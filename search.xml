<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ubuntué…ç½®v2rayè¯¦ç»†æ•™ç¨‹</title>
    <url>/2020/02/23/Ubuntu%E9%85%8D%E7%BD%AEv2ray%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title=" ç®€ä»‹"></a><a id="more"></a> ç®€ä»‹</h2><p>ğŸŒŸLinux/Windows/macOS è·¨å¹³å° v2ray GUI ğŸ”¨ ä½¿ç”¨ c++ ç¼–å†™ï¼Œæ”¯æŒè®¢é˜…ï¼Œæ‰«æäºŒç»´ç ï¼Œæ”¯æŒè‡ªå®šä¹‰è·¯ç”±ç¼–è¾‘ ğŸŒŸã€‚ä½¿ç”¨ Qt æ¡†æ¶çš„è·¨å¹³å° v2ray å®¢æˆ·ç«¯ã€‚æ”¯æŒ Windows, Linux, macOSã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul>
<li><p>ä¸‹è½½<code>V2ray</code>å®¢æˆ·ç«¯ï¼Œè¿™é‡Œä»¥æœ€ç®€å•çš„<code>AppImage</code>æ–‡ä»¶ä¸ºä¾‹,ä¸‹è½½é“¾æ¥ï¼š<br><a href="https://github.com/Qv2ray/Qv2ray/releases/download/v1.99.6/Qv2ray-refs.tags.v1.99.6-linux.AppImage" target="_blank" rel="noopener">https://github.com/Qv2ray/Qv2ray/releases/download/v1.99.6/Qv2ray-refs.tags.v1.99.6-linux.AppImage</a><br>æˆ–è€…æ‰“å¼€ç½‘ç«™ï¼š<a href="https://github.com/Qv2ray/Qv2ray/releases/tag/v1.99.6" target="_blank" rel="noopener">https://github.com/Qv2ray/Qv2ray/releases/tag/v1.99.6</a> é€‰æ‹©ä¸‹å›¾æ–‡ä»¶<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580651760-1.png" alt><br><strong>æ³¨æ„ï¼šå»ºè®®ä¸‹è½½1.99.6åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå…¶å®ƒç‰ˆæœ¬å¯èƒ½å‡ºç°æ‰¾ä¸åˆ°opensslåº“ã€‚</strong></p>
</li>
<li><p>ä¸‹è½½æ ¸å¿ƒæ–‡ä»¶ï¼Œä¸‹è½½é“¾æ¥ï¼š<br><a href="https://github.com/v2ray/v2ray-core/releases/download/v4.22.1/v2ray-linux-64.zip" target="_blank" rel="noopener">https://github.com/v2ray/v2ray-core/releases/download/v4.22.1/v2ray-linux-64.zip</a><br>æˆ–è€…æ‰“å¼€ç½‘ç«™ï¼š<a href="https://github.com/v2ray/v2ray-core/releases/" target="_blank" rel="noopener">https://github.com/v2ray/v2ray-core/releases/</a> é€‰æ‹©ä¸‹å›¾æ–‡ä»¶<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580651801-2.png" alt></p>
</li>
<li><p>è¿›å…¥v2rayä¸‹è½½çš„æ ¹ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chmod +x .&#x2F;Qv2ray-refs.tags.v1.99.6-linux.AppImage</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»ç„¶åœ¨v2rayæ ¹ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;Qv2ray-refs.tags.v1.99.6-linux.AppImage</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2></li>
</ul>
<p>æ‰§è¡Œåä¼šå‡ºç°ä¸»ç•Œé¢ï¼Œç‚¹å‡»é¦–é€‰é¡¹</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580652261-3-1580634671283.png" alt></p>
<p>åœ¨å¸¸è§„è®¾ç½®é‡Œé¢æŒ‰ç…§å›¾ç¤ºæ“ä½œ,æœ€åç‚¹å‡»okä¿å­˜ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580652339-4.png" alt></p>
<p>å›åˆ°ä¸»ç•Œé¢ï¼Œç‚¹å‡»è®¢é˜…ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580652363-5.png" alt></p>
<p>ç„¶åæŒ‰ç…§ä¸‹å›¾è¦æ±‚å¡«å…¥ç›¸åº”å†…å®¹,ç„¶åç‚¹å‡»okï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580655824-6.png" alt></p>
<p>è¿›å…¥ç½‘ç«™-&gt;ä¸ªäººä¸­å¿ƒï¼ŒæŒ‰ç…§ä¸‹å›¾è¯´æ˜å¤åˆ¶é“¾æ¥åˆ°ä¸Šå›¾ä¸­ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580652405-7.png" alt></p>
<p>å°†è½¯ä»¶çš„ä»£ç†æ¨¡å¼æ‰“å¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼›</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580653297-8.png" alt></p>
<p>ä¸€åˆ‡å‡†å¤‡å¥½åç‚¹å‡»ä¸»ç•Œé¢çš„è¿æ¥ï¼Œå¼€å§‹ç§‘å­¦ä¸Šç½‘</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580653343-9.png" alt></p>
<p>å¢™å¤–çš„ä¸–ç•Œåœ¨æ¬¢è¿ä½ !</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2ray/1580653648-tzyy_2020-02-02_22-27-02.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetå·ç§¯å±‚çš„å‰å‘ä¼ æ’­è§£æ</title>
    <url>/2020/02/23/AlexeyAB-DarkNet%E5%8D%B7%E7%A7%AF%E5%B1%82%E7%9A%84%E5%89%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title=" å‰è¨€"></a><a id="more"></a> å‰è¨€</h2><p>ä»Šå¤©æ¥ä»‹ç»ä¸€ä¸‹DarkNetä¸­å·ç§¯å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„å®ç°ï¼Œå·ç§¯å±‚æ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œäº†è§£å®ƒçš„åº•å±‚ä»£ç å®ç°å¯¹æˆ‘ä»¬ç†è§£å·ç§¯ç¥ç»ç½‘ç»œä»¥åŠä¼˜åŒ–å·ç§¯ç¥ç»ç½‘ç»œéƒ½æœ‰ä¸€äº›å¸®åŠ©ã€‚</p>
<h2 id="å·ç§¯å±‚çš„æ„é€ "><a href="#å·ç§¯å±‚çš„æ„é€ " class="headerlink" title="å·ç§¯å±‚çš„æ„é€ "></a>å·ç§¯å±‚çš„æ„é€ </h2><p>å·ç§¯å±‚çš„æ„é€ ä¸»è¦åœ¨<code>src/convolutional_layer.c</code>ä¸­çš„<code>make_convolutional_layer</code>ä¸­è¿›è¡Œå®ç°ï¼Œä¸‹é¢ç»™å‡ºéƒ¨åˆ†æ ¸å¿ƒä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** batch æ¯ä¸ªbatchå«æœ‰çš„å›¾ç‰‡æ•°</span><br><span class="line">** step</span><br><span class="line">** h å›¾åƒé«˜åº¦(è¡Œæ•°)</span><br><span class="line">** w å›¾åƒå®½åº¦(åˆ—æ•°)</span><br><span class="line">** c è¾“å…¥å›¾åƒé€šé“æ•°</span><br><span class="line">** n å·ç§¯æ ¸ä¸ªæ•°</span><br><span class="line">** groups åˆ†ç»„æ•°</span><br><span class="line">** size å·ç§¯æ ¸å°ºå¯¸</span><br><span class="line">** stride æ­¥é•¿</span><br><span class="line">** dilation ç©ºæ´å·ç§¯ç©ºæ´ç‡</span><br><span class="line">** padding å››å‘¨è¡¥0é•¿åº¦</span><br><span class="line">** activation æ¿€æ´»å‡½æ•°ç±»åˆ«</span><br><span class="line">** batch_normalize æ˜¯å¦è¿›è¡ŒBN</span><br><span class="line">** binary æ˜¯å¦å¯¹æƒé‡è¿›è¡ŒäºŒå€¼åŒ–</span><br><span class="line">** xnor æ˜¯å¦å¯¹æƒé‡ä»¥åŠè¾“å…¥è¿›è¡ŒäºŒå€¼åŒ–</span><br><span class="line">** adam ä¼˜åŒ–æ–¹å¼</span><br><span class="line">** use_bin_output</span><br><span class="line">** index åˆ†ç»„å·ç§¯çš„æ—¶å€™åˆ†ç»„ç´¢å¼•</span><br><span class="line">** antialiasing æŠ—é”¯é½¿æ ‡å¿—ï¼Œå¦‚æœä¸ºçœŸå¼ºè¡Œè®¾ç½®æ‰€æœ‰çš„æ­¥é•¿ä¸º1</span><br><span class="line">** share_layer æ ‡å¿—å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸€ä¸ªå·ç§¯å±‚æ˜¯å¦å’Œå…¶å®ƒå·ç§¯å±‚å…±äº«æƒé‡</span><br><span class="line">** assisted_excitation</span><br><span class="line">** deform æš‚æ—¶ä¸çŸ¥é“</span><br><span class="line">** train æ ‡å¿—å‚æ•°ï¼Œæ˜¯å¦åœ¨è®­ç»ƒ</span><br><span class="line">*&#x2F;</span><br><span class="line">convolutional_layer make_convolutional_layer(int batch, int steps, int h, int w, int c, int n, int groups, int size, int stride_x, int stride_y, int dilation, int padding, ACTIVATION activation,</span><br><span class="line"> int batch_normalize, int binary, int xnor, int adam, int use_bin_output, int index, int antialiasing, convolutional_layer *share_layer, int assisted_excitation, int deform, int train)</span><br><span class="line">&#123;</span><br><span class="line">    int total_batch &#x3D; batch*steps;</span><br><span class="line">    int i;</span><br><span class="line">    convolutional_layer l &#x3D; &#123; (LAYER_TYPE)0 &#125;;</span><br><span class="line">    l.type &#x3D; CONVOLUTIONAL;</span><br><span class="line">    l.train &#x3D; train;</span><br><span class="line"></span><br><span class="line">    if (xnor) groups &#x3D; 1;   &#x2F;&#x2F;å¯¹äºäºŒå€¼ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨åˆ†ç»„å·ç§¯</span><br><span class="line">    if (groups &lt; 1) groups &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    const int blur_stride_x &#x3D; stride_x;</span><br><span class="line">    const int blur_stride_y &#x3D; stride_y;</span><br><span class="line">    l.antialiasing &#x3D; antialiasing;</span><br><span class="line">    if (antialiasing) &#123;</span><br><span class="line">        stride_x &#x3D; stride_y &#x3D; l.stride &#x3D; l.stride_x &#x3D; l.stride_y &#x3D; 1; &#x2F;&#x2F; use stride&#x3D;1 in host-layer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    l.deform &#x3D; deform;</span><br><span class="line">    l.assisted_excitation &#x3D; assisted_excitation;</span><br><span class="line">    l.share_layer &#x3D; share_layer;</span><br><span class="line">    l.index &#x3D; index;</span><br><span class="line">    l.h &#x3D; h;</span><br><span class="line">    l.w &#x3D; w;</span><br><span class="line">    l.c &#x3D; c;</span><br><span class="line">    l.groups &#x3D; groups;</span><br><span class="line">    l.n &#x3D; n;</span><br><span class="line">    l.binary &#x3D; binary;</span><br><span class="line">    l.xnor &#x3D; xnor;</span><br><span class="line">    l.use_bin_output &#x3D; use_bin_output;</span><br><span class="line">    l.batch &#x3D; batch;</span><br><span class="line">    l.steps &#x3D; steps;</span><br><span class="line">    l.stride &#x3D; stride_x;</span><br><span class="line">    l.stride_x &#x3D; stride_x;</span><br><span class="line">    l.stride_y &#x3D; stride_y;</span><br><span class="line">    l.dilation &#x3D; dilation;</span><br><span class="line">    l.size &#x3D; size;</span><br><span class="line">    l.pad &#x3D; padding;</span><br><span class="line">    l.batch_normalize &#x3D; batch_normalize;</span><br><span class="line">    l.learning_rate_scale &#x3D; 1;</span><br><span class="line">	&#x2F;&#x2F; è¯¥å·ç§¯å±‚æ€»çš„æƒé‡å…ƒç´ ä¸ªæ•°ï¼ˆæƒé‡å…ƒç´ ä¸ªæ•°ç­‰äºè¾“å…¥æ•°æ®çš„é€šé“æ•°&#x2F;åˆ†ç»„æ•°*å·ç§¯æ ¸ä¸ªæ•°*å·ç§¯æ ¸çš„äºŒç»´å°ºå¯¸ï¼Œæ³¨æ„å› ä¸ºæ¯ä¸€ä¸ªå·ç§¯æ ¸æ˜¯åŒæ—¶ä½œç”¨äºè¾“å…¥æ•°æ®</span><br><span class="line">    &#x2F;&#x2F; çš„å¤šä¸ªé€šé“ä¸Šçš„ï¼Œå› æ­¤å®é™…ä¸Šå·ç§¯æ ¸æ˜¯ä¸‰ç»´çš„ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªç»´åº¦çš„å¹³é¢å°ºå¯¸ï¼Œä»¥åŠè¾“å…¥æ•°æ®é€šé“æ•°è¿™ä¸ªç»´åº¦ï¼Œæ¯ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸å‚æ•°éƒ½æ˜¯ç‹¬ç«‹çš„è®­ç»ƒå‚æ•°ï¼‰</span><br><span class="line">    l.nweights &#x3D; (c &#x2F; groups) * n * size * size;</span><br><span class="line">	&#x2F;&#x2F; å¦‚æœæ˜¯å…±äº«å·ç§¯å±‚ï¼Œå¯ä»¥ç›´æ¥ç”¨å…±äº«çš„å·ç§¯å±‚æ¥èµ‹å€¼ï¼ˆçŒœæµ‹æ˜¯æœ‰é¢„è®­ç»ƒæƒé‡çš„æ—¶å€™å¯ä»¥ç›´æ¥èµ‹å€¼ï¼‰</span><br><span class="line">    if (l.share_layer) &#123;</span><br><span class="line">        if (l.size !&#x3D; l.share_layer-&gt;size || l.nweights !&#x3D; l.share_layer-&gt;nweights || l.c !&#x3D; l.share_layer-&gt;c || l.n !&#x3D; l.share_layer-&gt;n) &#123;</span><br><span class="line">            printf(&quot;Layer size, nweights, channels or filters don&#39;t match for the share_layer&quot;);</span><br><span class="line">            getchar();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        l.weights &#x3D; l.share_layer-&gt;weights;</span><br><span class="line">        l.weight_updates &#x3D; l.share_layer-&gt;weight_updates;</span><br><span class="line"></span><br><span class="line">        l.biases &#x3D; l.share_layer-&gt;biases;</span><br><span class="line">        l.bias_updates &#x3D; l.share_layer-&gt;bias_updates;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">		&#x2F;&#x2F; è¯¥å·ç§¯å±‚æ€»çš„æƒé‡å…ƒç´ (å·ç§¯æ ¸å…ƒç´ )ä¸ªæ•°&#x3D;è¾“å…¥å›¾åƒé€šé“æ•° &#x2F; åˆ†ç»„æ•°*å·ç§¯æ ¸ä¸ªæ•°*å·ç§¯æ ¸å°ºå¯¸</span><br><span class="line">        l.weights &#x3D; (float*)xcalloc(l.nweights, sizeof(float));</span><br><span class="line">		&#x2F;&#x2F; biaså°±æ˜¯Wx+bä¸­çš„bï¼ˆä¸Šé¢çš„weightså°±æ˜¯Wï¼‰ï¼Œæœ‰å¤šå°‘ä¸ªå·ç§¯æ ¸ï¼Œå°±æœ‰å¤šå°‘ä¸ªbï¼ˆä¸Wçš„ä¸ªæ•°ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸ªWçš„å…ƒç´ ä¸ªæ•°ä¸ºc*size*sizeï¼‰</span><br><span class="line">        l.biases &#x3D; (float*)xcalloc(n, sizeof(float));</span><br><span class="line">		&#x2F;&#x2F; è®­ç»ƒæœŸé—´ï¼Œéœ€è¦æ‰§è¡Œåå‘ä¼ æ’­</span><br><span class="line">        if (train) &#123;</span><br><span class="line">			&#x2F;&#x2F; æ•æ„Ÿå›¾å’Œç‰¹å¾å›¾çš„å°ºå¯¸åº”è¯¥æ˜¯ä¸€æ ·çš„</span><br><span class="line">            l.weight_updates &#x3D; (float*)xcalloc(l.nweights, sizeof(float));</span><br><span class="line">			&#x2F;&#x2F; biasçš„æ•æ„Ÿå›¾ï¼Œç»´åº¦å’Œbiasä¸€è‡´</span><br><span class="line">            l.bias_updates &#x3D; (float*)xcalloc(n, sizeof(float));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; float scale &#x3D; 1.&#x2F;sqrt(size*size*c);</span><br><span class="line">	&#x2F;&#x2F; åˆå§‹åŒ–æƒé‡ï¼šç¼©æ”¾å› å­*æ ‡å‡†æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼Œç¼©æ”¾å› å­ç­‰äºsqrt(2.&#x2F;(size*size*c))ï¼Œéšæœºåˆå§‹åŒ–</span><br><span class="line">    &#x2F;&#x2F; æ­¤å¤„åˆå§‹åŒ–æƒé‡ä¸ºæ­£æ€åˆ†å¸ƒï¼Œè€Œåœ¨å…¨è¿æ¥å±‚make_connected_layer()ä¸­åˆå§‹åŒ–æƒé‡æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚</span><br><span class="line">    &#x2F;&#x2F; TODOï¼šä¸ªäººæ„Ÿè§‰ï¼Œè¿™é‡Œåº”è¯¥åŠ ä¸€ä¸ªifæ¡ä»¶è¯­å¥ï¼šif(weightfile)ï¼Œå› ä¸ºå¦‚æœå¯¼å…¥äº†é¢„è®­ç»ƒæƒé‡æ–‡ä»¶ï¼Œå°±æ²¡æœ‰å¿…è¦è¿™æ ·åˆå§‹åŒ–äº†ï¼ˆäº‹å®ä¸Šåœ¨detector.cçš„train_detector()å‡½æ•°ä¸­ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ç´§æ¥ç€parse_network_cfg()å‡½æ•°ä¹‹åï¼Œå°±æ·»åŠ äº†if(weightfile)è¯­å¥åˆ¤æ–­æ˜¯å¦å¯¼å…¥æƒé‡ç³»æ•°æ–‡ä»¶ï¼Œå¦‚æœå¯¼å…¥äº†æƒé‡ç³»æ•°æ–‡ä»¶ï¼Œä¹Ÿè®¸è¿™é‡Œåˆå§‹åŒ–çš„å€¼ä¹Ÿä¼šè¦†ç›–æ‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; æ€»ä¹‹è¿™é‡Œçš„æƒé‡åˆå§‹åŒ–çš„å¤„ç†æ–¹å¼è¿˜æ˜¯å€¼å¾—æ€è€ƒçš„ï¼Œä¹Ÿè®¸æ›´å¥½çš„æ–¹å¼æ˜¯åº”è¯¥è®¾ç½®ä¸“é—¨çš„å‡½æ•°è¿›è¡Œæƒé‡çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶åç½®ä¹Ÿæ˜¯ï¼Œä¸è¿‡è¿™é‡Œä¼¼ä¹æ²¡æœ‰è€ƒè™‘åç½®çš„åˆå§‹åŒ–ï¼Œåœ¨make_connected_layer()ä¸­å€’æ˜¯æœ‰ã€‚ã€‚ã€‚ï¼‰</span><br><span class="line">    float scale &#x3D; sqrt(2.&#x2F;(size*size*c&#x2F;groups));</span><br><span class="line">    for(i &#x3D; 0; i &lt; l.nweights; ++i) l.weights[i] &#x3D; scale*rand_uniform(-1, 1);   &#x2F;&#x2F; rand_normal();</span><br><span class="line">	&#x2F;&#x2F; æ ¹æ®è¯¥å±‚è¾“å…¥å›¾åƒçš„å°ºå¯¸ã€å·ç§¯æ ¸å°ºå¯¸ä»¥åŠè·¨åº¦è®¡ç®—è¾“å‡ºç‰¹å¾å›¾çš„å®½åº¦å’Œé«˜åº¦</span><br><span class="line">    int out_h &#x3D; convolutional_out_height(l);</span><br><span class="line">    int out_w &#x3D; convolutional_out_width(l);</span><br><span class="line">	&#x2F;&#x2F; è¾“å‡ºå›¾åƒé«˜åº¦</span><br><span class="line">    l.out_h &#x3D; out_h;</span><br><span class="line">	&#x2F;&#x2F; è¾“å‡ºå›¾åƒå®½åº¦	</span><br><span class="line">    l.out_w &#x3D; out_w;</span><br><span class="line">	&#x2F;&#x2F; è¾“å‡ºå›¾åƒé€šé“æ•°(ç­‰äºå·ç§¯æ ¸ä¸ªæ•°,æœ‰å¤šå°‘ä¸ªå·ç§¯æ ¸ï¼Œæœ€ç»ˆå°±å¾—åˆ°å¤šå°‘å¼ ç‰¹å¾å›¾ï¼Œæ¯å¼ ç‰¹å¾å›¾æ˜¯ä¸€ä¸ªé€šé“)</span><br><span class="line">    l.out_c &#x3D; n;</span><br><span class="line">    l.outputs &#x3D; l.out_h * l.out_w * l.out_c; &#x2F;&#x2F; å¯¹åº”æ¯å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆæ¯å¼ è¾“å…¥å›¾ç‰‡ä¼šå¾—åˆ°nä¹Ÿå³l.out_cå¼ ç‰¹å¾å›¾ï¼‰</span><br><span class="line">    l.inputs &#x3D; l.w * l.h * l.c; &#x2F;&#x2F; mini-batchä¸­æ¯å¼ è¾“å…¥å›¾ç‰‡çš„åƒç´ å…ƒç´ ä¸ªæ•°</span><br><span class="line">    l.activation &#x3D; activation;</span><br><span class="line"></span><br><span class="line">    l.output &#x3D; (float*)xcalloc(total_batch*l.outputs, sizeof(float)); &#x2F;&#x2F; l.outputä¸ºè¯¥å±‚æ‰€æœ‰çš„è¾“å‡ºï¼ˆåŒ…æ‹¬mini-batchæ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼‰</span><br><span class="line">#ifndef GPU</span><br><span class="line">    if (train) l.delta &#x3D; (float*)xcalloc(total_batch*l.outputs, sizeof(float));  &#x2F;&#x2F; l.delta è¯¥å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå’Œè¾“å‡ºçš„ç»´åº¦æƒ³åŒ</span><br><span class="line">#endif  &#x2F;&#x2F; not GPU</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; å·ç§¯å±‚ä¸‰ç§æŒ‡é’ˆå‡½æ•°ï¼Œå¯¹åº”ä¸‰ç§è®¡ç®—ï¼šå‰å‘ï¼Œåå‘ï¼Œæ›´æ–°</span><br><span class="line">    l.forward &#x3D; forward_convolutional_layer;</span><br><span class="line">    l.backward &#x3D; backward_convolutional_layer;</span><br><span class="line">    l.update &#x3D; update_convolutional_layer;</span><br></pre></td></tr></table></figure>
<h2 id="å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ"><a href="#å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ" class="headerlink" title="å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ"></a>å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ</h2><p>ä»£ç åœ¨<code>src/convolutional_layer.c</code>ä¸­ï¼Œæ³¨é‡Šå¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å·ç§¯å±‚çš„å‰å‘ä¼ æ’­æ ¸å¿ƒä»£ç </span><br><span class="line">void forward_convolutional_layer(convolutional_layer l, network_state state)</span><br><span class="line">&#123;</span><br><span class="line">    int out_h &#x3D; convolutional_out_height(l);</span><br><span class="line">    int out_w &#x3D; convolutional_out_width(l);</span><br><span class="line">    int i, j;</span><br><span class="line">	&#x2F;&#x2F; l.outputs &#x3D; l.out_h * l.out_w * l.out_cåœ¨makeå„ç½‘ç»œå±‚å‡½æ•°ä¸­èµ‹å€¼ï¼ˆæ¯”å¦‚make_convolutional_layer()ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å¯¹åº”æ¯å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆæ¯å¼ è¾“å…¥å›¾ç‰‡ä¼šå¾—åˆ°nä¹Ÿå³l.out_cå¼ ç‰¹å¾å›¾ï¼‰</span><br><span class="line">    &#x2F;&#x2F; åˆå§‹åŒ–è¾“å‡ºl.outputå…¨ä¸º0.0ï¼›è¾“å…¥l.outputs*l.batchä¸ºè¾“å‡ºçš„æ€»å…ƒç´ ä¸ªæ•°ï¼Œå…¶ä¸­l.outputsä¸ºbatch</span><br><span class="line">    &#x2F;&#x2F; ä¸­ä¸€ä¸ªè¾“å…¥å¯¹åº”çš„è¾“å‡ºçš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°ï¼Œl.batchä¸ºä¸€ä¸ªbatchè¾“å…¥åŒ…å«çš„å›¾ç‰‡å¼ æ•°ï¼›0è¡¨ç¤ºåˆå§‹åŒ–æ‰€æœ‰è¾“å‡ºä¸º0ï¼›</span><br><span class="line">    fill_cpu(l.outputs*l.batch, 0, l.output, 1);</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; æ˜¯å¦è¿›è¡ŒäºŒå€¼åŒ–æ“ä½œ</span><br><span class="line">    if (l.xnor &amp;&amp; (!l.align_bit_weights || state.train)) &#123;</span><br><span class="line">        if (!l.align_bit_weights || state.train) &#123;</span><br><span class="line">            binarize_weights(l.weights, l.n, l.nweights, l.binary_weights);</span><br><span class="line">            &#x2F;&#x2F;printf(&quot;\n binarize_weights l.align_bit_weights &#x3D; %p \n&quot;, l.align_bit_weights);</span><br><span class="line">        &#125;</span><br><span class="line">        swap_binary(&amp;l);</span><br><span class="line">        binarize_cpu(state.input, l.c*l.h*l.w*l.batch, l.binary_input);</span><br><span class="line">        state.input &#x3D; l.binary_input;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int m &#x3D; l.n &#x2F; l.groups; &#x2F;&#x2F; è¯¥å±‚çš„å·ç§¯æ ¸ä¸ªæ•°</span><br><span class="line">    int k &#x3D; l.size*l.size*l.c &#x2F; l.groups; &#x2F;&#x2F; è¯¥å±‚æ¯ä¸ªå·ç§¯æ ¸çš„å‚æ•°å…ƒç´ ä¸ªæ•°</span><br><span class="line">    int n &#x3D; out_h*out_w; &#x2F;&#x2F; è¯¥å±‚æ¯ä¸ªç‰¹å¾å›¾çš„å°ºå¯¸(å…ƒç´ ä¸ªæ•°)</span><br><span class="line"></span><br><span class="line">    static int u &#x3D; 0;</span><br><span class="line">    u++;</span><br><span class="line">    &#x2F;&#x2F; è¯¥å¾ªç¯å³ä¸ºå·ç§¯è®¡ç®—æ ¸å¿ƒä»£ç ï¼šæ‰€æœ‰å·ç§¯æ ¸å¯¹batchä¸­æ¯å¼ å›¾ç‰‡è¿›è¡Œå·ç§¯è¿ç®—</span><br><span class="line">    &#x2F;&#x2F; æ¯æ¬¡å¾ªç¯å¤„ç†ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼ˆæ‰€æœ‰å·ç§¯æ ¸å¯¹batchä¸­ä¸€å¼ å›¾ç‰‡åšå·ç§¯è¿ç®—ï¼‰</span><br><span class="line">    for(i &#x3D; 0; i &lt; l.batch; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">		&#x2F;&#x2F; è¯¥å¾ªç¯æ˜¯ä¸ºäº†å¤„ç†åˆ†ç»„å·ç§¯</span><br><span class="line">        for (j &#x3D; 0; j &lt; l.groups; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">			&#x2F;&#x2F; å½“å‰ç»„å·ç§¯æ ¸(ä¹Ÿå³æƒé‡)ï¼Œå…ƒç´ ä¸ªæ•°ä¸ºl.n*l.c&#x2F;l.groups*l.size*l.size,</span><br><span class="line">            &#x2F;&#x2F; å…±æœ‰l.nè¡Œï¼Œl.c&#x2F;l.gropus,l.c*l.size*l.sizeåˆ—</span><br><span class="line">            float *a &#x3D; l.weights +j*l.nweights &#x2F; l.groups;</span><br><span class="line">			&#x2F;&#x2F; å¯¹è¾“å…¥å›¾åƒè¿›è¡Œé‡æ’ä¹‹åçš„å›¾åƒæ•°æ®ï¼Œæ‰€ä»¥å†…å­˜ç©ºé—´ç”³è¯·ä¸ºç½‘ç»œä¸­æœ€å¤§å ç”¨å†…å­˜</span><br><span class="line">            float *b &#x3D; state.workspace;</span><br><span class="line">			&#x2F;&#x2F; å­˜å‚¨ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼ˆå¤šé€šé“ï¼‰å½“å‰ç»„çš„è¾“å‡ºç‰¹å¾å›¾ï¼ˆè¾“å…¥å›¾ç‰‡æ˜¯å¤šé€šé“çš„ï¼Œè¾“å‡º</span><br><span class="line">            &#x2F;&#x2F; å›¾ç‰‡ä¹Ÿæ˜¯å¤šé€šé“çš„ï¼Œæœ‰å¤šå°‘ç»„å·ç§¯æ ¸å°±æœ‰å¤šå°‘ç»„é€šé“ï¼Œæ¯ä¸ªåˆ†ç»„åçš„å·ç§¯æ ¸å¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾å³ä¸ºä¸€ä¸ªé€šé“ï¼‰</span><br><span class="line">            &#x2F;&#x2F; è¿™é‡Œä¼¼ä¹æœ‰ç‚¹æ‹—å£ï¼Œå¯ä»¥çœ‹ä¸‹åˆ†ç»„å·ç§¯åŸç†ã€‚</span><br><span class="line">            float *c &#x3D; l.output +(i*l.groups + j)*n*m;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;gemm(0,0,m,n,k,1,a,k,b,n,1,c,n);</span><br><span class="line">            &#x2F;&#x2F;gemm_nn_custom(m, n, k, 1, a, k, b, n, c, n);</span><br><span class="line">			&#x2F;&#x2F;äºŒå€¼ç½‘ç»œï¼Œç‰¹æ®Šå¤„ç†ï¼Œé‡Œé¢è¿˜æœ‰ä¸€äº›ä¼˜åŒ–ï¼Œç»†èŠ‚å¾ˆå¤šï¼Œè¿™é‡Œæš‚æ—¶ä¸ç®¡äºŒå€¼ç½‘ç»œè¿™éƒ¨åˆ†ï¼ŒæŠŠæ³¨æ„åŠ›å…ˆæ”¾åœ¨æ™®é€šå·ç§¯å±‚çš„è®¡ç®—ä¸Š</span><br><span class="line">            if (l.xnor &amp;&amp; l.align_bit_weights &amp;&amp; !state.train &amp;&amp; l.stride_x &#x3D;&#x3D; l.stride_y)</span><br><span class="line">            &#123;</span><br><span class="line">                memset(b, 0, l.bit_align*l.size*l.size*l.c * sizeof(float));</span><br><span class="line"></span><br><span class="line">                if (l.c % 32 &#x3D;&#x3D; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    &#x2F;&#x2F;printf(&quot; l.index &#x3D; %d - new XNOR \n&quot;, l.index);</span><br><span class="line"></span><br><span class="line">                    int ldb_align &#x3D; l.lda_align;</span><br><span class="line">                    size_t new_ldb &#x3D; k + (ldb_align - k%ldb_align); &#x2F;&#x2F; (k &#x2F; 8 + 1) * 8;</span><br><span class="line">                    &#x2F;&#x2F;size_t t_intput_size &#x3D; new_ldb * l.bit_align;&#x2F;&#x2F; n;</span><br><span class="line">                    &#x2F;&#x2F;size_t t_bit_input_size &#x3D; t_intput_size &#x2F; 8;&#x2F;&#x2F; +1;</span><br><span class="line"></span><br><span class="line">                    int re_packed_input_size &#x3D; l.c * l.w * l.h;</span><br><span class="line">                    memset(state.workspace, 0, re_packed_input_size * sizeof(float));</span><br><span class="line"></span><br><span class="line">                    const size_t new_c &#x3D; l.c &#x2F; 32;</span><br><span class="line">                    size_t in_re_packed_input_size &#x3D; new_c * l.w * l.h + 1;</span><br><span class="line">                    memset(l.bin_re_packed_input, 0, in_re_packed_input_size * sizeof(uint32_t));</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;float *re_packed_input &#x3D; calloc(l.c * l.w * l.h, sizeof(float));</span><br><span class="line">                    &#x2F;&#x2F;uint32_t *bin_re_packed_input &#x3D; calloc(new_c * l.w * l.h + 1, sizeof(uint32_t));</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; float32x4 by channel (as in cuDNN)</span><br><span class="line">                    repack_input(state.input, state.workspace, l.w, l.h, l.c);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 32 x floats -&gt; 1 x uint32_t</span><br><span class="line">                    float_to_bit(state.workspace, (unsigned char *)l.bin_re_packed_input, l.c * l.w * l.h);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;free(re_packed_input);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; slow - convolution the packed inputs and weights: float x 32 by channel (as in cuDNN)</span><br><span class="line">                    &#x2F;&#x2F;convolution_repacked((uint32_t *)bin_re_packed_input, (uint32_t *)l.align_bit_weights, l.output,</span><br><span class="line">                    &#x2F;&#x2F;    l.w, l.h, l.c, l.n, l.size, l.pad, l.new_lda, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; &#x2F;&#x2F; then exit from if()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    im2col_cpu_custom((float *)l.bin_re_packed_input, new_c, l.h, l.w, l.size, l.stride, l.pad, state.workspace);</span><br><span class="line">                    &#x2F;&#x2F;im2col_cpu((float *)bin_re_packed_input, new_c, l.h, l.w, l.size, l.stride, l.pad, b);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;free(bin_re_packed_input);</span><br><span class="line"></span><br><span class="line">                    int new_k &#x3D; l.size*l.size*l.c &#x2F; 32;</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; good for (l.c &#x3D;&#x3D; 64)</span><br><span class="line">                    &#x2F;&#x2F;gemm_nn_bin_32bit_packed(m, n, new_k, 1,</span><br><span class="line">                    &#x2F;&#x2F;    l.align_bit_weights, l.new_lda&#x2F;32,</span><br><span class="line">                    &#x2F;&#x2F;    b, n,</span><br><span class="line">                    &#x2F;&#x2F;    c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; &#x2F;&#x2F; then exit from if()</span><br><span class="line"></span><br><span class="line">                    transpose_uint32((uint32_t *)state.workspace, (uint32_t*)l.t_bit_input, new_k, n, n, new_ldb);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; the main GEMM function</span><br><span class="line">                    gemm_nn_custom_bin_mean_transposed(m, n, k, 1, (unsigned char*)l.align_bit_weights, new_ldb, (unsigned char*)l.t_bit_input, new_ldb, c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; &#x2F;&#x2F; alternative GEMM</span><br><span class="line">                    &#x2F;&#x2F;gemm_nn_bin_transposed_32bit_packed(m, n, new_k, 1,</span><br><span class="line">                    &#x2F;&#x2F;    l.align_bit_weights, l.new_lda&#x2F;32,</span><br><span class="line">                    &#x2F;&#x2F;    t_bit_input, new_ldb &#x2F; 32,</span><br><span class="line">                    &#x2F;&#x2F;    c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;free(t_bit_input);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123; &#x2F;&#x2F; else (l.c % 32 !&#x3D; 0)</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;--------------------------------------------------------</span><br><span class="line">                    &#x2F;&#x2F;printf(&quot; l.index &#x3D; %d - old XNOR \n&quot;, l.index);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;im2col_cpu_custom_align(state.input, l.c, l.h, l.w, l.size, l.stride, l.pad, b, l.bit_align);</span><br><span class="line">                    im2col_cpu_custom_bin(state.input, l.c, l.h, l.w, l.size, l.stride, l.pad, state.workspace, l.bit_align);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;size_t output_size &#x3D; l.outputs;</span><br><span class="line">                    &#x2F;&#x2F;float *count_output &#x3D; calloc(output_size, sizeof(float));</span><br><span class="line">                    &#x2F;&#x2F;size_t bit_output_size &#x3D; output_size &#x2F; 8 + 1;</span><br><span class="line">                    &#x2F;&#x2F;char *bit_output &#x3D; calloc(bit_output_size, sizeof(char));</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;size_t intput_size &#x3D; n * k; &#x2F;&#x2F; (out_h*out_w) X (l.size*l.size*l.c) : after im2col()</span><br><span class="line">                    &#x2F;&#x2F;size_t bit_input_size &#x3D; intput_size &#x2F; 8 + 1;</span><br><span class="line">                    &#x2F;&#x2F;char *bit_input &#x3D; calloc(bit_input_size, sizeof(char));</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;size_t weights_size &#x3D; k * m; &#x2F;&#x2F;l.size*l.size*l.c*l.n; &#x2F;&#x2F; l.nweights</span><br><span class="line">                    &#x2F;&#x2F;size_t bit_weights_size &#x3D; weights_size &#x2F; 8 + 1;</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;char *bit_weights &#x3D; calloc(bit_weights_size, sizeof(char));</span><br><span class="line">                    &#x2F;&#x2F;float *mean_arr &#x3D; calloc(l.n, sizeof(float));</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; transpose B from NxK to KxN (x-axis (ldb &#x3D; l.size*l.size*l.c) - should be multiple of 8 bits)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &#x2F;&#x2F;size_t ldb_align &#x3D; 256; &#x2F;&#x2F; 256 bit for AVX2</span><br><span class="line">                        int ldb_align &#x3D; l.lda_align;</span><br><span class="line">                        size_t new_ldb &#x3D; k + (ldb_align - k%ldb_align);</span><br><span class="line">                        size_t t_intput_size &#x3D; binary_transpose_align_input(k, n, state.workspace, &amp;l.t_bit_input, ldb_align, l.bit_align);</span><br><span class="line"></span><br><span class="line">                        &#x2F;&#x2F; 5x times faster than gemm()-float32</span><br><span class="line">                        gemm_nn_custom_bin_mean_transposed(m, n, k, 1, (unsigned char*)l.align_bit_weights, new_ldb, (unsigned char*)l.t_bit_input, new_ldb, c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                        &#x2F;&#x2F;gemm_nn_custom_bin_mean_transposed(m, n, k, 1, bit_weights, k, t_bit_input, new_ldb, c, n, mean_arr);</span><br><span class="line"></span><br><span class="line">                        &#x2F;&#x2F;free(t_input);</span><br><span class="line">                        &#x2F;&#x2F;free(t_bit_input);</span><br><span class="line">                        &#x2F;&#x2F;&#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                add_bias(l.output, l.biases, l.batch, l.n, out_h*out_w);</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F;activate_array(l.output, m*n*l.batch, l.activation);</span><br><span class="line">                if (l.activation &#x3D;&#x3D; SWISH) activate_array_swish(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">                else if (l.activation &#x3D;&#x3D; MISH) activate_array_mish(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">                else if (l.activation &#x3D;&#x3D; NORM_CHAN) activate_array_normalize_channels(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output);</span><br><span class="line">                else if (l.activation &#x3D;&#x3D; NORM_CHAN_SOFTMAX) activate_array_normalize_channels_softmax(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, 0);</span><br><span class="line">                else if (l.activation &#x3D;&#x3D; NORM_CHAN_SOFTMAX_MAXVAL) activate_array_normalize_channels_softmax(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, 1);</span><br><span class="line">                else activate_array_cpu_custom(l.output, m*n*l.batch, l.activation);</span><br><span class="line">                return;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                &#x2F;&#x2F;printf(&quot; l.index &#x3D; %d - FP32 \n&quot;, l.index);</span><br><span class="line">				&#x2F;&#x2F; ç”±äºæœ‰åˆ†ç»„å·ç§¯ï¼Œæ‰€ä»¥è·å–å±äºå½“å‰ç»„çš„è¾“å…¥imå¹¶æŒ‰ä¸€å®šå­˜å‚¨è§„åˆ™æ’åˆ—çš„æ•°ç»„bï¼Œ</span><br><span class="line">				&#x2F;&#x2F; ä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°è¿›è¡ŒçŸ©é˜µï¼ˆå·ç§¯ï¼‰è®¡ç®—ï¼Œè¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span><br><span class="line">				&#x2F;&#x2F; è¿™é‡Œçš„imå®é™…ä¸ŠåªåŠ è½½äº†ä¸€å¼ å›¾ç‰‡çš„æ•°æ®</span><br><span class="line">				&#x2F;&#x2F; å…³äºim2colçš„åŸç†æˆ‘ä¼šè®²</span><br><span class="line">                float *im &#x3D; state.input + (i*l.groups + j)*(l.c &#x2F; l.groups)*l.h*l.w;</span><br><span class="line">				&#x2F;&#x2F; å¦‚æœè¿™é‡Œå·ç§¯æ ¸å°ºå¯¸ä¸º1ï¼Œæ˜¯ä¸éœ€è¦æ”¹å˜å†…å­˜æ’å¸ƒæ–¹å¼</span><br><span class="line">                if (l.size &#x3D;&#x3D; 1) &#123;</span><br><span class="line">                    b &#x3D; im;</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    &#x2F;&#x2F;im2col_cpu(im, l.c &#x2F; l.groups, l.h, l.w, l.size, l.stride, l.pad, b);</span><br><span class="line">					&#x2F;&#x2F; å°†å¤šé€šé“äºŒç»´å›¾åƒimå˜æˆæŒ‰ä¸€å®šå­˜å‚¨è§„åˆ™æ’åˆ—çš„æ•°ç»„bï¼Œ</span><br><span class="line">					&#x2F;&#x2F; ä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°è¿›è¡ŒçŸ©é˜µï¼ˆå·ç§¯ï¼‰è®¡ç®—ï¼Œè¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span><br><span class="line">					&#x2F;&#x2F; è¿›è¡Œé‡æ’ï¼Œl.c&#x2F;groupsä¸ºæ¯å¼ å›¾ç‰‡çš„é€šé“æ•°åˆ†ç»„ï¼Œl.hä¸ºæ¯å¼ å›¾ç‰‡çš„é«˜åº¦ï¼Œl.wä¸ºæ¯å¼ å›¾ç‰‡çš„å®½åº¦ï¼Œl.sizeä¸ºå·ç§¯æ ¸å°ºå¯¸ï¼Œl.strideä¸ºæ­¥é•¿</span><br><span class="line">					&#x2F;&#x2F; å¾—åˆ°çš„bä¸ºä¸€å¼ å›¾ç‰‡é‡æ’åçš„ç»“æœï¼Œä¹Ÿæ˜¯æŒ‰è¡Œå­˜å‚¨çš„ä¸€ç»´æ•°ç»„ï¼ˆå…±æœ‰l.c&#x2F;l.groups*l.size*l.sizeè¡Œï¼Œl.out_w*l.out_håˆ—ï¼‰</span><br><span class="line">                    im2col_cpu_ext(im,   &#x2F;&#x2F; input</span><br><span class="line">                        l.c &#x2F; l.groups,     &#x2F;&#x2F; input channels</span><br><span class="line">                        l.h, l.w,           &#x2F;&#x2F; input size (h, w)</span><br><span class="line">                        l.size, l.size,     &#x2F;&#x2F; kernel size (h, w)</span><br><span class="line">                        l.pad, l.pad,       &#x2F;&#x2F; padding (h, w)</span><br><span class="line">                        l.stride_y, l.stride_x, &#x2F;&#x2F; stride (h, w)</span><br><span class="line">                        l.dilation, l.dilation, &#x2F;&#x2F; dilation (h, w)</span><br><span class="line">                        b);                 &#x2F;&#x2F; output</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">				&#x2F;&#x2F; æ­¤å¤„åœ¨im2col_cpuæ“ä½œåŸºç¡€ä¸Šï¼Œåˆ©ç”¨çŸ©é˜µä¹˜æ³•c&#x3D;alpha*a*b+beta*cå®Œæˆå¯¹å›¾åƒå·ç§¯çš„æ“ä½œ</span><br><span class="line">				&#x2F;&#x2F; 0,0è¡¨ç¤ºä¸å¯¹è¾“å…¥a,bè¿›è¡Œè½¬ç½®ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; mæ˜¯è¾“å…¥a,cçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªå·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; næ˜¯è¾“å…¥b,cçš„åˆ—æ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªè¾“å‡ºç‰¹å¾å›¾çš„å…ƒç´ ä¸ªæ•°(out_h*out_w)ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; kæ˜¯è¾“å…¥açš„åˆ—æ•°ä¹Ÿæ˜¯bçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºå·ç§¯æ ¸å…ƒç´ ä¸ªæ•°ä¹˜ä»¥è¾“å…¥å›¾åƒçš„é€šé“æ•°é™¤ä»¥åˆ†ç»„æ•°ï¼ˆl.size*l.size*l.c&#x2F;l.groupsï¼‰ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; a,b,cå³ä¸ºä¸‰ä¸ªå‚ä¸è¿ç®—çš„çŸ©é˜µï¼ˆç”¨ä¸€ç»´æ•°ç»„å­˜å‚¨ï¼‰,alpha&#x3D;beta&#x3D;1ä¸ºå¸¸ç³»æ•°ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; aä¸ºæ‰€æœ‰å·ç§¯æ ¸é›†åˆ,å…ƒç´ ä¸ªæ•°ä¸ºl.n*l.c&#x2F;l.groups*l.size*l.sizeï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå…±æœ‰l*nè¡Œï¼Œl.c&#x2F;l.groups*l.size*l.sizeåˆ—ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; å³aä¸­æ¯è¡Œä»£è¡¨ä¸€ä¸ªå¯ä»¥ä½œç”¨åœ¨3é€šé“ä¸Šçš„å·ç§¯æ ¸ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; bä¸ºä¸€å¼ è¾“å…¥å›¾åƒç»è¿‡im2col_cpué‡æ’åçš„å›¾åƒæ•°æ®ï¼ˆå…±æœ‰l.c&#x2F;l.group*l.size*l.sizeè¡Œï¼Œl.out_w*l.out_håˆ—ï¼‰ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; cä¸ºgemm()è®¡ç®—å¾—åˆ°çš„å€¼ï¼ŒåŒ…å«ä¸€å¼ è¾“å…¥å›¾ç‰‡å¾—åˆ°çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾ï¼ˆæ¯ä¸ªå·ç§¯æ ¸å¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾ï¼‰ï¼Œcä¸­ä¸€è¡Œä»£è¡¨ä¸€å¼ ç‰¹å¾å›¾ï¼Œ</span><br><span class="line">				&#x2F;&#x2F; å„ç‰¹å¾å›¾é“ºæ’å¼€æˆä¸€è¡Œåï¼Œå†å°†æ‰€æœ‰ç‰¹å¾å›¾å¹¶æˆä¸€å¤§è¡Œï¼Œå­˜å‚¨åœ¨cä¸­ï¼Œå› æ­¤cå¯è§†ä½œæœ‰l.nè¡Œï¼Œl.out_h*l.out_wåˆ—ã€‚</span><br><span class="line">				&#x2F;&#x2F; è¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span><br><span class="line">                gemm(0, 0, m, n, k, 1, a, k, b, n, 1, c, n);</span><br><span class="line">                &#x2F;&#x2F; bit-count to float</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;c +&#x3D; n*m;</span><br><span class="line">            &#x2F;&#x2F;state.input +&#x3D; l.c*l.h*l.w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	&#x2F;&#x2F; å¦‚æœå·ç§¯å±‚ä½¿ç”¨äº†BatchNormï¼Œé‚£ä¹ˆæ‰§è¡Œforward_batchnormï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ åç½®</span><br><span class="line">    if(l.batch_normalize)&#123;</span><br><span class="line">        forward_batchnorm_layer(l, state);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        add_bias(l.output, l.biases, l.batch, l.n, out_h*out_w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;activate_array(l.output, m*n*l.batch, l.activation);</span><br><span class="line">	&#x2F;&#x2F; ä½¿ç”¨ä¸åŒçš„æ¿€æ´»å‡½æ•°</span><br><span class="line">    if (l.activation &#x3D;&#x3D; SWISH) activate_array_swish(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">    else if (l.activation &#x3D;&#x3D; MISH) activate_array_mish(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">    else if (l.activation &#x3D;&#x3D; NORM_CHAN) activate_array_normalize_channels(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output);</span><br><span class="line">    else if (l.activation &#x3D;&#x3D; NORM_CHAN_SOFTMAX) activate_array_normalize_channels_softmax(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, 0);</span><br><span class="line">    else if (l.activation &#x3D;&#x3D; NORM_CHAN_SOFTMAX_MAXVAL) activate_array_normalize_channels_softmax(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, 1);</span><br><span class="line">    else activate_array_cpu_custom(l.output, l.outputs*l.batch, l.activation);</span><br><span class="line">	&#x2F;&#x2F; äºŒå€¼ç½‘ç»œï¼Œå‰å‘ä¼ æ’­ç»“æŸä¹‹åè½¬å›float</span><br><span class="line">    if(l.binary || l.xnor) swap_binary(&amp;l);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;visualize_convolutional_layer(l, &quot;conv_visual&quot;, NULL);</span><br><span class="line">    &#x2F;&#x2F;wait_until_press_key_cv();</span><br><span class="line">	&#x2F;&#x2F; æš‚æ—¶ä¸æ‡‚</span><br><span class="line">    if(l.assisted_excitation &amp;&amp; state.train) assisted_excitation_forward(l, state);</span><br><span class="line">	&#x2F;&#x2F; æš‚æ—¶ä¸æ‡‚</span><br><span class="line">    if (l.antialiasing) &#123;</span><br><span class="line">        network_state s &#x3D; &#123; 0 &#125;;</span><br><span class="line">        s.train &#x3D; state.train;</span><br><span class="line">        s.workspace &#x3D; state.workspace;</span><br><span class="line">        s.net &#x3D; state.net;</span><br><span class="line">        s.input &#x3D; l.output;</span><br><span class="line">        forward_convolutional_layer(*(l.input_layer), s);</span><br><span class="line">        &#x2F;&#x2F;simple_copy_ongpu(l.outputs*l.batch, l.output, l.input_antialiasing);</span><br><span class="line">        memcpy(l.output, l.input_layer-&gt;output, l.input_layer-&gt;outputs * l.input_layer-&gt;batch * sizeof(float));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="im2colè§£æ"><a href="#im2colè§£æ" class="headerlink" title="im2colè§£æ"></a>im2colè§£æ</h2><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œå·ç§¯å±‚çš„å‰å‘ä¼ æ’­æ ¸å¿ƒç‚¹æ˜¯im2colæ“ä½œè¿˜æœ‰sgemmçŸ©é˜µè®¡ç®—æ–¹æ³•å¯¹ä½¿ç”¨im2colè¿›è¡Œé‡æ’åçš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ç°åœ¨æ¥è§£æä¸€ä¸‹im2colç®—æ³•ï¼Œsgemmç®—æ³•å°±æ˜¯im2colè¿è¡Œåç›´æ¥è°ƒç”¨å³å¯ï¼Œå°±ä¸ç»†è®²äº†ã€‚</p>
<p>è¿™é‡Œè€ƒè™‘åˆ°ç»“åˆå›¾ç‰‡æ›´å®¹æ˜“ç†è§£im2colçš„æ€æƒ³ï¼Œæˆ‘åˆ©ç”¨CSDN Tiger-Gaoåšä¸»çš„å›¾æè¿°ä¸€ä¸‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ªå•é€šé“çš„é•¿å®½å‡ä¸º4çš„å›¾ç‰‡é€šè¿‡im2colé‡æ–°æ’å¸ƒåä¼šå˜æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿçœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/649.webp" alt></p>
<p>æ¥å…·ä½“çœ‹ä¸€ä¸‹å˜åŒ–è¿‡ç¨‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/650.webp" alt></p>
<p>è¿™æ˜¯å•é€šé“çš„å˜åŒ–è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¤šé€šé“çš„å‘¢ï¼Ÿé¦–å…ˆæ¥çœ‹åŸå›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/651.png" alt></p>
<p>å¤šé€šé“çš„im2colçš„è¿‡ç¨‹ï¼Œæ˜¯é¦–å…ˆim2colç¬¬ä¸€é€šé“ï¼Œç„¶åå†im2colç¬¬äºŒé€šé“ï¼Œæœ€åim2colç¬¬ä¸‰é€šé“ã€‚å„é€šé“im2colçš„æ•°æ®åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­å­˜å‚¨çš„ã€‚çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/652.webp" alt></p>
<p>è¿™æ˜¯åŸå›¾ç»è¿‡im2colçš„å˜åŒ–ï¼Œé‚£ä¹ˆkernelå‘¢ï¼Ÿçœ‹åŸå›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/653.webp" alt></p>
<p>kernelçš„é€šé“æ•°æ®åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­å­˜å‚¨çš„ã€‚æ‰€ä»¥ä¸Šé¢çš„kernelå›¾åƒç»è¿‡im2colç®—æ³•åå¯ä»¥è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/654.webp" alt></p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦‚ä½•å¾—åˆ°å‰å‘ä¼ æ’­çš„ç»“æœå‘¢ï¼Ÿåœ¨DarkNetä¸­å’ŒCaffeçš„å®ç°æ–¹å¼ä¸€æ ·ï¼Œéƒ½æ˜¯Kernel*Imgï¼Œå³æ˜¯åœ¨çŸ©é˜µä¹˜æ³•ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">M&#x3D;1 </span><br><span class="line">N&#x3D;output_h * output_w</span><br><span class="line">K&#x3D;input_channels * kernel_h * kernel_w</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/655.webp" alt></p>
<p>å›¾åƒæ•°æ®æ˜¯è¿ç»­å­˜å‚¨ï¼Œå› æ­¤è¾“å‡ºå›¾åƒä¹Ÿå¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€output_h x output_wã€‘=ã€2 x 2ã€‘ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/656.png" alt></p>
<p>å¯¹äºå¤šé€šé“å›¾åƒè¿‡ç¨‹ç±»ä¼¼ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/657.webp" alt></p>
<p>åŒæ ·ï¼Œå¤šä¸ªè¾“å‡ºé€šé“å›¾åƒçš„æ•°æ®æ˜¯è¿ç»­å­˜å‚¨ï¼Œå› æ­¤è¾“å‡ºå›¾åƒä¹Ÿå¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€output_channels x output_h x output_wã€‘=ã€3 x 2 x 2ã€‘</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/658.webp" alt></p>
<p>im2colç®—æ³•çš„å®ç°åœ¨<code>src/im2col.c</code>ä¸­ï¼Œå³<code>im2col_cpu</code>å‡½æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** ä»è¾“å…¥çš„å¤šé€šé“æ•°ç»„imï¼ˆå­˜å‚¨å›¾åƒæ•°æ®ï¼‰ä¸­è·å–æŒ‡å®šè¡Œï¼Œåˆ—ï¼Œé€šé“æ•°å¤„çš„å…ƒç´ å€¼</span><br><span class="line">** im:  å‡½æ•°çš„è¾“å…¥ï¼Œæ‰€æœ‰çš„æ•°æ®å­˜æˆä¸€ä¸ªä¸€ç»´æ•°ç»„</span><br><span class="line">** height: æ¯ä¸€ä¸ªé€šé“çš„é«˜åº¦(å³æ˜¯è¾“å…¥å›¾åƒçš„çœŸæ­£é«˜åº¦ï¼Œè¡¥0ä¹‹å‰)</span><br><span class="line">** width: æ¯ä¸€ä¸ªé€šé“çš„å®½åº¦(å³æ˜¯è¾“å…¥å›¾åƒçš„çœŸæ­£å®½åº¦ï¼Œè¡¥0ä¹‹å‰)</span><br><span class="line">** channlesï¼šè¾“å…¥é€šé“æ•°</span><br><span class="line">** row: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„è¡Œ(paddingä¹‹åçš„è¡Œæ•°)</span><br><span class="line">** col: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„åˆ—(paddingä¹‹åçš„åˆ—æ•°)</span><br><span class="line">** channel: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„é€šé“</span><br><span class="line">** pad: å›¾åƒä¸Šä¸‹å·¦å³è¡¥0çš„ä¸ªæ•°ï¼Œå››å‘¨æ˜¯ä¸€æ ·çš„</span><br><span class="line">** è¿”å›imä¸­channelé€šé“ï¼Œrow-padè¡Œ,col-padåˆ—å¤„çš„å…ƒç´ å€¼</span><br><span class="line">** åœ¨imä¸­å¹¶æ²¡æœ‰å­˜å‚¨è¡¥0çš„å…ƒç´ å€¼ï¼Œå› æ­¤heightï¼Œwidthéƒ½æ˜¯æ²¡æœ‰è¡¥0æ—¶è¾“å…¥å›¾åƒçœŸæ­£çš„é«˜ã€å®½ï¼›</span><br><span class="line">** è€Œrowä¸colåˆ™æ˜¯è¡¥0ä¹‹åï¼Œå…ƒç´ æ‰€åœ¨çš„è¡Œåˆ—ï¼Œå› æ­¤ï¼Œè¦å‡†ç¡®è·å–åœ¨imä¸­çš„å…ƒç´ å€¼ï¼Œé¦–å…ˆéœ€è¦</span><br><span class="line">** å‡å»padä»¥è·å–åœ¨imä¸­çœŸå®çš„è¡Œåˆ—æ•°</span><br><span class="line">*&#x2F;</span><br><span class="line">float im2col_get_pixel(float *im, int height, int width, int channels,</span><br><span class="line">                        int row, int col, int channel, int pad)</span><br><span class="line">&#123;</span><br><span class="line">	&#x2F;&#x2F;å‡å»è¡¥0é•¿åº¦ï¼Œè·å–åƒç´ çœŸå®çš„è¡Œåˆ—æ•°</span><br><span class="line">    row -&#x3D; pad;</span><br><span class="line">    col -&#x3D; pad;</span><br><span class="line">	&#x2F;&#x2F; å¦‚æœè¡Œåˆ—æ•°&lt;0ï¼Œæˆ–è€…è¶…è¿‡height&#x2F;widthï¼Œåˆ™è¿”å›0(åˆšå¥½æ˜¯è¡¥0çš„æ•ˆæœ)</span><br><span class="line">    if (row &lt; 0 || col &lt; 0 ||</span><br><span class="line">        row &gt;&#x3D; height || col &gt;&#x3D; width) return 0;</span><br><span class="line">	&#x2F;&#x2F; imå­˜å‚¨å¤šé€šé“äºŒç»´å›¾åƒçš„æ•°æ®æ ¼å¼ä¸º: å„ä¸ªé€šé“æ‰€æœ‰çš„æ‰€æœ‰è¡Œå¹¶æˆ1è¡Œï¼Œå†å¤šé€šé“ä¾æ¬¡å¹¶æˆä¸€è¡Œ</span><br><span class="line">    &#x2F;&#x2F; å› æ­¤width*height*channelé¦–å…ˆç§»ä½åˆ°æ‰€åœ¨é€šé“çš„èµ·ç‚¹ä½ç½®ï¼Œå†åŠ ä¸Šwidth*rowç§»ä½åˆ°æ‰€åœ¨æŒ‡å®š</span><br><span class="line">    &#x2F;&#x2F; é€šé“è¡Œï¼Œå†åŠ ä¸Šcolç§»ä½åˆ°æ‰€åœ¨åˆ—</span><br><span class="line">    return im[col + width*(row + height*channel)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;From Berkeley Vision&#39;s Caffe!</span><br><span class="line">&#x2F;&#x2F;https:&#x2F;&#x2F;github.com&#x2F;BVLC&#x2F;caffe&#x2F;blob&#x2F;master&#x2F;LICENSE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">** å°†è¾“å…¥å›¾ç‰‡è½¬ä¸ºä¾¿äºè®¡ç®—çš„æ•°ç»„æ ¼å¼</span><br><span class="line">** data_im: è¾“å…¥å›¾åƒ</span><br><span class="line">** height: è¾“å…¥å›¾åƒçš„é«˜åº¦(è¡Œ)</span><br><span class="line">** width: è¾“å…¥å›¾åƒçš„å®½åº¦(åˆ—)</span><br><span class="line">** ksize: å·ç§¯æ ¸å°ºå¯¸</span><br><span class="line">** stride: å·ç§¯æ ¸è·¨åº¦</span><br><span class="line">** pad: å››å‘¨è¡¥0çš„é•¿åº¦</span><br><span class="line">** data_col: ç›¸å½“äºè¾“å‡ºï¼Œä¸ºè¿›è¡Œæ ¼å¼é‡æ’åçš„è¾“å…¥å›¾åƒæ•°æ®</span><br><span class="line">** è¾“å‡ºdata_colçš„å…ƒç´ ä¸ªæ•°ä¸data_imä¸ªæ•°ä¸ç›¸ç­‰ï¼Œä¸€èˆ¬æ¯”data_imä¸ªæ•°å¤šï¼Œå› ä¸ºstrideè¾ƒå°ï¼Œå„ä¸ªå·ç§¯æ ¸ä¹‹é—´æœ‰å¾ˆå¤šé‡å ï¼Œ</span><br><span class="line">** å®é™…data_colä¸­çš„å…ƒç´ ä¸ªæ•°ä¸ºchannels*ksize*ksize*height_col*width_colï¼Œå…¶ä¸­channelsä¸ºdata_imçš„é€šé“æ•°ï¼Œ</span><br><span class="line">** ksizeä¸ºå·ç§¯æ ¸å¤§å°ï¼Œheight_colå’Œwidth_colå¦‚ä¸‹æ‰€æ³¨ã€‚data_colçš„è¿˜æ˜¯æŒ‰è¡Œæ’åˆ—ï¼Œåªæ˜¯è¡Œæ•°ä¸ºchannels*ksize*ksize,</span><br><span class="line">** åˆ—æ•°ä¸ºheight_col*width_colï¼Œå³ä¸€å¼ ç‰¹å¾å›¾æ€»çš„å…ƒç´ ä¸ªæ•°ï¼Œæ¯æ•´åˆ—åŒ…å«ä¸æŸä¸ªä½ç½®å¤„çš„å·ç§¯æ ¸è®¡ç®—çš„æ‰€æœ‰é€šé“ä¸Šçš„åƒç´ ï¼Œ</span><br><span class="line">** ï¼ˆæ¯”å¦‚è¾“å…¥å›¾åƒé€šé“æ•°ä¸º3,å·ç§¯æ ¸å°ºå¯¸ä¸º3*3ï¼Œåˆ™å…±æœ‰27è¡Œï¼Œæ¯åˆ—æœ‰27ä¸ªå…ƒç´ ï¼‰ï¼Œä¸åŒåˆ—å¯¹åº”å·ç§¯æ ¸åœ¨å›¾åƒä¸Šçš„ä¸åŒä½ç½®åšå·ç§¯</span><br><span class="line">*&#x2F;</span><br><span class="line">void im2col_cpu(float* data_im,</span><br><span class="line">     int channels,  int height,  int width,</span><br><span class="line">     int ksize,  int stride, int pad, float* data_col)</span><br><span class="line">&#123;</span><br><span class="line">    int c,h,w;</span><br><span class="line">	&#x2F;&#x2F; è®¡ç®—è¯¥å±‚ç¥ç»ç½‘ç»œçš„è¾“å‡ºå›¾åƒå°ºå¯¸ï¼ˆå…¶å®æ²¡æœ‰å¿…è¦å†æ¬¡è®¡ç®—çš„ï¼Œå› ä¸ºåœ¨æ„å»ºå·ç§¯å±‚æ—¶ï¼Œmake_convolutional_layer()å‡½æ•°</span><br><span class="line">    &#x2F;&#x2F; å·²ç»è°ƒç”¨convolutional_out_width()ï¼Œconvolutional_out_height()å‡½æ•°æ±‚å–äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; æ­¤å¤„ç›´æ¥ä½¿ç”¨l.out_h,l.out_wå³å¯ï¼Œå‡½æ•°å‚æ•°åªè¦ä¼ å…¥è¯¥å±‚ç½‘ç»œæŒ‡é’ˆå°±å¯äº†ï¼Œæ²¡å¿…è¦å¼„è¿™ä¹ˆå¤šå‚æ•°ï¼‰</span><br><span class="line">    int height_col &#x3D; (height + 2*pad - ksize) &#x2F; stride + 1;</span><br><span class="line">    int width_col &#x3D; (width + 2*pad - ksize) &#x2F; stride + 1;</span><br><span class="line">	&#x2F;&#x2F; å·ç§¯æ ¸å¤§å°ï¼šksize*ksizeæ˜¯ä¸€ä¸ªå·ç§¯æ ¸çš„å¤§å°ï¼Œä¹‹æ‰€ä»¥ä¹˜ä»¥é€šé“æ•°channelsï¼Œæ˜¯å› ä¸ºè¾“å…¥å›¾åƒæœ‰å¤šé€šé“ï¼Œæ¯ä¸ªå·ç§¯æ ¸åœ¨åšå·ç§¯æ—¶ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; æ˜¯åŒæ—¶å¯¹åŒä¸€ä½ç½®å¤šé€šé“çš„å›¾åƒè¿›è¡Œå·ç§¯è¿ç®—ï¼Œè¿™é‡Œä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œå°†ä¸‰ä¸ªé€šé“å°†ä¸‰é€šé“ä¸Šçš„å·ç§¯æ ¸å¹¶åœ¨ä¸€èµ·ä»¥ä¾¿è¿›è¡Œè®¡ç®—ï¼Œå› æ­¤å·ç§¯æ ¸</span><br><span class="line">    &#x2F;&#x2F; å®é™…ä¸Šå¹¶ä¸æ˜¯äºŒç»´çš„ï¼Œè€Œæ˜¯ä¸‰ç»´çš„ï¼Œæ¯”å¦‚å¯¹äº3é€šé“å›¾åƒï¼Œå·ç§¯æ ¸å°ºå¯¸ä¸º3*3ï¼Œè¯¥å·ç§¯æ ¸å°†åŒæ—¶ä½œç”¨äºä¸‰é€šé“å›¾åƒä¸Šï¼Œè¿™æ ·å¹¶èµ·æ¥å°±å¾—</span><br><span class="line">    &#x2F;&#x2F; åˆ°å«æœ‰27ä¸ªå…ƒç´ çš„å·ç§¯æ ¸ï¼Œä¸”è¿™27ä¸ªå…ƒç´ éƒ½æ˜¯ç‹¬ç«‹çš„éœ€è¦è®­ç»ƒçš„å‚æ•°ã€‚æ‰€ä»¥åœ¨è®¡ç®—è®­ç»ƒå‚æ•°ä¸ªæ•°æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ¯ä¸€ä¸ªå·ç§¯æ ¸çš„å®é™…</span><br><span class="line">    &#x2F;&#x2F; è®­ç»ƒå‚æ•°éœ€è¦ä¹˜ä»¥è¾“å…¥é€šé“æ•°ã€‚</span><br><span class="line">    int channels_col &#x3D; channels * ksize * ksize;</span><br><span class="line">	&#x2F;&#x2F; å¤–å¾ªç¯æ¬¡æ•°ä¸ºä¸€ä¸ªå·ç§¯æ ¸çš„å°ºå¯¸æ•°ï¼Œå¾ªç¯æ¬¡æ•°å³ä¸ºæœ€ç»ˆå¾—åˆ°çš„data_colçš„æ€»è¡Œæ•°</span><br><span class="line">    for (c &#x3D; 0; c &lt; channels_col; ++c) &#123;</span><br><span class="line">		&#x2F;&#x2F; åˆ—åç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå¹¶æŒ‰è¡Œå­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­ï¼Œåˆ©ç”¨æ±‚ä½™è¿ç®—è·å–å¯¹åº”åœ¨å·ç§¯æ ¸ä¸­çš„åˆ—æ•°ï¼Œæ¯”å¦‚å¯¹äº</span><br><span class="line">        &#x2F;&#x2F; 3*3çš„å·ç§¯æ ¸ï¼ˆ3é€šé“ï¼‰ï¼Œå½“c&#x3D;0æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬ä¸€åˆ—ï¼Œå½“c&#x3D;5æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬2åˆ—ï¼Œå½“c&#x3D;9æ—¶ï¼Œåœ¨ç¬¬äºŒé€šé“ä¸Šçš„å·ç§¯æ ¸çš„ç¬¬ä¸€åˆ—ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å½“c&#x3D;26æ—¶ï¼Œåœ¨ç¬¬ä¸‰åˆ—ï¼ˆç¬¬ä¸‰é€šé“ä¸Šï¼‰</span><br><span class="line">        int w_offset &#x3D; c % ksize;</span><br><span class="line">		&#x2F;&#x2F; è¡Œåç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼Œä¸”æ˜¯æŒ‰è¡Œï¼ˆå·ç§¯æ ¸æ‰€æœ‰è¡Œå¹¶æˆä¸€è¡Œï¼‰å­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­çš„ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; æ¯”å¦‚å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œå¤„ç†3é€šé“çš„å›¾åƒï¼Œé‚£ä¹ˆä¸€ä¸ªå·ç§¯æ ¸å…·æœ‰27ä¸ªå…ƒç´ ï¼Œæ¯9ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸ï¼ˆäº’ä¸ºä¸€æ ·ï¼‰ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; æ¯å½“cä¸º3çš„å€æ•°ï¼Œå°±æ„å‘³ç€å·ç§¯æ ¸æ¢äº†ä¸€è¡Œï¼Œh_offsetå–å€¼ä¸º0,1,2ï¼Œå¯¹åº”3*3å·ç§¯æ ¸ä¸­çš„ç¬¬1, 2, 3è¡Œ</span><br><span class="line">        int h_offset &#x3D; (c &#x2F; ksize) % ksize;</span><br><span class="line">		&#x2F;&#x2F; é€šé“åç§»ï¼Œchannels_colæ˜¯å¤šé€šé“çš„å·ç§¯æ ¸å¹¶åœ¨ä¸€èµ·çš„ï¼Œæ¯”å¦‚å¯¹äº3é€šé“ï¼Œ3*3å·ç§¯æ ¸ï¼Œæ¯è¿‡9ä¸ªå…ƒç´ å°±è¦æ¢ä¸€é€šé“æ•°ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å½“c&#x3D;0~8æ—¶ï¼Œc_im&#x3D;0;c&#x3D;9~17æ—¶ï¼Œc_im&#x3D;1;c&#x3D;18~26æ—¶ï¼Œc_im&#x3D;2</span><br><span class="line">        int c_im &#x3D; c &#x2F; ksize &#x2F; ksize;</span><br><span class="line">		&#x2F;&#x2F; ä¸­å¾ªç¯æ¬¡æ•°ç­‰äºè¯¥å±‚è¾“å‡ºå›¾åƒè¡Œæ•°height_colï¼Œè¯´æ˜data_colä¸­çš„æ¯ä¸€è¡Œå­˜å‚¨äº†ä¸€å¼ ç‰¹å¾å›¾ï¼Œè¿™å¼ ç‰¹å¾å›¾åˆæ˜¯æŒ‰è¡Œå­˜å‚¨åœ¨data_colä¸­çš„æŸè¡Œä¸­</span><br><span class="line">        for (h &#x3D; 0; h &lt; height_col; ++h) &#123;</span><br><span class="line">			&#x2F;&#x2F; å†…å¾ªç¯ç­‰äºè¯¥å±‚è¾“å‡ºå›¾åƒåˆ—æ•°width_colï¼Œè¯´æ˜æœ€ç»ˆå¾—åˆ°çš„data_colæ€»æœ‰channels_colè¡Œï¼Œheight_col*width_colåˆ—</span><br><span class="line">            for (w &#x3D; 0; w &lt; width_col; ++w) &#123;</span><br><span class="line">				&#x2F;&#x2F; ç”±ä¸Šé¢å¯çŸ¥ï¼Œå¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œh_offsetå–å€¼ä¸º0,1,2,å½“h_offset&#x3D;0æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ç¬¬ä¸€è¡Œå…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; ä¾æ¬¡ç±»æ¨ï¼›åŠ ä¸Šh*strideæ˜¯å¯¹å·ç§¯æ ¸è¿›è¡Œè¡Œç§»ä½æ“ä½œï¼Œæ¯”å¦‚å·ç§¯æ ¸ä»å›¾åƒ(0,0)ä½ç½®å¼€å§‹åšå·ç§¯ï¼Œé‚£ä¹ˆæœ€å…ˆå¼€å§‹æ¶‰åŠ(0,0)~(3,3)</span><br><span class="line">                &#x2F;&#x2F; ä¹‹é—´çš„åƒç´ å€¼ï¼Œè‹¥stride&#x3D;2ï¼Œé‚£ä¹ˆå·ç§¯æ ¸è¿›è¡Œä¸€æ¬¡è¡Œç§»ä½æ—¶ï¼Œä¸‹ä¸€è¡Œçš„å·ç§¯æ“ä½œæ˜¯ä»å…ƒç´ (2,0)ï¼ˆ2ä¸ºå›¾åƒè¡Œå·ï¼Œ0ä¸ºåˆ—å·ï¼‰å¼€å§‹</span><br><span class="line">                int im_row &#x3D; h_offset + h * stride;</span><br><span class="line">				&#x2F;&#x2F; å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œw_offsetå–å€¼ä¹Ÿä¸º0,1,2ï¼Œå½“w_offsetå–1æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ä¸­ç¬¬2åˆ—å…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; å®é™…åœ¨åšå·ç§¯æ“ä½œæ—¶ï¼Œå·ç§¯æ ¸å¯¹å›¾åƒé€è¡Œæ‰«æåšå·ç§¯ï¼ŒåŠ ä¸Šw*strideå°±æ˜¯ä¸ºäº†åšåˆ—ç§»ä½ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; æ¯”å¦‚å‰ä¸€æ¬¡å·ç§¯å…¶å®åƒç´ å…ƒç´ ä¸º(0,0)ï¼Œè‹¥stride&#x3D;2,é‚£ä¹ˆä¸‹æ¬¡å·ç§¯å…ƒç´ èµ·å§‹åƒç´ ä½ç½®ä¸º(0,2)ï¼ˆ0ä¸ºè¡Œå·ï¼Œ2ä¸ºåˆ—å·ï¼‰</span><br><span class="line">                int im_col &#x3D; w_offset + w * stride;</span><br><span class="line">				&#x2F;&#x2F; col_indexä¸ºé‡æ’åå›¾åƒä¸­çš„åƒç´ ç´¢å¼•ï¼Œç­‰äºc * height_col * width_col + h * width_col +wï¼ˆè¿˜æ˜¯æŒ‰è¡Œå­˜å‚¨ï¼Œæ‰€æœ‰é€šé“å†å¹¶æˆä¸€è¡Œï¼‰ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; å¯¹åº”ç¬¬cé€šé“ï¼Œhè¡Œï¼Œwåˆ—çš„å…ƒç´ </span><br><span class="line">                int col_index &#x3D; (c * height_col + h) * width_col + w;</span><br><span class="line">				&#x2F;&#x2F; im2col_get_pixelå‡½æ•°è·å–è¾“å…¥å›¾åƒdata_imä¸­ç¬¬c_imé€šé“ï¼Œim_row,im_colçš„åƒç´ å€¼å¹¶èµ‹å€¼ç»™é‡æ’åçš„å›¾åƒï¼Œ</span><br><span class="line">                &#x2F;&#x2F; heightå’Œwidthä¸ºè¾“å…¥å›¾åƒdata_imçš„çœŸå®é«˜ã€å®½ï¼Œpadä¸ºå››å‘¨è¡¥0çš„é•¿åº¦ï¼ˆæ³¨æ„im_row,im_colæ˜¯è¡¥0ä¹‹åçš„è¡Œåˆ—å·ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; ä¸æ˜¯çœŸå®è¾“å…¥å›¾åƒä¸­çš„è¡Œåˆ—å·ï¼Œå› æ­¤éœ€è¦å‡å»padè·å–çœŸå®çš„è¡Œåˆ—å·ï¼‰</span><br><span class="line">                data_col[col_index] &#x3D; im2col_get_pixel(data_im, height, width, channels,</span><br><span class="line">                        im_row, im_col, c_im, pad);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetç½‘ç»œçš„å‰å‘å’Œåå‘ä¼ æ’­ä»‹ç»ä»¥åŠlayerçš„è¯¦ç»†è§£æ</title>
    <url>/2020/02/22/AlexeyAB-DarkNet%E7%BD%91%E7%BB%9C%E7%9A%84%E5%89%8D%E5%90%91%E5%92%8C%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8Alayer%E7%9A%84%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title=" å‰è¨€"></a><a id="more"></a> å‰è¨€</h2><p>å‰é¢æˆ‘ä»¬å·²ç»æˆåŠŸçš„è·å–äº†ç›®æ ‡æ£€æµ‹çš„ç½‘ç»œç»“æ„(<code>cfg</code>æ–‡ä»¶çš„å†…å®¹)ï¼Œå¹¶å°†ç½‘ç»œä¿å­˜åœ¨äº†ä¸€ä¸ª<code>network</code>ç»“æ„ä½“ä¸­ï¼Œç„¶åæˆ‘ä»¬è¿˜åˆ†æäº†æ•°æ®åŠ è½½æ–¹å¼ã€‚ç°åœ¨æ•°æ®å’Œç½‘ç»œç»“æ„éƒ½æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¼€å§‹è®­ç»ƒ/æµ‹è¯•çš„è¿‡ç¨‹äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦è°ƒç”¨çš„æ˜¯<code>network</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­å‡½æ•°ï¼Œè€Œ<code>network</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­åˆå¯ä»¥ç»†åˆ†ä¸ºæ¯ä¸€ä¸ª<code>layer</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ä»¥åŠ<code>layer</code>æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚</p>
<h2 id="ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"><a href="#ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­" class="headerlink" title="ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"></a>ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­</h2><p>ç½‘ç»œçš„å‰å‘ä¼ æ’­å‡½æ•°åœ¨<code>src/network.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** å‰å‘è®¡ç®—ç½‘ç»œnetæ¯ä¸€å±‚çš„è¾“å‡º</span><br><span class="line">** stateç”¨æ¥æ ‡è®°å½“å‰ç½‘ç»œçš„çŠ¶æ€ï¼Œ</span><br><span class="line">** éå†netçš„æ¯ä¸€å±‚ç½‘ç»œï¼Œä»ç¬¬0å±‚åˆ°æœ€åä¸€å±‚ï¼Œé€å±‚è®¡ç®—æ¯å±‚çš„è¾“å‡º</span><br><span class="line">*&#x2F;</span><br><span class="line">void forward_network(network net, network_state state)</span><br><span class="line">&#123;</span><br><span class="line">	&#x2F;&#x2F; ç½‘ç»œçš„å·¥ä½œç©ºé—´, æŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§çš„é‚£ä¸ªå±‚çš„ workspace_size,</span><br><span class="line">    &#x2F;&#x2F; å› ä¸ºå®é™…ä¸Šåœ¨ GPU æˆ– CPU ä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘è¿ç®—</span><br><span class="line">    state.workspace &#x3D; net.workspace;</span><br><span class="line">    int i;</span><br><span class="line">	&#x2F;&#x2F; éå†æ‰€æœ‰å±‚ï¼Œä»ç¬¬ä¸€å±‚åˆ°æœ€åä¸€å±‚ï¼Œé€å±‚è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œç½‘ç»œå…±æœ‰net.nå±‚</span><br><span class="line">    for(i &#x3D; 0; i &lt; net.n; ++i)&#123;</span><br><span class="line">		&#x2F;&#x2F; å½“å‰æ­£åœ¨è¿›è¡Œç¬¬iå±‚çš„å¤„ç†</span><br><span class="line">        state.index &#x3D; i;</span><br><span class="line">		&#x2F;&#x2F; è·å–å½“å‰å±‚</span><br><span class="line">        layer l &#x3D; net.layers[i];</span><br><span class="line">		&#x2F;&#x2F; å¦‚æœå½“å‰å±‚çš„l.deltaå·²ç»åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œåˆ™è°ƒç”¨fill_cpu()å‡½æ•°å°†å…¶æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º0</span><br><span class="line">        if(l.delta &amp;&amp; state.train)&#123;</span><br><span class="line">			&#x2F;&#x2F; ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºl.deltaçš„å…ƒç´ ä¸ªæ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåˆå§‹åŒ–å€¼ï¼Œä¸º0</span><br><span class="line">            scal_cpu(l.outputs * l.batch, 0, l.delta, 1);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;double time &#x3D; get_time_point();</span><br><span class="line">		&#x2F;&#x2F; å‰å‘ä¼ æ’­: å®Œæˆå½“å‰å±‚å‰å‘æ¨ç†</span><br><span class="line">        l.forward(l, state);</span><br><span class="line">		&#x2F;&#x2F; å®ŒæˆæŸä¸€å±‚çš„æ¨ç†æ—¶ï¼Œç½®ç½‘ç»œçš„è¾“å…¥ä¸ºå½“å‰å±‚çš„è¾“å‡ºï¼ˆè¿™å°†æˆä¸ºä¸‹ä¸€å±‚ç½‘ç»œçš„è¾“å…¥ï¼‰ï¼Œæ³¨æ„æ­¤å¤„æ›´æ”¹çš„æ˜¯stateï¼Œè€ŒéåŸå§‹çš„net</span><br><span class="line">        &#x2F;&#x2F;printf(&quot;%d - Predicted in %lf milli-seconds.\n&quot;, i, ((double)get_time_point() - time) &#x2F; 1000);</span><br><span class="line">        state.input &#x3D; l.output;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç½‘ç»œçš„åå‘ä¼ æ’­å‡½æ•°ä¹Ÿåœ¨<code>src/network.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** åå‘è®¡ç®—ç½‘ç»œnetæ¯ä¸€å±‚çš„æ¢¯åº¦å›¾ï¼Œå¹¶è¿›è€Œè®¡ç®—æ¯ä¸€å±‚çš„æƒé‡ã€åç½®æ›´æ–°å€¼ï¼Œæœ€åå®Œæˆæ¯ä¸€å±‚æƒé‡ä¸åç½®æ›´æ–°</span><br><span class="line">** æµç¨‹: éå†netçš„æ¯ä¸€å±‚ç½‘ç»œï¼Œä»æœ€åä¸€å±‚åˆ°ç¬¬ä¸€å±‚(æ­¤å¤„æ‰€æŒ‡çš„ç¬¬ä¸€å±‚ä¸æ˜¯æŒ‡è¾“å…¥å±‚ï¼Œè€Œæ˜¯ä¸è¾“å…¥å±‚ç›´æ¥ç›¸è¿çš„ç¬¬ä¸€å±‚éšå«å±‚)è¿›è¡Œåå‘ä¼ æ’­</span><br><span class="line">*&#x2F;</span><br><span class="line">void backward_network(network net, network_state state)</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line">	&#x2F;&#x2F; åœ¨è¿›è¡Œåå‘ä¼ æ’­ä¹‹å‰å…ˆä¿å­˜ä¸€ä¸‹åŸæ¥çš„netä¿¡æ¯</span><br><span class="line">    float *original_input &#x3D; state.input;</span><br><span class="line">    float *original_delta &#x3D; state.delta;</span><br><span class="line">    state.workspace &#x3D; net.workspace;</span><br><span class="line">    for(i &#x3D; net.n-1; i &gt;&#x3D; 0; --i)&#123;</span><br><span class="line">		&#x2F;&#x2F; æ ‡å¿—å‚æ•°ï¼Œå½“å‰ç½‘ç»œçš„æ´»è·ƒå±‚</span><br><span class="line">        state.index &#x3D; i;</span><br><span class="line">		&#x2F;&#x2F; i &#x3D; 0æ—¶ï¼Œä¹Ÿå³å·²ç»åˆ°äº†ç½‘ç»œçš„ç¬¬1å±‚ï¼ˆæˆ–è€…è¯´ç¬¬0å±‚ï¼Œçœ‹ä¸ªäººä¹ æƒ¯äº†ï½ï¼‰äº†ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å°±æ˜¯ç›´æ¥ä¸è¾“å…¥å±‚ç›¸è¿çš„ç¬¬ä¸€å±‚éšå«å±‚ï¼ˆæ³¨æ„ä¸æ˜¯è¾“å…¥å±‚ï¼Œæˆ‘ç†è§£çš„è¾“å…¥å±‚å°±æ˜¯æŒ‡è¾“å…¥çš„å›¾åƒæ•°æ®ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; ä¸¥æ ¼æ¥è¯´ï¼Œè¾“å…¥å±‚ä¸ç®—ä¸€å±‚ç½‘ç»œï¼Œå› ä¸ºè¾“å…¥å±‚æ²¡æœ‰è®­ç»ƒå‚æ•°ï¼Œä¹Ÿæ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸éœ€è¦elseä¸­çš„èµ‹å€¼ï¼Œ1ï¼‰å¯¹äºç¬¬1å±‚æ¥è¯´ï¼Œå…¶å‰é¢å·²ç»æ²¡æœ‰ç½‘ç»œå±‚äº†ï¼ˆè¾“å…¥å±‚ä¸ç®—ï¼‰ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å› æ­¤æ²¡æœ‰å¿…è¦å†è®¡ç®—å‰ä¸€å±‚çš„å‚æ•°ï¼Œæ•…æ²¡æœ‰å¿…è¦åœ¨è·å–ä¸Šä¸€å±‚ï¼›2ï¼‰ç¬¬ä¸€å±‚çš„è¾“å…¥å°±æ˜¯å›¾åƒè¾“å…¥ï¼Œä¹Ÿå³æ•´ä¸ªnetæœ€åŸå§‹çš„è¾“å…¥ï¼Œåœ¨å¼€å§‹è¿›è¡Œåå‘ä¼ æ’­ä¹‹å‰ï¼Œå·²ç»ç”¨original_*å˜é‡ä¿å­˜äº†</span><br><span class="line">        &#x2F;&#x2F; æœ€ä¸ºåŸå§‹çš„netï¼Œæ‰€ä»¥net.inputå°±æ˜¯ç¬¬ä¸€å±‚çš„è¾“å…¥ï¼Œä¸éœ€è¦è·å–ä¸Šä¸€å±‚çš„è¾“å‡ºä½œä¸ºå½“å‰å±‚çš„è¾“å…¥ï¼›3ï¼‰åŒ1ï¼‰ï¼Œç¬¬ä¸€å±‚ä¹‹å‰å·²ç»æ²¡æœ‰å±‚äº†ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; ä¹Ÿå°±ä¸éœ€è¦è®¡ç®—ä¸Šä¸€å±‚çš„deltaï¼Œå³ä¸éœ€è¦å†å°†net.deltaé“¾æ¥åˆ°prev.deltaï¼Œæ­¤æ—¶è¿›å…¥åˆ°l.backward()ä¸­åï¼Œnet.deltaå°±æ˜¯NULLï¼ˆå¯ä»¥å‚çœ‹darknet.hä¸­å…³äºdelta</span><br><span class="line">        &#x2F;&#x2F; çš„æ³¨é‡Šï¼‰ï¼Œä¹Ÿå°±ä¸ä¼šå†è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦äº†ï¼ˆæ¯”å¦‚å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„backward_convolutional_layer()å‡½æ•°ï¼‰</span><br><span class="line">        &#x2F;&#x2F; è¿™å‡ è¡Œä»£ç å°±æ˜¯ç»™net.inputå’Œnet.deltaèµ‹å€¼</span><br><span class="line">        if(i &#x3D;&#x3D; 0)&#123;</span><br><span class="line">            state.input &#x3D; original_input;</span><br><span class="line">            state.delta &#x3D; original_delta;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            layer prev &#x3D; net.layers[i-1];</span><br><span class="line">            state.input &#x3D; prev.output;</span><br><span class="line">            state.delta &#x3D; prev.delta;</span><br><span class="line">        &#125;</span><br><span class="line">        layer l &#x3D; net.layers[i];</span><br><span class="line">        if (l.stopbackward) break;</span><br><span class="line">        if (l.onlyforward) continue;</span><br><span class="line">		&#x2F;&#x2F; åå‘è®¡ç®—ç¬¬iå±‚çš„æ•æ„Ÿåº¦å›¾ã€æƒé‡åŠåç½®æ›´æ–°å€¼ï¼Œå¹¶æ›´æ–°æƒé‡ã€åç½®ï¼ˆåŒæ—¶ä¼šè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å­˜å‚¨åœ¨net.deltaä¸­ï¼Œä½†æ˜¯è¿˜å·®ä¸€ä¸ªç¯èŠ‚ï¼šä¹˜ä¸Šä¸Šä¸€å±‚è¾“å‡ºå¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œä¹Ÿå³ä¸Šä¸€å±‚æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼‰</span><br><span class="line">        l.backward(l, state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="layerçš„è§£é‡Š"><a href="#layerçš„è§£é‡Š" class="headerlink" title="layerçš„è§£é‡Š"></a>layerçš„è§£é‡Š</h2><p>åœ¨å°†å…·ä½“æŸä¸ªå±‚å¦‚å·ç§¯å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ä¹‹å‰ï¼Œéœ€è¦å…ˆæ¥çœ‹ä¸€ä¸‹<code>layer</code>æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Œå› ä¸ºç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­å®é™…ä¸Šå°±æ˜¯å„ä¸ªç½‘ç»œå±‚(<code>layer</code>)çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œè¿™éƒ¨åˆ†åŠ å¥½æ³¨é‡Šçš„ä»£ç ï¼ˆåœ¨<code>src/darknet.h</code>ä¸­ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å®šä¹‰layer</span><br><span class="line">struct layer &#123;</span><br><span class="line">    LAYER_TYPE type; &#x2F;&#x2F; ç½‘ç»œå±‚çš„ç±»å‹ï¼Œæšä¸¾ç±»å‹ï¼Œå–å€¼æ¯”å¦‚DROPOUT,CONVOLUTIONAL,MAXPOOLåˆ†åˆ«è¡¨ç¤ºdropoutå±‚ï¼Œå·ç§¯å±‚ï¼Œæœ€å¤§æ± åŒ–å±‚ï¼Œå¯å‚è§LAYER_TYPEæšä¸¾ç±»å‹çš„å®šä¹‰</span><br><span class="line">    ACTIVATION activation; &#x2F;&#x2F;æ¿€æ´»å‡½æ•°ç±»å‹ï¼Œæšä¸¾ç±»å‹</span><br><span class="line">    COST_TYPE cost_type; &#x2F;&#x2F;æŸå¤±å‡½æ•°ç±»å‹ï¼Œæšä¸¾ç±»å‹</span><br><span class="line">    void(*forward)   (struct layer, struct network_state);</span><br><span class="line">    void(*backward)  (struct layer, struct network_state);</span><br><span class="line">    void(*update)    (struct layer, int, float, float, float);</span><br><span class="line">    void(*forward_gpu)   (struct layer, struct network_state);</span><br><span class="line">    void(*backward_gpu)  (struct layer, struct network_state);</span><br><span class="line">    void(*update_gpu)    (struct layer, int, float, float, float);</span><br><span class="line">    layer *share_layer;</span><br><span class="line">    int train;</span><br><span class="line">    int avgpool;</span><br><span class="line">    int batch_normalize; &#x2F;&#x2F; æ˜¯å¦è¿›è¡ŒBNï¼Œå¦‚æœè¿›è¡ŒBNï¼Œåˆ™å€¼ä¸º1</span><br><span class="line">    int shortcut;</span><br><span class="line">    int batch; &#x2F;&#x2F; ä¸€ä¸ªbatchä¸­å«æœ‰çš„å›¾ç‰‡å¼ æ•°ï¼Œç­‰äºnet.batchï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒnetwork.hä¸­çš„æ³¨é‡Šï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶èµ‹å€¼ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰</span><br><span class="line">    int forced;</span><br><span class="line">    int flipped;</span><br><span class="line">    int inputs; &#x2F;&#x2F; ä¸€å¼ è¾“å…¥å›¾ç‰‡æ‰€å«çš„å…ƒç´ ä¸ªæ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰ï¼Œç¬¬ä¸€å±‚çš„å€¼ç­‰äºl.h*l.w*l.cï¼Œ</span><br><span class="line">                &#x2F;&#x2F; ä¹‹åçš„æ¯ä¸€å±‚éƒ½æ˜¯ç”±ä¸Šä¸€å±‚çš„è¾“å‡ºè‡ªåŠ¨æ¨ç®—å¾—åˆ°çš„ï¼ˆå‚è§parse_network_cfg()ï¼Œåœ¨æ„å»ºæ¯ä¸€å±‚åï¼Œä¼šæ›´æ–°params.inputsä¸ºä¸Šä¸€å±‚çš„l.outputsï¼‰</span><br><span class="line">    int outputs; &#x2F;&#x2F; è¯¥å±‚å¯¹åº”ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span><br><span class="line">                 &#x2F;&#x2F; å¯¹äºä¸€äº›ç½‘ç»œï¼Œå¯ç”±è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸åŠç›¸å…³å‚æ•°è®¡ç®—å‡ºï¼Œæ¯”å¦‚å·ç§¯å±‚ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥å°ºå¯¸ä»¥åŠæ­¥é•¿ã€æ ¸å¤§å°è®¡ç®—å‡ºï¼›</span><br><span class="line">                 &#x2F;&#x2F; å¯¹äºå¦ä¸€äº›å°ºå¯¸ï¼Œåˆ™éœ€è¦é€šè¿‡ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœªæŒ‡å®šï¼Œå–é»˜è®¤å€¼1ï¼Œæ¯”å¦‚å…¨è¿æ¥å±‚ï¼ˆè§parse_connected()å‡½æ•°ï¼‰</span><br><span class="line">    int nweights;</span><br><span class="line">    int nbiases;</span><br><span class="line">    int extra;</span><br><span class="line">    int truths;  &#x2F;&#x2F; &lt; æ ¹æ®region_layer.cåˆ¤æ–­ï¼Œè¿™ä¸ªå˜é‡è¡¨ç¤ºä¸€å¼ å›¾ç‰‡å«æœ‰çš„çœŸå®å€¼çš„ä¸ªæ•°ï¼Œå¯¹äºæ£€æµ‹æ¨¡å‹æ¥è¯´ï¼Œä¸€ä¸ªçœŸå®çš„æ ‡ç­¾å«æœ‰5ä¸ªå€¼ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; åŒ…æ‹¬ç±»å‹å¯¹åº”çš„ç¼–å·ä»¥åŠå®šä½çŸ©å½¢æ¡†ç”¨åˆ°çš„w,h,x,yå››ä¸ªå‚æ•°ï¼Œä¸”åœ¨darknetä¸­å›ºå®šæ¯å¼ å›¾ç‰‡æœ€å¤§å¤„ç†30ä¸ªçŸ©å½¢æ¡†ï¼Œï¼ˆå¯æŸ¥çœ‹max_boxeså‚æ•°ï¼‰ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; å› æ­¤ï¼Œåœ¨region_layer.cçš„make_region_layer()å‡½æ•°ä¸­èµ‹å€¼ä¸º30*5.</span><br><span class="line">    int h, w, c;  &#x2F;&#x2F; è¯¥å±‚è¾“å…¥çš„å›¾ç‰‡çš„å®½ï¼Œé«˜ï¼Œé€šé“æ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span><br><span class="line">    int out_h, out_w, out_c;&#x2F;&#x2F; è¯¥å±‚è¾“å‡ºå›¾ç‰‡çš„é«˜ã€å®½ã€é€šé“æ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span><br><span class="line">    int n; &#x2F;&#x2F; å¯¹äºå·ç§¯å±‚ï¼Œè¯¥å‚æ•°è¡¨ç¤ºå·ç§¯æ ¸ä¸ªæ•°ï¼Œç­‰äºout_cï¼Œå…¶å€¼ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼›å¯¹äºregion_layerå±‚ï¼Œè¯¥å‚æ•°ç­‰äºé…ç½®æ–‡ä»¶ä¸­çš„numå€¼</span><br><span class="line">           &#x2F;&#x2F; (è¯¥å‚æ•°é€šè¿‡make_region_layer()å‡½æ•°èµ‹å€¼ï¼Œåœ¨parser.cä¸­è°ƒç”¨çš„make_region_layer()å‡½æ•°)ï¼Œ</span><br><span class="line">           &#x2F;&#x2F; å¯ä»¥åœ¨darknet&#x2F;cfgæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå‘½ä»¤ï¼šgrep num *.cfgä¾¿å¯ä»¥æœç´¢å‡ºæ‰€æœ‰è®¾ç½®äº†numå‚æ•°çš„ç½‘ç»œï¼Œè¿™é‡Œé¢åŒ…æ‹¬yolo.cfgç­‰ï¼Œå…¶å€¼æœ‰</span><br><span class="line">           &#x2F;&#x2F; è®¾å®šä¸º3,5,2çš„ï¼Œè¯¥å‚æ•°å°±æ˜¯Yoloè®ºæ–‡ä¸­çš„Bï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªcellä¸­é¢„æµ‹å¤šå°‘ä¸ªboxã€‚</span><br><span class="line">    int max_boxes; &#x2F;&#x2F; æ¯å¼ å›¾ç‰‡æœ€å¤šå«æœ‰çš„æ ‡ç­¾çŸ©å½¢æ¡†æ•°ï¼ˆå‚çœ‹ï¼šdata.cä¸­çš„load_data_detection()ï¼Œå…¶è¾“å…¥å‚æ•°boxeså°±æ˜¯æŒ‡è¿™ä¸ªå‚æ•°ï¼‰ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯æ¯å¼ å›¾ç‰‡ä¸­æœ€å¤šæ‰“äº†max_boxesä¸ªæ ‡ç­¾ç‰©ä½“ï¼Œæ¨¡å‹é¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé¢„æµ‹å‡ºå¾ˆå¤šçš„ç‰©ä½“ï¼Œä½†å®é™…ä¸Šï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å›¾ç‰‡ä¸­æ‰“ä¸Šæ ‡ç­¾çš„çœŸæ­£å­˜åœ¨çš„ç‰©ä½“æœ€å¤šå°±max_boxesä¸ªï¼Œé¢„æµ‹å¤šå‡ºæ¥çš„è‚¯å®šå­˜åœ¨false positiveï¼Œéœ€è¦æ»¤å‡ºä¸ç­›é€‰ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å¯å‚çœ‹region_layer.cä¸­forward_region_layer()å‡½æ•°çš„ç¬¬äºŒä¸ªforå¾ªç¯ä¸­çš„æ³¨é‡Š</span><br><span class="line">    int groups; &#x2F;&#x2F; åº”è¯¥æ˜¯æ§åˆ¶ç»„å·ç§¯çš„ç»„æ•°ï¼Œç±»ä¼¼äºcaffeçš„groupå‚æ•°</span><br><span class="line">    int group_id;</span><br><span class="line">    int size; &#x2F;&#x2F; æ ¸å°ºå¯¸ï¼ˆæ¯”å¦‚å·ç§¯æ ¸ï¼Œæ± åŒ–æ ¸ç­‰ï¼‰</span><br><span class="line">    int side;</span><br><span class="line">    int stride; &#x2F;&#x2F; æ»‘åŠ¨æ­¥é•¿ï¼Œå¦‚å·ç§¯æ ¸çš„æ»‘åŠ¨æ­¥é•¿</span><br><span class="line">    int stride_x;</span><br><span class="line">    int stride_y;</span><br><span class="line">    int dilation; &#x2F;&#x2F;ç©ºæ´å·ç§¯å‚æ•°</span><br><span class="line">    int antialiasing;</span><br><span class="line">    int maxpool_depth;</span><br><span class="line">    int out_channels; &#x2F;&#x2F; è¾“å‡ºé€šé“æ•°</span><br><span class="line">    int reverse;</span><br><span class="line">    int flatten;</span><br><span class="line">    int spatial;</span><br><span class="line">    int pad; &#x2F;&#x2F; è¯¥å±‚å¯¹è¾“å…¥æ•°æ®å››å‘¨çš„è¡¥0é•¿åº¦ï¼ˆç°åœ¨å‘ç°åœ¨å·ç§¯å±‚ï¼Œæœ€å¤§æ± åŒ–å±‚ä¸­æœ‰ç”¨åˆ°è¯¥å‚æ•°ï¼‰ï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶èµ‹å€¼ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰</span><br><span class="line">    int sqrt;</span><br><span class="line">    int flip;</span><br><span class="line">    int index;</span><br><span class="line">    int scale_wh;</span><br><span class="line">    int binary;</span><br><span class="line">    int xnor;</span><br><span class="line">    int peephole;</span><br><span class="line">    int use_bin_output;</span><br><span class="line">    int keep_delta_gpu;</span><br><span class="line">    int optimized_memory;</span><br><span class="line">    int steps;</span><br><span class="line">    int state_constrain;</span><br><span class="line">    int hidden;</span><br><span class="line">    int truth;</span><br><span class="line">    float smooth;</span><br><span class="line">    float dot;</span><br><span class="line">    int deform;</span><br><span class="line">    int sway;</span><br><span class="line">    int rotate;</span><br><span class="line">    int stretch;</span><br><span class="line">    int stretch_sway;</span><br><span class="line">    float angle;</span><br><span class="line">    float jitter;</span><br><span class="line">    float saturation;</span><br><span class="line">    float exposure;</span><br><span class="line">    float shift;</span><br><span class="line">    float ratio;</span><br><span class="line">    float learning_rate_scale;</span><br><span class="line">    float clip;</span><br><span class="line">    int focal_loss;</span><br><span class="line">    float *classes_multipliers;</span><br><span class="line">    float label_smooth_eps;</span><br><span class="line">    int noloss;</span><br><span class="line">    int softmax;</span><br><span class="line">    int classes; &#x2F;&#x2F; ç‰©ä½“ç±»åˆ«ç§æ•°ï¼Œä¸€ä¸ªè®­ç»ƒå¥½çš„ç½‘ç»œï¼Œåªèƒ½æ£€æµ‹æŒ‡å®šæ‰€æœ‰ç‰©ä½“ç±»åˆ«ä¸­çš„ç‰©ä½“ï¼Œæ¯”å¦‚yolo9000.cfgï¼Œè®¾ç½®è¯¥å€¼ä¸º9418ï¼Œ</span><br><span class="line">                 &#x2F;&#x2F; ä¹Ÿå°±æ˜¯è¯¥ç½‘ç»œè®­ç»ƒå¥½äº†ä¹‹åå¯ä»¥æ£€æµ‹9418ç§ç‰©ä½“ã€‚è¯¥å‚æ•°ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šã€‚ç›®å‰åœ¨ä½œè€…ç»™çš„ä¾‹å­ä¸­,</span><br><span class="line">                 &#x2F;&#x2F; æœ‰è®¾ç½®è¯¥å€¼çš„é…ç½®æ–‡ä»¶å¤§éƒ½æ˜¯æ£€æµ‹æ¨¡å‹ï¼Œçº¯è¯†åˆ«çš„ç½‘ç»œæ¨¡å‹æ²¡æœ‰è®¾ç½®è¯¥å€¼ï¼Œæˆ‘æƒ³æ˜¯å› ä¸ºæ£€æµ‹æ¨¡å‹è¾“å‡ºçš„ä¸€èˆ¬ä¼šä¸ºå„ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œ</span><br><span class="line">                 &#x2F;&#x2F; æ‰€ä»¥éœ€è¦çŸ¥é“è¿™ä¸ªç§ç±»æ•°ç›®ï¼Œè€Œè¯†åˆ«çš„è¯ï¼Œä¸éœ€è¦çŸ¥é“æŸä¸ªç‰©ä½“å±äºè¿™äº›æ‰€æœ‰ç±»çš„å…·ä½“æ¦‚ç‡ï¼Œå› æ­¤å¯ä»¥ä¸çŸ¥é“ã€‚</span><br><span class="line">    int coords; &#x2F;&#x2F; è¿™ä¸ªå‚æ•°ä¸€èˆ¬ç”¨åœ¨æ£€æµ‹æ¨¡å‹ä¸­ï¼Œä¸”ä¸æ˜¯æ‰€æœ‰å±‚éƒ½æœ‰è¿™ä¸ªå‚æ•°ï¼Œä¸€èˆ¬åœ¨æ£€æµ‹æ¨¡å‹æœ€åä¸€å±‚æœ‰ï¼Œæ¯”å¦‚region_layerå±‚ï¼Œè¯¥å‚æ•°çš„å«ä¹‰</span><br><span class="line">                &#x2F;&#x2F; æ˜¯å®šä½ä¸€ä¸ªç‰©ä½“æ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼Œä¸€èˆ¬ä¸º4ä¸ªï¼ŒåŒ…æ‹¬ç‰©ä½“æ‰€åœ¨çŸ©å½¢æ¡†ä¸­å¿ƒåæ ‡x,yä¸¤ä¸ªå‚æ•°ä»¥åŠçŸ©å½¢æ¡†é•¿å®½w,hä¸¤ä¸ªå‚æ•°ï¼Œ</span><br><span class="line">                &#x2F;&#x2F; å¯ä»¥åœ¨darknet&#x2F;cfgæ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰§è¡Œgrep coords *.cfgï¼Œä¼šæœç´¢å‡ºæ‰€æœ‰ä½¿ç”¨è¯¥å‚æ•°çš„æ¨¡å‹ï¼Œå¹¶å¯çœ‹åˆ°è¯¥å€¼éƒ½è®¾ç½®ä¸º4</span><br><span class="line">    int background;</span><br><span class="line">    int rescore;</span><br><span class="line">    int objectness;</span><br><span class="line">    int does_cost;</span><br><span class="line">    int joint;</span><br><span class="line">    int noadjust;</span><br><span class="line">    int reorg;</span><br><span class="line">    int log;</span><br><span class="line">    int tanh;</span><br><span class="line">    int *mask;</span><br><span class="line">    int total;</span><br><span class="line">    float bflops;</span><br><span class="line"></span><br><span class="line">    int adam;</span><br><span class="line">    float B1;</span><br><span class="line">    float B2;</span><br><span class="line">    float eps;</span><br><span class="line"></span><br><span class="line">    int t;</span><br><span class="line"></span><br><span class="line">    float alpha;</span><br><span class="line">    float beta;</span><br><span class="line">    float kappa;</span><br><span class="line"></span><br><span class="line">    float coord_scale;</span><br><span class="line">    float object_scale;</span><br><span class="line">    float noobject_scale;</span><br><span class="line">    float mask_scale;</span><br><span class="line">    float class_scale;</span><br><span class="line">    int bias_match;</span><br><span class="line">    float random;</span><br><span class="line">    float ignore_thresh;</span><br><span class="line">    float truth_thresh;</span><br><span class="line">    float iou_thresh;</span><br><span class="line">    float thresh;</span><br><span class="line">    float focus;</span><br><span class="line">    int classfix;</span><br><span class="line">    int absolute;</span><br><span class="line">    int assisted_excitation;</span><br><span class="line"></span><br><span class="line">    int onlyforward; &#x2F;&#x2F; æ ‡å¿—å‚æ•°ï¼Œå½“å€¼ä¸º1é‚£ä¹ˆå½“å‰å±‚åªæ‰§è¡Œå‰å‘ä¼ æ’­</span><br><span class="line">    int stopbackward;  &#x2F;&#x2F; æ ‡å¿—å‚æ•°ï¼Œç”¨æ¥å¼ºåˆ¶åœæ­¢åå‘ä¼ æ’­è¿‡ç¨‹ï¼ˆå€¼ä¸º1åˆ™åœæ­¢åå‘ä¼ æ’­ï¼‰ï¼Œå‚çœ‹network.cä¸­çš„backward_network()å‡½æ•°</span><br><span class="line">    int dontload;</span><br><span class="line">    int dontsave;</span><br><span class="line">    int dontloadscales;</span><br><span class="line">    int numload;</span><br><span class="line"></span><br><span class="line">    float temperature; &#x2F;&#x2F; æ¸©åº¦å‚æ•°ï¼Œsoftmaxå±‚ç‰¹æœ‰å‚æ•°ï¼Œåœ¨parse_softmax()å‡½æ•°ä¸­èµ‹å€¼ï¼Œç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼1ï¼ˆè§parse_softmax()ï¼‰</span><br><span class="line">    float probability; &#x2F;&#x2F; dropoutæ¦‚ç‡ï¼Œå³èˆå¼ƒæ¦‚ç‡ï¼Œç›¸åº”çš„1-probabilityä¸ºä¿ç•™æ¦‚ç‡ï¼ˆå…·ä½“çš„ä½¿ç”¨å¯å‚è§forward_dropout_layer()ï¼‰ï¼Œåœ¨make_dropout_layer()ä¸­èµ‹å€¼ï¼Œ</span><br><span class="line">						&#x2F;&#x2F; å…¶å€¼ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœç½‘ç»œé…ç½®æ–‡ä»¶æœªæŒ‡å®šï¼Œåˆ™å–é»˜è®¤å€¼0.5ï¼ˆè§parse_dropout()ï¼‰</span><br><span class="line">    float dropblock_size_rel;</span><br><span class="line">    int dropblock_size_abs;</span><br><span class="line">    int dropblock;</span><br><span class="line">    float scale; &#x2F;&#x2F; åœ¨dropoutå±‚ä¸­ï¼Œè¯¥å˜é‡æ˜¯ä¸€ä¸ªæ¯”ä¾‹å› å­ï¼Œå–å€¼ä¸ºä¿ç•™æ¦‚ç‡çš„å€’æ•°ï¼ˆdarknetå®ç°ç”¨çš„æ˜¯inverted dropoutï¼‰ï¼Œç”¨äºç¼©æ”¾è¾“å…¥å…ƒç´ çš„å€¼</span><br><span class="line">                       &#x2F;&#x2F; ï¼ˆåœ¨ç½‘ä¸Šéšä¾¿æœç´¢å…³äºdropoutçš„åšå®¢ï¼Œéƒ½ä¼šæåˆ°inverted dropoutï¼‰ï¼Œåœ¨make_dropout_layer()å‡½æ•°ä¸­èµ‹å€¼</span><br><span class="line"></span><br><span class="line">    char  * cweights;</span><br><span class="line">    int   * indexes; &#x2F;&#x2F; ç»´åº¦ä¸ºl.out_h * l.out_w * l.out_c * l.batchï¼Œå¯çŸ¥åŒ…å«æ•´ä¸ªbatchè¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span><br><span class="line">                     &#x2F;&#x2F; ç›®å‰ä»…å‘ç°å…¶ç”¨åœ¨åœ¨æœ€å¤§æ± åŒ–å±‚ä¸­ã€‚è¯¥å˜é‡å­˜å‚¨çš„æ˜¯ç´¢å¼•å€¼ï¼Œå¹¶ä¸å½“å‰å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œè¡¨ç¤ºå½“å‰å±‚æ¯ä¸ªè¾“å‡ºå…ƒç´ çš„å€¼æ˜¯ä¸Šä¸€å±‚è¾“å‡ºä¸­çš„å“ªä¸€ä¸ªå…ƒç´ å€¼ï¼ˆå­˜å‚¨çš„ç´¢å¼•å€¼æ˜¯</span><br><span class="line">                     &#x2F;&#x2F; åœ¨ä¸Šä¸€å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ï¼ˆåŒ…å«æ•´ä¸ªbatchï¼‰ä¸­çš„ç´¢å¼•ï¼‰ï¼Œå› ä¸ºå¯¹äºæœ€å¤§æ± åŒ–å±‚ï¼Œæ¯ä¸€ä¸ªè¾“å‡ºå…ƒç´ çš„å€¼å®é™…æ˜¯ä¸Šä¸€å±‚è¾“å‡ºï¼ˆä¹Ÿå³å½“å‰å±‚è¾“å…¥ï¼‰æŸä¸ªæ± åŒ–åŒºåŸŸä¸­çš„æœ€å¤§å…ƒç´ å€¼ï¼Œindexeså°±æ˜¯è®°å½•</span><br><span class="line">                     &#x2F;&#x2F; è¿™äº›å±€éƒ¨æœ€å¤§å…ƒç´ å€¼åœ¨ä¸Šä¸€å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ä¸­çš„æ€»ç´¢å¼•ã€‚è®°å½•è¿™äº›å€¼æœ‰ä»€ä¹ˆç”¨å—ï¼Ÿå½“ç„¶æœ‰ï¼Œç”¨äºåå‘ä¼ æ’­è¿‡ç¨‹è®¡ç®—ä¸Šä¸€å±‚æ•æ„Ÿåº¦å€¼ï¼Œè¯¦è§backward_maxpool_layer()ä»¥åŠforward_maxpool_layer()å‡½æ•°ã€‚</span><br><span class="line">    int   * input_layers; &#x2F;&#x2F;è¿™ä¸ªå±‚æœ‰å“ªäº›è¾“å…¥å±‚</span><br><span class="line">    int   * input_sizes; &#x2F;&#x2F; è¾“å…¥å±‚çš„å°ºå¯¸</span><br><span class="line">    float **layers_output; &#x2F;&#x2F;äº§ç”Ÿçš„ä¸€ç³»åˆ—è¾“å‡ºå±‚</span><br><span class="line">    float **layers_delta;</span><br><span class="line">    WEIGHTS_TYPE_T weights_type;</span><br><span class="line">    WEIGHTS_NORMALIZATION_T weights_normalizion;</span><br><span class="line">	&#x2F;*</span><br><span class="line">     * è¿™ä¸ªå‚æ•°ç”¨çš„ä¸å¤šï¼Œä»…åœ¨region_layer.cä¸­ä½¿ç”¨ï¼Œè¯¥å‚æ•°çš„ä½œç”¨æ˜¯ç”¨äºä¸åŒæ•°æ®é›†é—´ç±»åˆ«ç¼–å·çš„è½¬æ¢ï¼Œæ›´ä¸ºå…·ä½“çš„ï¼Œ</span><br><span class="line">     * æ˜¯cocoæ•°æ®é›†ä¸­80ç±»ç‰©ä½“ç¼–å·ä¸è”åˆæ•°æ®é›†ä¸­9000+ç‰©ä½“ç±»åˆ«ç¼–å·ä¹‹é—´çš„è½¬æ¢ï¼Œå¯ä»¥å¯¹æ¯”æŸ¥çœ‹data&#x2F;coco.namesä¸</span><br><span class="line">     * data&#x2F;9k.namesä»¥åŠdata&#x2F;coco9k.mapä¸‰ä¸ªæ–‡ä»¶ï¼ˆæ—§ç‰ˆçš„darknetå¯èƒ½æ²¡æœ‰ï¼Œæ–°ç‰ˆçš„darknetæ‰æœ‰coco9k.mapè¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œ</span><br><span class="line">     * å¯ä»¥å‘ç°ï¼Œcoco.namesä¸­æ¯ä¸€ä¸ªç‰©ä½“ç±»åˆ«éƒ½å¯ä»¥åœ¨9k.namesä¸­æ‰¾åˆ°,ä¸”coco.namesä¸­æ¯ä¸ªç‰©ä½“ç±»åˆ«åç§°åœ¨9k.names</span><br><span class="line">     * ä¸­æ‰€åœ¨çš„è¡Œæ•°å°±æ˜¯coco9k.mapä¸­çš„ç¼–å·å€¼ï¼ˆå‡äº†1,å› ä¸ºåœ¨ç¨‹åºæ•°ç»„ä¸­ç¼–å·ä»0å¼€å§‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªmapå°†cocoæ•°æ®é›†ä¸­</span><br><span class="line">     * çš„ç±»åˆ«ç¼–å·æ˜ å°„åˆ°è”å’Œæ•°æ®é›†9kä¸­çš„ç±»åˆ«ç¼–å·ï¼ˆè¿™ä¸ª9kæ•°æ®é›†æ˜¯ä¸€ä¸ªè”å’Œå¤šä¸ªæ•°æ®é›†çš„å¤§æ•°é›†ï¼Œå…¶åç§°åˆ†ç±»è¢«å±‚çº§åˆ’åˆ†ï¼Œ</span><br><span class="line">     * ï¼‰ï¼ˆæ³¨æ„ä¸¤ä¸ªæ–‡ä»¶ä¸­ç‰©ä½“çš„ç±»åˆ«åç§°å¤§éƒ¨åˆ†éƒ½ç›¸åŒï¼Œæœ‰å°éƒ¨åˆ†å­˜åœ¨å°å·®å¼‚ï¼Œè™½ç„¶æœ‰å·®å¼‚ï¼Œä½†åªæ˜¯ä¸¤ä¸ªæ•°æ®é›†ä¸­ä½¿ç”¨çš„åç§°æœ‰æ‰€å·®å¼‚è€Œå·²ï¼Œ</span><br><span class="line">     * å¯¹åº”çš„ç‰©ä½“æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚åœ¨coco.namesä¸­æ‘©æ‰˜è½¦çš„åç§°ä¸ºmotorbikeï¼Œåœ¨è”åˆæ•°æ®é›†9k.namesï¼Œå…¶åç§°ä¸ºmotorcycleï¼‰.</span><br><span class="line">    *&#x2F;</span><br><span class="line">    int   * map;</span><br><span class="line">    int   * counts;</span><br><span class="line">    float ** sums;</span><br><span class="line">	&#x2F;&#x2F; è¿™ä¸ªå‚æ•°ç›®å‰åªå‘ç°ç”¨åœ¨dropoutå±‚ï¼Œç”¨äºå­˜å‚¨ä¸€äº›åˆ—çš„éšæœºæ•°ï¼Œè¿™äº›éšæœºæ•°ä¸dropoutå±‚çš„è¾“å…¥å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œç»´åº¦ä¸ºl.batch*l.inputsï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰ï¼Œåœ¨make_dropout_layer()å‡½æ•°ä¸­ç”¨callocåŠ¨æ€åˆ†é…å†…å­˜ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å¹¶åœ¨å‰å‘ä¼ æ’­å‡½æ•°forward_dropout_layer()å‡½æ•°ä¸­é€å…ƒç´ èµ‹å€¼ã€‚é‡Œé¢å­˜å‚¨çš„éšæœºæ•°æ»¡è¶³0~1å‡åŒ€åˆ†å¸ƒï¼Œå¹²ä»€ä¹ˆç”¨å‘¢ï¼Ÿç”¨äºå†³å®šè¯¥è¾“å…¥å…ƒç´ çš„å»ç•™ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; æˆ‘ä»¬çŸ¥é“dropoutå±‚å°±å®Œæˆä¸€ä¸ªäº‹ï¼šæŒ‰ç…§ä¸€å®šæ¦‚ç‡èˆå¼ƒè¾“å…¥ç¥ç»å…ƒï¼ˆæ‰€è°“èˆå¼ƒå°±æ˜¯ç½®è¯¥è¾“å…¥çš„å€¼ä¸º0ï¼‰ï¼Œrandä¸­å­˜å‚¨çš„å€¼å°±æ˜¯å¦‚æœå°äºl.probabilityï¼Œåˆ™èˆå¼ƒè¯¥è¾“å…¥ç¥ç»å…ƒï¼ˆè¯¦è§ï¼šforward_dropout_layer()ï¼‰ã€‚</span><br><span class="line">    &#x2F;&#x2F; ä¸ºä»€ä¹ˆè¦ä¿ç•™è¿™äº›éšæœºæ•°å‘¢ï¼Ÿå’Œæœ€å¤§æ± åŒ–å±‚ä¸­çš„l.indexesç±»ä¼¼ï¼Œåœ¨åå‘ä¼ æ’­å‡½æ•°backward_dropout_layer()ä¸­ç”¨æ¥æŒ‡ç¤ºè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å€¼ï¼Œå› ä¸ºdropoutèˆå¼ƒäº†ä¸€äº›è¾“å…¥ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; è¿™äº›è¾“å…¥ï¼ˆdropoutå±‚çš„è¾“å…¥ï¼Œä¸Šä¸€å±‚çš„è¾“å‡ºï¼‰å¯¹åº”çš„æ•æ„Ÿåº¦å€¼å¯ä»¥ç½®ä¸º0ï¼Œè€Œé‚£äº›æ²¡æœ‰èˆå¼ƒçš„è¾“å…¥ï¼Œæ‰æœ‰å¿…è¦ç”±å½“å‰dropoutå±‚åå‘ä¼ æ’­è¿‡å»ã€‚</span><br><span class="line">    float * rand;</span><br><span class="line">    float * cost;</span><br><span class="line">    float * state;</span><br><span class="line">    float * prev_state;</span><br><span class="line">    float * forgot_state;</span><br><span class="line">    float * forgot_delta;</span><br><span class="line">    float * state_delta;</span><br><span class="line">    float * combine_cpu;</span><br><span class="line">    float * combine_delta_cpu;</span><br><span class="line"></span><br><span class="line">    float *concat;</span><br><span class="line">    float *concat_delta;</span><br><span class="line"></span><br><span class="line">    float *binary_weights;</span><br><span class="line"></span><br><span class="line">    float *biases;  &#x2F;&#x2F; å½“å‰å±‚æ‰€æœ‰åç½®ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦l.nï¼Œæ¯ä¸ªå·ç§¯æ ¸æœ‰ä¸€ä¸ªåç½®ï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ç­‰äºå•å¼ è¾“å…¥å›¾ç‰‡å¯¹åº”çš„å…ƒç´ ä¸ªæ•°å³outputsï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()</span><br><span class="line">    float *bias_updates; &#x2F;&#x2F; å½“å‰å±‚æ‰€æœ‰åç½®æ›´æ–°å€¼ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦l.nï¼Œæ¯ä¸ªå·ç§¯æ ¸æœ‰ä¸€ä¸ªåç½®ï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºoutputsã€‚æ‰€è°“æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå°±æ˜¯æ¢¯åº¦ä¸‹é™ä¸­ä¸æ­¥é•¿ç›¸ä¹˜çš„é‚£é¡¹ï¼Œä¹Ÿå³è¯¯å·®å¯¹åç½®çš„å¯¼æ•°ï¼Œ</span><br><span class="line">                          &#x2F;&#x2F; ä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer())</span><br><span class="line"></span><br><span class="line">    float *scales;</span><br><span class="line">    float *scale_updates;</span><br><span class="line"></span><br><span class="line">    float *weights; &#x2F;&#x2F;å½“å‰å±‚æ‰€æœ‰æƒé‡ç³»æ•°ï¼ˆè¿æ¥å½“å‰å±‚å’Œä¸Šä¸€å±‚çš„ç³»æ•°ï¼Œä½†è®°åœ¨å½“å‰å±‚ä¸Šï¼‰ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦ä¸ºl.n*l.c*l.size*l.sizeï¼Œå³å·ç§¯æ ¸ä¸ªæ•°ä¹˜ä»¥å·ç§¯æ ¸å°ºå¯¸å†ä¹˜ä»¥è¾“å…¥é€šé“æ•°ï¼ˆå„ä¸ªé€šé“ä¸Šçš„æƒé‡ç³»æ•°ç‹¬ç«‹ä¸ä¸€æ ·ï¼‰ï¼›</span><br><span class="line">                     &#x2F;&#x2F; å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºå•å¼ å›¾ç‰‡è¾“å…¥ä¸è¾“å‡ºå…ƒç´ ä¸ªæ•°ä¹‹ç§¯inputs*outputsï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()ï¼‰</span><br><span class="line">    float *weight_updates;&#x2F;&#x2F; å½“å‰å±‚æ‰€æœ‰æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå¯¹äºå·ç§¯å±‚ç»´åº¦ä¸ºl.n*l.c*l.size*l.sizeï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºå•å¼ å›¾ç‰‡è¾“å…¥ä¸è¾“å‡ºå…ƒç´ ä¸ªæ•°ä¹‹ç§¯inputs*outputsï¼Œ</span><br><span class="line">                            &#x2F;&#x2F; æ‰€è°“æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå°±æ˜¯æ¢¯åº¦ä¸‹é™ä¸­ä¸æ­¥é•¿ç›¸ä¹˜çš„é‚£é¡¹ï¼Œä¹Ÿå³è¯¯å·®å¯¹æƒé‡çš„å¯¼æ•°ï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()</span><br><span class="line"></span><br><span class="line">    float scale_x_y;</span><br><span class="line">    float max_delta;</span><br><span class="line">    float uc_normalizer;</span><br><span class="line">    float iou_normalizer;</span><br><span class="line">    float cls_normalizer;</span><br><span class="line">    IOU_LOSS iou_loss;</span><br><span class="line">    NMS_KIND nms_kind;</span><br><span class="line">    float beta_nms;</span><br><span class="line">    YOLO_POINT yolo_point;</span><br><span class="line"></span><br><span class="line">    char *align_bit_weights_gpu;</span><br><span class="line">    float *mean_arr_gpu;</span><br><span class="line">    float *align_workspace_gpu;</span><br><span class="line">    float *transposed_align_workspace_gpu;</span><br><span class="line">    int align_workspace_size;</span><br><span class="line"></span><br><span class="line">    char *align_bit_weights;</span><br><span class="line">    float *mean_arr;</span><br><span class="line">    int align_bit_weights_size;</span><br><span class="line">    int lda_align;</span><br><span class="line">    int new_lda;</span><br><span class="line">    int bit_align;</span><br><span class="line"></span><br><span class="line">    float *col_image;</span><br><span class="line">    float * delta; &#x2F;&#x2F; å­˜å‚¨æ¯ä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼šåŒ…å«æ‰€æœ‰è¾“å‡ºå…ƒç´ çš„æ•æ„Ÿåº¦å€¼ï¼ˆæ•´ä¸ªbatchæ‰€æœ‰å›¾ç‰‡ï¼‰ã€‚æ‰€è°“æ•æ„Ÿåº¦ï¼Œå³è¯¯å·®å‡½æ•°å…³äºå½“å‰å±‚æ¯ä¸ªåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å…³äºæ•æ„Ÿåº¦å›¾è¿™ä¸ªåç§°ï¼Œå…¶å®å°±æ˜¯æ¢¯åº¦ï¼Œå¯ä»¥å‚è€ƒhttps:&#x2F;&#x2F;www.zybuluo.com&#x2F;hanbingtao&#x2F;note&#x2F;485480ã€‚</span><br><span class="line">                   &#x2F;&#x2F; å…ƒç´ ä¸ªæ•°ä¸ºl.batch * l.outputsï¼ˆå…¶ä¸­l.outputs &#x3D; l.out_h * l.out_w * l.out_cï¼‰ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å¯¹äºå·ç§¯ç¥ç»ç½‘ç»œï¼Œåœ¨make_convolutional_layer()åŠ¨æ€åˆ†é…å†…å­˜ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå¯è§†ä¸ºl.batchè¡Œï¼Œl.outputsåˆ—ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å³batchä¸­æ¯ä¸€å¼ å›¾ç‰‡ï¼Œå¯¹åº”l.deltaä¸­çš„ä¸€è¡Œï¼Œè€Œè¿™ä¸€è¡Œï¼Œåˆå¯ä»¥è§†ä½œæœ‰l.out_cè¡Œï¼Œl.out_h*l.out_cåˆ—ï¼Œ</span><br><span class="line">                   &#x2F;&#x2F; å…¶ä¸­æ¯å°è¡Œå¯¹åº”ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„ä¸€å¼ è¾“å‡ºç‰¹å¾å›¾çš„æ•æ„Ÿåº¦ã€‚ä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span><br><span class="line">    float * output; &#x2F;&#x2F; å­˜å‚¨è¯¥å±‚æ‰€æœ‰çš„è¾“å‡ºï¼Œç»´åº¦ä¸ºl.out_h * l.out_w * l.out_c * l.batchï¼Œå¯çŸ¥åŒ…å«æ•´ä¸ªbatchè¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span><br><span class="line">                    &#x2F;&#x2F; æŒ‰è¡Œå­˜å‚¨ï¼šæ¯å¼ å›¾ç‰‡æŒ‰è¡Œé“ºæ’æˆä¸€å¤§è¡Œï¼Œå›¾ç‰‡é—´å†å¹¶æˆä¸€è¡Œã€‚</span><br><span class="line">    float * activation_input;</span><br><span class="line">    int delta_pinned;</span><br><span class="line">    int output_pinned;</span><br><span class="line">    float * loss;</span><br><span class="line">    float * squared;</span><br><span class="line">    float * norms;</span><br><span class="line"></span><br><span class="line">    float * spatial_mean;</span><br><span class="line">    float * mean;</span><br><span class="line">    float * variance;</span><br><span class="line"></span><br><span class="line">    float * mean_delta;</span><br><span class="line">    float * variance_delta;</span><br><span class="line"></span><br><span class="line">    float * rolling_mean;</span><br><span class="line">    float * rolling_variance;</span><br><span class="line"></span><br><span class="line">    float * x;</span><br><span class="line">    float * x_norm;</span><br><span class="line"></span><br><span class="line">    float * m;</span><br><span class="line">    float * v;</span><br><span class="line"></span><br><span class="line">    float * bias_m;</span><br><span class="line">    float * bias_v;</span><br><span class="line">    float * scale_m;</span><br><span class="line">    float * scale_v;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    float *z_cpu;</span><br><span class="line">    float *r_cpu;</span><br><span class="line">    float *h_cpu;</span><br><span class="line">    float *stored_h_cpu;</span><br><span class="line">    float * prev_state_cpu;</span><br><span class="line"></span><br><span class="line">    float *temp_cpu;</span><br><span class="line">    float *temp2_cpu;</span><br><span class="line">    float *temp3_cpu;</span><br><span class="line"></span><br><span class="line">    float *dh_cpu;</span><br><span class="line">    float *hh_cpu;</span><br><span class="line">    float *prev_cell_cpu;</span><br><span class="line">    float *cell_cpu;</span><br><span class="line">    float *f_cpu;</span><br><span class="line">    float *i_cpu;</span><br><span class="line">    float *g_cpu;</span><br><span class="line">    float *o_cpu;</span><br><span class="line">    float *c_cpu;</span><br><span class="line">    float *stored_c_cpu;</span><br><span class="line">    float *dc_cpu;</span><br><span class="line"></span><br><span class="line">    float *binary_input;</span><br><span class="line">    uint32_t *bin_re_packed_input;</span><br><span class="line">    char *t_bit_input;</span><br><span class="line"></span><br><span class="line">    struct layer *input_layer;</span><br><span class="line">    struct layer *self_layer;</span><br><span class="line">    struct layer *output_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *reset_layer;</span><br><span class="line">    struct layer *update_layer;</span><br><span class="line">    struct layer *state_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *input_gate_layer;</span><br><span class="line">    struct layer *state_gate_layer;</span><br><span class="line">    struct layer *input_save_layer;</span><br><span class="line">    struct layer *state_save_layer;</span><br><span class="line">    struct layer *input_state_layer;</span><br><span class="line">    struct layer *state_state_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *input_z_layer;</span><br><span class="line">    struct layer *state_z_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *input_r_layer;</span><br><span class="line">    struct layer *state_r_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *input_h_layer;</span><br><span class="line">    struct layer *state_h_layer;</span><br><span class="line"></span><br><span class="line">    struct layer *wz;</span><br><span class="line">    struct layer *uz;</span><br><span class="line">    struct layer *wr;</span><br><span class="line">    struct layer *ur;</span><br><span class="line">    struct layer *wh;</span><br><span class="line">    struct layer *uh;</span><br><span class="line">    struct layer *uo;</span><br><span class="line">    struct layer *wo;</span><br><span class="line">    struct layer *vo;</span><br><span class="line">    struct layer *uf;</span><br><span class="line">    struct layer *wf;</span><br><span class="line">    struct layer *vf;</span><br><span class="line">    struct layer *ui;</span><br><span class="line">    struct layer *wi;</span><br><span class="line">    struct layer *vi;</span><br><span class="line">    struct layer *ug;</span><br><span class="line">    struct layer *wg;</span><br><span class="line"> </span><br><span class="line">    tree *softmax_tree; &#x2F;&#x2F; softmaxå±‚ç”¨åˆ°çš„ä¸€ä¸ªå‚æ•°ï¼Œä¸è¿‡è¿™ä¸ªå‚æ•°ä¼¼ä¹å¹¶ä¸å¸¸è§ï¼Œå¾ˆå¤šç”¨åˆ°softmaxå±‚çš„ç½‘ç»œå¹¶æ²¡ç”¨ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œç›®å‰ä»…å‘ç°darknet9000.cfgä¸­ä½¿ç”¨äº†è¯¥å‚æ•°ï¼Œå¦‚æœæœªç”¨åˆ°è¯¥å‚æ•°ï¼Œå…¶å€¼ä¸ºNULLï¼Œå¦‚æœç”¨åˆ°äº†åˆ™ä¼šåœ¨parse_softmax()ä¸­èµ‹å€¼ï¼Œ</span><br><span class="line">                       &#x2F;&#x2F; ç›®å‰ä¸ªäººçš„åˆæ­¥çŒœæµ‹æ˜¯åˆ©ç”¨è¯¥å‚æ•°æ¥ç»„ç»‡æ ‡ç­¾æ•°æ®ï¼Œä»¥æ–¹ä¾¿è®¿é—®</span><br><span class="line"></span><br><span class="line">    size_t workspace_size; &#x2F;&#x2F; net.workspaceçš„å…ƒç´ ä¸ªæ•°ï¼Œä¸ºæ‰€æœ‰å±‚ä¸­æœ€å¤§çš„l.out_h*l.out_w*l.size*l.size*l.cï¼Œï¼ˆåœ¨make_convolutional_layer()è®¡ç®—å¾—åˆ°workspace_sizeçš„å¤§å°ï¼Œåœ¨parse_network_cfg()ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼Œæ­¤å€¼å¯¹åº”æœªä½¿ç”¨gpuæ—¶çš„æƒ…å†µ</span><br><span class="line"> </span><br><span class="line">#ifdef GPU</span><br><span class="line">    int *indexes_gpu;</span><br><span class="line"></span><br><span class="line">    float *z_gpu;</span><br><span class="line">    float *r_gpu;</span><br><span class="line">    float *h_gpu;</span><br><span class="line">    float *stored_h_gpu;</span><br><span class="line"></span><br><span class="line">    float *temp_gpu;</span><br><span class="line">    float *temp2_gpu;</span><br><span class="line">    float *temp3_gpu;</span><br><span class="line"></span><br><span class="line">    float *dh_gpu;</span><br><span class="line">    float *hh_gpu;</span><br><span class="line">    float *prev_cell_gpu;</span><br><span class="line">    float *prev_state_gpu;</span><br><span class="line">    float *last_prev_state_gpu;</span><br><span class="line">    float *last_prev_cell_gpu;</span><br><span class="line">    float *cell_gpu;</span><br><span class="line">    float *f_gpu;</span><br><span class="line">    float *i_gpu;</span><br><span class="line">    float *g_gpu;</span><br><span class="line">    float *o_gpu;</span><br><span class="line">    float *c_gpu;</span><br><span class="line">    float *stored_c_gpu;</span><br><span class="line">    float *dc_gpu;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; adam</span><br><span class="line">    float *m_gpu;</span><br><span class="line">    float *v_gpu;</span><br><span class="line">    float *bias_m_gpu;</span><br><span class="line">    float *scale_m_gpu;</span><br><span class="line">    float *bias_v_gpu;</span><br><span class="line">    float *scale_v_gpu;</span><br><span class="line"></span><br><span class="line">    float * combine_gpu;</span><br><span class="line">    float * combine_delta_gpu;</span><br><span class="line"></span><br><span class="line">    float * forgot_state_gpu;</span><br><span class="line">    float * forgot_delta_gpu;</span><br><span class="line">    float * state_gpu;</span><br><span class="line">    float * state_delta_gpu;</span><br><span class="line">    float * gate_gpu;</span><br><span class="line">    float * gate_delta_gpu;</span><br><span class="line">    float * save_gpu;</span><br><span class="line">    float * save_delta_gpu;</span><br><span class="line">    float * concat_gpu;</span><br><span class="line">    float * concat_delta_gpu;</span><br><span class="line"></span><br><span class="line">    float *binary_input_gpu;</span><br><span class="line">    float *binary_weights_gpu;</span><br><span class="line">    float *bin_conv_shortcut_in_gpu;</span><br><span class="line">    float *bin_conv_shortcut_out_gpu;</span><br><span class="line"></span><br><span class="line">    float * mean_gpu;</span><br><span class="line">    float * variance_gpu;</span><br><span class="line"></span><br><span class="line">    float * rolling_mean_gpu;</span><br><span class="line">    float * rolling_variance_gpu;</span><br><span class="line"></span><br><span class="line">    float * variance_delta_gpu;</span><br><span class="line">    float * mean_delta_gpu;</span><br><span class="line"></span><br><span class="line">    float * col_image_gpu;</span><br><span class="line"></span><br><span class="line">    float * x_gpu;</span><br><span class="line">    float * x_norm_gpu;</span><br><span class="line">    float * weights_gpu;</span><br><span class="line">    float * weight_updates_gpu;</span><br><span class="line">    float * weight_deform_gpu;</span><br><span class="line">    float * weight_change_gpu;</span><br><span class="line"></span><br><span class="line">    float * weights_gpu16;</span><br><span class="line">    float * weight_updates_gpu16;</span><br><span class="line"></span><br><span class="line">    float * biases_gpu;</span><br><span class="line">    float * bias_updates_gpu;</span><br><span class="line">    float * bias_change_gpu;</span><br><span class="line"></span><br><span class="line">    float * scales_gpu;</span><br><span class="line">    float * scale_updates_gpu;</span><br><span class="line">    float * scale_change_gpu;</span><br><span class="line"></span><br><span class="line">    float * input_antialiasing_gpu;</span><br><span class="line">    float * output_gpu;</span><br><span class="line">    float * activation_input_gpu;</span><br><span class="line">    float * loss_gpu;</span><br><span class="line">    float * delta_gpu;</span><br><span class="line">    float * rand_gpu;</span><br><span class="line">    float * squared_gpu;</span><br><span class="line">    float * norms_gpu;</span><br><span class="line"></span><br><span class="line">    float *gt_gpu;</span><br><span class="line">    float *a_avg_gpu;</span><br><span class="line"></span><br><span class="line">    int *input_sizes_gpu;</span><br><span class="line">    float **layers_output_gpu;</span><br><span class="line">    float **layers_delta_gpu;</span><br><span class="line">#ifdef CUDNN</span><br><span class="line">    cudnnTensorDescriptor_t srcTensorDesc, dstTensorDesc;</span><br><span class="line">    cudnnTensorDescriptor_t srcTensorDesc16, dstTensorDesc16;</span><br><span class="line">    cudnnTensorDescriptor_t dsrcTensorDesc, ddstTensorDesc;</span><br><span class="line">    cudnnTensorDescriptor_t dsrcTensorDesc16, ddstTensorDesc16;</span><br><span class="line">    cudnnTensorDescriptor_t normTensorDesc, normDstTensorDesc, normDstTensorDescF16;</span><br><span class="line">    cudnnFilterDescriptor_t weightDesc, weightDesc16;</span><br><span class="line">    cudnnFilterDescriptor_t dweightDesc, dweightDesc16;</span><br><span class="line">    cudnnConvolutionDescriptor_t convDesc;</span><br><span class="line">    cudnnConvolutionFwdAlgo_t fw_algo, fw_algo16;</span><br><span class="line">    cudnnConvolutionBwdDataAlgo_t bd_algo, bd_algo16;</span><br><span class="line">    cudnnConvolutionBwdFilterAlgo_t bf_algo, bf_algo16;</span><br><span class="line">    cudnnPoolingDescriptor_t poolingDesc;</span><br><span class="line">#endif  &#x2F;&#x2F; CUDNN</span><br><span class="line">#endif  &#x2F;&#x2F; GPU</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetåŠ è½½æ•°æ®è¿›è¡Œè®­ç»ƒ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E8%AE%AD%E7%BB%83/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title=" å‰è¨€"></a><a id="more"></a> å‰è¨€</h2><p>ä¹‹å‰è®²äº†DarkNetçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å°†ç½‘ç»œé…ç½®æ–‡ä»¶è¿›è¡Œäº†è§£æå­˜æ”¾åˆ°äº†ä¸€ä¸ª<code>network</code>ç»“æ„ä½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æ¥çœ‹ä¸€ä¸‹Darknetæ˜¯å¦‚ä½•åŠ è½½æ•°æ®è¿›è¡Œè®­ç»ƒçš„ã€‚</p>
<h2 id="åŠ è½½è®­ç»ƒæ•°æ®"><a href="#åŠ è½½è®­ç»ƒæ•°æ®" class="headerlink" title="åŠ è½½è®­ç»ƒæ•°æ®"></a>åŠ è½½è®­ç»ƒæ•°æ®</h2><p>DarkNetçš„æ•°æ®åŠ è½½å‡½æ•°<code>load_data()</code>åœ¨<code>src/data.c</code>ä¸­å®ç°ï¼ˆ<code>src/detector.c</code>å‡½æ•°ä¸­çš„<code>train_detector</code>ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°åŠ è½½æ•°æ®ï¼‰ã€‚<code>load_data()</code>å‡½æ•°è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š<code>load_data(args)-&gt;load_threads()-&gt;load_data_in_threads()-&gt;load_thread()-&gt;load_data_detection()</code>ï¼Œå‰å››ä¸ªå‡½æ•°éƒ½æ˜¯åœ¨å¯¹çº¿ç¨‹çš„è°ƒç”¨è¿›è¡Œå°è£…ã€‚æœ€åº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡ç”±<code>load_data_detection()</code>å‡½æ•°å®Œæˆã€‚æ‰€æœ‰çš„æ•°æ®(å›¾ç‰‡æ•°æ®å’Œæ ‡æ³¨ä¿¡æ¯æ•°æ®)åŠ è½½å®Œæˆä¹‹åå†æ‹¼æ¥åˆ°ä¸€ä¸ªå¤§çš„æ•°ç»„ä¸­ã€‚åœ¨DarkNetä¸­ï¼Œå›¾ç‰‡çš„å­˜å‚¨å½¢å¼æ˜¯ä¸€ä¸ªè¡Œå‘é‡ï¼Œå‘é‡é•¿åº¦ä¸º<code>h*w*3</code>ã€‚åŒæ—¶å›¾ç‰‡è¢«å½’ä¸€åŒ–åˆ°<code>[0, 1]</code>ä¹‹é—´ã€‚</p>
<h2 id="load-threads-å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥"><a href="#load-threads-å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥" class="headerlink" title="load_threads()å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥"></a>load_threads()å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥</h2><p><code>load_threads</code>åœ¨<code>src/data.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; copy from https:&#x2F;&#x2F;github.com&#x2F;hgpvision&#x2F;darknet&#x2F;blob&#x2F;master&#x2F;src&#x2F;data.c#L355</span><br><span class="line">&#x2F;*</span><br><span class="line">** å¼€è¾Ÿå¤šä¸ªçº¿ç¨‹è¯»å…¥å›¾ç‰‡æ•°æ®ï¼Œè¯»å…¥æ•°æ®å­˜å‚¨è‡³ptr.dä¸­ï¼ˆä¸»è¦è°ƒç”¨load_in_thread()å‡½æ•°å®Œæˆï¼‰</span><br><span class="line">** è¾“å…¥ï¼šptr    åŒ…å«æ‰€æœ‰çº¿ç¨‹è¦è¯»å…¥å›¾ç‰‡æ•°æ®çš„ä¿¡æ¯ï¼ˆè¯»å…¥å¤šå°‘å¼ ï¼Œå¼€å‡ ä¸ªçº¿ç¨‹è¯»å…¥ï¼Œè¯»å…¥å›¾ç‰‡æœ€ç»ˆçš„å®½é«˜ï¼Œå›¾ç‰‡è·¯å¾„ç­‰ç­‰ï¼‰</span><br><span class="line">** è¿”å›ï¼švoid*  ä¸‡èƒ½æŒ‡é’ˆï¼ˆå®é™…ä¸Šä¸éœ€è¦è¿”å›ä»€ä¹ˆï¼‰</span><br><span class="line">** è¯´æ˜ï¼š1) load_threads()æ˜¯ä¸€ä¸ªæŒ‡é’ˆå‡½æ•°ï¼Œåªæ˜¯ä¸€ä¸ªè¿”å›å˜é‡ä¸ºvoid*çš„æ™®é€šå‡½æ•°ï¼Œä¸æ˜¯å‡½æ•°æŒ‡é’ˆ</span><br><span class="line">**       2) è¾“å…¥ptræ˜¯ä¸€ä¸ªvoid*æŒ‡é’ˆï¼ˆä¸‡èƒ½æŒ‡é’ˆï¼‰ï¼Œä½¿ç”¨æ—¶éœ€è¦å¼ºè½¬ä¸ºå…·ä½“ç±»å‹çš„æŒ‡é’ˆ</span><br><span class="line">**       3) å‡½æ•°ä¸­æ¶‰åŠå››ä¸ªç”¨æ¥å­˜å‚¨è¯»å…¥æ•°æ®çš„å˜é‡ï¼šptr, args, out, buffersï¼Œé™¤argså¤–éƒ½æ˜¯data*ç±»å‹ï¼Œæ‰€æœ‰è¿™äº›å˜é‡çš„</span><br><span class="line">**          æŒ‡é’ˆå˜é‡å…¶å®éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜ï¼ˆå½“ç„¶å‡½æ•°ä¸­é—´æœ‰äº›åŠ¨æ€å˜åŒ–ï¼‰ï¼Œå› æ­¤è¯»å…¥çš„æ•°æ®éƒ½æ˜¯äº’é€šçš„ã€‚</span><br><span class="line">** æµç¨‹ï¼šæœ¬å‡½æ•°é¦–å…ˆä¼šè·å–è¦è¯»å…¥å›¾ç‰‡çš„å¼ æ•°ã€è¦å¼€å¯çº¿ç¨‹çš„ä¸ªæ•°ï¼Œè€Œåè®¡ç®—æ¯ä¸ªçº¿ç¨‹åº”è¯¥è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼ˆå°½å¯èƒ½çš„å‡åŒ€åˆ†é…ï¼‰ï¼Œ</span><br><span class="line">**       å¹¶åˆ›å»ºæ‰€æœ‰çš„çº¿ç¨‹ï¼Œå¹¶è¡Œè¯»å…¥æ•°æ®ï¼Œæœ€ååˆå¹¶æ¯ä¸ªçº¿ç¨‹è¯»å…¥çš„æ•°æ®è‡³ä¸€ä¸ªå¤§dataä¸­ï¼Œè¿™ä¸ªdataçš„æŒ‡é’ˆå˜é‡ä¸ptrçš„æŒ‡é’ˆå˜é‡</span><br><span class="line">**       æŒ‡å‘çš„æ˜¯ç»Ÿä¸€å—å†…å­˜ï¼Œå› æ­¤ä¹Ÿå°±æœ€ç»ˆå°†æ•°æ®è¯»å…¥åˆ°ptr.dä¸­ï¼ˆæ‰€ä»¥å…¶å®æ²¡æœ‰è¿”å›å€¼ï¼‰</span><br><span class="line">*&#x2F;</span><br><span class="line">void *load_threads(void *ptr)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;srand(time(0));</span><br><span class="line">    int i;</span><br><span class="line">	&#x2F;&#x2F; å…ˆä½¿ç”¨(load_args*)å¼ºè½¬void*æŒ‡é’ˆï¼Œè€Œåå–ptræ‰€æŒ‡å†…å®¹èµ‹å€¼ç»™args</span><br><span class="line">    &#x2F;&#x2F; è™½ç„¶argsä¸æ˜¯æŒ‡é’ˆï¼Œargsæ˜¯æ·±æ‹·è´äº†pträ¸­çš„å†…å®¹ï¼Œä½†æ˜¯è¦çŸ¥é“ptrï¼ˆä¹Ÿå°±æ˜¯load_argsæ•°æ®ç±»å‹ï¼‰ï¼Œæœ‰å¾ˆå¤šçš„</span><br><span class="line">    &#x2F;&#x2F; æŒ‡é’ˆå˜é‡ï¼Œargsæ·±æ‹·è´å°†æ‹·è´è¿™äº›æŒ‡é’ˆå˜é‡åˆ°argsä¸­ï¼ˆè¿™äº›æŒ‡é’ˆå˜é‡æœ¬èº«å¯¹ptræ¥è¯´å°±æ˜¯å†…å®¹ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; è€Œargsæ‰€æŒ‡çš„å€¼æ˜¯argsçš„å†…å®¹ï¼Œä¸æ˜¯ptrçš„ï¼Œä¸è¦æ··ä¸ºä¸€è°ˆï¼‰ï¼Œå› æ­¤ï¼Œargsä¸ptrå°†ä¼šå…±äº«æ‰€æœ‰æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å†…å®¹</span><br><span class="line">    load_args args &#x3D; *(load_args *)ptr;</span><br><span class="line">    if (args.threads &#x3D;&#x3D; 0) args.threads &#x3D; 1;</span><br><span class="line">	&#x2F;&#x2F; å¦æŒ‡é’ˆå˜é‡out&#x3D;args.dï¼Œä½¿å¾—outä¸args.dæŒ‡å‘ç»Ÿä¸€å—å†…å­˜ï¼Œä¹‹åï¼Œargs.dæ‰€æŒ‡çš„å†…å­˜å—ä¼šå˜ï¼ˆåæ­£ä¹Ÿæ²¡ä»€ä¹ˆç”¨äº†ï¼Œå˜å°±å˜å§ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ä½†outä¸ä¼šå˜ï¼Œè¿™æ ·å¯ä»¥ä¿è¯outä¸æœ€åŸå§‹çš„ptræŒ‡å‘åŒä¸€å—å­˜å‚¨è¯»å…¥å›¾ç‰‡æ•°æ®çš„å†…å­˜å—ï¼Œå› æ­¤æœ€ç»ˆå°†å›¾ç‰‡è¯»åˆ°outä¸­ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å®é™…å°±æ˜¯è¯»åˆ°äº†æœ€åŸå§‹çš„pträ¸­ï¼Œæ¯”å¦‚train_detector()å‡½æ•°ä¸­å®šä¹‰çš„args.dä¸­</span><br><span class="line">    data *out &#x3D; args.d;</span><br><span class="line">	&#x2F;&#x2F; è¯»å…¥å›¾ç‰‡çš„æ€»å¼ æ•°&#x3D; batch * subdivision * ngpusï¼Œå¯å‚è§train_detector()å‡½æ•°ä¸­çš„èµ‹å€¼</span><br><span class="line">    int total &#x3D; args.n;</span><br><span class="line">	&#x2F;&#x2F; é‡Šæ”¾ptrï¼šptræ˜¯ä¼ å…¥çš„æŒ‡é’ˆå˜é‡ï¼Œä¼ å…¥çš„æŒ‡é’ˆå˜é‡æœ¬èº«ä¹Ÿæ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œå³ä¼ å…¥å‡½æ•°ä¹‹åï¼ŒæŒ‡é’ˆå˜é‡å¾—åˆ°å¤åˆ¶ï¼Œå‡½æ•°å†…çš„å½¢å‚ptr</span><br><span class="line">    &#x2F;&#x2F; è·å–å¤–éƒ¨å®å‚çš„å€¼ä¹‹åï¼ŒäºŒè€…æœ¬èº«æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯ç”±äºæ˜¯æŒ‡é’ˆå˜é‡ï¼ŒäºŒè€…ä¹‹é—´åˆå­˜åœ¨ä¸€ä¸å…³ç³»ï¼Œé‚£å°±æ˜¯å‡½æ•°å†…å½¢å‚ä¸å‡½æ•°å¤–å®å‚æŒ‡å‘</span><br><span class="line">    &#x2F;&#x2F; åŒä¸€å—å†…å­˜ã€‚åˆç”±äºå‡½æ•°å¤–å®å‚å†…å­˜æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œå› æ­¤å‡½æ•°å†…çš„å½¢å‚å¯ä»¥ä½¿ç”¨free()å‡½æ•°è¿›è¡Œå†…å­˜é‡Šæ”¾ï¼Œä½†ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšï¼Œå› ä¸ºå‡½æ•°å†…é‡Šæ”¾å†…å­˜ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ä¼šå½±å“å‡½æ•°å¤–å®å‚çš„ä½¿ç”¨ï¼Œå¯èƒ½ä½¿ä¹‹æˆä¸ºé‡æŒ‡é’ˆï¼Œé‚£ä¸ºä»€ä¹ˆè¿™é‡Œå¯ä»¥ç”¨free()é‡Šæ”¾ptrå‘¢ï¼Œä¸ä¼šå‡ºç°é—®é¢˜å—ï¼Ÿ</span><br><span class="line">    &#x2F;&#x2F; å…¶ä¸€ï¼Œå› ä¸ºptræ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«ä¼—å¤šçš„æŒ‡é’ˆå˜é‡çš„ç»“æ„ä½“ï¼Œå¦‚data* dç­‰ï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–éæŒ‡é’ˆå˜é‡å¦‚int hç­‰ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ç›´æ¥free(ptr)å°†ä¼šå¯¼è‡´å‡½æ•°å¤–å®å‚æ— æ³•å†è®¿é—®éæŒ‡é’ˆå˜é‡int hç­‰ï¼ˆå®é™…ç»è¿‡æµ‹è¯•ï¼Œåœ¨gccç¼–è¯‘å™¨ä¸‹ï¼Œèƒ½è®¿é—®ä½†æ˜¯å€¼è¢«é‡æ–°åˆå§‹åŒ–ä¸º0ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å› ä¸ºå‡½æ•°å†…å½¢å‚å’Œå‡½æ•°å¤–å®å‚å…±äº«ä¸€å—å †å†…å­˜ï¼Œè€Œè¿™äº›éæŒ‡é’ˆå˜é‡éƒ½æ˜¯å­˜åœ¨è¿™å—å †å†…å­˜ä¸Šçš„ï¼Œå†…å­˜ä¸€é‡Šæ”¾ï¼Œå°±æ— æ³•è®¿é—®äº†ï¼›</span><br><span class="line">    &#x2F;&#x2F; ä½†æ˜¯å¯¹äºæŒ‡é’ˆå˜é‡ï¼Œfree(ptr)å°†æ— ä½œä¸ºï¼ˆè¿™ä¸ªç»“è®ºä¹Ÿæ˜¯ç»è¿‡æµ‹è¯•çš„ï¼Œä¹Ÿæ˜¯ç”¨çš„gccç¼–è¯‘å™¨ï¼‰ï¼Œä¸ä¼šé‡Šæ”¾æˆ–è€…æ“¦å†™æ‰ptræŒ‡é’ˆå˜é‡æœ¬èº«çš„å€¼ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å½“ç„¶ä¹Ÿä¸ä¼šå½±å“å‡½æ•°å¤–å®å‚ï¼Œæ›´ä¸ä¼šç‰µæ‰¯åˆ°è¿™äº›æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å†…å­˜å—ï¼Œæ€»çš„æ¥è¯´ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; free(ptr)å°†ä½¿å¾—pträ¸èƒ½å†è®¿é—®æŒ‡é’ˆå˜é‡ï¼ˆå¦‚int hç­‰ï¼Œå®é™…ç»è¿‡æµ‹è¯•ï¼Œåœ¨gccç¼–è¯‘å™¨ä¸‹ï¼Œèƒ½è®¿é—®ä½†æ˜¯å€¼è¢«é‡æ–°åˆå§‹åŒ–ä¸º0ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ä½†å…¶æŒ‡é’ˆå˜é‡æœ¬èº«æ²¡æœ‰å—å½±å“ï¼Œä¾æ—§å¯ä»¥è®¿é—®ï¼›å¯¹äºå‡½æ•°å¤–å®å‚ï¼ŒåŒæ ·ä¸èƒ½è®¿é—®éæŒ‡é’ˆå˜é‡ï¼Œè€ŒæŒ‡é’ˆå˜é‡ä¸å—å½±å“ï¼Œä¾æ—§å¯ä»¥è®¿é—®ã€‚</span><br><span class="line">    &#x2F;&#x2F; å…¶äºŒï¼Œdarknetæ•°æ®è¯»å–çš„å®ç°ä¸€å±‚å¥—ä¸€å±‚ï¼ˆä¼¼ä¹æœ‰ç‚¹ç½—å—¦ï¼Œæ€»æ„Ÿè§‰ä»£ç å¯ä»¥ä¸ç”¨è¿™ä¹ˆå†™çš„:)ï¼‰ï¼Œå…·ä½“è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</span><br><span class="line">    &#x2F;&#x2F; load_data(load_args args)-&gt;load_threads(load_args* ptr)-&gt;load_data_in_thread(load_args args)-&gt;load_thread(load_args* ptr)ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å°±åœ¨load_data()ä¸­ï¼Œé‡æ–°å®šä¹‰äº†ptrï¼Œå¹¶ä¸ºä¹‹åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œä¸”æ·±æ‹·è´äº†ä¼ ç»™load_data()å‡½æ•°çš„å€¼argsï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ­¤ä¹‹åload_data()å‡½æ•°ä¸­çš„argsé™¤äº†å…¶ä¸­çš„æŒ‡é’ˆå˜é‡æŒ‡ç€åŒä¸€å—å †å†…å­˜ä¹‹å¤–ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; äºŒè€…çš„éæŒ‡é’ˆå˜é‡å†æ— ç“œè‘›ï¼Œä¸ç®¡ä¹‹åç»è¿‡å¤šå°‘ä¸ªå‡½æ•°ï¼Œå¯¹ptrçš„éæŒ‡é’ˆå˜é‡åšäº†ä»€ä¹ˆæ”¹åŠ¨ï¼Œæ¯”å¦‚è¿™é‡Œç›´æ¥free(ptr)ï¼Œä½¿å¾—éæŒ‡é’ˆå˜é‡å€¼ä¸º0,éƒ½ä¸ä¼šå½±å“load_data()ä¸­çš„argsçš„éæŒ‡é’ˆå˜é‡ï¼Œä¹Ÿå°±ä¸ä¼šå½±å“æ›´ä¸ºé¡¶å±‚å‡½æ•°ä¸­å®šä¹‰çš„argsçš„éæŒ‡é’ˆå˜é‡çš„å€¼ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; æ¯”å¦‚train_detector()å‡½æ•°ä¸­çš„argsï¼Œtrain_detector()å¯¹argséæŒ‡é’ˆå˜é‡èµ‹çš„å€¼éƒ½ä¸ä¼šå—å½±å“ï¼Œä¿æŒä¸å˜ã€‚ç»¼å…¶ä¸¤ç‚¹ï¼Œæ­¤å¤„ç›´æ¥free(ptr)æ˜¯å®‰å…¨çš„ã€‚</span><br><span class="line">    &#x2F;&#x2F; è¯´æ˜ï¼šfree(ptr)å‡½æ•°ï¼Œç¡®å®šä¼šåšçš„äº‹æ˜¯ä½¿å¾—å†…å­˜å—å¯ä»¥é‡æ–°åˆ†é…ï¼Œä¸”ä¸ä¼šå½±å“æŒ‡é’ˆå˜é‡ptræœ¬èº«çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ptrè¿˜æ˜¯æŒ‡å‘é‚£å—åœ°å€ï¼Œ è™½ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†å¾ˆå±é™©ï¼Œå› ä¸ºè¿™å—å†…å­˜å®é™…æ˜¯æ— æ•ˆçš„ï¼Œ</span><br><span class="line">    &#x2F;&#x2F;      ç³»ç»Ÿå·²ç»è®¤ä¸ºè¿™å—å†…å­˜æ˜¯å¯åˆ†é…çš„ï¼Œä¼šæ¯«ä¸è€ƒè™‘çš„å°†è¿™å—å†…å­˜åˆ†ç»™å…¶ä»–å˜é‡ï¼Œè¿™æ ·ï¼Œå…¶å€¼éšæ—¶éƒ½å¯èƒ½ä¼šè¢«å…¶ä»–å˜é‡æ”¹å˜ï¼Œè¿™ç§æƒ…å†µä¸‹çš„ptræŒ‡é’ˆå°±æ˜¯æ‰€è°“çš„é‡æŒ‡é’ˆï¼ˆæ‰€ä»¥ç»å¸¸å¯ä»¥çœ‹åˆ°freeä¹‹åï¼Œç½®åŸæŒ‡é’ˆä¸ºNULLï¼‰ã€‚</span><br><span class="line">    &#x2F;&#x2F;      è€Œè‡³äºfree(ptr)è¿˜ä¸ä¼šåšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚ä¼šä¸ä¼šé‡æ–°åˆå§‹åŒ–è¿™å—å†…å­˜ä¸º0ï¼ˆæ“¦å†™æ‰ï¼‰ï¼Œä»¥åŠæ€ä¹ˆæ“¦å†™ï¼Œè¿™äº›æ“ä½œï¼Œæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½è·Ÿå…·ä½“çš„ç¼–è¯‘å™¨æœ‰å…³ï¼ˆä¸ªäººçŒœæµ‹ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F;      ç»è¿‡æµ‹è¯•ï¼Œå¯¹äºgccç¼–è¯‘å™¨ï¼Œfree(ptr)ä¹‹åï¼Œpträ¸­çš„éæŒ‡é’ˆå˜é‡çš„åœ°å€ä¸å˜ï¼Œä½†å…¶å€¼å…¨éƒ¨æ“¦å†™ä¸º0ï¼›pträ¸­çš„æŒ‡é’ˆå˜é‡ï¼Œä¸æ¯«ä¸å—å½±å“ï¼ŒæŒ‡é’ˆå˜é‡æœ¬èº«æ²¡æœ‰è¢«æ“¦å†™ï¼Œ</span><br><span class="line">    &#x2F;&#x2F;      å­˜å‚¨çš„åœ°å€è¿˜æ˜¯æŒ‡å‘å…ˆå‰åˆ†é…çš„å†…å­˜å—ï¼Œæ‰€ä»¥ptrèƒ½å¤Ÿæ­£å¸¸è®¿é—®å…¶æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å€¼ã€‚æµ‹è¯•ä»£ç ä¸ºdarknet_test_struct_memory_free.cã€‚</span><br><span class="line">    &#x2F;&#x2F;      ä¸çŸ¥é“è¿™æ®µæµ‹è¯•ä»£ç åœ¨VSä¸­æ‰§è¡Œä¼šæ€æ ·ï¼Œè¿˜æ²¡ç»è¿‡æµ‹è¯•ï¼Œä¹Ÿä¸çŸ¥é“æ¢ç”¨å…¶ä»–ç¼–è¯‘å™¨ï¼ˆdarknetçš„Makefileæ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šäº†ç¼–è¯‘å™¨ä¸ºgccï¼‰ï¼Œdarknetçš„ç¼–è¯‘ä¼šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼Ÿ</span><br><span class="line">    &#x2F;&#x2F;      å…³äºfree()ï¼Œå¯ä»¥çœ‹çœ‹ï¼šhttp:&#x2F;&#x2F;blog.sina.com.cn&#x2F;s&#x2F;blog_615ec1630102uwle.htmlï¼Œæ–‡ç« æœ€åæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ¯”å–»ï¼Œä½†æ„æ€å¥½åƒå°±å’Œæˆ‘è¿™é‡Œè¯´çš„æœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼ˆåˆ°åº•æ˜¯ä¸æ˜¯ç¼–è¯‘å™¨æå¾—é¬¼å‘¢ï¼Ÿï¼Ÿï¼‰ã€‚</span><br><span class="line">    free(ptr);</span><br><span class="line">	&#x2F;&#x2F; æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šè¯»å…¥ä¸€ä¸ªdataï¼Œå®šä¹‰å¹¶åˆ†é…args.threadä¸ªdataçš„å†…å­˜</span><br><span class="line">    data* buffers &#x3D; (data*)xcalloc(args.threads, sizeof(data));</span><br><span class="line">    pthread_t* threads &#x3D; (pthread_t*)xcalloc(args.threads, sizeof(pthread_t));</span><br><span class="line">	&#x2F;&#x2F; æ­¤å¤„å®šä¹‰äº†å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹åŠ¨æ€åˆ†é…å†…å­˜</span><br><span class="line">    for(i &#x3D; 0; i &lt; args.threads; ++i)&#123;</span><br><span class="line">		&#x2F;&#x2F; æ­¤å¤„å°±æ‰¿åº”äº†ä¸Šé¢çš„æ³¨é‡Šï¼Œargs.dæŒ‡é’ˆå˜é‡æœ¬èº«å‘ç”Ÿäº†æ”¹åŠ¨ï¼Œä½¿å¾—æœ¬å‡½æ•°çš„args.dä¸outä¸å†æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; æ”¹ä¸ºæŒ‡å‘buffersæŒ‡å‘çš„æŸä¸€æ®µå†…å­˜ï¼Œå› ä¸ºä¸‹é¢çš„load_data_in_thread()å‡½æ•°ç»Ÿä¸€äº†ç»“å£ï¼Œéœ€è¦è¾“å…¥ä¸€ä¸ªload_argsç±»å‹å‚æ•°ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; å®é™…æ˜¯æƒ³æŠŠå›¾ç‰‡æ•°æ®è¯»å…¥åˆ°buffers[i]ä¸­ï¼Œåªèƒ½ä»¤args.dä¸buffers[i]æŒ‡å‘åŒä¸€å—å†…å­˜</span><br><span class="line">        args.d &#x3D; buffers + i;</span><br><span class="line">		 &#x2F;&#x2F; ä¸‹é¢è¿™å¥å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çº¿ç¨‹è¯»å…¥çš„æ€»å›¾ç‰‡å¼ æ•°ä¸ºtotalï¼Œéœ€è¦å°†totalå‡åŒ€çš„åˆ†åˆ°å„ä¸ªçº¿ç¨‹ä¸Šï¼Œ</span><br><span class="line">        &#x2F;&#x2F; ä½†å¾ˆå¯èƒ½ä¼šé‡åˆ°totalä¸èƒ½æ•´é™¤çš„args.threadsçš„æƒ…å†µï¼Œæ¯”å¦‚total &#x3D; 61, args.threads &#x3D;8,æ˜¾ç„¶ä¸èƒ½åšåˆ°</span><br><span class="line">        &#x2F;&#x2F; å®Œå…¨å‡åŒ€çš„åˆ†é…ï¼Œä½†åˆè¦ä¿è¯è¯»å…¥å›¾ç‰‡çš„æ€»å¼ æ•°ä¸€å®šç­‰äºtotalï¼Œç”¨ä¸‹é¢çš„è¯­å¥åˆšå¥½åœ¨å°½é‡å‡åŒ€çš„æƒ…å†µä¸‹ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; ä¿è¯æ€»å’Œä¸ºtotalï¼Œæ¯”å¦‚61,é‚£ä¹ˆ8ä¸ªçº¿ç¨‹å„è‡ªè¯»å…¥çš„ç…§ç‰‡å¼ æ•°åˆ†åˆ«ä¸ºï¼š7, 8, 7, 8, 8, 7, 8, 8</span><br><span class="line">        args.n &#x3D; (i+1) * total&#x2F;args.threads - i * total&#x2F;args.threads;</span><br><span class="line">		&#x2F;&#x2F; å¼€å¯çº¿ç¨‹ï¼Œè¯»å…¥æ•°æ®åˆ°args.dä¸­ï¼ˆä¹Ÿå°±è¯»å…¥åˆ°buffers[i]ä¸­ï¼‰</span><br><span class="line">        &#x2F;&#x2F; load_data_in_thread()å‡½æ•°è¿”å›æ‰€å¼€å¯çš„çº¿ç¨‹ï¼Œå¹¶å­˜å‚¨ä¹‹å‰å·²ç»åŠ¨æ€åˆ†é…å†…å­˜ç”¨æ¥å­˜å‚¨æ‰€æœ‰çº¿ç¨‹çš„threadsä¸­ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; æ–¹ä¾¿ä¸‹é¢ä½¿ç”¨pthread_join()å‡½æ•°æ§åˆ¶ç›¸åº”çº¿ç¨‹</span><br><span class="line">        threads[i] &#x3D; load_data_in_thread(args);</span><br><span class="line">    &#125;</span><br><span class="line">    for(i &#x3D; 0; i &lt; args.threads; ++i)&#123;</span><br><span class="line">		&#x2F;&#x2F; ä»¥é˜»å¡çš„æ–¹å¼ç­‰å¾…çº¿ç¨‹threads[i]ç»“æŸï¼šé˜»å¡æ˜¯æŒ‡é˜»å¡å¯åŠ¨è¯¥å­çº¿ç¨‹çš„æ¯çº¿ç¨‹ï¼ˆæ­¤å¤„åº”ä¸ºä¸»çº¿ç¨‹ï¼‰ï¼Œ</span><br><span class="line">        &#x2F;&#x2F; æ˜¯æ¯çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸€ç›´ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œï¼ˆè¯»å®Œæ‰€æœ‰æ•°æ®ï¼‰æ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥</span><br><span class="line">        &#x2F;&#x2F; å…³äºå¤šçº¿ç¨‹çš„ä½¿ç”¨ï¼Œè¿›è¡Œè¿‡ä»£ç æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¯¹åº”ï¼šdarknet_test_pthread_join.c</span><br><span class="line">        pthread_join(threads[i], 0);</span><br><span class="line">    &#125;</span><br><span class="line">	&#x2F;&#x2F; å¤šä¸ªçº¿ç¨‹è¯»å…¥æ‰€æœ‰æ•°æ®ä¹‹åï¼Œåˆ†åˆ«å­˜å‚¨åˆ°buffers[0],buffers[1]...ä¸­ï¼Œæ¥ç€ä½¿ç”¨concat_datas()å‡½æ•°å°†buffersä¸­çš„æ•°æ®å…¨éƒ¨åˆå¹¶æˆä¸€ä¸ªå¤§æ•°ç»„å¾—åˆ°out</span><br><span class="line">    *out &#x3D; concat_datas(buffers, args.threads);</span><br><span class="line">	 &#x2F;&#x2F; ä¹Ÿå°±åªæœ‰outçš„shallowæ•¢ç½®ä¸º0äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºoutæ˜¯æ­¤æ¬¡è¿­ä»£è¯»å…¥çš„æœ€ç»ˆæ•°æ®ï¼Œè¯¥æ•°æ®å‚ä¸è®­ç»ƒï¼ˆç”¨å®Œï¼‰ä¹‹åï¼Œå½“ç„¶å¯ä»¥æ·±å±‚é‡Šæ”¾äº†ï¼Œè€Œæ­¤å‰çš„éƒ½æ˜¯ä¸­é—´å˜é‡ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; è¿˜å¤„äºè¯»å…¥æ•°æ®é˜¶æ®µï¼Œä¸‡ä¸å¯è®¾ç½®shallow&#x3D;0</span><br><span class="line">    out-&gt;shallow &#x3D; 0;</span><br><span class="line">	&#x2F;&#x2F; é‡Šæ”¾buffersï¼Œbuffersä¹Ÿæ˜¯ä¸ªä¸­é—´å˜é‡ï¼Œåˆ‡è®°shallowè®¾ç½®ä¸º1,å¦‚æœè®¾ç½®ä¸º0,é‚£å°±è¿outä¸­çš„æ•°æ®ä¹Ÿæ²¡äº†</span><br><span class="line">    for(i &#x3D; 0; i &lt; args.threads; ++i)&#123;</span><br><span class="line">        buffers[i].shallow &#x3D; 1;</span><br><span class="line">        free_data(buffers[i]);</span><br><span class="line">    &#125;</span><br><span class="line">	&#x2F;&#x2F; æœ€ç»ˆç›´æ¥é‡Šæ”¾buffers,threadsï¼Œæ³¨æ„buffersæ˜¯ä¸€ä¸ªå­˜å‚¨dataçš„ä¸€ç»´æ•°ç»„ï¼Œä¸Šé¢å¾ªç¯ä¸­çš„å†…å­˜é‡Šæ”¾ï¼Œå®é™…æ˜¯é‡Šæ”¾æ¯ä¸€ä¸ªdataçš„éƒ¨åˆ†å†…å­˜</span><br><span class="line">    &#x2F;&#x2F; ï¼ˆè¿™éƒ¨åˆ†å†…å­˜å¯¹dataè€Œè¨€æ˜¯éä¸»è¦å†…å­˜ï¼Œä¸æ˜¯å­˜å‚¨è¯»å…¥æ•°æ®çš„å†…å­˜å—ï¼Œè€Œæ˜¯å­˜å‚¨æŒ‡å‘è¿™äº›å†…å­˜å—çš„æŒ‡é’ˆå˜é‡ï¼Œå¯ä»¥é‡Šæ”¾çš„ï¼‰</span><br><span class="line">    free(buffers);</span><br><span class="line">    free(threads);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="load-data-in-thread-åˆ†é…çº¿ç¨‹"><a href="#load-data-in-thread-åˆ†é…çº¿ç¨‹" class="headerlink" title="load_data_in_thread()åˆ†é…çº¿ç¨‹"></a>load_data_in_thread()åˆ†é…çº¿ç¨‹</h2><p><code>load_data_in_thread()</code>å‡½æ•°ä»ç„¶åœ¨<code>src/data.c</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¯»å…¥ç›¸åº”å›¾ç‰‡æ•°æ®ï¼ˆæ­¤æ—¶args.nä¸å†æ˜¯ä¸€æ¬¡è¿­ä»£è¯»å…¥çš„æ‰€æœ‰å›¾ç‰‡çš„å¼ æ•°ï¼Œè€Œæ˜¯ç»è¿‡load_threads()å‡åŒ€åˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹çš„å›¾ç‰‡å¼ æ•°ï¼‰</span><br><span class="line">** è¾“å…¥ï¼šargs    åŒ…å«è¯¥çº¿ç¨‹è¦è¯»å…¥å›¾ç‰‡æ•°æ®çš„ä¿¡æ¯ï¼ˆè¯»å…¥å¤šå°‘å¼ ï¼Œè¯»å…¥å›¾ç‰‡æœ€ç»ˆçš„å®½é«˜ï¼Œå›¾ç‰‡è·¯å¾„ç­‰ç­‰ï¼‰</span><br><span class="line">** è¿”å›ï¼šphtread_t   çº¿ç¨‹id</span><br><span class="line">** è¯´æ˜ï¼šæœ¬å‡½æ•°å®é™…æ²¡æœ‰åšä»€ä¹ˆï¼Œå°±æ˜¯æ·±æ‹·è´äº†argsç»™ptr,ç„¶ååˆ›å»ºäº†ä¸€ä¸ªè°ƒç”¨load_thread()å‡½æ•°çš„çº¿ç¨‹å¹¶è¿”å›çº¿ç¨‹id</span><br><span class="line">*&#x2F;</span><br><span class="line">pthread_t load_data_in_thread(load_args args)</span><br><span class="line">&#123;</span><br><span class="line">    pthread_t thread;</span><br><span class="line">	&#x2F;&#x2F; åŒæ ·ç¬¬ä¸€ä»¶äº‹æ·±æ‹·è´äº†argsç»™ptr</span><br><span class="line">    struct load_args* ptr &#x3D; (load_args*)xcalloc(1, sizeof(struct load_args));</span><br><span class="line">    *ptr &#x3D; args;</span><br><span class="line">	&#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¯»å…¥ç›¸åº”æ•°æ®ï¼Œç»‘å®šload_thread()å‡½æ•°åˆ°è¯¥çº¿ç¨‹ä¸Šï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯load_thread()çš„è¾“å…¥å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºçº¿ç¨‹å±æ€§ï¼Œè®¾ç½®ä¸º0ï¼ˆå³NULLï¼‰</span><br><span class="line">	&#x2F;&#x2F;å½“åˆ›å»ºçº¿ç¨‹æˆåŠŸæ—¶ï¼Œå‡½æ•°è¿”å›0ï¼Œè‹¥ä¸ä¸º0åˆ™è¯´æ˜åˆ›å»ºçº¿ç¨‹å¤±è´¥</span><br><span class="line">    if(pthread_create(&amp;thread, 0, load_thread, ptr)) error(&quot;Thread creation failed&quot;); </span><br><span class="line">    return thread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="load-data-detection-å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡"><a href="#load-data-detection-å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡" class="headerlink" title="load_data_detection()å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡"></a>load_data_detection()å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡</h2><p><code>load_data_detection()</code>å‡½æ•°ä¹Ÿå®šä¹‰åœ¨<code>src/data.c</code>ä¸­ï¼Œå¸¦æ³¨é‡Šçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">** å¯ä»¥å‚è€ƒï¼Œçœ‹ä¸€ä¸‹å¯¹å›¾åƒè¿›è¡Œjitterå¤„ç†çš„å„ç§æ•ˆæœ:</span><br><span class="line">** https:&#x2F;&#x2F;github.com&#x2F;vxy10&#x2F;ImageAugmentation</span><br><span class="line">** ä»æ‰€æœ‰è®­ç»ƒå›¾ç‰‡ä¸­ï¼Œéšæœºè¯»å–nå¼ ï¼Œå¹¶å¯¹è¿™nå¼ å›¾ç‰‡è¿›è¡Œæ•°æ®å¢å¼ºï¼ŒåŒæ—¶çŸ«æ­£å¢å¼ºåçš„æ•°æ®æ ‡ç­¾ä¿¡æ¯ã€‚æœ€ç»ˆå¾—åˆ°çš„å›¾ç‰‡çš„å®½é«˜ä¸ºw,hï¼ˆåŸå§‹è®­ç»ƒé›†ä¸­çš„å›¾ç‰‡å°ºå¯¸ä¸å®šï¼‰ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾ç‰‡å°ºå¯¸ï¼Œ</span><br><span class="line">** æ•°æ®å¢å¼ºåŒ…æ‹¬ï¼šå¯¹åŸå§‹å›¾ç‰‡è¿›è¡Œå®½é«˜æ–¹å‘ä¸Šçš„æ’å€¼ç¼©æ”¾ï¼ˆä¸¤æ–¹å‘ä¸Šç¼©æ”¾ç³»æ•°ä¸ä¸€å®šç›¸åŒï¼‰ï¼Œä¸‹é¢ç§°ä¹‹ä¸ºç¼©æ”¾æŠ–åŠ¨ï¼›éšæœºæŠ å–æˆ–è€…å¹³ç§»å›¾ç‰‡ï¼ˆä½ç½®æŠ–åŠ¨ï¼‰ï¼›</span><br><span class="line">** åœ¨hsvé¢œè‰²ç©ºé—´å¢åŠ å™ªå£°ï¼ˆé¢œè‰²æŠ–åŠ¨ï¼‰ï¼›å·¦å³æ°´å¹³ç¿»è½¬ï¼Œä¸å«æ—‹è½¬æŠ–åŠ¨ã€‚</span><br><span class="line">** è¾“å…¥ï¼š n         ä¸€ä¸ªçº¿ç¨‹è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼ˆè¯¦è§å‡½æ•°å†…éƒ¨æ³¨é‡Šï¼‰</span><br><span class="line">**       paths     æ‰€æœ‰è®­ç»ƒå›¾ç‰‡æ‰€åœ¨è·¯å¾„é›†åˆï¼Œæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ¯ä¸€è¡Œå¯¹åº”ä¸€å¼ å›¾ç‰‡çš„è·¯å¾„ï¼ˆå°†åœ¨å…¶ä¸­éšæœºå–nä¸ªï¼‰</span><br><span class="line">**       m         pathsçš„è¡Œæ•°ï¼Œä¹Ÿå³è®­ç»ƒå›¾ç‰‡æ€»æ•°</span><br><span class="line">**       w         ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾çš„å®½åº¦ï¼ˆä¹Ÿå°±æ˜¯è¾“å…¥å›¾ç‰‡ç»è¿‡ä¸€ç³»åˆ—æ•°æ®å¢å¼ºã€å˜æ¢ä¹‹åæœ€ç»ˆè¾“å…¥åˆ°ç½‘ç»œçš„å›¾çš„å®½åº¦ï¼‰</span><br><span class="line">**       h         ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾çš„é«˜åº¦ï¼ˆä¹Ÿå°±æ˜¯è¾“å…¥å›¾ç‰‡ç»è¿‡ä¸€ç³»åˆ—æ•°æ®å¢å¼ºã€å˜æ¢ä¹‹åæœ€ç»ˆè¾“å…¥åˆ°ç½‘ç»œçš„å›¾çš„é«˜åº¦ï¼‰</span><br><span class="line">**       c         ç”¨æ¥æŒ‡å®šè®­ç»ƒå›¾ç‰‡çš„é€šé“æ•°ï¼ˆé»˜è®¤ä¸º3ï¼Œå³RGBå›¾ï¼‰</span><br><span class="line">**       boxes     æ¯å¼ è®­ç»ƒå›¾ç‰‡æœ€å¤§å¤„ç†çš„çŸ©å½¢æ¡†æ•°ï¼ˆå›¾ç‰‡å†…å¯èƒ½å«æœ‰æ›´å¤šçš„ç‰©ä½“ï¼Œå³æ›´å¤šçš„çŸ©å½¢æ¡†ï¼Œé‚£ä¹ˆå°±åœ¨å…¶ä¸­éšæœºé€‰æ‹©boxesä¸ªå‚ä¸è®­ç»ƒï¼Œå…·ä½“æ‰§è¡Œåœ¨fill_truth_detection()å‡½æ•°ä¸­ï¼‰</span><br><span class="line">**       classes   ç±»åˆ«æ€»æ•°ï¼Œæœ¬å‡½æ•°å¹¶æœªç”¨åˆ°ï¼ˆfill_truth_detectionå‡½æ•°å…¶å®å¹¶æ²¡æœ‰ç”¨è¿™ä¸ªå‚æ•°ï¼‰</span><br><span class="line">**       use_flip  æ˜¯å¦ä½¿ç”¨æ°´å¹³ç¿»è½¬</span><br><span class="line">**       use_mixup æ˜¯å¦ä½¿ç”¨mixupæ•°æ®å¢å¼º</span><br><span class="line">**       jitter    è¿™ä¸ªå‚æ•°ä¸ºç¼©æ”¾æŠ–åŠ¨ç³»æ•°ï¼Œå°±æ˜¯å›¾ç‰‡ç¼©æ”¾æŠ–åŠ¨çš„å‰§çƒˆç¨‹åº¦ï¼Œè¶Šå¤§ï¼Œå…è®¸çš„æŠ–åŠ¨èŒƒå›´è¶Šå¤§ï¼ˆæ‰€è°“ç¼©æ”¾æŠ–åŠ¨ï¼Œå°±æ˜¯åœ¨å®½é«˜ä¸Šæ’å€¼ç¼©æ”¾å›¾ç‰‡ï¼Œå®½é«˜ä¸¤æ–¹å‘ä¸Šç¼©æ”¾çš„ç³»æ•°ä¸ä¸€å®šç›¸åŒï¼‰</span><br><span class="line">**       hue       é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šè‰²è°ƒï¼ˆå–å€¼0åº¦åˆ°360åº¦ï¼‰åå·®æœ€å¤§å€¼ï¼Œå®é™…è‰²è°ƒåå·®ä¸º-hue~hueä¹‹é—´çš„éšæœºå€¼</span><br><span class="line">**       saturation é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šè‰²å½©é¥±å’Œåº¦ï¼ˆå–å€¼èŒƒå›´0~1ï¼‰ç¼©æ”¾æœ€å¤§å€¼ï¼Œå®é™…ä¸ºèŒƒå›´å†…çš„éšæœºå€¼</span><br><span class="line">**       exposure  é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šæ˜åº¦ï¼ˆè‰²å½©æ˜äº®ç¨‹åº¦ï¼Œ0~1ï¼‰ç¼©æ”¾æœ€å¤§å€¼ï¼Œå®é™…ä¸ºèŒƒå›´å†…çš„éšæœºå€¼</span><br><span class="line">**       mini_batch      å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span><br><span class="line">**       track           å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span><br><span class="line">**       augment_speed   å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span><br><span class="line">**       letter_box æ˜¯å¦è¿›è¡Œletter_boxå˜æ¢</span><br><span class="line">**       show_imgs</span><br><span class="line">** è¿”å›ï¼šdataç±»å‹æ•°æ®ï¼ŒåŒ…å«ä¸€ä¸ªçº¿ç¨‹è¯»å…¥çš„æ‰€æœ‰å›¾ç‰‡æ•°æ®ï¼ˆå«æœ‰nå¼ å›¾ç‰‡ï¼‰</span><br><span class="line">** è¯´æ˜ï¼šæœ€åå››ä¸ªå‚æ•°ç”¨äºæ•°æ®å¢å¼ºï¼Œä¸»è¦å¯¹åŸå›¾è¿›è¡Œç¼©æ”¾æŠ–åŠ¨ï¼Œä½ç½®æŠ–åŠ¨ï¼ˆå¹³ç§»ï¼‰ä»¥åŠé¢œè‰²æŠ–åŠ¨ï¼ˆé¢œè‰²å€¼å¢åŠ ä¸€å®šå™ªå£°ï¼‰ï¼ŒæŠ–åŠ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç†è§£æˆå¯¹å›¾åƒå¢åŠ å™ªå£°ã€‚</span><br><span class="line">**       é€šè¿‡å¯¹åŸå§‹å›¾åƒè¿›è¡ŒæŠ–åŠ¨ï¼Œå®ç°æ•°æ®å¢å¼ºã€‚æœ€åä¸‰ä¸ªå‚æ•°å…·ä½“ç”¨æ³•å‚è€ƒæœ¬å‡½æ•°å†…è°ƒç”¨çš„random_distort_image()å‡½æ•°</span><br><span class="line">** è¯´æ˜2ï¼šä»æ­¤å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œdarknetå¯¹è®­ç»ƒé›†ä¸­å›¾ç‰‡çš„å°ºå¯¸æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥æ˜¯ä»»æ„å°ºå¯¸çš„å›¾ç‰‡ï¼Œå› ä¸ºç»è¯¥å‡½æ•°å¤„ç†ï¼ˆç¼©æ”¾&#x2F;è£å‰ªï¼‰ä¹‹åï¼Œ</span><br><span class="line">**       ä¸ç®¡æ˜¯ä»€ä¹ˆå°ºå¯¸çš„ç…§ç‰‡ï¼Œéƒ½ä¼šç»Ÿä¸€ä¸ºç½‘ç»œè®­ç»ƒä½¿ç”¨çš„å°ºå¯¸</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">data load_data_detection(int n, char **paths, int m, int w, int h, int c, int boxes, int classes, int use_flip, int use_blur, int use_mixup, float jitter,</span><br><span class="line">    float hue, float saturation, float exposure, int mini_batch, int track, int augment_speed, int letter_box, int show_imgs)</span><br><span class="line">&#123;</span><br><span class="line">    const int random_index &#x3D; random_gen();</span><br><span class="line">    c &#x3D; c ? c : 3;</span><br><span class="line">    char **random_paths;</span><br><span class="line">    char **mixup_random_paths &#x3D; NULL;</span><br><span class="line">	&#x2F;&#x2F; pathsåŒ…å«æ‰€æœ‰è®­ç»ƒå›¾ç‰‡çš„è·¯å¾„ï¼Œget_random_pathså‡½æ•°ä»ä¸­éšæœºæå‡ºnæ¡ï¼Œå³ä¸ºæ­¤æ¬¡è¯»å…¥çš„nå¼ å›¾ç‰‡çš„è·¯å¾„</span><br><span class="line">    if(track) random_paths &#x3D; get_sequential_paths(paths, n, m, mini_batch, augment_speed);</span><br><span class="line">    else random_paths &#x3D; get_random_paths(paths, n, m);</span><br><span class="line"></span><br><span class="line">    assert(use_mixup &lt; 2);</span><br><span class="line">    int mixup &#x3D; use_mixup ? random_gen() % 2 : 0;</span><br><span class="line">    &#x2F;&#x2F;printf(&quot;\n mixup &#x3D; %d \n&quot;, mixup);</span><br><span class="line">	&#x2F;&#x2F; å¦‚æœä½¿ç”¨mixupç­–ç•¥ï¼Œéœ€è¦å†éšæœºå–å‡ºnæ¡æ•°æ®ï¼Œå³nå¼ å›¾ç‰‡</span><br><span class="line">    if (mixup) &#123;</span><br><span class="line">        if (track) mixup_random_paths &#x3D; get_sequential_paths(paths, n, m, mini_batch, augment_speed);</span><br><span class="line">        else mixup_random_paths &#x3D; get_random_paths(paths, n, m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int i;</span><br><span class="line">	&#x2F;&#x2F; åˆå§‹åŒ–ä¸º0,æ¸…ç©ºå†…å­˜ä¸­ä¹‹å‰çš„æ—§å€¼</span><br><span class="line">    data d &#x3D; &#123; 0 &#125;;</span><br><span class="line">    d.shallow &#x3D; 0;</span><br><span class="line">	&#x2F;&#x2F; ä¸€æ¬¡è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼šd.Xä¸­æ¯è¡Œå°±æ˜¯ä¸€å¼ å›¾ç‰‡çš„æ•°æ®ï¼Œå› æ­¤d.X.colsç­‰äºh*w*3</span><br><span class="line">    &#x2F;&#x2F; n &#x3D; net.batch * net.subdivisions * ngpus</span><br><span class="line">    &#x2F;&#x2F; ä»parse_net_option()å‡½æ•°å¯çŸ¥ï¼Œnet.batch &#x3D; net.batch &#x2F; net.subdivision</span><br><span class="line">    &#x2F;&#x2F; net.batch * net.subdivisionså°±å¾—åˆ°äº†åœ¨ç½‘ç»œé…ç½®æ–‡ä»¶ä¸­è®¾å®šçš„batchå€¼ï¼Œå³ç½‘ç»œé…ç½®æ–‡ä»¶.cfgä¸­è®¾ç½®çš„æ¯ä¸ªbatchçš„å›¾ç‰‡æ•°é‡, ç„¶åä¹˜ä»¥ngpusï¼Œæ˜¯è€ƒè™‘å¤šä¸ªGPUå®ç°æ•°æ®å¹¶è¡Œï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ä¸€æ¬¡è¯»å…¥å¤šä¸ªbatchçš„æ•°æ®ï¼Œåˆ†é…åˆ°ä¸åŒGPUä¸Šè¿›è¡Œè®­ç»ƒã€‚åœ¨load_threads()å‡½æ•°ä¸­ï¼Œåˆå°†æ•´ä¸ªçš„nä»…å¯èƒ½å‡åŒ€çš„åˆ’åˆ†åˆ°æ¯ä¸ªçº¿ç¨‹ä¸Šï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ä¹Ÿå°±æ˜¯æ€»çš„è¯»å…¥å›¾ç‰‡å¼ æ•°ä¸ºn &#x3D; net.batch * net.subdivisions * ngpusï¼Œä½†è¿™äº›å›¾ç‰‡ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹è¯»å®Œçš„ï¼Œè€Œæ˜¯åˆ†é…åˆ°å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¯»å…¥ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; å› æ­¤æœ¬å‡½æ•°ä¸­çš„nå®é™…ä¸æ˜¯æ€»çš„nï¼Œè€Œæ˜¯åˆ†é…åˆ°è¯¥çº¿ç¨‹ä¸Šçš„nï¼Œæ¯”å¦‚æ€»å…±è¦è¯»å…¥128å¼ å›¾ç‰‡ï¼Œå…±å¼€å¯8ä¸ªçº¿ç¨‹è¯»æ•°æ®ï¼Œé‚£ä¹ˆæœ¬å‡½æ•°ä¸­çš„nä¸º16,è€Œä¸æ˜¯æ€»æ•°128</span><br><span class="line">    d.X.rows &#x3D; n;</span><br><span class="line">	&#x2F;&#x2F;d.Xä¸ºä¸€ä¸ªmatrixç±»å‹æ•°æ®ï¼Œå…¶ä¸­d.X.valsæ˜¯å…¶å…·ä½“æ•°æ®ï¼Œæ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆï¼ˆå³ä¸ºäºŒç»´æ•°ç»„ï¼‰ï¼Œæ­¤å¤„å…ˆä¸ºç¬¬ä¸€ç»´åŠ¨æ€åˆ†é…å†…å­˜</span><br><span class="line">    d.X.vals &#x3D; (float**)xcalloc(d.X.rows, sizeof(float*));</span><br><span class="line">    d.X.cols &#x3D; h*w*c;</span><br><span class="line"></span><br><span class="line">    float r1 &#x3D; 0, r2 &#x3D; 0, r3 &#x3D; 0, r4 &#x3D; 0, r_scale;</span><br><span class="line">    float dhue &#x3D; 0, dsat &#x3D; 0, dexp &#x3D; 0, flip &#x3D; 0;</span><br><span class="line">    int augmentation_calculated &#x3D; 0;</span><br><span class="line">	&#x2F;&#x2F; d.yå­˜å‚¨äº†æ‰€æœ‰è¯»å…¥ç…§ç‰‡çš„æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯æ¡æ ‡ç­¾åŒ…å«5æ¡ä¿¡æ¯ï¼šç±»åˆ«ï¼Œä»¥åŠçŸ©å½¢æ¡†çš„x,y,w,h</span><br><span class="line">    &#x2F;&#x2F; boxesä¸ºä¸€å¼ å›¾ç‰‡æœ€å¤šèƒ½å¤Ÿå¤„ç†ï¼ˆå‚ä¸è®­ç»ƒï¼‰çš„çŸ©å½¢æ¡†çš„æ•°ï¼ˆå¦‚æœå›¾ç‰‡ä¸­çš„çŸ©å½¢æ¡†æ•°å¤šäºè¿™ä¸ªæ•°ï¼Œé‚£ä¹ˆéšæœºæŒ‘é€‰boxesä¸ªï¼Œè¿™ä¸ªå‚æ•°ä»…åœ¨parse_regionä»¥åŠparse_detectionä¸­å‡ºç°</span><br><span class="line">    &#x2F;&#x2F; åœ¨å…¶ä»–ç½‘ç»œè§£æå‡½æ•°ä¸­å¹¶æ²¡æœ‰å‡ºç°ã€‚åŒæ ·ï¼Œd.yæ˜¯ä¸€ä¸ªmatrixï¼Œmake_matrixä¼šæŒ‡å®šyçš„è¡Œæ•°å’Œåˆ—æ•°ï¼ŒåŒæ—¶ä¼šä¸ºå…¶ç¬¬ä¸€ç»´åŠ¨æ€åˆ†é…å†…å­˜</span><br><span class="line">    d.y &#x3D; make_matrix(n, 5 * boxes);</span><br><span class="line">    int i_mixup &#x3D; 0;</span><br><span class="line">    for (i_mixup &#x3D; 0; i_mixup &lt;&#x3D; mixup; i_mixup++) &#123;</span><br><span class="line">        if (i_mixup) augmentation_calculated &#x3D; 0;</span><br><span class="line">        for (i &#x3D; 0; i &lt; n; ++i) &#123;</span><br><span class="line">			</span><br><span class="line">            float *truth &#x3D; (float*)xcalloc(5 * boxes, sizeof(float));</span><br><span class="line">            char *filename &#x3D; (i_mixup) ? mixup_random_paths[i] : random_paths[i];</span><br><span class="line">			&#x2F;&#x2F;è¯»å…¥åŸå§‹çš„å›¾ç‰‡</span><br><span class="line">            image orig &#x3D; load_image(filename, 0, 0, c);</span><br><span class="line">			&#x2F;&#x2F; åŸå§‹å›¾åƒé•¿å®½</span><br><span class="line">            int oh &#x3D; orig.h;</span><br><span class="line">            int ow &#x3D; orig.w;</span><br><span class="line">			&#x2F;&#x2F; ç¼©æ”¾æŠ–åŠ¨å¤§å°ï¼šç¼©æ”¾æŠ–åŠ¨ç³»æ•°ä¹˜ä»¥åŸå§‹å›¾å®½é«˜å³å¾—åƒç´ å•ä½æ„ä¹‰ä¸Šçš„ç¼©æ”¾æŠ–åŠ¨</span><br><span class="line">            int dw &#x3D; (ow*jitter);</span><br><span class="line">            int dh &#x3D; (oh*jitter);</span><br><span class="line"></span><br><span class="line">            if (!augmentation_calculated || !track)</span><br><span class="line">            &#123;</span><br><span class="line">                augmentation_calculated &#x3D; 1;</span><br><span class="line">                r1 &#x3D; random_float();</span><br><span class="line">                r2 &#x3D; random_float();</span><br><span class="line">                r3 &#x3D; random_float();</span><br><span class="line">                r4 &#x3D; random_float();</span><br><span class="line"></span><br><span class="line">                r_scale &#x3D; random_float();</span><br><span class="line"></span><br><span class="line">                dhue &#x3D; rand_uniform_strong(-hue, hue);</span><br><span class="line">                dsat &#x3D; rand_scale(saturation);</span><br><span class="line">                dexp &#x3D; rand_scale(exposure);</span><br><span class="line"></span><br><span class="line">                flip &#x3D; use_flip ? random_gen() % 2 : 0;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            int pleft &#x3D; rand_precalc_random(-dw, dw, r1);</span><br><span class="line">            int pright &#x3D; rand_precalc_random(-dw, dw, r2);</span><br><span class="line">            int ptop &#x3D; rand_precalc_random(-dh, dh, r3);</span><br><span class="line">            int pbot &#x3D; rand_precalc_random(-dh, dh, r4);</span><br><span class="line">			&#x2F;&#x2F; è¿™ä¸ªç³»æ•°æ²¡ç”¨åˆ°</span><br><span class="line">            float scale &#x3D; rand_precalc_random(.25, 2, r_scale); &#x2F;&#x2F; unused currently</span><br><span class="line"></span><br><span class="line">            if (letter_box)</span><br><span class="line">            &#123;</span><br><span class="line">                float img_ar &#x3D; (float)ow &#x2F; (float)oh; &#x2F;&#x2F;åŸå§‹å›¾åƒå®½é«˜æ¯”</span><br><span class="line">                float net_ar &#x3D; (float)w &#x2F; (float)h; &#x2F;&#x2F;è¾“å…¥åˆ°ç½‘ç»œè¦æ±‚çš„å›¾åƒå®½é«˜æ¯”</span><br><span class="line">                float result_ar &#x3D; img_ar &#x2F; net_ar; &#x2F;&#x2F;ä¸¤è€…æ±‚æ¯”å€¼æ¥åˆ¤æ–­å¦‚ä½•è¿›è¡Œletter_boxç¼©æ”¾</span><br><span class="line">                &#x2F;&#x2F;printf(&quot; ow &#x3D; %d, oh &#x3D; %d, w &#x3D; %d, h &#x3D; %d, img_ar &#x3D; %f, net_ar &#x3D; %f, result_ar &#x3D; %f \n&quot;, ow, oh, w, h, img_ar, net_ar, result_ar);</span><br><span class="line">                if (result_ar &gt; 1)  &#x2F;&#x2F; sheight - should be increased</span><br><span class="line">                &#123;</span><br><span class="line">                    float oh_tmp &#x3D; ow &#x2F; net_ar;</span><br><span class="line">                    float delta_h &#x3D; (oh_tmp - oh) &#x2F; 2;</span><br><span class="line">                    ptop &#x3D; ptop - delta_h;</span><br><span class="line">                    pbot &#x3D; pbot - delta_h;</span><br><span class="line">                    &#x2F;&#x2F;printf(&quot; result_ar &#x3D; %f, oh_tmp &#x3D; %f, delta_h &#x3D; %d, ptop &#x3D; %f, pbot &#x3D; %f \n&quot;, result_ar, oh_tmp, delta_h, ptop, pbot);</span><br><span class="line">                &#125;</span><br><span class="line">                else  &#x2F;&#x2F; swidth - should be increased</span><br><span class="line">                &#123;</span><br><span class="line">                    float ow_tmp &#x3D; oh * net_ar;</span><br><span class="line">                    float delta_w &#x3D; (ow_tmp - ow) &#x2F; 2;</span><br><span class="line">                    pleft &#x3D; pleft - delta_w;</span><br><span class="line">                    pright &#x3D; pright - delta_w;</span><br><span class="line">                    &#x2F;&#x2F;printf(&quot; result_ar &#x3D; %f, ow_tmp &#x3D; %f, delta_w &#x3D; %d, pleft &#x3D; %f, pright &#x3D; %f \n&quot;, result_ar, ow_tmp, delta_w, pleft, pright);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			&#x2F;&#x2F; ä»¥ä¸‹æ­¥éª¤å°±æ˜¯æ‰§è¡Œäº†letter_boxå˜æ¢</span><br><span class="line">            int swidth &#x3D; ow - pleft - pright;</span><br><span class="line">            int sheight &#x3D; oh - ptop - pbot;</span><br><span class="line"></span><br><span class="line">            float sx &#x3D; (float)swidth &#x2F; ow;</span><br><span class="line">            float sy &#x3D; (float)sheight &#x2F; oh;</span><br><span class="line"></span><br><span class="line">            image cropped &#x3D; crop_image(orig, pleft, ptop, swidth, sheight);</span><br><span class="line"></span><br><span class="line">            float dx &#x3D; ((float)pleft &#x2F; ow) &#x2F; sx;</span><br><span class="line">            float dy &#x3D; ((float)ptop &#x2F; oh) &#x2F; sy;</span><br><span class="line">			&#x2F;&#x2F; resizeåˆ°æŒ‡å®šå¤§å°</span><br><span class="line">            image sized &#x3D; resize_image(cropped, w, h);</span><br><span class="line">            &#x2F;&#x2F; ç¿»è½¬</span><br><span class="line">			if (flip) flip_image(sized);</span><br><span class="line">			&#x2F;&#x2F;éšæœºå¯¹å›¾åƒjitterï¼ˆåœ¨hsvä¸‰ä¸ªé€šé“ä¸Šæ·»åŠ æ‰°åŠ¨ï¼‰ï¼Œå®ç°æ•°æ®å¢å¼º</span><br><span class="line">            distort_image(sized, dhue, dsat, dexp);</span><br><span class="line">            &#x2F;&#x2F;random_distort_image(sized, hue, saturation, exposure);</span><br><span class="line">			&#x2F;&#x2F; truthåŒ…å«æ‰€æœ‰å›¾åƒçš„æ ‡ç­¾ä¿¡æ¯ï¼ˆåŒ…æ‹¬çœŸå®ç±»åˆ«ä¸ä½ç½®</span><br><span class="line">            &#x2F;&#x2F; å› ä¸ºå¯¹åŸå§‹å›¾ç‰‡è¿›è¡Œäº†æ•°æ®å¢å¼ºï¼Œå…¶ä¸­çš„å¹³ç§»æŠ–åŠ¨åŠ¿å¿…ä¼šæ”¹åŠ¨æ¯ä¸ªç‰©ä½“çš„çŸ©å½¢æ¡†æ ‡ç­¾ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯çŸ©å½¢æ¡†çš„åƒç´ åæ ‡ä¿¡æ¯ï¼‰ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„æ•°æ®å¢å¼ºæ–¹å¼è¿›è¡Œç›¸åº”çŸ«æ­£</span><br><span class="line">            &#x2F;&#x2F; åé¢çš„å‚æ•°å°±æ˜¯ç”¨äºæ•°æ®å¢å¼ºåçš„çŸ©å½¢æ¡†ä¿¡æ¯çŸ«æ­£</span><br><span class="line">            fill_truth_detection(filename, boxes, truth, classes, flip, dx, dy, 1. &#x2F; sx, 1. &#x2F; sy, w, h);</span><br><span class="line"></span><br><span class="line">            if (i_mixup) &#123;</span><br><span class="line">                image old_img &#x3D; sized;</span><br><span class="line">                old_img.data &#x3D; d.X.vals[i];</span><br><span class="line">                &#x2F;&#x2F;show_image(sized, &quot;new&quot;);</span><br><span class="line">                &#x2F;&#x2F;show_image(old_img, &quot;old&quot;);</span><br><span class="line">                &#x2F;&#x2F;wait_until_press_key_cv();</span><br><span class="line">				&#x2F;&#x2F; åšmixupï¼Œæ··åˆç³»æ•°ä¸º0.5</span><br><span class="line">                blend_images(sized, 0.5, old_img, 0.5);</span><br><span class="line">				&#x2F;&#x2F; æ ‡ç­¾ä¹Ÿè¦å¯¹åº”æ”¹å˜</span><br><span class="line">                blend_truth(truth, boxes, d.y.vals[i]);</span><br><span class="line">                free_image(old_img);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            d.X.vals[i] &#x3D; sized.data;</span><br><span class="line">            memcpy(d.y.vals[i], truth, 5 * boxes * sizeof(float));</span><br><span class="line"></span><br><span class="line">            if (show_imgs)&#x2F;&#x2F; &amp;&amp; i_mixup)</span><br><span class="line">            &#123;</span><br><span class="line">                char buff[1000];</span><br><span class="line">                sprintf(buff, &quot;aug_%d_%d_%s_%d&quot;, random_index, i, basecfg(filename), random_gen());</span><br><span class="line"></span><br><span class="line">                int t;</span><br><span class="line">                for (t &#x3D; 0; t &lt; boxes; ++t) &#123;</span><br><span class="line">                    box b &#x3D; float_to_box_stride(d.y.vals[i] + t*(4 + 1), 1);</span><br><span class="line">                    if (!b.x) break;</span><br><span class="line">                    int left &#x3D; (b.x - b.w &#x2F; 2.)*sized.w;</span><br><span class="line">                    int right &#x3D; (b.x + b.w &#x2F; 2.)*sized.w;</span><br><span class="line">                    int top &#x3D; (b.y - b.h &#x2F; 2.)*sized.h;</span><br><span class="line">                    int bot &#x3D; (b.y + b.h &#x2F; 2.)*sized.h;</span><br><span class="line">                    draw_box_width(sized, left, top, right, bot, 1, 150, 100, 50); &#x2F;&#x2F; 3 channels RGB</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                save_image(sized, buff);</span><br><span class="line">                if (show_imgs &#x3D;&#x3D; 1) &#123;</span><br><span class="line">                    show_image(sized, buff);</span><br><span class="line">                    wait_until_press_key_cv();</span><br><span class="line">                &#125;</span><br><span class="line">                printf(&quot;\nYou use flag -show_imgs, so will be saved aug_...jpg images. Press Enter: \n&quot;);</span><br><span class="line">                &#x2F;&#x2F;getchar();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            free_image(orig);</span><br><span class="line">            free_image(cropped);</span><br><span class="line">            free(truth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(random_paths);</span><br><span class="line">    if (mixup_random_paths) free(mixup_random_paths);</span><br><span class="line">    return d;</span><br><span class="line">&#125;</span><br><span class="line">#endif    &#x2F;&#x2F; OPENCV</span><br></pre></td></tr></table></figure>
<h2 id="load-data-args-ä½¿ç”¨æ–¹æ³•"><a href="#load-data-args-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="load_data(args)ä½¿ç”¨æ–¹æ³•"></a>load_data(args)ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨<code>src/detector.c</code>ä¸­çš„çš„<code>train_detector()</code>å‡½æ•°å…±æœ‰<code>3</code>æ¬¡è°ƒç”¨<code>load_data(args)</code>ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸ºè®­ç»ƒé˜¶æ®µåšå¥½æ•°æ®å‡†å¤‡å·¥ä½œï¼Œå……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥åŠ è½½æ•°æ®ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨æ˜¯åœ¨<code>resize</code>æ“ä½œä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œåªæœ‰<code>random</code>å’Œ<code>count</code>åŒæ—¶æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ä¼šåš<code>resize</code>æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´<code>resize</code>åŠ è½½çš„æ•°æ®æ˜¯æœªè¿›è¡Œ<code>resize</code>è¿‡çš„ï¼Œå› æ­¤ï¼Œéœ€è¦è°ƒæ•´<code>args</code>ä¸­çš„å›¾åƒå®½é«˜ä¹‹åå†é‡æ–°è°ƒç”¨<code>load_data(args)</code>åŠ è½½æ•°æ®ã€‚åä¹‹ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œä¹‹å‰åŠ è½½çš„æ•°æ®ä»ç„¶å¯ç”¨ã€‚ç¬¬ä¸‰æ¬¡è°ƒç”¨å°±æ˜¯åœ¨æ•°æ®åŠ è½½å®Œæˆåï¼Œå°†åŠ è½½å¥½çš„æ•°æ®ä¿å­˜èµ·æ¥<code>train=buffer</code>; ç„¶åå¼€å§‹ä¸‹ä¸€æ¬¡çš„åŠ è½½å·¥ä½œã€‚è¿™ä¸€æ¬¡çš„æ•°æ®å°±ä¼šè¿›è¡Œè¿™ä¸€æ¬¡çš„è®­ç»ƒæ“ä½œ(è°ƒç”¨<code>train_network</code>å‡½æ•°)ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetæ•°æ®ç»“æ„è§£æ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="åŸºç¡€æ•°æ®ç»“æ„"><a href="#åŸºç¡€æ•°æ®ç»“æ„" class="headerlink" title=" åŸºç¡€æ•°æ®ç»“æ„"></a><a id="more"></a> åŸºç¡€æ•°æ®ç»“æ„</h2><p>ä¸ºäº†è§£æç½‘ç»œé…ç½®å‚æ•°ï¼ŒDarkNet ä¸­å®šä¹‰äº†ä¸‰ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ç±»å‹ã€‚<code>list</code>ç±»å‹å˜é‡ä¿å­˜æ‰€æœ‰çš„ç½‘ç»œå‚æ•°, <code>section</code>ç±»å‹å˜é‡ä¿å­˜çš„æ˜¯ç½‘ç»œä¸­æ¯ä¸€å±‚çš„ç½‘ç»œç±»å‹å’Œå‚æ•°, å…¶ä¸­çš„å‚æ•°åˆæ˜¯ä½¿ç”¨listç±»å‹æ¥è¡¨ç¤ºã€‚<code>kvp</code>é”®å€¼å¯¹ç±»å‹ç”¨æ¥ä¿å­˜è§£æåçš„å‚æ•°å˜é‡å’Œå‚æ•°å€¼ã€‚</p>
<ul>
<li>listç±»å‹å®šä¹‰åœ¨<code>src/list.h</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹</span><br><span class="line">typedef struct node&#123;</span><br><span class="line">    void *val;</span><br><span class="line">    struct node *next;</span><br><span class="line">    struct node *prev;</span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åŒå‘é“¾è¡¨</span><br><span class="line">typedef struct list&#123;</span><br><span class="line">    int size; &#x2F;&#x2F;listçš„æ‰€æœ‰èŠ‚ç‚¹ä¸ªæ•°</span><br><span class="line">    node *front; &#x2F;&#x2F;listçš„é¦–èŠ‚ç‚¹</span><br><span class="line">    node *back; &#x2F;&#x2F;listçš„æ™®é€šèŠ‚ç‚¹</span><br><span class="line">&#125; list;</span><br></pre></td></tr></table></figure>
<ul>
<li>section ç±»å‹å®šä¹‰åœ¨<code>src/parser.c</code>æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å®šä¹‰section</span><br><span class="line">typedef struct&#123;</span><br><span class="line">    char *type;</span><br><span class="line">    list *options;</span><br><span class="line">&#125;section;</span><br></pre></td></tr></table></figure>
<ul>
<li>kvp é”®å€¼å¯¹ç±»å‹å®šä¹‰åœ¨<code>src/option_list.h</code>æ–‡ä»¶ä¸­ï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; kvp é”®å€¼å¯¹</span><br><span class="line">typedef struct&#123;</span><br><span class="line">    char *key;</span><br><span class="line">    char *val;</span><br><span class="line">    int used;</span><br><span class="line">&#125; kvp;</span><br></pre></td></tr></table></figure>
<p>åœ¨Darknetçš„ç½‘ç»œé…ç½®æ–‡ä»¶(<code>.cfg</code>ç»“å°¾)ä¸­ï¼Œä»¥<code>[</code>å¼€å¤´çš„è¡Œè¢«ç§°ä¸ºä¸€ä¸ªæ®µ(<code>section</code>)ã€‚æ‰€æœ‰çš„ç½‘ç»œé…ç½®å‚æ•°ä¿å­˜åœ¨<code>list</code>ç±»å‹å˜é‡ä¸­ï¼Œ<code>list</code>ä¸­æœ‰å¾ˆå¤šçš„<code>section</code>èŠ‚ç‚¹ï¼Œæ¯ä¸ª<code>section</code>ä¸­åˆæœ‰ä¸€ä¸ªä¿å­˜å±‚å‚æ•°çš„å°<code>list</code>ï¼Œæ•´ä½“ä¸Šå‡ºç°äº†ä¸€ç§å¤§é“¾æŒ‚å°é“¾çš„ç»“æ„ã€‚å¤§é“¾çš„æ¯ä¸ªèŠ‚ç‚¹ä¸º<code>section</code>ï¼Œæ¯ä¸ª<code>section</code>ä¸­åŒ…å«çš„å‚æ•°ä¿å­˜åœ¨å°é“¾ä¸­ï¼Œå°é“¾çš„èŠ‚ç‚¹å€¼çš„æ•°æ®ç±»å‹ä¸ºkvpé”®å€¼å¯¹ï¼Œè¿™é‡Œæœ‰ä¸ªå›¾ç‰‡å¯ä»¥è§£é‡Šè¿™ç§ç»“æ„ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/648.webp" alt></p>
<p>æˆ‘ä»¬æ¥å¤§æ¦‚è§£é‡Šä¸‹è¯¥å‚æ•°ç½‘ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>list</code>ï¼Œå–å<code>sections</code>ï¼Œè®°å½•ä¸€å…±æœ‰å¤šå°‘ä¸ª<code>section</code>ï¼ˆä¸€ä¸ª<code>section</code>å­˜å‚¨äº†æŸä¸€ç½‘ç»œå±‚æ‰€éœ€å‚æ•°ï¼‰ï¼›ç„¶ååˆ›å»ºä¸€ä¸ª<code>node</code>ï¼Œè¯¥<code>node</code>çš„<code>void</code>ç±»å‹çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„<code>section</code>ï¼›è¯¥<code>section</code>çš„<code>char</code>ç±»å‹æŒ‡é’ˆæŒ‡å‘<code>.cfg</code>æ–‡ä»¶ä¸­çš„æŸä¸€è¡Œï¼ˆ<code>line</code>ï¼‰ï¼Œç„¶åå°†è¯¥<code>section</code>çš„<code>list</code>æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„<code>node</code>ï¼Œè¯¥<code>node</code>çš„<code>void</code>æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª<code>kvp</code>ç»“æ„ä½“ï¼Œ<code>kvp</code>ç»“æ„ä½“ä¸­çš„<code>key</code>å°±æ˜¯<code>.cfg</code>æ–‡ä»¶ä¸­çš„å…³é”®å­—ï¼ˆå¦‚ï¼š<code>batchï¼Œsubdivisions</code>ç­‰ï¼‰ï¼Œ<code>val</code>å°±æ˜¯å¯¹åº”çš„å€¼ï¼›å¦‚æ­¤å¾ªç¯å°±å½¢æˆäº†ä¸Šè¿°çš„å‚æ•°ç½‘ç»œå›¾ã€‚</p>
<h2 id="è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­"><a href="#è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­" class="headerlink" title="è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­"></a>è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­</h2><p>è¯»å–é…ç½®æ–‡ä»¶ç”±<code>src/parser.c</code>ä¸­çš„<code>read_cfg()</code>å‡½æ•°å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * è¯»å–ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶ï¼ˆ.cfgæ–‡ä»¶ï¼‰ä¸­çš„é…ç½®æ•°æ®ï¼Œ å°†æ¯ä¸ªç¥ç»ç½‘ç»œå±‚å‚æ•°è¯»å–åˆ°æ¯ä¸ª</span><br><span class="line"> * section ç»“æ„ä½“ (æ¯ä¸ª section æ˜¯ sections çš„ä¸€ä¸ªèŠ‚ç‚¹) ä¸­ï¼Œ è€Œåå…¨éƒ¨æ’å…¥åˆ°</span><br><span class="line"> * list ç»“æ„ä½“ sections ä¸­å¹¶è¿”å›</span><br><span class="line"> *</span><br><span class="line"> * \param: filename    C é£æ ¼å­—ç¬¦æ•°ç»„ï¼Œ ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="line"> *</span><br><span class="line"> * \return: list ç»“æ„ä½“æŒ‡é’ˆï¼ŒåŒ…å«ä»ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶ä¸­è¯»å…¥çš„æ‰€æœ‰ç¥ç»ç½‘ç»œå±‚çš„å‚æ•°</span><br><span class="line"> * æ¯ä¸ª section çš„æ‰€åœ¨è¡Œçš„å¼€å¤´æ˜¯ â€˜[â€™ , â€˜\0â€™ , â€˜#â€™ å’Œ â€˜;â€™ ç¬¦å·å¼€å¤´çš„è¡Œä¸ºæ— æ•ˆè¡Œ, é™¤æ­¤</span><br><span class="line"> *ä¹‹å¤–çš„è¡Œä¸º section å¯¹åº”çš„å‚æ•°è¡Œ. æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªç­‰å¼, ç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼.</span><br><span class="line"></span><br><span class="line"> *å¯ä»¥çœ‹åˆ°, å¦‚æœæŸä¸€è¡Œå¼€å¤´æ˜¯ç¬¦å· â€˜[â€™ , è¯´æ˜è¯»åˆ°äº†ä¸€ä¸ªæ–°çš„ section: current, ç„¶åç¬¬1508è¡Œ</span><br><span class="line"> *list_insert(options, current);&#96; å°†è¯¥æ–°çš„ section ä¿å­˜èµ·æ¥.</span><br><span class="line"></span><br><span class="line"> *åœ¨è¯»å–åˆ°ä¸‹ä¸€ä¸ªå¼€å¤´ç¬¦å·ä¸º â€˜[â€™ çš„è¡Œä¹‹å‰çš„æ‰€æœ‰è¡Œéƒ½æ˜¯è¯¥ section çš„å‚æ•°, åœ¨ç¬¬ 1518 è¡Œ</span><br><span class="line"> *read_option(line, current-&gt;options) å°†è¯»å–åˆ°çš„å‚æ•°ä¿å­˜åœ¨ current å˜é‡çš„ options ä¸­.</span><br><span class="line"> *æ³¨æ„, è¿™é‡Œä¿å­˜åœ¨ options èŠ‚ç‚¹ä¸­çš„æ•°æ®ä¸º kvp é”®å€¼å¯¹ç±»å‹.</span><br><span class="line"></span><br><span class="line"> *å½“ç„¶å¯¹äº kvp ç±»å‹çš„å‚æ•°, éœ€è¦å…ˆå°†æ¯ä¸€è¡Œä¸­å¯¹åº”çš„é”®å’Œå€¼(ç”¨ â€˜&#x3D;â€™ åˆ†å‰²) åˆ†ç¦»å‡ºæ¥, ç„¶åå†</span><br><span class="line"> *æ„é€ ä¸€ä¸ª kvp ç±»å‹çš„å˜é‡ä½œä¸ºèŠ‚ç‚¹å…ƒç´ çš„æ•°æ®.</span><br><span class="line"> *&#x2F;</span><br><span class="line">list *read_cfg(char *filename)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *file &#x3D; fopen(filename, &quot;r&quot;);</span><br><span class="line">	&#x2F;&#x2F;ä¸€ä¸ªsectionè¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œç»“æ„ä¸­çš„ä¸€å±‚</span><br><span class="line">    &#x2F;&#x2F;å› æ­¤ï¼Œä¸€ä¸ªsectionå°†è¯»å–å¹¶å­˜å‚¨æŸä¸€å±‚çš„å‚æ•°ä»¥åŠè¯¥å±‚çš„type</span><br><span class="line">    if(file &#x3D;&#x3D; 0) file_error(filename);</span><br><span class="line">    char *line;</span><br><span class="line">    int nu &#x3D; 0; &#x2F;&#x2F;å½“å‰è¯»å–è¡Œå·</span><br><span class="line">    list *sections &#x3D; make_list(); &#x2F;&#x2F;sectionsåŒ…å«æ‰€æœ‰çš„ç¥ç»ç½‘ç»œå±‚å‚æ•°</span><br><span class="line">    section *current &#x3D; 0;&#x2F;&#x2F;å½“å‰è¯»å–åˆ°æŸä¸€å±‚</span><br><span class="line">    while((line&#x3D;fgetl(file)) !&#x3D; 0)&#123;</span><br><span class="line">        ++ nu;</span><br><span class="line">        strip(line); &#x2F;&#x2F;å»é™¤è¯»å…¥è¡Œä¸­å«æœ‰çš„ç©ºæ ¼ç¬¦</span><br><span class="line">        switch(line[0])&#123;</span><br><span class="line">			 &#x2F;&#x2F; ä»¥ &#39;[&#39; å¼€å¤´çš„è¡Œæ˜¯ä¸€ä¸ªæ–°çš„ section , å…¶å†…å®¹æ˜¯å±‚çš„ type</span><br><span class="line">            &#x2F;&#x2F; æ¯”å¦‚ [net], [maxpool], [convolutional] ...</span><br><span class="line">            case &#39;[&#39;:</span><br><span class="line">                current &#x3D; (section*)xmalloc(sizeof(section));</span><br><span class="line">                list_insert(sections, current);</span><br><span class="line">                current-&gt;options &#x3D; make_list();</span><br><span class="line">                current-&gt;type &#x3D; line;</span><br><span class="line">                break;</span><br><span class="line">            case &#39;\0&#39;: &#x2F;&#x2F;ç©ºè¡Œ</span><br><span class="line">            case &#39;#&#39;: &#x2F;&#x2F;æ³¨é‡Š</span><br><span class="line">            case &#39;;&#39;: &#x2F;&#x2F;ç©ºè¡Œ</span><br><span class="line">                free(line); &#x2F;&#x2F; å¯¹äºä¸Šè¿°ä¸‰ç§æƒ…å†µç›´æ¥é‡Šæ”¾å†…å­˜å³å¯</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">			    &#x2F;&#x2F; å‰©ä¸‹çš„æ‰çœŸæ­£æ˜¯ç½‘ç»œç»“æ„çš„æ•°æ®ï¼Œè°ƒç”¨ read_option() å‡½æ•°è¯»å–</span><br><span class="line">                &#x2F;&#x2F; è¿”å› 0 è¯´æ˜æ–‡ä»¶ä¸­çš„æ•°æ®æ ¼å¼æœ‰é—®é¢˜ï¼Œå°†ä¼šæç¤ºé”™è¯¯</span><br><span class="line">                if(!read_option(line, current-&gt;options))&#123;</span><br><span class="line">                    fprintf(stderr, &quot;Config file error line %d, could parse: %s\n&quot;, nu, line);</span><br><span class="line">                    free(line);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	&#x2F;&#x2F;å…³é—­æ–‡ä»¶</span><br><span class="line">    fclose(file);</span><br><span class="line">    return sections;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é“¾è¡¨çš„æ’å…¥æ“ä½œ"><a href="#é“¾è¡¨çš„æ’å…¥æ“ä½œ" class="headerlink" title="é“¾è¡¨çš„æ’å…¥æ“ä½œ"></a>é“¾è¡¨çš„æ’å…¥æ“ä½œ</h2><p>ä¿å­˜<code>section</code>å’Œæ¯ä¸ªå‚æ•°ç»„æˆçš„é”®å€¼å¯¹æ—¶ä½¿ç”¨çš„æ˜¯<code>list_insert()</code>å‡½æ•°, å‰é¢æåˆ°äº†å‚æ•°ä¿å­˜çš„ç»“æ„å…¶å®æ˜¯å¤§é“¾(èŠ‚ç‚¹ä¸º<code>section</code>)ä¸Šè¾¹æŒ‚ç€å¾ˆå¤šå°é“¾(æ¯ä¸ª<code>section</code>èŠ‚ç‚¹çš„å„ä¸ªå‚æ•°)ã€‚<code>list_insert()</code>å‡½æ•°å®ç°äº†é“¾è¡¨æ’å…¥æ“ä½œï¼Œè¯¥å‡½æ•°å®šä¹‰åœ¨<code>src/list.c</code>æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * ç®€ä»‹: å°† val æŒ‡é’ˆæ’å…¥ list ç»“æ„ä½“ l ä¸­ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯ç”¨ C å®ç°äº† C++ ä¸­çš„</span><br><span class="line"> *         list çš„å…ƒç´ æ’å…¥åŠŸèƒ½</span><br><span class="line"> *</span><br><span class="line"> * å‚æ•°: l    é“¾è¡¨æŒ‡é’ˆ</span><br><span class="line"> *         val  é“¾è¡¨èŠ‚ç‚¹çš„å…ƒç´ å€¼</span><br><span class="line"> *</span><br><span class="line"> * æµç¨‹ï¼šlist ä¸­ä¿å­˜çš„æ˜¯ node æŒ‡é’ˆ. å› æ­¤ï¼Œéœ€è¦ç”¨ node ç»“æ„ä½“å°† val åŒ…è£¹èµ·æ¥åæ‰å¯ä»¥</span><br><span class="line"> *       æ’å…¥ list æŒ‡é’ˆ l ä¸­</span><br><span class="line"> *</span><br><span class="line"> * æ³¨æ„: æ­¤å‡½æ•°ç±»ä¼¼ C++ çš„ insert() æ’å…¥æ–¹å¼ï¼›</span><br><span class="line"> *      è€Œ opion_insert() å‡½æ•°ç±»ä¼¼ C++ map çš„æŒ‰å€¼æ’å…¥æ–¹å¼ï¼Œæ¯”å¦‚ map[key]&#x3D; value</span><br><span class="line"> *</span><br><span class="line"> *      ä¸¤ä¸ªå‡½æ•°æ“ä½œå¯¹è±¡éƒ½æ˜¯ list å˜é‡ï¼Œ åªæ˜¯æ“ä½œæ–¹å¼ç•¥æœ‰ä¸åŒã€‚</span><br><span class="line">*&#x2F;</span><br><span class="line">void list_insert(list *l, void *val)</span><br><span class="line">&#123;</span><br><span class="line">    node* newnode &#x3D; (node*)xmalloc(sizeof(node));</span><br><span class="line">    newnode-&gt;val &#x3D; val;</span><br><span class="line">    newnode-&gt;next &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœ list çš„ back æˆå‘˜ä¸ºç©º(åˆå§‹åŒ–ä¸º 0), è¯´æ˜ l åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰å­˜å…¥æ•°æ®</span><br><span class="line">    &#x2F;&#x2F; å¦å¤–, ä»¤ l çš„ front ä¸º new ï¼ˆæ­¤å front å°†ä¸ä¼šå†å˜ï¼Œé™¤éåˆ é™¤ï¼‰</span><br><span class="line">    if(!l-&gt;back)&#123;</span><br><span class="line">        l-&gt;front &#x3D; newnode;</span><br><span class="line">        newnode-&gt;prev &#x3D; 0;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        l-&gt;back-&gt;next &#x3D; newnode;</span><br><span class="line">        newnode-&gt;prev &#x3D; l-&gt;back;</span><br><span class="line">    &#125;</span><br><span class="line">    l-&gt;back &#x3D; newnode;</span><br><span class="line">    ++l-&gt;size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°, æ’å…¥çš„æ•°æ®éƒ½ä¼šè¢«é‡æ–°åŒ…è£…åœ¨ä¸€ä¸ªæ–°çš„<code>node</code> : å˜é‡<code>new</code>ä¸­ï¼Œç„¶åå†å°†è¿™ä¸ªèŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨ä¸­ã€‚ç½‘ç»œç»“æ„è§£æåˆ°é“¾è¡¨ä¸­åè¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨, å› ä¸ºæƒ³ä½¿ç”¨ä»»æ„ä¸€ä¸ªå‚æ•°éƒ½ä¸å¾—ä¸æ¯æ¬¡å»éå†æ•´ä¸ªé“¾è¡¨, è¿™æ ·å°±ä¼šå¯¼è‡´ç¨‹åºæ•ˆç‡å˜ä½, æ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯å°†å…¶ä¿å­˜åˆ°ä¸€ä¸ªç»“æ„ä½“å˜é‡ä¸­, ä½¿ç”¨çš„æ—¶å€™æŒ‰ç…§æˆå‘˜è¿›è¡Œè®¿é—®ã€‚å¤æ‚åº¦ä»$O(n)-&gt;O(1)$ã€‚</p>
<h2 id="å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“"><a href="#å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“" class="headerlink" title="å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“"></a>å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“</h2><ul>
<li>é¦–å…ˆæ¥çœ‹çœ‹<code>network</code>ç»“æ„ä½“çš„å®šä¹‰ï¼Œåœ¨<code>include/darknet.h</code>ä¸­ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å®šä¹‰networkç»“æ„ä½“</span><br><span class="line">typedef struct network &#123;</span><br><span class="line">    int n; &#x2F;&#x2F;ç½‘ç»œçš„å±‚æ•°ï¼Œè°ƒç”¨make_network(int n)æ—¶èµ‹å€¼</span><br><span class="line">    int batch; &#x2F;&#x2F;ä¸€æ‰¹è®­ç»ƒä¸­çš„å›¾ç‰‡å‚æ•°ï¼Œå’Œsubdivsionså‚æ•°ç›¸å…³</span><br><span class="line">    uint64_t *seen; &#x2F;&#x2F;ç›®å‰å·²ç»è¯»å…¥çš„å›¾ç‰‡å¼ æ•°(ç½‘ç»œå·²ç»å¤„ç†çš„å›¾ç‰‡å¼ æ•°)</span><br><span class="line">    int *t;</span><br><span class="line">    float epoch; &#x2F;&#x2F;åˆ°ç›®å‰ä¸ºæ­¢è®­ç»ƒäº†æ•´ä¸ªæ•°æ®é›†çš„æ¬¡æ•°</span><br><span class="line">    int subdivisions;</span><br><span class="line">    layer *layers; &#x2F;&#x2F;å­˜å‚¨ç½‘ç»œä¸­çš„æ‰€æœ‰å±‚</span><br><span class="line">    float *output;</span><br><span class="line">    learning_rate_policy policy; &#x2F;&#x2F; å­¦ä¹ ç‡ä¸‹é™ç­–ç•¥</span><br><span class="line">    int benchmark_layers;</span><br><span class="line">    &#x2F;&#x2F; æ¢¯åº¦ä¸‹é™æ³•ç›¸å…³å‚æ•°</span><br><span class="line">    float learning_rate; &#x2F;&#x2F;å­¦ä¹ ç‡</span><br><span class="line">    float learning_rate_min; &#x2F;&#x2F;å­¦ä¹ ç‡æœ€å°å€¼</span><br><span class="line">    float learning_rate_max;  &#x2F;&#x2F;å­¦ä¹ ç‡æœ€å¤§å€¼</span><br><span class="line">    int batches_per_cycle; &#x2F;&#x2F;</span><br><span class="line">    int batches_cycle_mult;</span><br><span class="line">    float momentum;</span><br><span class="line">    float decay;</span><br><span class="line">    float gamma;</span><br><span class="line">    float scale;</span><br><span class="line">    float power;</span><br><span class="line">    int time_steps;</span><br><span class="line">    int step;</span><br><span class="line">    int max_batches;</span><br><span class="line">    int num_boxes;</span><br><span class="line">    int train_images_num;</span><br><span class="line">    float *seq_scales;</span><br><span class="line">    float *scales;</span><br><span class="line">    int   *steps;</span><br><span class="line">    int num_steps;</span><br><span class="line">    int burn_in;</span><br><span class="line">    int cudnn_half;</span><br><span class="line">    &#x2F;&#x2F; ADAMä¼˜åŒ–æ–¹æ³•ç›¸å…³ç­–ç•¥</span><br><span class="line">    int adam;</span><br><span class="line">    float B1;</span><br><span class="line">    float B2;</span><br><span class="line">    float eps;</span><br><span class="line"></span><br><span class="line">    int inputs;</span><br><span class="line">    int outputs;</span><br><span class="line">    int truths;</span><br><span class="line">    int notruth;</span><br><span class="line">    int h, w, c;</span><br><span class="line">    int max_crop;</span><br><span class="line">    int min_crop;</span><br><span class="line">    float max_ratio;</span><br><span class="line">    float min_ratio;</span><br><span class="line">    int center;</span><br><span class="line">    int flip; &#x2F;&#x2F; horizontal flip 50% probability augmentaiont for classifier training (default &#x3D; 1)</span><br><span class="line">    int blur;</span><br><span class="line">    int mixup;</span><br><span class="line">    float label_smooth_eps;</span><br><span class="line">    int resize_step;</span><br><span class="line">    int letter_box;</span><br><span class="line">    float angle;</span><br><span class="line">    float aspect;</span><br><span class="line">    float exposure;</span><br><span class="line">    float saturation;</span><br><span class="line">    float hue;</span><br><span class="line">    int random;</span><br><span class="line">    int track;</span><br><span class="line">    int augment_speed;</span><br><span class="line">    int sequential_subdivisions;</span><br><span class="line">    int init_sequential_subdivisions;</span><br><span class="line">    int current_subdivision;</span><br><span class="line">    int try_fix_nan;</span><br><span class="line">    &#x2F;&#x2F;darknet ä¸ºæ¯ä¸ª GPU ç»´æŠ¤ä¸€ä¸ªç›¸åŒçš„ network, æ¯ä¸ª network ä»¥ gpu_index åŒºåˆ†</span><br><span class="line">    int gpu_index;</span><br><span class="line">    tree *hierarchy;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;ä¸­é—´å˜é‡ï¼Œç”¨æ¥æš‚å­˜æŸå±‚ç½‘ç»œçš„è¾“å…¥ï¼ˆåŒ…å«ä¸€ä¸ª batch çš„è¾“å…¥ï¼Œæ¯”å¦‚æŸå±‚ç½‘ç»œå®Œæˆå‰å‘ï¼Œ</span><br><span class="line">    &#x2F;&#x2F;å°†å…¶è¾“å‡ºèµ‹ç»™è¯¥å˜é‡ï¼Œä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œå¯ä»¥å‚çœ‹ network.c ä¸­çš„forward_network()</span><br><span class="line">    float *input;</span><br><span class="line">	&#x2F;&#x2F; ä¸­é—´å˜é‡ï¼Œä¸ä¸Šé¢çš„ input å¯¹åº”ï¼Œç”¨æ¥æš‚å­˜ input æ•°æ®å¯¹åº”çš„æ ‡ç­¾æ•°æ®ï¼ˆçœŸå®æ•°æ®ï¼‰</span><br><span class="line">    float *truth;</span><br><span class="line">	 &#x2F;&#x2F; ä¸­é—´å˜é‡ï¼Œç”¨æ¥æš‚å­˜æŸå±‚ç½‘ç»œçš„æ•æ„Ÿåº¦å›¾ï¼ˆåå‘ä¼ æ’­å¤„ç†å½“å‰å±‚æ—¶ï¼Œç”¨æ¥å­˜å‚¨ä¸Šä¸€å±‚çš„æ•</span><br><span class="line">    &#x2F;&#x2F;æ„Ÿåº¦å›¾ï¼Œå› ä¸ºå½“å‰å±‚ä¼šè®¡ç®—éƒ¨åˆ†ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå¯ä»¥å‚çœ‹ network.c ä¸­çš„ backward_network() å‡½æ•°ï¼‰</span><br><span class="line">    float *delta;</span><br><span class="line">	&#x2F;&#x2F; ç½‘ç»œçš„å·¥ä½œç©ºé—´, æŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§çš„é‚£ä¸ªå±‚çš„ workspace_size,</span><br><span class="line">    &#x2F;&#x2F; å› ä¸ºå®é™…ä¸Šåœ¨ GPU æˆ– CPU ä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘è¿ç®—</span><br><span class="line">    float *workspace;</span><br><span class="line">	&#x2F;&#x2F; ç½‘ç»œæ˜¯å¦å¤„äºè®­ç»ƒé˜¶æ®µçš„æ ‡å¿—å‚æ•°ï¼Œå¦‚æœæ˜¯åˆ™å€¼ä¸º1. è¿™ä¸ªå‚æ•°ä¸€èˆ¬ç”¨äºè®­ç»ƒä¸æµ‹è¯•é˜¶æ®µæœ‰ä¸</span><br><span class="line">    &#x2F;&#x2F; åŒæ“ä½œçš„æƒ…å†µï¼Œæ¯”å¦‚ dropout å±‚ï¼Œåœ¨è®­ç»ƒé˜¶æ®µæ‰éœ€è¦è¿›è¡Œ forward_dropout_layer()</span><br><span class="line">    &#x2F;&#x2F; å‡½æ•°ï¼Œ æµ‹è¯•é˜¶æ®µåˆ™ä¸éœ€è¦è¿›å…¥åˆ°è¯¥å‡½æ•°</span><br><span class="line">    int train;</span><br><span class="line">	&#x2F;&#x2F; æ ‡å¿—å‚æ•°ï¼Œå½“å‰ç½‘ç»œçš„æ´»è·ƒå±‚</span><br><span class="line">    int index;</span><br><span class="line">	&#x2F;&#x2F;æ¯ä¸€å±‚çš„æŸå¤±ï¼Œåªæœ‰[yolo]å±‚æœ‰å€¼</span><br><span class="line">    float *cost;</span><br><span class="line">    float clip;</span><br><span class="line"></span><br><span class="line">#ifdef GPU</span><br><span class="line">    &#x2F;&#x2F;float *input_gpu;</span><br><span class="line">    &#x2F;&#x2F;float *truth_gpu;</span><br><span class="line">    float *delta_gpu;</span><br><span class="line">    float *output_gpu;</span><br><span class="line"></span><br><span class="line">    float *input_state_gpu;</span><br><span class="line">    float *input_pinned_cpu;</span><br><span class="line">    int input_pinned_cpu_flag;</span><br><span class="line"></span><br><span class="line">    float **input_gpu;</span><br><span class="line">    float **truth_gpu;</span><br><span class="line">    float **input16_gpu;</span><br><span class="line">    float **output16_gpu;</span><br><span class="line">    size_t *max_input16_size;</span><br><span class="line">    size_t *max_output16_size;</span><br><span class="line">    int wait_stream;</span><br><span class="line"></span><br><span class="line">    float *global_delta_gpu;</span><br><span class="line">    float *state_delta_gpu;</span><br><span class="line">    size_t max_delta_gpu_size;</span><br><span class="line">#endif</span><br><span class="line">    int optimized_memory;</span><br><span class="line">    size_t workspace_size_limit;</span><br><span class="line">&#125; network;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸º<code>network</code>ç»“æ„ä½“åˆ†é…å†…å­˜ç©ºé—´ï¼Œå‡½æ•°å®šä¹‰åœ¨<code>src/network.c</code>æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¸ºnetworkç»“æ„ä½“åˆ†é…å†…å­˜ç©ºé—´</span><br><span class="line">network make_network(int n)</span><br><span class="line">&#123;</span><br><span class="line">    network net &#x3D; &#123;0&#125;;</span><br><span class="line">    net.n &#x3D; n;</span><br><span class="line">    net.layers &#x3D; (layer*)xcalloc(net.n, sizeof(layer));</span><br><span class="line">    net.seen &#x3D; (uint64_t*)xcalloc(1, sizeof(uint64_t));</span><br><span class="line">#ifdef GPU</span><br><span class="line">    net.input_gpu &#x3D; (float**)xcalloc(1, sizeof(float*));</span><br><span class="line">    net.truth_gpu &#x3D; (float**)xcalloc(1, sizeof(float*));</span><br><span class="line"></span><br><span class="line">    net.input16_gpu &#x3D; (float**)xcalloc(1, sizeof(float*));</span><br><span class="line">    net.output16_gpu &#x3D; (float**)xcalloc(1, sizeof(float*));</span><br><span class="line">    net.max_input16_size &#x3D; (size_t*)xcalloc(1, sizeof(size_t));</span><br><span class="line">    net.max_output16_size &#x3D; (size_t*)xcalloc(1, sizeof(size_t));</span><br><span class="line">#endif</span><br><span class="line">    return net;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>src/parser.c</code>ä¸­çš„<code>parse_network_cfg()</code>å‡½æ•°ä¸­ï¼Œä»<code>net</code>å˜é‡å¼€å§‹ï¼Œä¾æ¬¡ä¸ºå…¶ä¸­çš„æŒ‡é’ˆå˜é‡åˆ†é…å†…å­˜ã€‚ç”±äºç¬¬ä¸€ä¸ªæ®µ<code>[net]</code>ä¸­å­˜æ”¾çš„æ˜¯å’Œç½‘ç»œå¹¶ä¸ç›´æ¥ç›¸å…³çš„é…ç½®å‚æ•°, å› æ­¤ç½‘ç»œå±‚çš„æ•°ç›®ä¸º<code>sections-&gt;size - 1</code>ï¼Œå³ï¼š<code>network *net = make_network(sections-&gt;size - 1);</code></p>
<ul>
<li><p>å°†é“¾è¡¨ä¸­çš„ç½‘ç»œå‚æ•°è§£æåä¿å­˜åˆ°<code>network</code>ç»“æ„ä½“ï¼Œé…ç½®æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªæ®µä¸€å®šæ˜¯<code>[net]</code>æ®µï¼Œè¯¥æ®µçš„å‚æ•°è§£æç”±<code>parse_net_options()</code>å‡½æ•°å®Œæˆï¼Œå‡½æ•°å®šä¹‰åœ¨<code>src/parser.c</code>ä¸­ã€‚ä¹‹åçš„å„æ®µéƒ½æ˜¯ç½‘ç»œä¸­çš„å±‚ã€‚æ¯”å¦‚å®Œæˆç‰¹å®šç‰¹å¾æå–çš„å·ç§¯å±‚ï¼Œç”¨æ¥é™ä½è®­ç»ƒè¯¯å·®çš„<code>shortcur</code>å±‚å’Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„<code>dropout</code>å±‚ç­‰ã€‚è¿™äº›å±‚éƒ½æœ‰ç‰¹å®šçš„è§£æå‡½æ•°ï¼šæ¯”å¦‚<code>parse_convolutional()</code>, <code>parse_shortcut()</code>å’Œ<code>parse_dropout()</code>ã€‚æ¯ä¸ªè§£æå‡½æ•°è¿”å›ä¸€ä¸ªå¡«å……å¥½çš„å±‚<code>l</code>ï¼Œå°†è¿™äº›å±‚å…¨éƒ¨æ·»åŠ åˆ°<code>network</code>ç»“æ„ä½“çš„<code>layers</code>æ•°ç»„ä¸­ã€‚å³æ˜¯ï¼š<code>net-&gt;layers[count] = l</code>;å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™è¡Œä»£ç ï¼š<code>if (l.workspace_size &gt; workspace_size) workspace_size = l.workspace_size</code>;ï¼Œå…¶ä¸­<code>workspace</code>ä»£è¡¨ç½‘ç»œçš„å·¥ä½œç©ºé—´ï¼ŒæŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§é‚£ä¸ªå±‚çš„<code>workspace</code>ã€‚å› ä¸ºåœ¨CPUæˆ–GPUä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘ä¼ æ’­ã€‚è¾“å‡ºå±‚åªèƒ½åœ¨ç½‘ç»œæ­å»ºå®Œæ¯•ä¹‹åæ‰å¯ä»¥ç¡®å®šï¼Œè¾“å…¥å±‚éœ€è¦è€ƒè™‘<code>batch_size</code>çš„å› ç´ ï¼Œ<code>truth</code>æ˜¯è¾“å…¥æ ‡ç­¾ï¼ŒåŒæ ·éœ€è¦è€ƒè™‘<code>batch_size</code>çš„å› ç´ ã€‚å…·ä½“å±‚çš„å‚æ•°è§£æåé¢ä¸“é—¨å†™ä¸€ç¯‡æ¨æ–‡æ¥å¸®åŠ©ç†è§£ã€‚</p>
</li>
<li><p>åˆ°è¿™é‡Œï¼Œç½‘ç»œçš„å®è§‚è§£æç»“æŸã€‚<code>parse_network_cfg()</code>(<code>src/parser.c</code>ä¸­)å‡½æ•°è¿”å›è§£æå¥½çš„<code>network</code>ç±»å‹çš„æŒ‡é’ˆå˜é‡ã€‚</p>
</li>
</ul>
<h2 id="ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ"></a>ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ</h2><p>è¿™é‡Œå¯èƒ½æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸å°†é…ç½®æ–‡ä»¶è¯»å–å¹¶è§£æåˆ°<code>network</code>ç»“æ„ä½“å˜é‡ä¸­, è€Œè¦ä½¿ç”¨ä¸€ä¸ªä¸­é—´æ•°æ®ç»“æ„æ¥ç¼“å­˜è¯»å–åˆ°çš„æ–‡ä»¶å‘¢ï¼Ÿå› ä¸ºï¼Œå¦‚æœä¸ä½¿ç”¨ä¸­é—´æ•°æ®ç»“æ„æ¥ç¼“å­˜. å°†è¯»å–å’Œè§£ææµç¨‹ä¸²è¡Œè¿›è¡Œçš„è¯, å¦‚æœé…ç½®æ–‡ä»¶è¾ƒä¸ºå¤æ‚,  å°±ä¼šé•¿æ—¶é—´ä½¿æ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ­¤æ—¶ç”¨æˆ·æ›´æ”¹äº†é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›æ¡ç›®,  å°±ä¼šå¯¼è‡´è¯»å–å’Œè§£æè¿‡ç¨‹å‡ºç°é—®é¢˜ã€‚åˆ†å¼€ä¸¤æ­¥è¿›è¡Œå¯ä»¥å…ˆå¿«é€Ÿè¯»å–æ–‡ä»¶ä¿¡æ¯åˆ°å†…å­˜ä¸­ç»„ç»‡å¥½çš„ç»“æ„ä¸­, è¿™æ—¶å°±å¯ä»¥å…³é—­æ–‡ä»¶.  ç„¶åå†æ…¢æ…¢çš„è§£æå‚æ•°ã€‚è¿™ç§æœºåˆ¶ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­æ–­çš„åº•åŠéƒ¨æœºåˆ¶, å…ˆå¤„ç†é‡è¦çš„ä¸­æ–­ä¿¡å·, ç„¶ååœ¨ç³»ç»Ÿè´Ÿè·è¾ƒå°æ—¶å†å¤„ç†ä¸­æ–­ä¿¡å·ä¸­æºå¸¦çš„ä»»åŠ¡ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetæ¡†æ¶æ€»è§ˆ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E6%A1%86%E6%9E%B6%E6%80%BB%E8%A7%88/</url>
    <content><![CDATA[<h2 id="Darknetæ¡†æ¶åˆ†æä¸»çº¿"><a href="#Darknetæ¡†æ¶åˆ†æä¸»çº¿" class="headerlink" title=" Darknetæ¡†æ¶åˆ†æä¸»çº¿"></a><a id="more"></a> Darknetæ¡†æ¶åˆ†æä¸»çº¿</h2><h3 id="åˆ†æä¸»çº¿çš„ç¡®å®š"><a href="#åˆ†æä¸»çº¿çš„ç¡®å®š" class="headerlink" title="åˆ†æä¸»çº¿çš„ç¡®å®š"></a>åˆ†æä¸»çº¿çš„ç¡®å®š</h3><p>Darknetç›¸æ¯”å½“å‰è®­ç»ƒçš„C/C++ä¸»æµæ¡†æ¶ï¼ˆå¦‚Caffeï¼‰æ¥è®²ï¼Œå…·æœ‰ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¾èµ–å°‘ï¼Œæ˜“éƒ¨ç½²ç­‰ä¼—å¤šä¼˜ç‚¹ï¼Œæˆ‘ä»¬å…ˆå®šä½åˆ°<code>src/darknet.c</code>é‡Œé¢çš„<code>main</code>å‡½æ•°ï¼Œè¿™æ˜¯è¿™ä¸ªæ¡†æ¶å®ç°åˆ†ç±»ï¼Œå®šä½ï¼Œå›å½’ï¼Œåˆ†å‰²ç­‰åŠŸèƒ½çš„åˆå§‹å…¥å£ã€‚è¿™ä¸€èŠ‚çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„ä¸€ä¸‹å°±æ˜¯<code>run_yolo</code>åªæä¾›äº†<code>yolo</code>ç›®æ ‡æ£€æµ‹ç®—æ³•çš„åŸå§‹å®ç°ã€‚è€Œ<code>run_detector</code>å‡½æ•°æä¾›äº†AlexeyABæ·»åŠ äº†å„ç§æ–°ç‰¹æ€§çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œæ‰€ä»¥ä¹‹åæˆ‘ä»¬ä¼šä»è¿™ä¸ªå‡½æ•°è·Ÿè¿›å»æ¥è§£æDarknetæ¡†æ¶ã€‚Darknetæä¾›çš„å…¶ä»–åŠŸèƒ½å¦‚<code>run_super</code>ï¼ˆé«˜åˆ†è¾¨ç‡é‡å»ºï¼‰ï¼Œ<code>run_classifier</code>ï¼ˆå›¾åƒåˆ†ç±»ï¼‰ï¼Œ<code>run_char_rnn</code>ï¼ˆRNNæ–‡æœ¬è¯†åˆ«ï¼‰æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»è¯»ï¼ˆè¿™ä¸ªæ¡†æ¶ç”¨æ¥åšç›®æ ‡æ£€æµ‹æ¯”è¾ƒå¥½ï¼Œå…¶ä»–ç®—æ³•å»ºè®®è¿˜æ˜¯å»å…¶å®ƒæ¡†æ¶å®ç°å§ï¼‰ï¼Œæœ¬ç³»åˆ—åªè®²ç›®æ ‡æ£€æµ‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;average&quot;))&#123;</span><br><span class="line">       average(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;yolo&quot;))&#123;</span><br><span class="line">       run_yolo(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;voxel&quot;))&#123;</span><br><span class="line">       run_voxel(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;super&quot;))&#123;</span><br><span class="line">       run_super(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;detector&quot;))&#123;</span><br><span class="line">       run_detector(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;detect&quot;))&#123;</span><br><span class="line">       float thresh &#x3D; find_float_arg(argc, argv, &quot;-thresh&quot;, .24);</span><br><span class="line">	int ext_output &#x3D; find_arg(argc, argv, &quot;-ext_output&quot;);</span><br><span class="line">       char *filename &#x3D; (argc &gt; 4) ? argv[4]: 0;</span><br><span class="line">       test_detector(&quot;cfg&#x2F;coco.data&quot;, argv[2], argv[3], filename, thresh, 0.5, 0, ext_output, 0, NULL, 0, 0);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;cifar&quot;))&#123;</span><br><span class="line">       run_cifar(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;go&quot;))&#123;</span><br><span class="line">       run_go(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;rnn&quot;))&#123;</span><br><span class="line">       run_char_rnn(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;vid&quot;))&#123;</span><br><span class="line">       run_vid_rnn(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;coco&quot;))&#123;</span><br><span class="line">       run_coco(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;classify&quot;))&#123;</span><br><span class="line">       predict_classifier(&quot;cfg&#x2F;imagenet1k.data&quot;, argv[2], argv[3], argv[4], 5);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;classifier&quot;))&#123;</span><br><span class="line">       run_classifier(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;art&quot;))&#123;</span><br><span class="line">       run_art(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;tag&quot;))&#123;</span><br><span class="line">       run_tag(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;compare&quot;))&#123;</span><br><span class="line">       run_compare(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;dice&quot;))&#123;</span><br><span class="line">       run_dice(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;writing&quot;))&#123;</span><br><span class="line">       run_writing(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;3d&quot;))&#123;</span><br><span class="line">       composite_3d(argv[2], argv[3], argv[4], (argc &gt; 5) ? atof(argv[5]) : 0);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;test&quot;))&#123;</span><br><span class="line">       test_resize(argv[2]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;captcha&quot;))&#123;</span><br><span class="line">       run_captcha(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;nightmare&quot;))&#123;</span><br><span class="line">       run_nightmare(argc, argv);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;rgbgr&quot;))&#123;</span><br><span class="line">       rgbgr_net(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;reset&quot;))&#123;</span><br><span class="line">       reset_normalize_net(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;denormalize&quot;))&#123;</span><br><span class="line">       denormalize_net(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;statistics&quot;))&#123;</span><br><span class="line">       statistics_net(argv[2], argv[3]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;normalize&quot;))&#123;</span><br><span class="line">       normalize_net(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;rescale&quot;))&#123;</span><br><span class="line">       rescale_net(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;ops&quot;))&#123;</span><br><span class="line">       operations(argv[2]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;speed&quot;))&#123;</span><br><span class="line">       speed(argv[2], (argc &gt; 3 &amp;&amp; argv[3]) ? atoi(argv[3]) : 0);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;oneoff&quot;))&#123;</span><br><span class="line">       oneoff(argv[2], argv[3], argv[4]);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;partial&quot;))&#123;</span><br><span class="line">       partial(argv[2], argv[3], argv[4], atoi(argv[5]));</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;visualize&quot;))&#123;</span><br><span class="line">       visualize(argv[2], (argc &gt; 3) ? argv[3] : 0);</span><br><span class="line">   &#125; else if (0 &#x3D;&#x3D; strcmp(argv[1], &quot;imtest&quot;))&#123;</span><br><span class="line">       test_resize(argv[2]);</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       fprintf(stderr, &quot;Not an option: %s\n&quot;, argv[1]);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·Ÿè¿›run-detector"><a href="#è·Ÿè¿›run-detector" class="headerlink" title="è·Ÿè¿›run_detector"></a>è·Ÿè¿›run_detector</h3><p><code>run_detector</code>å‡½æ•°åœ¨<code>src/detector.c</code>é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆæœ‰å¾ˆå¤šè¶…å‚æ•°å¯ä»¥è®¾ç½®ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°åŒ…å«äº†è®­ç»ƒéªŒè¯ï¼Œæµ‹è¯•ï¼Œè®¡ç®—Anchorsï¼Œdemoå±•ç¤ºï¼Œè®¡ç®—mapå€¼å’Œrecallå€¼ç­‰åŠŸèƒ½ã€‚ç”±äºè®­ç»ƒï¼Œæµ‹è¯•ï¼ŒéªŒè¯é˜¶æ®µå·®ä¸å¤šï¼Œæˆ‘ä»¬è·Ÿè¿›å»ä¸€ä¸ªçœ‹çœ‹å°±å¥½ï¼Œè‡³äºåé¢é‚£å‡ ä¸ªåŠŸèƒ½æ˜¯AlexeyABæ·»åŠ çš„ï¼Œä¹‹åå†é€ä¸€è§£é‡Šã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void run_detector(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">    int dont_show &#x3D; find_arg(argc, argv, &quot;-dont_show&quot;);&#x2F;&#x2F;å±•ç¤ºå›¾åƒç•Œé¢</span><br><span class="line">    int benchmark &#x3D; find_arg(argc, argv, &quot;-benchmark&quot;);&#x2F;&#x2F;è¯„ä¼°æ¨¡å‹çš„è¡¨ç°</span><br><span class="line">    int benchmark_layers &#x3D; find_arg(argc, argv, &quot;-benchmark_layers&quot;);</span><br><span class="line">    &#x2F;&#x2F;if (benchmark_layers) benchmark &#x3D; 1;</span><br><span class="line">    if (benchmark) dont_show &#x3D; 1;</span><br><span class="line">    int show &#x3D; find_arg(argc, argv, &quot;-show&quot;);</span><br><span class="line">    int letter_box &#x3D; find_arg(argc, argv, &quot;-letter_box&quot;);&#x2F;&#x2F;æ˜¯å¦å¯¹å›¾åƒåšletter-boxå˜æ¢</span><br><span class="line">    int calc_map &#x3D; find_arg(argc, argv, &quot;-map&quot;);&#x2F;&#x2F;æ˜¯å¦è®¡ç®—mapå€¼</span><br><span class="line">    int map_points &#x3D; find_int_arg(argc, argv, &quot;-points&quot;, 0);</span><br><span class="line">    check_mistakes &#x3D; find_arg(argc, argv, &quot;-check_mistakes&quot;);&#x2F;&#x2F;æ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰è¯¯</span><br><span class="line">    int show_imgs &#x3D; find_arg(argc, argv, &quot;-show_imgs&quot;);&#x2F;&#x2F;æ˜¾ç¤ºå›¾ç‰‡</span><br><span class="line">    int mjpeg_port &#x3D; find_int_arg(argc, argv, &quot;-mjpeg_port&quot;, -1);</span><br><span class="line">    int json_port &#x3D; find_int_arg(argc, argv, &quot;-json_port&quot;, -1);</span><br><span class="line">    char *http_post_host &#x3D; find_char_arg(argc, argv, &quot;-http_post_host&quot;, 0);</span><br><span class="line">    int time_limit_sec &#x3D; find_int_arg(argc, argv, &quot;-time_limit_sec&quot;, 0);</span><br><span class="line">    char *out_filename &#x3D; find_char_arg(argc, argv, &quot;-out_filename&quot;, 0);</span><br><span class="line">    char *outfile &#x3D; find_char_arg(argc, argv, &quot;-out&quot;, 0);</span><br><span class="line">    char *prefix &#x3D; find_char_arg(argc, argv, &quot;-prefix&quot;, 0);&#x2F;&#x2F;æ¨¡å‹ä¿å­˜çš„å‰ç¼€</span><br><span class="line">    float thresh &#x3D; find_float_arg(argc, argv, &quot;-thresh&quot;, .25);    &#x2F;&#x2F; ç½®ä¿¡åº¦</span><br><span class="line">    float iou_thresh &#x3D; find_float_arg(argc, argv, &quot;-iou_thresh&quot;, .5);    &#x2F;&#x2F; 0.5 for mAP</span><br><span class="line">    float hier_thresh &#x3D; find_float_arg(argc, argv, &quot;-hier&quot;, .5);</span><br><span class="line">    int cam_index &#x3D; find_int_arg(argc, argv, &quot;-c&quot;, 0);&#x2F;&#x2F;æ‘„åƒå¤´ç¼–å·</span><br><span class="line">    int frame_skip &#x3D; find_int_arg(argc, argv, &quot;-s&quot;, 0);&#x2F;&#x2F;è·³å¸§æ£€æµ‹é—´éš”</span><br><span class="line">    int num_of_clusters &#x3D; find_int_arg(argc, argv, &quot;-num_of_clusters&quot;, 5);</span><br><span class="line">    int width &#x3D; find_int_arg(argc, argv, &quot;-width&quot;, -1);&#x2F;&#x2F; è¾“å…¥ç½‘ç»œçš„å›¾åƒå®½åº¦</span><br><span class="line">    int height &#x3D; find_int_arg(argc, argv, &quot;-height&quot;, -1);&#x2F;&#x2F; è¾“å…¥ç½‘ç»œçš„å›¾åƒé«˜åº¦</span><br><span class="line">    &#x2F;&#x2F; extended output in test mode (output of rect bound coords)</span><br><span class="line">    &#x2F;&#x2F; and for recall mode (extended output table-like format with results for best_class fit)</span><br><span class="line">    int ext_output &#x3D; find_arg(argc, argv, &quot;-ext_output&quot;);</span><br><span class="line">    int save_labels &#x3D; find_arg(argc, argv, &quot;-save_labels&quot;);</span><br><span class="line">    if (argc &lt; 4) &#123;</span><br><span class="line">        fprintf(stderr, &quot;usage: %s %s [train&#x2F;test&#x2F;valid&#x2F;demo&#x2F;map] [data] [cfg] [weights (optional)]\n&quot;, argv[0], argv[1]);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    char *gpu_list &#x3D; find_char_arg(argc, argv, &quot;-gpus&quot;, 0);&#x2F;&#x2F; å¤šä¸ªgpuè®­ç»ƒ</span><br><span class="line">    int *gpus &#x3D; 0;</span><br><span class="line">    int gpu &#x3D; 0;</span><br><span class="line">    int ngpus &#x3D; 0;</span><br><span class="line">    if (gpu_list) &#123;</span><br><span class="line">        printf(&quot;%s\n&quot;, gpu_list);</span><br><span class="line">        int len &#x3D; (int)strlen(gpu_list);</span><br><span class="line">        ngpus &#x3D; 1;</span><br><span class="line">        int i;</span><br><span class="line">        for (i &#x3D; 0; i &lt; len; ++i) &#123;</span><br><span class="line">            if (gpu_list[i] &#x3D;&#x3D; &#39;,&#39;) ++ngpus;</span><br><span class="line">        &#125;</span><br><span class="line">        gpus &#x3D; (int*)xcalloc(ngpus, sizeof(int));</span><br><span class="line">        for (i &#x3D; 0; i &lt; ngpus; ++i) &#123;</span><br><span class="line">            gpus[i] &#x3D; atoi(gpu_list);</span><br><span class="line">            gpu_list &#x3D; strchr(gpu_list, &#39;,&#39;) + 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        gpu &#x3D; gpu_index;</span><br><span class="line">        gpus &#x3D; &amp;gpu;</span><br><span class="line">        ngpus &#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int clear &#x3D; find_arg(argc, argv, &quot;-clear&quot;);</span><br><span class="line"></span><br><span class="line">    char *datacfg &#x3D; argv[3];&#x2F;&#x2F;å­˜å‚¨è®­ç»ƒé›†ï¼ŒéªŒè¯é›†ï¼Œä»¥åŠç±»åˆ«å¯¹åº”åå­—ç­‰ä¿¡æ¯çš„cfgæ–‡ä»¶</span><br><span class="line">    char *cfg &#x3D; argv[4];&#x2F;&#x2F;è¦è®­ç»ƒçš„ç½‘ç»œcfgæ–‡ä»¶</span><br><span class="line">    char *weights &#x3D; (argc &gt; 5) ? argv[5] : 0;&#x2F;&#x2F;æ˜¯å¦æœ‰é¢„è®­ç»ƒæ¨¡å‹</span><br><span class="line">    if (weights)</span><br><span class="line">        if (strlen(weights) &gt; 0)</span><br><span class="line">            if (weights[strlen(weights) - 1] &#x3D;&#x3D; 0x0d) weights[strlen(weights) - 1] &#x3D; 0;</span><br><span class="line">    char *filename &#x3D; (argc &gt; 6) ? argv[6] : 0;</span><br><span class="line">    if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;test&quot;)) test_detector(datacfg, cfg, weights, filename, thresh, hier_thresh, dont_show, ext_output, save_labels, outfile, letter_box, benchmark_layers);&#x2F;&#x2F;æ‰§è¡Œç›®æ ‡æ£€æµ‹æ¨¡å‹æµ‹è¯•</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;train&quot;)) train_detector(datacfg, cfg, weights, gpus, ngpus, clear, dont_show, calc_map, mjpeg_port, show_imgs, benchmark_layers);&#x2F;&#x2F;ç›®æ ‡æ£€æµ‹æ¨¡å‹è®­ç»ƒ</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;valid&quot;)) validate_detector(datacfg, cfg, weights, outfile);&#x2F;&#x2F;ç›®æ ‡æ£€æµ‹æ¨¡å‹éªŒè¯</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;recall&quot;)) validate_detector_recall(datacfg, cfg, weights);&#x2F;&#x2F;&#x2F;è®¡ç®—éªŒè¯é›†çš„å¬å›ç‡</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;map&quot;)) validate_detector_map(datacfg, cfg, weights, thresh, iou_thresh, map_points, letter_box, NULL);&#x2F;&#x2F;è®¡ç®—éªŒè¯é›†çš„mapå€¼</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;calc_anchors&quot;)) calc_anchors(datacfg, num_of_clusters, width, height, show);&#x2F;&#x2F;è®¡ç®—éªŒè¯é›†çš„anchors</span><br><span class="line">    else if (0 &#x3D;&#x3D; strcmp(argv[2], &quot;demo&quot;)) &#123;&#x2F;&#x2F;demoå±•ç¤º</span><br><span class="line">        list *options &#x3D; read_data_cfg(datacfg);</span><br><span class="line">        int classes &#x3D; option_find_int(options, &quot;classes&quot;, 20);</span><br><span class="line">        char *name_list &#x3D; option_find_str(options, &quot;names&quot;, &quot;data&#x2F;names.list&quot;);</span><br><span class="line">        char **names &#x3D; get_labels(name_list);</span><br><span class="line">        if (filename)</span><br><span class="line">            if (strlen(filename) &gt; 0)</span><br><span class="line">                if (filename[strlen(filename) - 1] &#x3D;&#x3D; 0x0d) filename[strlen(filename) - 1] &#x3D; 0;</span><br><span class="line">        demo(cfg, weights, thresh, hier_thresh, cam_index, filename, names, classes, frame_skip, prefix, out_filename,</span><br><span class="line">            mjpeg_port, json_port, dont_show, ext_output, letter_box, time_limit_sec, http_post_host, benchmark, benchmark_layers);</span><br><span class="line"></span><br><span class="line">        free_list_contents_kvp(options);</span><br><span class="line">        free_list(options);</span><br><span class="line">    &#125;</span><br><span class="line">    else printf(&quot; There isn&#39;t such command: %s&quot;, argv[2]);</span><br><span class="line"></span><br><span class="line">    if (gpus &amp;&amp; gpu_list &amp;&amp; ngpus &gt; 1) free(gpus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·Ÿè¿›train-detector"><a href="#è·Ÿè¿›train-detector" class="headerlink" title="è·Ÿè¿›train_detector"></a>è·Ÿè¿›train_detector</h3><p>ç”±äºè®­ç»ƒï¼ŒéªŒè¯å’Œæµ‹è¯•é˜¶æ®µä»£ç å‡ ä¹æ˜¯å·®ä¸å¤šçš„ï¼Œåªä¸è¿‡è®­ç»ƒå¤šäº†ä¸€ä¸ªåå‘ä¼ æ’­çš„è¿‡ç¨‹ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸»è¦åˆ†æä¸€ä¸‹è®­ç»ƒè¿‡ç¨‹ï¼Œè®­ç»ƒè¿‡ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œä¸è¿‡å®è§‚ä¸Šå¤§è‡´åˆ†ä¸ºè§£æç½‘ç»œé…ç½®æ–‡ä»¶ï¼ŒåŠ è½½è®­ç»ƒæ ·æœ¬å›¾åƒå’Œæ ‡ç­¾ï¼Œå¼€å¯è®­ç»ƒï¼Œç»“æŸè®­ç»ƒä¿å­˜æ¨¡å‹è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼ˆæˆ‘çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œå› ä¸ºè¿™ä¸€èŠ‚æ˜¯æ¡†æ¶æ€»è§ˆï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Šçš„ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void train_detector(char *datacfg, char *cfgfile, char *weightfile, int *gpus, int ngpus, int clear, int dont_show, int calc_map, int mjpeg_port, int show_imgs, int benchmark_layers)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; ä»optionsæ‰¾å‡ºè®­ç»ƒå›¾ç‰‡è·¯å¾„ä¿¡æ¯ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œé»˜è®¤ä½¿ç”¨&quot;data&#x2F;train.list&quot;è·¯å¾„ä¸‹çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆtrain.listå«æœ‰æ ‡å‡†çš„ä¿¡æ¯æ ¼å¼ï¼š&lt;object-class&gt; &lt;x&gt; &lt;y&gt; &lt;width&gt; &lt;height&gt;ï¼‰ï¼Œ</span><br><span class="line">    &#x2F;&#x2F; è¯¥æ–‡ä»¶å¯ä»¥ç”±darknetæä¾›çš„scripts&#x2F;voc_label.pyæ ¹æ®è‡ªè¡Œåœ¨ç½‘ä¸Šä¸‹è½½çš„vocæ•°æ®é›†ç”Ÿæˆï¼Œæ‰€ä»¥è¯´æ˜¯é»˜è®¤è·¯å¾„ï¼Œå…¶å®ä¹Ÿéœ€è¦ä½¿ç”¨è€…è‡ªè¡Œè°ƒæ•´ï¼Œä¹Ÿå¯ä»¥ä»»æ„å‘½åï¼Œä¸ä¸€å®šè¦ä¸ºtrain.listï¼Œ</span><br><span class="line">    &#x2F;&#x2F; ç”šè‡³å¯ä»¥ä¸ç”¨voc_label.pyç”Ÿæˆï¼Œå¯ä»¥è‡ªå·±ä¸åŒå…¶çƒ¦çš„åˆ¶ä½œä¸€ä¸ªï¼ˆå½“ç„¶è§„æ¨¡åº”è¯¥æ˜¯å¾ˆå°çš„ï¼Œä¸ç„¶å¤ªç´¯äº†ã€‚ã€‚ã€‚ï¼‰</span><br><span class="line">    &#x2F;&#x2F; è¯»å…¥åï¼Œtrain_imageså°†å«æœ‰è®­ç»ƒå›¾ç‰‡ä¸­æ‰€æœ‰å›¾ç‰‡çš„æ ‡ç­¾ä»¥åŠå®šä½ä¿¡æ¯</span><br><span class="line">    list *options &#x3D; read_data_cfg(datacfg);</span><br><span class="line">    char *train_images &#x3D; option_find_str(options, &quot;train&quot;, &quot;data&#x2F;train.txt&quot;);</span><br><span class="line">    char *valid_images &#x3D; option_find_str(options, &quot;valid&quot;, train_images);</span><br><span class="line">    char *backup_directory &#x3D; option_find_str(options, &quot;backup&quot;, &quot;&#x2F;backup&#x2F;&quot;);</span><br><span class="line"></span><br><span class="line">    network net_map;</span><br><span class="line">    &#x2F;&#x2F;å¦‚æœè¦è®¡ç®—map</span><br><span class="line">    if (calc_map) &#123;</span><br><span class="line">        FILE* valid_file &#x3D; fopen(valid_images, &quot;r&quot;);</span><br><span class="line">        if (!valid_file) &#123;</span><br><span class="line">            printf(&quot;\n Error: There is no %s file for mAP calculation!\n Don&#39;t use -map flag.\n Or set valid&#x3D;%s in your %s file. \n&quot;, valid_images, train_images, datacfg);</span><br><span class="line">            getchar();</span><br><span class="line">            exit(-1);</span><br><span class="line">        &#125;</span><br><span class="line">        else fclose(valid_file);</span><br><span class="line"></span><br><span class="line">        cuda_set_device(gpus[0]);</span><br><span class="line">        printf(&quot; Prepare additional network for mAP calculation...\n&quot;);</span><br><span class="line">        net_map &#x3D; parse_network_cfg_custom(cfgfile, 1, 1);</span><br><span class="line">        &#x2F;&#x2F;åˆ†ç±»æ•°</span><br><span class="line">        const int net_classes &#x3D; net_map.layers[net_map.n - 1].classes;</span><br><span class="line"></span><br><span class="line">        int k;  &#x2F;&#x2F; free memory unnecessary arrays</span><br><span class="line">        for (k &#x3D; 0; k &lt; net_map.n - 1; ++k) free_layer_custom(net_map.layers[k], 1);</span><br><span class="line"></span><br><span class="line">        char *name_list &#x3D; option_find_str(options, &quot;names&quot;, &quot;data&#x2F;names.list&quot;);</span><br><span class="line">        int names_size &#x3D; 0;</span><br><span class="line">        &#x2F;&#x2F;è·å–ç±»åˆ«å¯¹åº”çš„åå­—</span><br><span class="line">        char **names &#x3D; get_labels_custom(name_list, &amp;names_size);</span><br><span class="line">        if (net_classes !&#x3D; names_size) &#123;</span><br><span class="line">            printf(&quot; Error: in the file %s number of names %d that isn&#39;t equal to classes&#x3D;%d in the file %s \n&quot;,</span><br><span class="line">                name_list, names_size, net_classes, cfgfile);</span><br><span class="line">            if (net_classes &gt; names_size) getchar();</span><br><span class="line">        &#125;</span><br><span class="line">        free_ptrs((void**)names, net_map.layers[net_map.n - 1].classes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    srand(time(0));</span><br><span class="line">     &#x2F;&#x2F; æå–é…ç½®æ–‡ä»¶åç§°ä¸­çš„ä¸»è¦ä¿¡æ¯ï¼Œç”¨äºè¾“å‡ºæ‰“å°ï¼ˆå¹¶æ— å®è´¨ä½œç”¨ï¼‰ï¼Œæ¯”å¦‚æå–cfg&#x2F;yolo.cfgä¸­çš„yoloï¼Œç”¨äºä¸‹é¢çš„è¾“å‡ºæ‰“å°</span><br><span class="line">    char *base &#x3D; basecfg(cfgfile);</span><br><span class="line">    printf(&quot;%s\n&quot;, base);</span><br><span class="line">    float avg_loss &#x3D; -1;</span><br><span class="line">    &#x2F;&#x2F; æ„å»ºç½‘ç»œï¼šç”¨å¤šå°‘å—GPUï¼Œå°±ä¼šæ„å»ºå¤šå°‘ä¸ªç›¸åŒçš„ç½‘ç»œï¼ˆä¸ä½¿ç”¨GPUæ—¶ï¼Œngpus&#x3D;1ï¼‰</span><br><span class="line">    network* nets &#x3D; (network*)xcalloc(ngpus, sizeof(network));</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F;è®¾å®šéšæœºæ•°ç§å­</span><br><span class="line">    srand(time(0));</span><br><span class="line">    int seed &#x3D; rand();</span><br><span class="line">    int i;</span><br><span class="line">      &#x2F;&#x2F; forå¾ªç¯æ¬¡æ•°ä¸ºngpusï¼Œä½¿ç”¨å¤šå°‘å—GPUï¼Œå°±å¾ªç¯å¤šå°‘æ¬¡ï¼ˆä¸ä½¿ç”¨GPUæ—¶ï¼Œngpus&#x3D;1ï¼Œä¹Ÿä¼šå¾ªç¯ä¸€æ¬¡ï¼‰</span><br><span class="line">    &#x2F;&#x2F; è¿™é‡Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½ä¼šæ„å»ºä¸€ä¸ªç›¸åŒçš„ç¥ç»ç½‘ç»œï¼Œå¦‚æœæä¾›äº†åˆå§‹è®­ç»ƒå‚æ•°ï¼Œä¹Ÿä¼šä¸ºæ¯ä¸ªç½‘ç»œå¯¼å…¥ç›¸åŒçš„åˆå§‹è®­ç»ƒå‚æ•°</span><br><span class="line">    for (i &#x3D; 0; i &lt; ngpus; ++i) &#123;</span><br><span class="line">        srand(seed);</span><br><span class="line">#ifdef GPU</span><br><span class="line">        cuda_set_device(gpus[i]);</span><br><span class="line">#endif</span><br><span class="line">		&#x2F;&#x2F;è§£æç½‘ç»œé…ç½®æ–‡ä»¶</span><br><span class="line">        nets[i] &#x3D; parse_network_cfg(cfgfile);</span><br><span class="line">        &#x2F;&#x2F;æµ‹è¯•æŸä¸€ä¸ªç½‘ç»œå±‚çš„ç›¸å…³æŒ‡æ ‡å¦‚è¿è¡Œæ—¶é—´</span><br><span class="line">        nets[i].benchmark_layers &#x3D; benchmark_layers;</span><br><span class="line">        &#x2F;&#x2F;å¦‚æœæœ‰é¢„è®­ç»ƒæ¨¡å‹åˆ™åŠ è½½</span><br><span class="line">        if (weightfile) &#123;</span><br><span class="line">            load_weights(&amp;nets[i], weightfile);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;</span><br><span class="line">        if (clear) *nets[i].seen &#x3D; 0;</span><br><span class="line">        nets[i].learning_rate *&#x3D; ngpus;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£æé…ç½®æ–‡ä»¶"><a href="#è§£æé…ç½®æ–‡ä»¶" class="headerlink" title="è§£æé…ç½®æ–‡ä»¶"></a>è§£æé…ç½®æ–‡ä»¶</h3><p>æˆªå›¾éƒ¨åˆ†<code>yolov3.cfg</code>ç½‘ç»œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/647.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°é…ç½®å‚æ•°å¤§æ¦‚åˆ†ä¸º2ç±»ï¼š</p>
<ul>
<li>ä¸è®­ç»ƒç›¸å…³çš„é¡¹ï¼Œä»¥ [net] è¡Œå¼€å¤´çš„æ®µ. å…¶ä¸­åŒ…å«çš„å‚æ•°æœ‰: <code>batch_size, width,height,channel,momentum,decay,angle,saturation,  exposure,hue,learning_rate,burn_in,max_batches,policy,steps,scales</code>ã€‚</li>
<li>ä¸åŒç±»å‹çš„å±‚çš„é…ç½®å‚æ•°. å¦‚<code>[convolutional], [short_cut], [yolo], [route], [upsample]</code>å±‚ç­‰ã€‚</li>
</ul>
<p>åœ¨src/parse.cä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€è¡Œä»£ç ï¼Œ<code>net-&gt;batch /= net-&gt;subdivisions;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>batch_size</code> åœ¨ darknet å†…éƒ¨åˆè¢«å‡åˆ†ä¸º <code>net-&gt;subdivisions</code>ä»½, æˆä¸ºæ›´å°çš„<code>batch_size</code>ã€‚ ä½†æ˜¯è¿™äº›å°çš„ <code>batch_size</code> æœ€ç»ˆåˆè¢«æ±‡æ€», å› æ­¤ darknet ä¸­çš„<code>batch_size = net-&gt;batch / net-&gt;subdivisions * net-&gt;subdivisions</code>ã€‚æ­¤å¤–ï¼Œå’Œè¿™ä¸ªå‚æ•°ç›¸å…³çš„è®¡ç®—è®­ç»ƒå›¾ç‰‡æ•°ç›®çš„æ—¶å€™æ˜¯è¿™æ ·ï¼Œ<code>int imgs = net-&gt;batch * net-&gt;subdivisions * ngpus;</code>ï¼Œè¿™æ ·å¯ä»¥ä¿è¯<code>imgs</code>å¯ä»¥è¢«<code>subdivisions</code>æ•´é™¤ï¼Œå› æ­¤ï¼Œé€šå¸¸å°†è¿™ä¸ªå‚æ•°è®¾ä¸º8çš„å€æ•°ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¯ä¸ªgpuæˆ–è€…cpuéƒ½ä¼šè®­ç»ƒ<code>batch</code>ä¸ªæ ·æœ¬ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“äº†å‚æ•°æ˜¯ä»€ä¹ˆæ ·å­ï¼Œé‚£ä¹ˆdarknetæ˜¯å¦‚ä½•ä¿å­˜è¿™äº›å‚æ•°çš„å‘¢ï¼Ÿè¿™å°±è¦çœ‹ä¸‹åŸºæœ¬æ•°æ®ç»“æ„äº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyABç‰ˆDarknetä½¿ç”¨æ•™ç¨‹</title>
    <url>/2020/02/20/AlexeyAB%E7%89%88Darknet%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title=" å‰è¨€"></a><a id="more"></a> å‰è¨€</h2><p>è‡ªä»Joseph Redmonæå‡ºäº†yolov3åï¼Œå…¶darknetä»“åº“å·²ç»è·å¾—äº†16kçš„starï¼Œè¶³ä»¥è¯´æ˜darknetçš„æµè¡Œã€‚è¯¥ä½œè€…æœ€æ–°ä¸€æ¬¡æ›´æ–°ä¹Ÿæ˜¯ä¸€å¹´å‰äº†ï¼Œæ²¡æœ‰ç»§ç»­ç»´æŠ¤ã€‚ä¸è¿‡è‡ªæ¥è‡ªä¿„å›½çš„å¤§ç¥AlexeyABåœ¨ä¸æ–­åœ°æ›´æ–°darknet, ä¸ä»…æ·»åŠ äº†darknetåœ¨windowä¸‹çš„é€‚é…ï¼Œè€Œä¸”å®ç°äº†å¤šç§SOTAç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚AlexeyABä¹Ÿåœ¨åº“ä¸­æä¾›äº†ä¸€ä»½è¯¦ç»†çš„å»ºè®®ï¼Œä»ç¼–è¯‘ã€é…ç½®ã€æ¶‰åŠç½‘ç»œåˆ°æµ‹é‡æŒ‡æ ‡ç­‰ï¼Œä¸€åº”ä¿±å…¨ã€‚é€šè¿‡é˜…è¯»å’Œç†è§£AlexeyABçš„å»ºè®®ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬å¸¦æ¥å¾ˆå¤šå¯å‘ã€‚æœ¬æ–‡æ˜¯æ¥è‡ªç¿»è¯‘AlexeyABçš„darknetä¸­çš„READMEã€‚</p>
<p>ä¸‹å›¾æ˜¯CSPNetä¸­ç»Ÿè®¡çš„ç›®å‰çš„State of the Artçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ã€‚å…¶ä¸­csresnext50-panet-spp-optimalæ¨¡å‹æ˜¯CSPNetä¸­æå‡ºæ¥çš„ï¼Œç»“åˆAlexeyABç‰ˆæœ¬çš„Darknetå°±å¯ä»¥å®ç°ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/640.jpg" alt></p>
<h2 id="1-ä¾èµ–"><a href="#1-ä¾èµ–" class="headerlink" title="1. ä¾èµ–"></a>1. ä¾èµ–</h2><h3 id="1-1-ç¯å¢ƒè¦æ±‚"><a href="#1-1-ç¯å¢ƒè¦æ±‚" class="headerlink" title="1.1 ç¯å¢ƒè¦æ±‚"></a>1.1 ç¯å¢ƒè¦æ±‚</h3><ul>
<li>windowç³»ç»Ÿæˆ–è€…linuxç³»ç»Ÿã€‚</li>
<li>CMakeç‰ˆæœ¬é«˜äº3.8ã€‚</li>
<li>CUDA 10.0ï¼ŒcuDNN&gt;=7.0ã€‚</li>
<li>OpenCVç‰ˆæœ¬é«˜äº2.4ã€‚</li>
<li>Linuxä¸‹éœ€è¦GCC æˆ–è€…Clang, Windowä¸‹éœ€è¦Visual Studio 15ã€17æˆ–19ç‰ˆã€‚</li>
</ul>
<h3 id="1-2-æ•°æ®é›†è·å–"><a href="#1-2-æ•°æ®é›†è·å–" class="headerlink" title="1.2 æ•°æ®é›†è·å–"></a>1.2 æ•°æ®é›†è·å–</h3><ol>
<li>MS COCOæ•°æ®é›†: ä½¿ç”¨<code>./scripits/get_coco_dataset.sh</code>æ¥è·å–æ•°æ®é›†ã€‚</li>
<li>OpenImagesæ•°æ®é›†: ä½¿ç”¨<code>./scripits/get_openimages_dataset.py</code>è·å–æ•°æ®é›†,å¹¶æŒ‰ç…§è§„å®šçš„æ ¼å¼é‡æ’è®­ç»ƒé›†ã€‚</li>
<li>Pascal VOCæ•°æ®é›†: ä½¿ç”¨<code>./scripits/voc_label.py</code>å¯¹æ•°æ®é›†æ ‡æ³¨è¿›è¡Œå¤„ç†ã€‚</li>
<li>ILSVRC2012æ•°æ®é›†(ImageNet Classification): ä½¿ç”¨<code>./scripits/get_imagenet_train.sh</code>è·å–æ•°æ®é›†ï¼Œè¿è¡Œ<code>./scripits/imagenet_label.sh</code>ç”¨äºéªŒè¯é›†ã€‚</li>
<li>German/Belgium/Russian/LISA/MASTIF äº¤é€šæ ‡å¿—æ•°æ®é›†ã€‚</li>
<li>å…¶ä»–æ•°æ®é›†ï¼Œè¯·è®¿é—®<code>https://github.com/AlexeyAB/darknet/tree/master/scripts#datasets</code></li>
</ol>
<p>ç»“æœç¤ºæ„ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/641.webp" alt></p>
<p>å…¶ä»–æµ‹è¯•ç»“æœå¯ä»¥è®¿é—®:<code>https://www.youtube.com/user/pjreddie/videos</code></p>
<h2 id="2-ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›"><a href="#2-ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›" class="headerlink" title="2. ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›"></a>2. ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›</h2><ul>
<li>æ·»åŠ äº†å¯¹windowsä¸‹è¿è¡Œdarknetçš„æ”¯æŒã€‚</li>
<li>æ·»åŠ äº†SOTAæ¨¡å‹ï¼š CSPNet, PRN, EfficientNetã€‚</li>
<li>åœ¨å®˜æ–¹Darknetçš„åŸºç¡€ä¸Šæ·»åŠ äº†æ–°çš„å±‚ï¼š[conv_lstm], [scale_channels] SE/ASFF/BiFPN, [local_avgpool], [sam],  [Gaussian_yolo], [reorg3d] (ä¿®å¤ [reorg]), ä¿®å¤ [batchnorm]ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>[conv_lstm]</code>å±‚æˆ–è€…<code>[crnn]</code>å±‚æ¥å®ç°é’ˆå¯¹è§†é¢‘çš„ç›®æ ‡æ£€æµ‹ã€‚</li>
<li>æ·»åŠ äº†å¤šç§æ•°æ®å¢å¼ºç­–ç•¥: <code>[net] mixup=1 cutmix=1 mosaic=1 blur=1</code>ã€‚</li>
<li>æ·»åŠ äº†å¤šç§æ¿€æ´»å‡½æ•°: SWISH, MISH, NORM_CHAN, NORM\CHAN_SOFTMAXã€‚</li>
<li>å¢åŠ äº†ä½¿ç”¨CPU-RAMæé«˜GPUå¤„ç†è®­ç»ƒçš„èƒ½åŠ›ï¼Œä»¥å¢åŠ <code>mini_batch_size</code>å’Œå‡†ç¡®æ€§ã€‚</li>
<li>æå‡äº†äºŒå€¼ç½‘ç»œï¼Œè®©å…¶åœ¨CPUå’ŒGPUä¸Šçš„è®­ç»ƒå’Œæµ‹è¯•é€Ÿåº¦å˜ä¸ºåŸæ¥çš„2-4å€ã€‚</li>
<li>é€šè¿‡å°†Convolutionalå±‚å’ŒBatch-Normå±‚åˆå¹¶æˆä¸€ä¸ªå±‚ï¼Œæå‡äº†çº¦7%é€Ÿåº¦ã€‚</li>
<li>å¦‚æœåœ¨Makefileä¸­ä½¿ç”¨CUDNN_HALFå‚æ•°ï¼Œå¯ä»¥è®©ç½‘ç»œåœ¨TeslaV100ï¼ŒGeForce RTXç­‰å‹å·çš„GPUä¸Šçš„æ£€æµ‹é€Ÿåº¦æå‡ä¸¤å€ã€‚</li>
<li>é’ˆå¯¹è§†é¢‘çš„æ£€æµ‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹é«˜æ¸…è§†é¢‘æ£€æµ‹é€Ÿåº¦å¯ä»¥æå‡1.2å€ï¼Œå¯¹4kçš„è§†é¢‘æ£€æµ‹é€Ÿåº¦å¯ä»¥æå‡2å€ã€‚</li>
<li>æ•°æ®å¢å¼ºéƒ¨åˆ†ä½¿ç”¨Opencv SSE/AVXæŒ‡ä»¤ä¼˜åŒ–äº†åŸæ¥æœ´ç´ å®ç°çš„æ•°æ®å¢å¼ºï¼Œæ•°æ®å¢å¼ºé€Ÿåº¦æå‡ä¸ºåŸæ¥çš„3.5å€ã€‚</li>
<li>åœ¨CPUä¸Šä½¿ç”¨AVXæŒ‡ä»¤æ¥æé«˜äº†æ£€æµ‹é€Ÿåº¦ï¼Œyolov3æé«˜äº†çº¦85%ã€‚</li>
<li>åœ¨ç½‘ç»œå¤šå°ºåº¦è®­ç»ƒï¼ˆ<code>random=1</code>ï¼‰çš„æ—¶å€™ä¼˜åŒ–äº†å†…å­˜åˆ†é…ã€‚</li>
<li>ä¼˜åŒ–äº†æ£€æµ‹æ—¶çš„GPUåˆå§‹åŒ–ç­–ç•¥ï¼Œåœ¨bacth=1çš„æ—¶å€™æ‰§è¡Œåˆå§‹åŒ–è€Œä¸æ˜¯å½“batch=1çš„æ—¶å€™é‡æ–°åˆå§‹åŒ–ã€‚</li>
<li>æ·»åŠ äº†è®¡ç®—mAP,F1,IoU, Precision-Recallç­‰æŒ‡æ ‡çš„æ–¹æ³•ï¼Œåªéœ€è¦è¿è¡Œ<code>darknet detector map</code>å‘½ä»¤å³å¯ã€‚</li>
<li>æ”¯æŒåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ç”»lossæ›²çº¿å’Œå‡†ç¡®ç‡æ›²çº¿ï¼Œåªéœ€è¦æ·»åŠ <code>-map</code>æ ‡å¿—å³å¯ã€‚</li>
<li>æä¾›äº†<code>-json_port</code>,<code>-mjpeg_port</code>é€‰é¡¹ï¼Œæ”¯æŒä½œä¸ºjsonå’Œmjpeg æœåŠ¡å™¨æ¥åœ¨çº¿è·å–çš„ç»“æœã€‚å¯ä»¥ä½¿ç”¨ä½ çš„ç¼–å†™çš„è½¯ä»¶æˆ–è€…webæµè§ˆå™¨ä¸<strong>jsonå’ŒmjpegæœåŠ¡å™¨</strong>è¿æ¥ã€‚</li>
<li>æ·»åŠ äº†Anchorçš„è®¡ç®—åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®æ•°æ®é›†æ¥èšç±»å¾—åˆ°åˆé€‚çš„Anchorã€‚</li>
<li>æ·»åŠ äº†ä¸€äº›ç›®æ ‡æ£€æµ‹å’Œç›®æ ‡è·Ÿè¸ªçš„ç¤ºä¾‹ï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/src/yolo_console_dll.cpp</code></li>
<li>åœ¨ä½¿ç”¨é”™è¯¯çš„cfgæ–‡ä»¶æˆ–è€…æ•°æ®é›†çš„æ—¶å€™ï¼Œæ·»åŠ äº†è¿è¡Œæ—¶çš„å»ºè®®å’Œè­¦å‘Šã€‚</li>
<li>å…¶å®ƒä¸€äº›ä»£ç ä¿®å¤ã€‚</li>
</ul>
<h2 id="3-å‘½ä»¤è¡Œä½¿ç”¨"><a href="#3-å‘½ä»¤è¡Œä½¿ç”¨" class="headerlink" title="3. å‘½ä»¤è¡Œä½¿ç”¨"></a>3. å‘½ä»¤è¡Œä½¿ç”¨</h2><p>Linuxä¸­ä½¿ç”¨./darknetï¼Œwindowä¸‹ä½¿ç”¨darknet.exe.</p>
<p>Linuxä¸­å‘½ä»¤æ ¼å¼ç±»ä¼¼<code>./darknet detector test ./cfg/coco.data ./cfg/yolov3.cfg ./yolov3.weights</code></p>
<p>Linuxä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨æ ¹ç›®å½•ä¸‹ï¼ŒWindowä¸‹åˆ™åœ¨<code>\build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚ä»¥æ˜¯ä¸åŒæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨çš„å‘½ä»¤ï¼š</p>
<ul>
<li>Yolo v3 COCO - <strong>å›¾ç‰‡æµ‹è¯•</strong>: <code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -thresh 0.25</code></li>
<li><strong>è¾“å‡ºåæ ‡</strong> of objects: <code>darknet.exe detector test cfg/coco.data yolov3.cfg yolov3.weights -ext_output dog.jpg</code></li>
<li>Yolo v3 COCO - <strong>è§†é¢‘æµ‹è¯•</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights -ext_output test.mp4</code></li>
<li><strong>ç½‘ç»œæ‘„åƒå¤´</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights -c 0</code></li>
<li><strong>ç½‘ç»œè§†é¢‘æ‘„åƒå¤´</strong> - Smart WebCam: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights http://192.168.0.80:8080/video?dummy=param.mjpg</code></li>
<li>Yolo v3 - <strong>ä¿å­˜è§†é¢‘ç»“æœä¸ºres.avi</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights test.mp4 -out_filename res.avi</code></li>
<li>Yolo v3 <strong>Tinyç‰ˆæœ¬</strong> COCO - video: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3-tiny.cfg yolov3-tiny.weights test.mp4</code></li>
<li><strong>JSON and MJPEG æœåŠ¡å™¨</strong> ï¼šåˆ›å»ºJSONå’ŒMJPEGæœåŠ¡å™¨ï¼Œå…è®¸è½¯ä»¶æˆ–Webæµè§ˆå™¨è¿›è¡Œä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå¤šä¸ªè¿æ¥ ã€‚å‡è®¾ä¸¤è€…éœ€è¦çš„ç«¯å£ä¸º<code>ip-address:8070</code> å’Œ <code>8090</code>: <code>./darknet detector demo ./cfg/coco.data ./cfg/yolov3.cfg ./yolov3.weights  test50.mp4 -json_port 8070 -mjpeg_port 8090 -ext_output</code></li>
<li>Yolo v3 <strong>Tiny</strong> <strong>on GPU</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3-tiny.cfg yolov3-tiny.weights -i 1 test.mp4</code></li>
<li>å¦ä¸€ä¸ªå¯è¿›è¡Œå›¾ç‰‡æµ‹è¯•çš„å‘½ä»¤ Yolo v3 COCO - <strong>å›¾ç‰‡æµ‹è¯•</strong>: <code>darknet.exe detect cfg/yolov3.cfg yolov3.weights -i 0 -thresh 0.25</code></li>
<li>åœ¨ <strong>Amazon EC2</strong>ä¸Šè®­ç»ƒ, å¦‚æœæƒ³è¦çœ‹mAPå’ŒLossæ›²çº¿ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤: <code>http://ec2-35-160-228-91.us-west-2.compute.amazonaws.com:8090</code>  (<strong>Darknet å¿…é¡»ä½¿ç”¨OpenCVè¿›è¡Œç¼–è¯‘æ‰èƒ½ä½¿ç”¨è¯¥åŠŸèƒ½</strong>): <code>./darknet detector train cfg/coco.data yolov3.cfg darknet53.conv.74 -dont_show -mjpeg_port 8090 -map</code></li>
<li>186 MB Yolo9000 - <strong>å›¾ç‰‡åˆ†ç±»</strong>: <code>darknet.exe detector test cfg/combine9k.data cfg/yolo9000.cfg yolo9000.weights</code></li>
<li><strong>å¤„ç†ä¸€ç³»åˆ—å›¾ç‰‡ï¼Œå¹¶ä¿å­˜ç»“æœä¸ºjsonæ–‡ä»¶</strong>ï¼š<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -ext_output  -dont_show -out result.json &lt; data/train.txt</code></li>
<li><strong>å¤„ç†ä¸€ç³»åˆ—å›¾ç‰‡ï¼Œå¹¶ä¿å­˜ç»“æœä¸ºtxtæ–‡ä»¶</strong>:<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -dont_show -ext_output &lt; data/train.txt &gt; result.txt</code></li>
<li><strong>ä¼ªæ ‡æ³¨ï¼š</strong> å¤„ç†ä¸€ä¸ªlistçš„å›¾ç‰‡ <code>data/new_train.txt</code> ï¼Œå¯ä»¥è®©ç»“æœä¿å­˜ä¸ºYoloè®­ç»ƒæ‰€éœ€çš„æ ¼å¼ï¼Œæ ‡æ³¨æ–‡ä»¶ä¸º <code>.txt</code> ã€‚é€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥è¿…é€Ÿå¢åŠ è®­ç»ƒæ•°æ®é‡ã€‚å…·ä½“å‘½ä»¤ä¸º:<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -thresh 0.25  -dont_show -save_labels &lt; data/new_train.txt</code></li>
<li><strong>å¦‚ä½•è®¡ç®—anchor</strong>(é€šè¿‡èšç±»å¾—åˆ°): <code>darknet.exe detector calc_anchors data/obj.data -num_of_clusters 9 -width 416 -height 416</code></li>
<li><strong>è®¡ç®—mAP@IoU=50</strong>: <code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights</code></li>
<li><strong>è®¡ç®—mAP@IoU=75</strong>: <code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights -iou_thresh 0.75</code></li>
</ul>
<p><strong>åˆ©ç”¨Video-Cameraå’ŒMjepg-Streamåœ¨Androidæ™ºèƒ½è®¾å¤‡ä¸­è¿è¡ŒYOLOv3</strong></p>
<ol>
<li><p>ä¸‹è½½ mjpeg-stream APP: IP Webcam / Smart WebCam:</p>
</li>
<li><ul>
<li>Smart WebCam - ä»æ­¤å¤„ä¸‹è½½: <code>https://play.google.com/store/apps/details?id=com.acontech.android.SmartWebCam2</code></li>
<li>IP Webcamä¸‹è½½åœ°å€: <code>https://play.google.com/store/apps/details?id=com.pas.webcam</code></li>
</ul>
</li>
<li><p>å°†ä½ çš„æ‰‹æœºä¸ç”µè„‘é€šè¿‡WIFIæˆ–è€…USBç›¸è¿ã€‚</p>
</li>
<li><p>å¼€å¯æ‰‹æœºä¸­çš„Smart WebCam APPã€‚</p>
</li>
<li><p>å°†ä»¥ä¸‹IPåœ°å€æ›¿æ¢,åœ¨Smart WebCam APPä¸­æ˜¾ç¤ºï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
</li>
</ol>
<p>Yolo v3 COCO-model: <code>darknet.exe detector demo data/coco.data yolov3.cfg yolov3.weights http://192.168.0.80:8080/video?dummy=param.mjpg -i 0</code></p>
<h2 id="4-Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet"><a href="#4-Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet" class="headerlink" title="4. Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet"></a>4. Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet</h2><h3 id="4-1-ä½¿ç”¨CMakeç¼–è¯‘Darknet"><a href="#4-1-ä½¿ç”¨CMakeç¼–è¯‘Darknet" class="headerlink" title="4.1 ä½¿ç”¨CMakeç¼–è¯‘Darknet"></a>4.1 ä½¿ç”¨CMakeç¼–è¯‘Darknet</h3><p>CMakeList.txtæ˜¯ä¸€ä¸ªå°è¯•å‘ç°æ‰€æœ‰å®‰è£…è¿‡çš„ã€å¯é€‰çš„ä¾èµ–é¡¹(æ¯”å¦‚CUDAï¼ŒcuDNN, ZED)çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨è¿™äº›ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘ã€‚å®ƒå°†åˆ›å»ºä¸€ä¸ªå…±äº«åº“æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Darknetè¿›è¡Œä»£ç å¼€å‘ã€‚</p>
<p>åœ¨å…‹éš†äº†é¡¹ç›®åº“ä»¥åæŒ‰ç…§ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir build-release</span><br><span class="line">cd build-release</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h3 id="4-2-ä½¿ç”¨makeç¼–è¯‘Darknet"><a href="#4-2-ä½¿ç”¨makeç¼–è¯‘Darknet" class="headerlink" title="4.2 ä½¿ç”¨makeç¼–è¯‘Darknet"></a>4.2 ä½¿ç”¨makeç¼–è¯‘Darknet</h3><p>åœ¨å…‹éš†äº†é¡¹ç›®åº“ä»¥åï¼Œç›´æ¥è¿è¡Œ<code>make</code>å‘½ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯Makefileä¸­æœ‰ä¸€äº›å¯é€‰å‚æ•°ï¼š</p>
<ul>
<li>GPU=1ä»£è¡¨ç¼–è¯‘å®Œæˆåå°†å¯ä»¥ä½¿ç”¨CUDAæ¥è¿›è¡ŒGPUåŠ é€Ÿ(CUDAåº”è¯¥åœ¨<code>/usr/local/cuda</code>ä¸­)ã€‚</li>
<li>CUDNN=1ä»£è¡¨é€šè¿‡cuDNN v5-v7è¿›è¡Œç¼–è¯‘ï¼Œè¿™æ ·å°†å¯ä»¥åŠ é€Ÿä½¿ç”¨GPUè®­ç»ƒè¿‡ç¨‹(cuDNNåº”è¯¥åœ¨<code>/usr/local/cudnn</code>ä¸­)ã€‚</li>
<li>CUDNN_HALF=1ä»£è¡¨åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­æ˜¯å¦æ·»åŠ Tensor Cores, ç¼–è¯‘å®Œæˆåå°†å¯ä»¥å°†ç›®æ ‡æ£€æµ‹é€Ÿåº¦æå‡ä¸ºåŸæ¥çš„3å€ï¼Œè®­ç»ƒç½‘ç»œçš„é€Ÿåº¦æé«˜ä¸ºåŸæ¥çš„2å€ã€‚</li>
<li>OPENCV=1ä»£è¡¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­åŠ å…¥OpenCV, ç›®å‰æ”¯æŒçš„OpenCVçš„ç‰ˆæœ¬æœ‰4.x/3.x/2.4.xï¼Œ ç¼–è¯‘ç»“æŸåå°†å…è®¸Darknetå¯¹ç½‘ç»œæ‘„åƒå¤´çš„è§†é¢‘æµæˆ–è€…è§†é¢‘æ–‡ä»¶è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚</li>
<li>DEBUG=1 ä»£è¡¨æ˜¯å¦å¼€å¯YOLOçš„debugæ¨¡å¼ã€‚</li>
<li>OPENMP=1ä»£è¡¨ç¼–è¯‘è¿‡ç¨‹å°†å¼•å…¥openmp,ç¼–è¯‘ç»“æŸåå°†ä»£è¡¨å¯ä»¥ä½¿ç”¨å¤šæ ¸CPUå¯¹yoloè¿›è¡ŒåŠ é€Ÿã€‚</li>
<li>LIBSO=1 ä»£è¡¨ç¼–è¯‘åº“darknet.soã€‚</li>
<li>ZED_CAMERA=1 æ„å»ºå…·æœ‰ZED-3Dç›¸æœºæ”¯æŒçš„åº“(åº”å®‰è£…ZED SDK)ï¼Œç„¶åè¿è¡Œã€‚</li>
</ul>
<h2 id="5-å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet"><a href="#5-å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet" class="headerlink" title="5. å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet"></a>5. å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet</h2><h3 id="5-1-ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘"><a href="#5-1-ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.1 ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘"></a>5.1 ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘</h3><p>å»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥å®ŒæˆWindowä¸‹Darknetçš„ç¼–è¯‘ï¼Œéœ€è¦ç¯å¢ƒæœ‰ï¼šVisual Studio 15/17/19, CUDA&gt;10.0, cuDNN&gt;7.0, OpenCV&gt;2.4</p>
<p>ä½¿ç”¨CMake-GUIç¼–è¯‘æµç¨‹ï¼š</p>
<ol>
<li>Configure.</li>
<li>Optional platform for generator (Set: x64) .</li>
<li>Finish.</li>
<li>Generate.</li>
<li>Open Project.</li>
<li>Set: x64 &amp; Release.</li>
<li>Build.</li>
<li>Build solution.</li>
</ol>
<h3 id="5-2-ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘"><a href="#5-2-ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.2 ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘"></a>5.2 ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘</h3><p>å¦‚æœä½ å·²ç»æ»¡è¶³Visual Studio 15/17/19 ã€CUDA&gt;10.0ã€ cuDNN&gt;7.0ã€OpenCV&gt;2.4çš„æ¡ä»¶, é‚£ä¹ˆæ¨èä½¿ç”¨é€šè¿‡CMake-GUIçš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚</p>
<p>å¦åˆ™æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç¼–è¯‘:</p>
<ul>
<li>å®‰è£…æˆ–æ›´æ–°Visual Studioåˆ°17+,ç¡®ä¿å·²ç»å¯¹å…¶è¿›è¡Œå…¨é¢ä¿®è¡¥ã€‚</li>
<li>å®‰è£…CUDAå’ŒcuDNNã€‚</li>
<li>å®‰è£…Gitå’ŒCMake, å¹¶å°†å®ƒä»¬åŠ å…¥ç¯å¢ƒå˜é‡ä¸­ã€‚</li>
<li>å®‰è£…vcpkgç„¶åå°è¯•å®‰è£…ä¸€ä¸ªæµ‹è¯•åº“æ¥ç¡®è®¤å®‰è£…æ˜¯æ­£ç¡®çš„ï¼Œæ¯”å¦‚ï¼š<code>vcpkg install opengl</code>ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡<code>VCPKG_ROOT</code>, æŒ‡å‘vcpkgçš„å®‰è£…è·¯å¾„ã€‚</li>
<li>å®šä¹‰å¦ä¸€ä¸ªç¯å¢ƒå˜é‡<code>VCPKG_DEFAULT_TRIPLET</code>å°†å…¶æŒ‡å‘x64-windowsã€‚</li>
<li>æ‰“å¼€Powershellç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS \&gt;                  cd $env:VCPKG_ROOT</span><br><span class="line">PS Code\vcpkg&gt;         .\vcpkg install pthreads opencv[ffmpeg] </span><br><span class="line">#replace with opencv[cuda,ffmpeg] in case you want to use cuda-accelerated openCV</span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“å¼€Powershell, åˆ‡æ¢åˆ°darknetæ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œ<code>.\build.ps1</code>è¿›è¡Œç¼–è¯‘ã€‚å¦‚æœè¦ä½¿ç”¨Visual Studioï¼Œå°†åœ¨Buildåæ‰¾åˆ°CMakeä¸ºæ‚¨åˆ›å»ºçš„ä¸¤ä¸ªè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆï¼Œä¸€ä¸ªåœ¨<code>build_win_debug</code>ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨<code>build_win_release</code>ä¸­ï¼Œå…¶ä¸­åŒ…å«é€‚ç”¨äºç³»ç»Ÿçš„æ‰€æœ‰é…ç½®æ ‡å¿—ã€‚</li>
</ul>
<h3 id="5-3-ä½¿ç”¨legacy-wayè¿›è¡Œç¼–è¯‘"><a href="#5-3-ä½¿ç”¨legacy-wayè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.3 ä½¿ç”¨legacy wayè¿›è¡Œç¼–è¯‘"></a>5.3 ä½¿ç”¨legacy wayè¿›è¡Œç¼–è¯‘</h3><ul>
<li><p>å¦‚æœä½ æœ‰CUDA10.0ã€cuDNN 7.4 å’ŒOpenCV 3.x , é‚£ä¹ˆæ‰“å¼€<code>build\darknet\darknet.sln</code>, è®¾ç½®x64å’ŒRelease ç„¶åè¿è¡ŒBuildï¼Œ è¿›è¡Œdarknetçš„ç¼–è¯‘ï¼Œå°†cuDNNåŠ å…¥ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<ul>
<li>åœ¨<code>C:\opencv_3.0\opencv\build\x64\vc14\bin</code>æ‰¾åˆ°<code>opencv_world320.dll</code>å’Œ<code>opencv_ffmpeg320_64.dll</code>, ç„¶åå°†å…¶å¤åˆ¶åˆ°<code>darknet.exe</code>åŒçº§ç›®å½•ä¸­ã€‚</li>
<li>åœ¨<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.0</code>ä¸­æ£€æŸ¥æ˜¯å¦å«æœ‰binå’Œincludeæ–‡ä»¶å¤¹ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œé‚£å°±å°†ä»–ä»¬ä»CUDAå®‰è£…çš„åœ°æ–¹å¤åˆ¶åˆ°è¿™ä¸ªåœ°æ–¹ã€‚</li>
<li>å®‰è£…cuDNN 7.4.1 æ¥åŒ¹é…CUDA 10.0, å°†cuDNNæ·»åŠ åˆ°ç¯å¢ƒå˜é‡<code>CUDNN</code>ã€‚å°†<code>cudnn64_7.dll</code>å¤åˆ¶åˆ°<code>\build\darknet\x64</code>ä¸­ã€‚</li>
</ul>
</li>
<li><p>å¦‚æœä½ æ˜¯ç”¨çš„æ˜¯å…¶ä»–ç‰ˆæœ¬çš„CUDAï¼ˆä¸æ˜¯CUDA 10.0ï¼‰, é‚£ä¹ˆä½¿ç”¨Notepadæ‰“å¼€<code>build\darknet\darknet.vxcproj</code>, å°†å…¶ä¸­çš„CUDA 10.0æ›¿æ¢ä¸ºä½ çš„CUDAçš„ç‰ˆæœ¬ã€‚ç„¶åæ‰“å¼€<code>\darknet.sln</code>, ç„¶åå³å‡»å·¥ç¨‹ï¼Œç‚¹å‡»å±æ€§properties, é€‰æ‹©CUDA C/C++, ç„¶åé€‰æ‹©Device , ç„¶åç§»é™¤<code>compute_75,sm_75</code>ã€‚ä¹‹åä»ç¬¬ä¸€æ­¥ä»å¤´å¼€å§‹æ‰§è¡Œã€‚</p>
</li>
<li><p>å¦‚æœä½ æ²¡æœ‰GPUä½†æ˜¯æœ‰OpenCV3.0ï¼Œ é‚£ä¹ˆæ‰“å¼€<code>build\darknet\darknet_no_gpu.sln</code>, è®¾ç½®x64å’ŒReleaseï¼Œ ç„¶åè¿è¡Œbuild -&gt; build darknet_no_gpuã€‚</p>
</li>
<li><p>å¦‚æœä½ åªå®‰è£…äº†OpenCV 2.4.14ï¼Œé‚£ä½ åº”è¯¥ä¿®æ”¹<code>\darknet.sln</code>ä¸­çš„è·¯å¾„ã€‚</p>
</li>
<li><ul>
<li>(å³é”®ç‚¹å‡»å·¥ç¨‹) -&gt; properties -&gt; C/C++ -&gt; General -&gt; Additional Include Directories: <code>C:\opencv_2.4.13\opencv\build\include</code></li>
<li>(å³é”®ç‚¹å‡»å·¥ç¨‹)-&gt; properties -&gt; Linker -&gt; General -&gt; Additional Library Directories: <code>C:\opencv_2.4.13\opencv\build\x64\vc14\lib</code></li>
</ul>
</li>
<li><p>å¦‚æœä½ çš„GPUæœ‰Tensor Cores(Nvidia Titan V/ Tesla V100/ DGX-2ç­‰å‹å·)ï¼Œ å¯ä»¥æå‡ç›®æ ‡æ£€æµ‹æ¨¡å‹æµ‹è¯•é€Ÿåº¦ä¸ºåŸæ¥çš„3å€ï¼Œè®­ç»ƒé€Ÿåº¦å˜ä¸ºåŸæ¥çš„2å€ã€‚<code>\darknet.sln</code> -&gt; (å³é”®ç‚¹å‡»å·¥ç¨‹) -&gt; properties -&gt; C/C++ -&gt; Preprocessor -&gt; Preprocessor Definitions, and add here: <code>CUDNN_HALF;</code></p>
<p><strong>æ³¨æ„</strong>ï¼šCUDA å¿…é¡»åœ¨Visual Studioå®‰è£…åå†å®‰è£…ã€‚</p>
</li>
</ul>
<h2 id="6-å¦‚ä½•è®­ç»ƒ"><a href="#6-å¦‚ä½•è®­ç»ƒ" class="headerlink" title="6. å¦‚ä½•è®­ç»ƒ"></a>6. å¦‚ä½•è®­ç»ƒ</h2><h3 id="6-1-Pascal-VOC-dataset"><a href="#6-1-Pascal-VOC-dataset" class="headerlink" title="6.1 Pascal VOC dataset"></a>6.1 Pascal VOC dataset</h3><ol>
<li><p>ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ (154 MB): <code>http://pjreddie.com/media/files/darknet53.conv.74</code> å°†å…¶æ”¾åœ¨ <code>build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
</li>
<li><p>ä¸‹è½½pascal vocæ•°æ®é›†å¹¶è§£å‹åˆ° <code>build\darknet\x64\data\voc</code> æ”¾åœ¨ <code>build\darknet\x64\data\voc\VOCdevkit\</code>æ–‡ä»¶å¤¹ä¸­:</p>
<p>2.1 ä¸‹è½½ <code>voc_label.py</code> åˆ° <code>build\darknet\x64\data\voc</code>ï¼Œåœ°å€ä¸º: <code>http://pjreddie.com/media/files/voc_label.pyã€‚</code></p>
</li>
<li><ul>
<li><code>http://pjreddie.com/media/files/VOCtrainval_11-May-2012.tar</code>ã€‚</li>
<li><code>http://pjreddie.com/media/files/VOCtrainval_06-Nov-2007.tar</code>ã€‚</li>
<li><code>http://pjreddie.com/media/files/VOCtest_06-Nov-2007.tar</code>ã€‚</li>
</ul>
</li>
<li><p>ä¸‹è½½å¹¶å®‰è£…python: <code>https://www.python.org/ftp/python/3.5.2/python-3.5.2-amd64.exe</code></p>
</li>
<li><p>è¿è¡Œå‘½ä»¤: <code>python build\darknet\x64\data\voc\voc_label.py</code> (æ¥ç”Ÿæˆæ–‡ä»¶: 2007_test.txt, 2007_train.txt, 2007_val.txt, 2012_train.txt, 2012_val.txt)ã€‚</p>
</li>
<li><p>è¿è¡Œå‘½ä»¤: <code>type 2007_train.txt 2007_val.txt 2012_*.txt &gt; train.txt</code>ã€‚</p>
</li>
<li><p>åœ¨ <code>yolov3-voc.cfg</code>æ–‡ä»¶ä¸­è®¾ç½® <code>batch=64</code> å’Œ<code>subdivisions=8</code>ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>train_voc.cmd</code> æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ:</p>
<p><code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg darknet53.conv.74</code>ã€‚</p>
</li>
</ol>
<p>(<strong>Note:</strong> å¦‚æœæƒ³è¦åœæ­¢lossæ˜¾ç¤ºï¼Œæ·»åŠ  <code>-dont_show</code>æ ‡å¿—. å¦‚æœä½¿ç”¨CPUè¿è¡Œ, ç”¨<code>darknet_no_gpu.exe</code> ä»£æ›¿ <code>darknet.exe</code>ã€‚)</p>
<p>å¦‚æœæƒ³è¦æ”¹æ•°æ®é›†è·¯å¾„çš„è¯ï¼Œè¯·ä¿®æ”¹ <code>build\darknet\cfg\voc.data</code>æ–‡ä»¶ã€‚</p>
<p><strong>Note:</strong> åœ¨è®­ç»ƒä¸­å¦‚æœä½ çœ‹åˆ°avgä¸ºnanï¼Œé‚£è¯æ˜è®­ç»ƒå‡ºé”™ã€‚ä½†æ˜¯å¦‚æœåœ¨å…¶ä»–éƒ¨åˆ†å‡ºç°nanï¼Œè¿™å±äºæ­£å¸¸ç°è±¡ï¼Œè®­ç»ƒè¿‡ç¨‹æ˜¯æ­£å¸¸çš„ã€‚</p>
<h3 id="6-2-å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ"><a href="#6-2-å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ" class="headerlink" title="6.2 å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ"></a>6.2 å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ</h3><ol>
<li>é¦–å…ˆåœ¨ä¸€ä¸ªGPUä¸­è®­ç»ƒå¤§æ¦‚1000ä¸ªè½®æ¬¡: <code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg darknet53.conv.74</code>ã€‚</li>
<li>ç„¶ååœä¸‹æ¥åŸºäºè¿™ä¸ªä¿å­˜çš„æ¨¡å‹ <code>/backup/yolov3-voc_1000.weights</code> ä½¿ç”¨å¤šGPU (æœ€å¤š4ä¸ªGPU): <code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg /backup/yolov3-voc_1000.weights -gpus 0,1,2,3</code>ã€‚</li>
</ol>
<p>åœ¨å¤šGPUè®­ç»ƒçš„æ—¶å€™ï¼Œ<code>learning rate</code>éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚å•<code>gpuä½¿ç”¨0.001</code>ï¼Œé‚£ä¹ˆå¤šgpuåº”è¯¥ä½¿ç”¨0.001/GPUSã€‚ç„¶å<code>cfg</code>æ–‡ä»¶ä¸­çš„<code>burn_in</code>å‚æ•°å’Œ<code>max_batches</code>å‚æ•°è¦è®¾ç½®ä¸ºåŸæ¥çš„GPUSå€ã€‚</p>
<h3 id="6-3-è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†-é‡ç‚¹å…³æ³¨"><a href="#6-3-è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†-é‡ç‚¹å…³æ³¨" class="headerlink" title="6.3 è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†(é‡ç‚¹å…³æ³¨)"></a>6.3 è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†(é‡ç‚¹å…³æ³¨)</h3><p>è®­ç»ƒè¾ƒæ—©æå‡ºçš„Yoloç³»åˆ—ç®—æ³•å¦‚<code>yolov2-voc.cfg</code>, <code>yolov2-tiny-voc.cfg</code>, <code>yolo-voc.cfg</code>, <code>yolo-voc.2.0.cfg</code>ï¼Œè¯·çœ‹<code>https://github.com/AlexeyAB/darknet/tree/47c7af1cea5bbdedf1184963355e6418cb8b1b4f#how-to-train-pascal-voc-data</code>ã€‚</p>
<p>Training Yolo v3:</p>
<ol>
<li>åˆ›å»ºä¸ <code>yolov3.cfg</code>å†…å®¹ç›¸åŒçš„ <code>yolo-obj.cfg</code> æˆ–è€…ç›´æ¥å¤åˆ¶ç„¶åé‡å‘½åä¸º<code>yolo-obj.cfg</code> ç„¶å</li>
</ol>
<ul>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­ <code>batch=64</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­ <code>subdivisions=16</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­<code>max_batches</code>å‚æ•° (ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸º<code>classes*2000</code> ä½†æ˜¯ä¸è¦ä½äº <code>4000</code>), æ¯”å¦‚ å¦‚æœä½ æœ‰ä¸‰ä¸ªç±»ï¼Œé‚£ä¹ˆè®¾ç½®<code>max_batches=6000</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>steps</code>å‚æ•°ï¼Œä¸€èˆ¬ä¸º80%å’Œ90%çš„<code>max_batches</code>ã€‚æ¯”å¦‚ <code>steps=4800,5400</code></p>
</li>
<li><p>è®¾ç½®ç½‘ç»œè¾“å…¥é•¿å®½å¿…é¡»èƒ½å¤Ÿæ•´é™¤32ï¼Œæ¯”å¦‚ <code>width=416 height=416</code> `</p>
</li>
<li><p>ä¿®æ”¹yoloå±‚ä¸­çš„ <code>classes=80</code> æ”¹ä¸ºä½ çš„ç±»åˆ«çš„ä¸ªæ•°ï¼Œæ¯”å¦‚<code>classes=3</code>:</p>
</li>
<li><p>ä¿®æ”¹yoloå±‚å‰ä¸€ä¸ªå·ç§¯å±‚convolutionalè¾“å‡ºé€šé“æ•°ã€‚ä¿®æ”¹çš„<code>filter</code>ä¸ªæ•°æœ‰ä¸€å®šè¦æ±‚ï¼ŒæŒ‰ç…§å…¬å¼<code>filters=(classes+5)Ã—3</code>æ¥è®¾ç½®ã€‚è¿™é‡Œçš„<code>5</code>ä»£è¡¨<code>x, y, w, h, conf</code>, è¿™é‡Œçš„<code>3</code>ä»£è¡¨åˆ†é…<code>3</code>ä¸ªanchorã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨ <code>[Gaussian_yolo]</code> (Gaussian_yolov3_BDD.cfg)ï¼Œ<code>filters</code>è®¡ç®—æ–¹å¼ä¸å¤ªä¸€æ ·ï¼ŒæŒ‰ç…§ <code>filters=(classes + 9)x3</code>è¿›è¡Œè®¡ç®—ã€‚</p>
</li>
<li><p>é€šå¸¸æ¥è®²ï¼Œfiltersçš„ä¸ªæ•°è®¡ç®—ä¾èµ–äºç±»åˆ«ä¸ªæ•°ï¼Œåæ ‡ä»¥åŠ<code>mask</code>çš„ä¸ªæ•°ï¼ˆ<code>cfg</code>ä¸­çš„<code>mask</code>å‚æ•°ä¹Ÿå°±æ˜¯<code>anchors</code>çš„ä¸ªæ•°ï¼‰ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­,å¯¹äºä¸¤ä¸ªç›®æ ‡,ä½ çš„ <code>yolo-obj.cfg</code> å’Œ<code>yolov3.cfg</code> ä¸åŒçš„åœ°æ–¹åº”è¯¥åœ¨æ¯ä¸ª<code>[yolo]/[region]</code>å±‚çš„ä¸‹é¢å‡ è¡Œ:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">filters&#x3D;21</span><br><span class="line"></span><br><span class="line">[region]</span><br><span class="line">classes&#x3D;2</span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>build\darknet\x64\data\</code>åˆ›å»ºæ–‡ä»¶ <code>obj.names</code> , æ¯è¡Œä¸€ä¸ªç±»åˆ«çš„åç§°ã€‚</li>
<li>åœ¨<code>build\darknet\x64\data\</code> åˆ›å»º<code>obj.data</code>, å…·ä½“å†…å®¹å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">classes&#x3D; 2 # ä½ çš„ç±»åˆ«çš„ä¸ªæ•°</span><br><span class="line">train  &#x3D; data&#x2F;train.txt # å­˜å‚¨ç”¨äºè®­ç»ƒçš„å›¾ç‰‡ä½ç½®</span><br><span class="line">valid  &#x3D; data&#x2F;test.txt # å­˜å‚¨ç”¨äºæµ‹è¯•çš„å›¾ç‰‡çš„ä½ç½®</span><br><span class="line">names &#x3D; data&#x2F;obj.names # æ¯è¡Œä¸€ä¸ªç±»åˆ«çš„åç§°</span><br><span class="line">backup &#x3D; backup&#x2F;</span><br></pre></td></tr></table></figure>
<ol>
<li>å°†ä½ çš„å›¾ç‰‡æ”¾åœ¨ <code>build\darknet\x64\data\obj\</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</li>
<li>ä½ åº”è¯¥æ ‡æ³¨ä½ çš„æ•°æ®é›†ä¸­çš„æ¯ä¸€å¼ å›¾ç‰‡ï¼Œä½¿ç”¨<code>Yolo_mark</code>è¿™ä¸ªå¯è§†åŒ–GUIè½¯ä»¶æ¥æ ‡æ³¨å‡ºç›®æ ‡æ¡†å¹¶ä¸”äº§ç”Ÿæ ‡æ³¨æ–‡ä»¶ã€‚åœ°å€ï¼š <code>https://github.com/AlexeyAB/Yolo_mark</code>ã€‚</li>
</ol>
<p>è½¯ä»¶å°†ä¼šä¸ºæ¯ä¸€ä¸ªå›¾åƒåˆ›å»ºä¸€ä¸ª<code>txt</code>æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå‘½åä¸åŸå›¾ç‰‡çš„åç§°ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯åç¼€æ˜¯txtã€‚txtæ ‡æ³¨æ–‡ä»¶ä¸­æ¯ä¸€ä¸ªç›®æ ‡ç‹¬å ä¸€è¡Œï¼ŒæŒ‰ç…§<code>&lt;object-class&gt; &lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;</code>çš„æ ¼å¼æ’å¸ƒã€‚</p>
<p>å…·ä½“å‚æ•°è§£é‡Šï¼š</p>
<ul>
<li><p><code>&lt;object-class&gt;</code>- æ˜¯ä» <code>0</code> åˆ° <code>(classes-1)</code>çš„æ•´æ•°ï¼Œä»£è¡¨å…·ä½“çš„ç±»åˆ«ã€‚</p>
</li>
<li><p><code>&lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;</code> -  æ˜¯å½’ä¸€åŒ–åˆ°<code>(0.0 to 1.0]</code>ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯ç›¸å¯¹äºå›¾ç‰‡æ•´ä½“çš„å®½å’Œé«˜çš„ä¸€ä¸ªç›¸å¯¹å€¼ã€‚</p>
</li>
<li><p>æ¯”å¦‚: <code>&lt;x&gt; = &lt;absolute_x&gt; / &lt;image_width&gt;</code> æˆ–è€… <code>&lt;height&gt; = &lt;absolute_height&gt; / &lt;image_height&gt;</code></p>
</li>
<li><p>éœ€è¦æ³¨æ„çš„æ˜¯: <code>&lt;x_center&gt; &lt;y_center&gt;</code> - æ˜¯æ ‡æ³¨æ¡†çš„ä¸­å¿ƒç‚¹ï¼Œè€Œä¸æ˜¯å·¦ä¸Šè§’ã€‚è¯·æ³¨æ„æ ¼å¼ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œimg1.txtä¸­å†…å®¹å¦‚ä¸‹ï¼Œä»£è¡¨æœ‰ä¸¤ä¸ªç±»åˆ«çš„ä¸‰ä¸ªç›®æ ‡ï¼š</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 0.716797 0.395833 0.216406 0.147222</span><br><span class="line">0 0.687109 0.379167 0.255469 0.158333</span><br><span class="line">1 0.420312 0.395833 0.140625 0.166667</span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>build\darknet\x64\data\</code>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºtrain.txtæ–‡ä»¶ï¼Œæ¯è¡ŒåŒ…å«çš„æ˜¯è®­ç»ƒé›†å›¾ç‰‡çš„å†…å®¹ã€‚å…¶è·¯å¾„æ˜¯ç›¸å¯¹äº <code>darknet.exe</code>çš„è·¯å¾„æˆ–è€…ç»å¯¹è·¯å¾„ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x2F;obj&#x2F;img1.jpg</span><br><span class="line">data&#x2F;obj&#x2F;img2.jpg</span><br><span class="line">data&#x2F;obj&#x2F;img3.jpg</span><br></pre></td></tr></table></figure>
<ol>
<li><p>ä¸‹è½½é¢„è®­ç»ƒæƒé‡ï¼Œå¹¶å°†å…¶æ”¾åœ¨ <code>build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<ul>
<li>å¯¹äº<code>csresnext50-panet-spp.cfg</code> (133 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>yolov3.cfg, yolov3-spp.cfg</code> (154 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>yolov3-tiny-prn.cfg , yolov3-tiny.cfg</code> (6 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>enet-coco.cfg (EfficientNetB0-Yolov3)</code>ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
</ul>
</li>
<li><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå¼€å§‹è®­ç»ƒ: <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74</code>ã€‚</p>
<p>å¯¹äºlinuxç”¨æˆ·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ: <code>./darknet detector train data/obj.data yolo-obj.cfg darknet53.conv.74</code> (ä½¿ç”¨<code>./darknet</code> è€Œä¸æ˜¯ <code>darknet.exe</code>)ã€‚</p>
<p>å¦‚æœæƒ³è®­ç»ƒçš„è¿‡ç¨‹ä¸­åŒæ­¥æ˜¾ç¤ºmAPï¼ˆæ¯å››ä¸ªepochè¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼‰ï¼Œè¿è¡Œå‘½ä»¤: <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -map</code>ã€‚</p>
<ul>
<li>æƒé‡æ–‡ä»¶ <code>yolo-obj_last.weights</code> å°†ä¼šä¿å­˜åœ¨ <code>build\darknet\x64\backup\</code> æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯100ä¸ªè¿­ä»£ä¿å­˜ä¸€æ¬¡ã€‚</li>
<li>æƒé‡æ–‡ä»¶<code>yolo-obj_xxxx.weights</code> å°†ä¼šä¿å­˜åœ¨ <code>build\darknet\x64\backup\</code> æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯1000ä¸ªè¿­ä»£ä¿å­˜ä¸€æ¬¡ã€‚</li>
<li>å¦‚æœä¸æƒ³åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­åŒæ­¥å±•ç¤ºlossæ›²çº¿ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -dont_show</code>ã€‚</li>
<li>å¦‚æœæƒ³åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŸ¥çœ‹mAPå’ŒLossæ›²çº¿ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -dont_show -mjpeg_port 8090 -map</code> ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL <code>http://ip-address:8090</code> ã€‚</li>
</ul>
</li>
<li><p>è®­ç»ƒç»“æŸä»¥åï¼Œå°†ä¼šåœ¨æ–‡ä»¶å¤¹<code>build\darknet\x64\backup\</code>ä¸­å¾—åˆ°æƒé‡æ–‡ä»¶ <code>yolo-obj_final.weights</code> ã€‚</p>
</li>
</ol>
<ul>
<li>åœ¨100æ¬¡è¿­ä»£ä»¥åï¼Œä½ å¯ä»¥åœä¸‹æ¥ï¼Œç„¶åä»è¿™ä¸ªç‚¹åŠ è½½æ¨¡å‹ç»§ç»­è®­ç»ƒã€‚æ¯”å¦‚è¯´, ä½ åœ¨2000æ¬¡è¿­ä»£ä»¥ååœæ­¢è®­ç»ƒï¼Œå¦‚æœä½ ä¹‹åæƒ³è¦æ¢å¤è®­ç»ƒï¼Œåªéœ€è¦è¿è¡Œå‘½ä»¤ï¼š <code>darknet.exe detector train data/obj.data yolo-obj.cfg backup\yolo-obj_2000.weights</code>ï¼Œè€Œä¸éœ€è¦é‡å¤´å¼€å§‹è®­ç»ƒã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ol>
<li>å¦‚æœåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°<code>avg</code>æŒ‡æ ‡å˜ä¸º<code>nan</code>ï¼Œé‚£è¯æ˜è®­ç»ƒè¿‡ç¨‹æœ‰è¯¯ï¼Œå¯èƒ½æ˜¯æ•°æ®æ ‡æ³¨è¶Šç•Œå¯¼è‡´çš„é—®é¢˜ã€‚ä½†æ˜¯å…¶ä»–æŒ‡æ ‡æœ‰<code>nan</code>æ˜¯æ­£å¸¸çš„ã€‚</li>
<li>ä¿®æ”¹<code>width</code>,<code>height</code>çš„æ—¶å€™å¿…é¡»è¦ä¿è¯ä¸¤è€…éƒ½èƒ½å¤Ÿè¢«32æ•´é™¤ã€‚</li>
<li>è®­ç»ƒç»“æŸåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•ï¼š<code>darknet.exe detector test data/obj.data yolo-obj.cfg yolo-obj_8000.weights</code></li>
<li>å¦‚æœå‡ºç°<code>Ouf of memery</code>é—®é¢˜ï¼Œé‚£è¯´æ˜æ˜¾å¡çš„æ˜¾å­˜ä¸å¤Ÿï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>subdivisions</code>å‚æ•°ï¼Œå°†å…¶ä»åŸæ¥çš„<code>16</code>æé«˜ä¸º<code>32</code>æˆ–è€…<code>64</code>ï¼Œè¿™æ ·å°±èƒ½é™ä½ä½¿ç”¨çš„æ˜¾å­˜ï¼Œä¿è¯ç¨‹åºæ­£å¸¸è¿è¡Œã€‚</li>
</ol>
<h3 id="6-4-è®­ç»ƒtiny-yolo"><a href="#6-4-è®­ç»ƒtiny-yolo" class="headerlink" title="6.4 è®­ç»ƒtiny-yolo"></a>6.4 è®­ç»ƒtiny-yolo</h3><p>è®­ç»ƒtiny yoloä¸ä»¥ä¸Šçš„è®­ç»ƒè¿‡ç¨‹å¹¶æ— æ˜æ˜¾åŒºåˆ«ï¼Œé™¤äº†ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ä¸‹è½½tiny yoloçš„é¢„è®­ç»ƒæƒé‡ï¼š<code>https://pjreddie.com/media/files/yolov3-tiny.weights</code></li>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œæ¥è·å–é¢„è®­ç»ƒæƒé‡: <code>darknet.exe partial cfg/yolov3-tiny.cfg yolov3-tiny.weights yolov3-tiny.conv.15 15</code>ï¼Œ è¿™é‡Œçš„15ä»£è¡¨å‰15ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯backboneæ‰€åœ¨çš„å±‚ã€‚</li>
<li>ä½¿ç”¨çš„é…ç½®æ–‡ä»¶åº”è¯¥æ˜¯ <code>cfg/yolov3-tiny_obj.cfg</code> è€Œä¸æ˜¯ <code>yolov3.cfg</code></li>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ: <code>darknet.exe detector train data/obj.data yolov3-tiny-obj.cfg yolov3-tiny.conv.15</code></li>
</ul>
<p>å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–backboneè¿›è¡Œè®­ç»ƒæ¯”å¦‚ DenseNet201-Yoloæˆ–è€…ResNet50-Yolo, ä½ å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­æ‰¾åˆ°:<code>https://github.com/AlexeyAB/darknet/blob/master/build/darknet/x64/partial.cmd</code></p>
<p>å¦‚æœä½ é‡‡ç”¨çš„æ˜¯è‡ªå·±è®¾è®¡çš„backbone,é‚£å°±æ— æ³•è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œbackboneå¯ä»¥ç›´æ¥è¿›è¡Œå‚æ•°éšæœºåˆå§‹åŒ–ã€‚</p>
<h3 id="6-5-ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ"><a href="#6-5-ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ" class="headerlink" title="6.5 ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ"></a>6.5 ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ</h3><p>å»ºè®®ä¸ºæ¯ä¸ªç±»åˆ†é…è‡³å°‘2000æ¬¡è¿­ä»£ï¼Œä½†æ˜¯æ•´ä½“è¿­ä»£æ¬¡æ•°ä¸åº”å°‘äº4000æ¬¡ã€‚å¦‚æœæƒ³è¦æ›´åŠ ç²¾å‡†åœ°å®šä¹‰ä»€ä¹ˆæ—¶å€™è¯¥åœæ­¢è®­ç»ƒï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li>è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä½ å°†ä¼šçœ‹åˆ°æ—¥å¿—ä¸­æœ‰å¾ˆå¤šé”™è¯¯çš„åº¦é‡æŒ‡æ ‡ï¼Œä½ éœ€è¦åœ¨avgæŒ‡æ ‡ä¸å†ä¸‹é™çš„æ—¶å€™åœæ­¢è®­ç»ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</li>
</ol>
<blockquote>
<p>Region Avg IOU: 0.798363, Class: 0.893232, Obj: 0.700808, No Obj: 0.004567, Avg Recall: 1.000000,  count: 8 Region Avg IOU: 0.800677, Class: 0.892181, Obj: 0.701590, No Obj: 0.004574, Avg Recall: 1.000000,  count: 8</p>
<p><strong>9002</strong>: 0.211667, <strong>0.60730 avg</strong>, 0.001000 rate, 3.868000 seconds, 576128 images Loaded: 0.000000 seconds</p>
</blockquote>
<ul>
<li><p><strong>9002</strong> - ä»£è¡¨å½“å‰çš„è¿­ä»£æ¬¡æ•°ã€‚</p>
</li>
<li><p><strong>0.60730 avg</strong> - average loss (error) - <strong>è¿™ä¸ªæŒ‡æ ‡æ˜¯å¹³å‡loss, å…¶è¶Šä½è¶Šå¥½ã€‚</strong></p>
<p>åœ¨è¿™ä¸ªæŒ‡æ ‡ä¸å†ä¸‹é™çš„æ—¶å€™å°±å¯ä»¥åœæ­¢è®­ç»ƒäº†ã€‚æœ€ç»ˆçš„å€¼å¤§æ¦‚åˆ†å¸ƒåœ¨0.05-3.0ä¹‹é—´ï¼Œå°è€Œç®€å•çš„æ¨¡å‹é€šå¸¸æœ€ç»ˆlossæ¯”è¾ƒå°ï¼Œå¤§è€Œå¤æ‚çš„losså¯èƒ½ä¼šæ¯”è¾ƒå¤§ã€‚</p>
</li>
</ul>
<p>è®­ç»ƒå®Œæˆåï¼Œä½ å°±å¯ä»¥ä» <code>darknet\build\darknet\x64\backup</code> æ–‡ä»¶å¤¹ä¸­å–å‡ºæ¯”è¾ƒé åçš„å‡ ä¸ª<code>weights</code>æ–‡ä»¶ï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œæµ‹è¯•ï¼Œé€‰æ‹©æœ€å¥½çš„æƒé‡æ–‡ä»¶ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ åœ¨<code>9000</code>æ¬¡è¿­ä»£ååœæ­¢è®­ç»ƒï¼Œä½†æœ€å¥½çš„æƒé‡å¯èƒ½æ˜¯<code>7000,8000,9000</code>æ¬¡çš„å€¼ã€‚è¿™ç§æƒ…å†µçš„å‡ºç°æ˜¯ç”±äº<strong>è¿‡æ‹Ÿåˆ</strong>å¯¼è‡´çš„ã€‚<strong>è¿‡æ‹Ÿåˆ</strong>æ˜¯ç”±äºè¿‡åº¦å­¦ä¹ è®­ç»ƒé›†çš„åˆ†å¸ƒï¼Œè€Œé™ä½äº†æ¨¡å‹åœ¨æµ‹è¯•é›†çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<p><strong>Early Stopping Point</strong>ç¤ºæ„å›¾:</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/642.webp" alt></p>
<p>ä¸ºäº†å¾—åˆ°åœ¨early stopping pointå¤„çš„æƒé‡ï¼š</p>
<p>2.1 é¦–å…ˆï¼Œä½ çš„obj.dataæ–‡ä»¶ä¸­åº”è¯¥å«æœ‰valid=valid.txtä¸€é¡¹ï¼Œç”¨äºæµ‹è¯•åœ¨éªŒè¯é›†çš„å‡†ç¡®ç‡ã€‚å¦‚æœä½ æ²¡æœ‰éªŒè¯é›†å›¾ç‰‡ï¼Œé‚£å°±ç›´æ¥å¤åˆ¶train.txté‡å‘½åä¸ºvalid.txtã€‚</p>
<p>2.2 å‡å¦‚ä½ é€‰æ‹©åœ¨<code>9000</code>æ¬¡è¿­ä»£ååœæ­¢ï¼Œé‚£å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æµ‹è¯•<code>7000,8000,9000</code>ä¸‰ä¸ªæ¨¡å‹çš„ç›¸å…³æŒ‡æ ‡ã€‚é€‰æ‹©æœ€é«˜<code>mAP</code>æˆ–è€…æœ€é«˜<code>IoU</code>çš„æ¨¡å‹æœ€ä¸ºæœ€ç»ˆæ¨¡å‹ã€‚</p>
<ul>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights</code></li>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_8000.weights</code></li>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_9000.weights</code></li>
</ul>
<p>æˆ–è€…ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨<code>-map</code>æ ‡å¿—ç¬¦æ¥ç›´æ¥å®æ—¶æµ‹è¯•mAPå€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">darknet.exe detector train data&#x2F;obj.data yolo-obj.cfg darknet53.conv.74 -map</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½ å°±èƒ½å¾—åˆ°lossæ›²çº¿å’ŒmAPæ›²çº¿ï¼ŒmAPæ¯4ä¸ªepochå¯¹éªŒè¯é›†è¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼Œå¹¶å°†ç»“æœæ˜¾ç¤ºåœ¨å›¾ä¸­ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/643.webp" alt></p>
<p>æŒ‡æ ‡è§£é‡Š</p>
<ul>
<li><p><strong>IoU</strong> (intersect over union) - å¹³å‡äº¤å¹¶æ¯”</p>
</li>
<li><p><strong>mAP</strong> (mean average precision) - æ¯ä¸ªç±»çš„å¹³å‡ç²¾åº¦ã€‚</p>
</li>
</ul>
<p><strong>mAP</strong> æ˜¯Pascal VOCç«èµ›çš„é»˜è®¤æŒ‡æ ‡ï¼Œä¸MS COCOç«èµ›ä¸­çš„AP50æŒ‡æ ‡æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>Precisionå’ŒRecallå‚æ•°åœ¨Pascal VOCç«èµ›ä¸­ç•¥å¾®ä¸åŒï¼Œä½† <strong>IoU çš„æ„ä¹‰éƒ½æ˜¯ç›¸åŒçš„</strong>ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/644.jpg" alt></p>
<h3 id="6-6-å¦‚ä½•åœ¨pascal-voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡"><a href="#6-6-å¦‚ä½•åœ¨pascal-voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡" class="headerlink" title="6.6 å¦‚ä½•åœ¨pascal voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡"></a>6.6 å¦‚ä½•åœ¨pascal voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡</h3><ol>
<li>åœ¨VOC2007ä¸­è®¡ç®—mAPï¼š</li>
</ol>
<ul>
<li>ä¸‹è½½VOCæ•°æ®é›†ï¼Œå®‰è£…pythonå¹¶ä¸”ä¸‹è½½<code>`2007_test.txt</code>æ–‡ä»¶ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé“¾æ¥ï¼š<code>https://github.com/AlexeyAB/darknet#how-to-train-pascal-voc-data</code></li>
<li>ä¸‹è½½æ–‡ä»¶ <code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/scripts/voc_label_difficult.py</code> åˆ° <code>build\darknet\x64\data\</code> æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œ <code>voc_label_difficult.py</code> ä»è€Œå¾—åˆ° <code>difficult_2007_test.txt</code>ã€‚</li>
<li>å°†ä¸‹é¢voc.dataæ–‡ä»¶ä¸­çš„ç¬¬å››è¡Œ#åˆ é™¤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">classes&#x3D; 20</span><br><span class="line">train  &#x3D; data&#x2F;train_voc.txt</span><br><span class="line">valid  &#x3D; data&#x2F;2007_test.txt</span><br><span class="line">#difficult &#x3D; data&#x2F;difficult_2007_test.txt</span><br><span class="line">names &#x3D; data&#x2F;voc.names</span><br><span class="line">backup &#x3D; backup&#x2F;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥è®¡ç®—å¾—åˆ°mAP:</p>
<ol>
<li>ä½¿ç”¨Darknet + Python: è¿è¡Œ <code>build/darknet/x64/calc_mAP_voc_py.cmd</code> ï¼Œä½ å°†å¾—åˆ° <code>yolo-voc.cfg</code> æ¨¡å‹çš„mAPå€¼, mAP = 75.9%</li>
<li>ç›´æ¥ä½¿ç”¨å‘½ä»¤: è¿è¡Œæ–‡ä»¶ <code>build/darknet/x64/calc_mAP.cmd</code> -ä½ å°†å¾—åˆ° <code>yolo-voc.cfg</code> æ¨¡å‹, å¾—åˆ°mAP = 75.8%</li>
</ol>
<p>YOLOv3çš„è®ºæ–‡ï¼š<code>https://arxiv.org/pdf/1612.08242v1.pdf</code>æŒ‡å‡ºå¯¹äº416x416çš„YOLOv2ï¼ŒPascal Vocä¸Šçš„mAPå€¼æ˜¯76.8%ã€‚æˆ‘ä»¬å¾—åˆ°çš„å€¼è¾ƒä½ï¼Œå¯èƒ½æ˜¯ç”±äºæ¨¡å‹åœ¨è¿›è¡Œæ£€æµ‹æ—¶çš„ä»£ç ç•¥æœ‰ä¸åŒã€‚</p>
<p>å¦‚æœä½ æƒ³ä¸º<code>tiny-yolo-voc</code>è®¡ç®—mAPå€¼ï¼Œå°†è„šæœ¬ä¸­<code>tiny-yolo-voc.cfg</code>å–æ¶ˆæ³¨é‡Šï¼Œå°†<code>yolo-voc.cfg</code>æ³¨é‡Šæ‰ã€‚</p>
<p>å¦‚æœä½ æ˜¯ç”¨çš„æ˜¯python 2.x è€Œä¸æ˜¯python 3.x, è€Œä¸”ä½ é€‰æ‹©ä½¿ç”¨Darknet+Pythonçš„æ–¹å¼æ¥è®¡ç®—mAP, é‚£ä½ åº”è¯¥ä½¿ç”¨ <code>reval_voc.py</code> å’Œ <code>voc_eval.py</code> è€Œä¸æ˜¯ä½¿ç”¨ <code>reval_voc_py3.py</code> å’Œ <code>voc_eval_py3.py</code> ã€‚ä»¥ä¸Šè„šæœ¬æ¥è‡ªä»¥ä¸‹ç›®å½•ï¼š<code>https://github.com/AlexeyAB/darknet/tree/master/scripts</code>ã€‚</p>
<p>ç›®æ ‡æ£€æµ‹çš„ä¾‹å­ï¼š<code>darknet.exe detector test data/obj.data yolo-obj.cfg yolo-obj_8000.weights</code></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/645.webp" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/ABDarknet/646.webp" alt></p>
<h2 id="7-å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ"><a href="#7-å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ" class="headerlink" title="7. å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ"></a>7. å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ</h2><ol>
<li><p>è®­ç»ƒä¹‹å‰ï¼š</p>
<ul>
<li><code>train_network_width * train_obj_width / train_image_width ~= detection_network_width *  detection_obj_width / detection_image_width</code></li>
<li><p><code>train_network_height * train_obj_height / train_image_height ~= detection_network_height *  detection_obj_height / detection_image_height</code></p>
</li>
<li><p>å®Œæ•´æ¨¡å‹ï¼ˆ5ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3_5l.cfg</code>ã€‚</p>
</li>
<li><p>Tinyæ¨¡å‹ï¼ˆ3ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3-tiny_3l.cfg</code>ã€‚</p>
</li>
<li><p>å¸¦ç©ºé—´é‡‘å­—å¡”æ± åŒ–çš„å®Œæ•´æ¨¡å‹ï¼ˆ3ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3-spp.cfg</code>ã€‚</p>
</li>
<li><p>åœ¨<code>cfg</code>æ–‡ä»¶ä¸­å°†<code>random</code>è®¾ä¸º1ï¼šè¿™å°†åœ¨Yoloä¸­ä½¿ç”¨å¤šå°ºåº¦è®­ç»ƒï¼Œä¼šæå‡æ£€æµ‹æ¨¡å‹å‡†ç¡®ç‡ã€‚</p>
</li>
<li><p>åœ¨<code>cfg</code>æ–‡ä»¶ä¸­æŠŠè¾“å…¥åˆ†è¾¨ç‡å¢å¤§(<code>height=608</code>, <code>width=608</code>æˆ–è€…å…¶ä»–ä»»æ„32çš„å€æ•°)ï¼šè¿™å°†æå‡æ£€æµ‹æ¨¡å‹å‡†ç¡®ç‡ã€‚</p>
</li>
<li><p>æ£€æŸ¥ä½ è¦æ£€æµ‹çš„æ¯ä¸ªç›®æ ‡åœ¨æ•°æ®é›†ä¸­æ˜¯å¦è¢«æ ‡è®°ï¼Œæ•°æ®é›†ä¸­ä»»ä½•ç›®æ ‡éƒ½ä¸åº”è¯¥æ²¡æœ‰æ ‡ç­¾ã€‚åœ¨å¤§å¤šæ•°è®­ç»ƒå‡ºé—®é¢˜çš„æƒ…å†µä¸­åŸºæœ¬éƒ½æ˜¯æœ‰é”™è¯¯çš„æ ‡ç­¾ï¼ˆé€šè¿‡ä½¿ç”¨æŸäº›è½¬æ¢è„šæœ¬ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ ‡æ³¨æ¥è·å¾—æ ‡ç­¾ï¼‰ï¼Œå¯ä»¥é€šè¿‡<code>https://github.com/AlexeyAB/Yolo_mark</code>æ¥æ£€æŸ¥ä½ çš„æ•°æ®é›†æ˜¯å¦å…¨éƒ¨æ ‡æ³¨æ­£ç¡®ã€‚</p>
</li>
<li><p>æˆ‘çš„æŸå¤±å‡½æ•°å¾ˆé«˜å¹¶ä¸”mAPå¾ˆä½ï¼Œè®­ç»ƒå‡ºé”™äº†å—ï¼Ÿåœ¨è®­ç»ƒå‘½ä»¤æœ«ç«¯ä½¿ç”¨<code>-show_imgs</code> æ ‡å¿—æ¥è¿è¡Œè®­ç»ƒï¼Œä½ æ˜¯å¦èƒ½çœ‹åˆ°æœ‰æ­£ç¡®çš„è¾¹ç•Œé¢„æµ‹æ¡†çš„ç›®æ ‡ï¼ˆåœ¨çª—å£æˆ–è€…<code>aug_...jpg</code>ï¼‰ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œè®­ç»ƒæ˜¯å‘ç”Ÿé”™è¯¯äº†ã€‚</p>
</li>
<li><p>å¯¹äºä½ è¦æ£€æµ‹çš„æ¯ä¸ªç›®æ ‡ï¼Œè®­ç»ƒæ•°æ®é›†ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç›¸ä¼¼çš„ç›®æ ‡ï¼Œå®ƒä»¬å…·æœ‰å¤§è‡´ç›¸åŒçš„å½¢çŠ¶ï¼Œç‰©ä½“ä¾§é¢å§¿æ€ï¼Œç›¸å¯¹å¤§å°ï¼Œæ—‹è½¬è§’åº¦ï¼Œå€¾æ–œåº¦ï¼Œç…§æ˜åº¦ç­‰ã€‚ç†æƒ³çš„æ˜¯ï¼Œä½ çš„è®­ç»ƒæ•°æ®é›†åŒ…æ‹¬å…·æœ‰ä¸åŒæ¯”ä¾‹ï¼Œæ—‹è½¬è§’åº¦ï¼Œç…§æ˜åº¦ï¼Œç‰©ä½“ä¾§é¢å§¿æ€å’Œå¤„äºä¸åŒèƒŒæ™¯çš„ç›®æ ‡å›¾åƒï¼Œä½ æœ€å¥½æ‹¥æœ‰2000å¼ ä¸åŒçš„å›¾åƒï¼Œå¹¶ä¸”è‡³å°‘è®­ç»ƒ<code>2000Ã—classes</code>è½®æ¬¡ã€‚</p>
</li>
<li><p>å¸Œæœ›ä½ çš„è®­ç»ƒæ•°æ®é›†å›¾ç‰‡åŒ…å«ä½ ä¸æƒ³æ£€æµ‹çš„æœªæ ‡æ³¨çš„ç›®æ ‡ï¼Œä¹Ÿå³æ˜¯æ— è¾¹ç•Œæ¡†çš„è´Ÿæ ·æœ¬å›¾ç‰‡(ç©ºçš„<code>.txt</code>æ–‡ä»¶)ï¼Œå¹¶ä¸”è´Ÿæ ·æœ¬å›¾ç‰‡çš„æ•°é‡å’Œå¸¦æœ‰ç›®æ ‡çš„æ­£æ ·æœ¬å›¾ç‰‡æ•°é‡æœ€å¥½ä¸€æ ·å¤šã€‚</p>
</li>
<li><p>æ ‡æ³¨ç›®æ ‡çš„æœ€ä½³æ–¹æ³•æ˜¯ï¼šä»…ä»…æ ‡è®°ç›®æ ‡çš„å¯è§éƒ¨åˆ†æˆ–è€…æ ‡è®°ç›®æ ‡çš„å¯è§å’Œé‡å éƒ¨åˆ†ï¼Œæˆ–æ ‡è®°æ¯”æ•´ä¸ªç›®æ ‡å¤šä¸€ç‚¹(æœ‰ä¸€ç‚¹é—´éš™)?æ ¹æ®ä½ å¸Œæœ›å¦‚ä½•æ£€æµ‹ç›®æ ‡æ¥è¿›è¡Œæ ‡è®°ã€‚</p>
</li>
<li><p>ä¸ºäº†å¯¹å›¾ç‰‡ä¸­åŒ…å«å¤§é‡ç›®æ ‡çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæ·»åŠ <code>max=200</code>æˆ–è€…æ›´é«˜çš„å€¼åœ¨ä½ <code>cfg</code>æ–‡ä»¶ä¸­<code>yolo</code>å±‚æˆ–è€…<code>region</code>å±‚çš„æœ€åä¸€è¡Œï¼ˆYOLOv3å¯ä»¥æ£€æµ‹åˆ°çš„ç›®æ ‡å…¨å±€æœ€å¤§æ•°é‡ä¸º<code>0,0615234375*(width*height)</code>å…¶ä¸­<code>width</code>å’Œ<code>height</code>æ˜¯åœ¨<code>cfg</code>æ–‡ä»¶ä¸­çš„<code>[net]</code>éƒ¨åˆ†æŒ‡å®šçš„ï¼‰ã€‚</p>
</li>
<li><p>å¯¹äºå°ç›®æ ‡çš„è®­ç»ƒï¼ˆæŠŠå›¾åƒresizeåˆ°416x416å¤§å°åå°äº16x16çš„ç›®æ ‡ï¼‰ï¼šè®¾ç½®<code>layers = -1, 11</code>è€Œä¸æ˜¯<code>layers=-1, 36</code>ï¼›è®¾ç½®<code>stride=4</code>è€Œä¸æ˜¯<code>stride=2</code>ã€‚</p>
</li>
<li><p>å¯¹äºæ—¢æœ‰å¤§ç›®æ ‡åˆæœ‰å°ç›®æ ‡çš„è®­ç»ƒä½¿ç”¨ä¸‹é¢çš„æ¨¡å‹ï¼š</p>
</li>
<li><p>å¦‚æœä½ è¦è®­ç»ƒæ¨¡å‹å°†å·¦å³ç›®æ ‡åˆ†ä¸ºå•ç‹¬çš„ç±»åˆ«ï¼ˆå·¦/å³æ‰‹ï¼Œå·¦/å³äº¤é€šæ ‡å¿—ï¼‰ï¼Œé‚£å°±ç¦ç”¨ç¿»è½¬çš„æ•°æ®æ‰©å……æ–¹å¼ï¼Œå³åœ¨æ•°æ®è¾“å…¥éƒ¨åˆ†æ·»åŠ <code>flip=0</code>ã€‚</p>
</li>
<li><p>ä¸€èˆ¬è§„åˆ™ï¼šä½ çš„è®­ç»ƒæ•°æ®é›†åº”åŒ…æ‹¬ä¸€ç»„æ‚¨æƒ³è¦æ£€æµ‹çš„ç›¸å¯¹å¤§å°çš„ç›®æ ‡ï¼Œå¦‚ä¸‹ï¼š</p>
<p>å³ï¼Œå¯¹äºæµ‹è¯•é›†ä¸­çš„æ¯ä¸ªç›®æ ‡ï¼Œè®­ç»ƒé›†ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåŒç±»ç›®æ ‡å’Œå®ƒå…·æœ‰å¤§çº¦ç›¸åŒçš„å°ºå¯¸ï¼š</p>
<p><code>object width in percent from Training dataset</code> ~= <code>object width in percent from Test dataset</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè®­ç»ƒé›†ä¸­ä»…å­˜åœ¨å å›¾åƒæ¯”ä¾‹80%-90%çš„ç›®æ ‡ï¼Œåˆ™è®­ç»ƒåçš„ç›®æ ‡æ£€æµ‹ç½‘ç»œå°†æ— æ³•æ£€æµ‹åˆ°å å›¾åƒæ¯”ä¾‹ä¸º1-10%çš„ç›®æ ‡ã€‚</p>
</li>
<li><p>ä¸ºäº†åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼ˆåŒæ—¶ä¼šé™ä½æ£€æµ‹ç²¾åº¦ï¼‰ä½¿ç”¨å¾®è°ƒè€Œä¸æ˜¯è¿ç§»å­¦ä¹ ï¼Œåœ¨[net]ä¸‹é¢è®¾ç½®<code>stopbackward=1</code>ã€‚ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<code>./darknet partial cfg/yolov3.cfg yolov3.weights yolov3.conv.81 81</code>è¿™å°†ä¼šåˆ›å»º<code>yolov3.conv.81</code>æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨<code>yolov3.conv.81</code>æ–‡ä»¶è¿›è¡Œè®­ç»ƒè€Œä¸æ˜¯<code>darknet53.conv.74</code>ã€‚</p>
</li>
<li><p>åœ¨è§‚å¯Ÿç›®æ ‡çš„æ—¶å€™ï¼Œä»ä¸åŒçš„æ–¹å‘ã€ä¸åŒçš„ç…§æ˜æƒ…å†µã€ä¸åŒå°ºåº¦ã€ä¸åŒçš„è½¬è§’å’Œå€¾æ–œè§’åº¦æ¥çœ‹ï¼Œå¯¹ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸åŒçš„ç›®æ ‡ã€‚å› æ­¤ï¼Œè¦æ£€æµ‹çš„ç›®æ ‡è¶Šå¤šï¼Œåº”ä½¿ç”¨è¶Šå¤æ‚çš„ç½‘ç»œæ¨¡å‹ã€‚</p>
</li>
<li><p>ä¸ºäº†è®©æ£€æµ‹æ¡†æ›´å‡†ï¼Œä½ å¯ä»¥åœ¨æ¯ä¸ª<code>yolo</code>å±‚æ·»åŠ ä¸‹é¢ä¸‰ä¸ªå‚æ•°<code>ignore_thresh = .9 iou_normalizer=0.5 iou_loss=giou</code>ï¼Œè¿™å›æé«˜map@0.9ï¼Œä½†ä¼šé™ä½map@0.5ã€‚</p>
</li>
<li><p>å½“ä½ æ˜¯ç¥ç»ç½‘ç»œæ–¹é¢çš„ä¸“å®¶æ—¶ï¼Œå¯ä»¥é‡æ–°è®¡ç®—ç›¸å¯¹äº<code>width</code>å’Œ<code>height</code>çš„<code>anchors</code>ï¼š<code>darknet.exe detector calc_anchors data/obj.data -num_of_clusters 9 -width 416 -height 416</code>ç„¶ååœ¨3ä¸ª<code>[yolo]</code>å±‚æ”¾ç½®è¿™9ä¸ª<code>anchors</code>ã€‚ä½†æ˜¯ä½ éœ€è¦ä¿®æ”¹æ¯ä¸ª<code>[yolo]</code>å±‚çš„<code>masks</code>å‚æ•°ï¼Œè®©ç¬¬ä¸€ä¸ª<code>[yolo]</code>å±‚çš„<code>anchors</code>å°ºå¯¸å¤§äº60x60ï¼Œç¬¬äºŒä¸ª<code>[yolo]</code>å±‚çš„<code>anchors</code>å°ºå¯¸å¤§äº30x30ï¼Œå‰©ä¸‹å°±æ˜¯ç¬¬ä¸‰ä¸ª<code>[yolo]</code>å±‚çš„<code>mask</code>ã€‚å®å¤–ï¼Œä½ éœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ª<code>[yolo]</code>å±‚å‰é¢çš„<code>filters=(classes + 5)x</code>ã€‚å¦‚æœå¾ˆå¤šè®¡ç®—çš„<code>anchors</code>éƒ½æ‰¾ä¸åˆ°åˆé€‚çš„å±‚ï¼Œé‚£è¿˜æ˜¯ä½¿ç”¨Yoloçš„é»˜è®¤<code>anchors</code>å§ã€‚</p>
</li>
</ul>
</li>
<li><p>è®­ç»ƒä¹‹åï¼š</p>
<ul>
<li>æ²¡æœ‰å¿…è¦é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œç›´æ¥ä½¿ç”¨ç”¨<code>416x416</code>åˆ†è¾¨ç‡è®­ç»ƒå‡ºæ¥çš„<code>.weights</code>æ¨¡å‹æ–‡ä»¶ã€‚</li>
<li>ä½†æ˜¯è¦è·å¾—æ›´é«˜çš„å‡†ç¡®ç‡ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>608x608</code>æˆ–è€…<code>832x832</code>æ¥è®­ç»ƒï¼Œæ³¨æ„å¦‚æœ<code>Out of memory</code>å‘ç”Ÿäº†ï¼Œä½ åº”è¯¥åœ¨<code>.cfg</code>æ–‡ä»¶ä¸­å¢åŠ <code>subdivisions=16ï¼Œ32ï¼Œ64</code>ã€‚</li>
<li>é€šè¿‡åœ¨<code>.cfg</code>æ–‡ä»¶ä¸­è®¾ç½®ï¼ˆ<code>height=608</code> and <code>width=608</code>ï¼‰æˆ–è€…ï¼ˆ<code>height=832</code> and <code>width=832</code>ï¼‰æˆ–è€…ä»»ä½•32çš„å€æ•°ï¼Œè¿™ä¼šæå‡å‡†ç¡®ç‡å¹¶ä½¿å¾—å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ›´åŠ å®¹æ˜“ã€‚</li>
</ul>
</li>
</ol>
<h2 id="8-å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶"><a href="#8-å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶" class="headerlink" title="8. å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶"></a>8. å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶</h2><p>ä¸‹é¢çš„å·¥ç¨‹æä¾›äº†ç”¨äºæ ‡è®°ç›®æ ‡è¾¹ç•Œæ¡†å¹¶ä¸ºYOLO v2&amp;v3 ç”Ÿæˆæ ‡æ³¨æ–‡ä»¶çš„å¸¦å›¾åƒç•Œé¢è½¯ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://github.com/AlexeyAB/Yolo_mark</code>ã€‚</p>
<p>ä¾‹å¦‚å¯¹äºåªæœ‰ä¸¤ç±»ç›®æ ‡çš„æ•°æ®é›†æ ‡æ³¨åæœ‰ä»¥ä¸‹æ–‡ä»¶<code>train.txt</code>,<code>obj.names</code>,<code>obj.data</code>,<code>yolo-obj.cfg</code>,<code>air 1-6.txt</code>,<code>bird 1-4.txt</code>ï¼Œæ¥ç€é…åˆ<code>train_obj.cmd</code>å°±å¯ä»¥ä½¿ç”¨YOLO v2å’ŒYOLO v3æ¥è®­ç»ƒè¿™ä¸ªæ•°æ®é›†äº†ã€‚</p>
<p>ä¸‹é¢æä¾›äº†5é‡å¸¸è§çš„ç›®æ ‡æ ‡æ³¨å·¥å…·ï¼š</p>
<ul>
<li>C++å®ç°çš„ï¼š<code>https://github.com/AlexeyAB/Yolo_mark</code></li>
<li>Pythonå®ç°çš„ï¼š<code>https://github.com/tzutalin/labelImg</code></li>
<li>Pythonå®ç°çš„ï¼š<code>https://github.com/Cartucho/OpenLabeling</code></li>
<li>C++å®ç°çš„ï¼š<code>https://www.ccoderun.ca/darkmark/</code></li>
<li>JavaScriptå®ç°çš„ï¼š<code>https://github.com/opencv/cvat</code></li>
</ul>
<h2 id="9-ä½¿ç”¨YOLO9000"><a href="#9-ä½¿ç”¨YOLO9000" class="headerlink" title="9. ä½¿ç”¨YOLO9000"></a>9. ä½¿ç”¨YOLO9000</h2><p>åŒæ—¶æ£€æµ‹å’Œåˆ†ç±»9000ä¸ªç›®æ ‡ï¼š<code>darknet.exe detector test cfg/combine9k.data cfg/yolo9000.cfg yolo9000.weights data/dog.jpg</code></p>
<ul>
<li><p><code>yolo9000.weights</code>ï¼š186Mbçš„YOLO9000æ¨¡å‹éœ€è¦4G GPUæ˜¾å­˜ï¼Œè®­ç»ƒå¥½çš„æ¨¡å‹ä¸‹è½½åœ°å€ï¼š<code>http://pjreddie.com/media/files/yolo9000.weights</code>ã€‚</p>
</li>
<li><p><code>yolo9000.cfg</code>ï¼šYOLO9000çš„cç½‘ç»œç»“æ„æ–‡ä»¶ï¼ŒåŒæ—¶è¿™é‡Œä¹Ÿæœ‰<code>9k.tree</code>å’Œ<code>coco9k.map</code>æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tree&#x3D;data&#x2F;9k.tree</span><br><span class="line">map &#x3D; data&#x2F;coco9k.map</span><br></pre></td></tr></table></figure>
<ul>
<li><code>9k.tree</code>ï¼š9418ä¸ªç±»åˆ«çš„å•è¯æ•°ï¼Œæ¯ä¸€è¡Œçš„å½¢å¼ä¸º<code>`ï¼Œå¦‚æœ</code>parent_id==-1<code>é‚£ä¹ˆè¿™ä¸ªæ ‡ç­¾æ²¡æœ‰çˆ¶ç±»åˆ«ï¼Œåœ°å€ä¸ºï¼š</code><a href="https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.tree`ã€‚" target="_blank" rel="noopener">https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.tree`ã€‚</a></li>
<li><code>coco9k.map</code>ï¼šå°†MSCOCOçš„80ä¸ªç›®æ ‡ç±»åˆ«æ˜ å°„åˆ°<code>9k.tree</code>çš„æ–‡ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/coco9k.map</code>ã€‚</li>
</ul>
</li>
<li><p><code>combine9k.data</code>ï¼šæ•°æ®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯<code>9k.labels</code>ã€‚<code>9k.names</code>ï¼Œ<code>inet9k.map</code>çš„è·¯å¾„ï¼ˆä¿®æ”¹<code>combine9k.train.list</code>æ–‡ä»¶çš„è·¯å¾„ä¸ºä½ è‡ªå·±çš„ï¼‰ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/combine9k.data</code>ã€‚</p>
</li>
<li><p><code>9k.labels</code>ï¼š9418ç±»ç›®æ ‡çš„æ ‡ç­¾ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.labels</code>ã€‚</p>
</li>
<li><p><code>9k.names</code>ï¼š9418ç±»ç›®æ ‡çš„åå­—ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.names</code>ã€‚</p>
</li>
<li><p><code>inet9k.map</code>ï¼šå°†ImageNetçš„200ä¸ªç›®æ ‡ç±»åˆ«æ˜ å°„åˆ°<code>9k.tree</code>çš„æ–‡ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/inet9k.map</code>ã€‚</p>
</li>
</ul>
<h2 id="10-å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ"><a href="#10-å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ" class="headerlink" title="10. å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ"></a>10. å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ</h2><ul>
<li><p>åœ¨Linuxä¸Šã€‚</p>
<ul>
<li>ä½¿ç”¨<code>build.sh</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>cmake</code>ç¼–è¯‘<code>darknet</code> æˆ–è€…</li>
<li>å°†<code>Makefile</code>é‡çš„<code>LIBSO=0</code>æ”¹ä¸º<code>LIBSO=1</code>ï¼Œç„¶åæ‰§è¡Œ<code>make</code>ç¼–è¯‘<code>darknet</code></li>
</ul>
</li>
<li><p>åœ¨Windowsä¸Šã€‚</p>
<ul>
<li>ä½¿ç”¨<code>build.ps1</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>cmake</code>ç¼–è¯‘<code>darknet</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>build\darknet\yolo_cpp_dll.sln</code>æˆ–<code>build\darknet\yolo_cpp_dll_no_gpu.sln</code>è§£å†³æ–¹æ³•ç¼–è¯‘<code>darknet</code></li>
</ul>
</li>
<li><p>è¿™é‡Œæœ‰ä¸¤ä¸ªAPIï¼š</p>
<ul>
<li>ä½¿ç”¨C++ APIçš„C++ä¾‹å­ï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/src/yolo_console_dll.cpp</code></li>
<li>ä½¿ç”¨C APIçš„Pythonä¾‹å­ï¼š<br><code>https://github.com/AlexeyAB/darknet/blob/master/darknet.py</code><br><code>https://github.com/AlexeyAB/darknet/blob/master/darknet_video.py</code></li>
<li>C APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/darknet.h</code></li>
<li>C++ APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/yolo_v2_class.hpp</code></li>
</ul>
</li>
</ul>
<h2 id="11-é™„å½•"><a href="#11-é™„å½•" class="headerlink" title="11. é™„å½•"></a>11. é™„å½•</h2><ol>
<li><p>ä¸ºäº†å°†Yoloç¼–è¯‘æˆC++çš„DLLæ–‡ä»¶<code>yolo_cpp_dll.dll</code>ï¼šæ‰“å¼€<code>build\darknet\yolo_cpp_dll.sln</code>è§£å†³æ–¹æ¡ˆï¼Œç¼–è¯‘é€‰é¡¹é€‰<strong>X64</strong>å’Œ<strong>Release</strong>ï¼Œç„¶åæ‰§è¡ŒBuild-&gt;Build yolo_cpp_dllå°±ï¼Œç¼–è¯‘çš„ä¸€äº›å‰ç½®æ¡ä»¶ä¸ºï¼š</p>
<ul>
<li>å®‰è£…<strong>CUDA 10.0</strong>ã€‚</li>
<li>ä¸ºäº†ä½¿ç”¨cuDNNæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼šç‚¹å‡»å·¥ç¨‹å±æ€§-&gt;properties-&gt;C++-&gt;Preprocessor-&gt;Preprocessor Definitionsï¼Œç„¶ååœ¨å¼€å¤´æ·»åŠ ä¸€è¡Œ<code>CUDNN</code>ã€‚</li>
</ul>
</li>
<li><p>åœ¨è‡ªå·±çš„C++å·¥ç¨‹ä¸­å°†Yoloå½“æˆDLLæ–‡ä»¶ä½¿ç”¨ï¼šæ‰“å¼€<code>build\darknet\yolo_console_dll.sln</code>è§£å†³æ–¹æ¡ˆï¼Œç¼–è¯‘é€‰é¡¹é€‰<strong>X64</strong>å’Œ<strong>Release</strong>ï¼Œç„¶åæ‰§è¡ŒBuild-&gt;Build yolo_console_dllï¼š</p>
<p><code>yolo_cpp_dll.dll</code>-APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/yolo_v2_class.hpp</code></p>
<ul>
<li>ä½ å¯ä»¥åˆ©ç”¨Windowsèµ„æºç®¡ç†å™¨è¿è¡Œ<code>build\darknet\x64\yolo_console_dll.exe</code>å¯æ‰§è¡Œç¨‹åºå¹¶<strong>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</strong>:  <code>yolo_console_dll.exe data/coco.names yolov3.cfg yolov3.weights test.mp4</code></li>
<li>å¯åŠ¨æ§åˆ¶å°åº”ç”¨ç¨‹åºå¹¶è¾“å…¥å›¾åƒæ–‡ä»¶ååï¼Œä½ å°†çœ‹åˆ°æ¯ä¸ªç›®æ ‡çš„ä¿¡æ¯ï¼š<code> </code></li>
<li>å¦‚æœè¦ä½¿ç”¨OpenCV-GUIä½ åº”è¯¥å°†<code>yolo_console_dll.cpp</code>ä¸­çš„<code>//#define OPENCV</code>å–æ¶ˆæ³¨é‡Šã€‚</li>
<li>ä½ å¯ä»¥çœ‹åˆ°è§†é¢‘æ£€æµ‹ä¾‹å­çš„æºä»£ç ï¼Œåœ°å€ä¸ºyolo_console_dll.cppçš„ç¬¬75è¡Œã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct bbox_t &#123;</span><br><span class="line">    unsigned int x, y, w, h;    &#x2F;&#x2F; (x,y) - top-left corner, (w, h) - width &amp; height of bounded box</span><br><span class="line">    float prob;                    &#x2F;&#x2F; confidence - probability that the object was found correctly</span><br><span class="line">    unsigned int obj_id;        &#x2F;&#x2F; class of object - from range [0, classes-1]</span><br><span class="line">    unsigned int track_id;        &#x2F;&#x2F; tracking id for video (0 - untracked, 1 - inf - tracked object)</span><br><span class="line">    unsigned int frames_counter;&#x2F;&#x2F; counter of frames on which the object was detected</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Detector &#123;</span><br><span class="line">public:</span><br><span class="line">        Detector(std::string cfg_filename, std::string weight_filename, int gpu_id &#x3D; 0);</span><br><span class="line">        ~Detector();</span><br><span class="line"></span><br><span class="line">        std::vector&lt;bbox_t&gt; detect(std::string image_filename, float thresh &#x3D; 0.2, bool use_mean &#x3D; false);</span><br><span class="line">        std::vector&lt;bbox_t&gt; detect(image_t img, float thresh &#x3D; 0.2, bool use_mean &#x3D; false);</span><br><span class="line">        static image_t load_image(std::string image_filename);</span><br><span class="line">        static void free_image(image_t m);</span><br><span class="line"></span><br><span class="line">#ifdef OPENCV</span><br><span class="line">        std::vector&lt;bbox_t&gt; detect(cv::Mat mat, float thresh &#x3D; 0.2, bool use_mean &#x3D; false);</span><br><span class="line">	std::shared_ptr&lt;image_t&gt; mat_to_image_resize(cv::Mat mat) const;</span><br><span class="line">#endif</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>ECCV 2018 Convolutional Block Attention Module</title>
    <url>/2020/02/19/ECCV-2018-Convolutional-Block-Attention-Module/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title=" å‰è¨€"></a><a id="more"></a> å‰è¨€</h2><p>ç›®å‰cvé¢†åŸŸå€Ÿé‰´äº†nlpé¢†åŸŸçš„attentionæœºåˆ¶ä»¥åç”Ÿäº§å‡ºäº†å¾ˆå¤šæœ‰ç”¨çš„åŸºäºattentionæœºåˆ¶çš„è®ºæ–‡ï¼Œattentionæœºåˆ¶ä¹Ÿæ˜¯åœ¨2019å¹´è®ºæ–‡ä¸­éå¸¸ç«ã€‚è¿™ç¯‡cbamè™½ç„¶æ˜¯åœ¨2018å¹´æå‡ºçš„ï¼Œä½†æ˜¯å…¶å½±å“åŠ›æ¯”è¾ƒæ·±è¿œï¼Œåœ¨å¾ˆå¤šé¢†åŸŸéƒ½ç”¨åˆ°äº†è¯¥æ¨¡å—ï¼Œæ‰€ä»¥ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¨¡å—æœ‰ä»€ä¹ˆç‹¬åˆ°ä¹‹å¤„ï¼Œå¹¶å­¦ç€å®ç°å®ƒã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ</h2><p>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ç§æ•°æ®å¤„ç†æ–¹æ³•ï¼Œå¹¿æ³›åº”ç”¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ã€å›¾åƒè¯†åˆ«åŠè¯­éŸ³è¯†åˆ«ç­‰å„ç§ä¸åŒç±»å‹çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ã€‚</p>
<p>é€šä¿—æ¥è®²ï¼šæ³¨æ„åŠ›æœºåˆ¶å°±æ˜¯å¸Œæœ›ç½‘ç»œèƒ½å¤Ÿè‡ªåŠ¨å­¦å‡ºæ¥å›¾ç‰‡æˆ–è€…æ–‡å­—åºåˆ—ä¸­çš„éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚æ¯”å¦‚äººçœ¼åœ¨çœ‹ä¸€å¹…ç”»çš„æ—¶å€™ï¼Œä¸ä¼šå°†æ³¨æ„åŠ›å¹³ç­‰åœ°åˆ†é…ç»™ç”»ä¸­çš„æ‰€æœ‰åƒç´ ï¼Œè€Œæ˜¯å°†æ›´å¤šæ³¨æ„åŠ›åˆ†é…ç»™äººä»¬å…³æ³¨çš„åœ°æ–¹ã€‚</p>
<p>ä»å®ç°çš„è§’åº¦æ¥è®²ï¼šæ³¨æ„åŠ›æœºåˆ¶é€šè¿‡ç¥ç»ç½‘ç»œçš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ©ç mask,ï¼Œmaskä¸Šçš„å€¼ä¸€ä¸ªæ‰“åˆ†ï¼Œè¯„ä»·å½“å‰éœ€è¦å…³æ³¨çš„ç‚¹çš„è¯„åˆ†ã€‚</p>
<p>æ³¨æ„åŠ›æœºåˆ¶å¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li>é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼šå¯¹é€šé“ç”Ÿæˆæ©ç maskï¼Œè¿›è¡Œæ‰“åˆ†ï¼Œä»£è¡¨æ˜¯SENet, Channel Attention Module</li>
<li>ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼šå¯¹ç©ºé—´è¿›è¡Œæ©ç çš„ç”Ÿæˆï¼Œè¿›è¡Œæ‰“åˆ†ï¼Œä»£è¡¨æ˜¯Spatial Attention Module</li>
<li>æ··åˆåŸŸæ³¨æ„åŠ›æœºåˆ¶ï¼šåŒæ—¶å¯¹é€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›è¿›è¡Œè¯„ä»·æ‰“åˆ†ï¼Œä»£è¡¨çš„æœ‰BAM, CBAM</li>
</ul>
<h2 id="æ€ä¹ˆå®ç°CBAMï¼Ÿ-pytorchä¸ºä¾‹"><a href="#æ€ä¹ˆå®ç°CBAMï¼Ÿ-pytorchä¸ºä¾‹" class="headerlink" title="æ€ä¹ˆå®ç°CBAMï¼Ÿ(pytorchä¸ºä¾‹)"></a><strong>æ€ä¹ˆå®ç°CBAMï¼Ÿ(pytorchä¸ºä¾‹)</strong></h2><p>CBAMå…¨ç§°æ˜¯Convolutional Block Attention Module, æ˜¯åœ¨ECCV2018ä¸Šå‘è¡¨çš„æ³¨æ„åŠ›æœºåˆ¶ä»£è¡¨ä½œä¹‹ä¸€ï¼Œ<a href="http://openaccess.thecvf.com/content_ECCV_2018/papers/Sanghyun_Woo_Convolutional_Block_Attention_ECCV_2018_paper.pdf" target="_blank" rel="noopener">è®ºæ–‡ä¸‹è½½åœ°å€</a>ã€‚</p>
<p>åœ¨è¯¥è®ºæ–‡ä¸­ï¼Œä½œè€…ç ”ç©¶äº†ç½‘ç»œæ¶æ„ä¸­çš„æ³¨æ„åŠ›ï¼Œæ³¨æ„åŠ›ä¸ä»…è¦å‘Šè¯‰æˆ‘ä»¬é‡ç‚¹å…³æ³¨å“ªé‡Œï¼Œè¿˜è¦æé«˜å…³æ³¨ç‚¹çš„è¡¨ç¤ºã€‚ç›®æ ‡æ˜¯é€šè¿‡ä½¿ç”¨æ³¨æ„æœºåˆ¶æ¥å¢åŠ è¡¨ç°åŠ›ï¼Œå…³æ³¨é‡è¦ç‰¹å¾å¹¶æŠ‘åˆ¶ä¸å¿…è¦çš„ç‰¹å¾ã€‚ä¸ºäº†å¼ºè°ƒç©ºé—´å’Œé€šé“è¿™ä¸¤ä¸ªç»´åº¦ä¸Šçš„æœ‰æ„ä¹‰ç‰¹å¾ï¼Œä½œè€…ä¾æ¬¡åº”ç”¨<strong>é€šé“å’Œç©ºé—´æ³¨æ„æ¨¡å—</strong>ï¼Œæ¥åˆ†åˆ«åœ¨é€šé“å’Œç©ºé—´ç»´åº¦ä¸Šå­¦ä¹ å…³æ³¨ä»€ä¹ˆã€åœ¨å“ªé‡Œå…³æ³¨ã€‚æ­¤å¤–ï¼Œé€šè¿‡äº†è§£è¦å¼ºè°ƒæˆ–æŠ‘åˆ¶çš„ä¿¡æ¯ä¹Ÿæœ‰åŠ©äºç½‘ç»œå†…çš„ä¿¡æ¯æµåŠ¨ã€‚</p>
<p>ä¸»è¦ç½‘ç»œæ¶æ„ä¹Ÿå¾ˆç®€å•ï¼Œä¸€ä¸ªæ˜¯é€šé“æ³¨æ„åŠ›æ¨¡å—ï¼Œå¦ä¸€ä¸ªæ˜¯ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼ŒCBAMå°±æ˜¯å…ˆåé›†æˆäº†é€šé“æ³¨æ„åŠ›æ¨¡å—å’Œç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚</p>
<h3 id="2-1-é€šé“æ³¨æ„åŠ›æœºåˆ¶"><a href="#2-1-é€šé“æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.1 é€šé“æ³¨æ„åŠ›æœºåˆ¶"></a>2.1 é€šé“æ³¨æ„åŠ›æœºåˆ¶</h3><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/640.webp" alt></p>
<p>é€šé“æ³¨æ„åŠ›æœºåˆ¶æŒ‰ç…§ä¸Šå›¾è¿›è¡Œå®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ChannelAttention(nn.Module):</span><br><span class="line">    def __init__(self, in_planes, rotio&#x3D;16):</span><br><span class="line">        super(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool &#x3D; nn.AdaptiveAvgPool2d(1)</span><br><span class="line">        self.max_pool &#x3D; nn.AdaptiveMaxPool2d(1)</span><br><span class="line"></span><br><span class="line">        self.sharedMLP &#x3D; nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_planes, in_planes &#x2F;&#x2F; ratio, 1, bias&#x3D;False), nn.ReLU(),</span><br><span class="line">            nn.Conv2d(in_planes &#x2F;&#x2F; rotio, in_planes, 1, bias&#x3D;False))</span><br><span class="line">        self.sigmoid &#x3D; nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        avgout &#x3D; self.sharedMLP(self.avg_pool(x))</span><br><span class="line">        maxout &#x3D; self.sharedMLP(self.max_pool(x))</span><br><span class="line">        return self.sigmoid(avgout + maxout)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶"><a href="#2-2-ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.2 ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶"></a>2.2 ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶</h3><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/641.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SpatialAttention(nn.Module):</span><br><span class="line">    def __init__(self, kernel_size&#x3D;7):</span><br><span class="line">        super(SpatialAttention, self).__init__()</span><br><span class="line">        assert kernel_size in (3,7), &quot;kernel size must be 3 or 7&quot;</span><br><span class="line">        padding &#x3D; 3 if kernel_size &#x3D;&#x3D; 7 else 1</span><br><span class="line"></span><br><span class="line">        self.conv &#x3D; nn.Conv2d(2,1,kernel_size, padding&#x3D;padding, bias&#x3D;False)</span><br><span class="line">        self.sigmoid &#x3D; nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        avgout &#x3D; torch.mean(x, dim&#x3D;1, keepdim&#x3D;True)</span><br><span class="line">        maxout, _ &#x3D; torch.max(x, dim&#x3D;1, keepdim&#x3D;True)</span><br><span class="line">        x &#x3D; torch.cat([avgout, maxout], dim&#x3D;1)</span><br><span class="line">        x &#x3D; self.conv(x)</span><br><span class="line">        return self.sigmoid(x)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-Convolutional-bottleneck-attention-module"><a href="#2-3-Convolutional-bottleneck-attention-module" class="headerlink" title="2.3 Convolutional bottleneck attention module"></a>2.3 Convolutional bottleneck attention module</h3><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/642.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class BasicBlock(nn.Module):</span><br><span class="line">    expansion &#x3D; 1</span><br><span class="line">    def __init__(self, inplanes, planes, stride&#x3D;1, downsample&#x3D;None):</span><br><span class="line">        super(BasicBlock, self).__init__()</span><br><span class="line">        self.conv1 &#x3D; conv3x3(inplanes, planes, stride)</span><br><span class="line">        self.bn1 &#x3D; nn.BatchNorm2d(planes)</span><br><span class="line">        self.relu &#x3D; nn.ReLU(inplace&#x3D;True)</span><br><span class="line">        self.conv2 &#x3D; conv3x3(planes, planes)</span><br><span class="line">        self.bn2 &#x3D; nn.BatchNorm2d(planes)</span><br><span class="line">        self.ca &#x3D; ChannelAttention(planes)</span><br><span class="line">        self.sa &#x3D; SpatialAttention()</span><br><span class="line">        self.downsample &#x3D; downsample</span><br><span class="line">        self.stride &#x3D; stride</span><br><span class="line">    def forward(self, x):</span><br><span class="line">        residual &#x3D; x</span><br><span class="line">        out &#x3D; self.conv1(x)</span><br><span class="line">        out &#x3D; self.bn1(out)</span><br><span class="line">        out &#x3D; self.relu(out)</span><br><span class="line">        out &#x3D; self.conv2(out)</span><br><span class="line">        out &#x3D; self.bn2(out)</span><br><span class="line">        out &#x3D; self.ca(out) * out  # å¹¿æ’­æœºåˆ¶</span><br><span class="line">        out &#x3D; self.sa(out) * out  # å¹¿æ’­æœºåˆ¶</span><br><span class="line">        if self.downsample is not None:</span><br><span class="line">            residual &#x3D; self.downsample(x)</span><br><span class="line">        out +&#x3D; residual</span><br><span class="line">        out &#x3D; self.relu(out)</span><br><span class="line">        return out</span><br></pre></td></tr></table></figure>
<p>ä¸ºä½•è¦å…ˆä½¿ç”¨é€šé“æ³¨æ„åŠ›æœºåˆ¶ç„¶åå†ä½¿ç”¨ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿä½¿ç”¨é¡ºåºä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å—è¿˜æ˜¯å¹¶è¡Œçš„ä½¿ç”¨ä¸¤ä¸ªæ¨¡å—ï¼Ÿå…¶å®æ˜¯ä½œè€…å·²ç»åšè¿‡äº†ç›¸å…³å®éªŒï¼Œå¹¶ä¸”è¯æ˜äº†å…ˆè¯•ç”¨é€šé“ç„¶åå†ä½¿ç”¨ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶è¿™æ ·çš„ç»„åˆæ•ˆæœæ¯”è¾ƒå¥½ï¼Œè¿™ä¹Ÿæ˜¯CBAMçš„é€šç”¨ç»„åˆæ¨¡å¼ã€‚</p>
<h2 id="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ"><a href="#åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ" class="headerlink" title="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ"></a>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ</h2><p>æå‡ºCBAMçš„ä½œè€…ä¸»è¦å¯¹åˆ†ç±»ç½‘ç»œå’Œç›®æ ‡æ£€æµ‹ç½‘ç»œè¿›è¡Œäº†å®éªŒ,è¯æ˜äº†CBAMæ¨¡å—ç¡®å®æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>ä»¥ResNetä¸ºä¾‹ï¼Œè®ºæ–‡ä¸­æä¾›äº†æ”¹é€ çš„ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/643.webp" alt></p>
<p>ä¹Ÿå°±æ˜¯åœ¨ResNetä¸­çš„æ¯ä¸ªblockä¹‹é—´æ·»åŠ äº†CBAMæ¨¡å—ï¼Œè®­ç»ƒæ•°æ®æ¥è‡ªbenchmark ImageNet-1Kã€‚æ£€æµ‹ä½¿ç”¨çš„æ˜¯Faster  R-CNNï¼Œ Backboneé€‰æ‹©çš„ResNet34ï¼ŒResNet50ï¼ŒWideResNet18ï¼ŒResNet50ç­‰ï¼Œè¿˜è·ŸSEç­‰è¿›è¡Œäº†å¯¹æ¯”ã€‚</p>
<p><strong>æ¶ˆèå®éªŒ</strong>ï¼šæ¶ˆèå®éªŒä¸€èˆ¬æ˜¯æ§åˆ¶å˜é‡ï¼Œæœ€èƒ½çœ‹å‡ºæ¨¡å‹å˜å¥½èµ·ä½œç”¨çš„éƒ¨åˆ†åœ¨é‚£é‡Œã€‚åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>å¦‚ä½•æ›´æœ‰æ•ˆåœ°è®¡ç®—channel attention?</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/644.webp" alt>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä½¿ç”¨avgpoolå’Œmaxpoolå¯ä»¥æ›´å¥½çš„é™ä½é”™è¯¯ç‡ï¼Œå¤§æ¦‚æœ‰1-2%çš„æå‡ï¼Œè¿™ä¸ªç»„åˆå°±æ˜¯dual poolingï¼Œèƒ½æä¾›æ›´åŠ ç²¾ç»†çš„ä¿¡æ¯ï¼Œæœ‰åˆ©äºæå‡æ¨¡å‹çš„è¡¨ç°ã€‚</p>
</li>
<li><p>å¦‚ä½•æ›´æœ‰æ•ˆåœ°è®¡ç®—spatial attention?</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/645.webp" alt></p>
<p>è¿™é‡Œçš„ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶å‚æ•°ä¹Ÿæ˜¯æœ‰avgï¼Œmaxç»„æˆï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªå·ç§¯çš„å‚æ•°kernel_size(k)ï¼Œé€šè¿‡ä»¥ä¸Šå®éªŒï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“å‰ä½¿ç”¨é€šé“çš„å¹³å‡å’Œé€šé“çš„æœ€å¤§åŒ–ï¼Œå¹¶ä¸”è®¾ç½®kernel size=7æ˜¯æœ€å¥½çš„ã€‚</p>
</li>
<li><p>å¦‚ä½•ç»„ç»‡è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Ÿ</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/646.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œä¸SENetä¸­çš„SEæ¨¡å—ä¹Ÿè¿›è¡Œäº†æ¯”è¾ƒï¼Œè¿™é‡Œä½¿ç”¨CBAMä¹Ÿæ˜¯è¶…å‡ºäº†SEçš„è¡¨ç°ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜è¿›è¡Œäº†é¡ºåºå’Œå¹¶è¡Œçš„æµ‹è¯•ï¼Œå‘ç°ï¼Œå…ˆchannel attentionç„¶åspatial attentionæ•ˆæœæœ€å¥½ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æœ€ç»ˆçš„CBAMæ¨¡å—çš„ç»„æˆã€‚</p>
<p>åœ¨MSCOCOæ•°æ®åŠä½¿ç”¨äº†ResNet50ï¼ŒResNet101ä¸ºbackboneï¼ŒFaster RCNNä¸ºæ£€æµ‹å™¨çš„æ¨¡å‹è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/647.webp" alt></p>
<p>åœ¨VOC2007æ•°æ®é›†ä¸­é‡‡ç”¨äº†StairNetè¿›è¡Œäº†æµ‹è¯•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CBAM/648.webp" alt></p>
<p>è²Œä¼¼æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡æ£€æµ‹éƒ¨åˆ†çš„ä»£ç ï¼ŒCBAMçš„ä½œç”¨åœ¨äºå¯¹ä¿¡æ¯è¿›è¡Œç²¾ç»†åŒ–åˆ†é…å’Œå¤„ç†ï¼Œæ‰€ä»¥çŒœæµ‹æ˜¯åœ¨backboneçš„åˆ†ç±»å™¨ä¹‹å‰æ·»åŠ çš„CBAMæ¨¡å—ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>Attentionæœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€ç®€å•æœ€æ˜“å®ç°çš„SEæ¨¡å—</title>
    <url>/2020/02/19/%E6%9C%80%E7%AE%80%E5%8D%95%E6%9C%80%E6%98%93%E5%AE%9E%E7%8E%B0%E7%9A%84SE%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h2 id="Squeeze-and-Excitation-Networks"><a href="#Squeeze-and-Excitation-Networks" class="headerlink" title=" Squeeze-and-Excitation Networks"></a><a id="more"></a> Squeeze-and-Excitation Networks</h2><p>SENetæ˜¯Squeeze-and-Excitation  Networksçš„ç®€ç§°ï¼Œæ‹¿åˆ°äº†ImageNet2017åˆ†ç±»æ¯”èµ›å† å†›ï¼Œå…¶æ•ˆæœå¾—åˆ°äº†è®¤å¯ï¼Œå…¶æå‡ºçš„SEæ¨¡å—æ€æƒ³ç®€å•ï¼Œæ˜“äºå®ç°ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å¯ä»¥åŠ è½½åˆ°ç°æœ‰çš„ç½‘ç»œæ¨¡å‹æ¡†æ¶ä¸­ã€‚SENetä¸»è¦æ˜¯å­¦ä¹ äº†channelä¹‹é—´çš„ç›¸å…³æ€§ï¼Œç­›é€‰å‡ºäº†é’ˆå¯¹é€šé“çš„æ³¨æ„åŠ›ï¼Œç¨å¾®å¢åŠ äº†ä¸€ç‚¹è®¡ç®—é‡ï¼Œä½†æ˜¯æ•ˆæœæ¯”è¾ƒå¥½ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/se/640.webp" alt></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥ç†è§£ä»–çš„å®ç°è¿‡ç¨‹ï¼Œé€šè¿‡å¯¹å·ç§¯çš„åˆ°çš„feature  mapè¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªå’Œé€šé“æ•°ä¸€æ ·çš„ä¸€ç»´å‘é‡ä½œä¸ºæ¯ä¸ªé€šé“çš„è¯„ä»·åˆ†æ•°ï¼Œç„¶åå°†ä¿®æ”¹çš„åˆ†æ•°åˆ†åˆ«æ–½åŠ åˆ°å¯¹åº”çš„é€šé“ä¸Šï¼Œå¾—åˆ°å…¶ç»“æœï¼Œå°±åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šåªæ·»åŠ äº†ä¸€ä¸ªæ¨¡å—ï¼Œä¸‹è¾¹æˆ‘ä»¬ç”¨pytorchå®ç°è¿™ä¸ªå¾ˆç®€å•çš„æ¨¡å—ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/se/641.webp" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SELayer(nn.Module):</span><br><span class="line">    def __init__(self, channel, reduction&#x3D;16):</span><br><span class="line">        super(SELayer, self).__init__()</span><br><span class="line">        self.avg_pool &#x3D; nn.AdaptiveAvgPool2d(1)</span><br><span class="line">        self.fc &#x3D; nn.Sequential(</span><br><span class="line">            nn.Linear(channel, channel &#x2F;&#x2F; reduction, bias&#x3D;False),</span><br><span class="line">            nn.ReLU(inplace&#x3D;True),</span><br><span class="line">            nn.Linear(channel &#x2F;&#x2F; reduction, channel, bias&#x3D;False),</span><br><span class="line">            nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        b, c, _, _ &#x3D; x.size()</span><br><span class="line">        y &#x3D; self.avg_pool(x).view(b, c)</span><br><span class="line">        y &#x3D; self.fc(y).view(b, c, 1, 1)</span><br><span class="line">        return x * y.expand_as(x)</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æ ¸å¿ƒå°±æ˜¯ä»¥ä¸Šçš„å†…å®¹ï¼Œä¸è¿‡ä¸èƒ½ç®€å•åœ°ç»“æŸï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li><p>ä½œä¸ºä¸€ä¸ªé‡è¦çš„attentionæœºåˆ¶çš„æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« å¦‚ä½•æè¿°attentionï¼Œrelated workå¦‚ä½•ç»„ç»‡ï¼Ÿ</p>
<p>attentionæœºåˆ¶å½“æ—¶å·²ç»æœ‰ä¸€å®šçš„ç ”ç©¶å’Œå‘å±•ï¼Œä¹Ÿæ˜¯é›†ä¸­äºåºåˆ—å­¦ä¹ ï¼Œimage captioning, understanding in  imagesè¿™äº›å·¥ä½œï¼Œä¹Ÿå·²ç»æœ‰å¾ˆå¤šå‡ºè‰²çš„å·¥ä½œæ˜¯æ¢ç´¢äº†attentionæœºåˆ¶ã€‚senetè¿™ç¯‡æ–‡ç« ä¸»è¦æ¢ç´¢äº†é€šè¿‡å¯¹é€šé“é—´å…³ç³»è¿›è¡Œå»ºæ¨¡æ¥æå‡æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚related work ä¸»è¦ä»æ›´æ·±çš„ç½‘ç»œæ¶æ„ï¼Œæ¶æ„æœç´¢ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä¸‰ä¸ªè§’åº¦è¿›è¡Œäº†æ¢³ç†ï¼Œç¡®å®éå¸¸å…¨é¢ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£é‡ŠSEæ¨¡å—ï¼Ÿ</p>
<p><strong>Sequeeze</strong>ï¼šå¯¹$C \times H \times W$è¿›è¡Œglobal average poolingï¼Œå¾—åˆ° $1 \times 1 \times C$å¤§å°çš„ç‰¹å¾å›¾ï¼Œè¿™ä¸ªç‰¹å¾å›¾å¯ä»¥ç†è§£ä¸ºå…·æœ‰å…¨å±€æ„Ÿå—é‡ã€‚</p>
<p><strong>Excitation</strong>ï¼šä½¿ç”¨ä¸€ä¸ªå…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå¯¹Sequeezeä¹‹åçš„ç»“æœåšä¸€ä¸ªéçº¿æ€§å˜æ¢ã€‚</p>
<p><strong>ç‰¹å¾é‡æ ‡å®š</strong>ï¼šä½¿ç”¨Excitation å¾—åˆ°çš„ç»“æœä½œä¸ºæƒé‡ï¼Œä¹˜åˆ°è¾“å…¥ç‰¹å¾ä¸Šã€‚</p>
</li>
<li><p>SEæ¨¡å—å¦‚ä½•åŠ åˆ°åˆ†ç±»ç½‘ç»œï¼Œæ•ˆæœå¦‚ä½•ï¼Ÿ</p>
<p>åˆ†ç±»ç½‘ç»œç°åœ¨ä¸€èˆ¬éƒ½æ˜¯æˆä¸€ä¸ªblockä¸€ä¸ªblockï¼Œseæ¨¡å—å°±å¯ä»¥åŠ åˆ°ä¸€ä¸ªblockç»“æŸçš„ä½ç½®ï¼Œè¿›è¡Œä¸€ä¸ªä¿¡æ¯refineã€‚è¿™é‡Œç”¨äº†ä¸€äº›STOAçš„åˆ†ç±»æ¨¡å‹å¦‚ï¼šresnet50ï¼Œresnext50ï¼Œbn-inceptionç­‰ç½‘ç»œã€‚é€šè¿‡æ·»åŠ SEæ¨¡å—ï¼Œèƒ½ä½¿æ¨¡å‹æå‡0.5-1.5%,æ•ˆæœè¿˜å¯ä»¥ï¼Œå¢åŠ çš„è®¡ç®—é‡ä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚åœ¨è½»é‡çº§ç½‘ç»œMobileNetï¼ŒShuffleNetä¸Šä¹Ÿè¿›è¡Œäº†å®éªŒï¼Œå¯ä»¥æå‡çš„ç‚¹æ›´å¤šä¸€ç‚¹å¤§æ¦‚åœ¨1.5-2%ã€‚</p>
</li>
<li><p>SEæ¨¡å—å¦‚ä½•åŠ åˆ°ç›®æ ‡æ£€æµ‹ç½‘ç»œï¼Œæ•ˆæœå¦‚ä½•ï¼Ÿ</p>
<p>ä¸»è¦è¿˜æ˜¯å°†SEæ¨¡å—æ·»åŠ åˆ°backboneéƒ¨åˆ†ï¼Œä¼˜åŒ–å­¦ä¹ åˆ°çš„å†…å®¹ã€‚ç›®æ ‡æ£€æµ‹æ•°æ®é›†ä½¿ç”¨çš„æ˜¯benchmark MSCOCO, ä½¿ç”¨çš„Faster  R-CNNä½œä¸ºç›®æ ‡æ£€æµ‹å™¨ï¼Œä½¿ç”¨backboneä»ResNet50æ›¿æ¢ä¸ºSE-ResNet50ä»¥åå¸¦äº†äº†ä¸¤ä¸ªç‚¹çš„APæå‡ï¼Œç¡®å®æœ‰æ•ˆæœã€‚</p>
</li>
<li><p>è¿™ç¯‡æ–‡ç« çš„å®éªŒéƒ¨åˆ†æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ</p>
<p>è¿™ç¯‡æ–‡ç« ä¸­ä¹Ÿè¿›è¡Œäº†æ¶ˆèå®éªŒï¼Œæ¥è¯æ˜SEæ¨¡å—çš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿè¯´æ˜äº†è®¾ç½®reduction=16çš„åŸå› ã€‚</p>
<ul>
<li>squeezeæ–¹å¼ï¼šä»…ä»…æ¯”è¾ƒäº†maxå’Œavgï¼Œå‘ç°avgè¦å¥½ä¸€ç‚¹ã€‚</li>
<li>excitationæ–¹å¼ï¼šä½¿ç”¨äº†ReLUï¼ŒTanhï¼ŒSigmoidï¼Œå‘ç°Sigmoidå¥½ã€‚</li>
<li>stage: resnet50æœ‰ä¸åŒçš„é˜¶æ®µï¼Œé€šè¿‡å®éªŒå‘ç°ï¼Œå°†seæ–½åŠ åˆ°æ‰€æœ‰çš„é˜¶æ®µæ•ˆæœæœ€å¥½ã€‚</li>
<li>é›†æˆç­–ç•¥ï¼šå°†seæ”¾åœ¨æ®‹å·®å•å…ƒçš„å‰éƒ¨ï¼Œåéƒ¨è¿˜æ˜¯å¹³è¡Œäºæ®‹å·®å•å…ƒï¼Œæœ€ç»ˆå‘ç°ï¼Œæ”¾åˆ°å‰éƒ¨æ¯”è¾ƒå¥½ã€‚</li>
</ul>
</li>
<li><p>å¦‚ä½•æŸ¥çœ‹æ¯ä¸ªé€šé“å­¦åˆ°çš„attentionä¿¡æ¯å¹¶è¯æ˜å…¶æœ‰æ•ˆæ€§ï¼Ÿ</p>
<p>ä½œè€…é€‰å–äº†ImageNetä¸­çš„å››ä¸ªç±»åˆ«è¿›è¡Œäº†ä¸€ä¸ªå®éªŒï¼Œæµ‹è¯•backboneæœ€åä¸€ä¸ªSEå±‚çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/se/642.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºè¿™ä¸¤ä¸ªç±»æ¿€æ´»å‡ºæ¥çš„å†…å®¹æœ‰ä¸€å®šçš„å·®è·ï¼Œèµ·åˆ°äº†ä¸€å®šçš„ä½œç”¨ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>Attentionæœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows å¦‚ä½•é€šè¿‡VNCä»è¿œç¨‹æ§åˆ¶Ubuntu</title>
    <url>/2020/02/18/Windows%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87VNC%E4%BB%8E%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6Ubuntu/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title=" ç®€ä»‹"></a><a id="more"></a> ç®€ä»‹</h2><p>VNC å·¥å…·æ˜¯æä¾›ä½ ä¸€ä¸ªå¯ä»¥è¿œç¨‹å›¾åƒåŒ–æ¡Œé¢çš„æ–¹å¼ã€‚å…¶å® VNC æ˜¯ä¸€ç§è½¯ä»¶çš„ç»Ÿç§°ã€‚åªè¦ä½ çš„ Linux æ¶è®¾å¥½äº†ä¸€ä¸ªæœåŠ¡å™¨ (Server) çš„ VNCï¼Œå®¢æˆ·ç«¯æ¯”å¦‚ä½ çš„ Macï¼Œæ‰‹æœºï¼Œåªè¦å®‰è£…ä»»ä½•ä¸€ç§ VNC å®¢æˆ·ç«¯è½¯ä»¶å°±èƒ½é“¾æ¥ä¸ŠæœåŠ¡å™¨ç«¯çš„ç”µè„‘ã€‚</p>
<h2 id="UbuntuæœåŠ¡ç«¯å®‰è£…"><a href="#UbuntuæœåŠ¡ç«¯å®‰è£…" class="headerlink" title="UbuntuæœåŠ¡ç«¯å®‰è£…"></a>UbuntuæœåŠ¡ç«¯å®‰è£…</h2><p>æ‰“å¼€ Terminalï¼Œè¾“å…¥:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install x11vnc</span><br></pre></td></tr></table></figure><br>ç¡®è®¤ä½ çš„ Linux ç”¨æˆ·å¯†ç ï¼Œå°±èƒ½å®‰è£…è¿™ä¸ªæœ€å¸¸ç”¨çš„ x11vnc è½¯ä»¶ã€‚è¿™ä¸ªè½¯ä»¶çš„ä½¿ç”¨ï¼Œè®¾ç½®éå¸¸ç®€å•ã€‚å®‰è£…å¥½åï¼Œæœ€å¥½ç»™ä½ çš„ x11vnc è®¾ç½®ä¸€ä¸ªç”¨äºè¿æ¥çš„å¯†ç ï¼Œè¾“å…¥<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x11vnc -storepasswd</span><br></pre></td></tr></table></figure><br>ä¼šå‡ºç°ä»¥ä¸‹ç”»é¢ï¼Œè®¾ç½®ä½ çš„å¯†ç ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Enter VNC password:</span><br><span class="line">Verify password:</span><br><span class="line">Write password to &#x2F;home&#x2F;morvan&#x2F;.vnc&#x2F;passwd?  [y]&#x2F;n y</span><br><span class="line">Password written to: &#x2F;home&#x2F;morvan&#x2F;.vnc&#x2F;passwd</span><br></pre></td></tr></table></figure><br>å¼€å¯æœåŠ¡:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x11vnc -auth guess -once -loop -noxdamage -repeat -rfbauth &#x2F;home&#x2F;USERNAME&#x2F;.vnc&#x2F;passwd -rfbport 5900 -shared</span><br></pre></td></tr></table></figure></p>
<p><strong>æ³¨æ„ï¼š/home/USERNAME/.vnc/passwd ä¸­çš„USERNAMEéœ€è¦æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åã€‚</strong></p>
<p>è®¾ä¸ºå¼€æœºå¯åŠ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;x11vnc.service</span><br></pre></td></tr></table></figure><br>åœ¨æ‰“å¼€çš„é¡µé¢ä¸­æ’å…¥ä»¥ä¸‹ä»£ç ï¼Œä¿å­˜<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;Start x11vnc at startup.</span><br><span class="line">After&#x3D;multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;x11vnc -auth guess -once -loop -noxdamage -repeat -rfbauth &#x2F;home&#x2F;USERNAME&#x2F;.vnc&#x2F;passwd -rfbport 5900 -shared</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure><br>æ¥ç€æ‰§è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable x11vnc.service</span><br></pre></td></tr></table></figure><br>å¥½äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯é…ç½®å®Œæ¯•ã€‚</p>
<h2 id="Windowså®¢æˆ·ç«¯å®‰è£…"><a href="#Windowså®¢æˆ·ç«¯å®‰è£…" class="headerlink" title="Windowså®¢æˆ·ç«¯å®‰è£…"></a>Windowså®¢æˆ·ç«¯å®‰è£…</h2><p>æˆ‘è¿™é‡Œç”¨çš„æ˜¯RealVNCçš„VNC Viewerï¼Œ<a href="https://www.realvnc.com/en/connect/download/viewer/" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p>
<p>æ‰“å¼€å®¢æˆ·ç«¯ï¼Œè¾“å…¥ä½ è¦è¿æ¥çš„æœåŠ¡ç«¯çš„IP</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VNC/Snipaste_2020-02-18_18-11-36.jpg" alt></p>
<p>æ¥ç€è¾“å…¥ä½ æ‰€è®¾ç½®çš„å¯†ç å³å¯è¿æ¥ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VNC/Snipaste_2020-02-18_18-12-44.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>VNC</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨YOLOv3æ¨¡å‹ä¸­æ·»åŠ Attentionæœºåˆ¶</title>
    <url>/2020/02/18/%E5%9C%A8YOLOv3%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B7%BB%E5%8A%A0Attention%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="1-è§„å®šæ ¼å¼"><a href="#1-è§„å®šæ ¼å¼" class="headerlink" title=" 1. è§„å®šæ ¼å¼"></a><a id="more"></a> 1. è§„å®šæ ¼å¼</h2><p>æ­£å¦‚<code>[convolutional]</code>,<code>[maxpool]</code>,<code>[net]</code>,<code>[route]</code>ç­‰å±‚åœ¨cfgä¸­çš„å®šä¹‰ä¸€æ ·ï¼Œæˆ‘ä»¬å†æ·»åŠ å…¨æ–°çš„æ¨¡å—çš„æ—¶å€™ï¼Œè¦è§„å®šä¸€ä¸‹cfgçš„æ ¼å¼ã€‚åšå‡ºä»¥ä¸‹è§„å®šï¼š</p>
<p>åœ¨SEæ¨¡å—ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°ä¸º<code>reduction</code>,è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯16ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ¨¡å—ä¸­çš„è¯¦ç»†å‚æ•°æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹å†…å®¹è¿›è¡Œè®¾ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[se]</span><br><span class="line">reduction&#x3D;16</span><br></pre></td></tr></table></figure>
<p>åœ¨CBAMæ¨¡å—ä¸­ï¼Œç©ºé—´æ³¨æ„åŠ›æœºåˆ¶å’Œé€šé“æ³¨æ„åŠ›æœºåˆ¶ä¸­ä¸€å…±å­˜åœ¨ä¸¤ä¸ªå‚æ•°ï¼š<code>ratio</code>å’Œ<code>kernel_size</code>, æ‰€ä»¥è¿™æ ·è§„å®šCBAMåœ¨cfgæ–‡ä»¶ä¸­çš„æ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[cbam]</span><br><span class="line">ratio&#x3D;16</span><br><span class="line">kernelsize&#x3D;7</span><br></pre></td></tr></table></figure>
<h2 id="2-ä¿®æ”¹è§£æéƒ¨åˆ†"><a href="#2-ä¿®æ”¹è§£æéƒ¨åˆ†" class="headerlink" title="2. ä¿®æ”¹è§£æéƒ¨åˆ†"></a>2. ä¿®æ”¹è§£æéƒ¨åˆ†</h2><p>ç”±äºæ·»åŠ çš„è¿™äº›å‚æ•°éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è§£æcfgæ–‡ä»¶çš„å‡½æ•°ï¼Œä¹‹å‰è®²è¿‡ï¼Œéœ€è¦ä¿®æ”¹<code>parse_config.py</code>ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def parse_model_cfg(path):</span><br><span class="line">    # pathå‚æ•°ä¸º: cfg&#x2F;yolov3-tiny.cfg</span><br><span class="line">    if not path.endswith(&#39;.cfg&#39;):</span><br><span class="line">        path +&#x3D; &#39;.cfg&#39;</span><br><span class="line">    if not os.path.exists(path) and \</span><br><span class="line">    	   os.path.exists(&#39;cfg&#39; + os.sep + path):</span><br><span class="line">        path &#x3D; &#39;cfg&#39; + os.sep + path</span><br><span class="line"></span><br><span class="line">    with open(path, &#39;r&#39;) as f:</span><br><span class="line">        lines &#x3D; f.read().split(&#39;\n&#39;)</span><br><span class="line"></span><br><span class="line">    # å»é™¤ä»¥#å¼€å¤´çš„ï¼Œå±äºæ³¨é‡Šéƒ¨åˆ†çš„å†…å®¹</span><br><span class="line">    lines &#x3D; [x for x in lines if x and not x.startswith(&#39;#&#39;)]</span><br><span class="line">    lines &#x3D; [x.rstrip().lstrip() for x in lines]</span><br><span class="line">    mdefs &#x3D; []  # æ¨¡å—çš„å®šä¹‰</span><br><span class="line">    for line in lines:</span><br><span class="line">        if line.startswith(&#39;[&#39;):  # æ ‡å¿—ç€ä¸€ä¸ªæ¨¡å—çš„å¼€å§‹</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line">            eg:</span><br><span class="line">            [shortcut]</span><br><span class="line">            from&#x3D;-3</span><br><span class="line">            activation&#x3D;linear</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line">            mdefs.append(&#123;&#125;)</span><br><span class="line">            mdefs[-1][&#39;type&#39;] &#x3D; line[1:-1].rstrip()</span><br><span class="line">            if mdefs[-1][&#39;type&#39;] &#x3D;&#x3D; &#39;convolutional&#39;:</span><br><span class="line">                mdefs[-1][&#39;batch_normalize&#39;] &#x3D; 0 </span><br><span class="line">        else:</span><br><span class="line">            key, val &#x3D; line.split(&quot;&#x3D;&quot;)</span><br><span class="line">            key &#x3D; key.rstrip()</span><br><span class="line"></span><br><span class="line">            if &#39;anchors&#39; in key:</span><br><span class="line">                mdefs[-1][key] &#x3D; np.array([float(x) for x in val.split(&#39;,&#39;)]).reshape((-1, 2))</span><br><span class="line">            else:</span><br><span class="line">                mdefs[-1][key] &#x3D; val.strip()</span><br><span class="line"></span><br><span class="line">    # Check all fields are supported</span><br><span class="line">    supported &#x3D; [&#39;type&#39;, &#39;batch_normalize&#39;, &#39;filters&#39;, &#39;size&#39;,\</span><br><span class="line">                 &#39;stride&#39;, &#39;pad&#39;, &#39;activation&#39;, &#39;layers&#39;, \</span><br><span class="line">                 &#39;groups&#39;,&#39;from&#39;, &#39;mask&#39;, &#39;anchors&#39;, \</span><br><span class="line">                 &#39;classes&#39;, &#39;num&#39;, &#39;jitter&#39;, &#39;ignore_thresh&#39;,\</span><br><span class="line">                 &#39;truth_thresh&#39;, &#39;random&#39;,\</span><br><span class="line">                 &#39;stride_x&#39;, &#39;stride_y&#39;]</span><br><span class="line"></span><br><span class="line">    f &#x3D; []  # fields</span><br><span class="line">    for x in mdefs[1:]:</span><br><span class="line">        [f.append(k) for k in x if k not in f]</span><br><span class="line">    u &#x3D; [x for x in f if x not in supported]  # unsupported fields</span><br><span class="line">    assert not any(u), &quot;Unsupported fields %s in %s. See https:&#x2F;&#x2F;github.com&#x2F;ultralytics&#x2F;yolov3&#x2F;issues&#x2F;631&quot; % (u, path)</span><br><span class="line"></span><br><span class="line">    return mdefs</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå†…å®¹ä¸­ï¼Œéœ€è¦æ”¹çš„æ˜¯supportedä¸­çš„å­—æ®µï¼Œå°†æˆ‘ä»¬çš„å†…å®¹æ·»åŠ è¿›å»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">supported &#x3D; [&#39;type&#39;, &#39;batch_normalize&#39;, &#39;filters&#39;, &#39;size&#39;,\</span><br><span class="line">            &#39;stride&#39;, &#39;pad&#39;, &#39;activation&#39;, &#39;layers&#39;, \</span><br><span class="line">            &#39;groups&#39;,&#39;from&#39;, &#39;mask&#39;, &#39;anchors&#39;, \</span><br><span class="line">            &#39;classes&#39;, &#39;num&#39;, &#39;jitter&#39;, &#39;ignore_thresh&#39;,\</span><br><span class="line">            &#39;truth_thresh&#39;, &#39;random&#39;,\</span><br><span class="line">            &#39;stride_x&#39;, &#39;stride_y&#39;,\</span><br><span class="line">            &#39;ratio&#39;, &#39;reduction&#39;, &#39;kernelsize&#39;]</span><br></pre></td></tr></table></figure>
<h2 id="3-å®ç°SEå’ŒCBAM"><a href="#3-å®ç°SEå’ŒCBAM" class="headerlink" title="3. å®ç°SEå’ŒCBAM"></a>3. å®ç°SEå’ŒCBAM</h2><p><strong>SE</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SELayer(nn.Module):</span><br><span class="line">    def __init__(self, channel, reduction&#x3D;16):</span><br><span class="line">        super(SELayer, self).__init__()</span><br><span class="line">        self.avg_pool &#x3D; nn.AdaptiveAvgPool2d(1)</span><br><span class="line">        self.fc &#x3D; nn.Sequential(</span><br><span class="line">            nn.Linear(channel, channel &#x2F;&#x2F; reduction, bias&#x3D;False),</span><br><span class="line">            nn.ReLU(inplace&#x3D;True),</span><br><span class="line">            nn.Linear(channel &#x2F;&#x2F; reduction, channel, bias&#x3D;False),</span><br><span class="line">            nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        b, c, _, _ &#x3D; x.size()</span><br><span class="line">        y &#x3D; self.avg_pool(x).view(b, c)</span><br><span class="line">        y &#x3D; self.fc(y).view(b, c, 1, 1)</span><br><span class="line">        return x * y.expand_as(x)</span><br></pre></td></tr></table></figure>
<p><strong>CBAM</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SpatialAttention(nn.Module):</span><br><span class="line">    def __init__(self, kernel_size&#x3D;7):</span><br><span class="line">        super(SpatialAttention, self).__init__()</span><br><span class="line">        assert kernel_size in (3,7), &quot;kernel size must be 3 or 7&quot;</span><br><span class="line">        padding &#x3D; 3 if kernel_size &#x3D;&#x3D; 7 else 1</span><br><span class="line"></span><br><span class="line">        self.conv &#x3D; nn.Conv2d(2,1,kernel_size, padding&#x3D;padding, bias&#x3D;False)</span><br><span class="line">        self.sigmoid &#x3D; nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        avgout &#x3D; torch.mean(x, dim&#x3D;1, keepdim&#x3D;True)</span><br><span class="line">        maxout, _ &#x3D; torch.max(x, dim&#x3D;1, keepdim&#x3D;True)</span><br><span class="line">        x &#x3D; torch.cat([avgout, maxout], dim&#x3D;1)</span><br><span class="line">        x &#x3D; self.conv(x)</span><br><span class="line">        return self.sigmoid(x)</span><br><span class="line">    </span><br><span class="line">class ChannelAttention(nn.Module):</span><br><span class="line">    def __init__(self, in_planes, rotio&#x3D;16):</span><br><span class="line">        super(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool &#x3D; nn.AdaptiveAvgPool2d(1)</span><br><span class="line">        self.max_pool &#x3D; nn.AdaptiveMaxPool2d(1)</span><br><span class="line"></span><br><span class="line">        self.sharedMLP &#x3D; nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_planes, in_planes &#x2F;&#x2F; ratio, 1, bias&#x3D;False), nn.ReLU(),</span><br><span class="line">            nn.Conv2d(in_planes &#x2F;&#x2F; rotio, in_planes, 1, bias&#x3D;False))</span><br><span class="line">        self.sigmoid &#x3D; nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        avgout &#x3D; self.sharedMLP(self.avg_pool(x))</span><br><span class="line">        maxout &#x3D; self.sharedMLP(self.max_pool(x))</span><br><span class="line">        return self.sigmoid(avgout + maxout)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯ä¸¤ä¸ªæ¨¡å—çš„ä»£ç ï¼Œæ·»åŠ åˆ°<code>models.py</code>æ–‡ä»¶ä¸­ã€‚</p>
<h2 id="4-è®¾è®¡cfgæ–‡ä»¶"><a href="#4-è®¾è®¡cfgæ–‡ä»¶" class="headerlink" title="4. è®¾è®¡cfgæ–‡ä»¶"></a>4. è®¾è®¡cfgæ–‡ä»¶</h2><p>è¿™é‡Œä»¥<code>yolov3-tiny.cfg</code>ä¸ºbaselineï¼Œç„¶åæ·»åŠ æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ã€‚</p>
<p>CBAMä¸SEç±»ä¼¼ï¼Œæ‰€ä»¥ä»¥SEä¸ºä¾‹ï¼Œæ·»åŠ åˆ°backboneä¹‹åçš„éƒ¨åˆ†ï¼Œè¿›è¡Œä¿¡æ¯é‡æ„(refinement)ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[net]</span><br><span class="line"># Testing</span><br><span class="line">batch&#x3D;1</span><br><span class="line">subdivisions&#x3D;1</span><br><span class="line"># Training</span><br><span class="line"># batch&#x3D;64</span><br><span class="line"># subdivisions&#x3D;2</span><br><span class="line">width&#x3D;416</span><br><span class="line">height&#x3D;416</span><br><span class="line">channels&#x3D;3</span><br><span class="line">momentum&#x3D;0.9</span><br><span class="line">decay&#x3D;0.0005</span><br><span class="line">angle&#x3D;0</span><br><span class="line">saturation &#x3D; 1.5</span><br><span class="line">exposure &#x3D; 1.5</span><br><span class="line">hue&#x3D;.1</span><br><span class="line"></span><br><span class="line">learning_rate&#x3D;0.001</span><br><span class="line">burn_in&#x3D;1000</span><br><span class="line">max_batches &#x3D; 500200</span><br><span class="line">policy&#x3D;steps</span><br><span class="line">steps&#x3D;400000,450000</span><br><span class="line">scales&#x3D;.1,.1</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;16</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;32</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;64</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;256</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;512</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;1</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;1024</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[se]</span><br><span class="line">reduction&#x3D;16</span><br><span class="line"></span><br><span class="line"># åœ¨backboneç»“æŸçš„åœ°æ–¹æ·»åŠ seæ¨¡å—</span><br><span class="line">#####backbone######</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;256</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;512</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">filters&#x3D;18</span><br><span class="line">activation&#x3D;linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask &#x3D; 3,4,5</span><br><span class="line">anchors &#x3D; 10,14,  23,27,  37,58,  81,82,  135,169,  344,319</span><br><span class="line">classes&#x3D;1</span><br><span class="line">num&#x3D;6</span><br><span class="line">jitter&#x3D;.3</span><br><span class="line">ignore_thresh &#x3D; .7</span><br><span class="line">truth_thresh &#x3D; 1</span><br><span class="line">random&#x3D;1</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers &#x3D; -4</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[upsample]</span><br><span class="line">stride&#x3D;2</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers &#x3D; -1, 8</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;256</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">filters&#x3D;18</span><br><span class="line">activation&#x3D;linear</span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask &#x3D; 0,1,2</span><br><span class="line">anchors &#x3D; 10,14,  23,27,  37,58,  81,82,  135,169,  344,319</span><br><span class="line">classes&#x3D;1</span><br><span class="line">num&#x3D;6</span><br><span class="line">jitter&#x3D;.3</span><br><span class="line">ignore_thresh &#x3D; .7</span><br><span class="line">truth_thresh &#x3D; 1</span><br><span class="line">random&#x3D;1</span><br></pre></td></tr></table></figure>
<h2 id="5-æ¨¡å‹æ„å»º"><a href="#5-æ¨¡å‹æ„å»º" class="headerlink" title="5. æ¨¡å‹æ„å»º"></a>5. æ¨¡å‹æ„å»º</h2><p>ä»¥ä¸Šéƒ½æ˜¯å‡†å¤‡å·¥ä½œï¼Œä»¥SEä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¿®æ”¹<code>model.py</code>æ–‡ä»¶ä¸­çš„æ¨¡å‹åŠ è½½éƒ¨åˆ†ï¼Œå¹¶ä¿®æ”¹forwardå‡½æ•°éƒ¨åˆ†çš„ä»£ç ï¼Œè®©å…¶æ­£å¸¸å‘æŒ¥ä½œç”¨ï¼š</p>
<p>åœ¨<code>model.py</code>ä¸­çš„<code>create_modules</code>å‡½æ•°ä¸­è¿›è¡Œæ·»åŠ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;se&#39;:</span><br><span class="line">    modules.add_module(</span><br><span class="line">        &#39;se_module&#39;,</span><br><span class="line">        SELayer(output_filters[-1], reduction&#x3D;int(mdef[&#39;reduction&#39;])))</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹Darknetä¸­çš„forwardéƒ¨åˆ†çš„å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def forward(self, x, var&#x3D;None):</span><br><span class="line">    img_size &#x3D; x.shape[-2:]</span><br><span class="line">    layer_outputs &#x3D; []</span><br><span class="line">    output &#x3D; []</span><br><span class="line"></span><br><span class="line">    for i, (mdef,</span><br><span class="line">            module) in enumerate(zip(self.module_defs, self.module_list)):</span><br><span class="line">        mtype &#x3D; mdef[&#39;type&#39;]</span><br><span class="line">        if mtype in [&#39;convolutional&#39;, &#39;upsample&#39;, &#39;maxpool&#39;]:</span><br><span class="line">            x &#x3D; module(x)</span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;route&#39;:</span><br><span class="line">            layers &#x3D; [int(x) for x in mdef[&#39;layers&#39;].split(&#39;,&#39;)]</span><br><span class="line">            if len(layers) &#x3D;&#x3D; 1:</span><br><span class="line">                x &#x3D; layer_outputs[layers[0]]</span><br><span class="line">            else:</span><br><span class="line">                try:</span><br><span class="line">                    x &#x3D; torch.cat([layer_outputs[i] for i in layers], 1)</span><br><span class="line">                except:  # apply stride 2 for darknet reorg layer</span><br><span class="line">                    layer_outputs[layers[1]] &#x3D; F.interpolate(</span><br><span class="line">                        layer_outputs[layers[1]], scale_factor&#x3D;[0.5, 0.5])</span><br><span class="line">                    x &#x3D; torch.cat([layer_outputs[i] for i in layers], 1)</span><br><span class="line"></span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;shortcut&#39;:</span><br><span class="line">            x &#x3D; x + layer_outputs[int(mdef[&#39;from&#39;])]</span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;yolo&#39;:</span><br><span class="line">            output.append(module(x, img_size))</span><br><span class="line">        layer_outputs.append(x if i in self.routs else [])</span><br></pre></td></tr></table></figure>
<p>åœ¨forwardä¸­åŠ å…¥SEæ¨¡å—ï¼Œå…¶å®å¾ˆç®€å•ã€‚SEæ¨¡å—ä¸å·ç§¯å±‚ï¼Œä¸Šé‡‡æ ·ï¼Œæœ€å¤§æ± åŒ–å±‚åœ°ä½æ˜¯ä¸€æ ·çš„ï¼Œä¸éœ€è¦æ›´å¤šæ“ä½œï¼Œåªéœ€è¦å°†ä»¥ä¸Šéƒ¨åˆ†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i, (mdef,</span><br><span class="line">           module) in enumerate(zip(self.module_defs, self.module_list)):</span><br><span class="line">       mtype &#x3D; mdef[&#39;type&#39;]</span><br><span class="line">       if mtype in [&#39;convolutional&#39;, &#39;upsample&#39;, &#39;maxpool&#39;, &#39;se&#39;]:</span><br><span class="line">           x &#x3D; module(x)</span><br></pre></td></tr></table></figure>
<p>CBAMçš„æ•´ä½“è¿‡ç¨‹ç±»ä¼¼ï¼Œå¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹YOLOv3çš„æ•´ä½“æµç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3æ¨¡å‹æ„å»ºä¸­çš„YOLOLayer</title>
    <url>/2020/02/18/YOLOv3%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E4%B8%AD%E7%9A%84YOLOLayer/</url>
    <content><![CDATA[<h2 id="1-Gridåˆ›å»º"><a href="#1-Gridåˆ›å»º" class="headerlink" title=" 1. Gridåˆ›å»º"></a><a id="more"></a> 1. Gridåˆ›å»º</h2><p>YOLOv3æ˜¯ä¸€ä¸ªå•é˜¶æ®µçš„ç›®æ ‡æ£€æµ‹å™¨ï¼Œå°†ç›®æ ‡åˆ’åˆ†ä¸ºä¸åŒçš„gridï¼Œæ¯ä¸ªgridåˆ†é…3ä¸ªanchorä½œä¸ºå…ˆéªŒæ¡†æ¥è¿›è¡ŒåŒ¹é…ã€‚é¦–å…ˆè¯»ä¸€ä¸‹ä»£ç ä¸­å…³äºgridåˆ›å»ºçš„éƒ¨åˆ†ã€‚</p>
<p>é¦–å…ˆäº†è§£ä¸€ä¸‹pytorchä¸­çš„APIï¼š<code>torch.mershgrid</code></p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Python 3.7.3 (default, Apr 24 2019, 15:29:51) [MSC v.1915 64 bit (AMD64)] :: Anaconda, Inc. on win32</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import torch</span><br><span class="line">&gt;&gt;&gt; a &#x3D; torch.arange(3)</span><br><span class="line">&gt;&gt;&gt; b &#x3D; torch.arange(5)</span><br><span class="line">&gt;&gt;&gt; x,y &#x3D; torch.meshgrid(a,b)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">tensor([0, 1, 2])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">tensor([0, 1, 2, 3, 4])</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">tensor([[0, 0, 0, 0, 0],</span><br><span class="line">        [1, 1, 1, 1, 1],</span><br><span class="line">        [2, 2, 2, 2, 2]])</span><br><span class="line">&gt;&gt;&gt; y</span><br><span class="line">tensor([[0, 1, 2, 3, 4],</span><br><span class="line">        [0, 1, 2, 3, 4],</span><br><span class="line">        [0, 1, 2, 3, 4]])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å•çº¯çœ‹è¾“å…¥è¾“å‡ºï¼Œå¯èƒ½ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œåˆ—ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for i in range(3):</span><br><span class="line">...     for j in range(4):</span><br><span class="line">...         print(&quot;(&quot;, x[i,j], &quot;,&quot; ,y[i,j],&quot;)&quot;)</span><br><span class="line">...</span><br><span class="line">( tensor(0) , tensor(0) )</span><br><span class="line">( tensor(0) , tensor(1) )</span><br><span class="line">( tensor(0) , tensor(2) )</span><br><span class="line">( tensor(0) , tensor(3) )</span><br><span class="line">( tensor(1) , tensor(0) )</span><br><span class="line">( tensor(1) , tensor(1) )</span><br><span class="line">( tensor(1) , tensor(2) )</span><br><span class="line">( tensor(1) , tensor(3) )</span><br><span class="line">( tensor(2) , tensor(0) )</span><br><span class="line">( tensor(2) , tensor(1) )</span><br><span class="line">( tensor(2) , tensor(2) )</span><br><span class="line">( tensor(2) , tensor(3) )</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; torch.stack((x,y),2)</span><br><span class="line">tensor([[[0, 0],</span><br><span class="line">         [0, 1],</span><br><span class="line">         [0, 2],</span><br><span class="line">         [0, 3],</span><br><span class="line">         [0, 4]],</span><br><span class="line"></span><br><span class="line">        [[1, 0],</span><br><span class="line">         [1, 1],</span><br><span class="line">         [1, 2],</span><br><span class="line">         [1, 3],</span><br><span class="line">         [1, 4]],</span><br><span class="line"></span><br><span class="line">        [[2, 0],</span><br><span class="line">         [2, 1],</span><br><span class="line">         [2, 2],</span><br><span class="line">         [2, 3],</span><br><span class="line">         [2, 4]]])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œåˆ’åˆ†äº†3Ã—4çš„ç½‘æ ¼ï¼Œé€šè¿‡éå†å¾—åˆ°çš„xå’Œyå°±èƒ½éå†å…¨éƒ¨æ ¼å­ã€‚</p>
<p>ä¸‹é¢æ˜¯yolov3ä¸­æä¾›çš„ä»£ç (éœ€è¦æ³¨æ„çš„æ˜¯è¿™æ˜¯é’ˆå¯¹æŸä¸€å±‚YOLOLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„YOLOLayerï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def create_grids(self,</span><br><span class="line">                 img_size&#x3D;416,</span><br><span class="line">                 ng&#x3D;(13, 13),</span><br><span class="line">                 device&#x3D;&#39;cpu&#39;,</span><br><span class="line">                 type&#x3D;torch.float32):</span><br><span class="line">    nx, ny &#x3D; ng  # ç½‘æ ¼å°ºå¯¸</span><br><span class="line">    self.img_size &#x3D; max(img_size)</span><br><span class="line">    #ä¸‹é‡‡æ ·å€æ•°ä¸º32</span><br><span class="line">    self.stride &#x3D; self.img_size &#x2F; max(ng)</span><br><span class="line"></span><br><span class="line">    # åˆ’åˆ†ç½‘æ ¼ï¼Œæ„å»ºç›¸å¯¹å·¦ä¸Šè§’çš„åç§»é‡</span><br><span class="line">    yv, xv &#x3D; torch.meshgrid([torch.arange(ny), torch.arange(nx)])</span><br><span class="line">    # é€šè¿‡ä»¥ä¸Šä¾‹å­å¾ˆå®¹æ˜“ç†è§£</span><br><span class="line">    self.grid_xy &#x3D; torch.stack((xv, yv), 2).to(device).type(type).view(</span><br><span class="line">        (1, 1, ny, nx, 2))</span><br><span class="line"></span><br><span class="line">    # å¤„ç†anchorï¼Œå°†å…¶é™¤ä»¥ä¸‹é‡‡æ ·å€æ•°</span><br><span class="line">    self.anchor_vec &#x3D; self.anchors.to(device) &#x2F; self.stride</span><br><span class="line">    self.anchor_wh &#x3D; self.anchor_vec.view(1, self.na, 1, 1,</span><br><span class="line">                                          2).to(device).type(type)</span><br><span class="line">    self.ng &#x3D; torch.Tensor(ng).to(device)</span><br><span class="line">    self.nx &#x3D; nx</span><br><span class="line">    self.ny &#x3D; ny</span><br></pre></td></tr></table></figure>
<h2 id="2-YOLOLayer"><a href="#2-YOLOLayer" class="headerlink" title="2. YOLOLayer"></a>2. YOLOLayer</h2><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®²è¿‡ï¼ŒYOLOå±‚å‰ä¸€å±‚å·ç§¯å±‚çš„filterä¸ªæ•°å…·æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œè®¡ç®—æ–¹æ³•ä¸ºï¼š</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/653.webp" alt></p>
<p><strong>è®­ç»ƒè¿‡ç¨‹ï¼š</strong></p>
<p>YOLOLayerçš„ä½œç”¨å°±æ˜¯å¯¹ä¸Šä¸€ä¸ªå·ç§¯å±‚å¾—åˆ°çš„å¼ é‡è¿›è¡Œå¤„ç†ï¼Œå…·ä½“å¯ä»¥çœ‹trainingè¿‡ç¨‹æ¶‰åŠçš„ä»£ç (æš‚æ—¶ä¸å…³å¿ƒONNXéƒ¨åˆ†çš„ä»£ç )ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class YOLOLayer(nn.Module):</span><br><span class="line">    def __init__(self, anchors, nc, img_size, yolo_index, arc):</span><br><span class="line">        super(YOLOLayer, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.anchors &#x3D; torch.Tensor(anchors)</span><br><span class="line">        self.na &#x3D; len(anchors)  # è¯¥YOLOLayeråˆ†é…ç»™æ¯ä¸ªgridçš„anchorçš„ä¸ªæ•°</span><br><span class="line">        self.nc &#x3D; nc  # ç±»åˆ«ä¸ªæ•°</span><br><span class="line">        self.no &#x3D; nc + 5  # æ¯ä¸ªæ ¼å­å¯¹åº”è¾“å‡ºçš„ç»´åº¦ class + 5 ä¸­5ä»£è¡¨x,y,w,h,conf</span><br><span class="line">        self.nx &#x3D; 0  # åˆå§‹åŒ–xæ–¹å‘ä¸Šçš„æ ¼å­æ•°é‡</span><br><span class="line">        self.ny &#x3D; 0  # åˆå§‹åŒ–yæ–¹å‘ä¸Šçš„æ ¼å­æ•°é‡</span><br><span class="line">        self.arc &#x3D; arc</span><br><span class="line"></span><br><span class="line">        if ONNX_EXPORT:  # grids must be computed in __init__</span><br><span class="line">            stride &#x3D; [32, 16, 8][yolo_index]  # stride of this layer</span><br><span class="line">            nx &#x3D; int(img_size[1] &#x2F; stride)  # number x grid points</span><br><span class="line">            ny &#x3D; int(img_size[0] &#x2F; stride)  # number y grid points</span><br><span class="line">            create_grids(self, img_size, (nx, ny))</span><br><span class="line"></span><br><span class="line">    def forward(self, p, img_size, var&#x3D;None):</span><br><span class="line">        &#39;&#39;&#39;</span><br><span class="line">        onnxä»£è¡¨å¼€æ”¾å¼ç¥ç»ç½‘ç»œäº¤æ¢</span><br><span class="line">        pytorchä¸­çš„æ¨¡å‹éƒ½å¯ä»¥å¯¼å‡ºæˆ–è½¬æ¢ä¸ºæ ‡å‡†ONNXæ ¼å¼</span><br><span class="line">        åœ¨æ¨¡å‹é‡‡ç”¨ONNXæ ¼å¼åï¼Œå³å¯åœ¨å„ç§å¹³å°å’Œè®¾å¤‡ä¸Šè¿è¡Œ</span><br><span class="line">        åœ¨è¿™é‡ŒONNXä»£è¡¨è§„èŒƒåŒ–çš„æ¨ç†è¿‡ç¨‹</span><br><span class="line">        &#39;&#39;&#39;</span><br><span class="line">        if ONNX_EXPORT:</span><br><span class="line">            bs &#x3D; 1  # batch size</span><br><span class="line">        else:</span><br><span class="line">            bs, _, ny, nx &#x3D; p.shape  # bs, 255, 13, 13</span><br><span class="line">            if (self.nx, self.ny) !&#x3D; (nx, ny):</span><br><span class="line">                create_grids(self, img_size, (nx, ny), p.device, p.dtype)</span><br><span class="line"></span><br><span class="line">        # p.view(bs, 255, 13, 13) -- &gt; (bs, 3, 13, 13, 85)</span><br><span class="line">        # (bs, anchors, grid, grid, classes + xywh)</span><br><span class="line">        p &#x3D; p.view(bs, self.na, self.no, self.ny,</span><br><span class="line">                   self.nx).permute(0, 1, 3, 4, 2).contiguous()</span><br><span class="line"></span><br><span class="line">        if self.training:</span><br><span class="line">            return p</span><br></pre></td></tr></table></figure>
<p>åœ¨ç†è§£ä»¥ä¸Šä»£ç çš„æ—¶å€™ï¼Œéœ€è¦ç†è§£æ¯ä¸€ä¸ªé€šé“æ‰€ä»£è¡¨çš„æ„ä¹‰ï¼ŒåŸå…ˆçš„Pæ˜¯ç”±ä¸Šä¸€å±‚å·ç§¯å¾—åˆ°çš„feature map, å½¢çŠ¶ä¸º(ä»¥80ä¸ªç±»åˆ«ã€è¾“å…¥416ã€ä¸‹é‡‡æ ·32å€ä¸ºä¾‹)ï¼šã€batch size, anchorÃ—(80+5), 13,  13ã€‘ï¼Œåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå°†feature mapé€šè¿‡å¼ é‡æ“ä½œè½¬åŒ–çš„å½¢çŠ¶ä¸ºï¼šã€batch size, anchor, 13, 13, 85ã€‘ã€‚</p>
<p><strong>æµ‹è¯•è¿‡ç¨‹ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pçš„å½¢çŠ¶ç›®å‰ä¸ºï¼šã€bs, anchor_num, gridx,gridy,xywhc+classã€‘</span><br><span class="line">else:  # æµ‹è¯•æ¨ç†è¿‡ç¨‹</span><br><span class="line">   # s &#x3D; 1.5  # scale_xy  (pxy &#x3D; pxy * s - (s - 1) &#x2F; 2)</span><br><span class="line">   io &#x3D; p.clone()  # æµ‹è¯•è¿‡ç¨‹è¾“å‡ºå°±æ˜¯io</span><br><span class="line">   io[..., :2] &#x3D; torch.sigmoid(io[..., :2]) + self.grid_xy  # xy</span><br><span class="line">   # grid_xyæ˜¯å·¦ä¸Šè§’å†åŠ ä¸Šåç§»é‡io[...:2]ä»£è¡¨xyåç§»</span><br><span class="line">   io[..., 2:4] &#x3D; torch.exp(</span><br><span class="line">       io[..., 2:4]) * self.anchor_wh  # wh yolo method</span><br><span class="line">   # io[..., 2:4] &#x3D; ((torch.sigmoid(io[..., 2:4]) * 2) ** 3) * self.anchor_wh</span><br><span class="line">   # wh power method</span><br><span class="line">   io[..., :4] *&#x3D; self.stride</span><br><span class="line"></span><br><span class="line">   if &#39;default&#39; in self.arc:  # seperate obj and cls</span><br><span class="line">       torch.sigmoid_(io[..., 4])</span><br><span class="line">   elif &#39;BCE&#39; in self.arc:  # unified BCE (80 classes)</span><br><span class="line">       torch.sigmoid_(io[..., 5:])</span><br><span class="line">       io[..., 4] &#x3D; 1</span><br><span class="line">   elif &#39;CE&#39; in self.arc:  # unified CE (1 background + 80 classes)</span><br><span class="line">       io[..., 4:] &#x3D; F.softmax(io[..., 4:], dim&#x3D;4)</span><br><span class="line">       io[..., 4] &#x3D; 1</span><br><span class="line"></span><br><span class="line">   if self.nc &#x3D;&#x3D; 1:</span><br><span class="line">       io[..., 5] &#x3D; 1</span><br><span class="line">       # single-class model https:&#x2F;&#x2F;github.com&#x2F;ultralytics&#x2F;yolov3&#x2F;issues&#x2F;235</span><br><span class="line"></span><br><span class="line">   # reshape from [1, 3, 13, 13, 85] to [1, 507, 85]</span><br><span class="line">   return io.view(bs, -1, self.no), p</span><br></pre></td></tr></table></figure>
<p>ç†è§£ä»¥ä¸Šå†…å®¹æ˜¯éœ€è¦å¯¹åº”ä»¥ä¸‹å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned} b_{x}=& \sigma\left(t_{x}\right)+c_{x} \\ b_{y}=& \sigma\left(t_{y}\right)+c_{y} \\ b_{w}=& p_{w} e^{t_{x}} \\ b_{h}=& p_{h} e^{t_{h}} \end{aligned}</script><p><strong>xyéƒ¨åˆ†:</strong></p>
<script type="math/tex; mode=display">
b_{x}=\sigma\left(t_{x}\right)+c_{x}\\
b_{y}=\sigma\left(t_{y}\right)+c_{y}</script><p>$c_{x}, c_{y}$ä»£è¡¨çš„æ˜¯æ ¼å­çš„å·¦ä¸Šè§’åæ ‡ï¼›$t_{x}, t_{y}$ä»£è¡¨çš„æ˜¯ç½‘ç»œé¢„æµ‹çš„ç»“æœï¼› $\sigma$ä»£è¡¨sigmoidæ¿€æ´»å‡½æ•°ã€‚å¯¹åº”ä»£ç ç†è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">io[..., :2] &#x3D; torch.sigmoid(io[..., :2]) + self.grid_xy  # xy</span><br><span class="line"># grid_xyæ˜¯å·¦ä¸Šè§’å†åŠ ä¸Šåç§»é‡io[...:2]ä»£è¡¨xyåç§»</span><br></pre></td></tr></table></figure>
<p><strong>whéƒ¨åˆ†:</strong></p>
<script type="math/tex; mode=display">
b_{w}=p_{w} e^{t_{x}}\\
b_{h}=p_{h} e^{t_{h}}</script><p>$p_{w}, p_{h}$ä»£è¡¨çš„æ˜¯anchorå…ˆéªŒæ¡†åœ¨feature mapä¸Šå¯¹åº”çš„å¤§å°ã€‚$t_{w}, t_{h}$ä»£è¡¨çš„æ˜¯ç½‘ç»œå­¦ä¹ å¾—åˆ°çš„ç¼©æ”¾ç³»æ•°ã€‚å¯¹åº”ä»£ç ç†è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># wh yolo method</span><br><span class="line">io[..., 2:4] &#x3D; torch.exp(io[..., 2:4]) * self.anchor_wh</span><br></pre></td></tr></table></figure>
<p><strong>classéƒ¨åˆ†ï¼š</strong></p>
<p>åœ¨ç±»åˆ«éƒ¨åˆ†ï¼Œæä¾›äº†å‡ ç§æ–¹æ³•ï¼Œæ ¹æ®arcå‚æ•°æ¥è¿›è¡Œä¸åŒæ¨¡å¼çš„é€‰æ‹©ã€‚ä»¥CEï¼ˆcrossEntropyï¼‰ä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ioï¼š(bs, anchors, grid, grid, xywh+classes)</span><br><span class="line">io[..., 4:] &#x3D; F.softmax(io[..., 4:], dim&#x3D;4)# ä½¿ç”¨softmax</span><br><span class="line">io[..., 4] &#x3D; 1</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3ç½‘ç»œæ¨¡å‹çš„æ„å»º</title>
    <url>/2020/02/18/YOLOv3%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="1-cfgæ–‡ä»¶"><a href="#1-cfgæ–‡ä»¶" class="headerlink" title=" 1. cfgæ–‡ä»¶"></a><a id="more"></a> 1. cfgæ–‡ä»¶</h2><p>åœ¨YOLOv3ä¸­ï¼Œä¿®æ”¹ç½‘ç»œç»“æ„å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ä¿®æ”¹cfgæ–‡ä»¶å³å¯ã€‚ç›®å‰ï¼Œcfgæ–‡ä»¶æ”¯æŒconvolutional, maxpool, unsample, route, shortcut, yoloè¿™å‡ ä¸ªå±‚ã€‚</p>
<p>è€Œä¸”ä½œè€…ä¹Ÿæä¾›äº†å¤šä¸ªcfgæ–‡ä»¶æ¥è¿›è¡Œç½‘ç»œæ„å»ºï¼Œæ¯”å¦‚ï¼šyolov3.cfgã€yolov3-tiny.cfgã€yolov3-spp.cfgã€csresnext50-panet-spp.cfgæ–‡ä»¶ï¼ˆæä¾›çš„yolov3-spp-pan-scale.cfgæ–‡ä»¶ï¼Œåœ¨ä»£ç çº§åˆ«è¿˜æ²¡æœ‰æä¾›æ”¯æŒï¼‰ã€‚</p>
<p>å¦‚æœæƒ³è¦æ·»åŠ è‡ªå®šä¹‰çš„æ¨¡å—ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæ¯”å¦‚è¯´æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ã€ç©ºæ´å·ç§¯ç­‰ï¼Œéƒ½å¯ä»¥ç®€å•åœ°å¾—åˆ°æ·»åŠ æˆ–è€…ä¿®æ”¹ã€‚</p>
<p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ç†è§£cfgæ–‡ä»¶ç½‘ç»œæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œåœ¨è¿™é‡Œæ¨èä¸€ä¸ªGithubä¸Šçš„ç½‘ç»œç»“æ„å¯è§†åŒ–è½¯ä»¶ï¼š<code>Netron</code>ï¼Œä¸‹å›¾æ˜¯å¯è§†åŒ–yolov3-tinyçš„ç»“æœï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/648.jpg" alt></p>
<h2 id="2-ç½‘ç»œæ¨¡å‹æ„å»º"><a href="#2-ç½‘ç»œæ¨¡å‹æ„å»º" class="headerlink" title="2. ç½‘ç»œæ¨¡å‹æ„å»º"></a>2. ç½‘ç»œæ¨¡å‹æ„å»º</h2><p>ä»<code>train.py</code>æ–‡ä»¶å…¥æ‰‹ï¼Œå…¶ä¸­æ¶‰åŠçš„ç½‘ç»œæ„å»ºçš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Initialize model</span><br><span class="line">model &#x3D; Darknet(cfg, arc&#x3D;opt.arc).to(device)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ²¿ç€Darknetå®ç°è¿›è¡Œè®²è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Darknet(nn.Module):</span><br><span class="line">    # YOLOv3 object detection model</span><br><span class="line">    def __init__(self, cfg, img_size&#x3D;(416, 416), arc&#x3D;&#39;default&#39;):</span><br><span class="line">        super(Darknet, self).__init__()</span><br><span class="line">        self.module_defs &#x3D; parse_model_cfg(cfg)</span><br><span class="line">        self.module_list, self.routs &#x3D; create_modules(self.module_defs, img_size, arc)</span><br><span class="line">        self.yolo_layers &#x3D; get_yolo_layers(self)</span><br><span class="line"></span><br><span class="line">        # Darknet Header</span><br><span class="line">        self.version &#x3D; np.array([0, 2, 5], dtype&#x3D;np.int32)</span><br><span class="line">        # (int32) version info: major, minor, revision</span><br><span class="line">        self.seen &#x3D; np.array([0], dtype&#x3D;np.int64)</span><br><span class="line">        # (int64) number of images seen during training</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ–‡ä»¶ä¸­ï¼Œæ¯”è¾ƒå…³é”®çš„å°±æ˜¯æˆå‘˜å‡½å˜é‡<code>module_defs</code>ã€<code>module_list</code>ã€<code>routs</code>ã€<code>yolo_layers</code>å››ä¸ªæˆå‘˜å‡½æ•°ï¼Œå…ˆå¯¹è¿™å‡ ä¸ªå‚æ•°çš„æ„ä¹‰è¿›è¡Œè§£é‡Šï¼š</p>
<h3 id="2-1-module-defs"><a href="#2-1-module-defs" class="headerlink" title="2.1 module_defs"></a>2.1 module_defs</h3><p>è°ƒç”¨äº†<code>parse_model_cfg</code>å‡½æ•°ï¼Œå¾—åˆ°äº†<code>module_defs</code>å¯¹è±¡ã€‚å®é™…ä¸Šè¯¥å‡½æ•°æ˜¯é€šè¿‡è§£æcfgæ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªlistï¼Œlistä¸­åŒ…å«å¤šä¸ªå­—å…¸ï¼Œæ¯ä¸ªå­—å…¸ä¿å­˜çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªæ¨¡å—å†…å®¹ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;2</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def parse_model_cfg(path):</span><br><span class="line">    # pathå‚æ•°ä¸º: cfg&#x2F;yolov3-tiny.cfg</span><br><span class="line">    if not path.endswith(&#39;.cfg&#39;):</span><br><span class="line">        path +&#x3D; &#39;.cfg&#39;</span><br><span class="line">    if not os.path.exists(path) and os.path.exists(&#39;cfg&#39; + os.sep + path):</span><br><span class="line">        path &#x3D; &#39;cfg&#39; + os.sep + path</span><br><span class="line"></span><br><span class="line">    with open(path, &#39;r&#39;) as f:</span><br><span class="line">        lines &#x3D; f.read().split(&#39;\n&#39;)</span><br><span class="line"></span><br><span class="line">    # å»é™¤ä»¥#å¼€å¤´çš„ï¼Œå±äºæ³¨é‡Šéƒ¨åˆ†çš„å†…å®¹</span><br><span class="line">    lines &#x3D; [x for x in lines if x and not x.startswith(&#39;#&#39;)]</span><br><span class="line">    lines &#x3D; [x.rstrip().lstrip() for x in lines]</span><br><span class="line">    mdefs &#x3D; []  # æ¨¡å—çš„å®šä¹‰</span><br><span class="line">    for line in lines:</span><br><span class="line">        if line.startswith(&#39;[&#39;):  # æ ‡å¿—ç€ä¸€ä¸ªæ¨¡å—çš„å¼€å§‹</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line">            æ¯”å¦‚:</span><br><span class="line">            [shortcut]</span><br><span class="line">            from&#x3D;-3</span><br><span class="line">            activation&#x3D;linear</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line">            mdefs.append(&#123;&#125;)</span><br><span class="line">            mdefs[-1][&#39;type&#39;] &#x3D; line[1:-1].rstrip()</span><br><span class="line">            if mdefs[-1][&#39;type&#39;] &#x3D;&#x3D; &#39;convolutional&#39;:</span><br><span class="line">                mdefs[-1][&#39;batch_normalize&#39;] &#x3D; 0  </span><br><span class="line">                # pre-populate with zeros (may be overwritten later)</span><br><span class="line">        else:</span><br><span class="line">            # å°†é”®å’Œé”®å€¼æ”¾å…¥å­—å…¸</span><br><span class="line">            key, val &#x3D; line.split(&quot;&#x3D;&quot;)</span><br><span class="line">            key &#x3D; key.rstrip()</span><br><span class="line"></span><br><span class="line">            if &#39;anchors&#39; in key:</span><br><span class="line">                mdefs[-1][key] &#x3D; np.array([float(x) for x in val.split(&#39;,&#39;)]).reshape((-1, 2))  # np anchors</span><br><span class="line">            else:</span><br><span class="line">                mdefs[-1][key] &#x3D; val.strip()</span><br><span class="line"></span><br><span class="line">    # æ”¯æŒçš„å‚æ•°ç±»å‹</span><br><span class="line">    supported &#x3D; [&#39;type&#39;, &#39;batch_normalize&#39;, &#39;filters&#39;, &#39;size&#39;,\</span><br><span class="line">                 &#39;stride&#39;, &#39;pad&#39;, &#39;activation&#39;, &#39;layers&#39;, &#39;groups&#39;,\</span><br><span class="line">                 &#39;from&#39;, &#39;mask&#39;, &#39;anchors&#39;, &#39;classes&#39;, &#39;num&#39;, &#39;jitter&#39;, \</span><br><span class="line">                 &#39;ignore_thresh&#39;, &#39;truth_thresh&#39;, &#39;random&#39;,\</span><br><span class="line">                 &#39;stride_x&#39;, &#39;stride_y&#39;]</span><br><span class="line"></span><br><span class="line">    # åˆ¤æ–­æ‰€æœ‰å‚æ•°ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆè¦æ±‚çš„key</span><br><span class="line">    f &#x3D; []</span><br><span class="line">    for x in mdefs[1:]:</span><br><span class="line">        [f.append(k) for k in x if k not in f]</span><br><span class="line">    u &#x3D; [x for x in f if x not in supported]  # unsupported fields</span><br><span class="line">    assert not any(u), &quot;Unsupported fields %s in %s. See https:&#x2F;&#x2F;github.com&#x2F;ultralytics&#x2F;yolov3&#x2F;issues&#x2F;631&quot; % (u, path)</span><br><span class="line"></span><br><span class="line">    return mdefs</span><br></pre></td></tr></table></figure>
<p>è¿”å›çš„å†…å®¹é€šè¿‡debugæ¨¡å¼è¿›è¡ŒæŸ¥çœ‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/649.webp" alt></p>
<p>å…¶ä¸­éœ€è¦å…³æ³¨çš„å°±æ˜¯anchorçš„ç»„ç»‡ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/650.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œanchoræ˜¯æŒ‰ç…§æ¯ä¸¤ä¸ªä¸€å¯¹è¿›è¡Œç»„ç»‡çš„ï¼Œä¸æˆ‘ä»¬çš„ç†è§£ä¸€è‡´ã€‚</p>
<h3 id="2-2-module-list-amp-routs"><a href="#2-2-module-list-amp-routs" class="headerlink" title="2.2 module_list&amp;routs"></a>2.2 module_list&amp;routs</h3><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ç†è§£æ¨¡å‹æ„å»ºçš„å…³é”®ã€‚</p>
<p>åœ¨pytorchä¸­ï¼Œæ„å»ºæ¨¡å‹å¸¸è§çš„æœ‰é€šè¿‡Sequentialæˆ–è€…ModuleListè¿›è¡Œæ„å»ºã€‚</p>
<p><strong>é€šè¿‡Sequentialæ„å»º</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">model&#x3D;nn.Sequential()</span><br><span class="line">model.add_module(&#39;conv&#39;,nn.Conv2d(3,3,3))</span><br><span class="line">model.add_module(&#39;batchnorm&#39;,nn.BatchNorm2d(3))</span><br><span class="line">model.add_module(&#39;activation_layer&#39;,nn.ReLU())</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">model&#x3D;nn.Sequential(</span><br><span class="line">    nn.Conv2d(3,3,3),</span><br><span class="line">    nn.BatchNorm2d(3),</span><br><span class="line">    nn.ReLU()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from collections import OrderedDict</span><br><span class="line">model&#x3D;nn.Sequential(OrderedDict([</span><br><span class="line">    (&#39;conv&#39;,nn.Conv2d(3,3,3)),</span><br><span class="line">    (&#39;batchnorm&#39;,nn.BatchNorm2d(3)),</span><br><span class="line">    (&#39;activation_layer&#39;,nn.ReLU())</span><br><span class="line">]))</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡sequentialæ„å»ºçš„æ¨¡å—å†…éƒ¨<strong>å®ç°äº†forwardå‡½æ•°</strong>ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥å‚æ•°ï¼Œè¿›è¡Œè°ƒç”¨ã€‚</p>
<p><strong>é€šè¿‡ModuleListæ„å»º</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">model&#x3D;nn.ModuleList([nn.Linear(3,4),</span><br><span class="line">						 nn.ReLU(),</span><br><span class="line">						 nn.Linear(4,2)])</span><br></pre></td></tr></table></figure>
<p>ModuleListç±»ä¼¼listï¼Œå†…éƒ¨<strong>æ²¡æœ‰å®ç°forwardå‡½æ•°</strong>ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ„å»ºforwardå‡½æ•°,æ„å»ºè‡ªå·±æ¨¡å‹å¸¸ç”¨ModuleListå‡½æ•°å»ºç«‹å­æ¨¡å‹,å»ºç«‹forwardå‡½æ•°å®ç°å‰å‘ä¼ æ’­ã€‚</p>
<p>åœ¨YOLOv3ä¸­ï¼Œçµæ´»åœ°ç»“åˆäº†ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œé€šè¿‡è§£æä»¥ä¸Šå¾—åˆ°çš„module_defsï¼Œè¿›è¡Œæ„å»ºä¸€ä¸ªModuleListï¼Œç„¶åå†é€šè¿‡æ„å»ºforwardå‡½æ•°è¿›è¡Œå‰å‘ä¼ æ’­å³å¯ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def create_modules(module_defs, img_size, arc):</span><br><span class="line">    # é€šè¿‡module_defsè¿›è¡Œæ„å»ºæ¨¡å‹</span><br><span class="line">    hyperparams &#x3D; module_defs.pop(0)</span><br><span class="line">    output_filters &#x3D; [int(hyperparams[&#39;channels&#39;])]</span><br><span class="line">    module_list &#x3D; nn.ModuleList()</span><br><span class="line">    routs &#x3D; []  # å­˜å‚¨äº†æ‰€æœ‰çš„å±‚ï¼Œåœ¨routeã€shortcutä¼šä½¿ç”¨åˆ°ã€‚</span><br><span class="line">    yolo_index &#x3D; -1</span><br><span class="line"></span><br><span class="line">    for i, mdef in enumerate(module_defs):</span><br><span class="line">        modules &#x3D; nn.Sequential()</span><br><span class="line">        &#39;&#39;&#39;</span><br><span class="line">        é€šè¿‡typeå­—æ ·ä¸åŒçš„ç±»å‹ï¼Œæ¥è¿›è¡Œæ¨¡å‹æ„å»º</span><br><span class="line">        &#39;&#39;&#39;</span><br><span class="line">        if mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;convolutional&#39;:</span><br><span class="line">            bn &#x3D; int(mdef[&#39;batch_normalize&#39;])</span><br><span class="line">            filters &#x3D; int(mdef[&#39;filters&#39;])</span><br><span class="line">            size &#x3D; int(mdef[&#39;size&#39;])</span><br><span class="line">            stride &#x3D; int(mdef[&#39;stride&#39;]) if &#39;stride&#39; in mdef else (int(</span><br><span class="line">                mdef[&#39;stride_y&#39;]), int(mdef[&#39;stride_x&#39;]))</span><br><span class="line">            pad &#x3D; (size - 1) &#x2F;&#x2F; 2 if int(mdef[&#39;pad&#39;]) else 0</span><br><span class="line">            modules.add_module(</span><br><span class="line">                &#39;Conv2d&#39;,</span><br><span class="line">                nn.Conv2d(</span><br><span class="line">                    in_channels&#x3D;output_filters[-1],</span><br><span class="line">                    out_channels&#x3D;filters,</span><br><span class="line">                    kernel_size&#x3D;size,</span><br><span class="line">                    stride&#x3D;stride,</span><br><span class="line">                    padding&#x3D;pad,</span><br><span class="line">                    groups&#x3D;int(mdef[&#39;groups&#39;]) if &#39;groups&#39; in mdef else 1,</span><br><span class="line">                    bias&#x3D;not bn))</span><br><span class="line">            if bn:</span><br><span class="line">                modules.add_module(&#39;BatchNorm2d&#39;,</span><br><span class="line">                                   nn.BatchNorm2d(filters, momentum&#x3D;0.1))</span><br><span class="line">            if mdef[&#39;activation&#39;] &#x3D;&#x3D; &#39;leaky&#39;:  # TODO: activation study https:&#x2F;&#x2F;github.com&#x2F;ultralytics&#x2F;yolov3&#x2F;issues&#x2F;441</span><br><span class="line">                modules.add_module(&#39;activation&#39;, nn.LeakyReLU(0.1,</span><br><span class="line">                                                              inplace&#x3D;True))</span><br><span class="line">            elif mdef[&#39;activation&#39;] &#x3D;&#x3D; &#39;swish&#39;:</span><br><span class="line">                modules.add_module(&#39;activation&#39;, Swish())</span><br><span class="line">            # åœ¨æ­¤å¤„å¯ä»¥æ·»åŠ æ–°çš„æ¿€æ´»å‡½æ•°</span><br><span class="line"></span><br><span class="line">        elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;maxpool&#39;:</span><br><span class="line">            # æœ€å¤§æ± åŒ–æ“ä½œ</span><br><span class="line">            size &#x3D; int(mdef[&#39;size&#39;])</span><br><span class="line">            stride &#x3D; int(mdef[&#39;stride&#39;])</span><br><span class="line">            maxpool &#x3D; nn.MaxPool2d(kernel_size&#x3D;size,</span><br><span class="line">                                   stride&#x3D;stride,</span><br><span class="line">                                   padding&#x3D;int((size - 1) &#x2F;&#x2F; 2))</span><br><span class="line">            if size &#x3D;&#x3D; 2 and stride &#x3D;&#x3D; 1:  # yolov3-tiny</span><br><span class="line">                modules.add_module(&#39;ZeroPad2d&#39;, nn.ZeroPad2d((0, 1, 0, 1)))</span><br><span class="line">                modules.add_module(&#39;MaxPool2d&#39;, maxpool)</span><br><span class="line">            else:</span><br><span class="line">                modules &#x3D; maxpool</span><br><span class="line"></span><br><span class="line">        elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;upsample&#39;:</span><br><span class="line">            # é€šè¿‡è¿‘é‚»æ’å€¼å®Œæˆä¸Šé‡‡æ ·</span><br><span class="line">            modules &#x3D; nn.Upsample(scale_factor&#x3D;int(mdef[&#39;stride&#39;]),</span><br><span class="line">                                  mode&#x3D;&#39;nearest&#39;)</span><br><span class="line"></span><br><span class="line">        elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;route&#39;:</span><br><span class="line">            # nn.Sequential() placeholder for &#39;route&#39; layer</span><br><span class="line">            layers &#x3D; [int(x) for x in mdef[&#39;layers&#39;].split(&#39;,&#39;)]</span><br><span class="line">            filters &#x3D; sum(</span><br><span class="line">                [output_filters[i + 1 if i &gt; 0 else i] for i in layers])</span><br><span class="line">            # extendè¡¨ç¤ºæ·»åŠ ä¸€ç³»åˆ—å¯¹è±¡</span><br><span class="line">            routs.extend([l if l &gt; 0 else l + i for l in layers])</span><br><span class="line"></span><br><span class="line">        elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;shortcut&#39;:</span><br><span class="line">            # nn.Sequential() placeholder for &#39;shortcut&#39; layer</span><br><span class="line">            filters &#x3D; output_filters[int(mdef[&#39;from&#39;])]</span><br><span class="line">            layer &#x3D; int(mdef[&#39;from&#39;])</span><br><span class="line">            routs.extend([i + layer if layer &lt; 0 else layer])</span><br><span class="line"></span><br><span class="line">        elif mdef[&#39;type&#39;] &#x3D;&#x3D; &#39;yolo&#39;:</span><br><span class="line">            yolo_index +&#x3D; 1</span><br><span class="line">            mask &#x3D; [int(x) for x in mdef[&#39;mask&#39;].split(&#39;,&#39;)]  # anchor mask</span><br><span class="line">            modules &#x3D; YOLOLayer(</span><br><span class="line">                anchors&#x3D;mdef[&#39;anchors&#39;][mask],  # anchor list</span><br><span class="line">                nc&#x3D;int(mdef[&#39;classes&#39;]),  # number of classes</span><br><span class="line">                img_size&#x3D;img_size,  # (416, 416)</span><br><span class="line">                yolo_index&#x3D;yolo_index,  # 0, 1 or 2</span><br><span class="line">                arc&#x3D;arc)  # yolo architecture</span><br><span class="line"></span><br><span class="line">            # è¿™æ˜¯åœ¨focal lossæ–‡ç« ä¸­æåˆ°çš„ä¸ºå·ç§¯å±‚æ·»åŠ bias</span><br><span class="line">            # ä¸»è¦ç”¨äºè§£å†³æ ·æœ¬ä¸å¹³è¡¡é—®é¢˜</span><br><span class="line">            # (è®ºæ–‡åœ°å€ https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;1708.02002.pdf section 3.3)</span><br><span class="line">            # å…·ä½“è®²è§£è§ä¸‹æ–¹</span><br><span class="line">            try:</span><br><span class="line">                if arc &#x3D;&#x3D; &#39;defaultpw&#39; or arc &#x3D;&#x3D; &#39;Fdefaultpw&#39;:</span><br><span class="line">                    # default with positive weights</span><br><span class="line">                    b &#x3D; [-5.0, -5.0]  # obj, cls</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;default&#39;:</span><br><span class="line">                    # default no pw (40 cls, 80 obj)</span><br><span class="line">                    b &#x3D; [-5.0, -5.0]</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;uBCE&#39;:</span><br><span class="line">                    # unified BCE (80 classes)</span><br><span class="line">                    b &#x3D; [0, -9.0]</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;uCE&#39;:</span><br><span class="line">                    # unified CE (1 background + 80 classes)</span><br><span class="line">                    b &#x3D; [10, -0.1]</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;Fdefault&#39;:</span><br><span class="line">                    # Focal default no pw (28 cls, 21 obj, no pw)</span><br><span class="line">                    b &#x3D; [-2.1, -1.8]</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;uFBCE&#39; or arc &#x3D;&#x3D; &#39;uFBCEpw&#39;:</span><br><span class="line">                    # unified FocalBCE (5120 obj, 80 classes)</span><br><span class="line">                    b &#x3D; [0, -6.5]</span><br><span class="line">                elif arc &#x3D;&#x3D; &#39;uFCE&#39;:</span><br><span class="line">                    # unified FocalCE (64 cls, 1 background + 80 classes)</span><br><span class="line">                    b &#x3D; [7.7, -1.1]</span><br><span class="line"></span><br><span class="line">                bias &#x3D; module_list[-1][0].bias.view(len(mask), -1)</span><br><span class="line">                # 255 to 3x85</span><br><span class="line">                bias[:, 4] +&#x3D; b[0] - bias[:, 4].mean()  # obj</span><br><span class="line">                bias[:, 5:] +&#x3D; b[1] - bias[:, 5:].mean()  # cls</span><br><span class="line">                </span><br><span class="line">                # å°†æ–°çš„åç§»é‡èµ‹å€¼å›æ¨¡å‹ä¸­</span><br><span class="line">                module_list[-1][0].bias &#x3D; torch.nn.Parameter(bias.view(-1))</span><br><span class="line"></span><br><span class="line">            except:</span><br><span class="line">                print(&#39;WARNING: smart bias initialization failure.&#39;)</span><br><span class="line"></span><br><span class="line">        else:</span><br><span class="line">            print(&#39;Warning: Unrecognized Layer Type: &#39; + mdef[&#39;type&#39;])</span><br><span class="line"></span><br><span class="line">        # å°†moduleå†…å®¹ä¿å­˜åœ¨module_listä¸­ã€‚</span><br><span class="line">        module_list.append(modules)</span><br><span class="line">        # ä¿å­˜æ‰€æœ‰çš„filterä¸ªæ•°</span><br><span class="line">        output_filters.append(filters)</span><br><span class="line"></span><br><span class="line">    return module_list, routs</span><br></pre></td></tr></table></figure>
<p><strong>biaséƒ¨åˆ†è®²è§£</strong></p>
<p>å…¶ä¸­åœ¨YOLO Layeréƒ¨åˆ†æ¶‰åŠåˆ°ä¸€ä¸ªåˆå§‹åŒ–çš„trickï¼Œæ¥è‡ªFocal Lossä¸­å…³äºæ¨¡å‹åˆå§‹åŒ–çš„è®¨è®ºï¼Œå…·ä½“å†…å®¹è¯·é˜…è¯»è®ºæ–‡ï¼Œ<code>https://arxiv.org/pdf/1708.02002.pdf</code> çš„ç¬¬3.3èŠ‚ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/651.webp" alt></p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªéå¸¸insightçš„ç‚¹ï¼Œåœ¨ç¬¬ä¸€ç¯‡ä¸­ä»‹ç»äº†ï¼ŒYOLOå±‚å‰ä¸€ä¸ªå·ç§¯çš„filterä¸ªæ•°è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
filter=(c l a s s+5) \times 3</script><p>5ä»£è¡¨x,y,w,h, scoreï¼Œscoreä»£è¡¨è¯¥æ ¼å­ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡ï¼Œ3ä»£è¡¨è¿™ä¸ªæ ¼å­ä¸­ä¼šåˆ†é…3ä¸ªanchorè¿›è¡ŒåŒ¹é…ã€‚åœ¨YOLOLayerä¸­çš„forwardå‡½æ•°ä¸­ï¼Œæœ‰ä»¥ä¸‹ä»£ç ï¼Œéœ€è¦é€šè¿‡sigmoidæ¿€æ´»å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if &#39;default&#39; in self.arc:  # seperate obj and cls</span><br><span class="line">	torch.sigmoid_(io[..., 4])</span><br><span class="line">elif &#39;BCE&#39; in self.arc:  # unified BCE (80 classes)</span><br><span class="line">	torch.sigmoid_(io[..., 5:])</span><br><span class="line">	io[..., 4] &#x3D; 1</span><br><span class="line">elif &#39;CE&#39; in self.arc:  # unified CE (1 background + 80 classes)</span><br><span class="line">	io[..., 4:] &#x3D; F.softmax(io[..., 4:], dim&#x3D;4)</span><br><span class="line">	io[..., 4] &#x3D; 1</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/652.png" alt></p>
<p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼ŒSigmoidæ¢¯åº¦æ˜¯æœ‰é™çš„ï¼Œåœ¨<code>[-5,5]</code>ä¹‹é—´ã€‚</p>
<p>è€Œpytorchä¸­çš„å·ç§¯å±‚é»˜è®¤çš„åˆå§‹åŒ–æ˜¯ä»¥0ä¸ºä¸­å¿ƒç‚¹çš„æ­£æ€åˆ†å¸ƒï¼Œè¿™æ ·è¿›è¡Œçš„åˆå§‹åŒ–ä¼šå¯¼è‡´å¾ˆå¤šgirdä¸­å¤§çº¦ä¸€åŠå¾—åˆ°äº†æ¿€æ´»ï¼Œåœ¨è®¡ç®—lossçš„æ—¶å€™å°±ä¼šè®¡ç®—ä¸Šæ‰€æœ‰çš„æ¿€æ´»çš„ç‚¹å¯¹åº”çš„åæ ‡ä¿¡æ¯ï¼Œè¿™æ ·è®¡ç®—losså°±ä¼šå˜å¾—å¾ˆå¤§ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªç°è±¡ï¼Œä½œè€…é€‰æ‹©åœ¨YOLOLayerçš„å‰ä¸€ä¸ªå·ç§¯å±‚æ·»åŠ biasï¼Œæ¥é¿å…è¿™ç§æƒ…å†µï¼Œå®é™…æ“ä½œå°±æ˜¯åœ¨åŸæœ‰çš„biasä¸Šå‡å»5ï¼Œè¿™æ ·é€šè¿‡å·ç§¯å¾—åˆ°çš„æ•°å€¼å°±ä¸ä¼šè¢«æ¿€æ´»ï¼Œå¯ä»¥é˜²æ­¢åœ¨åˆå§‹é˜¶æ®µçš„ç¬¬ä¸€ä¸ªbatchä¸­å°±è¿›è¡Œè¿‡æ‹Ÿåˆã€‚é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œèƒ½å¤Ÿè®©æ‰€æœ‰çš„ç¥ç»å…ƒåœ¨å‰å‡ ä¸ªbatchä¸­è¾“å‡ºç©ºçš„æ£€æµ‹ã€‚</p>
<p>ç»è¿‡ä½œè€…çš„å®éªŒï¼Œé€šè¿‡ä½¿ç”¨biasçš„trickï¼Œå¯ä»¥æå‡mAPã€F1ã€Pã€Rç­‰æŒ‡æ ‡ï¼Œè¿˜èƒ½è®©è®­ç»ƒè¿‡ç¨‹æ›´åŠ å¹³æ»‘ã€‚</p>
<h3 id="2-3-yolo-layers"><a href="#2-3-yolo-layers" class="headerlink" title="2.3 yolo_layers"></a>2.3 yolo_layers</h3><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def get_yolo_layers(model):</span><br><span class="line">    return [i for i, x in enumerate(model.module_defs) if x[&#39;type&#39;] &#x3D;&#x3D; &#39;yolo&#39;]</span><br><span class="line">    # [82, 94, 106] for yolov3</span><br></pre></td></tr></table></figure>
<p>yolo layerçš„è·å–æ˜¯é€šè¿‡è§£æmodule_defsè¿™ä¸ªå­˜å‚¨cfgæ–‡ä»¶ä¸­çš„ä¿¡æ¯çš„å˜é‡å¾—åˆ°çš„ã€‚ä»¥yolov3.cfgä¸ºä¾‹ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯yoloå±‚åœ¨æ•´ä¸ªmoduleçš„åºå·ã€‚æ¯”å¦‚ï¼šç¬¬83,94,106ä¸ªå±‚æ˜¯YOLOå±‚ã€‚</p>
<h2 id="3-forwardå‡½æ•°"><a href="#3-forwardå‡½æ•°" class="headerlink" title="3. forwardå‡½æ•°"></a>3. forwardå‡½æ•°</h2><p>åœ¨YOLOä¸­ï¼Œå¦‚æœèƒ½ç†è§£å‰å‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œé‚£æ•´ä¸ªç½‘ç»œçš„æ„å»ºä¹Ÿå°±å¾ˆæ¸…æ¥šæ˜äº†äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def forward(self, x, var&#x3D;None):</span><br><span class="line">    img_size &#x3D; x.shape[-2:]</span><br><span class="line">    layer_outputs &#x3D; []</span><br><span class="line">    output &#x3D; []</span><br><span class="line"></span><br><span class="line">    for i, (mdef,</span><br><span class="line">            module) in enumerate(zip(self.module_defs, self.module_list)):</span><br><span class="line">        mtype &#x3D; mdef[&#39;type&#39;]</span><br><span class="line">        if mtype in [&#39;convolutional&#39;, &#39;upsample&#39;, &#39;maxpool&#39;]:</span><br><span class="line">            # å·ç§¯å±‚ï¼Œä¸Šé‡‡æ ·ï¼Œæ± åŒ–å±‚åªéœ€è¦ç»è¿‡å³å¯</span><br><span class="line">            x &#x3D; module(x)</span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;route&#39;:</span><br><span class="line">            # routeæ“ä½œå°±æ˜¯å°†å‡ ä¸ªå±‚çš„å†…å®¹æ‹¼æ¥èµ·æ¥ï¼Œå…·ä½“å¯ä»¥çœ‹cfgæ–‡ä»¶è§£æ</span><br><span class="line">            layers &#x3D; [int(x) for x in mdef[&#39;layers&#39;].split(&#39;,&#39;)]</span><br><span class="line">            if len(layers) &#x3D;&#x3D; 1:</span><br><span class="line">                x &#x3D; layer_outputs[layers[0]]</span><br><span class="line">            else:</span><br><span class="line">                try:</span><br><span class="line">                    x &#x3D; torch.cat([layer_outputs[i] for i in layers], 1)</span><br><span class="line">                except:</span><br><span class="line">                    # apply stride 2 for darknet reorg layer</span><br><span class="line">                    layer_outputs[layers[1]] &#x3D; F.interpolate(</span><br><span class="line">                        layer_outputs[layers[1]], scale_factor&#x3D;[0.5, 0.5])</span><br><span class="line">                    x &#x3D; torch.cat([layer_outputs[i] for i in layers], 1)</span><br><span class="line"></span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;shortcut&#39;:</span><br><span class="line">            x &#x3D; x + layer_outputs[int(mdef[&#39;from&#39;])]</span><br><span class="line">        elif mtype &#x3D;&#x3D; &#39;yolo&#39;:</span><br><span class="line">            output.append(module(x, img_size))</span><br><span class="line">        #è®°å½•routeå¯¹åº”çš„å±‚</span><br><span class="line">        layer_outputs.append(x if i in self.routs else [])</span><br><span class="line"></span><br><span class="line">    if self.training:</span><br><span class="line">        # å¦‚æœè®­ç»ƒï¼Œç›´æ¥è¾“å‡ºYOLOè¦æ±‚çš„Tensor</span><br><span class="line">        # 3*(class+5)</span><br><span class="line">        return output</span><br><span class="line">    </span><br><span class="line">    elif ONNX_EXPORT:# è¿™ä¸ªæ˜¯å¯¹åº”çš„onnxå¯¼å‡ºçš„å†…å®¹</span><br><span class="line">        x &#x3D; [torch.cat(x, 0) for x in zip(*output)]</span><br><span class="line">        return x[0], torch.cat(x[1:3], 1)  # scores, boxes: 3780x80, 3780x4</span><br><span class="line">    else:</span><br><span class="line">        # å¯¹åº”æµ‹è¯•é˜¶æ®µ</span><br><span class="line">        io, p &#x3D; list(zip(*output))  # inference output, training output</span><br><span class="line">        return torch.cat(io, 1), p</span><br></pre></td></tr></table></figure>
<p>forwardçš„è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡å¾—åˆ°çš„module_defså’Œmodule_listå˜é‡ï¼Œé€šè¿‡forå¾ªç¯å°†æ•´ä¸ªmodule_listä¸­çš„å†…å®¹è¿›è¡Œä¸€éä¸²è”ï¼Œéœ€è¦å¾—åˆ°çš„æœ€ç»ˆç»“æœæ˜¯YOLOå±‚çš„è¾“å‡ºã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨frpæœåŠ¡å®ç°å¯¹å†…ç½‘æœºå™¨çš„è¿œç¨‹è¿æ¥</title>
    <url>/2020/02/16/%E4%BD%BF%E7%94%A8frp%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/</url>
    <content><![CDATA[<h2 id="ä¸ºä½•è¦ç”¨"><a href="#ä¸ºä½•è¦ç”¨" class="headerlink" title=" ä¸ºä½•è¦ç”¨"></a><a id="more"></a> ä¸ºä½•è¦ç”¨</h2><p>æˆ‘ä»¬å¹¶ä¸æ˜¯æ¯å¤©éƒ½ä¼šæ¥è§¦åˆ°å®éªŒå®¤å†…ç½‘ç¯å¢ƒã€‚å½“ä¸åœ¨å­¦æ ¡æ—¶ï¼Œå¦‚ä½•è®¿é—®å†…ç½‘çš„èµ„æºæˆäº†ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ã€‚æœ¬æ–‡æ—¨åœ¨æå‡ºä¸€ç§å†…ç½‘ç©¿é€è§£å†³æ–¹æ¡ˆï¼Œåœ¨å¤–ç½‘ç¯å¢ƒä¸‹ä¼˜é›…çš„è®¿é—®åˆ°å†…ç½‘çš„ä»»ä½•ç«¯å£ã€‚å³ä½¿èº«ç¦»å­¦æ ¡ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ä¿®æ”¹å†…ç½‘æ¨¡å‹ï¼Œè®¿é—®å†…ç½‘è®¡ç®—èµ„æºã€‚ </p>
<h2 id="ç‰¹æ®Šéœ€è¦"><a href="#ç‰¹æ®Šéœ€è¦" class="headerlink" title="ç‰¹æ®Šéœ€è¦"></a>ç‰¹æ®Šéœ€è¦</h2><ul>
<li><p>ä¸€å°å…¬ç½‘æœºï¼ˆæœ‰å…¬ç½‘ipçš„vpsï¼Œ æ¯”å¦‚é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼‰</p>
</li>
<li><p>frp ç«¯å£è½¬å‘è½¯ä»¶ :<a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p>
</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>windowsä¸ç”¨è¯´ï¼Œè¿™é‡Œè®²Ubuntuçš„å®‰è£…</p>
<p>é€‰æ‹©ç›¸åº”ç‰ˆæœ¬ï¼Œå³é”®å¤åˆ¶é“¾æ¥</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/Snipaste_2020-02-16_15-19-58.jpg" alt></p>
<p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥<code>wget å¤åˆ¶çš„é“¾æ¥åœ°å€</code>å³å¯å¼€å§‹ä¸‹è½½</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/Snipaste_2020-02-16_15-25-08.jpg" alt></p>
<p>ä¸‹è½½å®Œæˆåï¼Œæ‰¾åˆ°å®‰è£…åŒ…ï¼Œè§£å‹å³å¯ï¼Œè§£å‹å‘½ä»¤ä¸º<code>tar -zxvf åŒ…å</code></p>
<p><strong>å…¬ç½‘æœºã€å†…ç½‘æœºéƒ½éœ€è¦å®‰è£…ï¼Œä¸”frpç‰ˆæœ¬è¦ä¸€è‡´ã€‚</strong></p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="å…¬ç½‘æœºé…ç½®"><a href="#å…¬ç½‘æœºé…ç½®" class="headerlink" title="å…¬ç½‘æœºé…ç½®"></a>å…¬ç½‘æœºé…ç½®</h3><p>ä¿®æ”¹ <strong>frps.ini</strong> æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨äº†æœ€ç®€åŒ–çš„é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000 <span class="comment">#è¿™ä¸ªç«¯å£ä»£è¡¨å†…ç½‘æœºè¿åˆ°å…¬ç½‘æ‰€éœ€ç«¯å£ï¼Œé»˜è®¤7000ï¼Œå¯è‡ªå·±å®šä¹‰</span></span><br></pre></td></tr></table></figure>
<p>Windows å¯åŠ¨ frpsï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frps.exe -c .&#x2F;frps.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu å¯åŠ¨ frps:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frps -c .&#x2F;frps.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu åœ¨åå°å¼€å¯è¿è¡Œ frp æœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nohup .&#x2F;frps -c frps.ini &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h3 id="å†…ç½‘æœºå™¨é…ç½®"><a href="#å†…ç½‘æœºå™¨é…ç½®" class="headerlink" title="å†…ç½‘æœºå™¨é…ç½®"></a>å†…ç½‘æœºå™¨é…ç½®</h3><p>ä¿®æ”¹ <strong>frpc.ini</strong> æ–‡ä»¶ï¼Œå‡è®¾ <strong>frps</strong> æ‰€åœ¨æœåŠ¡å™¨çš„å…¬ç½‘ IP ä¸º x.x.x.xï¼›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; x.x.x.x #è¿™é‡Œå¯ä»¥æ˜¯å…¬ç½‘æœºçš„åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ip</span><br><span class="line">server_port &#x3D; 7000 #åˆšåˆšå…¬ç½‘æœºé…ç½®çš„ä¸å†…ç½‘æœºäº¤æ¢çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">local_ip &#x3D; 127.0.0.1</span><br><span class="line">local_port &#x3D; 22 #æœ¬åœ°ç«¯å£å·ï¼Œæœ¬åœ°éœ€è¦è½¬å‘çš„ç«¯å£ é»˜è®¤22 å¯è‡ªå·±è®¾å®š</span><br><span class="line">remote_port &#x3D; 6000  #è¿œç¨‹ç«¯å£å·ï¼Œå°†ç«¯å£æ˜ å°„åˆ°å…¬ç½‘ç›¸åº”çš„ç«¯å£ å¯è‡ªå·±è®¾å®š</span><br></pre></td></tr></table></figure>
<p>Windows å¯åŠ¨ frpcï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frpc.exe -c .&#x2F;frpc.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu å¯åŠ¨ frpcï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frpc -c .&#x2F;frpc.ini</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œä½ å°±å¯ä»¥é€šè¿‡ä½ çš„å¤–ç½‘ IP + è¿œç¨‹ç«¯å£å·æ¥å®ç°å¯¹å†…ç½‘ç›¸å…³æœåŠ¡çš„è®¿é—®äº†ã€‚</p>
<h2 id="è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºå¯åŠ¨"></a>è®¾ç½®å¼€æœºå¯åŠ¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;frpc.service</span><br></pre></td></tr></table></figure>
<p>æŒ‰å¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;frpc daemon</span><br><span class="line">After&#x3D;syslog.target  network.target</span><br><span class="line">Wants&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;frp&#x2F;frpc -c &#x2F;etc&#x2F;frp&#x2F;frpc.ini</span><br><span class="line">Restart&#x3D; always</span><br><span class="line">RestartSec&#x3D;1min</span><br><span class="line">ExecStop&#x3D;&#x2F;usr&#x2F;bin&#x2F;killall frpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>sudo systemctl enable frpc.service</code>å¯ç”¨æœåŠ¡</p>
<p>æœåŠ¡å™¨ç«¯ï¼ˆå…¬ç½‘æœºå™¨ï¼‰åŒç†</p>
<h2 id="ç™½å«–ç®€åŒ–æ­¥éª¤"><a href="#ç™½å«–ç®€åŒ–æ­¥éª¤" class="headerlink" title="ç™½å«–ç®€åŒ–æ­¥éª¤"></a>ç™½å«–ç®€åŒ–æ­¥éª¤</h2><p>è€ƒè™‘åˆ°å¾ˆå¤šäººè´Ÿæ‹…ä¸èµ·å…¬ç½‘æœºçš„ä»·æ ¼ï¼Œè¿™é‡Œæä¾›å‘å¸ƒå…è´¹å…¬ç½‘åŸŸåçš„ç½‘ç«™<br><a href="http://www.frps.top/" target="_blank" rel="noopener">frpå…è´¹å…¬å…±æœåŠ¡å™¨åˆ—è¡¨</a></p>
<p>ç”±äºåŸŸåä¾›åº”å•†å·²ç»é…ç½®å¥½äº†å…¬ç½‘æœºç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é…ç½®æˆ‘ä»¬éœ€è¦è¿æ¥çš„å†…ç½‘æœºå³å¯</p>
<p>é¦–å…ˆæ‰¾åˆ°å¯ç”¨çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/Snipaste_2020-02-16_15-47-16.jpg" alt></p>
<p>ä¸Šé¢æ˜¾ç¤ºå®ƒæ‰€ç”¨çš„frpç‰ˆæœ¬ä¸º0.14.1ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¿…é¡»å®‰è£…<strong>ç›¸åº”çš„frpç‰ˆæœ¬</strong>åœ¨å†…ç½‘æœºä¸Šï¼Œå¦åˆ™ç”±äºè½¯ä»¶ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¿ä¸ä¸Šã€‚</p>
<p>æŒ‰ç…§ä¹‹å‰çš„æ•™ç¨‹ï¼Œæ ¹æ®æ‰€æä¾›çš„ä¿¡æ¯ï¼Œä¿®æ”¹<strong>frpc.ini</strong>ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/TIM%E5%9B%BE%E7%89%8720200216154853.jpg" alt></p>
<p>è¿™é‡Œæ³¨æ„0.17.0ç‰ˆæœ¬ä¹‹å‰ç”¨çš„æ˜¯<code>privilege_token = xxxx</code>ï¼Œè€Œä¹‹åçš„ç‰ˆæœ¬ç”¨çš„æ˜¯<code>token = xxxx</code>ï¼Œ<strong>è¿œç¨‹ç«¯å£å·å¿…é¡»è®¾ç½®åœ¨æœåŠ¡å•†æ‰€æä¾›çš„èŒƒå›´å†…</strong>ï¼Œå¦‚å›¾ä¸­TCP/UDPç«¯å£ä¸º1000-65535ï¼Œåˆ™å†æ­¤åŒºé—´ä»»å–ç«¯å£å¡«å…¥å°±è¡Œã€‚</p>
<p>è®¾ç½®å®Œï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ç›¸åº”çš„SSHè½¯ä»¶ï¼Œè¿æ¥å†…ç½‘æœºå™¨ï¼Œä¸»æœºåä¸ºå…¬ç½‘åŸŸåï¼Œç«¯å£å·ä¸ºä½ è®¾ç½®çš„è¿œç¨‹ç«¯å£</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/TIM%E5%9B%BE%E7%89%8720200216155354.png" alt></p>
<p>æœ‰çš„æœåŠ¡å•†è¿˜æä¾›äº†äºŒçº§æˆ–ä¸‰çº§åŸŸåï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/frp/Snipaste_2020-02-16_15-58-29.jpg" alt></p>
<p>åˆ™ frpc.ini é…ç½®å¦‚ä¸‹æ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">#server_addrä¸€å®šè¦å†™åŸŸåå½¢å¼ï¼Œä¸è¦ç›´æ¥å†™IPåœ°å€</span><br><span class="line">server_addr &#x3D; frp1.chuantou.org</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line">privilege_token &#x3D; www.xxorg.com</span><br><span class="line"># æ ‡æ³¨ä½ çš„ä»£ç†åå­—ï¼Œéšä¾¿é€‰æ‹©ä¸€ä¸ªè·Ÿåˆ«äººä¸ä¸€æ ·å³å¯</span><br><span class="line">user &#x3D; myname</span><br><span class="line"></span><br><span class="line">[xxorg] # å¯ä»¥è‡ªå·±å–</span><br><span class="line">type &#x3D; http</span><br><span class="line">local_ip &#x3D; 127.0.0.1</span><br><span class="line">local_port &#x3D; 80 # æŒ‰ç…§å›¾ä¸­æ˜¾ç¤ºä¸º80</span><br><span class="line"># è‡ªå·±å–ä¸€ä¸ªå¯ç”¨çš„å­åŸŸåï¼Œä½ çš„è®¿é—®åœ°å€å°†ä¼šæ˜¯http:&#x2F;&#x2F;xxorg.frp1.chuantou.org</span><br><span class="line">subdomain &#x3D; xxorg</span><br><span class="line"></span><br><span class="line">[tcp3389] # å¯ä»¥è‡ªå·±å–</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">local_ip &#x3D; 127.0.0.1</span><br><span class="line">local_port &#x3D; 3389 # è‡ªå·±è®¾</span><br><span class="line">remote_port &#x3D; 53389 #è‡ªå·±è®¾ï¼Œå›¾ä¸­èŒƒå›´ä¸º50000-60000</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®å®Œï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ç›¸åº”çš„SSHè½¯ä»¶ï¼Œè¿æ¥å†…ç½‘æœºå™¨</p>
<p>å¦‚ï¼šä¸»æœºåä¸º<code>http://xxorg.frp1.chuantou.org</code>ï¼Œç«¯å£å·ä¸º53389</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>frp</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•é…ç½®SwitchyOmegaæ’ä»¶</title>
    <url>/2020/02/16/%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AESwitchyOmega%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title=" ç®€ä»‹"></a><a id="more"></a> ç®€ä»‹</h2><p>SwitchyOmegaæ˜¯ Chrome å’Œ Firefox æµè§ˆå™¨ä¸Šçš„ä»£ç†æ‰©å±•ç¨‹åº,å¯ä»¥è½»æ¾å¿«æ·çš„ç®¡ç†å’Œåˆ‡æ¢å¤šä¸ªä»£ç†è®¾ç½®ã€‚æ¥ç®¡æµè§ˆå™¨ä»£ç†æ–¹å¼ï¼Œå¯ç¬é—´åˆ‡æ¢ä»£ç†å’Œæœ¬åœ°è¿æ¥æ–¹å¼ï¼Œé…åˆsocks5ï¼ˆç­‰å…¶ä»–ä»£ç†å·¥å…·ï¼‰å¯å®ç°åªä»£ç†éƒ¨åˆ†å›½å†…æ— æ³•è®¿é—®çš„ç½‘ç«™ã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>è¿›å…¥æ’ä»¶é€‰é¡¹ç•Œé¢</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_13-39-31.jpg" alt></p>
<p>é€‰æ‹©æ–°å»ºæƒ…æ™¯æ¨¡å¼â€”ä»£ç†æœåŠ¡å™¨ï¼Œåç§°è‡ªå–</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_13-41-23.jpg" alt></p>
<p>æ‰¾åˆ°è½¯ä»¶æ‰€æä¾›çš„Socksç«¯å£å·ï¼Œè¿™é‡Œä»¥clashä¸ºä¾‹</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-51-02.jpg" alt></p>
<p>SSRã€Netchç­‰åŒç†</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-52-44.jpg" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-53-32.jpg" alt></p>
<p>æŒ‰ä»¥ä¸‹æ ¼å¼é…ç½®ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-49-43.jpg" alt></p>
<p>æ¥ç€æ–°å»ºæƒ…æ™¯æ¨¡å¼â€”è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåå­—è‡ªå–</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-55-29.jpg" alt></p>
<p>è§„åˆ™åˆ—è¡¨æ ¼å¼ä¸ºï¼šAutoProxy</p>
<p>è§„åˆ™åˆ—è¡¨ç½‘å€ä¸ºï¼š<code>https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</code></p>
<p>ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œåˆ™ä¼šè‡ªåŠ¨åŠ è½½PACåˆ—è¡¨</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_14-57-22.jpg" alt></p>
<p>åˆ‡æ¢è§„åˆ™æŒ‰å¦‚ä¸‹é…ç½®ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_15-01-34.jpg" alt></p>
<p>æ„æ€æ˜¯ï¼Œé€‰æ‹©autoæ¨¡å¼æ—¶ï¼Œæ’ä»¶ä¸ºæ ¹æ®PACè§„åˆ™åˆ¤æ–­æ˜¯å¦è¦èµ°ä»£ç†</p>
<p>ç°åœ¨è½¯ä»¶åœ¨åå°å¯åŠ¨ç€ï¼Œä¸éœ€è¦å¼€å¯ä»£ç†ï¼Œéƒ½å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„æ­¤æ’ä»¶è¿›è¡Œåˆ‡æ¢ï¼ŒPACæ¨¡å¼é€‰autoï¼Œå…¨å±€é€‰ä»£ç†æœåŠ¡å™¨ï¼Œä¸ä»£ç†é€‰ç›´è¿</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/switchyomega/Snipaste_2020-02-16_15-06-10.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç»™çƒ­ç‚¹ç¿»å¢™</title>
    <url>/2020/02/16/%E5%A6%82%E4%BD%95%E7%BB%99%E7%83%AD%E7%82%B9%E7%BF%BB%E5%A2%99/</url>
    <content><![CDATA[<h2 id="Netchç®€ä»‹"><a href="#Netchç®€ä»‹" class="headerlink" title=" Netchç®€ä»‹"></a><a id="more"></a> Netchç®€ä»‹</h2><p>Netchæ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œæ¸¸æˆå·¥å…·ï¼Œæ”¯æŒSocks5ã€55Rã€V2ç­‰åè®®ï¼ŒUDP NAT  FullConeåŠæŒ‡å®šè¿›ç¨‹åŠ é€Ÿï¼ˆä¸éœ€è¦éº»çƒ¦çš„IPè§„åˆ™ï¼‰ã€‚åŠŸèƒ½ä¸Šå’ŒSSTAPå·®ä¸å¤šï¼Œä¸è¿‡å¬è¯´åŠ é€Ÿæ•ˆæœæ¯”åè€…è¦æ›´å¥½ï¼Œç”šè‡³å ªæ¯”ä¸€äº›ä»˜è´¹çš„åŠ é€Ÿå™¨ï¼Œå½“ç„¶å‰æéœ€è¦ä½ çš„çº¿è·¯ç»™åŠ›ï¼Œä¸ç„¶åŠ é€Ÿå°±æ²¡æ„ä¹‰äº†ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-1.jpg" alt></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ä¸‹è½½ Netch å®¢æˆ·ç«¯ï¼Œè§£å‹åä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ Netch.exeã€‚è‹¥ç³»ç»Ÿæç¤ºéœ€è¦å®‰è£… .NET Frameworkï¼Œè¯·<a href="https://www.microsoft.com/net/download/dotnet-framework-runtime" target="_blank" rel="noopener">ç‚¹æ­¤</a>è®¿é—®å¾®è½¯å®˜ç½‘ä¸‹è½½å®‰è£…ã€‚</p>
<p><strong>Githubåœ°å€ï¼š</strong><a href="https://github.com/netchx/Netch" target="_blank" rel="noopener">https://github.com/netchx/Netch</a></p>
<p><strong>ä¸‹è½½åœ°å€ï¼š</strong><a href="https://github.com/netchx/Netch/releases" target="_blank" rel="noopener">https://github.com/netchx/Netch/releases</a></p>
<p>æ‰“å¼€ç¨‹åºåï¼Œé€‰ä¸­ â€œè®¢é˜…â€ &gt; â€œç®¡ç†è®¢é˜…é“¾æ¥â€</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-2.jpg" alt></p>
<p>ç²˜è´´æœåŠ¡å•†æä¾›çš„è®¢é˜…é“¾æ¥åˆ°å·¦ä¸‹è§’çš„é“¾æ¥ï¼Œå¤‡æ³¨éšä¾¿å¡«å†™ï¼Œç‚¹å‡»æ·»åŠ ï¼Œç„¶åç‚¹å‡»ä¿å­˜</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-3.jpg" alt></p>
<p>ä¹Ÿå¯ä»¥ä»å‰ªåˆ‡æ¿æ·»åŠ èŠ‚ç‚¹</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2019-06-24_10-48-31.png" alt></p>
<p>é€‰æ‹©<code>Bypass LAN and China #ç»•è¿‡å±€åŸŸç½‘å’Œå¤§é™†</code>ï¼Œç‚¹å‡»å¯åŠ¨ï¼Œå³å¯</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_12-45-58.jpg" alt></p>
<p>æ¨¡å¼ä¸­ä¹Ÿå¯ä»¥é€‰æ‹©ç›¸åº”çš„æ¸¸æˆè¿›è¡ŒåŠ é€Ÿï¼Œä¹Ÿæ”¯æŒç»™Xshellå’ŒXftpè¿æ¥å›½å¤–æœåŠ¡å™¨è¿›è¡ŒåŠ é€Ÿ</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-7.jpg" alt></p>
<p>å¦‚æœéœ€è¦åŠ é€Ÿçš„æ¸¸æˆä¸åœ¨åˆ—è¡¨é‡Œé¢ï¼Œé‚£ä¹ˆå°±é€‰ä¸­ â€œæ¨¡å¼â€ &gt; â€œåˆ›å»ºè¿›ç¨‹æ¨¡å¼â€</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-4.jpg" alt></p>
<p>ç‚¹å‡» â€œæ‰«æâ€ é€‰å–ä½ æ¸¸æˆå®‰è£…ç›®å½•åé€‰æ‹©ç¡®å®šå³å¯æ·»åŠ ï¼Œå®ƒå°†è‡ªåŠ¨åŠ è½½å…¶ä¸­çš„exeæ–‡ä»¶ï¼Œç‚¹å‡»ä¿å­˜å³å¯é€‰æ‹©åº”ç”¨æ­¤æ¨¡å¼</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/windows-netch-6.jpg" alt>                            </p>
<p>è‹¥éœ€å¼€å¯çƒ­ç‚¹ï¼Œç»™å…¶ä»–è®¾å¤‡ä¹Ÿç¿»å¢™ï¼Œåˆ™éœ€è¦Tapè™šæ‹Ÿç½‘å¡çš„æ”¯æŒï¼Œè‡ªè¡ŒæŸ¥çœ‹è‡ªå·±ç”µè„‘æ˜¯å¦è£…æœ‰</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_12-58-05.jpg" alt></p>
<p>è‹¥æœªå®‰è£…åˆ™å»<a href="https://build.openvpn.net/downloads/releases/tap-windows-9.21.2.exe" target="_blank" rel="noopener">TAP-Windows</a>ä¸‹è½½å®‰è£…ï¼ŒClashã€OpenVPNç­‰è½¯ä»¶ä¸­ä¹Ÿæä¾›äº†å®‰è£…</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_12-57-35.jpg" alt></p>
<p>ç¡®è®¤Tapç½‘å¡ipä¸ºè‡ªåŠ¨è·å–</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_13-21-22.jpg" alt></p>
<p>é€‰æ‹©<code>Bypass LAN and China (TUN/TAP)</code>ï¼Œç‚¹å‡»å¯åŠ¨</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_12-52-59.jpg" alt></p>
<p>å¯åŠ¨çƒ­ç‚¹ï¼Œä¼šå‘ç°åœ¨ç½‘ç»œé€‚é…å™¨ä¸­å¤šå‡ºä¸€ä¸ªæœ¬åœ°è¿æ¥</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_13-26-48.jpg" alt></p>
<p>å³é”®Tapç½‘å¡ï¼Œå±æ€§â€”å…±äº«ï¼Œé€‰æ‹©Internetè¿æ¥å…±äº«ï¼Œæ·»åŠ çƒ­ç‚¹æ‰€å¯¹åº”çš„æœ¬åœ°è¿æ¥</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/Snipaste_2020-02-16_13-28-32.jpg" alt></p>
<p>æ­¤æ—¶ï¼Œçƒ­ç‚¹å³å¯æˆåŠŸç¿»å¢™</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/netch/TIM%E5%9B%BE%E7%89%8720200216133203.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3ä¸­çš„å‚æ•°è¿›åŒ–</title>
    <url>/2020/02/15/YOLOv3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E8%BF%9B%E5%8C%96/</url>
    <content><![CDATA[<p>YOLOv3ä»£ç ä¸­ä¹Ÿæä¾›äº†å‚æ•°è¿›åŒ–(æœç´¢)ï¼Œå¯ä»¥ä¸ºå¯¹åº”çš„æ•°æ®é›†è¿›åŒ–ä¸€å¥—åˆé€‚çš„è¶…å‚æ•°ã€‚æœ¬æ–‡å»ºæ¡£åˆ†æä¸€ä¸‹æœ‰å…³è¿™éƒ¨åˆ†çš„æ“ä½œæ–¹æ³•ä»¥åŠå…¶å‚æ•°çš„å…·ä½“è¿›åŒ–æ–¹æ³•ã€‚</p>
<h2 id="1-è¶…å‚æ•°"><a href="#1-è¶…å‚æ•°" class="headerlink" title=" 1. è¶…å‚æ•°"></a><a id="more"></a> 1. è¶…å‚æ•°</h2><p>YOLOv3ä¸­çš„è¶…å‚æ•°åœ¨train.pyä¸­æä¾›ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›æ•°æ®å¢å¼ºå‚æ•°è®¾ç½®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hyp &#x3D; &#123;&#39;giou&#39;: 3.54,  # giou loss gain</span><br><span class="line">       &#39;cls&#39;: 37.4,  # cls loss gain</span><br><span class="line">       &#39;cls_pw&#39;: 1.0,  # cls BCELoss positive_weight</span><br><span class="line">       &#39;obj&#39;: 49.5,  # obj loss gain (*&#x3D;img_size&#x2F;320 if img_size !&#x3D; 320)</span><br><span class="line">       &#39;obj_pw&#39;: 1.0,  # obj BCELoss positive_weight</span><br><span class="line">       &#39;iou_t&#39;: 0.225,  # iou training threshold</span><br><span class="line">       &#39;lr0&#39;: 0.00579,  # initial learning rate (SGD&#x3D;1E-3, Adam&#x3D;9E-5)</span><br><span class="line">       &#39;lrf&#39;: -4.,  # final LambdaLR learning rate &#x3D; lr0 * (10 ** lrf)</span><br><span class="line">       &#39;momentum&#39;: 0.937,  # SGD momentum</span><br><span class="line">       &#39;weight_decay&#39;: 0.000484,  # optimizer weight decay</span><br><span class="line">       &#39;fl_gamma&#39;: 0.5,  # focal loss gamma</span><br><span class="line">       &#39;hsv_h&#39;: 0.0138,  # image HSV-Hue augmentation (fraction)</span><br><span class="line">       &#39;hsv_s&#39;: 0.678,  # image HSV-Saturation augmentation (fraction)</span><br><span class="line">       &#39;hsv_v&#39;: 0.36,  # image HSV-Value augmentation (fraction)</span><br><span class="line">       &#39;degrees&#39;: 1.98,  # image rotation (+&#x2F;- deg)</span><br><span class="line">       &#39;translate&#39;: 0.05,  # image translation (+&#x2F;- fraction)</span><br><span class="line">       &#39;scale&#39;: 0.05,  # image scale (+&#x2F;- gain)</span><br><span class="line">       &#39;shear&#39;: 0.641&#125;  # image shear (+&#x2F;- deg)</span><br></pre></td></tr></table></figure>
<h2 id="2-ä½¿ç”¨æ–¹æ³•"><a href="#2-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2. ä½¿ç”¨æ–¹æ³•"></a>2. ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œtrain.pyæä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°<code>--evolve</code>, è¿™ä¸ªå‚æ•°å†³å®šäº†æ˜¯å¦è¿›è¡Œè¶…å‚æ•°æœç´¢ä¸è¿›åŒ–ï¼ˆé»˜è®¤æ˜¯ä¸å¼€å¯è¶…å‚æ•°æœç´¢çš„ï¼‰ã€‚</p>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python train.py --data data&#x2F;voc.data</span><br><span class="line">				--cfg cfg&#x2F;yolov3-tiny.cfg</span><br><span class="line">				--img-size 416 </span><br><span class="line">				--epochs 273 </span><br><span class="line">				--evolve</span><br></pre></td></tr></table></figure>
<p>å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œtrain.pyä¸­çš„çº¦444è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for _ in range(1):  # generations to evolve</span><br></pre></td></tr></table></figure>
<p>å°†å…¶ä¸­çš„1ä¿®æ”¹ä¸ºä½ æƒ³è®¾ç½®çš„è¿­ä»£æ•°ï¼Œæ¯”å¦‚200ä»£ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œç»“æœå°†ä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®é™…ä¸Šå°±æ˜¯åªæœ‰ä¸€ä»£ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/646.webp" alt></p>
<h2 id="3-åŸç†"><a href="#3-åŸç†" class="headerlink" title="3. åŸç†"></a>3. åŸç†</h2><p>æ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå¯¹äºè¿›åŒ–è¿‡ç¨‹ä¸­çš„æ–°ä¸€ä»£ï¼Œéƒ½é€‰äº†äº†é€‚åº”æ€§æœ€é«˜çš„å‰ä¸€ä»£ï¼ˆåœ¨å‰å‡ ä»£ä¸­ï¼‰è¿›è¡Œçªå˜ã€‚ä»¥ä¸Šæ‰€æœ‰çš„å‚æ•°å°†æœ‰çº¦20%çš„ 1-sigmaçš„æ­£æ€åˆ†å¸ƒå‡ ç‡åŒæ—¶çªå˜ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s &#x3D; 0.2 # sigma</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªè¿›åŒ–è¿‡ç¨‹éœ€è¦ææ¸…æ¥šä¸¤ä¸ªç‚¹ï¼š</p>
<ol>
<li>å¦‚ä½•è¯„åˆ¤å…¶ä¸­ä¸€ä»£çš„å¥½åï¼Ÿ</li>
<li>ä¸‹ä¸€ä»£å¦‚ä½•æ ¹æ®ä¸Šä¸€ä»£è¿›è¡Œè¿›åŒ–ï¼Ÿ</li>
</ol>
<p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</strong>åˆ¤æ–­å¥½åçš„æ ‡å‡†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def fitness(x):</span><br><span class="line">    w &#x3D; [0.0, 0.0, 0.8, 0.2]</span><br><span class="line">    # weights for [P, R, mAP, F1]@0.5</span><br><span class="line">    return (x[:, :4] * w).sum(1)</span><br></pre></td></tr></table></figure>
<p>YOLOv3è¿›åŒ–éƒ¨åˆ†æ˜¯é€šè¿‡ä»¥ä¸Šçš„é€‚åº”åº¦å‡½æ•°åˆ¤æ–­çš„ï¼Œé€‚åº”åº¦è¶Šé«˜ï¼Œä»£è¡¨è¿™ä¸€ä»£çš„æ€§èƒ½è¶Šå¥½ã€‚è€Œåœ¨é€‚åº”åº¦ä¸­ï¼Œæ˜¯é€šè¿‡Precision,Recall ,mAP,F1è¿™å››ä¸ªæŒ‡æ ‡ä½œä¸ºé€‚åº”åº¦çš„è¯„ä»·æ ‡å‡†ã€‚</p>
<p>å…¶ä¸­çš„wæ˜¯è®¾ç½®çš„åŠ æƒï¼Œå¦‚æœæ›´å…³å¿ƒmAPçš„å€¼ï¼Œå¯ä»¥æé«˜mAPçš„æƒé‡ï¼›å¦‚æœæ›´å…³å¿ƒF1,åˆ™è®¾ç½®æ›´é«˜çš„æƒé‡åœ¨å¯¹åº”çš„F1ä¸Šã€‚è¿™é‡Œåˆ†é…mAPæƒé‡ä¸º0.8ã€F1æƒé‡ä¸º0.2ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªé—®é¢˜ï¼š</strong>å¦‚ä½•è¿›è¡Œè¿›åŒ–ï¼Ÿ</p>
<p>è¿›åŒ–è¿‡ç¨‹ä¸­æœ‰<strong>ä¸¤ä¸ªé‡è¦çš„å‚æ•°</strong>:</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<strong>parent</strong>, å¯é€‰å€¼ä¸º<code>single</code>æˆ–è€…<code>weighted</code>ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ï¼šå†³å®šå¦‚ä½•é€‰æ‹©ä¸Šä¸€ä»£ã€‚å¦‚æœé€‰æ‹©singleï¼Œä»£è¡¨åªé€‰æ‹©ä¸Šä¸€ä»£ä¸­æœ€å¥½çš„é‚£ä¸ªã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if parent &#x3D;&#x3D; &#39;single&#39; or len(x) &#x3D;&#x3D; 1:</span><br><span class="line">	x &#x3D; x[fitness(x).argmax()]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé€‰æ‹©weightedï¼Œä»£è¡¨é€‰æ‹©å¾—åˆ†çš„å‰10ä¸ªåŠ æƒå¹³å‡çš„ç»“æœä½œä¸ºä¸‹ä¸€ä»£ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">elif parent &#x3D;&#x3D; &#39;weighted&#39;:  # weighted combination</span><br><span class="line">    n &#x3D; min(10, len(x))  # number to merge</span><br><span class="line">    x &#x3D; x[np.argsort(-fitness(x))][:n]  # top n mutations</span><br><span class="line">    w &#x3D; fitness(x) - fitness(x).min()  # weights</span><br><span class="line">    x &#x3D; (x * w.reshape(n, 1)).sum(0) &#x2F; w.sum()  # new parent</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªå‚æ•°ä¸º<strong>method</strong>ï¼Œå¯é€‰å€¼ä¸º<code>1,2,3</code>, åˆ†åˆ«ä»£è¡¨ä½¿ç”¨ä¸‰ç§æ¨¡å¼æ¥è¿›åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Mutate</span><br><span class="line">method &#x3D; 2</span><br><span class="line">s &#x3D; 0.2  # 20% sigma</span><br><span class="line">np.random.seed(int(time.time()))</span><br><span class="line">g &#x3D; np.array([1, 1, 1, 1, 1, 1, 1, 0, .1, \</span><br><span class="line">              1, 0, 1, 1, 1, 1, 1, 1, 1])  # gains</span><br><span class="line"># è¿™é‡Œçš„gç±»ä¼¼åŠ æƒ</span><br><span class="line">ng &#x3D; len(g)</span><br><span class="line">if method &#x3D;&#x3D; 1:</span><br><span class="line">    v &#x3D; (np.random.randn(ng) *</span><br><span class="line">         np.random.random() * g * s + 1) ** 2.0</span><br><span class="line">elif method &#x3D;&#x3D; 2:</span><br><span class="line">    v &#x3D; (np.random.randn(ng) *</span><br><span class="line">         np.random.random(ng) * g * s + 1) ** 2.0</span><br><span class="line">elif method &#x3D;&#x3D; 3:</span><br><span class="line">    v &#x3D; np.ones(ng)</span><br><span class="line">    while all(v &#x3D;&#x3D; 1):</span><br><span class="line">        # ä¸ºäº†é˜²æ­¢é‡å¤ï¼Œç›´åˆ°æœ‰å˜åŒ–æ‰åœä¸‹æ¥</span><br><span class="line">         r &#x3D; (np.random.random(ng) &lt; 0.1) * np.random.randn(ng)</span><br><span class="line">         # 10% çš„çªå˜å‡ ç‡</span><br><span class="line">         v &#x3D; (g * s * r + 1) ** 2.0</span><br><span class="line"></span><br><span class="line">for i, k in enumerate(hyp.keys()):</span><br><span class="line">    hyp[k] &#x3D; x[i + 7] * v[i]</span><br><span class="line">    # è¿›è¡Œçªå˜</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢çªå˜è¿‡ç¨‹ï¼Œå¯¼è‡´å‚æ•°å‡ºç°æ˜æ˜¾ä¸åˆç†çš„èŒƒå›´ï¼Œéœ€è¦ç”¨ä¸€ä¸ªèŒƒå›´è¿›è¡Œæ¡†å®šï¼Œå°†è¶…å‡ºèŒƒå›´çš„å†…å®¹å‰ªåˆ‡æ‰ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Clip to limits</span><br><span class="line">keys &#x3D; [&#39;lr0&#39;, &#39;iou_t&#39;, &#39;momentum&#39;,</span><br><span class="line">        &#39;weight_decay&#39;, &#39;hsv_s&#39;,</span><br><span class="line">        &#39;hsv_v&#39;, &#39;translate&#39;,</span><br><span class="line">        &#39;scale&#39;, &#39;fl_gamma&#39;]</span><br><span class="line">limits &#x3D; [(1e-5, 1e-2), (0.00, 0.70),</span><br><span class="line">          (0.60, 0.98), (0, 0.001),</span><br><span class="line">          (0, .9), (0, .9), (0, .9),</span><br><span class="line">          (0, .9), (0, 3)]</span><br><span class="line"></span><br><span class="line">for k, v in zip(keys, limits):</span><br><span class="line">    hyp[k] &#x3D; np.clip(hyp[k], v[0], v[1])</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆè®­ç»ƒçš„è¶…å‚æ•°æœç´¢çš„ç»“æœå¯è§†åŒ–ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/647.webp" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3çš„æ•°æ®åŠ è½½æœºåˆ¶å’Œå¢å¼ºæ–¹æ³•</title>
    <url>/2020/02/15/YOLOv3%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%92%8C%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="1-æ ‡æ³¨æ ¼å¼"><a href="#1-æ ‡æ³¨æ ¼å¼" class="headerlink" title=" 1. æ ‡æ³¨æ ¼å¼"></a><a id="more"></a> 1. æ ‡æ³¨æ ¼å¼</h2><p><code>voc_label.py</code>ï¼Œå…¶ä½œç”¨æ˜¯å°†xmlæ–‡ä»¶è½¬æˆtxtæ–‡ä»¶æ ¼å¼ï¼Œå…·ä½“æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># class id, x, y, w, h</span><br><span class="line">0 0.8604166666666666 0.5403899721448469 0.058333333333333334 0.055710306406685235</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„x,y çš„æ„ä¹‰æ˜¯å½’ä¸€åŒ–ä»¥åçš„æ¡†çš„ä¸­å¿ƒåæ ‡ï¼Œw,hæ˜¯å½’ä¸€åŒ–åçš„æ¡†çš„å®½å’Œé«˜ã€‚</p>
<p>å…·ä½“çš„å½’ä¸€åŒ–æ–¹å¼ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def convert(size, box):</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    sizeæ˜¯å›¾ç‰‡çš„é•¿å’Œå®½</span><br><span class="line">    boxæ˜¯xmin,xmax,ymin,ymaxåæ ‡å€¼</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    dw &#x3D; 1. &#x2F; (size[0])</span><br><span class="line">    dh &#x3D; 1. &#x2F; (size[1])</span><br><span class="line">    # å¾—åˆ°é•¿å’Œå®½çš„ç¼©æ”¾æ¯”</span><br><span class="line">    x &#x3D; (box[0] + box[1])&#x2F;2.0  </span><br><span class="line">    y &#x3D; (box[2] + box[3])&#x2F;2.0  </span><br><span class="line">    w &#x3D; box[1] - box[0]</span><br><span class="line">    h &#x3D; box[3] - box[2]</span><br><span class="line">    # åˆ†åˆ«è®¡ç®—ä¸­å¿ƒç‚¹åæ ‡ï¼Œæ¡†çš„å®½å’Œé«˜</span><br><span class="line">    x &#x3D; x * dw</span><br><span class="line">    w &#x3D; w * dw</span><br><span class="line">    y &#x3D; y * dh</span><br><span class="line">    h &#x3D; h * dh</span><br><span class="line">    # æŒ‰ç…§å›¾ç‰‡é•¿å’Œå®½è¿›è¡Œå½’ä¸€åŒ–</span><br><span class="line">    return (x,y,w,h)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå½’ä¸€åŒ–éƒ½æ˜¯ç›¸å¯¹äºå›¾ç‰‡çš„å®½å’Œé«˜è¿›è¡Œå½’ä¸€åŒ–çš„ã€‚</p>
<h2 id="2-è°ƒç”¨"><a href="#2-è°ƒç”¨" class="headerlink" title="2. è°ƒç”¨"></a>2. è°ƒç”¨</h2><p>ä¸‹è¾¹æ˜¯train.pyæ–‡ä»¶ä¸­çš„æœ‰å…³æ•°æ®çš„è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Dataset</span><br><span class="line">dataset &#x3D; LoadImagesAndLabels(train_path, img_size, batch_size,</span><br><span class="line">                              augment&#x3D;True,</span><br><span class="line">                              hyp&#x3D;hyp,  # augmentation hyperparameters</span><br><span class="line">                              rect&#x3D;opt.rect,  # rectangular training</span><br><span class="line">                              cache_labels&#x3D;True,</span><br><span class="line">                              cache_images&#x3D;opt.cache_images)</span><br><span class="line"></span><br><span class="line">batch_size &#x3D; min(batch_size, len(dataset))</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹åŠ è½½æ•°æ®é›†</span><br><span class="line">nw &#x3D; min([os.cpu_count(), batch_size if batch_size &gt; 1 else 0, 1])</span><br><span class="line"></span><br><span class="line">dataloader &#x3D; DataLoader(dataset,</span><br><span class="line">                        batch_size&#x3D;batch_size,</span><br><span class="line">                        num_workers&#x3D;nw,</span><br><span class="line">                        shuffle&#x3D;not opt.rect,</span><br><span class="line">                        # Shuffle&#x3D;True</span><br><span class="line">                        # unless rectangular training is used</span><br><span class="line">                        pin_memory&#x3D;True,</span><br><span class="line">                        collate_fn&#x3D;dataset.collate_fn)</span><br></pre></td></tr></table></figure>
<p>åœ¨pytorchä¸­ï¼Œæ•°æ®é›†åŠ è½½ä¸»è¦æ˜¯é‡æ„datasetsç±»ï¼Œç„¶åå†ä½¿ç”¨dataloaderä¸­åŠ è½½datasetï¼Œå°±æ„å»ºå¥½äº†æ•°æ®éƒ¨åˆ†ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ¨¡æ¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">from torch.utils.data import Dataset</span><br><span class="line">from torch.utils.data import DataLoader</span><br><span class="line"></span><br><span class="line"># æ ¹æ®è‡ªå·±çš„æ•°æ®é›†æ ¼å¼è¿›è¡Œé‡æ„</span><br><span class="line">class MyDataset(Dataset):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        #ä¸‹è½½æ•°æ®ã€åˆå§‹åŒ–æ•°æ®ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå®Œæˆ</span><br><span class="line">        xy &#x3D; np.loadtxt(&#39;label.txt&#39;, delimiter&#x3D;&#39;,&#39;, dtype&#x3D;np.float32)</span><br><span class="line">        # ä½¿ç”¨numpyè¯»å–æ•°æ®</span><br><span class="line">        self.x_data &#x3D; torch.from_numpy(xy[:, 0:-1])</span><br><span class="line">        self.y_data &#x3D; torch.from_numpy(xy[:, [-1]])</span><br><span class="line">        self.len &#x3D; xy.shape[0]</span><br><span class="line">    </span><br><span class="line">    def __getitem__(self, index):</span><br><span class="line">        # dataloaderä¸­ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œé€šè¿‡indexè¿›è¡Œè®¿é—®</span><br><span class="line">        return self.x_data[index], self.y_data[index]</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        # æŸ¥è¯¢æ•°æ®é›†ä¸­æ•°é‡ï¼Œå¯ä»¥é€šè¿‡len(mydataset)å¾—åˆ°</span><br><span class="line">        return self.len</span><br><span class="line"></span><br><span class="line"># å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†Datasetç±»å‹çš„æ•°æ®ï¼Œè®°ä¸‹æ¥å°±å°†è¿™ä¸ªç±»ä¼ ç»™DataLoaderï¼Œå°±å¯ä»¥äº†ã€‚</span><br><span class="line">myDataset &#x3D; MyDataset()</span><br><span class="line"></span><br><span class="line"># æ„å»ºdataloader</span><br><span class="line">train_loader &#x3D; DataLoader(dataset&#x3D;myDataset,</span><br><span class="line">                          batch_size&#x3D;32,</span><br><span class="line">                          shuffle&#x3D;True)</span><br><span class="line"></span><br><span class="line">for epoch in range(2):</span><br><span class="line">    for i, data in enumerate(train_loader):</span><br><span class="line">        # å°†æ•°æ®ä» train_loader ä¸­è¯»å‡ºæ¥,ä¸€æ¬¡è¯»å–çš„æ ·æœ¬æ•°æ˜¯32ä¸ª</span><br><span class="line">        inputs, labels &#x3D; data</span><br><span class="line">        # å°†è¿™äº›æ•°æ®è½¬æ¢æˆVariableç±»å‹</span><br><span class="line">        inputs, labels &#x3D; Variable(inputs), Variable(labels)</span><br><span class="line">		# æ¨¡å‹è®­ç»ƒ...</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šæ¨¡æ¿å°±èƒ½å¤§è‡´äº†è§£pytorchä¸­çš„æ•°æ®åŠ è½½æœºåˆ¶ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»YOLOv3ä¸­çš„æ•°æ®åŠ è½½ã€‚</p>
<h2 id="3-YOLOv3ä¸­çš„æ•°æ®åŠ è½½"><a href="#3-YOLOv3ä¸­çš„æ•°æ®åŠ è½½" class="headerlink" title="3. YOLOv3ä¸­çš„æ•°æ®åŠ è½½"></a>3. YOLOv3ä¸­çš„æ•°æ®åŠ è½½</h2><p>ä¸‹é¢è§£æçš„æ˜¯LoadImagesAndLabelsç±»ä¸­çš„å‡ ä¸ªä¸»è¦çš„å‡½æ•°ï¼š</p>
<h3 id="3-1-initå‡½æ•°"><a href="#3-1-initå‡½æ•°" class="headerlink" title="3.1 initå‡½æ•°"></a>3.1 initå‡½æ•°</h3><p>initå‡½æ•°ä¸­åŒ…å«äº†å¤§éƒ¨åˆ†éœ€è¦å¤„ç†çš„æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class LoadImagesAndLabels(Dataset):  # for training&#x2F;testing</span><br><span class="line">    def __init__(self,</span><br><span class="line">                 path,</span><br><span class="line">                 img_size&#x3D;416,</span><br><span class="line">                 batch_size&#x3D;16,</span><br><span class="line">                 augment&#x3D;False,</span><br><span class="line">                 hyp&#x3D;None,</span><br><span class="line">                 rect&#x3D;False,</span><br><span class="line">                 image_weights&#x3D;False,</span><br><span class="line">                 cache_labels&#x3D;False,</span><br><span class="line">                 cache_images&#x3D;False):</span><br><span class="line">        path &#x3D; str(Path(path))  # os-agnostic</span><br><span class="line">        assert os.path.isfile(path), &#39;File not found %s. See %s&#39; % (path,</span><br><span class="line">                                                                    help_url)</span><br><span class="line">        with open(path, &#39;r&#39;) as f:</span><br><span class="line">            self.img_files &#x3D; [</span><br><span class="line">                x.replace(&#39;&#x2F;&#39;, os.sep)</span><br><span class="line">                for x in f.read().splitlines()  # os-agnostic</span><br><span class="line">                if os.path.splitext(x)[-1].lower() in img_formats</span><br><span class="line">            ]</span><br><span class="line">        # img_filesæ˜¯ä¸€ä¸ªlistï¼Œä¿å­˜çš„æ˜¯å›¾ç‰‡çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line">        n &#x3D; len(self.img_files)</span><br><span class="line">        assert n &gt; 0, &#39;No images found in %s. See %s&#39; % (path, help_url)</span><br><span class="line">        bi &#x3D; np.floor(np.arange(n) &#x2F; batch_size).astype(np.int)  # batch index</span><br><span class="line">        # å¦‚æœn&#x3D;10, batch&#x3D;2, bi&#x3D;[0,0,1,1,2,2,3,3,4,4]</span><br><span class="line">        nb &#x3D; bi[-1] + 1  # æœ€å¤šæœ‰å¤šå°‘ä¸ªbatch</span><br><span class="line"></span><br><span class="line">        self.n &#x3D; n</span><br><span class="line">        self.batch &#x3D; bi  # å›¾ç‰‡çš„batchç´¢å¼•ï¼Œä»£è¡¨ç¬¬å‡ ä¸ªbatchçš„å›¾ç‰‡</span><br><span class="line">        self.img_size &#x3D; img_size</span><br><span class="line">        self.augment &#x3D; augment</span><br><span class="line">        self.hyp &#x3D; hyp</span><br><span class="line">        self.image_weights &#x3D; image_weights # æ˜¯å¦é€‰æ‹©æ ¹æ®æƒé‡è¿›è¡Œé‡‡æ ·</span><br><span class="line">        self.rect &#x3D; False if image_weights else rect</span><br><span class="line">        # å¦‚æœé€‰æ‹©æ ¹æ®æƒé‡è¿›è¡Œé‡‡æ ·ï¼Œå°†æ— æ³•ä½¿ç”¨çŸ©å½¢è®­ç»ƒï¼š</span><br><span class="line">        # å…·ä½“å†…å®¹è§ä¸‹æ–‡</span><br><span class="line"></span><br><span class="line">        # æ ‡ç­¾æ–‡ä»¶æ˜¯é€šè¿‡imagesæ›¿æ¢ä¸ºlabels, .jpgæ›¿æ¢ä¸º.txtå¾—åˆ°çš„ã€‚</span><br><span class="line">        self.label_files &#x3D; [</span><br><span class="line">            x.replace(&#39;images&#39;,</span><br><span class="line">                      &#39;labels&#39;).replace(os.path.splitext(x)[-1], &#39;.txt&#39;)</span><br><span class="line">            for x in self.img_files</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        # çŸ©å½¢è®­ç»ƒå…·ä½“å†…å®¹è§ä¸‹æ–‡è§£æ</span><br><span class="line">        if self.rect:</span><br><span class="line">            # è·å–å›¾ç‰‡çš„é•¿å’Œå®½ (wh)</span><br><span class="line">            sp &#x3D; path.replace(&#39;.txt&#39;, &#39;.shapes&#39;)</span><br><span class="line">            # å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class="line">            # shapefile path</span><br><span class="line">            try:</span><br><span class="line">                with open(sp, &#39;r&#39;) as f:  # è¯»å–shapeæ–‡ä»¶</span><br><span class="line">                    s &#x3D; [x.split() for x in f.read().splitlines()]</span><br><span class="line">                    assert len(s) &#x3D;&#x3D; n, &#39;Shapefile out of sync&#39;</span><br><span class="line">            except:</span><br><span class="line">                s &#x3D; [</span><br><span class="line">                    exif_size(Image.open(f))</span><br><span class="line">                    for f in tqdm(self.img_files, desc&#x3D;&#39;Reading image shapes&#39;)</span><br><span class="line">                ]</span><br><span class="line">                np.savetxt(sp, s, fmt&#x3D;&#39;%g&#39;)  # overwrites existing (if any)</span><br><span class="line"></span><br><span class="line">            # æ ¹æ®é•¿å®½æ¯”è¿›è¡Œæ’åº</span><br><span class="line">            s &#x3D; np.array(s, dtype&#x3D;np.float64)</span><br><span class="line">            ar &#x3D; s[:, 1] &#x2F; s[:, 0]  # aspect ratio</span><br><span class="line">            i &#x3D; ar.argsort()</span><br><span class="line"></span><br><span class="line">            # æ ¹æ®é¡ºåºé‡æ’é¡ºåº</span><br><span class="line">            self.img_files &#x3D; [self.img_files[i] for i in i]</span><br><span class="line">            self.label_files &#x3D; [self.label_files[i] for i in i]</span><br><span class="line">            self.shapes &#x3D; s[i]  # wh</span><br><span class="line">            ar &#x3D; ar[i]</span><br><span class="line"></span><br><span class="line">            # è®¾ç½®è®­ç»ƒçš„å›¾ç‰‡å½¢çŠ¶</span><br><span class="line">            shapes &#x3D; [[1, 1]] * nb</span><br><span class="line">            for i in range(nb):</span><br><span class="line">                ari &#x3D; ar[bi &#x3D;&#x3D; i]</span><br><span class="line">                mini, maxi &#x3D; ari.min(), ari.max()</span><br><span class="line">                if maxi &lt; 1:</span><br><span class="line">                    shapes[i] &#x3D; [maxi, 1]</span><br><span class="line">                elif mini &gt; 1:</span><br><span class="line">                    shapes[i] &#x3D; [1, 1 &#x2F; mini]</span><br><span class="line"></span><br><span class="line">            self.batch_shapes &#x3D; np.ceil(</span><br><span class="line">                np.array(shapes) * img_size &#x2F; 32.).astype(np.int) * 32</span><br><span class="line"></span><br><span class="line">        # é¢„è½½æ ‡ç­¾</span><br><span class="line">        # weighted CE è®­ç»ƒæ—¶éœ€è¦è¿™ä¸ªæ­¥éª¤</span><br><span class="line">        # å¦åˆ™æ— æ³•æŒ‰ç…§æƒé‡è¿›è¡Œé‡‡æ ·</span><br><span class="line">        self.imgs &#x3D; [None] * n</span><br><span class="line">        self.labels &#x3D; [None] * n</span><br><span class="line">        if cache_labels or image_weights:  # cache labels for faster training</span><br><span class="line">            self.labels &#x3D; [np.zeros((0, 5))] * n</span><br><span class="line">            extract_bounding_boxes &#x3D; False</span><br><span class="line">            create_datasubset &#x3D; False</span><br><span class="line">            pbar &#x3D; tqdm(self.label_files, desc&#x3D;&#39;Caching labels&#39;)</span><br><span class="line">            nm, nf, ne, ns, nd &#x3D; 0, 0, 0, 0, 0  # number missing, found, empty, datasubset, duplicate</span><br><span class="line">            for i, file in enumerate(pbar):</span><br><span class="line">                try:</span><br><span class="line">                    # è¯»å–æ¯ä¸ªæ–‡ä»¶å†…å®¹</span><br><span class="line">                    with open(file, &#39;r&#39;) as f:</span><br><span class="line">                        l &#x3D; np.array(</span><br><span class="line">                            [x.split() for x in f.read().splitlines()],</span><br><span class="line">                            dtype&#x3D;np.float32)</span><br><span class="line">                except:</span><br><span class="line">                    nm +&#x3D; 1  # print(&#39;missing labels for image %s&#39; % self.img_files[i])  # file missing</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">                if l.shape[0]:</span><br><span class="line">                    # åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚</span><br><span class="line">                    # æ‰€æœ‰çš„å€¼éœ€è¦&gt;0, &lt;1, ä¸€å…±5åˆ—</span><br><span class="line">                    assert l.shape[1] &#x3D;&#x3D; 5, &#39;&gt; 5 label columns: %s&#39; % file</span><br><span class="line">                    assert (l &gt;&#x3D; 0).all(), &#39;negative labels: %s&#39; % file</span><br><span class="line">                    assert (l[:, 1:] &lt;&#x3D; 1).all(</span><br><span class="line">                    ), &#39;non-normalized or out of bounds coordinate labels: %s&#39; % file</span><br><span class="line">                    if np.unique(</span><br><span class="line">                            l, axis&#x3D;0).shape[0] &lt; l.shape[0]:  # duplicate rows</span><br><span class="line">                        nd +&#x3D; 1  # print(&#39;WARNING: duplicate rows in %s&#39; % self.label_files[i])  # duplicate rows</span><br><span class="line"></span><br><span class="line">                    self.labels[i] &#x3D; l</span><br><span class="line">                    nf +&#x3D; 1  # file found</span><br><span class="line"></span><br><span class="line">                    # åˆ›å»ºä¸€ä¸ªå°å‹çš„æ•°æ®é›†è¿›è¡Œè¯•éªŒ</span><br><span class="line">                    if create_datasubset and ns &lt; 1E4:</span><br><span class="line">                        if ns &#x3D;&#x3D; 0:</span><br><span class="line">                            create_folder(path&#x3D;&#39;.&#x2F;datasubset&#39;)</span><br><span class="line">                            os.makedirs(&#39;.&#x2F;datasubset&#x2F;images&#39;)</span><br><span class="line">                        exclude_classes &#x3D; 43</span><br><span class="line">                        if exclude_classes not in l[:, 0]:</span><br><span class="line">                            ns +&#x3D; 1</span><br><span class="line">                            # shutil.copy(src&#x3D;self.img_files[i], dst&#x3D;&#39;.&#x2F;datasubset&#x2F;images&#x2F;&#39;)  # copy image</span><br><span class="line">                            with open(&#39;.&#x2F;datasubset&#x2F;images.txt&#39;, &#39;a&#39;) as f:</span><br><span class="line">                                f.write(self.img_files[i] + &#39;\n&#39;)</span><br><span class="line"></span><br><span class="line">                    # ä¸ºä¸¤é˜¶æ®µåˆ†ç±»å™¨æå–ç›®æ ‡æ£€æµ‹çš„æ£€æµ‹æ¡†</span><br><span class="line">                    # é»˜è®¤å¼€å…³æ˜¯å…³æ‰çš„ï¼Œä¸æ˜¯å¾ˆç†è§£</span><br><span class="line">                    if extract_bounding_boxes:</span><br><span class="line">                        p &#x3D; Path(self.img_files[i])</span><br><span class="line">                        img &#x3D; cv2.imread(str(p))</span><br><span class="line">                        h, w &#x3D; img.shape[:2]</span><br><span class="line">                        for j, x in enumerate(l):</span><br><span class="line">                            f &#x3D; &#39;%s%sclassifier%s%g_%g_%s&#39; % (p.parent.parent,</span><br><span class="line">                                                              os.sep, os.sep,</span><br><span class="line">                                                              x[0], j, p.name)</span><br><span class="line">                            if not os.path.exists(Path(f).parent):</span><br><span class="line">                                os.makedirs(Path(f).parent)</span><br><span class="line">                                # make new output folder</span><br><span class="line"></span><br><span class="line">                            b &#x3D; x[1:] * np.array([w, h, w, h])  # box</span><br><span class="line">                            b[2:] &#x3D; b[2:].max()  # rectangle to square</span><br><span class="line">                            b[2:] &#x3D; b[2:] * 1.3 + 30  # pad</span><br><span class="line"></span><br><span class="line">                            b &#x3D; xywh2xyxy(b.reshape(-1,4)).ravel().astype(np.int)</span><br><span class="line"></span><br><span class="line">                            b[[0,2]] &#x3D; np.clip(b[[0, 2]], 0,w)  # clip boxes outside of image</span><br><span class="line">                            b[[1, 3]] &#x3D; np.clip(b[[1, 3]], 0, h)</span><br><span class="line">                            assert cv2.imwrite(f, img[b[1]:b[3], b[0]:b[2]]), &#39;Failure extracting classifier boxes&#39;</span><br><span class="line">                else:</span><br><span class="line">                    ne +&#x3D; 1</span><br><span class="line"></span><br><span class="line">                pbar.desc &#x3D; &#39;Caching labels (%g found, %g missing, %g empty, %g duplicate, for %g images)&#39; </span><br><span class="line">                % (nf, nm, ne, nd, n) # ç»Ÿè®¡å‘ç°ï¼Œä¸¢å¤±ï¼Œç©ºï¼Œé‡å¤æ ‡ç­¾çš„æ•°é‡ã€‚</span><br><span class="line">            assert nf &gt; 0, &#39;No labels found. See %s&#39; % help_url</span><br><span class="line"></span><br><span class="line">        # å°†å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯ä»¥åŠ é€Ÿè®­ç»ƒ</span><br><span class="line">        # è­¦å‘Šï¼šå¦‚æœåœ¨æ•°æ®æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹å¯èƒ½ä¼šè¶…å‡ºRAM</span><br><span class="line">        if cache_images:  # if training</span><br><span class="line">            gb &#x3D; 0  # è®¡ç®—ç¼“å­˜åˆ°å†…å­˜ä¸­çš„å›¾ç‰‡å ç”¨çš„ç©ºé—´GBä¸ºå•ä½</span><br><span class="line">            pbar &#x3D; tqdm(range(len(self.img_files)), desc&#x3D;&#39;Caching images&#39;)</span><br><span class="line">            self.img_hw0, self.img_hw &#x3D; [None] * n, [None] * n</span><br><span class="line">            for i in pbar:  # max 10k images</span><br><span class="line">                self.imgs[i], self.img_hw0[i], self.img_hw[i] &#x3D; load_image(</span><br><span class="line">                    self, i)  # img, hw_original, hw_resized</span><br><span class="line">                gb +&#x3D; self.imgs[i].nbytes</span><br><span class="line">                pbar.desc &#x3D; &#39;Caching images (%.1fGB)&#39; % (gb &#x2F; 1E9)</span><br><span class="line"></span><br><span class="line">        # åˆ é™¤æŸåçš„æ–‡ä»¶</span><br><span class="line">        # æ ¹æ®éœ€è¦è¿›è¡Œæ‰‹åŠ¨å¼€å…³</span><br><span class="line">        detect_corrupted_images &#x3D; False</span><br><span class="line">        if detect_corrupted_images:</span><br><span class="line">            from skimage import io  # conda install -c conda-forge scikit-image</span><br><span class="line">            for file in tqdm(self.img_files,</span><br><span class="line">                             desc&#x3D;&#39;Detecting corrupted images&#39;):</span><br><span class="line">                try:</span><br><span class="line">                    _ &#x3D; io.imread(file)</span><br><span class="line">                except:</span><br><span class="line">                    print(&#39;Corrupted image detected: %s&#39; % file)</span><br></pre></td></tr></table></figure>
<p><strong>Rectangular inferenceï¼ˆçŸ©å½¢æ¨ç†ï¼‰</strong></p>
<ol>
<li>çŸ©å½¢æ¨ç†æ˜¯åœ¨detect.pyï¼Œä¹Ÿå°±æ˜¯æµ‹è¯•è¿‡ç¨‹ä¸­çš„å®ç°ï¼Œå¯ä»¥å‡å°‘æ¨ç†æ—¶é—´ã€‚YOLOv3ä¸­æ˜¯ä¸‹é‡‡æ ·32å€ï¼Œé•¿å®½ä¹Ÿå¿…é¡»æ˜¯32çš„å€æ•°ï¼Œæ‰€ä»¥åœ¨è¿›å…¥æ¨¡å‹å‰ï¼Œæ•°æ®éœ€è¦å¤„ç†åˆ°416Ã—416å¤§å°ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä»¿å°„å˜æ¢ï¼Œå¦‚æœç”¨opencvå®ç°å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ¥è‡ª https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;93822508</span><br><span class="line">def cv2_letterbox_image(image, expected_size):</span><br><span class="line">    ih, iw &#x3D; image.shape[0:2]</span><br><span class="line">    ew, eh &#x3D; expected_size</span><br><span class="line">    scale &#x3D; min(eh &#x2F; ih, ew &#x2F; iw)</span><br><span class="line">    nh &#x3D; int(ih * scale)</span><br><span class="line">    nw &#x3D; int(iw * scale)</span><br><span class="line">    image &#x3D; cv2.resize(image, (nw, nh), interpolation&#x3D;cv2.INTER_CUBIC)</span><br><span class="line">    top &#x3D; (eh - nh) &#x2F;&#x2F; 2</span><br><span class="line">    bottom &#x3D; eh - nh - top</span><br><span class="line">    left &#x3D; (ew - nw) &#x2F;&#x2F; 2</span><br><span class="line">    right &#x3D; ew - nw - left</span><br><span class="line">    new_img &#x3D; cv2.copyMakeBorder(image, top, bottom, left, right, cv2.BORDER_CONSTANT)</span><br><span class="line">    return new_img</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªh&gt;wï¼Œä¸€ä¸ªæ˜¯w&gt;hçš„å›¾ç‰‡ç»è¿‡ä»¿å°„å˜æ¢åresizeåˆ°416Ã—416çš„ç¤ºä¾‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/643.webp" alt></p>
<p>ä»¥ä¸Šå°±æ˜¯æ­£æ–¹å½¢æ¨ç†ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºä»¥ä¸Šé€šè¿‡è¡¥å……å¾—åˆ°çš„ç»“æœä¼šå­˜åœ¨å¾ˆå¤šå†—ä½™ä¿¡æ¯ï¼Œè€ŒRectangular Trainingæ€è·¯å°±æ˜¯æƒ³è¦å»æ‰è¿™äº›å†—ä½™çš„éƒ¨åˆ†ã€‚</p>
<p>å…·ä½“è¿‡ç¨‹ä¸ºï¼šæ±‚å¾—è¾ƒé•¿è¾¹ç¼©æ”¾åˆ°416çš„æ¯”ä¾‹ï¼Œç„¶åå¯¹å›¾ç‰‡w:hæŒ‰è¿™ä¸ªæ¯”ä¾‹ç¼©æ”¾ï¼Œä½¿å¾—è¾ƒé•¿è¾¹è¾¾åˆ°416,å†å¯¹è¾ƒçŸ­è¾¹è¿›è¡Œå°½é‡å°‘çš„å¡«å……ä½¿å¾—è¾ƒçŸ­è¾¹æ»¡è¶³32çš„å€æ•°ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/644.webp" alt></p>
<p><strong>Rectangular Trainingï¼ˆçŸ©å½¢è®­ç»ƒï¼‰</strong></p>
<p>å¾ˆè‡ªç„¶çš„ï¼Œè®­ç»ƒçš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ç”¨åˆ°è¿™ä¸ªæƒ³æ³•ï¼Œå‡å°‘å†—ä½™ã€‚ä¸è¿‡è®­ç»ƒçš„æ—¶å€™æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œç”±äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ˜¯ä¸€ä¸ªbatchçš„å›¾ç‰‡ï¼Œè€Œæ¯ä¸ªbatchå›¾ç‰‡æ˜¯æœ‰å¯èƒ½é•¿å®½æ¯”ä¸åŒçš„ï¼Œè¿™å°±æ˜¯ä¸æµ‹è¯•æœ€å¤§çš„åŒºåˆ«ã€‚å…·ä½“æ˜¯å®ç°æ˜¯å–è¿™ä¸ªbatchä¸­æœ€å¤§çš„åœºåˆå®½ï¼Œç„¶åå°†æ•´ä¸ªbatchä¸­å¡«å……åˆ°max widthå’Œmax  height,è¿™æ ·æ“ä½œå¯¹å°ä¸€äº›çš„å›¾ç‰‡æ¥è¯´ä¹Ÿæ˜¯æ¯”è¾ƒæµªè´¹ã€‚è¿™é‡Œçš„yolov3çš„å®ç°ä¸»è¦å°±æ˜¯ä¼˜åŒ–äº†ä¸€ä¸‹å¦‚ä½•å°†æ¯”ä¾‹ç›¸è¿‘çš„å›¾ç‰‡æ”¾åœ¨ä¸€ä¸ªbatchï¼Œè¿™æ ·æ˜¾ç„¶å¡«å……çš„å°±æ›´å°‘ä¸€äº›äº†ã€‚ä½œè€…åœ¨issueä¸­æåˆ°ï¼Œåœ¨cocoæ•°æ®é›†ä¸­ä½¿ç”¨è¿™ä¸ªç­–ç•¥è¿›è¡Œè®­ç»ƒï¼Œèƒ½å¤Ÿå¿«1/3ã€‚</p>
<p>è€Œå¦‚æœé€‰æ‹©å¼€å¯çŸ©å½¢è®­ç»ƒï¼Œå¿…é¡»è¦å…³é—­dataloaderä¸­çš„shuffleå‚æ•°ï¼Œé˜²æ­¢å¯¹æ•°æ®çš„é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚åŒæ—¶å¦‚æœé€‰æ‹©image_weights, æ ¹æ®å›¾ç‰‡è¿›è¡Œé‡‡æ ·ï¼Œä¹Ÿæ— æ³•ä¸çŸ©é˜µè®­ç»ƒåŒæ—¶ä½¿ç”¨ã€‚</p>
<h3 id="3-2-getitemå‡½æ•°"><a href="#3-2-getitemå‡½æ•°" class="headerlink" title="3.2 getitemå‡½æ•°"></a>3.2 getitemå‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def __getitem__(self, index):</span><br><span class="line">    # æ–°çš„ä¸‹è§’æ ‡</span><br><span class="line">    if self.image_weights:</span><br><span class="line">        index &#x3D; self.indices[index]</span><br><span class="line"></span><br><span class="line">    img_path &#x3D; self.img_files[index]</span><br><span class="line">    label_path &#x3D; self.label_files[index]</span><br><span class="line"></span><br><span class="line">    hyp &#x3D; self.hyp</span><br><span class="line">    mosaic &#x3D; True and self.augment</span><br><span class="line">    # å¦‚æœå¼€å¯ç»„åˆå˜åŒ–ã€æ•°æ®å¢å¼º</span><br><span class="line">    # åŠ è½½å››å¼ å›¾ç‰‡ï¼Œä½œä¸ºä¸€ä¸ªæ‹¼å›¾ï¼Œå…·ä½“çœ‹ä¸‹æ–‡è§£æã€‚</span><br><span class="line">    if mosaic:</span><br><span class="line">        # åŠ è½½æ‹¼å›¾å†…å®¹</span><br><span class="line">        img, labels &#x3D; load_mosaic(self, index)</span><br><span class="line">        shapes &#x3D; None</span><br><span class="line"></span><br><span class="line">    else:</span><br><span class="line">        # åŠ è½½å›¾ç‰‡</span><br><span class="line">        img, (h0, w0), (h, w) &#x3D; load_image(self, index)</span><br><span class="line"></span><br><span class="line">        # ä»¿å°„å˜æ¢</span><br><span class="line">        shape &#x3D; self.batch_shapes[self.batch[</span><br><span class="line">            index]] if self.rect else self.img_size</span><br><span class="line">        img, ratio, pad &#x3D; letterbox(img,</span><br><span class="line">                                    shape,</span><br><span class="line">                                    auto&#x3D;False,</span><br><span class="line">                                    scaleup&#x3D;self.augment)</span><br><span class="line">        shapes &#x3D; (h0, w0), (</span><br><span class="line">            (h &#x2F; h0, w &#x2F; w0), pad)</span><br><span class="line"></span><br><span class="line">        # åŠ è½½æ ‡æ³¨æ–‡ä»¶</span><br><span class="line">        labels &#x3D; []</span><br><span class="line">        if os.path.isfile(label_path):</span><br><span class="line">            x &#x3D; self.labels[index]</span><br><span class="line">            if x is None:  # å¦‚æœæ ‡ç­¾æ²¡æœ‰åŠ è½½ï¼Œè¯»å–label_pathå†…å®¹</span><br><span class="line">                with open(label_path, &#39;r&#39;) as f:</span><br><span class="line">                    x &#x3D; np.array(</span><br><span class="line">                        [x.split() for x in f.read().splitlines()],</span><br><span class="line">                        dtype&#x3D;np.float32)</span><br><span class="line"></span><br><span class="line">            if x.size &gt; 0:</span><br><span class="line">                # å°†å½’ä¸€åŒ–åçš„xywhè½¬åŒ–ä¸ºå·¦ä¸Šè§’ã€å³ä¸‹è§’çš„è¡¨è¾¾å½¢å¼</span><br><span class="line">                labels &#x3D; x.copy()</span><br><span class="line">                labels[:, 1] &#x3D; ratio[0] * w * (</span><br><span class="line">                    x[:, 1] - x[:, 3] &#x2F; 2) + pad[0]  # pad width</span><br><span class="line">                labels[:, 2] &#x3D; ratio[1] * h * (</span><br><span class="line">                    x[:, 2] - x[:, 4] &#x2F; 2) + pad[1]  # pad height</span><br><span class="line">                labels[:, 3] &#x3D; ratio[0] * w * (x[:, 1] +</span><br><span class="line">                                               x[:, 3] &#x2F; 2) + pad[0]</span><br><span class="line">                labels[:, 4] &#x3D; ratio[1] * h * (x[:, 2] +</span><br><span class="line">                                               x[:, 4] &#x2F; 2) + pad[1]</span><br><span class="line"></span><br><span class="line">    if self.augment:</span><br><span class="line">        # å›¾ç‰‡ç©ºé—´çš„æ•°æ®å¢å¼º</span><br><span class="line">        if not mosaic:</span><br><span class="line">            # å¦‚æœæ²¡æœ‰ä½¿ç”¨ç»„åˆçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹å›¾ç‰‡è¿›è¡Œéšæœºæ”¾å°„</span><br><span class="line">            img, labels &#x3D; random_affine(img,</span><br><span class="line">                                        labels,</span><br><span class="line">                                        degrees&#x3D;hyp[&#39;degrees&#39;],</span><br><span class="line">                                        translate&#x3D;hyp[&#39;translate&#39;],</span><br><span class="line">                                        scale&#x3D;hyp[&#39;scale&#39;],</span><br><span class="line">                                        shear&#x3D;hyp[&#39;shear&#39;])</span><br><span class="line"></span><br><span class="line">        # å¢å¼ºhsvç©ºé—´</span><br><span class="line">        augment_hsv(img,</span><br><span class="line">                    hgain&#x3D;hyp[&#39;hsv_h&#39;],</span><br><span class="line">                    sgain&#x3D;hyp[&#39;hsv_s&#39;],</span><br><span class="line">                    vgain&#x3D;hyp[&#39;hsv_v&#39;])</span><br><span class="line"></span><br><span class="line">    nL &#x3D; len(labels)  # æ ‡æ³¨æ–‡ä»¶ä¸ªæ•°</span><br><span class="line"></span><br><span class="line">    if nL:</span><br><span class="line">        # å°† xyxy æ ¼å¼è½¬åŒ–ä¸º xywh æ ¼å¼</span><br><span class="line">        labels[:, 1:5] &#x3D; xyxy2xywh(labels[:, 1:5])</span><br><span class="line"></span><br><span class="line">        # å½’ä¸€åŒ–åˆ°0-1ä¹‹é—´</span><br><span class="line">        labels[:, [2, 4]] &#x2F;&#x3D; img.shape[0]  # height</span><br><span class="line">        labels[:, [1, 3]] &#x2F;&#x3D; img.shape[1]  # width</span><br><span class="line"></span><br><span class="line">    if self.augment:</span><br><span class="line">        # éšæœºå·¦å³ç¿»è½¬</span><br><span class="line">        lr_flip &#x3D; True</span><br><span class="line">        if lr_flip and random.random() &lt; 0.5:</span><br><span class="line">            img &#x3D; np.fliplr(img)</span><br><span class="line">            if nL:</span><br><span class="line">                labels[:, 1] &#x3D; 1 - labels[:, 1]</span><br><span class="line"></span><br><span class="line">        # éšæœºä¸Šä¸‹ç¿»è½¬</span><br><span class="line">        ud_flip &#x3D; False</span><br><span class="line">        if ud_flip and random.random() &lt; 0.5:</span><br><span class="line">            img &#x3D; np.flipud(img)</span><br><span class="line">            if nL:</span><br><span class="line">                labels[:, 2] &#x3D; 1 - labels[:, 2]</span><br><span class="line"></span><br><span class="line">    labels_out &#x3D; torch.zeros((nL, 6))</span><br><span class="line">    if nL:</span><br><span class="line">        labels_out[:, 1:] &#x3D; torch.from_numpy(labels)</span><br><span class="line"></span><br><span class="line">    # å›¾åƒç»´åº¦è½¬æ¢</span><br><span class="line">    img &#x3D; img[:, :, ::-1].transpose(2, 0, 1)  # BGR to RGB, to 3x416x416</span><br><span class="line">    img &#x3D; np.ascontiguousarray(img)</span><br><span class="line"></span><br><span class="line">    return torch.from_numpy(img), labels_out, img_path, shapes</span><br></pre></td></tr></table></figure>
<p>ä¸‹å›¾æ˜¯å¼€å¯äº†ç»„åˆå’Œæ—‹è½¬ä»¥åçš„å¢å¼ºæ•ˆæœ</p>
<p>è¿™é‡Œç†è§£ç»„åˆå°±æ˜¯å°†å››å¼ å›¾ç‰‡ï¼Œä»¥ä¸åŒçš„æ¯”ä¾‹ï¼Œåˆæˆä¸ºä¸€å¼ å›¾ç‰‡ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/645.webp" alt></p>
<h3 id="3-3-collate-fnå‡½æ•°"><a href="#3-3-collate-fnå‡½æ•°" class="headerlink" title="3.3 collate_fnå‡½æ•°"></a>3.3 collate_fnå‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@staticmethod</span><br><span class="line">def collate_fn(batch):</span><br><span class="line">    img, label, path, shapes &#x3D; zip(*batch)  # transposed</span><br><span class="line">    for i, l in enumerate(label):</span><br><span class="line">        l[:, 0] &#x3D; i  # add target image index for build_targets()</span><br><span class="line">    return torch.stack(img, 0), torch.cat(label, 0), path, shapes</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰æœ€åä¸€ç‚¹å†…å®¹ï¼Œæ˜¯å…³äºpytorchçš„æ•°æ®è¯»å–æœºåˆ¶ï¼Œåœ¨pytorchçš„dataloaderä¸­æ˜¯ä¼šå¯¹é€šè¿‡getitemæ–¹æ³•å¾—åˆ°çš„ç»“æœï¼ˆbatchï¼‰è¿›è¡ŒåŒ…è£…ï¼Œè€Œè¿™ä¸ªåŒ…è£…å¯èƒ½ä¸æˆ‘ä»¬æƒ³è¦çš„æœ‰æ‰€ä¸åŒã€‚é»˜è®¤çš„æ–¹æ³•å¯ä»¥çœ‹ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def default_collate(batch):</span><br><span class="line">    r&quot;&quot;&quot;Puts each data field into a tensor with outer dimension batch size&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    elem_type &#x3D; type(batch[0])</span><br><span class="line">    if isinstance(batch[0], torch.Tensor):</span><br><span class="line">        out &#x3D; None</span><br><span class="line">        if _use_shared_memory:</span><br><span class="line">            # If we&#39;re in a background process, concatenate directly into a</span><br><span class="line">            # shared memory tensor to avoid an extra copy</span><br><span class="line">            numel &#x3D; sum([x.numel() for x in batch])</span><br><span class="line">            storage &#x3D; batch[0].storage()._new_shared(numel)</span><br><span class="line">            out &#x3D; batch[0].new(storage)</span><br><span class="line">        return torch.stack(batch, 0, out&#x3D;out)</span><br><span class="line">    elif elem_type.__module__ &#x3D;&#x3D; &#39;numpy&#39; and elem_type.__name__ !&#x3D; &#39;str_&#39; \</span><br><span class="line">            and elem_type.__name__ !&#x3D; &#39;string_&#39;:</span><br><span class="line">        elem &#x3D; batch[0]</span><br><span class="line">        if elem_type.__name__ &#x3D;&#x3D; &#39;ndarray&#39;:</span><br><span class="line">            # array of string classes and object</span><br><span class="line">            if np_str_obj_array_pattern.search(elem.dtype.str) is not None:</span><br><span class="line">                raise TypeError(error_msg_fmt.format(elem.dtype))</span><br><span class="line"></span><br><span class="line">            return default_collate([torch.from_numpy(b) for b in batch])</span><br><span class="line">        if elem.shape &#x3D;&#x3D; ():  # scalars</span><br><span class="line">            py_type &#x3D; float if elem.dtype.name.startswith(&#39;float&#39;) else int</span><br><span class="line">            return numpy_type_map[elem.dtype.name](list(map(py_type, batch)))</span><br><span class="line">    elif isinstance(batch[0], float):</span><br><span class="line">        return torch.tensor(batch, dtype&#x3D;torch.float64)</span><br><span class="line">    elif isinstance(batch[0], int_classes):</span><br><span class="line">        return torch.tensor(batch)</span><br><span class="line">    elif isinstance(batch[0], string_classes):</span><br><span class="line">        return batch</span><br><span class="line">    elif isinstance(batch[0], container_abcs.Mapping):</span><br><span class="line">        return &#123;key: default_collate([d[key] for d in batch]) for key in batch[0]&#125;</span><br><span class="line">    elif isinstance(batch[0], tuple) and hasattr(batch[0], &#39;_fields&#39;):  # namedtuple</span><br><span class="line">        return type(batch[0])(*(default_collate(samples) for samples in zip(*batch)))</span><br><span class="line">    elif isinstance(batch[0], container_abcs.Sequence):</span><br><span class="line">        transposed &#x3D; zip(*batch)</span><br><span class="line">        return [default_collate(samples) for samples in transposed]</span><br><span class="line"></span><br><span class="line">    raise TypeError((error_msg_fmt.format(type(batch[0]))))</span><br></pre></td></tr></table></figure>
<p>ä¼šæ ¹æ®ä½ çš„æ•°æ®ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯è¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹<code>collate_fn</code>,å…·ä½“å†…å®¹è¯·çœ‹ä»£ç ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±ä¸å¤šèµ˜è¿°ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorchç‰ˆYOLOv3ä¸­çš„ä»£ç é…ç½®å’Œæ•°æ®é›†æ„å»º</title>
    <url>/2020/02/15/Pytorch%E7%89%88YOLOv3%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE%E5%92%8C%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h3 id="1-ç¯å¢ƒæ­å»º"><a href="#1-ç¯å¢ƒæ­å»º" class="headerlink" title=" 1. ç¯å¢ƒæ­å»º"></a><a id="more"></a> 1. ç¯å¢ƒæ­å»º</h3><ol>
<li>å°†githubåº“downloadä¸‹æ¥ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ultralytics&#x2F;yolov3.git</span><br></pre></td></tr></table></figure>
<ol>
<li>å»ºè®®åœ¨linuxç¯å¢ƒä¸‹ä½¿ç”¨anacondaè¿›è¡Œæ­å»º</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">conda create -n yolov3 python&#x3D;3.7</span><br></pre></td></tr></table></figure>
<ol>
<li>å®‰è£…éœ€è¦çš„è½¯ä»¶</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p>ç¯å¢ƒè¦æ±‚ï¼š</p>
<ul>
<li>python &gt;= 3.7</li>
<li>pytorch &gt;= 1.1</li>
<li>numpy</li>
<li>tqdm</li>
<li>opencv-python</li>
</ul>
<p>å…¶ä¸­åªéœ€è¦æ³¨æ„pytorchçš„å®‰è£…ï¼š</p>
<p>åˆ°<a href="https://pytorch.org/" target="_blank" rel="noopener">https://pytorch.org/</a>ä¸­æ ¹æ®æ“ä½œç³»ç»Ÿï¼Œpythonç‰ˆæœ¬ï¼Œcudaç‰ˆæœ¬ç­‰é€‰æ‹©å‘½ä»¤å³å¯ã€‚</p>
<h3 id="2-æ•°æ®é›†æ„å»º"><a href="#2-æ•°æ®é›†æ„å»º" class="headerlink" title="2. æ•°æ®é›†æ„å»º"></a>2. æ•°æ®é›†æ„å»º</h3><h4 id="1-xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶"><a href="#1-xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶" class="headerlink" title="1. xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶"></a>1. xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶</h4><p>åœ¨Windowsä¸‹ä½¿ç”¨LabelImgè½¯ä»¶è¿›è¡Œæ ‡æ³¨ï¼š</p>
<ul>
<li>ä½¿ç”¨å¿«æ·é”®ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Ctrl + u  åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰å›¾åƒï¼Œé¼ æ ‡ç‚¹å‡»Open diråŒåŠŸèƒ½</span><br><span class="line">Ctrl + r  æ›´æ”¹é»˜è®¤æ³¨é‡Šç›®æ ‡ç›®å½•(xmlæ–‡ä»¶ä¿å­˜çš„åœ°å€)</span><br><span class="line">Ctrl + s  ä¿å­˜</span><br><span class="line">Ctrl + d  å¤åˆ¶å½“å‰æ ‡ç­¾å’ŒçŸ©å½¢æ¡†</span><br><span class="line">space     å°†å½“å‰å›¾åƒæ ‡è®°ä¸ºå·²éªŒè¯</span><br><span class="line">w         åˆ›å»ºä¸€ä¸ªçŸ©å½¢æ¡†</span><br><span class="line">d         ä¸‹ä¸€å¼ å›¾ç‰‡</span><br><span class="line">a         ä¸Šä¸€å¼ å›¾ç‰‡</span><br><span class="line">del       åˆ é™¤é€‰å®šçš„çŸ©å½¢æ¡†</span><br><span class="line">Ctrl++    æ”¾å¤§</span><br><span class="line">Ctrl--    ç¼©å°</span><br><span class="line">â†‘â†’â†“â†        é”®ç›˜ç®­å¤´ç§»åŠ¨é€‰å®šçš„çŸ©å½¢æ¡†</span><br></pre></td></tr></table></figure>
<h4 id="2-VOC2007-æ•°æ®é›†æ ¼å¼"><a href="#2-VOC2007-æ•°æ®é›†æ ¼å¼" class="headerlink" title="2. VOC2007 æ•°æ®é›†æ ¼å¼"></a>2. VOC2007 æ•°æ®é›†æ ¼å¼</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-data</span><br><span class="line">    - VOCdevkit2007</span><br><span class="line">        - VOC2007</span><br><span class="line">            - Annotations (æ ‡ç­¾XMLæ–‡ä»¶ï¼Œç”¨å¯¹åº”çš„å›¾ç‰‡å¤„ç†å·¥å…·äººå·¥ç”Ÿæˆçš„)</span><br><span class="line">            - ImageSets (ç”Ÿæˆçš„æ–¹æ³•æ˜¯ç”¨shæˆ–è€…MATLABè¯­è¨€ç”Ÿæˆ)</span><br><span class="line">                - Main</span><br><span class="line">                    - test.txt</span><br><span class="line">                    - train.txt</span><br><span class="line">                    - trainval.txt</span><br><span class="line">                    - val.txt</span><br><span class="line">            - JPEGImages(åŸå§‹æ–‡ä»¶)</span><br><span class="line">            - labels (xmlæ–‡ä»¶å¯¹åº”çš„txtæ–‡ä»¶)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šè½¯ä»¶ä¸»è¦æ„é€ å¥½JPEGImageså’ŒAnnotationsæ–‡ä»¶å¤¹ä¸­å†…å®¹,Mainæ–‡ä»¶å¤¹ä¸­çš„txtæ–‡ä»¶å¯ä»¥é€šè¿‡ä»¥ä¸‹pythonè„šæœ¬ç”Ÿæˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">import random</span><br><span class="line">  </span><br><span class="line">trainval_percent &#x3D; 0.9</span><br><span class="line">train_percent &#x3D; 1</span><br><span class="line">xmlfilepath &#x3D; &#39;Annotations&#39;</span><br><span class="line">txtsavepath &#x3D; &#39;ImageSets\Main&#39;</span><br><span class="line">total_xml &#x3D; os.listdir(xmlfilepath)</span><br><span class="line">  </span><br><span class="line">num&#x3D;len(total_xml)</span><br><span class="line">list&#x3D;range(num)</span><br><span class="line">tv&#x3D;int(num*trainval_percent)</span><br><span class="line">tr&#x3D;int(tv*train_percent)</span><br><span class="line">trainval&#x3D; random.sample(list,tv)</span><br><span class="line">train&#x3D;random.sample(trainval,tr)</span><br><span class="line">  </span><br><span class="line">ftrainval &#x3D; open(&#39;ImageSets&#x2F;Main&#x2F;trainval.txt&#39;, &#39;w&#39;)</span><br><span class="line">ftest &#x3D; open(&#39;ImageSets&#x2F;Main&#x2F;test.txt&#39;, &#39;w&#39;)</span><br><span class="line">ftrain &#x3D; open(&#39;ImageSets&#x2F;Main&#x2F;train.txt&#39;, &#39;w&#39;)</span><br><span class="line">fval &#x3D; open(&#39;ImageSets&#x2F;Main&#x2F;val.txt&#39;, &#39;w&#39;)</span><br><span class="line">  </span><br><span class="line">for i  in list:</span><br><span class="line">    name&#x3D;total_xml[i][:-4]+&#39;\n&#39;</span><br><span class="line">    if i in trainval:</span><br><span class="line">        ftrainval.write(name)</span><br><span class="line">        if i in train:</span><br><span class="line">            ftrain.write(name)</span><br><span class="line">        else:</span><br><span class="line">            fval.write(name)</span><br><span class="line">    else:</span><br><span class="line">        ftest.write(name)</span><br><span class="line">  </span><br><span class="line">ftrainval.close()</span><br><span class="line">ftrain.close()</span><br><span class="line">fval.close()</span><br><span class="line">ftest.close()</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ç”Ÿæˆlabelsæ–‡ä»¶å¤¹ä¸­çš„txtæ–‡ä»¶ï¼Œvoc_label.pyæ–‡ä»¶å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Created on Tue Oct  2 11:42:13 2018</span><br><span class="line">å°†æœ¬æ–‡ä»¶æ”¾åˆ°VOC2007ç›®å½•ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è¿è¡Œ</span><br><span class="line">éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š</span><br><span class="line">1. setsä¸­æ›¿æ¢ä¸ºè‡ªå·±çš„æ•°æ®é›†</span><br><span class="line">2. classesä¸­æ›¿æ¢ä¸ºè‡ªå·±çš„ç±»åˆ«</span><br><span class="line">3. å°†æœ¬æ–‡ä»¶æ”¾åˆ°VOC2007ç›®å½•ä¸‹</span><br><span class="line">4. ç›´æ¥å¼€å§‹è¿è¡Œ</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import xml.etree.ElementTree as ET</span><br><span class="line">import pickle</span><br><span class="line">import os</span><br><span class="line">from os import listdir, getcwd</span><br><span class="line">from os.path import join</span><br><span class="line">sets&#x3D;[(&#39;2007&#39;, &#39;train&#39;), (&#39;2007&#39;, &#39;val&#39;), (&#39;2007&#39;, &#39;test&#39;)]  #æ›¿æ¢ä¸ºè‡ªå·±çš„æ•°æ®é›†</span><br><span class="line">classes &#x3D; [&quot;person&quot;]     #ä¿®æ”¹ä¸ºè‡ªå·±çš„ç±»åˆ«</span><br><span class="line"></span><br><span class="line">#è¿›è¡Œå½’ä¸€åŒ–</span><br><span class="line">def convert(size, box):</span><br><span class="line">    dw &#x3D; 1.&#x2F;(size[0])</span><br><span class="line">    dh &#x3D; 1.&#x2F;(size[1])</span><br><span class="line">    x &#x3D; (box[0] + box[1])&#x2F;2.0 - 1</span><br><span class="line">    y &#x3D; (box[2] + box[3])&#x2F;2.0 - 1</span><br><span class="line">    w &#x3D; box[1] - box[0]</span><br><span class="line">    h &#x3D; box[3] - box[2]</span><br><span class="line">    x &#x3D; x*dw</span><br><span class="line">    w &#x3D; w*dw</span><br><span class="line">    y &#x3D; y*dh</span><br><span class="line">    h &#x3D; h*dh</span><br><span class="line">    return (x,y,w,h)</span><br><span class="line"></span><br><span class="line">def convert_annotation(year, image_id):</span><br><span class="line">    in_file &#x3D; open(&#39;VOC%s&#x2F;Annotations&#x2F;%s.xml&#39;%(year, image_id))  #å°†æ•°æ®é›†æ”¾äºå½“å‰ç›®å½•ä¸‹</span><br><span class="line">    out_file &#x3D; open(&#39;VOC%s&#x2F;labels&#x2F;%s.txt&#39;%(year, image_id), &#39;w&#39;)</span><br><span class="line">    tree&#x3D;ET.parse(in_file)</span><br><span class="line">    root &#x3D; tree.getroot()</span><br><span class="line">    size &#x3D; root.find(&#39;size&#39;)</span><br><span class="line">    w &#x3D; int(size.find(&#39;width&#39;).text)</span><br><span class="line">    h &#x3D; int(size.find(&#39;height&#39;).text)</span><br><span class="line">    for obj in root.iter(&#39;object&#39;):</span><br><span class="line">        difficult &#x3D; obj.find(&#39;difficult&#39;).text</span><br><span class="line">        cls &#x3D; obj.find(&#39;name&#39;).text</span><br><span class="line">        if cls not in classes or int(difficult)&#x3D;&#x3D;1:</span><br><span class="line">            continue</span><br><span class="line">        cls_id &#x3D; classes.index(cls)</span><br><span class="line">        xmlbox &#x3D; obj.find(&#39;bndbox&#39;)</span><br><span class="line">        b &#x3D; (float(xmlbox.find(&#39;xmin&#39;).text), float(xmlbox.find(&#39;xmax&#39;).text), float(xmlbox.find(&#39;ymin&#39;).text), float(xmlbox.find(&#39;ymax&#39;).text))</span><br><span class="line">        bb &#x3D; convert((w,h), b)</span><br><span class="line">        out_file.write(str(cls_id) + &quot; &quot; + &quot; &quot;.join([str(a) for a in bb]) + &#39;\n&#39;)</span><br><span class="line">wd &#x3D; getcwd()</span><br><span class="line">for year, image_set in sets:</span><br><span class="line">    if not os.path.exists(&#39;VOC%s&#x2F;labels&#x2F;&#39;%(year)):</span><br><span class="line">        os.makedirs(&#39;VOC%s&#x2F;labels&#x2F;&#39;%(year))</span><br><span class="line">    image_ids &#x3D; open(&#39;VOC%s&#x2F;ImageSets&#x2F;Main&#x2F;%s.txt&#39;%(year, image_set)).read().strip().split()</span><br><span class="line">    list_file &#x3D; open(&#39;%s_%s.txt&#39;%(year, image_set), &#39;w&#39;)</span><br><span class="line">    for image_id in image_ids:</span><br><span class="line">        list_file.write(&#39;VOC%s&#x2F;JPEGImages&#x2F;%s.jpg\n&#39;%(year, image_id))</span><br><span class="line">        convert_annotation(year, image_id)</span><br><span class="line">    list_file.close()</span><br></pre></td></tr></table></figure>
<p>åˆ°åº•ä¸ºæ­¢ï¼ŒVOCæ ¼å¼æ•°æ®é›†æ„é€ å®Œæ¯•ï¼Œä½†æ˜¯è¿˜éœ€è¦ç»§ç»­æ„é€ ç¬¦åˆdarknetæ ¼å¼çš„æ•°æ®é›†(coco)ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼šå¦‚æœæ‰“ç®—ä½¿ç”¨cocoè¯„ä»·æ ‡å‡†ï¼Œéœ€è¦æ„é€ cocoä¸­jsonæ ¼å¼ï¼Œå¦‚æœè¦æ±‚ä¸é«˜ï¼Œåªéœ€è¦VOCæ ¼å¼å³å¯ï¼Œä½¿ç”¨ä½œè€…å†™çš„mAPè®¡ç®—ç¨‹åºå³å¯ã€‚</p>
<h4 id="3-åˆ›å»º-names-file"><a href="#3-åˆ›å»º-names-file" class="headerlink" title="3. åˆ›å»º*.names file,"></a>3. åˆ›å»º*.names file,</h4><p>å…¶ä¸­ä¿å­˜çš„æ˜¯ä½ çš„æ‰€æœ‰çš„ç±»åˆ«ï¼Œæ¯è¡Œä¸€ä¸ªç±»åˆ«ï¼Œå¦‚data/coco.namesï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">person</span><br></pre></td></tr></table></figure>
<h4 id="4-æ›´æ–°data-coco-data-å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯"><a href="#4-æ›´æ–°data-coco-data-å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯" class="headerlink" title="4. æ›´æ–°data/coco.data,å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯"></a>4. æ›´æ–°data/coco.data,å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">classes &#x3D; 1 # æ”¹æˆä½ çš„æ•°æ®é›†çš„ç±»åˆ«ä¸ªæ•°</span><br><span class="line">train &#x3D; .&#x2F;data&#x2F;2007_train.txt # é€šè¿‡voc_label.pyæ–‡ä»¶ç”Ÿæˆçš„txtæ–‡ä»¶</span><br><span class="line">valid &#x3D; .&#x2F;data&#x2F;2007_test.txt # é€šè¿‡voc_label.pyæ–‡ä»¶ç”Ÿæˆçš„txtæ–‡ä»¶</span><br><span class="line">names &#x3D; data&#x2F;coco.names # è®°å½•ç±»åˆ«</span><br><span class="line">backup &#x3D; backup&#x2F; # åœ¨æœ¬åº“ä¸­æ²¡æœ‰ç”¨åˆ°</span><br><span class="line">eval &#x3D; coco # é€‰æ‹©mapè®¡ç®—æ–¹å¼</span><br></pre></td></tr></table></figure>
<h4 id="5-æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯"><a href="#5-æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯" class="headerlink" title="5. æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯"></a>5. æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯</h4><p>æ‰“å¼€cfgæ–‡ä»¶å¤¹ä¸‹çš„yolov3.cfgæ–‡ä»¶ï¼Œå¤§ä½“è€Œè¨€ï¼Œcfgæ–‡ä»¶è®°å½•çš„æ˜¯æ•´ä¸ªç½‘ç»œçš„ç»“æ„ï¼Œæ˜¯æ ¸å¿ƒéƒ¨åˆ†ã€‚</p>
<p>åªéœ€è¦æ›´æ”¹æ¯ä¸ª[yolo]å±‚å‰è¾¹å·ç§¯å±‚çš„filterä¸ªæ•°å³å¯ï¼š</p>
<blockquote>
<p>æ¯ä¸€ä¸ª[region/yolo]å±‚å‰çš„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­çš„ filters=é¢„æµ‹æ¡†çš„ä¸ªæ•°(maskå¯¹åº”çš„ä¸ªæ•°ï¼Œæ¯”å¦‚mask=0,1,2,  ä»£è¡¨ä½¿ç”¨äº†anchorsä¸­çš„å‰ä¸‰å¯¹ï¼Œè¿™é‡Œé¢„æµ‹æ¡†ä¸ªæ•°å°±åº”è¯¥æ˜¯3*(classes+5)  ,5çš„æ„ä¹‰æ˜¯5ä¸ªåæ ‡ï¼ˆè®ºæ–‡ä¸­çš„tx,ty,tw,th,poï¼‰ï¼Œ3çš„æ„ä¹‰å°±æ˜¯ç”¨äº†3ä¸ªanchorã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘æœ‰ä¸‰ä¸ªç±»ï¼Œn = 3, é‚£ä¹ˆfilter  = 3 Ã— (n+5) = 24</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">filters&#x3D;255 # æ”¹ä¸º 24</span><br><span class="line">activation&#x3D;linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask &#x3D; 6,7,8</span><br><span class="line">anchors &#x3D; 10,13,  16,30,  33,23,  30,61,  62,45,  59,119,  116,90,  156,198,  373,326</span><br><span class="line">classes&#x3D;80 # æ”¹ä¸º 3</span><br><span class="line">num&#x3D;9</span><br><span class="line">jitter&#x3D;.3</span><br><span class="line">ignore_thresh &#x3D; .7</span><br><span class="line">truth_thresh &#x3D; 1</span><br><span class="line">random&#x3D;1</span><br></pre></td></tr></table></figure>
<h4 id="6-æ•°æ®é›†æ ¼å¼è¯´æ˜"><a href="#6-æ•°æ®é›†æ ¼å¼è¯´æ˜" class="headerlink" title="6. æ•°æ®é›†æ ¼å¼è¯´æ˜"></a>6. æ•°æ®é›†æ ¼å¼è¯´æ˜</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- yolov3</span><br><span class="line">    - data</span><br><span class="line">      - 2007_train.txt</span><br><span class="line">      - 2007_test.txt</span><br><span class="line">      - coco.names</span><br><span class="line">      - coco.data</span><br><span class="line">      - annotations(json files)</span><br><span class="line">      - images(å°†2007_train.txtä¸­çš„å›¾ç‰‡æ”¾åˆ°train2014æ–‡ä»¶å¤¹ä¸­ï¼ŒteståŒç†)</span><br><span class="line">        - train2014</span><br><span class="line">          - 0001.jpg</span><br><span class="line">          - 0002.jpg</span><br><span class="line">        - val2014</span><br><span class="line">          - 0003.jpg</span><br><span class="line">          - 0004.jpg</span><br><span class="line">      - labelsï¼ˆvoc_labels.pyç”Ÿæˆçš„å†…å®¹éœ€è¦é‡æ–°ç»„ç»‡ä¸€ä¸‹ï¼‰</span><br><span class="line">        - train2014</span><br><span class="line">          - 0001.txt</span><br><span class="line">          - 0002.txt</span><br><span class="line">        - val2014</span><br><span class="line">          - 0003.txt</span><br><span class="line">          - 0004.txt</span><br><span class="line">      - samples(å­˜æ”¾å¾…æµ‹è¯•å›¾ç‰‡)</span><br></pre></td></tr></table></figure>
<p>2007_train.txtå†…å®¹ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;home&#x2F;dpj&#x2F;yolov3-master&#x2F;data&#x2F;images&#x2F;val2014&#x2F;Cow_1192.jpg</span><br><span class="line">&#x2F;home&#x2F;dpj&#x2F;yolov3-master&#x2F;data&#x2F;images&#x2F;val2014&#x2F;Cow_1196.jpg</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„imageså’Œlabelsæ–‡ä»¶æ¶æ„ä¸€è‡´æ€§ï¼Œå› ä¸ºtxtæ˜¯é€šè¿‡ç®€å•çš„æ›¿æ¢å¾—åˆ°çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">images -&gt; labels</span><br><span class="line">.jpg -&gt; .txt</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å†…å®¹å¯ä»¥åœ¨datasets.pyæ–‡ä»¶ä¸­æ‰¾åˆ°è¯¦ç»†çš„æ›¿æ¢ã€‚</p>
<h3 id="3-è®­ç»ƒæ¨¡å‹"><a href="#3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="3. è®­ç»ƒæ¨¡å‹"></a>3. è®­ç»ƒæ¨¡å‹</h3><p>é¢„è®­ç»ƒæ¨¡å‹ï¼š</p>
<ul>
<li><p>Darknet <code>*.weights</code> format: <a href="https://pjreddie.com/media/files/yolov3.weights" target="_blank" rel="noopener">https://pjreddie.com/media/files/yolov3.weights</a></p>
</li>
<li><p>PyTorch <code>*.pt</code> format: </p>
<p><a href="https://drive.google.com/open?id=1LezFG5g3BCW6iYaV89B2i64cqEUZD7e0" target="_blank" rel="noopener">https://drive.google.com/open?id=1LezFG5g3BCW6iYaV89B2i64cqEUZD7e0</a></p>
</li>
</ul>
<p>å¼€å§‹è®­ç»ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python train.py --data data&#x2F;coco.data --cfg cfg&#x2F;yolov3.cfg</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ—¥å¿—æ­£å¸¸è¾“å‡ºé‚£è¯æ˜å¯ä»¥è¿è¡Œäº†</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/640.webp" alt></p>
<p>å¦‚æœä¸­æ–­äº†ï¼Œå¯ä»¥æ¢å¤è®­ç»ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python train.py --data data&#x2F;coco.data --cfg cfg&#x2F;yolov3.cfg --resume</span><br></pre></td></tr></table></figure>
<h3 id="4-æµ‹è¯•æ¨¡å‹"><a href="#4-æµ‹è¯•æ¨¡å‹" class="headerlink" title="4. æµ‹è¯•æ¨¡å‹"></a>4. æµ‹è¯•æ¨¡å‹</h3><p>å°†å¾…æµ‹è¯•å›¾ç‰‡æ”¾åˆ°data/samplesä¸­ï¼Œç„¶åè¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python detect.py --cfg cfg&#x2F;yolov3.cfg --weights weights&#x2F;best.pt</span><br></pre></td></tr></table></figure>
<p>ç›®å‰è¯¥æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥æ”¾å…¥è§†é¢‘è¿›è¡Œè§†é¢‘ç›®æ ‡æ£€æµ‹ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/641.webp" alt></p>
<ul>
<li>Image: <code>--source file.jpg</code></li>
<li>Video: <code>--source file.mp4</code></li>
<li>Directory: <code>--source dir/</code></li>
<li>Webcam: <code>--source 0</code></li>
<li>RTSP stream: <code>--source rtsp://170.93.143.139/rtplive/470011e600ef003a004ee33696235daa</code></li>
<li>HTTP stream: <code>--source http://wmccpinetop.axiscam.net/mjpg/video.mjpg</code></li>
</ul>
<h3 id="5-è¯„ä¼°æ¨¡å‹"><a href="#5-è¯„ä¼°æ¨¡å‹" class="headerlink" title="5. è¯„ä¼°æ¨¡å‹"></a>5. è¯„ä¼°æ¨¡å‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python test.py --weights weights&#x2F;best.pt</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨cocoAPIä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python3 test.py --img-size 608 --iou-thr 0.6 --weights ultralytics68.pt --cfg yolov3-spp.cfg</span><br><span class="line"></span><br><span class="line">Namespace(batch_size&#x3D;32, cfg&#x3D;&#39;yolov3-spp.cfg&#39;, conf_thres&#x3D;0.001, data&#x3D;&#39;data&#x2F;coco2014.data&#39;, device&#x3D;&#39;&#39;, img_size&#x3D;608, iou_thres&#x3D;0.6, save_json&#x3D;True, task&#x3D;&#39;test&#39;, weights&#x3D;&#39;ultralytics68.pt&#39;)</span><br><span class="line">Using CUDA device0 _CudaDeviceProperties(name&#x3D;&#39;Tesla V100-SXM2-16GB&#39;, total_memory&#x3D;16130MB)</span><br><span class="line">               Class    Images   Targets         P         R   mAP@0.5        F1: 100% 157&#x2F;157 [03:30&lt;00:00,  1.16it&#x2F;s]</span><br><span class="line">                 all     5e+03  3.51e+04    0.0353     0.891     0.606    0.0673</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.50:0.95 | area&#x3D;   all | maxDets&#x3D;100 ] &#x3D; 0.409</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.50      | area&#x3D;   all | maxDets&#x3D;100 ] &#x3D; 0.615</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.75      | area&#x3D;   all | maxDets&#x3D;100 ] &#x3D; 0.437</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.50:0.95 | area&#x3D; small | maxDets&#x3D;100 ] &#x3D; 0.242</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.50:0.95 | area&#x3D;medium | maxDets&#x3D;100 ] &#x3D; 0.448</span><br><span class="line"> Average Precision  (AP) @[ IoU&#x3D;0.50:0.95 | area&#x3D; large | maxDets&#x3D;100 ] &#x3D; 0.519</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D;   all | maxDets&#x3D;  1 ] &#x3D; 0.337</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D;   all | maxDets&#x3D; 10 ] &#x3D; 0.557</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D;   all | maxDets&#x3D;100 ] &#x3D; 0.612</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D; small | maxDets&#x3D;100 ] &#x3D; 0.438</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D;medium | maxDets&#x3D;100 ] &#x3D; 0.658</span><br><span class="line"> Average Recall     (AR) @[ IoU&#x3D;0.50:0.95 | area&#x3D; large | maxDets&#x3D;100 ] &#x3D; 0.746</span><br></pre></td></tr></table></figure>
<p><strong>mAPè®¡ç®—</strong></p>
<ul>
<li>mAP@0.5 run at <code>--iou-thr 0.5</code>, mAP@0.5â€¦0.95 run at <code>--iou-thr 0.7</code></li>
</ul>
<h3 id="6-å¯è§†åŒ–"><a href="#6-å¯è§†åŒ–" class="headerlink" title="6. å¯è§†åŒ–"></a>6. å¯è§†åŒ–</h3><p>å¯ä»¥ä½¿ç”¨<code>python -c from utils import utils;utils.plot_results()</code></p>
<p>åˆ›å»ºdrawLog.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def plot_results():</span><br><span class="line">    # Plot YOLO training results file &#39;results.txt&#39;</span><br><span class="line">    import glob</span><br><span class="line">    import numpy as np</span><br><span class="line">    import matplotlib.pyplot as plt</span><br><span class="line">    #import os; os.system(&#39;rm -rf results.txt &amp;&amp; wget https:&#x2F;&#x2F;storage.googleapis.com&#x2F;ultralytics&#x2F;results_v1_0.txt&#39;)</span><br><span class="line"></span><br><span class="line">    plt.figure(figsize&#x3D;(16, 8))</span><br><span class="line">    s &#x3D; [&#39;X&#39;, &#39;Y&#39;, &#39;Width&#39;, &#39;Height&#39;, &#39;Objectness&#39;, &#39;Classification&#39;, &#39;Total Loss&#39;, &#39;Precision&#39;, &#39;Recall&#39;, &#39;mAP&#39;]</span><br><span class="line">    files &#x3D; sorted(glob.glob(&#39;results.txt&#39;))</span><br><span class="line">    for f in files:</span><br><span class="line">        results &#x3D; np.loadtxt(f, usecols&#x3D;[2, 3, 4, 5, 6, 7, 8, 17, 18, 16]).T  # column 16 is mAP</span><br><span class="line">        n &#x3D; results.shape[1]</span><br><span class="line">        for i in range(10):</span><br><span class="line">            plt.subplot(2, 5, i + 1)</span><br><span class="line">            plt.plot(range(1, n), results[i, 1:], marker&#x3D;&#39;.&#39;, label&#x3D;f)</span><br><span class="line">            plt.title(s[i])</span><br><span class="line">            if i &#x3D;&#x3D; 0:</span><br><span class="line">                plt.legend()</span><br><span class="line">    plt.savefig(&#39;.&#x2F;plot.png&#39;)</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    plot_results()</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pyyolov3/642.webp" alt></p>
<p><strong>7. æ•°æ®é›†é…å¥—ä»£ç </strong></p>
<p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œäº†ï¼Œæ­å–œä½ ï¼Œä½ å¯ä»¥é¿å¼€ä»¥ä¸Šç•¥æ˜¾å¤æ‚çš„æ•°æ®å¤„ç†ã€‚è¿™é‡Œæä¾›äº†ä¸€å¥—ä»£ç ï¼Œé›†æˆäº†ä»¥ä¸Šè„šæœ¬ï¼Œåªéœ€è¦ä½ æœ‰jpgå›¾ç‰‡å’Œå¯¹åº”çš„xmlæ–‡ä»¶ï¼Œå°±å¯ä»¥ç›´æ¥ç”Ÿæˆç¬¦åˆè¦æ±‚çš„æ•°æ®é›†ï¼Œç„¶åæŒ‰ç…§è¦æ±‚ä¿®æ”¹ä¸€äº›ä»£ç å³å¯ã€‚</p>
<p>ä»£ç åœ°å€ï¼š<a href="https://github.com/pprp/voc2007_for_yolo_torch" target="_blank" rel="noopener">https://github.com/pprp/voc2007_for_yolo_torch</a></p>
<p>è¯·æŒ‰ç…§readmeä¸­è¿›è¡Œå¤„ç†å°±å¯ä»¥å¾—åˆ°æ•°æ®é›†ã€‚</p>
<blockquote>
<p>åè®°ï¼šè¿™å¥—ä»£ç ä¸€ç›´ç”±ä¸€ä¸ªå¤–å›½çš„å›¢é˜Ÿè¿›è¡Œç»´æŠ¤ï¼Œä¹Ÿæ·»åŠ äº†å¾ˆå¤šæ–°çš„trickã€‚ç›®å‰å·²è·å¾—äº†3.3kä¸ªstarï¼Œ1k  forkã€‚ä¸ä»…å¦‚æ­¤ï¼Œå…¶å›¢é˜Ÿä¼šç»å¸¸å›å¤issueï¼Œç›®å‰ä¹Ÿæœ‰æ¥è¿‘1kçš„issueã€‚åªè¦å¤„ç†è¿‡ä¸€éæ•°æ®ï¼Œå°±ä¼šäº†è§£åˆ°è¿™ä¸ªåº“çš„äº®ç‚¹ï¼Œéå¸¸å®¹æ˜“é…ç½®ï¼Œä¸éœ€è¦è¿›è¡Œç¼–è¯‘ç­‰æ“ä½œï¼Œæ˜“ç”¨æ€§æå¼ºã€‚å†åŠ ä¸Šæä¾›çš„é…å¥—æ•°æ®å¤„ç†ä»£ç ï¼Œåœ¨çŸ­çŸ­10å¤šåˆ†é’Ÿå°±å¯ä»¥é…ç½®å¥½ã€‚(âœªÏ‰âœª)</p>
</blockquote>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨VS Code + SSHè¿›è¡Œè¿œç¨‹å¼€å‘</title>
    <url>/2020/02/14/%E4%BD%BF%E7%94%A8VS-Code-+-SSH%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘" class="headerlink" title=" ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘"></a><a id="more"></a> ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘</h2><p>åœ¨è¿›è¡ŒLinuxå¼€å‘çš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸åœ¨Windowsä¸Šä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ç¼–è¾‘ä»£ç ï¼Œäº¤å‰ç¼–è¯‘å·¥å…·åœ¨Linuxè™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨ä¸Šï¼Œåœ¨å¼€å‘æœŸé—´éœ€è¦ä¸åœçš„è¿›è¡Œå¦‚ä¸‹çš„å¾ªç¯æ“ä½œï¼š</p>
<ul>
<li>ç¼–è¾‘å¥½ä»£ç ï¼Œä½¿ç”¨<strong>åŸºäºSSHçš„ftp</strong>å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</li>
<li><strong>ä½¿ç”¨SSHè¿œç¨‹ç»ˆç«¯</strong>ï¼Œåœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>ç¼–è¯‘å®Œæˆåä½¿ç”¨<strong>åŸºäºSSHçš„ftp</strong>å°†æ–‡ä»¶ä¼ å›åˆ°æœ¬åœ°</li>
</ul>
<p>è¿™äº›æ“ä½œéƒ½æ˜¯åŸºäºSSHçš„ï¼Œä½†æ˜¯éœ€è¦ç»ˆç«¯è½¯ä»¶ï¼Œæ–‡ä»¶ä¼ è¾“è½¯ä»¶ï¼Œ å¹¶ä¸”ä¸åœåœ°åˆ‡æ¢æ“ä½œï¼Œè¿‡ç¨‹å¾ˆéº»çƒ¦ã€‚</p>
<p>å¦‚æœ<strong>æœ¬åœ°çš„ç¼–è¾‘å™¨å¯ä»¥ç›´æ¥é€šè¿‡SSHæ‰“å¼€è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ï¼Œæ“ä½œæ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤</strong>ï¼Œè¿™å°±ç§°ä¹‹ä¸ºè¿œç¨‹å¼€å‘ï¼Œä½¿ç”¨è¿œç¨‹å¼€å‘å¯ä»¥å¤§å¤§æ–¹ä¾¿æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ã€‚</p>
<h2 id="Visual-Studio-Code-Remote-SSHæ‰©å±•"><a href="#Visual-Studio-Code-Remote-SSHæ‰©å±•" class="headerlink" title="Visual Studio Code Remote - SSHæ‰©å±•"></a>Visual Studio Code Remote - SSHæ‰©å±•</h2><p>Remote Development extension packæ˜¯VS Codeåœ¨ä»Šå¹´5æœˆä»½å‘å¸ƒçš„æ‰©å±•ï¼Œè¯¥æ‰©å±•åŒ…æ‹¬ä¸‰ä¸ªæ‰©å±•ï¼š</p>
<ul>
<li>Remote - SSH</li>
<li>Remote - Containers</li>
<li>Remote - WSL</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ‰©å±•åˆ†åˆ«æ”¯æŒå°†è¿œç¨‹è®¡ç®—æœºï¼Œå®¹å™¨ï¼Œæˆ–Windowså­ç³»ç»ŸLinuxï¼ˆWSLï¼‰ç”¨ä½œåŠŸèƒ½é½å…¨çš„åå°å¼€å‘ç¯å¢ƒï¼Œæœ¬åœ°çš„VS Codeåªæ˜¯ä¸€ä¸ªå‰ç«¯çš„ç•Œé¢ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨SSHæ‰©å±•ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522113131209.png" alt></p>
<h2 id="ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤"><a href="#ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤" class="headerlink" title="ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤"></a>ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤</h2><ul>
<li>å¦‚æœä½¿ç”¨çš„ç³»ç»Ÿæ˜¯<code>Windows10</code>ï¼Œç³»ç»Ÿä¸­å·²ç»è‡ªå¸¦äº†<code>SSH</code>ï¼Œ<strong>ä¸èƒ½å†ä½¿ç”¨Gitçš„ssh</strong>ï¼šå¦‚å›¾ï¼š</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190630104856278.png" alt></p>
<ul>
<li>å¦‚æœä½¿ç”¨çš„ç³»ç»Ÿæ˜¯<code>Windows7</code>ï¼Œ<strong>ä¸èƒ½å®‰è£…OpenSSH</strong>ï¼Œåªèƒ½ä½¿ç”¨Gitä¸­çš„sshå‘½ä»¤ï¼Œå°†Gitå®‰è£…ç›®å½•ä¸­çš„<code>usr\bin</code>æ–‡ä»¶å¤¹æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œè¯¥ç›®å½•ä¸‹åŒ…å«sshå‘½ä»¤çš„å¯æ‰§è¡Œç¨‹åºï¼›</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522115459170.png" alt></p>
<h2 id="å®‰è£…SSHæ‰©å±•"><a href="#å®‰è£…SSHæ‰©å±•" class="headerlink" title="å®‰è£…SSHæ‰©å±•"></a>å®‰è£…SSHæ‰©å±•</h2><p>åœ¨VS  Codeæ‰©å±•å¸‚åœºæœç´¢<code>remote</code>ï¼Œé€‰æ‹©<code>Remote-SSH</code>ï¼Œç‚¹å‡»å®‰è£…ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522114027910.png" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522114100203.png" alt></p>
<h2 id="è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨"><a href="#è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨" class="headerlink" title="è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨"></a>è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨</h2><p>ç‰¹åˆ«æ³¨æ„ï¼š<strong>SSHæ‰©å±•åªèƒ½è¿æ¥64ä½çš„Linuxæ“ä½œç³»ç»Ÿã€‚</strong><br>åœ¨è¿œç¨‹Linuxä¸»æœºä¸Šå®‰è£…sshæœåŠ¡å™¨ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure></p>
<h2 id="è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯"><a href="#è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯" class="headerlink" title="è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯"></a>è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯</h2><p>æ‰“å¼€å‘½ä»¤é¢æ¿<code>ctrl+shift+p</code>ï¼Œè¾“å…¥<code>ssh</code>ï¼Œé€‰æ‹©è®¾ç½®ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523120834360.png" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523120925461.png" alt></p>
<h2 id="å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº"><a href="#å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº" class="headerlink" title="å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº"></a>å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº</h2><p>SSHå¯åŠ¨çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>Ctrl+Shift+P</code>æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥<code>ssh</code>ï¼Œé€‰æ‹©<code>Connect to Host</code>ï¼š</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522120252523.png" alt></p>
<ul>
<li><p>ç›´æ¥ç‚¹å‡»å·¦ä¸‹è§’çš„sshå›¾æ ‡ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190522120345995.png" alt></p>
</li>
</ul>
<p>å¯åŠ¨ä¹‹åè¾“å…¥è¿œç¨‹ä¸»æœºçš„<code>ç”¨æˆ·å@ipåœ°å€</code>ï¼ŒæŒ‰å›è½¦è¿›è¡Œè¿æ¥ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523121056234.png" alt></p>
<p>ä¼šæ˜¾ç¤ºå‡ºSSHç™»å½•ç»ˆç«¯ï¼Œè¾“å…¥ç”¨æˆ·çš„å¯†ç å³å¯ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523115727683.png" alt></p>
<p>é¦–æ¬¡ç™»å½•åï¼ŒVS Codeä¼šè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªæ–°çš„çª—å£ç”¨äºè¿œç¨‹å·¥ä½œï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åœ¨è¿œç¨‹ä¸»æœºä¸Šå®‰è£…VS Code serverï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523115814332.png" alt></p>
<p>ç™»å½•æˆåŠŸåå¦‚å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523122154883.png" alt></p>
<h2 id="æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº"><a href="#æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº" class="headerlink" title="æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº"></a>æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº</h2><p>ç‚¹å‡»æ–‡ä»¶è§†å›¾ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523122256594.png" alt></p>
<p>ç„¶åé€‰æ‹©è¦æ‰“å¼€çš„ç›®å½•ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523122341344.png" alt></p>
<p>æ‰“å¼€æˆåŠŸå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523122740634.png" alt></p>
<h2 id="ä½¿ç”¨è¿œç¨‹ç»ˆç«¯"><a href="#ä½¿ç”¨è¿œç¨‹ç»ˆç«¯" class="headerlink" title="ä½¿ç”¨è¿œç¨‹ç»ˆç«¯"></a>ä½¿ç”¨è¿œç¨‹ç»ˆç«¯</h2><p><strong>ç›´æ¥ç‚¹å‡»æ–°å»ºç»ˆç«¯å³å¯æ‰“å¼€Bash</strong>ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523122927502.png" alt></p>
<h2 id="å®‰è£…æ‰©å±•"><a href="#å®‰è£…æ‰©å±•" class="headerlink" title="å®‰è£…æ‰©å±•"></a>å®‰è£…æ‰©å±•</h2><p>æ³¨æ„ï¼Œåœ¨è¿œç¨‹å¼€å‘çš„æ—¶å€™æ‰©å±•åˆ†ä¸ºæœ¬åœ°æ‰©å±•å’Œè¿œç¨‹æ‰©å±•ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190523123334817.png" alt></p>
<h2 id="è®°ä½å¸¸ç”¨ä¸»æœº"><a href="#è®°ä½å¸¸ç”¨ä¸»æœº" class="headerlink" title="è®°ä½å¸¸ç”¨ä¸»æœº"></a>è®°ä½å¸¸ç”¨ä¸»æœº</h2><p>å¦‚å›¾ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190524091244209.png" alt></p>
<p>é€‰æ‹© ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/2019052409132074.png" alt></p>
<p>æŒ‰å¦‚ä¸‹æ ¼å¼å¡«å†™å†…å®¹ï¼Œä¿å­˜ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190524091455578.png" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/vscode%20ssh/20190524091601192.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>C++</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3çš„cfgæ–‡ä»¶è§£æ</title>
    <url>/2020/02/14/YOLOv3%E7%9A%84cfg%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="1-Netå±‚"><a href="#1-Netå±‚" class="headerlink" title=" 1. Netå±‚"></a><a id="more"></a> 1. Netå±‚</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[net]</span><br><span class="line">#Testing</span><br><span class="line">#batch&#x3D;1</span><br><span class="line">#subdivisions&#x3D;1</span><br><span class="line">#åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè®¾ç½®batch&#x3D;1,subdivisions&#x3D;1</span><br><span class="line">#Training</span><br><span class="line">batch&#x3D;16</span><br><span class="line">subdivisions&#x3D;4</span><br><span class="line">#è¿™é‡Œçš„batchä¸æ™®éæ„ä¹‰ä¸Šçš„batchä¸æ˜¯ä¸€è‡´çš„ã€‚</span><br><span class="line">#è®­ç»ƒçš„è¿‡ç¨‹ä¸­å°†ä¸€æ¬¡æ€§åŠ è½½16å¼ å›¾ç‰‡è¿›å†…å­˜ï¼Œç„¶ååˆ†4æ¬¡å®Œæˆå‰å‘ä¼ æ’­ï¼Œæ¯æ¬¡4å¼ ã€‚</span><br><span class="line">#ç»è¿‡16å¼ å›¾ç‰‡çš„å‰å‘ä¼ æ’­ä»¥åï¼Œè¿›è¡Œä¸€æ¬¡åå‘ä¼ æ’­ã€‚</span><br><span class="line">width&#x3D;416</span><br><span class="line">height&#x3D;416</span><br><span class="line">channels&#x3D;3</span><br><span class="line">#è®¾ç½®å›¾ç‰‡è¿›å…¥ç½‘ç»œçš„å®½ã€é«˜å’Œé€šé“ä¸ªæ•°ã€‚</span><br><span class="line">#ç”±äºYOLOv3çš„ä¸‹é‡‡æ ·ä¸€èˆ¬æ˜¯32å€ï¼Œæ‰€ä»¥å®½é«˜å¿…é¡»èƒ½è¢«32æ•´é™¤ã€‚</span><br><span class="line">#å¤šå°ºåº¦è®­ç»ƒé€‰æ‹©ä¸º32çš„å€æ•°æœ€å°320*320ï¼Œæœ€å¤§608*608ã€‚</span><br><span class="line">#é•¿å’Œå®½è¶Šå¤§ï¼Œå¯¹å°ç›®æ ‡è¶Šå¥½ï¼Œä½†æ˜¯å ç”¨æ˜¾å­˜ä¹Ÿä¼šé«˜ï¼Œéœ€è¦æƒè¡¡ã€‚</span><br><span class="line">momentum&#x3D;0.9</span><br><span class="line">#åŠ¨é‡å‚æ•°å½±å“ç€æ¢¯åº¦ä¸‹é™åˆ°æœ€ä¼˜å€¼çš„é€Ÿåº¦ã€‚</span><br><span class="line">decay&#x3D;0.0005</span><br><span class="line">#æƒé‡è¡°å‡æ­£åˆ™é¡¹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</span><br><span class="line">angle&#x3D;0</span><br><span class="line">#æ•°æ®å¢å¼ºï¼Œè®¾ç½®æ—‹è½¬è§’åº¦ã€‚</span><br><span class="line">saturation &#x3D; 1.5</span><br><span class="line">#é¥±å’Œåº¦</span><br><span class="line">exposure &#x3D; 1.5</span><br><span class="line">#æ›å…‰é‡</span><br><span class="line">hue&#x3D;.1</span><br><span class="line">#è‰²è°ƒ</span><br><span class="line"></span><br><span class="line">learning_rate&#x3D;0.001</span><br><span class="line">#å­¦ä¹ ç‡:åˆšå¼€å§‹è®­ç»ƒæ—¶å¯ä»¥å°†å­¦ä¹ ç‡è®¾ç½®çš„é«˜ä¸€ç‚¹ï¼Œè€Œä¸€å®šè½®æ•°ä¹‹åï¼Œå°†å…¶å‡å°ã€‚</span><br><span class="line">#åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ ¹æ®è®­ç»ƒè½®æ•°è®¾ç½®åŠ¨æ€å˜åŒ–çš„å­¦ä¹ ç‡ã€‚</span><br><span class="line">burn_in&#x3D;1000</span><br><span class="line">#åœ¨è¿­ä»£æ¬¡æ•°å°äºburn_inæ—¶ï¼Œå…¶å­¦ä¹ ç‡çš„æ›´æ–°æœ‰ä¸€ç§æ–¹å¼ï¼Œå¤§äºburn inæ—¶ï¼Œæ‰é‡‡ç”¨policyçš„æ›´æ–°æ–¹å¼</span><br><span class="line">max_batches &#x3D; 500200</span><br><span class="line">#æœ€å¤§batch</span><br><span class="line">policy&#x3D;steps</span><br><span class="line">#å­¦ä¹ ç‡è°ƒæ•´çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹policyï¼š</span><br><span class="line">#constant, steps, exp, poly, step, sig, RANDOMï¼Œconstantç­‰æ–¹å¼</span><br><span class="line">#è°ƒæ•´å­¦ä¹ ç‡çš„policyï¼Œ</span><br><span class="line">#æœ‰å¦‚ä¸‹policyï¼šconstant, steps, exp, poly, step, sig, RANDOMã€‚</span><br><span class="line">#steps#æ¯”è¾ƒå¥½ç†è§£ï¼ŒæŒ‰ç…§stepsæ¥æ”¹å˜å­¦ä¹ ç‡ã€‚</span><br><span class="line"></span><br><span class="line">steps&#x3D;400000,450000</span><br><span class="line">scales&#x3D;.1,.1</span><br><span class="line">#åœ¨è¾¾åˆ°40000ã€45000çš„æ—¶å€™å°†å­¦ä¹ ç‡ä¹˜ä»¥å¯¹åº”çš„scale</span><br><span class="line">#å³stepså’Œscaleæ˜¯è®¾ç½®å­¦ä¹ ç‡çš„å˜åŒ–ï¼Œè¿­ä»£åˆ°40000æ¬¡æ—¶ï¼Œå­¦ä¹ ç‡è¡°å‡10å€ï¼Œ45000æ¬¡è¿­ä»£æ—¶ï¼Œå­¦ä¹ ç‡åˆä¼šåœ¨å‰ä¸€ä¸ªå­¦ä¹ ç‡çš„åŸºç¡€ä¸Šè¡°å‡10å€</span><br></pre></td></tr></table></figure>
<h2 id="2-å·ç§¯å±‚"><a href="#2-å·ç§¯å±‚" class="headerlink" title="2. å·ç§¯å±‚"></a>2. å·ç§¯å±‚</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1    		</span><br><span class="line">#æ˜¯å¦åšBNæ“ä½œ</span><br><span class="line">filters&#x3D;32                  </span><br><span class="line">#è¾“å‡ºç‰¹å¾å›¾çš„æ•°é‡</span><br><span class="line">size&#x3D;3               		</span><br><span class="line">#å·ç§¯æ ¸çš„å°ºå¯¸</span><br><span class="line">stride&#x3D;1                	</span><br><span class="line">#åšå·ç§¯è¿ç®—çš„æ­¥é•¿</span><br><span class="line">pad&#x3D;1               		</span><br><span class="line">#å·ç§¯æ—¶æ˜¯å¦è¿›è¡Œè¡¥é›¶paddingï¼›paddingçš„ä¸ªæ•°ä¸å·ç§¯æ ¸å°ºå¯¸æœ‰å…³ï¼Œä¸ºsize&#x2F;2å‘ä¸‹å–æ•´ï¼Œå¦‚3&#x2F;2&#x3D;1</span><br><span class="line">activation&#x3D;leaky		</span><br><span class="line">#æ¿€æ´»å‡½æ•°çš„ç±»å‹ï¼šlogisticï¼Œloggyï¼Œreluï¼Œ</span><br><span class="line">#eluï¼Œrelieï¼Œplseï¼Œhardtanï¼Œlhtanï¼Œ</span><br><span class="line">#linearï¼Œrampï¼Œleakyï¼Œtanhï¼Œstair</span><br><span class="line"># alexeyABç‰ˆæ·»åŠ äº†mish, swish, nrom_chanç­‰æ–°çš„æ¿€æ´»å‡½æ•°</span><br></pre></td></tr></table></figure>
<p>feature mapè®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
OutFeature =\frac{\text {InFeature}+2 \times \text { padding }-\text {size}}{\text {stride}}+1</script><h2 id="3-ä¸‹é‡‡æ ·"><a href="#3-ä¸‹é‡‡æ ·" class="headerlink" title="3. ä¸‹é‡‡æ ·"></a>3. ä¸‹é‡‡æ ·</h2><p>å¯ä»¥é€šè¿‡è°ƒæ•´å·ç§¯å±‚å‚æ•°è¿›è¡Œä¸‹é‡‡æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;2</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡å¸¦å…¥ä»¥ä¸Šå…¬å¼ï¼Œå¯ä»¥å¾—åˆ°OutFeatureæ˜¯InFeatureçš„ä¸€åŠã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨maxpoolingè¿›è¡Œä¸‹é‡‡æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br></pre></td></tr></table></figure>
<h2 id="4-ä¸Šé‡‡æ ·"><a href="#4-ä¸Šé‡‡æ ·" class="headerlink" title="4. ä¸Šé‡‡æ ·"></a>4. ä¸Šé‡‡æ ·</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[upsample]</span><br><span class="line">stride&#x3D;2</span><br></pre></td></tr></table></figure>
<p>ä¸Šé‡‡æ ·æ˜¯é€šè¿‡çº¿æ€§æ’å€¼å®ç°çš„ã€‚</p>
<h2 id="5-Shortcutå’ŒRouteå±‚"><a href="#5-Shortcutå’ŒRouteå±‚" class="headerlink" title="5. Shortcutå’ŒRouteå±‚"></a>5. Shortcutå’ŒRouteå±‚</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[shortcut]</span><br><span class="line">from&#x3D;-3</span><br><span class="line">activation&#x3D;linear</span><br><span class="line">#shortcutæ“ä½œæ˜¯ç±»ä¼¼ResNetçš„è·¨å±‚è¿æ¥ï¼Œå‚æ•°fromæ˜¯âˆ’3ï¼Œ</span><br><span class="line">#æ„æ€æ˜¯shortcutçš„è¾“å‡ºæ˜¯å½“å‰å±‚ä¸å…ˆå‰çš„å€’æ•°ç¬¬ä¸‰å±‚ç›¸åŠ è€Œå¾—åˆ°ã€‚</span><br><span class="line"># é€šä¿—æ¥è®²å°±æ˜¯addæ“ä½œ</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers &#x3D; -1, 36</span><br><span class="line"># å½“å±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œå°±æ˜¯å°†ä¸Šä¸€å±‚å’Œç¬¬36å±‚è¿›è¡Œconcate</span><br><span class="line">#å³æ²¿æ·±åº¦çš„ç»´åº¦è¿æ¥ï¼Œè¿™ä¹Ÿè¦æ±‚feature mapå¤§å°æ˜¯ä¸€è‡´çš„ã€‚</span><br><span class="line">[route]</span><br><span class="line">layers &#x3D; -4</span><br><span class="line">#å½“å±æ€§åªæœ‰ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒä¼šè¾“å‡ºç”±è¯¥å€¼ç´¢å¼•çš„ç½‘ç»œå±‚çš„ç‰¹å¾å›¾ã€‚</span><br><span class="line">#æœ¬ä¾‹å­ä¸­å°±æ˜¯æå–ä»å½“å‰å€’æ•°ç¬¬å››ä¸ªå±‚è¾“å‡º</span><br></pre></td></tr></table></figure>
<h2 id="6-YOLOå±‚"><a href="#6-YOLOå±‚" class="headerlink" title="6. YOLOå±‚"></a>6. YOLOå±‚</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">filters&#x3D;18</span><br><span class="line">#æ¯ä¸€ä¸ª[region&#x2F;yolo]å±‚å‰çš„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­çš„</span><br><span class="line">#filters&#x3D;num(yoloå±‚ä¸ªæ•°)*(classes+5) ,5çš„æ„ä¹‰æ˜¯5ä¸ªåæ ‡ï¼Œ</span><br><span class="line">#ä»£è¡¨è®ºæ–‡ä¸­çš„tx,ty,tw,th,po</span><br><span class="line">#è¿™é‡Œç±»åˆ«ä¸ªæ•°ä¸º1ï¼Œï¼ˆ1+5ï¼‰*3&#x3D;18</span><br><span class="line">activation&#x3D;linear</span><br><span class="line"></span><br><span class="line">[yolo]	</span><br><span class="line">mask &#x3D; 6,7,8 				</span><br><span class="line">#è®­ç»ƒæ¡†maskçš„å€¼æ˜¯0,1,2ï¼Œ			</span><br><span class="line">#è¿™æ„å‘³ç€ä½¿ç”¨ç¬¬ä¸€ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªanchor</span><br><span class="line">anchors &#x3D; 10,13,  16,30,  33,23,  30,61,  62,45,\</span><br><span class="line">		  59,119,  116,90,  156,198,  373,326</span><br><span class="line"># æ€»å…±æœ‰ä¸‰ä¸ªæ£€æµ‹å±‚ï¼Œå…±è®¡9ä¸ªanchor</span><br><span class="line"># è¿™é‡Œçš„anchoræ˜¯ç”±kmeansèšç±»ç®—æ³•å¾—åˆ°çš„ã€‚</span><br><span class="line">classes&#x3D;1 </span><br><span class="line">#ç±»åˆ«ä¸ªæ•°</span><br><span class="line">num&#x3D;9     			</span><br><span class="line">#æ¯ä¸ªgridé¢„æµ‹çš„BoundingBox num&#x2F;yoloå±‚ä¸ªæ•°</span><br><span class="line">jitter&#x3D;.3    		</span><br><span class="line">#åˆ©ç”¨æ•°æ®æŠ–åŠ¨äº§ç”Ÿæ›´å¤šæ•°æ®ï¼Œ</span><br><span class="line">#å±äºTTAï¼ˆTest Time Augmentationï¼‰</span><br><span class="line">ignore_thresh &#x3D; .5</span><br><span class="line"># ignore_thresh æŒ‡çš„æ˜¯å‚ä¸è®¡ç®—çš„IOUé˜ˆå€¼å¤§å°ã€‚</span><br><span class="line">#å½“é¢„æµ‹çš„æ£€æµ‹æ¡†ä¸ground trueçš„IOUå¤§äºignore_threshçš„æ—¶å€™ï¼Œ</span><br><span class="line">#å‚ä¸lossçš„è®¡ç®—ï¼Œå¦åˆ™ï¼Œæ£€æµ‹æ¡†çš„ä¸å‚ä¸æŸå¤±è®¡ç®—ã€‚</span><br><span class="line">#ç›®çš„æ˜¯æ§åˆ¶å‚ä¸lossè®¡ç®—çš„æ£€æµ‹æ¡†çš„è§„æ¨¡ï¼Œå½“ignore_threshè¿‡äºå¤§ï¼Œ</span><br><span class="line">#æ¥è¿‘äº1çš„æ—¶å€™ï¼Œé‚£ä¹ˆå‚ä¸æ£€æµ‹æ¡†å›å½’lossçš„ä¸ªæ•°å°±ä¼šæ¯”è¾ƒå°‘ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼›</span><br><span class="line">#è€Œå¦‚æœignore_threshè®¾ç½®çš„è¿‡äºå°ï¼Œé‚£ä¹ˆå‚ä¸è®¡ç®—çš„ä¼šæ•°é‡è§„æ¨¡å°±ä¼šå¾ˆå¤§ã€‚</span><br><span class="line">#åŒæ—¶ä¹Ÿå®¹æ˜“åœ¨è¿›è¡Œæ£€æµ‹æ¡†å›å½’çš„æ—¶å€™é€ æˆæ¬ æ‹Ÿåˆã€‚</span><br><span class="line">#ignore_thresh ä¸€èˆ¬é€‰å–0.5-0.7ä¹‹é—´çš„ä¸€ä¸ªå€¼</span><br><span class="line"># å°å°ºåº¦ï¼ˆ13*13ï¼‰ç”¨çš„æ˜¯0.7ï¼Œ</span><br><span class="line"># å¤§å°ºåº¦ï¼ˆ26*26ï¼‰ç”¨çš„æ˜¯0.5ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="7-æ¨¡å—æ€»ç»“"><a href="#7-æ¨¡å—æ€»ç»“" class="headerlink" title="7. æ¨¡å—æ€»ç»“"></a>7. æ¨¡å—æ€»ç»“</h2><p>Darket-53ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2709767-e65c08c61bfaa7c7.png" alt></p>
<p>å®ƒæ˜¯ç”±é‡å¤çš„ç±»ä¼¼äºResNetçš„æ¨¡å—ç»„æˆçš„ï¼Œå…¶ä¸‹é‡‡æ ·æ˜¯é€šè¿‡å·ç§¯æ¥å®Œæˆçš„ã€‚é€šè¿‡å¯¹cfgæ–‡ä»¶çš„è§‚å¯Ÿï¼Œæå‡ºäº†ä»¥ä¸‹æ€»ç»“ï¼š</p>
<p><strong>ä¸æ”¹å˜featureå¤§å°çš„æ¨¡å—ï¼š</strong></p>
<ol>
<li>æ®‹å·®æ¨¡å—ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;256</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br><span class="line"></span><br><span class="line">[shortcut]</span><br><span class="line">from&#x3D;-3</span><br><span class="line">activation&#x3D;linear</span><br></pre></td></tr></table></figure>
<ol>
<li>1Ã—1å·ç§¯ï¼šå¯ä»¥é™ä½è®¡ç®—é‡</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;512</span><br><span class="line">size&#x3D;1</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br></pre></td></tr></table></figure>
<ol>
<li>æ™®é€š3Ã—3å·ç§¯ï¼šå¯ä»¥å¯¹filterä¸ªæ•°è¿›è¡Œè°ƒæ•´</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;1024</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;1</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br></pre></td></tr></table></figure>
<p><strong>æ”¹å˜feature mapå¤§å°</strong></p>
<ol>
<li>feature mapå‡åŠï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;2</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize&#x3D;1</span><br><span class="line">filters&#x3D;128</span><br><span class="line">size&#x3D;3</span><br><span class="line">stride&#x3D;2</span><br><span class="line">pad&#x3D;1</span><br><span class="line">activation&#x3D;leaky</span><br></pre></td></tr></table></figure>
<ol>
<li>feature mapåŠ å€:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size&#x3D;2</span><br><span class="line">stride&#x3D;1</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹å¾èåˆæ“ä½œ</strong></p>
<ol>
<li>ä½¿ç”¨Routeå±‚è·å–æŒ‡å®šçš„å±‚ï¼ˆ13Ã—13ï¼‰ã€‚</li>
<li>æ·»åŠ å·ç§¯å±‚è¿›è¡Œå­¦ä¹ ä½†ä¸æ”¹å˜feature mapå¤§å°ã€‚</li>
<li>è¿›è¡Œä¸Šé‡‡æ ·ï¼ˆ26Ã—26ï¼‰ã€‚</li>
<li>ä»backboneä¸­æ‰¾åˆ°å¯¹åº”feature mapå¤§å°çš„å±‚è¿›è¡ŒRouteæˆ–è€…Shortcutï¼ˆ26Ã—26ï¼‰ã€‚</li>
<li>èåˆå®Œæˆã€‚</li>
</ol>
<blockquote>
<p>åè®°ï¼šä»¥ä¸Šæ˜¯ä½¿ç”¨darknetè¿‡ç¨‹ä¸­æ”¶é›†å’Œæ€»ç»“çš„ä¸€äº›ç»éªŒï¼ŒæŒæ¡ä»¥ä¸Šå†…å®¹å¹¶è¯»æ‡‚yolov3è®ºæ–‡åï¼Œå°±å¯ä»¥ç€æ‰‹è¿è¡Œä»£ç äº†ã€‚ç›®å‰ä½¿ç”¨ä¸darknetä¸€è‡´çš„cfgæ–‡ä»¶è§£æçš„æœ‰ä¸€äº›ï¼Œæ¯”å¦‚åŸç‰ˆDarknetï¼ŒAlexeyABç‰ˆæœ¬çš„Darknetï¼Œè¿˜æœ‰ä¸€ä¸ªpytorchç‰ˆæœ¬çš„yolov3ã€‚AlexeyABç‰ˆæœ¬çš„æ·»åŠ äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæ¯”å¦‚ [conv_lstm], [scale_channels] SE/ASFF/BiFPN, [local_avgpool], [sam],  [Gaussian_yolo], [reorg3d] (fixed [reorg]),  [batchnorm]ç­‰ç­‰ã€‚è€Œpytorchç‰ˆæœ¬çš„yolov3å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ã€‚ä¹‹åæˆ‘ä»¬å°†ä¼šå¯¹è¿™ä¸ªç‰ˆæœ¬è¿›è¡Œæ”¹è¿›ï¼Œæ·»åŠ å­”æ´å·ç§¯ã€SEã€CBAMã€SKç­‰æ¨¡å—ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹å¸¸è§è¯„ä»·æŒ‡æ ‡(mAP)çš„è¯¦ç»†è®¡ç®—æ–¹æ³•åŠä»£ç è§£æ</title>
    <url>/2020/02/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E4%B9%8B%E5%B8%B8%E8%A7%81%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87(mAP)%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%E5%8F%8A%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>å®šä¹‰ä¸€äº›è¯„ä»·æ ‡å‡†ï¼š</p>
<ul>
<li><p>å‡†ç¡®ç‡(Acc)ï¼šå‡†ç¡®ç‡(Acc)çš„è®¡ç®—å…¬å¼ä¸º$A c c=\frac{T P+T N}{N}$ï¼Œå³é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ¯”ä¾‹ï¼Œ$N$ä»£è¡¨æµ‹è¯•çš„æ ·æœ¬æ•°ã€‚åœ¨æ£€æµ‹ä»»åŠ¡ä¸­æ²¡æœ‰é¢„æµ‹æ­£ç¡®çš„è´Ÿæ ·æœ¬çš„æ¦‚å¿µï¼Œæ‰€ä»¥Accè‡ªç„¶ç”¨ä¸åˆ°äº†ã€‚</p>
</li>
<li><p>æŸ¥å‡†ç‡(Precision)ï¼šæŸ¥å‡†ç‡æ˜¯é’ˆå¯¹æŸä¸€ä¸ªå…·ä½“ç±»åˆ«è€Œè¨€çš„ï¼Œå…¬å¼ä¸ºï¼šPrecision $=\frac{T P}{T P+F P}=\frac{T P}{N}$ï¼Œå…¶ä¸­$N$ä»£è¡¨æ‰€æœ‰æ£€æµ‹åˆ°çš„æŸä¸ªå…·ä½“ç±»çš„ç›®æ ‡æ¡†ä¸ªæ•°ã€‚</p>
</li>
<li><p>å¬å›ç‡(Recall)ï¼šå¬å›ç‡ä»ç„¶æ˜¯é’ˆå¯¹æŸä¸€ä¸ªå…·ä½“ç±»åˆ«è€Œè¨€çš„ï¼Œå…¬å¼ä¸ºï¼šRecall$=\frac{T P}{T P+F N}$ï¼Œå³é¢„æµ‹æ­£ç¡®çš„ç›®æ ‡æ¡†å’Œæ‰€æœ‰Ground Truthæ¡†çš„æ¯”å€¼ã€‚</p>
</li>
<li><p>F1 Scoreï¼šå®šä½æŸ¥å‡†ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F_{1}=2 \times \frac{\text {Precision} * \text {Recall}}{\text {Precision}+\text {Recall}}=\frac{2 T P}{2 T P+F N+F P}</script></li>
<li><p>IOUï¼šå…ˆä¸ºè®¡ç®—mAPå€¼åšä¸€ä¸ªé“ºå«ï¼Œå³IOUé˜ˆå€¼æ˜¯å¦‚ä½•å½±å“Precisionå’ŒRecallå€¼çš„ï¼Ÿæ¯”å¦‚åœ¨PASCAL  VOCç«èµ›ä¸­é‡‡ç”¨çš„IoUé˜ˆå€¼ä¸º0.5ï¼Œè€ŒCOCOç«èµ›ä¸­åœ¨è®¡ç®—mAPè¾ƒå¤æ‚ï¼Œå…¶è®¡ç®—äº†ä¸€ç³»åˆ—IoUé˜ˆå€¼ï¼ˆ0.05è‡³0.95ï¼‰ä¸‹çš„mAPå½“æˆæœ€åçš„mAPå€¼ã€‚</p>
</li>
<li><p>mAPï¼šå…¨ç§°ä¸ºAverage Precisionï¼ŒAPå€¼æ˜¯Precision-Recallæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç›®æ ‡æ£€æµ‹ä¸­PRæ›²çº¿æ€ä¹ˆæ¥çš„ï¼Ÿå¯ä»¥åœ¨è¿™ç¯‡è®ºæ–‡æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/map%20code/640.webp" alt></p>
<p>æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼Œè¦å¾—åˆ°Precision-Recallæ›²çº¿(ä»¥ä¸‹ç®€ç§°PR)æ›²çº¿ï¼Œé¦–å…ˆè¦å¯¹æ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæŒ‰ç…§ç›®æ ‡ç½®ä¿¡åº¦é™åºæ’åˆ—ã€‚ç„¶åç»™å®šä¸€ä¸ª<code>rank</code>å€¼ï¼ŒRecallå’ŒPrecisionä»…åœ¨ç½®ä¿¡åº¦é«˜äºè¯¥<code>rank</code>å€¼çš„é¢„æµ‹ç»“æœä¸­è®¡ç®—ï¼Œæ”¹å˜<code>rank</code>å€¼ä¼šç›¸åº”çš„æ”¹å˜Recallå€¼å’ŒPrecisionå€¼ã€‚è¿™é‡Œé€‰æ‹©äº†11ä¸ªä¸åŒçš„<code>rank</code>å€¼ï¼Œä¹Ÿå°±å¾—åˆ°äº†11ç»„Precisionå’ŒRecallå€¼ï¼Œç„¶åAPå€¼å³å®šä¹‰ä¸ºåœ¨è¿™11ä¸ªRecallä¸‹Precisionå€¼çš„å¹³å‡å€¼ï¼Œå…¶å¯ä»¥è¡¨å¾æ•´ä¸ªPRæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ã€‚å³ï¼š</p>
<script type="math/tex; mode=display">
A P=\frac{1}{11} \sum_{r \in\{0,0.1, \ldots, 1\}} p_{i n t e r p}(r)</script><p>è¿˜æœ‰å¦å¤–ä¸€ç§æ’å€¼çš„è®¡ç®—æ–¹æ³•ï¼Œå³å¯¹äºæŸä¸ªRecallå€¼<code>r</code>ï¼ŒPrecisionå–æ‰€æœ‰Recallå€¼å¤§äº<code>r</code>ä¸­çš„æœ€å¤§å€¼ï¼Œè¿™æ ·ä¿è¯äº†PRæ›²çº¿æ˜¯å•è°ƒé€’å‡çš„ï¼Œé¿å…æ›²çº¿å‡ºç°æ‘‡æ‘†ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯åœ¨2010å¹´åè®¡ç®—APå€¼æ—¶æ˜¯å–äº†æ‰€æœ‰çš„æ•°æ®ç‚¹ï¼Œè€Œä¸ä»…ä»…åªæ˜¯11ä¸ªRecallå€¼ã€‚æˆ‘ä»¬åœ¨è®¡ç®—å‡ºAPä¹‹åï¼Œå¯¹æ‰€æœ‰ç±»åˆ«æ±‚å¹³å‡ä¹‹åå°±æ˜¯mAPå€¼äº†ï¼Œä¹Ÿæ˜¯å½“å‰ç›®æ ‡æ£€æµ‹ç”¨çš„æœ€å¤šçš„è¯„åˆ¤æ ‡å‡†ã€‚</p>
<ul>
<li>AP50ï¼ŒAP60ï¼ŒAP70ç­‰ç­‰ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿä»£è¡¨IOUé˜ˆå€¼åˆ†åˆ«å–0.5ï¼Œ0.6ï¼Œ0.7ç­‰å¯¹åº”çš„APå€¼ã€‚</li>
</ul>
<h1 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h1><p>ä¸‹é¢è§£æä¸€ä¸‹Faster-RCNNä¸­å¯¹VOCæ•°æ®é›†è®¡ç®—æ¯ä¸ªç±»åˆ«APå€¼çš„ä»£ç ï¼ŒmAPå°±æ˜¯æ‰€æœ‰ç±»çš„APå€¼å¹³å‡å€¼ã€‚ä»£ç æ¥è‡ªpy-faster-rcnné¡¹ç›®ã€‚ä»£ç è§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># --------------------------------------------------------</span><br><span class="line"># Fast&#x2F;er R-CNN</span><br><span class="line"># Licensed under The MIT License [see LICENSE for details]</span><br><span class="line"># Written by Bharath Hariharan</span><br><span class="line"># --------------------------------------------------------</span><br><span class="line"></span><br><span class="line">import xml.etree.ElementTree as ET #è¯»å–xmlæ–‡ä»¶</span><br><span class="line">import os</span><br><span class="line">import cPickle #åºåˆ—åŒ–å­˜å‚¨æ¨¡å—</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">def parse_rec(filename):</span><br><span class="line">    &quot;&quot;&quot; Parse a PASCAL VOC xml file &quot;&quot;&quot;</span><br><span class="line">    tree &#x3D; ET.parse(filename)</span><br><span class="line">    objects &#x3D; []</span><br><span class="line">    # è§£æxmlæ–‡ä»¶ï¼Œå°†GTæ¡†ä¿¡æ¯æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨</span><br><span class="line">    for obj in tree.findall(&#39;object&#39;):</span><br><span class="line">        obj_struct &#x3D; &#123;&#125;</span><br><span class="line">        obj_struct[&#39;name&#39;] &#x3D; obj.find(&#39;name&#39;).text</span><br><span class="line">        obj_struct[&#39;pose&#39;] &#x3D; obj.find(&#39;pose&#39;).text</span><br><span class="line">        obj_struct[&#39;truncated&#39;] &#x3D; int(obj.find(&#39;truncated&#39;).text)</span><br><span class="line">        obj_struct[&#39;difficult&#39;] &#x3D; int(obj.find(&#39;difficult&#39;).text)</span><br><span class="line">        bbox &#x3D; obj.find(&#39;bndbox&#39;)</span><br><span class="line">        obj_struct[&#39;bbox&#39;] &#x3D; [int(bbox.find(&#39;xmin&#39;).text),</span><br><span class="line">                              int(bbox.find(&#39;ymin&#39;).text),</span><br><span class="line">                              int(bbox.find(&#39;xmax&#39;).text),</span><br><span class="line">                              int(bbox.find(&#39;ymax&#39;).text)]</span><br><span class="line">        objects.append(obj_struct)</span><br><span class="line"></span><br><span class="line">    return objects</span><br><span class="line"></span><br><span class="line"># å•ä¸ªè®¡ç®—APçš„å‡½æ•°ï¼Œè¾“å…¥å‚æ•°ä¸ºç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼ŒåŸç†è§ä¸Šé¢</span><br><span class="line">def voc_ap(rec, prec, use_07_metric&#x3D;False):</span><br><span class="line">    &quot;&quot;&quot; ap &#x3D; voc_ap(rec, prec, [use_07_metric])</span><br><span class="line">    Compute VOC AP given precision and recall.</span><br><span class="line">    If use_07_metric is true, uses the</span><br><span class="line">    VOC 07 11 point method (default:False).</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # å¦‚æœä½¿ç”¨2007å¹´çš„è®¡ç®—APçš„æ–¹å¼(æ’å€¼çš„æ–¹å¼)</span><br><span class="line">    if use_07_metric:</span><br><span class="line">        # 11 point metric</span><br><span class="line">        ap &#x3D; 0.</span><br><span class="line">        for t in np.arange(0., 1.1, 0.1):</span><br><span class="line">            if np.sum(rec &gt;&#x3D; t) &#x3D;&#x3D; 0:</span><br><span class="line">                p &#x3D; 0</span><br><span class="line">            else:</span><br><span class="line">                p &#x3D; np.max(prec[rec &gt;&#x3D; t])</span><br><span class="line">            ap &#x3D; ap + p &#x2F; 11.</span><br><span class="line">    else:</span><br><span class="line">       # ä½¿ç”¨2010å¹´åçš„è®¡ç®—APå€¼çš„æ–¹å¼</span><br><span class="line">        # è¿™é‡Œæ˜¯æ–°å¢ä¸€ä¸ª(0,0)ï¼Œæ–¹ä¾¿è®¡ç®—</span><br><span class="line">        mrec &#x3D; np.concatenate(([0.], rec, [1.]))</span><br><span class="line">        mpre &#x3D; np.concatenate(([0.], prec, [0.]))</span><br><span class="line"></span><br><span class="line">        # compute the precision envelope</span><br><span class="line">        for i in range(mpre.size - 1, 0, -1):</span><br><span class="line">            mpre[i - 1] &#x3D; np.maximum(mpre[i - 1], mpre[i])</span><br><span class="line"></span><br><span class="line">        # to calculate area under PR curve, look for points</span><br><span class="line">        # where X axis (recall) changes value</span><br><span class="line">        i &#x3D; np.where(mrec[1:] !&#x3D; mrec[:-1])[0]</span><br><span class="line"></span><br><span class="line">        # and sum (\Delta recall) * prec</span><br><span class="line">        ap &#x3D; np.sum((mrec[i + 1] - mrec[i]) * mpre[i + 1])</span><br><span class="line">    return ap</span><br><span class="line"></span><br><span class="line"># ä¸»å‡½æ•°</span><br><span class="line">def voc_eval(detpath,</span><br><span class="line">             annopath,</span><br><span class="line">             imagesetfile,</span><br><span class="line">             classname,</span><br><span class="line">             cachedir,</span><br><span class="line">             ovthresh&#x3D;0.5,</span><br><span class="line">             use_07_metric&#x3D;False):</span><br><span class="line">    &quot;&quot;&quot;rec, prec, ap &#x3D; voc_eval(detpath,</span><br><span class="line">                                annopath,</span><br><span class="line">                                imagesetfile,</span><br><span class="line">                                classname,</span><br><span class="line">                                [ovthresh],</span><br><span class="line">                                [use_07_metric])</span><br><span class="line">    Top level function that does the PASCAL VOC evaluation.</span><br><span class="line">    detpath: äº§ç”Ÿçš„txtæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯ä¸€å¼ å›¾ç‰‡çš„å„ä¸ªæ£€æµ‹æ¡†ç»“æœã€‚</span><br><span class="line">    annopath: xml æ–‡ä»¶ä¸å¯¹åº”çš„å›¾åƒç›¸å‘¼åº”ã€‚</span><br><span class="line">    imagesetfile: ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æ¯ä¸ªå›¾ç‰‡çš„åœ°å€ï¼Œæ¯è¡Œä¸€ä¸ªåœ°å€ã€‚</span><br><span class="line">    classname: ç§ç±»çš„åå­—ï¼Œå³ç±»åˆ«ã€‚</span><br><span class="line">    cachedir: ç¼“å­˜æ ‡æ³¨çš„ç›®å½•ã€‚</span><br><span class="line">    [ovthresh]: IOUé˜ˆå€¼ï¼Œé»˜è®¤ä¸º0.5ï¼Œå³mAP50ã€‚</span><br><span class="line">    [use_07_metric]: æ˜¯å¦ä½¿ç”¨2007çš„è®¡ç®—APçš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºFasle</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # assumes detections are in detpath.format(classname)</span><br><span class="line">    # assumes annotations are in annopath.format(imagename)</span><br><span class="line">    # assumes imagesetfile is a text file with each line an image name</span><br><span class="line">    # cachedir caches the annotations in a pickle file</span><br><span class="line"></span><br><span class="line">    # é¦–å…ˆåŠ è½½Ground Truthæ ‡æ³¨ä¿¡æ¯ã€‚</span><br><span class="line">    if not os.path.isdir(cachedir):</span><br><span class="line">        os.mkdir(cachedir)</span><br><span class="line">    # å³å°†æ–°å»ºæ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">    cachefile &#x3D; os.path.join(cachedir, &#39;annots.pkl&#39;)</span><br><span class="line">    # è¯»å–æ–‡æœ¬é‡Œçš„æ‰€æœ‰å›¾ç‰‡è·¯å¾„</span><br><span class="line">    with open(imagesetfile, &#39;r&#39;) as f:</span><br><span class="line">        lines &#x3D; f.readlines()</span><br><span class="line">    # è·å–æ–‡ä»¶åï¼Œstripç”¨æ¥å»é™¤å¤´å°¾å­—ç¬¦ã€ç©ºç™½ç¬¦(åŒ…æ‹¬\nã€\rã€\tã€&#39; &#39;ï¼Œå³ï¼šæ¢è¡Œã€å›è½¦ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼)</span><br><span class="line">    imagenames &#x3D; [x.strip() for x in lines]</span><br><span class="line">    #å¦‚æœcachefileæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥</span><br><span class="line">    if not os.path.isfile(cachefile):</span><br><span class="line">        # load annots</span><br><span class="line">        recs &#x3D; &#123;&#125;</span><br><span class="line">        for i, imagename in enumerate(imagenames):</span><br><span class="line">            #annopath.format(imagename): labelçš„xmlæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„</span><br><span class="line">            recs[imagename] &#x3D; parse_rec(annopath.format(imagename))</span><br><span class="line">            if i % 100 &#x3D;&#x3D; 0:</span><br><span class="line">                print &#39;Reading annotation for &#123;:d&#125;&#x2F;&#123;:d&#125;&#39;.format(</span><br><span class="line">                    i + 1, len(imagenames))</span><br><span class="line">        # save</span><br><span class="line">        print &#39;Saving cached annotations to &#123;:s&#125;&#39;.format(cachefile)</span><br><span class="line">        with open(cachefile, &#39;w&#39;) as f:</span><br><span class="line">            #å†™å…¥cPickleæ–‡ä»¶é‡Œé¢ã€‚å†™å…¥çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå·¦ä¾§ä¸ºxmlæ–‡ä»¶åï¼Œå³ä¾§ä¸ºæ–‡ä»¶é‡Œé¢ä¸ªå„ä¸ªå‚æ•°ã€‚</span><br><span class="line">            cPickle.dump(recs, f)</span><br><span class="line">    else:</span><br><span class="line">        # load</span><br><span class="line">        with open(cachefile, &#39;r&#39;) as f:</span><br><span class="line">            recs &#x3D; cPickle.load(f)</span><br><span class="line"></span><br><span class="line">    # å¯¹æ¯å¼ å›¾ç‰‡çš„xmlè·å–å‡½æ•°æŒ‡å®šç±»çš„bboxç­‰</span><br><span class="line">    class_recs &#x3D; &#123;&#125;# ä¿å­˜çš„æ˜¯ Ground Truthçš„æ•°æ®</span><br><span class="line">    npos &#x3D; 0</span><br><span class="line">    for imagename in imagenames:</span><br><span class="line">        # è·å–Ground Truthæ¯ä¸ªæ–‡ä»¶ä¸­æŸç§ç±»åˆ«çš„ç‰©ä½“</span><br><span class="line">        R &#x3D; [obj for obj in recs[imagename] if obj[&#39;name&#39;] &#x3D;&#x3D; classname]</span><br><span class="line">        bbox &#x3D; np.array([x[&#39;bbox&#39;] for x in R])</span><br><span class="line">        #  differentåŸºæœ¬éƒ½ä¸º0&#x2F;False</span><br><span class="line">        difficult &#x3D; np.array([x[&#39;difficult&#39;] for x in R]).astype(np.bool)</span><br><span class="line">        det &#x3D; [False] * len(R)</span><br><span class="line">        npos &#x3D; npos + sum(~difficult) #è‡ªå¢ï¼Œ~difficultå–å,ç»Ÿè®¡æ ·æœ¬ä¸ªæ•°</span><br><span class="line">        # # è®°å½•Ground Truthçš„å†…å®¹</span><br><span class="line">        class_recs[imagename] &#x3D; &#123;&#39;bbox&#39;: bbox,</span><br><span class="line">                                 &#39;difficult&#39;: difficult,</span><br><span class="line">                                 &#39;det&#39;: det&#125;</span><br><span class="line"></span><br><span class="line">    # read dets è¯»å–æŸç±»åˆ«é¢„æµ‹è¾“å‡º</span><br><span class="line">    detfile &#x3D; detpath.format(classname)</span><br><span class="line">    with open(detfile, &#39;r&#39;) as f:</span><br><span class="line">        lines &#x3D; f.readlines()</span><br><span class="line"></span><br><span class="line">    splitlines &#x3D; [x.strip().split(&#39; &#39;) for x in lines]</span><br><span class="line">    image_ids &#x3D; [x[0] for x in splitlines] # å›¾ç‰‡ID</span><br><span class="line">    confidence &#x3D; np.array([float(x[1]) for x in splitlines]) # IOUå€¼</span><br><span class="line">    BB &#x3D; np.array([[float(z) for z in x[2:]] for x in splitlines]) # bounding boxæ•°å€¼</span><br><span class="line"></span><br><span class="line">    # å¯¹confidenceçš„indexæ ¹æ®å€¼å¤§å°è¿›è¡Œé™åºæ’åˆ—ã€‚</span><br><span class="line">    sorted_ind &#x3D; np.argsort(-confidence)</span><br><span class="line">    sorted_scores &#x3D; np.sort(-confidence)</span><br><span class="line">    #é‡æ’bboxï¼Œç”±å¤§æ¦‚ç‡åˆ°å°æ¦‚ç‡ã€‚</span><br><span class="line">    BB &#x3D; BB[sorted_ind, :]</span><br><span class="line">    # å›¾ç‰‡é‡æ’ï¼Œç”±å¤§æ¦‚ç‡åˆ°å°æ¦‚ç‡ã€‚</span><br><span class="line">    image_ids &#x3D; [image_ids[x] for x in sorted_ind]</span><br><span class="line"></span><br><span class="line">    # go down dets and mark TPs and FPs</span><br><span class="line">    nd &#x3D; len(image_ids)</span><br><span class="line">    tp &#x3D; np.zeros(nd)</span><br><span class="line">    fp &#x3D; np.zeros(nd)</span><br><span class="line">    for d in range(nd):</span><br><span class="line">        R &#x3D; class_recs[image_ids[d]]</span><br><span class="line">        bb &#x3D; BB[d, :].astype(float)</span><br><span class="line">        ovmax &#x3D; -np.inf</span><br><span class="line">        BBGT &#x3D; R[&#39;bbox&#39;].astype(float)</span><br><span class="line"></span><br><span class="line">        if BBGT.size &gt; 0:</span><br><span class="line">            # compute overlaps</span><br><span class="line">            # intersection</span><br><span class="line">            ixmin &#x3D; np.maximum(BBGT[:, 0], bb[0])</span><br><span class="line">            iymin &#x3D; np.maximum(BBGT[:, 1], bb[1])</span><br><span class="line">            ixmax &#x3D; np.minimum(BBGT[:, 2], bb[2])</span><br><span class="line">            iymax &#x3D; np.minimum(BBGT[:, 3], bb[3])</span><br><span class="line">            iw &#x3D; np.maximum(ixmax - ixmin + 1., 0.)</span><br><span class="line">            ih &#x3D; np.maximum(iymax - iymin + 1., 0.)</span><br><span class="line">            inters &#x3D; iw * ih</span><br><span class="line"></span><br><span class="line">            # union</span><br><span class="line">            uni &#x3D; ((bb[2] - bb[0] + 1.) * (bb[3] - bb[1] + 1.) +</span><br><span class="line">                   (BBGT[:, 2] - BBGT[:, 0] + 1.) *</span><br><span class="line">                   (BBGT[:, 3] - BBGT[:, 1] + 1.) - inters)</span><br><span class="line"></span><br><span class="line">            overlaps &#x3D; inters &#x2F; uni</span><br><span class="line">            ovmax &#x3D; np.max(overlaps)</span><br><span class="line">            jmax &#x3D; np.argmax(overlaps)</span><br><span class="line"></span><br><span class="line">        if ovmax &gt; ovthresh:</span><br><span class="line">            if not R[&#39;difficult&#39;][jmax]:</span><br><span class="line">                if not R[&#39;det&#39;][jmax]:</span><br><span class="line">                    tp[d] &#x3D; 1.</span><br><span class="line">                    R[&#39;det&#39;][jmax] &#x3D; 1</span><br><span class="line">                else:</span><br><span class="line">                    fp[d] &#x3D; 1.</span><br><span class="line">        else:</span><br><span class="line">            fp[d] &#x3D; 1.</span><br><span class="line"></span><br><span class="line">    # compute precision recall</span><br><span class="line">    fp &#x3D; np.cumsum(fp)</span><br><span class="line">    tp &#x3D; np.cumsum(tp)</span><br><span class="line">    rec &#x3D; tp &#x2F; float(npos)</span><br><span class="line">    # avoid divide by zero in case the first detection matches a difficult</span><br><span class="line">    # ground truth</span><br><span class="line">    prec &#x3D; tp &#x2F; np.maximum(tp + fp, np.finfo(np.float64).eps)</span><br><span class="line">    ap &#x3D; voc_ap(rec, prec, use_07_metric)</span><br><span class="line"></span><br><span class="line">	return rec, prec, ap</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè„šæœ¬å¯ä»¥ç›´æ¥è°ƒç”¨æ¥è®¡ç®—mAPå€¼ï¼Œå…·ä½“ä¾‹å­å¯ä»¥çœ‹è¿™ä¸ªï¼š<a href="https://blog.csdn.net/amusi1994/article/details/81564504" target="_blank" rel="noopener">åœ¨Darknetä¸­è°ƒç”¨ä¸Šé¢çš„è„šæœ¬æ¥è®¡ç®—mAPå€¼</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹ç®—æ³•çš„è¯„ä»·æ ‡å‡†å’Œå¸¸è§æ•°æ®é›†</title>
    <url>/2020/02/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E7%9A%84%E8%AF%84%E4%BB%B7%E6%A0%87%E5%87%86%E5%92%8C%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E9%9B%86/</url>
    <content><![CDATA[<h2 id="è¯„ä»·æŒ‡æ ‡"><a href="#è¯„ä»·æŒ‡æ ‡" class="headerlink" title=" è¯„ä»·æŒ‡æ ‡"></a><a id="more"></a> è¯„ä»·æŒ‡æ ‡</h2><h3 id="1-å‡†ç¡®ç‡-Accuracy"><a href="#1-å‡†ç¡®ç‡-Accuracy" class="headerlink" title="1.å‡†ç¡®ç‡(Accuracy)"></a>1.å‡†ç¡®ç‡(Accuracy)</h3><p>æ£€æµ‹æ—¶åˆ†å¯¹çš„æ ·æœ¬æ•°é™¤ä»¥æ‰€æœ‰çš„æ ·æœ¬æ•°ã€‚å‡†ç¡®ç‡ä¸€èˆ¬è¢«ç”¨æ¥è¯„ä¼°æ£€æµ‹æ¨¡å‹çš„å…¨å±€å‡†ç¡®ç¨‹åº¦ï¼ŒåŒ…å«çš„ä¿¡æ¯æœ‰é™ï¼Œä¸èƒ½å®Œå…¨è¯„ä»·ä¸€ä¸ªæ¨¡å‹æ€§èƒ½ã€‚</p>
<h3 id="2-æ··æ·†çŸ©é˜µ-Confusion-Matrix"><a href="#2-æ··æ·†çŸ©é˜µ-Confusion-Matrix" class="headerlink" title="2.æ··æ·†çŸ©é˜µ(Confusion Matrix)"></a>2.æ··æ·†çŸ©é˜µ(Confusion Matrix)</h3><p>æ··æ·†çŸ©é˜µæ˜¯ä»¥æ¨¡å‹é¢„æµ‹çš„ç±»åˆ«æ•°é‡ç»Ÿè®¡ä¿¡æ¯ä¸ºæ¨ªè½´ï¼ŒçœŸå®æ ‡ç­¾çš„æ•°é‡ç»Ÿè®¡ä¿¡æ¯ä¸ºçºµè½´ç”»å‡ºçš„çŸ©é˜µã€‚å¯¹è§’çº¿ä»£è¡¨äº†æ¨¡å‹é¢„æµ‹å’Œæ•°æ®æ ‡ç­¾ä¸€è‡´çš„æ•°ç›®ï¼Œæ‰€ä»¥å‡†ç¡®ç‡ä¹Ÿå¯ä»¥ç”¨<strong>æ··æ·†çŸ©é˜µå¯¹è§’çº¿ä¹‹å’Œé™¤ä»¥æµ‹è¯•é›†å›¾ç‰‡æ•°é‡</strong>æ¥è®¡ç®—ã€‚å¯¹è§’çº¿ä¸Šçš„æ•°å­—è¶Šå¤§è¶Šå¥½ï¼Œåœ¨æ··æ·†çŸ©é˜µå¯è§†åŒ–ç»“æœä¸­é¢œè‰²è¶Šæ·±ï¼Œä»£è¡¨æ¨¡å‹åœ¨è¯¥ç±»çš„é¢„æµ‹ç»“æœæ›´å¥½ã€‚å…¶ä»–åœ°æ–¹è‡ªç„¶æ˜¯é¢„æµ‹é”™è¯¯çš„åœ°æ–¹ï¼Œè‡ªç„¶å€¼è¶Šå°ï¼Œé¢œè‰²è¶Šæµ…è¯´æ˜æ¨¡å‹é¢„æµ‹çš„æ›´å¥½ã€‚</p>
<h3 id="3-ç²¾ç¡®ç‡-Precision-å’Œå¬å›ç‡-Recall-å’ŒPRæ›²çº¿"><a href="#3-ç²¾ç¡®ç‡-Precision-å’Œå¬å›ç‡-Recall-å’ŒPRæ›²çº¿" class="headerlink" title="3.ç²¾ç¡®ç‡(Precision)å’Œå¬å›ç‡(Recall)å’ŒPRæ›²çº¿"></a>3.ç²¾ç¡®ç‡(Precision)å’Œå¬å›ç‡(Recall)å’ŒPRæ›²çº¿</h3><p>ä¸€ä¸ªç»å…¸ä¾‹å­æ˜¯å­˜åœ¨ä¸€ä¸ªæµ‹è¯•é›†åˆï¼Œæµ‹è¯•é›†åˆåªæœ‰å¤§é›å’Œé£æœºä¸¤ç§å›¾ç‰‡ç»„æˆï¼Œå‡è®¾ä½ çš„åˆ†ç±»ç³»ç»Ÿæœ€ç»ˆçš„ç›®çš„æ˜¯ï¼šèƒ½å–å‡ºæµ‹è¯•é›†ä¸­æ‰€æœ‰é£æœºçš„å›¾ç‰‡ï¼Œè€Œä¸æ˜¯å¤§é›çš„å›¾ç‰‡ã€‚ç„¶åå°±å¯ä»¥å®šä¹‰ï¼š</p>
<ul>
<li>True positives: ç®€ç§°ä¸ºTPï¼Œå³æ­£æ ·æœ¬è¢«æ­£ç¡®è¯†åˆ«ä¸ºæ­£æ ·æœ¬ï¼Œé£æœºçš„å›¾ç‰‡è¢«æ­£ç¡®çš„è¯†åˆ«æˆäº†é£æœºã€‚</li>
<li>True negatives: ç®€ç§°ä¸ºTNï¼Œå³è´Ÿæ ·æœ¬è¢«æ­£ç¡®è¯†åˆ«ä¸ºè´Ÿæ ·æœ¬ï¼Œå¤§é›çš„å›¾ç‰‡æ²¡æœ‰è¢«è¯†åˆ«å‡ºæ¥ï¼Œç³»ç»Ÿæ­£ç¡®åœ°è®¤ä¸ºå®ƒä»¬æ˜¯å¤§é›ã€‚</li>
<li>False Positives: ç®€ç§°ä¸ºFPï¼Œå³è´Ÿæ ·æœ¬è¢«é”™è¯¯è¯†åˆ«ä¸ºæ­£æ ·æœ¬ï¼Œå¤§é›çš„å›¾ç‰‡è¢«é”™è¯¯åœ°è¯†åˆ«æˆäº†é£æœºã€‚</li>
<li>False negatives: ç®€ç§°ä¸ºFNï¼Œå³æ­£æ ·æœ¬è¢«é”™è¯¯è¯†åˆ«ä¸ºè´Ÿæ ·æœ¬ï¼Œé£æœºçš„å›¾ç‰‡æ²¡æœ‰è¢«è¯†åˆ«å‡ºæ¥ï¼Œç³»ç»Ÿé”™è¯¯åœ°è®¤ä¸ºå®ƒä»¬æ˜¯å¤§é›ã€‚</li>
</ul>
<p><strong>ç²¾ç¡®ç‡</strong>å°±æ˜¯åœ¨è¯†åˆ«å‡ºæ¥çš„å›¾ç‰‡ä¸­ï¼ŒTrue positivesæ‰€å çš„æ¯”ç‡ã€‚ä¹Ÿå°±æ˜¯æœ¬å‡è®¾ä¸­ï¼Œæ‰€æœ‰è¢«è¯†åˆ«å‡ºæ¥çš„é£æœºä¸­ï¼ŒçœŸæ­£çš„é£æœºæ‰€å çš„æ¯”ä¾‹ï¼Œå…¬å¼å¦‚ä¸‹ï¼šPrecision $=\frac{T P}{T P+F P}=\frac{T P}{N}$ ï¼Œå…¶ä¸­Nä»£è¡¨æµ‹è¯•é›†æ ·æœ¬æ•°ã€‚</p>
<p><strong>å¬å›ç‡</strong>æ˜¯æµ‹è¯•é›†ä¸­æ‰€æœ‰æ­£æ ·æœ¬æ ·ä¾‹ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«ä¸ºæ­£æ ·æœ¬çš„æ¯”ä¾‹ã€‚ä¹Ÿå°±æ˜¯æœ¬å‡è®¾ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«å‡ºæ¥çš„é£æœºä¸ªæ•°ä¸æµ‹è¯•é›†ä¸­æ‰€æœ‰çœŸå®é£æœºçš„ä¸ªæ•°çš„æ¯”å€¼ï¼Œå…¬å¼å¦‚ä¸‹ï¼š Recall$=\frac{T P}{T P+F N}$</p>
<p>æ‰€è°“<strong>PRæ›²çº¿</strong>å°±æ˜¯æ”¹å˜è¯†åˆ«é˜ˆå€¼ï¼Œä½¿å¾—ç³»ç»Ÿä¾æ¬¡èƒ½å¤Ÿè¯†åˆ«å‰Kå¼ å›¾ç‰‡ï¼Œé˜ˆå€¼çš„å˜åŒ–åŒæ—¶ä¼šå¯¼è‡´Precisionä¸Recallå€¼å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¾—åˆ°æ›²çº¿ã€‚æ›²çº¿å›¾å¤§æ¦‚å¦‚ä¸‹ï¼Œè¿™é‡Œæœ‰3æ¡PRæ›²çº¿ï¼Œå‘¨å¿—åæœºå™¨å­¦ä¹ çš„è§£é‡Šå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/metrics%20and%20databases/640.webp" alt></p>
<h3 id="4-å¹³å‡ç²¾åº¦-Average-Precisionï¼ŒAP-å’ŒmAP"><a href="#4-å¹³å‡ç²¾åº¦-Average-Precisionï¼ŒAP-å’ŒmAP" class="headerlink" title="4.å¹³å‡ç²¾åº¦(Average-Precisionï¼ŒAP)å’ŒmAP"></a>4.å¹³å‡ç²¾åº¦(Average-Precisionï¼ŒAP)å’ŒmAP</h3><p><strong>AP</strong>å°±æ˜¯Precision-recall æ›²çº¿ä¸‹é¢çš„é¢ç§¯ï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªè¶Šå¥½çš„åˆ†ç±»å™¨ï¼ŒAPå€¼è¶Šé«˜ã€‚<strong>mAP</strong>æ˜¯å¤šä¸ªç±»åˆ«APçš„å¹³å‡å€¼ã€‚è¿™ä¸ªmeançš„æ„æ€æ˜¯å¯¹æ¯ä¸ªç±»çš„APå†æ±‚å¹³å‡ï¼Œå¾—åˆ°çš„å°±æ˜¯mAPçš„å€¼ï¼ŒmAPçš„å¤§å°ä¸€å®šåœ¨[0,1]åŒºé—´ï¼Œè¶Šå¤§è¶Šå¥½ã€‚è¯¥æŒ‡æ ‡æ˜¯ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­æœ€é‡è¦çš„ä¸€ä¸ªã€‚</p>
<h3 id="5-ROCæ›²çº¿"><a href="#5-ROCæ›²çº¿" class="headerlink" title="5.ROCæ›²çº¿"></a>5.ROCæ›²çº¿</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/metrics%20and%20databases/641.webp" alt></p>
<p>ROCçš„æ¨ªè½´æ˜¯å‡æ­£ç‡(False positive rateï¼Œ FPR)ï¼ŒFPR = FP / [ FP + TN]  ï¼Œä»£è¡¨æ‰€æœ‰è´Ÿæ ·æœ¬ä¸­é”™è¯¯é¢„æµ‹ä¸ºæ­£æ ·æœ¬çš„æ¦‚ç‡ï¼Œå‡è­¦æŠ¥ç‡ã€‚ROCçš„çºµè½´æ˜¯çœŸæ­£ç‡(True positive rateï¼Œ TPR)ï¼ŒTPR  = TP / [ TP + FN]  ï¼Œä»£è¡¨æ‰€æœ‰æ­£æ ·æœ¬ä¸­é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡ï¼Œå‘½ä¸­ç‡ã€‚ROCæ›²çº¿çš„å¯¹è§’çº¿åæ ‡å¯¹åº”äºéšå³çŒœæµ‹ï¼Œè€Œåæ ‡ç‚¹(0,1)ä¹Ÿå³æ˜¯å·¦ä¸Šè§’åæ ‡å¯¹åº”ç†æƒ³æ¨¡å‹ã€‚æ›²çº¿è¶Šæ¥è¿‘å·¦ä¸Šè§’ä»£è¡¨æ£€æµ‹æ¨¡å‹çš„æ•ˆæœè¶Šå¥½ã€‚</p>
<p>å³ï¼šä» (0, 0) åˆ° (1,1) çš„å¯¹è§’çº¿å°†ROCç©ºé—´åˆ’åˆ†ä¸ºå·¦ä¸Šï¼å³ä¸‹ä¸¤ä¸ªåŒºåŸŸï¼Œåœ¨è¿™æ¡çº¿çš„ä»¥ä¸Šçš„ç‚¹ä»£è¡¨äº†ä¸€ä¸ªå¥½çš„åˆ†ç±»ç»“æœï¼ˆèƒœè¿‡éšæœºåˆ†ç±»ï¼‰ï¼Œè€Œåœ¨è¿™æ¡çº¿ä»¥ä¸‹çš„ç‚¹ä»£è¡¨äº†å·®çš„åˆ†ç±»ç»“æœï¼ˆåŠ£äºéšæœºåˆ†ç±»ï¼‰ã€‚</p>
<p>å®Œç¾çš„é¢„æµ‹æ˜¯ä¸€ä¸ªåœ¨å·¦ä¸Šè§’çš„ç‚¹ï¼Œåœ¨ROCç©ºé—´åº§æ ‡ (0,1)ç‚¹ï¼ŒX=0 ä»£è¡¨ç€æ²¡æœ‰ä¼ªé˜³æ€§ï¼ŒY=1  ä»£è¡¨ç€æ²¡æœ‰ä¼ªé˜´æ€§ï¼ˆæ‰€æœ‰çš„é˜³æ€§éƒ½æ˜¯çœŸé˜³æ€§ï¼‰ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡åˆ†ç±»å™¨è¾“å‡ºç»“æœæ˜¯é˜³æ€§æˆ–é˜´æ€§ï¼Œéƒ½æ˜¯100%æ­£ç¡®ã€‚ä¸€ä¸ªéšæœºçš„é¢„æµ‹ä¼šå¾—åˆ°ä½äºä» (0, 0) åˆ° (1, 1) å¯¹è§’çº¿ï¼ˆä¹Ÿå«æ— è¯†åˆ«ç‡çº¿ï¼‰ä¸Šçš„ä¸€ä¸ªç‚¹ï¼›æœ€ç›´è§‚çš„éšæœºé¢„æµ‹çš„ä¾‹å­å°±æ˜¯æŠ›ç¡¬å¸ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/metrics%20and%20databases/v2-fc750883be72300fa2373d1c5b81ee9e_hd.jpg" alt></p>
<p>é‚£ä¹ˆROCæ›²çº¿æ˜¯æ€ä¹ˆç»˜åˆ¶çš„å‘¢ï¼Ÿæœ‰å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ ¹æ®æ¯ä¸ªæµ‹è¯•æ ·æœ¬å±äºæ­£æ ·æœ¬çš„æ¦‚ç‡å€¼ä»å¤§åˆ°å°æ’åºã€‚</li>
<li>ä»é«˜åˆ°ä½ï¼Œä¾æ¬¡å°†â€œScoreâ€å€¼ä½œä¸ºé˜ˆå€¼thresholdï¼Œå½“æµ‹è¯•æ ·æœ¬å±äºæ­£æ ·æœ¬çš„æ¦‚ç‡å¤§äºæˆ–ç­‰äºè¿™ä¸ªthresholdæ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä¸ºæ­£æ ·æœ¬ï¼Œå¦åˆ™ä¸ºè´Ÿæ ·æœ¬ã€‚</li>
<li>æ¯æ¬¡é€‰å–ä¸€ä¸ªä¸åŒçš„thresholdï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ç»„FPRå’ŒTPRï¼Œå³ROCæ›²çº¿ä¸Šçš„ä¸€ç‚¹ã€‚å½“æˆ‘ä»¬å°†thresholdè®¾ç½®ä¸º1å’Œ0æ—¶ï¼Œåˆ†åˆ«å¯ä»¥å¾—åˆ°ROCæ›²çº¿ä¸Šçš„(0,0)å’Œ(1,1)ä¸¤ä¸ªç‚¹ã€‚å°†è¿™äº›(FPR,TPR)å¯¹è¿æ¥èµ·æ¥ï¼Œå°±å¾—åˆ°äº†ROCæ›²çº¿ã€‚å½“thresholdå–å€¼è¶Šå¤šï¼ŒROCæ›²çº¿è¶Šå¹³æ»‘ã€‚</li>
</ul>
<h3 id="6-AUC-Area-Uner-Curve"><a href="#6-AUC-Area-Uner-Curve" class="headerlink" title="6.AUC(Area Uner Curve)"></a>6.AUC(Area Uner Curve)</h3><p>å³ä¸ºROCæ›²çº¿ä¸‹çš„é¢ç§¯ã€‚AUCè¶Šæ¥è¿‘äº1ï¼Œåˆ†ç±»å™¨æ€§èƒ½è¶Šå¥½ã€‚AUCå€¼æ˜¯ä¸€ä¸ªæ¦‚ç‡å€¼ï¼Œå½“ä½ éšæœºæŒ‘é€‰ä¸€ä¸ªæ­£æ ·æœ¬ä»¥åŠä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œå½“å‰çš„åˆ†ç±»ç®—æ³•æ ¹æ®è®¡ç®—å¾—åˆ°çš„Scoreå€¼å°†è¿™ä¸ªæ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢çš„æ¦‚ç‡å°±æ˜¯AUCå€¼ã€‚å½“ç„¶ï¼ŒAUCå€¼è¶Šå¤§ï¼Œå½“å‰çš„åˆ†ç±»ç®—æ³•è¶Šæœ‰å¯èƒ½å°†æ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢ï¼Œå³èƒ½å¤Ÿæ›´å¥½çš„åˆ†ç±»ã€‚AUCçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
A U C=\frac{\sum p r e d_{p o s}>p r e d_{n e g}}{p o s i t i v e N u m * n e g a t i v e N  u m}</script><p>å³ï¼šåˆ†åˆ«éšæœºä»æ ·æœ¬é›†ä¸­æŠ½å–ä¸€ä¸ªæ­£è´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬çš„é¢„æµ‹å€¼å¤§äºè´Ÿæ ·æœ¬çš„æ¦‚ç‡ã€‚</p>
<h3 id="PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº"><a href="#PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº" class="headerlink" title="PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº"></a>PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº</h3><p>ç›®æ ‡æ£€æµ‹ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯MAPå€¼ï¼Œä½†æˆ‘ä»¬æœ€å¥½å†äº†è§£ä¸€ä¸‹PRæ›²çº¿å’ŒROCæ›²çº¿çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨ä¸åŒçš„æ•°æ®é›†ä¸­é€‰æ‹©åˆé€‚çš„è¯„ä»·æ ‡å‡†æ›´å¥½çš„åˆ¤æ–­æˆ‘ä»¬çš„æ¨¡å‹æ˜¯å¦è®­å¥½äº†ã€‚</p>
<h3 id="PRæ›²çº¿"><a href="#PRæ›²çº¿" class="headerlink" title="PRæ›²çº¿"></a>PRæ›²çº¿</h3><p>ä»PRçš„è®¡ç®—å…¬å¼å¯ä»¥çœ‹å‡ºï¼ŒPRæ›²çº¿èšç„¦äºæ­£ä¾‹ã€‚ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ä¸­ç”±äºä¸»è¦å…³å¿ƒæ­£ä¾‹ï¼Œæ‰€ä»¥åœ¨æ­¤æƒ…å†µä¸‹PRæ›²çº¿è¢«å¹¿æ³›è®¤ä¸ºä¼˜äºROCæ›²çº¿ã€‚</p>
<h3 id="ROCæ›²çº¿"><a href="#ROCæ›²çº¿" class="headerlink" title="ROCæ›²çº¿"></a>ROCæ›²çº¿</h3><p>å½“æµ‹è¯•é›†ä¸­çš„æ­£è´Ÿæ ·æœ¬çš„åˆ†å¸ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒROCæ›²çº¿å¯ä»¥ä¿æŒä¸å˜ã€‚å› ä¸ºTPRèšç„¦äºæ­£ä¾‹ï¼ŒFPRèšç„¦äºä¸è´Ÿä¾‹ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ¯”è¾ƒå‡è¡¡çš„è¯„ä¼°æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å…³å¿ƒæ­£ä¾‹çš„é¢„æµ‹å‡†ç¡®æ€§çš„åœºæ™¯ï¼ŒROCæ›²çº¿å°±ä¸èƒ½æ›´å¥½çš„ååº”æ¨¡å‹çš„æ€§èƒ½äº†ï¼Œå› ä¸ºROCæ›²çº¿çš„æ¨ªè½´é‡‡ç”¨FPRï¼Œæ ¹æ®FPRå…¬å¼ ï¼Œå½“è´Ÿä¾‹Nçš„æ•°é‡è¿œè¶…æ­£ä¾‹Pæ—¶ï¼ŒFPçš„å¤§å¹…å¢é•¿åªèƒ½æ¢æ¥FPRçš„å¾®å°æ”¹å˜ã€‚ç»“æœæ˜¯è™½ç„¶å¤§é‡è´Ÿä¾‹è¢«é”™åˆ¤æˆæ­£ä¾‹ï¼Œåœ¨ROCæ›²çº¿ä¸Šå´æ— æ³•ç›´è§‚åœ°çœ‹å‡ºæ¥ã€‚</p>
<p>å› æ­¤ï¼ŒPRæ›²çº¿å’ŒROCæ›²çº¿çš„é€‰ç”¨æ—¶æœºå¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/metrics%20and%20databases/642.webp" alt></p>
<p>ä»ç›®æ ‡æ£€æµ‹ä»»åŠ¡æ¥è®²ï¼Œä¸€èˆ¬å…³å¿ƒMAPå€¼å³å¯ã€‚</p>
<h2 id="æ•°æ®é›†ä»‹ç»"><a href="#æ•°æ®é›†ä»‹ç»" class="headerlink" title="æ•°æ®é›†ä»‹ç»"></a>æ•°æ®é›†ä»‹ç»</h2><p>åˆšæ‰ä»‹ç»äº†ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å¸¸è§è¯„ä»·æ ‡å‡†ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸‹ç›®æ ‡æ£€æµ‹å¸¸ç”¨çš„æ•°æ®é›†ã€‚ä»¥ä¸‹ä»‹ç»æ¥è‡ªäºgithubå·¥ç¨‹æ•´ç†ï¼šDeepLearning-500-questions</p>
<h3 id="PASCAL-VOCæ•°æ®é›†"><a href="#PASCAL-VOCæ•°æ®é›†" class="headerlink" title="PASCAL VOCæ•°æ®é›†"></a>PASCAL VOCæ•°æ®é›†</h3><p>VOCæ•°æ®é›†æ˜¯ç›®æ ‡æ£€æµ‹ç»å¸¸ç”¨çš„ä¸€ä¸ªæ•°æ®é›†ï¼Œè‡ª2005å¹´èµ·æ¯å¹´ä¸¾åŠä¸€æ¬¡æ¯”èµ›ï¼Œæœ€å¼€å§‹åªæœ‰4ç±»ï¼Œåˆ°2007å¹´æ‰©å……ä¸º20ä¸ªç±»ï¼Œå…±æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„ç‰ˆæœ¬ï¼š2007å’Œ2012ã€‚å­¦æœ¯ç•Œå¸¸ç”¨5kçš„train/val 2007å’Œ16kçš„train/val 2012ä½œä¸ºè®­ç»ƒé›†ï¼Œtest 2007ä½œä¸ºæµ‹è¯•é›†ï¼Œç”¨10kçš„train/val 2007+test  2007å’Œ16kçš„train/val 2012ä½œä¸ºè®­ç»ƒé›†ï¼Œtest2012ä½œä¸ºæµ‹è¯•é›†ï¼Œåˆ†åˆ«æ±‡æŠ¥ç»“æœã€‚</p>
<h3 id="MSCOCOæ•°æ®é›†"><a href="#MSCOCOæ•°æ®é›†" class="headerlink" title="MSCOCOæ•°æ®é›†"></a>MSCOCOæ•°æ®é›†</h3><p>COCOæ•°æ®é›†æ˜¯å¾®è½¯å›¢é˜Ÿå‘å¸ƒçš„ä¸€ä¸ªå¯ä»¥ç”¨æ¥å›¾åƒrecognition+segmentation+captioningçš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†æ”¶é›†äº†å¤§é‡åŒ…å«å¸¸è§ç‰©ä½“çš„æ—¥å¸¸åœºæ™¯å›¾ç‰‡ï¼Œå¹¶æä¾›åƒç´ çº§çš„å®ä¾‹æ ‡æ³¨ä»¥æ›´ç²¾ç¡®åœ°è¯„ä¼°æ£€æµ‹å’Œåˆ†å‰²ç®—æ³•çš„æ•ˆæœï¼Œè‡´åŠ›äºæ¨åŠ¨åœºæ™¯ç†è§£çš„ç ”ç©¶è¿›å±•ã€‚ä¾æ‰˜è¿™ä¸€æ•°æ®é›†ï¼Œæ¯å¹´ä¸¾åŠä¸€æ¬¡æ¯”èµ›ï¼Œç°å·²æ¶µç›–æ£€æµ‹ã€åˆ†å‰²ã€å…³é”®ç‚¹è¯†åˆ«ã€æ³¨é‡Šç­‰æœºå™¨è§†è§‰çš„ä¸­å¿ƒä»»åŠ¡ï¼Œæ˜¯ç»§ImageNet Chanllengeä»¥æ¥æœ€æœ‰å½±å“åŠ›çš„å­¦æœ¯ç«èµ›ä¹‹ä¸€ã€‚ç›¸æ¯”ImageNetï¼ŒCOCOæ›´åŠ åå¥½ç›®æ ‡ä¸å…¶åœºæ™¯å…±åŒå‡ºç°çš„å›¾ç‰‡ï¼Œå³non-iconic  imagesã€‚è¿™æ ·çš„å›¾ç‰‡èƒ½å¤Ÿåæ˜ è§†è§‰ä¸Šçš„è¯­ä¹‰ï¼Œæ›´ç¬¦åˆå›¾åƒç†è§£çš„ä»»åŠ¡è¦æ±‚ã€‚è€Œç›¸å¯¹çš„iconic  imagesåˆ™æ›´é€‚åˆæµ…è¯­ä¹‰çš„å›¾åƒåˆ†ç±»ç­‰ä»»åŠ¡ã€‚COCOçš„æ£€æµ‹ä»»åŠ¡å…±å«æœ‰80ä¸ªç±»ï¼Œåœ¨2014å¹´å‘å¸ƒçš„æ•°æ®è§„æ¨¡åˆ†train/val/teståˆ†åˆ«ä¸º80k/40k/40kï¼Œå­¦æœ¯ç•Œè¾ƒä¸ºé€šç”¨çš„åˆ’åˆ†æ˜¯ä½¿ç”¨trainå’Œ35kçš„valå­é›†ä½œä¸ºè®­ç»ƒé›†ï¼ˆtrainval35kï¼‰ï¼Œä½¿ç”¨å‰©ä½™çš„valä½œä¸ºæµ‹è¯•é›†ï¼ˆminivalï¼‰ï¼ŒåŒæ—¶å‘å®˜æ–¹çš„evaluation serveræäº¤ç»“æœï¼ˆtest-devï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCOCOå®˜æ–¹ä¹Ÿä¿ç•™ä¸€éƒ¨åˆ†testæ•°æ®ä½œä¸ºæ¯”èµ›çš„è¯„æµ‹é›†ã€‚</p>
<h3 id="Google-Open-Imageæ•°æ®é›†"><a href="#Google-Open-Imageæ•°æ®é›†" class="headerlink" title="Google Open Imageæ•°æ®é›†"></a>Google Open Imageæ•°æ®é›†</h3><p>pen Imageæ˜¯è°·æ­Œå›¢é˜Ÿå‘å¸ƒçš„æ•°æ®é›†ã€‚æœ€æ–°å‘å¸ƒçš„Open Images  V4åŒ…å«190ä¸‡å›¾åƒã€600ä¸ªç§ç±»ï¼Œ1540ä¸‡ä¸ªbounding-boxæ ‡æ³¨ï¼Œæ˜¯å½“å‰æœ€å¤§çš„å¸¦ç‰©ä½“ä½ç½®æ ‡æ³¨ä¿¡æ¯çš„æ•°æ®é›†ã€‚è¿™äº›è¾¹ç•Œæ¡†å¤§éƒ¨åˆ†éƒ½æ˜¯ç”±ä¸“ä¸šæ³¨é‡Šäººå‘˜æ‰‹åŠ¨ç»˜åˆ¶çš„ï¼Œç¡®ä¿äº†å®ƒä»¬çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚å¦å¤–ï¼Œè¿™äº›å›¾åƒæ˜¯éå¸¸å¤šæ ·åŒ–çš„ï¼Œå¹¶ä¸”é€šå¸¸åŒ…å«æœ‰å¤šä¸ªå¯¹è±¡çš„å¤æ‚åœºæ™¯ï¼ˆå¹³å‡æ¯ä¸ªå›¾åƒ 8 ä¸ªï¼‰ã€‚</p>
<h3 id="ImageNetæ•°æ®é›†"><a href="#ImageNetæ•°æ®é›†" class="headerlink" title="ImageNetæ•°æ®é›†"></a>ImageNetæ•°æ®é›†</h3><p>ImageNetæ˜¯ä¸€ä¸ªè®¡ç®—æœºè§†è§‰ç³»ç»Ÿè¯†åˆ«é¡¹ç›®ï¼Œ  æ˜¯ç›®å‰ä¸–ç•Œä¸Šå›¾åƒè¯†åˆ«æœ€å¤§çš„æ•°æ®åº“ã€‚ImageNetæ˜¯ç¾å›½æ–¯å¦ç¦çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼Œæ¨¡æ‹Ÿäººç±»çš„è¯†åˆ«ç³»ç»Ÿå»ºç«‹çš„ã€‚èƒ½å¤Ÿä»å›¾ç‰‡è¯†åˆ«ç‰©ä½“ã€‚Imagenetæ•°æ®é›†æ–‡æ¡£è¯¦ç»†ï¼Œæœ‰ä¸“é—¨çš„å›¢é˜Ÿç»´æŠ¤ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸç ”ç©¶è®ºæ–‡ä¸­åº”ç”¨éå¸¸å¹¿ï¼Œå‡ ä¹æˆä¸ºäº†ç›®å‰æ·±åº¦å­¦ä¹ å›¾åƒé¢†åŸŸç®—æ³•æ€§èƒ½æ£€éªŒçš„â€œæ ‡å‡†â€æ•°æ®é›†ã€‚Imagenetæ•°æ®é›†æœ‰1400å¤šä¸‡å¹…å›¾ç‰‡ï¼Œæ¶µç›–2ä¸‡å¤šä¸ªç±»åˆ«ï¼›å…¶ä¸­æœ‰è¶…è¿‡ç™¾ä¸‡çš„å›¾ç‰‡æœ‰æ˜ç¡®çš„ç±»åˆ«æ ‡æ³¨å’Œå›¾åƒä¸­ç‰©ä½“ä½ç½®çš„æ ‡æ³¨ã€‚</p>
<h3 id="DOTAæ•°æ®é›†"><a href="#DOTAæ•°æ®é›†" class="headerlink" title="DOTAæ•°æ®é›†"></a>DOTAæ•°æ®é›†</h3><p>DOTAæ˜¯é¥æ„Ÿèˆªç©ºå›¾åƒæ£€æµ‹çš„å¸¸ç”¨æ•°æ®é›†ï¼ŒåŒ…å«2806å¼ èˆªç©ºå›¾åƒï¼Œå°ºå¯¸å¤§çº¦ä¸º4k x 4kï¼ŒåŒ…å«15ä¸ªç±»åˆ«å…±è®¡188282ä¸ªå®ä¾‹ï¼Œå…¶ä¸­14ä¸ªä¸»ç±»ï¼Œsmall vehicle å’Œ large  vehicleéƒ½æ˜¯vehicleçš„å­ç±»ã€‚å…¶æ ‡æ³¨æ–¹å¼ä¸ºå››ç‚¹ç¡®å®šçš„ä»»æ„å½¢çŠ¶å’Œæ–¹å‘çš„å››è¾¹å½¢ã€‚èˆªç©ºå›¾åƒåŒºåˆ«äºä¼ ç»Ÿæ•°æ®é›†ï¼Œæœ‰å…¶è‡ªå·±çš„ç‰¹ç‚¹ï¼Œå¦‚ï¼šå°ºåº¦å˜åŒ–æ€§æ›´å¤§ï¼›å¯†é›†çš„å°ç‰©ä½“æ£€æµ‹ï¼›æ£€æµ‹ç›®æ ‡çš„ä¸ç¡®å®šæ€§ã€‚æ•°æ®åˆ’åˆ†ä¸º1/6éªŒè¯é›†ï¼Œ1/3æµ‹è¯•é›†ï¼Œ1/2è®­ç»ƒé›†ã€‚ç›®å‰å‘å¸ƒäº†è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå›¾åƒå°ºå¯¸ä»800 x 800åˆ°4000 x 4000ä¸ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu clashé…ç½®</title>
    <url>/2020/02/05/Ubuntu-clash%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="1"><a href="#1" class="headerlink" title=" 1."></a><a id="more"></a> 1.</h2><p>æ‰§è¡Œ <code>cd &amp;&amp; mkdir clash</code>åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º clash æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾è§£å‹åçš„æ–‡ä»¶åŠé…ç½®æ–‡ä»¶,å°†ä¸‹è½½çš„å‹ç¼©æ–‡ä»¶è§£å‹è‡³æ­¤ï¼Œå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶â€œ clash-linux-amd64 â€ã€‚ã€‚</p>
<p>ä¸€èˆ¬ä¸ªäººçš„64ä½ç”µè„‘ä¸‹è½½ clash-linux-amd64.tar.gz å³å¯ã€‚</p>
<p><a href="https://github.com/Dreamacro/clash/releases" target="_blank" rel="noopener">ä¸‹è½½å®¢æˆ·ç«¯</a><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/windows-cfw-1.png" alt></p>
<h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè¯¥æ–‡ä»¶<code>sudo ./clash-linux-amd64</code>ï¼Œæç¤ºç¼ºå°‘config.ymlé…ç½®æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆ/home/å½“å‰ç”¨æˆ·ID/.config/clashæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ config.yml å’Œ Country.mmdb ï¼Œè‹¥çœ‹ä¸åˆ°è¿™æ–‡ä»¶å¤¹ï¼Œåˆ™æŒ‰<code>ctrl+H</code>æ˜¾ç¤ºéšè—æ–‡ä»¶ã€‚å…¶ä¸­ Country.mmdbç”±äºå¢™çš„åŸå› ä¸‹è½½è¾ƒæ…¢ï¼Œè¿™é‡Œæä¾›<a href="https://quqi.gblhgk.com/s/2796382/PtRJqrmJaeM9Nh17" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a>ï¼Œç›´æ¥æ‹·è´è¿›/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp Country.mmdbçš„è·¯å¾„ ~&#x2F;home&#x2F;å½“å‰ç”¨æˆ·ID&#x2F;.config&#x2F;clash</span><br></pre></td></tr></table></figure></p>
<h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><p>ç¼–è¾‘/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸‹çš„ config.ymlé…ç½®æ–‡ä»¶ï¼Œå†…å®¹ä¸ºè‡ªå·±çš„æœåŠ¡å™¨åŠè§„åˆ™ç­‰ä¿¡æ¯(æœ‰äº›å•†å®¶ä¼šæä¾›ç›¸åº”çš„ymlæ–‡ä»¶ï¼Œä¸‹è½½åå°†å†…å®¹copyè‡³è¯¥æ–‡ä»¶)ï¼Œä¿å­˜æ›´æ”¹åå¤åˆ¶è¯¥æ–‡ä»¶è‡³å…ˆå‰åˆ›å»ºçš„Clashæ–‡ä»¶å¤¹(by:è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸è¦å¼„æ··ï¼Œä¸€ä¸ªæ˜¯æ‰‹åŠ¨å»ºç«‹çš„ï¼Œä¸€ä¸ªæ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œéƒ½éœ€è¦.ymlæ–‡ä»¶)ã€‚</p>
<p>åœ¨ç»ˆç«¯ cd åˆ° Clash äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œä¸‹è½½ Clash é…ç½®æ–‡ä»¶ï¼Œå¾—åˆ°å•†å®¶æä¾›çš„æœåŠ¡å™¨åŠè§„åˆ™ç­‰ä¿¡æ¯<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/linux-clash-2.jpg" alt></p>
<p>å°†å…¶åœ¨/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸‹å¤åˆ¶ä¸€ä»½<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp ~&#x2F;home&#x2F;å½“å‰ç”¨æˆ·ID&#x2F;clash&#x2F;config.yml ~&#x2F;home&#x2F;å½“å‰ç”¨æˆ·ID&#x2F;.config&#x2F;clash</span><br></pre></td></tr></table></figure></p>
<h2 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h2><p>é‡å¯ç»ˆç«¯ï¼Œæ‰§è¡Œ <code>sudo ./clash-linux-amd64</code>ä»¥åŠ è½½é…ç½®æ–‡ä»¶</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/linux-clash-3.jpg" alt></p>
<h2 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h2><p>è®¿é—® <a href="http://clash.razord.top/" target="_blank" rel="noopener">Clash Dashboard </a> å¯ä»¥è¿›è¡Œåˆ‡æ¢èŠ‚ç‚¹ã€æµ‹å»¶è¿Ÿç­‰æ“ä½œã€‚</p>
<p>Host: <code>127.0.0.1</code>ï¼Œç«¯å£: <code>9090</code><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/linux-clash-4.jpg" alt></p>
<h2 id="6"><a href="#6" class="headerlink" title="6."></a>6.</h2><p>ä»¥ Ubuntu 19.04 ä¸ºä¾‹ï¼Œæ‰“å¼€ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œä»£ç†å³è¾¹çš„ âš™ æŒ‰é’®ï¼Œé€‰æ‹©æ‰‹åŠ¨ï¼Œå¡«å†™ HTTP å’Œ HTTPS ä»£ç†ä¸º <code>127.0.0.1:7890</code>ï¼Œå¡«å†™ Socks ä¸»æœºä¸º <code>127.0.0.1:7891</code>ï¼Œå³å¯å¯ç”¨ç³»ç»Ÿä»£ç†ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/linux-clash-5.jpg" alt></p>
<p>è‹¥éœ€å…³æ‰ä»£ç†ï¼Œåˆ™<code>ctrl+c</code>åœæ­¢ç»ˆç«¯ï¼Œå¹¶åœ¨ç³»ç»Ÿä»£ç†è®¾ç½®ä¸­é‡æ–°æ”¹ä¸ºæ— å³å¯ã€‚</p>
<h2 id="7"><a href="#7" class="headerlink" title="7."></a>7.</h2><p>è‹¥éœ€å›ºå®šåˆ°å¯åŠ¨å™¨ï¼Œåˆ™é€‰æ‹©åˆé€‚çš„å›¾ç‰‡æ–‡ä»¶ï¼Œç”¨ä½œå›¾æ ‡ï¼Œæ”¾ç½®äºåˆ›å»ºçš„clashæ–‡ä»¶å¤¹ä¸‹</p>
<p>ä½¿ç”¨<code>sudo gedit /usr/share/applications/Clash.desktop</code>åœ¨ /usr/share/applications/ ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ Clash.desktop ï¼Œæ­¥éª¤åŠå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä»¥ä¸‹å„é¡¹æ ¹æ®è‡ªå·±çš„æƒ…å†µå¡«å†™</span><br><span class="line">[Desktop Entry]</span><br><span class="line"> Version&#x3D;0.17.0</span><br><span class="line"> Name&#x3D;Clash</span><br><span class="line"> Comment&#x3D;A rule-based tunnel in Go</span><br><span class="line"> Exec&#x3D;&#x2F;full&#x2F;path&#x2F;to&#x2F;clash-linux</span><br><span class="line"> Icon&#x3D;&#x2F;full&#x2F;path&#x2F;to&#x2F;clash-logo.png</span><br><span class="line"> Terminal&#x3D;false</span><br><span class="line"> Type&#x3D;Application</span><br><span class="line"> Categories&#x3D;Network</span><br></pre></td></tr></table></figure></p>
<p>å…³é”®è¯è¯´æ˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Desktop Entry] æ–‡ä»¶å¤´</span><br><span class="line">Version    ç‰ˆæœ¬</span><br><span class="line">Name    åº”ç”¨åç§°</span><br><span class="line">Name[xx]    ä¸åŒè¯­è¨€çš„åº”ç”¨åç§°</span><br><span class="line">Comment æ³¨é‡Š</span><br><span class="line">Exec    æ‰§è¡Œæ–‡ä»¶è·¯å¾„</span><br><span class="line">Icon    å›¾æ ‡è·¯å¾„</span><br><span class="line">Terminal    æ˜¯å¦ä½¿ç”¨ç»ˆç«¯</span><br><span class="line">Type    å¯åŠ¨å™¨ç±»å‹</span><br><span class="line">Categories  åº”ç”¨çš„ç±»å‹ï¼ˆå†…å®¹ç›¸å…³ï¼‰</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ“ä½œå®Œæˆåï¼Œå³å¯åœ¨å¯åŠ¨å™¨ä¸­çœ‹åˆ°è¯¥åº”ç”¨å›¾æ ‡ï¼Œå¯¹å…¶å³é”®å•å‡»ï¼Œé€‰æ‹©å›ºå®šåˆ°ä»»åŠ¡æ ï¼Œæ–¹ä¾¿ä»¥åæ‰“å¼€ ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/clash/Snipaste_2020-02-05_23-07-03.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>åç¡•è·¯ç”±å™¨åˆ·å›ºä»¶</title>
    <url>/2020/02/03/%E5%8D%8E%E7%A1%95%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%9B%BA%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title=" ä»‹ç»"></a><a id="more"></a> ä»‹ç»</h2><p>ç°åœ¨å¸‚é¢ä¸Šçš„è·¯ç”±å™¨åŸºæœ¬ä¸Šä½¿ç”¨çš„éƒ½æ˜¯å®˜æ–¹çš„å›ºä»¶ï¼Œè¿™æ˜¯å› ä¸ºè·¯ç”±å™¨çš„è®¾å¤‡å‚å•†æ˜¯ä¸ºäº†è®¾å¤‡çš„ç¨³å®šæ€§ç€æƒ³è€Œå‡ºå‘çš„ï¼Œè¿˜æœ‰å°±æ˜¯æ‰€è°“çš„åˆ·æ¢…æ—å›ºä»¶ä¹Ÿå°±æ˜¯åˆ·ç¬¬ä¸‰æ–¹çš„å›ºä»¶ï¼Œæœ€å¤§çš„ä½œç”¨å¯ä»¥è§£å°ä¸€äº›åŠŸèƒ½ã€‚å¯¹äºæ¢…æ—å›ºä»¶æ¥è¯´ï¼Œè¿™æœ‰ä¸€åŠçš„æ€§è´¨æ˜¯å±äºå®˜æ–¹çš„è·¯ç”±å™¨å›ºä»¶ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€åŠæ˜¯å¯ä»¥ç”¨æˆ·è‡ªå·±æ¥è¿›è¡Œè®¾ç½®çš„ï¼Œå…¶å®æ¢…æ—å›ºä»¶å°±æ˜¯ä¸€ä¸ªåç¡•è·¯ç”±å™¨çš„è‡ªå®šä¹‰å›ºä»¶ï¼Œæ˜¯åç¡•å®˜æ–¹çš„é—­æºé©±åŠ¨ï¼Œå› æ­¤ç¨³å®šæ€§è¦å¥½å¾ˆå¤šï¼Œä¸æ”¯æŒè¶…é¢‘ï¼Œå¾ˆå°‘å‡ºç°æ­»æœºã€å¡é¡¿çš„æƒ…å†µã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/185417q0zxbdexeze1x1nb.jpg" alt></p>
<p>å…¶æœ€å…·ç‰¹è‰²çš„ä¾¿æ˜¯å¤šäº†è½¯ä»¶ä¸­å¿ƒï¼Œåœ¨é‡Œé¢å®‰è£…å„ç§å„æ ·çš„æ’ä»¶å¯ä»¥å®ç°å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚ç¿»å¢™ï¼Œå»å¹¿å‘Šï¼Œç¦»çº¿ä¸‹è½½ï¼ŒåŒæ‹¨ç­‰ã€‚</p>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½èƒ½åˆ·æ¢…æ—å›ºä»¶ï¼Œéåç¡•çš„è·¯ç”±å™¨éœ€è¦ä¸åç¡•æŸä¸ªç‰ˆæœ¬çš„ç¡¬ä»¶ä¸€è‡´æ‰èƒ½åˆ·ï¼Œä»¥ç½‘ä»¶å’Œåç¡•è‡ªèº«çš„è·¯ç”±å™¨å±…å¤šã€‚</p>
<p>æˆ‘æ‰‹å¤´çš„è·¯ç”±å™¨ä¸ºåç¡•AC86Uï¼Œåç¡•åˆ·æ¢…æ—å›ºä»¶ç›¸å¯¹ç®€å•ï¼Œé£é™©ä½ï¼Œè‹¥å…¶ä»–å“ç‰Œçš„è·¯ç”±å™¨è¯·å»æŸ¥æ‰¾ç›¸åº”æ•™ç¨‹ï¼Œæ­¤æ•™ç¨‹åªé€‚ç”¨äºåç¡•å“ç‰Œã€‚</p>
<h2 id="å›ºä»¶ä¸‹è½½"><a href="#å›ºä»¶ä¸‹è½½" class="headerlink" title="å›ºä»¶ä¸‹è½½"></a>å›ºä»¶ä¸‹è½½</h2><p><a href="https://firmware.koolshare.cn/" target="_blank" rel="noopener">Koolshare</a>æ˜¯è·¯ç”±å™¨åˆ·æœºçš„è®ºå›ï¼Œå¯ä»¥å»é‡Œé¢ä¸‹è½½å›ºä»¶ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/Snipaste_2020-02-03_16-18-35.jpg" alt></p>
<p>å¸¸ç”¨åˆ°çš„ä¸ºçº¢è‰²æ¡†å‡ºæ¥çš„è¿™å››ä¸ªï¼Œåˆ†åˆ«æ˜¯åç¡•å®˜æ”¹å›ºä»¶ã€æ¢…æ—åŸç‰ˆå›ºä»¶ã€æ¢…æ—æ”¹ç‰ˆå›ºä»¶ã€ç½‘ä»¶å®˜æ”¹å›ºä»¶ã€‚</p>
<ul>
<li><p>åŸå‚å›ºä»¶ä¸ºåç¡•å®˜æ–¹çš„å›ºä»¶ã€‚</p>
</li>
<li><p>åŸç‰ˆæ¢…æ—ä¸ºå›½å¤–RMerlå¤§ç¥åŸºäºåç¡•å®˜æ–¹å›ºä»¶æºä»£ç ä¿®æ”¹è€Œæ¥çš„æ¢…æ—å›ºä»¶ã€‚</p>
</li>
<li><p>æ”¹ç‰ˆæ¢…æ—ä¸ºkoolshareå¼€å‘ç»„åŸºäºæ¢…æ—å›ºä»¶ä¿®æ”¹è€Œæ¥çš„å¸¦è½¯ä»¶ä¸­å¿ƒçš„æ¢…æ—æ”¹ç‰ˆå›ºä»¶ã€‚</p>
</li>
<li><p>å®˜æ”¹å›ºä»¶ä¸ºkoolshareå¼€å‘ç»„åŸºäºåç¡•å®˜æ–¹æºä»£ç ä¿®æ”¹è€Œæ¥çš„å¸¦è½¯ä»¶ä¸­å¿ƒçš„å®˜æ”¹å›ºä»¶ã€‚</p>
</li>
</ul>
<p>è¿™ä¹‹ä¸­å¸¸ç”¨çš„ä¸ºæ¢…æ—æ”¹å’Œå®˜æ”¹ï¼Œç›¸æ¯”å®˜æ”¹å›ºä»¶ï¼Œæ¢…æ—æ”¹ç‰ˆå›ºä»¶æœ‰æ›´å¤šçš„åŠŸèƒ½å’Œbugä¿®å¤ï¼Œè€Œå®˜æ”¹å›ºä»¶æ›´æ–°è¾ƒå¿«ã€‚å¥½ç”¨ç¨‹åº¦å·®åˆ«ä¸å¤§ï¼Œç¨³å®šæ€§æ¥è¯´ä¹ŸåŸºæœ¬æ— å·®ï¼Œé€‰å“ªä¸ªå›ºä»¶åŸºäºä¸ªäººå–œå¥½å³å¯ã€‚</p>
<p>æˆ‘ç”¨çš„æ˜¯æ¢…æ—æ”¹å›ºä»¶ï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œå¯ä»¥çœ‹åˆ°å¯ç”¨æœºå‹ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/Snipaste_2020-02-03_16-32-11.jpg" alt></p>
<p>é€‰æ‹©å¯¹åº”æœºå‹ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/Snipaste_2020-02-03_16-32-28.jpg" alt></p>
<p>é€‰æ‹©æœ€æ–°ç‰ˆæœ¬å›ºä»¶ä¸‹è½½ï¼Œå›ºä»¶ä¸º.wåç¼€ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/Snipaste_2020-02-03_16-32-47.jpg" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/Snipaste_2020-02-03_16-32-57.jpg" alt></p>
<h2 id="å›ºä»¶å®‰è£…"><a href="#å›ºä»¶å®‰è£…" class="headerlink" title="å›ºä»¶å®‰è£…"></a>å›ºä»¶å®‰è£…</h2><ul>
<li>é€‰æ‹©ã€ç³»ç»Ÿç®¡ç†ã€‘-ã€å›ºä»¶å‡çº§ã€‘ï¼Œé€‰æ‹©ä¸‹å¥½çš„ .w åç¼€çš„å›ºä»¶ï¼Œä¸Šä¼ å³å¯</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/k3.png" alt></p>
<ul>
<li>åˆ·æœºå®Œæˆåä¼šè‡ªåŠ¨é‡å¯ï¼Œè¯·è€å¿ƒç­‰å¾…å®Œæˆ</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/merlin/k4.png" alt></p>
<ul>
<li><p>åˆ·æœºå®Œæˆååœ¨ã€ç³»ç»Ÿç®¡ç†ã€‘â€“ã€æ¢å¤/å¯¼å‡º/ä¸Šä¼ è®¾ç½®ã€‘æ¢å¤å‡ºå‚è®¾ç½®</p>
</li>
<li><p>åœ¨ã€ç³»ç»Ÿç®¡ç†ã€‘â€“ã€ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼šFormat JFFS partition at next boot å’Œ Enable JFFS custom scripts and configs ç„¶åç‚¹å‡»åº”ç”¨æœ¬é¡µé¢è®¾ç½®ï¼ŒæˆåŠŸåé‡å¯è·¯ç”±å™¨ï¼›</p>
</li>
</ul>
<p>ï¼ˆæ³¨ï¼šåŒæ¸…å°±æ˜¯æŒ‡æ¢å¤å‡ºå‚è®¾ç½® + æ ¼å¼åŒ–jffsåˆ†åŒºï¼‰</p>
<p>é‡å¯åå…ˆå°†è·¯ç”±å™¨è¿ä¸Šç½‘ç»œï¼Œç„¶åè¿›å…¥è½¯ä»¶ä¸­å¿ƒå°†è½¯ä»¶ä¸­å¿ƒæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p>
<h2 id="è½¯ä»¶ä¸­å¿ƒ"><a href="#è½¯ä»¶ä¸­å¿ƒ" class="headerlink" title="è½¯ä»¶ä¸­å¿ƒ"></a>è½¯ä»¶ä¸­å¿ƒ</h2><p>å®Œæˆä¸Šè¿°å·¥ä½œï¼Œæ¢…æ—å›ºä»¶å°±è£…å¥½äº†ï¼Œç°åœ¨ä½ å¯ä»¥è¿›å…¥è½¯ä»¶ä¸­å¿ƒæœªå®‰è£…ï¼Œé€‰æ‹©åˆé€‚çš„æ’ä»¶å®‰è£…äº†ï¼Œæ’ä»¶å°±ä¸ä¸€ä¸€ä»‹ç»ï¼Œå…·ä½“å¯ä»¥ç™¾åº¦ï¼Œæˆ‘å¸¸ç”¨çš„æ˜¯è™šæ‹Ÿå†…å­˜å’Œshadowsocksã€‚</p>
<p>æ–°ç‰ˆè½¯ä»¶ä¸­å¿ƒå†…ä¸æä¾›shadowsocksæ’ä»¶ï¼Œæˆ‘è¿™é‡Œé€šè¿‡<a href="https://quqi.gblhgk.com/s/2796382/045bYgimCEJLRiCe" target="_blank" rel="noopener">äº‘ç›˜</a>åˆ†äº«ï¼Œå¤§å®¶å¯ä»¥åœ¨ã€è½¯ä»¶ä¸­å¿ƒã€‘-ã€ç¦»çº¿å®‰è£…ã€‘æ‰‹åŠ¨å®‰è£…æ’ä»¶ã€‚</p>
<h2 id="åç»­æ›´æ–°"><a href="#åç»­æ›´æ–°" class="headerlink" title="åç»­æ›´æ–°"></a>åç»­æ›´æ–°</h2><p>æŒ‰æ­¤æ•™ç¨‹åšçš„ï¼Œåç»­æ›´æ–°æ–°ç‰ˆçš„æ¢…æ—æ”¹æ—¶ï¼ŒæŒ‰Bæ¥å³å¯ã€‚</p>
<h5 id="A-åŸå‚å›ºä»¶-åŸç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#A-åŸå‚å›ºä»¶-åŸç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="A. åŸå‚å›ºä»¶/åŸç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>A. åŸå‚å›ºä»¶/åŸç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ol>
<li>åœ¨<code>åŸäº§å›ºä»¶</code>/<code>åŸç‰ˆæ¢…æ—</code>å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶æ–‡ä»¶ï¼›</li>
<li>åˆ·æœºå®Œæˆåä¼šè‡ªåŠ¨é‡å¯ï¼Œæ­¤æ—¶åˆ·æœºå®Œæˆï¼ˆåˆ·æœºå®Œæˆåå¯ä»¥ä¸æ¢å¤å‡ºäº§è®¾ç½®ï¼Œå½“ç„¶æ¢å¤ä¸€æ¬¡æ›´å¥½ï¼‰ï¼›</li>
<li>åˆ·æœºå®Œæˆåœ¨ã€ç³»ç»Ÿç®¡ç† ã€‘â€“ã€ ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼š<code>Format JFFS partition at next boot</code> å’Œ <code>Enable JFFS custom scripts and configs</code> ç„¶åç‚¹å‡»<code>åº”ç”¨æœ¬é¡µé¢è®¾ç½®</code>ï¼ŒæˆåŠŸåé‡å¯è·¯ç”±å™¨ï¼›</li>
<li>é‡å¯åå…ˆå°†è·¯ç”±å™¨è¿ä¸Šç½‘ç»œï¼Œç„¶åè¿›å…¥è½¯ä»¶ä¸­å¿ƒå°†è½¯ä»¶ä¸­å¿ƒæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</li>
</ol>
<h5 id="B-æ”¹ç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#B-æ”¹ç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="B. æ”¹ç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>B. æ”¹ç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ol>
<li>åˆ·è¿‡<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶çš„ï¼Œåœ¨å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>æ”¹ç‰ˆæ¢…æ—</code>æ–‡ä»¶ï¼ˆå¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œä¸éœ€è¦æ¢å¤å‡ºäº§è®¾ç½®ï¼‰ï¼›</li>
<li>åˆ·æœºåæ‰€æœ‰å·²ç»å®‰è£…çš„æ’ä»¶éƒ½ä¼šè¢«ä¿ç•™ï¼Œä¸ä¼šå—åˆ°å½±å“ã€‚</li>
</ol>
<h5 id="C-æ”¹ç‰ˆæ¢…æ—-åˆ·-å®˜æ”¹å›ºä»¶ï¼š"><a href="#C-æ”¹ç‰ˆæ¢…æ—-åˆ·-å®˜æ”¹å›ºä»¶ï¼š" class="headerlink" title="C. æ”¹ç‰ˆæ¢…æ— åˆ· å®˜æ”¹å›ºä»¶ï¼š"></a>C. æ”¹ç‰ˆæ¢…æ— åˆ· å®˜æ”¹å›ºä»¶ï¼š</h5><ul>
<li>è¯¦è§ï¼š<a href="http://koolshare.cn/thread-139965-1-1.html" target="_blank" rel="noopener">http://koolshare.cn/thread-139965-1-1.html</a></li>
</ul>
<h5 id="D-å®˜æ”¹å›ºä»¶-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#D-å®˜æ”¹å›ºä»¶-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="D. å®˜æ”¹å›ºä»¶ åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>D. å®˜æ”¹å›ºä»¶ åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ul>
<li>è¯¦è§ï¼š<a href="http://koolshare.cn/thread-139965-1-1.html" target="_blank" rel="noopener">http://koolshare.cn/thread-139965-1-1.html</a></li>
</ul>
<h5 id="E-æ”¹ç‰ˆæ¢…æ—-åˆ·-åŸå‚å›ºä»¶-æ¢…æ—åŸç‰ˆï¼š"><a href="#E-æ”¹ç‰ˆæ¢…æ—-åˆ·-åŸå‚å›ºä»¶-æ¢…æ—åŸç‰ˆï¼š" class="headerlink" title="E. æ”¹ç‰ˆæ¢…æ— åˆ· åŸå‚å›ºä»¶/æ¢…æ—åŸç‰ˆï¼š"></a>E. æ”¹ç‰ˆæ¢…æ— åˆ· åŸå‚å›ºä»¶/æ¢…æ—åŸç‰ˆï¼š</h5><ol>
<li>åœ¨<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>åŸäº§å›ºä»¶</code>/<code>æ¢…æ—åŸç‰ˆ</code>å›ºä»¶æ–‡ä»¶ï¼Œåˆ·æœºå®Œæˆåæœºå™¨ä¼šè‡ªåŠ¨é‡å¯ï¼ˆåˆ·æœºåå¯ä»¥ä¸æ¢å¤å‡ºäº§è®¾ç½®ï¼Œå½“ç„¶æ¢å¤ä¸€æ¬¡æ›´å¥½ï¼‰ï¼›</li>
<li>åˆ·æœºå®Œæˆåœ¨ã€ç³»ç»Ÿç®¡ç† ã€‘â€“ã€ ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼š<code>Format JFFS partition at next boot</code> å’Œ <code>Enable JFFS custom scripts and configs</code> ç„¶åç‚¹å‡»<code>åº”ç”¨æœ¬é¡µé¢è®¾ç½®</code>ï¼ŒæˆåŠŸåº”ç”¨åé‡å¯è·¯ç”±å™¨å³å¯ï¼Œæ­¤æ“ä½œå¯ä»¥æ¸…é™¤å®‰è£…åœ¨jffsåˆ†åŒºçš„è½¯ä»¶ä¸­å¿ƒå’Œæ‰€æœ‰æ’ä»¶ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>è·¯ç”±å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›ç™¾åº¦ç½‘ç›˜çš„ç ´è§£æ–¹æ³•</title>
    <url>/2020/02/02/%E4%B8%80%E4%BA%9B%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9A%84%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="1-ç½‘ç›˜åŠ©æ‰‹"><a href="#1-ç½‘ç›˜åŠ©æ‰‹" class="headerlink" title=" 1.ç½‘ç›˜åŠ©æ‰‹"></a><a id="more"></a> 1.ç½‘ç›˜åŠ©æ‰‹</h2><p>ç”±ç½‘å‹â€å“©å‘µâ€åˆ¶ä½œçš„<a href="https://greasyfork.org/zh-CN/scripts/378301-%E7%BD%91%E7%9B%98%E5%8A%A9%E6%89%8B" target="_blank" rel="noopener">ç½‘ç›˜åŠ©æ‰‹</a>è„šæœ¬ï¼Œéœ€è¦é€šè¿‡æ‹“å±• Violentmonkey æˆ–è€… Tampermonkey æ¥å¯ç”¨ï¼ŒåŸç†æ˜¯é€šè¿‡æ˜¾ç¤ºç›´é“¾ï¼Œç„¶åä½¿ç”¨ IDM æ¥åŠ é€Ÿä¸‹è½½<br><strong>ä½¿ç”¨æ–¹æ³•ï¼šï¼ˆä¸‹è½½éƒ¨åˆ†ï¼‰</strong><br>1ã€é€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶ï¼Œç‚¹å‡»é¡µé¢é‡Œçš„ â€œç”Ÿæˆé“¾æ¥â€ æ¥è·å–åŠ é€Ÿä¸‹è½½åœ°å€ã€‚<br>2ã€ä½¿ç”¨é¼ æ ‡å³é”®ç‚¹å‡»é“¾æ¥ï¼ˆæ³¨æ„æ˜¯å³é”®ç‚¹å‡»é“¾æ¥ï¼‰ï¼Œé€‰æ‹©â€œä½¿ç”¨ IDM ä¸‹è½½â€ï¼Œç„¶åç¡®å®šä¸‹è½½ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/7a6a15d5gy1g8s99l1zdqg20qn0euqa8.gif" alt></p>
<p>ä¹Ÿå¯ä»¥é…åˆAria2 manageræ‰©å±•ï¼Œæ·»åŠ å³é”®èœå•ï¼Œå°†ç”Ÿæˆçš„é“¾æ¥â€œ<strong>å¯¼å‡ºåˆ° ARIA2 RPC</strong>â€ï¼Œç”±AriaNgä¸‹è½½<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/Snipaste_2020-02-02_20-12-56.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/Snipaste_2020-02-02_20-13-39.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/7a6a15d5gy1g952lk3yu0g20sf0fy469.gif" alt></p>
<h2 id="2-äº¿å¯»ä¸‹è½½å™¨"><a href="#2-äº¿å¯»ä¸‹è½½å™¨" class="headerlink" title="2.äº¿å¯»ä¸‹è½½å™¨"></a>2.äº¿å¯»ä¸‹è½½å™¨</h2><p>ç”±52ç ´è§£è®ºå›ç½‘å‹ <a href="https://www.52pojie.cn/thread-959139-1-1.html" target="_blank" rel="noopener">kud</a> å¼€å‘ï¼Œè½¯ä»¶å‘å¸ƒå·²ç»4æœˆæœ‰ä½™ï¼Œä¸‹è½½é€Ÿåº¦å’Œæ˜“ç”¨æ€§ä¸è¾“å…¶å®ƒå·¥å…·ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥å…ç™»é™†ä¸‹è½½ï¼Œè¿™é‡Œæä¾›ç½‘ç›˜ä¸‹è½½ï¼š<a href="https://quqi.gblhgk.com/s/2796382/WN4on64IJNvzDDMZ" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a><br><strong>ä½¿ç”¨æ–¹æ³•ï¼šï¼ˆä¸‹è½½éƒ¨åˆ†ï¼‰</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/%E5%88%86%E4%BA%AB%E4%B8%8B%E8%BD%BD%E6%BC%94%E7%A4%BA.gif" alt></p>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>å½“ä½¿ç”¨ aria2 æ— æ³•ä¸‹è½½æ—¶ï¼Œè¯·å°è¯•ä½¿ç”¨ saldl ä¸‹è½½ã€‚</li>
<li>å½“ä¸‹è½½ç›®å½•æœ‰ä¸å°†è¦ä¸‹è½½çš„æ–‡ä»¶åŒåçš„æ–‡ä»¶æ—¶ï¼Œsaldl ä¸ä¼šç»§ç»­ä¸‹è½½ã€‚</li>
</ol>
<h2 id="3-Aria2ä¸‹è½½åŠ©æ‰‹"><a href="#3-Aria2ä¸‹è½½åŠ©æ‰‹" class="headerlink" title="3.Aria2ä¸‹è½½åŠ©æ‰‹"></a>3.Aria2ä¸‹è½½åŠ©æ‰‹</h2><p>æ­¤è„šæœ¬ä¸ä»…èƒ½ç”¨ariaä¸‹è½½ç™¾åº¦ç½‘ç›˜ï¼Œè¿˜èƒ½ä¸‹è½½bç«™è§†é¢‘ï¼Œçœ‹bç«™æ¸¯æ¾³å°ï¼Œç”±äºæ›¾è¢«äººä¸¾æŠ¥ï¼Œå·²ä»è„šæœ¬ç½‘ç«™ä¸‹æ¶ï¼Œéœ€è‡ªå·±è¿›å…¥Tempermonkeyï¼ˆæœ€å¥½ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œè¯¥è„šæœ¬ä¸æ”¯æŒæ—§ç‰ˆæœ¬Tempermonkeyï¼‰åˆ›å»ºã€‚<br>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; &#x3D;&#x3D;UserScript&#x3D;&#x3D;</span><br><span class="line">&#x2F;&#x2F; @namespace zyxubing</span><br><span class="line">&#x2F;&#x2F; @name Aria2ä¸‹è½½åŠ©æ‰‹</span><br><span class="line">&#x2F;&#x2F; @version 0.3.16</span><br><span class="line">&#x2F;&#x2F; @downloadURL https:&#x2F;&#x2F;gitee.com&#x2F;zyxubing&#x2F;codes&#x2F;1ru485apywbeg3ni0lxq260&#x2F;raw?blob_name&#x3D;aria2</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;pan.baidu.com&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;yun.baidu.com&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;wallhaven.cc&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;av*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;www.bilibili.com&#x2F;bangumi&#x2F;play&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;live.bilibili.com&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;space.bilibili.com&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;search.bilibili.com&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;nyaa.fun&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;nyaa.si&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;sukebei.nyaa.si&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;nyaa.mlyx.workers.dev&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;acg.rip&#x2F;*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;konachan.com&#x2F;post*</span><br><span class="line">&#x2F;&#x2F; @include https:&#x2F;&#x2F;konachan.net&#x2F;post*</span><br><span class="line">&#x2F;&#x2F; @domain baidu.com</span><br><span class="line">&#x2F;&#x2F; @domain baidupcs.com</span><br><span class="line">&#x2F;&#x2F; @domain bilibili.com</span><br><span class="line">&#x2F;&#x2F; @domain 111.229.137.150</span><br><span class="line">&#x2F;&#x2F; @domain 127.0.0.1</span><br><span class="line">&#x2F;&#x2F; @domain localhost</span><br><span class="line">&#x2F;&#x2F; @domain self</span><br><span class="line">&#x2F;&#x2F; @grant GM_cookie</span><br><span class="line">&#x2F;&#x2F; @grant GM_setClipboard</span><br><span class="line">&#x2F;&#x2F; @grant GM_xmlhttpRequest</span><br><span class="line">&#x2F;&#x2F; @run-at document-idle</span><br><span class="line">&#x2F;&#x2F; &#x3D;&#x3D;&#x2F;UserScript&#x3D;&#x3D;</span><br><span class="line">&#x2F;*</span><br><span class="line">åˆ‡å‹¿ä½¿ç”¨æ­¤è„šæœ¬ä¸‹è½½ç§å¯†æ–‡ä»¶</span><br><span class="line">åˆ‡å‹¿ä½¿ç”¨æ­¤è„šæœ¬ä¸‹è½½ç§å¯†æ–‡ä»¶</span><br><span class="line">åˆ‡å‹¿ä½¿ç”¨æ­¤è„šæœ¬ä¸‹è½½ç§å¯†æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">å…³äºä¸ºä½•è¦è·å–ç”¨æˆ·çš„cookieä¿¡æ¯è¯´æ˜</span><br><span class="line">è·å–cookieä¿¡æ¯åå¯ä»¥ä¸ç”¨ç™»å½•ç›´æ¥è¿›å…¥ç›¸åº”è´¦å·çš„ç™¾åº¦ç½‘ç›˜ã€‚</span><br><span class="line">ä½†è¿™å¹¶éä¸ºäº†çª¥æ¢ç”¨æˆ·çš„éšç§ï¼Œå› ä¸ºè¿™æ ·å¹¶ä¸èƒ½ç»™æˆ‘å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚</span><br><span class="line"></span><br><span class="line">å…¶å®ç›®çš„æ˜¯ä¸ºäº†å®ç°èµ„æºæ•´åˆåˆ©ç”¨ï¼Œå¤§è‡´ä¸Šå¯ä»¥ç†è§£ä¸ºå½“ä½ çš„è´¦å·é—²ç½®æ—¶å¯</span><br><span class="line">ä»¥ä¸ºå…¶ä»–äººæå‡ä¸‹è½½é€Ÿåº¦ã€‚è€Œå½“ä½ ä½¿ç”¨æ­¤è„šæœ¬ä¸‹è½½åº¦ç›˜ä¸Šçš„èµ„æºæ—¶ï¼Œå°±ç®—ä½ </span><br><span class="line">çš„è´¦å·å·²ç»è¢«ç™¾åº¦å®˜æ–¹æ‹‰é»‘é™é€Ÿï¼Œä½†ä»ç„¶åŠ é€Ÿä¸‹è½½ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœä½¿ç”¨svipè´¦å·åˆ™å»ºè®®ä½ ä½¿ç”¨å®˜æ–¹çš„å®¢æˆ·ç«¯æˆ–è€…å…¶ä»–å·¥å…·è¿›è¡Œä¸‹è½½ã€‚è¿™ä¸ª</span><br><span class="line">è„šæœ¬ä¸»è¦æ˜¯é’ˆå¯¹éä¼šå‘˜è´¦å·è®¾è®¡çš„ï¼Œå¯¹svipè´¦å·åŸºæœ¬ä¸Šå¹¶æ— æé€Ÿæ•ˆæœã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœä½ ä¸æƒ³ä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼Œå¯ä»¥ä¿®æ”¹ç™¾åº¦ç½‘ç›˜çš„è´¦å·å¯†ç ï¼Œè¿™æ ·è¢«æ‹¿çš„</span><br><span class="line">cookieä¿¡æ¯å°±ä¼šå¤±æ•ˆã€‚</span><br><span class="line"></span><br><span class="line">è‡³äºä»£ç ä¸ºä½•è¦è¿›è¡Œæ··æ·†ï¼Œå½“ç„¶æ˜¯ä¸ºäº†ä¿æŠ¤ã€‚æºç è£¸å¥”å®åœ¨å¤ªå®¹æ˜“å‡‰äº†ï¼Œåº¦</span><br><span class="line">ç›˜çš„å·¥ä½œäººå‘˜åˆä¸æ˜¯åªæ‹¿é’±ä¸åšäº‹çš„ã€‚å¯¹äºæ™®é€šç”¨æˆ·è€Œè¨€åº”è¯¥æ²¡æœ‰äººéœ€è¦æŸ¥</span><br><span class="line">çœ‹æºä»£ç ï¼ŒæŠŠæ‰€æœ‰ç»†èŠ‚éƒ½æ•´æ˜ç™½å¼„æ¸…æ¥šã€‚</span><br><span class="line"></span><br><span class="line">0.3.16 ä¿®å¤å“”å“©å“”å“©æ‰¹é‡ä¸‹è½½æ—¶ä¸èƒ½è·³è¿‡å·²å¤±æ•ˆçš„è§†é¢‘</span><br><span class="line">*&#x2F;</span><br><span class="line">!function()&#123;const ipod&#x3D;&#123;&#125;,u&#x3D;&#123;aria2(e,t&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;)&#123;console.log(t,&quot;| task &#x3D;&quot;,e.length);let o&#x3D;[],n&#x3D;&#123;id:u.uid(),method:&quot;system.multicall&quot;,params:[]&#125;;e.forEach(e&#x3D;&gt;&#123;let t&#x3D;&#123;&#125;,i&#x3D;&#123;methodName:&quot;aria2.addUri&quot;,params:[]&#125;;e.header&amp;&amp;(t[&quot;use-head&quot;]&#x3D;&quot;true&quot;,t.header&#x3D;e.header),t.split&#x3D;e.pi?e.pi:&quot;&quot;+e.url.length;e.dir&amp;&amp;(t.dir&#x3D;e.dir),t.out&#x3D;e.path?e.path.replace(&#x2F;\s+\&#x2F;\s+&#x2F;g,&quot;&#x2F;&quot;):e.extype?n.id+e.extype:&quot;&quot;;ipod.aria2.token&amp;&amp;i.params.push(&quot;token:&quot;+ipod.aria2.token),i.params.push(e.url);i.params.push(t),o.push(i)&#125;),n.params.push(o);GM_xmlhttpRequest(&#123;url:t,method:&quot;POST&quot;,data:JSON.stringify(n),onerror(e)&#123;console.log(&quot;error&quot;,e.finalUrl),alert(&quot;\u8fde\u63a5aria2\u5931\u8d25 \u8bf7\u68c0\u67e5aria2\u662f\u5426\u8fd0\u884c\u6216jsonrpc\u662f\u5426\u586b\u5199\u9519\u8bef&quot;)&#125;,onload(e)&#123;console.log(JSON.parse(e.responseText))&#125;&#125;)&#125;,now:()&#x3D;&gt;(new Date).getTime(),uid:()&#x3D;&gt;u.now().toString(36),zdom(e&#x3D;0)&#123;let t&#x3D;window.event;return t.preventDefault(),t.stopPropagation(),e?t.target:t.currentTarget&#125;,zform(e,t)&#123;document.querySelectorAll(e).forEach(e&#x3D;&gt;&#123;let o&#x3D;e.getAttribute(&quot;name&quot;);if(t.hasOwnProperty(o))switch(e.getAttribute(&quot;type&quot;))&#123;case&quot;radio&quot;:t[o].includes(e.value)&amp;&amp;(e.checked&#x3D;!0);break;case&quot;checkbox&quot;:t[o]&amp;&amp;(e.checked&#x3D;!0);break;default:e.value&#x3D;t[o]&#125;&#125;)&#125;,load(e)&#123;let t&#x3D;u.now(),o&#x3D;JSON.parse(localStorage.getItem(e));return Object.prototype.isPrototypeOf(o)&amp;&amp;(0&#x3D;&#x3D;o.expire||o.expir&gt;t)?o.data:null&#125;,save(e,t,o&#x3D;0)&#123;let n&#x3D;u.now();localStorage.setItem(e,JSON.stringify(&#123;data:t,expire:o?216e5*o+n:0&#125;))&#125;,serialize(e,t)&#123;let o,n,i&#x3D;[];switch(typeof e)&#123;case&quot;object&quot;:if(&quot;[object Array]&quot;&#x3D;&#x3D;(n&#x3D;Object.prototype.toString.call(e))||&quot;[object Object]&quot;&#x3D;&#x3D;n)for(o in e)Object.prototype.hasOwnProperty.call(e,o)&amp;&amp;i.push(u.serialize(e[o],t?t+&quot;[&quot;+o+&quot;]&quot;:o));return 0&#x3D;&#x3D;i.length?&quot;&quot;:i.join(&quot;&amp;&quot;);default:return t+&quot;&#x3D;&quot;+encodeURIComponent(&quot;&quot;+e)&#125;&#125;,strcut(e,t,o)&#123;let n,i,r&#x3D;&quot;&quot;;if(e&amp;&amp;e.includes(t))&#123;n&#x3D;e.indexOf(t)+t.length,-1&#x3D;&#x3D;(i&#x3D;e.indexOf(o,n))&amp;&amp;(i&#x3D;e.length);r&#x3D;e.substring(n,i)&#125;return r&#125;,sprintf(e)&#123;let t,o,n;if(o&#x3D;&quot;string&quot;&#x3D;&#x3D;typeof e?e:&quot;&quot;)for(t&#x3D;arguments.length-1;t&gt;0;t--)n&#x3D;RegExp(&quot;%&quot;+t,&quot;ig&quot;),o&#x3D;o.replace(n,arguments[t]);return o&#125;,download(e)&#123;if(e)&#123;let t&#x3D;[],o&#x3D;Object.assign(ipod.aria2);o.url&#x3D;[],e&#x3D;e.startsWith(&quot;magnet:&quot;)?u.magnet(e):e.startsWith(&quot;http&quot;)?e:e.startsWith(&quot;&#x2F;&#x2F;&quot;)?location.protocol+e:e.startsWith(&quot;&#x2F;&quot;)?location.origin+e:location.origin+&quot;&#x2F;&quot;+e;o.url.push(e),t.push(o);u.aria2(t,ipod.aria2.jsonrpc)&#125;&#125;,magnet(e)&#123;let t&#x3D;e.indexOf(&quot;&amp;&quot;);return-1&#x3D;&#x3D;t?e:e.substring(0,t)&#125;,history(e)&#123;const t&#x3D;history[e];return function()&#123;let o&#x3D;new Event(e);return o.arguments&#x3D;arguments,window.dispatchEvent(o),t.apply(this,arguments)&#125;&#125;&#125;;async function e(e)&#123;if(0&#x3D;&#x3D;ipod.task)&#123;ipod.list&#x3D;[],ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(ipod.len&#x3D;&#x3D;ipod.list.length)&#123;clearInterval(ipod.task),ipod.task&#x3D;0;&quot;video&quot;&#x3D;&#x3D;ipod.type&amp;&amp;ipod.aria2.cover&amp;&amp;y(1&#x3D;&#x3D;ipod.count&amp;&amp;1&#x3D;&#x3D;ipod.len?0:1),u.aria2(ipod.list,ipod.aria2.jsonrpc);ipod.adom&amp;&amp;ipod.adom.removeAttribute(&quot;style&quot;)&#125;&#125;,1e3);let t&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;player&#x2F;pagelist?aid&#x3D;&quot;+e,o&#x3D;await fetch(t).then(e&#x3D;&gt;e.json()).then(e&#x3D;&gt;0&#x3D;&#x3D;e.code?e.data[0].cid:0);if(0&#x3D;&#x3D;o)clearInterval(ipod.task),ipod.task&#x3D;0;else&#123;t&#x3D;u.sprintf(&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;web-interface&#x2F;view?aid&#x3D;%1&amp;cid&#x3D;%2&quot;,e,o);let n&#x3D;await fetch(t).then(e&#x3D;&gt;e.json()).then(t&#x3D;&gt;&#123;let o&#x3D;[];if(0&#x3D;&#x3D;t.code)&#123;o&#x3D;t.data.pages,ipod.type&#x3D;&quot;video&quot;;ipod.url&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;player&#x2F;playurl?avid&#x3D;%1&amp;cid&#x3D;%2&amp;qn&#x3D;116&quot;,ipod.aid&#x3D;e;ipod.title&#x3D;t.data.title,ipod.cover&#x3D;t.data.pic&#125;return o&#125;);ipod.count&#x3D;ipod.len&#x3D;n.length,g(n)&#125;&#125;&#125;async function t(e)&#123;let t,o,n&#x3D;&quot;https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;av&quot;+e.aid,i&#x3D;u.strcut(document.cookie,&quot;bili_jct&#x3D;&quot;,&quot;;&quot;),r&#x3D;&#123;&quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded; charset&#x3D;UTF-8&quot;&#125;;o&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;report&#x2F;click&#x2F;now&quot;,t&#x3D;await fetch(o,&#123;referrer:n,method:&quot;GET&quot;&#125;).then(e&#x3D;&gt;e.json()).then(e&#x3D;&gt;e.data.now);o&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;report&#x2F;click&#x2F;web&#x2F;h5&quot;,await fetch(o,&#123;headers:r,referrer:n,body:u.serialize(&#123;aid:e.aid,cid:e.cid,part:e.part,mid:e.mid,lv:0,ftime:e.created,stime:t,jsonp:&quot;jsonp&quot;,type:3,sub_type:0&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;);o&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;report&#x2F;web&#x2F;heartbeat&quot;,await fetch(o,&#123;headers:r,referrer:n,body:u.serialize(&#123;aid:e.aid,cid:e.cid,mid:e.mid,csrf:i,played_time:0,realtime:0,start_ts:t,type:3,dt:2,play_type:1&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;);await fetch(o,&#123;headers:r,referrer:n,body:u.serialize(&#123;aid:e.aid,cid:e.cid,mid:e.mid,csrf:i,played_time:e.duration,realtime:e.duration,start_ts:t,type:3,dt:2,play_type:0&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;),await fetch(o,&#123;headers:r,referrer:n,body:u.serialize(&#123;aid:e.aid,cid:e.cid,mid:e.mid,csrf:i,played_time:-1,realtime:e.len,start_ts:t,type:3,dt:2,play_type:4&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;);o&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;v2&#x2F;history&#x2F;delete&quot;,await fetch(o,&#123;headers:r,referrer:&quot;https:&#x2F;&#x2F;www.bilibili.com&#x2F;account&#x2F;history&quot;,body:u.serialize(&#123;kid:&quot;archive_&quot;+e.aid,jsonp:&quot;jsonp&quot;,csrf:i&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;);2&gt;Math.floor(10*e.like&#x2F;e.view)&amp;&amp;(o&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;web-interface&#x2F;archive&#x2F;has&#x2F;like?aid&#x3D;&quot;+e.aid,await fetch(o,&#123;referrer:n,method:&quot;GET&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;).then(e&#x3D;&gt;e.json()).then(t&#x3D;&gt;&#123;0&#x3D;&#x3D;t.code&amp;&amp;0&#x3D;&#x3D;t.data&amp;&amp;fetch(&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;web-interface&#x2F;archive&#x2F;like&quot;,&#123;headers:r,referrer:n,body:u.serialize(&#123;aid:e.aid,like:1,csrf:i&#125;),method:&quot;POST&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;)&#125;))&#125;function o()&#123;setTimeout(n,2e3)&#125;function n()&#123;let e,t;document.querySelector(&quot;ul.nav.navbar-nav&quot;).insertAdjacentHTML(&quot;afterbegin&quot;,&#39;&lt;li&gt;&lt;a id&#x3D;&quot;czyset&quot;&gt;Aria2\u8bbe\u7f6e&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;),document.querySelector(&quot;#czyset&quot;).addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;u.zdom(),A()&#125;,!1);(t&#x3D;document.querySelector(&quot;#bangumi-box&quot;))&amp;&amp;t.remove(),(t&#x3D;document.querySelector(&quot;div.footer&quot;))&amp;&amp;t.remove();(e&#x3D;document.querySelectorAll(&quot;i.fa.fa-download&quot;)).forEach(e&#x3D;&gt;&#123;e.addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;let e&#x3D;u.zdom(),t&#x3D;&#123;dir:ipod.aria2.dir,pi:&quot;1&quot;,url:[]&#125;;t.url.push(location.origin+e.parentElement.getAttribute(&quot;href&quot;)),u.aria2([t],ipod.aria2.jsonrpc)&#125;)&#125;)&#125;function i()&#123;let e&#x3D;[],t&#x3D;u.zdom(),o&#x3D;&#123;dir:ipod.aria2.dir,pi:1,url:[]&#125;;console.clear(),o.url.push(u.magnet(t.getAttribute(&quot;data-url&quot;)));e.push(o),u.aria2(e,ipod.aria2.jsonrpc)&#125;function r()&#123;return u.strcut(decodeURIComponent(location.hash),&quot;path&#x3D;&quot;,&quot;&amp;&quot;)&#125;function a(e)&#123;let t&#x3D;[],o&#x3D;&#123;timestamp:yunData.timestamp,uk:yunData.MYUK,dir:e&#125;;return e&amp;&amp;$.ajax(&#123;async:!1,method:&quot;GET&quot;,dataType:&quot;json&quot;,url:location.origin+&quot;&#x2F;api&#x2F;list&quot;,data:o,success(e)&#123;t&#x3D;0&#x3D;&#x3D;e.errno?e.list:[]&#125;&#125;),t&#125;function c()&#123;ipod.surl.length&amp;&amp;$.ajax(&#123;async:!1,url:&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;share&#x2F;cancel&quot;,method:&quot;POST&quot;,data:&quot;shareid_list&#x3D;%5B&quot;+ipod.shareid+&quot;%5D&quot;&#125;)&#125;function l()&#123;let e,t&#x3D;0,o&#x3D;[&quot;User-Agent: netdisk&quot;,&quot;Cookie: &quot;+ipod.cookie];function n()&#123;u.aria2(e,ipod.aria2.jsonrpc),ipod.btn.setAttribute(&quot;class&quot;,&quot;ion-download&quot;)&#125;e&#x3D;(()&#x3D;&gt;&#123;let e&#x3D;[],t&#x3D;a(r());return console.clear(),console.log(&quot;fileList &#x3D;&quot;,t.length),$(&quot;dd.g-clearfix&quot;).each((o,n)&#x3D;&gt;&#123;if(3&#x3D;&#x3D;n.getAttribute(&quot;class&quot;).replace(&quot; open-enable&quot;,&quot;&quot;).trim().split(&quot; &quot;).length)&#123;let o&#x3D;decodeURIComponent($(n).find(&quot;a&quot;).first().text());t.forEach(t&#x3D;&gt;&#123;o&#x3D;&#x3D;t.server_filename&amp;&amp;(t.isdir?e&#x3D;e.concat(function e(t)&#123;let o,n&#x3D;&#123;timestamp:yunData.timestamp,uk:yunData.MYUK,dir:t&#125;;return $.ajax(&#123;async:!1,method:&quot;GET&quot;,dataType:&quot;json&quot;,url:location.origin+&quot;&#x2F;api&#x2F;list&quot;,data:n,success(t)&#123;(o&#x3D;0&#x3D;&#x3D;t.errno?t.list:[]).forEach(t&#x3D;&gt;&#123;t.isdir&amp;&amp;(o&#x3D;o.concat(e(t.path)))&#125;)&#125;&#125;),o&#125;(t.path)):e.push(t))&#125;)&#125;&#125;),t&#x3D;[],e.forEach(e&#x3D;&gt;&#123;if(!e.isdir)&#123;void 0&#x3D;&#x3D;e.thumbs||delete e.thumbs,e.url&#x3D;[];e.pi&#x3D;&quot;16&quot;,t.push(e)&#125;&#125;),console.log(&quot;selectedList &#x3D;&quot;,t.length),t&#125;)().map(e&#x3D;&gt;(e.header&#x3D;o,e.pi&#x3D;&quot;16&quot;,e.url.push(&quot;http:&#x2F;&#x2F;pcs.baidu.com&#x2F;rest&#x2F;2.0&#x2F;pcs&#x2F;file?app_id&#x3D;250528&amp;method&#x3D;download&amp;path&#x3D;&quot;+encodeURIComponent(e.path)),e)),GM_xmlhttpRequest(&#123;url:&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;rest&#x2F;2.0&#x2F;xpan&#x2F;nas?method&#x3D;uinfo&quot;,method:&quot;GET&quot;,responseType:&quot;json&quot;,error:n,onload(o)&#123;let i&#x3D;o.response;0&#x3D;&#x3D;i.errno?2&#x3D;&#x3D;i.vip_type?n():6&gt;e.length?function o()&#123;if(t&#x3D;&#x3D;e.length)n();else&#123;let n&#x3D;e[t];(e&#x3D;&gt;&#123;let t&#x3D;&#123;schannel:0,channel_list:&quot;[]&quot;,period:1,fid_list:JSON.stringify(e)&#125;;ipod.shareid&#x3D;0,ipod.surl&#x3D;&quot;&quot;;e.length&amp;&amp;$.ajax(&#123;async:!1,url:&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;share&#x2F;set&quot;,method:&quot;POST&quot;,data:u.serialize(t),success(e)&#123;0&#x3D;&#x3D;e.errno&amp;&amp;(ipod.shareid&#x3D;e.shareid,ipod.surl&#x3D;e.link.substring(25))&#125;&#125;)&#125;)([n.fs_id]),ipod.surl?GM_xmlhttpRequest(&#123;method:&quot;POST&quot;,url:&quot;http:&#x2F;&#x2F;111.229.137.150&#x2F;img&#x2F;baiduyun.php&quot;,data:u.serialize(&#123;ctime:&quot;20200112&quot;,mode:ipod.mode,cookie:ipod.cookie,fid:n.fs_id,file:&quot;&#x2F;&quot;+n.server_filename,shareid:ipod.shareid,surl:ipod.surl,uid:yunData.MYUK&#125;),headers:&#123;&quot;Content-type&quot;:&quot;application&#x2F;x-www-form-urlencoded; charset&#x3D;UTF-8&quot;&#125;,error()&#123;console.log(&quot;error link &#x3D;&quot;,++t),c();e.length&gt;t&amp;&amp;o()&#125;,onload(e)&#123;console.log(&quot;success link &#x3D;&quot;,++t);let i&#x3D;JSON.parse(e.responseText);0&#x3D;&#x3D;i.error&amp;&amp;(n.header&#x3D;ipod.header,n.url&#x3D;i.url.slice()),c();o()&#125;&#125;):(console.log(&quot;fail &#x3D;&quot;,++t),o())&#125;&#125;():(ipod.btn.setAttribute(&quot;class&quot;,&quot;ion-download&quot;),alert(&quot;\u52fe\u9009\u7684\u6587\u4ef6\u6570\u91cf\u8fc7\u591a \u8bf7\u5206\u6279\u6b21\u4e0b\u8f7d&quot;)):n()&#125;&#125;)&#125;function f()&#123;let e&#x3D;!0,o&#x3D;Math.floor(u.now()&#x2F;1e3);if(ipod.vlistlen&#x3D;0,ipod.vlist&#x3D;[],&quot;www.bilibili.com&quot;&#x3D;&#x3D;location.host)&#123;e&#x3D;!1,location.pathname.startsWith(&quot;&#x2F;video&#x2F;&quot;)&amp;&amp;(e&#x3D;!0);location.pathname.startsWith(&quot;&#x2F;bangumi&#x2F;play&#x2F;&quot;)&amp;&amp;(e&#x3D;!0)&#125;if(e&amp;&amp;o&gt;parseInt(localStorage.getItem(&quot;zlog&quot;)||0,10))&#123;localStorage.setItem(&quot;zlog&quot;,o+1800);let e&#x3D;setInterval(()&#x3D;&gt;&#123;ipod.vlistlen&#x3D;&#x3D;ipod.vlist.length&amp;&amp;(clearInterval(e),ipod.vlist.length&amp;&amp;ipod.vlist.forEach(t))&#125;,2e3);(()&#x3D;&gt;&#123;let e&#x3D;9,t&#x3D;0,o&#x3D;[],n&#x3D;setInterval(()&#x3D;&gt;&#123;if(e&#x3D;&#x3D;t)&#123;clearInterval(n),ipod.vlistlen&#x3D;o.length;o.forEach(s)&#125;&#125;,1e3);GM_xmlhttpRequest(&#123;url:&quot;http:&#x2F;&#x2F;111.229.137.150&#x2F;img&#x2F;bluid.php&quot;,method:&quot;GET&quot;,responseType:&quot;json&quot;,onload(n)&#123;let i&#x3D;n.response;e&#x3D;i.list.length,i.list.forEach(e&#x3D;&gt;&#123;GM_xmlhttpRequest(&#123;url:u.sprintf(&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;space&#x2F;arc&#x2F;search?mid&#x3D;%1&amp;ps&#x3D;30&amp;tid&#x3D;0&amp;pn&#x3D;1&amp;keyword&#x3D;&amp;order&#x3D;pubdate&quot;,e),method:&quot;GET&quot;,responseType:&quot;json&quot;,onload(e)&#123;t++,o&#x3D;o.concat(e.response.data.list.vlist)&#125;&#125;)&#125;)&#125;&#125;)&#125;)()&#125;&#125;function s(e)&#123;let t,o;GM_xmlhttpRequest(&#123;url:&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;web-interface&#x2F;archive&#x2F;stat?aid&#x3D;&quot;+e.aid,method:&quot;GET&quot;,responseType:&quot;json&quot;,onload(n)&#123;let i,r&#x3D;n.response;0&#x3D;&#x3D;r.code?(o&#x3D;&#123;aid:e.aid,created:e.created,mid:e.mid,title:e.title,view:(i&#x3D;r.data).view,danmaku:i.danmaku,favorite:i.favorite,coin:i.coin,share:i.share,like:i.like&#125;,GM_xmlhttpRequest(&#123;url:&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;player&#x2F;pagelist?aid&#x3D;&quot;+e.aid,method:&quot;GET&quot;,responseType:&quot;json&quot;,onload(e)&#123;let n,i&#x3D;e.response;if(0&#x3D;&#x3D;i.code)&#123;(t&#x3D;15*Math.floor((n&#x3D;i.data[0]).duration&#x2F;15))&#x3D;&#x3D;n.duration&amp;&amp;(t-&#x3D;15),o.duration&#x3D;t;o.cid&#x3D;n.cid,o.len&#x3D;n.duration;o.part&#x3D;n.part,ipod.vlist.push(o)&#125;else ipod.vlistlen--&#125;&#125;)):ipod.vlistlen--&#125;&#125;)&#125;function d()&#123;ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(&quot;function&quot;&#x3D;&#x3D;typeof jQuery&amp;&amp;document.querySelector(&quot;ul.video-list&quot;))&#123;clearInterval(ipod.task),ipod.task&#x3D;0;$(&quot;ul.video-list&quot;).on(&quot;click&quot;,()&#x3D;&gt;&#123;if(window.event.altKey)&#123;ipod.adom&#x3D;u.zdom(1);while(&quot;li&quot;!&#x3D;ipod.adom.tagName.toLowerCase())ipod.adom&#x3D;ipod.adom.parentElement;ipod.adom.setAttribute(&quot;style&quot;,&quot;visibility: hidden&quot;),e(ipod.adom.children[0].getAttribute(&quot;href&quot;).match(&#x2F;av(\d+)&#x2F;)[1])&#125;&#125;)&#125;&#125;,1e3)&#125;function b()&#123;setTimeout(()&#x3D;&gt;&#123;location.pathname.endsWith(&quot;&#x2F;favlist&quot;)&amp;&amp;(ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(document.querySelector(&quot;ul.fav-video-list&quot;)&amp;&amp;(clearInterval(ipod.task),ipod.task&#x3D;0,!document.querySelector(&quot;#zydl&quot;)))&#123;$(&quot;div.fav-filters&quot;).prepend(&#39;&lt;div class&#x3D;&quot;filter-item&quot;&gt;&lt;span id&#x3D;&quot;zydl&quot; class&#x3D;&quot;text&quot;&gt;&lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u5168\u90e8\u4e0b\u8f7d&lt;&#x2F;span&gt;&lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;filter-item&quot;&gt;&lt;span id&#x3D;&quot;czyset&quot; class&#x3D;&quot;text&quot;&gt;&lt;i class&#x3D;&quot;ion-settings&quot;&gt;&lt;&#x2F;i&gt; Aria2\u8bbe\u7f6e&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&#39;),$(&quot;#zydl&quot;).on(&quot;click&quot;,v);$(&quot;#czyset&quot;).on(&quot;click&quot;,A),$(&quot;ul.fav-video-list&quot;).on(&quot;click&quot;,w)&#125;&#125;,1e3)),location.pathname.endsWith(&quot;&#x2F;video&quot;)&amp;&amp;(ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(document.querySelector(&quot;ul.cube-list&quot;)&amp;&amp;(clearInterval(ipod.task),ipod.task&#x3D;0,!document.querySelector(&quot;#zydl&quot;)))&#123;$(&quot;ul.be-tab-inner&quot;).append(&#39;&lt;li id&#x3D;&quot;zydl&quot; class&#x3D;&quot;be-tab-item&quot;&gt;&lt;span&gt;&lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u5168\u90e8\u4e0b\u8f7d&lt;&#x2F;span&gt;&lt;&#x2F;li&gt; &lt;li id&#x3D;&quot;czyset&quot; class&#x3D;&quot;be-tab-item&quot;&gt;&lt;span&gt;&lt;i class&#x3D;&quot;ion-settings&quot;&gt;&lt;&#x2F;i&gt; Aria2\u8bbe\u7f6e&lt;&#x2F;span&gt;&lt;&#x2F;li&gt;&#39;),$(&quot;#zydl&quot;).on(&quot;click&quot;,v);$(&quot;#czyset&quot;).on(&quot;click&quot;,A),$(&quot;ul.cube-list&quot;).on(&quot;click&quot;,w)&#125;&#125;,1e3))&#125;,1e3)&#125;function p()&#123;let e&#x3D;setInterval(()&#x3D;&gt;&#123;let t&#x3D;document.querySelector(&quot;input.bui-checkbox&quot;);t&amp;&amp;(clearInterval(e),t.checked&amp;&amp;t.click())&#125;,3e3)&#125;function m()&#123;fetch(u.sprintf(ipod.url,ipod.aid,ipod.cid)).then(e&#x3D;&gt;e.json()).then(e&#x3D;&gt;&#123;if(0&#x3D;&#x3D;e.code)&#123;let t,o&#x3D;[];f(),e.durl.forEach(e&#x3D;&gt;&#123;t&#x3D;&#123;duration:e.length,filesize:e.size,url:e.url.replace(&quot;http:&quot;,&quot;https:&quot;)&#125;,o.push(t)&#125;);((e,t)&#x3D;&gt;&#123;if(flvjs.isSupported())&#123;if(j)&#123;j.unload(),j.detachMediaElement();j.destroy()&#125;if(j&#x3D;flvjs.createPlayer(&#123;cors:!0,type:e,segments:t&#125;))&#123;j.attachMediaElement(document.querySelector(&quot;#bplayer&quot;)),j.load();j.play()&#125;&#125;&#125;)(e.format,o)&#125;else alert(&quot;\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u6ca1\u6709\u5927\u4f1a\u5458\u8d26\u53f7\u8fdb\u884c\u89e3\u6790\u64ad\u653e\u5730\u5740&quot;)&#125;)&#125;function h()&#123;let e&#x3D;u.zdom();ipod.aid&#x3D;e.getAttribute(&quot;data-aid&quot;),ipod.cid&#x3D;e.getAttribute(&quot;data-cid&quot;);m()&#125;function y(e)&#123;ipod.len++;let t&#x3D;&#123;dir:ipod.aria2.video,folder:e?ipod.aid:&quot;&quot;,file:ipod.aid+&quot;.jpg&quot;,url:[ipod.cover]&#125;;t.path&#x3D;t.folder?t.folder+&quot;&#x2F;&quot;+t.file:t.file,ipod.list.push(t)&#125;function v()&#123;console.clear();let t&#x3D;document.querySelector(&quot;ul.cube-list&quot;)?document.querySelectorAll(&quot;ul.cube-list&gt;li&quot;):document.querySelector(&quot;ul.fav-video-list&quot;)?document.querySelectorAll(&quot;ul.fav-video-list&gt;li&quot;):[],o&#x3D;t.length,n&#x3D;0,i&#x3D;setInterval(()&#x3D;&gt;&#123;n&#x3D;&#x3D;o?(clearInterval(i),document.querySelector(&quot;#zydl&gt;i&quot;).setAttribute(&quot;class&quot;,&quot;ion-download&quot;)):0&#x3D;&#x3D;ipod.task&amp;&amp;(e(t[n].getAttribute(&quot;data-aid&quot;)),n++)&#125;,2e3);document.querySelector(&quot;#zydl&gt;i&quot;).setAttribute(&quot;class&quot;,&quot;ion-refresh spinner&quot;)&#125;function g(e)&#123;e.forEach(e&#x3D;&gt;&#123;fetch(u.sprintf(ipod.url,ipod.aid,e.cid),&#123;method:&quot;GET&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;).then(e&#x3D;&gt;e.json()).then(t&#x3D;&gt;&#123;if(0&#x3D;&#x3D;t.code)&#123;let o&#x3D;t.data.durl,n&#x3D;o.length;ipod.len+&#x3D;n-1,o.forEach(t&#x3D;&gt;&#123;let o&#x3D;&#123;url:[],pi:&quot;8&quot;,header:ipod.header,dir:ipod.aria2.video&#125;;Array.isArray(t.backup_url)&amp;&amp;(o.url&#x3D;t.backup_url),o.url.push(t.url);o.folder&#x3D;1&#x3D;&#x3D;ipod.count&amp;&amp;1&#x3D;&#x3D;n?&quot;&quot;:ipod.aid,o.file&#x3D;1&#x3D;&#x3D;ipod.count?1&#x3D;&#x3D;n?ipod.aid+&quot;.flv&quot;:z(t.order)+&quot;.flv&quot;:1&#x3D;&#x3D;n?z(e.page)+&quot; &quot;+e.part+&quot;.flv&quot;:z(e.page)+&quot; &quot;+e.part+&quot; &quot;+z(t.order)+&quot;.flv&quot;;o.path&#x3D;o.folder?o.folder+&quot;&#x2F;&quot;+o.file:o.file,ipod.list.push(o)&#125;)&#125;else ipod.len--&#125;)&#125;)&#125;function w()&#123;if(window.event.altKey)&#123;ipod.adom&#x3D;u.zdom(1);while(&quot;li&quot;!&#x3D;ipod.adom.tagName.toLowerCase())ipod.adom&#x3D;ipod.adom.parentElement;ipod.adom.setAttribute(&quot;style&quot;,&quot;visibility: hidden&quot;),e(ipod.adom.getAttribute(&quot;data-aid&quot;))&#125;&#125;function k(e)&#123;e.forEach(e&#x3D;&gt;&#123;fetch(u.sprintf(ipod.url,ipod.aid,e.cid),&#123;method:&quot;GET&quot;,mode:&quot;cors&quot;,credentials:&quot;include&quot;&#125;).then(e&#x3D;&gt;e.json()).then(t&#x3D;&gt;&#123;if(0&#x3D;&#x3D;t.code)&#123;let o&#x3D;ipod.area?t.durl:t.result.durl,n&#x3D;o.length;ipod.len+&#x3D;n-1,o.forEach(t&#x3D;&gt;&#123;let o&#x3D;&#123;url:[],header:ipod.header,dir:ipod.aria2.anime&#125;;Array.isArray(t.backup_url)&amp;&amp;(o.url&#x3D;t.backup_url),o.url.push(t.url);o.folder&#x3D;1&#x3D;&#x3D;ipod.count&amp;&amp;1&#x3D;&#x3D;n?&quot;&quot;:ipod.title,o.file&#x3D;1&#x3D;&#x3D;ipod.count?1&#x3D;&#x3D;n?ipod.title+&quot;.flv&quot;:z(t.order)+&quot;.flv&quot;:1&#x3D;&#x3D;n?z(e.title)+&quot; &quot;+e.longTitle+&quot;.flv&quot;:z(e.title)+&quot; &quot;+e.longTitle+&quot; &quot;+z(t.order)+&quot;.flv&quot;;o.path&#x3D;o.folder?o.folder+&quot;&#x2F;&quot;+o.file:o.file,ipod.list.push(o)&#125;)&#125;else ipod.len--&#125;)&#125;)&#125;function x()&#123;$(&quot;#zylist li&quot;).on(&quot;click&quot;,()&#x3D;&gt;&#123;let e&#x3D;u.zdom();$(e).toggleClass(&quot;on&quot;)&#125;),$(&quot;#zylist button&quot;).on(&quot;click&quot;,()&#x3D;&gt;&#123;switch(u.zdom().getAttribute(&quot;name&quot;))&#123;case&quot;all&quot;:$(&quot;#zylist li&quot;).each((e,t)&#x3D;&gt;&#123;$(t).addClass(&quot;on&quot;)&#125;);break;case&quot;invert&quot;:$(&quot;#zylist li&quot;).each((e,t)&#x3D;&gt;&#123;$(t).toggleClass(&quot;on&quot;)&#125;);break;default:let e&#x3D;[],t&#x3D;[],o&#x3D;__INITIAL_STATE__;$(&quot;#zylist li&quot;).each((t,o)&#x3D;&gt;&#123;let n&#x3D;$(o);n.hasClass(&quot;on&quot;)&amp;&amp;e.push(n.attr(&quot;name&quot;))&#125;),ipod.len&#x3D;e.length;ipod.list&#x3D;[],$(&quot;#zylist&quot;).fadeOut();&quot;video&quot;&#x3D;&#x3D;ipod.type&amp;&amp;(o.videoData.pages.forEach(o&#x3D;&gt;&#123;e.includes(&quot;&quot;+o.cid)&amp;&amp;t.push(o)&#125;),g(t)),&quot;anime&quot;&#x3D;&#x3D;ipod.type&amp;&amp;(o.epList.forEach(o&#x3D;&gt;&#123;e.includes(&quot;&quot;+o.cid)&amp;&amp;t.push(o)&#125;),k(t))&#125;&#125;)&#125;function _()&#123;let e,t&#x3D;u.zdom();if(0&#x3D;&#x3D;ipod.task)&#123;if(e&#x3D;__INITIAL_STATE__,document.querySelector(&quot;#zydl&gt;i&quot;).setAttribute(&quot;style&quot;,&quot;color: #fb7299&quot;),ipod.list&#x3D;[],ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(ipod.len&#x3D;&#x3D;ipod.list.length)if(clearInterval(ipod.task),ipod.task&#x3D;0,document.querySelector(&quot;#zydl&gt;i&quot;).removeAttribute(&quot;style&quot;),&quot;video&quot;&#x3D;&#x3D;ipod.type&amp;&amp;ipod.aria2.cover&amp;&amp;y(1&#x3D;&#x3D;ipod.count&amp;&amp;1&#x3D;&#x3D;ipod.len?0:1),ipod.aria2.getlink)&#123;let e&#x3D;[];ipod.list.forEach(t&#x3D;&gt;&#123;e.push(t.url[0])&#125;),GM_setClipboard(e.join(&quot;\r\n&quot;),&quot;text&quot;)&#125;else u.aria2(ipod.list,ipod.aria2.jsonrpc)&#125;,1e3),e.videoData)if(ipod.type&#x3D;&quot;video&quot;,ipod.url&#x3D;&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;x&#x2F;player&#x2F;playurl?avid&#x3D;%1&amp;cid&#x3D;%2&amp;qn&#x3D;116&quot;,ipod.aid&#x3D;e.videoData.aid,ipod.title&#x3D;e.videoData.title,ipod.cover&#x3D;e.videoData.pic,ipod.count&#x3D;ipod.len&#x3D;e.videoData.pages.length,1&#x3D;&#x3D;ipod.count)g(e.videoData.pages);else&#123;let o&#x3D;&#39;&lt;div&gt; &lt;div class&#x3D;&quot;btn-group full&quot;&gt; &lt;button name&#x3D;&quot;all&quot;&gt; \u5168\u9009 &lt;&#x2F;button&gt; &lt;button name&#x3D;&quot;invert&quot;&gt; \u53cd\u9009 &lt;&#x2F;button&gt; &lt;button name&#x3D;&quot;download&quot;&gt; &lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u4e0b\u8f7d &lt;&#x2F;button&gt; &lt;&#x2F;div&gt; &lt;ul&gt;&#39;;if(t&#x3D;document.querySelector(&quot;#zylist&quot;))t.setAttribute(&quot;style&quot;,&quot;display: flex&quot;);else&#123;t&#x3D;document.createElement(&quot;div&quot;),document.body.insertAdjacentElement(&quot;beforeend&quot;,t);t.setAttribute(&quot;class&quot;,&quot;tamper&quot;),t.setAttribute(&quot;id&quot;,&quot;zylist&quot;)&#125;e.videoData.pages.forEach(e&#x3D;&gt;&#123;o+&#x3D;u.sprintf(&#39;&lt;li name&#x3D;&quot;%1&quot;&gt;%2&lt;&#x2F;li&gt;&#39;,e.cid,z(e.page)+&quot; &quot;+e.part)&#125;),t.innerHTML&#x3D;o+&quot;&lt;&#x2F;ul&gt; &lt;&#x2F;div&gt;&quot;;x()&#125;if(e.mediaInfo)if(ipod.type&#x3D;&quot;anime&quot;,ipod.area&#x3D;__PGC_USERSTATE__.area_limit,ipod.url&#x3D;ipod.area?&quot;https:&#x2F;&#x2F;www.biliplus.com&#x2F;BPplayurl.php?aid&#x3D;%1&amp;cid&#x3D;%2&amp;qn&#x3D;116&amp;otype&#x3D;json&amp;module&#x3D;bangumi&quot;:&quot;https:&#x2F;&#x2F;api.bilibili.com&#x2F;pgc&#x2F;player&#x2F;web&#x2F;playurl?avid&#x3D;%1&amp;cid&#x3D;%2&amp;qn&#x3D;116&quot;,ipod.title&#x3D;e.mediaInfo.title,ipod.cover&#x3D;e.mediaInfo.cover,ipod.count&#x3D;ipod.len&#x3D;e.epList.length,1&#x3D;&#x3D;ipod.count)k(e.epList);else&#123;let o&#x3D;&#39;&lt;div&gt; &lt;div class&#x3D;&quot;btn-group full&quot;&gt; &lt;button name&#x3D;&quot;settings&quot;&gt; &lt;i class&#x3D;&quot;ion-settings&quot;&gt;&lt;&#x2F;i&gt; \u8bbe\u7f6e &lt;&#x2F;button&gt; &lt;button name&#x3D;&quot;all&quot;&gt; \u5168\u9009 &lt;&#x2F;button&gt; &lt;button name&#x3D;&quot;invert&quot;&gt; \u53cd\u9009 &lt;&#x2F;button&gt; &lt;button name&#x3D;&quot;download&quot;&gt; &lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u4e0b\u8f7d &lt;&#x2F;button&gt; &lt;&#x2F;div&gt; &lt;ul&gt;&#39;;if(t&#x3D;document.querySelector(&quot;#zylist&quot;))t.setAttribute(&quot;style&quot;,&quot;display: flex&quot;);else&#123;t&#x3D;document.createElement(&quot;div&quot;),document.body.insertAdjacentElement(&quot;beforeend&quot;,t);t.setAttribute(&quot;class&quot;,&quot;tamper&quot;),t.setAttribute(&quot;id&quot;,&quot;zylist&quot;)&#125;e.epList.forEach(e&#x3D;&gt;&#123;o+&#x3D;u.sprintf(&#39;&lt;li name&#x3D;&quot;%1&quot;&gt;%2&lt;&#x2F;li&gt;&#39;,e.cid,z(e.title)+&quot; &quot;+e.longTitle)&#125;),t.innerHTML&#x3D;o+&quot;&lt;&#x2F;ul&gt; &lt;&#x2F;div&gt;&quot;;x()&#125;&#125;&#125;function z(e)&#123;let t&#x3D;+e;return isNaN(t)&amp;&amp;(t&#x3D;0),(t&#x3D;&quot;000&quot;+t).substring(t.length-4)&#125;function S()&#123;document.head.insertAdjacentHTML(&quot;beforeend&quot;,&#39;&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;@font-face&#123;font-family:&quot;Ionicons&quot;;src:url(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;ionicons&#x2F;4.5.6&#x2F;fonts&#x2F;ionicons.eot?v&#x3D;4.5.5#iefix&quot;) format(&quot;embedded-opentype&quot;),url(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;ionicons&#x2F;4.5.6&#x2F;fonts&#x2F;ionicons.woff2?v&#x3D;4.5.5&quot;) format(&quot;woff2&quot;),url(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;ionicons&#x2F;4.5.6&#x2F;fonts&#x2F;ionicons.woff?v&#x3D;4.5.5&quot;) format(&quot;woff&quot;),url(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;ionicons&#x2F;4.5.6&#x2F;fonts&#x2F;ionicons.ttf?v&#x3D;4.5.5&quot;) format(&quot;truetype&quot;),url(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;ionicons&#x2F;4.5.6&#x2F;fonts&#x2F;ionicons.svg?v&#x3D;4.5.5#Ionicons&quot;) format(&quot;svg&quot;);font-weight:normal;font-style:normal&#125;i[class|&#x3D;ion]&#123;display:inline-block;font-family:&quot;Ionicons&quot;;font-size:120%;font-style:normal;font-variant:normal;font-weight:normal;line-height:1;text-rendering:auto;text-transform:none;vertical-align:text-bottom;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased&#125;.ion-android:before&#123;content:&quot;\\f225&quot;&#125;.ion-angular:before&#123;content:&quot;\\f227&quot;&#125;.ion-apple:before&#123;content:&quot;\\f229&quot;&#125;.ion-bitbucket:before&#123;content:&quot;\\f193&quot;&#125;.ion-bitcoin:before&#123;content:&quot;\\f22b&quot;&#125;.ion-buffer:before&#123;content:&quot;\\f22d&quot;&#125;.ion-chrome:before&#123;content:&quot;\\f22f&quot;&#125;.ion-closed-captioning:before&#123;content:&quot;\\f105&quot;&#125;.ion-codepen:before&#123;content:&quot;\\f230&quot;&#125;.ion-css3:before&#123;content:&quot;\\f231&quot;&#125;.ion-designernews:before&#123;content:&quot;\\f232&quot;&#125;.ion-dribbble:before&#123;content:&quot;\\f233&quot;&#125;.ion-dropbox:before&#123;content:&quot;\\f234&quot;&#125;.ion-euro:before&#123;content:&quot;\\f235&quot;&#125;.ion-facebook:before&#123;content:&quot;\\f236&quot;&#125;.ion-flickr:before&#123;content:&quot;\\f107&quot;&#125;.ion-foursquare:before&#123;content:&quot;\\f237&quot;&#125;.ion-freebsd-devil:before&#123;content:&quot;\\f238&quot;&#125;.ion-game-controller-a:before&#123;content:&quot;\\f13b&quot;&#125;.ion-game-controller-b:before&#123;content:&quot;\\f181&quot;&#125;.ion-github:before&#123;content:&quot;\\f239&quot;&#125;.ion-google:before&#123;content:&quot;\\f23a&quot;&#125;.ion-googleplus:before&#123;content:&quot;\\f23b&quot;&#125;.ion-hackernews:before&#123;content:&quot;\\f23c&quot;&#125;.ion-html5:before&#123;content:&quot;\\f23d&quot;&#125;.ion-instagram:before&#123;content:&quot;\\f23e&quot;&#125;.ion-ionic:before&#123;content:&quot;\\f150&quot;&#125;.ion-ionitron:before&#123;content:&quot;\\f151&quot;&#125;.ion-javascript:before&#123;content:&quot;\\f23f&quot;&#125;.ion-linkedin:before&#123;content:&quot;\\f240&quot;&#125;.ion-markdown:before&#123;content:&quot;\\f241&quot;&#125;.ion-model-s:before&#123;content:&quot;\\f153&quot;&#125;.ion-no-smoking:before&#123;content:&quot;\\f109&quot;&#125;.ion-nodejs:before&#123;content:&quot;\\f242&quot;&#125;.ion-npm:before&#123;content:&quot;\\f195&quot;&#125;.ion-octocat:before&#123;content:&quot;\\f243&quot;&#125;.ion-pinterest:before&#123;content:&quot;\\f244&quot;&#125;.ion-playstation:before&#123;content:&quot;\\f245&quot;&#125;.ion-polymer:before&#123;content:&quot;\\f15e&quot;&#125;.ion-python:before&#123;content:&quot;\\f246&quot;&#125;.ion-reddit:before&#123;content:&quot;\\f247&quot;&#125;.ion-rss:before&#123;content:&quot;\\f248&quot;&#125;.ion-sass:before&#123;content:&quot;\\f249&quot;&#125;.ion-skype:before&#123;content:&quot;\\f24a&quot;&#125;.ion-slack:before&#123;content:&quot;\\f10b&quot;&#125;.ion-snapchat:before&#123;content:&quot;\\f24b&quot;&#125;.ion-steam:before&#123;content:&quot;\\f24c&quot;&#125;.ion-tumblr:before&#123;content:&quot;\\f24d&quot;&#125;.ion-tux:before&#123;content:&quot;\\f2ae&quot;&#125;.ion-twitch:before&#123;content:&quot;\\f2af&quot;&#125;.ion-twitter:before&#123;content:&quot;\\f2b0&quot;&#125;.ion-usd:before&#123;content:&quot;\\f2b1&quot;&#125;.ion-vimeo:before&#123;content:&quot;\\f2c4&quot;&#125;.ion-vk:before&#123;content:&quot;\\f10d&quot;&#125;.ion-whatsapp:before&#123;content:&quot;\\f2c5&quot;&#125;.ion-windows:before&#123;content:&quot;\\f32f&quot;&#125;.ion-wordpress:before&#123;content:&quot;\\f330&quot;&#125;.ion-xbox:before&#123;content:&quot;\\f34c&quot;&#125;.ion-xing:before&#123;content:&quot;\\f10f&quot;&#125;.ion-yahoo:before&#123;content:&quot;\\f34d&quot;&#125;.ion-yen:before&#123;content:&quot;\\f34e&quot;&#125;.ion-youtube:before&#123;content:&quot;\\f34f&quot;&#125;.ion-add:before&#123;content:&quot;\\f273&quot;&#125;.ion-add-circle:before&#123;content:&quot;\\f272&quot;&#125;.ion-add-circle-outline:before&#123;content:&quot;\\f158&quot;&#125;.ion-airplane:before&#123;content:&quot;\\f15a&quot;&#125;.ion-alarm:before&#123;content:&quot;\\f274&quot;&#125;.ion-albums:before&#123;content:&quot;\\f275&quot;&#125;.ion-alert:before&#123;content:&quot;\\f276&quot;&#125;.ion-american-football:before&#123;content:&quot;\\f277&quot;&#125;.ion-analytics:before&#123;content:&quot;\\f278&quot;&#125;.ion-aperture:before&#123;content:&quot;\\f279&quot;&#125;.ion-apps:before&#123;content:&quot;\\f27a&quot;&#125;.ion-appstore:before&#123;content:&quot;\\f27b&quot;&#125;.ion-archive:before&#123;content:&quot;\\f27c&quot;&#125;.ion-arrow-back:before&#123;content:&quot;\\f27d&quot;&#125;.ion-arrow-down:before&#123;content:&quot;\\f27e&quot;&#125;.ion-arrow-dropdown:before&#123;content:&quot;\\f280&quot;&#125;.ion-arrow-dropdown-circle:before&#123;content:&quot;\\f27f&quot;&#125;.ion-arrow-dropleft:before&#123;content:&quot;\\f282&quot;&#125;.ion-arrow-dropleft-circle:before&#123;content:&quot;\\f281&quot;&#125;.ion-arrow-dropright:before&#123;content:&quot;\\f284&quot;&#125;.ion-arrow-dropright-circle:before&#123;content:&quot;\\f283&quot;&#125;.ion-arrow-dropup:before&#123;content:&quot;\\f286&quot;&#125;.ion-arrow-dropup-circle:before&#123;content:&quot;\\f285&quot;&#125;.ion-arrow-forward:before&#123;content:&quot;\\f287&quot;&#125;.ion-arrow-round-back:before&#123;content:&quot;\\f288&quot;&#125;.ion-arrow-round-down:before&#123;content:&quot;\\f289&quot;&#125;.ion-arrow-round-forward:before&#123;content:&quot;\\f28a&quot;&#125;.ion-arrow-round-up:before&#123;content:&quot;\\f28b&quot;&#125;.ion-arrow-up:before&#123;content:&quot;\\f28c&quot;&#125;.ion-at:before&#123;content:&quot;\\f28d&quot;&#125;.ion-attach:before&#123;content:&quot;\\f28e&quot;&#125;.ion-backspace:before&#123;content:&quot;\\f28f&quot;&#125;.ion-barcode:before&#123;content:&quot;\\f290&quot;&#125;.ion-baseball:before&#123;content:&quot;\\f291&quot;&#125;.ion-basket:before&#123;content:&quot;\\f292&quot;&#125;.ion-basketball:before&#123;content:&quot;\\f293&quot;&#125;.ion-battery-charging:before&#123;content:&quot;\\f294&quot;&#125;.ion-battery-dead:before&#123;content:&quot;\\f295&quot;&#125;.ion-battery-full:before&#123;content:&quot;\\f296&quot;&#125;.ion-beaker:before&#123;content:&quot;\\f297&quot;&#125;.ion-bed:before&#123;content:&quot;\\f160&quot;&#125;.ion-beer:before&#123;content:&quot;\\f298&quot;&#125;.ion-bicycle:before&#123;content:&quot;\\f299&quot;&#125;.ion-bluetooth:before&#123;content:&quot;\\f29a&quot;&#125;.ion-boat:before&#123;content:&quot;\\f29b&quot;&#125;.ion-body:before&#123;content:&quot;\\f29c&quot;&#125;.ion-bonfire:before&#123;content:&quot;\\f29d&quot;&#125;.ion-book:before&#123;content:&quot;\\f29e&quot;&#125;.ion-bookmark:before&#123;content:&quot;\\f29f&quot;&#125;.ion-bookmarks:before&#123;content:&quot;\\f2a0&quot;&#125;.ion-bowtie:before&#123;content:&quot;\\f2a1&quot;&#125;.ion-briefcase:before&#123;content:&quot;\\f2a2&quot;&#125;.ion-browsers:before&#123;content:&quot;\\f2a3&quot;&#125;.ion-brush:before&#123;content:&quot;\\f2a4&quot;&#125;.ion-bug:before&#123;content:&quot;\\f2a5&quot;&#125;.ion-build:before&#123;content:&quot;\\f2a6&quot;&#125;.ion-bulb:before&#123;content:&quot;\\f2a7&quot;&#125;.ion-bus:before&#123;content:&quot;\\f2a8&quot;&#125;.ion-business:before&#123;content:&quot;\\f1a4&quot;&#125;.ion-cafe:before&#123;content:&quot;\\f2a9&quot;&#125;.ion-calculator:before&#123;content:&quot;\\f2aa&quot;&#125;.ion-calendar:before&#123;content:&quot;\\f2ab&quot;&#125;.ion-call:before&#123;content:&quot;\\f2ac&quot;&#125;.ion-camera:before&#123;content:&quot;\\f2ad&quot;&#125;.ion-car:before&#123;content:&quot;\\f2b2&quot;&#125;.ion-card:before&#123;content:&quot;\\f2b3&quot;&#125;.ion-cart:before&#123;content:&quot;\\f2b4&quot;&#125;.ion-cash:before&#123;content:&quot;\\f2b5&quot;&#125;.ion-cellular:before&#123;content:&quot;\\f164&quot;&#125;.ion-chatboxes:before&#123;content:&quot;\\f2b6&quot;&#125;.ion-chatbubbles:before&#123;content:&quot;\\f2b7&quot;&#125;.ion-checkbox:before&#123;content:&quot;\\f2b9&quot;&#125;.ion-checkbox-outline:before&#123;content:&quot;\\f2b8&quot;&#125;.ion-checkmark:before&#123;content:&quot;\\f2bc&quot;&#125;.ion-checkmark-circle:before&#123;content:&quot;\\f2bb&quot;&#125;.ion-checkmark-circle-outline:before&#123;content:&quot;\\f2ba&quot;&#125;.ion-clipboard:before&#123;content:&quot;\\f2bd&quot;&#125;.ion-clock:before&#123;content:&quot;\\f2be&quot;&#125;.ion-close:before&#123;content:&quot;\\f2c0&quot;&#125;.ion-close-circle:before&#123;content:&quot;\\f2bf&quot;&#125;.ion-close-circle-outline:before&#123;content:&quot;\\f166&quot;&#125;.ion-cloud:before&#123;content:&quot;\\f2c9&quot;&#125;.ion-cloud-circle:before&#123;content:&quot;\\f2c2&quot;&#125;.ion-cloud-done:before&#123;content:&quot;\\f2c3&quot;&#125;.ion-cloud-download:before&#123;content:&quot;\\f2c6&quot;&#125;.ion-cloud-outline:before&#123;content:&quot;\\f2c7&quot;&#125;.ion-cloud-upload:before&#123;content:&quot;\\f2c8&quot;&#125;.ion-cloudy:before&#123;content:&quot;\\f2cb&quot;&#125;.ion-cloudy-night:before&#123;content:&quot;\\f2ca&quot;&#125;.ion-code:before&#123;content:&quot;\\f2ce&quot;&#125;.ion-code-download:before&#123;content:&quot;\\f2cc&quot;&#125;.ion-code-working:before&#123;content:&quot;\\f2cd&quot;&#125;.ion-cog:before&#123;content:&quot;\\f2cf&quot;&#125;.ion-color-fill:before&#123;content:&quot;\\f2d0&quot;&#125;.ion-color-filter:before&#123;content:&quot;\\f2d1&quot;&#125;.ion-color-palette:before&#123;content:&quot;\\f2d2&quot;&#125;.ion-color-wand:before&#123;content:&quot;\\f2d3&quot;&#125;.ion-compass:before&#123;content:&quot;\\f2d4&quot;&#125;.ion-construct:before&#123;content:&quot;\\f2d5&quot;&#125;.ion-contact:before&#123;content:&quot;\\f2d6&quot;&#125;.ion-contacts:before&#123;content:&quot;\\f2d7&quot;&#125;.ion-contract:before&#123;content:&quot;\\f2d8&quot;&#125;.ion-contrast:before&#123;content:&quot;\\f2d9&quot;&#125;.ion-copy:before&#123;content:&quot;\\f2da&quot;&#125;.ion-create:before&#123;content:&quot;\\f2db&quot;&#125;.ion-crop:before&#123;content:&quot;\\f2dc&quot;&#125;.ion-cube:before&#123;content:&quot;\\f2dd&quot;&#125;.ion-cut:before&#123;content:&quot;\\f2de&quot;&#125;.ion-desktop:before&#123;content:&quot;\\f2df&quot;&#125;.ion-disc:before&#123;content:&quot;\\f2e0&quot;&#125;.ion-document:before&#123;content:&quot;\\f2e1&quot;&#125;.ion-done-all:before&#123;content:&quot;\\f2e2&quot;&#125;.ion-download:before&#123;content:&quot;\\f2e3&quot;&#125;.ion-easel:before&#123;content:&quot;\\f2e4&quot;&#125;.ion-egg:before&#123;content:&quot;\\f2e5&quot;&#125;.ion-exit:before&#123;content:&quot;\\f2e6&quot;&#125;.ion-expand:before&#123;content:&quot;\\f2e7&quot;&#125;.ion-eye:before&#123;content:&quot;\\f2e9&quot;&#125;.ion-eye-off:before&#123;content:&quot;\\f2e8&quot;&#125;.ion-fastforward:before&#123;content:&quot;\\f2ea&quot;&#125;.ion-female:before&#123;content:&quot;\\f2eb&quot;&#125;.ion-filing:before&#123;content:&quot;\\f2ec&quot;&#125;.ion-film:before&#123;content:&quot;\\f2ed&quot;&#125;.ion-finger-print:before&#123;content:&quot;\\f2ee&quot;&#125;.ion-fitness:before&#123;content:&quot;\\f1ac&quot;&#125;.ion-flag:before&#123;content:&quot;\\f2ef&quot;&#125;.ion-flame:before&#123;content:&quot;\\f2f0&quot;&#125;.ion-flash:before&#123;content:&quot;\\f17e&quot;&#125;.ion-flash-off:before&#123;content:&quot;\\f12f&quot;&#125;.ion-flashlight:before&#123;content:&quot;\\f16b&quot;&#125;.ion-flask:before&#123;content:&quot;\\f2f2&quot;&#125;.ion-flower:before&#123;content:&quot;\\f2f3&quot;&#125;.ion-folder:before&#123;content:&quot;\\f2f5&quot;&#125;.ion-folder-open:before&#123;content:&quot;\\f2f4&quot;&#125;.ion-football:before&#123;content:&quot;\\f2f6&quot;&#125;.ion-funnel:before&#123;content:&quot;\\f2f7&quot;&#125;.ion-gift:before&#123;content:&quot;\\f199&quot;&#125;.ion-git-branch:before&#123;content:&quot;\\f2fa&quot;&#125;.ion-git-commit:before&#123;content:&quot;\\f2fb&quot;&#125;.ion-git-compare:before&#123;content:&quot;\\f2fc&quot;&#125;.ion-git-merge:before&#123;content:&quot;\\f2fd&quot;&#125;.ion-git-network:before&#123;content:&quot;\\f2fe&quot;&#125;.ion-git-pull-request:before&#123;content:&quot;\\f2ff&quot;&#125;.ion-glasses:before&#123;content:&quot;\\f300&quot;&#125;.ion-globe:before&#123;content:&quot;\\f301&quot;&#125;.ion-grid:before&#123;content:&quot;\\f302&quot;&#125;.ion-hammer:before&#123;content:&quot;\\f303&quot;&#125;.ion-hand:before&#123;content:&quot;\\f304&quot;&#125;.ion-happy:before&#123;content:&quot;\\f305&quot;&#125;.ion-headset:before&#123;content:&quot;\\f306&quot;&#125;.ion-heart:before&#123;content:&quot;\\f308&quot;&#125;.ion-heart-dislike:before&#123;content:&quot;\\f167&quot;&#125;.ion-heart-empty:before&#123;content:&quot;\\f1a1&quot;&#125;.ion-heart-half:before&#123;content:&quot;\\f1a2&quot;&#125;.ion-help:before&#123;content:&quot;\\f30b&quot;&#125;.ion-help-buoy:before&#123;content:&quot;\\f309&quot;&#125;.ion-help-circle:before&#123;content:&quot;\\f30a&quot;&#125;.ion-help-circle-outline:before&#123;content:&quot;\\f16d&quot;&#125;.ion-home:before&#123;content:&quot;\\f30c&quot;&#125;.ion-hourglass:before&#123;content:&quot;\\f111&quot;&#125;.ion-ice-cream:before&#123;content:&quot;\\f30d&quot;&#125;.ion-image:before&#123;content:&quot;\\f30e&quot;&#125;.ion-images:before&#123;content:&quot;\\f30f&quot;&#125;.ion-infinite:before&#123;content:&quot;\\f310&quot;&#125;.ion-information:before&#123;content:&quot;\\f312&quot;&#125;.ion-information-circle:before&#123;content:&quot;\\f311&quot;&#125;.ion-information-circle-outline:before&#123;content:&quot;\\f16f&quot;&#125;.ion-jet:before&#123;content:&quot;\\f315&quot;&#125;.ion-journal:before&#123;content:&quot;\\f18d&quot;&#125;.ion-key:before&#123;content:&quot;\\f316&quot;&#125;.ion-keypad:before&#123;content:&quot;\\f317&quot;&#125;.ion-laptop:before&#123;content:&quot;\\f318&quot;&#125;.ion-leaf:before&#123;content:&quot;\\f319&quot;&#125;.ion-link:before&#123;content:&quot;\\f22e&quot;&#125;.ion-list:before&#123;content:&quot;\\f31b&quot;&#125;.ion-list-box:before&#123;content:&quot;\\f31a&quot;&#125;.ion-locate:before&#123;content:&quot;\\f31c&quot;&#125;.ion-lock:before&#123;content:&quot;\\f31d&quot;&#125;.ion-log-in:before&#123;content:&quot;\\f31e&quot;&#125;.ion-log-out:before&#123;content:&quot;\\f31f&quot;&#125;.ion-magnet:before&#123;content:&quot;\\f320&quot;&#125;.ion-mail:before&#123;content:&quot;\\f322&quot;&#125;.ion-mail-open:before&#123;content:&quot;\\f321&quot;&#125;.ion-mail-unread:before&#123;content:&quot;\\f172&quot;&#125;.ion-male:before&#123;content:&quot;\\f323&quot;&#125;.ion-man:before&#123;content:&quot;\\f324&quot;&#125;.ion-map:before&#123;content:&quot;\\f325&quot;&#125;.ion-medal:before&#123;content:&quot;\\f326&quot;&#125;.ion-medical:before&#123;content:&quot;\\f327&quot;&#125;.ion-medkit:before&#123;content:&quot;\\f328&quot;&#125;.ion-megaphone:before&#123;content:&quot;\\f329&quot;&#125;.ion-menu:before&#123;content:&quot;\\f32a&quot;&#125;.ion-mic:before&#123;content:&quot;\\f32c&quot;&#125;.ion-mic-off:before&#123;content:&quot;\\f32b&quot;&#125;.ion-microphone:before&#123;content:&quot;\\f32d&quot;&#125;.ion-moon:before&#123;content:&quot;\\f32e&quot;&#125;.ion-more:before&#123;content:&quot;\\f1c9&quot;&#125;.ion-move:before&#123;content:&quot;\\f331&quot;&#125;.ion-musical-note:before&#123;content:&quot;\\f332&quot;&#125;.ion-musical-notes:before&#123;content:&quot;\\f333&quot;&#125;.ion-navigate:before&#123;content:&quot;\\f334&quot;&#125;.ion-notifications:before&#123;content:&quot;\\f338&quot;&#125;.ion-notifications-off:before&#123;content:&quot;\\f336&quot;&#125;.ion-notifications-outline:before&#123;content:&quot;\\f337&quot;&#125;.ion-nuclear:before&#123;content:&quot;\\f339&quot;&#125;.ion-nutrition:before&#123;content:&quot;\\f33a&quot;&#125;.ion-open:before&#123;content:&quot;\\f33b&quot;&#125;.ion-options:before&#123;content:&quot;\\f33c&quot;&#125;.ion-outlet:before&#123;content:&quot;\\f33d&quot;&#125;.ion-paper:before&#123;content:&quot;\\f33f&quot;&#125;.ion-paper-plane:before&#123;content:&quot;\\f33e&quot;&#125;.ion-partly-sunny:before&#123;content:&quot;\\f340&quot;&#125;.ion-pause:before&#123;content:&quot;\\f341&quot;&#125;.ion-paw:before&#123;content:&quot;\\f342&quot;&#125;.ion-people:before&#123;content:&quot;\\f343&quot;&#125;.ion-person:before&#123;content:&quot;\\f345&quot;&#125;.ion-person-add:before&#123;content:&quot;\\f344&quot;&#125;.ion-phone-landscape:before&#123;content:&quot;\\f346&quot;&#125;.ion-phone-portrait:before&#123;content:&quot;\\f347&quot;&#125;.ion-photos:before&#123;content:&quot;\\f348&quot;&#125;.ion-pie:before&#123;content:&quot;\\f349&quot;&#125;.ion-pin:before&#123;content:&quot;\\f34a&quot;&#125;.ion-pint:before&#123;content:&quot;\\f34b&quot;&#125;.ion-pizza:before&#123;content:&quot;\\f354&quot;&#125;.ion-planet:before&#123;content:&quot;\\f356&quot;&#125;.ion-play:before&#123;content:&quot;\\f357&quot;&#125;.ion-play-circle:before&#123;content:&quot;\\f174&quot;&#125;.ion-podium:before&#123;content:&quot;\\f358&quot;&#125;.ion-power:before&#123;content:&quot;\\f359&quot;&#125;.ion-pricetag:before&#123;content:&quot;\\f35a&quot;&#125;.ion-pricetags:before&#123;content:&quot;\\f35b&quot;&#125;.ion-print:before&#123;content:&quot;\\f35c&quot;&#125;.ion-pulse:before&#123;content:&quot;\\f35d&quot;&#125;.ion-qr-scanner:before&#123;content:&quot;\\f35e&quot;&#125;.ion-quote:before&#123;content:&quot;\\f35f&quot;&#125;.ion-radio:before&#123;content:&quot;\\f362&quot;&#125;.ion-radio-button-off:before&#123;content:&quot;\\f360&quot;&#125;.ion-radio-button-on:before&#123;content:&quot;\\f361&quot;&#125;.ion-rainy:before&#123;content:&quot;\\f363&quot;&#125;.ion-recording:before&#123;content:&quot;\\f364&quot;&#125;.ion-redo:before&#123;content:&quot;\\f365&quot;&#125;.ion-refresh:before&#123;content:&quot;\\f366&quot;&#125;.ion-refresh-circle:before&#123;content:&quot;\\f228&quot;&#125;.ion-remove:before&#123;content:&quot;\\f368&quot;&#125;.ion-remove-circle:before&#123;content:&quot;\\f367&quot;&#125;.ion-remove-circle-outline:before&#123;content:&quot;\\f176&quot;&#125;.ion-reorder:before&#123;content:&quot;\\f369&quot;&#125;.ion-repeat:before&#123;content:&quot;\\f36a&quot;&#125;.ion-resize:before&#123;content:&quot;\\f36b&quot;&#125;.ion-restaurant:before&#123;content:&quot;\\f36c&quot;&#125;.ion-return-left:before&#123;content:&quot;\\f36d&quot;&#125;.ion-return-right:before&#123;content:&quot;\\f36e&quot;&#125;.ion-reverse-camera:before&#123;content:&quot;\\f36f&quot;&#125;.ion-rewind:before&#123;content:&quot;\\f370&quot;&#125;.ion-ribbon:before&#123;content:&quot;\\f371&quot;&#125;.ion-rocket:before&#123;content:&quot;\\f179&quot;&#125;.ion-rose:before&#123;content:&quot;\\f372&quot;&#125;.ion-sad:before&#123;content:&quot;\\f373&quot;&#125;.ion-save:before&#123;content:&quot;\\f1a9&quot;&#125;.ion-school:before&#123;content:&quot;\\f374&quot;&#125;.ion-search:before&#123;content:&quot;\\f375&quot;&#125;.ion-send:before&#123;content:&quot;\\f376&quot;&#125;.ion-settings:before&#123;content:&quot;\\f377&quot;&#125;.ion-share:before&#123;content:&quot;\\f379&quot;&#125;.ion-share-alt:before&#123;content:&quot;\\f378&quot;&#125;.ion-shirt:before&#123;content:&quot;\\f37a&quot;&#125;.ion-shuffle:before&#123;content:&quot;\\f37b&quot;&#125;.ion-skip-backward:before&#123;content:&quot;\\f37c&quot;&#125;.ion-skip-forward:before&#123;content:&quot;\\f37d&quot;&#125;.ion-snow:before&#123;content:&quot;\\f37e&quot;&#125;.ion-speedometer:before&#123;content:&quot;\\f37f&quot;&#125;.ion-square:before&#123;content:&quot;\\f381&quot;&#125;.ion-square-outline:before&#123;content:&quot;\\f380&quot;&#125;.ion-star:before&#123;content:&quot;\\f384&quot;&#125;.ion-star-half:before&#123;content:&quot;\\f382&quot;&#125;.ion-star-outline:before&#123;content:&quot;\\f383&quot;&#125;.ion-stats:before&#123;content:&quot;\\f385&quot;&#125;.ion-stopwatch:before&#123;content:&quot;\\f386&quot;&#125;.ion-subway:before&#123;content:&quot;\\f387&quot;&#125;.ion-sunny:before&#123;content:&quot;\\f388&quot;&#125;.ion-swap:before&#123;content:&quot;\\f389&quot;&#125;.ion-switch:before&#123;content:&quot;\\f38a&quot;&#125;.ion-sync:before&#123;content:&quot;\\f38b&quot;&#125;.ion-tablet-landscape:before&#123;content:&quot;\\f38c&quot;&#125;.ion-tablet-portrait:before&#123;content:&quot;\\f38d&quot;&#125;.ion-tennisball:before&#123;content:&quot;\\f38e&quot;&#125;.ion-text:before&#123;content:&quot;\\f38f&quot;&#125;.ion-thermometer:before&#123;content:&quot;\\f390&quot;&#125;.ion-thumbs-down:before&#123;content:&quot;\\f391&quot;&#125;.ion-thumbs-up:before&#123;content:&quot;\\f392&quot;&#125;.ion-thunderstorm:before&#123;content:&quot;\\f393&quot;&#125;.ion-time:before&#123;content:&quot;\\f394&quot;&#125;.ion-timer:before&#123;content:&quot;\\f395&quot;&#125;.ion-today:before&#123;content:&quot;\\f17d&quot;&#125;.ion-train:before&#123;content:&quot;\\f396&quot;&#125;.ion-transgender:before&#123;content:&quot;\\f397&quot;&#125;.ion-trash:before&#123;content:&quot;\\f398&quot;&#125;.ion-trending-down:before&#123;content:&quot;\\f399&quot;&#125;.ion-trending-up:before&#123;content:&quot;\\f39a&quot;&#125;.ion-trophy:before&#123;content:&quot;\\f39b&quot;&#125;.ion-tv:before&#123;content:&quot;\\f17f&quot;&#125;.ion-umbrella:before&#123;content:&quot;\\f39c&quot;&#125;.ion-undo:before&#123;content:&quot;\\f39d&quot;&#125;.ion-unlock:before&#123;content:&quot;\\f39e&quot;&#125;.ion-videocam:before&#123;content:&quot;\\f39f&quot;&#125;.ion-volume-high:before&#123;content:&quot;\\f123&quot;&#125;.ion-volume-low:before&#123;content:&quot;\\f131&quot;&#125;.ion-volume-mute:before&#123;content:&quot;\\f3a1&quot;&#125;.ion-volume-off:before&#123;content:&quot;\\f3a2&quot;&#125;.ion-walk:before&#123;content:&quot;\\f3a4&quot;&#125;.ion-wallet:before&#123;content:&quot;\\f18f&quot;&#125;.ion-warning:before&#123;content:&quot;\\f3a5&quot;&#125;.ion-watch:before&#123;content:&quot;\\f3a6&quot;&#125;.ion-water:before&#123;content:&quot;\\f3a7&quot;&#125;.ion-wifi:before&#123;content:&quot;\\f3a8&quot;&#125;.ion-wine:before&#123;content:&quot;\\f3a9&quot;&#125;.ion-woman:before&#123;content:&quot;\\f3aa&quot;&#125;div.tamper&#123;color:#333;align-items:center;background-color:rgba(0,0,0,0.85);box-sizing:border-box;display:flex;font-size:14px !important;height:100%;justify-content:center;left:0;position:fixed;top:0;text-align:left;width:100%;z-index:900000&#125;div.tamper&gt;div&#123;background-color:white;box-sizing:border-box;padding:1em;width:360px&#125;div.tamper&gt;div.doc&#123;width:720px&#125;div.tamper h1&#123;font-size:1.8rem;font-weight:400;margin:10px 0 20px 0;text-align:center&#125;div.tamper form&#123;display:block&#125;div.tamper form&gt;div&#123;padding:.5em 0&#125;div.tamper form&gt;div&gt;div&#123;margin:.5em 0&#125;div.tamper form&gt;div&gt;div:last-child&#123;margin-bottom:0&#125;div.tamper form label:first-child&#123;display:block;margin-bottom:.5em&#125;div.tamper form label:first-child:before&#123;content:&quot;\\00bb&quot;;margin:0 .25em&#125;div.tamper form label:not(:first-child)&#123;display:inline&#125;div.tamper form input&#123;box-shadow:none&#125;div.tamper form input[type&#x3D;text]&#123;color:#000;background-color:#fff;border:1px solid #ddd;box-sizing:border-box;display:block;font-size:1em;padding:.5em;width:100%&#125;div.tamper form input[type&#x3D;text]:focus&#123;border:1px solid #59c1f0&#125;div.tamper form input[type&#x3D;password]&#123;color:#000;background-color:#fff;border:1px solid #ddd;box-sizing:border-box;display:block;font-size:1em;padding:.5em;width:100%&#125;div.tamper form input[type&#x3D;password]:focus&#123;border:1px solid #59c1f0&#125;div.tamper form input[type&#x3D;radio],div.tamper form input[type&#x3D;checkbox]&#123;display:inline-block !important;height:1em;margin-right:.25em;vertical-align:middle;width:1em&#125;div.tamper form input[type&#x3D;checkbox]&#123;-webkit-appearance:checkbox !important&#125;div.tamper form input[type&#x3D;radio]&#123;-webkit-appearance:radio !important&#125;div.tamper ul&#123;margin:.5em;padding:0;list-style-type:disc;list-style-position:inside;max-height:520px;overflow-y:auto;scrollbar-width:thin&#125;div.tamper ul&gt;li&#123;box-sizing:content-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:.25em 0;cursor:default&#125;div.tamper ul&gt;li.on&#123;color:#f45a8d&#125;div.summary&#123;color:#666&#125;div.btn-group&#123;box-sizing:border-box;display:inline-flex&#125;div.btn-group.full&#123;display:flex&#125;div.btn-group.outline&gt;button&#123;background-color:transparent;border:1px solid #ccc;color:#000&#125;div.btn-group.outline&gt;button:hover&#123;color:#ffffff;background-color:#000;border-color:#000&#125;div.btn-group.outline&gt;button:not(:first-child)&#123;border-left:none&#125;div.btn-group&gt;button&#123;background-color:#666;border-radius:0;border:none;color:#fff;display:inline-block;flex:1 1 auto;margin:0;outline:none;padding:.5em 1.25em;position:relative;font-size:inherit&#125;div.btn-group&gt;button:hover&#123;background-color:#000&#125;div.btn-group&gt;button:first-child&#123;border-bottom-left-radius:.25rem;border-top-left-radius:.25rem&#125;div.btn-group&gt;button:last-child&#123;border-bottom-right-radius:.25rem;border-top-right-radius:.25rem&#125;@keyframes spinner&#123;0%&#123;transform:rotate(0)&#125;100%&#123;transform:rotate(360deg)&#125;&#125;.spinner&#123;animation-name:spinner;animation-duration:1800ms;animation-timing-function:linear;animation-iteration-count:infinite&#125;&lt;&#x2F;tyle&gt;&#39;);let e,t&#x3D;location.host.split(&quot;.&quot;);while(t.length&gt;2)t.shift();switch(t.join(&quot;.&quot;))&#123;case&quot;baidu.com&quot;:e&#x3D;location.pathname.includes(&quot;&#x2F;s&#x2F;&quot;)?&#39;&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;#bd-main&gt;div.bd-aside&#123;display:none !important&#125;#bd-main&gt;div.bd-left&#123;margin:10px auto !important&#125;#hd,#layoutHeader,#web-right-view,#layoutAside&#123;display:none !important&#125;#bd&#123;width:960px;min-width:960px;margin:10px auto !important&#125;#layoutApp&gt;.frame-main&#123;max-width:720px;margin-top:15px&#125;#layoutApp&gt;.frame-main&gt;.frame-content&#123;margin:0&#125;div.frame-all&#123;background-color:#444&#125;div.x-button-box&gt;a.g-button&#123;display:none&#125;div.x-button-box&gt;a.g-button[data-button-id&#x3D;b1]&#123;display:inline-block&#125;&lt;&#x2F;style&gt;&#39;:&#39;&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;dd[node-type~&#x3D;header-apps]&#123;margin-right:120px !important&#125;&lt;&#x2F;style&gt;&#39;;break;case&quot;bilibili.com&quot;:e&#x3D;&#39;&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;#videoList&#123;display:flex;flex-wrap:wrap;list-style:none;margin-top:10px;width:100%&#125;#videoList&gt;li&#123;border-radius:.25em;border:1px solid #ddd;cursor:default;display:inline-block;flex:initial initial auto;margin:4px 2px;padding:.5em 1.25em;text-align:center&#125;#videoList&gt;li:hover&#123;background-color:#555;border-color:#555;color:#fff&#125;&lt;&#x2F;style&gt;&#39;&#125;document.head.insertAdjacentHTML(&quot;beforeend&quot;,e)&#125;function A()&#123;if(document.querySelector(&quot;#zyset&quot;))ipod.aria2&amp;&amp;u.zform(&quot;#zyset input&quot;,ipod.aria2),document.querySelector(&quot;#zyset&quot;).setAttribute(&quot;style&quot;,&quot;display: flex&quot;);else&#123;let e,t&#x3D;location.host.split(&quot;.&quot;);while(t.length&gt;2)t.shift();switch(t.join(&quot;.&quot;))&#123;case&quot;bilibili.com&quot;:e&#x3D;&#39;&lt;div class&#x3D;&quot;tamper&quot; id&#x3D;&quot;zyset&quot;&gt; &lt;div&gt; &lt;h1&gt;Aria2\u4e0b\u8f7d\u52a9\u624b&lt;&#x2F;h1&gt; &lt;form&gt; &lt;input name&#x3D;&quot;version&quot; type&#x3D;&quot;hidden&quot; value&#x3D;&quot;20191120&quot;&gt; &lt;div&gt; &lt;label&gt;\u5e38\u89c4\u8bbe\u7f6e&lt;&#x2F;label&gt; &lt;div&gt; &lt;input name&#x3D;&quot;getlink&quot; type&#x3D;&quot;checkbox&quot; value&#x3D;&quot;1&quot;&gt; &lt;label&gt;\u4ec5\u63d0\u53d6\u89c6\u9891\u7684\u4e0b\u8f7d\u5730\u5740\uff0c\u7c98\u8d34\u5230idm\u4e2d\u4f7f\u7528&lt;&#x2F;label&gt;&lt;br&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;input name&#x3D;&quot;cover&quot; type&#x3D;&quot;checkbox&quot; value&#x3D;&quot;1&quot;&gt; &lt;label&gt;\u4e0b\u8f7d\u89c6\u9891\u6216\u63d0\u53d6\u94fe\u63a5\u5305\u542b\u5c01\u9762\u56fe\u7247&lt;&#x2F;label&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;input name&#x3D;&quot;danmaku&quot; type&#x3D;&quot;checkbox&quot; value&#x3D;&quot;1&quot;&gt; &lt;label&gt;\u64ad\u653e\u89c6\u9891\u65f6\u9ed8\u8ba4\u5173\u95ed\u5f39\u5e55&lt;&#x2F;label&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e aria2 jsonrpc&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;jsonrpc&quot; type&#x3D;&quot;text&quot;&gt; &lt;div class&#x3D;&quot;summary&quot;&gt; \u63a8\u8350\u4f7f\u7528\u914d\u5957\u7684 &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1eCDe2M6pLnukDhGAnJNasg&quot; target&#x3D;&quot;_blank&quot;&gt;Aria2&lt;&#x2F;a&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e aria2 \u8bbf\u95ee\u53e3\u4ee4&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;token&quot; type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;\u6ca1\u6709\u53e3\u4ee4\u5219\u4e0d\u8981\u586b\u5199&quot;&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e\u89c6\u9891\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;video&quot; type&#x3D;&quot;text&quot;&gt; &lt;div class&#x3D;&quot;summary&quot;&gt; \u8bf7\u4f7f\u7528\u5de6\u659c\u6760\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u5141\u8bb8\u4e2d\u6587\u5b57\u7b26\u3002 &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e\u756a\u5267\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;anime&quot; type&#x3D;&quot;text&quot;&gt; &lt;div class&#x3D;&quot;summary&quot;&gt; \u76ee\u524d\u4e0d\u80fd\u4e0b\u8f7d\u4ec5\u9650\u5927\u4f1a\u5458\u89c2\u770b\u7684\u6e2f\u6fb3\u53f0\u756a\u5267 &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;btn-group&quot;&gt; &lt;button type&#x3D;&quot;submit&quot;&gt; &lt;i class&#x3D;&quot;ion-checkmark&quot;&gt;&lt;&#x2F;i&gt; \u786e\u5b9a &lt;&#x2F;button&gt; &lt;button type&#x3D;&quot;button&quot;&gt; &lt;i class&#x3D;&quot;ion-close&quot;&gt;&lt;&#x2F;i&gt; \u53d6\u6d88 &lt;&#x2F;button&gt; &lt;&#x2F;div&gt; &lt;&#x2F;form&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt;&#39;;break;default:e&#x3D;&#39;&lt;div class&#x3D;&quot;tamper&quot; id&#x3D;&quot;zyset&quot;&gt; &lt;div&gt; &lt;h1&gt;Aria2\u4e0b\u8f7d\u52a9\u624b&lt;&#x2F;h1&gt; &lt;form&gt; &lt;input name&#x3D;&quot;version&quot; type&#x3D;&quot;hidden&quot; value&#x3D;&quot;20200106&quot;&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e aria2 jsonrpc&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;jsonrpc&quot; type&#x3D;&quot;text&quot;&gt; &lt;div class&#x3D;&quot;summary&quot;&gt; \u63a8\u8350\u4f7f\u7528\u914d\u5957\u7684 &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1eCDe2M6pLnukDhGAnJNasg&quot; target&#x3D;&quot;_blank&quot;&gt;Aria2&lt;&#x2F;a&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e aria2 \u8bbf\u95ee\u53e3\u4ee4&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;token&quot; type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;\u6ca1\u6709\u53e3\u4ee4\u5219\u4e0d\u8981\u586b\u5199&quot;&gt; &lt;&#x2F;div&gt; &lt;div&gt; &lt;label&gt;\u8bbe\u7f6e\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84&lt;&#x2F;label&gt; &lt;input name&#x3D;&quot;dir&quot; type&#x3D;&quot;text&quot;&gt; &lt;div class&#x3D;&quot;summary&quot;&gt; \u8bf7\u4f7f\u7528\u5de6\u659c\u6760\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u8def\u5f84\u4e2d\u53ef\u4ee5\u6709\u4e2d\u6587 &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;btn-group&quot;&gt; &lt;button type&#x3D;&quot;submit&quot;&gt;&lt;i class&#x3D;&quot;ion-checkmark&quot;&gt;&lt;&#x2F;i&gt; \u786e\u5b9a&lt;&#x2F;button&gt; &lt;button type&#x3D;&quot;button&quot;&gt;&lt;i class&#x3D;&quot;ion-close&quot;&gt;&lt;&#x2F;i&gt; \u53d6\u6d88&lt;&#x2F;button&gt; &lt;&#x2F;div&gt; &lt;&#x2F;form&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt;&#39;&#125;document.body.insertAdjacentHTML(&quot;beforeend&quot;,e),console.log(ipod.aria2);ipod.aria2&amp;&amp;u.zform(&quot;#zyset input&quot;,ipod.aria2),document.querySelector(&quot;#zyset button[type&#x3D;button]&quot;).addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;u.zdom(),document.querySelector(&quot;#zyset&quot;).setAttribute(&quot;style&quot;,&quot;display: none&quot;)&#125;);document.querySelector(&quot;#zyset form&quot;).addEventListener(&quot;submit&quot;,()&#x3D;&gt;&#123;let e&#x3D;&#123;&#125;,t&#x3D;u.zdom(),o&#x3D;new FormData(t);for(let t of o.entries())e[t[0]]&#x3D;t[1];ipod.aria2&#x3D;Object.assign(ipod.defaults,e),u.save(&quot;aria2&quot;,ipod.aria2);document.querySelector(&quot;#zyset&quot;).setAttribute(&quot;style&quot;,&quot;display: none&quot;)&#125;)&#125;&#125;let j;if(location.host.includes(&quot;bilibili.com&quot;))&#123;if(S(),ipod.header&#x3D;[&quot;Referer: &quot;+location.href],ipod.header2&#x3D;&#123;Referer:location.href&#125;,ipod.defaults&#x3D;&#123;token:&quot;&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;,getlink:0,cover:0,danmaku:0,video:&quot;D:&#x2F;bilibili&#x2F;video&quot;,anime:&quot;D:&#x2F;bilibili&#x2F;anime&quot;&#125;,ipod.aria2&#x3D;u.load(&quot;aria2&quot;),null!&#x3D;ipod.aria2&amp;&amp;&quot;20191120&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),&quot;live.bilibili.com&quot;&#x3D;&#x3D;location.host||A()),&quot;live.bilibili.com&quot;&#x3D;&#x3D;location.host&amp;&amp;parseInt(location.pathname.substring(1))&amp;&amp;(f(),setInterval(()&#x3D;&gt;&#123;f()&#125;,9e5)),&quot;www.bilibili.com&quot;&#x3D;&#x3D;location.host)&#123;history.pushState&#x3D;u.history(&quot;pushState&quot;),window.addEventListener(&quot;pushState&quot;,f);location.pathname.startsWith(&quot;&#x2F;video&#x2F;&quot;)&amp;&amp;(ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(&quot;function&quot;&#x3D;&#x3D;typeof jQuery&amp;&amp;document.querySelector(&quot;div.ops&quot;)&amp;&amp;&quot;--&quot;!&#x3D;document.querySelector(&quot;div.ops&gt;span.coin&quot;).innerText.replace(&#x2F;\s+&#x2F;g,&quot;&quot;)&amp;&amp;(clearInterval(ipod.task),ipod.task&#x3D;0,f(),$(&quot;div.ops&quot;).first().prepend(&#39;&lt;span id&#x3D;&quot;zydl&quot; title&#x3D;&quot;\u4e0b\u8f7d&quot;&gt;&lt;i class&#x3D;&quot;van-icon-download&quot;&gt;&lt;&#x2F;i&gt;\u4e0b\u8f7d&lt;&#x2F;span&gt;&#39;),$(&#39;&lt;div class&#x3D;&quot;appeal-text&quot;&gt;Aria2\u8bbe\u7f6e&lt;&#x2F;div&gt;&#39;).on(&quot;click&quot;,A).appendTo($(&quot;#arc_toolbar_report&quot;)),$(&quot;#zydl&quot;).on(&quot;click&quot;,_),ipod.aria2.danmaku))&#123;p(),history.pushState&#x3D;u.history(&quot;pushState&quot;);window.addEventListener(&quot;pushState&quot;,p)&#125;&#125;,1e3)),location.pathname.startsWith(&quot;&#x2F;bangumi&#x2F;play&#x2F;&quot;)&amp;&amp;(ipod.task&#x3D;setInterval(()&#x3D;&gt;&#123;if(&quot;function&quot;&#x3D;&#x3D;typeof jQuery&amp;&amp;document.querySelector(&quot;#toolbar_module&quot;)&amp;&amp;&quot;--&quot;!&#x3D;document.querySelector(&quot;#toolbar_module&gt;div.coin-info&quot;).innerText.replace(&#x2F;\s+&#x2F;g,&quot;&quot;))if(clearInterval(ipod.task),ipod.task&#x3D;0,$(&quot;#toolbar_module&quot;).prepend(&#39;&lt;div id&#x3D;&quot;zydl&quot; class&#x3D;&quot;coin-info&quot;&gt;&lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt;&lt;span&gt;\u4e0b\u8f7d&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&#39;),$(&quot;#zydl&quot;).on(&quot;click&quot;,_),__PGC_USERSTATE__.area_limit)&#123;let e&#x3D;__INITIAL_STATE__;ipod.aid&#x3D;e.epInfo.aid,ipod.cid&#x3D;e.epInfo.cid;ipod.url&#x3D;&quot;https:&#x2F;&#x2F;www.biliplus.com&#x2F;BPplayurl.php?aid&#x3D;%1&amp;cid&#x3D;%2&amp;qn&#x3D;116&amp;otype&#x3D;json&amp;module&#x3D;bangumi&quot;,$.getScript(&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;flv.js&#x2F;1.5.0&#x2F;flv.min.js&quot;,()&#x3D;&gt;&#123;document.querySelector(&quot;#bofqi&quot;).insertAdjacentHTML(&quot;beforeend&quot;,&#39;&lt;video id&#x3D;&quot;bplayer&quot; width&#x3D;&quot;100%&quot; height&#x3D;&quot;100%&quot; controls&gt;&lt;&#x2F;video&gt;&#39;),$(&quot;#player_mask_module, div.limit_area_wrap&quot;).remove();m()&#125;);let t&#x3D;&#39;&lt;ul id&#x3D;&quot;videoList&quot;&gt;&#39;;e.epList.forEach((e,o)&#x3D;&gt;&#123;t+&#x3D;u.sprintf(&#39;&lt;li data-aid&#x3D;&quot;%1&quot; data-cid&#x3D;&quot;%2&quot;&gt;%3&lt;&#x2F;li&gt;&#39;,e.aid,e.cid,z(o+1))&#125;),t+&#x3D;&quot;&lt;&#x2F;ul&gt;&quot;;document.querySelector(&quot;#player_module&quot;).insertAdjacentHTML(&quot;afterend&quot;,t),$(&quot;#videoList &gt; li&quot;).on(&quot;click&quot;,h)&#125;else if(ipod.aria2.danmaku)&#123;p(),f();history.replaceState&#x3D;u.history(&quot;replaceState&quot;),window.addEventListener(&quot;replaceState&quot;,p)&#125;&#125;,1e3))&#125;if(&quot;space.bilibili.com&quot;&#x3D;&#x3D;location.host)&#123;history.pushState&#x3D;u.history(&quot;pushState&quot;),window.addEventListener(&quot;pushState&quot;,b);b()&#125;if(&quot;search.bilibili.com&quot;&#x3D;&#x3D;location.host)&#123;history.pushState&#x3D;u.history(&quot;pushState&quot;),window.addEventListener(&quot;pushState&quot;,d);d()&#125;&#125;if(location.host.includes(&quot;baidu.com&quot;))switch(ipod.header&#x3D;[&quot;User-Agent: netdisk&quot;],ipod.defaults&#x3D;&#123;token:&quot;&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6801&#x2F;jsonrpc&quot;,dir:&quot;E:&#x2F;netdisk&quot;&#125;,location.pathname)&#123;case&quot;&#x2F;share&#x2F;init&quot;:location.hash?(document.querySelector(&quot;input&quot;).value&#x3D;location.hash.substring(1,5),document.querySelector(&quot;a.g-button-blue-large&quot;).click()):GM_xmlhttpRequest(&#123;url:&quot;https:&#x2F;&#x2F;search.pandown.cn&#x2F;api&#x2F;query?surl&#x3D;1&quot;+location.search.substring(6),method:&quot;GET&quot;,onload(e)&#123;let t&#x3D;JSON.parse(e.responseText);0&#x3D;&#x3D;t.code&amp;&amp;(document.querySelector(&quot;input&quot;).value&#x3D;t.data[0].password,document.querySelector(&quot;a.g-button-blue-large&quot;).click())&#125;&#125;);break;case&quot;&#x2F;disk&#x2F;home&quot;:S(),ipod.aria2&#x3D;u.load(&quot;aria2&quot;);null!&#x3D;ipod.aria2&amp;&amp;&quot;20200106&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),A());let e&#x3D;setInterval(()&#x3D;&gt;&#123;&quot;function&quot;&#x3D;&#x3D;typeof jQuery&amp;&amp;(clearInterval(e),location.hash.startsWith(&quot;#&#x2F;all&quot;)&amp;&amp;GM_cookie.list(&#123;&#125;,e&#x3D;&gt;&#123;let t&#x3D;[&quot;BDUSS&quot;,&quot;STOKEN&quot;],o&#x3D;[];if(e.forEach(e&#x3D;&gt;&#123;t.includes(e.name)&amp;&amp;o.push(e.name+&quot;&#x3D;&quot;+e.value)&#125;),o.length)&#123;ipod.cookie&#x3D;o.join(&quot;;&quot;),$(&quot;a.g-button[data-button-id&#x3D;b5]&quot;).remove();$(&quot;div.QDDOQB&quot;).removeClass(&quot;QDDOQB&quot;).addClass(&quot;btn-group outline&quot;).css(&quot;font-size&quot;,&quot;12.5px&quot;).empty().append(&#39;&lt;button name&#x3D;&quot;zyset&quot;&gt;&lt;i class&#x3D;&quot;ion-settings&quot;&gt;&lt;&#x2F;i&gt; \u8bbe\u7f6e &lt;&#x2F;button&gt;&lt;button name&#x3D;&quot;zydl&quot;&gt;&lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u7ebf\u8def1 &lt;&#x2F;button&gt;&lt;button name&#x3D;&quot;zydl2&quot;&gt;&lt;i class&#x3D;&quot;ion-download&quot;&gt;&lt;&#x2F;i&gt; \u7ebf\u8def2 &lt;&#x2F;button&gt;&lt;button name&#x3D;&quot;zyshare&quot;&gt;&lt;i class&#x3D;&quot;ion-share&quot;&gt;&lt;&#x2F;i&gt; \u514d\u5bc6\u5206\u4eab &lt;&#x2F;button&gt;&#39;).on(&quot;click&quot;,()&#x3D;&gt;&#123;let e&#x3D;u.zdom(1);while(!e.hasAttribute(&quot;name&quot;))e&#x3D;e.parentElement;switch(e.getAttribute(&quot;name&quot;))&#123;case&quot;zyset&quot;:A();break;case&quot;zydl&quot;:ipod.mode&#x3D;1,ipod.btn&#x3D;e.children[0];ipod.btn.setAttribute(&quot;class&quot;,&quot;ion-refresh spinner&quot;),l();break;case&quot;zydl2&quot;:ipod.mode&#x3D;2,ipod.btn&#x3D;e.children[0];ipod.btn.setAttribute(&quot;class&quot;,&quot;ion-refresh spinner&quot;),l();break;case&quot;zyshare&quot;:e.children[0].setAttribute(&quot;class&quot;,&quot;ion-refresh spinner&quot;),(()&#x3D;&gt;&#123;let e&#x3D;&#123;schannel:0,channel_list:&quot;[]&quot;,period:0,fid_list:JSON.stringify((()&#x3D;&gt;&#123;let e&#x3D;[],t&#x3D;a(r());return console.clear(),console.log(&quot;fileList &#x3D;&quot;,t.length),$(&quot;dd.g-clearfix&quot;).each((o,n)&#x3D;&gt;&#123;if(3&#x3D;&#x3D;n.getAttribute(&quot;class&quot;).replace(&quot; open-enable&quot;,&quot;&quot;).trim().split(&quot; &quot;).length)&#123;let o&#x3D;decodeURIComponent($(n).find(&quot;a&quot;).first().text());t.forEach(t&#x3D;&gt;&#123;o&#x3D;&#x3D;t.server_filename&amp;&amp;e.push(t.fs_id)&#125;)&#125;&#125;),console.log(&quot;selectedList &#x3D;&quot;,e.length),e&#125;)())&#125;;$.ajax(&#123;url:&quot;https:&#x2F;&#x2F;pan.baidu.com&#x2F;share&#x2F;set&quot;,method:&quot;POST&quot;,data:u.serialize(e),success(e)&#123;$(&quot;div.btn-group.outline &gt; button[name&#x3D;zyshare] &gt; i&quot;).attr(&quot;class&quot;,&quot;ion-share&quot;),0&#x3D;&#x3D;e.errno?GM_setClipboard(e.link,&quot;text&quot;):alert(&quot;\u64cd\u4f5c\u5931\u8d25&quot;)&#125;&#125;)&#125;)()&#125;&#125;)&#125;&#125;))&#125;,1e3);break;default:S();let t&#x3D;document.querySelector(&quot;#bd &gt; div.bd-aside&quot;);t&amp;&amp;t.setAttribute(&quot;style&quot;,&quot;display: none&quot;)&#125;if(location.host.includes(&quot;wallhaven.cc&quot;))&#123;S(),ipod.defaults&#x3D;&#123;token:&quot;&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;,dir:&quot;E:&#x2F;\u56fe\u7247&#x2F;temp&quot;,pi:&quot;1&quot;,extype:&quot;.jpg&quot;&#125;;ipod.aria2&#x3D;u.load(&quot;aria2&quot;),null!&#x3D;ipod.aria2&amp;&amp;&quot;20200106&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),A());let e&#x3D;document.querySelector(&quot;#thumbs&quot;);e&amp;&amp;e.addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;let e&#x3D;u.zdom(1);fetch(e.getAttribute(&quot;href&quot;)).then(e&#x3D;&gt;e.text()).then(e&#x3D;&gt;&#123;let t&#x3D;e.match(&#x2F;&lt;img id&#x3D;&quot;wallpaper&quot; src&#x3D;&quot;(.+?)&quot;&#x2F;);u.download(t[1])&#125;)&#125;)&#125;if(location.host.includes(&quot;nyaa&quot;))&#123;switch(S(),function()&#123;$(&quot;#navFilter-category&quot;).find(&quot;.btn&quot;).each((e,t)&#x3D;&gt;&#123;t.setAttribute(&quot;style&quot;,&quot;background-color:#fff; color:#333; font-size: 14px&quot;)&#125;),$(&quot;#navFilter-category&quot;).next(&quot;input&quot;).on(&quot;focus&quot;,function()&#123;this.value&#x3D;&quot;&quot;&#125;);$(&quot;i.fa-download&quot;).each((e,t)&#x3D;&gt;&#123;t.parentElement.remove()&#125;),$(&quot;i.fa-magnet&quot;).each((e,t)&#x3D;&gt;&#123;t.setAttribute(&quot;data-url&quot;,t.parentElement.getAttribute(&quot;href&quot;)),t.addEventListener(&quot;click&quot;,i,!1);t.parentElement.removeAttribute(&quot;href&quot;),t.parentElement.setAttribute(&quot;style&quot;,&quot;cursor: default&quot;)&#125;);$(&quot;a[title],a[rel~&#x3D;nofollow]&quot;).each((e,t)&#x3D;&gt;&#123;t.setAttribute(&quot;style&quot;,&quot;cursor: default&quot;),t.setAttribute(&quot;target&quot;,&quot;_blank&quot;)&#125;)&#125;(),ipod.defaults&#x3D;&#123;dir:&quot;E:&#x2F;netdisk&#x2F;bt&quot;,pi:&quot;1&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;&#125;,ipod.aria2&#x3D;u.load(&quot;aria2&quot;),null!&#x3D;ipod.aria2&amp;&amp;&quot;20191120&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),A()),location.host)&#123;case&quot;nyaa.fun&quot;:$(&quot;#navbar&quot;).children(&quot;ul&quot;).first().empty().append(&#39;&lt;li&gt;&lt;a id&#x3D;&quot;czyset&quot; href&#x3D;&quot;#&quot;&gt;Aria2\u8bbe\u7f6e&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_1_1_k_0&quot;&gt;\u52a8\u6f2b&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_1_3_k_0&quot;&gt;\u6e38\u620f&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_1_4_k_0&quot;&gt;\u6f2b\u753b&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_1_5_k_0&quot;&gt;\u56fe\u7247&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_2_6_k_0&quot;&gt;\u5199\u771f&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;search&#x2F;c_2_7_k_0&quot;&gt;\u89c6\u9891&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;);break;case&quot;nyaa.mlyx.workers.dev&quot;:case&quot;nyaa.si&quot;:$(&quot;#navbar&quot;).children(&quot;ul&quot;).first().empty().append(&#39;&lt;li&gt;&lt;a id&#x3D;&quot;czyset&quot; href&#x3D;&quot;#&quot;&gt;Aria2\u8bbe\u7f6e&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_3&quot;&gt;Anime&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_1&quot;&gt;AMV&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;2_0&quot;&gt;Audio&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;5_1&quot;&gt;Graphic&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;5_2&quot;&gt;Photo&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;6_1&quot;&gt;App&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;6_2&quot;&gt;Game&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;);break;case&quot;sukebei.nyaa.si&quot;:$(&quot;#navbar&quot;).children(&quot;ul&quot;).first().empty().append(&#39;&lt;li&gt;&lt;a id&#x3D;&quot;czyset&quot; href&#x3D;&quot;#&quot;&gt;Aria2\u8bbe\u7f6e&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_1&quot;&gt;\u52a8\u6f2b&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_3&quot;&gt;\u6e38\u620f&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_4&quot;&gt;\u6f2b\u753b&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_5&quot;&gt;\u56fe\u7247&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;1_2&quot;&gt;\u540c\u4eba&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;2_1&quot;&gt;\u5199\u771f&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;&#x2F;?c&#x3D;2_2&quot;&gt;\u89c6\u9891&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; &lt;li&gt;&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;nyaa.si&quot;&gt;nyaa&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;)&#125;document.querySelector(&quot;#czyset&quot;).addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;u.zdom(),A()&#125;,!1)&#125;if(location.host.includes(&quot;acg.rip&quot;))&#123;S(),ipod.defaults&#x3D;&#123;dir:&quot;E:&#x2F;netdisk&#x2F;bt&quot;,pi:&quot;1&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;&#125;;ipod.aria2&#x3D;u.load(&quot;aria2&quot;),null!&#x3D;ipod.aria2&amp;&amp;&quot;20191120&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),A());history.pushState&#x3D;u.history(&quot;pushState&quot;),window.addEventListener(&quot;pushState&quot;,o);o()&#125;if(location.host.includes(&quot;konachan&quot;))&#123;let e,t,o;if(S(),ipod.defaults&#x3D;&#123;token:&quot;&quot;,jsonrpc:&quot;http:&#x2F;&#x2F;127.0.0.1:6800&#x2F;jsonrpc&quot;,dir:&quot;E:&#x2F;\u56fe\u7247&#x2F;temp&quot;,pi:&quot;1&quot;,extype:&quot;.jpg&quot;&#125;,ipod.aria2&#x3D;u.load(&quot;aria2&quot;),null!&#x3D;ipod.aria2&amp;&amp;&quot;20200106&quot;&#x3D;&#x3D;ipod.aria2.version||(ipod.aria2&#x3D;Object.assign(ipod.defaults),A()),&quot;&#x2F;post&quot;&#x3D;&#x3D;location.pathname)&#123;if(&quot;&quot;&#x3D;&#x3D;(e&#x3D;location.search))return void(location.search&#x3D;&quot;?tags&#x3D;limit%3A56&quot;);if(-1&#x3D;&#x3D;e.indexOf(&quot;limit&quot;))return e&#x3D;e.replace(&#x2F;\++&#x2F;g,&quot;+&quot;).replace(&#x2F;\+$&#x2F;,&quot;&quot;),void(location.search&#x3D;e+&quot;+limit%3A56&quot;);for(document.querySelector(&quot;#site-title&quot;).children[1].remove(),document.querySelector(&quot;#post-list-posts&quot;).addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;u.download(u.zdom(1).getAttribute(&quot;data-url&quot;))&#125;,!1),t&#x3D;(e&#x3D;document.querySelector(&quot;#tags&quot;)).value?e.value.replace(&quot;rating:safe&quot;,&quot;&quot;).replace(&quot;limit:56&quot;,&quot;&quot;).replace(&#x2F;\s+&#x2F;,&quot; &quot;):&quot;&quot;,e.value&#x3D;&quot; &quot;&#x3D;&#x3D;t?&quot;&quot;:t,e&#x3D;document.querySelectorAll(&quot;a.thumb&quot;),t&#x3D;document.querySelectorAll(&quot;a.directlink&quot;),o&#x3D;0;e.length&gt;o;o++)e[o].setAttribute(&quot;style&quot;,&quot;cursor: default&quot;),e[o].children[0].setAttribute(&quot;data-url&quot;,t[o].getAttribute(&quot;href&quot;))&#125;&#125;&#125;();</span><br></pre></td></tr></table></figure><br>è¿˜éœ€è®¾ç½®Tempermonkeyæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/Snipaste_2020-02-02_20-35-59.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/Snipaste_2020-02-02_20-36-24.jpg" alt></p>
<h2 id="4-Pandownload"><a href="#4-Pandownload" class="headerlink" title="4. Pandownload"></a>4. Pandownload</h2><p>Pandownloadå¯ä»¥è¯´æ˜¯å¤§åé¼é¼çš„ç™¾åº¦äº‘ä¸‹è½½å™¨äº†ï¼Œä½†å‰æ®µæ—¶é—´ç™¾åº¦ç½‘ç›˜çš„æ•´æ”¹ï¼Œä¸€åº¦è¢«å°ï¼Œæœ€è¿‘å®˜ç½‘åˆå‘å¸ƒäº†æ–°çš„ç‰ˆæœ¬ï¼Œæ¢å¤äº†ä¸‹è½½ï¼Œä½†æˆ‘ä½“éªŒèµ·æ¥ä»ä¸ç¨³å®šï¼Œä¸”æœ‰é™é€Ÿçš„é£é™©ï¼Œæˆ‘ä¸æ¨èç”¨è¿™ä¸ªï¼Œä¸çŸ¥é“åç»­æ›´æ–°å¦‚ä½•ï¼Œè¿™é‡Œè´´å‡ºå®ƒçš„<a href="http://pandownload.com/" target="_blank" rel="noopener">å®˜æ–¹ç½‘ç«™</a>ã€‚</p>
<h2 id="5-çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­"><a href="#5-çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­" class="headerlink" title="5. çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­"></a>5. çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­</h2><p>çˆ±å¥‡è‰ºä½œä¸ºç™¾åº¦ç³»ä¸‹çš„äº§å“ï¼Œå…¶åº”ç”¨å•†åº—æä¾›çš„ä¸‡èƒ½è”æ’­ä¸‹è½½å™¨ï¼Œå¯ä»¥è®¿é—®ç™¾åº¦ç½‘ç›˜ä¸‹è½½ï¼Œä¸”ä¸ä»…é’ˆå¯¹è§†é¢‘ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰åŠ é€Ÿæ•ˆæœï¼Œä½†å¹¶ä¸éƒ½æ˜¯å…¨éƒ¨ï¼Œä¸”é™é€Ÿ3Mï¼Œä½†æ¯”èµ·ç™¾åº¦è‡ªèº«é™é€Ÿ100kè¦å¥½å¾—å¤šï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒç”¨ç¬¬ä¸‰æ–¹å°å·çš„å±é™©ã€‚<br><a href="http://store.iqiyi.com/" target="_blank" rel="noopener">å®˜ç½‘åœ°å€</a></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/baiduwp/Snipaste_2020-02-09_19-30-07.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>ç™¾åº¦ç½‘ç›˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorchå¿«é€Ÿå®‰è£…æ•™ç¨‹</title>
    <url>/2020/01/26/Pytorch%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>è¿›å…¥<a href="https://pytorch.org/" target="_blank" rel="noopener">å®˜ç½‘</a>ï¼ŒæŒ‰ç…§ä½ çš„ç¯å¢ƒé€‰æ‹©ï¼Œå¾—åˆ°ä¸‹è½½å‘½ä»¤ï¼Œè¿™é‡Œä»¥windowsä¸ºä¾‹ï¼ŒUbuntuåŒç†</p>
<h2 id="condaå®‰è£…"><a href="#condaå®‰è£…" class="headerlink" title="condaå®‰è£…"></a>condaå®‰è£…</h2><p>å®˜ç½‘å¾—åˆ°å‘½ä»¤å¦‚å›¾ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pytorch%20install/Snipaste_2020-01-26_14-06-32.jpg" alt><br>ä½†ç”±äºå¢™çš„åŸå› ç›´æ¥ä½¿ç”¨æ­¤å‘½ä»¤ä¸‹è½½å¾ˆæ…¢ï¼Œå› æ­¤è¯·æ›´æ¢condaæºä¸ºå›½å†…é•œåƒ<br>å¹¶å°†å‘½ä»¤ä¸­ -c pytorchå»æ‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">conda install pytorch torchvision cudatoolkit&#x3D;10.1</span><br></pre></td></tr></table></figure><br>å³å¯è°ƒç”¨å›½å†…é•œåƒä¸‹è½½ã€‚</p>
<h2 id="pipå®‰è£…"><a href="#pipå®‰è£…" class="headerlink" title="pipå®‰è£…"></a>pipå®‰è£…</h2><p>å®˜ç½‘å¾—åˆ°å‘½ä»¤å¦‚å›¾ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pytorch%20install/Snipaste_2020-01-26_14-06-05.jpg" alt><br>çº¢è‰²æ¡†å‡ºéƒ¨åˆ†ä¸ºå®˜ç½‘å»ºè®®ç‰ˆæœ¬ï¼Œä½†ç”±äºå¢™çš„åŸå› ç›´æ¥ä½¿ç”¨æ­¤å‘½ä»¤ä¸‹è½½å¾ˆæ…¢ï¼Œå› æ­¤å°†pipä¸‹è½½åœ°å€æ”¹æˆå›½å†…é•œåƒå³å¯<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install torch&#x3D;&#x3D;&#x3D;1.4.0 torchvision&#x3D;&#x3D;&#x3D;0.5.0 -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾ç½®Pycharm plotsä¸åœ¨tool windowæ˜¾ç¤º</title>
    <url>/2020/01/26/%E8%AE%BE%E7%BD%AEPycharm-plots%E4%B8%8D%E5%9C%A8tool-window%E6%98%BE%E7%A4%BA/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>Pycharmç”»å›¾é»˜è®¤åœ¨tool windowsæ˜¾ç¤ºï¼Œå¯¹äºè§‚çœ‹ã€æ“ä½œå…¶æä¸æ–¹ä¾¿ï¼Œç‰¹åˆ«æ˜¯ç”»åŠ¨æ€å›¾æ—¶ï¼Œè¿˜ä¼šæŠŠæ¯å¸§éƒ½è¾“å‡ºï¼Œå› æ­¤æœ€å¥½è®¾ç½®è®©å®ƒå•ç‹¬çª—å£æ˜¾ç¤ºã€‚<br>å¦‚ä¸‹å›¾ï¼ŒæŠŠå‹¾å»æ‰å³å¯ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/plot/Snipaste_2020-01-26_14-14-13.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pycharm</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntué…ç½®SSHå’ŒXshellè¿æ¥æœåŠ¡å™¨çš„æ•™ç¨‹</title>
    <url>/2020/01/26/Ubuntu%E9%85%8D%E7%BD%AESSH%E5%92%8CXshell%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>SSHåˆ†ä¸ºå®¢æˆ·ç«¯ openssh-client å’ŒæœåŠ¡å™¨ openssh-serverï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤ç¡®è®¤ç”µè„‘<br>ä¸Šæ˜¯å¦å®‰è£…äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚å¦‚æœåªæ˜¯æƒ³è¿œç¨‹ç™»é™†åˆ«çš„æœºå™¨åªéœ€è¦å®‰è£…å®¢æˆ·ç«¯ï¼ˆUbuntué»˜è®¤å®‰è£…äº†å®¢æˆ·ç«¯ï¼‰ï¼Œå¦‚æœè¦æœ¬æœºçš„SSHæœåŠ¡å°±éœ€è¦å®‰è£…æœåŠ¡å™¨ã€‚<br>é¦–å…ˆç¡®è®¤ssh-serveræ˜¯å¦å·²ç»å¯åŠ¨äº†ï¼Œä¸‹é¢æ˜¯å·²ç»å¯åŠ¨è¿‡äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -l | grep ssh</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161410.jpg" alt><br>å®¢æˆ·ç«¯ openssh-client å’ŒæœåŠ¡å™¨ openssh-serverå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-client</span><br><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161511.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161512.jpg" alt><br>æŸ¥çœ‹ç½‘å¡å¯¹åº”çš„æœåŠ¡å™¨IPåœ°å€å’Œç”¨æˆ·å<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifconfig | grep inet</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161513.jpg" alt><br>è¿œç¨‹ç™»å½•å’Œå¤åˆ¶æ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬è¿›å…¥Xshellè¾“å…¥å‘½ä»¤ã€‚<br>é¦–å…ˆç™»é™†Xshellï¼Œæ–°å»ºä¼šè¯ï¼Œç‚¹å‡»è¿æ¥ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161614.jpg" alt><br>è¾“å…¥ç™»é™†æœåŠ¡å™¨IPï¼ˆåˆšæ‰æŸ¥å¾—çš„ï¼‰ï¼Œç«¯å£22ï¼ˆé»˜è®¤ï¼‰ï¼Œé€‰æ‹©åè®®SSHã€‚ä¹‹åç¡®è®¤å’Œè¿æ¥ï¼Œ<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161615.jpg" alt><br>é¦–æ¬¡ç™»é™†éœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥è¿›å»ä½ Ubuntuçš„ç”¨æˆ·åå’Œå¯†ç ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161617.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161718.jpg" alt><br>æŸ¥çœ‹ä¿¡æ¯æ˜¯å¦è¿æ¥ï¼Œè¿›å…¥æœåŠ¡å™¨ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/SSH/2019111014161719.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>SSH</tag>
        <tag>Xshell</tag>
      </tags>
  </entry>
  <entry>
    <title>Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨å¹¶å®ç°è¿œç¨‹è°ƒè¯•</title>
    <url>/2020/01/26/Pycharm%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<h2 id="Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨"><a href="#Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨"></a><a id="more"></a>Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨</h2><ul>
<li>è¿›å…¥é…ç½®é¡µé¢<br>Pycharmèœå•æ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¾æ¬¡ç‚¹å‡» Tools -&gt; Deployment -&gt; Configrationâ€¦<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161124726.png" alt></li>
<li>é…ç½®è¿æ¥æœåŠ¡å™¨<br>å¦‚ä¸‹å›¾ã€‚nameéšä¾¿å†™ä¸ªå°±è¡Œã€‚<br>Connectionä¸‹ï¼Œåè®®æœ€å¥½é€‰æ‹©sftpï¼Œæ¥ä¸‹æ¥å¡«å†™æœåŠ¡å™¨ä¸»æœºIPï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/2018082916114659.png" alt><br>ç‚¹å‡»Test SFTP connectionä¼šå‘ç°ï¼Œå¦‚æœè¿æ¥æˆåŠŸä¼šæç¤ºä½ å¦‚ä¸‹<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161158768.png" alt><br>åœ¨Mappingä¸‹ï¼Œé€‰æ‹©è¿æ¥windowsä¸‹çš„é‚£éƒ¨åˆ†ä»£ç å’ŒæœåŠ¡å™¨ä¸Šä»£ç ç›¸è¿ï¼Œæœ¬åœ°Local pathï¼ŒæœåŠ¡å™¨pathï¼Œapplyï¼ŒOKï¼Œè¡¨ç¤ºå·²ç»æŠŠæœ¬åœ°çš„ä»£ç å’ŒæœåŠ¡å™¨ä»£ç è¿æ¥ä¸Šäº†ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161217756.png" alt></li>
<li>ä¸Šä¼ ä»£ç ï¼Œä½¿å¾—æœ¬åœ°ä»£ç å’ŒæœåŠ¡å™¨ä»£ç ä¿æŒåŒæ­¥<br>ç‚¹å‡»Upload to nameï¼ˆåˆšæ‰å¡«å†™çš„è¿œç¨‹æœåŠ¡å™¨åå­—ï¼‰ï¼Œå³å¯ä¸Šä¼ ä»£ç ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161235445.png" alt><br>è‹¥é…ç½®æœ‰å¤šä¸ªä¸åŒæœåŠ¡å™¨æˆ–åŒä¸€ä¸ªæœåŠ¡å™¨é…ç½®äº†å¤šä¸ª æœåŠ¡å™¨ä¸Šä¼ è·¯å¾„ï¼ˆDeployment Pathï¼‰ï¼Œå¯é€‰æ‹© Upload toâ€¦ï¼Œä¸Šä¼ åˆ°ä¸åŒçš„æœåŠ¡å™¨/è·¯å¾„ã€‚</li>
</ul>
<h2 id="é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨"><a href="#é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨" class="headerlink" title="é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨"></a>é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨</h2><p>ä½¿ç”¨æœåŠ¡å™¨è°ƒè¯•Pythonç¨‹åºçš„å‰ææ—¶åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…äº†Pythonè§£é‡Šå™¨ï¼Œå¦‚æœæ²¡å®‰è£…ï¼Œè¯·å…ˆå®‰è£…ã€‚</p>
<ul>
<li>å°†Pythonè§£é‡Šå™¨è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„<br>åœ¨èœå•æ ï¼ŒFile -&gt; Settingsâ€¦ -&gt; Project Ã—Ã— -&gt; Project Interpreterï¼Œç‚¹å‡»å³ä¾§ AddæŒ‰é’®ï¼Œæ·»åŠ è§£é‡Šå™¨ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161249360.png" alt><br>é€‰æ‹©SSH Interpreterï¼Œå¡«å†™æœåŠ¡å™¨çš„ Host åœ°å€ï¼Œç«¯å£Portï¼Œç”¨æˆ·åUsernameï¼Œå¡«å¥½åï¼Œä¸‹ä¸€æ­¥Nextã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161306837.png" alt><br>å¡«å†™å¯†ç  Passwordï¼Œä¸‹ä¸€æ­¥Nextã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161340812.png" alt><br>é€‰æ‹©è¿œç¨‹æœåŠ¡å™¨ä¸ŠPythonè§£é‡Šå™¨çš„ä½ç½®ï¼ŒæœåŠ¡å™¨ä¸Šçš„è¿œç¨‹åŒæ­¥æ–‡ä»¶å¤¹Sync foldersï¼ˆå³ä¹‹å‰é…ç½®çš„æœåŠ¡å™¨Pathï¼‰ï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªã€‚å¦‚æœä¸çŸ¥é“Pythonå®‰è£…åœ¨å“ªï¼Œå¯ä»¥è¿œç¨‹è¿æ¥æœåŠ¡å™¨åï¼Œä½¿ç”¨ å‘½ä»¤ which python æ‰¾åˆ°Pythonå®‰è£…ä½ç½®ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm%20remote%20control/20180829161653972.jpg" alt><br>Finishï¼Œé…ç½®ç»“æŸã€‚è¯¥é¡¹ç›®ç°åœ¨ä½¿ç”¨çš„å°±æ˜¯è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„Pythonè§£é‡Šå™¨äº†ã€‚ä»¥åçš„é¡¹ç›®è‹¥æƒ³/ä¸æƒ³ä½¿ç”¨è¯¥è§£é‡Šå™¨ï¼Œæ‰‹åŠ¨æ›´æ”¹è§£é‡Šå™¨å³å¯ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº"><a href="#ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº" class="headerlink" title="ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº"></a>ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº</h2><p>å°†æµ‹è¯•ä»£ç ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ï¼ˆTooles -&gt; Deployment -&gt; Upload to Ã—Ã—ï¼‰ã€‚<br>Runæµ‹è¯•ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨ä»£ç æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œäº†ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pycharm</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹Rimeå®‰è£…é…ç½®</title>
    <url>/2020/01/26/Ubuntu%E4%B8%8BRime%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>å®˜æ–¹ç½‘ç«™åŠæ–‡æ¡£ï¼š<a href="https://rime.im/" target="_blank" rel="noopener">https://rime.im/</a><br>è¾“å…¥æ³•å¹³å°ï¼šiBus<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install ibus-rime</span><br></pre></td></tr></table></figure><br>åœ¨è®¾ç½®äººåŒºåŸŸå’Œè¯­è¨€é€‰æ‹©è®¾ç½®è¾“å…¥æ³•ä¸ºRime<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/rime/1762213-d899b160aa87f944.png" alt><br>æ ¹æ®ä¸ªäººå–œå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šä¸€èˆ¬ç”¨æˆ·ç›´æ¥ä¿®æ”¹default.yamlå³å¯ã€‚ä¿®æ”¹å‰æœ€å¥½å¤‡ä»½ä¸€ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">~&#x2F;.config&#x2F;ibus&#x2F;rime&#x2F;default.yaml</span><br><span class="line"></span><br><span class="line">schema_list:   </span><br><span class="line">  - schema: luna_pinyin_simp #simpæ˜¯ç®€ä½“ï¼Œç¬¬ä¸€ä½æ˜¯é»˜è®¤è¾“å…¥æ³• </span><br><span class="line">menu:</span><br><span class="line">  page_size: 9 #æ¯é¡µå€™é€‰è¯ä¸ªæ•°</span><br><span class="line">ascii_composer:</span><br><span class="line">  switch_key:</span><br><span class="line">    Shift_L: commit_code #å·¦shiftæäº¤å­—æ¯</span><br></pre></td></tr></table></figure><br>é‡å¯ibus-deamon<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ibus restart</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>arxivæ–‡ç« ä¸‹è½½åŠ é€Ÿ</title>
    <url>/2020/01/26/arxiv%E6%96%87%E7%AB%A0%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>å¯¹äºæˆ‘ä»¬è¿™æ ·çš„æ·±åº¦å­¦ä¹ å±Œä¸æ¥è¯´ï¼Œæ²¡é’±ï¼Œæ²¡èµ„æºï¼Œæ²¡æ•°æ®ï¼Œæ²¡æ—¶é—´ï¼Œåªèƒ½çœ‹çœ‹åˆ«äººçš„è®ºæ–‡ç”Ÿå­˜äº†ï¼Œç»å¸¸ä¼šåˆ°arxivä¸Šä¸‹è½½ä¸€äº›æ–‡ç« ï¼Œæ¯”å¦‚cvprçš„æ–‡ç« ï¼Œä½†æ˜¯ï¼Œç”±äºå›½å†…å°é”ï¼Œä¸‹è½½å¾ˆæ…¢ï¼Œç”šè‡³æ¥è¿å‡ å¤©æ‰“ä¸å¼€arxivçš„ç½‘ç«™ï¼Œå’‹åŠï¼Ÿ<br>å¼ºçƒˆæ¨èä½¿ç”¨ä¸­ç§‘é™¢arxivçš„é•œåƒåœ°å€ï¼š<a href="http://xxx.itp.ac.cn" target="_blank" rel="noopener">http://xxx.itp.ac.cn</a><br>å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼šæŠŠè¦è®¿é—® arxiv é“¾æ¥ä¸­çš„åŸŸåä» <a href="https://arxiv.org" target="_blank" rel="noopener">https://arxiv.org</a> æ¢æˆ <a href="http://xxx.itp.ac.cn" target="_blank" rel="noopener">http://xxx.itp.ac.cn</a> ,<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¯”å¦‚:</span><br><span class="line">https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;1608.00367</span><br><span class="line">æ¢æˆï¼š</span><br><span class="line">http:&#x2F;&#x2F;xxx.itp.ac.cn&#x2F;pdf&#x2F;1608.00367.pdf</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ–è€…å°†ï¼š</span><br><span class="line">https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;1608.00367</span><br><span class="line">æ¢æˆï¼š</span><br><span class="line">http:&#x2F;&#x2F;xxx.itp.ac.cn&#x2F;abs&#x2F;1608.00367</span><br></pre></td></tr></table></figure><br>å³å¯æ‰“å¼€ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿ</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>arxiv</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu16.04å®‰è£…opencvæ•™ç¨‹</title>
    <url>/2020/01/19/ubuntu16.04%E5%AE%89%E8%A3%85opencv%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>1.å»å®˜ç½‘ä¸‹è½½opencvï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­é€‰ç”¨çš„æ˜¯opencv3.4.1ï¼Œå…¶ä»–ç‰ˆæœ¬çš„é…ç½®æ–¹æ³•å¼‚æ›²åŒå·¥ã€‚<br><a href="http://opencv.org/releases.html" target="_blank" rel="noopener">ä¸‹è½½é“¾æ¥</a>ï¼Œé€‰æ‹©sourcesç‰ˆæœ¬<br>2.è§£å‹ä¸‹è½½ä¸‹æ¥çš„zipåŒ…<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unzip opencv-3.4.1.zip</span><br></pre></td></tr></table></figure><br>3.è¿›å…¥åˆ°è§£å‹åçš„æ–‡ä»¶åŒ…ä¸­<br>4.å®‰è£…ä¾èµ–åº“å’Œcmake ï¼Œå¦‚æœæé†’éœ€è¦apt-get updateï¼Œé‚£å°±å…ˆsudo suè¿›å…¥rootæƒé™ï¼Œå†sudo apt-get updateï¼Œç„¶ååœ¨æ‰§è¡Œä¸‹é¢å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install cmake</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libtiff4.dev libswscale-dev libjasper-dev</span><br></pre></td></tr></table></figure><br>åœ¨ç¬¬äºŒæ­¥ä¸­è‹¥æç¤ºä¾èµ–ç‰ˆæœ¬é—®é¢˜ï¼ŒåŸå› åœ¨äºaptæºå¤ªæ—§ï¼Œæ›´æ¢æ–°çš„æºï¼Œå†è¿›è¡Œå®‰è£…ã€‚<br>5.å®‰è£…å®Œcmakeä¹‹åæ‰§è¡Œå‘½ä»¤ ,åˆ›å»ºç¼–è¯‘æ–‡ä»¶å¤¹ï¼Œä¸åˆ›å»ºçš„ä¼šæç¤ºï¼ˆå¦‚ä¸‹å›¾ï¼‰<br>In-source builds are not allowed.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir my_build_dir</span><br><span class="line">cd my_build_dir</span><br></pre></td></tr></table></figure><br>6.cmakeä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmake -D CMAKE_BUILD_TYPE&#x3D;Release -D CMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local ..</span><br></pre></td></tr></table></figure><br>æ³¨æ„ï¼šå¦‚æœå·²ç»åœ¨æ–°çš„æ–‡ä»¶å¤¹ä¸­ç¼–è¯‘ï¼Œä½†æ˜¯è¿˜ä¼šå‡ºç°ä¹‹å‰çš„æŠ¥é”™ï¼ŒæŠŠcmakecache.txtåˆ äº†å†ç¼–è¯‘å°±å¯<br>æœŸé—´å¯èƒ½ä¼šä¸‹è½½ä¸€ä¸ªä¸œè¥¿ï¼Œç­‰å¾…ä¸€ä¼šå„¿å°±OK<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/opencv/20171005220631735.png" alt><br>7.æ‰§è¡Œå‘½ä»¤ï¼Œæ¼«é•¿çš„ç¼–è¯‘è¿‡ç¨‹<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo make</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/opencv/20171005214720292.png" alt><br>8.æ‰§è¡Œå‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo make install</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/opencv/20171005214847504.png" alt><br>9.sudo make install æ‰§è¡Œå®Œæ¯•åOpenCVç¼–è¯‘è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦é…ç½®ä¸€äº›OpenCVçš„ç¼–è¯‘ç¯å¢ƒé¦–å…ˆå°†OpenCVçš„åº“æ·»åŠ åˆ°è·¯å¾„ï¼Œä»è€Œå¯ä»¥è®©ç³»ç»Ÿæ‰¾åˆ°<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;ld.so.conf.d&#x2F;opencv.conf</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œæ­¤å‘½ä»¤åæ‰“å¼€çš„å¯èƒ½æ˜¯ä¸€ä¸ªç©ºç™½çš„æ–‡ä»¶ï¼Œä¸ç”¨ç®¡ï¼Œåªéœ€è¦åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ <br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;lib</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/opencv/20171005215009149.png" alt><br>10.æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿å¾—åˆšæ‰çš„é…ç½®è·¯å¾„ç”Ÿæ•ˆ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure><br>11.é…ç½®bash<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;bash.bashrc</span><br></pre></td></tr></table></figure><br>åœ¨æœ€æœ«å°¾æ·»åŠ <br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PKG_CONFIG_PATH&#x3D;$PKG_CONFIG_PATH:&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig  </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure><br>ä¿å­˜ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿å¾—é…ç½®ç”Ÿæ•ˆ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;bash.bashrc</span><br></pre></td></tr></table></figure><br>æ›´æ–°<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo updatedb</span><br></pre></td></tr></table></figure><br>12.è‡³æ­¤æ‰€æœ‰çš„é…ç½®éƒ½å·²ç»å®Œæˆ<br>ä¸‹é¢ç”¨ä¸€ä¸ªå°ç¨‹åºæµ‹è¯•ä¸€ä¸‹</p>
<p>æ‰¾åˆ°<br>cdåˆ°opencv-3.4.1/samples/cpp/example_cmakeç›®å½•ä¸‹<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç›®å½•é‡Œå®˜æ–¹å·²ç»ç»™å‡ºäº†ä¸€ä¸ªcmakeçš„exampleæˆ‘ä»¬å¯ä»¥æ‹¿æ¥æµ‹è¯•ä¸‹<br>æŒ‰é¡ºåºæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">.&#x2F;opencv_example</span><br></pre></td></tr></table></figure><br>å³å¯çœ‹åˆ°æ‰“å¼€äº†æ‘„åƒå¤´ï¼Œåœ¨å·¦ä¸Šè§’æœ‰ä¸€ä¸ªhello opencv<br>å³è¡¨ç¤ºé…ç½®æˆåŠŸ</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Opencv</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuå¿«é€Ÿæ­å»ºC++å¼€å‘ç¯å¢ƒï¼ˆVS Codeç¼–è¾‘å™¨ï¼‰</title>
    <url>/2020/01/19/Ubuntu%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAC++%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%88VS-Code%E7%BC%96%E8%BE%91%E5%99%A8%EF%BC%89/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>ä»¥ä¸‹å®‰è£…çš„æ˜¯g++-8ï¼ˆç›®å‰æœ€æ–°ï¼‰å’ŒVisual Studio Codeï¼Œæ­¤æ–¹æ³•é€‚ç”¨äºUbuntu 14.04 64ä½ã€Ubuntu 16.04 32ä½/64ä½ã€Ubuntu 18.04ï¼ŒUbuntu 14.04 32ä½åŠä»¥ä¸‹ç³»ç»Ÿæ— æ•ˆã€‚æ‰“å¼€ç»ˆç«¯å¹¶ä¸”è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚</p>
<h2 id="å®‰è£…g-8"><a href="#å®‰è£…g-8" class="headerlink" title="å®‰è£…g++-8"></a>å®‰è£…g++-8</h2><ul>
<li>å®‰è£…software-properties-commonï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install software-properties-common</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ PPAåˆ°åº“å¹¶æ›´æ–°ï¼ˆä¼šæç¤ºæŒ‰å›è½¦ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶æŒ‰å›è½¦å³å¯ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-toolchain-r&#x2F;test</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°è½¯ä»¶ä¿¡æ¯ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…g++ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install g++-8</span><br></pre></td></tr></table></figure></li>
<li>å°†g++æŒ‡å‘g++-8ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ln -sf &#x2F;usr&#x2F;bin&#x2F;g++-8 &#x2F;usr&#x2F;bin&#x2F;g++</span><br></pre></td></tr></table></figure></li>
<li>æ˜¾ç¤ºg++ç‰ˆæœ¬å·ï¼Œå¦‚æœæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·æ„å‘³ç€å®‰è£…æˆåŠŸï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">g++ --version</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…Visual-Studio-Code"><a href="#å®‰è£…Visual-Studio-Code" class="headerlink" title="å®‰è£…Visual Studio Code"></a>å®‰è£…Visual Studio Code</h2></li>
<li>å®‰è£…libgconfåº“ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y libgconf-2-4</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…gitï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install git</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ PPAåˆ°åº“å¹¶æ›´æ–°ï¼ˆä¼šæç¤ºæŒ‰å›è½¦ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶æŒ‰å›è½¦å³å¯ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-desktop&#x2F;ubuntu-make</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°è½¯ä»¶ä¿¡æ¯ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ubuntu-makeï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install ubuntu-make</span><br></pre></td></tr></table></figure></li>
<li>é€šè¿‡ubuntu-makeå®‰è£…Visual Studio Codeï¼›è¿‡ç¨‹ä¸­ä¼šè¯¢é—®å®‰è£…è·¯å¾„ï¼Œæ­¤æ—¶ä¸éœ€è¦ä¿®æ”¹ç›´æ¥æŒ‰å›è½¦å³å¯ï¼›ç„¶åä¼šè¯¢é—®æ˜¯å¦æ¥å—åè®®ï¼Œæ­¤æ—¶è¾“å…¥aç„¶åå›è½¦å³å¯ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo umake ide visual-studio-code</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºè½¯é“¾æ¥åˆ°ç¨‹åºç›®å½•ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ln -sf &#96;env | grep ^HOME&#x3D; | cut -c 6-&#96;&#x2F;.local&#x2F;share&#x2F;umake&#x2F;ide&#x2F;visual-studio-code&#x2F;bin&#x2F;code &#x2F;usr&#x2F;bin&#x2F;code</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé¡¹ç›®ç›®å½•ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir ~&#x2F;Projects</span><br></pre></td></tr></table></figure></li>
<li>æ˜¾ç¤ºVisual Studio Codeç‰ˆæœ¬å·ï¼Œå¦‚æœæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·æ„å‘³ç€å®‰è£…æˆåŠŸï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code --version</span><br></pre></td></tr></table></figure></li>
<li>è¿è¡ŒVS Codeï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼š<br>1.æŒ‰ä¸‹é”®ç›˜Ctrl+Shift+X<br>2.åœ¨è¾“å…¥æ¡†é‡Œè¾“å…¥Chinese<br>3.æŒ‰ä¸‹ä¸­æ–‡(ç®€ä½“)åé¢çš„install<br>4.å®‰è£…å®ŒåæŒ‰ä¸‹Ctrl+Shift+Pæ‰“å¼€å‘½ä»¤é¢æ¿<br>5.è¾“å…¥configåé€‰æ‹©é…ç½®è¯­è¨€å‘½ä»¤<br>6.é€‰æ‹©Configure Display Language<br>7.å°†â€localeâ€:â€enâ€æ”¹æˆâ€localeâ€: â€œzh-cnâ€ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜Ctrl+Sä¿å­˜æºæ–‡ä»¶<br>8.å…³é—­VS Code<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-047109e9a0a075af.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-8c9880935d6bcbe8.png" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-43717f65ac98f10e.png" alt><h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªC-é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªC-é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š"></a>åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š</h2></li>
<li>åˆ›å»ºé¡¹ç›®ç›®å½•cppdemoï¼Œç”¨äºå­¦ä¹ åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼Œå¹¶è¿›å…¥cppdemoç›®å½•ä¸­ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir ~&#x2F;Projects&#x2F;cppdemo &amp;&amp; cd ~&#x2F;Projects&#x2F;cppdemo</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé…ç½®ç›®å½•ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir .&#x2F;.vscode</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt; .vscode&#x2F;tasks.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;2.0.0&quot;,</span><br><span class="line">    &quot;tasks&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;label&quot;: &quot;build&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;shell&quot;,</span><br><span class="line">            &quot;command&quot;: &quot;g++&quot;,</span><br><span class="line">            &quot;args&quot;: [</span><br><span class="line">                &quot;-std&#x3D;c++17&quot;,</span><br><span class="line">                &quot;-Wall&quot;,</span><br><span class="line">                &quot;-Wextra&quot;,</span><br><span class="line">                &quot;-g&quot;,</span><br><span class="line">                &quot;-ggdb&quot;,</span><br><span class="line">                &quot;mycpp.cpp&quot;,</span><br><span class="line">                &quot;-o&quot;,</span><br><span class="line">                &quot;demoapp.out&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;group&quot;: &quot;build&quot;,</span><br><span class="line">            &quot;presentation&quot;: &#123;</span><br><span class="line">                &quot;reveal&quot;: &quot;always&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;problemMatcher&quot;: &quot;\$gcc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ è¿è¡Œé…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt; .vscode&#x2F;launch.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;(gdb) Launch&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;cppdbg&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;program&quot;: &quot;\$&#123;workspaceFolder&#125;&#x2F;demoapp.out&quot;,</span><br><span class="line">            &quot;args&quot;: [],</span><br><span class="line">            &quot;stopAtEntry&quot;: false,</span><br><span class="line">            &quot;cwd&quot;: &quot;\$&#123;workspaceFolder&#125;&quot;,</span><br><span class="line">            &quot;environment&quot;: [],</span><br><span class="line">            &quot;externalConsole&quot;: true,</span><br><span class="line">            &quot;MIMode&quot;: &quot;gdb&quot;,</span><br><span class="line">            &quot;setupCommands&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;description&quot;: &quot;Enable pretty-printing for gdb&quot;,</span><br><span class="line">                    &quot;text&quot;: &quot;-enable-pretty-printing&quot;,</span><br><span class="line">                    &quot;ignoreFailures&quot;: true</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;preLaunchTask&quot;: &quot;build&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ æ™ºèƒ½æç¤ºé…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if [ &#96;getconf LONG_BIT&#96; -eq &quot;64&quot; ]; then</span><br><span class="line">cat &gt; .vscode&#x2F;c_cpp_properties.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Linux&quot;,</span><br><span class="line">            &quot;includePath&quot;: [</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&#x2F;backward&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-linux-gnu&#x2F;8&#x2F;include&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;local&#x2F;include&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-linux-gnu&#x2F;8&#x2F;include-fixed&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&quot;,</span><br><span class="line">                &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;defines&quot;: [],</span><br><span class="line">            &quot;intelliSenseMode&quot;: &quot;clang-x64&quot;,</span><br><span class="line">            &quot;browse&quot;: &#123;</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&#x2F;backward&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-linux-gnu&#x2F;8&#x2F;include&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;local&#x2F;include&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-linux-gnu&#x2F;8&#x2F;include-fixed&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&quot;,</span><br><span class="line">                    &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;limitSymbolsToIncludedHeaders&quot;: true,</span><br><span class="line">                &quot;databaseFilename&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 3</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">else</span><br><span class="line">cat &gt; .vscode&#x2F;c_cpp_properties.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Linux&quot;,</span><br><span class="line">            &quot;includePath&quot;: [</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;i386-linux-gnu&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&#x2F;backward&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;i686-linux-gnu&#x2F;8&#x2F;include&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;local&#x2F;include&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;i686-linux-gnu&#x2F;8&#x2F;include-fixed&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&#x2F;i386-linux-gnu&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;include&quot;,</span><br><span class="line">                &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;defines&quot;: [],</span><br><span class="line">            &quot;intelliSenseMode&quot;: &quot;clang-x64&quot;,</span><br><span class="line">            &quot;browse&quot;: &#123;</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;i386-linux-gnu&#x2F;c++&#x2F;8&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;c++&#x2F;8&#x2F;backward&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;i686-linux-gnu&#x2F;8&#x2F;include&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;local&#x2F;include&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;i686-linux-gnu&#x2F;8&#x2F;include-fixed&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&#x2F;i386-linux-gnu&quot;,</span><br><span class="line">                    &quot;&#x2F;usr&#x2F;include&quot;,</span><br><span class="line">                    &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;limitSymbolsToIncludedHeaders&quot;: true,</span><br><span class="line">                &quot;databaseFilename&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 3</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºC++æºæ–‡ä»¶mycpp.cppï¼ˆä»£ç å°±æ˜¯å†™åœ¨è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch mycpp.cpp</span><br></pre></td></tr></table></figure></li>
<li>ç”¨Visual Studio Codeæ‰“å¼€å½“å‰å·¥ä½œç¯å¢ƒï¼ˆä¸è¦å¿½ç•¥æœ€åçš„ç‚¹å“Ÿï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code .</span><br></pre></td></tr></table></figure></li>
<li>åŒå‡»mycpp.cppæ‰“å¼€æ–‡ä»¶ï¼Œç¬¬ä¸€æ¬¡ä¼šæç¤ºå®‰è£…C++æ’ä»¶ï¼Œç‚¹å‡»å®‰è£…ï¼Œç„¶åç­‰å¾…å³ä¸‹è§’æ¶ˆæ¯å®‰è£…å®Œæˆï¼ˆåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸éœ€è¦å†æ‰§è¡Œï¼‰ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-84d0b75234245983.png" alt></li>
<li>åŒå‡»æ‰“å¼€mycpp.cppï¼Œç„¶åè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;å°å¤é“¶çš„C++æ•™ç¨‹&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-5c0e4151fa446bb1.png" alt></li>
<li>æŒ‰ä¸‹Ctrl+Shift+Bï¼Œç„¶åé€‰æ‹©buildï¼Œå°±ä¼šå¼€å§‹ç¼–è¯‘ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-9086cfb5ebae16ca.png" alt></li>
<li>ç¼–è¯‘å®Œåï¼Œåœ¨ç»ˆç«¯çª—å£æŒ‰å›è½¦é”®å…³é—­ç»ˆç«¯ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-422767a1784b76a6.png" alt></li>
<li>ç‚¹å‡»èœå•æ ä¸­çš„ç»ˆç«¯ï¼Œç„¶åç‚¹å‡»æ–°å»ºç»ˆç«¯ï¼Œå°±ä¼šæ‰“å¼€ç»ˆç«¯çª—å£ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-86304c028d93ecc7.png" alt></li>
<li>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œå°±ä¼šè¿è¡Œç¨‹åºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;demoapp.out</span><br></pre></td></tr></table></figure></li>
<li>è¿è¡Œç¨‹åºå°†ä¼šæ˜¾ç¤ºå°å¤é“¶çš„C++æ•™ç¨‹ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/VScode/11655830-4ecc19bb3b0c9794.png" alt><br>æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç¨‹åºå°±å®Œæˆäº†ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>C++</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuç¾åŒ–</title>
    <url>/2020/01/19/Ubuntu%E7%BE%8E%E5%8C%96/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><ul>
<li>å®‰è£…Unity-tweak-tool<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install unity-tweak-tool</span><br></pre></td></tr></table></figure>
<img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/Ubuntu%E7%BE%8E%E5%8C%96/20180909004455285.png" alt></li>
<li>æ›´æ–°æº<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab&#x2F;themes</span><br><span class="line">sudo apt-add-repository ppa:numix&#x2F;ppa </span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ä¸»é¢˜<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab&#x2F;themes  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install flatabulous-theme </span><br><span class="line">sudo apt-get install arc-theme</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…å›¾æ ‡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab&#x2F;icons  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install ultra-flat-icons </span><br><span class="line">sudo apt-get install numix-icon-theme-circle</span><br></pre></td></tr></table></figure></li>
<li>é€‰æ‹©ä¸»é¢˜<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/Ubuntu%E7%BE%8E%E5%8C%96/20180909005108750.png" alt></li>
<li>é€‰æ‹©å›¾æ ‡<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/Ubuntu%E7%BE%8E%E5%8C%96/20180909005211146.png" alt></li>
<li>æœ€ç»ˆæ•ˆæœ<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/Ubuntu%E7%BE%8E%E5%8C%96/20180909005447430.png" alt></li>
</ul>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows10å®‰è£…ubuntu16.04åŒç³»ç»Ÿæ•™ç¨‹</title>
    <url>/2020/01/19/Windows10%E5%AE%89%E8%A3%85ubuntu16.04%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>BIOSæ¨¡å¼æœ‰ä¼ ç»Ÿçš„MBRæ¨¡å¼å’Œæ–°å¼UEFIæ¨¡å¼ï¼Œè¿™å°†å¯¹å®‰è£…åŒç³»ç»Ÿçš„æ–¹æ³•äº§ç”Ÿç›´æ¥å½±å“ã€‚ç›®å‰æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ç”µè„‘éƒ½å±äºæ–°å¼UEFIæ¨¡å¼ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸€äº›è€æœºå­ä»ç„¶å±äºä¼ ç»ŸMBRæ¨¡å¼ã€‚æœ¬æ•™ç¨‹åªä»‹ç»æ–°å¼UEFIæ¨¡å¼ä¸‹çš„åŒç³»ç»Ÿå®‰è£…æ–¹æ³•ï¼Œå¦‚æœä½ çš„ç”µè„‘å±äºä¼ ç»ŸMBRæ¨¡å¼ï¼Œå¼ºçƒˆå»ºè®®ä½ é‡è£…windowsç³»ç»Ÿæ¥æ›´æ–°BIOSæ¨¡å¼åˆ°UEFIã€‚</p>
<h2 id="åˆ¶ä½œç³»ç»Ÿç›˜"><a href="#åˆ¶ä½œç³»ç»Ÿç›˜" class="headerlink" title="åˆ¶ä½œç³»ç»Ÿç›˜"></a>åˆ¶ä½œç³»ç»Ÿç›˜</h2><p>éœ€è¦å‡†å¤‡ä»¥ä¸‹å·¥å…·ï¼š<br>â‘ ubuntuç³»ç»Ÿé•œåƒ<br>â‘¡åˆ»å½•è½¯ä»¶ï¼Œæ¨èâ€è½¯ç¢Ÿé€šâ€ï¼Œä¼šæç¤ºæ³¨å†Œï¼Œé€‰æ‹©ç»§ç»­è¯•ç”¨å°±å¥½<br>â‘¢ä¸€ä¸ªå¤§äº 2G çš„ U ç›˜<br>1.å®‰è£…å¹¶æ‰“å¼€è½¯ç¢Ÿé€šï¼Œæ’ä¸Š U ç›˜ï¼Œå¹¶ä¸”æœ€å¥½å¤‡ä»½ä½ çš„ U ç›˜ï¼Œå› ä¸ºä¹‹åéœ€è¦æ ¼å¼åŒ–ï¼›<br>2.è¿›å…¥è½¯ç¢Ÿé€šï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œæµè§ˆåˆ°ä½ çš„ubuntué•œåƒæ‰€åœ¨çš„ç›®å½•ï¼Œé€‰æ‹©ubuntué•œåƒæ–‡ä»¶ï¼ŒåŒå‡»æ‰“å¼€ï¼Œå¦‚å›¾ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422030.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422031.jpg" alt><br>3.åœ¨è½¯ç¢Ÿé€šç•Œé¢èœå•æ é€‰æ‹©â€å¯åŠ¨â€ï¼Œé€‰æ‹©â€å†™å…¥ç¡¬ç›˜æ˜ åƒâ€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422032.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422033.jpg" alt><br>æ¥ä¸‹æ¥å¾ˆé‡è¦ï¼Œæ³¨æ„æ¬¡åºï¼š<br>1ï¼‰çœ‹ä½ çš„ç¡¬ç›˜é©±åŠ¨å™¨æ˜¯å¦å¯¹åº”çš„æ˜¯ä½ çš„ U ç›˜ï¼ˆå¿…é¡»æ˜¯ï¼‰ ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯ï¼›<br>2ï¼‰çœ‹æ˜ åƒæ–‡ä»¶æ˜¯å¦å¯¹åº”ä½ çš„ ubuntu é•œåƒï¼›<br>3ï¼‰å¦‚æœä¸Šè¿°å‡æ²¡æœ‰é”™è¯¯ï¼Œé€‰æ‹©æ ¼å¼åŒ–ï¼Œä¹‹åå°±ä¼šæ ¼å¼åŒ–ä½ çš„ U ç›˜ï¼›<br>4ï¼‰åœ¨ U ç›˜æ ¼å¼åŒ–å®Œæ¯•ä¹‹åï¼Œé€‰æ‹©å†™å…¥ï¼Œä¹‹åå°±æ˜¯æ…¢æ…¢ç­‰å¾…äº†ï¼Œç­‰å¾…å†™å…¥å®Œæ¯•ï¼›</p>
<h2 id="åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº"><a href="#åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº" class="headerlink" title="åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº"></a>åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº</h2><p>è¯´æ˜ï¼šè¿™ä¸€æ­¥æ˜¯ä¸ºubuntuç³»ç»Ÿåˆ†é…ç©ºé—´ï¼Œå•ç¡¬ç›˜å’ŒåŒç¡¬ç›˜å­˜åœ¨ä¸€ç‚¹åŒºåˆ«ã€‚<br>1.â€æ­¤ç”µè„‘â€ç‚¹å‡»å³é”®ï¼Œç‚¹å‡»â€ç®¡ç†â€ï¼Œç‚¹å‡»â€ç£ç›˜ç®¡ç†â€ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422034.jpg" alt><br>2.ä¸ºubuntuåˆ†é…ç©ºé—´<br>ï¼ˆ1ï¼‰å¦‚æœæ˜¯å•ç¡¬ç›˜ï¼Œä»»é€‰ä¸€ä¸ªç›˜ï¼Œåœ¨è¯¥ç›˜ç‚¹å‡»å³é”®ï¼Œé€‰æ‹©å‹ç¼©å·ï¼Œå¦‚ä¸‹ï¼Œè¾“å…¥å‹ç¼©ç©ºé—´é‡ï¼Œå•ä½ä¸ºMï¼Œå¦‚æœç©ºé—´å……è¶³ï¼Œå»ºè®®åˆ†å‡º80Gæˆ–100Gï¼Œç©ºé—´ä¸è¶³ä¹Ÿå¯ä»¥åˆ†60Gï¼ˆ1G=1024Mï¼‰ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/20190520082545559.png" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422136.jpg" alt><br>ï¼ˆ2ï¼‰å¦‚æœæ˜¯åŒç¡¬ç›˜ï¼Œéœ€è¦å…ˆåœ¨ç³»ç»Ÿç›˜åˆ†å‡º200Mçš„ç©ºç™½åˆ†åŒºç”¨æ¥å®‰è£…ubuntuçš„å¯åŠ¨é¡¹ï¼Œç„¶åå†åœ¨å¦ä¸€å—ç¡¬ç›˜åˆ†å‡ºç©ºé—´ï¼Œåœ¨è¯¥ç›˜ç‚¹å‡»å³é”®ï¼Œé€‰æ‹©å‹ç¼©å·ï¼Œå¦‚ä¸‹ï¼Œè¾“å…¥å‹ç¼©ç©ºé—´é‡ï¼Œå•ä½ä¸ºM,å¦‚æœç©ºé—´å……è¶³ï¼Œå»ºè®®åˆ†å‡º80Gæˆ–100Gï¼Œç©ºé—´ä¸è¶³ä¹Ÿå¯ä»¥åˆ†60Gï¼ˆ1G=1024Mï¼‰<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422138.jpg" alt></p>
<h2 id="ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ"><a href="#ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ" class="headerlink" title="ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ"></a>ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ</h2><p>å…ˆç‚¹å‡»æ¡Œé¢å³ä¸‹è§’ï¼šç”µæºå›¾æ ‡â†’ç”µæºè®¾ç½®â†’ç”µæºå’Œç¡çœ â†’å…¶ä»–ç”µæºè®¾ç½®â†’é€‰æ‹©ç”µæºæŒ‰é’®çš„åŠŸèƒ½â†’æ›´æ”¹å½“å‰ä¸å¯ç”¨çš„è®¾ç½®ï¼Œå°†â€œå…³æœºè®¾ç½®â€ä¸­çš„å¿«é€Ÿå¯åŠ¨é¡¹å…³é—­ï¼Œä¿å­˜ä¿®æ”¹ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/20190520084629381.png" alt>è‹¥å‘ˆç°è‰²ï¼Œæ— æ³•ä¿®æ”¹ï¼Œwin+rè¿›å…¥gpedit.mscå°†ç³»ç»Ÿé…ç½®ä¸­çš„å…³æœºé€‰é¡¹ï¼Œå¿«é€Ÿå¯åŠ¨æ”¹ä¸ºç¦ç”¨ï¼Œé‡å¯å®Œå³å¯æ›´æ”¹ã€‚<br>1.æ’å¥½ç³»ç»Ÿç›˜ï¼Œé‡å¯ç”µè„‘ï¼Œå¼€æœºè¿›biosï¼Œåœ¨Securityé¡µé¢ï¼Œå…³æ‰secure bootï¼ˆä¸åŒç”µè„‘secure bootå¯èƒ½åœ¨ä¸åŒä½ç½®ï¼‰ï¼Œç„¶ååˆ°Booté¡µé¢ï¼Œå¦‚æœæœ‰Fast Bootè¿™ä¸€é¡¹ï¼ˆéƒ¨åˆ†è”æƒ³ç”µè„‘æœ‰ï¼‰ï¼Œä¹ŸæŠŠå®ƒå…³æ‰ï¼Œæ²¡æœ‰å¿½ç•¥ï¼›ç„¶åä¿å­˜æ›´æ”¹ï¼Œåœ¨Booté¡µé¢ä¸‹æ–¹å¯åŠ¨é¡¹é€‰æ‹© USBå¯åŠ¨ï¼Œå›è½¦ï¼Œå¦‚æœé¡ºåˆ©è¿›å…¥å®‰è£…é¡µé¢ï¼Œç»§ç»­å¾€ä¸‹åšï¼›å¦‚æœç‚¹å‡»USBå¯åŠ¨é¡¹æ— æ³•è¿›å…¥ï¼Œä¿å­˜å¹¶é€€å‡ºï¼Œç”µè„‘ä¼šé‡å¯ï¼Œæ ¹æ®è‡ªå·±ç”µè„‘æŒ‰ç›¸åº”çš„é”®è¿›boot managerï¼Œæ‰¾åˆ°USBå¯åŠ¨é¡¹ï¼Œå›è½¦å³å¯è¿›å…¥ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422139.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422140.jpg" alt><br>2.ç„¶åä¼šè¿›å…¥è¿™ä¸ªç•Œé¢ï¼Œé€‰æ‹©Install Ubuntuï¼Œå›è½¦ç¡®è®¤<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422141.jpg" alt><br>3.å®‰è£…è¿‡ç¨‹è®°ä½æ–­ç½‘ï¼Œå¦åˆ™å¾ˆæ…¢<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422143.jpg" alt><br>å…¨ä¸é€‰ï¼Œè¾¹å®‰è£…è¾¹ä¸‹è½½æ›´æ–°å¾ˆæ…¢ï¼Œç‚¹å‡»â€ç»§ç»­â€<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/20171229140050194.png" alt><br>å‡ºç°ä»¥ä¸‹æˆ–ç±»ä¼¼ç•Œé¢ï¼Œä¸€å®šè¦é€‰æ‹©â€å…¶ä»–é€‰é¡¹â€ï¼Œå› ä¸ºéœ€è¦æ‰‹åŠ¨åˆ†åŒº<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422145.jpg" alt><br>åˆ†åŒºç•Œé¢å¦‚ä¸‹<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422246.jpg" alt><br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿›è¡Œæ‰‹åŠ¨åˆ†åŒºï¼Œé€‰æ‹©ç•™å‡ºçš„ç©ºé—²åˆ†åŒºï¼Œç‚¹å‡»â€+â€è¿›è¡Œåˆ†åŒºï¼Œå¦‚ä¸‹ï¼š<br>1ï¼‰efiï¼šå¦‚æœæ˜¯å•ç¡¬ç›˜ï¼Œåœ¨å”¯ä¸€çš„ä¸€ä¸ªç©ºé—²åˆ†åŒºä¸Šæ·»åŠ ï¼Œå¤§å°200Mï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºefiï¼›å¦‚æœæ˜¯åŒç¡¬ç›˜ï¼Œæ‰¾åˆ°äº‹å…ˆåˆ†å¥½çš„200Mç©ºé—²åˆ†åŒºæ·»åŠ ï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºefiã€‚è¿™ä¸ªåˆ†åŒºå¿…ä¸å¯å°‘ï¼Œç”¨äºå®‰è£…ubuntuå¯åŠ¨é¡¹ã€‚<br>2ï¼‰swap:ä¸­æ–‡æ˜¯â€äº¤æ¢ç©ºé—´â€ï¼Œå……å½“ubuntuçš„è™šæ‹Ÿå†…å­˜ï¼Œä¸€èˆ¬çš„å¤§å°ä¸ç”µè„‘ç‰©ç†å†…å­˜ä¸€æ ·ï¼Œå¯ä»¥å°†å…¶åˆ†ä¸º 8Gï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€swapâ€æˆ–â€äº¤æ¢ç©ºé—´â€<br>3) /:è¿™æ˜¯ubuntu çš„æ ¹ç›®å½•,ç”¨äºå®‰è£…ç³»ç»Ÿå’Œè½¯ä»¶ï¼Œç›¸å½“äºwindowsçš„Cç›˜ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸º 20Gï¼Œä¸»åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€ext4æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿâ€ï¼ŒæŒ‚è½½ç‚¹ä¸ºâ€/â€œï¼ˆæ ¹æ®ä½ çš„ç£ç›˜ç©ºé—´è°ƒæ•´ï¼Œå¯ä»¥å¤§ä¸€ç‚¹ï¼Œæ¯•ç«Ÿubuntuè£…è½¯ä»¶éƒ½æ˜¯é»˜è®¤è£…åœ¨æ ¹ç›®å½•çš„ï¼‰<br>4ï¼‰/home:ç›¸å½“äºwindowsçš„å…¶ä»–ç›˜ï¼Œå‰©ä¸‹çš„å…¨åˆ†ç»™å®ƒï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€ext4æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿâ€ï¼ŒæŒ‚è½½ç‚¹ä¸ºâ€/homeâ€<br>åˆ†åŒºå®Œæ¯•ï¼Œåœ¨åˆ†åŒºç•Œé¢çš„ä¸‹æ–¹ï¼Œé€‰æ‹©å®‰è£…å¯åŠ¨é¡¹çš„ä½ç½®ï¼Œæˆ‘ä»¬åˆšåˆšä¸æ˜¯åˆ›å»ºäº†200Mçš„efiåˆ†åŒºå—ï¼Œç°åœ¨ä½ çœ‹çœ‹è¿™ä¸ªåŒºå‰é¢çš„ç¼–å·æ˜¯å¤šå°‘ï¼Œæ¯”å¦‚æ˜¯/dev/sda1,ä¸åŒçš„æœºå­ä¼šæœ‰ä¸åŒçš„ç¼–å·ï¼Œä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¿™ä¸ªefiåˆ†åŒºç¼–å·ï¼ˆè¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼Œwindowsçš„å¯åŠ¨é¡¹ä¹Ÿæ˜¯efiæ–‡ä»¶ï¼Œå¤§å°å¤§æ¦‚æ˜¯100Mï¼Œè€Œæˆ‘ä»¬åˆ›å»ºçš„ubuntuçš„efiå¤§å°æ˜¯200Mï¼Œä¸€å®šè¦é€‰å¯¹ï¼‰ï¼Œä¹‹åç‚¹å‡»â€Install Nowâ€<br>è®¾ç½®åœ°åŒºä¸é‡è¦ï¼ŒæŒ‰ä½ éœ€è¦è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç»§ç»­ï¼Œä¸å½±å“<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422248.jpg" alt><br>é”®ç›˜å¸ƒå±€é»˜è®¤æ˜¯è‹±è¯­çš„ï¼Œå»ºè®®ä¸æ”¹ï¼ˆé»˜è®¤ä¸­æ–‡ä¹Ÿè¡Œï¼‰<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422249.jpg" alt><br>è¿™é‡Œè®¾ç½®ç”¨æˆ·ï¼Œè‡ªå·±è¾“å…¥å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚è‹±æ–‡å­—æ¯ï¼Œå°½é‡ç®€å•ç‚¹ï¼Œå¯†ç ä¹Ÿç®€å•ç‚¹<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422250.jpg" alt><br>ç³»ç»Ÿå¼€å§‹å®‰è£…ï¼Œè€å¿ƒç­‰å¾…å®‰è£…å®Œæ¯•å°±å¯ä»¥äº†<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422251.jpg" alt><br>å…¨éƒ¨å®Œæˆä¹‹åï¼Œä¼šæé†’ä½ é‡å¯ï¼ŒæŠŠUç›˜æ‹”äº†ï¼Œç‚¹â€ç°åœ¨é‡å¯â€ï¼Œå¦‚æœå¡æ­»å°±å¼ºåˆ¶å…³æœºå†é‡å¯å°±å¥½<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422252.jpg" alt><br>é‡å¯åä½ ä¼šçœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼Œç¬¬ä¸€é¡¹æ˜¯ubuntuå¯åŠ¨é¡¹ï¼Œç¬¬äºŒé¡¹æ˜¯ubuntué«˜çº§è®¾ç½®ï¼Œç¬¬ä¸‰é¡¹æ˜¯windowså¯åŠ¨é¡¹ï¼Œç¬¬å››é¡¹ä¸ç”¨ç®¡ï¼Œé»˜è®¤é€‰æ‹©çš„æ˜¯ç¬¬ä¸€ä¸ªï¼Œå›è½¦è¿›ubuntuç³»ç»Ÿ<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/%E5%8F%8C%E7%B3%BB%E7%BB%9F/2019121214422253.jpg" alt><br>è‹¥æ²¡æœ‰å‡ºç°ï¼Œåˆ™è¿›å…¥bioså°†å¯åŠ¨é¡ºåºæ”¹ä¸ºUbuntuå…ˆã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Windows10</tag>
      </tags>
  </entry>
  <entry>
    <title>CMake Error at /usr/share/cmake-3.5/Modules/FindQt4.cmake:634 (message)</title>
    <url>/2020/01/19/CMake%20Error/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>ç¼–è¯‘å·¥ç¨‹æ—¶å‡ºç°cmakeæ‰¾ä¸åˆ°Qt4çš„é—®é¢˜,å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CMake Warning at &#x2F;usr&#x2F;share&#x2F;cmake-3.5&#x2F;Modules&#x2F;FindQt4.cmake:626 (message):</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;qmake-qt4 reported QT_INSTALL_LIBS as &quot;&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&quot;</span><br><span class="line"> but QtCore could not be found there.  </span><br><span class="line"> Qt is NOT installed correctly for the target build environment.</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CMake Error at &#x2F;usr&#x2F;share&#x2F;cmake-3.5&#x2F;Modules&#x2F;FindQt4.cmake:634 (message):</span><br><span class="line">  Could NOT find QtCore.</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install cmake gcc g++ qt&#123;4,5&#125;-qmake libqt4-dev</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¹ç›®å½• /var/lib/apt/lists/ åŠ é” é—®é¢˜è§£å†³æ–¹æ³•</title>
    <url>/2020/01/19/%E5%AF%B9%E7%9B%AE%E5%BD%95-varlibaptlists-%E5%8A%A0%E9%94%81-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;lock</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu apt æ›´æ¢ä¸ºå›½å†…çš„æº</title>
    <url>/2020/01/19/ubuntu-apt-%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%9B%BD%E5%86%85%E7%9A%84%E6%BA%90/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>å¤‡ä»½åŸæ¥çš„æºï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak</span><br></pre></td></tr></table></figure><br>æ›´æ¢æº:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br></pre></td></tr></table></figure><br>å°†é‡Œé¢æ–‡ä»¶å†…å®¹å…¨éƒ¨æ›¿æ¢æˆä¸‹é¢ï¼š<br><a href="https://wiki.ubuntu.org.cn/%E6%A8%A1%E6%9D%BF:16.04source" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„è·å¾—æœ€æ–°æº</a><br>ä¿å­˜é€€å‡º<br>æ‰§è¡Œæ›´æ–°ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10å’ŒUbuntuåŒç³»ç»Ÿä¸‹æ—¶é—´ä¸å¯¹é—®é¢˜</title>
    <url>/2020/01/19/Win10%E5%92%8CUbuntu%E5%8F%8C%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%97%B6%E9%97%B4%E4%B8%8D%E5%AF%B9%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>ç”µè„‘å®‰è£…å®Œwin10å’ŒUbuntuåŒç³»ç»Ÿåï¼ŒUbuntuæ—¶é—´æ€»ä¼šå’ŒWindowsæ—¶é—´ç›¸å·®8å°æ—¶ï¼Œè¿™æ˜¯å› ä¸ºwindowsè®¤ä¸ºbiosæ—¶é—´æ˜¯æœ¬åœ°æ—¶é—´ï¼ŒUbuntuè®¤ä¸ºbiosæ—¶é—´æ˜¯UTCæ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Ubuntuæ—¶é—´æ”¹æˆæœ¬åœ°æ—¶é—´ã€‚<br>æ‰§è¡Œè¿™æ¡è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">timedatectl set-local-rtc 1 --adjust-system-clock</span><br></pre></td></tr></table></figure>
<p>é‡å¯è¿›å…¥windowsï¼Œæ—¶é—´è®¾ç½®ä¸­ç‚¹å‡»ç«‹å³åŒæ­¥å³å¯è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è·å–OneDrive 5Tç½‘ç›˜ç©ºé—´(å¯å‡çº§25T)</title>
    <url>/2020/01/16/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96OneDrive-5T%E7%BD%91%E7%9B%98%E7%A9%BA%E9%97%B4(%E5%8F%AF%E5%8D%87%E7%BA%A725T)/</url>
    <content><![CDATA[<p><a href="https://blog.wulel.com/post/how-to-get-5t-onedrive/" target="_blank" rel="noopener">ç‚¹æ­¤è·³è½¬</a></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Onedrive</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ Onedrive åŒæ­¥ä»»æ„æ–‡ä»¶å¤¹</title>
    <url>/2020/01/16/%E4%BD%BF-Onedrive-%E5%90%8C%E6%AD%A5%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a><a id="more"></a></h1><p>onedriveé»˜è®¤åªåŒæ­¥æŒ‡å®šçš„onedriveæ–‡ä»¶å¤¹ï¼Œä¸ºäº†è®©å®ƒåŒæ­¥å…¶ä»–çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ï¼‰ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mklink &#x2F;j &quot;onedriveæ–‡ä»¶å¤¹åœ°å€\éœ€è¦åŒæ­¥çš„æ–‡ä»¶å¤¹å&quot; &quot;éœ€è¦åŒæ­¥çš„æ–‡ä»¶å¤¹åœ°å€&quot;</span><br></pre></td></tr></table></figure><br>æ¯”å¦‚è¯´æˆ‘çš„onedriveåœ¨D:\Onedriveï¼Œæˆ‘çš„ç›®æ ‡æ–‡ä»¶å¤¹teståœ¨D:\ã€‚é‚£ä¹ˆ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mklink &#x2F;j &quot;D:\Onedrive\test&quot; &quot;D:\test&quot;</span><br></pre></td></tr></table></figure><br>å¦‚æœæˆåŠŸçš„çš„è¯ï¼Œä¼šæç¤º<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/onedrive/1392594-20181005094204092-1998469109.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Onedrive</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹è°ƒç ”</title>
    <url>/2020/01/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E8%B0%83%E7%A0%94/</url>
    <content><![CDATA[<h3 id="ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡"><a href="#ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡" class="headerlink" title=" ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡"></a><a id="more"></a> ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡</h3><ul>
<li><strong>åˆ†ç±»-Classification</strong>ï¼šè§£å†³â€œæ˜¯ä»€ä¹ˆï¼Ÿâ€çš„é—®é¢˜ï¼Œå³ç»™å®šä¸€å¼ å›¾ç‰‡æˆ–ä¸€æ®µè§†é¢‘åˆ¤æ–­é‡Œé¢åŒ…å«ä»€ä¹ˆç±»åˆ«çš„ç›®æ ‡ã€‚</li>
<li><strong>å®šä½-Location</strong>ï¼šè§£å†³â€œåœ¨å“ªé‡Œï¼Ÿâ€çš„é—®é¢˜ï¼Œå³å®šä½å‡ºè¿™ä¸ªç›®æ ‡çš„çš„ä½ç½®ã€‚</li>
<li><strong>æ£€æµ‹-Detection</strong>ï¼šè§£å†³â€œæ˜¯ä»€ä¹ˆï¼Ÿåœ¨å“ªé‡Œï¼Ÿâ€çš„é—®é¢˜ï¼Œå³å®šä½å‡ºè¿™ä¸ªç›®æ ‡çš„çš„ä½ç½®å¹¶ä¸”çŸ¥é“ç›®æ ‡ç‰©æ˜¯ä»€ä¹ˆã€‚</li>
<li><strong>åˆ†å‰²-Segmentation</strong>ï¼šåˆ†ä¸ºå®ä¾‹çš„åˆ†å‰²ï¼ˆInstance-levelï¼‰å’Œåœºæ™¯åˆ†å‰²ï¼ˆScene-levelï¼‰ï¼Œè§£å†³â€œæ¯ä¸€ä¸ªåƒç´ å±äºå“ªä¸ªç›®æ ‡ç‰©æˆ–åœºæ™¯â€çš„é—®é¢˜ã€‚</li>
</ul>
<h3 id="æ‰€é¢ä¸´çš„æŒ‘æˆ˜"><a href="#æ‰€é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="æ‰€é¢ä¸´çš„æŒ‘æˆ˜"></a>æ‰€é¢ä¸´çš„æŒ‘æˆ˜</h3><ul>
<li>ç›®æ ‡å¯èƒ½å‡ºç°åœ¨å›¾åƒçš„ä»»ä½•ä½ç½®ã€‚</li>
<li>ç›®æ ‡æœ‰å„ç§ä¸åŒçš„å¤§å°ã€‚</li>
<li>ç›®æ ‡å¯èƒ½æœ‰å„ç§ä¸åŒçš„å½¢çŠ¶ã€‚</li>
</ul>
<h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/deep_learning_object_detection_dataset.PNG" alt></p>
<ul>
<li><p>Pascal Visual Object Classes(05-12) æ˜¯è®¡ç®—æœºè§†è§‰é¢†åŸŸæœ€é‡è¦çš„èµ›äº‹ä¹‹ä¸€ã€‚åŒ…å«å¤šä»»åŠ¡ï¼Œå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²å’Œè¡Œä¸ºæ£€æµ‹ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ Pascal-VOC ç”¨äºæ£€æµ‹ï¼šVOC07 å’Œ VOC12ï¼Œå‰è€…åŒ…å« 5K å¼ è®­ç»ƒå›¾åƒï¼Œå…± 12K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚åè€…åŒ…å« 11K å¼ è®­ç»ƒå›¾åƒï¼Œå…± 27K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚ä¸¤ä¸ªæ•°æ®é›†ä¸­åŒ…å«äº† 20 ä¸ªç”Ÿæ´»ä¸­å¸¸è§çš„ç›®æ ‡ç±»ï¼ˆPersonï¼šperson; Animalï¼šbird, cat, cow, dog, horse, sheep; Vehicleï¼šaeroplane, bicycle, boat, bus, car, motor-bike, train; Indoor: bottle, chair, dining table, potted plant, sofa, tv/monitorï¼‰</p>
</li>
<li><p>ImageNet Large Scale Visual Recognition Challenge(10-17) åŒ…å«æ£€æµ‹æŒ‘æˆ˜èµ›ã€‚Imagenetæ•°æ®é›†æœ‰1400å¤šä¸‡å¹…å›¾ç‰‡ï¼Œæ¶µç›–2ä¸‡å¤šä¸ªç±»åˆ«ï¼ŒILSVRCæ¯”èµ›ä¼šæ¯å¹´ä»ImageNetæ•°æ®é›†ä¸­æŠ½å‡ºéƒ¨åˆ†æ ·æœ¬, æ£€æµ‹æ•°æ®é›†åŒ…æ‹¬ 200 ç±»è§†è§‰ç›®æ ‡ï¼Œå›¾åƒ/ç›®æ ‡æ¯” VOC å¤§ä¸¤ä¸ªæ•°é‡çº§ã€‚ä¾‹å¦‚ï¼ŒILSVRC-14 åŒ…å«517K å›¾åƒä»¥åŠ 534K æ³¨é‡Šç›®æ ‡ã€‚</p>
</li>
<li><p>MS-COCO æ˜¯å½“å‰æœ€æœ‰æŒ‘æˆ˜æ€§çš„ç›®æ ‡æ£€æµ‹æ•°æ®é›†ã€‚ä» 15 å¹´å¼€å§‹ä¸¾åŠæ¯”èµ›ã€‚å®ƒçš„ç›®æ ‡ç±»åˆ«æ¯” ILSVRC å°‘ï¼Œä½†æ˜¯ç›®æ ‡å®ä¾‹æ›´å¤šã€‚ä¾‹å¦‚ï¼ŒMS-COCO-17 åŒ…å« 164K å¼ å›¾åƒï¼Œæ¥è‡ª 80 ç±»çš„ 897K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚ä¸ VOC å’Œ ILSVRC ç›¸æ¯”ï¼ŒMS-COCO é™¤äº†è¾¹ç•Œæ¡†æ³¨é‡Šä»¥å¤–ï¼Œæ¯ä¸ªç›®æ ‡é€šè¿‡å®ä¾‹åˆ†å‰²è¿›ä¸€æ­¥æ ‡æ³¨æ¥å¸®åŠ©ç²¾ç¡®å®šä½ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…å«æ›´å¤šå°ç›®æ ‡ï¼ˆé¢ç§¯å°äºå›¾åƒçš„ 1%ï¼‰ï¼Œä»¥åŠå¯†é›†å®šä½ç›®æ ‡ã€‚è¿™äº›ç‰¹ç‚¹ä½¿ MSâˆ’COCOä¸­çš„ç›®æ ‡åˆ†å¸ƒæ›´æ¥è¿‘äºçœŸå®ä¸–ç•Œã€‚</p>
</li>
<li><p>Open Images</p>
<p>2018 å¹´æ¨å‡ºäº† Open ImagesOpen~ImagesOpen Images æ£€æµ‹æŒ‘æˆ˜èµ›ã€‚åŒ…å«ä¸¤ä¸ªä»»åŠ¡ï¼š</p>
<p>æ ‡å‡†ç›®æ ‡æ£€æµ‹<br>è§†è§‰å…³ç³»æ£€æµ‹ï¼Œç”¨äºæ£€æµ‹ç‰¹å®šå…³ç³»ä¸­çš„åŒ¹é…ç›®æ ‡</p>
<p>ç›®æ ‡æ£€æµ‹ï¼Œæ•°æ®é›†åŒ…å« 1910K å¼ å›¾åƒï¼Œ600 ä¸ªç›®æ ‡ç±»åˆ«çš„ 15440K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚</p>
</li>
</ul>
<h3 id="è¯„ä»·æŒ‡æ ‡"><a href="#è¯„ä»·æŒ‡æ ‡" class="headerlink" title="è¯„ä»·æŒ‡æ ‡"></a>è¯„ä»·æŒ‡æ ‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢„æµ‹\å®é™…</th>
<th>æ­£</th>
<th>è´Ÿ  </th>
</tr>
</thead>
<tbody>
<tr>
<td>æ­£</td>
<td>TP</td>
<td>FP</td>
<td></td>
</tr>
<tr>
<td>è´Ÿ</td>
<td>FN</td>
<td>TN</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Recall=TP/(TP+FN)ï¼Œå¬å›ç‡ï¼Œ<strong>å¯ç†è§£ä¸ºæ­£ç¡®çš„è¢«åˆ¤æ–­ä¸ºæ­£ç¡®çš„</strong></p>
<p>Precision=TP/(TP+FP)ï¼Œå‡†ç¡®åº¦ï¼Œ<strong>é¢„æµ‹ä¸ºæ­£ç±»ä¸­ï¼Œå®é™…ä¸ºæ­£ç±»çš„æ¯”ä¾‹</strong></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2018042521300715.png" alt></p>
<p><strong>å‡†ç¡®ç‡-å¬å›ç‡æ›²çº¿ï¼ˆP-Ræ›²çº¿ï¼‰</strong>ï¼šä»¥å¬å›ç‡ä¸ºæ¨ªåæ ‡ï¼Œç²¾ç¡®ç‡ä¸ºçºµåæ ‡</p>
<script type="math/tex; mode=display">
\mathrm{AP}=\int_{0}^{1} P(R) d(R)</script><script type="math/tex; mode=display">
\mathrm{mAP}=\frac{1}{\text { classes }} \sum_{i=1}^{\text {classes }} \int_{0}^{1} P(R) d(R)</script><p><strong>IoU</strong>ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20180423003716617.png" alt></p>
<p>VOC07 ä»¥åä½¿ç”¨ AP è¯„ä»·æ£€æµ‹æ€§èƒ½ã€‚AP å®šä¹‰ä¸ºä¸åŒå¬å›ç‡ä¸‹çš„å¹³å‡æ£€æµ‹ç²¾åº¦ï¼Œé€šå¸¸åœ¨æŸä¸€ç‰¹å®šç±»åˆ«ä¸‹è¿›è¡Œè¯„ä¼°ã€‚ä¸ºæ¯”è¾ƒæ‰€æœ‰ç›®æ ‡ç±»çš„æ£€æµ‹æ€§èƒ½ï¼Œé€šå¸¸ä½¿ç”¨ mAP ä½œä¸ºæœ€ç»ˆæ€§èƒ½æŒ‡æ ‡ã€‚</p>
<p>ä¸ºåº¦é‡ç›®æ ‡å®šä½ç²¾åº¦ï¼Œä½¿ç”¨äº¤å¹¶æ¯”ï¼ˆIoUï¼‰æ¥æ£€æŸ¥é¢„æµ‹æ¡†å’Œ GT æ¡†ä¹‹é—´çš„ IoUæ˜¯å¦å¤§äºé¢„å®šä¹‰çš„é˜ˆå€¼ï¼Œå¦‚ï¼Œ0.5ã€‚å¦‚æœå¤§äºé˜ˆå€¼åˆ™è¡¨ç¤ºæˆåŠŸæ£€æµ‹ï¼Œå¦åˆ™è¡¨ç¤ºæ¼æ£€ã€‚åŸºäº 0.5IoU çš„ mAP å·²ç»æˆä¸ºå¤šå¹´æ¥ç”¨äºç›®æ ‡æ£€æµ‹é—®é¢˜çš„äº‹å®ä¸Šçš„åº¦é‡æ ‡å‡†ã€‚</p>
<p>MSâˆ’COCO çš„ AP æ˜¯åœ¨ 0.5âˆ’0.95å¤šä¸ª IoU é˜ˆå€¼ä¸Šçš„å¹³å‡å€¼ã€‚</p>
<h3 id="æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•"><a href="#æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•" class="headerlink" title="æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•"></a>æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•</h3><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/deep_learning_object_detection_history.PNG" alt></p>
<p><strong>Two-stage Detectorsï¼ˆä¸¤é˜¶æ®µç›®æ ‡æ£€æµ‹å™¨ï¼‰</strong></p>
<p>é¦–å…ˆç”±ç®—æ³•ï¼ˆalgorithmï¼‰ç”Ÿæˆä¸€ç³»åˆ—ä½œä¸ºæ ·æœ¬çš„å€™é€‰æ¡†ï¼Œå†é€šè¿‡å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œæ ·æœ¬ï¼ˆSampleï¼‰åˆ†ç±»ã€‚</p>
<p>è¯¸å¦‚R-CNNï¼ŒFast R-CNNï¼ŒFaster R-CNNåˆ°æœ€æ–°çš„Mask Scoring R-CNNç­‰ç½‘ç»œç»“æ„ï¼Œéƒ½å±äºTwo-stageæ£€æµ‹æ–¹æ³•ã€‚</p>
<p><strong>One-stage Detectorsï¼ˆå•é˜¶æ®µç›®æ ‡æ£€æµ‹å™¨ï¼‰</strong></p>
<p>ä¸éœ€è¦äº§ç”Ÿå€™é€‰æ¡†ï¼Œç›´æ¥å°†ç›®æ ‡æ¡†å®šä½çš„é—®é¢˜è½¬åŒ–ä¸ºå›å½’ï¼ˆRegressionï¼‰é—®é¢˜å¤„ç†(Process)ã€‚</p>
<p>ä»æœ€æ—©çš„OverFeatåˆ°ç°åœ¨çš„YOLOï¼ŒSSDï¼ŒRetinaNetï¼ŒYOLOv2ï¼ŒCornerNetç­‰éƒ½å±äºone stageç›®æ ‡æ£€æµ‹æ–¹æ³•ã€‚</p>
<p>å³ï¼š</p>
<p><strong>åŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰</strong>çš„ï¼Œå¦‚R-CNNã€SPP-netã€Fast R-CNNã€Faster R-CNNã€R-FCNï¼›</p>
<p><strong>åŸºäºç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰</strong>ï¼Œæ— éœ€å€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„ï¼Œå¦‚YOLOã€SSDã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20180509095302426.png" alt></p>
<p>å¯¹äºä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼ŒåŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„æ–¹æ³•åœ¨æ£€æµ‹å‡†ç¡®ç‡å’Œå®šä½ç²¾åº¦ä¸Šå ä¼˜ï¼ŒåŸºäºç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰çš„ç®—æ³•é€Ÿåº¦å ä¼˜ã€‚ç›¸å¯¹äºR-CNNç³»åˆ—çš„â€œçœ‹ä¸¤çœ¼â€ï¼ˆå€™é€‰æ¡†æå–å’Œåˆ†ç±»ï¼‰ï¼ŒYOLOåªéœ€è¦â€œçœ‹ä¸€çœ¼â€ã€‚æ€»ä¹‹ï¼Œç›®å‰æ¥è¯´ï¼ŒåŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„æ–¹æ³•ä¾ç„¶å æ®ä¸Šé£ï¼Œä½†ç«¯åˆ°ç«¯çš„æ–¹æ³•é€Ÿåº¦ä¸Šä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<h3 id="å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦"><a href="#å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦" class="headerlink" title="å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦"></a>å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Detector</th>
<th style="text-align:center">VOC07 (mAP@IoU=0.5)</th>
<th style="text-align:center">VOC12 (mAP@IoU=0.5)</th>
<th style="text-align:center">COCO (mAP@IoU=0.5:0.95)</th>
<th style="text-align:center">Published In</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">R-CNN</td>
<td style="text-align:center">58.5</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™14</td>
</tr>
<tr>
<td style="text-align:center">SPP-Net</td>
<td style="text-align:center">59.2</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™14</td>
</tr>
<tr>
<td style="text-align:center">MR-CNN</td>
<td style="text-align:center">78.2 (07+12)</td>
<td style="text-align:center">73.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™15</td>
</tr>
<tr>
<td style="text-align:center">Fast R-CNN</td>
<td style="text-align:center">70.0 (07+12)</td>
<td style="text-align:center">68.4 (07++12)</td>
<td style="text-align:center">19.7</td>
<td style="text-align:center">ICCVâ€™15</td>
</tr>
<tr>
<td style="text-align:center">Faster R-CNN</td>
<td style="text-align:center">73.2 (07+12)</td>
<td style="text-align:center">70.4 (07++12)</td>
<td style="text-align:center">21.9</td>
<td style="text-align:center">NIPSâ€™15</td>
</tr>
<tr>
<td style="text-align:center">YOLO v1</td>
<td style="text-align:center">66.4 (07+12)</td>
<td style="text-align:center">57.9 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">G-CNN</td>
<td style="text-align:center">66.8</td>
<td style="text-align:center">66.4 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">AZNet</td>
<td style="text-align:center">70.4</td>
<td style="text-align:center">-</td>
<td style="text-align:center">22.3</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">ION</td>
<td style="text-align:center">80.1</td>
<td style="text-align:center">77.9</td>
<td style="text-align:center">33.1</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">HyperNet</td>
<td style="text-align:center">76.3 (07+12)</td>
<td style="text-align:center">71.4 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">OHEM</td>
<td style="text-align:center">78.9 (07+12)</td>
<td style="text-align:center">76.3 (07++12)</td>
<td style="text-align:center">22.4</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">MPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">33.2</td>
<td style="text-align:center">BMVCâ€™16</td>
</tr>
<tr>
<td style="text-align:center">SSD</td>
<td style="text-align:center">76.8 (07+12)</td>
<td style="text-align:center">74.9 (07++12)</td>
<td style="text-align:center">31.2</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">GBDNet</td>
<td style="text-align:center">77.2 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">27.0</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">CPF</td>
<td style="text-align:center">76.4 (07+12)</td>
<td style="text-align:center">72.6 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">R-FCN</td>
<td style="text-align:center">79.5 (07+12)</td>
<td style="text-align:center">77.6 (07++12)</td>
<td style="text-align:center">29.9</td>
<td style="text-align:center">NIPSâ€™16</td>
</tr>
<tr>
<td style="text-align:center">DeepID-Net</td>
<td style="text-align:center">69.0</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">PAMIâ€™16</td>
</tr>
<tr>
<td style="text-align:center">NoC</td>
<td style="text-align:center">71.6 (07+12)</td>
<td style="text-align:center">68.8 (07+12)</td>
<td style="text-align:center">27.2</td>
<td style="text-align:center">TPAMIâ€™16</td>
</tr>
<tr>
<td style="text-align:center">DSSD</td>
<td style="text-align:center">81.5 (07+12)</td>
<td style="text-align:center">80.0 (07++12)</td>
<td style="text-align:center">33.2</td>
<td style="text-align:center">arXivâ€™17</td>
</tr>
<tr>
<td style="text-align:center">TDM</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">37.3</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">FPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">36.2</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">YOLO v2</td>
<td style="text-align:center">78.6 (07+12)</td>
<td style="text-align:center">73.4 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">RON</td>
<td style="text-align:center">77.6 (07+12)</td>
<td style="text-align:center">75.4 (07++12)</td>
<td style="text-align:center">27.4</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">DeNet</td>
<td style="text-align:center">77.1 (07+12)</td>
<td style="text-align:center">73.9 (07++12)</td>
<td style="text-align:center">33.8</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">CoupleNet</td>
<td style="text-align:center">82.7 (07+12)</td>
<td style="text-align:center">80.4 (07++12)</td>
<td style="text-align:center">34.4</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">RetinaNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">39.1</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">DSOD</td>
<td style="text-align:center">77.7 (07+12)</td>
<td style="text-align:center">76.3 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">SMN</td>
<td style="text-align:center">70.0</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">Light-Head R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.5</td>
<td style="text-align:center">arXivâ€™17</td>
</tr>
<tr>
<td style="text-align:center">YOLO v3</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">33.0</td>
<td style="text-align:center">arXivâ€™18</td>
</tr>
<tr>
<td style="text-align:center">SIN</td>
<td style="text-align:center">76.0 (07+12)</td>
<td style="text-align:center">73.1 (07++12)</td>
<td style="text-align:center">23.2</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">STDN</td>
<td style="text-align:center">80.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">RefineDet</td>
<td style="text-align:center">83.8 (07+12)</td>
<td style="text-align:center">83.5 (07++12)</td>
<td style="text-align:center">41.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">SNIP</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">45.7</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Relation-Network</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">32.5</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Cascade R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">MLKP</td>
<td style="text-align:center">80.6 (07+12)</td>
<td style="text-align:center">77.2 (07++12)</td>
<td style="text-align:center">28.6</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Fitness-NMS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">RFBNet</td>
<td style="text-align:center">82.2 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">CornerNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.1</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">PFPNet</td>
<td style="text-align:center">84.1 (07+12)</td>
<td style="text-align:center">83.7 (07++12)</td>
<td style="text-align:center">39.4</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Pelee</td>
<td style="text-align:center">70.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">NIPSâ€™18</td>
</tr>
<tr>
<td style="text-align:center">HKRM</td>
<td style="text-align:center">78.8 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">37.8</td>
<td style="text-align:center">NIPSâ€™18</td>
</tr>
<tr>
<td style="text-align:center">M2Det</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.2</td>
<td style="text-align:center">AAAIâ€™19</td>
</tr>
<tr>
<td style="text-align:center">R-DAD</td>
<td style="text-align:center">81.2 (07++12)</td>
<td style="text-align:center">82.0 (07++12)</td>
<td style="text-align:center">43.1</td>
<td style="text-align:center">AAAIâ€™19</td>
</tr>
<tr>
<td style="text-align:center">ScratchDet</td>
<td style="text-align:center">84.1 (07++12)</td>
<td style="text-align:center">83.6 (07++12)</td>
<td style="text-align:center">39.1</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Libra R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">43.0</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Reasoning-RCNN</td>
<td style="text-align:center">82.5 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">43.2</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FSAF</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.6</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">AmoebaNet + NAS-FPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">47.0</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Cascade-RetinaNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.1</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">TridentNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">48.4</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">DAFS</td>
<td style="text-align:center"><strong>85.3 (07+12)</strong></td>
<td style="text-align:center">83.1 (07++12)</td>
<td style="text-align:center">40.5</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Auto-FPN</td>
<td style="text-align:center">81.8 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">40.5</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FCOS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.7</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FreeAnchor</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.8</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">DetNAS</td>
<td style="text-align:center">81.5 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.0</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">NATS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.0</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">AmoebaNet + NAS-FPN + AA</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">50.7</td>
<td style="text-align:center">arXivâ€™19</td>
</tr>
<tr>
<td style="text-align:center">EfficientDet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center"><strong>51.0</strong></td>
<td style="text-align:center">arXivâ€™19</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†-Proposal"><a href="#ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†-Proposal" class="headerlink" title="ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†(Proposal)"></a>ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†(Proposal)</h3><p>ç‰©ä½“å€™é€‰æ¡†è·å–ï¼Œå½“å‰ä¸»è¦ä½¿ç”¨å›¾åƒåˆ†å‰²ä¸åŒºåŸŸç”Ÿé•¿æŠ€æœ¯ã€‚åŒºåŸŸç”Ÿé•¿(åˆå¹¶)ä¸»è¦ç”±äºæ£€æµ‹å›¾åƒä¸­å­˜åœ¨çš„ç‰©ä½“å…·æœ‰å±€éƒ¨åŒºåŸŸç›¸ä¼¼æ€§(é¢œè‰²ã€çº¹ç†ç­‰)ã€‚</p>
<p>æ ¹æ®ç›®æ ‡å€™é€‰åŒºåŸŸçš„æå–æ–¹å¼ä¸åŒï¼Œä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•å¯ä»¥åˆ†ä¸ºåŸºäºæ»‘åŠ¨çª—å£çš„ç›®æ ‡æ£€æµ‹ç®—æ³•å’ŒåŸºäºé€‰æ‹©æ€§æœç´¢çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚</p>
<p><strong>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰</strong></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/1423648-20190316210029111-840970217.png" alt></p>
<p>åŸºæœ¬åŸç†å°±æ˜¯é‡‡ç”¨ä¸åŒå¤§å°å’Œæ¯”ä¾‹ï¼ˆå®½é«˜æ¯”ï¼‰çš„çª—å£åœ¨æ•´å¼ å›¾ç‰‡ä¸Šä»¥ä¸€å®šçš„æ­¥é•¿è¿›è¡Œæ»‘åŠ¨ï¼Œç„¶åå¯¹è¿™äº›çª—å£å¯¹åº”çš„åŒºåŸŸåšå›¾åƒåˆ†ç±»</p>
<p>ç¼ºç‚¹ï¼šä¸çŸ¥é“è¦æ£€æµ‹çš„ç›®æ ‡å¤§å°æ˜¯ä»€ä¹ˆè§„æ¨¡ï¼Œæ‰€ä»¥è¦è®¾ç½®ä¸åŒå¤§å°å’Œæ¯”ä¾‹çš„çª—å£å»æ»‘åŠ¨ï¼Œè€Œä¸”è¿˜è¦é€‰å–åˆé€‚çš„æ­¥é•¿ã€‚ä½†æ˜¯è¿™æ ·ä¼šäº§ç”Ÿå¾ˆå¤šçš„å­åŒºåŸŸï¼Œå¹¶ä¸”éƒ½è¦ç»è¿‡åˆ†ç±»å™¨å»åšé¢„æµ‹ï¼Œè¿™éœ€è¦å¾ˆå¤§çš„è®¡ç®—é‡ã€‚</p>
<p>å…·ä½“æ­¥éª¤ï¼šé¦–å…ˆå¯¹è¾“å…¥å›¾åƒè¿›è¡Œä¸åŒçª—å£å¤§å°çš„æ»‘çª—è¿›è¡Œä»å·¦å¾€å³ã€ä»ä¸Šåˆ°ä¸‹çš„æ»‘åŠ¨ã€‚æ¯æ¬¡æ»‘åŠ¨æ—¶å€™å¯¹å½“å‰çª—å£æ‰§è¡Œåˆ†ç±»å™¨(åˆ†ç±»å™¨æ˜¯äº‹å…ˆè®­ç»ƒå¥½çš„)ã€‚å¦‚æœå½“å‰çª—å£å¾—åˆ°è¾ƒé«˜çš„åˆ†ç±»æ¦‚ç‡ï¼Œåˆ™è®¤ä¸ºæ£€æµ‹åˆ°äº†ç‰©ä½“ã€‚å¯¹æ¯ä¸ªä¸åŒçª—å£å¤§å°çš„æ»‘çª—éƒ½è¿›è¡Œæ£€æµ‹åï¼Œä¼šå¾—åˆ°ä¸åŒçª—å£æ£€æµ‹åˆ°çš„ç‰©ä½“æ ‡è®°ï¼Œè¿™äº›çª—å£å¤§å°ä¼šå­˜åœ¨é‡å¤è¾ƒé«˜çš„éƒ¨åˆ†ï¼Œæœ€åé‡‡ç”¨éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum Suppression, NMS)çš„æ–¹æ³•è¿›è¡Œç­›é€‰ã€‚æœ€ç»ˆï¼Œç»è¿‡NMSç­›é€‰åè·å¾—æ£€æµ‹åˆ°çš„ç‰©ä½“ã€‚</p>
<p><strong>éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum Suppression,NMS)</strong></p>
<p>æ ¹æ®åˆ†ç±»å™¨ç±»åˆ«åˆ†ç±»æ¦‚ç‡åšæ’åº</p>
<p>ã€€ã€€(1)ä»æœ€å¤§æ¦‚ç‡çŸ©å½¢æ¡†å¼€å§‹ï¼Œåˆ†åˆ«å¾—åˆ†åé¢çš„çŸ©å½¢æ¡†ä¸å…¶çš„é‡å åº¦IOUæ˜¯å¦å¤§äºæŸä¸ªè®¾å®šçš„é˜ˆå€¼;</p>
<p>ã€€ã€€(2)å‡è®¾é‡å åº¦è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±æ‰”æ‰ï¼›å¹¶æ ‡è®°ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œæ˜¯æˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ã€‚</p>
<p>ã€€ã€€(3)ä»å‰©ä¸‹çš„çŸ©å½¢æ¡†ä¸­ï¼Œé€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ï¼Œç„¶ååˆ¤æ–­å¾—åˆ†åé¢çš„çŸ©å½¢æ¡†ä¸å…¶çš„é‡å åº¦ï¼Œé‡å åº¦å¤§äºä¸€å®šçš„é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±æ‰”æ‰ï¼›å¹¶æ ‡è®°æ˜¯æˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ã€‚</p>
<p>ã€€ã€€å¦‚æ­¤å¾ªç¯å¾€å¤çŸ¥é“æ²¡æœ‰å‰©ä½™çš„çŸ©å½¢æ¡†ï¼Œç„¶åæ‰¾åˆ°æ‰€æœ‰è¢«ä¿ç•™ä¸‹æ¥çš„çŸ©å½¢æ¡†ï¼Œå°±æ˜¯æˆ‘ä»¬è®¤ä¸ºæœ€å¯èƒ½åŒ…å«ç›®æ ‡çš„çŸ©å½¢æ¡†ã€‚</p>
<p><strong>R-CNNç®—æ³•ä¸­NMSçš„å…·ä½“åšæ³•</strong>ï¼š</p>
<p>ã€€ã€€å‡è®¾æœ‰20ç±»ï¼Œ2000ä¸ªå»ºè®®æ¡†ï¼Œæœ€åè¾“å‡ºå‘é‡ç»´æ•°2000*20ï¼Œåˆ™æ¯åˆ—å¯¹åº”ä¸€ç±»ï¼Œä¸€è¡Œæ˜¯å„ä¸ªå»ºè®®æ¡†çš„å¾—åˆ†ï¼ŒNMSç®—æ³•æ­¥éª¤å¦‚ä¸‹ï¼š<br>ã€€ã€€â‘  å¯¹2000Ã—20ç»´çŸ©é˜µä¸­æ¯åˆ—æŒ‰ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼›<br>ã€€ã€€â‘¡ ä»æ¯åˆ—æœ€å¤§çš„å¾—åˆ†å»ºè®®æ¡†å¼€å§‹ï¼Œåˆ†åˆ«ä¸è¯¥åˆ—åé¢çš„å¾—åˆ†å»ºè®®æ¡†è¿›è¡ŒIoUè®¡ç®—ï¼Œè‹¥IoU&gt;é˜ˆå€¼ï¼Œåˆ™å‰”é™¤å¾—åˆ†è¾ƒå°çš„å»ºè®®æ¡†ï¼Œå¦åˆ™è®¤ä¸ºå›¾åƒä¸­å­˜åœ¨å¤šä¸ªåŒä¸€ç±»ç‰©ä½“ï¼›<br>ã€€ã€€â‘¢ ä»æ¯åˆ—æ¬¡å¤§çš„å¾—åˆ†å»ºè®®æ¡†å¼€å§‹ï¼Œé‡å¤æ­¥éª¤â‘¡ï¼›<br>ã€€ã€€â‘£ é‡å¤æ­¥éª¤â‘¢ç›´åˆ°éå†å®Œè¯¥åˆ—æ‰€æœ‰å»ºè®®æ¡†ï¼›<br>ã€€ã€€â‘¤ éå†å®Œ2000Ã—20ç»´çŸ©é˜µæ‰€æœ‰åˆ—ï¼Œå³æ‰€æœ‰ç‰©ä½“ç§ç±»éƒ½åšä¸€ééæå¤§å€¼æŠ‘åˆ¶ï¼›<br>ã€€ã€€â‘¥ æœ€åå‰”é™¤å„ä¸ªç±»åˆ«ä¸­å‰©ä½™å»ºè®®æ¡†å¾—åˆ†å°‘äºè¯¥ç±»åˆ«é˜ˆå€¼çš„å»ºè®®æ¡†ã€‚</p>
<p><strong>é€‰æ‹©æ€§æœç´¢(Selective Search)</strong></p>
<p>æ»‘çª—æ³•ç±»ä¼¼ç©·ä¸¾è¿›è¡Œå›¾åƒå­åŒºåŸŸæœç´¢ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹å›¾åƒä¸­å¤§éƒ¨åˆ†å­åŒºåŸŸæ˜¯æ²¡æœ‰ç‰©ä½“çš„ã€‚å­¦è€…ä»¬è‡ªç„¶è€Œç„¶æƒ³åˆ°åªå¯¹å›¾åƒä¸­æœ€æœ‰å¯èƒ½åŒ…å«ç‰©ä½“çš„åŒºåŸŸè¿›è¡Œæœç´¢ä»¥æ­¤æ¥æé«˜è®¡ç®—æ•ˆç‡ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/1423648-20190317100459585-1587811888.png" alt></p>
<p>é€‰æ‹©æœç´¢ç®—æ³•çš„ä¸»è¦è§‚ç‚¹ï¼šå›¾åƒä¸­ç‰©ä½“å¯èƒ½å­˜åœ¨çš„åŒºåŸŸåº”è¯¥æ˜¯æœ‰æŸäº›ç›¸ä¼¼æ€§æˆ–è€…è¿ç»­æ€§åŒºåŸŸçš„ã€‚å› æ­¤ï¼Œé€‰æ‹©æœç´¢åŸºäºä¸Šé¢è¿™ä¸€æƒ³æ³•é‡‡ç”¨å­åŒºåŸŸåˆå¹¶çš„æ–¹æ³•è¿›è¡Œæå–å€™é€‰è¾¹ç•Œæ¡†ï¼ˆbounding boxesï¼‰ã€‚é¦–å…ˆï¼Œå¯¹è¾“å…¥å›¾åƒè¿›è¡Œåˆ†å‰²ç®—æ³•äº§ç”Ÿè®¸å¤šå°çš„å­åŒºåŸŸ(å¤§çº¦2000ä¸ªå­åŒºåŸŸ)ã€‚å…¶æ¬¡ï¼Œæ ¹æ®è¿™äº›å­åŒºåŸŸä¹‹é—´ç›¸ä¼¼æ€§(ç›¸ä¼¼æ€§æ ‡å‡†ä¸»è¦æœ‰é¢œè‰²ã€çº¹ç†ã€å¤§å°ç­‰ç­‰)è¿›è¡ŒåŒºåŸŸåˆå¹¶ï¼Œä¸æ–­çš„è¿›è¡ŒåŒºåŸŸè¿­ä»£åˆå¹¶ã€‚æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­å¯¹è¿™äº›åˆå¹¶çš„å­åŒºåŸŸåšå¤–åˆ‡çŸ©å½¢ï¼ˆbounding boxesï¼‰ï¼Œè¿™äº›å­åŒºåŸŸå¤–åˆ‡çŸ©å½¢å°±æ˜¯é€šå¸¸æ‰€è¯´çš„å€™é€‰æ¡†ã€‚</p>
<p>ä¼˜ç‚¹ï¼š<br>ã€€ã€€ã€€ã€€ï¼ˆaï¼‰è®¡ç®—æ•ˆç‡ä¼˜äºæ»‘çª—æ³•ã€‚<br>ã€€ã€€ã€€ã€€ï¼ˆbï¼‰ç”±äºé‡‡ç”¨å­åŒºåŸŸåˆå¹¶ç­–ç•¥ï¼Œæ‰€ä»¥å¯ä»¥åŒ…å«å„ç§å¤§å°çš„ç–‘ä¼¼ç‰©ä½“æ¡†ã€‚<br>ã€€ã€€ã€€ã€€ï¼ˆcï¼‰åˆå¹¶åŒºåŸŸç›¸ä¼¼çš„æŒ‡æ ‡å¤šæ ·æ€§ï¼Œæé«˜äº†æ£€æµ‹ç‰©ä½“çš„æ¦‚ç‡ã€‚</p>
<h3 id="è¾¹ç•Œæ¡†å›å½’-Bounding-Box-regression"><a href="#è¾¹ç•Œæ¡†å›å½’-Bounding-Box-regression" class="headerlink" title="è¾¹ç•Œæ¡†å›å½’(Bounding-Box regression)"></a>è¾¹ç•Œæ¡†å›å½’(Bounding-Box regression)</h3><p>çª—å£ä¸€èˆ¬ä½¿ç”¨å››ç»´å‘é‡$(x,y,w,h)$æ¥è¡¨ç¤ºï¼Œ åˆ†åˆ«è¡¨ç¤ºçª—å£çš„ä¸­å¿ƒç‚¹åæ ‡å’Œå®½é«˜ã€‚ å¯¹äºä¸‹å›¾, çº¢è‰²çš„æ¡† $P$ ä»£è¡¨åŸå§‹çš„Proposal, ç»¿è‰²çš„æ¡† $G$ ä»£è¡¨ç›®æ ‡çš„ Ground Truthï¼Œ ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ç§å…³ç³»ä½¿å¾—è¾“å…¥åŸå§‹çš„çª—å£ $P$ ç»è¿‡æ˜ å°„å¾—åˆ°ä¸€ä¸ªè·ŸçœŸå®çª—å£ $G$ æ›´æ¥è¿‘çš„å›å½’çª—å£$\hat{G}$ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/TIM%E5%9B%BE%E7%89%8720200106182123.png" alt></p>
<p>è¾¹æ¡†å›å½’çš„ç›®çš„æ—¢æ˜¯ï¼šç»™å®š$\left(P_{x}, P_{y}, P_{w}, P_{h}\right)$å¯»æ‰¾ä¸€ç§æ˜ å°„$f$ï¼Œ ä½¿å¾—$f\left(P_{x}, P_{y}, P_{w}, P_{h}\right)=\left(\hat{G}_{x}, \hat{G}_{y}, \hat{G}_{w}, \hat{G}_{h}\right)$å¹¶ä¸”$\left(\hat{G}_{x}, \hat{G}_{y}, \hat{G}_{w}, \hat{G}_{h}\right) \approx\left(G_{x}, G_{y}, G_{w}, G_{h}\right)$</p>
<p>æ€è·¯: å¹³ç§» + å°ºåº¦æ”¾ç¼©</p>
<ol>
<li><p>å…ˆåšå¹³ç§»$(\Delta x, \Delta y), \quad \Delta x=P_{w} d_{x}(P), \Delta y=P_{h} d_{y}(P)$</p>
<p>$\hat{G}_{x}=P_{w} d_{x}(P)+P_{x}$<br>$\hat{G}_{y}=P_{h} d_{y}(P)+P_{y}$</p>
</li>
<li><p>ç„¶åå†åšå°ºåº¦ç¼©æ”¾$\left(S_{w}, S_{h}\right), S_{w}=\exp \left(d_{w}(P)\right), S_{h}=\exp \left(d_{h}(P)\right)$</p>
<p>$\hat{G}_{w}=P_{w} \exp \left(d_{w}(P)\right)$<br>$\hat{G}_{h}=P_{h} \exp \left(d_{h}(P)\right)$</p>
</li>
</ol>
<p>è¾¹æ¡†å›å½’å°±æ˜¯å­¦ä¹ $d_{x}(P), d_{y}(P), d_{w}(P), d_{h}(P)$è¿™å››ä¸ªå˜æ¢ã€‚</p>
<p>çº¿æ€§å›å½’å°±æ˜¯ç»™å®šè¾“å…¥çš„ç‰¹å¾å‘é‡$X$, å­¦ä¹ ä¸€ç»„å‚æ•° $W$, ä½¿å¾—ç»è¿‡çº¿æ€§å›å½’åçš„å€¼è·ŸçœŸå®å€¼ $Y$(Ground Truth)éå¸¸æ¥è¿‘. å³$Y â‰ˆ WX$ã€‚</p>
<p>è¾“å…¥ä¸ºï¼š$P=\left(P_{x}, P_{y}, P_{w}, P_{h}\right)$è¿™ä¸ªçª—å£å¯¹åº”çš„ CNN ç‰¹å¾(æ³¨ï¼šè®­ç»ƒé˜¶æ®µè¾“å…¥è¿˜åŒ…æ‹¬ Ground Truthï¼Œ ä¹Ÿå°±æ˜¯ä¸‹è¾¹æåˆ°çš„$t_{*}=\left(t_{x}, t_{y}, t_{w}, t_{h}\right)$ )</p>
<p>è¾“å‡ºä¸ºï¼šå››ä¸ªå˜æ¢ï¼Œå› ä¸ºæœ‰äº†è¿™å››ä¸ªå˜æ¢æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¾—åˆ° Ground Truthï¼ŒçœŸå®å€¼æ‰€å¯¹åº”çš„çœŸæ­£çš„å˜åŒ–ä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned}
&t_{x}=\left(G_{x}-P_{x}\right) / P_{w}\\
&t_{y}=\left(G_{y}-P_{y}\right) / P_{h}\\
&t_{w}=\log \left(G_{w} / P_{w}\right)\\
&t_{h}=\log \left(G_{h} / P_{h}\right)
\end{aligned}</script><p>ç›®æ ‡å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸º$d_{<em>}(P)=w_{</em>}^{T} \Phi_{5}(P)$ï¼Œ $\Phi_{5}(P)$æ˜¯è¾“å…¥ Proposal çš„ç‰¹å¾å‘é‡ï¼Œ $w_{<em>}$æ˜¯è¦å­¦ä¹ çš„å‚æ•°ï¼ˆ</em> è¡¨ç¤º $x,y,w,h$ï¼Œ ä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå˜æ¢å¯¹åº”ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼‰, $d_{*}(P)$ æ˜¯å¾—åˆ°çš„é¢„æµ‹å€¼ã€‚</p>
<p>æŸå¤±å‡½æ•°ï¼šè¦è®©é¢„æµ‹å€¼è·ŸçœŸå®å€¼$t_{*}=\left(t_{x}, t_{y}, t_{w}, t_{h}\right)$å·®è·æœ€å°</p>
<script type="math/tex; mode=display">
Loss=\sum_{i}^{N}\left(t_{*}^{i}-\hat{w}_{*}^{T} \phi_{5}\left(P^{i}\right)\right)^{2}</script><p>å‡½æ•°ä¼˜åŒ–ç›®æ ‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
W_{*}=\operatorname{argmin}_{w_{*}} \sum_{i}^{N}\left(t_{*}^{i}-\hat{w}_{*}^{T} \phi_{5}\left(P^{i}\right)\right)^{2}+\lambda\left\|\hat{w}_{*}\right\|^{2}</script><h3 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h3><p>Rich feature hierarchies for accurate object detection and semantic segmentation(CVPR 2014)</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_09-57-14.jpg" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨Selective Searchæå–å¤§çº¦2000ä¸ªå€™é€‰åŒºåŸŸï¼ˆproposalï¼‰;</li>
<li>å¯¹æ¯ä¸ªå€™é€‰åŒºåŸŸçš„å›¾åƒè¿›è¡Œæ‹‰ä¼¸å½¢å˜ï¼Œä½¿ä¹‹æˆä¸ºå›ºå®šå¤§å°çš„æ­£æ–¹å½¢å›¾åƒï¼Œå¹¶å°†è¯¥å›¾åƒè¾“å…¥åˆ°CNNä¸­æå–ç‰¹å¾;</li>
<li>ä½¿ç”¨çº¿æ€§çš„SVMå¯¹æå–çš„ç‰¹å¾è¿›è¡Œåˆ†ç±»ã€‚</li>
</ul>
<p><strong>åˆ›æ–°ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†å¤§å‹å·ç§¯ç¥ç»ç½‘ç»œ(CNNs)åº”ç”¨äºè‡ªä¸‹è€Œä¸Šçš„å€™é€‰åŒºåŸŸä»¥å®šä½å’Œåˆ†å‰²ç‰©ä½“ã€‚</li>
<li>å½“å¸¦æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ä¸è¶³æ—¶ï¼Œå…ˆé’ˆå¯¹è¾…åŠ©ä»»åŠ¡è¿›è¡Œæœ‰ç›‘ç£é¢„è®­ç»ƒï¼Œå†è¿›è¡Œç‰¹å®šä»»åŠ¡çš„è°ƒä¼˜ï¼Œå°±å¯ä»¥äº§ç”Ÿæ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚</li>
</ul>
<p><strong>R-CNNå›¾ç‰‡ç¼©æ”¾</strong></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20180425214236957.png" alt></p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><p><strong>é‡å¤è®¡ç®—</strong> R-CNNè™½ç„¶ä¸å†æ˜¯ç©·ä¸¾ï¼Œä½†é€šè¿‡Proposalï¼ˆSelective Searchï¼‰çš„æ–¹æ¡ˆä¾ç„¶æœ‰ä¸¤åƒä¸ªå·¦å³çš„å€™é€‰æ¡†ï¼Œè¿™äº›å€™é€‰æ¡†éƒ½éœ€è¦å•ç‹¬ç»è¿‡backboneç½‘ç»œæå–ç‰¹å¾ï¼Œè®¡ç®—é‡ä¾ç„¶å¾ˆå¤§ï¼Œå€™é€‰æ¡†ä¹‹é—´ä¼šæœ‰é‡å ï¼Œå› æ­¤æœ‰ä¸å°‘å…¶å®æ˜¯é‡å¤è®¡ç®—ã€‚</p>
</li>
<li><p><strong>è®­ç»ƒæµ‹è¯•ä¸ç®€æ´</strong> å€™é€‰åŒºåŸŸæå–ã€ç‰¹å¾æå–ã€åˆ†ç±»ã€å›å½’éƒ½æ˜¯åˆ†å¼€æ“ä½œï¼Œä¸­é—´æ•°æ®è¿˜éœ€è¦å•ç‹¬ä¿å­˜ã€‚</p>
</li>
<li><p><strong>é€Ÿåº¦æ…¢</strong> å‰é¢çš„ç¼ºç‚¹æœ€ç»ˆå¯¼è‡´R-CNNå‡ºå¥‡çš„æ…¢ï¼ŒGPUä¸Šå¤„ç†ä¸€å¼ å›¾ç‰‡éœ€è¦åå‡ ç§’ï¼ŒCPUä¸Šåˆ™éœ€è¦æ›´é•¿æ—¶é—´ã€‚</p>
</li>
<li><p><strong>è¾“å…¥çš„å›¾ç‰‡Patchå¿…é¡»å¼ºåˆ¶ç¼©æ”¾æˆå›ºå®šå¤§å°</strong> ï¼ˆåŸæ–‡é‡‡ç”¨227Ã—227ï¼‰ï¼Œä¼šé€ æˆç‰©ä½“å½¢å˜ï¼Œå¯¼è‡´æ£€æµ‹æ€§èƒ½ä¸‹é™ã€‚</p>
</li>
</ul>
<h3 id="SPP-Net"><a href="#SPP-Net" class="headerlink" title="SPP-Net"></a>SPP-Net</h3><p>Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition(ECCV 2014)</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_10-28-09.jpg" alt></p>
<p>å·ç§¯å±‚çš„å‚æ•°å’Œè¾“å…¥å›¾åƒçš„å°ºå¯¸æ— å…³ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå·ç§¯æ ¸åœ¨å›¾åƒä¸Šæ»‘åŠ¨ï¼Œä¸ç®¡è¾“å…¥å›¾åƒæ˜¯å¤šå°‘éƒ½æ²¡å…³ç³»ï¼Œåªæ˜¯å¯¹ä¸åŒå¤§å°çš„å›¾ç‰‡å·ç§¯å‡ºä¸åŒå¤§å°çš„ç‰¹å¾å›¾ï¼Œæ± åŒ–å±‚å¯¹è¾“å…¥å›¾åƒçš„å°ºå¯¸ä¹Ÿæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œåªæ˜¯è·å¾—ä¸åŒçš„ç‰¹å¾å›¾è€Œå·²ï¼Œä½†æ˜¯å…¨è¿æ¥å±‚çš„å‚æ•°å°±å’Œè¾“å…¥å›¾åƒå¤§å°æœ‰å…³ï¼Œå› ä¸ºå®ƒè¦æŠŠè¾“å…¥çš„æ‰€æœ‰åƒç´ ç‚¹è¿æ¥èµ·æ¥,éœ€è¦æŒ‡å®šè¾“å…¥å±‚ç¥ç»å…ƒä¸ªæ•°å’Œè¾“å‡ºå±‚ç¥ç»å…ƒä¸ªæ•°ï¼Œæ‰€ä»¥éœ€è¦è§„å®šè¾“å…¥çš„featureçš„å¤§å°ã€‚</p>
<p>é€šè¿‡åœ¨å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚ä¹‹é—´åŠ å…¥ç©ºé—´é‡‘å­—å¡”æ± åŒ–ç»“æ„ï¼ˆSpatial Pyramid Poolingï¼‰ä»£æ›¿R-CNNç®—æ³•åœ¨è¾“å…¥å·ç§¯ç¥ç»ç½‘ç»œå‰å¯¹å„ä¸ªå€™é€‰åŒºåŸŸè¿›è¡Œå‰ªè£ã€ç¼©æ”¾æ“ä½œä½¿å…¶å›¾åƒå­å—å°ºå¯¸ä¸€è‡´çš„åšæ³•ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹</strong>ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡é€‰æ‹©æ€§æœç´¢ï¼Œå¯¹å¾…æ£€æµ‹çš„å›¾ç‰‡è¿›è¡Œæœç´¢å‡º2000ä¸ªå€™é€‰çª—å£ã€‚è¿™ä¸€æ­¥å’ŒR-CNNä¸€æ ·ã€‚</li>
<li>ç‰¹å¾æå–é˜¶æ®µã€‚è¿™ä¸€æ­¥å°±æ˜¯å’ŒR-CNNæœ€å¤§çš„åŒºåˆ«äº†ï¼ŒåŒæ ·æ˜¯ç”¨å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œç‰¹å¾æå–ï¼Œä½†æ˜¯SPP-Netç”¨çš„æ˜¯é‡‘å­—å¡”æ± åŒ–ã€‚è¿™ä¸€æ­¥éª¤çš„å…·ä½“æ“ä½œå¦‚ä¸‹ï¼šæŠŠæ•´å¼ å¾…æ£€æµ‹çš„å›¾ç‰‡ï¼Œè¾“å…¥CNNä¸­ï¼Œè¿›è¡Œä¸€æ¬¡æ€§ç‰¹å¾æå–ï¼Œå¾—åˆ°feature mapsï¼Œç„¶ååœ¨feature mapsä¸­æ‰¾åˆ°å„ä¸ªå€™é€‰æ¡†çš„åŒºåŸŸï¼Œå†å¯¹å„ä¸ªå€™é€‰æ¡†é‡‡ç”¨é‡‘å­—å¡”ç©ºé—´æ± åŒ–ï¼Œæå–å‡ºå›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡ã€‚è€ŒR-CNNè¾“å…¥çš„æ˜¯æ¯ä¸ªå€™é€‰æ¡†ï¼Œç„¶ååœ¨è¿›å…¥CNNï¼Œå› ä¸ºSPP-Netåªéœ€è¦ä¸€æ¬¡å¯¹æ•´å¼ å›¾ç‰‡è¿›è¡Œç‰¹å¾æå–ï¼Œé€Ÿåº¦æ›´å¿«å•Šã€‚</li>
<li>æœ€åä¸€æ­¥ä¹Ÿæ˜¯å’ŒR-CNNä¸€æ ·ï¼Œé‡‡ç”¨SVMç®—æ³•è¿›è¡Œç‰¹å¾å‘é‡åˆ†ç±»è¯†åˆ«ã€‚</li>
</ul>
<p><strong>ä¸€æ¬¡ç‰¹å¾æå–</strong><br>RCNNæ˜¯å¤šä¸ªregions+å¤šæ¬¡CNN+å•ä¸ªpoolingï¼Œè€ŒSPPåˆ™æ˜¯å•ä¸ªå›¾åƒ+å•æ¬¡CNN+å¤šä¸ªregion+å¤šä¸ªpooling<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20180425215129861.png" alt></p>
<p><strong>é‡‘å­—å¡”æ± åŒ–ç»“æ„</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_10-41-12.jpg" alt><br>åˆ©ç”¨ä¸åŒå¤§å°çš„åˆ»åº¦ï¼Œå¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œäº†åˆ’åˆ†ã€‚å›¾ä¸­ï¼Œåˆ©ç”¨äº†ä¸‰ç§ä¸åŒå¤§å°çš„åˆ»åº¦ï¼Œå¯¹ä¸€å¼ è¾“å…¥çš„å›¾ç‰‡è¿›è¡Œäº†åˆ’åˆ†ï¼Œæœ€åæ€»å…±å¯ä»¥å¾—åˆ°16+4+1=21ä¸ªå—ï¼Œä»è¿™21ä¸ªå›¾ç‰‡å—ä¸­ï¼Œåˆ†åˆ«è®¡ç®—æ¯ä¸ªå—çš„æœ€å¤§å€¼ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªè¾“å‡ºç‰¹å¾å‘é‡ã€‚æœ€åæŠŠä¸€å¼ ä»»æ„å¤§å°çš„å›¾ç‰‡è½¬æ¢æˆäº†ä¸€ä¸ªå›ºå®šå¤§å°çš„21ç»´ç‰¹å¾ï¼ˆå½“ç„¶å¯ä»¥è®¾è®¡å…¶å®ƒç»´æ•°çš„è¾“å‡ºï¼Œå¢åŠ é‡‘å­—å¡”çš„å±‚æ•°ï¼Œæˆ–è€…æ”¹å˜åˆ’åˆ†ç½‘æ ¼çš„å¤§å°ï¼‰ã€‚ä¸Šé¢çš„ä¸‰ç§ä¸åŒåˆ»åº¦çš„åˆ’åˆ†ï¼Œæ¯ä¸€ç§åˆ»åº¦ç§°ä¹‹ä¸ºé‡‘å­—å¡”çš„ä¸€å±‚ï¼Œä½¿ç”¨å¤šä¸ªä¸åŒåˆ»åº¦çš„å±‚ï¼Œå¯ä»¥æé«˜æ‰€æå–ç‰¹å¾çš„é²æ£’æ€§ã€‚æ¯ä¸€ä¸ªå›¾ç‰‡å—å¤§å°ç§°ä¹‹ä¸ºï¼šSliding Windows Sizeã€‚å¦‚æœå¸Œæœ›é‡‘å­—å¡”çš„æŸä¸€å±‚è¾“å‡ºnxnä¸ªç‰¹å¾ï¼Œé‚£ä¹ˆå°±è¦ç”¨Windows Sizeå¤§å°ä¸ºï¼š(w/n,h/n)è¿›è¡Œæ± åŒ–ã€‚ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœ(5x5ï¼‰ä¹Ÿè¦å¾—åˆ°3x3çš„è¯ï¼Œè®¡ç®—å¾—åˆ°çš„size=2ï¼Œstride=1ï¼Œåˆ©ç”¨å…¬å¼ç®—å‡ºæ¥å¾—åˆ°çš„æ± åŒ–ä¸ºï¼ˆ4x4ï¼‰ä¸é¢„æœŸçš„3x3ä¸ç¬¦ï¼Œè¿™é‡Œæš‚æ—¶è¿˜æœ‰é—®é¢˜ï¼Œä¸æ¸…æ¥šå…·ä½“åŸå› æ˜¯ä»€ä¹ˆï¼‰ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_10-46-02.jpg" alt></p>
<p><strong>åˆ›æ–°ç‚¹ï¼š</strong></p>
<ul>
<li>åˆ©ç”¨ç©ºé—´é‡‘å­—å¡”æ± åŒ–ç»“æ„ï¼›</li>
<li>å¯¹æ•´å¼ å›¾ç‰‡åªè¿›è¡Œäº†ä¸€æ¬¡ç‰¹å¾æå–ï¼ŒåŠ å¿«è¿ç®—é€Ÿåº¦ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong><br>ã€€    å’ŒR-CNNä¸€æ ·ï¼Œå®ƒçš„è®­ç»ƒè¦ç»è¿‡å¤šä¸ªé˜¶æ®µï¼Œç‰¹å¾ä¹Ÿè¦å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¦å¤–ï¼ŒSPPä¸­çš„å¾®è°ƒåªæ›´æ–°SPPå±‚åé¢çš„å…¨è¿æ¥å±‚ï¼Œå¯¹å¾ˆæ·±çš„ç½‘ç»œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p>
<h3 id="Fast-R-CNN"><a href="#Fast-R-CNN" class="headerlink" title="Fast R-CNN"></a>Fast R-CNN</h3><p>Girshick, R., Fast R-CNN, in 2015 IEEE International Conference on Computer Vision (ICCV). 2015. p. 1440-1448.</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/3940902-7569280b566d0e58.png" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/3940902-5519b489e581557a.png" alt></p>
<p>Fast R-CNNåœ¨ç‰¹å¾æå–ä¸Šå¯ä»¥è¯´å¾ˆå¤§ç¨‹åº¦å€Ÿé‰´äº†SPPnetï¼Œé¦–å…ˆå°†å›¾ç‰‡ç”¨é€‰æ‹©æœç´¢ç®—æ³•ï¼ˆselective searchï¼‰å¾—åˆ°2000ä¸ªå€™é€‰åŒºåŸŸï¼ˆregion proposalsï¼‰çš„åæ ‡ä¿¡æ¯ã€‚å¦ä¸€æ–¹é¢ï¼Œç›´æ¥å°†å›¾ç‰‡å½’ä¸€åŒ–åˆ°CNNéœ€è¦çš„æ ¼å¼ï¼Œæ•´å¼ å›¾ç‰‡é€å…¥CNNï¼ˆæœ¬æ–‡é€‰æ‹©çš„ç½‘ç»œæ˜¯VGGï¼‰ï¼Œå°†ç¬¬äº”å±‚çš„æ™®é€šæ± åŒ–å±‚æ›¿æ¢ä¸ºRoIæ± åŒ–å±‚ï¼Œå›¾ç‰‡ç„¶åç»è¿‡5å±‚å·ç§¯æ“ä½œåï¼Œå¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾ï¼ˆfeature mapsï¼‰ï¼Œå¼€å§‹å¾—åˆ°çš„åæ ‡ä¿¡æ¯é€šè¿‡ä¸€å®šçš„æ˜ å°„å…³ç³»è½¬æ¢ä¸ºå¯¹åº”ç‰¹å¾å›¾çš„åæ ‡ï¼Œæˆªå–å¯¹åº”çš„å€™é€‰åŒºåŸŸï¼Œç»è¿‡RoIå±‚åæå–åˆ°å›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡ï¼Œé€å…¥å…¨è¿æ¥å±‚ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹</strong>:</p>
<ul>
<li>è¾“å…¥çš„æ˜¯ä¸€å¼ å®Œæ•´å›¾ç‰‡å›¾åƒå½’ä¸€åŒ–ä¸º224Ã—224å’Œä¸€ç»„ï¼ˆçº¦2000ä¸ªï¼‰ç‰©ä½“å»ºè®®æ¡†ï¼ˆä¹Ÿå«RoIsï¼‰é€å…¥ç½‘ç»œã€‚</li>
<li>å¯¹Conv feature mapè¿›è¡Œç‰¹å¾æå–ã€‚æ¯ä¸€ä¸ªåŒºåŸŸç»è¿‡RoI pooling layerå’ŒFC layerså¾—åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„feature vectorï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥åˆ°åé¢RoI pooling layerçš„feature mapæ˜¯åœ¨Conv feature mapä¸Šæå–çš„ã€‚è™½ç„¶åœ¨æœ€å¼€å§‹ä¹Ÿæå–å‡ºäº†å¤§é‡çš„RoIï¼Œä½†ä»–ä»¬è¿˜æ˜¯ä½œä¸ºæ•´ä½“è¾“å…¥è¿›å·ç§¯ç½‘ç»œçš„ï¼Œæœ€å¼€å§‹æå–å‡ºçš„RoIåŒºåŸŸåªæ˜¯ä¸ºäº†æœ€åçš„Bounding box å›å½’æ—¶ä½¿ç”¨ï¼Œç”¨æ¥è¾“å‡ºåŸå›¾ä¸­çš„ä½ç½®ã€‚</li>
<li>è¿™äº›ç‰¹å¾å‘é‡åœ¨ç»è¿‡å…¨æ¥è¿å±‚ä¹‹åè¿›å…¥ä¸¤ä¸ªå¹¶åˆ—çš„è¾“å‡ºå±‚ã€‚ç¬¬ä¸€ä¸ªæ˜¯åˆ†ç±»ï¼Œä½¿ç”¨softmaxï¼Œç¬¬äºŒä¸ªæ˜¯æ¯ä¸€ç±»çš„bounding boxå›å½’ã€‚åˆ©ç”¨SoftMax Losså’ŒSmooth L1 Losså¯¹åˆ†ç±»æ¦‚ç‡å’Œè¾¹æ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰è”åˆè®­ç»ƒã€‚<br>æ•´ä¸ªç»“æ„æ˜¯ä½¿ç”¨å¤šä»»åŠ¡æŸå¤±çš„ç«¯åˆ°ç«¯è®­ç»ƒï¼ˆtrained end-to-end with a multi-task lossï¼‰ã€‚</li>
</ul>
<p><strong>ä»€ä¹ˆæ˜¯ROIå‘¢ï¼Ÿ</strong></p>
<p>RoIæ˜¯Region of Interestçš„ç®€å†™ï¼ŒæŒ‡çš„æ˜¯åœ¨â€œ<strong>ç‰¹å¾å›¾ä¸Šçš„æ¡†</strong>â€ï¼›åœ¨Fast RCNNä¸­ï¼Œ RoIæ˜¯æŒ‡Selective Searchå®Œæˆåå¾—åˆ°çš„â€œå€™é€‰æ¡†â€åœ¨ç‰¹å¾å›¾ä¸Šçš„æ˜ å°„;</p>
<p><strong>ROI Poolingçš„è¾“å…¥</strong><br>è¾“å…¥æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç‰¹å¾å›¾ï¼šæŒ‡çš„æ˜¯ç‰¹å¾å›¾ï¼Œåœ¨Fast RCNNä¸­ï¼Œå®ƒä½äºRoI Poolingä¹‹å‰ï¼Œé€šå¸¸æˆ‘ä»¬å¸¸å¸¸ç§°ä¹‹ä¸ºâ€œshare_convâ€ï¼›</li>
<li>ROIS ï¼šåœ¨Fast RCNNä¸­ï¼ŒæŒ‡çš„æ˜¯Selective Searchçš„è¾“å‡ºï¼Œä¸€å †çŸ©å½¢å€™é€‰æ¡†æ¡†ï¼Œå½¢çŠ¶ä¸º1x5x1x1ï¼ˆ4ä¸ªåæ ‡+ç´¢å¼•indexï¼‰ï¼Œå…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåæ ‡çš„å‚è€ƒç³»ä¸æ˜¯é’ˆå¯¹feature mapè¿™å¼ å›¾çš„ï¼Œè€Œæ˜¯é’ˆå¯¹åŸå›¾çš„ï¼ˆç¥ç»ç½‘ç»œæœ€å¼€å§‹çš„è¾“å…¥ï¼‰ã€‚</li>
</ul>
<p><strong>ROI Poolingçš„è¾“å‡º</strong><br>ã€€ã€€è¾“å‡ºæ˜¯batchä¸ªvectorï¼Œå…¶ä¸­batchçš„å€¼ç­‰äºRoIçš„ä¸ªæ•°ï¼Œvectorçš„å¤§å°ä¸ºchannel x w x hï¼›RoI Poolingçš„è¿‡ç¨‹å°±æ˜¯å°†ä¸€ä¸ªä¸ªå¤§å°ä¸åŒçš„boxçŸ©å½¢æ¡†ï¼Œéƒ½æ˜ å°„æˆå¤§å°å›ºå®šï¼ˆw x hï¼‰çš„çŸ©å½¢æ¡†ï¼›</p>
<p><strong>ROI Poolingçš„è¿‡ç¨‹</strong><br>ã€€ã€€å…ˆæŠŠRoIä¸­çš„åæ ‡æ˜ å°„åˆ°feature mapä¸Šï¼Œæ˜ å°„è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠå„ä¸ªåæ ‡é™¤ä»¥â€œè¾“å…¥å›¾ç‰‡ä¸feature mapçš„å¤§å°çš„æ¯”å€¼â€ï¼Œå¾—åˆ°äº†feature mapä¸Šçš„boxåæ ‡åï¼Œä½¿ç”¨Poolingå¾—åˆ°è¾“å‡ºï¼›ç”±äºè¾“å…¥çš„å›¾ç‰‡å¤§å°ä¸ä¸€ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„ç±»ä¼¼Spp Poolingï¼Œåœ¨Poolingçš„è¿‡ç¨‹ä¸­éœ€è¦è®¡ç®—Poolingåçš„ç»“æœå¯¹åº”åˆ°feature mapä¸Šæ‰€å çš„èŒƒå›´ï¼Œç„¶ååœ¨é‚£ä¸ªèŒƒå›´ä¸­è¿›è¡Œå–maxæˆ–è€…å–averageã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/3940902-a6127730f6d21abd.png" alt></p>
<ul>
<li>cls_scoreå±‚ç”¨äºåˆ†ç±»ï¼Œè¾“å‡ºK+1ç»´æ•°ç»„pï¼Œè¡¨ç¤ºå±äºKç±»å’ŒèƒŒæ™¯çš„æ¦‚ç‡ã€‚</li>
<li>bbox_prdictå±‚ç”¨äºè°ƒæ•´å€™é€‰åŒºåŸŸä½ç½®ï¼Œè¾“å‡º4*Kç»´æ•°ç»„tï¼Œè¡¨ç¤ºåˆ†åˆ«å±äºKç±»æ—¶ï¼Œåº”è¯¥å¹³ç§»ç¼©æ”¾çš„å‚æ•°ã€‚</li>
</ul>
<p><strong>æœ€åä¸€ä¸ªé˜¶æ®µçš„ç‰¹å¾è¾“å…¥åˆ°ä¸¤ä¸ªå¹¶è¡Œçš„å…¨è¿å±‚ä¸­ã€‚</strong><br>ä¸€ä¸ªæ˜¯å¯¹åŒºåŸŸçš„åˆ†ç±»Softmaxï¼ˆåŒ…æ‹¬èƒŒæ™¯ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹bounding boxå›å½’çš„å¾®è°ƒã€‚åœ¨SVMå’ŒSoftmaxçš„å¯¹æ¯”å®éªŒä¸­è¯´æ˜ï¼ŒSVMçš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ï¼Œæ•…ç›´æ¥ç”¨Softmaxå°†æ•´ä¸ªç½‘ç»œæ•´åˆè®­ç»ƒæ›´å¥½ã€‚æ€»ä»£ä»·ä¸ºä¸¤è€…åŠ æƒå’Œï¼ŒFast-RCNNæŠŠä¸¤ä¸ªå›å½’çš„lossè¿›è¡Œè”åˆè®­ç»ƒã€‚</p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>æå‡ºRoI Pooling å±‚ï¼Œå®ƒå°†ä¸åŒå¤§å°å€™é€‰æ¡†çš„å·ç§¯ç‰¹å¾å›¾ç»Ÿä¸€é‡‡æ ·æˆå›ºå®šå¤§å°çš„ç‰¹å¾ã€‚</li>
<li>ç‹¬ç«‹çš„SVMåˆ†ç±»å™¨å’Œå›å½’å™¨éœ€è¦å¤§é‡ç‰¹å¾ä½œä¸ºè®­ç»ƒæ ·æœ¬ï¼Œéœ€è¦å¤§é‡çš„ç¡¬ç›˜ç©ºé—´ï¼ŒFast-RCNNæŠŠç±»åˆ«åˆ¤æ–­å’Œä½ç½®å›å½’ç»Ÿä¸€ç”¨æ·±åº¦ç¥ç»ç½‘ç»œå®ç°ï¼Œä¸å†éœ€è¦é¢å¤–å­˜å‚¨ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š<br>æ£€æµ‹é€Ÿåº¦ä»ç„¶å—é™äº Selective Search</p>
<h3 id="Faster-R-CNN"><a href="#Faster-R-CNN" class="headerlink" title="Faster R-CNN"></a>Faster R-CNN</h3><p>Ren, S., et al., Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks. IEEE Trans Pattern Anal Mach Intell, 2017. 39(6): p. 1137-1149.</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/v2-e64a99b38f411c337f538eb5f093bdf3_r.jpg" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong>:</p>
<ul>
<li>æŠŠæ•´å¼ å›¾ç‰‡é€å…¥CNNï¼Œè¿›è¡Œç‰¹å¾æå–ï¼›</li>
<li>åœ¨æœ€åä¸€å±‚å·ç§¯feature mapä¸Šç”Ÿæˆregion proposalï¼ˆé€šè¿‡RPNï¼‰ï¼Œæ¯å¼ å›¾ç‰‡å¤§çº¦300ä¸ªå»ºè®®çª—å£ï¼›</li>
<li>é€šè¿‡RoI poolingå±‚ï¼ˆå…¶å®æ˜¯å•å±‚çš„SPP layerï¼‰ä½¿å¾—æ¯ä¸ªå»ºè®®çª—å£ç”Ÿæˆå›ºå®šå¤§å°çš„feature mapï¼›</li>
<li>ç»§ç»­ç»è¿‡ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼ˆFCï¼‰å¾—åˆ°ç‰¹å¾å‘é‡ã€‚ç‰¹å¾å‘é‡ç»ç”±å„è‡ªçš„FCå±‚ï¼Œå¾—åˆ°ä¸¤ä¸ªè¾“å‡ºå‘é‡ã€‚ç¬¬ä¸€ä¸ªæ˜¯åˆ†ç±»ï¼Œä½¿ç”¨softmaxï¼Œç¬¬äºŒä¸ªæ˜¯æ¯ä¸€ç±»çš„bounding boxå›å½’ã€‚åˆ©ç”¨SoftMax Losså’ŒSmooth L1 Losså¯¹åˆ†ç±»æ¦‚ç‡å’Œè¾¹æ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰è”åˆè®­ç»ƒã€‚</li>
</ul>
<p><strong>Region Proposal Networks</strong>ã€‚RPNç½‘ç»œç”¨äºç”Ÿæˆregion proposalsã€‚è¯¥å±‚é€šè¿‡softmaxåˆ¤æ–­anchorså±äºpositiveæˆ–è€…negativeï¼Œå†åˆ©ç”¨bounding box regressionä¿®æ­£anchorsè·å¾—ç²¾ç¡®çš„proposalsã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/v2-1908feeaba591d28bee3c4a754cca282_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°RPNç½‘ç»œå®é™…åˆ†ä¸º2æ¡çº¿ï¼Œä¸Šé¢ä¸€æ¡é€šè¿‡softmaxåˆ†ç±»anchorsè·å¾—positiveå’Œnegativeåˆ†ç±»ï¼Œä¸‹é¢ä¸€æ¡ç”¨äºè®¡ç®—å¯¹äºanchorsçš„bounding box regressionåç§»é‡ï¼Œä»¥è·å¾—ç²¾ç¡®çš„proposalã€‚è€Œæœ€åçš„Proposalå±‚åˆ™è´Ÿè´£ç»¼åˆpositive anchorså’Œå¯¹åº”bounding box regressionåç§»é‡è·å–proposalsï¼ŒåŒæ—¶å‰”é™¤å¤ªå°å’Œè¶…å‡ºè¾¹ç•Œçš„proposalsã€‚</p>
<p>æ‰€è°“anchorsï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç»„ç”±rpn/generate_anchors.pyç”Ÿæˆçš„çŸ©å½¢ã€‚ç›´æ¥è¿è¡Œä½œè€…demoä¸­çš„generate_anchors.pyå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[ -84.  -40.   99.   55.]</span><br><span class="line"> [-176.  -88.  191.  103.]</span><br><span class="line"> [-360. -184.  375.  199.]</span><br><span class="line"> [ -56.  -56.   71.   71.]</span><br><span class="line"> [-120. -120.  135.  135.]</span><br><span class="line"> [-248. -248.  263.  263.]</span><br><span class="line"> [ -36.  -80.   51.   95.]</span><br><span class="line"> [ -80. -168.   95.  183.]</span><br><span class="line"> [-168. -344.  183.  359.]]</span><br></pre></td></tr></table></figure><br>å…¶ä¸­æ¯è¡Œçš„4ä¸ªå€¼$\left(x_{1}, y_{1}, x_{2}, y_{2}\right)$è¡¨çŸ©å½¢å·¦ä¸Šå’Œå³ä¸‹è§’ç‚¹åæ ‡ã€‚9ä¸ªçŸ©å½¢å…±æœ‰3ç§å½¢çŠ¶ï¼Œé•¿å®½æ¯”ä¸ºå¤§çº¦ä¸ºwidth: height $\in\{1: 1,1: 2,2: 1\}$ä¸‰ç§ï¼Œå¦‚å›¾ã€‚å®é™…ä¸Šé€šè¿‡anchorså°±å¼•å…¥äº†æ£€æµ‹ä¸­å¸¸ç”¨åˆ°çš„å¤šå°ºåº¦æ–¹æ³•ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/v2-7abead97efcc46a3ee5b030a2151643f_hd.jpg" alt></p>
<p>æ³¨ï¼šå…³äºä¸Šé¢çš„anchors sizeï¼Œå…¶å®æ˜¯æ ¹æ®æ£€æµ‹å›¾åƒè®¾ç½®çš„ã€‚åœ¨python demoä¸­ï¼Œä¼šæŠŠä»»æ„å¤§å°çš„è¾“å…¥å›¾åƒreshapeæˆ800x600ã€‚å†å›å¤´æ¥çœ‹anchorsçš„å¤§å°ï¼Œanchorsä¸­é•¿å®½1:2ä¸­æœ€å¤§ä¸º352x704ï¼Œé•¿å®½2:1ä¸­æœ€å¤§736x384ï¼ŒåŸºæœ¬æ˜¯coveräº†800x600çš„å„ä¸ªå°ºåº¦å’Œå½¢çŠ¶ã€‚</p>
<p><strong>é‚£ä¹ˆè¿™9ä¸ªanchorsæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</strong>éå†Conv layersè®¡ç®—è·å¾—çš„feature mapsï¼Œä¸ºæ¯ä¸€ä¸ªç‚¹éƒ½é…å¤‡è¿™9ç§anchorsä½œä¸ºåˆå§‹çš„æ£€æµ‹æ¡†ã€‚è¿™æ ·åšè·å¾—æ£€æµ‹æ¡†å¾ˆä¸å‡†ç¡®ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåé¢è¿˜æœ‰2æ¬¡bounding box regressionå¯ä»¥ä¿®æ­£æ£€æµ‹æ¡†ä½ç½®ã€‚</p>
<p><strong>å…¶å®RPNæœ€ç»ˆå°±æ˜¯åœ¨åŸå›¾å°ºåº¦ä¸Šï¼Œè®¾ç½®äº†å¯†å¯†éº»éº»çš„å€™é€‰Anchorã€‚ç„¶åç”¨cnnå»åˆ¤æ–­å“ªäº›Anchoræ˜¯é‡Œé¢æœ‰ç›®æ ‡çš„positive anchorï¼Œå“ªäº›æ˜¯æ²¡ç›®æ ‡çš„negative anchorã€‚æ‰€ä»¥ï¼Œä»…ä»…æ˜¯ä¸ªäºŒåˆ†ç±»è€Œå·²ï¼</strong></p>
<p>ä¸€å‰¯MxNå¤§å°çš„çŸ©é˜µé€å…¥Faster RCNNç½‘ç»œåï¼Œåˆ°RPNç½‘ç»œå˜ä¸º(M/16)x(N/16)ï¼Œä¸å¦¨è®¾ W=M/16ï¼ŒH=N/16ã€‚åœ¨è¿›å…¥reshapeä¸softmaxä¹‹å‰ï¼Œå…ˆåšäº†1x1å·ç§¯<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/v2-1ab4b6c3dd607a5035b5203c76b078f3_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°å…¶num_output=18ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡è¯¥å·ç§¯çš„è¾“å‡ºå›¾åƒä¸ºWxHx18å¤§å°ã€‚è¿™ä¹Ÿå°±åˆšå¥½å¯¹åº”äº†feature mapsæ¯ä¸€ä¸ªç‚¹éƒ½æœ‰9ä¸ªanchorsï¼ŒåŒæ—¶æ¯ä¸ªanchorsåˆæœ‰å¯èƒ½æ˜¯positiveå’Œnegativeï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜WxHx(9<em>2)å¤§å°çš„çŸ©é˜µã€‚<em>*ä¸ºä½•è¿™æ ·åšï¼Ÿ</em></em>åé¢æ¥softmaxåˆ†ç±»è·å¾—positive anchorsï¼Œä¹Ÿå°±ç›¸å½“äºåˆæ­¥æå–äº†æ£€æµ‹ç›®æ ‡å€™é€‰åŒºåŸŸboxï¼ˆä¸€èˆ¬è®¤ä¸ºç›®æ ‡åœ¨positive anchorsä¸­ï¼‰ã€‚</p>
<p><strong>é‚£ä¹ˆä¸ºä½•è¦åœ¨softmaxå‰åéƒ½æ¥ä¸€ä¸ªreshape layerï¼Ÿ</strong>å…¶å®åªæ˜¯ä¸ºäº†ä¾¿äºsoftmaxåˆ†ç±»,å­˜å‚¨å½¢å¼ä¸º[1, 2x9, H, W]ã€‚è€Œåœ¨softmaxåˆ†ç±»æ—¶éœ€è¦è¿›è¡Œpositive/negativeäºŒåˆ†ç±»ï¼Œæ‰€ä»¥reshape layerä¼šå°†å…¶å˜ä¸º[1, 2, 9xH, W]å¤§å°ï¼Œå³å•ç‹¬â€œè…¾ç©ºâ€å‡ºæ¥ä¸€ä¸ªç»´åº¦ä»¥ä¾¿softmaxåˆ†ç±»ï¼Œä¹‹åå†reshapeå›å¤åŸçŠ¶ã€‚</p>
<p>RPNç½‘ç»œä¸­åˆ©ç”¨anchorså’Œsoftmaxåˆæ­¥æå–å‡ºpositive anchorsä½œä¸ºå€™é€‰åŒºåŸŸï¼ˆå¦å¤–ä¹Ÿæœ‰å®ç°ç”¨sigmoidä»£æ›¿softmaxï¼ŒåŸç†ç±»ä¼¼ï¼‰ã€‚</p>
<p><strong>å¯¹proposalsè¿›è¡Œbounding box regression</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/v2-8241c8076d60156248916fe2f1a5674a_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°å…¶ num_output=36ï¼Œå³ç»è¿‡è¯¥å·ç§¯è¾“å‡ºå›¾åƒä¸ºWxHx36ï¼Œè¿™é‡Œç›¸å½“äºfeature mapsæ¯ä¸ªç‚¹éƒ½æœ‰9ä¸ªanchorsï¼Œæ¯ä¸ªanchorsåˆéƒ½æœ‰4ä¸ªç”¨äºå›å½’çš„$\left[d_{x}(A), d_{y}(A), d_{w}(A), d_{h}(A)\right]$å˜åŒ–é‡</p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>é‡‡ç”¨RPN(Region Proposal Network)ä»£æ›¿é€‰æ‹©æ€§æœç´¢(Selective Search)ï¼Œåˆ©ç”¨GPUè¿›è¡Œè®¡ç®—å¤§å¹…åº¦ç¼©å‡æå–region proposalçš„é€Ÿåº¦ã€‚</li>
<li>äº§ç”Ÿå»ºè®®çª—å£çš„CNNå’Œç›®æ ‡æ£€æµ‹çš„CNNå…±äº«ã€‚</li>
</ul>
<p>åœ¨ä¸»å¹²ç½‘ç»œä¸­å¢åŠ äº†RPN ï¼ˆRegion Proposal Networkï¼‰ç½‘ç»œï¼Œé€šè¿‡ä¸€å®šè§„åˆ™è®¾ç½®ä¸åŒå°ºåº¦çš„é”šç‚¹ï¼ˆAnchorï¼‰åœ¨RPNçš„å·ç§¯ç‰¹å¾å±‚æå–å€™é€‰æ¡†æ¥ä»£æ›¿Selective Searchç­‰ä¼ ç»Ÿçš„å€™é€‰æ¡†ç”Ÿæˆæ–¹æ³•ï¼Œå®ç°äº†ç½‘ç»œçš„ç«¯åˆ°ç«¯è®­ç»ƒã€‚å€™é€‰åŒºåŸŸç”Ÿæˆã€å€™é€‰åŒºåŸŸç‰¹å¾æå–ã€æ¡†å›å½’å’Œåˆ†ç±»å…¨è¿‡ç¨‹ä¸€æ°”å‘µæˆï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¨¡å‹å„éƒ¨åˆ†ä¸ä»…å­¦ä¹ å¦‚ä½•å®Œæˆè‡ªå·±çš„ä»»åŠ¡ï¼Œè¿˜è‡ªä¸»å­¦ä¹ å¦‚ä½•ç›¸äº’é…åˆã€‚è¿™ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚</p>
<h3 id="YOLO"><a href="#YOLO" class="headerlink" title="YOLO"></a>YOLO</h3><p>Redmon, J., et al., You Only Look Once: Unified, Real-Time Object Detection, in 2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). 2016. p. 779-788.</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/6983308-d54136f1eb0cd733.png" alt></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/6983308-0d1e8d42480e1c1a.png" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong></p>
<ul>
<li>å°†å›¾åƒresizeåˆ°448 * 448ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ ï¼›</li>
<li>è¿è¡Œç¥ç»ç½‘ç»œï¼Œå¾—åˆ°ä¸€äº›bounding boxåæ ‡ã€boxä¸­åŒ…å«ç‰©ä½“çš„ç½®ä¿¡åº¦å’Œclass probabilities ï¼›</li>
<li>è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶ï¼Œç­›é€‰Boxesã€‚</li>
</ul>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>YOLOå°†ç›®æ ‡æ£€æµ‹é—®é¢˜è½¬åŒ–ä¸ºå›å½’é—®é¢˜ï¼Œä¸éœ€è¦å¤æ‚çš„æµç¨‹ã€‚åœ¨å®æ—¶æ£€æµ‹ç³»ç»Ÿä¸­ï¼Œ YOLOçš„æ•ˆæœæ˜¯æœ€å¥½çš„ã€‚</li>
<li>YOLO åœ¨åšå‡ºé¢„æµ‹æ—¶æ˜¯æ¨ç†æ•´ä¸ªå›¾åƒçš„ã€‚ä¸æ»‘åŠ¨çª—å£å’Œå€™é€‰åŒºåŸŸç®—æ³•ä¸åŒï¼Œ YOLO åœ¨è®­ç»ƒå’Œæµ‹è¯•æ—¶ï¼Œä»æ•´ä¸ªå›¾åƒç»¼åˆè€ƒè™‘ï¼Œä¸ä»…åˆ†æç‰©ä½“çš„ appearance è¿˜åˆ†æå…¶ contextual ä¿¡æ¯ã€‚Fast R-CNN æ¯”è¾ƒå®¹æ˜“å°†èƒŒæ™¯è¯¯æ£€æµ‹ä¸ºç‰©ä½“ï¼Œå› ä¸ºå®ƒä¸è€ƒè™‘ contextual ä¿¡æ¯ã€‚YOLO æŠŠèƒŒæ™¯è¯¯æ£€æµ‹ä¸ºç‰©ä½“çš„æ¦‚ç‡ä¸åˆ° Fast R-CNN çš„ä¸€åŠã€‚</li>
<li>YOLO å¯¹ç‰©ä½“çš„æ³›åŒ–èƒ½åŠ›æ¯”è¾ƒå¥½ã€‚å½“åœ¨è‡ªç„¶å›¾åƒä¸Šè®­ç»ƒï¼Œåœ¨è‰ºæœ¯å›¾åƒä¸Šæ£€æµ‹æ—¶ï¼ŒYOLOçš„æ•ˆæœè¦æ¯” DPM å’Œ R-CNN å¥½å¾ˆå¤šã€‚</li>
</ul>
<p>YOLOæ²¡æœ‰é€‰æ‹©æ»‘åŠ¨çª—å£ï¼ˆsilding windowï¼‰æˆ–æå–proposalçš„æ–¹å¼è®­ç»ƒç½‘ç»œï¼Œè€Œæ˜¯ç›´æ¥é€‰ç”¨æ•´å›¾è®­ç»ƒæ¨¡å‹ï¼Œå°† Object Detection çš„é—®é¢˜è½¬åŒ–æˆä¸€ä¸ª Regression é—®é¢˜ã€‚</p>
<p>å°†å›¾ç‰‡åˆ†ä¸º$S\times S$ä¸ªå•å…ƒæ ¼(åŸæ–‡ä¸­S=7)ï¼Œä¹‹åçš„è¾“å‡ºæ˜¯ä»¥å•å…ƒæ ¼ä¸ºå•ä½è¿›è¡Œçš„ï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªobjectçš„ä¸­å¿ƒè½åœ¨æŸä¸ªå•å…ƒæ ¼ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªå•å…ƒæ ¼è´Ÿè´£é¢„æµ‹è¿™ä¸ªç‰©ä½“ã€‚</li>
<li>æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹Bä¸ªbboxå€¼(bboxå€¼åŒ…æ‹¬åæ ‡å’Œå®½é«˜ï¼ŒåŸæ–‡ä¸­B=2)ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªbboxå€¼é¢„æµ‹ä¸€ä¸ªç½®ä¿¡åº¦(confidence scores)ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹BÃ—(4+1)ä¸ªå€¼ã€‚</li>
<li>æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹C(ç‰©ä½“ç§ç±»ä¸ªæ•°ï¼ŒåŸæ–‡C=20ï¼Œè¿™ä¸ªä¸ä½¿ç”¨çš„æ•°æ®åº“æœ‰å…³)ä¸ªæ¡ä»¶æ¦‚ç‡å€¼.</li>
</ul>
<p>æ‰€ä»¥ï¼Œæœ€åç½‘ç»œçš„è¾“å‡ºç»´åº¦ä¸º$S \times S \times (B\times 5 + C)$ï¼Œè¿™é‡Œè¾“å‡ºä¸º$7\times7\times(2\times5+20)$, è™½ç„¶æ¯ä¸ªå•å…ƒæ ¼è´Ÿè´£é¢„æµ‹ä¸€ç§ç‰©ä½“(è¿™ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« çš„é—®é¢˜ï¼Œå½“æœ‰å°ç‰©ä½“æ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜)ï¼Œä½†æ˜¯æ¯ä¸ªå•å…ƒæ ¼å¯ä»¥é¢„æµ‹å¤šä¸ªbboxå€¼(è¿™é‡Œå¯ä»¥è®¤ä¸ºæœ‰å¤šä¸ªä¸åŒå½¢çŠ¶çš„bboxï¼Œä¸ºäº†æ›´å‡†ç¡®çš„å®šä½å‡ºç‰©ä½“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º)ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/6983308-29a33d2e79ed722b.png" alt></p>
<p><strong>(x,y)æ˜¯bboxçš„ä¸­å¿ƒç›¸å¯¹äºå•å…ƒæ ¼çš„offset</strong><br>å•å…ƒæ ¼åæ ‡ä¸º$(x_{col},y_{row})$ï¼Œå‡è®¾å®ƒé¢„æµ‹çš„è¾“å‡ºçš„bboxä¸­å¿ƒåæ ‡ä¸º$(x_c,y_c)$,é‚£ä¹ˆæœ€ç»ˆé¢„æµ‹å‡ºæ¥çš„(x,y)æ˜¯ç»è¿‡å½’ä¸€åŒ–å¤„ç†çš„ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸­å¿ƒç›¸å¯¹äºå•å…ƒæ ¼çš„offset</p>
<p><strong>(w,h)æ˜¯bboxç›¸å¯¹äºæ•´ä¸ªå›¾ç‰‡çš„æ¯”ä¾‹</strong><br>é¢„æµ‹çš„bboxçš„å®½é«˜ä¸º$w_b,h_b$ï¼Œ(w,h)è¡¨ç¤ºçš„æ˜¯bboxçš„æ˜¯ç›¸å¯¹äºæ•´å¼ å›¾ç‰‡çš„å æ¯”</p>
<p><strong>confidence</strong><br>è¿™ä¸ªç½®ä¿¡åº¦æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€æ˜¯æ ¼å­å†…æ˜¯å¦æœ‰ç›®æ ‡ï¼ŒäºŒæ˜¯bboxçš„å‡†ç¡®åº¦ã€‚å®šä¹‰ç½®ä¿¡åº¦ä¸º$P_r(Object)âˆ—IOU^{truth}_{pred}$<br>è¿™é‡Œï¼Œå¦‚æœæ ¼å­å†…æœ‰ç‰©ä½“ï¼Œåˆ™$P_r(Object)=1$ï¼Œæ­¤æ—¶ç½®ä¿¡åº¦ç­‰äºIoUã€‚å¦‚æœæ ¼å­å†…æ²¡æœ‰ç‰©ä½“ï¼Œåˆ™$P_r(Object)=0$ï¼Œæ­¤æ—¶ç½®ä¿¡åº¦ä¸º0</p>
<p><strong>Cç±»çš„æ¡ä»¶æ¦‚ç‡</strong><br>æ¡ä»¶æ¦‚ç‡å®šä¹‰ä¸º$P_r(Class_i |Object)$ï¼Œè¡¨ç¤ºè¯¥å•å…ƒæ ¼å­˜åœ¨ç‰©ä½“ä¸”å±äºç¬¬iç±»çš„æ¦‚ç‡ã€‚</p>
<p>åœ¨æµ‹è¯•çš„æ—¶å€™æ¯ä¸ªå•å…ƒæ ¼é¢„æµ‹æœ€ç»ˆè¾“å‡ºçš„æ¦‚ç‡å®šä¹‰ä¸ºï¼Œå¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºï¼ˆä¸¤å¹…å›¾ä¸ä¸€æ ·ï¼Œä»£è¡¨ä¸€ä¸ªæ¡†ä¼šè¾“å‡ºBåˆ—æ¦‚ç‡å€¼ï¼‰<br>$P_r(Class_i|Object) âˆ— P_r(Object) âˆ— IOU^{truth}_{pred} = P_r(Class_i) âˆ— IOU^{truth}_{pred}$</p>
<p>æœ€åå°†$(S\times S)\times B\times20$ åˆ—çš„ç»“æœé€å…¥NMSï¼Œæœ€åå³å¯å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºæ¡†ç»“æœ</p>
<p><strong>æŸå¤±å‡½æ•°</strong></p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20180511204751564.png" alt></p>
<p>è¿™é‡Œå¼ºè°ƒä¸¤ç‚¹ï¼š<br> 1.æ¯ä¸ªå›¾ç‰‡çš„æ¯ä¸ªå•å…ƒæ ¼ä¸ä¸€å®šéƒ½åŒ…å«objectï¼Œå¦‚æœæ²¡æœ‰objectï¼Œé‚£ä¹ˆconfidenceå°±ä¼šå˜æˆ0ï¼Œè¿™æ ·åœ¨ä¼˜åŒ–æ¨¡å‹çš„æ—¶å€™å¯èƒ½ä¼šè®©æ¢¯åº¦è·¨è¶Šå¤ªå¤§ï¼Œæ¨¡å‹ä¸ç¨³å®šè·‘é£äº†ã€‚ä¸ºäº†å¹³è¡¡è¿™ä¸€ç‚¹ï¼Œåœ¨æŸå¤±å‡½æ•°ä¸­ï¼Œè®¾ç½®ä¸¤ä¸ªå‚æ•°$Î»_{corrd}$å’Œ$Î»_{noobj}$ï¼Œå…¶ä¸­$Î»_{corrd}$æ§åˆ¶bboxé¢„æµ‹ä½ç½®çš„æŸå¤±ï¼Œ$Î»_{noobj}$æ§åˆ¶å•ä¸ªæ ¼å†…æ²¡æœ‰ç›®æ ‡çš„æŸå¤±ã€‚<br> 2.å¯¹äºå¤§çš„ç‰©ä½“ï¼Œå°çš„åå·®å¯¹äºå°çš„ç‰©ä½“å½±å“è¾ƒå¤§ï¼Œä¸ºäº†å‡å°‘è¿™ä¸ªå½±å“ï¼Œæ‰€ä»¥å¯¹bboxçš„å®½é«˜éƒ½å¼€æ ¹å·ã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>YOLOçš„ç‰©ä½“æ£€æµ‹ç²¾åº¦ä½äºå…¶ä»–state-of-the-artçš„ç‰©ä½“æ£€æµ‹ç³»ç»Ÿã€‚</li>
<li>YOLOå®¹æ˜“äº§ç”Ÿç‰©ä½“çš„å®šä½é”™è¯¯ã€‚</li>
<li>YOLOå¯¹å°ç‰©ä½“çš„æ£€æµ‹æ•ˆæœä¸å¥½ï¼ˆå°¤å…¶æ˜¯å¯†é›†çš„å°ç‰©ä½“ï¼Œå› ä¸ºä¸€ä¸ªæ …æ ¼åªèƒ½é¢„æµ‹2ä¸ªç‰©ä½“ï¼‰ã€‚</li>
</ul>
<h3 id="YOLO-v2"><a href="#YOLO-v2" class="headerlink" title="YOLO v2"></a>YOLO v2</h3><p>Redmon, J. and A. Farhadi, YOLO9000: Better, Faster, Stronger. (CVPR 2017)</p>
<p><strong>æ”¹è¿›</strong>ï¼š</p>
<ul>
<li><p><strong>Batch Normalization</strong></p>
<p>Batch Normalizationå¯ä»¥æå‡æ¨¡å‹æ”¶æ•›é€Ÿåº¦ï¼Œè€Œä¸”å¯ä»¥èµ·åˆ°ä¸€å®šæ­£åˆ™åŒ–æ•ˆæœï¼Œé™ä½æ¨¡å‹çš„è¿‡æ‹Ÿåˆã€‚åœ¨YOLOv2ä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚åé¢éƒ½æ·»åŠ äº†Batch Normalizationå±‚ï¼Œå¹¶ä¸”ä¸å†ä½¿ç”¨droputã€‚ä½¿ç”¨Batch Normalizationåï¼ŒYOLOv2çš„mAPæå‡äº†2.4%ã€‚</p>
</li>
<li><p><strong>High Resolution Classifier</strong></p>
<p>ç›®å‰å¤§éƒ¨åˆ†çš„æ£€æµ‹æ¨¡å‹éƒ½ä¼šåœ¨å…ˆåœ¨ImageNetåˆ†ç±»æ•°æ®é›†ä¸Šé¢„è®­ç»ƒæ¨¡å‹çš„ä¸»ä½“éƒ¨åˆ†ï¼ˆCNNç‰¹å¾æå–å™¨ï¼‰ï¼Œç”±äºå†å²åŸå› ï¼ŒImageNetåˆ†ç±»æ¨¡å‹åŸºæœ¬é‡‡ç”¨å¤§å°ä¸º$224 \times 224$çš„å›¾ç‰‡ä½œä¸ºè¾“å…¥ï¼Œåˆ†è¾¨ç‡ç›¸å¯¹è¾ƒä½ï¼Œä¸åˆ©äºæ£€æµ‹æ¨¡å‹ã€‚æ‰€ä»¥YOLOv1åœ¨é‡‡ç”¨$224 \times 224$åˆ†ç±»æ¨¡å‹é¢„è®­ç»ƒåï¼Œå°†åˆ†è¾¨ç‡å¢åŠ è‡³$448 \times 448$ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªé«˜åˆ†è¾¨ç‡åœ¨æ£€æµ‹æ•°æ®é›†ä¸Šfine tuneã€‚ä½†æ˜¯ç›´æ¥åˆ‡æ¢åˆ†è¾¨ç‡ï¼Œæ£€æµ‹æ¨¡å‹å¯èƒ½éš¾ä»¥å¿«é€Ÿé€‚åº”é«˜åˆ†è¾¨ç‡ã€‚æ‰€ä»¥YOLOv2å¢åŠ äº†åœ¨ImageNetæ•°æ®é›†ä¸Šä½¿ç”¨$448 \times 448$æ¥fine tuneåˆ†ç±»ç½‘ç»œè¿™ä¸€ä¸­é—´è¿‡ç¨‹ï¼ˆ10 epochsï¼‰ï¼Œè¿™å¯ä»¥ä½¿å¾—æ¨¡å‹åœ¨æ£€æµ‹æ•°æ®é›†ä¸Šfine tuneä¹‹å‰å·²ç»é€‚ç”¨é«˜åˆ†è¾¨ç‡è¾“å…¥ã€‚ä½¿ç”¨é«˜åˆ†è¾¨ç‡åˆ†ç±»å™¨åï¼ŒYOLOv2çš„mAPæå‡äº†çº¦4%ã€‚</p>
</li>
<li><p><strong>Convolutionlal With Anchor Boxes</strong></p>
<p>anchoræ˜¯RNPç½‘ç»œä¸­çš„ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œè¯´çš„æ˜¯åœ¨å·ç§¯ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ»‘çª—æ“ä½œï¼Œæ¯ä¸€ä¸ªä¸­å¿ƒå¯ä»¥é¢„æµ‹9ç§ä¸åŒå¤§å°çš„å»ºè®®æ¡†ã€‚</p>
<p><strong>YOLO v1ï¼š S*S* (B*5 + C) =&gt; 7*7ï¼ˆ2*5+20ï¼‰</strong><br>ã€€ã€€ å…¶ä¸­Bå¯¹åº”Boxæ•°é‡ï¼Œ5å¯¹åº” Rect å®šä½+ç½®ä¿¡åº¦ã€‚æ¯ä¸ªGridåªèƒ½é¢„æµ‹å¯¹åº”ä¸¤ä¸ªBoxï¼Œè¿™ä¸¤ä¸ªBoxå…±ç”¨ä¸€ä¸ªåˆ†ç±»ç»“æœï¼ˆ20 classesï¼‰ï¼Œè¿™æ˜¯å¾ˆä¸åˆç†çš„ä¸´æ—¶æ–¹æ¡ˆã€‚</p>
<p><strong>YOLO v2ï¼š S*S*K* (5 + C) =&gt; 13*13*9ï¼ˆ5+20ï¼‰</strong><br>ã€€ã€€åˆ†è¾¨ç‡æ”¹æˆäº†13*13ï¼Œæ›´ç»†çš„æ ¼å­åˆ’åˆ†å¯¹å°ç›®æ ‡é€‚åº”æ›´å¥½ï¼Œå†åŠ ä¸Šä¸Fasterä¸€æ ·çš„K=9ï¼Œè®¡ç®—é‡å¢åŠ äº†ä¸å°‘ã€‚é€šè¿‡Anchor Boxæ”¹è¿›ï¼ŒmAPç”±69.5ä¸‹é™åˆ°69.2ï¼ŒRecallç”±81%æå‡åˆ°äº†88%ã€‚<br>ã€€ã€€<br>ã€€ã€€ä¸ºäº†å¼•å…¥anchor boxesæ¥é¢„æµ‹bounding boxesï¼Œä½œè€…åœ¨ç½‘ç»œä¸­æœæ–­å»æ‰äº†å…¨è¿æ¥å±‚ã€‚é¦–å…ˆï¼Œä½œè€…å»æ‰äº†åé¢çš„ä¸€ä¸ªæ± åŒ–å±‚ä»¥ç¡®ä¿è¾“å‡ºçš„å·ç§¯ç‰¹å¾å›¾æœ‰æ›´é«˜çš„åˆ†è¾¨ç‡ã€‚ç„¶åï¼Œé€šè¿‡ç¼©å‡ç½‘ç»œï¼Œè®©å›¾ç‰‡è¾“å…¥åˆ†è¾¨ç‡ä¸º416x416ï¼Œè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºäº†è®©åé¢äº§ç”Ÿçš„å·ç§¯ç‰¹å¾å›¾å®½é«˜éƒ½ä¸ºå¥‡æ•°ï¼Œè¿™æ ·å°±å¯ä»¥äº§ç”Ÿä¸€ä¸ªcenter cellã€‚ä½œè€…è§‚å¯Ÿåˆ°ï¼Œå¤§ç‰©ä½“é€šå¸¸å æ®äº†å›¾åƒçš„ä¸­é—´ä½ç½®ï¼Œ å°±å¯ä»¥åªç”¨ä¸­å¿ƒçš„ä¸€ä¸ªcellæ¥é¢„æµ‹è¿™äº›ç‰©ä½“çš„ä½ç½®ï¼Œå¦åˆ™å°±è¦ç”¨ä¸­é—´çš„4ä¸ªcellæ¥è¿›è¡Œé¢„æµ‹ï¼Œè¿™ä¸ªæŠ€å·§å¯ç¨ç¨æå‡æ•ˆç‡ã€‚æœ€åï¼ŒYOLOv2ä½¿ç”¨äº†å·ç§¯å±‚é™é‡‡æ ·ï¼ˆfactorä¸º32ï¼‰ï¼Œä½¿å¾—è¾“å…¥å·ç§¯ç½‘ç»œçš„416x416å›¾ç‰‡æœ€ç»ˆå¾—åˆ°13x13çš„å·ç§¯ç‰¹å¾å›¾ï¼ˆ416/32=13ï¼‰ã€‚<br>ã€€ã€€åŠ å…¥äº†anchor boxesåï¼Œå¯ä»¥é¢„æ–™åˆ°çš„ç»“æœæ˜¯å¬å›ç‡ä¸Šå‡ï¼Œå‡†ç¡®ç‡ä¸‹é™ã€‚æˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹ï¼Œå‡è®¾æ¯ä¸ªcellé¢„æµ‹9ä¸ªå»ºè®®æ¡†ï¼Œé‚£ä¹ˆæ€»å…±ä¼šé¢„æµ‹13x13x9 = 1521ä¸ªboxesï¼Œè€Œä¹‹å‰çš„ç½‘ç»œä»…ä»…é¢„æµ‹7x7x2 = 98ä¸ªboxesã€‚å…·ä½“æ•°æ®ä¸ºï¼šæ²¡æœ‰anchor boxesï¼Œæ¨¡å‹recallä¸º81%ï¼ŒmAPä¸º69.5%ï¼›åŠ å…¥anchor boxesï¼Œæ¨¡å‹recallä¸º88%ï¼ŒmAPä¸º69.2%ã€‚è¿™æ ·çœ‹æ¥ï¼Œå‡†ç¡®ç‡åªæœ‰å°å¹…åº¦çš„ä¸‹é™ï¼Œè€Œå¬å›ç‡åˆ™æå‡äº†7%ï¼Œè¯´æ˜å¯ä»¥é€šè¿‡è¿›ä¸€æ­¥çš„å·¥ä½œæ¥åŠ å¼ºå‡†ç¡®ç‡ï¼Œçš„ç¡®æœ‰æ”¹è¿›ç©ºé—´ã€‚</p>
</li>
<li><p><strong>New Networkâ€”â€”Darknet-19</strong></p>
<p>YOLOv2ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„åˆ†ç±»ç½‘ç»œä½œä¸ºç‰¹å¾æå–éƒ¨åˆ†ï¼Œå‚è€ƒäº†å‰äººçš„å…ˆè¿›ç»éªŒï¼Œæ¯”å¦‚ç±»ä¼¼äºVGGï¼Œä½œè€…ä½¿ç”¨äº†è¾ƒå¤šçš„3x3å·ç§¯æ ¸ï¼Œåœ¨æ¯ä¸€æ¬¡æ± åŒ–æ“ä½œåæŠŠé€šé“æ•°ç¿»å€ã€‚å€Ÿé‰´äº†network in networkçš„æ€æƒ³ï¼Œç½‘ç»œä½¿ç”¨äº†å…¨å±€å¹³å‡æ± åŒ–ï¼ˆglobal average poolingï¼‰ï¼ŒæŠŠ1x1çš„å·ç§¯æ ¸ç½®äº3x3çš„å·ç§¯æ ¸ä¹‹é—´ï¼Œç”¨æ¥å‹ç¼©ç‰¹å¾ã€‚ä¹Ÿç”¨äº†batch normalizationç¨³å®šæ¨¡å‹è®­ç»ƒã€‚æ¨¡å‹å‚æ•°ç›¸å¯¹å°ä¸€äº›ã€‚ä½¿ç”¨Darknet-19ä¹‹åï¼ŒYOLOv2çš„mAPå€¼æ²¡æœ‰æ˜¾è‘—æå‡ï¼Œä½†æ˜¯è®¡ç®—é‡å´å¯ä»¥å‡å°‘çº¦33%ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_18-40-15.jpg" alt></p>
</li>
</ul>
<ul>
<li><p><strong>Dimension Clusters</strong></p>
<p>åœ¨Faster R-CNNå’ŒSSDä¸­ï¼Œå…ˆéªŒæ¡†çš„ç»´åº¦ï¼ˆé•¿å’Œå®½ï¼‰éƒ½æ˜¯æ‰‹åŠ¨è®¾å®šçš„ï¼Œå¸¦æœ‰ä¸€å®šçš„ä¸»è§‚æ€§ã€‚å¦‚æœé€‰å–çš„å…ˆéªŒæ¡†ç»´åº¦æ¯”è¾ƒåˆé€‚ï¼Œé‚£ä¹ˆæ¨¡å‹æ›´å®¹æ˜“å­¦ä¹ ï¼Œä»è€Œåšå‡ºæ›´å¥½çš„é¢„æµ‹ã€‚å› æ­¤ï¼ŒYOLOv2é‡‡ç”¨k-meansèšç±»æ–¹æ³•å¯¹è®­ç»ƒé›†ä¸­çš„è¾¹ç•Œæ¡†åšäº†èšç±»åˆ†æã€‚å› ä¸ºè®¾ç½®å…ˆéªŒæ¡†çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä½¿å¾—é¢„æµ‹æ¡†ä¸ground truthçš„IOUæ›´å¥½ï¼Œæ‰€ä»¥èšç±»åˆ†ææ—¶é€‰ç”¨boxä¸èšç±»ä¸­å¿ƒboxä¹‹é—´çš„IOUå€¼ä½œä¸ºè·ç¦»æŒ‡æ ‡ï¼š $d(\text { box }, \text { centroid })=1-\mathrm{IOU}(\text { box }, \text { centroid })$</p>
</li>
<li><p><strong>Direct location prediction</strong></p>
<script type="math/tex; mode=display">
x=\left(t_{x} * w_{a}\right)-x_{a}</script><script type="math/tex; mode=display">
y=\left(t_{y} * h_{a}\right)-y_{a}</script><p>è¿™ä¸ªå…¬å¼çš„ç†è§£ä¸ºï¼šå½“é¢„æµ‹tx=1ï¼Œå°±ä¼šæŠŠboxå‘å³è¾¹ç§»åŠ¨ä¸€å®šè·ç¦»ï¼ˆå…·ä½“ä¸ºanchor boxçš„å®½åº¦ï¼‰ï¼Œé¢„æµ‹tx=-1ï¼Œå°±ä¼šæŠŠboxå‘å·¦è¾¹ç§»åŠ¨ç›¸åŒçš„è·ç¦»ï¼Œè¯¥å…¬å¼æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œä¸­å¿ƒç‚¹å¯èƒ½ä¼šå‡ºç°åœ¨å›¾åƒä»»ä½•ä½ç½®ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´å›å½’è¿‡ç¨‹éœ‡è¡ï¼Œç”šè‡³æ— æ³•æ”¶æ•›ã€‚</p>
<p><strong>å¼ºçº¦æŸæ–¹æ³•</strong>ï¼š</p>
<ul>
<li>å¯¹åº” Cell è·ç¦»å·¦ä¸Šè§’çš„è¾¹è·ä¸º$\left(C_{x}, C_{y}\right)$ï¼ŒÏƒå®šä¹‰ä¸ºsigmoidæ¿€æ´»å‡½æ•°ï¼Œå°†å‡½æ•°å€¼çº¦æŸåˆ°ï¼»0ï¼Œ1ï¼½ï¼Œç”¨æ¥é¢„æµ‹ç›¸å¯¹äºè¯¥Cellä¸­å¿ƒçš„åç§»ï¼ˆä¸ä¼šåç¦»cellï¼‰ï¼›</li>
<li>é¢„å®šAnchorï¼ˆæ–‡ä¸­æè¿°ä¸ºbounding box priorï¼‰å¯¹åº”çš„å®½é«˜ä¸º$\left(P_{w}, P_{h}\right)$ï¼Œé¢„æµ‹ Location æ˜¯ç›¸å¯¹äºAnchorçš„å®½é«˜ä¹˜ä»¥ç³»æ•°å¾—åˆ°ï¼›</li>
</ul>
</li>
</ul>
<p>  å¦‚æœè¿™ä¸ªcellè·ç¦»å›¾åƒå·¦ä¸Šè§’çš„è¾¹è·ä¸º$\left(C_{x}, C_{y}\right)$ä»¥åŠè¯¥cellå¯¹åº”çš„boxç»´åº¦ï¼ˆbounding box priorï¼‰çš„é•¿å’Œå®½åˆ†åˆ«ä¸º$\left(P_{w}, P_{h}\right)$ï¼Œé‚£ä¹ˆé¢„æµ‹å€¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š </p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_18-53-58.jpg" alt></p>
<ul>
<li><p><strong>Fine-Grained Features</strong><br>YOLOæœ€ç»ˆåœ¨13x13çš„ç‰¹å¾å›¾ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œè™½ç„¶è¿™è¶³ä»¥èƒœä»»å¤§å°ºåº¦ç‰©ä½“çš„æ£€æµ‹ï¼Œä½†å¯¹äºå°ç‰©ä½“è¿˜éœ€è¦æ›´ç²¾ç»†çš„ç‰¹å¾å›¾ï¼ˆFine-Grained Featuresï¼‰ï¼Œå‰é¢æ›´ç²¾ç»†çš„ç‰¹å¾å›¾å¯ä»¥ç”¨æ¥é¢„æµ‹å°ç‰©ä½“ã€‚<br>YOLOv2æå‡ºäº†ä¸€ç§passthroughå±‚æ¥åˆ©ç”¨æ›´ç²¾ç»†çš„ç‰¹å¾å›¾ã€‚YOLOv2æ‰€åˆ©ç”¨çš„Fine-Grained Featuresæ˜¯26x26å¤§å°çš„ç‰¹å¾å›¾ï¼ˆæœ€åä¸€ä¸ªmaxpoolingå±‚çš„è¾“å…¥ï¼‰ï¼Œå¯¹äºDarknet-19æ¨¡å‹æ¥è¯´å°±æ˜¯å¤§å°ä¸º26x26x512çš„ç‰¹å¾å›¾ã€‚passthroughå±‚ä¸ResNetç½‘ç»œçš„shortcutç±»ä¼¼ï¼Œä»¥å‰é¢æ›´é«˜åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸ºè¾“å…¥ï¼Œç„¶åå°†å…¶è¿æ¥åˆ°åé¢çš„ä½åˆ†è¾¨ç‡ç‰¹å¾å›¾ä¸Šã€‚å‰é¢çš„ç‰¹å¾å›¾ç»´åº¦æ˜¯åé¢çš„ç‰¹å¾å›¾çš„2å€ï¼Œpassthroughå±‚æŠ½å–å‰é¢å±‚çš„æ¯ä¸ª2x2çš„å±€éƒ¨åŒºåŸŸï¼Œç„¶åå°†å…¶è½¬åŒ–ä¸ºchannelç»´åº¦ï¼Œå¯¹äº26x26x512çš„ç‰¹å¾å›¾ï¼Œç»passthroughå±‚å¤„ç†ä¹‹åå°±å˜æˆäº†13x13x2048çš„æ–°ç‰¹å¾å›¾ï¼ˆç‰¹å¾å›¾å¤§å°é™ä½4å€ï¼Œè€Œchannleså¢åŠ 4å€ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ä¸åé¢çš„13x13x1024ç‰¹å¾å›¾è¿æ¥åœ¨ä¸€èµ·å½¢æˆ13x13x3072çš„ç‰¹å¾å›¾ï¼Œç„¶ååœ¨æ­¤ç‰¹å¾å›¾åŸºç¡€ä¸Šå·ç§¯åšé¢„æµ‹ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-07_19-14-51.jpg" alt></p>
</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/20161229150249883.jpg" alt></p>
<ul>
<li><p><strong>Multi-Scale Training</strong><br>ã€€ã€€ä¸ºäº†è®© YOLOv2 é€‚åº”ä¸åŒScaleä¸‹çš„æ£€æµ‹ä»»åŠ¡ï¼Œä½œè€…å°è¯•é€šè¿‡ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡çš„è®­ç»ƒæ¥æé«˜ç½‘ç»œçš„é€‚åº”æ€§ã€‚(ç½‘ç»œåªç”¨åˆ°äº†å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œå¯ä»¥è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼ˆæ£€æµ‹ä»»æ„å¤§å°å›¾ç‰‡ï¼‰)<br>å…·ä½“åšæ³•æ˜¯ï¼š<br>ã€€ã€€ æ¯ç»è¿‡10æ¬¡è®­ç»ƒï¼ˆ10 epochï¼‰ï¼Œå°±ä¼šéšæœºé€‰æ‹©æ–°çš„å›¾ç‰‡å°ºå¯¸ã€‚YOLOç½‘ç»œä½¿ç”¨çš„é™é‡‡æ ·å‚æ•°ä¸º32ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨32çš„å€æ•°è¿›è¡Œå°ºåº¦æ± åŒ–{320,352ï¼Œâ€¦ï¼Œ608}ã€‚æœ€ç»ˆæœ€å°çš„å°ºå¯¸ä¸º320 <em> 320ï¼Œæœ€å¤§çš„å°ºå¯¸ä¸º608 </em> 608ã€‚æ¥ç€æŒ‰ç…§è¾“å…¥å°ºå¯¸è°ƒæ•´ç½‘ç»œè¿›è¡Œè®­ç»ƒã€‚</p>
<p>â€‹         è¿™ç§æœºåˆ¶ä½¿å¾—ç½‘ç»œå¯ä»¥æ›´å¥½åœ°é¢„æµ‹ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œæ„å‘³ç€åŒä¸€ä¸ªç½‘ç»œå¯ä»¥è¿›è¡Œä¸åŒåˆ†è¾¨ç‡çš„æ£€æµ‹ä»»åŠ¡ï¼Œåœ¨å°å°ºå¯¸å›¾ç‰‡ä¸ŠYOLOv2è¿è¡Œæ›´å¿«ï¼Œåœ¨é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¾¾åˆ°äº†å¹³è¡¡ã€‚</p>
</li>
<li><p><strong>äº¤å‰æ•°æ®è®­ç»ƒ</strong></p>
<p>YOLO9000æ˜¯åœ¨YOLOv2çš„åŸºç¡€ä¸Šæå‡ºçš„ä¸€ç§å¯ä»¥æ£€æµ‹è¶…è¿‡9000ä¸ªç±»åˆ«çš„æ¨¡å‹ï¼Œå…¶ä¸»è¦è´¡çŒ®ç‚¹åœ¨äºæå‡ºäº†ä¸€ç§åˆ†ç±»å’Œæ£€æµ‹çš„è”åˆè®­ç»ƒç­–ç•¥ã€‚ä¼—å¤šå‘¨çŸ¥ï¼Œæ£€æµ‹æ•°æ®é›†çš„æ ‡æ³¨è¦æ¯”åˆ†ç±»æ•°æ®é›†æ‰“æ ‡ç­¾ç¹ççš„å¤šï¼Œæ‰€ä»¥ImageNetåˆ†ç±»æ•°æ®é›†æ¯”VOCç­‰æ£€æµ‹æ•°æ®é›†é«˜å‡ºå‡ ä¸ªæ•°é‡çº§ã€‚åœ¨YOLOä¸­ï¼Œè¾¹ç•Œæ¡†çš„é¢„æµ‹å…¶å®å¹¶ä¸ä¾èµ–äºç‰©ä½“çš„æ ‡ç­¾ï¼Œæ‰€ä»¥YOLOå¯ä»¥å®ç°åœ¨åˆ†ç±»å’Œæ£€æµ‹æ•°æ®é›†ä¸Šçš„è”åˆè®­ç»ƒã€‚å¯¹äºæ£€æµ‹æ•°æ®é›†ï¼Œå¯ä»¥ç”¨æ¥å­¦ä¹ é¢„æµ‹ç‰©ä½“çš„è¾¹ç•Œæ¡†ã€ç½®ä¿¡åº¦ä»¥åŠä¸ºç‰©ä½“åˆ†ç±»ï¼Œè€Œå¯¹äºåˆ†ç±»æ•°æ®é›†å¯ä»¥ä»…ç”¨æ¥å­¦ä¹ åˆ†ç±»ï¼Œä½†æ˜¯å…¶å¯ä»¥å¤§å¤§æ‰©å……æ¨¡å‹æ‰€èƒ½æ£€æµ‹çš„ç‰©ä½“ç§ç±»ã€‚</p>
<p>ä½œè€…é€‰æ‹©åœ¨COCOå’ŒImageNetæ•°æ®é›†ä¸Šè¿›è¡Œè”åˆè®­ç»ƒï¼Œä½†æ˜¯é‡åˆ°çš„ç¬¬ä¸€é—®é¢˜æ˜¯ä¸¤è€…çš„ç±»åˆ«å¹¶ä¸æ˜¯å®Œå…¨äº’æ–¥çš„ï¼Œæ¯”å¦‚â€Norfolk terrierâ€æ˜æ˜¾å±äºâ€dogâ€ï¼Œæ‰€ä»¥ä½œè€…æå‡ºäº†ä¸€ç§å±‚çº§åˆ†ç±»æ–¹æ³•ï¼ˆHierarchical classificationï¼‰ï¼Œä¸»è¦æ€è·¯æ˜¯æ ¹æ®å„ä¸ªç±»åˆ«ä¹‹é—´çš„ä»å±å…³ç³»ï¼ˆæ ¹æ®WordNetï¼‰å»ºç«‹ä¸€ç§æ ‘ç»“æ„WordTreeï¼Œç»“åˆCOCOå’ŒImageNetå»ºç«‹çš„WordTreeå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_09-22-20.jpg" alt><br>åˆ†ç±»æ—¶çš„æ¦‚ç‡è®¡ç®—å€Ÿç”¨äº†å†³ç­–æ ‘æ€æƒ³ï¼ŒæŸä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡å€¼ç­‰äº è¯¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰æ¡ä»¶æ¦‚ç‡ä¹‹ç§¯ã€‚<br>å¦‚æœæƒ³æ±‚å¾—ç‰¹å®šèŠ‚ç‚¹çš„ç»å¯¹æ¦‚ç‡ï¼Œåªéœ€è¦æ²¿ç€è·¯å¾„åšè¿ç»­ä¹˜ç§¯ã€‚ä¾‹å¦‚ å¦‚æœæƒ³çŸ¥é“ä¸€å¼ å›¾ç‰‡æ˜¯ä¸æ˜¯â€œNorfolk terrier â€éœ€è¦è®¡ç®—ï¼š</p>
<p>$\operatorname{Pr}(\text { Norfolk terrier })=\operatorname{Pr}(\text { Norfolk terrier } | \text { terrier })$<br>*$\operatorname{Pr}(\text { terrier } | \text { hunting dog })$</p>
<p><em>. . . </em></p>
<p><em>$\operatorname{Pr}(\text { mammal } |\text { animal })$
  </em>$\operatorname{Pr}(\text { animal } | \text { physical object })$<br>softmaxæ“ä½œä¹ŸåŒæ—¶åº”è¯¥é‡‡ç”¨åˆ†ç»„æ“ä½œï¼ŒåŸºäºæ‰€æœ‰â€œåŒä¹‰è¯é›†â€è®¡ç®—softmaxï¼Œå…¶ä¸­â€œåŒä¹‰è¯é›†â€æ˜¯åŒä¸€æ¦‚å¿µçš„ä¸‹ä½è¯ã€‚</p>
</li>
</ul>
<h3 id="YOLO-v3"><a href="#YOLO-v3" class="headerlink" title="YOLO v3"></a>YOLO v3</h3><p>Redmon, J. and A. Farhadi, YOLOv3: An Incremental Improvement. 2018.</p>
<ul>
<li><p><strong>æ–°çš„ç½‘ç»œç»“æ„Darknet-53</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2709767-e65c08c61bfaa7c7.png" alt></p>
<p>å€Ÿé‰´äº†æ®‹å·®ç½‘ç»œresidual networkçš„åšæ³•ï¼Œåœ¨ä¸€äº›å±‚ä¹‹é—´è®¾ç½®äº†å¿«æ·é“¾è·¯ï¼ˆshortcut connectionsï¼‰ã€‚æ¯ä¸ªæ®‹å·®ç»„ ä»¶æœ‰ä¸¤ä¸ªå·ç§¯å±‚å’Œä¸€ä¸ªå¿«æ·é“¾è·¯ã€‚</p>
</li>
<li><p><strong>åˆ©ç”¨å¤šå°ºåº¦ç‰¹å¾è¿›è¡Œå¯¹è±¡æ£€æµ‹</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2709767-bc5def91d05e4d3a.png" alt><br>YOLO2æ›¾é‡‡ç”¨passthroughç»“æ„æ¥æ£€æµ‹ç»†ç²’åº¦ç‰¹å¾ï¼Œåœ¨YOLO3æ›´è¿›ä¸€æ­¥é‡‡ç”¨äº†3ä¸ªä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾æ¥è¿›è¡Œå¯¹è±¡æ£€æµ‹ã€‚</p>
<p>ç»“åˆä¸Šå›¾çœ‹ï¼Œå·ç§¯ç½‘ç»œåœ¨79å±‚åï¼Œç»è¿‡ä¸‹æ–¹å‡ ä¸ªé»„è‰²çš„å·ç§¯å±‚å¾—åˆ°ä¸€ç§å°ºåº¦çš„æ£€æµ‹ç»“æœã€‚ç›¸æ¯”è¾“å…¥å›¾åƒï¼Œè¿™é‡Œç”¨äºæ£€æµ‹çš„ç‰¹å¾å›¾æœ‰32å€çš„ä¸‹é‡‡æ ·ã€‚æ¯”å¦‚è¾“å…¥æ˜¯416x416çš„è¯ï¼Œè¿™é‡Œçš„ç‰¹å¾å›¾å°±æ˜¯13x13äº†ã€‚ç”±äºä¸‹é‡‡æ ·å€æ•°é«˜ï¼Œè¿™é‡Œç‰¹å¾å›¾çš„æ„Ÿå—é‡æ¯”è¾ƒå¤§ï¼Œå› æ­¤é€‚åˆæ£€æµ‹å›¾åƒä¸­å°ºå¯¸æ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚</p>
<p>ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æ£€æµ‹ï¼Œç¬¬79å±‚çš„ç‰¹å¾å›¾åˆå¼€å§‹ä½œä¸Šé‡‡æ ·ï¼ˆä»79å±‚å¾€å³å¼€å§‹ä¸Šé‡‡æ ·å·ç§¯ï¼‰ï¼Œç„¶åä¸ç¬¬61å±‚ç‰¹å¾å›¾èåˆï¼ˆConcatenationï¼‰ï¼Œè¿™æ ·å¾—åˆ°ç¬¬91å±‚è¾ƒç»†ç²’åº¦çš„ç‰¹å¾å›¾ï¼ŒåŒæ ·ç»è¿‡å‡ ä¸ªå·ç§¯å±‚åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ16å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒå…·æœ‰ä¸­ç­‰å°ºåº¦çš„æ„Ÿå—é‡ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å°ºåº¦çš„å¯¹è±¡ã€‚</p>
<p>æœ€åï¼Œç¬¬91å±‚ç‰¹å¾å›¾å†æ¬¡ä¸Šé‡‡æ ·ï¼Œå¹¶ä¸ç¬¬36å±‚ç‰¹å¾å›¾èåˆï¼ˆConcatenationï¼‰ï¼Œæœ€åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ8å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒçš„æ„Ÿå—é‡æœ€å°ï¼Œé€‚åˆæ£€æµ‹å°å°ºå¯¸çš„å¯¹è±¡ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2709767-9b28d0f1c682b80a.png" alt></p>
<p>å¯¹äºä¸€ä¸ª416x416çš„è¾“å…¥å›¾åƒï¼Œåœ¨æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾çš„æ¯ä¸ªç½‘æ ¼è®¾ç½®3ä¸ªå…ˆéªŒæ¡†ï¼Œæ€»å…±æœ‰ 13x13x3 + 26x26x3 + 52x52x3 = 10647 ä¸ªé¢„æµ‹ã€‚æ¯ä¸€ä¸ªé¢„æµ‹æ˜¯ä¸€ä¸ª(4+1+80)=85ç»´å‘é‡ï¼Œè¿™ä¸ª85ç»´å‘é‡åŒ…å«è¾¹æ¡†åæ ‡ï¼ˆ4ä¸ªæ•°å€¼ï¼‰ï¼Œè¾¹æ¡†ç½®ä¿¡åº¦ï¼ˆ1ä¸ªæ•°å€¼ï¼‰ï¼Œå¯¹è±¡ç±»åˆ«çš„æ¦‚ç‡ï¼ˆå¯¹äºCOCOæ•°æ®é›†ï¼Œæœ‰80ç§å¯¹è±¡ï¼‰ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹ï¼ŒYOLO2é‡‡ç”¨13x13x5 = 845ä¸ªé¢„æµ‹ï¼ŒYOLO3çš„å°è¯•é¢„æµ‹è¾¹æ¡†æ•°é‡å¢åŠ äº†10å¤šå€ï¼Œè€Œä¸”æ˜¯åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸Šè¿›è¡Œï¼Œæ‰€ä»¥mAPä»¥åŠå¯¹å°ç‰©ä½“çš„æ£€æµ‹æ•ˆæœæœ‰ä¸€å®šçš„æå‡ã€‚</p>
</li>
<li><p><strong>9ç§å°ºåº¦çš„å…ˆéªŒæ¡†</strong><br>éšç€è¾“å‡ºçš„ç‰¹å¾å›¾çš„æ•°é‡å’Œå°ºåº¦çš„å˜åŒ–ï¼Œå…ˆéªŒæ¡†çš„å°ºå¯¸ä¹Ÿéœ€è¦ç›¸åº”çš„è°ƒæ•´ã€‚YOLO2å·²ç»å¼€å§‹é‡‡ç”¨K-meansèšç±»å¾—åˆ°å…ˆéªŒæ¡†çš„å°ºå¯¸ï¼ŒYOLO3å»¶ç»­äº†è¿™ç§æ–¹æ³•ï¼Œä¸ºæ¯ç§ä¸‹é‡‡æ ·å°ºåº¦è®¾å®š3ç§å…ˆéªŒæ¡†ï¼Œæ€»å…±èšç±»å‡º9ç§å°ºå¯¸çš„å…ˆéªŒæ¡†ã€‚åœ¨COCOæ•°æ®é›†è¿™9ä¸ªå…ˆéªŒæ¡†æ˜¯ï¼š(10x13)ï¼Œ(16x30)ï¼Œ(33x23)ï¼Œ(30x61)ï¼Œ(62x45)ï¼Œ(59x119)ï¼Œ(116x90)ï¼Œ(156x198)ï¼Œ(373x326)ã€‚</p>
<p>åˆ†é…ä¸Šï¼Œåœ¨æœ€å°çš„13x13ç‰¹å¾å›¾ä¸Šï¼ˆæœ‰æœ€å¤§çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå¤§çš„å…ˆéªŒæ¡†(116x90)ï¼Œ(156x198)ï¼Œ(373x326)ï¼Œé€‚åˆæ£€æµ‹è¾ƒå¤§çš„å¯¹è±¡ã€‚ä¸­ç­‰çš„26x26ç‰¹å¾å›¾ä¸Šï¼ˆä¸­ç­‰æ„Ÿå—é‡ï¼‰åº”ç”¨ä¸­ç­‰çš„å…ˆéªŒæ¡†(30x61)ï¼Œ(62x45)ï¼Œ(59x119)ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å¤§å°çš„å¯¹è±¡ã€‚è¾ƒå¤§çš„52x52ç‰¹å¾å›¾ä¸Šï¼ˆè¾ƒå°çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå°çš„å…ˆéªŒæ¡†(10x13)ï¼Œ(16x30)ï¼Œ(33x23)ï¼Œé€‚åˆæ£€æµ‹è¾ƒå°çš„å¯¹è±¡ã€‚</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2709767-5cc00a60004e0473.png" alt></p>
</li>
<li><p><strong>å¯¹è±¡åˆ†ç±»softmaxæ”¹æˆlogistic</strong><br>YOLOv3 ä¸ä½¿ç”¨ Softmax å¯¹æ¯ä¸ªæ¡†è¿›è¡Œåˆ†ç±»ï¼Œä¸»è¦è€ƒè™‘å› ç´ æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>Softmax ä½¿å¾—æ¯ä¸ªæ¡†åˆ†é…ä¸€ä¸ªç±»åˆ«ï¼ˆå¾—åˆ†æœ€é«˜çš„ä¸€ä¸ªï¼‰ï¼Œè€Œå¯¹äº Open Imagesè¿™ç§æ•°æ®é›†ï¼Œç›®æ ‡å¯èƒ½æœ‰é‡å çš„ç±»åˆ«æ ‡ç­¾ï¼Œå› æ­¤ Softmaxä¸é€‚ç”¨äºå¤šæ ‡ç­¾åˆ†ç±»ã€‚</li>
<li>Softmax å¯è¢«ç‹¬ç«‹çš„å¤šä¸ª logistic åˆ†ç±»å™¨æ›¿ä»£ï¼Œä¸”å‡†ç¡®ç‡ä¸ä¼šä¸‹é™ã€‚<br>æ‰€ä»¥é¢„æµ‹å¯¹è±¡ç±»åˆ«æ—¶ä¸ä½¿ç”¨softmaxï¼Œæ”¹æˆä½¿ç”¨logisticçš„è¾“å‡ºè¿›è¡Œé¢„æµ‹ã€‚è¿™æ ·èƒ½å¤Ÿæ”¯æŒå¤šæ ‡ç­¾å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<h3 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h3><p>Liu, W., et al., SSD: Single Shot MultiBox Detector. (ECCV 2016)</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_14-51-11.jpg" alt></p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li><p><strong>åœ¨å¤šå±‚å¤šå°ºåº¦ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ£€æµ‹</strong></p>
<p>ä½å±‚ç‰¹å¾å›¾å…·æœ‰ç»†èŠ‚ä¿¡æ¯ï¼Œçœ‹å¾—æ¯”è¾ƒç»†ï¼Œè€Œé«˜å±‚ç‰¹å¾å›¾ä¸­å…·æœ‰é«˜çº§è¯­ä¹‰ä¿¡æ¯ï¼Œçœ‹å¾—æ¯”è¾ƒå¹¿ï¼ŒSSDæå‡ºåŒæ—¶åˆ©ç”¨ä½å±‚ç‰¹å¾å›¾å’Œé«˜å±‚ç‰¹å¾å›¾è¿›è¡Œæ£€æµ‹ã€‚SSDä¸ºäº†é¿å…åˆ©ç”¨å¤ªä½å±‚çš„ç‰¹å¾ï¼Œä»VGGåé¢å¼€å§‹ï¼Œåˆå¾€åæ·»åŠ äº†4å±‚å·ç§¯å±‚ï¼Œå¦‚æ­¤å°±å¾—åˆ°äº†å¤šå±‚æ¬¡çš„ç‰¹å¾å›¾ã€‚è¿™6å±‚ç‰¹å¾å›¾çš„å¤§å°åˆ†åˆ«ä¸ºï¼š38x38, 19x19, 10x10, 5x5, 3x3, 1x1</p>
</li>
<li><p><strong>default boxes</strong></p>
<p>two-stage æ–¹æ³•å¤ªæ…¢ï¼Œè®¡ç®—ä»£ä»·å¤§ã€‚SSDä¸­é¿å…ä½¿ç”¨region proposals,è€Œé‡‡ç”¨default boxesã€‚SSDå€Ÿé‰´RPNç½‘ç»œä¸­çš„anchor boxæ¦‚å¿µã€‚é¦–å…ˆå°†feature mapåˆ’åˆ†ä¸ºå°æ ¼å­å«åšfeature map cellï¼Œå†åœ¨æ¯ä¸ªcellä¸­è®¾ç½®ä¸€ç³»åˆ—ä¸åŒé•¿å®½æ¯”çš„default boxã€‚å°†å…¶åº”ç”¨äºä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸­ã€‚åœ¨å¤šä¸ªç‰¹å¾å›¾ä¸­ä½¿ç”¨ä¸åŒçš„é»˜è®¤æ¡†å½¢çŠ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç¦»æ•£å¯èƒ½çš„è¾“å‡ºæ¡†å½¢çŠ¶ç©ºé—´ã€‚</p>
</li>
<li><p><strong>ç”¨å·ç§¯å±‚æ¥é¢„</strong><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2148039-cec47c5d71ce8f22.png" alt>3x3çš„å·ç§¯åœ¨ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ“ä½œï¼Œåœ¨ç‰¹å¾å›¾çš„æ¯ä¸ªç‚¹æå–ç‰¹å¾ï¼Œç„¶åå¯¹æ¯ä¸ªdefault boxç”Ÿæˆå››ä¸ªåç§»é‡æ¥è¡¨ç¤ºç”Ÿæˆçš„bounding boxï¼Œè¿™å››ä¸ªåç§»é‡åˆ†åˆ«è¡¨ç¤ºç”Ÿæˆæ¡†ä¸­å¿ƒxåæ ‡ã€yåæ ‡ã€å®½åº¦ã€é«˜åº¦å¯¹åº”äºå½“å‰default boxçš„åç§»é‡ï¼Œè¿™é‡Œçš„è®¡ç®—æ–¹æ³•é‡‡ç”¨äº†RPNä¸­çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œé’ˆå¯¹æ¯ä¸ªbounding box, å·ç§¯ä¼šè¿›è¡Œåˆ†ç±»æ“ä½œï¼Œè¾“å‡ºCä¸ªåˆ†ç±»æ•°å€¼ï¼Œæ³¨æ„è¿™é‡Œçš„CåŒ…æ‹¬èƒŒæ™¯ç±»ã€‚å› æ­¤å¯¹äºæ¯ä¸ªdefault boxæœ‰C+4ä¸ªè¾“å‡ºå€¼ï¼Œè€ŒKä¸ªdefault boxå°±æœ‰K(C+4)ä¸ªè¾“å‡ºå€¼ï¼Œå› æ­¤ï¼Œæ€»å…±éœ€è¦K*(C+4)ä¸ª3x3å·ç§¯ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯é‡‡ç”¨default boxçš„æ–¹å¼ï¼Œåœ¨å¤šå±‚å¤šå°ºåº¦çš„ç‰¹å¾å›¾ä¸Šä½¿ç”¨å·ç§¯è¿›è¡Œæ£€æµ‹ï¼ˆåˆ†ç±»+å›å½’ï¼‰ã€‚</p>
</li>
<li><p><strong>æ•°æ®å¢å¹¿</strong><br>ä¸ºäº†ä½¿å¾—æ¨¡å‹å¯¹äºä¸åŒå¤§å°ã€ä¸åŒå½¢çŠ¶çš„ç‰©ä½“å…·æœ‰é²æ£’æ€§ï¼Œå› æ­¤é‡‡ç”¨äº†data augmentationã€‚è¿™ç¯‡è®ºæ–‡åœ¨è®­ç»ƒæ—¶ï¼Œé¦–å…ˆå¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œrandom cropï¼Œç„¶åå°†å…¶resizeçš„åŸå›¾å°ºåº¦ï¼Œç„¶åä»¥0.5çš„æ¦‚ç‡è¿›è¡Œæ°´å¹³ç¿»è½¬ã€åŒæ—¶æ·»åŠ ä¸€äº›è‰²å½©å˜æ¢ã€‚</p>
</li>
<li><p><strong>åŠ å…¥atrous</strong><br>å°† VGG ä¸­çš„ FC6 layerã€FC7 layer è½¬æˆä¸º å·ç§¯å±‚ï¼Œå¹¶ä»æ¨¡å‹çš„ FC6ã€FC7 ä¸Šçš„å‚æ•°ï¼Œè¿›è¡Œé‡‡æ ·å¾—åˆ°è¿™ä¸¤ä¸ªå·ç§¯å±‚çš„ parametersã€‚è¿˜å°† Pool5 layer çš„å‚æ•°ï¼Œä»2Ã—2âˆ’s2è½¬å˜æˆ 3Ã—3âˆ’s4ï¼Œå¤–åŠ ä¸€ä¸ª padï¼ˆ1ï¼‰ï¼ˆçŒœæƒ³æ˜¯ä¸æƒ³reduceç‰¹å¾å›¾å¤§å°ï¼‰ï¼Œä¸ºäº†é…åˆè¿™ç§å˜åŒ–ï¼Œé‡‡ç”¨äº†ä¸€ç§Atrous Algorithmï¼Œå…¶å®å°±æ˜¯conv6é‡‡ç”¨æ‰©å±•å·ç§¯æˆ–å¸¦å­”å·ç§¯ï¼ˆDilation Convï¼‰ï¼Œå…¶åœ¨ä¸å¢åŠ å‚æ•°ä¸æ¨¡å‹å¤æ‚åº¦çš„æ¡ä»¶ä¸‹æŒ‡æ•°çº§æ‰©å¤§å·ç§¯çš„è§†é‡ï¼Œå…¶ä½¿ç”¨æ‰©å¼ ç‡(dilation rate)å‚æ•°ï¼Œæ¥è¡¨ç¤ºæ‰©å¼ çš„å¤§å°ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_15-32-00.jpg" alt><br>å¸¦å­”å·ç§¯å¹¶ä¸æ˜¯å·ç§¯æ ¸é‡Œå¸¦å­”ï¼Œè€Œæ˜¯åœ¨å·ç§¯çš„æ—¶å€™ï¼Œè·³ç€çš„å»å·ç§¯mapï¼ˆæ¯”å¦‚dilatedï¼2çš„å­”å·ç§¯ï¼Œå°±æ˜¯éš”ä¸€ä¸ªåƒç´ ç‚¹ï¼Œâ€œå·â€ä¸€ä¸‹ï¼Œè¿™å°±ç›¸å½“äºæŠŠå·ç§¯æ ¸ç»™æ”¾å¤§äº†ï¼ˆ3x3çš„æ ¸å˜æˆ7x7çš„æ ¸ï¼Œå¤šå‡ºä½ç½®çš„weightsç»™0å°±æ˜¯ã€‚ï¼‰è¿™æ ·å°±ä½¿å¾—3x3çš„å·ç§¯æ ¸ä¹Ÿèƒ½è¾¾åˆ°7x7å·ç§¯æ ¸çš„æ„Ÿå—é‡</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/2018051716490729.png" alt></p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong><br>SSDå­˜åœ¨çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>éœ€è¦æ‰‹åŠ¨è®¾ç½®å‚æ•°prior boxï¼Œæ— æ³•é€šè¿‡è®­ç»ƒå¾—åˆ°ï¼Œä¾èµ–ç»éªŒã€‚</li>
<li>å­˜åœ¨ç€å¯¹å°ç›®æ ‡æ£€æµ‹æ•ˆæœä¸å¥½çš„ç°è±¡ã€‚</li>
</ul>
<h3 id="DSSD"><a href="#DSSD" class="headerlink" title="DSSD"></a>DSSD</h3><p>Fu, C., et al., DSSD : Deconvolutional Single Shot Detector. (CVPR 2017)</p>
<p>DSSDé’ˆå¯¹å°ç›®æ ‡é²æ£’æ€§å¤ªå·®ï¼Œæå‡ºäº†ä»¥ä¸‹ä¸¤ä¸ªè´¡çŒ®ï¼š</p>
<ul>
<li>æŠŠSSDçš„åŸºå‡†ç½‘ç»œä»VGGæ¢æˆäº†Resnet-101ï¼Œå¢å¼ºäº†ç‰¹å¾æå–èƒ½åŠ›ï¼›</li>
<li>ä½¿ç”¨åå·ç§¯å±‚ï¼ˆdeconvolution layer ï¼‰å¢åŠ äº†å¤§é‡ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_16-00-32.jpg" alt></p>
<p>æ¢å®Œbase networkä¹‹åï¼Œä½œè€…é€šè¿‡å®éªŒå‘ç°ï¼Œå‡†ç¡®ç‡ä»77.5%é™è‡³äº†76.4%ï¼Œè¯´æ˜åªæ¢ç½‘ç»œå¹¶ä¸èƒ½å¤Ÿæé«˜å‡†ç¡®ç‡ã€‚å¦‚æœèƒ½å¤Ÿæé«˜æ¯ä¸€ä¸ªå­ç½‘ç»œçš„å‡†ç¡®ç‡ï¼Œé‚£æ•´ä¸ªç½‘ç»œçš„å‡†ç¡®ç‡ä¹Ÿä¼šå¾—åˆ°æå‡ã€‚æ‰€ä»¥ä½œè€…åœ¨æ¯æ¬¡é¢„æµ‹ä¹‹å‰åŠ å…¥äº†ä¸€ä¸ªâ€œé¢„æµ‹æ¨¡å—â€ï¼ˆprediction moduleï¼‰ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_16-11-49.jpg" alt><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š<br>(a)ä¸ºåŸSSDå¯¹äºç‰¹å¾ä¿¡æ¯è¿›è¡Œåˆ†ç±»ä¸å®šä½çš„æ¨¡å‹ï¼Œå…¶å®å¹¶æ²¡æœ‰é¢„æµ‹æ¨¡å—ï¼Œç›´æ¥è¿›è¡Œé¢„æµ‹ï¼›<br>(b)ä¸ºä½œè€…åœ¨é¢„æµ‹ä¹‹å‰åŠ å…¥äº†residual blockæ¨¡å—ï¼›<br>(c)å°†residual blockæ¨¡å—ä¸­ç›´æ¥æ˜ å°„identity mappingæ¢æˆäº†1x1å·ç§¯<br>(d)å †ç§¯residual blockæ¨¡å—</p>
<p>ç»è¿‡å®éªŒè¯æ˜ï¼Œï¼ˆcï¼‰èƒ½å¤Ÿè·å¾—æ›´å¥½çš„å‡†ç¡®ç‡ã€‚</p>
<p>ç¬¬äºŒä¸ªè´¡çŒ®å°±æ˜¯æ·»åŠ äº†åå·ç§¯æ¨¡å—ï¼Œå¼•å…¥äº†ç©ºé—´ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œå¤§å¤§æé«˜äº†æ£€æµ‹å‡†ç¡®ç‡ã€‚æ·»åŠ äº†åå·ç§¯ä¹‹åï¼Œæ•´ä¸ªç½‘ç»œå½¢æˆä¸å¯¹ç§°çš„æ²™æ¼ç»“æ„ã€‚</p>
<p>è“è‰²å—ä¸ºå·ç§¯å±‚ï¼Œçº¢è‰²å—ä¸ºåå·ç§¯å±‚ã€‚çº¢è‰²å—åšåå·ç§¯æ“ä½œï¼Œç„¶åä¸åŒå¤§å°çš„å·ç§¯å±‚èåˆï¼Œä¹‹åå†è¿›è¡Œç‰©ä½“æ£€æµ‹ã€‚å…¶ä¸­çš„â€œåå·ç§¯æ¨¡å—â€ï¼ˆDeconvolution moduleï¼‰</p>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/object%20detection/Snipaste_2020-01-08_16-17-17.jpg" alt></p>
<p>å…¶ä¸­Eltw Productæ˜¯å…ƒç´ ç‚¹ç§¯æ“ä½œã€‚ä½œè€…ä¹Ÿå°è¯•äº†å…ƒç´ æ±‚å’Œï¼Œä½†æ˜¯ç‚¹ç§¯æ“ä½œçš„å‡†ç¡®ç‡ç¨é«˜ä¸€äº›ã€‚</p>
<h3 id="ç›®æ ‡æ£€æµ‹è¿›å±•"><a href="#ç›®æ ‡æ£€æµ‹è¿›å±•" class="headerlink" title="ç›®æ ‡æ£€æµ‹è¿›å±•"></a>ç›®æ ‡æ£€æµ‹è¿›å±•</h3><ul>
<li><p>ç”¨æ›´å¥½çš„å¼•æ“æ£€æµ‹</p>
<p>AlexNet<br>VGGï¼š 16â€”19å±‚ï¼Œä½¿ç”¨ 3Ã—3 å·ç§¯æ ¸å–ä»£ 5Ã—5 å’Œ 7Ã—7ã€‚<br>GoogLeNetï¼š å³ï¼ŒInception ç½‘ç»œå®¶æ—ï¼Œå¢åŠ å·ç§¯ç¥ç»ç½‘ç»œæ·±åº¦å’Œå®½åº¦ã€‚<br>ResNet<br>DenseNetï¼š å— short cut è¿æ¥çš„å½±å“ï¼Œä½œè€…å°†æ¯ä¸€å±‚ä»¥å‰é¦ˆçš„æ–¹å¼å’Œå…¶ä»–æ‰€æœ‰å±‚ç›¸è¿ã€‚<br>SENetï¼š ä¸»è¦è´¡çŒ®æ˜¯å°†å…¨å±€æ± åŒ–ä¸ shuffling ç»“åˆï¼Œå­¦ä¹ ç‰¹å¾å›¾é€šé“çš„é‡è¦æ€§ã€‚</p>
</li>
<li><p>ç”¨æ›´å¥½çš„ç‰¹å¾æ£€æµ‹<br>ç ”ç©¶è€…åœ¨æœ€æ–°æ£€æµ‹å¼•æ“çš„åŸºç¡€ä¸Šï¼ŒåŠªåŠ›æé«˜å›¾åƒç‰¹å¾è´¨é‡ï¼Œæœ€é‡è¦çš„ä¸¤ç»„æ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>ç‰¹å¾èåˆ<br>-è‡ªåº•å‘ä¸Šèåˆï¼šé€šè¿‡è·³è·ƒè¿æ¥å°†æµ…å±‚ç‰¹å¾ä¼ é€’åˆ°æ·±å±‚<br>-è‡ªé¡¶å‘ä¸‹èåˆï¼šå°†æ·±å±‚ç‰¹å¾åé¦ˆç»™æµ…å±‚<br>ç‰¹å¾èåˆå¯ä»¥è¢«çœ‹åšæ˜¯ä¸åŒç‰¹å¾å›¾é—´çš„å…ƒç´ è¿ç®—ã€‚ä¸»è¦æœ‰å‡ ç»„æ–¹æ³•ï¼š<br>å…ƒç´ æ±‚å’Œ<br>å…ƒç´ ä¹˜ç§¯<br>ä¸²è”<br>å…ƒç´ ä¹˜ç§¯çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æŠ‘åˆ¶æˆ–è€…å¼ºè°ƒæŸä¸€åŒºåŸŸå†…ç‰¹å¾ï¼Œå¯èƒ½æœ‰åˆ©äºå°ç›®æ ‡æ£€æµ‹ã€‚ç‰¹å¾ä¸²è”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ•´åˆä¸åŒåŒºåŸŸçš„ä¸Šä¸‹æ–‡ç‰¹å¾ï¼Œç¼ºç‚¹æ˜¯å¢åŠ å†…å­˜æ¶ˆè€—ã€‚</li>
<li>å­¦ä¹ å…·æœ‰å¤§æ„Ÿå—é‡çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾<br>å°æ„Ÿå—é‡æ›´å…³æ³¨å±€éƒ¨ç»†èŠ‚ã€‚ç‰¹å¾å›¾åˆ†è¾¨ç‡è¶Šå°ï¼Œè¶Šéš¾æ£€æµ‹å°ç›®æ ‡ã€‚å¢åŠ ç‰¹å¾åˆ†è¾¨ç‡æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å»é™¤æ± åŒ–å±‚ï¼Œæˆ–è€…å‡å°å·ç§¯ä¸‹é‡‡æ ·ç‡ã€‚ä½†æ˜¯è¿™æ ·åŒæ—¶ä¼šå‡å°æ„Ÿå—é‡ã€‚<br>åŒæ—¶å¢åŠ æ„Ÿå—é‡å’Œåˆ†è¾¨ç‡çš„æ–¹æ³•æ˜¯å¼•å…¥ç©ºæ´å·ç§¯ã€‚</li>
</ul>
</li>
<li>å®šä½æå‡<br>ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>è¾¹ç•Œæ¡†ç²¾ç‚¼<br>è®¾è®¡æ–°çš„æŸå¤±å‡½æ•°</li>
<li>å¯¹æ—‹è½¬å’Œå°ºåº¦å˜åŒ–é²æ£’çš„æ£€æµ‹<br>æ•°æ®å¢å¼º<br>ä¸ºä¸åŒæ–¹ä½è®­ç»ƒç‹¬ç«‹æ£€æµ‹å™¨</li>
</ul>
<h3 id="æœªæ¥çš„ç ”ç©¶"><a href="#æœªæ¥çš„ç ”ç©¶" class="headerlink" title="æœªæ¥çš„ç ”ç©¶"></a>æœªæ¥çš„ç ”ç©¶</h3><ul>
<li>è½»é‡çº§ç›®æ ‡æ£€æµ‹ï¼šåŠ é€Ÿæ£€æµ‹ç®—æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¹³ç¨³è¿è¡Œã€‚</li>
<li>æ£€æµ‹ä¸AutoMLï¼šæœªæ¥çš„ä¸€ä¸ªæ–¹å‘æ˜¯ä½¿ç”¨ç¥ç»ç»“æ„æœç´¢ï¼Œå‡å°‘è®¾è®¡æ£€æµ‹æ¨¡å‹æ—¶çš„äººä¸ºå¹²é¢„(ä¾‹å¦‚ï¼Œå¦‚ä½•è®¾è®¡å¼•æ“ï¼Œå¦‚ä½•è®¾ç½®Anchor)</li>
<li>Proposalçš„Anchorç”Ÿæˆæ–¹å¼</li>
<li>å¼±ç›‘ç£æ£€æµ‹</li>
<li>å°ç›®æ ‡æ£€æµ‹</li>
<li>è§†é¢‘ä¸­çš„æ£€æµ‹ï¼ˆå®æ—¶ï¼‰</li>
<li>ä¿¡æ¯èåˆæ£€æµ‹</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>PyQt5ä¸Opencvçš„å°å°èåˆ</title>
    <url>/2019/03/20/PyQt5%E4%B8%8EOpencv%E7%9A%84%E5%B0%8F%E5%B0%8F%E8%9E%8D%E5%90%88/</url>
    <content><![CDATA[<h2 id="ä¸€äº›æ ¸å¿ƒä»£ç "><a href="#ä¸€äº›æ ¸å¿ƒä»£ç " class="headerlink" title="ä¸€äº›æ ¸å¿ƒä»£ç "></a><a id="more"></a>ä¸€äº›æ ¸å¿ƒä»£ç </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class myLabel(QLabel):</span><br><span class="line">    x0 &#x3D; 0</span><br><span class="line">    y0 &#x3D; 0</span><br><span class="line">    x1 &#x3D; 0</span><br><span class="line">    y1 &#x3D; 0</span><br><span class="line">    flag &#x3D; False</span><br><span class="line"></span><br><span class="line">    def mousePressEvent(self,event):</span><br><span class="line">        self.flag &#x3D; True</span><br><span class="line">        self.x0 &#x3D; event.x()</span><br><span class="line">        self.y0 &#x3D; event.y()</span><br><span class="line">    def mouseReleaseEvent(self,event):</span><br><span class="line">        self.flag &#x3D; False</span><br><span class="line"></span><br><span class="line">    def mouseMoveEvent(self,event):</span><br><span class="line">        if self.flag:</span><br><span class="line">            self.x1 &#x3D; event.x()</span><br><span class="line">            self.y1 &#x3D; event.y()</span><br><span class="line">            self.update()</span><br><span class="line">    def paintEvent(self, event):</span><br><span class="line">        super().paintEvent(event)</span><br><span class="line">        rect &#x3D;QRect(self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br><span class="line">        painter &#x3D; QPainter(self)</span><br><span class="line">        painter.setPen(QPen(Qt.red,4,Qt.SolidLine))</span><br><span class="line">        painter.drawRect(rect)</span><br><span class="line"></span><br><span class="line">        pqscreen  &#x3D; QGuiApplication.primaryScreen()</span><br><span class="line">        pixmap2 &#x3D; pqscreen.grabWindow(self.winId(), self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br><span class="line">        pixmap2.save(&#39;555.png&#39;)</span><br><span class="line">    </span><br><span class="line">class Example(QWidget):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.initUI()</span><br><span class="line">    def initUI(self):</span><br><span class="line">        self.resize(675, 300)</span><br><span class="line">        self.setWindowTitle(&#39;å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šå­¦ç‚¹ç¼–ç¨‹å§--opencvã€PyQt5çš„å°å°èåˆ&#39;)</span><br><span class="line"></span><br><span class="line">        self.lb &#x3D; myLabel(self)</span><br><span class="line">        self.lb.setGeometry(QRect(140, 30, 511, 241))</span><br><span class="line"></span><br><span class="line">        img &#x3D; cv2.imread(&#39;xxx.jpg&#39;)</span><br><span class="line">        height, width, bytesPerComponent &#x3D; img.shape</span><br><span class="line">        bytesPerLine &#x3D; 3 * width</span><br><span class="line">        cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br><span class="line">        QImg &#x3D; QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br><span class="line">        pixmap &#x3D; QPixmap.fromImage(QImg)</span><br><span class="line"></span><br><span class="line">        self.lb.setPixmap(pixmap)</span><br><span class="line">        self.lb.setCursor(Qt.CrossCursor)</span><br><span class="line"></span><br><span class="line">        self.show()</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°å¤§ä½“æ€è·¯"><a href="#å®ç°å¤§ä½“æ€è·¯" class="headerlink" title="å®ç°å¤§ä½“æ€è·¯"></a>å®ç°å¤§ä½“æ€è·¯</h2><ul>
<li>é‡æ–°å®ç°QLabelç±»ï¼Œåœ¨ç±»ä¸­é‡æ–°å®ç°äº†é¼ æ ‡çš„ç‚¹å‡»ã€æ‹–åŠ¨ã€é‡Šæ”¾ã€ä»¥åŠç»˜ç”»äº‹ä»¶</li>
<li>åœ¨çª—ä½“ä¸Šæ–°å»ºäº†ä¸€ä¸ªlabelæ ‡ç­¾ï¼Œç„¶åè½½å…¥å›¾ç‰‡</li>
<li>labelæ ‡ç­¾è½½å…¥çš„å›¾åƒæ˜¯ç”±Opencvå®ç°çš„</li>
</ul>
<h2 id="é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯"><a href="#é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯" class="headerlink" title="é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯"></a>é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯</h2><ul>
<li>æ–°å»ºä¸€ä¸ªçŸ©å½¢æ˜¯å¦å®Œæˆæ ‡å¿—flagï¼Œé»˜è®¤æ˜¯Flaseï¼Œè¡¨ç¤ºæœªå®Œæˆ</li>
<li>é¼ æ ‡ç‚¹å‡»çš„æ—¶å€™ï¼Œè®°å½•å½“å‰é¼ æ ‡æ‰€åœ¨ä½ç½®çš„åæ ‡ï¼Œflagæ ‡å¿—ç½®ä¸ºTrueï¼Œè¡¨ç¤ºå¼€å§‹ç”»çŸ©å½¢äº†</li>
<li>é¼ æ ‡æ‹–åŠ¨çš„æ—¶å€™ï¼Œå› ä¸ºflagä¸ºTrueï¼Œæ‰€ä»¥è®°å½•å½“å‰é¼ æ ‡æ‰€åœ¨ä½ç½®çš„åæ ‡</li>
<li>é¼ æ ‡é‡Šæ”¾çš„æ—¶å€™ï¼Œflagç½®ä¸ºFalseï¼Œè¡¨ç¤ºçŸ©å½¢ç”»å®Œäº†ï¼Œå‡†å¤‡ç”»ä¸‹ä¸€ä¸ªäº†</li>
</ul>
<h2 id="ä»£ç è®²è§£"><a href="#ä»£ç è®²è§£" class="headerlink" title="ä»£ç è®²è§£"></a>ä»£ç è®²è§£</h2><h3 id="Opencvå›¾åƒçš„è½¬æ¢"><a href="#Opencvå›¾åƒçš„è½¬æ¢" class="headerlink" title="Opencvå›¾åƒçš„è½¬æ¢"></a>Opencvå›¾åƒçš„è½¬æ¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">img &#x3D; cv2.imread(&#39;xxx.jpg&#39;)</span><br><span class="line">height, width, bytesPerComponent &#x3D; img.shape</span><br><span class="line">bytesPerLine &#x3D; 3 * width</span><br><span class="line">cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br><span class="line">QImg &#x3D; QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br><span class="line">pixmap &#x3D; QPixmap.fromImage(QImg)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå°±æ˜¯Opencvå’ŒPyQtå¯¹è±¡çš„è½¬åŒ–äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">img &#x3D; cv2.imread(&#39;xxx.jpg&#39;)</span><br></pre></td></tr></table></figure><br>ä½¿ç”¨Opencvè¯»å–å›¾åƒã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">height, width, bytesPerComponent &#x3D; img.shape</span><br></pre></td></tr></table></figure><br>åœ¨OpenCV-Pythonç»‘å®šä¸­ï¼Œå›¾åƒä½¿ç”¨NumPyæ•°ç»„çš„å±æ€§(è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè¦æ›´æ–°numpy)æ¥è¡¨ç¤ºå›¾åƒçš„å°ºå¯¸å’Œé€šé“ä¿¡æ¯ã€‚æ­¤æ—¶å¦‚æœæˆ‘ä»¬è¾“å‡ºimg.shapeï¼Œå°†å¾—åˆ°(200, 360, 3)ã€‚æœ€åçš„3è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªRGBå›¾åƒã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br></pre></td></tr></table></figure><br>å°†å›¾åƒä»ä¸€ä¸ªé¢œè‰²ç©ºé—´è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢œè‰²ç©ºé—´ã€‚<br>Pythonä¸­çš„å‡½æ•°è¦æ±‚æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Pythonï¼šcv2.cvtColorï¼ˆsrcï¼Œcode [ï¼Œdst [ï¼ŒdstCn]]ï¼‰â†’dst</span><br></pre></td></tr></table></figure><br>å‚æ•°ï¼š</p>
<ol>
<li>src - è¾“å…¥å›¾åƒï¼š8ä½æ— ç¬¦å·ï¼Œ16ä½æ— ç¬¦å·ï¼ˆCV_16UC â€¦ï¼‰æˆ–å•ç²¾åº¦æµ®ç‚¹æ•°ã€‚</li>
<li>dst - è¾“å‡ºä¸srcç›¸åŒå¤§å°å’Œæ·±åº¦çš„å›¾åƒã€‚</li>
<li>code - é¢œè‰²ç©ºé—´è½¬æ¢ä»£ç ï¼ˆè¯·å‚é˜…ä¸‹é¢çš„è¯´æ˜ï¼‰ã€‚</li>
<li>dstCn - ç›®æ ‡å›¾åƒä¸­çš„é€šé“æ•°é‡ï¼›å¦‚æœå‚æ•°æ˜¯0ï¼Œåˆ™é€šé“çš„æ•°é‡æ˜¯ä»srcå’Œä»£ç è‡ªåŠ¨å¯¼å‡ºçš„ã€‚</li>
</ol>
<p>è¯¥å‡½æ•°å°†è¾“å…¥å›¾åƒä»ä¸€ä¸ªé¢œè‰²ç©ºé—´è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢œè‰²ç©ºé—´ã€‚åœ¨ä»RGBé¢œè‰²ç©ºé—´è½¬æ¢åˆ°RGBé¢œè‰²ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œé€šé“çš„é¡ºåºåº”æ˜ç¡®æŒ‡å®šï¼ˆRGBæˆ–BGRï¼‰ã€‚è¯·æ³¨æ„ï¼ŒOpenCVä¸­çš„é»˜è®¤é¢œè‰²æ ¼å¼é€šå¸¸è¢«ç§°ä¸ºRGBï¼Œä½†å®é™…ä¸Šæ˜¯BGRï¼ˆå­—èŠ‚ç›¸åï¼‰ã€‚å› æ­¤ï¼Œæ ‡å‡†ï¼ˆ24ä½ï¼‰å½©è‰²å›¾åƒä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å°†æ˜¯ä¸€ä¸ª8ä½è“è‰²åˆ†é‡ï¼Œç¬¬äºŒä¸ªå­—èŠ‚å°†æ˜¯ç»¿è‰²ï¼Œè€Œç¬¬ä¸‰ä¸ªå­—èŠ‚å°†æ˜¯çº¢è‰²ã€‚ç¬¬å››ï¼Œäº”ï¼Œå…­å­—èŠ‚å°†æ˜¯ç¬¬äºŒä¸ªåƒç´ ï¼ˆè“è‰²ï¼Œç„¶åæ˜¯ç»¿è‰²ï¼Œç„¶åæ˜¯çº¢è‰²ï¼‰ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°±æ˜¯è¦æ±‚ä»Opencvçš„BGRå›¾åƒè½¬æ¢æˆRGBå›¾åƒäº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¦è½¬æ¢æˆPyQt5å¯ä»¥è¯†åˆ«çš„å•Šï¼<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bytesPerLine &#x3D; 3 * width</span><br><span class="line">QImg &#x3D; QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br></pre></td></tr></table></figure><br>QImageç±»æä¾›äº†ç‹¬ç«‹äºç¡¬ä»¶çš„å›¾åƒè¡¨ç¤ºå½¢å¼ï¼Œå…è®¸ç›´æ¥è®¿é—®åƒç´ æ•°æ®ï¼Œå¹¶å¯ç”¨ä½œç»˜ç”»è®¾å¤‡ã€‚Qtæä¾›äº†å››ä¸ªç±»æ¥å¤„ç†å›¾åƒæ•°æ®ï¼šQImageï¼ŒQPixmapï¼ŒQBitmapå’ŒQPictureã€‚QImageæ˜¯ä¸ºI/Oè®¾è®¡å’Œä¼˜åŒ–çš„ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è¿›è¡Œåƒç´ è®¿é—®å’Œæ“ä½œï¼Œè€ŒQPixmapåˆ™æ˜¯é’ˆå¯¹åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå›¾åƒè€Œè®¾è®¡å’Œä¼˜åŒ–çš„ã€‚ </p>
<p>QBitmapåªæ˜¯ä¸€ä¸ªç»§æ‰¿QPixmapçš„ä¾¿åˆ©ç±»ï¼Œæ·±åº¦ä¸º1ã€‚æœ€åï¼ŒQPictureç±»æ˜¯ä¸€ä¸ªè®°å½•å’Œé‡æ”¾QPainterå‘½ä»¤çš„ç»˜å›¾è®¾å¤‡ã€‚</p>
<p>å› ä¸ºQImageæ˜¯ä¸€ä¸ªQPaintDeviceå­ç±»ï¼ŒQPainterå¯ä»¥ç”¨æ¥ç›´æ¥ç»˜åˆ¶å›¾åƒã€‚åœ¨QImageä¸Šä½¿ç”¨QPainteræ—¶ï¼Œå¯ä»¥åœ¨å½“å‰GUIçº¿ç¨‹ä¹‹å¤–çš„å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œç»˜åˆ¶ã€‚QImageæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¯ç”¨äºè·å–æœ‰å…³å›¾åƒçš„å„ç§ä¿¡æ¯ã€‚ä¹Ÿæœ‰å‡ ä¸ªåŠŸèƒ½ï¼Œä½¿å›¾åƒè½¬æ¢ã€‚<br>è¯¦è§å®˜ç½‘ä»‹ç»ï¼š<a href="https://doc.qt.io/qt-5/qimage.html" target="_blank" rel="noopener">QImage Class | Qt GUI 5.10</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QImg &#x3D; QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°åŸå‹æ˜¯ï¼š<strong>QImage(str, int, int, int, QImage.Format)</strong>ï¼Œç”¨ç»™å®šçš„å®½åº¦ï¼Œé«˜åº¦å’Œæ ¼å¼æ„é€ ä¸€ä¸ªä½¿ç”¨ç°æœ‰å†…å­˜ç¼“å†²åŒºæ•°æ®çš„å›¾åƒã€‚å®½åº¦å’Œé«˜åº¦å¿…é¡»ä»¥åƒç´ æŒ‡å®šã€‚bytesPerLineæŒ‡å®šæ¯è¡Œçš„å­—èŠ‚æ•°ã€‚</p>
<p><strong>è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆbytesPerLine = 3 * widthï¼Ÿ</strong><br>æˆ‘çš„ç†è§£æ˜¯ï¼šå½“1ä¸ªåƒç´ å 3ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶å›¾åƒä¸ºçœŸå½©è‰²å›¾åƒã€‚</p>
<p><strong>QImage.Format_RGB888</strong>è¡¨ç¤ºçš„æ˜¯å›¾åƒå­˜å‚¨ä½¿ç”¨8-8-8 24ä½RGBæ ¼å¼ã€‚å½“ç„¶è¿˜æœ‰æ›´å¤šçš„æ ¼å¼ï¼Œè¯¦è§QImageçš„å®˜æ–¹ä»‹ç»ï¼Œé™äºç¯‡å¹…è¿™é‡Œä¸å±•å¼€ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pixmap &#x3D; QPixmap.fromImage(QImg)</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æƒ³QImageå¯¹è±¡è½¬æ¢æˆQPixmapå¯¹è±¡ï¼Œä¾¿äºä¸‹æ­¥æˆ‘ä»¬å°†Labelæ ‡ç­¾ä¸­è®¾ç½®å›¾åƒã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">self.lb.setPixmap(pixmap)</span><br></pre></td></tr></table></figure><br>è®¾ç½®æ ‡ç­¾çš„å›¾åƒä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">self.lb.setCursor(Qt.CrossCursor)</span><br></pre></td></tr></table></figure><br>è®¾ç½®é¼ æ ‡åœ¨QLabelå¯¹è±¡ä¸­çš„æ ·å¼ï¼Œåªæ˜¯ä¸ºäº†ç”»ç”»å¥½çœ‹äº›è€Œå·²ï¼Œæ²¡å…¶å®ƒçš„æ„æ€ã€‚é™¤äº†è¿™ä¸ªåå­—æ¶çš„ï¼Œè¿˜æœ‰å…¶å®ƒå¾ˆå¤šæ ·å¼ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/v2-cf7bf8978adbaa898f059207f52f3d5b_hd.jpg" alt></p>
<h3 id="é¼ æ ‡äº‹ä»¶"><a href="#é¼ æ ‡äº‹ä»¶" class="headerlink" title="é¼ æ ‡äº‹ä»¶"></a>é¼ æ ‡äº‹ä»¶</h3><p>æŒ‰ç…§ä¸Šæ–‡ä¸­æˆ‘ä»¬ä»‹ç»çš„æ€è·¯ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªQLabelç±»myLabelï¼Œå½“ç„¶æ˜¯ç»§æ‰¿äº†QLabelã€‚ç„¶åæˆ‘ä»¬ç”¨å‡ ä¸ªç±»å˜é‡è®°å½•é¼ æ ‡çš„åæ ‡å’ŒçŸ©å½¢æ˜¯å¦å®Œæˆçš„æ ‡å¿—ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">def mousePressEvent(self,event):</span><br><span class="line">    self.flag &#x3D; True</span><br><span class="line">    self.x0 &#x3D; event.x()</span><br><span class="line">    self.y0 &#x3D; event.y()</span><br><span class="line"></span><br><span class="line">def mouseReleaseEvent(self,event):</span><br><span class="line">    self.flag &#x3D; False</span><br><span class="line"></span><br><span class="line">def mouseMoveEvent(self,event):</span><br><span class="line">    if self.flag:</span><br><span class="line">        self.x1 &#x3D; event.x()</span><br><span class="line">        self.y1 &#x3D; event.y()</span><br><span class="line">        self.update()</span><br></pre></td></tr></table></figure><br>è¿™é‡Œå°±æ˜¯é‡è½½äº†é¼ æ ‡äº§ç”Ÿçš„å‡ ä¸ªäº‹ä»¶ï¼Œæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ã€‚åˆ†åˆ«è®°å½•äº†ç‚¹å‡»é¼ æ ‡ååˆå§‹çš„é¼ æ ‡åæ ‡ï¼Œä»¥åŠé‡Šæ”¾é¼ æ ‡åçš„é¼ æ ‡åæ ‡ã€‚å¹¶åœ¨é¼ æ ‡ç§»åŠ¨çš„æ—¶å€™æ›´æ–°UIã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯ã€‚</p>
<h3 id="ç”»çŸ©å½¢"><a href="#ç”»çŸ©å½¢" class="headerlink" title="ç”»çŸ©å½¢"></a>ç”»çŸ©å½¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def paintEvent(self, event):</span><br><span class="line">    super().paintEvent(event)</span><br><span class="line">    rect &#x3D;QRect(self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br><span class="line">    painter &#x3D; QPainter(self)</span><br><span class="line">    painter.setPen(QPen(Qt.red,4,Qt.SolidLine))</span><br><span class="line">    painter.drawRect(rect)</span><br><span class="line"></span><br><span class="line">    pqscreen  &#x3D; QGuiApplication.primaryScreen()</span><br><span class="line">    pixmap2 &#x3D; pqscreen.grabWindow(self.winId(), self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br><span class="line">    pixmap2.save(&#39;555.png&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜¯å…³é”®ç‚¹å•Šï¼<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">super().paintEvent(event)</span><br></pre></td></tr></table></figure><br>è°ƒç”¨çˆ¶ç±»çš„paintEvent()ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†æ˜¾ç¤ºä½ è®¾ç½®çš„æ•ˆæœã€‚å¦åˆ™ä¼šæ˜¯ä¸€ç‰‡ç©ºç™½ã€‚å¤§å®¶å¯ä»¥è¯•è¯•æ³¨é‡Šè¿™å¥è¯ï¼Œçœ‹çœ‹æ•ˆæœå•Šï¼<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rect &#x3D;QRect(self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br></pre></td></tr></table></figure><br>QRectç±»ä½¿ç”¨æ•´æ•°ç²¾åº¦åœ¨å¹³é¢ä¸­å®šä¹‰ä¸€ä¸ªçŸ©å½¢ã€‚çŸ©å½¢é€šå¸¸è¡¨ç¤ºä¸ºå·¦ä¸Šè§’å’Œå¤§å°ã€‚QRectçš„å¤§å°ï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰å§‹ç»ˆç­‰åŒäºæ„æˆå…¶æ¸²æŸ“åŸºç¡€çš„æ•°å­¦çŸ©å½¢ã€‚QRectå¯ä»¥ç”¨ä¸€ç»„å·¦ï¼Œä¸Šï¼Œå®½å’Œé«˜æ•´æ•°ï¼Œæˆ–è€…ä»QPointå’ŒQSizeæ„æˆã€‚ä»¥ä¸‹ä»£ç åˆ›å»ºä¸¤ä¸ªç›¸åŒçš„çŸ©å½¢ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QRect(100, 200, 11, 16)</span><br><span class="line">QRect(QPoint(100, 200), QSize(11, 16))</span><br><span class="line">painter &#x3D; QPainter(self)</span><br><span class="line">painter.setPen(QPen(Qt.red,4,Qt.SolidLine))</span><br><span class="line">painter.drawRect(rect)</span><br></pre></td></tr></table></figure><br>æ„å»ºä¸€ä¸ªQPainterå¯¹è±¡ï¼Œè®¾ç½®å®ƒçš„ç”»ç¬”ï¼Œç„¶åç”»ä¸€ä¸ªçŸ©å½¢ã€‚è²Œä¼¼æ„Ÿè§‰å¥½ç®€å•ï¼^_^â€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pqscreen  &#x3D; QGuiApplication.primaryScreen()</span><br><span class="line">pixmap2 &#x3D; pqscreen.grabWindow(self.winId(), self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0))</span><br><span class="line">pixmap2.save(&#39;555.png&#39;)</span><br></pre></td></tr></table></figure>
<p>æˆªå±çš„åŸç†å‘¢ï¼Œä¸»è¦è¿˜æ˜¯è¿ç”¨QScreenç±»ä¸­çš„grabWindowæ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QScreen.grabWindow(WId window, int x &#x3D; 0, int y &#x3D; 0, int width &#x3D; -1, int height &#x3D; -1)</span><br></pre></td></tr></table></figure><br>å¤§è‡´æ„æ€æ˜¯åˆ›å»ºå¹¶è¿”å›é€šè¿‡æŠ“å–ç”±QRectï¼ˆxï¼Œyï¼Œwidthï¼Œheightï¼‰é™åˆ¶çš„ç»™å®šçª—å£æ„é€ çš„åƒç´ å›¾ã€‚</p>
<p>å‚æ•°ï¼ˆxï¼Œyï¼‰æŒ‡å®šçª—å£ä¸­çš„åç§»é‡ï¼Œè€Œï¼ˆå®½åº¦ï¼Œé«˜åº¦ï¼‰æŒ‡å®šè¦å¤åˆ¶çš„åŒºåŸŸã€‚å¦‚æœå®½åº¦ä¸ºè´Ÿæ•°ï¼Œåˆ™è¯¥å‡½æ•°å°†æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°çª—å£çš„å³è¾¹ç•Œã€‚å¦‚æœé«˜åº¦ä¸ºè´Ÿæ•°ï¼Œåˆ™è¯¥å‡½æ•°å°†æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°çª—å£çš„åº•éƒ¨ã€‚</p>
<p>çª—å£ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆWIdï¼‰å¯ä»¥ä½¿ç”¨QWidget.winIdï¼ˆï¼‰å‡½æ•°è¿›è¡Œæ£€ç´¢ã€‚grabWindowï¼ˆï¼‰å‡½æ•°ä»å±å¹•æŠ“å–åƒç´ ï¼Œè€Œä¸æ˜¯ä»çª—å£æŠ“å–åƒç´ ï¼Œå³ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªçª—å£éƒ¨åˆ†æˆ–å…¨éƒ¨è¦†ç›–æŠ“å–çš„åƒç´ ï¼Œåˆ™ä¹Ÿä¼šä»ä¸Šé¢çš„çª—å£è·å–åƒç´ ã€‚é¼ æ ‡å…‰æ ‡ä¸€èˆ¬ä¸ä¼šè¢«æŠ“å–ã€‚è¯¦è§å®˜ç½‘ä»‹ç»ï¼šQScreen Class | Qt GUI 5.10</p>
<p>ç”±äºQScreenç±»æ— æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨QGuiApplication.primaryScreen()åˆ›å»ºäº†ä¸€ä¸ªQscreenç±»å¯¹è±¡ã€‚æœ€åä½¿ç”¨pixmap2.save(â€˜555.pngâ€™)ï¼Œä¿å­˜å…·ä½“çš„æˆªå›¾ã€‚</p>
<p>å¦‚æœä½ æƒ³ä¿å­˜çš„å›¾ç‰‡æ²¡æœ‰çº¢æ¡†ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼š<br><a href="http://www.xdbcb8.com/forum/topic/%e3%80%8apyqt5%e4%b8%8eopencv%e7%9a%84%e5%b0%8f%e5%b0%8f%e8%9e%8d%e5%90%88%e3%80%8b%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e4%b8%ad%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e4%bf%9d%e5%ad%98%e4%b8%8b%e6%9d%a5" target="_blank" rel="noopener">ã€Špyqt5ä¸opencvçš„å°å°èåˆã€‹è¿™ç¯‡æ–‡ç« ä¸­å¦‚ä½•å®ç°ä¿å­˜ä¸‹æ¥</a></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Opencv</tag>
        <tag>PyQt5</tag>
      </tags>
  </entry>
  <entry>
    <title>Permmision deniedè§£å†³æ–¹æ³•</title>
    <url>/2019/03/19/Permmision%20denied%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>è¿™æ˜¯å› ä¸ºè¦ç®¡ç†å‘˜æƒé™çš„ï¼Œè€Œubuntuåˆä¸æƒ³ç»™æ™®é€šç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚æ‰€ä»¥è¿™é‡Œå¼€å¯rootè´¦å·</p>
<h2 id="é¦–å…ˆè®¾ç½®-root-å¯†ç "><a href="#é¦–å…ˆè®¾ç½®-root-å¯†ç " class="headerlink" title=" é¦–å…ˆè®¾ç½® root å¯†ç "></a><a id="more"></a> é¦–å…ˆè®¾ç½® root å¯†ç </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo passwd</span><br></pre></td></tr></table></figure>
<p>ä¼šå‡ºç°ä»¥ä¸‹ç”»é¢ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[sudo] password for luban: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â &#x2F;&#x2F;è¾“å…¥å½“å‰æ™®é€šç”¨æˆ·çš„å¯†ç </span><br><span class="line"></span><br><span class="line">Enter new UNIX password: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   &#x2F;&#x2F;ç»™rootè®¾ç½®å¯†ç </span><br><span class="line"></span><br><span class="line">Retype new UNIX password: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#x2F;&#x2F;ç¡®è®¤è¾“å…¥å¯†ç </span><br><span class="line"></span><br><span class="line">passwd: password updated successfully</span><br></pre></td></tr></table></figure></p>
<h2 id="å¼€å¯root"><a href="#å¼€å¯root" class="headerlink" title="å¼€å¯root"></a>å¼€å¯root</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>
<h2 id="ä¿®æ”¹æ–‡ä»¶æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æƒé™</h2><p>ä¸ºäº†è·å¾—æ‰§è¡Œæƒé™ï¼Œå€ŸåŠ©chmodæŒ‡ä»¤ä¿®æ”¹æ–‡ä»¶æƒé™å³å¯ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 777 æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ–°ç¯å¢ƒä¸‹å¿«é€Ÿå®‰è£…ä¾èµ–åŒ…çš„å°æŠ€å·§</title>
    <url>/2019/03/19/Python%E6%96%B0%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p>å½“ä½ æ–°åˆ›ä¸€ä¸ªPythonç¯å¢ƒæ—¶ï¼Œè‹¥è¿˜ç”¨pipä¸€ä¸ªä¸ªè£…ä½ æ‰€éœ€è¦çš„åº“ï¼Œæ˜æ˜¾æ•ˆç‡ååˆ†ä½ä¸‹ã€‚è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§ï¼Œä½ å¯ä»¥ä»å·²é…ç½®å¥½çš„æ—§ç¯å¢ƒä¸­ï¼Œå¯¼å‡ºä¸€ä¸ªrequirements.txt æ–‡ä»¶ï¼Œç”¨äºè®°å½•æ‰€æœ‰ä¾èµ–åŒ…åŠå…¶ç²¾ç¡®çš„ç‰ˆæœ¬å·ã€‚ä»¥ä¾¿æ–°ç¯å¢ƒéƒ¨ç½²ã€‚<br><a id="more"></a><br>åœ¨æ—§ç¯å¢ƒä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆrequirements.txtæ–‡ä»¶ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure><br>requirements.txtä¸­çš„å†…å®¹ç±»ä¼¼å¦‚ä¸‹ï¼Œè®°å½•äº†ä½ æ—§æœ‰ç¯å¢ƒçš„ä¾èµ–åŒ…åŠå…¶ç²¾ç¡®çš„ç‰ˆæœ¬å·ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">appdirs&#x3D;&#x3D;1.4.3</span><br><span class="line">backports.functools-lru-cache&#x3D;&#x3D;1.5</span><br><span class="line">beautifulsoup4&#x3D;&#x3D;4.5.3</span><br><span class="line">bs4&#x3D;&#x3D;0.0.1</span><br><span class="line">cycler&#x3D;&#x3D;0.10.0</span><br><span class="line">kiwisolver&#x3D;&#x3D;1.0.1</span><br><span class="line">lxml&#x3D;&#x3D;3.7.3</span><br><span class="line">matplotlib&#x3D;&#x3D;2.2.0</span><br><span class="line">numpy&#x3D;&#x3D;1.14.1</span><br><span class="line">pandas&#x3D;&#x3D;0.22.0</span><br><span class="line">pyparsing&#x3D;&#x3D;2.2.0</span><br><span class="line">python-dateutil&#x3D;&#x3D;2.6.1</span><br><span class="line">pytz&#x3D;&#x3D;2018.3</span><br><span class="line">six&#x3D;&#x3D;1.11.0</span><br><span class="line">virtualenv&#x3D;&#x3D;15.1.0</span><br></pre></td></tr></table></figure><br>è¿™æ—¶ä½ å¯ä»¥æŠŠrequirements.txtæ‹·å…¥æ–°é…ç½®çš„Pythonç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><br>åˆ™ä¼šæŒ‰ç…§requirements.txtä¸­æ‰€å†™çš„ä¾èµ–åŒ…å’Œç‰ˆæœ¬ä¾åºè¿›è¡Œå®‰è£…ã€‚<br>æ³¨æ„ï¼š<br>è‹¥è¿å…¥çš„ç³»ç»Ÿä¸åŒæˆ–Pythonç‰ˆæœ¬ä¸åŒï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ°ç›¸åº”çš„ä¾èµ–åŒ…ç‰ˆæœ¬è€ŒæŠ¥é”™<br>è¿™æ—¶ä½ å¯ä»¥è¿›å…¥requirements.txtæŠŠæŠ¥é”™çš„ä¾èµ–åŒ…åçš„ç‰ˆæœ¬ä¿¡æ¯å»æ‰ï¼Œä¿å­˜ï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤å³å¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½åŒ¹é…çš„æœ€æ–°ç‰ˆæœ¬ã€‚<br>ä¹Ÿå¯ä»¥æŠŠ==æ”¹æˆ&lt;=ï¼Œä»£è¡¨å®ƒä¼šæœç´¢ä¸å¤§äºæ­¤ç‰ˆæœ¬çš„æœ€é«˜ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚<br>ç”±äºpipä¸‹è½½æºåœ¨å›½å¤–ï¼Œè‹¥æ— åˆé€‚çš„VPNï¼Œæ­¤æœŸé—´ä¸‹è½½è¿‡ç¨‹ä¼šååˆ†æ¼«é•¿ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªå¸¸ç”¨çš„å›½å†…é•œåƒæºï¼š</p>
<ul>
<li>æ¸…åå¤§å­¦ <a href="https://pypi.tuna.tsinghua.edu.cn/simple/" target="_blank" rel="noopener">https://pypi.tuna.tsinghua.edu.cn/simple/</a></li>
<li>ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ <a href="http://pypi.mirrors.ustc.edu.cn/simple/" target="_blank" rel="noopener">http://pypi.mirrors.ustc.edu.cn/simple/</a></li>
<li>é˜¿é‡Œäº‘ <a href="http://mirrors.aliyun.com/pypi/simple/" target="_blank" rel="noopener">http://mirrors.aliyun.com/pypi/simple/</a></li>
<li>è±†ç“£ <a href="http://pypi.douban.com/simple/" target="_blank" rel="noopener">http://pypi.douban.com/simple/</a></li>
<li>åä¸­ç§‘æŠ€å¤§å­¦ <a href="http://pypi.hustunique.com/" target="_blank" rel="noopener">http://pypi.hustunique.com/</a></li>
</ul>
<p>å¯ä»¥åœ¨ä½¿ç”¨pipçš„æ—¶å€™ï¼ŒåŠ ä¸Šå‚æ•°-iå’Œé•œåƒåœ°å€ï¼ŒæŒ‡å®šä¸‹è½½æºï¼ŒåŠ é€Ÿä¸‹è½½è¿‡ç¨‹ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 16.04ä¸‹é…ç½®GPUç‰ˆCUDAå’ŒcuDNN</title>
    <url>/2019/03/19/Ubuntu-16.04%E4%B8%8B%E9%85%8D%E7%BD%AEGPU%E7%89%88CUDA%E5%92%8CcuDNN/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>å…ˆä»‹ç»ä¸‹æˆ‘è‡ªå·±é…ç½®çš„ç¯å¢ƒ</p>
<ul>
<li>Ubuntu 16.04</li>
<li>GTX2080tiæ˜¾å¡</li>
<li>NVIDIA 418.3</li>
<li>CUDA 10.0</li>
<li>cuDNN 7.6.2</li>
</ul>
<p>ä»¥ä¸‹æ•™ç¨‹é’ˆå¯¹ä»é›¶å¼€å§‹çš„ç”¨æˆ·ï¼Œè‹¥ç³»ç»Ÿä¸­å·²è£…æœ‰CUDAå’ŒcuDNNï¼Œå´åœ¨å½“å‰ç”¨æˆ·ä¸‹æ— æ³•ä½¿ç”¨ï¼Œè¯·<a href="#æ·»åŠ ç¯å¢ƒå˜é‡">æ·»åŠ ç¯å¢ƒå˜é‡</a></p>
<h2 id="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"><a href="#å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨" class="headerlink" title="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"></a>å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨</h2><p>1.å…ˆåœ¨<a href="https://www.nvidia.cn/Download/index.aspx?lang=cn" target="_blank" rel="noopener">NVIDIAå®˜ç½‘</a>ä¸Šä¸‹è½½å¯¹åº”çš„é©±åŠ¨ç¨‹åºï¼Œå¯æ ¹æ®è‡ªå·±çš„GPUçš„å‹å·ä¸‹è½½ç›¸åº”çš„.runæ–‡ä»¶<br>ä¾‹å¦‚NVIDIA-Linux-x86_64-3xx.xx.runå½¢å¼çš„æ–‡ä»¶å</p>
<p>2.ç¦ç”¨å¼€æºnouveaué©±åŠ¨<strong>ï¼ˆéå¸¸é‡è¦ï¼‰</strong><br>Ubuntuç³»ç»Ÿé›†æˆçš„æ˜¾å¡é©±åŠ¨ç¨‹åºæ˜¯nouveauï¼Œå®ƒæ˜¯ç¬¬ä¸‰æ–¹ä¸ºNVIDIAå¼€å‘çš„å¼€æºé©±åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å…¶å±è”½æ‰èƒ½å®‰è£…NVIDIAå®˜æ–¹é©±åŠ¨ã€‚<br>å°†é©±åŠ¨æ·»åŠ åˆ°é»‘åå•blacklist.confä¸­ï¼Œä½†æ˜¯ç”±äºè¯¥æ–‡ä»¶çš„å±æ€§ä¸å…è®¸ä¿®æ”¹ã€‚æ‰€ä»¥éœ€è¦å…ˆä¿®æ”¹æ–‡ä»¶å±æ€§ã€‚<br>æŸ¥çœ‹å±æ€§<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ls -lh &#x2F;etc&#x2F;modprobe.d&#x2F;blacklist.conf</span><br></pre></td></tr></table></figure><br>ä¿®æ”¹å±æ€§<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chmod 666 &#x2F;etc&#x2F;modprobe.d&#x2F;blacklist.conf</span><br></pre></td></tr></table></figure><br>ç”¨geditç¼–è¾‘å™¨æ‰“å¼€<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;modprobe.d&#x2F;blacklist.conf</span><br></pre></td></tr></table></figure><br>åœ¨è¯¥æ–‡ä»¶åæ·»åŠ ä¸€ä¸‹å‡ è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">blacklist vga16fb</span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist rivafb</span><br><span class="line">blacklist rivatv</span><br><span class="line">blacklist nvidiafb</span><br></pre></td></tr></table></figure><br>3.å¼€å§‹å®‰è£…<br>å…ˆæŒ‰Ctrl + Alt + F1åˆ°æ§åˆ¶å°ï¼Œå…³é—­å½“å‰å›¾å½¢ç¯å¢ƒ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo service lightdm stop</span><br></pre></td></tr></table></figure><br>å†å®‰è£…é©±åŠ¨ç¨‹åº<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chmod a+x NVIDIA-Linux-x86_64-xxx.run</span><br><span class="line">sudo .&#x2F;NVIDIA-Linux-x86_64-xxx.run -no-x-check -no-nouveau-check -no-opengl-files</span><br></pre></td></tr></table></figure><br>æœ€åé‡æ–°å¯åŠ¨å›¾å½¢ç¯å¢ƒ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo service lightdm start</span><br></pre></td></tr></table></figure><br>åœ¨ç»ˆç«¯é‡Œè¾“å…¥ï¼šnvidia-smi ï¼Œè¾“å‡ºä»¥ä¸‹å›¾ç‰‡çš„ä»£ç åˆ™å®‰è£…æˆåŠŸ<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CUDA%26cuDNN/2019051413224071.png" alt></p>
<h2 id="cuda-10-0å®‰è£…"><a href="#cuda-10-0å®‰è£…" class="headerlink" title="cuda 10.0å®‰è£…"></a>cuda 10.0å®‰è£…</h2><p><a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener">å®˜æ–¹ä¸‹è½½</a><br><a href="https://pan.baidu.com/s/1piTbzIIL3wTx1dCeUDDiOw" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a> æå–ç : aarn<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chmod a+x cuda_10.0.130_410.48_linux.run &#x2F;&#x2F; è·å–æƒé™</span><br><span class="line">sudo sh cuda_10.0.130_410.48_linux.run --tmpdir&#x3D;&#x2F;home&#x2F;max&#x2F;temp</span><br></pre></td></tr></table></figure><br>è¿™é‡ŒåŠ  â€”tmpdir ä¸»è¦æ˜¯ç›´æ¥è¿è¡Œåï¼Œä¼šæç¤ºç©ºé—´ä¸è¶³çš„é—®é¢˜<br>æ¥ä¸‹æ¥è¿›å…¥è‹±æ–‡é€‰æ‹©ç•Œé¢æŒ‰ä½ç©ºæ ¼é”®å¯ä»¥å¿«é€Ÿæµè§ˆ<br>åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€‰é¡¹é€‰æ‹©ï¼š<br>accept #åŒæ„å®‰è£…<br>n #ä¸å®‰è£…Driverï¼Œå› ä¸ºå·²å®‰è£…é©±åŠ¨<strong>ï¼ˆè¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼‰</strong><br>y #å®‰è£…CUDA Toolkit</p>
<h1 id="å®‰è£…åˆ°é»˜è®¤ç›®å½•"><a href="#å®‰è£…åˆ°é»˜è®¤ç›®å½•" class="headerlink" title="å®‰è£…åˆ°é»˜è®¤ç›®å½•"></a>å®‰è£…åˆ°é»˜è®¤ç›®å½•</h1><p>y #åˆ›å»ºå®‰è£…ç›®å½•çš„è½¯é“¾æ¥<br>n #ä¸å¤åˆ¶Samplesï¼Œå› ä¸ºåœ¨å®‰è£…ç›®å½•ä¸‹æœ‰/samples</p>
<h2 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h2><p>homeæ–‡ä»¶ä¸‹ ctrl+Hæ˜¾ç¤ºéšè—æ–‡ä»¶ æ‰“å¼€ .bashrcæ–‡ä»¶åœ¨æœ€åæ·»åŠ <br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.0&#x2F;bin$&#123;PATH:+:$&#123;PATH&#125;&#125;</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.0&#x2F;lib64$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;&#125;</span><br></pre></td></tr></table></figure><br>ç»ˆç«¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¿å­˜æ“ä½œ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure><br>æ£€æŸ¥cudaæ˜¯å¦å®‰è£…æˆåŠŸ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nvcc -V</span><br><span class="line">nvcc --version</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CUDA%26cuDNN/20190514132130343.png" alt></p>
<h2 id="cuDnn-10-0å®‰è£…"><a href="#cuDnn-10-0å®‰è£…" class="headerlink" title="cuDnn 10.0å®‰è£…"></a>cuDnn 10.0å®‰è£…</h2><p><a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DdS0_A4QlZ_3Bhjw8LEC" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a><br>æ³¨æ„ï¼šéœ€è·ŸCUDAç‰ˆæœ¬å¯¹åº”<br>åˆ‡æ¢åˆ°ä¸‹è½½ç›®å½•è¿›è¡Œè§£å‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo tar -zxvf .&#x2F;cudnn-10.0-linux-x64-xxx.tgz</span><br></pre></td></tr></table></figure><br>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°cudaæ–‡ä»¶å¤¹ï¼Œåœ¨å½“å‰ç›®å½•æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp cuda&#x2F;include&#x2F;cudnn.h &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include&#x2F;</span><br><span class="line"> </span><br><span class="line">sudo cp cuda&#x2F;lib64&#x2F;libcudnn* &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64&#x2F;</span><br><span class="line"> </span><br><span class="line">sudo chmod a+r &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include&#x2F;cudnn.h</span><br><span class="line"> </span><br><span class="line">sudo chmod a+r &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64&#x2F;libcudnn*</span><br></pre></td></tr></table></figure><br>åœ¨ç»ˆç«¯è¾“å…¥<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include&#x2F;cudnn.h | grep CUDNN_MAJOR -A 2</span><br></pre></td></tr></table></figure><br>å¦‚æœå‡ºç°ä¸‹å›¾æ‰€ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/CUDA%26cuDNN/20180815114007852.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Ubuntu</tag>
        <tag>CUDA</tag>
        <tag>cuDNN</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu16.04ä¸‹Tensorflow-gpuå®‰è£…</title>
    <url>/2019/03/19/Ubuntu16.04%E4%B8%8BTensorflow-gpu%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆç¡®å®šå®‰è£…å¥½æ˜¾å¡é©±åŠ¨ã€CUDAã€cuDNNï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a href="https://qiyuan-z.github.io/2019/03/19/Ubuntu-16.04ä¸‹é…ç½®GPUç‰ˆCUDAå’ŒcuDNN/">å¦ä¸€ç¯‡åšå®¢</a><br><a id="more"></a><br>1.å®‰è£…Numpy<br>æ¨èå®‰è£…1.16.0ç‰ˆæœ¬ï¼Œè‹¥ä¹‹å‰å·²å®‰è£…ï¼Œè¯·å…ˆå¸è½½<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip uninstall numpy</span><br></pre></td></tr></table></figure><br>ç„¶åæ‰§è¡Œå®‰è£…<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install numpy&#x3D;&#x3D;1.16.0</span><br></pre></td></tr></table></figure><br>2.å®‰è£…Tensorflow-gpu<br>æ¨èå®‰è£…1.14.0ç‰ˆæœ¬<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install tensorflow-gpu&#x3D;&#x3D;1.14.0</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Ubuntu</tag>
        <tag>Tensorflow</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹virtualenvçš„ä½¿ç”¨ä¸pycharmçš„åŸºæœ¬é…ç½®</title>
    <url>/2019/03/19/Ubuntu%E4%B8%8Bvirtualenv%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8Epycharm%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å®‰è£…virtualenv"><a href="#å®‰è£…virtualenv" class="headerlink" title="å®‰è£…virtualenv"></a><a id="more"></a>å®‰è£…virtualenv</h2><p>virtualenvæ˜¯ Python å¤šç‰ˆæœ¬ç®¡ç†çš„åˆ©å™¨ï¼Œä¸åŒç‰ˆæœ¬çš„å¼€å‘è°ƒè¯•å…¨é å®ƒäº†ï¼ˆæ²¡æœ‰å¤šç‰ˆæœ¬å°½é‡ä¹Ÿè£…ä¸Šå§ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo pip install virtualenv</span><br></pre></td></tr></table></figure></p>
<h2 id="åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ"><a href="#åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ"></a>åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ</h2><p>ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">virtualenv + è·¯å¾„</span><br></pre></td></tr></table></figure><br>ä»¥è¿™ç§æ–¹å¼åˆ›å»ºç¯å¢ƒå°†ä¸åŒ…å«ç³»ç»Ÿçš„pythonåŒ…ï¼Œæ–°çš„ç¯å¢ƒé‡Œé¢åªæœ‰pipã€setuptoolså’Œwheelè¿™äº›åŒ…ï¼Œåˆ™è®¸å¤šåŒ…è¦ç”¨pipé‡æ–°å®‰è£…ã€‚</p>
<p>è‹¥éœ€æŒ‡å®špythonç‰ˆæœ¬ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">virtualenv â€“p python3 + è·¯å¾„</span><br></pre></td></tr></table></figure></p>
<h2 id="æ¿€æ´»virtualenvç¯å¢ƒ"><a href="#æ¿€æ´»virtualenvç¯å¢ƒ" class="headerlink" title="æ¿€æ´»virtualenvç¯å¢ƒ"></a>æ¿€æ´»virtualenvç¯å¢ƒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source è·¯å¾„&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç›´æ¥è¿›åˆ°æ‰€åˆ›ç¯å¢ƒçš„binç›®å½•ä¸­å³é”®ç»ˆç«¯ï¼Œè¿è¡Œsource activate<br>æ³¨æ„ï¼šæ¿€æ´»åªå¯¹å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼Œå¦‚æœæ–°æ‰“å¼€äº†ä¸€ä¸ªç»ˆç«¯çš„è¯ï¼Œé‡æ–°è¿è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚ æ¿€æ´»åç»ˆç«¯å‰é¢ä¼šå¤šä¸€ä¸ª(**)çš„ä¸œè¥¿ï¼Œæç¤ºå½“å‰virtualenvçš„åç§°ã€‚</p>
<p>æ¿€æ´»åå¯ä»¥åœ¨å½“å‰ç»ˆç«¯é€šè¿‡python æ–‡ä»¶å.pyçš„æ–¹å¼è¿è¡Œpythonè„šæœ¬ï¼Œå¦‚æœè„šæœ¬ä¸­ä½¿ç”¨äº†å½“å‰ç¯å¢ƒä¸­æ²¡æœ‰çš„åŒ…ï¼Œå°†ä¼šæŠ¥é”™ã€‚</p>
<p>å¯ä»¥åœ¨æ¿€æ´»ç¯å¢ƒåä½¿ç”¨pipå®‰è£…å¯¹åº”çš„åŒ…ã€‚<strong>æ³¨æ„ä¸è¦ä½¿ç”¨sudo</strong>ï¼Œå¦åˆ™åŒ…ä¼šå®‰è£…åˆ°ç³»ç»Ÿå½“ä¸­å»ï¼Œè€Œä¸æ˜¯å½“å‰çš„virtualenvç›®å½•ä¸­ã€‚</p>
<h2 id="é€€å‡ºvirtualenvç¯å¢ƒ"><a href="#é€€å‡ºvirtualenvç¯å¢ƒ" class="headerlink" title="é€€å‡ºvirtualenvç¯å¢ƒ"></a>é€€å‡ºvirtualenvç¯å¢ƒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ç›´æ¥å…³é—­å½“å‰ç»ˆç«¯ã€‚</p>
<h2 id="åˆ é™¤virtualenvç¯å¢ƒ"><a href="#åˆ é™¤virtualenvç¯å¢ƒ" class="headerlink" title="åˆ é™¤virtualenvç¯å¢ƒ"></a>åˆ é™¤virtualenvç¯å¢ƒ</h2><p>ç›´æ¥åˆ é™¤å¯¹åº”ç›®å½•å³å¯åˆ é™¤virtualenvç¯å¢ƒï¼Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿä»»ä½•å½±å“ï¼Œæ‰€ä»¥åœ¨virtualenvä¸­å¯ä»¥æ”¾å¿ƒæ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm -rvf  + è·¯å¾„</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafafdaa2aca.webp" alt></p>
<h2 id="Pycharmé…ç½®"><a href="#Pycharmé…ç½®" class="headerlink" title="Pycharmé…ç½®"></a>Pycharmé…ç½®</h2><p>æ–°å»ºé¡¹ç›®<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb0d3811f2.webp" alt></p>
<ul>
<li><p>New environment using Virtualenv: å°†åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒï¼Œç„¶åä½¿ç”¨å®ƒå½“ä½œå½“å‰é¡¹ç›®çš„pythonè§£é‡Šå™¨ï¼Œé»˜è®¤ä¸åŒ…å«ç³»ç»Ÿçš„pythonåŒ…ã€‚<br>ç›¸å½“äºï¼š virtualenv + è·¯å¾„</p>
</li>
<li><p>location:ä¸ºæ–°å»ºçš„ç¯å¢ƒçš„ä½ç½®ï¼Œé»˜è®¤ä¸ºå½“å‰å·¥ç¨‹ä¸‹çš„venvã€‚</p>
</li>
<li><p>Base interpreter:åŸºäºç³»ç»Ÿä¸­çš„pythonç‰ˆæœ¬ï¼Œæ–°å»ºçš„ç¯å¢ƒä¸­çš„pythonç‰ˆæœ¬ä¸æ­¤ä¸€è‡´ï¼Œå¯ä»¥é€‰æ‹©python2æˆ–è€…python3, å–å†³äºé¡¹ç›®çš„éœ€è¦ï¼Œç›¸å½“äºvirtualenv â€“p pythonç‰ˆæœ¬ +è·¯å¾„ã€‚<br>å‹¾é€‰Inherit global site-packagesï¼ŒåŒ…å«ç³»ç»Ÿçš„pythonåŒ…ï¼Œç›¸å½“äºï¼š virtualenv â€“system-site-packages + è·¯å¾„<br>å‹¾é€‰Make available to all projectsï¼Œä¸‹æ¬¡æ–°å»ºé¡¹ç›®çš„æ—¶å€™ä¼šåœ¨Existing interpreterä¸­æ‰¾åˆ°è¿™ä¸ªç¯å¢ƒï¼Œ å¯ä»¥é‡å¤ä½¿ç”¨è¿™ä¸ªç¯å¢ƒã€‚</p>
</li>
<li><p>Existing interpreterï¼šä½¿ç”¨å·²æœ‰çš„pythonç¯å¢ƒï¼Œç‚¹å‡»åä¼šå‡ºç°åé¢çš„è®¾ç½®ä¼šå‡ºç°è¿™ä¸ªç•Œé¢ï¼Œåˆ†åˆ«æ˜¯virtualenv, condaå’Œç³»ç»Ÿçš„pythonç¯å¢ƒã€‚å¯ä»¥é€‰æ‹©å·²æœ‰çš„virtualenvç¯å¢ƒï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„pythonè§£é‡Šå™¨ã€‚ Condaæ˜¯anaconda(ä¸€ä¸ªç§‘å­¦è®¡ç®—çš„pythonå‘è¡Œç‰ˆ)çš„åŒ…ç®¡ç†å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å»ºç«‹pythonç¯å¢ƒã€‚</p>
</li>
</ul>
<p>ä¼šå‘ç°ç”Ÿæˆçš„é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªå«venvçš„æ–‡ä»¶å¤¹ï¼Œå®ƒå®è´¨ä¸Šå’Œç›´æ¥ç”¨virtualenvåˆ›å»ºçš„ä¸€æ ·ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb2bd99f29.webp" alt><br>å¯ä»¥ç”¨virtualenvçš„ç®¡ç†æ–¹æ³•ç®¡ç†å®ƒï¼Œæ¯”å¦‚å®‰è£…numpyï¼Œå®‰è£…ä¹‹åå¯ä»¥åœ¨pycharmæ­£å¸¸ä½¿ç”¨ã€‚ï¼ˆæ³¨æ„åœ¨virtualenvä¸­<strong>ä¸è¦ä½¿ç”¨sudo</strong>ï¼‰<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb2bdb011c.webp" alt><br>ä¹Ÿå¯ä»¥åœ¨pycharmä¸­ä½¿ç”¨ file-settings-project-project interpreterä¸­ç®¡ç†ç¯å¢ƒä¸­çš„pythonåŒ…ï¼Œå¯ä»¥å¯¹è¯¥ç¯å¢ƒä¸‹çš„pythonåŒ…è¿›è¡Œåˆ é™¤å’Œå®‰è£…ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Ubuntu</tag>
        <tag>virtualenv</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å¦‚ä½•æ·»åŠ æ–°ç”¨æˆ·å¹¶å¢åŠ ç®¡ç†å‘˜æƒé™</title>
    <url>/2019/03/19/Ubuntu%E4%B8%8B%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7%E5%B9%B6%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<h2 id="æ·»åŠ æ–°ç”¨æˆ·"><a href="#æ·»åŠ æ–°ç”¨æˆ·" class="headerlink" title=" æ·»åŠ æ–°ç”¨æˆ·"></a><a id="more"></a> æ·»åŠ æ–°ç”¨æˆ·</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo adduser xxx #xxxä¸ºç”¨æˆ·å</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥å¯†ç åï¼Œå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ­£åœ¨æ·»åŠ ç”¨æˆ·&quot;xxx&quot;â€¦</span><br><span class="line">æ­£åœ¨æ·»åŠ æ–°ç»„&quot;xxx&quot; (1003)â€¦</span><br><span class="line">æ­£åœ¨æ·»åŠ æ–°ç”¨æˆ·&quot;xxx&quot; (1003) åˆ°ç»„&quot;xxx&quot;â€¦</span><br><span class="line">åˆ›å»ºä¸»ç›®å½•&quot;&#x2F;home&#x2F;xxx&quot;â€¦</span><br><span class="line">æ­£åœ¨ä»&quot;&#x2F;etc&#x2F;skel&quot;å¤åˆ¶æ–‡ä»¶â€¦</span><br><span class="line">è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">é‡æ–°è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">passwdï¼šå·²æˆåŠŸæ›´æ–°å¯†ç </span><br><span class="line">æ­£åœ¨æ”¹å˜ xxx çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">è¯·è¾“å…¥æ–°å€¼ï¼Œæˆ–ç›´æ¥æ•²å›è½¦ä»¥ä½¿ç”¨é»˜è®¤å€¼</span><br><span class="line">        å…¨å [ ]ï¼š</span><br><span class="line">        æˆ¿é—´å·ç  [ ]ï¼š</span><br><span class="line">        å·¥ä½œç”µè¯ [ ]ï¼š</span><br><span class="line">        å®¶åº­ç”µè¯ [ ]ï¼š</span><br><span class="line">        å…¶å®ƒ [ ]ï¼š</span><br><span class="line">è¿™äº›ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Ÿ [Y&#x2F;n] y</span><br></pre></td></tr></table></figure><br>åˆ°è¿™é‡Œï¼Œæ–°ç”¨æˆ·æ·»åŠ æˆåŠŸã€‚</p>
<h2 id="å¢åŠ ç®¡ç†å‘˜æƒé™"><a href="#å¢åŠ ç®¡ç†å‘˜æƒé™" class="headerlink" title="å¢åŠ ç®¡ç†å‘˜æƒé™"></a>å¢åŠ ç®¡ç†å‘˜æƒé™</h2><p>éœ€è¦è®©æ­¤ç”¨æˆ·æœ‰rootæƒé™ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo nano &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure><br>å¾€ä¸‹æ‹‰ï¼Œä¿®æ”¹æ–‡ä»¶å¹¶æ·»åŠ ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xxx ALL&#x3D;(ALLï¼šALL) ALL #xxxä¸ºä½ ä¹‹å‰æ‰€åˆ›çš„ç”¨æˆ·å</span><br></pre></td></tr></table></figure><br>æ·»åŠ å®ŒæˆæŒ‰ä¸‹Ctrl + Xä¿å­˜å¹¶é€€å‡ºï¼Œå†æ¬¡æŒ‰ä¸‹Enter,å®Œæˆ<br>ç°åœ¨ä½ å¯ä»¥ç‚¹å‡»å³ä¸Šè§’ï¼Œçœ‹åˆ°ä½ æ–°åˆ›çš„ç”¨æˆ·ï¼Œç‚¹å‡»å¹¶åˆ‡æ¢äº†ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å®‰è£…Pycharm</title>
    <url>/2019/03/19/Ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85Pycharm/</url>
    <content><![CDATA[<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a><a id="more"></a>ä¸‹è½½</h2><p>æœ‰ç¤¾åŒºç‰ˆå’Œä¸“ä¸šç‰ˆï¼Œä¸“ä¸šç‰ˆéœ€è¦æ¿€æ´»ï¼Œç¤¾åŒºç‰ˆå…è´¹ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯ç¤¾åŒºç‰ˆã€‚<br><a href="https://www.jetbrains.com/pycharm/download/#section=linux" target="_blank" rel="noopener">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DfZJG3QQlZ_3Bhj8mrEC" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿›å…¥downloadç›®å½•ï¼Œå¯¹ä¸‹è½½å¥½çš„Pycharmå‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œé€‰ä¸­æ–‡ä»¶å³é”®æå–åˆ°æ­¤å¤„å³å¯ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D1664510513%2C942693123%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>è¿›å…¥è§£å‹åçš„Pycharmæ–‡ä»¶å¤¹ï¼Œè¿›å…¥binç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶å«åšpycharm.shã€‚ä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­æ‰€é€‰ä¸­çš„æ–‡ä»¶ï¼š<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D101055722%2C4258535600%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>æ­¤æ—¶åœ¨binæ–‡ä»¶å¤¹ä¸‹å³é”®æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥è¿è¡Œå‘½ä»¤, æ‰§è¡ŒPycharmç¨‹åº<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;pycharm.sh</span><br></pre></td></tr></table></figure><br>å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œå¤§å®¶å¯ä»¥æ·»åŠ sudoå‘½ä»¤è¿›è¡Œæ“ä½œï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo .&#x2F;pycharm.sh</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D805484803%2C1629350165%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>å¤§å®¶ç‚¹å‡»OKå³å¯è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œï¼Œæ ¹æ®æç¤ºçš„å†…å®¹è¿›è¡Œå‹¾é€‰åŒæ„åè®®ï¼Œç„¶åç‚¹å‡»continueè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»donâ€™t sendè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œé€‰æ‹©å–œæ¬¢çš„ç•Œé¢é£æ ¼ï¼Œç„¶åå†æ¬¡ç‚¹å‡»nextè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°æç¤ºstartå¯åŠ¨ç¨‹åºã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D227808303%2C3066408894%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D22323540%2C1357101677%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D1914658415%2C2906990210%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>ä¸ºäº†æ–¹ä¾¿ä»¥åçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†Pycharmçš„å›¾æ ‡ï¼ˆå¿«æ·é”®ï¼‰é”å®šåˆ°å¯åŠ¨å™¨ã€‚ä¹‹åä¸ç”¨å†å»åœ¨ç»ˆç«¯ä¸­å¯åŠ¨Pycharmäº†ï¼Œç›´æ¥ç‚¹å‡»å›¾æ ‡å¯åŠ¨å³å¯ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/pycharm/u%3D1149108563%2C3867497858%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å®‰è£…æ›´æ–°pip</title>
    <url>/2019/03/19/Ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85%E6%9B%B4%E6%96%B0pip/</url>
    <content><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a><a id="more"></a>å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install python-pip</span><br></pre></td></tr></table></figure>
<p>è‹¥åŒæ—¶è£…æœ‰Python2ã€Python3ä¸Šæ¡å‘½ä»¤è£…çš„æ˜¯pip2ï¼Œè‹¥è¿˜éœ€è£…pip3ï¼Œåˆ™å†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br></pre></td></tr></table></figure></p>
<h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>å®‰è£…æˆåŠŸåè¿›è¡Œæ›´æ–°ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo pip install --upgrade pip</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo pip3 install --upgrade pip</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å¦‚ä½•å®‰è£…æœç‹—è¾“å…¥æ³•</title>
    <url>/2019/03/19/sougou/</url>
    <content><![CDATA[<h2 id="Ubuntuç³»ç»Ÿé…ç½®"><a href="#Ubuntuç³»ç»Ÿé…ç½®" class="headerlink" title=" Ubuntuç³»ç»Ÿé…ç½®"></a><a id="more"></a> Ubuntuç³»ç»Ÿé…ç½®</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">system settings-&gt;language support-&gt;install&#x2F;remove languages</span><br></pre></td></tr></table></figure>
<p>åœ¨å¼¹å‡ºçš„èœå•ä¸­é€‰æ‹©Chinese(simplified),ç‚¹å‡»apply<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/20180729142927736.png" alt><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/20180729142927712.png" alt></p>
<h2 id="é…ç½®è¾“å…¥æ³•æ¡†æ¶"><a href="#é…ç½®è¾“å…¥æ³•æ¡†æ¶" class="headerlink" title="é…ç½®è¾“å…¥æ³•æ¡†æ¶"></a>é…ç½®è¾“å…¥æ³•æ¡†æ¶</h2><p>æœç‹—è¾“å…¥æ³•æ˜¯å»ºç«‹åœ¨fcitxæ¡†æ¶ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥è¦å°†è¾“å…¥æ³•æ¡†æ¶é€‰æ‹©ä¸ºfictx<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/20180729142927666.png" alt><br>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰fcitxé€‰é¡¹ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å®‰è£…fcitxæ¡†æ¶ä¹‹ååœ¨è¿›è¡Œé…ç½®ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:fcitx-team&#x2F;nightly Â  &#x2F;&#x2F;æ·»åŠ FCITXä»“åº“</span><br><span class="line"></span><br><span class="line">sudo apt-get updateÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#x2F;&#x2F;æ›´æ–°ä»“åº“</span><br><span class="line"></span><br><span class="line">sudo apt-get install fcitxÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â  &#x2F;&#x2F;å®‰è£…fcitxè¾“å…¥æ³•æ¡†æ¶</span><br></pre></td></tr></table></figure><br>é…ç½®å¥½è¾“å…¥æ³•æ¡†æ¶ä¹‹åï¼Œé‡å¯ubuntuç³»ç»Ÿã€‚é‡å¯ä¹‹åå¦‚æœé…ç½®æˆåŠŸï¼Œåœ¨ä»»åŠ¡æ çš„å³ä¸Šè§’ä¼šå‡ºç°fcitxçš„è®¾ç½®é€‰é¡¹ï¼ˆä¸€ä¸ªå°é”®ç›˜å›¾æ ‡ï¼‰<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/20180729142927651.png" alt></p>
<h2 id="å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for-Linux"><a href="#å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for-Linux" class="headerlink" title="å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for Linux"></a>å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for Linux</h2><p><a href="https://pinyin.sogou.com/linux/" target="_blank" rel="noopener">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DeShNo0QlZ_3Bhic5rAC" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a><br>ä¸‹è½½å®Œæˆä¹‹åï¼Œåœ¨downloadç›®å½•ä¸‹æ‰¾åˆ°ä¸‹è½½çš„æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…å³å¯ï¼Œç‚¹å‡»installå³å¯<br>æˆ–è€…åœ¨ç»ˆç«¯çš„å‘½ä»¤çª—å£ä¸­è¾“å…¥å¦‚ä¸‹çš„æŒ‡ä»¤å®‰è£…ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i å®‰è£…åŒ…åç§°.deb</span><br></pre></td></tr></table></figure><br>å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°ç›¸å…³ä¾èµ–æ–‡ä»¶çš„é”™è¯¯ã€‚åˆ™éœ€è¦å…ˆå®‰è£…å…¶ä¾èµ–çš„è½¯ä»¶åŒ…<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/Snipaste_2019-12-13_14-33-14.jpg" alt><br>åœ¨ç»ˆç«¯çª—å£æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…ç¼ºå°‘çš„ä¾èµ–æ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/Snipaste_2019-12-13_14-33-49.jpg" alt><br>å®‰è£…å®Œæˆåï¼Œé¦–å…ˆæ‰“å¼€å³ä¸Šè§’ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç¬¬ä¸€è¡Œçš„æœ€åä¸€ä¸ªé€‰é¡¹â€Text Entryâ€œï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„+å·ï¼Œåœ¨æ‰“å¼€çš„çª—å£ä¸­æ‰¾åˆ°æœç‹—è¾“å…¥æ³•Sogou pinyinç‚¹å‡»Addæ·»åŠ è¿›å»<br>ä»…æ˜¾ç¤ºå½“å‰è¯­è¨€ä¸€å®šè¦å»æ‰é‚£ä¸ªå‹¾ï¼Œæ‰å¯ä»¥æ‰¾åˆ°æœç‹—è¾“å…¥æ³•ï¼Œç„¶åæ·»åŠ å°±æ˜¯<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/sougou/2019050512074094.png" alt><br>è¿™æ—¶å°±å¯ä»¥åœ¨å³ä¸Šæ–¹å°é”®ç›˜é€‰æ‹©æœç‹—è¾“å…¥æ³•äº†ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntuä¸‹ teamviewerçš„å®‰è£…æ–¹æ³•</title>
    <url>/2019/03/19/ubuntu%E4%B8%8B-teamviewer%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"><a href="#å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title=" å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"></a><a id="more"></a> å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…</h2><p><a href="https://www.teamviewer.com/zhcn/download/linux/" target="_blank" rel="noopener">å®˜ç½‘é“¾æ¥</a><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/teamviewer/20180128120840387.png" alt></p>
<h2 id="åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…"><a href="#åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…" class="headerlink" title="åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…"></a>åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…</h2><p>ï¼ˆåœ¨ä¸‹è½½æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼šsudo dpkg -i  teamviewer_13.0.6634_amd64.debï¼‰ï¼ˆteamviewer_13.0.6634_amd64.debä¸ºå®‰è£…åŒ…åï¼Œæ ¹æ®è‡ªå·±å®‰è£…åŒ…ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i  teamviewer_13.0.6634_amd64.deb</span><br></pre></td></tr></table></figure></p>
<h2 id="å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»"><a href="#å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»" class="headerlink" title="å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»"></a>å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»</h2><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/teamviewer/20180128120923823.png" alt><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -f</span><br></pre></td></tr></table></figure></p>
<h2 id="å†æ¬¡å®‰è£…"><a href="#å†æ¬¡å®‰è£…" class="headerlink" title="å†æ¬¡å®‰è£…"></a>å†æ¬¡å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i  teamviewer_13.0.6634_amd64.deb</span><br></pre></td></tr></table></figure>
<h2 id="æ‰“å¼€teamview"><a href="#æ‰“å¼€teamview" class="headerlink" title="æ‰“å¼€teamview"></a>æ‰“å¼€teamview</h2><p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/teamviewer/20180128121156354.png" alt><br>æˆ–ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo teamviewer --daemon start</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Teamviewer</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è§£å†³å‡ºç° unable to resolve host é—®é¢˜</title>
    <url>/2019/03/19/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%87%BA%E7%8E%B0-unable-to-resolve-host-%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id><a href="#" class="headerlink" title></a><a id="more"></a></h2><p>Ubuntuç¯å¢ƒï¼Œæœ‰æ—¶å€™æ‰§è¡Œsudo å°±å‡ºç°è¿™ä¸ªè­¦å‘Šè®¯æ¯: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo: unable to resolve host abc</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶sudo è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œ, ä½†æ˜¯çœ‹åˆ°è¿™æ ·çš„é€šçŸ¥è¿˜æ˜¯ä¼šè§‰å¾—çƒ¦ï¼Œæ€ä¹ˆå»é™¤è¿™ä¸ªè­¦å‘Šå‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªè­¦å‘Šæ˜¯å› ä¸ºç³»ç»Ÿæ‰¾ä¸åˆ°ä¸€ä¸ªå«åš abcçš„hostname </p>
<p>é€šè¿‡ ä¿®æ”¹ /etc/hosts è®¾å®š, å¯ä»¥è§£å†³<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nano &#x2F;etc&#x2F;hostname</span><br></pre></td></tr></table></figure></p>
<p>åœ¨127.0.0.1 localhost åé¢åŠ ä¸Šä¸»æœºåç§°(hostname) å³å¯:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1 localhost abc</span><br></pre></td></tr></table></figure><br>é—®é¢˜è§£å†³ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>çŸ©é˜µåˆ†æï¼ˆåˆ˜ä¸é…‰ï¼‰è¯¾åç­”æ¡ˆåŠå†å¹´è¯•å·</title>
    <url>/2019/03/19/%E7%9F%A9%E9%98%B5%E5%88%86%E6%9E%90%EF%BC%88%E5%88%98%E4%B8%81%E9%85%89%EF%BC%89%E8%AF%BE%E5%90%8E%E7%AD%94%E6%A1%88%E5%8F%8A%E5%8E%86%E5%B9%B4%E8%AF%95%E5%8D%B7/</url>
    <content><![CDATA[<p>è€ƒè™‘åˆ°åˆ˜ä¸é…‰ç‰ˆæœ¬åªæœ‰éƒ¨åˆ†ä¹ é¢˜çš„è§£ç­”ï¼Œè¿˜ä¸å¤Ÿè¯¦ç»†ï¼Œäºæ˜¯æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå°†æ¯é“ä¹ é¢˜åšäº†ä¸€éï¼Œå¹¶è®°å½•äº†ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½å¯¹å­¦ä¹ çŸ©é˜µåˆ†æçš„åŒå­¦ç»™äºˆä¸€å®šçš„å‚è€ƒã€‚ç”±äºæœ¬äººä»åœ¨å­¦ä¹ é˜¶æ®µï¼Œéš¾å…ç­”æ¡ˆä¼šæœ‰åšé”™çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦å°½ä¿¡ç­”æ¡ˆï¼Œåªå½“ä½œä¸€ä¸ªæ€è·¯ä¸Šçš„å‚è€ƒæ¥çœ‹ã€‚é¡ºä¾¿é™„èµ å†å¹´çš„å·å­ä¸ç­”æ¡ˆï¼ˆçœ‹äº†ä¸€éå†å¹´çš„å·å­ï¼Œç­”æ¡ˆæœ‰é”™!@-@ï¼‰<br><a id="more"></a><br>ä¸‹è½½åœ°å€ï¼š<a href="https://www.jianguoyun.com/p/DQe8_9kQlZ_3Bhid4LYC" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a></p>
]]></content>
      <categories>
        <category>èµ„æºåˆ†äº«</category>
      </categories>
      <tags>
        <tag>çŸ©é˜µåˆ†æ</tag>
      </tags>
  </entry>
</search>

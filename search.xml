<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JetBrainså…¨ç³»åˆ—è½¯ä»¶æ¿€æ´»æ•™ç¨‹</title>
    <url>/2022/01/14/JetBrains%E5%85%A8%E7%B3%BB%E5%88%97%E8%BD%AF%E4%BB%B6%E6%BF%80%E6%B4%BB%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>Jetbrainså®¶çš„äº§å“æœ‰ä¸€ä¸ªå¾ˆè‰¯å¿ƒçš„åœ°æ–¹ï¼Œä»–ä¼šå…è®¸ä½ è¯•ç”¨ 30 å¤©ï¼ˆè¿™ä¸ªæ•°å­—å†™æ­»åœ¨ä»£ç é‡Œäº†ï¼‰ä»¥è¯„ä¼°æ˜¯å¦ä½ çœŸçš„éœ€è¦ä¸ºå®ƒè€Œä»˜è´¹ã€‚ å› æ­¤æ¨èä½¿ç”¨æ— é™é‡ç½®è¯•ç”¨çš„æ–¹æ³•ç™½å«–ï¼Œæœ€ç»ˆå’Œæ°¸ä¹…æ¿€æ´»ä½¿ç”¨æ— å·®å¼‚ï¼Œä¹Ÿæ¯”ç ´è§£ç¨³å®šã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114101810909.png" alt></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åœ¨<code>Settings/Preferences... -&gt; Plugins</code>å†…æ‰‹åŠ¨æ·»åŠ ç¬¬ä¸‰æ–¹æ’ä»¶ä»“åº“åœ°å€ï¼š<code>https://plugins.zhile.io</code>æœç´¢ï¼šIDE Eval Resetæ’ä»¶è¿›è¡Œå®‰è£…ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114101936925.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114102036711.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114102121670.png" alt></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ IDE çª—å£åˆ‡å‡ºå»æˆ–åˆ‡å›æ¥æ—¶ï¼ˆçª—å£å¤±å»/å¾—åˆ°ç„¦ç‚¹ï¼‰ä¼šè§¦å‘äº‹ä»¶ï¼Œæ£€æµ‹æ˜¯å¦é•¿æ—¶é—´ï¼ˆ25å¤©ï¼‰æ²¡æœ‰é‡ç½®ï¼Œç»™é€šçŸ¥è®©ä½ é€‰æ‹©ã€‚ï¼ˆåˆæ¬¡å®‰è£…å› ä¸ºæ— æ³•è·å–ä¸Šæ¬¡é‡ç½®æ—¶é—´ï¼Œä¼šç›´æ¥ç»™äºˆæç¤ºï¼‰ã€‚</p>
<p>æ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨å”¤å‡ºæ’ä»¶çš„ä¸»ç•Œé¢ï¼š</p>
<p>a. å¦‚æœ IDE æ²¡æœ‰æ‰“å¼€é¡¹ç›®ï¼Œåœ¨ Welcome ç•Œé¢ç‚¹å‡» IDE çš„èœå•ï¼š<code>Get Help -&gt; Eval Reset</code></p>
<p>b. å¦‚æœ IDE æ‰“å¼€äº†é¡¹ç›®ï¼Œç‚¹å‡» IDE çš„èœå•ï¼š<code>Help -&gt; Eval Reset</code></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114102222559.png" alt></p>
<p>å”¤å‡ºçš„æ’ä»¶ä¸»ç•Œé¢ä¸­åŒ…å«äº†ä¸€äº›æ˜¾ç¤ºä¿¡æ¯ï¼Œæœ‰ 2 ä¸ªæŒ‰é’®å’Œ 1 ä¸ªå‹¾é€‰é¡¹ï¼š</p>
<ul>
<li>æŒ‰é’®ï¼š<code>Reload</code> ç”¨æ¥åˆ·æ–°ç•Œé¢ä¸Šçš„æ˜¾ç¤ºä¿¡æ¯ã€‚</li>
<li>æŒ‰é’®ï¼š<code>Reset</code> ç‚¹å‡»ä¼šè¯¢é—®æ˜¯å¦é‡ç½®è¯•ç”¨ä¿¡æ¯å¹¶é‡å¯ IDEã€‚é€‰æ‹© Yes åˆ™æ‰§è¡Œé‡ç½®æ“ä½œå¹¶é‡å¯ IDE ç”Ÿæ•ˆï¼Œé€‰æ‹© No åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚ï¼ˆæ­¤ä¸ºæ‰‹åŠ¨é‡ç½®æ–¹å¼ï¼‰</li>
<li>å‹¾é€‰é¡¹ï¼š<code>Auto reset before per restart</code> å¦‚æœå‹¾é€‰äº†ï¼Œåˆ™è‡ªå‹¾é€‰åæ¯æ¬¡é‡å¯/é€€å‡º IDE æ—¶ä¼šè‡ªåŠ¨é‡ç½®è¯•ç”¨ä¿¡æ¯ï¼Œä½ æ— éœ€åšé¢å¤–çš„äº‹æƒ…ã€‚ï¼ˆæ­¤ä¸ºè‡ªåŠ¨é‡ç½®æ–¹å¼ï¼Œæ¨èæ­¤æ–¹æ³•ï¼ï¼‰</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/jetbrains/image-20220114102304339.png" alt></p>
<h3 id="ä¸€äº›è¯´æ˜"><a href="#ä¸€äº›è¯´æ˜" class="headerlink" title="ä¸€äº›è¯´æ˜"></a>ä¸€äº›è¯´æ˜</h3><p>å¸‚åœºä»˜è´¹æ’ä»¶çš„è¯•ç”¨ä¿¡æ¯ä¹Ÿä¼šä¸€å¹¶é‡ç½®ã€‚</p>
<p>MyBatisCodeHelperPro æ’ä»¶æœ‰ä¸¤ä¸ªç‰ˆæœ¬å¦‚ä¸‹ï¼ŒåŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œå®‰è£…æ—¶é¡»çœ‹æ¸…æ¥šï¼</p>
<ul>
<li><a href="https://plugins.jetbrains.com/plugin/14522-mybatiscodehelperpro-marketplace-edition-">MyBatisCodeHelperPro</a> (Marketplace Edition)ï¼Œ<code>å¯é‡ç½®</code>ï¼</li>
<li><a href="https://plugins.jetbrains.com/plugin/9837-mybatiscodehelperpro">MyBatisCodeHelperPro</a>ï¼Œ<code>ä¸å¯é‡ç½®</code>ï¼</li>
</ul>
<p>å¯¹äºæŸäº›ä»˜è´¹æ’ä»¶ï¼ˆå¦‚: Iedis 2, MinBatisï¼‰æ¥è¯´ï¼Œä½ å¯èƒ½éœ€è¦å»å–æ‰ javaagent é…ç½®ï¼ˆå¦‚æœæœ‰ï¼‰åé‡å¯IDEï¼š</p>
<ul>
<li>å¦‚æœIDEæ²¡æœ‰æ‰“å¼€é¡¹ç›®ï¼Œåœ¨ Welcome ç•Œé¢ç‚¹å‡»èœå•ï¼šConfigure -&gt; Edit Custom VM Optionsâ€¦ -&gt; ç§»é™¤ -javaagent: å¼€å¤´çš„è¡Œã€‚</li>
<li>å¦‚æœIDEæ‰“å¼€äº†é¡¹ç›®ï¼Œç‚¹å‡»èœå•ï¼šHelp -&gt; Edit Custom VM Optionsâ€¦ -&gt; ç§»é™¤ -javaagent: å¼€å¤´çš„è¡Œã€‚</li>
</ul>
<p>é‡ç½®éœ€è¦é‡å¯IDEç”Ÿæ•ˆï¼</p>
<p>é‡ç½®åå¹¶ä¸å¼¹å‡º Licenses å¯¹è¯æ¡†è®©ä½ é€‰æ‹©è¾“å…¥ License æˆ–è¯•ç”¨ï¼Œè¿™å’Œä¹‹å‰çš„é‡ç½®è„šæœ¬/æ’ä»¶ä¸åŒï¼ˆçœå»è¿™çƒ¦äººçš„ä¸€æ­¥ï¼‰ã€‚</p>
<p>å¦‚æœé•¿è¾¾ 25 å¤©ä¸æ›¾æœ‰ä»»ä½•é‡ç½®åŠ¨ä½œï¼ŒIDE ä¼šæœ‰é€šçŸ¥è¯¢é—®ä½ æ˜¯å¦è¿›è¡Œé‡ç½®ã€‚</p>
<p>å¦‚æœå‹¾é€‰ï¼šAuto reset before per restart ï¼Œé‡ç½®æ˜¯é™é»˜æ— æ„ŸçŸ¥çš„ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼šå‹¾é€‰äº† Auto reset before per restart åˆ™æ— éœ€å†ç®¡ï¼Œä¸€åŠ³æ°¸é€¸ã€‚</p>
<h3 id="æ”¯æŒçš„äº§å“"><a href="#æ”¯æŒçš„äº§å“" class="headerlink" title="æ”¯æŒçš„äº§å“"></a>æ”¯æŒçš„äº§å“</h3><ul>
<li>IntelliJ IDEA</li>
<li>AppCode</li>
<li>CLion</li>
<li>DataGrip</li>
<li>GoLand</li>
<li>PhpStorm</li>
<li>PyCharm</li>
<li>Rider</li>
<li>RubyMine</li>
<li>WebStorm</li>
</ul>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
      <tags>
        <tag>JetBrains</tag>
      </tags>
  </entry>
  <entry>
    <title>LabelImgæ ‡æ³¨å·¥å…·ä½¿ç”¨åŠæ•°æ®æ ¼å¼è§£æ</title>
    <url>/2022/01/12/LabelImg%E6%A0%87%E6%B3%A8%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>LabelImgæ˜¯ç›®æ ‡æ£€æµ‹æ•°æ®æ ‡æ³¨å·¥å…·ï¼Œæ”¯æŒä¸¤ç§æ ‡æ³¨æ ¼å¼ï¼š</p>
<ul>
<li>VOCæ ‡ç­¾æ ¼å¼ï¼Œæ ‡æ³¨çš„æ ‡ç­¾å­˜å‚¨åœ¨xmlæ–‡ä»¶</li>
<li>YOLOæ ‡ç­¾æ ¼å¼ï¼Œæ ‡æ³¨çš„æ ‡ç­¾å­˜å‚¨åœ¨txtæ–‡ä»¶ä¸­</li>
</ul>
<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ç¡®ä¿ç”µè„‘ä¸Šå®‰è£…python3+ï¼Œå…¶ä¸­windowså’ŒmacOSæ¨èä½¿ç”¨Anacondaç­‰å·¥å…·å¿«é€Ÿå®‰è£…pythonã€‚è¿™é‡Œä¸å†å±•å¼€ä»‹ç»ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰"><a href="#è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰" class="headerlink" title="è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰"></a>è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰</h3><p>ä½¿ç”¨<code>pip</code>å®‰è£…LabelImgå®‰è£…æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œå®‰è£…å®Œä¹‹åä¼šè‡ªåŠ¨æŠŠLabelImgæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<p>æ‰“å¼€ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install labelimg</span><br></pre></td></tr></table></figure>
<p>å›½å†…é€Ÿåº¦æ…¢çš„å¯æŒ‡å®šé•œåƒæºå†å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install labelimg -i https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šåœ¨éƒ¨åˆ†è€ç”µè„‘ä¸Šç›´æ¥å®‰è£…labelimgæœ€æ–°ç‰ˆæœ‰çš„ä¸èƒ½æˆåŠŸï¼Œç»æµ‹è¯•å®‰è£…1.8.0ç‰ˆæœ¬ä»¥ä¸‹è€ç‰ˆæœ¬å¯ä»¥ï¼Œå‡ºé”™çš„å¯æŒ‡å®šç‰ˆæœ¬ï¼Œå®‰è£…è¿™ä¹‹ä¸‹ç‰ˆæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install labelimg==1.8.0</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/clip_image002.jpg" alt></p>
<h3 id="æ‰‹åŠ¨å®‰è£…"><a href="#æ‰‹åŠ¨å®‰è£…" class="headerlink" title="æ‰‹åŠ¨å®‰è£…"></a>æ‰‹åŠ¨å®‰è£…</h3><p>éœ€ä»å®˜æ–¹ä¸‹è½½æºç ï¼š<a href="https://github.com/tzutalin/labelImg">https://github.com/tzutalin/labelImg</a></p>
<p>ä»æºç å¼€å§‹å®‰è£…LabelImgï¼Œä¸€èˆ¬æ¯”è¾ƒéº»çƒ¦ï¼Œä¸æ¨è</p>
<h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p>â‘  Python 2 + Qt4</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install pyqt4-dev-tools</span><br><span class="line">sudo pip install lxml</span><br><span class="line">make qt4py2</span><br><span class="line">python labelImg.py</span><br><span class="line">python labelImg.py [IMAGE_PATH] [PRE-DEFINED CLASS FILE]</span><br></pre></td></tr></table></figure>
<p>â‘¡ Python 3 + Qt5 (Recommended)</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install pyqt5-dev-tools</span><br><span class="line">sudo pip3 install -r requirements/requirements-linux-python3.txt</span><br><span class="line">make qt5py3</span><br><span class="line">python3 labelImg.py</span><br><span class="line">python3 labelImg.py [IMAGE_PATH] [PRE-DEFINED CLASS FILE]</span><br></pre></td></tr></table></figure>
<h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><p>â‘  Python 2 + Qt4</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install qt qt4</span><br><span class="line">brew install libxml2</span><br><span class="line">make qt4py2</span><br><span class="line">python labelImg.py</span><br><span class="line">python labelImg.py [IMAGE_PATH] [PRE-DEFINED CLASS FILE]</span><br></pre></td></tr></table></figure>
<p>â‘¡ Python 3 + Qt5 (Recommended)</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install qt</span><br><span class="line">brew install libxml2</span><br><span class="line"> </span><br><span class="line">or using pip</span><br><span class="line"> </span><br><span class="line">pip3 install pyqt5 lxml</span><br><span class="line"> </span><br><span class="line">make qt5py3</span><br><span class="line">python3 labelImg.py</span><br><span class="line">python3 labelImg.py [IMAGE_PATH] [PRE-DEFINED CLASS FILE]</span><br></pre></td></tr></table></figure>
<h4 id="Virtualenv"><a href="#Virtualenv" class="headerlink" title="Virtualenv"></a>Virtualenv</h4><p>ä½¿ç”¨<code>virtualenv</code>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¯ä»¥é¿å…pythonç‰ˆæœ¬å’ŒQTç‰ˆæœ¬å¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨<code>conda</code>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install python3</span><br><span class="line">pip3 install pipenv</span><br><span class="line">pipenv run pip install pyqt5==5.13.2 lxml</span><br><span class="line">pipenv run make qt5py3</span><br><span class="line">python3 labelImg.py</span><br></pre></td></tr></table></figure>
<h3 id="æ›´å¤šå®‰è£…æ–¹å¼"><a href="#æ›´å¤šå®‰è£…æ–¹å¼" class="headerlink" title="æ›´å¤šå®‰è£…æ–¹å¼"></a>æ›´å¤šå®‰è£…æ–¹å¼</h3><p>å¯å‚è§å®˜æ–¹ï¼Œå¦‚dockerå®‰è£…æ–¹æ³•ï¼Œè¿™é‡Œä¸å†è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="æ‰“å¼€è½¯ä»¶"><a href="#æ‰“å¼€è½¯ä»¶" class="headerlink" title="æ‰“å¼€è½¯ä»¶"></a>æ‰“å¼€è½¯ä»¶</h3><p>â‘  å¦‚æœæ˜¯<code>pip</code>å®‰è£…çš„ï¼Œç”±äºä¼šè‡ªåŠ¨åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå› æ­¤åªè¦åœ¨ç»ˆç«¯è¾“å…¥<code>LabelImg</code> æˆ– <code>labelimg</code>å³å¯æ‰“å¼€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112175932198.png" alt></p>
<p>â‘¡ å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–è¯‘çš„ï¼Œéœ€è¦åˆ°è½¯ä»¶å®‰è£…ç›®å½•æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ<code>python labelImg.py</code>ã€‚</p>
<h3 id="æŒ‰é’®ä»‹ç»"><a href="#æŒ‰é’®ä»‹ç»" class="headerlink" title="æŒ‰é’®ä»‹ç»"></a>æŒ‰é’®ä»‹ç»</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112180734010.png" alt></p>
<ul>
<li><code>Open Dir</code>ï¼šå¾…æ ‡æ³¨å›¾ç‰‡æ•°æ®çš„è·¯å¾„æ–‡ä»¶å¤¹</li>
<li><code>Change Save Dir</code>ï¼šä¿å­˜ç±»åˆ«æ ‡ç­¾çš„è·¯å¾„æ–‡ä»¶å¤¹</li>
<li><code>PascalVOC</code>ï¼šæ ‡æ³¨çš„æ ‡ç­¾ä¿å­˜æˆVOCæ ¼å¼ï¼Œåœ¨é¼ æ ‡ç‚¹ä¸€ä¸‹å°±å˜æˆYOLOï¼Œå³æ­¤æ—¶å°±ä¼šæŠŠæ ‡æ³¨çš„æ ‡ç­¾å˜æˆYOLOæ ¼å¼</li>
<li><code>Create RectBox</code>ï¼šç‚¹å‡»åé¼ æ ‡ä¼šå˜æˆåå­—æ¶ï¼Œå¯ä»¥å¼€å§‹ç”»æ¡†</li>
</ul>
<h3 id="å¿«æ·é”®ä»‹ç»"><a href="#å¿«æ·é”®ä»‹ç»" class="headerlink" title="å¿«æ·é”®ä»‹ç»"></a>å¿«æ·é”®ä»‹ç»</h3><ul>
<li><code>W</code>ï¼šè°ƒå‡ºæ ‡æ³¨çš„åå­—æ¶ï¼Œå¼€å§‹æ ‡æ³¨</li>
<li><code>A</code>ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€å¼ å›¾ç‰‡</li>
<li><code>D</code>ï¼šåˆ‡æ¢åˆ°ä¸‹ä¸€å¼ å›¾ç‰‡</li>
<li><code>Ctrl+S</code>ï¼šä¿å­˜æ ‡æ³¨å¥½çš„æ ‡ç­¾</li>
<li><code>del</code>ï¼šåˆ é™¤æ ‡æ³¨çš„çŸ©å½¢æ¡†</li>
<li><code>Ctrl+é¼ æ ‡æ»šè½®</code>ï¼šæŒ‰ä½Ctrlï¼Œç„¶åæ»šåŠ¨é¼ æ ‡æ»šè½®ï¼Œå¯ä»¥è°ƒæ•´æ ‡æ³¨å›¾ç‰‡çš„æ˜¾ç¤ºå¤§å°</li>
<li><code>Ctrl+u</code>ï¼šé€‰æ‹©è¦æ ‡æ³¨å›¾ç‰‡çš„æ–‡ä»¶å¤¹</li>
<li><code>Ctrl+r</code>ï¼šé€‰æ‹©æ ‡æ³¨å¥½çš„labelæ ‡ç­¾å­˜æ”¾çš„æ–‡ä»¶å¤¹</li>
<li><code>â†‘â†’â†“â†</code>ï¼šç§»åŠ¨æ ‡æ³¨çš„çŸ©å½¢æ¡†çš„ä½ç½®</li>
</ul>
<h3 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h3><p>ç‚¹å‡»<code>View</code>æ˜¾ç¤ºï¼Œæ¨èé€‰ä¸Šä»¥ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li><code>Auto Save mode</code>ï¼šå½“ä½ åˆ‡æ¢åˆ°ä¸‹ä¸€å¼ å›¾ç‰‡æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨æŠŠä¸Šä¸€å¼ æ ‡æ³¨çš„å›¾ç‰‡æ ‡ç­¾è‡ªåŠ¨ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ ‡æ³¨ä¸€æ ·å›¾ç‰‡éƒ½æŒ‰<code>Ctrl+S</code>ä¿å­˜ä¸€ä¸‹äº†</li>
<li><code>Display Labels</code>ï¼šæ ‡æ³¨å¥½å›¾ç‰‡ä¹‹åï¼Œä¼šæŠŠæ¡†å’Œæ ‡ç­¾éƒ½æ˜¾ç¤ºå‡ºæ¥</li>
<li><code>Advanced Mode</code>ï¼šè¿™æ ·æ ‡æ³¨çš„åå­—æ¶å°±ä¼šä¸€ç›´æ‚¬æµ®åœ¨çª—å£ï¼Œä¸ç”¨æ¯æ¬¡æ ‡å®Œä¸€ä¸ªç›®æ ‡ï¼Œå†æŒ‰ä¸€æ¬¡<code>W</code>å¿«æ·é”®æˆ–ç‚¹å‡»<code>Create RectBox</code>ï¼Œè°ƒå‡ºæ ‡æ³¨çš„åå­—æ¶ã€‚</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112181105527.png" alt></p>
<h3 id="è¯»å–æ ‡æ³¨"><a href="#è¯»å–æ ‡æ³¨" class="headerlink" title="è¯»å–æ ‡æ³¨"></a>è¯»å–æ ‡æ³¨</h3><p>å¦‚æœå·²å­˜åœ¨æ ‡æ³¨æ–‡ä»¶ï¼Œå¯ç‚¹å‡»<code>File</code>-&gt;<code>Open Annotation</code>æ‰“å¼€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112184439055.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112184453555.png" alt></p>
<h3 id="å…·ä½“æ ‡æ³¨è¿‡ç¨‹å±•ç¤º"><a href="#å…·ä½“æ ‡æ³¨è¿‡ç¨‹å±•ç¤º" class="headerlink" title="å…·ä½“æ ‡æ³¨è¿‡ç¨‹å±•ç¤º"></a>å…·ä½“æ ‡æ³¨è¿‡ç¨‹å±•ç¤º</h3><p>â‘  é¦–å…ˆï¼Œæ‰“å¼€å›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œè¿™è¾¹ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œ<code>demo</code>æ–‡ä»¶å¤¹ä¸­åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ ‡æ³¨ä¿å­˜è·¯å¾„ä¹Ÿè®¾ç½®æˆ<code>demo</code>æ–‡ä»¶å¤¹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112181957866.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112182257756.png" alt></p>
<p>â‘¡ æŒ‰ä¸€æ¬¡<code>W</code>å¿«æ·é”®æˆ–ç‚¹å‡»<code>Create RectBox</code>ï¼Œè°ƒå‡ºæ ‡æ³¨çš„åå­—æ¶ï¼Œå¼€å§‹ç”»æ¡†ã€‚ç”»å¥½æ¡†åä¼šå¼¹å‡ºçª—å£æç¤ºè¾“å…¥ç±»åˆ«ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112182440716.png" alt></p>
<p>â‘¢ è¾“å…¥ç±»åˆ«ï¼Œå®Œæˆæ ‡æ³¨ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112182611233.png" alt></p>
<p>å¯çœ‹åˆ°æ ‡æ³¨å®Œæˆåï¼Œç±»åˆ«ï¼ˆè¿™é‡Œçš„ç±»åˆ«æ˜¯<code>person</code>ï¼‰ä¼šå±•ç¤ºåœ¨å³è¾¹çš„çª—å£ä¸­ï¼Œä¸æ¡†å¯¹åº”çš„é¢œè‰²æ˜¾ç¤ºã€‚</p>
<p>ä¿å­˜åï¼Œä¼šçœ‹åˆ°åœ¨è®¾ç½®çš„æ ‡æ³¨ä¿å­˜è·¯å¾„ä¸­ä¼šç”Ÿæˆä¸å›¾ç‰‡åŒåçš„æ ‡æ³¨æ–‡ä»¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112182740201.png" alt></p>
<p>å¦‚æœæ ‡æ³¨éœ€è¦ä¿®æ­£ï¼Œå…ˆç¡®ä¿è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆç‚¹å‡»<code>Edit RectBox</code>ï¼‰ï¼š</p>
<p>æ¯”å¦‚æ¡†ç”»å¾—ä¸å¥½ï¼Œå¯ä»¥é€‰ä¸­æ¡†æŒ‰<code>Delete</code>åˆ é™¤åï¼Œé‡ç”»ã€‚</p>
<p>æ¯”å¦‚ç±»åˆ«éœ€è¦ä¿®æ”¹ï¼Œä»å³è¾¹çª—å£é€‰æ‹©éœ€è¦ä¿®æ”¹çš„ç±»åˆ«ï¼Œå³é”®<code>Edit Label</code>è¿›è¡Œä¿®æ”¹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112184045178.png" alt></p>
<h3 id="å…¶ä»–æŠ€å·§"><a href="#å…¶ä»–æŠ€å·§" class="headerlink" title="å…¶ä»–æŠ€å·§"></a>å…¶ä»–æŠ€å·§</h3><p>å¦‚æœç±»åˆ«ç§ç±»ç¡®å®šï¼Œå¯åœ¨txtä¸­äº‹å…ˆè§„å®šå¥½è¦ç”¨åˆ°çš„ç±»åˆ«ï¼Œæ¯”å¦‚å®šä¹‰äº†ä¸€ä¸ª<code>predefined_classes.txt</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">circle_red</span><br><span class="line">circle_gray</span><br><span class="line">rectangle_red</span><br><span class="line">rectangle_gray</span><br><span class="line">fingeprint_red</span><br><span class="line">fingeprint_gray</span><br><span class="line">other</span><br></pre></td></tr></table></figure>
<p>åœ¨è½¯ä»¶æ‰“å¼€æ—¶ï¼Œå¸¦ä¸Šå‚æ•°ï¼ŒæŒ‡å®šå›¾ç‰‡è·¯å¾„å’Œé¢„å®šä¹‰ç±»åˆ«txtçš„è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">labelimg /path/to/image_file /path/to/predefined_classes.txt</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ ‡æ³¨çš„æ—¶å€™ï¼Œä¼šæŠŠ<code>predefined_classes.txt</code>é¢„å®šä¹‰çš„æ ‡ç­¾åŠ è½½å‡ºæ¥ï¼Œç„¶ååªè¦é€‰æ‹©å¯¹åº”çš„æ ‡ç­¾å³å¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥äº†ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/labelimg/image-20220112185041147.png" alt></p>
<h2 id="æ•°æ®æ ‡ç­¾æ ¼å¼è§£æ"><a href="#æ•°æ®æ ‡ç­¾æ ¼å¼è§£æ" class="headerlink" title="æ•°æ®æ ‡ç­¾æ ¼å¼è§£æ"></a>æ•°æ®æ ‡ç­¾æ ¼å¼è§£æ</h2><h3 id="VOCæ•°æ®æ ¼å¼"><a href="#VOCæ•°æ®æ ¼å¼" class="headerlink" title="VOCæ•°æ®æ ¼å¼"></a>VOCæ•°æ®æ ¼å¼</h3><p>å¦‚ï¼šæ ‡æ³¨çš„<code>000001.jpg</code>å›¾ç‰‡ï¼Œæ ‡æ³¨çš„æ ‡ç­¾ä¿¡æ¯ä¼šä¿å­˜åˆ°<code>000001.xml</code>æ–‡ä»¶ä¸­ï¼Œ<code>000001.xml</code>ä¸­çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">folder</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">folder</span>&gt;</span> # æ–‡ä»¶å¤¹åï¼Œä¸é‡è¦</span><br><span class="line">	<span class="tag">&lt;<span class="name">filename</span>&gt;</span>000001.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span> # å›¾ç‰‡åï¼Œé‡è¦</span><br><span class="line">	<span class="tag">&lt;<span class="name">path</span>&gt;</span>C:\Users\Qiyuan-Z\Desktop\demo\000001.jpg<span class="tag">&lt;/<span class="name">path</span>&gt;</span> # å›¾ç‰‡è·¯å¾„ï¼Œä¸é‡è¦</span><br><span class="line">	<span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">database</span>&gt;</span>Unknown<span class="tag">&lt;/<span class="name">database</span>&gt;</span> # æ•°æ®é›†åç§°ï¼Œä¸é‡è¦</span><br><span class="line">	<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">size</span>&gt;</span> # å›¾åƒå°ºå¯¸ï¼Œé‡è¦</span><br><span class="line">		<span class="tag">&lt;<span class="name">width</span>&gt;</span>468<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">height</span>&gt;</span>624<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span> # æ˜¯å¦ç”¨äºåˆ†å‰²ï¼Œ0ä¸ºå¦ï¼Œ1ä¸ºæ˜¯</span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span> # ç›®æ ‡ä¿¡æ¯ï¼Œé‡è¦</span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>person<span class="tag">&lt;/<span class="name">name</span>&gt;</span> # ç›®æ ‡ç±»åˆ«</span><br><span class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span> # æ‹æ‘„è§’åº¦</span><br><span class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span> # æ˜¯å¦è¢«æˆªæ–­ï¼Œ0ä¸ºå®Œæ•´</span><br><span class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span> # æ˜¯å¦éš¾è¯†åˆ«ï¼Œ0ä¸ºç®€å•</span><br><span class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span> # å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„xyåæ ‡</span><br><span class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>172<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>112<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>317<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>502<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="YOLOæ•°æ®æ ¼å¼"><a href="#YOLOæ•°æ®æ ¼å¼" class="headerlink" title="YOLOæ•°æ®æ ¼å¼"></a>YOLOæ•°æ®æ ¼å¼</h3><p>å¦‚ï¼šæ ‡æ³¨çš„<code>000001.jpg</code>å›¾ç‰‡ï¼Œæ ‡æ³¨çš„æ ‡ç­¾ä¿¡æ¯ä¼šä¿å­˜åˆ°<code>000001.txt</code>æ–‡ä»¶ä¸­ï¼ˆåŒæ—¶ä¼šç”Ÿæˆä¸€ä¸ª<code>classes.txt</code>æ–‡ä»¶ï¼‰ï¼Œ<code>000001.txt</code>ä¸­çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 0.521000 0.235075 0.362000 0.450249</span><br><span class="line">0 0.213000 0.645522 0.418000 0.519900</span><br><span class="line">0 0.794000 0.665423 0.376000 0.470149</span><br></pre></td></tr></table></figure>
<ul>
<li>æ¯ä¸€è¡Œä»£è¡¨æ ‡æ³¨çš„ä¸€ä¸ªç›®æ ‡</li>
<li>ç¬¬ä¸€ä¸ªæ•°ä»£è¡¨æ ‡æ³¨ç›®æ ‡çš„æ ‡ç­¾ï¼Œå¦‚ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯circle_redï¼Œå¯¹åº”çš„æ•°å­—å°±æ˜¯0</li>
<li>åé¢çš„å››ä¸ªæ•°ä»£è¡¨æ ‡æ³¨æ¡†çš„ä¸­å¿ƒåæ ‡å’Œæ ‡æ³¨æ¡†çš„ç›¸å¯¹å®½å’Œé«˜</li>
</ul>
<p><code>classes.txt</code>ä¸­çš„ä¿¡æ¯å¦‚ä¸‹ï¼Œä¼šæŒ‰é¡ºåºå­˜å‚¨æ ‡ç­¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">circle_red</span><br><span class="line">circle_gray</span><br><span class="line">rectangle_red</span><br><span class="line">rectangle_gray</span><br><span class="line">fingeprint_red</span><br><span class="line">fingeprint_gray</span><br><span class="line">other</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>BitCometé…ç½®</title>
    <url>/2022/01/12/BitComet%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>æœ¬æ–‡è®°å½•å¯¹BitCometçš„ä¸€äº›é…ç½®ä¿®æ”¹ï¼Œç”¨äºå¤‡ä»½ã€‚</p>
<h2 id="BitComet"><a href="#BitComet" class="headerlink" title="BitComet"></a>BitComet</h2><p>BitCometï¼ˆæ¯”ç‰¹å½—æ˜Ÿï¼‰æ˜¯ä¸€æ¬¾å®Œå…¨å…è´¹çš„BTä¸‹è½½è½¯ä»¶ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ å’Œè¾¹ä¸‹è½½è¾¹æ’­æ”¾ä¸‹è½½ç®¡ç†è½¯ä»¶ï¼Œä¹Ÿç§°BTä¸‹è½½å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªé›†BT/HTTP/FTPäºä¸€ä½“çš„ä¸‹è½½ç®¡ç†å™¨ã€‚å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="http://www.bitcomet.com/en/downloading?platform=win32">BitComet - Downloading</a></p>
<p>ä¸è¿‡è¿˜æ˜¯å»ºè®®å»æ‰¾ç¬¬ä¸‰æ–¹ä¿®æ”¹ç‰ˆèƒ½å¼€å¯ç§å­å¸‚åœºçš„ï¼Œæœ‰æ„æƒ³ä¸åˆ°çš„ç¦åˆ©å“¦ğŸ˜‹</p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>ç¡®ä¿ä½ çš„ç½‘ç»œä¸ºå…¬ç½‘ï¼Œè·¯ç”±å™¨ä¹Ÿéœ€æ‰“å¼€ç«¯å£æ˜ å°„ï¼Œæ²¡å…¬ç½‘çš„å¯æ‰“ç”µè¯ç”³è¯·æˆ–ä½¿ç”¨ç©¿é€å·¥å…·ç­‰ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œç¡®ä¿æ‰“å¼€è½¯ä»¶ï¼Œå³ä¸‹è§’ä¸¤ç»¿ç¯äº®èµ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/1.jpg" alt></p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="ç½‘ç»œè¿æ¥"><a href="#ç½‘ç»œè¿æ¥" class="headerlink" title="ç½‘ç»œè¿æ¥"></a>ç½‘ç»œè¿æ¥</h3><p>æˆ‘è¿™é‡Œè®¾ç½®ä¸‹è½½ä¸é™é€Ÿï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å¸¦å®½è®¾ç½®ã€‚ä¸Šä¼ å»ºè®®æ¯”è‡ªå·±æœ€å¤§ä¸Šä¼ å¸¦å®½å°ï¼Œä¸è¦è®¾ç½®å¤ªå¤§ï¼Œä½†ä¹Ÿä¸èƒ½è®¾ç½®å¤ªä½ï¼ˆæœ‰ä¸Šä¼ æ‰æœ‰ä¸‹è½½ï¼Œäººäººä¸ºæˆ‘ï¼Œæˆ‘ä¸ºäººäººï¼ï¼‰ï¼Œæˆ‘è¿™é‡Œè®¾ç½®780KB/sã€‚</p>
<p>ç›‘å¬ç«¯å£å»ºè®®è‡ªå·±æŒ‡å®šä¸€ä¸ªï¼Œä¸æ¨è<code>6881-6885</code> ï¼Œ<code>16881-16885</code>èŒƒå›´å†…å’Œä¸€äº›ç‰¹æ®Šçš„ç«¯å£ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/2.jpg" alt></p>
<h3 id="ä¸‹è½½ç›®å½•"><a href="#ä¸‹è½½ç›®å½•" class="headerlink" title="ä¸‹è½½ç›®å½•"></a>ä¸‹è½½ç›®å½•</h3><p>è‡ªå·±è®¾ç½®åˆé€‚çš„ä¸‹è½½ç›®å½•ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/3.jpg" alt></p>
<h3 id="ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—"></a>ä»»åŠ¡é˜Ÿåˆ—</h3><p>æ¨èåšç§ä»»åŠ¡æ•°æ‹‰æ»¡ï¼Œä¸‹è½½ä»»åŠ¡æ•°ä¸è¦å¤ªå¤§ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/4.jpg" alt></p>
<h3 id="BTä¸‹è½½"><a href="#BTä¸‹è½½" class="headerlink" title="BTä¸‹è½½"></a>BTä¸‹è½½</h3><p>å‹¾é€‰åŠ å…¥DHTï¼Œè‡ªåŠ¨åå¸è¡€ï¼Œåè®®ä¼˜å…ˆï¼Œç§å­å­˜æ¡£ã€ç§å­å¸‚åœºæ‰“å¼€ï¼Œä¸Šä¼ æ— é™åˆ¶æˆ–æ ¹æ®è‡ªå·±ä¸Šä¼ å¸¦å®½è®¾ç½®ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/5.jpg" alt></p>
<h3 id="Tracker"><a href="#Tracker" class="headerlink" title="Tracker"></a>Tracker</h3><p>ç½‘ä¸Šå¯ä»¥æ‰¾ä¸€äº›trackeræœåŠ¡å™¨åˆ—è¡¨ï¼Œè¿›è¡Œæ·»åŠ ï¼Œæˆ‘è¿™é‡Œç”¨çš„åˆ—è¡¨æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://github.itzmx.com/1265578519/OpenTracker/master/tracker.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/6.jpg" alt></p>
<h3 id="ç”µé©´ä¸‹è½½"><a href="#ç”µé©´ä¸‹è½½" class="headerlink" title="ç”µé©´ä¸‹è½½"></a>ç”µé©´ä¸‹è½½</h3><p>éœ€è¦æ”¯æŒeD2kç½‘ç»œçš„ï¼Œå¯å®‰è£…æ’ä»¶ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/7.jpg" alt></p>
<h3 id="é•¿æ•ˆç§å­"><a href="#é•¿æ•ˆç§å­" class="headerlink" title="é•¿æ•ˆç§å­"></a>é•¿æ•ˆç§å­</h3><p>æ¨èå¯ç”¨ï¼Œä¸Šä¼ é™é€Ÿå¯è‡ªåŠ¨ï¼Œä¹Ÿå¯æ ¹æ®è‡ªå·±çš„ä¸Šä¼ å¸¦å®½è®¾ç½®ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/8.jpg" alt></p>
<h3 id="ç³»ç»Ÿé›†æˆ"><a href="#ç³»ç»Ÿé›†æˆ" class="headerlink" title="ç³»ç»Ÿé›†æˆ"></a>ç³»ç»Ÿé›†æˆ</h3><p>é»˜è®¤å…³è”ã€æµè§ˆå™¨æ’ä»¶ç­‰ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦è®¾ç½®å³å¯ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/9.jpg" alt></p>
<h3 id="ç•Œé¢å¤–è§‚"><a href="#ç•Œé¢å¤–è§‚" class="headerlink" title="ç•Œé¢å¤–è§‚"></a>ç•Œé¢å¤–è§‚</h3><p>æ ¹æ®è‡ªå·±çš„å–œå¥½è®¾ç½®å¤–è§‚ã€æ“ä½œã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/10.jpg" alt></p>
<h3 id="é«˜çº§è®¾ç½®"><a href="#é«˜çº§è®¾ç½®" class="headerlink" title="é«˜çº§è®¾ç½®"></a>é«˜çº§è®¾ç½®</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/11.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/12.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/13.jpg" alt></p>
<p>æ¯”è¾ƒé‡è¦çš„è®¾ç½®ï¼š</p>
<ul>
<li>bittorrent.max_connections_per_ltseedï¼šæ¯ä¸ªé•¿æ•ˆç§å­çš„æœ€å¤§è¿æ¥æ•°ï¼ˆ1-10ï¼‰ï¼Œæ¨èæ‹‰æ»¡ï¼Œè®¾ç½®10ã€‚</li>
<li>bittorrent.max_connections_per_taskï¼šæ¯ä»»åŠ¡æœ€å¤§è¿æ¥æ•°ï¼ˆ0ä¸ºè‡ªåŠ¨ï¼‰ï¼Œæ¨èè®¾ç½®ä¸ªé€‚å½“çš„å€¼ï¼Œä¸è¦å¤ªå¤§ï¼Œè¿™é‡Œæˆ‘è®¾ç½®200ã€‚</li>
<li>network.max_connecting_connectionsï¼šæœ€å¤§åŒæ—¶å°è¯•çš„TCPè¿æ¥ä¸ªæ•°ï¼ˆ0ä¸ºè‡ªåŠ¨ï¼‰ï¼Œæ¨èè®¾ç½®ä¸ªé€‚å½“çš„å€¼ï¼Œä¸è¦å¤ªå¤§ï¼Œè¿™é‡Œæˆ‘è®¾ç½®è·Ÿbittorrent.max_connections_per_taskä¸€æ ·ã€‚</li>
<li>torrent_share.max_metadata_dl_taskï¼šå¹¶å‘ä¸‹è½½å…ƒæ•°æ®çš„æœ€å¤§æ•°é‡ï¼ˆ1-1000ï¼‰ï¼Œæ¨èæ‹‰æ»¡ã€‚</li>
<li>torrent_share.metadata_dl_timeoutï¼šä¸‹è½½å…ƒæ•°æ®çš„è¶…æ—¶ç§’æ•°ï¼ˆ10-3600ï¼‰ï¼Œè®¾å€¼æœ€ä½ã€‚</li>
<li>ui.preview_program_pathï¼šè§†é¢‘é¢„è§ˆç¨‹åºè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¾¹çœ‹è¾¹æ’­æ‰€ç”¨æ’­æ”¾å™¨çš„è·¯å¾„ï¼Œè¿™é‡Œæˆ‘è®¾ç½®æˆä½¿ç”¨potplayer</li>
</ul>
<h3 id="ç£ç›˜ç¼“å­˜"><a href="#ç£ç›˜ç¼“å­˜" class="headerlink" title="ç£ç›˜ç¼“å­˜"></a>ç£ç›˜ç¼“å­˜</h3><p>å‹¾é€‰åœ¨æœ€å¤§æœ€å°å€¼èŒƒå›´å†…è‡ªåŠ¨è°ƒæ•´ç¼“å­˜å¤§å°å³å¯ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®æœ€å¤§æœ€å°ï¼Œä¸€èˆ¬æœ€å°å¯è®¾128Mï¼Œæœ€å¤§å¯è®¾ä½ å†…å­˜å¤§å°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/14.jpg" alt></p>
<h2 id="ä¸‹è½½è¡¨ç°"><a href="#ä¸‹è½½è¡¨ç°" class="headerlink" title="ä¸‹è½½è¡¨ç°"></a>ä¸‹è½½è¡¨ç°</h2><p>é…ç½®å®Œæ¯•åï¼Œéšä¾¿æ‰¾äº†ä¸ªç§å­ä¸‹è½½ï¼Œé€Ÿåº¦è¿˜æ˜¯ä¸é”™çš„ã€‚ğŸ˜Š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/bitcomet/15.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>BitComet</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨PyTorchåˆ†å¸ƒå¼è®­ç»ƒ</title>
    <url>/2022/01/11/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Pytorch%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/</url>
    <content><![CDATA[<h2 id="DDP"><a href="#DDP" class="headerlink" title="DDP"></a>DDP</h2><p>DDPæ˜¯PyTorchä¸­çš„ä¸€ä¸ªåº“ï¼Œå®ƒæ”¯æŒè·¨å¤šä¸ªè®¾å¤‡çš„æ¢¯åº¦åŒæ­¥ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥é€šè¿‡è·¨å¤šä¸ªGPUå¹¶è¡Œå¤„ç†ï¼Œçº¿æ€§åœ°åŠ å¿«æ¨¡å‹è®­ç»ƒã€‚DDPçš„å·¥ä½œåŸç†æ˜¯ä¸ºæ¯ä¸ªGPUåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„Pythonè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä½¿ç”¨ä¸€ä¸ªä¸é‡å çš„æ•°æ®å­é›†ã€‚</p>
<p>æ¯”èµ·DPæ¥ï¼ŒDDPè®­ç»ƒé€Ÿåº¦æ›´å¿«ï¼Œæ˜¾å¡è´Ÿè½½ä¹Ÿæ›´ä¸ºå‡è¡¡ã€‚ç›®å‰å®˜æ–¹å¼€å‘è€…æ¨èä½¿ç”¨DDPä»£æ›¿DPï¼ŒDPå¾ˆå°‘ç»´æŠ¤äº†ï¼Œå¯¼è‡´æœ‰è®¸å¤šbugã€‚æ¯”å¦‚ï¼š<code>nn.ParameterList</code>å’Œ<code>nn.ParameterDict</code>åœ¨DPä¸­ä¼šå­˜åœ¨å…¶ä»–å¡æ— æ³•å¤åˆ¶ï¼Œå˜æˆç©ºå€¼çš„Bugï¼Œè€Œè¿™åœ¨DDPä¸­å°±æ­£å¸¸ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>â‘  æ·»åŠ è¶…å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span>():</span></span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--local_rank&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>)</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">return</span> args</span><br></pre></td></tr></table></figure>
<ul>
<li>local_rankï¼šè¿›ç¨‹å†…GPUç¼–å·ï¼Œéæ˜¾å¼å‚æ•°ï¼Œç”± <code>torch.distributed.launch</code> å†…éƒ¨æŒ‡å®šï¼Œé»˜è®¤ä¸ºGPUå¯ç”¨åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªGPUï¼Œè¿™ä¸ªæ˜¯å¿…é¡»åŠ çš„ã€‚</li>
</ul>
<p>â‘¡ åœ¨ä¸»å‡½æ•°æ·»åŠ ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&#x27;Distributed Training&#x27;</span>)</span><br><span class="line"><span class="comment"># è¯¥å‚æ•°ç”±torch.distributed.launchè‡ªåŠ¨ä¼ é€’ï¼Œä»£è¡¨å½“å‰è¿›ç¨‹å¤„ç†çš„GPUç¼–å·</span></span><br><span class="line">parser.add_argument(<span class="string">&#x27;--local_rank&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰€åˆ›å»ºçš„è¿›ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰€ä½¿ç”¨çš„GPUæ•°é‡</span></span><br><span class="line">num_gpus = <span class="built_in">int</span>(os.environ[<span class="string">&#x27;WORLD_SIZE&#x27;</span>]) <span class="keyword">if</span> <span class="string">&#x27;WORLD_SIZE&#x27;</span> <span class="keyword">in</span> os.environ <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">args.is_distributed = num_gpus &gt; <span class="number">1</span></span><br><span class="line">args.num_gpus = num_gpus</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.is_distributed:</span><br><span class="line">    torch.cuda.set_device(args.local_rank)</span><br><span class="line">    torch.distributed.init_process_group(backend=<span class="string">&#x27;nccl&#x27;</span>, init_method=<span class="string">&#x27;env://&#x27;</span>)</span><br><span class="line">    dist.barrier() <span class="comment"># ç”¨dist.barrier()æ¥åŒæ­¥ä¸åŒè¿›ç¨‹é—´çš„å¿«æ…¢</span></span><br></pre></td></tr></table></figure>
<ul>
<li>world sizeï¼šè¡¨ç¤ºå…¨å±€è¿›ç¨‹ä¸ªæ•°ã€‚</li>
</ul>
<p>â‘¢ ä¿®æ”¹å¯¼å…¥æ•°æ®çš„æ¥å£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dataset = DAVIS2017(root, <span class="string">&#x27;training&#x27;</span>)</span><br><span class="line">num_workers = <span class="number">4</span> <span class="keyword">if</span> cuda <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨DistributedSampleræ¥ä¸ºå„ä¸ªè¿›ç¨‹åˆ†å‘æ•°æ®ï¼Œç”¨äºå°†æ•°æ®é›†ç­‰åˆ†æˆä¸é‡å çš„æ•°ä¸ªå­é›†</span></span><br><span class="line">train_sampler  = torch.utils.data.distributed.DistributedSampler(dataset)</span><br><span class="line"><span class="comment"># åœ¨Dataloaderä¸­æŒ‡å®šsampleræ—¶ï¼Œå…¶ä¸­çš„shuffleå¿…é¡»ä¸ºFalseï¼Œè€ŒDistributedSamplerä¸­çš„shuffleé¡¹é»˜è®¤ä¸ºTrueï¼Œå› æ­¤è®­ç»ƒè¿‡ç¨‹é»˜è®¤æ‰§è¡Œshuffle</span></span><br><span class="line">dataloader = DataLoader(dataset,batch_size=batchsize,shuffle=<span class="literal">False</span>, num_workers=num_workers,pin_memory=cuda, drop_last=<span class="literal">True</span>, sampler=train_sampler)</span><br></pre></td></tr></table></figure>
<p>â‘£ å‡†å¤‡æ¨¡å‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">model = create_model()</span><br><span class="line"><span class="comment"># åˆ›å»ºCUDAè®¾å¤‡</span></span><br><span class="line">device = device = torch.device(<span class="string">&#x27;cuda:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(args.local_rank))</span><br><span class="line"><span class="comment"># æŠŠæ¨¡å‹æ”¾åˆ°cudaä¸Š</span></span><br><span class="line">model = model.to(device)</span><br><span class="line"><span class="comment"># å°†æ¨¡å‹ç”¨DDPå°è£…</span></span><br><span class="line">model = DistributedDataParallel(model, device_ids=[args.local_rank], output_device=args.local_rank)</span><br></pre></td></tr></table></figure>
<p>â‘¤ æƒé‡åŠ è½½ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½æ¨¡å‹å‰åç”¨dist.barrier()æ¥åŒæ­¥ä¸åŒè¿›ç¨‹é—´çš„å¿«æ…¢</span></span><br><span class="line">dist.barrier()</span><br><span class="line">model.load_state_dict(torch.load(<span class="string">&#x27;model.pth&#x27;</span>), map_location=torch.device(<span class="string">&#x27;cpu&#x27;</span>))</span><br><span class="line">dist.barrier()</span><br></pre></td></tr></table></figure>
<p>â‘¥ å­¦ä¹ ç‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­¦ä¹ ç‡åº”æ‰©å¤§GPUæ•°çš„å€æ•°ï¼Œå› ä¸ºDDPæ¯å¼ æ˜¾å¡åˆ†åˆ«è·‘batchsize</span></span><br><span class="line"><span class="comment"># è€ŒDPæ˜¯å¤šå¼ æ˜¾å¡è·‘ä¸€ä¸ªbatchsize</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥å°†batchsize // args.num_gpusä½œä¸ºbatchsizeï¼Œlrä¸å˜</span></span><br><span class="line">lr *= args.num_gpus</span><br></pre></td></tr></table></figure>
<p>â‘¦ è¿­ä»£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span>(<span class="params">epoch</span>):</span></span><br><span class="line">    <span class="comment"># åœ¨å¤šGPUç¯å¢ƒä¸‹ï¼Œé‡‡æ ·å™¨å¿…é¡»çŸ¥é“å“ªä¸ªepoch</span></span><br><span class="line">    <span class="comment"># å› æ­¤ï¼Œæ¯æ¬¡è¿­ä»£å¼€å§‹éœ€è¦ä¸ºsamplerè®¾ç½®å½“å‰epoch</span></span><br><span class="line">    train_sampler.set_epoch(epoch)</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>â‘§ è¾“å‡ºlossï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_world_size</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> dist.is_available():</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> dist.is_initialized():</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> dist.get_world_size()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reduce_value</span>(<span class="params">value, average=<span class="literal">True</span></span>):</span></span><br><span class="line">    world_size = get_world_size()</span><br><span class="line">    <span class="keyword">if</span> world_size &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        dist.all_reduce(value)</span><br><span class="line">        <span class="keyword">if</span> average:</span><br><span class="line">            value /= world_size</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span>(<span class="params">epoch</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> batch_idx, (inputs, targets) <span class="keyword">in</span> <span class="built_in">enumerate</span>(trainloader):</span><br><span class="line">        ...</span><br><span class="line">        loss = criterion(outputs, targets)</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># lossä¸ºæ¯ä¸ªGPUä¸Šlossçš„ç´¯åŠ ï¼Œå› æ­¤ä¼šå¾ˆå¤§</span></span><br><span class="line">        <span class="comment"># å¦‚æœæƒ³è¾“å‡ºä¸€ä¸ªGPUä¸Šçš„lossï¼Œå¯å¯¹losså–å¹³å‡</span></span><br><span class="line">        <span class="keyword">if</span> is_main_process():</span><br><span class="line">            reduced_loss = reduce_tensor(loss)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;loss: %.3f&#x27;</span> % reduced_loss.item())</span><br></pre></td></tr></table></figure>
<p>â‘¨ æ¨¡å‹ä¿å­˜ã€æ—¥å¿—è¾“å‡ºã€æ§åˆ¶å°æ‰“å°ç­‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rank</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> dist.is_available():</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> dist.is_initialized():</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> dist.get_rank()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_main_process</span>():</span></span><br><span class="line">    <span class="keyword">return</span> get_rank() == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼è®­ç»ƒä¼šå¼€å¯å¤šä¸ªè¿›ç¨‹ï¼Œå› æ­¤æ¨¡å‹çš„ä¿å­˜ã€æ—¥å¿—è¾“å‡ºã€æ§åˆ¶å°æ‰“å°ç­‰ä¹Ÿä¼šè¿›è¡Œå¤šæ¬¡</span></span><br><span class="line"><span class="comment"># å› æ­¤ç›´æ¥ä¿å­˜ä¼šå‘ç”Ÿå†²çª</span></span><br><span class="line"><span class="comment"># é‡åˆ°æ­¤ç±»æ“ä½œéƒ½éœ€è¦åŠ åˆ¤æ–­ï¼Œåªåœ¨ä¸»è¿›ç¨‹æ—¶è¿›è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> is_main_process():</span><br><span class="line">	torch.save(xxxx)</span><br></pre></td></tr></table></figure>
<p>â‘© è®­ç»ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åœ¨åŸæ¥åŸºç¡€ä¸ŠåŠ ä¸Špython -m torch.distributed.launch --nproc_per_node=GPUæ•°é‡å³å¯</span><br><span class="line">python -m torch.distributed.launch --nproc_per_node=GPUæ•°é‡ train.py --arg1 --arg2 --arg3</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>Grad-CAMåŸç†å’Œå®ç°</title>
    <url>/2022/01/10/Grad-CAM%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>æœ¬æ–‡è½¬è½½äº<a href="https://zhuanlan.zhihu.com/p/453689298">âš¡å“¥çš„çŸ¥ä¹ä¸“æ </a>ï¼Œå¤§ä½¬å†™çš„çœŸæ˜¯æ¸…æ™°æ˜“æ‡‚ï¼Œèœé¸¡çš„æˆ‘é»˜é»˜ç•™å­˜ï¼Œå¥½å¥½å­¦ä¹ ï¼ğŸ™‡â€â™‚ï¸</p>
<p>è§‰å¾—ä¸é”™çš„ï¼Œå¤§å®¶è®°å¾—å¸®ç”µå“¥ç‚¹èµğŸ‘+æ”¶è—â­å‘€ï¼</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>â‘  è¦åšçŒ«ç‹—çš„äºŒåˆ†ç±»ä»»åŠ¡ï¼Œç½‘ç»œçš„åˆ†ç±»å™¨æ˜¯è¾“å‡ºä¸ºä¸¤ä¸ªç¥ç»å…ƒçš„å…¨è¿æ¥å±‚ï¼Œä¸¤ä¸ªç¥ç»å…ƒçš„è¾“å‡ºåˆ†åˆ«ä¸º$z=\left[z_{c}, z_{d}\right]$ï¼Œå…¶ä¸­çŒ«çš„æ¦‚ç‡ä¸º$p_c$ï¼Œç‹—çš„æ¦‚ç‡ä¸º$p_d$ï¼Œä¸”$\left[p_{c}, p_{d}\right]=\operatorname{softmax}(z)$ã€‚<br>â‘¡ è¦å¯è§†åŒ–çŒ«è¿™ä¸ªç±»åˆ«çš„GradCAMï¼Œé€šè¿‡$z_c$å¯¹CNNæœ€åä¸€å±‚çš„æ‰€æœ‰ç‰¹å¾å›¾$A_{i, j}^{k}$æ±‚åå¯¼$G_{i, j}^{k}=\frac{\partial z_{c}}{\partial A_{i, j}^{k}}$ï¼Œå…¶ä¸­$A_{i, j}^{k}$è¡¨ç¤ºç‰¹å¾å›¾$A$ shape=(1, C, H, W)çš„ç¬¬ké€šé“çš„(i, j)åæ ‡ç‚¹ï¼Œæœ€ç»ˆçš„åå¯¼ç‰¹å¾å›¾$G$ shape=(1, C, H, W)ã€‚</p>
<ul>
<li><p>å–æœ€åä¸€å±‚çš„åŸå› ï¼š</p>
<ul>
<li>GradCAMå¯ä»¥ç”¨æ¥å¯è§†åŒ–ä»»ä½•çš„æ¿€æ´»ç‰¹å¾å›¾ï¼Œä½†è®ºæ–‡çš„ä¸»è¦ç›®çš„æ˜¯è¦è§£é‡Šç¥ç»ç½‘ç»œå¾—åˆ°å†³ç­–çš„å¯èƒ½åŸå› ã€‚</li>
<li>æœ€åä¸€å±‚ç‰¹å¾å›¾æœ‰ä¸°å¯Œçš„highlevelè¯­ä¹‰ä¿¡æ¯å’Œè¯¦ç»†çš„ç©ºé—´ä¿¡æ¯ï¼Œè€Œå…¨è¿æ¥å±‚å®Œå…¨ä¸¢å¤±äº†ç©ºé—´ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><p>æ±‚åå¯¼çš„æ„ä¹‰ï¼š</p>
<ul>
<li>åå¯¼è¡¨ç¤ºè¾“å‡ºå…³äºè¾“å…¥çš„å˜åŒ–ç‡ï¼Œä¹Ÿå°±æ˜¯ç‰¹å¾å›¾ä¸Šå˜åŒ–ä¸€ä¸ªå•ä½ï¼Œå¾—åˆ°çš„è¾“å‡ºå˜åŒ–å¤šå°‘å•ä½ã€‚å¯ä»¥åæ˜ å‡ºè¾“å‡º$z_c$å…³äº$A_{i, j}^{k}$çš„æ•æ„Ÿç¨‹åº¦ï¼Œå¦‚æœæ¢¯åº¦å¤§ï¼Œåˆ™éå¸¸æ•æ„Ÿï¼Œè¡¨ç¤ºè¯¥ä½ç½®æ›´æœ‰å¯èƒ½å°±æ˜¯çŒ«ç±»ã€‚</li>
</ul>
</li>
</ul>
<p>â‘¢ å¯¹åå¯¼ç‰¹å¾å›¾$G$åšå…¨å±€å¹³å‡æ± åŒ–GAPï¼Œå¾—åˆ°ä¸€ä¸ª$C$ä¸ªå…ƒç´ çš„æƒé‡å‘é‡$\alpha=\left[\alpha_{1}, \cdots, \alpha_{k}, \cdots, \alpha_{C}\right]$ï¼Œ$C$æ˜¯$G$çš„é€šé“æ•°ï¼Œ$\alpha_{k}=\frac{1}{H W} \sum_{i}^{H} \sum_{j}^{W} G_{i, j}^{k}$ã€‚$\alpha_k$è¡¨ç¤ºçš„æ˜¯çŒ«ç±»ç›¸å¯¹äºæœ€åä¸€å±‚ç‰¹å¾å›¾çš„ç¬¬kä¸ªé€šé“çš„å¹³å‡çš„æ•æ„Ÿç¨‹åº¦ã€‚</p>
<p>â‘£ å°†æƒé‡å‘é‡$\alpha$ä¸ç‰¹å¾å›¾$A$å¯¹åº”é€šé“åšçº¿æ€§åŠ æƒï¼Œå¾—åˆ°ä¸€ä¸ªäºŒç»´çš„æ¿€æ´»å›¾$\operatorname{Grad CAM}=\operatorname{ReLU}\left(\sum_{k} \alpha_{k} A^{k}\right)$ã€‚</p>
<ul>
<li>ReLUçš„ä½œç”¨æ˜¯è¦æ±‚å¾—åˆ°æ¿€æ´»å›¾é‡Œçš„å€¼å’ŒçŒ«ç±»æ­£ç›¸å…³çš„çƒ­åŠ›å›¾ï¼Œè€Œè´Ÿæ•°éƒ¨åˆ†è¡¨ç¤ºå±äºç‹—ç±»ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºå¯¹é¢„æµ‹ä¸ºçŒ«ç±»èµ·åˆ°æŠ‘åˆ¶ä½œç”¨ï¼Œå› æ­¤ç”¨ReLUè¿‡æ»¤æ‰è¿™äº›èµ·æŠ‘åˆ¶ä½œç”¨çš„éƒ¨åˆ†ã€‚</li>
<li>æœ€åå°†æ¿€æ´»å›¾ä¸Šé‡‡æ ·åˆ°è¾“å…¥å›¾ç‰‡å¤§å°ã€‚</li>
</ul>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> torchvision.models.resnet <span class="keyword">import</span> resnet18</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GradCAM</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, model: nn.Module, target_layer: <span class="built_in">str</span>, size=(<span class="params"><span class="number">224</span>, <span class="number">224</span></span>), mean=<span class="literal">None</span>, std=<span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.model = model</span><br><span class="line">        self.model.<span class="built_in">eval</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># register hook</span></span><br><span class="line">        <span class="comment"># å¯ä»¥è‡ªå·±æŒ‡å®šå±‚åï¼Œæ²¡å¿…è¦ä¸€å®šé€šè¿‡target_layerä¼ é€’å‚æ•°</span></span><br><span class="line">        <span class="comment"># self.model.layer4</span></span><br><span class="line">        <span class="comment"># self.model.layer4[1].register_forward_hook(self.__forward_hook)</span></span><br><span class="line">        <span class="comment"># self.model.layer4[1].register_backward_hook(self.__backward_hook)</span></span><br><span class="line">        <span class="built_in">getattr</span>(self.model, target_layer).register_forward_hook(self.__forward_hook)</span><br><span class="line">        <span class="built_in">getattr</span>(self.model, target_layer).register_backward_hook(self.__backward_hook)</span><br><span class="line"></span><br><span class="line">        self.size = size</span><br><span class="line">        self.origin_size = <span class="literal">None</span></span><br><span class="line">        self.mean, self.std = [<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], [<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]</span><br><span class="line">        <span class="keyword">if</span> mean <span class="keyword">and</span> std:</span><br><span class="line">            self.mean, self.std = mean, std</span><br><span class="line"></span><br><span class="line">        self.grads = []</span><br><span class="line">        self.fmaps = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, img_arr: np.ndarray, label=<span class="literal">None</span>, show=<span class="literal">True</span>, write=<span class="literal">False</span></span>):</span></span><br><span class="line">        img_input = self.__img_preprocess(img_arr.copy())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># forward</span></span><br><span class="line">        output = self.model(img_input)</span><br><span class="line">        idx = np.argmax(output.cpu().data.numpy())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># backward</span></span><br><span class="line">        self.model.zero_grad()</span><br><span class="line">        loss = self.__compute_loss(output, label)</span><br><span class="line"></span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># generate CAM</span></span><br><span class="line">        grads_val = self.grads[<span class="number">0</span>].cpu().data.numpy().squeeze()</span><br><span class="line">        fmap = self.fmaps[<span class="number">0</span>].cpu().data.numpy().squeeze()</span><br><span class="line">        cam = self.__compute_cam(fmap, grads_val)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># show</span></span><br><span class="line">        cam_show = cv2.resize(cam, self.origin_size)</span><br><span class="line">        img_show = img_arr.astype(np.float32) / <span class="number">255</span></span><br><span class="line">        self.__show_cam_on_image(img_show, cam_show, if_show=show, if_write=write)</span><br><span class="line"></span><br><span class="line">        self.fmaps.clear()</span><br><span class="line">        self.grads.clear()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__img_transform</span>(<span class="params">self, img_arr: np.ndarray, transform: torchvision.transforms</span>) -&gt; torch.Tensor:</span></span><br><span class="line">        img = img_arr.copy()  <span class="comment"># [H, W, C]</span></span><br><span class="line">        img = Image.fromarray(np.uint8(img))</span><br><span class="line">        img = transform(img).unsqueeze(<span class="number">0</span>)  <span class="comment"># [N,C,H,W]</span></span><br><span class="line">        <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__img_preprocess</span>(<span class="params">self, img_in: np.ndarray</span>) -&gt; torch.Tensor:</span></span><br><span class="line">        self.origin_size = (img_in.shape[<span class="number">1</span>], img_in.shape[<span class="number">0</span>])  <span class="comment"># [H, W, C]</span></span><br><span class="line">        img = img_in.copy()</span><br><span class="line">        img = cv2.resize(img, self.size)</span><br><span class="line">        img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br><span class="line">        transform = transforms.Compose([</span><br><span class="line">            transforms.ToTensor(),</span><br><span class="line">            transforms.Normalize(self.mean, self.std)</span><br><span class="line">        ])</span><br><span class="line">        img_tensor = self.__img_transform(img, transform)</span><br><span class="line">        <span class="keyword">return</span> img_tensor</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__backward_hook</span>(<span class="params">self, module, grad_in, grad_out</span>):</span></span><br><span class="line">        self.grads.append(grad_out[<span class="number">0</span>].detach())</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__forward_hook</span>(<span class="params">self, module, <span class="built_in">input</span>, output</span>):</span></span><br><span class="line">        self.fmaps.append(output)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__compute_loss</span>(<span class="params">self, logit, index=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> index:</span><br><span class="line">            index = np.argmax(logit.cpu().data.numpy())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            index = np.array(index)</span><br><span class="line"></span><br><span class="line">        index = index[np.newaxis, np.newaxis]</span><br><span class="line">        index = torch.from_numpy(index)</span><br><span class="line">        one_hot = torch.zeros(<span class="number">1</span>, <span class="number">1000</span>).scatter_(<span class="number">1</span>, index, <span class="number">1</span>)</span><br><span class="line">        one_hot.requires_grad = <span class="literal">True</span></span><br><span class="line">        loss = torch.<span class="built_in">sum</span>(one_hot * logit)</span><br><span class="line">        <span class="keyword">return</span> loss</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__compute_cam</span>(<span class="params">self, feature_map, grads</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        feature_map: np.array [C, H, W]</span></span><br><span class="line"><span class="string">        grads: np.array, [C, H, W]</span></span><br><span class="line"><span class="string">        return: np.array, [H, W]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        cam = np.zeros(feature_map.shape[<span class="number">1</span>:], dtype=np.float32)</span><br><span class="line">        alpha = np.mean(grads, axis=(<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># GAP</span></span><br><span class="line">        <span class="keyword">for</span> k, ak <span class="keyword">in</span> <span class="built_in">enumerate</span>(alpha):</span><br><span class="line">            cam += ak * feature_map[k]  <span class="comment"># linear combination</span></span><br><span class="line">        </span><br><span class="line">        cam = np.maximum(cam, <span class="number">0</span>)  <span class="comment"># relu</span></span><br><span class="line">        cam = cv2.resize(cam, self.size)</span><br><span class="line">        cam = (cam - np.<span class="built_in">min</span>(cam)) / np.<span class="built_in">max</span>(cam)</span><br><span class="line">        <span class="keyword">return</span> cam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__show_cam_on_image</span>(<span class="params">self, img: np.ndarray, mask: np.ndarray, if_show=<span class="literal">True</span>, if_write=<span class="literal">False</span></span>):</span></span><br><span class="line">        heatmap = cv2.applyColorMap(np.uint8(<span class="number">255</span> * mask), cv2.COLORMAP_JET)</span><br><span class="line">        heatmap = np.float32(heatmap) / <span class="number">255</span></span><br><span class="line">        cam = heatmap + np.float32(img)</span><br><span class="line">        cam = cam / np.<span class="built_in">max</span>(cam)</span><br><span class="line">        cam = np.uint8(<span class="number">255</span> * cam)</span><br><span class="line">        <span class="keyword">if</span> if_write:</span><br><span class="line">            cv2.imwrite(<span class="string">&quot;camcam.jpg&quot;</span>, cam)</span><br><span class="line">        <span class="keyword">if</span> if_show:</span><br><span class="line">            <span class="comment"># è¦æ˜¾ç¤ºRGBçš„å›¾ç‰‡ï¼Œå¦‚æœæ˜¯BGRçš„ çƒ­åŠ›å›¾æ˜¯åè¿‡æ¥çš„</span></span><br><span class="line">            plt.imshow(cam[:, :, ::-<span class="number">1</span>])</span><br><span class="line">            plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;test.jpg&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">net = resnet18(pretrained=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">grad_cam = GradCAM(net, <span class="string">&#x27;layer4&#x27;</span>, (<span class="number">224</span>, <span class="number">224</span>), [<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], [<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line">grad_cam.forward(img, show=<span class="literal">True</span>, write=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cam/1.jpg" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>TensorRTå®‰è£…</title>
    <url>/2022/01/07/TensorRT%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="å®‰è£…PyCuda"><a href="#å®‰è£…PyCuda" class="headerlink" title="å®‰è£…PyCuda"></a>å®‰è£…PyCuda</h2><p>å¦‚æœé€šè¿‡Pythonä½¿ç”¨TensorRTçš„è¯ï¼Œéœ€è¦å®‰è£…PyCudaï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install pycuda</span><br></pre></td></tr></table></figure>
<p>(æ³¨ï¼šæœ¬äººæµ‹è¯•ç¯å¢ƒä¸ºUbuntu16.04ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å‘ç°PyCudaæ–°ç‰ˆæœ¬ä¼šç¼–è¯‘å¤±è´¥ï¼Œè€Œ<code>pycuda&lt;=2019.1</code>åˆ™æ­£å¸¸ã€‚)</p>
<p>è‹¥å®‰è£…å‡ºç°é—®é¢˜ï¼Œéœ€æ‰‹åŠ¨ç¼–è¯‘ï¼Œå¯å‚ç…§<a href="https://wiki.tiker.net/PyCuda/Installation/Linux/">å®˜ç½‘</a>æ•™ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/inducer/pycuda.git # æµ‹è¯•æ—¶æ–°ç‰ˆæœ¬ä¸º2020.1</span><br><span class="line">tar xfz pycuda-VERSION.tar.gz</span><br><span class="line">cd pycuda-VERSION</span><br><span class="line">pip3 install numpy==1.20rc   # æ­¤å¤„ä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬,æœ¬äººåˆšå¼€å§‹å®‰è£…äº†1.19,ä¸€ç›´ä¸æˆåŠŸ</span><br><span class="line">python configure.py --cuda-root=/where/ever/you/installed/cuda  # ä¿®æ”¹ä¸ºè‡ªå·±cudaçš„è·¯å¾„</span><br><span class="line">su -c &quot;make install&quot;</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•</span><br><span class="line">cd pycuda-VERSION/test</span><br><span class="line">python test_driver.py    # &quot;OK&quot;åˆ™é€šè¿‡</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…TensorRT"><a href="#å®‰è£…TensorRT" class="headerlink" title="å®‰è£…TensorRT"></a>å®‰è£…TensorRT</h2><p>å®˜æ–¹æ¨èå®‰è£…cuda10.2æˆ–è€…11.0ä»¥ä¸Šï¼Œcudaç‰ˆæœ¬ä¸å¯¹çš„è¯·è‡ªè¡Œæ›´æ¢ã€‚è¿™é‡Œæ¨èå®‰è£…TensorRT 7.2.3.4åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¤ªæ—©çš„ç‰ˆæœ¬å¾ˆå¤šç®—å­ä¸æ”¯æŒï¼Œå®¹æ˜“è¸©å‘ã€‚</p>
<p>ä»¥TensorRT 7ç³»åˆ—ä¸ºä¾‹ï¼Œå»<a href="https://link.zhihu.com/?target=https%3A//developer.nvidia.com/nvidia-tensorrt-7x-download">å®˜ç½‘</a>é€‰æ‹©åˆé€‚ç‰ˆæœ¬ä¸‹è½½</p>
<p>â‘  è§£å‹ç¼©</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xzvf TensorRT-7.2.3.4.Ubuntu-16.04.x86_64-gnu.cuda-10.2.cudnn8.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>â‘¡ å®‰è£…TensorRT wheel æ–‡ä»¶ï¼Œæ ¹æ®pythonç‰ˆæœ¬é€‰æ‹©ï¼Œè¿™é‡Œæ˜¯python3.6</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd TensorRT-7.2.3.4/python</span><br><span class="line">pip install tensorrt-7.2.3.4-cp36-none-linux_x86_64.whl</span><br></pre></td></tr></table></figure>
<p>â‘¢ å®‰è£…graphsurgeon wheelæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd TensorRT-7.2.3.4/graphsurgeon</span><br><span class="line">pip install graphsurgeon-0.4.5-py2.py3-none-any.whl</span><br></pre></td></tr></table></figure>
<p>â‘£ é…ç½®ç¯å¢ƒå˜é‡</p>
<p>ç¼–è¾‘<code>~/.bashrc</code>æ–‡ä»¶ï¼Œåœ¨æ–‡æœ«æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/home/ç”¨æˆ·å/TensorRT-7.2.3.4/lib:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>
<p>(æ³¨ï¼šè‡ªå·±æ¢æˆTensorRT-7.2.3.4æ‰€åœ¨è·¯å¾„)</p>
<p>é…ç½®ç”Ÿæ•ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>TensorRT</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³nvidia-smiå’Œnvccæ˜¾ç¤ºä¿¡æ¯ä¸æ‰€å®‰è£…CUDAç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜</title>
    <url>/2022/01/06/%E8%A7%A3%E5%86%B3nvidia-smi%E5%92%8Cnvcc%E6%98%BE%E7%A4%BA%E4%BF%A1%E6%81%AF%E4%B8%8E%E6%89%80%E5%AE%89%E8%A3%85CUDA%E7%89%88%E6%9C%AC%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="nvidia-smi-amp-nvcc-V"><a href="#nvidia-smi-amp-nvcc-V" class="headerlink" title="nvidia-smi &amp; nvcc -V"></a>nvidia-smi &amp; nvcc -V</h2><p>é¦–å…ˆéœ€æ˜ç™½CUDAæœ‰runtime apiå’Œdriver apiï¼Œä¸¤è€…éƒ½æœ‰å¯¹åº”çš„CUDAç‰ˆæœ¬ï¼Œ<code>nvcc -V</code>æ˜¾ç¤ºå‰è€…å¯¹åº”çš„CUDAç‰ˆæœ¬ï¼Œè€Œ<code>nvidia-smi</code>æ˜¾ç¤ºåè€…å¯¹åº”çš„CUDAç‰ˆæœ¬ã€‚</p>
<p>é€šå¸¸ï¼Œdriver apiç‰ˆæœ¬èƒ½å‘ä¸‹å…¼å®¹runtime apiçš„ç‰ˆæœ¬ï¼Œå³<code>nvidia-smi</code>æ˜¾ç¤ºçš„ç‰ˆæœ¬å¤§äº<code>nvcc -V</code>çš„ç‰ˆæœ¬é€šå¸¸ä¸ä¼šå‡ºç°å¤§é—®é¢˜ã€‚å› æ­¤<code>nvidia-smi</code>æ˜¾ç¤ºçš„ç‰ˆæœ¬ä¸æ‰€å®‰è£…CUDAç‰ˆæœ¬ä¸ä¸€è‡´æ˜¯æ­£å¸¸çš„ã€‚</p>
<p>è€Œå¹³å¸¸æˆ‘ä»¬åšæ·±åº¦å­¦ä¹ æ‰€ç”¨çš„æ˜¯CUDAçš„runtime apiç‰ˆæœ¬ï¼Œå› æ­¤ä»¥<code>nvcc -V</code>ä¸ºå‡†ï¼Œè¿™é‡Œç‰ˆæœ¬å¦‚æœä¸ä¸€è‡´å°±å®¹æ˜“å‘ç”Ÿé—®é¢˜ã€‚å…¶åŸå› ä¸»è¦æ˜¯æœ¬æœºå­˜åœ¨å¤šä¸ªCUDAï¼Œæ²¡æœ‰æ­£ç¡®æ˜ å°„é€ æˆã€‚</p>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>æŸ¥è¯¢ç°åœ¨çš„æ˜ å°„å…³ç³»ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stat /usr/bin/nvcc</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/image-20220106101722613.png" alt></p>
<p>è¦æ˜¯æ˜ å°„é”™è¯¯ï¼Œéœ€é‡æ–°å»ºç«‹æ˜ å°„ï¼š</p>
<p>â‘  åˆ é™¤åŸæ¥æ˜ å°„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo rm -rf /usr/bin/nvcc</span><br></pre></td></tr></table></figure>
<p>â‘¡ å»ºç«‹æ–°çš„è½¯é“¾æ¥æŒ‡å‘å®‰è£…çš„CUDAç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ln -s /usr/local/cuda/bin/nvcc /usr/bin/nvcc</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>CUDA</tag>
        <tag>cuDNN</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿«é€Ÿå…¥é—¨Docker</title>
    <url>/2022/01/04/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8Docker/</url>
    <content><![CDATA[<h1 id="Dockeræ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Dockeræ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Dockeræ˜¯ä»€ä¹ˆï¼Ÿ"></a>Dockeræ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Dockeræ˜¯ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå®¹å™¨ï¼Œå¯ä»¥å°†ä½ çš„å¼€å‘ç¯å¢ƒã€ä»£ç ã€é…ç½®æ–‡ä»¶ç­‰ä¸€å¹¶æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨ä¸­ï¼Œå¹¶å‘å¸ƒå’Œåº”ç”¨åˆ°ä»»æ„å¹³å°ä¸­ã€‚</p>
<h1 id="Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ"><a href="#Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ" class="headerlink" title="Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ"></a>Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ</h1><p>â‘  é•œåƒï¼ˆImageï¼‰ï¼šæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘Dockerå¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ªUbuntué•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Ubuntuæ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ã€‚</p>
<p>â‘¡ å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootæƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Dockerå¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDockeråœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚</p>
<p>â‘¢ ä»“åº“ï¼ˆRepositoryï¼‰ï¼šDockerç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨tagè¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚Ubuntuä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04ç­‰ï¼‰çš„Ubuntué•œåƒã€‚</p>
<h1 id="Dockerçš„å®‰è£…å’Œå¸è½½"><a href="#Dockerçš„å®‰è£…å’Œå¸è½½" class="headerlink" title="Dockerçš„å®‰è£…å’Œå¸è½½"></a>Dockerçš„å®‰è£…å’Œå¸è½½</h1><p>å¯æŸ¥çœ‹<a href="https://docs.docker.com/engine/install/">å®˜æ–¹æ•™ç¨‹</a>ï¼Œè¿™é‡Œä»¥CentOSç³»ç»Ÿå’ŒUbuntuç³»ç»Ÿä¸ºä¾‹ã€‚</p>
<h2 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>â‘  å®‰è£…æ‰€éœ€è½¯ä»¶åŒ…ä¸é©±åŠ¨ç¨‹åº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
<p>â‘¡ è®¾ç½®ä»“åº“æº</p>
<ul>
<li><p>å®˜æ–¹æºï¼ˆæ¯”è¾ƒæ…¢ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li>
<li><p>é˜¿é‡Œæº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li>
<li><p>æ¸…åå¤§å­¦æº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>â‘¢ å®‰è£…Dockerï¼ˆé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>
<p>å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºæ˜¯å¦æ¥å—GPGå¯†é’¥ï¼Œè¯·é€‰æ˜¯ã€‚</p>
<p>å¦‚æœè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥å¯ç”¨ç‰ˆæœ¬ï¼ˆæŒ‰ç‰ˆæœ¬å·ä»é«˜åˆ°ä½å¯¹ç»“æœè¿›è¡Œæ’åºï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>
<p>ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-ce.x86_64  3:18.09.1-3.el7                     docker-ce-stable</span><br><span class="line">docker-ce.x86_64  3:18.09.0-3.el7                     docker-ce-stable</span><br><span class="line">docker-ce.x86_64  18.06.1.ce-3.el7                    docker-ce-stable</span><br><span class="line">docker-ce.x86_64  18.06.0.ce-3.el7                    docker-ce-stable</span><br></pre></td></tr></table></figure>
<p>å¹¶é€šè¿‡å…¶ç‰ˆæœ¬å·å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œå³ç¬¬äºŒåˆ—ç¬¬ä¸€ä¸ª<code>:</code>ä¸€ç›´åˆ°ç¬¬ä¸€ä¸ª<code>-</code>ä¸­é—´çš„å­—ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce-18.09.1 docker-ce-cli-18.09.1 containerd.io</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šDocker å®‰è£…å®Œé»˜è®¤æœªå¯åŠ¨ã€‚å¹¶ä¸”å·²ç»åˆ›å»ºå¥½ docker ç”¨æˆ·ç»„ï¼Œä½†è¯¥ç”¨æˆ·ç»„ä¸‹æ²¡æœ‰ç”¨æˆ·ã€‚</p>
<p>â‘£ å¯åŠ¨Docker</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>
<p>â‘¤ éªŒè¯</p>
<p>é€šè¿‡è¿è¡Œ hello-world æ˜ åƒæ¥éªŒè¯æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>åˆ é™¤å®‰è£…åŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum remove docker-ce</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤é•œåƒã€å®¹å™¨ã€é…ç½®æ–‡ä»¶ç­‰å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>
<p>å¸è½½æ—§ç‰ˆæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>
<h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><strong>è‡ªåŠ¨å®‰è£…ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å›½å†… daocloud ä¸€é”®å®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>
<p><strong>æ‰‹åŠ¨å®‰è£…ï¼š</strong></p>
<p>â‘  æ›´æ–°aptåŒ…ç´¢å¼•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<p>â‘¡ å®‰è£…aptä¾èµ–åŒ…ï¼Œç”¨äºé€šè¿‡httpsæ¥è·å–ä»“åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common</span><br></pre></td></tr></table></figure>
<p>â‘¢ æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>
<p>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 é€šè¿‡æœç´¢æŒ‡çº¹çš„å8ä¸ªå­—ç¬¦ï¼ŒéªŒè¯æ‚¨ç°åœ¨æ˜¯å¦æ‹¥æœ‰å¸¦æœ‰æŒ‡çº¹çš„å¯†é’¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure>
<p>â‘£ è®¾ç½®ç¨³å®šç‰ˆä»“åº“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository &quot;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/ $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure>
<p>â‘¤ æ›´æ–°aptåŒ…ç´¢å¼•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<p>â‘¥ å®‰è£…Docker</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥å¯ç”¨ç‰ˆæœ¬ï¼ˆæŒ‰ç‰ˆæœ¬å·ä»é«˜åˆ°ä½å¯¹ç»“æœè¿›è¡Œæ’åºï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-cache madison docker-ce</span><br></pre></td></tr></table></figure>
<p>ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-ce | 5:18.09.1~3-0~ubuntu-xenial | https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">docker-ce | 5:18.09.0~3-0~ubuntu-xenial | https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">docker-ce | 18.06.1~ce~3-0~ubuntu       | https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">docker-ce | 18.06.0~ce~3-0~ubuntu       | https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å¹¶é€šè¿‡å…¶ç‰ˆæœ¬å·å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œå³ç¬¬äºŒåˆ—ç¬¬ä¸€ä¸ª<code>:</code>ä¸€ç›´åˆ°ç¬¬ä¸€ä¸ª<code>-</code>ä¸­é—´çš„å­—ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce-18.09.1 docker-ce-cli-18.09.1 containerd.io</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šDocker å®‰è£…å®Œé»˜è®¤æœªå¯åŠ¨ã€‚å¹¶ä¸”å·²ç»åˆ›å»ºå¥½ docker ç”¨æˆ·ç»„ï¼Œä½†è¯¥ç”¨æˆ·ç»„ä¸‹æ²¡æœ‰ç”¨æˆ·ã€‚</p>
<p>â‘¦ å¯åŠ¨Docker</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>
<p>â‘§ éªŒè¯</p>
<p>é€šè¿‡è¿è¡Œ hello-world æ˜ åƒæ¥éªŒè¯æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="å¸è½½-1"><a href="#å¸è½½-1" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>åˆ é™¤å®‰è£…åŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get purge docker-ce</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤é•œåƒã€å®¹å™¨ã€é…ç½®æ–‡ä»¶ç­‰å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>
<p>å¸è½½æ—§ç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>
<h1 id="åŠ å…¥ç”¨æˆ·ç»„"><a href="#åŠ å…¥ç”¨æˆ·ç»„" class="headerlink" title="åŠ å…¥ç”¨æˆ·ç»„"></a>åŠ å…¥ç”¨æˆ·ç»„</h1><p>Dockeréœ€è¦ç”¨æˆ·å…·æœ‰sudoæƒé™ï¼Œä¸ºäº†é¿å…æ¯æ¬¡å‘½ä»¤éƒ½è¾“å…¥sudoï¼Œå»ºè®®å°†ç”¨æˆ·åŠ å…¥Dockerç”¨æˆ·ç»„ï¼š</p>
<p>â‘  æ·»åŠ Dockeråˆ†ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo groupadd docker</span><br></pre></td></tr></table></figure>
<p>â‘¡ å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°åˆ†ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>
<p>â‘¢ é‡å¯æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure>
<p>â‘£ åˆ‡æ¢å½“å‰ä¼šè¯åˆ°æ–°ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">newgrp - docker</span><br></pre></td></tr></table></figure>
<h1 id="é…ç½®é•œåƒåŠ é€Ÿ"><a href="#é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="é…ç½®é•œåƒåŠ é€Ÿ"></a>é…ç½®é•œåƒåŠ é€Ÿ</h1><p>å›½å†…ä»DockerHubæ‹‰å–é•œåƒé€Ÿåº¦æ…¢ï¼Œæ­¤æ—¶å¯ä»¥é…ç½®é•œåƒåŠ é€Ÿå™¨ã€‚Dockerå®˜æ–¹å’Œå›½å†…å¾ˆå¤šäº‘æœåŠ¡å•†éƒ½æä¾›äº†å›½å†…åŠ é€Ÿå™¨æœåŠ¡ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ç§‘å¤§é•œåƒï¼š<a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn/</a></li>
<li>ç½‘æ˜“ï¼š<a href="https://hub-mirror.c.163.com/">https://hub-mirror.c.163.com/</a></li>
<li>é˜¿é‡Œäº‘ï¼šhttps://&lt;ä½ çš„ID&gt;.mirror.aliyuncs.com</li>
<li>ä¸ƒç‰›äº‘åŠ é€Ÿå™¨ï¼š<a href="https://reg-mirror.qiniu.com">https://reg-mirror.qiniu.com</a></li>
<li>ä¸­å›½ç§‘æŠ€å¤§å­¦<a href="https://docker.mirrors.ustc.edu.cn">https://docker.mirrors.ustc.edu.cn</a></li>
</ul>
<p>æ³¨ï¼šé˜¿é‡Œäº‘é¡»<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">ç™»å½•</a>ï¼Œä»å·¦ä¾§èœå•é€‰ä¸­é•œåƒåŠ é€Ÿå™¨è·å–ä¸“å±åœ°å€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/docker/docker1.jpg" alt></p>
<p>è¿™é‡Œä»¥Ubuntu16.04+ã€Debian8+ã€CentOS7çš„é…ç½®ä¸ºä¾‹ï¼Œåœ¨ <code>/etc/docker/daemon.json</code>ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;,</span><br><span class="line">&quot;http://hub-mirror.c.163.com&quot;,</span><br><span class="line">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤šä¸ªé•œåƒæºåˆ™ä»¥<code>,</code>åˆ†å‰²ã€‚</p>
<p>ä¹‹åé‡å¯æœåŠ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="dockerå¸¸ç”¨å‘½ä»¤"><a href="#dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤"></a>dockerå¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker --help #æŸ¥çœ‹dockerå‘½ä»¤</span><br><span class="line">docker info #docker è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒå’Œå®¹å™¨</span><br><span class="line">docker version #æŸ¥çœ‹dockerç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
<h2 id="å¸¸ç”¨é•œåƒå‘½ä»¤"><a href="#å¸¸ç”¨é•œåƒå‘½ä»¤" class="headerlink" title="å¸¸ç”¨é•œåƒå‘½ä»¤"></a>å¸¸ç”¨é•œåƒå‘½ä»¤</h2><h3 id="æŸ¥çœ‹é•œåƒ"><a href="#æŸ¥çœ‹é•œåƒ" class="headerlink" title="æŸ¥çœ‹é•œåƒ"></a>æŸ¥çœ‹é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker images #æŸ¥çœ‹dockeré•œåƒ</span><br><span class="line">docker images -a #åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒ</span><br><span class="line">docker images -q #åªæ˜¾ç¤ºé•œåƒID</span><br><span class="line">docker images --digests #æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯</span><br><span class="line">docker images --no-trunc #æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>å…·ä½“åˆ—è§£é‡Šå«ä¹‰ï¼š</p>
<ul>
<li>REPOSITORYï¼šé•œåƒä»“åº“æº        </li>
<li>TAGï¼šé•œåƒçš„æ ‡ç­¾         </li>
<li>IMAGE IDï¼šé•œåƒid      </li>
<li>CREATEDï¼šåˆ›å»ºæ—¶é—´       </li>
<li>SIZEï¼šå¤§å°</li>
</ul>
<p>æ³¨ï¼šåŒä¸€ä¸ªä»“åº“æºå¯ä»¥æœ‰å¤šä¸ªTAGï¼Œè¡¨ç¤ºè¿™ä¸ªä»“åº“æºçš„ä¸åŒç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>REPOSITORY:TAG</code>æ¥å®šä¹‰ä¸åŒçš„é•œåƒã€‚å¦‚æœä¸æŒ‡å®šä¸€ä¸ªé•œåƒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾‹å¦‚åªä½¿ç”¨tomcatï¼Œdockerå°†é»˜è®¤ä½¿ç”¨<code>tomcat:latest</code>é•œåƒ</p>
<h3 id="æŸ¥æ‰¾é•œåƒ"><a href="#æŸ¥æ‰¾é•œåƒ" class="headerlink" title="æŸ¥æ‰¾é•œåƒ"></a>æŸ¥æ‰¾é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker search tomcat #ä»Docker Hubä¸ŠæŸ¥æ‰¾tomcaté•œåƒ</span><br><span class="line">docker search --filter=stars=300 tomcat #ä»Docker Hubä¸ŠæŸ¥æ‰¾å…³æ³¨åº¦(stars)å¤§äº300çš„tomcaté•œåƒ</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‹è½½é•œåƒ"><a href="#ä¸‹è½½é•œåƒ" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull tomcat #ä¸‹è½½tomcaté•œåƒï¼Œç›¸å½“äºï¼šdocker pull tomcat:latest</span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker rmi redis #å•ä¸ªé•œåƒåˆ é™¤ï¼Œç›¸å½“äºï¼šdocker rmi redis:latest</span><br><span class="line">docker rmi -f redis #å¼ºåˆ¶åˆ é™¤(é’ˆå¯¹åŸºäºé•œåƒæœ‰è¿è¡Œçš„å®¹å™¨è¿›ç¨‹)</span><br><span class="line">docker rmi -f redis tomcat nginx #å¤šä¸ªé•œåƒåˆ é™¤ï¼Œä¸åŒé•œåƒé—´ä»¥ç©ºæ ¼é—´éš”</span><br><span class="line">docker rmi -f $(docker images -q) #åˆ é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ</span><br></pre></td></tr></table></figure>
<h2 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h2><p>åªæœ‰åœ¨é•œåƒçš„åŸºç¡€ä¸Šæ‰èƒ½è¿è¡Œå®¹å™¨å‘½ä»¤</p>
<h3 id="æŸ¥çœ‹å®¹å™¨"><a href="#æŸ¥çœ‹å®¹å™¨" class="headerlink" title="æŸ¥çœ‹å®¹å™¨"></a>æŸ¥çœ‹å®¹å™¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps -a #-a æ˜¯æŸ¥çœ‹å½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker ps -q #åªæ˜¾ç¤ºå®¹å™¨ID</span><br></pre></td></tr></table></figure>
<h3 id="å®¹å™¨å¯åŠ¨"><a href="#å®¹å™¨å¯åŠ¨" class="headerlink" title="å®¹å™¨å¯åŠ¨"></a>å®¹å™¨å¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -i -t --name mycentos #æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼Œå‚æ•°ï¼š-i ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼›-t ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼›--name ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°, ç›¸å½“äº: docker run -it mycentos</span><br><span class="line">docker run -d mycentos #åå°å¯åŠ¨å®¹å™¨ï¼Œå‚æ•°ï¼š-d ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨å®¹å™¨</span><br><span class="line">docker start å®¹å™¨idæˆ–å®¹å™¨å #å¯åŠ¨å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨idæˆ–å®¹å™¨å #é‡å¯å®¹å™¨</span><br></pre></td></tr></table></figure>
<h3 id="å®¹å™¨åœæ­¢"><a href="#å®¹å™¨åœæ­¢" class="headerlink" title="å®¹å™¨åœæ­¢"></a>å®¹å™¨åœæ­¢</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker kill å®¹å™¨idæˆ–å®¹å™¨å</span><br><span class="line">docker stop å®¹å™¨idæˆ–å®¹å™¨å</span><br></pre></td></tr></table></figure>
<h3 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼Shellï¼Œå› æ­¤ç”¨çš„æ˜¯/bin/bash</span><br><span class="line">docker attach å®¹å™¨idæˆ–å®¹å™¨å /bin/bash #è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„ç»ˆç«¯è¿›ç¨‹</span><br><span class="line">docker run -it å®¹å™¨idæˆ–å®¹å™¨å /bin/bash #ä½¿ç”¨runæ–¹å¼åœ¨åˆ›å»ºæ—¶è¿›å…¥</span><br><span class="line">docker exec -it å®¹å™¨idæˆ–å®¹å™¨å /bin/bash #è¿›å…¥å®¹å™¨åï¼Œå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œ</span><br></pre></td></tr></table></figure>
<h3 id="é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºå®¹å™¨"></a>é€€å‡ºå®¹å™¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exit #å…³é—­å®¹å™¨å¹¶é€€å‡º</span><br><span class="line">å¿«æ·é”®ï¼šCtrl + P + Q #ä»…é€€å‡ºå®¹å™¨ï¼Œä¸å…³é—­</span><br></pre></td></tr></table></figure>
<h3 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -it -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨ç›®å½• é•œåƒå /bin/bash #-v å®¹å™¨å¯åŠ¨æ—¶ä¼šå°†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨é‡Œ</span><br></pre></td></tr></table></figure>
<h3 id="å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº"><a href="#å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº" class="headerlink" title="å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº"></a>å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker cp å®¹å™¨id:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„</span><br></pre></td></tr></table></figure>
<h3 id="å®¹å™¨è¿æ¥"><a href="#å®¹å™¨è¿æ¥" class="headerlink" title="å®¹å™¨è¿æ¥"></a>å®¹å™¨è¿æ¥</h3><p>å¯ä»¥é€šè¿‡ <code>-P</code> æˆ– <code>-p</code>å‚æ•°æ¥æŒ‡å®šç«¯å£æ˜ å°„ï¼Œå®ç°å¤–éƒ¨é€šè¿‡ç½‘ç»œç«¯å£æ¥è®¿é—®è¿è¡Œåœ¨Dockerå®¹å™¨å†…çš„æœåŠ¡ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d -P training/webapp python app.py</span><br><span class="line">docker run -d -p 5000:5000 training/webapp python app.py</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-P</code> :æ˜¯å®¹å™¨å†…éƒ¨ç«¯å£<strong>éšæœº</strong>æ˜ å°„åˆ°ä¸»æœºçš„é«˜ç«¯å£ã€‚</li>
<li><code>-p</code>:æ˜¯å®¹å™¨å†…éƒ¨ç«¯å£ç»‘å®šåˆ°<strong>æŒ‡å®š</strong>çš„ä¸»æœºç«¯å£ã€‚</li>
</ul>
<p>å¤–éƒ¨å¯é€šè¿‡SSHï¼Œä½¿ç”¨ip+ç»‘å®šçš„ä¸»æœºç«¯å£å·è¿›è¡Œå®¹å™¨è®¿é—®ã€‚</p>
<h2 id="åˆ©ç”¨Dockerfileåˆ›å»ºé•œåƒ"><a href="#åˆ©ç”¨Dockerfileåˆ›å»ºé•œåƒ" class="headerlink" title="åˆ©ç”¨Dockerfileåˆ›å»ºé•œåƒ"></a>åˆ©ç”¨Dockerfileåˆ›å»ºé•œåƒ</h2><p>Dockerfileå¯ä»¥ç†è§£ä¸ºä¸€ç§é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å‘Šè¯‰docker buildå‘½ä»¤åº”è¯¥æ‰§è¡Œå“ªäº›æ“ä½œã€‚å¯å‚ç…§<a href="https://docs.docker.com/engine/reference/builder/">å®˜æ–¹</a>è¯´æ˜ã€‚</p>
<h3 id="Dockerfileç»„æˆ"><a href="#Dockerfileç»„æˆ" class="headerlink" title="Dockerfileç»„æˆ"></a>Dockerfileç»„æˆ</h3><p>Dockerfileæ˜¯ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œå¹¶ä¸”æ”¯æŒå·²<code>#</code>å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥å°†Dockerfileåˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>åŸºç¡€é•œåƒ(çˆ¶é•œåƒ)ä¿¡æ¯æŒ‡ä»¤<code>FROM</code></li>
<li>ç»´æŠ¤è€…ä¿¡æ¯æŒ‡ä»¤<code>MAINTAINER</code></li>
<li>é•œåƒæ“ä½œæŒ‡ä»¤<code>RUN</code>ã€<code>EVN</code>ã€<code>ADD</code>å’Œ<code>WORKDIR</code>ç­‰</li>
<li>å®¹å™¨å¯åŠ¨æŒ‡ä»¤<code>CMD</code>ã€<code>ENTRYPOINT</code>å’Œ<code>USER</code>ç­‰</li>
</ul>
<h3 id="Dockerfileç¤ºä¾‹"><a href="#Dockerfileç¤ºä¾‹" class="headerlink" title="Dockerfileç¤ºä¾‹"></a>Dockerfileç¤ºä¾‹</h3><p>ä¸‹é¢æ˜¯ä¸€æ®µç®€å•çš„Dockerfileçš„ä¾‹å­ï¼š</p>
<p>é¦–å…ˆåˆ›å»ºDockerfileæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch Dockerfile</span><br></pre></td></tr></table></figure>
<p>ç„¶åç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œè¾“å…¥å†…å®¹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM python:3.6</span><br><span class="line">MAINTAINER zqy &lt;zqy@gmail.com&gt;</span><br><span class="line">COPY . /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">EXPOSE 5000</span><br><span class="line">ENTRYPOINT [&quot;python&quot;]</span><br><span class="line">CMD [&quot;app.py&quot;]</span><br></pre></td></tr></table></figure></p>
<ul>
<li>1ã€ä»<code>Docker Hub</code>ä¸Š<code>pull</code>ä¸‹<code>python 3.6</code>çš„åŸºç¡€é•œåƒ</li>
<li>2ã€æ„å»ºè€…çš„ä¿¡æ¯ï¼ˆè‡ªå·±å®šä¹‰ï¼‰</li>
<li>3ã€<code>copy</code>å½“å‰ç›®å½•<code>.</code>åˆ°å®¹å™¨ä¸­çš„<code>/app</code>ç›®å½•ä¸‹</li>
<li>4ã€æŒ‡å®šå·¥ä½œè·¯å¾„ä¸º<code>/app</code></li>
<li>5ã€å®‰è£…ä¾èµ–åŒ…</li>
<li>6ã€æš´éœ²<code>5000</code>ç«¯å£</li>
<li>7ã€æ‰§è¡Œ<code>app.py</code></li>
</ul>
<p>æœ€ååœ¨Dockerfileæ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t zqy/demo:v1 .</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-t</code>æ˜¯ä¸ºæ–°é•œåƒè®¾ç½®ä»“åº“å’Œåç§°ï¼Œå…¶ä¸­<code>zqy</code>ä¸ºä»“åº“åï¼Œ<code>demo</code>ä¸ºé•œåƒåï¼Œ<code>:v1</code>ä¸ºç‰ˆæœ¬æ ‡ç­¾ï¼ˆä¸æ·»åŠ ä¸ºé»˜è®¤ <code>latest</code> ï¼‰ï¼Œ<code>.</code>ä¸ºå½“å‰è·¯å¾„</li>
</ul>
<h3 id="å¸¸ç”¨æŒ‡ä»¤é›†"><a href="#å¸¸ç”¨æŒ‡ä»¤é›†" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤é›†"></a>å¸¸ç”¨æŒ‡ä»¤é›†</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>ç”¨äºæŒ‡å®šåŸºç¡€çš„<code>images</code>ï¼Œä¸€èˆ¬æ ¼å¼ä¸º<code>FROM &lt;image&gt;</code>or<code>FORM &lt;image&gt;:&lt;tag&gt;</code>ï¼Œæ‰€æœ‰çš„ Dockerfileéƒ½ç”¨è¯¥ä»¥<code>FROM</code>å¼€å¤´ï¼Œ<code>FROM</code>å‘½ä»¤æŒ‡æ˜Dockerfileæ‰€åˆ›å»ºçš„é•œåƒæ–‡ä»¶ä»¥ä»€ä¹ˆé•œåƒä¸ºåŸºç¡€ï¼Œ<code>FROM</code>ä»¥åçš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¼šåœ¨<code>FROM</code>çš„åŸºç¡€ä¸Šè¿›è¡Œåˆ›å»ºé•œåƒã€‚</p>
<h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><p>MAINTAINER æ˜¯ç”¨äºæŒ‡å®šé•œåƒåˆ›å»ºè€…å’Œè”ç³»æ–¹å¼ï¼Œä¸€èˆ¬æ ¼å¼ä¸º<code>MAINTAINER &lt;name&gt;</code>ã€‚</p>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>ç”¨äºå¤åˆ¶æœ¬åœ°ä¸»æœºçš„<code>&lt;src&gt;</code>(ä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„)åˆ°å®¹å™¨ä¸­çš„ <code>&lt;dest&gt;</code>ã€‚å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èä½¿ç”¨<code>COPY</code>ã€‚ä¸€èˆ¬æ ¼å¼ä¸º<code>COPY &lt;src&gt; &lt;dest&gt;</code>æˆ–<code>COPY [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</code>(ç‰¹åˆ«é€‚åˆè·¯å¾„ä¸­å¸¦æœ‰ç©ºæ ¼çš„æƒ…å†µ)ã€‚</p>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>ä¸ä»…èƒ½å¤Ÿå°†æ„å»ºå‘½ä»¤æ‰€åœ¨çš„ä¸»æœºæœ¬åœ°çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè€Œä¸”èƒ½å¤Ÿå°†è¿œç¨‹URLæ‰€å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½œä¸ºèµ„æºå¤åˆ¶åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿã€‚å¯ä»¥è®¤ä¸ºæ˜¯å¢å¼ºç‰ˆçš„<code>COPY</code>ï¼Œæ”¯æŒå°†è¿œç¨‹URLçš„èµ„æºåŠ å…¥åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¸€èˆ¬æ ¼å¼ä¸º<code>ADD &lt;src&gt; &lt;dest&gt;</code>æˆ–<code>ADD [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</code>(ç‰¹åˆ«é€‚åˆè·¯å¾„ä¸­å¸¦æœ‰ç©ºæ ¼çš„æƒ…å†µ)ã€‚</p>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è¢«åé¢çš„æ‰€æœ‰æŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œæ ¼å¼ä¸º<code>ENV &lt;key&gt; &lt;value&gt; ...</code>ï¼Œå¦‚è®¾ç½®JAVAç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV JAVA_HOME /opt/software/jdk1.8.0_161</span><br><span class="line">ENV PATH $JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>ç”¨äºé…åˆ<code>RUN</code>ï¼Œ<code>CMD</code>ï¼Œ<code>ENTRYPOINT</code>å‘½ä»¤è®¾ç½®å½“å‰å·¥ä½œè·¯å¾„ã€‚å¯ä»¥è®¾ç½®å¤šæ¬¡ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ç›¸å¯¹å‰ä¸€ä¸ª<code>WORKDIR</code>å‘½ä»¤ã€‚é»˜è®¤è·¯å¾„ä¸º<code>/</code>ã€‚ä¸€èˆ¬æ ¼å¼ä¸º<code>WORKDIR /path/to/work/dir</code>ã€‚</p>
<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>ç”¨äºå®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤ã€‚æ¯ä¸ª<code>RUN</code>å‘½ä»¤ç›¸å½“äºåœ¨åŸæœ‰çš„é•œåƒåŸºç¡€ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ”¹åŠ¨å±‚ï¼ŒåŸæœ‰çš„é•œåƒä¸ä¼šæœ‰å˜åŒ–ã€‚ä¸€èˆ¬æ ¼å¼ä¸º<code>RUN &lt;command&gt;</code> ã€‚ä¾‹å¦‚è¦å®‰è£…<code>python</code>ä¾èµ–åŒ…ï¼Œåšæ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RUN pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>ç”¨æ¥æŒ‡å®šå¯¹å¤–å¼€æ”¾çš„ç«¯å£ã€‚ä¸€èˆ¬æ ¼å¼ä¸º<code>EXPOSE &lt;port&gt; [&lt;port&gt;...]</code></p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>è®©å®¹å™¨è¡¨ç°å¾—åƒä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¸€æ ·ã€‚ä¸€ä¸ªDockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>ENTRYPOINT</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<p><code>ENTRYPOINT</code> å‘½ä»¤æœ‰ä¸¤ç§æ ¼å¼ï¼š</p>
<ul>
<li><code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code> ï¼šæ¨èä½¿ç”¨çš„ <code>exec</code>å½¢å¼</li>
<li><code>ENTRYPOINT command param1 param2</code> ï¼š<code>shell</code> å½¢å¼</li>
</ul>
<p>ä¾‹å¦‚è¦å°†<code>python</code>é•œåƒå˜æˆå¯æ‰§è¡Œçš„ç¨‹åºï¼Œå¯ä»¥è¿™æ ·å»åšï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENTRYPOINT [&quot;python&quot;]</span><br></pre></td></tr></table></figure>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>ç”¨äºå¯åŠ¨å®¹å™¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ï¼Œ<code>CMD</code>å‘½ä»¤å¯ä»¥åŒ…å«å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸åŒ…å«å¯æ‰§è¡Œæ–‡ä»¶çš„æƒ…å†µä¸‹å°±è¦ç”¨<code>ENTRYPOINT</code>æŒ‡å®šä¸€ä¸ªï¼Œç„¶å<code>CMD</code>å‘½ä»¤çš„å‚æ•°å°±ä¼šä½œä¸º<code>ENTRYPOINT</code>çš„å‚æ•°ã€‚</p>
<p><code>CMD</code> å‘½ä»¤æœ‰ä¸‰ç§æ ¼å¼ï¼š</p>
<ul>
<li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code>ï¼šæ¨èä½¿ç”¨çš„ <code>exec</code> å½¢å¼ã€‚</li>
<li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code>ï¼šæ— å¯æ‰§è¡Œç¨‹åºå½¢å¼</li>
<li><code>CMD command param1 param2</code>ï¼šshell å½¢å¼ã€‚</li>
</ul>
<p>ä¸€ä¸ªDockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>CMD</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚è€Œ<code>CMD</code>çš„<code>shell</code>å½¢å¼é»˜è®¤è°ƒç”¨<code>/bin/sh -c</code>æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p><code>CMD</code>å‘½ä»¤ä¼šè¢«Dockerå‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°è¦†ç›–ï¼š<code>docker run busybox /bin/echo Hello</code> <code>Docker</code>ä¼šæŠŠ<code>CMD</code>é‡Œçš„å‘½ä»¤è¦†ç›–ã€‚</p>
<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ–UIDæˆ–GIDï¼Œåç»­çš„æ“ä½œéƒ½ä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·ã€‚æ ¼å¼ï¼š<code>USER user</code>æˆ–<code>USER user:group</code>æˆ–<code>USER uid</code>æˆ–<code>USER uid:gid</code>æˆ–<code>USER user:gid</code>æˆ–<code>USER uid:group</code></p>
<p>ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USER www #ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·åï¼ŒDockerfileä¸­å…¶åçš„å‘½ä»¤RUNã€CMDã€ENTRYPOINTéƒ½å°†ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚é•œåƒæ„å»ºå®Œæˆåï¼Œé€šè¿‡docker runè¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡-uå‚æ•°æ¥è¦†ç›–æ‰€æŒ‡å®šçš„ç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuå¤šç‰ˆæœ¬CUDAå®‰è£…ä¸åˆ‡æ¢</title>
    <url>/2022/01/04/Ubuntu%E5%A4%9A%E7%89%88%E6%9C%ACcuda%E5%AE%89%E8%A3%85%E4%B8%8E%E5%88%87%E6%8D%A2/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»CUDAå¤šç‰ˆæœ¬å¦‚ä½•å…±å­˜ä¸åˆ‡æ¢ï¼Œè¿™é‡Œä»¥cuda10.1ä¸ºä¾‹ã€‚</p>
<h2 id="å®‰è£…æ–°ç‰ˆæœ¬cuda"><a href="#å®‰è£…æ–°ç‰ˆæœ¬cuda" class="headerlink" title="å®‰è£…æ–°ç‰ˆæœ¬cuda"></a>å®‰è£…æ–°ç‰ˆæœ¬cuda</h2><p>å»<a href="https://developer.nvidia.com/cuda-downloads?target_os=Windows&amp;target_arch=x86_64&amp;target_version=10">å®˜ç½‘</a>é€‰æ‹©å¯¹åº”å®‰è£…åŒ…ï¼Œè¿™é‡Œé€‰æ‹©runfileç±»å‹çš„å®‰è£…æ–‡ä»¶<code>cuda_10.1.243_418.87.00_linux.run</code>ã€‚</p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¼€å§‹å®‰è£…ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo sh cuda_10.1.243_418.87.00_linux.run</span><br></pre></td></tr></table></figure></p>
<p>ä¾æ¬¡å‡ºç°å¦‚ä¸‹ç•Œé¢ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/sw1.png" alt></p>
<p>é€‰æ‹©continueï¼Œç»§ç»­ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/sw2.png" alt></p>
<p>è¾“å…¥acceptï¼Œå›è½¦æ¥å—ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/sw3.png" alt></p>
<ul>
<li>æ˜¯å¦å®‰è£…æ˜¾å¡é©±åŠ¨ï¼Œæœ¬æœºå·²æœ‰ï¼Œè¿™é‡Œä¸€èˆ¬å–æ¶ˆå‹¾é€‰</li>
<li>æ˜¯å¦å®‰è£…å·¥å…·åŒ…ï¼Œé»˜è®¤å‹¾é€‰</li>
<li>æ˜¯å¦å®‰è£…æ ·ä¾‹ï¼Œ é»˜è®¤å‹¾é€‰</li>
<li>æ˜¯å¦å®‰è£…æ¼”ç¤ºå¥—ä»¶ï¼Œé»˜è®¤å‹¾é€‰</li>
<li>æ˜¯å¦å®‰è£…æ–‡æ¡£ï¼Œé»˜è®¤å‹¾é€‰</li>
</ul>
<p>å‹¾é€‰å®Œæ¯•ï¼Œç‚¹å‡»installå¼€å§‹å®‰è£…ã€‚</p>
<p>è¿‡ç¨‹ä¸­ä¼šå«ä½ é€‰æ‹©æ˜¯å¦åˆ›å»ºæŒ‡å‘cudaçš„é“¾æ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Do you want to install a symbolic link at /usr/local/cuda?</span><br><span class="line">(y)es/(n)o/(q)uit:</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé©¬ä¸Šæƒ³è¦ä½¿ç”¨å½“å‰ç‰ˆæœ¬ï¼Œè¿™é‡Œå°±é€‰yesï¼Œå¦åˆ™å°±é€‰noï¼Œç­‰æœ‰éœ€è¦æ—¶å†è®¾ç½®ã€‚</p>
<h2 id="å®‰è£…cuDNN"><a href="#å®‰è£…cuDNN" class="headerlink" title="å®‰è£…cuDNN"></a>å®‰è£…cuDNN</h2><p>åŒæ ·å»<a href="https://developer.nvidia.com/rdp/cudnn-archive">å®˜ç½‘</a>ä¸‹è½½å¥½ä¸CUDAç‰ˆæœ¬å¯¹åº”çš„å®‰è£…åŒ…ï¼Œæ–‡ä»¶æ ¼å¼ä¸ºtarå‹ç¼©æ–‡ä»¶<code>cudnn-10.1-linux-x64-v7.6.4.38.tgz</code>ã€‚</p>
<p>â‘  è¿›è¡Œè§£å‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -zxvf cudnn-10.1-linux-x64-v7.6.4.38.tgz</span><br></pre></td></tr></table></figure>
<p>â‘¡ å°†è§£å‹åçš„æ–‡ä»¶å¤åˆ¶åˆ°æ–°ç‰ˆæœ¬cudaç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo cp cuda/include/cudnn.h  /usr/local/cuda-10.1/include</span><br><span class="line">sudo cp cuda/lib64/libcudnn*  /usr/local/cuda-10.1/lib64</span><br></pre></td></tr></table></figure>
<p>â‘¢ æ›´æ”¹æƒé™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod a+r /usr/local/cuda-10.1/include/cudnn.h  /usr/local/cuda-10.1/lib64/libcudnn*</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><p>ä¿®æ”¹ ~/.bashrc æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64</span><br><span class="line">export PATH=$PATH:/usr/local/cuda/bin</span><br><span class="line">export CUDA_HOME=$CUDA_HOME:/usr/local/cuda</span><br></pre></td></tr></table></figure>
<p>æŒ‰æ­¤è®¾ç½®åï¼Œä»¥åæ›´æ¢CUDAç‰ˆæœ¬æ— éœ€å†åŠ¨ç¯å¢ƒé…ç½®ã€‚</p>
<h2 id="å¤šç‰ˆæœ¬åˆ‡æ¢"><a href="#å¤šç‰ˆæœ¬åˆ‡æ¢" class="headerlink" title="å¤šç‰ˆæœ¬åˆ‡æ¢"></a>å¤šç‰ˆæœ¬åˆ‡æ¢</h2><p>CUDAé»˜è®¤å®‰è£…åœ¨<code>/usr/local</code>ä¸‹ï¼Œå¯è‡³æ­¤ç›®å½•æŸ¥çœ‹å·²å®‰è£…ç‰ˆæœ¬ã€‚</p>
<p>ä½¿ç”¨statå‘½ä»¤å¯æŸ¥çœ‹å½“å‰CUDAè½¯é“¾æ¥æŒ‡å‘å“ªä¸ªCUDAç‰ˆæœ¬ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/sw4.png" alt></p>
<p>åˆ‡æ¢ç‰ˆæœ¬åªéœ€å°†è½¯é“¾æ¥æŒ‡å‘æ–°çš„CUDAç‰ˆæœ¬ï¼š</p>
<p>â‘  åˆ é™¤åŸæ¥çš„é“¾æ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo rm -rf /usr/local/cuda</span><br></pre></td></tr></table></figure>
<p>â‘¡ å»ºç«‹æ–°é“¾æ¥ï¼ŒæŒ‡å‘æŒ‡å®šçš„CUDAç‰ˆæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ln -s /usr/local/cuda-10.1 /usr/local/cuda</span><br></pre></td></tr></table></figure>
<p>åˆ‡æ¢å®Œæ¯•åå¯å†æ¬¡é€šè¿‡<code>stat</code>å‘½ä»¤æˆ–<code>nvcc -V</code>æŸ¥çœ‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/cuda/sw5.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>CUDA</tag>
        <tag>cuDNN</tag>
      </tags>
  </entry>
  <entry>
    <title>EndNoteæ ·å¼ä½¿ç”¨æ•™ç¨‹</title>
    <url>/2020/12/11/EndNote%E6%A0%B7%E5%BC%8F%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>EndNoteä¸»è¦é’ˆå¯¹è‹±æ–‡æ–‡çŒ®ï¼Œæ‰€ä»¥å¹¶æ²¡æä¾›ç¬¦åˆä¸­åæ ‡å‡†çš„æ–‡çŒ®æ ·å¼ï¼Œè€Œç½‘ä¸Šæ‰¾çš„æ ·å¼åˆä¸å¤ªå¯¹ã€‚å› æ­¤è¿™é‡Œæœ¬äººæ ¹æ®ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡†GB/T7714-2005å’Œæ±Ÿå—å¤§å­¦è®ºæ–‡è¦æ±‚ï¼Œåˆ¶ä½œäº†å¯ä¾›å¯¼å…¥ä½¿ç”¨çš„æ ·å¼ã€‚</p>
<p>ä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼š<br><a href="https://drive.google.com/file/d/1RgwQu1P_yDF_zLhAr2b-q3qFkFm8pNLz/view?usp=sharing">æ±Ÿå¤§å¼€é¢˜æŠ¥å‘Šæ ·å¼</a><br><a href="https://drive.google.com/file/d/1EeGhckTxcrS2fdU2tLck_1vozWer0jU6/view?usp=sharing">æ±Ÿå¤§æ¯•ä¸šè®ºæ–‡æ ·å¼</a></p>
<h2 id="ä½¿ç”¨æ•™ç¨‹"><a href="#ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="ä½¿ç”¨æ•™ç¨‹"></a>ä½¿ç”¨æ•™ç¨‹</h2><p><strong>â‘  å°†.ensæ ·å¼æ–‡ä»¶æ”¾å…¥EndNoteå®‰è£…ç›®å½•ä¸‹çš„Stylesæ–‡ä»¶å¤¹ã€‚</strong></p>
<p><strong>â‘¡ ä½¿ç”¨æ—¶åˆ‡æ¢æ ·å¼å³å¯ï¼š</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/4.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/5.png" alt></p>
<p><strong>â‘¢ æ’å…¥æ–‡çŒ®æ•ˆæœå¦‚ä¸‹ï¼š</strong></p>
<ul>
<li>å¼€é¢˜æŠ¥å‘Šï¼š</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/6.jpg" alt></p>
<ul>
<li><p>æ¯•ä¸šè®ºæ–‡ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/13.png" alt></p>
</li>
</ul>
<p><strong>â‘£ è‹¥å‚è€ƒæ–‡çŒ®åºå·åé¢ç©ºæ ¼è¿‡é•¿å¯è®¾ç½®æ‚¬æŒ‚ç¼©è¿›è·ç¦»ï¼š</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/7.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/8.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/9.jpg" alt></p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><h3 id="â‘ -arxivæœŸåˆŠï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºManuscriptï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ï¼Œå¹¶æŒ‰å›¾ä¸­å­—æ®µå®Œå–„ç›¸åº”å†…å®¹ã€‚"><a href="#â‘ -arxivæœŸåˆŠï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºManuscriptï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ï¼Œå¹¶æŒ‰å›¾ä¸­å­—æ®µå®Œå–„ç›¸åº”å†…å®¹ã€‚" class="headerlink" title="â‘   arxivæœŸåˆŠï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºManuscriptï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ï¼Œå¹¶æŒ‰å›¾ä¸­å­—æ®µå®Œå–„ç›¸åº”å†…å®¹ã€‚"></a>â‘   arxivæœŸåˆŠï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºManuscriptï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ï¼Œå¹¶æŒ‰å›¾ä¸­å­—æ®µå®Œå–„ç›¸åº”å†…å®¹ã€‚</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/10.jpg" alt></p>
<h3 id="â‘¡-ä¸­æ–‡æ–‡çŒ®ï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºä¸­æ–‡æ–‡çŒ®ï¼Œå¹¶å¡«å†™Secondary-Authorï¼ˆä¸Authorä¸€æ ·ï¼‰ï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ã€‚"><a href="#â‘¡-ä¸­æ–‡æ–‡çŒ®ï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºä¸­æ–‡æ–‡çŒ®ï¼Œå¹¶å¡«å†™Secondary-Authorï¼ˆä¸Authorä¸€æ ·ï¼‰ï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ã€‚" class="headerlink" title="â‘¡ ä¸­æ–‡æ–‡çŒ®ï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºä¸­æ–‡æ–‡çŒ®ï¼Œå¹¶å¡«å†™Secondary Authorï¼ˆä¸Authorä¸€æ ·ï¼‰ï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ã€‚"></a>â‘¡ ä¸­æ–‡æ–‡çŒ®ï¼Œè¯·è®¾ç½®å‚è€ƒç±»å‹ä¸ºä¸­æ–‡æ–‡çŒ®ï¼Œå¹¶å¡«å†™Secondary Authorï¼ˆä¸Authorä¸€æ ·ï¼‰ï¼Œä»¥æ–¹ä¾¿æ ·å¼è¯†åˆ«æ–‡çŒ®ç±»å‹ã€‚</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/12.jpg" alt></p>
<p><strong>ä¸­æ–‡æ–‡çŒ®å‚è€ƒç±»å‹è®¾ç½®ï¼š</strong></p>
<p>ç‚¹å‡»ã€Œç¼–è¾‘ã€â†’ã€Œé¦–é€‰é¡¹ã€â†’ã€Œå‚è€ƒæ–‡çŒ®ç±»å‹ã€â†’ã€Œä¿®æ”¹å‚è€ƒæ–‡çŒ®ç±»å‹ã€ï¼ˆã€ŒEditã€â†’ã€ŒPreferenceã€â†’ã€ŒReference Typesã€â†’ã€ŒModify Reference Types ã€ï¼‰</p>
<p>EndNoteæœªä½¿ç”¨çš„æ–‡çŒ®ç±»å‹ (Reference Type) é»˜è®¤ä¸º3ä¸ª , å®ƒä»¬è¢«å‘½åä¸º Unused 1ï¼ŒUnused 2å’ŒUnused 3 ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™å‡ ä¸ªæœªä½œç”¨çš„æ–‡çŒ®ç±»å‹æ¥ä¿®æ”¹ã€‚</p>
<p>å¦‚é€‰æ‹©Unused 1ï¼Œåœ¨ Generic é¡¹ä¸­è¾“å…¥æ–°æ–‡çŒ®ç±»å‹åã€Œä¸­æ–‡æ–‡çŒ®ã€ï¼Œç„¶åä¾æ¬¡ä¿®æ”¹å„é¡¹ï¼Œä¿®æ”¹å®Œæ¯•åã€ŒOKã€å…³é—­ä¿å­˜ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/11.jpg" alt></p>
<h3 id="â‘¢-å­¦ä½è®ºæ–‡ï¼Œåˆ™æŒ‰ç…§å¦‚ä¸‹å›¾ï¼Œå®Œå–„ç›¸åº”ä¿¡æ¯ã€‚"><a href="#â‘¢-å­¦ä½è®ºæ–‡ï¼Œåˆ™æŒ‰ç…§å¦‚ä¸‹å›¾ï¼Œå®Œå–„ç›¸åº”ä¿¡æ¯ã€‚" class="headerlink" title="â‘¢ å­¦ä½è®ºæ–‡ï¼Œåˆ™æŒ‰ç…§å¦‚ä¸‹å›¾ï¼Œå®Œå–„ç›¸åº”ä¿¡æ¯ã€‚"></a>â‘¢ å­¦ä½è®ºæ–‡ï¼Œåˆ™æŒ‰ç…§å¦‚ä¸‹å›¾ï¼Œå®Œå–„ç›¸åº”ä¿¡æ¯ã€‚</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/14.png" alt></p>
<h3 id="â‘£-ä¼šè®®è®ºæ–‡è¯·è¡¥å……å®Œå–„ä¼šè®®åœ°ç‚¹ï¼š"><a href="#â‘£-ä¼šè®®è®ºæ–‡è¯·è¡¥å……å®Œå–„ä¼šè®®åœ°ç‚¹ï¼š" class="headerlink" title="â‘£ ä¼šè®®è®ºæ–‡è¯·è¡¥å……å®Œå–„ä¼šè®®åœ°ç‚¹ï¼š"></a>â‘£ ä¼šè®®è®ºæ–‡è¯·è¡¥å……å®Œå–„ä¼šè®®åœ°ç‚¹ï¼š</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/15.png" alt></p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
  </entry>
  <entry>
    <title>PytorchåŸºäºApexçš„æ··åˆç²¾åº¦åŠ é€Ÿ</title>
    <url>/2020/08/20/Pytorch%E5%9F%BA%E4%BA%8EApex%E7%9A%84%E6%B7%B7%E5%90%88%E7%B2%BE%E5%BA%A6%E5%8A%A0%E9%80%9F/</url>
    <content><![CDATA[<h1 id="Pytorch-gt-1-6-0"><a href="#Pytorch-gt-1-6-0" class="headerlink" title="Pytorch &gt;= 1.6.0"></a>Pytorch &gt;= 1.6.0</h1><p>pytorch1.6å¼€å§‹å®˜æ–¹æ”¯æŒäº†æ··åˆç²¾åº¦è®­ç»ƒã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.cuda.amp <span class="keyword">import</span> autocast <span class="keyword">as</span> autocast, GradScaler</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºmodelï¼Œé»˜è®¤æ˜¯torch.FloatTensor</span></span><br><span class="line">model = Net().cuda()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è®­ç»ƒæœ€å¼€å§‹ä¹‹å‰å®ä¾‹åŒ–ä¸€ä¸ªGradScalerå¯¹è±¡</span></span><br><span class="line">scaler = GradScaler()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> epochs:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">input</span>, target <span class="keyword">in</span> data:</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‰å‘è¿‡ç¨‹(model + loss)å¼€å¯ autocast</span></span><br><span class="line">        <span class="keyword">with</span> autocast():</span><br><span class="line">            output = model(<span class="built_in">input</span>)</span><br><span class="line">            loss = loss_fn(output, target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Scales lossï¼Œè¿™æ˜¯å› ä¸ºåŠç²¾åº¦çš„æ•°å€¼èŒƒå›´æœ‰é™ï¼Œå› æ­¤éœ€è¦ç”¨å®ƒæ”¾å¤§</span></span><br><span class="line">        scaler.scale(loss).backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># scaler.step() unscaleä¹‹å‰æ”¾å¤§åçš„æ¢¯åº¦ï¼Œä½†æ˜¯scaleå¤ªå¤šå¯èƒ½å‡ºç°infæˆ–NaN</span></span><br><span class="line">        <span class="comment"># æ•…å…¶ä¼šåˆ¤æ–­æ˜¯å¦å‡ºç°äº†inf/NaN</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ¢¯åº¦çš„å€¼ä¸æ˜¯ infs æˆ–è€… NaNs, é‚£ä¹ˆè°ƒç”¨optimizer.step()æ¥æ›´æ–°æƒé‡,</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ£€æµ‹åˆ°å‡ºç°äº†infæˆ–è€…NaNï¼Œå°±è·³è¿‡è¿™æ¬¡æ¢¯åº¦æ›´æ–°ï¼ŒåŒæ—¶åŠ¨æ€è°ƒæ•´scalerçš„å¤§å°</span></span><br><span class="line">        scaler.step(optimizer)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥çœ‹æ˜¯å¦è¦æ›´æ–°scaler</span></span><br><span class="line">        scaler.update()</span><br></pre></td></tr></table></figure>
<h1 id="Pytorch-lt-1-6-0"><a href="#Pytorch-lt-1-6-0" class="headerlink" title="Pytorch &lt; 1.6.0"></a>Pytorch &lt; 1.6.0</h1><p>pytorch1.6ç‰ˆæœ¬å‰éœ€è¦é…åˆç¬¬ä¸‰æ–¹æ’ä»¶ä½¿ç”¨æ··åˆç²¾åº¦ã€‚</p>
<h2 id="Apex"><a href="#Apex" class="headerlink" title="Apex"></a>Apex</h2><p><a href="https://github.com/NVIDIA/apex">Apex</a>æ˜¯ç”±Nvidiaç»´æŠ¤çš„ä¸€ä¸ªæ”¯æŒæ··åˆç²¾åº¦åˆ†å¸ƒå¼è®­ç»ƒçš„ç¬¬ä¸‰æ–¹Pytorchæ‰©å±•ã€‚å¯ä»¥ç”¨çŸ­çŸ­ä¸‰è¡Œä»£ç å°±èƒ½å®ç°ä¸åŒç¨‹åº¦çš„æ··åˆç²¾åº¦åŠ é€Ÿï¼Œä½¿è®­ç»ƒæ—¶é—´å’Œæ˜¾å­˜å ç”¨ç›´æ¥ç¼©å°ä¸€åŠã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä»¥ä¸‹æ˜¯å®‰è£… apex çš„æ–¹æ³•. apexå…‹éš†åœ¨å“ªé‡Œéƒ½æ— æ‰€è°“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/NVIDIA/apex</span><br><span class="line">cd apex</span><br><span class="line">pip install -v --no-cache-dir --global-option=&quot;--pyprof&quot; --global-option=&quot;--cpp_ext&quot; --global-option=&quot;--cuda_ext&quot; ./</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹ä»£ç ç”¨äºéªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> apex.parallel <span class="keyword">import</span> DistributedDataParallel <span class="keyword">as</span> DDP</span><br><span class="line">    <span class="keyword">from</span> apex.fp16_utils <span class="keyword">import</span> *</span><br><span class="line">    <span class="keyword">from</span> apex <span class="keyword">import</span> amp, optimizers</span><br><span class="line">    <span class="keyword">from</span> apex.multi_tensor_apply <span class="keyword">import</span> multi_tensor_applier</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">raise</span> ImportError(<span class="string">&quot;Please install apex from https://www.github.com/nvidia/apex to run this example.&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¸è½½å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip uninstall apex</span><br></pre></td></tr></table></figure>
<h2 id="æ”¯æŒåˆ—è¡¨"><a href="#æ”¯æŒåˆ—è¡¨" class="headerlink" title="æ”¯æŒåˆ—è¡¨"></a>æ”¯æŒåˆ—è¡¨</h2><p>åˆ¤æ–­ä½ çš„GPUæ˜¯å¦æ”¯æŒFP16ï¼šæ”¯æŒçš„æœ‰æ‹¥æœ‰Tensor Coreçš„GPU(2080Tiã€Titanã€Teslaç­‰)ï¼Œä¸æ”¯æŒçš„(Pascalç³»åˆ—)å°±ä¸å»ºè®®æŠ˜è…¾äº†ã€‚</p>
<p>å¦‚æœä½ çš„GPUæ˜¯ä»¥ä¸‹GPUçš„å…¶ä¸­ä¸€ç§: è¯·è°ƒæ•´nvccä¸pytorch.cudaè‡³10.0</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GeForce GTX 1650</span><br><span class="line">GeForce GTX 1660</span><br><span class="line">GeForce GTX 1660 Ti</span><br><span class="line">GeForce RTX 2060</span><br><span class="line">GeForce RTX 2060 Super</span><br><span class="line">GeForce RTX 2070</span><br><span class="line">GeForce RTX 2070 Super</span><br><span class="line">GeForce RTX 2080</span><br><span class="line">GeForce RTX 2080 Super</span><br><span class="line">GeForce RTX 2080 Ti</span><br><span class="line">Titan RTX</span><br><span class="line">Quadro RTX 4000</span><br><span class="line">Quadro RTX 5000</span><br><span class="line">Quadro RTX 6000</span><br><span class="line">Quadro RTX 8000</span><br><span class="line">Tesla T4</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ‰“ç®—è°ƒæ•´Pytorch Versionæ¥é€‚åº”APEX(æ¨è)</p>
<p>é¦–å…ˆç”¨ <code>nvcc --version</code> å‘½ä»¤è°ƒæŸ¥ä½ çš„nvccç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2018 NVIDIA Corporation</span><br><span class="line">Built on Tue_Jun_12_23:07:04_CDT_2018</span><br><span class="line">Cuda compilation tools, release 9.2, V9.2.148</span><br></pre></td></tr></table></figure>
<p>å†è¿›å…¥pythonçœ‹çœ‹pytorch cudaç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; torch.version.cuda</span><br><span class="line">&#x27;9.0.176&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>3090tiè‡ªå¸¦cudaä¸º11.1ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åŒ¹é…çš„torchç‰ˆæœ¬ï¼Œè¿™é‡Œä¸ºäº†å®‰ä¸Šapexï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>setup.py</code>å°è¯•ç¦ç”¨æ¬¡è¦ç‰ˆæœ¬æ£€æŸ¥ã€‚</p>
<p>æ‰¾åˆ°å¦‚ä¸‹å‡½æ•°ï¼Œæ³¨é‡Šæ‰åŸè¯­å¥ï¼Œè¿”å›ç©ºå€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> def check_cuda_torch_binary_vs_bare_metal(cuda_dir):</span><br><span class="line">+    return</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹åï¼Œé‡æ–°å®‰è£…apexå³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -v --no-cache-dir --global-option=&quot;--cpp_ext&quot; --global-option=&quot;--cuda_ext&quot; ./</span><br></pre></td></tr></table></figure>
<p>æˆ‘åœ¨å®‰è£…äº†å¸¦æœ‰cuda-11.0çš„pytorchçš„åŒæ—¶ï¼Œé’ˆå¯¹æ•´ä¸ªç³»ç»Ÿçš„cuda-11.1æˆåŠŸæ„å»ºäº†apexï¼</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¯¼å…¥åŒ…ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> apex <span class="keyword">import</span> amp</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½ åˆ›å»ºånet(model)å’Œoptimizeråæ·»åŠ ä»£ç (æ³¨æ„é¡ºåº)ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">net = net.cuda()</span><br><span class="line">net, optimizer = amp.initialize(net, optimizer, opt_level=<span class="string">&quot;O1&quot;</span>) <span class="comment"># è¿™é‡Œæ˜¯â€œæ¬§ä¸€â€ï¼Œä¸æ˜¯â€œé›¶ä¸€â€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if you need to use multiple GPU, uncomment this line</span></span><br><span class="line"><span class="comment"># net = torch.nn.DataParallel(net, device_ids=[i for i in range(torch.cuda.device_count())])</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæŠŠä½ çš„loss.backward()æ¢æˆ ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> amp.scale_loss(loss, optimizer) <span class="keyword">as</span> scaled_loss:</span><br><span class="line">    scaled_loss.backward()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æœ‰ç”¨Pytorchè‡ªå¸¦çš„BCELossæˆ–F.binary_cross_entropy, è¯·æŠŠä»–ä»¬æ›¿æ¢æˆBCEWithLogitsLossæˆ–F.binary_cross_entropy_with_logistså¹¶ç”¨logists ä½œä¸ºè¾“å…¥.</p>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><h3 id="opt-level"><a href="#opt-level" class="headerlink" title="opt level"></a>opt level</h3><p>å…¶ä¸­åªæœ‰ä¸€ä¸ªopt_leveléœ€è¦ç”¨æˆ·è‡ªè¡Œé…ç½®ï¼š</p>
<ul>
<li><p>oeï¼šçº¯FP32è®­ç»ƒï¼Œå¯ä»¥ä½œä¸ºaccuracyçš„baselineï¼›</p>
</li>
<li><p>o1ï¼šæ··åˆç²¾åº¦è®­ç»ƒ(æ¨èä½¿ç”¨)ï¼Œæ ¹æ®é»‘ç™½åå•è‡ªåŠ¨å†³å®šä½¿ç”¨FP16(GEMMï¼Œå·ç§¯)è¿˜æ˜¯FP32(Softmax)è¿›è¡Œè®¡ç®—ã€‚</p>
</li>
<li><p>02ï¼šâ€œå‡ ä¹FP16â€æ··åˆç²¾åº¦è®­ç»ƒï¼Œä¸å­˜åœ¨é»‘ç™½åå•ï¼Œé™¤äº†Batch normï¼Œå‡ ä¹éƒ½æ˜¯ç”¨FP16è®¡ç®—ã€‚</p>
</li>
<li><p>o3ï¼šçº¯FP16è®­ç»ƒï¼Œå¾ˆä¸ç¨³å®šï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºspeedçš„baselineï¼›</p>
</li>
</ul>
<h3 id="åŠ¨æ€æŸå¤±æ”¾å¤§ï¼ˆDynamic-Loss-Scalingï¼‰"><a href="#åŠ¨æ€æŸå¤±æ”¾å¤§ï¼ˆDynamic-Loss-Scalingï¼‰" class="headerlink" title="åŠ¨æ€æŸå¤±æ”¾å¤§ï¼ˆDynamic Loss Scalingï¼‰"></a>åŠ¨æ€æŸå¤±æ”¾å¤§ï¼ˆDynamic Loss Scalingï¼‰</h3><p>AMPé»˜è®¤ä½¿ç”¨åŠ¨æ€æŸå¤±æ”¾å¤§ï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨FP16çš„èŒƒå›´ï¼Œç¼“è§£èˆå…¥è¯¯å·®ï¼Œå°½é‡ä½¿ç”¨æœ€é«˜çš„æ”¾å¤§å€($2^{24}$)ï¼Œå¦‚æœäº§ç”Ÿäº†ä¸Šæº¢å‡º(Overflow)ï¼Œåˆ™è·³è¿‡å‚æ•°æ›´æ–°ï¼Œç¼©å°æ”¾å¤§å€æ•°ä½¿å…¶ä¸æº¢å‡ºï¼Œåœ¨ä¸€å®šæ­¥æ•°å(æ¯”å¦‚2000æ­¥)ä¼šå†å°è¯•ä½¿ç”¨å¤§çš„scaleæ¥å……åˆ†åˆ©ç”¨FP16çš„èŒƒå›´ï¼š</p>
<h2 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h2><ol>
<li><strong>å‡å°‘æ˜¾å­˜å ç”¨</strong>    ç°åœ¨æ¨¡å‹è¶Šæ¥è¶Šå¤§ï¼Œå½“ä½ ä½¿ç”¨Bertè¿™ä¸€ç±»çš„é¢„è®­ç»ƒæ¨¡å‹æ—¶ï¼Œå¾€å¾€æ˜¾å­˜å°±è¢«æ¨¡å‹åŠæ¨¡å‹è®¡ç®—å å»å¤§åŠï¼Œå½“æƒ³è¦ä½¿ç”¨æ›´å¤§çš„Batch Sizeçš„æ—¶å€™ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚ç”±äºFP16çš„å†…å­˜å ç”¨åªæœ‰FP32çš„ä¸€åŠï¼Œè‡ªç„¶åœ°å°±å¯ä»¥å¸®åŠ©è®­ç»ƒè¿‡ç¨‹èŠ‚çœä¸€åŠçš„æ˜¾å­˜ç©ºé—´ã€‚</li>
<li><strong>åŠ å¿«è®­ç»ƒå’Œæ¨æ–­çš„è®¡ç®—</strong>    ä¸æ™®é€šçš„ç©ºé—´æ—¶é—´Trade-offçš„åŠ é€Ÿæ–¹æ³•ä¸åŒï¼ŒFP16é™¤äº†èƒ½èŠ‚çº¦å†…å­˜ï¼Œè¿˜èƒ½åŒæ—¶èŠ‚çœæ¨¡å‹çš„è®­ç»ƒæ—¶é—´ã€‚åœ¨å¤§éƒ¨åˆ†çš„æµ‹è¯•ä¸­ï¼ŒåŸºäºFP16çš„åŠ é€Ÿæ–¹æ³•èƒ½å¤Ÿç»™æ¨¡å‹è®­ç»ƒå¸¦æ¥å¤šä¸€å€çš„åŠ é€Ÿä½“éªŒï¼ˆçˆ½æ„Ÿç±»ä¼¼äºä¸¤å€é€Ÿçœ‹è‚¥çš‚å‰§ï¼‰ã€‚</li>
<li><strong>å¼ é‡æ ¸å¿ƒçš„æ™®åŠ</strong>    ç¡¬ä»¶çš„å‘å±•åŒæ ·ä¹Ÿæ¨åŠ¨ç€æ¨¡å‹è®¡ç®—çš„åŠ é€Ÿï¼Œéšç€Nvidiaå¼ é‡æ ¸å¿ƒ(Tensor Core)çš„æ™®åŠï¼Œ16bitè®¡ç®—ä¹Ÿä¸€æ­¥æ­¥èµ°å‘æˆç†Ÿï¼Œä½ç²¾åº¦è®¡ç®—ä¹Ÿæ˜¯æœªæ¥æ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªé‡è¦è¶‹åŠ¿ï¼Œå†ä¸å­¦ä¹ å°±outå•¦ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcodeåˆ·é¢˜(Python3åŠJavaå®ç°)</title>
    <url>/2021/03/09/Leetcode%E5%88%B7%E9%A2%98/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç³»åˆ—æ˜¯æœ¬äººåœ¨åˆ·é¢˜è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒ<a href="https://www.geekxh.com/0.0.%E5%AD%A6%E4%B9%A0%E9%A1%BB%E7%9F%A5/01.html">ã€Šå°æµ©ç®—æ³•ã€‹</a>çš„é¢˜å‹åˆ†ç±»æ‰€åšã€‚ç”±äºå°æµ©åœ¨å¤§å¤šæ•°é¢˜ç›®å¹¶æœªä½¿ç”¨ç»Ÿä¸€çš„è¯­è¨€å®ç°ï¼Œè¿™é‡Œæœ¬äººç»™å‡ºäº†Pythonå’ŒJavaçš„å®ç°ã€‚ç›®å‰Pythonå®ç°å·²å®Œæˆï¼ŒJavaå®ç°ä»åœ¨æ›´æ–°ä¸­ã€‚è‹¥æœ‰é”™è¯¯æˆ–è€…æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œæ¬¢è¿æå‡ºã€‚</p>
</blockquote>
<h2 id="æ•°ç»„ç³»åˆ—"><a href="#æ•°ç»„ç³»åˆ—" class="headerlink" title="æ•°ç»„ç³»åˆ—"></a>æ•°ç»„ç³»åˆ—</h2><h3 id="1-äº¤é›†"><a href="#1-äº¤é›†" class="headerlink" title="1.äº¤é›†"></a>1.äº¤é›†</h3><blockquote>
<p>æ­¤é¢˜å¯ä»¥çœ‹æˆæ˜¯ä¸€é“ä¼ ç»Ÿçš„æ˜ å°„é¢˜ï¼ˆmapæ˜ å°„ï¼‰ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·çœ‹å‘¢ï¼Œå› ä¸ºæˆ‘ä»¬éœ€æ‰¾å‡ºä¸¤ä¸ªæ•°ç»„çš„äº¤é›†å…ƒç´ ï¼ŒåŒæ—¶åº”ä¸ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ã€‚è¿™æ ·å°±å¯¼è‡´äº†æˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸ªå€¼å‡ºç°çš„æ¬¡æ•°ï¼Œæ‰€ä»¥æ˜ å°„å…³ç³»å°±æˆäº†&lt;å…ƒç´ ,å‡ºç°æ¬¡æ•°&gt;</p>
</blockquote>
<p><strong>[ç¬¬349é¢˜]</strong>    ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚ </p>
<ul>
<li><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums1 = [1,2,2,1], nums2 = [2,2]<br>è¾“å‡ºï¼š[2]</p>
</li>
<li><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums1 = [4,9,5], nums2 = [9,4,9,8,4]<br>è¾“å‡ºï¼š[9,4] </p>
</li>
</ul>
<p>è¯´æ˜ï¼š <strong>è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚</strong> æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚ </p>
<p><strong>æ–¹æ³•ä¸€ï¼šæ˜ å°„å­—å…¸</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersection</span>(<span class="params">self, nums1: <span class="type">List</span>[<span class="built_in">int</span>], nums2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        key = &#123;&#125;</span><br><span class="line">        result=[]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> nums1:</span><br><span class="line">        	<span class="comment">#éå†nums1ï¼Œåˆå§‹åŒ–å­—å…¸key</span></span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">                key[v] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> nums2:</span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">in</span> key:</span><br><span class="line">            	<span class="comment">#å¦‚æœå…ƒç´ ç›¸åŒï¼Œå°†å…¶å­˜å…¥resultä¸­ï¼Œå¹¶å°†å‡ºç°æ¬¡æ•°å‡1</span></span><br><span class="line">                <span class="keyword">if</span> key[v] &gt; <span class="number">0</span>:</span><br><span class="line">                    key[v] -= <span class="number">1</span></span><br><span class="line">                    result.append(v)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:60 ms,å‡»è´¥äº†74.80% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†70.92% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[nums2.length];</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//getOrDefault()ï¼Œå½“Mapé›†åˆä¸­æœ‰è¿™ä¸ªkeyæ—¶ï¼Œå°±ä½¿ç”¨è¿™ä¸ªkeyå€¼ï¼Œå¦‚æœæ²¡æœ‰å°±ä½¿ç”¨é»˜è®¤å€¼defaultValue</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums1) map.put(num, map.getOrDefault(num, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.getOrDefault(num, -<span class="number">1</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                map.put(num, map.get(num)-<span class="number">1</span>);</span><br><span class="line">                res[count++] = num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›æŒ‡å®šé•¿åº¦çš„æ–°æ•°ç»„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(res, count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†84.57% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†7.70% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šsetå‡½æ•°</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersection</span>(<span class="params">self, nums1: <span class="type">List</span>[<span class="built_in">int</span>], nums2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">    	<span class="comment">#setè½¬åŒ–æˆæ— é‡å¤å…ƒç´ çš„é›†åˆå–äº¤é›†</span></span><br><span class="line">        result = <span class="built_in">set</span>(nums1).intersection(<span class="built_in">set</span>(nums2))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(result)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:64 ms,å‡»è´¥äº†57.06% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†88.25% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">        Set&lt;Integer&gt; map = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[nums2.length];</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums1) map.add(num);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.contains(num))&#123;</span><br><span class="line">                res[count++] = num;</span><br><span class="line">                map.remove(num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›æŒ‡å®šé•¿åº¦çš„æ–°æ•°ç»„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(res, count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.86% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†58.09% çš„ç”¨æˆ·</p>
<p><strong>[ç¬¬350é¢˜]</strong>    ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚ </p>
<ul>
<li><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums1 = [1,2,2,1], nums2 = [2,2]<br>è¾“å‡ºï¼š[2]</p>
</li>
<li><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums1 = [4,9,5], nums2 = [9,4,9,8,4]<br>è¾“å‡ºï¼š[9,4] </p>
</li>
</ul>
<p>è¯´æ˜ï¼š<strong>è¾“å‡ºç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°çš„æœ€å°å€¼ä¸€è‡´ã€‚</strong>æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersect</span>(<span class="params">self, nums1: <span class="type">List</span>[<span class="built_in">int</span>], nums2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        key = &#123;&#125;</span><br><span class="line">        result = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> nums1:</span><br><span class="line">            <span class="comment">#éå†nums1ï¼Œåˆå§‹åŒ–å­—å…¸key</span></span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">                key[v] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                key[v] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> nums2:</span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">in</span> key:</span><br><span class="line">                <span class="comment">#å¦‚æœå…ƒç´ ç›¸åŒï¼Œå°†å…¶å­˜å…¥resultä¸­ï¼Œå¹¶å°†å‡ºç°æ¬¡æ•°å‡1</span></span><br><span class="line">                <span class="keyword">if</span> key[v] &gt; <span class="number">0</span>:</span><br><span class="line">                    key[v] -= <span class="number">1</span></span><br><span class="line">                    result.append(v)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†97.73% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†36.24% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intersect(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[nums2.length];</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums1) map.put(num,map.getOrDefault(num,<span class="number">0</span>) + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.getOrDefault(num, -<span class="number">1</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                res[count++] = num ;</span><br><span class="line">                map.put(num,map.get(num) -<span class="number">1</span>) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›æŒ‡å®šé•¿åº¦çš„æ–°æ•°ç»„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(res, count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†73.45% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†16.45% çš„ç”¨æˆ·</p>
<p><strong>[é¢˜ç›®è¿›é˜¶]</strong>   å¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿå‡å¦‚ä¸¤ä¸ªæ•°ç»„éƒ½æ˜¯æœ‰åºçš„ï¼Œåˆ†åˆ«ä¸ºï¼šarr1 = [1,2,3,4,4,13]ï¼Œarr2 = [1,2,3,9,10]</p>
<blockquote>
<p>å¯¹äºä¸¤ä¸ªå·²ç»æ’åºå¥½æ•°ç»„çš„é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨åŒæŒ‡é’ˆçš„è§£æ³•</p>
<p>è®¾å®šä¸¤ä¸ªä¸º0çš„æŒ‡é’ˆï¼Œæ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆçš„å…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœæŒ‡é’ˆçš„å…ƒç´ ç›¸ç­‰ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªæŒ‡é’ˆä¸€èµ·<br>å‘åç§»åŠ¨ï¼Œå¹¶ä¸”å°†ç›¸ç­‰çš„å…ƒç´ æ”¾å…¥ç©ºç™½æ•°ç»„ã€‚</p>
<p>å¦‚æœä¸¤ä¸ªæŒ‡é’ˆçš„å…ƒç´ ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å°†å°çš„å…ƒç´ çš„æŒ‡é’ˆåç§»ã€‚ç»§ç»­è¿›è¡Œåˆ¤æ–­ã€‚</p>
<p>åå¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´åˆ°ä»»æ„ä¸€ä¸ªæ•°ç»„ç»ˆæ­¢ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersect</span>(<span class="params">self, nums1: <span class="type">List</span>[<span class="built_in">int</span>], nums2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        nums1.sort()</span><br><span class="line">        nums2.sort()</span><br><span class="line">        result = []</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(nums1) <span class="keyword">and</span> j &lt; <span class="built_in">len</span>(nums2):</span><br><span class="line">            <span class="keyword">if</span> nums1[i] == nums2[j]:</span><br><span class="line">                result.append(nums1[i])</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> nums1[i] &lt; nums2[j]:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:68 ms,å‡»è´¥äº†46.68% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†44.53% çš„Python3ç”¨æˆ·</p>
<h3 id="2-æœ€é•¿å…¬å…±å‰ç¼€"><a href="#2-æœ€é•¿å…¬å…±å‰ç¼€" class="headerlink" title="2.æœ€é•¿å…¬å…±å‰ç¼€"></a>2.æœ€é•¿å…¬å…±å‰ç¼€</h3><blockquote>
<p>æˆ‘ä»¬è¦æƒ³å¯»æ‰¾æœ€é•¿å…¬å…±å‰ç¼€ï¼Œé‚£ä¹ˆé¦–å…ˆè¿™ä¸ªå‰ç¼€æ˜¯å…¬å…±çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»»æ„ä¸€ä¸ªå…ƒç´ ä¸­æ‰¾åˆ°å®ƒã€‚<br>å‡å®šæˆ‘ä»¬ç°åœ¨å°±ä»ä¸€ä¸ªæ•°ç»„ä¸­å¯»æ‰¾æœ€é•¿å…¬å…±å‰ç¼€ï¼Œé‚£ä¹ˆé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¬¬ä¸€ä¸ªå…ƒç´ è®¾ç½®ä¸ºåŸºå‡†<br>å…ƒç´ x0ã€‚å‡å¦‚æ•°ç»„ä¸º[â€œflowâ€,â€flowerâ€,â€flightâ€]ï¼Œflowå°±æ˜¯æˆ‘ä»¬çš„åŸºå‡†å…ƒç´ x0ã€‚</p>
<p>ç„¶åæˆ‘ä»¬åªéœ€è¦ä¾æ¬¡å°†åŸºå‡†å…ƒç´ å’Œåé¢çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼ˆå‡å®šåé¢çš„å…ƒç´ ä¾æ¬¡ä¸ºx1,x2,x3â€¦.ï¼‰ï¼Œä¸æ–­æ›´<br>æ–°åŸºå‡†å…ƒç´ ï¼Œç›´åˆ°åŸºå‡†å…ƒç´ å’Œæ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³æœ€é•¿å…¬å…±å‰ç¼€çš„æ¡ä»¶ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p>
<p>å…·ä½“æ¯”å¯¹è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>å¦‚æœstrings.Index(x1,x) == 0ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼ˆå› ä¸ºæ­¤æ—¶xå°±æ˜¯x1çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼‰ï¼Œå¯¹æ¯”ä¸‹ä¸€ä¸ªå…ƒ<br>ç´ ã€‚ï¼ˆå¦‚flowerå’Œflowè¿›è¡Œæ¯”è¾ƒï¼‰</p>
<p>å¦‚æœstrings.Index(x1,x) != 0, åˆ™æˆªå–æ‰åŸºå‡†å…ƒç´ xçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå†æ¬¡å’Œx1è¿›è¡Œæ¯”è¾ƒï¼Œç›´è‡³æ»¡è¶³<br>string.Index(x1,x) == 0ï¼Œæ­¤æ—¶æˆªå–åçš„xä¸ºxå’Œx1çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚ï¼ˆå¦‚flightå’Œflowè¿›è¡Œæ¯”è¾ƒï¼Œä¾<br>æ¬¡æˆªå–å‡ºflow-flo-flï¼Œç›´åˆ°flè¢«æˆªå–å‡ºï¼Œæ­¤æ—¶flä¸ºflightå’Œflowçš„æœ€é•¿å…¬å…±å‰ç¼€ï¼‰</p>
</blockquote>
<p><strong>[ç¬¬14é¢˜]</strong>   ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚ å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚ </p>
<ul>
<li><p>ç¤ºä¾‹ 1:<br>è¾“å…¥: [â€œflowerâ€,â€flowâ€,â€flightâ€]<br>è¾“å‡º: â€œflâ€</p>
</li>
<li><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: [â€œdogâ€,â€racecarâ€,â€carâ€]<br>è¾“å‡º: â€œâ€<br>è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚</p>
</li>
</ul>
<p>è¯´æ˜: æ‰€æœ‰è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ a-z ã€‚ </p>
<p><strong>æ–¹æ³•ä¸€ï¼šæ¯”å¯¹åŸºå‡†å…ƒç´ </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span>(<span class="params">self, strs: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(strs) &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#åŸºå‡†å…ƒç´ </span></span><br><span class="line">            result = strs[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#åŸºå‡†å…ƒç´ å’Œåé¢çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> strs[<span class="number">1</span>:]:</span><br><span class="line">            <span class="comment"># find:åœ¨[beg, end]èŒƒå›´å†…æŸ¥æ‰¾substringï¼Œæ‰¾åˆ°è¿”å›substrçš„èµ·å§‹ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å›-1ã€‚</span></span><br><span class="line">            <span class="comment"># å‰ç¼€èµ·å§‹åæ ‡å¿…é¡»ä¸º0å¼€å§‹ï¼Œä¸­é—´ä¸ç®—</span></span><br><span class="line">            <span class="keyword">while</span> k.find(result) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(result) == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment">#è°ƒæ•´åŸºå‡†å…ƒç´ </span></span><br><span class="line">                    result = result[:-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†98.27% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†56.76% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestCommonPrefix</span><span class="params">(String[] strs)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®åŸºå‡†å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span>(strs.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        String res = strs[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//ä¸åç»­å­—ç¬¦ä¸²æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;strs.length; i++)&#123;</span><br><span class="line">            <span class="comment">//è‹¥ä¸åŒ…å«ï¼Œåˆ™ç¼©å°èŒƒå›´</span></span><br><span class="line">             <span class="keyword">while</span>(!strs[i].startsWith(res))&#123;</span><br><span class="line">                <span class="keyword">if</span>(res.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                res = res.substring(<span class="number">0</span>, res.length()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†30.89% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šåˆ©ç”¨ASCIIç </strong></p>
<blockquote>
<p>åˆ©ç”¨pythonçš„max()å’Œmin()ï¼Œåœ¨Pythoné‡Œå­—ç¬¦ä¸²æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼ŒæŒ‰ç…§ascIIå€¼æ’ï¼Œä¸¾ä¾‹abbï¼Œ abaï¼Œabacï¼Œæœ€å¤§ä¸ºabbï¼Œæœ€å°ä¸ºabaã€‚æ‰€ä»¥åªéœ€è¦æ¯”è¾ƒæœ€å¤§æœ€å°çš„å…¬å…±å‰ç¼€å°±æ˜¯æ•´ä¸ªæ•°ç»„çš„å…¬å…±å‰ç¼€</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span>(<span class="params">self, strs: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> strs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        s1 = <span class="built_in">min</span>(strs)</span><br><span class="line">        s2 = <span class="built_in">max</span>(strs)</span><br><span class="line">        <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(s1):</span><br><span class="line">            <span class="keyword">if</span> x != s2[i]:</span><br><span class="line">                <span class="keyword">return</span> s2[:i]</span><br><span class="line">        <span class="keyword">return</span> s1</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†61.62% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†85.07% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestCommonPrefix</span><span class="params">(String[] strs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(strs.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        String min = strs[<span class="number">0</span>];</span><br><span class="line">        String max = strs[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(String s: strs)&#123;</span><br><span class="line">            <span class="comment">//è‹¥å­—ç¬¦ä¸²ç­‰äºå‚æ•°å­—ç¬¦ä¸²ã€åˆ™è¿”å›0ï¼Œå­—ç¬¦ä¸²å°äºå‚æ•°å­—ç¬¦ä¸²ã€åˆ™è¿”å›å€¼å°äº0ï¼Œå­—ç¬¦ä¸²å¤§äºå‚æ•°å­—ç¬¦ä¸²ã€è¿”å›å€¼å¤§äº0ã€‚</span></span><br><span class="line">            <span class="keyword">if</span>(s.compareTo(max) &gt; <span class="number">0</span>) max = s;</span><br><span class="line">            <span class="keyword">if</span>(s.compareTo(min) &lt; <span class="number">0</span>) min = s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;min.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(min.charAt(i) != max.charAt(i)) <span class="keyword">return</span> min.substring(<span class="number">0</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†85.32% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†20.75% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼šåˆ©ç”¨zipå‡½æ•°</strong></p>
<blockquote>
<p>åˆ©ç”¨pythonçš„zipå‡½æ•°ï¼ŒæŠŠstrçœ‹æˆlistç„¶åæŠŠè¾“å…¥çœ‹æˆäºŒç»´æ•°ç»„ï¼Œå·¦å¯¹é½çºµå‘å‹ç¼©ï¼Œç„¶åæŠŠæ¯é¡¹åˆ©ç”¨é›†åˆå»é‡ï¼Œä¹‹åéå†listä¸­æ‰¾åˆ°å…ƒç´ é•¿åº¦å¤§äº1ä¹‹å‰çš„å°±æ˜¯å…¬å…±å‰ç¼€</p>
<p>æ¯”å¦‚strs=[â€œflowâ€,â€flowerâ€,â€flightâ€]ï¼Œåˆ™zip(*strs)å°†ä¾æ¬¡å–å‡º[â€˜fâ€™,â€™fâ€™,â€™fâ€™]ã€[â€˜lâ€™,â€™lâ€™,â€™lâ€™]ã€â€¦â€¦ã€[â€˜â€™, â€˜râ€™,â€™tâ€™]ï¼Œé€šè¿‡setå»é‡ï¼Œåˆ™[â€˜fâ€™]ã€[â€˜lâ€™]ã€â€¦â€¦ã€[â€˜â€™, â€˜râ€™,â€™tâ€™]ï¼Œé•¿åº¦å¤§äº1ä¹‹å‰çš„å°±æ˜¯å…¬å…±å‰ç¼€</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span>(<span class="params">self, strs: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> strs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        ss = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">set</span>, <span class="built_in">zip</span>(*strs)))</span><br><span class="line">        res = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(ss):</span><br><span class="line">            x = <span class="built_in">list</span>(x)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(x) &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            res = res + x[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†81.85% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†50.03% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestCommonPrefix</span><span class="params">(String[] strs)</span> </span>&#123;</span><br><span class="line">        String res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        List&lt;Set&lt;Character&gt;&gt; ss = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> maxLength = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(String s: strs)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s.length() &gt; maxLength) maxLength = s.length();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;maxLength; i++)&#123;</span><br><span class="line">            Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(String s: strs)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i &lt; s.length()) set.add(s.charAt(i));</span><br><span class="line">                <span class="keyword">else</span> set.add(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ss.add(set);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Set&lt;Character&gt; set: ss)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.size() &gt; <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">char</span> s: set) res += s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š16 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.83% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.05% çš„ç”¨æˆ·</p>
<h3 id="3-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"><a href="#3-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" class="headerlink" title="3.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"></a>3.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</h3><p><strong>[ç¬¬122é¢˜]</strong>   ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥<strong>å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚ </strong></p>
<ul>
<li><p>ç¤ºä¾‹ 1: è¾“å…¥: [7,1,5,3,6,4]<br>è¾“å‡º: 7<br>è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-3 = 3 ã€‚</p>
</li>
<li><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: [1,2,3,4,5]<br>è¾“å‡º: 4<br>è§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚</p>
</li>
<li><p>ç¤ºä¾‹ 3:<br>è¾“å…¥: [7,6,4,3,1]<br>è¾“å‡º: 0<br>è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚ </p>
</li>
</ul>
<blockquote>
<p>1ã€ä¸èƒ½å‚ä¸å¤šç¬”äº¤æ˜“ã€‚æ¢å¥è¯è®²ï¼Œæˆ‘ä»¬åªèƒ½åœ¨æ‰‹ä¸Šæ²¡æœ‰è‚¡ç¥¨çš„æ—¶å€™ä¹°å…¥ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡º<br>å”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚åƒæˆ‘ä»¬å¹³æ—¶ä¹°è‚¡ç¥¨æ—¶çš„è¿½æ¶¨æ€è·Œæ˜¯ä¸å¯ä»¥çš„ã€‚</p>
<p>2ã€å°½å¯èƒ½åœ°å¤šè¿›è¡Œäº¤æ˜“ã€‚è¿™ä¸ªéå¸¸å¥½ç†è§£ã€‚åƒæ˜¯é»„é‡‘ï¼Œä¸€å¹´åŸºæœ¬ä¸Šéƒ½æœ‰2-3æ¬¡æ¶¨è·Œã€‚æˆ‘ä»¬åªè¦æŠŠæ¡ä½æœº<br>ä¼šï¼Œåœ¨æ¯ä¸€æ¬¡æ¶¨è·Œçš„æ—¶å€™ï¼Œä½ä»·å–å…¥é«˜ä»·å–å‡ºï¼Œå°±å¯ä»¥ä½¿åˆ©ç›Šè¾¾åˆ°æœ€å¤§åŒ–ã€‚è¿™ä¸ªæ¡ä»¶ä¹Ÿæ˜¯ç›¸å½“é‡è¦çš„ï¼Œ<br>å¦‚æœæˆ‘ä»¬æŠŠè¿™é‡Œå˜æˆï¼Œæœ€å¤šå®Œæˆä¸¤ç¬”äº¤æ˜“ï¼Œå°±å˜æˆå¦ä¸€é“é¢˜ã€‚</p>
<p>å‡è®¾ç»™å®šçš„æ•°ç»„ä¸ºï¼š[7, 1, 5, 3, 6, 4] æˆ‘ä»¬å°†å…¶ç»˜åˆ¶æˆæŠ˜çº¿å›¾ï¼Œï¼Œæˆ‘ä»¬è¦åœ¨æ»¡è¶³1å’Œ2çš„æ¡ä»¶ä¸‹è·å–æœ€å¤§åˆ©ç›Šï¼Œå…¶å®å°±æ˜¯å°½å¯èƒ½å¤šçš„ä½ä»·ä¹°å…¥é«˜ä»·å–å‡ºã€‚è€Œæ¯ä¸€æ¬¡ä¸Šå‡æ³¢æ®µï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡ä½ä»·ä¹°å…¥é«˜ä»·å–å‡ºã€‚è€Œæˆ‘ä»¬æ²¡æœ‰é™åˆ¶äº¤æ˜“æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æ±‚å‡ºæ‰€æœ‰çš„ä¸Šå‡æ³¢æ®µçš„å’Œã€‚å¦‚å›¾é‡Œå°±æ˜¯A+Bï¼Œä¹Ÿå°±æ˜¯ï¼ˆ5-1ï¼‰+ï¼ˆ6-3ï¼‰ = 7ï¼Œå°±æ˜¯æˆ‘ä»¬èƒ½è·å–åˆ°çš„æœ€å¤§åˆ©ç›Šã€‚</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/1.jpg" alt></p>
<p><strong>æ–¹æ³•ä¸€ï¼šè´ªå¿ƒç®—æ³•</strong></p>
<blockquote>
<p>åªè¦ä»Šå¤©ä»·æ ¼å°äºæ˜å¤©ä»·æ ¼å°±åœ¨ä»Šå¤©ä¹°å…¥ç„¶åæ˜å¤©å–å‡º</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span>(<span class="params">self, prices: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        profit = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(prices)-<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> prices[i] &lt; prices[i+<span class="number">1</span>]:</span><br><span class="line">                profit += (prices[i+<span class="number">1</span>] - prices[i])</span><br><span class="line">        <span class="keyword">return</span>  profit</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:84 ms,å‡»è´¥äº†53.70% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†38.34% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> profit=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;prices.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(prices[i]&lt;prices[i+<span class="number">1</span>]) profit+=(prices[i+<span class="number">1</span>]-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†99.57% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†79.49% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šDPåŠ¨æ€è§„åˆ’</strong></p>
<blockquote>
<p>ç¬¬iå¤©åªæœ‰ä¸¤ç§çŠ¶æ€ï¼Œä¸æŒæœ‰æˆ–æŒæœ‰è‚¡ç¥¨ï¼Œå½“å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„çŠ¶æ€å¯èƒ½æ¥è‡ªæ˜¨å¤©å–å‡ºæˆ–è€…æ˜¨å¤©ä¹Ÿä¸æŒæœ‰ï¼ŒåŒç†ï¼Œå½“å¤©æŒæœ‰è‚¡ç¥¨çš„çŠ¶æ€å¯èƒ½æ¥è‡ªæ˜¨å¤©ä¹°å…¥æˆ–è€…æ˜¨å¤©ä¹ŸæŒæœ‰ä¸­ï¼Œå–æœ€åä¸€å¤©çš„ä¸æŒæœ‰è‚¡ç¥¨çŠ¶æ€å°±æ˜¯é—®é¢˜çš„è§£</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span>(<span class="params">self, prices: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(prices) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [[<span class="number">0</span>]*<span class="number">2</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(prices))]</span><br><span class="line">        <span class="comment"># dp[i][0]è¡¨ç¤ºç¬¬iå¤©ä¸æŒæœ‰è‚¡ç¥¨, dp[i][1]è¡¨ç¤ºç¬¬iå¤©æŒæœ‰è‚¡ç¥¨</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = -prices[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(prices)):</span><br><span class="line">            <span class="comment">#ä¸æŒæœ‰è‚¡ç¥¨åˆ†ä¸ºï¼š1.1ä¸€ç›´éƒ½ä¸ä¹°å…¥ä»æ˜¯æ˜¨å¤©çš„æœªæŒæœ‰ 2.ä»Šå¤©å–å‡ºï¼Œå³æ˜¨å¤©åŠ ä»Šå¤©å–å‡ºçš„é’±</span></span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="built_in">max</span>(dp[i-<span class="number">1</span>][<span class="number">0</span>], dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i])</span><br><span class="line">            <span class="comment">#æŒæœ‰è‚¡ç¥¨åˆ†ä¸ºï¼š1.æ˜¨å¤©æ²¡æœ‰æŒæœ‰ï¼Œä»Šå¤©ä¹°å…¥ 2.æ˜¨å¤©å·²ä¹°å…¥ä¸€ç›´æŒæœ‰ç€</span></span><br><span class="line">            dp[i][<span class="number">1</span>] = <span class="built_in">max</span>(dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i], dp[i-<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span>  dp[-<span class="number">1</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:136 ms,å‡»è´¥äº†5.26% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16.4 MB,å‡»è´¥äº†5.02% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[prices.length][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = -prices[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt; prices.length; i++)&#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>], dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]); </span><br><span class="line">            dp[i][<span class="number">1</span>] = Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>], dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[prices.length-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†19.71% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†91.41% çš„ç”¨æˆ·</p>
<h3 id="4-æ—‹è½¬æ•°ç»„"><a href="#4-æ—‹è½¬æ•°ç»„" class="headerlink" title="4.æ—‹è½¬æ•°ç»„"></a>4.æ—‹è½¬æ•°ç»„</h3><p><strong>[ç¬¬189é¢˜]</strong>   ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: [1,2,3,4,5,6,7] å’Œ k = 3<br>è¾“å‡º: [5,6,7,1,2,3,4]<br>è§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: [7,1,2,3,4,5,6]ï¼Œå‘å³æ—‹è½¬ 2 æ­¥: [6,7,1,2,3,4,5]ï¼Œå‘å³æ—‹è½¬ 3 æ­¥: [5,6,7,1,2,3,4]</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: [-1,-100,3,99] å’Œ k = 2<br>è¾“å‡º: [3,99,-1,-100]<br>è§£é‡Š: å‘å³æ—‹è½¬ 1 æ­¥: [99,-1,-100,3]ï¼Œå‘å³æ—‹è½¬ 2 æ­¥: [3,99,-1,-100] </li>
</ul>
<p>è¯´æ˜: å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ <strong>è¦æ±‚ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„åŸåœ°ç®—æ³•ã€‚</strong> </p>
<blockquote>
<p>è¿™ä¸ªæ–¹æ³•åŸºäºè¿™ä¸ªäº‹å®ï¼šè‹¥æˆ‘ä»¬éœ€è¦å°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œ é‚£ä¹ˆ k%l (lä¸ºæ•°ç»„é•¿<br>åº¦) çš„å°¾éƒ¨å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°å¤´éƒ¨ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¼šè¢«å‘åç§»åŠ¨ã€‚</p>
<p>é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‰€æœ‰å…ƒç´ åè½¬ï¼Œç„¶ååè½¬å‰ k ä¸ªå…ƒç´ ï¼Œå†åè½¬åé¢l-kä¸ªå…ƒç´ ï¼Œå°±èƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/2.jpg" alt></p>
<p><strong>æ–¹æ³•ä¸€ï¼šç¿»è½¬ä¸‰æ¬¡</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        k %= n</span><br><span class="line">        <span class="comment"># å®šä¹‰åè½¬å‡½æ•°</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">switch</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">while</span> (a&lt;b):    <span class="comment"># ä»ä¸¤å¤´å¾€ä¸­é—´äº¤æ¢</span></span><br><span class="line">                nums[a], nums[b] = nums[b], nums[a]</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">                b -= <span class="number">1</span></span><br><span class="line">        <span class="comment"># ä¸‰æ¬¡åè½¬</span></span><br><span class="line">        switch(<span class="number">0</span>, n-<span class="number">1</span>)  <span class="comment"># åè½¬æ•´ä½“</span></span><br><span class="line">        switch(<span class="number">0</span>, k-<span class="number">1</span>)    <span class="comment"># åè½¬å‰kä¸ªå…ƒç´ </span></span><br><span class="line">        switch(k, n-<span class="number">1</span>)    <span class="comment"># åè½¬åé¢å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†94.96% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†76.57% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        k = k % nums.length;</span><br><span class="line">        reverse(nums, <span class="number">0</span>, nums.length-<span class="number">1</span>);</span><br><span class="line">        reverse(nums, <span class="number">0</span>, k-<span class="number">1</span>);</span><br><span class="line">        reverse(nums, k, nums.length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = nums[start];</span><br><span class="line">                nums[start] = nums[end];</span><br><span class="line">                nums[end] = tmp;</span><br><span class="line">                start++;</span><br><span class="line">                end--;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†45.62% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šåˆ©ç”¨åˆ‡ç‰‡ç¿»è½¬</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        k = k % <span class="built_in">len</span>(nums)</span><br><span class="line">        nums.reverse()</span><br><span class="line">        nums[:k] = <span class="built_in">reversed</span>(nums[:k])</span><br><span class="line">        nums[k:] = <span class="built_in">reversed</span>(nums[k:])</span><br><span class="line">        <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†85.56% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†27.15% çš„Python3ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼šåˆ©ç”¨åˆ‡ç‰‡ç§»ä½ï¼ˆä¸è€ƒè™‘åŸåœ°ç®—æ³•ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        k = k % <span class="built_in">len</span>(nums)</span><br><span class="line">        nums[:] = nums[-k:] + nums[:-k]</span><br><span class="line">        <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†85.56% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†44.31% çš„Python3ç”¨æˆ·</p>
<h3 id="5-åŸåœ°åˆ é™¤"><a href="#5-åŸåœ°åˆ é™¤" class="headerlink" title="5.åŸåœ°åˆ é™¤"></a>5.åŸåœ°åˆ é™¤</h3><p><strong>[ç¬¬27é¢˜]</strong>   ç»™ä½ ä¸€ä¸ªæ•°ç»„numså’Œä¸€ä¸ªå€¼valï¼Œä½ éœ€è¦åŸåœ°ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äºvalçš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ <strong>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚</strong> å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>ç»™å®š nums = [3,2,2,3], val = 3, å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚<br>ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</li>
<li>ç¤ºä¾‹ 2:<br>ç»™å®š nums = [0,1,2,2,3,0,4,2], val = 2,å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚<br>æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeElement</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], val: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># åº”ä½¿ç”¨é€†åº</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯æ­£åºçš„è¯ï¼Œåˆ é™¤ä¸€ä¸ªç´¢å¼•æ‰€å¯¹åº”çš„å€¼å</span></span><br><span class="line">        <span class="comment"># pythonä¼šè‡ªåŠ¨å§åˆ é™¤çš„ä½ç½®è¡¥ä¸Šæ¥</span></span><br><span class="line">        <span class="comment"># è¿™æ ·å°±ä¼šå¯¼è‡´ä»åˆ é™¤ä½ä½ç½®åˆ°æœ€åä¸€ä½çš„ç´¢å¼•å’ŒåŸç´¢å¼•ç›¸å·®1ä¸ª</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] == val:</span><br><span class="line">                <span class="keyword">del</span> nums[i]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†72.46% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†33.88% çš„Python3ç”¨æˆ·</p>
<blockquote>
<p>å› ä¸ºé¢˜ç›®è¯´äº†ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸éœ€è¦çœŸçš„ç§»é™¤ï¼Œåªè¦å°†å…¶å€¼è¦†ç›–å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=val)&#123;</span><br><span class="line">                nums[count]=nums[i];</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†8.49% çš„ç”¨æˆ·</p>
<p><strong>[ç¬¬26é¢˜]</strong>   ç»™å®šä¸€ä¸ª<strong>æ’åºæ•°ç»„</strong>ï¼Œä½ éœ€è¦åœ¨åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚<strong>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</strong></p>
<ul>
<li>ç¤ºä¾‹ 1:<br>ç»™å®šæ•°ç»„ nums = [1,1,2], å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2ã€‚ ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ </li>
<li>ç¤ºä¾‹ 2:<br>ç»™å®š nums = [0,0,1,1,1,2,2,3,3,4],å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸”åŸæ•°ç»„numsçš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4ã€‚<br>ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</li>
</ul>
<blockquote>
<p>è¿™é“é¢˜çš„é‡ç‚¹æ˜¯åŸåœ°ä¸¤ä¸ªå­—ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚å¿…é¡»åœ¨ O(1) çš„ç©ºé—´ä¸‹å®Œæˆã€‚å¹¶ä¸”é¢˜ä¸­å·²ç»å‘ŠçŸ¥äº†æ•°ç»„ä¸ºæœ‰åºæ•°ç»„ï¼Œè¿™æ ·é‡å¤çš„å…ƒç´ ä¸€å®šæ˜¯è¿åœ¨ä¸€èµ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªä¸€ä¸ªç§»é™¤é‡å¤çš„å…ƒç´ å³å¯</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼šå¾ªç¯ç§»é™¤</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] == nums[i-<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">del</span> nums[i]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†88.67% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.2 MB,å‡»è´¥äº†96.20% çš„Python3ç”¨æˆ·</p>
<blockquote>
<p>ä¸27é¢˜åŒç†</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; nums.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=nums[i+<span class="number">1</span>]) nums[++count] = nums[i+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ++count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†80.44% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š40.4 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†19.16% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šsetå‡½æ•°ï¼ˆä¸è€ƒè™‘åŸåœ°ç®—æ³•ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        nums[:] = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(nums)))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†99.68% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.4 MB,å‡»è´¥äº†64.71% çš„Python3ç”¨æˆ·</p>
<h3 id="6-åŠ ä¸€"><a href="#6-åŠ ä¸€" class="headerlink" title="6.åŠ ä¸€"></a>6.åŠ ä¸€</h3><p><strong>[ç¬¬66é¢˜]</strong>   ç»™å®šä¸€ä¸ªç”±æ•´æ•°ç»„æˆçš„éç©ºæ•°ç»„æ‰€è¡¨ç¤ºçš„éè´Ÿæ•´æ•°ï¼Œåœ¨è¯¥æ•°çš„åŸºç¡€ä¸ŠåŠ ä¸€ã€‚æœ€é«˜ä½æ•°å­—å­˜æ”¾åœ¨æ•°ç»„çš„é¦–ä½ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åªå­˜å‚¨å•ä¸ªæ•°å­—ã€‚ ä½ å¯ä»¥å‡è®¾é™¤äº†æ•´æ•° 0 ä¹‹å¤–ï¼Œè¿™ä¸ªæ•´æ•°ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚ </p>
<ul>
<li><p>ç¤ºä¾‹ 1:<br>è¾“å…¥: [1,2,3]<br>è¾“å‡º: [1,2,4]<br>è§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 123ã€‚</p>
</li>
<li><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: [4,3,2,1]<br>è¾“å‡º: [4,3,2,2]<br>è§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 4321ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ ¹æ®é¢˜ç›®ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸€ï¼æ²¡é”™ï¼ŒåŠ ä¸€å¾ˆé‡è¦ã€‚å› ä¸ºå®ƒåªæ˜¯åŠ ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šè€ƒè™‘åˆ°ä¸¤ç§æƒ…å†µï¼š</p>
<p>æ™®é€šæƒ…å†µï¼Œé™¤9ä¹‹å¤–çš„æ•°å­—åŠ 1ã€‚<br>ç‰¹æ®Šæƒ…å†µï¼Œ9åŠ 1ã€‚ï¼ˆå› ä¸º9åŠ 1éœ€è¦è¿›ä½ï¼‰</p>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ¨¡æ‹Ÿè¿™ä¸¤ç§è¿ç®—ï¼Œå°±å¯ä»¥é¡ºåˆ©è¿›è¡Œæ±‚è§£ï¼</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿè¿ç®—</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plusOne</span>(<span class="params">self, digits: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        addon = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(digits)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            digits[i] += addon</span><br><span class="line">            <span class="comment"># å°†è¿›ä½å½’0</span></span><br><span class="line">            addon = <span class="number">0</span></span><br><span class="line">            <span class="comment"># ä¸ªä½åŠ 1</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="built_in">len</span>(digits) - <span class="number">1</span>:</span><br><span class="line">                digits[i] += <span class="number">1</span></span><br><span class="line">            <span class="comment"># é€¢åè¿›ä¸€</span></span><br><span class="line">            <span class="keyword">if</span> digits[i] == <span class="number">10</span>:</span><br><span class="line">                addon = <span class="number">1</span></span><br><span class="line">                digits[i] = <span class="number">0</span></span><br><span class="line">        <span class="comment">#ç±»ä¼¼99ï¼Œæˆ–è€…999ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ‰©å……æ•°ç»„</span></span><br><span class="line">        <span class="keyword">if</span> addon == <span class="number">1</span>:</span><br><span class="line">            digits.insert(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> digits</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†70.94% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†46.46% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] plusOne(<span class="keyword">int</span>[] digits) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[digits.length+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> addon = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=digits.length-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==digits.length-<span class="number">1</span>) digits[i]++;</span><br><span class="line">            res[i+<span class="number">1</span>] = digits[i] + addon;</span><br><span class="line">            addon = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(res[i+<span class="number">1</span>]==<span class="number">10</span>)&#123;</span><br><span class="line">                addon = <span class="number">1</span>;</span><br><span class="line">                res[i+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(addon==<span class="number">1</span>) res[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> addon==<span class="number">1</span>?res: Arrays.copyOfRange(res, <span class="number">1</span>, res.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†29.28% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šåˆ©ç”¨Pythonç‰¹æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plusOne</span>(<span class="params">self, digits: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        <span class="comment"># æ•´å½¢è½¬å­—ç¬¦</span></span><br><span class="line">        digits = [<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> digits]</span><br><span class="line">        <span class="comment"># æ‹¼æ¥å­—ç¬¦è½¬æ•°å­—</span></span><br><span class="line">        digits = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(digits))</span><br><span class="line">        <span class="comment"># åŠ 1</span></span><br><span class="line">        digits += <span class="number">1</span></span><br><span class="line">        <span class="comment"># æ•°å­—è½¬åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">str</span>(digits)))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:48 ms,å‡»è´¥äº†18.72% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†33.38% çš„Python3ç”¨æˆ·</p>
<h3 id="7-ä¸¤æ•°ä¹‹å’Œ"><a href="#7-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="7.ä¸¤æ•°ä¹‹å’Œ"></a>7.ä¸¤æ•°ä¹‹å’Œ</h3><p><strong>[ç¬¬1é¢˜]</strong>   ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„numså’Œä¸€ä¸ªç›®æ ‡å€¼targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ä¸¤ä¸ªæ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>ç»™å®š nums = [2, 7, 11, 15], target = 9<br>å› ä¸º nums[0] + nums[1] = 2 + 7 = 9<br>æ‰€ä»¥è¿”å› [0, 1]</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•</strong></p>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬æ‹¿åˆ°é¢˜ç›®ä¸€çœ‹ï¼Œé©¬ä¸Šå¯ä»¥æƒ³åˆ°æš´åŠ›é¢˜è§£ã€‚æˆ‘ä»¬åªéœ€è¦ â€œéå†æ¯ä¸ªå…ƒç´  xï¼Œå¹¶æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå€¼ä¸ target - x ç›¸ç­‰çš„ç›®æ ‡å…ƒç´ ã€‚â€</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="keyword">if</span> target-nums[i] <span class="keyword">in</span> nums[i+<span class="number">1</span>:]:</span><br><span class="line">                <span class="keyword">return</span> i, nums[i+<span class="number">1</span>:].index(target-nums[i])+i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:964 ms,å‡»è´¥äº†38.87% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.1 MB,å‡»è´¥äº†85.75% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; nums.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = target - nums[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j &lt; nums.length; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[j]==tmp) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;i, j&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†44.60% çš„ç”¨æˆ·</p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°è¯¥ç§è§£é¢˜æ–¹å¼çš„æ—¶é—´å¤æ‚åº¦è¿‡é«˜ï¼Œè¾¾åˆ°äº†O(nÂ²)ã€‚ä¸ºäº†å¯¹è¿è¡Œæ—¶é—´å¤æ‚åº¦è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹æ³•æ¥æ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ç”¨å“ˆå¸Œè¡¨çš„æ–¹å¼ï¼Œé€šè¿‡ä»¥ç©ºé—´æ¢å–æ—¶é—´çš„æ–¹å¼æ¥è¿›è¡Œã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•äºŒï¼šå“ˆå¸Œè¡¨</strong></p>
<blockquote>
<p>é¦–å…ˆå…ˆéå†æ•°ç»„numsï¼Œi ä¸ºå½“å‰ä¸‹æ ‡ã€‚å°†æ¯ä¸€ä¸ªéå†çš„å€¼æ”¾å…¥å­—å…¸ä¸­ä½œä¸ºkeyã€‚</p>
<p>åŒæ—¶ï¼Œå¯¹æ¯ä¸ªå€¼éƒ½åˆ¤æ–­å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨target-nums[i]çš„keyå€¼ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        hashmap = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> index, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">            another_num = target - num</span><br><span class="line">            <span class="keyword">if</span> another_num <span class="keyword">in</span> hashmap:</span><br><span class="line">                <span class="keyword">return</span> [hashmap[another_num], index]</span><br><span class="line">            hashmap[num] = index</span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†91.51% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.6 MB,å‡»è´¥äº†37.49% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(target-nums[i])) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;map.get(target-nums[i]), i&#125;;</span><br><span class="line">            map.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†34.68% çš„ç”¨æˆ·</p>
<h3 id="8-ä¸‰æ•°ä¹‹å’Œ"><a href="#8-ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="8.ä¸‰æ•°ä¹‹å’Œ"></a>8.ä¸‰æ•°ä¹‹å’Œ</h3><p><strong>[ç¬¬15é¢˜]</strong> ç»™ä½ ä¸€ä¸ªåŒ…å«nä¸ªæ•´æ•°çš„æ•°ç»„numsï¼Œåˆ¤æ–­numsä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚ æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>ç»™å®šæ•°ç»„ nums = [-1, 0, 1, 2, -1, -4]ï¼Œ<br>æ»¡è¶³è¦æ±‚çš„ä¸‰å…ƒç»„é›†åˆä¸ºï¼š<br>[<br> [-1, 0, 1],<br> [-1, -1, 2]<br>]</li>
</ul>
<blockquote>
<p>æœ¬é¢˜çš„æš´åŠ›é¢˜è§£å¯ä»¥ä»¿ç…§äºŒæ•°ä¹‹å’Œï¼Œç›´æ¥ä¸‰å±‚éå†ï¼Œå–å’Œä¸º0çš„ä¸‰å…ƒç»„ï¼Œå¹¶è®°å½•ä¸‹æ¥ï¼Œæœ€åå†å»é‡ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªæœ‰æ™ºæ…§çš„äººï¼Œæˆ‘ä»¬ä¸èƒ½è¿™ä¹ˆå»åšã€‚</p>
<p>å‡è‹¥æˆ‘ä»¬çš„æ•°ç»„ä¸ºï¼š[-1, 0, 1, 2, -1, -4]<br>é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠæ•°ç»„æ’ä¸ªåºï¼Œå› ä¸ºæˆ‘ä»¬è¦åŒæ—¶æ‰¾ä¸‰ä¸ªæ•°ï¼Œæ‰€ä»¥<strong>é‡‡å–å›ºå®šä¸€ä¸ªæ•°ï¼ŒåŒæ—¶ç”¨åŒæŒ‡é’ˆæ¥æŸ¥æ‰¾å¦å¤–ä¸¤ä¸ªæ•°çš„æ–¹å¼ã€‚</strong>æ‰€ä»¥åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©å›ºå®šç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå½“ç„¶ï¼Œè¿™ä¸€è½®èµ°å®Œäº†ï¼Œè¿™ä¸ªè“æ¡†æ¡†æˆ‘ä»¬å°±è¦ä¹Ÿå¾€å‰ç§»åŠ¨ï¼‰ï¼ŒåŒæ—¶å°†ä¸‹ä¸€ä¸ªå…ƒç´ å’Œæœ«å°¾å…ƒç´ åˆ†åˆ«è®¾ä¸Š left å’Œ right æŒ‡é’ˆã€‚ç”»å‡ºå›¾æ¥å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/37.png" alt><br>å› ä¸ºæˆ‘ä»¬å·²ç»æ’å¥½äº†åºï¼Œå¦‚æœ<strong>å›ºå®šä¸‹æ¥çš„æ•°ï¼ˆä¸Šé¢è“è‰²æ¡†æ¡†ï¼‰æœ¬èº«å°±å¤§äº 0ï¼Œé‚£ä¸‰æ•°ä¹‹å’Œå¿…ç„¶æ— æ³•ç­‰äº 0ã€‚</strong><br>ç°åœ¨æˆ‘ä»¬çš„æ’åºå°±å‘æŒ¥å‡ºç”¨å¤„äº†ï¼Œ<strong>å¦‚æœå’Œå¤§äº0ï¼Œé‚£å°±è¯´æ˜ right çš„å€¼å¤ªå¤§ï¼Œéœ€è¦å·¦ç§»ã€‚å¦‚æœå’Œå°äº0ï¼Œé‚£å°±è¯´æ˜ left çš„å€¼å¤ªå°ï¼Œéœ€è¦å³ç§»ã€‚</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/38.png" alt><br>å…¶ä¸­ï¼šåœ¨ç¬¬6è¡Œæ—¶ï¼Œå› ä¸ºä¸‰æ•°ä¹‹å’Œå¤§äº0ï¼Œæ‰€ä»¥rightè¿›è¡Œäº†å·¦ç§»ã€‚æœ€åä¸€è¡Œï¼Œè·³è¿‡äº†é‡å¤çš„-1ã€‚<br><strong>é™¤äº†å›ºå®šä¸‹æ¥çš„iå€¼ï¼ˆè“æ¡†æ¡†ï¼‰ï¼Œleft å’Œ right å½“ç„¶ä¹Ÿæ˜¯éœ€è¦å¤„ç†é‡å¤çš„æƒ…å†µã€‚</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="comment"># è¿›è¡Œæ’åº</span></span><br><span class="line">        nums.sort()</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="comment"># å›ºå®šå€¼å¤§äº0é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># è¿‡æ»¤å›ºå®šå€¼é‡å¤</span></span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> nums[i] == nums[i - <span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># å·¦æŒ‡é’ˆ</span></span><br><span class="line">            L = i + <span class="number">1</span></span><br><span class="line">            <span class="comment"># å³æŒ‡é’ˆ</span></span><br><span class="line">            R = <span class="built_in">len</span>(nums) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> L &lt; R:</span><br><span class="line">                <span class="comment"># æ»¡è¶³æ¡ä»¶æ·»åŠ res</span></span><br><span class="line">                <span class="keyword">if</span> nums[i] + nums[L] + nums[R] == <span class="number">0</span>:</span><br><span class="line">                    res.append([nums[i], nums[L], nums[R]])</span><br><span class="line">                    <span class="comment">#æ»¡è¶³æ¡ä»¶åï¼Œç§»åŠ¨åŒæŒ‡é’ˆï¼Œè·³è¿‡é‡å¤çš„</span></span><br><span class="line">                    <span class="keyword">while</span> L &lt; R <span class="keyword">and</span> nums[L] == nums[L + <span class="number">1</span>]:</span><br><span class="line">                        L = L + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> L &lt; R <span class="keyword">and</span> nums[R] == nums[R - <span class="number">1</span>]:</span><br><span class="line">                        R = R - <span class="number">1</span></span><br><span class="line">                    L = L + <span class="number">1</span></span><br><span class="line">                    R = R - <span class="number">1</span></span><br><span class="line">                <span class="comment"># ä¸‰æ•°ä¹‹å’Œå¤§äº0,å³æŒ‡é’ˆå·¦ç§»</span></span><br><span class="line">                <span class="keyword">elif</span> nums[i] + nums[L] + nums[R] &gt; <span class="number">0</span>:</span><br><span class="line">                    R = R - <span class="number">1</span></span><br><span class="line">                <span class="comment"># ä¸‰æ•°ä¹‹å’Œå°äº0,å·¦æŒ‡é’ˆå³ç§»</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    L = L + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:836 ms,å‡»è´¥äº†79.07% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16 MB,å‡»è´¥äº†43.03% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; threeSum(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nums.length-<span class="number">2</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> l = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> r = nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] + nums[l] + nums[r] == <span class="number">0</span>)&#123;</span><br><span class="line">                    res.add(<span class="keyword">new</span> ArrayList&lt;Integer&gt;(Arrays.asList(nums[i], nums[l], nums[r])));</span><br><span class="line">                    <span class="keyword">while</span>(l &lt; r &amp;&amp; nums[l] == nums[l+<span class="number">1</span>]) l++;</span><br><span class="line">                    <span class="keyword">while</span>(l &lt; r &amp;&amp; nums[r] == nums[r-<span class="number">1</span>]) r--;</span><br><span class="line">                    l++;</span><br><span class="line">                    r--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(nums[i] + nums[l] + nums[r] &gt; <span class="number">0</span>) r--;</span><br><span class="line">                <span class="keyword">else</span> l++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š29 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†31.84% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š42.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†48.86% çš„ç”¨æˆ·</p>
<h3 id="9-Zå­—å½¢å˜æ¢"><a href="#9-Zå­—å½¢å˜æ¢" class="headerlink" title="9.Zå­—å½¢å˜æ¢"></a>9.Zå­—å½¢å˜æ¢</h3><p><strong>[ç¬¬6é¢˜]</strong> å°†ä¸€ä¸ªç»™å®šå­—ç¬¦ä¸²æ ¹æ®ç»™å®šçš„è¡Œæ•°ï¼Œä»¥ä»ä¸Šå¾€ä¸‹ã€ä»å·¦åˆ°å³è¿›è¡Œ Z å­—å½¢æ’åˆ—ã€‚ æ¯”å¦‚è¾“å…¥å­—ç¬¦ä¸²ä¸º â€œLEETCODEISHIRINGâ€ è¡Œæ•°ä¸º 3 æ—¶ï¼Œæ’åˆ—å¦‚ä¸‹ï¼š<br>L   C   I   R<br>E T O E S I I G<br>E   D   H   N<br>ä¹‹åï¼Œä½ çš„è¾“å‡ºéœ€è¦ä»å·¦å¾€å³é€è¡Œè¯»å–ï¼Œäº§ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼šâ€LCIRETOESIIGEDHNâ€ã€‚ è¯·ä½ å®ç°è¿™ä¸ªå°†å­—ç¬¦ä¸²è¿›è¡ŒæŒ‡å®šè¡Œæ•°å˜æ¢çš„å‡½æ•°ï¼š string convert(string s, int numRows); </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: s = â€œLEETCODEISHIRINGâ€, numRows = 3<br>è¾“å‡º: â€œLCIRETOESIIGEDHNâ€</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: s = â€œLEETCODEISHIRINGâ€, numRows = 4<br>è¾“å‡º: â€œLDREOEIIECIHNTSGâ€<br>è§£é‡Š:<br>L     D     R<br>E   O E   I I<br>E C   I H   N<br>T     S     G </li>
</ul>
<blockquote>
<p><strong>æ ¹æ® numRows çš„å¤§å°æ¥å›è¿›è¡Œæ”¾ç½®å³å¯</strong>ï¼ˆå³ä»0åˆ°n-1ï¼Œå†ä»n-1åˆ°0ï¼‰ã€‚å…·ä½“çš„è¯·çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/39.png" alt><br>æˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ï¼Œ<strong>æ¯ 2n-2 å³ä¸ºä¸€ä¸ªå‘¨æœŸ</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">self, s: <span class="built_in">str</span>, numRows: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">if</span> numRows == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        temp = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(numRows)]</span><br><span class="line">        period = numRows * <span class="number">2</span> - <span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">            <span class="comment"># æ¯2n-2ä¸ºå‘¨æœŸ</span></span><br><span class="line">            mod = index % period</span><br><span class="line">            <span class="comment"># 0åˆ°n-1</span></span><br><span class="line">            <span class="keyword">if</span> mod &lt; numRows:</span><br><span class="line">                temp[mod] += value</span><br><span class="line">            <span class="comment"># n-1åˆ°0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp[period - mod] += value</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(temp)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:56 ms,å‡»è´¥äº†95.52% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†16.18% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convert</span><span class="params">(String s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numRows &lt; <span class="number">2</span>) <span class="keyword">return</span> s;</span><br><span class="line">        String[] tmp = <span class="keyword">new</span> String[numRows];</span><br><span class="line">        Arrays.fill(tmp, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> period = numRows * <span class="number">2</span> - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> mod = i % period;</span><br><span class="line">            <span class="keyword">if</span>(mod &lt; numRows) tmp[mod] += s.charAt(i);</span><br><span class="line">            <span class="keyword">else</span> tmp[period-mod] += s.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        String res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(String str: tmp)&#123;</span><br><span class="line">            res += str;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š18 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†20.92% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†13.73% çš„ç”¨æˆ·</p>
<h2 id="é“¾è¡¨ç³»åˆ—"><a href="#é“¾è¡¨ç³»åˆ—" class="headerlink" title="é“¾è¡¨ç³»åˆ—"></a>é“¾è¡¨ç³»åˆ—</h2><h3 id="1-åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"><a href="#1-åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹" class="headerlink" title="1.åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"></a>1.åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</h3><blockquote>
<p>åœ¨é“¾è¡¨çš„é¢˜ç›®ä¸­ï¼Œåé“æœ‰ä¹é“ä¼šç”¨åˆ°å“¨å…µèŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯å“¨å…µèŠ‚ç‚¹ã€‚<br>å“¨å…µèŠ‚ç‚¹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé™„åŠ åœ¨åŸé“¾è¡¨æœ€å‰é¢ç”¨æ¥ç®€åŒ–è¾¹ç•Œæ¡ä»¶çš„é™„åŠ èŠ‚ç‚¹ï¼Œå®ƒçš„å€¼åŸŸä¸å­˜å‚¨ä»»ä½•ä¸œ<br>è¥¿ï¼Œåªæ˜¯ä¸ºäº†æ“ä½œæ–¹ä¾¿è€Œå¼•å…¥ã€‚æ¯”å¦‚åŸé“¾è¡¨ä¸º a -&gt; b -&gt; cï¼Œåˆ™åŠ äº†å“¨å…µèŠ‚ç‚¹çš„é“¾è¡¨å³ä¸º x -&gt; a -&gt; b &gt; cã€‚</p>
<p>é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥å“¨å…µèŠ‚ç‚¹å‘¢?ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åˆ é™¤æŸé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¸¸è§çš„åˆ é™¤é“¾è¡¨<br>çš„æ“ä½œæ˜¯æ‰¾åˆ°è¦åˆ å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ ï¼Œå‡å¦‚æˆ‘ä»¬è®°ä¸ºpreã€‚æˆ‘ä»¬é€šè¿‡ï¼š</p>
<p>pre.Next = pre.Next.Next</p>
<p>æ¥è¿›è¡Œåˆ é™¤é“¾è¡¨çš„æ“ä½œã€‚ä½†æ˜¯æ­¤æ—¶è‹¥æ˜¯åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¯ï¼Œä½ å°±å¾ˆéš¾è¿›è¡Œäº†ï¼Œå› ä¸ºæŒ‰é“ç†æ¥è®²ï¼Œæ­¤æ—¶<br>ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ å°±æ˜¯nilï¼ˆç©ºçš„ï¼‰ï¼Œå¦‚æœä½¿ç”¨preå°±ä¼šæŠ¥é”™ã€‚é‚£å¦‚æœæ­¤æ—¶ä½ è®¾ç½®äº†å“¨å…µèŠ‚ç‚¹çš„<br>è¯ï¼Œæ­¤æ—¶çš„preå°±æ˜¯å“¨å…µèŠ‚ç‚¹äº†ã€‚è¿™æ ·å¯¹äºé“¾è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ï¼Œä½ è¦åˆ é™¤éƒ½å¯ä»¥é€šè¿‡ pre.Next =<br>pre.Next.Next çš„æ–¹å¼æ¥è¿›è¡Œï¼Œè¿™å°±æ˜¯å“¨å…µèŠ‚ç‚¹çš„ä½œç”¨ã€‚</p>
</blockquote>
<p><strong>[ç¬¬19é¢˜]</strong>  ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>ç»™å®šä¸€ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5, å’Œ n = 2.<br>å½“åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹åï¼Œé“¾è¡¨å˜ä¸º 1-&gt;2-&gt;3-&gt;5.</li>
</ul>
<p>è¯´æ˜ï¼š ç»™å®šçš„ n ä¿è¯æ˜¯æœ‰æ•ˆçš„ã€‚<br>è¿›é˜¶ï¼š ä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ </p>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬æ€è€ƒï¼Œè®©æˆ‘ä»¬åˆ é™¤å€’æ•°ç¬¬Nä¸ªå…ƒç´ ï¼Œé‚£æˆ‘ä»¬åªè¦æ‰¾åˆ°å€’æ•°ç¬¬Nä¸ªå…ƒç´ å°±å¯ä»¥äº†ï¼Œé‚£æ€ä¹ˆæ‰¾<br>å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä¸­é—´é—´éš”N-1å…ƒç´ ã€‚å½“åé¢çš„æŒ‡é’ˆéå†å®Œæ‰€æœ‰å…ƒç´ æŒ‡å‘nil<br>æ—¶ï¼Œå‰é¢çš„æŒ‡é’ˆå°±æŒ‡å‘äº†æˆ‘ä»¬è¦åˆ é™¤çš„å…ƒç´ ã€‚</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/3.jpg" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeNthFromEnd</span>(<span class="params">self, head: ListNode, n: <span class="built_in">int</span></span>) -&gt; ListNode:</span></span><br><span class="line">        <span class="comment"># æ€è·¯ï¼šåŒæŒ‡é’ˆæ³•ã€‚</span></span><br><span class="line">        slow = fast = head</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):  <span class="comment"># å…ˆè®©fastèµ°næ­¥</span></span><br><span class="line">            fast = fast.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">if</span> fast == <span class="literal">None</span>:  <span class="comment"># è‹¥èµ°äº†næ­¥åä¸ºNoneï¼Œåˆ™è¡¨æ˜åˆ é™¤çš„ä¸ºheadèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> head.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> fast.<span class="built_in">next</span> != <span class="literal">None</span>:  <span class="comment"># slowå’ŒfaståŒæ—¶å¾€å‰èµ°</span></span><br><span class="line">            slow = slow.<span class="built_in">next</span>  <span class="comment"># å½“fastèµ°åˆ°å¤´æ—¶ï¼Œsecondå³æ˜¯è¦åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä½ç½®</span></span><br><span class="line">            fast = fast.<span class="built_in">next</span></span><br><span class="line">        slow.<span class="built_in">next</span> = slow.<span class="built_in">next</span>.<span class="built_in">next</span>  <span class="comment"># åˆ é™¤è¯¥èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> head</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†82.68% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†31.27% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        ListNode res = <span class="keyword">new</span> ListNode(<span class="number">0</span>, head);</span><br><span class="line">        ListNode fast = head;</span><br><span class="line">        ListNode slow = res;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(fast.next!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            fast=fast.next;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= n) slow = slow.next;   </span><br><span class="line">        &#125;</span><br><span class="line">        slow.next = slow.next.next;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†33.64% çš„ç”¨æˆ·</p>
<h3 id="2-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#2-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="2.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>2.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h3><p><strong>[ç¬¬21é¢˜]</strong> å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„å‡åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4<br>è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</li>
</ul>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªpreheadçš„å“¨å…µèŠ‚ç‚¹ã€‚æˆ‘ä»¬å…¶å®åªéœ€è¦è°ƒæ•´å®ƒçš„nextæŒ‡é’ˆã€‚è®©å®ƒæ€»æ˜¯æŒ‡å‘l1æˆ–è€…l2ä¸­è¾ƒå°çš„ä¸€ä¸ªï¼Œç›´åˆ°l1æˆ–è€…l2ä»»ä¸€æŒ‡å‘nullã€‚è¿™æ ·åˆ°äº†æœ€åï¼Œå¦‚æœl1è¿˜æ˜¯l2ä¸­ä»»æ„ä¸€æ–¹è¿˜æœ‰ä½™ä¸‹å…ƒç´ æ²¡æœ‰ç”¨åˆ°ï¼Œé‚£ä½™ä¸‹çš„è¿™äº›å…ƒç´ ä¸€å®šå¤§äºpreheadå·²ç»åˆå¹¶å®Œçš„é“¾è¡¨ï¼ˆå› ä¸ºæ˜¯æœ‰åºé“¾è¡¨ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span>(<span class="params">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°é“¾è¡¨</span></span><br><span class="line">        cur = ListNode()</span><br><span class="line">        <span class="comment"># è®¾ç½®å“¨å…µèŠ‚ç‚¹</span></span><br><span class="line">        result = cur</span><br><span class="line">        <span class="comment"># æŒ‡å‘ä¸¤è€…ä¸­å°çš„</span></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt; l2.val:</span><br><span class="line">                cur.<span class="built_in">next</span> = l1</span><br><span class="line">                l1 = l1.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cur.<span class="built_in">next</span> = l2</span><br><span class="line">                l2 = l2.<span class="built_in">next</span></span><br><span class="line">            cur = cur.<span class="built_in">next</span></span><br><span class="line">        <span class="comment"># å°†å…¶ä¸­ä¸€æ–¹å‰©ä½™çš„æ·»åŠ è¿›æ¥</span></span><br><span class="line">        <span class="keyword">if</span> l1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            cur.<span class="built_in">next</span> = l1</span><br><span class="line">        <span class="keyword">if</span> l2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            cur.<span class="built_in">next</span> = l2</span><br><span class="line">        <span class="keyword">return</span> result.<span class="built_in">next</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†48.83% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†79.52% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        ListNode res = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode p = res;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="keyword">null</span> &amp;&amp; l2!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1.val&lt;=l2.val)&#123;</span><br><span class="line">                p.next = l1;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                p.next = l2;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l1!=<span class="keyword">null</span>) p.next = l1;</span><br><span class="line">        <span class="keyword">if</span>(l2!=<span class="keyword">null</span>) p.next = l2;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†10.58% çš„ç”¨æˆ·</p>
<h3 id="3-ç¯å½¢é“¾è¡¨"><a href="#3-ç¯å½¢é“¾è¡¨" class="headerlink" title="3.ç¯å½¢é“¾è¡¨"></a>3.ç¯å½¢é“¾è¡¨</h3><p><strong>[ç¬¬141é¢˜]</strong> ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ªnextæŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•°posæ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœposæ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼šposä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚ å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œåˆ™è¿”å›true ã€‚ å¦åˆ™ï¼Œè¿”å›false ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼šè¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</li>
<li>ç¤ºä¾‹ 2ï¼šè¾“å…¥ï¼šhead = [1,2], pos = 0<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>ç¤ºä¾‹ 3ï¼šè¾“å…¥ï¼šhead = [1], pos = -1<br>è¾“å‡ºï¼šfalse<br>è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</li>
</ul>
<p>è¿›é˜¶ï¼šä½ èƒ½ç”¨O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</p>
<p><strong>æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨åˆ¤å®š</strong></p>
<blockquote>
<p>æ€è·¯ï¼šé€šè¿‡hashè¡¨æ¥æ£€æµ‹èŠ‚ç‚¹ä¹‹å‰æ˜¯å¦è¢«è®¿é—®è¿‡ï¼Œæ¥åˆ¤æ–­é“¾è¡¨æ˜¯å¦æˆç¯ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasCycle</span>(<span class="params">self, head: ListNode</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="built_in">hash</span> = &#123;&#125;</span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            <span class="keyword">if</span> head <span class="keyword">in</span> <span class="built_in">hash</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="built_in">hash</span>[head] = <span class="number">1</span></span><br><span class="line">            head = head.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:64 ms,å‡»è´¥äº†58.42% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16.4 MB,å‡»è´¥äº†32.63% çš„Python3ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆ</strong></p>
<blockquote>
<p>æœ¬é¢˜æ ‡å‡†è§£æ³•ï¼å¸¸è¯†å†…å®¹ï¼Œå¿…é¡»æŒæ¡ï¼</p>
<p>æ€è·¯æ¥æºï¼šå…ˆæƒ³è±¡ä¸€ä¸‹ï¼Œä¸¤åè¿åŠ¨å‘˜ä»¥ä¸åŒé€Ÿåº¦åœ¨è·‘é“ä¸Šè¿›è¡Œè·‘æ­¥ä¼šæ€ä¹ˆæ ·ï¼Ÿç›¸é‡ï¼å¥½äº†ï¼Œè¿™é“é¢˜ä½ ä¼š<br>äº†ã€‚</p>
<p>è§£é¢˜æ–¹æ³•ï¼šé€šè¿‡ä½¿ç”¨å…·æœ‰ä¸åŒé€Ÿåº¦çš„å¿«ã€æ…¢ä¸¤ä¸ªæŒ‡é’ˆéå†é“¾è¡¨ï¼Œç©ºé—´å¤æ‚åº¦å¯ä»¥è¢«é™ä½è‡³ O(1)ã€‚æ…¢æŒ‡<br>é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œè€Œå¿«æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasCycle</span>(<span class="params">self, head: ListNode</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        slow, fast = head, head</span><br><span class="line">        <span class="keyword">while</span> fast <span class="keyword">and</span> fast.<span class="built_in">next</span>:</span><br><span class="line">            <span class="comment"># æ…¢æŒ‡é’ˆï¼Œæ¯æ¬¡èµ°ä¸€æ­¥; å¿«æŒ‡é’ˆï¼Œæ¯æ¬¡èµ°ä¸¤æ­¥</span></span><br><span class="line">            slow, fast = slow.<span class="built_in">next</span>, fast.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">            <span class="comment"># å¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œè¡¨ç¤ºæœ‰ç¯</span></span><br><span class="line">            <span class="keyword">if</span> fast <span class="keyword">is</span> slow:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:48 ms,å‡»è´¥äº†99.09% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16.3 MB,å‡»è´¥äº†77.10% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasCycle</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">       ListNode fast = head;</span><br><span class="line">       ListNode slow = head;</span><br><span class="line">       <span class="keyword">while</span>(fast!=<span class="keyword">null</span> &amp;&amp; fast.next!=<span class="keyword">null</span>)&#123;</span><br><span class="line">           slow = slow.next;</span><br><span class="line">           fast = fast.next.next;</span><br><span class="line">           <span class="keyword">if</span>(fast==slow) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†13.26% çš„ç”¨æˆ·</p>
<h3 id="4-ä¸¤æ•°ç›¸åŠ "><a href="#4-ä¸¤æ•°ç›¸åŠ " class="headerlink" title="4.ä¸¤æ•°ç›¸åŠ "></a>4.ä¸¤æ•°ç›¸åŠ </h3><p><strong>[ç¬¬2é¢˜]</strong> ç»™å‡ºä¸¤ä¸ªéç©ºçš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§é€†åºçš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ä¸€ä½æ•°å­—ã€‚å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚æ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>è¾“å…¥ï¼š(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>è¾“å‡ºï¼š7 -&gt; 0 -&gt; 8<br>åŸå› ï¼š342 + 465 = 807</li>
</ul>
<blockquote>
<p>åŠ æ³•è‚¯å®šæ˜¯ä»æœ€ä½ä½åˆ°æœ€é«˜ä½è¿›è¡Œç›¸åŠ ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„<strong>é“¾è¡¨å¤´åˆ°é“¾è¡¨å°¾è¿›è¡Œç›¸åŠ ï¼Œæ‰€ä»¥éœ€è¦éå†é“¾è¡¨</strong>ã€‚</p>
<p>ä»¤ l1 å’Œ l2 æŒ‡å‘ä¸¤ä¸ªé“¾è¡¨çš„å¤´ï¼Œç”¨ä¸€ä¸ªtmpå€¼æ¥å­˜å‚¨åŒä¸€ä½ç›¸åŠ çš„ç»“æœï¼Œä»¥åŠä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥å­˜å‚¨tmpçš„å€¼ã€‚</p>
<p><strong>æ‰€æœ‰æ¨¡æ‹Ÿè¿ç®—çš„é¢˜ç›®ï¼Œéƒ½éœ€è¦è€ƒè™‘è¿›ä½</strong>ã€‚<strong>æˆ‘ä»¬ä½¿ç”¨tmpæºå¸¦è¿›ä½çš„å€¼åˆ°ä¸‹ä¸€ä½çš„è¿ç®—</strong>ã€‚è‡ªç„¶ï¼Œè¿™é‡Œçš„é“¾è¡¨ä¹Ÿä¸èƒ½ç›´æ¥å­˜å‚¨tmpçš„å€¼äº†ï¼Œè€Œæ˜¯è¦å­˜å‚¨tmp%10çš„å€¼ã€‚é‡å¤è¿™ä¸ªæ­¥éª¤ï¼Œ<strong>ç›´åˆ°ä¸¤ä¸ªé“¾è¡¨éƒ½éå†å®Œæˆï¼Œå¹¶ä¸” tmp æ²¡æœ‰è¿›ä½å€¼</strong>ã€‚</p>
<p><strong>å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ„é€ å“¨å…µèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸å¤ªå®¹æ˜“ç›´æ¥è¿”å›æ–°é“¾è¡¨</strong>ã€‚æ‰€ä»¥åœ¨æ•´ä¸ªæµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹æŒ‡å‘æˆ‘ä»¬çš„æ–°é“¾è¡¨ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addTwoNumbers</span>(<span class="params">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span></span><br><span class="line">        <span class="built_in">list</span> = ListNode()</span><br><span class="line">        result = <span class="built_in">list</span></span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">or</span> l2 <span class="keyword">or</span> tmp != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> l1:</span><br><span class="line">                tmp += l1.val</span><br><span class="line">                l1 = l1.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">if</span> l2:</span><br><span class="line">                tmp += l2.val</span><br><span class="line">                l2 = l2.<span class="built_in">next</span></span><br><span class="line">            <span class="built_in">list</span>.<span class="built_in">next</span> = ListNode(tmp % <span class="number">10</span>)</span><br><span class="line">            tmp //= <span class="number">10</span></span><br><span class="line">            <span class="built_in">list</span> = <span class="built_in">list</span>.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">return</span> result.<span class="built_in">next</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:72 ms,å‡»è´¥äº†84.37% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†6.12% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        ListNode res = <span class="keyword">new</span> ListNode();</span><br><span class="line">        ListNode p = res;</span><br><span class="line">        <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="keyword">null</span> || l2!=<span class="keyword">null</span> || tmp != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                tmp += l1.val;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(l2!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                tmp += l2.val;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            p.next = <span class="keyword">new</span> ListNode(tmp % <span class="number">10</span>);</span><br><span class="line">            tmp /= <span class="number">10</span>;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†49.86% çš„ç”¨æˆ·</p>
<h2 id="åŠ¨æ€è§„åˆ’ç³»åˆ—"><a href="#åŠ¨æ€è§„åˆ’ç³»åˆ—" class="headerlink" title="åŠ¨æ€è§„åˆ’ç³»åˆ—"></a>åŠ¨æ€è§„åˆ’ç³»åˆ—</h2><blockquote>
<p>å…³äºåŠ¨æ€è§„åˆ’çš„èµ„æ–™å¾ˆå¤šï¼Œå®˜æ–¹çš„å®šä¹‰æ˜¯æŒ‡æŠŠå¤šé˜¶æ®µè¿‡ç¨‹è½¬åŒ–ä¸ºä¸€ç³»åˆ—å•é˜¶æ®µé—®é¢˜ï¼Œåˆ©ç”¨å„é˜¶æ®µä¹‹é—´çš„å…³ç³»ï¼Œé€ä¸ªæ±‚è§£ã€‚æ¦‚å¿µä¸­çš„å„é˜¶æ®µä¹‹é—´çš„å…³ç³»ï¼Œå…¶å®æŒ‡çš„å°±æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚å¾ˆå¤šäººè§‰å¾—DPéš¾ï¼ˆä¸‹æ–‡ç»Ÿç§°åŠ¨æ€è§„åˆ’ä¸ºDPï¼‰ï¼Œæ ¹æœ¬åŸå› æ˜¯å› ä¸ºDPè·Ÿä¸€äº›å›ºå®šå½¢å¼çš„ç®—æ³•ä¸åŒï¼ˆæ¯”å¦‚DFSã€äºŒåˆ†æ³•ã€KMPï¼‰ï¼Œå®ƒæ²¡æœ‰å®é™…çš„æ­¥éª¤è§„å®šç¬¬ä¸€æ­¥ã€ç¬¬äºŒæ­¥æ¥åšä»€ä¹ˆï¼Œæ‰€ä»¥å‡†ç¡®æ¥è¯´ï¼ŒDPå…¶å®æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„æ€æƒ³ã€‚</p>
<p>è¿™ç§æ€æƒ³çš„æœ¬è´¨æ˜¯ï¼šä¸€ä¸ªè§„æ¨¡æ¯”è¾ƒå¤§çš„é—®é¢˜ï¼ˆå¯ä»¥ç”¨ä¸¤ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºçš„é—®é¢˜ï¼‰ï¼Œå¯ä»¥é€šè¿‡è‹¥å¹²è§„æ¨¡è¾ƒå°çš„é—®é¢˜çš„ç»“æœæ¥å¾—åˆ°çš„ï¼ˆé€šå¸¸ä¼šå¯»æ±‚åˆ°ä¸€äº›ç‰¹æ®Šçš„è®¡ç®—é€»è¾‘ï¼Œå¦‚æ±‚æœ€å€¼ç­‰ï¼‰ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•é€šè¿‡å­é—®é¢˜å»å¾—åˆ°å¤§è§„æ¨¡é—®é¢˜å‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬çœ‹åˆ°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ŒåŸºæœ¬éƒ½æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;opt ï¼šæŒ‡ä»£ç‰¹æ®Šçš„è®¡ç®—é€»è¾‘ï¼Œé€šå¸¸ä¸º max or minã€‚</span><br><span class="line">&gt;i,j,k éƒ½æ˜¯åœ¨å®šä¹‰DPæ–¹ç¨‹ä¸­ç”¨åˆ°çš„å‚æ•°ã€‚</span><br><span class="line">&gt;dp[i] = opt(dp[i-1])+1</span><br><span class="line">&gt;dp[i][j] = w(i,j,k) + opt(dp[i-1][k])</span><br><span class="line">&gt;dp[i][j] = opt(dp[i-1][j] + xi, dp[i][j-1] + yj, ...)</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸€ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¤šå°‘éƒ½æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚è¿™ä¸ªå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸–é—´çš„å…³ç³»å¤šäº†å»äº†ï¼Œä¸å¯èƒ½æŠ½è±¡å‡ºå®Œå…¨å¯ä»¥å¥—ç”¨çš„å…¬å¼ã€‚æ‰€ä»¥æˆ‘ä¸ªäººå…¶å®ä¸å»ºè®®å»æ­»è®°ç¡¬èƒŒå„ç§ç±»å‹çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚</p>
</blockquote>
<h3 id="1-çˆ¬æ¥¼æ¢¯"><a href="#1-çˆ¬æ¥¼æ¢¯" class="headerlink" title="1.çˆ¬æ¥¼æ¢¯"></a>1.çˆ¬æ¥¼æ¢¯</h3><p><strong>[ç¬¬70é¢˜]</strong> å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦né˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚æ¯æ¬¡ä½ å¯ä»¥çˆ¬1æˆ–2ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿæ³¨æ„ï¼šç»™å®šnæ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼š 2<br>è¾“å‡ºï¼š 2<br>è§£é‡Šï¼š æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</li>
</ul>
<ol>
<li>1 é˜¶ + 1 é˜¶ </li>
<li>2 é˜¶ </li>
</ol>
<ul>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼š 3<br>è¾“å‡ºï¼š 3<br>è§£é‡Šï¼š æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</li>
</ul>
<ol>
<li>1 é˜¶ + 1 é˜¶ + 1 é˜¶</li>
<li>1 é˜¶ + 2 é˜¶</li>
<li>2 é˜¶ + 1 é˜¶</li>
</ol>
<blockquote>
<p>é€šè¿‡åˆ†ææˆ‘ä»¬å¯ä»¥æ˜ç¡®ï¼Œè¯¥é¢˜å¯ä»¥è¢«åˆ†è§£ä¸ºä¸€äº›åŒ…å«æœ€ä¼˜å­ç»“æ„çš„å­é—®é¢˜ï¼Œå³å®ƒçš„æœ€ä¼˜è§£å¯ä»¥ä»å…¶å­é—®é¢˜çš„æœ€ä¼˜è§£æ¥æœ‰æ•ˆåœ°æ„å»ºã€‚æ»¡è¶³â€œå°†å¤§é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡è¾ƒå°çš„é—®é¢˜â€çš„æ¡ä»¶ã€‚æ‰€æˆ‘ä»¬ä»¤dp[n]è¡¨ç¤ºèƒ½åˆ°è¾¾ç¬¬né˜¶çš„æ–¹æ³•æ€»æ•°ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p>dp[n]=dp[n-1]+dp[n-2]</p>
<p>ä¸Š 1 é˜¶å°é˜¶ï¼šæœ‰1ç§æ–¹å¼ã€‚<br>ä¸Š 2 é˜¶å°é˜¶ï¼šæœ‰1+1å’Œ2ä¸¤ç§æ–¹å¼ã€‚<br>ä¸Š 3 é˜¶å°é˜¶ï¼šåˆ°è¾¾ç¬¬3é˜¶çš„æ–¹æ³•æ€»æ•°å°±æ˜¯åˆ°ç¬¬1é˜¶å’Œç¬¬2é˜¶çš„æ–¹æ³•æ•°ä¹‹å’Œã€‚<br>ä¸Š n é˜¶å°é˜¶ï¼Œåˆ°è¾¾ç¬¬né˜¶çš„æ–¹æ³•æ€»æ•°å°±æ˜¯åˆ°ç¬¬ (n-1) é˜¶å’Œç¬¬ (n-2) é˜¶çš„æ–¹æ³•æ•°ä¹‹å’Œã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">climbStairs</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        dp = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> n &gt;= <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n+<span class="number">1</span>):</span><br><span class="line">                dp.append(dp[i-<span class="number">1</span>] + dp[i-<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†87.16% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†50.33% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=n; i++) dp[i] = dp[i-<span class="number">1</span>] + dp[i-<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">return</span> dp[n]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†38.13% çš„ç”¨æˆ·</p>
<h3 id="2-æœ€å¤§å­åºå’Œ"><a href="#2-æœ€å¤§å­åºå’Œ" class="headerlink" title="2.æœ€å¤§å­åºå’Œ"></a>2.æœ€å¤§å­åºå’Œ</h3><p><strong>[ç¬¬53é¢˜]</strong> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„numsï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4]<br>è¾“å‡º: 6<br>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º6ã€‚</li>
</ul>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬åˆ†æé¢˜ç›®ï¼Œä¸€ä¸ªè¿ç»­å­æ•°ç»„ä¸€å®šè¦ä»¥ä¸€ä¸ªæ•°ä½œä¸ºç»“å°¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€å®šä¹‰æˆå¦‚ä¸‹ï¼š</p>
<p>dp[i]ï¼šè¡¨ç¤ºä»¥nums[i]ç»“å°¾çš„è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œã€‚</p>
<p>æ ¹æ®çŠ¶æ€çš„å®šä¹‰ï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œåˆ†æï¼šå¦‚æœè¦å¾—åˆ°dp[i]ï¼Œé‚£ä¹ˆnums[i]ä¸€å®šä¼šè¢«é€‰å–ã€‚å¹¶ä¸”dp[i]æ‰€è¡¨ç¤ºçš„è¿ç»­å­åºåˆ—ä¸dp[i-1]æ‰€è¡¨ç¤ºçš„è¿ç»­å­åºåˆ—å¾ˆå¯èƒ½å°±å·®ä¸€ä¸ªnums[i] ã€‚å³ï¼š</p>
<p>dp[i] = dp[i-1]+nums[i] , if (dp[i-1] &gt;= 0)</p>
<p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¾ˆæœ‰å¯èƒ½dp[i-1]æœ¬èº«æ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚é‚£è¿™ç§æƒ…å†µçš„è¯ï¼Œå¦‚æœdp[i]é€šè¿‡dp[i-1]+nums[i] æ¥æ¨å¯¼ï¼Œé‚£ä¹ˆç»“æœå…¶å®åè€Œå˜å°äº†ï¼Œå› ä¸ºæˆ‘ä»¬dp[i]è¦æ±‚çš„æ˜¯æœ€å¤§å’Œã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœdp[i-1] &lt; 0ï¼Œé‚£ä¹ˆdp[i]å…¶å®å°±æ˜¯nums[i]çš„å€¼ã€‚å³</p>
<p>dp[i] = nums[i] , if (dp[i-1] &lt; 0)</p>
<p>ç»¼ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š</p>
<p>dp[i]=max(nums[i], dp[iâˆ’1]+nums[i])</p>
<p>å¾—åˆ°äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡ä¸€ä¸ªå·²æœ‰çš„çŠ¶æ€çš„è¿›è¡Œæ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°dp[0]ä¸€å®šæ˜¯ä»¥nums[0]è¿›è¡Œç»“å°¾ï¼Œæ‰€ä»¥</p>
<p>dp[i] = dp[i-1]+nums[i] , if (dp[i-1] &gt;= 0)<br>dp[0] = nums[0]</p>
<p>åœ¨å¾ˆå¤šé¢˜ç›®ä¸­ï¼Œå› ä¸ºdp[i]æœ¬èº«å°±å®šä¹‰æˆäº†é¢˜ç›®ä¸­çš„é—®é¢˜ï¼Œæ‰€ä»¥dp[i]æœ€ç»ˆå°±æ˜¯è¦çš„ç­”æ¡ˆã€‚ä½†æ˜¯è¿™é‡ŒçŠ¶æ€ä¸­çš„å®šä¹‰ï¼Œå¹¶ä¸æ˜¯é¢˜ç›®ä¸­è¦çš„é—®é¢˜ï¼Œä¸èƒ½ç›´æ¥è¿”å›æœ€åçš„ä¸€ä¸ªçŠ¶æ€ (è¿™ä¸€æ­¥ç»å¸¸æœ‰åˆå­¦è€…ä¼šæ‘”è·Ÿå¤´)ã€‚æ‰€ä»¥æœ€ç»ˆçš„ç­”æ¡ˆï¼Œå…¶å®æˆ‘ä»¬æ˜¯å¯»æ‰¾ï¼š</p>
<p>max(dp[0], dp[1], â€¦, d[i-1], dp[i])</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [nums[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> dp[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(nums)):</span><br><span class="line">            dp.append(<span class="built_in">max</span>(nums[i], dp[i-<span class="number">1</span>]+nums[i]))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(dp)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†90.97% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.2 MB,å‡»è´¥äº†24.24% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> res = dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;nums.length;i++)&#123;</span><br><span class="line">            dp[i] = Math.max(dp[i-<span class="number">1</span>]+nums[i], nums[i]);</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.84% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†76.68% çš„ç”¨æˆ·</p>
<h3 id="3-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#3-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="3.æœ€é•¿ä¸Šå‡å­åºåˆ—"></a>3.æœ€é•¿ä¸Šå‡å­åºåˆ—</h3><p><strong>[ç¬¬300é¢˜]</strong> ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥: [10,9,2,5,3,7,101,18]<br>è¾“å‡º: 4<br>è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚ </li>
</ul>
<p>è¯´æ˜: å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚ </p>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬åˆ†æé¢˜ç›®ï¼Œè¦æ‰¾çš„æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLongest Increasing Subsequenceï¼ŒLISï¼‰ã€‚å› ä¸ºé¢˜ç›®ä¸­æ²¡æœ‰è¦æ±‚è¿ç»­ï¼Œæ‰€ä»¥LISå¯èƒ½æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯éè¿ç»­çš„ã€‚åŒæ—¶ï¼ŒLISç¬¦åˆå¯ä»¥ä»å…¶å­é—®é¢˜çš„æœ€ä¼˜è§£æ¥è¿›è¡Œæ„å»ºçš„æ¡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨åŠ¨æ€è§„åˆ’æ¥è¿›è¡Œæ±‚è§£ã€‚é¦–å…ˆæˆ‘ä»¬å®šä¹‰çŠ¶æ€ï¼š</p>
<p>dp[i] ï¼šè¡¨ç¤ºä»¥nums[i]ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦</p>
<p>æˆ‘ä»¬åˆ†ä¸¤ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼š</p>
<p>å¦‚æœnums[i]æ¯”å‰é¢çš„æ‰€æœ‰å…ƒç´ éƒ½å°ï¼Œé‚£ä¹ˆdp[i]ç­‰äº1ï¼ˆå³å®ƒæœ¬èº«ï¼‰ï¼ˆè¯¥ç»“è®ºæ­£ç¡®ï¼‰</p>
<p>å¦‚æœnums[i]å‰é¢å­˜åœ¨æ¯”ä»–å°çš„å…ƒç´ ï¼Œé‚£ä¹ˆdp[i]å°±ç­‰äºdp[i] = max(dp[j]+1ï¼Œdp[k]+1ï¼Œdp[p]+1ï¼Œâ€¦..)<br>åªè¦æ»¡è¶³ï¼š<br>nums[i] &gt; nums[j]<br>nums[i] &gt; nums[k]<br>nums[i] &gt; nums[p]</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [<span class="number">1</span>]</span><br><span class="line">        result = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(nums)):</span><br><span class="line">            dp.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">                <span class="keyword">if</span> nums[i] &gt; nums[j]:</span><br><span class="line">                    dp[i] = <span class="built_in">max</span>(dp[j]+<span class="number">1</span>, dp[i])</span><br><span class="line">            result = <span class="built_in">max</span>(result, dp[i])</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:1344 ms,å‡»è´¥äº†26.36% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†5.92% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLIS</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> maxLen = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;i; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] &gt; nums[j]) maxLen = Math.max(maxLen, dp[j]+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i] = maxLen;</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š67 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†75.12% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†15.62% çš„ç”¨æˆ·</p>
<h3 id="4-ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"><a href="#4-ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ" class="headerlink" title="4.ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"></a>4.ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ</h3><p><strong>[ç¬¬120é¢˜]</strong> ç»™å®šä¸€ä¸ªä¸‰è§’å½¢ï¼Œæ‰¾å‡ºè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œã€‚æ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚ ç›¸é‚»çš„ç»“ç‚¹åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯ä¸‹æ ‡ä¸ä¸Šä¸€å±‚ç»“ç‚¹ä¸‹æ ‡ç›¸åŒæˆ–è€…ç­‰ä¸Šä¸€å±‚ç»“ç‚¹ä¸‹æ ‡ + 1çš„ä¸¤ä¸ªç‚¹ã€‚ </p>
<ul>
<li>ä¾‹å¦‚ï¼Œç»™å®šä¸‰è§’å½¢ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[	[2],     </span><br><span class="line">   [3,4],    </span><br><span class="line">  [6,5,7],   </span><br><span class="line"> [4,1,8,3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
è‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œä¸º11ï¼ˆå³ï¼Œ2 + 3 + 5 + 1 = 11ï¼‰ã€‚ </li>
</ul>
<blockquote>
<p>æˆ‘ä»¬æ ¹æ®é¢˜ç›®ä¸­ç»™å‡ºçš„æ¡ä»¶ï¼šæ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚å…¶å®ä¹Ÿå°±ç­‰åŒäºï¼Œæ¯ä¸€æ­¥æˆ‘ä»¬åªèƒ½å¾€ä¸‹ç§»åŠ¨ä¸€æ ¼æˆ–è€…å³ä¸‹ç§»åŠ¨ä¸€æ ¼ã€‚å°†å…¶è½¬åŒ–æˆä»£ç ï¼Œå‡å¦‚2æ‰€åœ¨çš„å…ƒç´ ä½ç½®ä¸º[0,0]ï¼Œé‚£æˆ‘ä»¬å¾€ä¸‹ç§»åŠ¨å°±åªèƒ½ç§»åŠ¨åˆ°[1,0]æˆ–è€…[1,1]çš„ä½ç½®ä¸Šã€‚å‡å¦‚5æ‰€åœ¨çš„ä½ç½®ä¸º[2,1]ï¼ŒåŒæ ·ä¹Ÿåªèƒ½ç§»åŠ¨åˆ°[3,1]å’Œ[3,2]çš„ä½ç½®ä¸Šã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬é€šè¿‡åŠ¨æ€è§„åˆ’è¿›è¡Œæ±‚è§£ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰çŠ¶æ€ï¼š<br><code>dp[i][j] : è¡¨ç¤ºåŒ…å«ç¬¬iè¡Œjåˆ—å…ƒç´ çš„æœ€å°è·¯å¾„å’Œ</code><br>æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°å¯ä»¥è‡ªé¡¶å‘ä¸‹è¿›è¡Œåˆ†æã€‚å¹¶ä¸”ï¼Œæ— è®ºæœ€åçš„è·¯å¾„æ˜¯å“ªä¸€æ¡ï¼Œå®ƒä¸€å®šè¦ç»è¿‡æœ€é¡¶ä¸Šçš„å…ƒ<br>ç´ ï¼Œå³<code>[0,0]</code>ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹<code>dp[0][0]</code>è¿›è¡Œåˆå§‹åŒ–ã€‚<br><code>dp[0][0] = [0][0]ä½ç½®æ‰€åœ¨çš„å…ƒç´ å€¼</code><br>ç»§ç»­åˆ†æï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚<code>dp[i][j]</code>ï¼Œé‚£ä¹ˆå…¶ä¸€å®šä¼šä»è‡ªå·±å¤´é¡¶ä¸Šçš„ä¸¤ä¸ªå…ƒç´ ç§»åŠ¨è€Œæ¥ã€‚<br>å¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<br><code>dp[i][j] = min(dp[i-1][j-1],dp[i-1][j]) + triangle[i][j]</code><br>ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼é™¤äº†æœ€é¡¶ä¸Šçš„å…ƒç´ ä¹‹å¤–ï¼Œ<br><strong>æœ€å·¦è¾¹çš„å…ƒç´ åªèƒ½ä»è‡ªå·±å¤´é¡¶è€Œæ¥</strong><br><strong>æœ€å³è¾¹çš„å…ƒç´ åªèƒ½ä»è‡ªå·±å·¦ä¸Šè§’è€Œæ¥</strong><br>ç„¶åï¼Œæˆ‘ä»¬è§‚å¯Ÿå‘ç°ï¼Œä½äºç¬¬2è¡Œçš„å…ƒç´ ï¼Œéƒ½æ˜¯ç‰¹æ®Šå…ƒç´ ï¼ˆå› ä¸ºéƒ½åªèƒ½ä»[0,0]çš„å…ƒç´ èµ°è¿‡æ¥ï¼‰<br>æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶ç‰¹æ®Šå¤„ç†ï¼Œå¾—åˆ°ï¼š<br><code>dp[1][0] = triangle[1][0] + triangle[0][0]</code><br><code>dp[1][1] = triangle[1][1] + triangle[0][0]</code><br>æœ€åï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°æœ€åä¸€è¡Œå…ƒç´ ä¸­ï¼Œè·¯å¾„å’Œæœ€å°çš„ä¸€ä¸ªï¼Œå°±æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆã€‚å³ï¼š<br><code>lï¼šdpæ•°ç»„é•¿åº¦</code><br><code>result = min(dp[l-1,0]ï¼Œdp[l-1,1]ï¼Œdp[l-1,2]....)</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minimumTotal</span>(<span class="params">self, triangle: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(triangle) &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(triangle)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(triangle[i])):</span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">                    triangle[i][j] = triangle[i - <span class="number">1</span>][j] + triangle[i][j]</span><br><span class="line">                <span class="keyword">elif</span> j == <span class="built_in">len</span>(triangle[i]) - <span class="number">1</span>:</span><br><span class="line">                    triangle[i][j] = triangle[i - <span class="number">1</span>][j - <span class="number">1</span>] + triangle[i][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    triangle[i][j] = <span class="built_in">min</span>(triangle[i - <span class="number">1</span>][j], triangle[i - <span class="number">1</span>][j - <span class="number">1</span>]) + triangle[i][j]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(triangle[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†96.02% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14 MB,å‡»è´¥äº†39.84% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = triangle.size();</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = triangle.get(<span class="number">0</span>).get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> res = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; triangle.get(i).size(); j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j == <span class="number">0</span>) dp[i][j] = triangle.get(i).get(j) + dp[i - <span class="number">1</span>][j];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(j == triangle.get(i).size()-<span class="number">1</span>)&#123;</span><br><span class="line">                    dp[i][j] = triangle.get(i).get(j) + dp[i - <span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j] = triangle.get(i).get(j) + Math.min(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - <span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(i == n-<span class="number">1</span>) res = Math.min(res, dp[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š5 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†21.88% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.22% çš„ç”¨æˆ·</p>
<p><strong>ä¼˜åŒ–ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = triangle.size();</span><br><span class="line">        <span class="comment">//å› ä¸ºå½“å‰çŠ¶æ€åªä¸ä¸Šä¸€è¡Œçš„åˆ—æœ‰å…³ï¼Œå› æ­¤å¯ä»¥å‹ç¼©ç©ºé—´</span></span><br><span class="line">        <span class="comment">//dp[j]ä»£è¡¨ç¬¬jåˆ—çš„æœ€å°è·¯å¾„å’Œ</span></span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        dp[<span class="number">0</span>] = triangle.get(<span class="number">0</span>).get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="comment">//æ›´æ–°æœ€åä¸€åˆ—</span></span><br><span class="line">            dp[i] = dp[i - <span class="number">1</span>] + triangle.get(i).get(i);</span><br><span class="line">            <span class="comment">//æ›´æ–°ä¸­é—´åˆ—</span></span><br><span class="line">            <span class="comment">//éœ€è¦é€†åºï¼Œå¦åˆ™ä¸Šä¸€åˆ—çš„å€¼ä¼šè¢«è¦†ç›–</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>; j &gt; <span class="number">0</span>; --j) &#123;</span><br><span class="line">                dp[j] = Math.min(dp[j - <span class="number">1</span>], dp[j]) + triangle.get(i).get(j);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ›´æ–°ç¬¬0åˆ—</span></span><br><span class="line">            dp[<span class="number">0</span>] += triangle.get(i).get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> minTotal = dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            minTotal = Math.min(minTotal, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minTotal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.30% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.22% çš„ç”¨æˆ·</p>
<h3 id="5-æœ€å°è·¯å¾„å’Œ"><a href="#5-æœ€å°è·¯å¾„å’Œ" class="headerlink" title="5.æœ€å°è·¯å¾„å’Œ"></a>5.æœ€å°è·¯å¾„å’Œ</h3><p><strong>[ç¬¬64é¢˜]</strong> ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„m x nç½‘æ ¼ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚ è¯´æ˜ï¼šæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">[1,3,1],</span><br><span class="line">[1,5,1],</span><br><span class="line">[4,2,1]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
è¾“å‡º: 7<br>è§£é‡Š: å› ä¸ºè·¯å¾„ 1â†’3â†’1â†’1â†’1 çš„æ€»å’Œæœ€å°ã€‚</li>
</ul>
<blockquote>
<p>è¯¥é¢˜ä¸ä¸Šä¸€é“æ±‚ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œä¸€æ ·ï¼Œé¢˜ç›®æ˜æ˜¾ç¬¦åˆå¯ä»¥ä»å­é—®é¢˜çš„æœ€ä¼˜è§£è¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨åŠ¨æ€è§„åˆ’è¿›è¡Œæ±‚è§£ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰çŠ¶æ€ï¼š<br><code>dp[i][j] : è¡¨ç¤ºåŒ…å«ç¬¬iè¡Œjåˆ—å…ƒç´ çš„æœ€å°è·¯å¾„å’Œ</code><br>åŒæ ·ï¼Œå› ä¸ºä»»ä½•ä¸€æ¡åˆ°è¾¾å³ä¸‹è§’çš„è·¯å¾„ï¼Œéƒ½ä¼šç»è¿‡<code>[0,0]</code>è¿™ä¸ªå…ƒç´ ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹<code>dp[0][0]</code>è¿›è¡Œåˆå§‹åŒ–ã€‚<br><code>dp[0][0] = [0][0]ä½ç½®æ‰€åœ¨çš„å…ƒç´ å€¼</code><br>å¦‚æœæˆ‘ä»¬è¦æ±‚<code>dp[i][j]</code> ï¼Œé‚£ä¹ˆå®ƒä¸€å®šæ˜¯ä»è‡ªå·±çš„ä¸Šæ–¹æˆ–è€…å·¦è¾¹ç§»åŠ¨è€Œæ¥<br>è¿›è€Œæˆ‘ä»¬å¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<br><code>dp[i][j] = min(dp[i-1][j],dp[i][j-1]) + grid[i][j]</code><br>åŒæ ·æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼š<br><strong>æœ€ä¸Šé¢ä¸€è¡Œï¼Œåªèƒ½ç”±å·¦è¾¹ç§»åŠ¨è€Œæ¥</strong><br><strong>æœ€å·¦è¾¹ä¸€åˆ—ï¼Œåªèƒ½ç”±ä¸Šé¢ç§»åŠ¨è€Œæ¥</strong><br>æœ€åï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’ï¼Œæ•´ä¸ªç½‘æ ¼çš„æœ€å°è·¯å¾„å’Œå…¶å®å°±æ˜¯åŒ…å«å³ä¸‹è§’å…ƒç´ çš„æœ€å°è·¯å¾„å’Œã€‚å³ï¼š<br><code>æœ€ç»ˆç»“æœå°±æ˜¯ï¼šdp[l-1][len(dp[l-1])-1]</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minPathSum</span>(<span class="params">self, grid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(grid)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(grid[i])):</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) <span class="keyword">and</span> (j == <span class="number">0</span>):</span><br><span class="line">                    grid[i][j] = grid[i][j]</span><br><span class="line">                <span class="keyword">elif</span> (i == <span class="number">0</span>) <span class="keyword">and</span> (j != <span class="number">0</span>):</span><br><span class="line">                    grid[i][j] = grid[i][j-<span class="number">1</span>] + grid[i][j]</span><br><span class="line">                <span class="keyword">elif</span> (i != <span class="number">0</span>) <span class="keyword">and</span> (j == <span class="number">0</span>):</span><br><span class="line">                    grid[i][j] = grid[i-<span class="number">1</span>][j] + grid[i][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    grid[i][j] = <span class="built_in">min</span>(grid[i][j-<span class="number">1</span>], grid[i-<span class="number">1</span>][j]) + grid[i][j]</span><br><span class="line">        <span class="keyword">return</span> grid[-<span class="number">1</span>][-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:72 ms,å‡»è´¥äº†19.09% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†23.49% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minPathSum</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; grid.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span> &amp;&amp; j==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">0</span> &amp;&amp; j != <span class="number">0</span>) grid[i][j] = grid[i][j-<span class="number">1</span>] + grid[i][j];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(i!=<span class="number">0</span> &amp;&amp; j == <span class="number">0</span>) grid[i][j] = grid[i-<span class="number">1</span>][j] + grid[i][j];</span><br><span class="line">                <span class="keyword">else</span> grid[i][j] = Math.min(grid[i-<span class="number">1</span>][j], grid[i][j-<span class="number">1</span>]) + grid[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> grid[grid.length-<span class="number">1</span>][grid[<span class="number">0</span>].length-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†15.82% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†86.60% çš„ç”¨æˆ·</p>
<h3 id="6-æ‰“å®¶åŠ«èˆ"><a href="#6-æ‰“å®¶åŠ«èˆ" class="headerlink" title="6.æ‰“å®¶åŠ«èˆ"></a>6.æ‰“å®¶åŠ«èˆ</h3><p><strong>[ç¬¬198é¢˜]</strong> ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼š[1,2,3,1]<br>è¾“å‡ºï¼š4<br>è§£é‡Šï¼šå·çªƒ1å·æˆ¿å±‹ (é‡‘é¢ = 1) ï¼Œç„¶åå·çªƒ3å·æˆ¿å±‹ (é‡‘é¢ = 3)ã€‚å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 1 + 3 = 4 ã€‚ </li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼š[2,7,9,3,1]#<br>è¾“å‡ºï¼š12<br>è§£é‡Šï¼šå·çªƒ1å·æˆ¿å±‹ (é‡‘é¢ = 2), å·çªƒ3å·æˆ¿å±‹ (é‡‘é¢ = 9)ï¼Œæ¥ç€å·çªƒ5å·æˆ¿å±‹ (é‡‘é¢ = 1)ã€‚å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 2 + 9 + 1 = 12 ã€‚</li>
</ul>
<blockquote>
<p>å®šä¹‰å‡ºçŠ¶æ€:<br><code>dp[i] : å·ç›—è‡³ç¬¬iä¸ªæˆ¿å­æ—¶ï¼Œæ‰€è·å–çš„æœ€å¤§åˆ©ç›Š</code><br>å› ä¸ºå°å·ä¸€å®šä¼šä»å‰å·åˆ°æœ€åï¼ˆå¼ºè°ƒï¼šå·ç›—è‡³ç¬¬iä¸ªæˆ¿é—´ï¼Œä¸ä»£è¡¨å°å·è¦ä»ç¬¬iä¸ªæˆ¿é—´ä¸­è·å–è´¢ç‰©ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æœ€ç»ˆç­”æ¡ˆå¾ˆå®¹æ˜“ç¡®å®šã€‚å³ï¼š<code>dp[i]</code><br>ç”±äºä¸å¯ä»¥åœ¨ç›¸é‚»çš„æˆ¿å±‹é—¯å…¥ï¼Œæ‰€ä»¥è‡³iæˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼ï¼Œè¦ä¹ˆå°±æ˜¯è‡³i-1æˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼ï¼Œè¦ä¹ˆå°±æ˜¯è‡³i-2æˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼åŠ ä¸Šå½“å‰æˆ¿å±‹çš„å€¼ï¼ŒäºŒè€…ä¹‹é—´å–æœ€å¤§å€¼ï¼Œå³ï¼š<br><code>dp[i] = max(dp[i-2]+nums[i], dp[i-1])</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                nums[i] = nums[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">                nums[i] = <span class="built_in">max</span>(nums[<span class="number">0</span>], nums[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nums[i] = <span class="built_in">max</span>(nums[i-<span class="number">2</span>]+nums[i], nums[i-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> nums[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†96.55% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†5.36% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>) dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">1</span>) dp[<span class="number">1</span>] = Math.max(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">else</span> dp[i] = Math.max(dp[i-<span class="number">1</span>], dp[i-<span class="number">2</span>] + nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[nums.length-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†61.62% çš„ç”¨æˆ·</p>
<h2 id="å­—ç¬¦ä¸²ç³»åˆ—"><a href="#å­—ç¬¦ä¸²ç³»åˆ—" class="headerlink" title="å­—ç¬¦ä¸²ç³»åˆ—"></a>å­—ç¬¦ä¸²ç³»åˆ—</h2><h3 id="1-åè½¬å­—ç¬¦ä¸²"><a href="#1-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="1.åè½¬å­—ç¬¦ä¸²"></a>1.åè½¬å­—ç¬¦ä¸²</h3><p><strong>[ç¬¬344é¢˜]</strong> ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„char[]çš„å½¢å¼ç»™å‡ºã€‚ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨O(1)çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ASCIIç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼š[â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€]<br>è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€]</li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼š[â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€]<br>è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€] </li>
</ul>
<blockquote>
<p>è¿™æ˜¯ä¸€é“ç›¸å½“ç®€å•çš„ç»å…¸é¢˜ç›®ï¼Œç›´æ¥ä¸Šé¢˜è§£ï¼šä½¿ç”¨åŒæŒ‡é’ˆè¿›è¡Œåè½¬å­—ç¬¦ä¸²ã€‚<br>å‡è®¾è¾“å…¥å­—ç¬¦ä¸²ä¸º[â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€0â€]<br>å®šä¹‰leftå’Œrightåˆ†åˆ«æŒ‡å‘é¦–å…ƒç´ å’Œå°¾å…ƒç´ <br>å½“left &lt; right ï¼Œè¿›è¡Œäº¤æ¢ã€‚<br>äº¤æ¢å®Œæ¯•ï¼Œleft++ï¼Œrightâ€”<br>ç›´è‡³left == right</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseString</span>(<span class="params">self, s: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify s in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="built_in">len</span>(s) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            s[left], s[right] = s[right], s[left]</span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line">            right -= <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:48 ms,å‡»è´¥äº†77.38% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.6 MB,å‡»è´¥äº†7.10% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="keyword">char</span>[] s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = s.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right)&#123;</span><br><span class="line">            swap(s, left, right);</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">char</span>[] ch,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> temp = ch[i];</span><br><span class="line">        ch[i] = ch[j];</span><br><span class="line">        ch[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š45.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†33.90% çš„ç”¨æˆ·</p>
<h3 id="2-å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦"><a href="#2-å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦" class="headerlink" title="2.å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦"></a>2.å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦</h3><p><strong>[ç¬¬387é¢˜]</strong> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ï¼Œå¹¶è¿”å›å®ƒçš„ç´¢å¼•ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>s = â€œleetcodeâ€ è¿”å› 0<br>s = â€œloveleetcodeâ€ è¿”å› 2</li>
</ul>
<p>æç¤ºï¼šä½ å¯ä»¥å‡å®šè¯¥å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚</p>
<p><strong>æ–¹æ³•ä¸€ï¼šç”¨å­—å…¸</strong></p>
<blockquote>
<p>åœ¨æ•°ç»„ä¸­è®°å½•æ¯ä¸ªå­—æ¯çš„æœ€åä¸€æ¬¡å‡ºç°çš„æ‰€åœ¨ç´¢å¼•ã€‚ç„¶åå†é€šè¿‡ä¸€æ¬¡å¾ªç¯ï¼Œæ¯”è¾ƒå„ä¸ªå­—æ¯ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•æ˜¯å¦ä¸ºæœ€åä¸€æ¬¡çš„ç´¢å¼•ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå¦‚æœä¸æ˜¯æˆ‘ä»¬å°†å…¶è®¾ä¸º -1ï¼ˆæ ‡ç¤ºè¯¥å…ƒç´ éç›®æ ‡å…ƒç´ ï¼‰å¦‚æœç¬¬äºŒæ¬¡éå†æœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡ï¼Œç›´æ¥è¿”å› -1å³å¯ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstUniqChar</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="built_in">dict</span>[s[i]] = i</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="built_in">dict</span>[s[i]]:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">dict</span>[s[i]] = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:128 ms,å‡»è´¥äº†61.83% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†5.07% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstUniqChar</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length(); i++) map.put(s.charAt(i), i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (i == map.get(s.charAt(i))) <span class="keyword">return</span> i;</span><br><span class="line">            <span class="keyword">else</span> map.put(s.charAt(i), -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š35 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†27.69% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†27.58% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šç”¨é›†åˆ</strong></p>
<blockquote>
<p>é›†åˆçš„ç‰¹æ€§ä¸ºé›†åˆä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç‰¹æ€§ï¼Œå°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstUniqChar</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># è½¬ä¸ºé›†åˆ, å°†å»é‡åçš„é›†åˆå†è½¬åŒ–ä¸ºåˆ—è¡¨</span></span><br><span class="line">        unique = <span class="built_in">list</span>(<span class="built_in">set</span>(s))</span><br><span class="line">        <span class="comment"># æŒ‰åŸåˆ—è¡¨ç´¢å¼•æ’åºï¼Œä¸æ”¹å˜é¡ºåº</span></span><br><span class="line">        unique.sort(key=s.index)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> unique:</span><br><span class="line">            <span class="keyword">if</span> s.count(i) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> s.index(i)</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:76 ms,å‡»è´¥äº†94.58% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†5.07% çš„Python3ç”¨æˆ·</p>
<h3 id="3-å®ç°SundayåŒ¹é…"><a href="#3-å®ç°SundayåŒ¹é…" class="headerlink" title="3.å®ç°SundayåŒ¹é…"></a>3.å®ç°SundayåŒ¹é…</h3><p><strong>[ç¬¬28é¢˜]</strong> å®ç°strStr()å‡½æ•°ã€‚ç»™å®šä¸€ä¸ªhaystackå­—ç¬¦ä¸²å’Œä¸€ä¸ªneedleå­—ç¬¦ä¸²ï¼Œåœ¨haystackå­—ç¬¦ä¸²ä¸­æ‰¾å‡ºneedleå­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: haystack = â€œhelloâ€, needle = â€œllâ€<br>è¾“å‡º: 2</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: haystack = â€œaaaaaâ€, needle = â€œbbaâ€<br>è¾“å‡º: -1</li>
</ul>
<p>è¯´æ˜:<br>å½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚ </p>
<p>å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“needleæ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å›0 ã€‚è¿™ä¸Cè¯­è¨€çš„strstr()ä»¥åŠJavaçš„indexOf()å®šä¹‰ç›¸ç¬¦ã€‚ </p>
<blockquote>
<p>å…ˆæ™®åŠå‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>ä¸²ï¼šä¸²æ˜¯å­—ç¬¦ä¸²çš„ç®€ç§°</li>
<li>ç©ºä¸²ï¼šé•¿åº¦ä¸ºé›¶çš„ä¸²ç§°ä¸ºç©ºä¸²</li>
<li>ä¸»ä¸²ï¼šåŒ…å«å­ä¸²çš„ä¸²ç›¸åº”åœ°ç§°ä¸ºä¸»ä¸²</li>
<li>å­ä¸²ï¼šä¸²ä¸­ä»»æ„ä¸ªè¿ç»­å­—ç¬¦ç»„æˆçš„å­åºåˆ—ç§°ä¸ºè¯¥ä¸²çš„å­ä¸²</li>
<li>æ¨¡å¼ä¸²ï¼šå­ä¸²çš„å®šä½è¿ç®—åˆç§°ä¸ºä¸²çš„æ¨¡å¼åŒ¹é…ï¼Œæ˜¯ä¸€ç§æ±‚å­ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨ä¸»ä¸²ä¸­åºå·çš„è¿ç®—ã€‚è¢«åŒ¹é…çš„ä¸»ä¸²ç§°ä¸ºç›®æ ‡ä¸²ï¼Œå­ä¸²ç§°ä¸ºæ¨¡å¼ä¸²ã€‚</li>
</ul>
<p>å¯¹äºSUNDAYç®—æ³•ï¼Œæˆ‘ä»¬<strong>ä»å¤´éƒ¨å¼€å§‹æ¯”è¾ƒï¼Œä¸€æ—¦å‘ç°ä¸åŒ¹é…ï¼Œç›´æ¥æ‰¾åˆ°ä¸»ä¸²ä¸­ä½äºæ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</strong>ï¼Œå³ä¸‹é¢ç»¿è‰²çš„ â€œsâ€ã€‚ï¼ˆå› ä¸ºï¼Œæ— è®ºæ¨¡å¼ä¸²ç§»åŠ¨å¤šå°‘æ­¥ï¼Œæ¨¡å¼ä¸²åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½è¦å‚ä¸ä¸‹ä¸€æ¬¡æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ â€œsâ€ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/53.png" alt></p>
<p>æ‰¾åˆ°äº†æ¨¡å¼ä¸²åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ â€œsâ€ï¼Œæ¥ä¸‹æ¥è¯¥æ€ä¹ˆåšï¼Ÿæˆ‘ä»¬éœ€è¦<strong>æŸ¥çœ‹æ¨¡å¼ä¸²ä¸­æ˜¯å¦åŒ…å«è¿™ä¸ªå…ƒç´ ï¼Œå¦‚æœä¸åŒ…å«é‚£å°±å¯ä»¥è·³è¿‡ä¸€å¤§ç‰‡ï¼Œä»è¯¥å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ¯”è¾ƒã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/54.png" alt></p>
<p>å› ä¸ºä»ç„¶ä¸åŒ¹é…ï¼ˆç©ºæ ¼å’Œlï¼‰ï¼Œæˆ‘ä»¬ç»§ç»­é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚æ‰¾åˆ°æ¨¡å¼ä¸²çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼št</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/55.png" alt></p>
<p>ç°åœ¨æœ‰æ„æ€äº†ï¼Œæˆ‘ä»¬å‘ç°tè¢«åŒ…å«äºæ¨¡å¼ä¸²ä¸­ï¼Œå¹¶ä¸”tå‡ºç°åœ¨æ¨¡å¼ä¸²å€’æ•°ç¬¬3ä¸ªã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠæ¨¡å¼ä¸²å‘å‰ç§»åŠ¨3ä¸ªå•ä½ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/56.png" alt></p>
<p>æå¹²è´§ï¼Œè¿™ä¸ªè¿‡ç¨‹é‡Œæˆ‘ä»¬åšäº†ä¸€äº›ä»€ä¹ˆï¼š</p>
<ul>
<li>å¯¹é½ç›®æ ‡ä¸²å’Œæ¨¡å¼ä¸²ï¼Œä»å‰å‘ååŒ¹é…</li>
<li><strong>å…³æ³¨ä¸»ä¸²ä¸­ä½äºæ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæ ¸å¿ƒï¼‰</strong></li>
<li>å¦‚æœå…³æ³¨çš„å­—ç¬¦æ²¡æœ‰åœ¨å­ä¸²ä¸­å‡ºç°åˆ™ç›´æ¥è·³è¿‡</li>
<li>å¦åˆ™å¼€å§‹ç§»åŠ¨æ¨¡å¼ä¸²ï¼Œç§»åŠ¨ä½æ•° = å­ä¸²é•¿åº¦ - è¯¥å­—ç¬¦æœ€å³å‡ºç°çš„ä½ç½®(ä»¥0å¼€å§‹)</li>
</ul>
</blockquote>
<p>ç„¶è€Œè¿™ç§æ–¹æ³•ï¼Œæˆ‘è¿™é‡Œç”¨Pythonå†™ä¼šè¶…æ—¶ï¼Œä¼°è®¡åŸå› åœ¨äºæŸ¥æ‰¾ç´¢å¼•å¤ªè€—æ—¶ï¼Œè¿˜æ˜¯ç”¨å­ä¸²é€ä¸€æ¯”è¾ƒæ¥çš„å®åœ¨<img src="file:///C:\Users\Qiyuan-Z\AppData\LocalLow\Baidu\BAIDUP~1\dict\Default\0F25D2~1.PNG" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">strStr</span>(<span class="params">self, haystack: <span class="built_in">str</span>, needle: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        L, n = <span class="built_in">len</span>(needle), <span class="built_in">len</span>(haystack)</span><br><span class="line">        <span class="keyword">for</span> start <span class="keyword">in</span> <span class="built_in">range</span>(n - L + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> haystack[start: start + L] == needle:</span><br><span class="line">                <span class="keyword">return</span> start</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†97.51% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†17.10% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">strStr</span><span class="params">(String haystack, String needle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (haystack == <span class="keyword">null</span> || needle == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (haystack.length() &lt; needle.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç›®æ ‡ä¸²åŒ¹é…ç´¢</span></span><br><span class="line">        <span class="keyword">int</span> originIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//æ¨¡å¼ä¸²åŒ¹é…ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">int</span> aimIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æˆåŠŸåŒ¹é…å®Œç»ˆæ­¢æ¡ä»¶ï¼šæ‰€æœ‰needleå‡æˆåŠŸåŒ¹é…</span></span><br><span class="line">        <span class="keyword">while</span> (aimIndex &lt; needle.length()) &#123;</span><br><span class="line">            <span class="comment">// é’ˆå¯¹originåŒ¹é…å®Œï¼Œä½†needleæœªåŒ¹é…å®Œæƒ…å†µå¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (originIndex &gt; haystack.length() - <span class="number">1</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (haystack.charAt(originIndex) == needle.charAt(aimIndex)) &#123;</span><br><span class="line">                <span class="comment">// åŒ¹é…åˆ™indexå‡åŠ 1</span></span><br><span class="line">                originIndex++;</span><br><span class="line">                aimIndex++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//ä¸‹ä¸€ä¸ªç›®æ ‡å­—ç¬¦ç´¢å¼•</span></span><br><span class="line">                <span class="keyword">int</span> nextCharIndex = originIndex - aimIndex + needle.length();</span><br><span class="line">                <span class="comment">//åˆ¤æ–­ä¸‹ä¸€ä¸ªç›®æ ‡å­—ç¬¦ï¼ˆå›¾é‡Œçš„é‚£ä¸ªç»¿æ¡†æ¡†ï¼‰æ˜¯å¦å­˜åœ¨ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (nextCharIndex &lt; haystack.length()) &#123;</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­ç›®æ ‡å­—ç¬¦åœ¨æ¨¡å¼ä¸²ä¸­åŒ¹é…åˆ°ï¼Œè¿”å›æœ€åä¸€ä¸ªåŒ¹é…çš„index</span></span><br><span class="line">                    <span class="keyword">int</span> step = needle.lastIndexOf(haystack.charAt(nextCharIndex));</span><br><span class="line">                    <span class="keyword">if</span> (step == -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// ä¸å­˜åœ¨çš„è¯ï¼Œè®¾ç½®åˆ°ç›®æ ‡å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                        originIndex = nextCharIndex + <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å­˜åœ¨çš„è¯ï¼Œç§»åŠ¨å¯¹åº”çš„æ•°å­—ï¼ˆå‚è€ƒä¸Šæ–‡ä¸­çš„å­˜åœ¨å…¬å¼ï¼‰</span></span><br><span class="line">                        originIndex = nextCharIndex - step;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//æ¨¡å¼ä¸²æ€»æ˜¯ä»ç¬¬ä¸€ä¸ªå¼€å§‹åŒ¹é…</span></span><br><span class="line">                    aimIndex = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> originIndex - aimIndex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†28.87% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†68.02% çš„ç”¨æˆ·</p>
<h3 id="4-å¤§æ•°æ‰“å°"><a href="#4-å¤§æ•°æ‰“å°" class="headerlink" title="4.å¤§æ•°æ‰“å°"></a>4.å¤§æ•°æ‰“å°</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‰‘æŒ‡offer 17ï¼šå¤§æ•°æ‰“å°</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¾“å…¥æ•°å­—nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä»1åˆ°æœ€å¤§çš„nä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„3ä½æ•° 999ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n = 1 </span><br><span class="line">è¾“å‡º: [1,2,3,4,5,6,7,8,9]</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>ç”¨è¿”å›ä¸€ä¸ªæ•´æ•°åˆ—è¡¨æ¥ä»£æ›¿æ‰“å°</li>
<li>n ä¸ºæ­£æ•´æ•°</li>
</ul>
<p><strong>é¢˜ç›®å‡çº§</strong>ï¼š <strong>è¿™é“é¢˜ç›®çš„åå­—å«åšå¤§æ•°æ‰“å°ï¼Œå¦‚æœé˜ˆå€¼è¶…å‡ºlongç±»å‹ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¯·æ‰‹åŠ¨å®ç°ä¸€ä¸‹ï¼</strong></p>
<blockquote>
<p><strong>é‡‡ç”¨æ•°ç»„è¿›è¡Œå­˜å‚¨</strong>ã€‚</p>
<ul>
<li>å¯¹æœ€ä½ä½nSumçš„å€¼é€’å¢ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²åŠ 1è¿ç®—ï¼‰ï¼Œå½“å¤§äºç­‰äº10æ—¶ï¼Œæˆ‘ä»¬æŠŠè¿›ä½æ ‡è¯†æ”¹ä¸º1ï¼ŒåŒæ—¶æ¢å¤å¯¹nSumå‡10ï¼ˆ29-31ï¼‰</li>
<li>é€šè¿‡åˆ¤æ–­é¦–ä½æ˜¯å¦è¿›ä½æ¥åˆ¤æ–­åˆ°è¾¾æœ€å¤§çš„nä½æ•°æƒ…å†µã€‚æ¯”å¦‚n=4ï¼Œåªæœ‰å¯¹9999åŠ 1ï¼Œæ‰ä¼šå¯¹ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›ä½ã€‚</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printNumbers</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        result = []</span><br><span class="line">        num = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        isBegin = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> isBegin:</span><br><span class="line">            <span class="comment"># tmpç”¨äºå­˜å‚¨è¿›ä½ï¼Œåˆå§‹å€¼ä¸º1ä»£è¡¨åŠ 1</span></span><br><span class="line">            tmp = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                <span class="comment"># python divmod() å‡½æ•°æŠŠé™¤æ•°å’Œä½™æ•°è¿ç®—ç»“æœç»“åˆèµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å•†å’Œä½™æ•°çš„å…ƒç»„(a // b, a % b)ã€‚</span></span><br><span class="line">                tmp, num[i] = <span class="built_in">divmod</span>(num[i] + tmp, <span class="number">10</span>)</span><br><span class="line">                <span class="keyword">if</span> tmp &gt; <span class="number">0</span> <span class="keyword">and</span> i != <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">elif</span> tmp == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># ç›´åˆ°æœ€åä¸€ä½ä»è¿›ä½å°±ç»“æŸ</span></span><br><span class="line">                    isBegin = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> isBegin:</span><br><span class="line">                result.append(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, num))))</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š200 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†5.22% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š20.3 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†18.63% çš„ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] printNumbers(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">int</span> max = (<span class="keyword">int</span>)Math.pow(<span class="number">10</span>, n)-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line">        <span class="keyword">char</span>[] num  = <span class="keyword">new</span> <span class="keyword">char</span>[n];</span><br><span class="line">        Arrays.fill(num, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> isBegin = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(isBegin)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =n-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">                <span class="keyword">int</span> sum = num[i] - <span class="string">&#x27;0&#x27;</span> + tmp;</span><br><span class="line">                num[i] = (<span class="keyword">char</span>) (sum % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                tmp = sum / <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">if</span>(tmp &gt; <span class="number">0</span> &amp;&amp; i != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(tmp == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">else</span> isBegin = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(isBegin) res[index++] = saveNumber(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveNumber</span><span class="params">(<span class="keyword">char</span>[] number)</span> </span>&#123;</span><br><span class="line">        String res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">boolean</span> isBegin = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : number) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isBegin &amp;&amp; c != <span class="string">&#x27;0&#x27;</span>) isBegin = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (isBegin) res += c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š60 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.31% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š46.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†91.10% çš„ç”¨æˆ·</p>
<h3 id="5-éªŒè¯å›æ–‡ä¸²"><a href="#5-éªŒè¯å›æ–‡ä¸²" class="headerlink" title="5.éªŒè¯å›æ–‡ä¸²"></a>5.éªŒè¯å›æ–‡ä¸²</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬125é¢˜ï¼šéªŒè¯å›æ–‡ä¸²</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>è¯´æ˜ï¼š</strong> æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²å®šä¹‰ä¸ºæœ‰æ•ˆçš„å›æ–‡ä¸²ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;A man, a plan, a canal: Panama&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;race a car&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€œå›æ–‡ä¸²â€æ˜¯ä¸€ä¸ªæ­£è¯»å’Œåè¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚â€œlevelâ€æˆ–è€…â€œnoonâ€ç­‰ç­‰å°±æ˜¯å›æ–‡ä¸²ã€‚</p>
<p>å½“ç„¶ï¼Œå¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå› ä¸ºåŸå­—ç¬¦ä¸²è¿˜åŒ…æ‹¬äº†é™¤å­—æ¯ï¼Œæ•°å­—ä¹‹å¤–çš„ä¸€äº›å¹ºè›¾å­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†å…¶æ›¿æ¢æˆ–è·³è¿‡ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="comment"># è½¬æ¢æˆå°å†™</span></span><br><span class="line">        s = s.lower()</span><br><span class="line">        <span class="comment"># ä¸¤å¤´éå†æ¯”å¯¹</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        j = <span class="built_in">len</span>(s) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; j:</span><br><span class="line">        	<span class="comment"># è·³è¿‡ç‰¹æ®Šç¬¦å·</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> ((s[i] &gt;= <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> s[i] &lt;= <span class="string">&#x27;9&#x27;</span>) <span class="keyword">or</span> (s[i] &gt;= <span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> s[i] &lt;= <span class="string">&#x27;z&#x27;</span>)):</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> ((s[j] &gt;= <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> s[j] &lt;= <span class="string">&#x27;9&#x27;</span>) <span class="keyword">or</span> (s[j] &gt;= <span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> s[j] &lt;= <span class="string">&#x27;z&#x27;</span>)):</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> s[i] != s[j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:60 ms,å‡»è´¥äº†61.53% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.8 MB,å‡»è´¥äº†53.68% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String str = s.toLowerCase();</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> r = str.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!((str.charAt(l) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; str.charAt(l) &lt;= <span class="string">&#x27;9&#x27;</span>) || (str.charAt(l) &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; str.charAt(l) &lt;= <span class="string">&#x27;z&#x27;</span>)))&#123;</span><br><span class="line">                l++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!((str.charAt(r) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; str.charAt(r) &lt;= <span class="string">&#x27;9&#x27;</span>) || (str.charAt(r) &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; str.charAt(r) &lt;= <span class="string">&#x27;z&#x27;</span>)))&#123;</span><br><span class="line">                r--;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(str.charAt(l) != str.charAt(r)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            l++;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†64.94% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.4 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†73.12% çš„ç”¨æˆ·</p>
<h3 id="6-KMP"><a href="#6-KMP" class="headerlink" title="6.KMP"></a>6.KMP</h3><blockquote>
<p>KMP ç®—æ³•å¸¸è¢«ç§°ä¸ºâ€œçœ‹æ¯›ç‰‡ç®—æ³•â€ï¼Œç”±ä¸€ä¸ªå§“Kçš„ï¼Œä¸€ä¸ªå§“Mçš„ï¼Œä¸€ä¸ªå§“P ä¸€èµ·æå‡ºã€‚<strong>æ˜¯ä¸€ç§ç”±æš´åŠ›åŒ¹é…æ”¹è¿›çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/57.png" alt></p>
<p>æš´åŠ›åŒ¹é…ï¼Œå°±æ˜¯ç›®æ ‡ä¸²å’Œæ¨¡å¼ä¸²ä¸€ä¸ªä¸€ä¸ªçš„å¯¹æ¯”ã€‚å‡è‹¥æˆ‘ä»¬ç›®æ ‡ä¸²é•¿åº¦ä¸ºmï¼Œæ¨¡å¼ä¸²é•¿åº¦ä¸ºnã€‚æ¨¡å¼ä¸²ä¸ç›®æ ‡ä¸²è‡³å°‘æ¯”è¾ƒmæ¬¡ï¼Œåˆå› å…¶è‡ªèº«é•¿åº¦ä¸ºnï¼Œæ‰€ä»¥ç†è®ºçš„æ—¶é—´å¤æ‚åº¦ä¸º<strong>O(m*n)ã€‚</strong> ä½†å› ä¸ºé€”ä¸­é‡åˆ°ä¸èƒ½åŒ¹é…çš„å­—ç¬¦æ—¶ï¼Œå°±å¯ä»¥åœæ­¢ï¼Œå¹¶ä¸éœ€è¦å®Œå…¨å¯¹æ¯”ï¼ˆæ¯”å¦‚ä¸Šå›¾ç¬¬2è¡Œï¼‰<strong>ã€‚æ‰€ä»¥è™½ç„¶ç†è®ºæ—¶é—´å¤æ‚åº¦ä¸º </strong>O(m*n) ï¼Œä½†å…¶å®å¤§éƒ¨åˆ†æƒ…å†µæ•ˆç‡é«˜å¾ˆå¤šã€‚</p>
<p>ä¸‹é¢ç›´æ¥ç»™å‡º <strong>KMPç®—æ³•</strong> çš„æ“ä½œæµç¨‹ï¼š</p>
<ul>
<li>å‡è®¾ç°åœ¨æ–‡æœ¬ä¸² S åŒ¹é…åˆ° i ä½ç½®ï¼Œæ¨¡å¼ä¸² P åŒ¹é…åˆ° j ä½ç½®</li>
<li>å¦‚æœ j = -1ï¼Œæˆ–è€…å½“å‰å­—ç¬¦åŒ¹é…æˆåŠŸï¼ˆå³ S[i] == P[j] ï¼‰ï¼Œéƒ½ä»¤ i++ï¼Œj++ï¼Œç»§ç»­åŒ¹é…ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼›   å¦‚æœ j !=  -1ï¼Œä¸”å½“å‰å­—ç¬¦åŒ¹é…å¤±è´¥ï¼ˆå³ S[i] != P[j] ï¼‰ï¼Œåˆ™ä»¤ i ä¸å˜ï¼Œj = next[j]ã€‚æ­¤ä¸¾æ„å‘³ç€å¤±é…æ—¶ï¼Œæ¨¡å¼ä¸² Pç›¸å¯¹äºæ–‡æœ¬ä¸² S å‘å³ç§»åŠ¨äº† j - next [j]  ä½</li>
<li>æ¢è¨€ä¹‹ï¼Œå°†æ¨¡å¼ä¸² P å¤±é…ä½ç½®çš„ next æ•°ç»„çš„å€¼å¯¹åº”çš„æ¨¡å¼ä¸² P çš„ç´¢å¼•ä½ç½®ç§»åŠ¨åˆ°å¤±é…å¤„</li>
</ul>
<p>ä»¥ä¸‹å›¾æ–‡æœ¬ä¸² S ä¸æ¨¡å¼ä¸² P ä¸ºä¾‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/58.jpg" alt><br>æ±‚å¾—æ¯ä¸€ä¸ªå­ä¸²çš„æ‰€æœ‰å‰ç¼€ä¸åç¼€ã€‚<br><strong>å‰ç¼€</strong>æŒ‡é™¤äº†æœ€åä¸€ä¸ªå­—ç¬¦ä»¥å¤–ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²çš„å…¨éƒ¨å¤´éƒ¨ç»„åˆï¼›<strong>åç¼€</strong>æŒ‡é™¤äº†ç¬¬ä¸€ä¸ªå­—ç¬¦ä»¥å¤–ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²çš„å…¨éƒ¨å°¾éƒ¨ç»„åˆã€‚</p>
<p>æ±‚å¾—åŸæ¨¡å¼ä¸² P çš„å­ä¸²å¯¹åº”çš„å„ä¸ªå‰ç¼€åç¼€çš„å…¬å…±å…ƒç´ çš„<strong>æœ€å¤§é•¿åº¦è¡¨</strong>ä¸‹å›¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/59.jpg" alt></p>
<p>æ ¹æ®<strong>æœ€å¤§é•¿åº¦è¡¨</strong>å»æ±‚<strong>nextæ•°ç»„</strong>ï¼š<strong>nextæ•°ç»„ç›¸å½“äºâ€œæœ€å¤§é•¿åº¦å€¼â€ æ•´ä½“å‘å³ç§»åŠ¨ä¸€ä½ï¼Œç„¶ååˆå§‹å€¼èµ‹ä¸º-1</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/60.jpg" alt></p>
<p>å¥½äº†ï¼Œè·å–äº†<strong>next æ•°ç»„</strong>åï¼Œ<strong>KMP ç®—æ³•</strong>çš„æ“ä½œå°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<p>å°†æ¨¡å¼ä¸² P ä¸æ–‡æœ¬ä¸² S çš„å­—æ¯ä¸€ä¸ªä¸ªè¿›è¡ŒåŒ¹é…ï¼Œå½“å¤±é…çš„æ—¶å€™ï¼Œæ¨¡å¼ä¸²å‘å³ç§»åŠ¨ã€‚æ¯”å¦‚æ¨¡å¼ä¸²çš„ <strong>b</strong> ä¸æ–‡æœ¬ä¸²çš„ <strong>c</strong> å¤±é…äº†ï¼Œæ‰¾å‡ºå¤±é…å¤„æ¨¡å¼ä¸²çš„<strong>nextæ•°ç»„</strong>é‡Œé¢å¯¹åº”çš„å€¼ï¼Œè¿™é‡Œä¸º <strong>0</strong>ï¼Œç„¶åå°†ç´¢å¼•ä¸º <strong>0</strong> çš„ä½ç½®ç§»åŠ¨åˆ°å¤±é…å¤„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/61.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/62.jpg" alt></p>
</blockquote>
<p>ä¾‹å­ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/156.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/154.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/155.png" alt></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KMPAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">&quot;BBC ABCDAB ABCDABCDABDE&quot;</span>;</span><br><span class="line">        String str2 = <span class="string">&quot;ABCDABD&quot;</span>;</span><br><span class="line">        <span class="comment">//å¾—åˆ°ç›®æ ‡å­ä¸²çš„éƒ¨åˆ†åŒ¹é…å€¼</span></span><br><span class="line">        <span class="keyword">int</span>[] next = kmpNext(str2);</span><br><span class="line">        System.out.println(<span class="string">&quot;next=&quot;</span>+ Arrays.toString(next));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> index = kmpSearch(str1, str2, next);</span><br><span class="line">        System.out.println(<span class="string">&quot;index= &quot;</span> +index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str1 æºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str2 å­ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> next éƒ¨åˆ†åŒ¹é…è¡¨ï¼Œæ˜¯å­ä¸²å¯¹åº”çš„éƒ¨åˆ†åŒ¹é…è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœæ˜¯-1å°±æ˜¯æ²¡æœ‰åŒ¹é…åˆ°ï¼Œå¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„ä½ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmpSearch</span><span class="params">(String str1, String str2, <span class="keyword">int</span>[] next)</span></span>&#123;</span><br><span class="line">        <span class="comment">//éå†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>; i&lt; str1.length(); i++) &#123;</span><br><span class="line">            <span class="comment">//è‹¥åŒ¹é…ä¸æˆåŠŸï¼Œç›®æ ‡å­ä¸²åç§», ç§»åŠ¨ä½æ•°ä¸ºï¼ˆå·²åŒ¹é…å­—ç¬¦æ•°-éƒ¨åˆ†åŒ¹é…å€¼ï¼‰ç›¸å½“äºnextå³ç§»</span></span><br><span class="line">            <span class="comment">//å› æ­¤j = j - next[j-1]æˆ–j = next[j-1]éƒ½å¯</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">0</span> &amp;&amp; str1.charAt(i) != str2.charAt(j)) j= next[j-<span class="number">1</span>];</span><br><span class="line">            <span class="comment">//è®°å½•å·²åŒ¹é…çš„å­—ç¬¦æ•°</span></span><br><span class="line">            <span class="keyword">if</span> (str1.charAt(i) == str2.charAt(j)) j++;</span><br><span class="line">            <span class="comment">//åŒ¹é…æˆåŠŸ, è¿”å›ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">if</span> (j == str2.length()) <span class="keyword">return</span> i-j+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›-1</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå­ä¸²ï¼‰çš„éƒ¨åˆ†åŒ¹é…å€¼è¡¨</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">int</span>[] kmpNext(String dest)&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªnextæ•°ç»„ä¿å­˜éƒ¨åˆ†åŒ¹é…å€¼</span></span><br><span class="line">        <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[dest.length()];</span><br><span class="line">        next[<span class="number">0</span>] = <span class="number">0</span>;<span class="comment">//å¦‚æœå­—ç¬¦ä¸²æ˜¯é•¿åº¦ä¸º1éƒ¨åˆ†åŒ¹é…å€¼å°±æ˜¯0</span></span><br><span class="line">        <span class="comment">// iç›¸å½“äºåç¼€ï¼Œä¸€æ­¥æ­¥éå†ç›®æ ‡ä¸²çš„å­ä¸², jä»£è¡¨å…¬å…±å‰ç¼€é•¿</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>, j=<span class="number">0</span>; i&lt; dest.length(); i++)&#123;</span><br><span class="line">            <span class="comment">//è‹¥åç¼€ä¸ç­‰äºå‰ç¼€ï¼Œåˆ™å…¬å…±å‰ç¼€é•¿å½’0</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">0</span> &amp;&amp; dest.charAt(i) != dest.charAt(j)) j = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">//éšç€åç¼€é•¿åº¦å¢åŠ  è‹¥åç¼€ä¸€ç›´ç­‰äºå‰ç¼€ï¼Œå…¬å…±å‰ç¼€é•¿+1</span></span><br><span class="line">            <span class="keyword">if</span> (dest.charAt(i) == dest.charAt(j)) j++;</span><br><span class="line">            <span class="comment">//éƒ¨åˆ†åŒ¹é…å€¼ä¸ºå…¬å…±å‰ç¼€é•¿</span></span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-æ—‹è½¬å­—ç¬¦ä¸²"><a href="#7-æ—‹è½¬å­—ç¬¦ä¸²" class="headerlink" title="7.æ—‹è½¬å­—ç¬¦ä¸²"></a>7.æ—‹è½¬å­—ç¬¦ä¸²</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬796é¢˜ï¼šæ—‹è½¬å­—ç¬¦ä¸²</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸², A å’Œ Bã€‚A çš„æ—‹è½¬æ“ä½œå°±æ˜¯å°† A æœ€å·¦è¾¹çš„å­—ç¬¦ç§»åŠ¨åˆ°æœ€å³è¾¹ã€‚ä¾‹å¦‚, è‹¥ A = â€˜abcdeâ€™ï¼Œåœ¨ç§»åŠ¨ä¸€æ¬¡ä¹‹åç»“æœå°±æ˜¯â€™bcdeaâ€™ ã€‚å¦‚æœåœ¨è‹¥å¹²æ¬¡æ—‹è½¬æ“ä½œä¹‹åï¼ŒA èƒ½å˜æˆBï¼Œé‚£ä¹ˆè¿”å›Trueã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: A = &#x27;abcde&#x27;, B = &#x27;cdeab&#x27;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: A = &#x27;abcde&#x27;, B = &#x27;abced&#x27;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> A å’Œ B é•¿åº¦ä¸è¶…è¿‡ 100ã€‚</p>
<blockquote>
<p>æ— è®ºå®ƒæ€æ ·æ—‹è½¬ï¼Œæœ€ç»ˆçš„ A + AåŒ…å«äº†æ‰€æœ‰å¯ä»¥é€šè¿‡æ—‹è½¬æ“ä½œä» A å¾—åˆ°çš„å­—ç¬¦ä¸²ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/63.png" alt><br>é‚£æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ B æ˜¯å¦ä¸º A + A çš„å­ä¸²å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotateString</span>(<span class="params">self, A: <span class="built_in">str</span>, B: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(A) == <span class="built_in">len</span>(B) <span class="keyword">and</span> (B <span class="keyword">in</span> (A + A))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†35.30% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†48.35% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rotateString</span><span class="params">(String A, String B)</span> </span>&#123;</span><br><span class="line">        String s = A + A;</span><br><span class="line">        <span class="keyword">return</span> A.length()==B.length() &amp;&amp; s.contains(B)?<span class="keyword">true</span>: <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†37.20% çš„ç”¨æˆ·</p>
<h3 id="8-æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦"><a href="#8-æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦" class="headerlink" title="8.æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦"></a>8.æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬58é¢˜ï¼šæœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªä»…åŒ…å«å¤§å°å†™å­—æ¯å’Œç©ºæ ¼ â€˜ â€˜ çš„å­—ç¬¦ä¸² sï¼Œè¿”å›å…¶æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦ã€‚å¦‚æœå­—ç¬¦ä¸²ä»å·¦å‘å³æ»šåŠ¨æ˜¾ç¤ºï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå•è¯å°±æ˜¯æœ€åå‡ºç°çš„å•è¯ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;Hello World&quot; </span><br><span class="line">è¾“å‡º: 5</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜ï¼š</strong> ä¸€ä¸ªå•è¯æ˜¯æŒ‡ä»…ç”±å­—æ¯ç»„æˆã€ä¸åŒ…å«ä»»ä½•ç©ºæ ¼å­—ç¬¦çš„ <strong>æœ€å¤§å­å­—ç¬¦ä¸²</strong>ã€‚</p>
<blockquote>
<p>é¢˜ä¸­çš„é™·é˜±åœ¨äºï¼Œ<strong>ç»“å°¾å¤„ä»ç„¶å¯èƒ½æœ‰ç©ºæ ¼</strong>ã€‚</p>
<p>æ‰€ä»¥ä¸€èˆ¬çš„è§£é¢˜æ€è·¯ä¸ºï¼Œå…ˆå»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œç„¶åä»å°¾å‘å‰å¼€å§‹éå†ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼å¤„ç»“æŸã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLastWord</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># å»é™¤å­—ç¬¦ä¸²å¼€å¤´æˆ–è€…ç»“å°¾çš„ç©ºæ ¼,å†æŒ‰ç©ºæ ¼åˆ’åˆ†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(s.strip().split(<span class="string">&#x27; &#x27;</span>)[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†94.69% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†12.63% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLastWord</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String[] str = s.trim().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> str[str.length-<span class="number">1</span>].length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†38.46% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†8.91% çš„ç”¨æˆ·</p>
<h2 id="äºŒå‰æ ‘ç³»åˆ—"><a href="#äºŒå‰æ ‘ç³»åˆ—" class="headerlink" title="äºŒå‰æ ‘ç³»åˆ—"></a>äºŒå‰æ ‘ç³»åˆ—</h2><h3 id="1-æœ€å¤§æ·±åº¦ä¸DFS"><a href="#1-æœ€å¤§æ·±åº¦ä¸DFS" class="headerlink" title="1.æœ€å¤§æ·±åº¦ä¸DFS"></a>1.æœ€å¤§æ·±åº¦ä¸DFS</h3><blockquote>
<p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒäºŒå‰æ ‘æ˜¯æ¯ä¸ªç»“ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­æ ‘çš„æ ‘ç»“æ„ã€‚é€šå¸¸å­æ ‘è¢«ç§°ä½œâ€œå·¦å­æ ‘â€ï¼ˆleft subtreeï¼‰å’Œâ€œå³å­æ ‘â€ï¼ˆright subtreeï¼‰ã€‚äºŒå‰æ ‘å¸¸è¢«ç”¨äºå®ç°äºŒå‰æŸ¥æ‰¾æ ‘å’ŒäºŒå‰å †ã€‚æ ‘æ¯”é“¾è¡¨ç¨å¾®å¤æ‚ï¼Œå› ä¸ºé“¾è¡¨æ˜¯çº¿æ€§æ•°æ®ç»“æ„ï¼Œè€Œæ ‘ä¸æ˜¯ã€‚æ ‘çš„é—®é¢˜å¾ˆå¤šéƒ½å¯ä»¥ç”±å¹¿åº¦ä¼˜å…ˆæœç´¢æˆ–æ·±åº¦ä¼˜å…ˆæœç´¢è§£å†³ã€‚</p>
</blockquote>
<p><strong>[ç¬¬104é¢˜]</strong> ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">     / \</span><br><span class="line">    15  7</span><br></pre></td></tr></table></figure>
è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šé€’å½’æ±‚è§£</strong></p>
<blockquote>
<p>æ¯ä¸ªèŠ‚ç‚¹çš„æ·±åº¦ä¸å®ƒå·¦å³å­æ ‘çš„æ·±åº¦æœ‰å…³ï¼Œä¸”ç­‰äºå…¶å·¦å³å­æ ‘æœ€å¤§æ·±åº¦å€¼åŠ ä¸Š1ï¼Œå³<br><code>maxDepth(root) = max(maxDepth(root.left), maxDepth(root.right)) + 1</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxDepth</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(self.maxDepth(root.left), self.maxDepth(root.right)) + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:56 ms,å‡»è´¥äº†54.54% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.4 MB,å‡»è´¥äº†12.04% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> Math.max(maxDepth(root.left), maxDepth(root.right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†12.93% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šéé€’å½’DFS</strong></p>
<blockquote>
<p>DFSï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth First Searchï¼‰ï¼Œå¯¹äºäºŒå‰æ ‘è€Œè¨€ï¼Œå®ƒæ²¿ç€<strong>æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸€ç›´è¿›è¡Œåˆ°å·²å‘ç°ä»æºèŠ‚ç‚¹å¯è¾¾çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ­¢ã€‚</strong><br>å¦‚ä¸‹å›¾äºŒå‰æ ‘ï¼Œå®ƒçš„è®¿é—®é¡ºåºä¸ºï¼šA-B-D-E-C-F-G<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    a</span><br><span class="line">   / \</span><br><span class="line">  b    c</span><br><span class="line"> / \  / \</span><br><span class="line">d   e f  g</span><br></pre></td></tr></table></figure><br>è™½ç„¶æˆ‘ä»¬ç”¨é€’å½’çš„æ–¹å¼æ ¹æ®DFSçš„æ€æƒ³é¡ºåˆ©å®Œæˆäº†é¢˜ç›®ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å´æ˜¾è€Œæ˜“è§ã€‚å› ä¸ºåœ¨é€’å½’ä¸­ï¼Œå¦‚æœå±‚çº§è¿‡æ·±ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¿å­˜è¿‡å¤šçš„ä¸´æ—¶å˜é‡ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸€èˆ¬ä¸åœ¨åå°ä»£ç ä¸­ä½¿ç”¨é€’å½’çš„åŸå› ã€‚<br>äº‹å®ä¸Šï¼Œå‡½æ•°è°ƒç”¨çš„å‚æ•°æ˜¯é€šè¿‡æ ˆç©ºé—´æ¥ä¼ é€’çš„ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šå ç”¨çº¿ç¨‹çš„æ ˆèµ„æºã€‚è€Œé€’å½’è°ƒç”¨ï¼Œåªæœ‰èµ°åˆ°æœ€åçš„ç»“æŸç‚¹åå‡½æ•°æ‰èƒ½ä¾æ¬¡é€€å‡ºï¼Œè€Œæœªåˆ°è¾¾æœ€åçš„ç»“æŸç‚¹ä¹‹å‰ï¼Œå ç”¨çš„æ ˆç©ºé—´ä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼Œå¦‚æœé€’å½’è°ƒç”¨æ¬¡æ•°è¿‡å¤šï¼Œå°±å¯èƒ½å¯¼è‡´å ç”¨çš„æ ˆèµ„æºè¶…è¿‡çº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œä»è€Œå¯¼è‡´æ ˆæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºçš„å¼‚å¸¸é€€å‡ºã€‚<br>å¦‚ä½•å°†é€’å½’çš„ä»£ç è½¬åŒ–æˆéé€’å½’çš„å½¢å¼ã€‚è¿™é‡Œè¯·è®°ä½ï¼Œ<strong>99%çš„é€’å½’è½¬éé€’å½’ï¼Œéƒ½å¯ä»¥é€šè¿‡æ ˆæ¥è¿›è¡Œå®ç°ã€‚</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxDepth</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">#stackè®°å½•çš„æ˜¯èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">#æ˜¯åŒæ—¶å…¥æ ˆåŒæ—¶å‡ºæ ˆï¼Œlevelè®°å½•çš„æ˜¯èŠ‚ç‚¹åœ¨ç¬¬å‡ å±‚</span></span><br><span class="line">        stack = []</span><br><span class="line">        level = [<span class="number">1</span>]</span><br><span class="line">        maxdepth = <span class="number">0</span></span><br><span class="line">        stack.append(root)</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            <span class="comment">#stackä¸­çš„å…ƒç´ å’Œlevelä¸­çš„å…ƒç´ åŒæ—¶å‡ºæ ˆ</span></span><br><span class="line">            node = stack.pop()</span><br><span class="line">            temp = level.pop()</span><br><span class="line">            maxdepth = <span class="built_in">max</span>(temp, maxdepth)</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                <span class="comment"># åŒæ—¶å…¥æ ˆ</span></span><br><span class="line">                stack.append(node.right)</span><br><span class="line">                level.append(temp + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                <span class="comment"># åŒæ—¶å…¥æ ˆ</span></span><br><span class="line">                stack.append(node.left)</span><br><span class="line">                level.append(temp + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxdepth</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†97.17% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.6 MB,å‡»è´¥äº†81.81% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        Stack&lt;Integer&gt; level = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> maxdepth = <span class="number">0</span>;</span><br><span class="line">        stack.push(root);</span><br><span class="line">        level.push(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(!stack.empty())&#123;</span><br><span class="line">            TreeNode node = stack.pop();</span><br><span class="line">            <span class="keyword">int</span> tmp = level.pop();</span><br><span class="line">            maxdepth = Math.max(maxdepth, tmp);</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">                level.push(tmp+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">                level.push(tmp+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxdepth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†16.83% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.17% çš„ç”¨æˆ·</p>
<p>å¦‚æœä¸ç†è§£ä»£ç ï¼Œè¯·çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/4.jpg" alt></p>
<p>1ï¼šé¦–å…ˆå°†aå‹å…¥æ ˆ<br>2ï¼šaå¼¹æ ˆï¼Œå°†cã€bå‹å…¥æ ˆï¼ˆæ³¨æ„é¡ºåºï¼‰<br>3ï¼šbå¼¹æ ˆï¼Œå°†eã€då‹å…¥æ ˆ<br>4ï¼šdã€eã€cå¼¹æ ˆï¼Œå°†gã€få‹å…¥æ ˆ<br>5ï¼šfã€gå¼¹æ ˆ</p>
<p><strong>å”¯ä¸€éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œä¸ºä»€ä¹ˆéœ€è¦å…ˆå³åå·¦å‹å…¥æ•°æ®ï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å°†å…ˆè®¿é—®çš„æ•°æ®ï¼Œåå‹å…¥æ ˆï¼ˆè¯·æ€è€ƒæ ˆçš„ç‰¹ç‚¹ï¼‰ã€‚</strong></p>
<h3 id="2-å±‚æ¬¡éå†ä¸BFS"><a href="#2-å±‚æ¬¡éå†ä¸BFS" class="headerlink" title="2.å±‚æ¬¡éå†ä¸BFS"></a>2.å±‚æ¬¡éå†ä¸BFS</h3><blockquote>
<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¾‹é¢˜å­¦ä¹ äº†äºŒå‰æ ‘çš„DFSï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰ï¼Œå…¶å®å°±æ˜¯æ²¿ç€ä¸€ä¸ªæ–¹å‘ä¸€ç›´<br>å‘ä¸‹éå†ã€‚é‚£æˆ‘ä»¬å¯ä¸å¯ä»¥æŒ‰ç…§é«˜åº¦ä¸€å±‚ä¸€å±‚çš„è®¿é—®æ ‘ä¸­çš„æ•°æ®å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œå°±æ˜¯æœ¬èŠ‚ä¸­æˆ‘ä»¬<br>è¦è®²çš„BFSï¼ˆå®½åº¦ä¼˜å…ˆæœç´¢ï¼‰ï¼ŒåŒæ—¶ä¹Ÿè¢«ç§°ä¸ºå¹¿åº¦ä¼˜å…ˆæœç´¢ã€‚</p>
<p>å…¶å®å°±æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œå…ˆæŠŠæ¯ä¸€å±‚éå†å®Œä¹‹åå†éå†ä¸€ä¸‹ä¸€å±‚ã€‚å‡å¦‚æˆ‘ä»¬çš„æ ‘å¦‚ä¸‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    a</span><br><span class="line">   / \</span><br><span class="line">  b    c</span><br><span class="line"> / \  / \</span><br><span class="line">d   e f  g</span><br></pre></td></tr></table></figure><br>æŒ‰ç…§BFSï¼Œè®¿é—®é¡ºåºå¦‚ä¸‹ï¼š<br><code>a-&gt;b-&gt;c-&gt;d-&gt;e-&gt;f-&gt;g</code></p>
</blockquote>
<p><strong>[ç¬¬102é¢˜]</strong> ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›å…¶æŒ‰å±‚åºéå†å¾—åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>äºŒå‰æ ‘ï¼š[3,9,20,null,null,15,7]<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure>
è¿”å›å…¶å±‚æ¬¡éå†ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šDFSé€’å½’æ±‚è§£</strong></p>
<blockquote>
<p>æƒ³åˆ°é€’å½’ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆæƒ³åˆ°DFSã€‚æˆ‘ä»¬å¯ä»¥å¯¹è¯¥äºŒå‰æ ‘è¿›è¡Œå…ˆåºéå†ï¼ˆæ ¹å·¦å³çš„é¡ºåºï¼‰ï¼ŒåŒæ—¶ï¼Œè®°å½•èŠ‚ç‚¹æ‰€åœ¨çš„å±‚æ¬¡levelï¼Œå¹¶ä¸”å¯¹æ¯ä¸€å±‚éƒ½å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå°†è®¿é—®åˆ°çš„èŠ‚ç‚¹å€¼æ”¾å…¥å¯¹åº”å±‚çš„æ•°ç»„ä¸­ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">levelOrder</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        self.result = []</span><br><span class="line">        self._dfs(root, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> self.result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dfs</span>(<span class="params">self, node, level</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.result) &lt; level + <span class="number">1</span>:</span><br><span class="line">            self.result.append([])</span><br><span class="line">        self.result[level].append(node.val)</span><br><span class="line">        self._dfs(node.left, level + <span class="number">1</span>)</span><br><span class="line">        self._dfs(node.right, level + <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†94.65% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14 MB,å‡»è´¥äº†11.12% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        levelOrder(root, result, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">levelOrder</span><span class="params">(TreeNode root, List&lt;List&lt;Integer&gt;&gt; result, <span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">while</span> (result.size() &lt; level + <span class="number">1</span>) &#123;</span><br><span class="line">            List&lt;Integer&gt; item = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            result.add(item);</span><br><span class="line">        &#125;</span><br><span class="line">        result.get(level).add(root.val);</span><br><span class="line">        levelOrder(root.left, result, level + <span class="number">1</span>);</span><br><span class="line">        levelOrder(root.right, result, level + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†14.02% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šBFSæ±‚è§£</strong></p>
<blockquote>
<p>ä¸Šé¢çš„è§£æ³•ï¼Œå…¶å®ç›¸å½“äºæ˜¯ç”¨DFSçš„æ–¹æ³•å®ç°äº†äºŒå‰æ ‘çš„BFSã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨BFSçš„æ–¹å¼è¿›è¡Œè§£é¢˜å‘¢ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Queueçš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å°†rootèŠ‚ç‚¹åˆå§‹åŒ–è¿›é˜Ÿåˆ—ï¼Œé€šè¿‡æ¶ˆè€—å°¾éƒ¨ï¼Œæ’å…¥å¤´éƒ¨çš„æ–¹å¼æ¥å®ŒæˆBFSã€‚</p>
</blockquote>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/5.jpg" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">levelOrder</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        result = []</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–é˜Ÿåˆ—</span></span><br><span class="line">        queue = collections.deque()</span><br><span class="line">        queue.append(root)</span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            current_level = []</span><br><span class="line">            <span class="comment"># åŒä¸€å±‚ä»å³è¿›ï¼Œä»å·¦å‡º</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(queue)):</span><br><span class="line">                node = queue.popleft()</span><br><span class="line">                current_level.append(node.val)</span><br><span class="line">                <span class="keyword">if</span> node.left:</span><br><span class="line">                    queue.append(node.left)</span><br><span class="line">                <span class="keyword">if</span> node.right:</span><br><span class="line">                    queue.append(node.right)</span><br><span class="line">            <span class="comment"># æ·»åŠ æ¯å±‚çš„èŠ‚ç‚¹</span></span><br><span class="line">            result.append(current_level)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†84.08% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†32.49% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            List&lt;Integer&gt; tmp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">int</span> size = queue.size();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">                TreeNode node = queue.poll();</span><br><span class="line">                tmp.add(node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="keyword">null</span>) queue.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="keyword">null</span>) queue.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.76% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†68.05% çš„ç”¨æˆ·</p>
<h3 id="3-BSTä¸å…¶éªŒè¯"><a href="#3-BSTä¸å…¶éªŒè¯" class="headerlink" title="3.BSTä¸å…¶éªŒè¯"></a>3.BSTä¸å…¶éªŒè¯</h3><blockquote>
<p>å…ˆçœ‹å®šä¹‰ï¼šäºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œï¼ˆåˆï¼šäºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒäºŒå‰æ’åºæ ‘ï¼‰å®ƒæˆ–è€…æ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼šè‹¥<strong>å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›è‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼</strong>ï¼›å®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æœç´¢æ ‘ã€‚</p>
<p>è¿™é‡Œå¼ºè°ƒä¸€ä¸‹å­æ ‘çš„æ¦‚å¿µï¼šè®¾Tæ˜¯æœ‰æ ¹æ ‘ï¼Œaæ˜¯Tä¸­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼Œç”±<strong>aä»¥åŠaçš„æ‰€æœ‰åè£”ï¼ˆåä»£ï¼‰</strong>å¯¼å‡ºçš„å­å›¾ç§°ä¸ºæœ‰å‘æ ‘Tçš„å­æ ‘ã€‚å…·ä½“æ¥è¯´ï¼Œ<strong>å­æ ‘å°±æ˜¯æ ‘çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä»¥åŠå…¶ä¸‹é¢çš„æ‰€æœ‰çš„èŠ‚ç‚¹</strong>æ‰€æ„æˆçš„æ ‘ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™å°±æ˜¯ä¸€é¢—äºŒå‰æœç´¢æ ‘ï¼š</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/6.jpg" alt></p>
<blockquote>
<p>ä¸‹é¢è¿™ä¸¤ä¸ªéƒ½ä¸æ˜¯ï¼š</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/7.jpg" alt></p>
<blockquote>
<p><1>å›¾ä¸­4èŠ‚ç‚¹ä½ç½®çš„æ•°å€¼åº”è¯¥å¤§äºæ ¹èŠ‚ç‚¹</1></p>
<p><2>å›¾ä¸­3èŠ‚ç‚¹ä½ç½®çš„æ•°å€¼åº”è¯¥å¤§äºæ ¹èŠ‚ç‚¹</2></p>
</blockquote>
<p><strong>[ç¬¬98é¢˜]</strong> ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼šèŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  2</span><br><span class="line"> / \</span><br><span class="line">1   3</span><br></pre></td></tr></table></figure>
è¾“å‡º: true</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  5</span><br><span class="line"> / \</span><br><span class="line">1   4</span><br><span class="line"> Â  / \</span><br><span class="line">Â     3   6</span><br></pre></td></tr></table></figure>
è¾“å‡º: false<br>è§£é‡Š: è¾“å…¥ä¸º: [5,1,4,null,null,3,6]ã€‚æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 5 ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º 4 ã€‚</li>
</ul>
<blockquote>
<p>é¦–å…ˆçœ‹å®Œé¢˜ç›®ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°éå†æ•´æ£µæ ‘ï¼Œæ¯”è¾ƒæ‰€æœ‰èŠ‚ç‚¹ï¼Œé€šè¿‡å·¦èŠ‚ç‚¹å€¼&lt;èŠ‚ç‚¹å€¼ï¼Œå³èŠ‚ç‚¹å€¼&gt;èŠ‚ç‚¹å€¼çš„æ–¹å¼æ¥è¿›è¡Œæ±‚è§£ã€‚ä½†æ˜¯è¿™ç§è§£æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå¯¹äºä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¸å…‰éœ€è¦å·¦èŠ‚ç‚¹å€¼å°äºè¯¥èŠ‚ç‚¹ï¼Œå¹¶ä¸”å·¦å­æ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹å€¼éƒ½éœ€è¦å°äºè¯¥èŠ‚ç‚¹ã€‚ï¼ˆå³èŠ‚ç‚¹ä¸€è‡´ï¼‰æ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤å¼•å…¥ä¸Šç•Œä¸ä¸‹ç•Œï¼Œç”¨ä»¥ä¿å­˜ä¹‹å‰çš„èŠ‚ç‚¹ä¸­å‡ºç°çš„æœ€å¤§å€¼ä¸æœ€å°å€¼ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidBST</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> self.isBST(root, -inf, inf)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isBST</span>(<span class="params">self, root, <span class="built_in">min</span>, <span class="built_in">max</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">min</span> &gt;= root.val) <span class="keyword">or</span> (<span class="built_in">max</span> &lt;= root.val):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> self.isBST(root.left, <span class="built_in">min</span>, root.val) <span class="keyword">and</span> self.isBST(root.right, root.val, <span class="built_in">max</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†88.67% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.8 MB,å‡»è´¥äº†38.48% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBST</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isBST(root, Long.MIN_VALUE, Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBST</span><span class="params">(TreeNode root, <span class="keyword">long</span> min, <span class="keyword">long</span> max)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.val &lt;= min || root.val &gt;= max) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> isBST(root.left, min, root.val) &amp;&amp; isBST(root.right, root.val, max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.4 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†7.36% çš„ç”¨æˆ·</p>
<h3 id="4-BSTçš„æŸ¥æ‰¾"><a href="#4-BSTçš„æŸ¥æ‰¾" class="headerlink" title="4.BSTçš„æŸ¥æ‰¾"></a>4.BSTçš„æŸ¥æ‰¾</h3><p><strong>[ç¬¬700é¢˜]</strong> ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œä¸€ä¸ªå€¼ã€‚ ä½ éœ€è¦åœ¨BSTä¸­æ‰¾åˆ°èŠ‚ç‚¹å€¼ç­‰äºç»™å®šå€¼çš„èŠ‚ç‚¹ã€‚ è¿”å›ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ã€‚ å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› NULLã€‚ </p>
<ul>
<li>ä¾‹å¦‚ï¼Œ<br>ç»™å®šäºŒå‰æœç´¢æ ‘:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    4</span><br><span class="line">   / \</span><br><span class="line">  2   7</span><br><span class="line"> / \</span><br><span class="line">1   3</span><br></pre></td></tr></table></figure>
å’Œå€¼: 2<br>ä½ åº”è¯¥è¿”å›å¦‚ä¸‹å­æ ‘: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  2     </span><br><span class="line"> / \   </span><br><span class="line">1   3</span><br></pre></td></tr></table></figure>
åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœè¦æ‰¾çš„å€¼æ˜¯ 5ï¼Œä½†å› ä¸ºæ²¡æœ‰èŠ‚ç‚¹å€¼ä¸º 5ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å› NULLã€‚ </li>
</ul>
<blockquote>
<p>å‡è®¾ç›®æ ‡å€¼ä¸º valï¼Œæ ¹æ®BSTçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°æŸ¥æ‰¾è¿‡ç¨‹<br>å¦‚æœvalå°äºå½“å‰ç»“ç‚¹çš„å€¼ï¼Œè½¬å‘å…¶å·¦å­æ ‘ç»§ç»­æœç´¢ï¼›<br>å¦‚æœvalå¤§äºå½“å‰ç»“ç‚¹çš„å€¼ï¼Œè½¬å‘å…¶å³å­æ ‘ç»§ç»­æœç´¢ï¼›<br>å¦‚æœå·²æ‰¾åˆ°ï¼Œåˆ™è¿”å›å½“å‰ç»“ç‚¹ã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼šé€’å½’</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchBST</span>(<span class="params">self, root: TreeNode, val: <span class="built_in">int</span></span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> root.val &gt; val:</span><br><span class="line">            <span class="keyword">return</span> self.searchBST(root.left, val)</span><br><span class="line">        <span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">            <span class="keyword">return</span> self.searchBST(root.right, val)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:116 ms,å‡»è´¥äº†10.76% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.5 MB,å‡»è´¥äº†33.59% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">searchBST</span><span class="params">(TreeNode root, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.val &gt; val) <span class="keyword">return</span> searchBST(root.left, val);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val &lt; val) <span class="keyword">return</span> searchBST(root.right, val);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†83.28% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šè¿­ä»£</strong></p>
<blockquote>
<p>é€’å½’ä¸è¿­ä»£çš„åŒºåˆ«<br>é€’å½’ï¼šé‡å¤è°ƒç”¨å‡½æ•°è‡ªèº«å®ç°å¾ªç¯ç§°ä¸ºé€’å½’ï¼›<br>è¿­ä»£ï¼šåˆ©ç”¨å˜é‡çš„åŸå€¼æ¨å‡ºæ–°å€¼ç§°ä¸ºè¿­ä»£ï¼Œæˆ–è€…è¯´è¿­ä»£æ˜¯å‡½æ•°å†…æŸæ®µä»£ç å®ç°å¾ªç¯ï¼›</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchBST</span>(<span class="params">self, root: TreeNode, val: <span class="built_in">int</span></span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">while</span> root:</span><br><span class="line">            <span class="keyword">if</span> root.val &gt; val:</span><br><span class="line">                root = root.left</span><br><span class="line">            <span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">                root = root.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> root</span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:76 ms,å‡»è´¥äº†99.39% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.6 MB,å‡»è´¥äº†6.14% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">searchBST</span><span class="params">(TreeNode root, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(root!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.val &gt; val) root = root.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.val &lt; val) root = root.right;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†8.04% çš„ç”¨æˆ·</p>
<h3 id="5-BSTçš„åˆ é™¤"><a href="#5-BSTçš„åˆ é™¤" class="headerlink" title="5.BSTçš„åˆ é™¤"></a>5.BSTçš„åˆ é™¤</h3><p><strong>[ç¬¬450é¢˜]</strong> ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹rootå’Œä¸€ä¸ªå€¼keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„keyå¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚<br>è¯´æ˜ï¼š è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>root = [5,3,6,2,4,null,7]<br>key = 3<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  3   6</span><br><span class="line"> / \   \</span><br><span class="line">2   4   7</span><br></pre></td></tr></table></figure>
ç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ 3ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° 3 è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤å®ƒã€‚<br>ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [5,4,6,2,null,null,7], å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  4   6</span><br><span class="line"> /     \</span><br><span class="line">2       7</span><br></pre></td></tr></table></figure>
å¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [5,2,6,null,4,null,7]ã€‚<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  5</span><br><span class="line"> / \</span><br><span class="line">2   6</span><br><span class="line"> \   \</span><br><span class="line">  4   7</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬è¦åˆ é™¤BSTçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹ã€‚è€Œæ‰¾åˆ°ä¹‹åï¼Œä¼šå‡ºç°ä¸‰ç§æƒ…å†µã€‚</p>
<p>1ã€å¾…åˆ é™¤çš„èŠ‚ç‚¹å·¦å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘æ›¿ä»£è‡ªå·±ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/8.jpg" alt><br>2ã€å¾…åˆ é™¤çš„èŠ‚ç‚¹å³å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘æ›¿ä»£è‡ªå·±ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/9.jpg" alt><br>3ã€å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½ä¸ä¸ºç©ºã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<strong>æ¯”å½“å‰èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ï¼ˆå‰é©±ï¼‰</strong>ï¼Œæ¥æ›¿æ¢è‡ªå·±</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/10.jpg" alt></p>
<p>æˆ–è€…<strong>æ¯”å½“å‰èŠ‚ç‚¹å¤§çš„æœ€å°èŠ‚ç‚¹ï¼ˆåç»§ï¼‰</strong>ï¼Œæ¥æ›¿æ¢è‡ªå·±ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/11.jpg" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteNode</span>(<span class="params">self, root: TreeNode, key: <span class="built_in">int</span></span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> root.val &gt; key:</span><br><span class="line">            root.left = self.deleteNode(root.left, key)</span><br><span class="line">        <span class="keyword">elif</span> root.val &lt; key:</span><br><span class="line">            root.right = self.deleteNode(root.right, key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> root.left <span class="keyword">or</span> <span class="keyword">not</span> root.right:</span><br><span class="line">                root = root.left <span class="keyword">if</span> root.left <span class="keyword">else</span> root.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># ç¬¬ä¸‰ç§æƒ…å†µï¼ŒæŸ¥æ‰¾åç»§</span></span><br><span class="line">                cur = root.right</span><br><span class="line">                <span class="keyword">while</span> cur.left:</span><br><span class="line">                    cur = cur.left</span><br><span class="line">                root.val = cur.val</span><br><span class="line">                <span class="comment"># æ‰¾åˆ°å³å­æ ‘æœ€å°å€¼ï¼Œå†é€šè¿‡ä¸»é€’å½’å‡½æ•°åˆ é™¤æœ€å°å€¼</span></span><br><span class="line">                <span class="comment"># å‡ºå£å°±æ˜¯ if not root.left or not root.right: root = root.left if root.left else root.right</span></span><br><span class="line">                root.right = self.deleteNode(root.right, cur.val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:72 ms,å‡»è´¥äº†99.85% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:17.6 MB,å‡»è´¥äº†24.40% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">deleteNode</span><span class="params">(TreeNode root, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.val &gt; key) root.left = deleteNode(root.left, key);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val &lt; key) root.right = deleteNode(root.right, key);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="keyword">null</span> || root.right==<span class="keyword">null</span> )&#123;</span><br><span class="line">                root = root.left!=<span class="keyword">null</span>?root.left: root.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                TreeNode cur = root.right;</span><br><span class="line">                <span class="keyword">while</span>(cur.left!=<span class="keyword">null</span>) cur = cur.left;</span><br><span class="line">                root.val = cur.val;</span><br><span class="line">                root.right = deleteNode(root.right, cur.val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†62.43% çš„ç”¨æˆ·</p>
<h3 id="6-å¹³è¡¡äºŒå‰æ ‘"><a href="#6-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="6.å¹³è¡¡äºŒå‰æ ‘"></a>6.å¹³è¡¡äºŒå‰æ ‘</h3><p><strong>[ç¬¬110é¢˜]</strong> ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚<br>æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7] <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7 </span><br></pre></td></tr></table></figure>
è¿”å› true ã€‚  </li>
<li>ç¤ºä¾‹ 2:<br>ç»™å®šäºŒå‰æ ‘ [1,2,2,3,3,null,null,4,4] <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      1</span><br><span class="line">     / \</span><br><span class="line">    2   2</span><br><span class="line">   / \</span><br><span class="line">  3   3</span><br><span class="line"> / \</span><br><span class="line">4   4</span><br></pre></td></tr></table></figure>
è¿”å› false ã€‚ </li>
</ul>
<blockquote>
<p>æˆ‘ä»¬æƒ³åˆ¤æ–­ä¸€æ£µæ ‘æ˜¯å¦æ»¡è¶³å¹³è¡¡äºŒå‰æ ‘ï¼Œæ— éå°±æ˜¯åˆ¤æ–­å½“å‰ç»“ç‚¹çš„ä¸¤ä¸ªå­©å­æ˜¯å¦æ»¡è¶³å¹³è¡¡ï¼ŒåŒæ—¶ä¸¤ä¸ªå­©å­çš„é«˜åº¦å·®æ˜¯å¦è¶…è¿‡1ã€‚é‚£åªè¦æˆ‘ä»¬å¯ä»¥å¾—åˆ°é«˜åº¦ï¼Œå†åŸºäºé«˜åº¦è¿›è¡Œåˆ¤æ–­å³å¯ã€‚</p>
<p>è¿™é‡Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬åˆ¤å®šå…¶ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœä¸æ»¡è¶³å¹³è¡¡äºŒå‰æ ‘æ—¶ï¼Œé‚£è¯´æ˜æ•´æ£µæ ‘å·²ç»ä¸æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œé˜»æ–­ï¼Œä¸éœ€è¦ç»§ç»­é€’å½’ä¸‹å»ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isBalanced</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="comment"># ä¸å¹³è¡¡çš„æƒ…å†µæœ‰3ç§ï¼šå·¦æ ‘ä¸å¹³è¡¡ã€å³æ ‘ä¸å¹³è¡¡ã€å·¦æ ‘å’Œå³æ ‘å·®çš„ç»å¯¹å€¼å¤§äº1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.isBalanced(root.left) <span class="keyword">or</span> <span class="keyword">not</span> self.isBalanced(root.right):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        leftH = self.maxDepth(root.left) + <span class="number">1</span></span><br><span class="line">        rightH = self.maxDepth(root.right) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(leftH - rightH) &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxDepth</span>(<span class="params">self, root</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># æ ‘çš„æ·±åº¦ä¸ºå·¦å³ä¿©å­æ ‘æœ€å¤§æ·±åº¦ + 1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(self.maxDepth(root.left), self.maxDepth(root.right)) + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:64 ms,å‡»è´¥äº†73.12% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:17.3 MB,å‡»è´¥äº†66.69% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!isBalanced(root.left) || !isBalanced(root.right)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> leftH = maxDepth(root.left) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> rightH = maxDepth(root.right) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(Math.abs(leftH - rightH) &gt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> Math.max(maxDepth(root.left), maxDepth(root.right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†99.97% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.03% çš„ç”¨æˆ·</p>
<h3 id="7-å®Œå…¨äºŒå‰æ ‘"><a href="#7-å®Œå…¨äºŒå‰æ ‘" class="headerlink" title="7.å®Œå…¨äºŒå‰æ ‘"></a>7.å®Œå…¨äºŒå‰æ ‘</h3><blockquote>
<p>å¦‚æœ<strong>äºŒå‰æ ‘ä¸­é™¤äº†å¶å­ç»“ç‚¹ï¼Œæ¯ä¸ªç»“ç‚¹çš„åº¦éƒ½ä¸º 2</strong>ï¼Œåˆ™æ­¤äºŒå‰æ ‘ç§°ä¸º<strong>æ»¡äºŒå‰æ ‘</strong>ã€‚ï¼ˆ<strong>äºŒå‰æ ‘çš„åº¦ä»£è¡¨æŸä¸ªç»“ç‚¹çš„å­©å­æˆ–è€…è¯´ç›´æ¥åç»§çš„ä¸ªæ•°</strong>ã€‚å¯¹äºäºŒå‰æ ‘è€Œè¨€ï¼Œ1åº¦æ˜¯åªæœ‰ä¸€ä¸ªå­©å­æˆ–è€…è¯´å•å­æ ‘,2åº¦æ˜¯æœ‰ä¸¤ä¸ªå­©å­æˆ–è€…è¯´å·¦å³å­æ ‘éƒ½æœ‰ã€‚ï¼‰</p>
<p>æ»¡äºŒå‰æ ‘å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/12.jpg" alt><br>å¦‚æœ<strong>äºŒå‰æ ‘ä¸­é™¤å»æœ€åä¸€å±‚èŠ‚ç‚¹ä¸ºæ»¡äºŒå‰æ ‘ï¼Œä¸”æœ€åä¸€å±‚çš„ç»“ç‚¹ä¾æ¬¡ä»å·¦åˆ°å³åˆ†å¸ƒï¼Œåˆ™æ­¤äºŒå‰æ ‘è¢«ç§°ä¸º<br>å®Œå…¨äºŒå‰æ ‘</strong>ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™é¢—ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/13.jpg" alt><br>è€Œè¿™é¢—å°±ä¸æ˜¯ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/14.jpg" alt></p>
</blockquote>
<p><strong>[ç¬¬222é¢˜]</strong> ç»™å‡ºä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚<br>è¯´æ˜ï¼š<br>å®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬hå±‚ï¼Œåˆ™è¯¥å±‚åŒ…å«1~ 2hä¸ªèŠ‚ç‚¹ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \  /</span><br><span class="line">4  5 6</span><br></pre></td></tr></table></figure>
è¾“å‡º: 6 </li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šé€’å½’æ±‚è§£</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">countNodes</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + self.countNodes(root.left) + self.countNodes(root.right)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:88 ms,å‡»è´¥äº†91.26% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:20.5 MB,å‡»è´¥äº†6.22% çš„Python3ç”¨æˆ·</p>
<p>ä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œå‡ºé¢˜è€…è‚¯å®šä¸æ˜¯è¦è¿™ç§ç­”æ¡ˆã€‚å› ä¸ºè¿™ç§ç­”æ¡ˆå’Œå®Œå…¨äºŒå‰æ ‘ä¸€æ¯›é’±å…³ç³»éƒ½æ²¡æœ‰ã€‚æ‰€ä»¥æˆ‘ä»¬ç»§<br>ç»­æ€è€ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> countNodes(root.left) + countNodes(root.right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†23.37% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šç»å…¸è§£æ³•</strong></p>
<blockquote>
<p>ç”±äºé¢˜ä¸­å·²ç»å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼Œæˆ‘ä»¬åˆå·²çŸ¥äº†å®Œå…¨äºŒå‰æ ‘é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚éƒ½æ˜¯æ»¡çš„ï¼Œå¹¶ä¸”æœ€åä¸€å±‚çš„èŠ‚ç‚¹å…¨éƒ¨é å‘äº†å·¦è¾¹ã€‚é‚£æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œå¯ä»¥å°†è¯¥å®Œå…¨äºŒå‰æ ‘å¯ä»¥åˆ†å‰²æˆ<strong>è‹¥å¹²æ»¡äºŒå‰æ ‘å’Œå®Œå…¨äºŒå‰æ ‘ï¼Œæ»¡äºŒå‰æ ‘ç›´æ¥æ ¹æ®å±‚é«˜hè®¡ç®—å‡ºèŠ‚ç‚¹ä¸º2^h-1ï¼Œç„¶åç»§ç»­è®¡ç®—å­æ ‘ä¸­å®Œå…¨äºŒå‰æ ‘èŠ‚ç‚¹</strong>ã€‚é‚£å¦‚ä½•åˆ†å‰²æˆè‹¥å¹²æ»¡äºŒå‰æ ‘å’Œå®Œå…¨äºŒå‰æ ‘å‘¢ï¼Ÿ<strong>å¯¹ä»»æ„ä¸€ä¸ªå­æ ‘ï¼Œéå†å…¶å·¦å­æ ‘å±‚é«˜leftï¼Œå³å­æ ‘å±‚é«˜rightï¼Œç›¸ç­‰å·¦å­æ ‘åˆ™æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå¦åˆ™å³å­æ ‘æ˜¯æ»¡äºŒå‰æ ‘</strong>ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/15.jpg" alt><br>å·¦å­æ ‘ä¸ºæ»¡äºŒå‰æ ‘<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/16.jpg" alt><br>å³å­æ ‘ä¸ºæ»¡äºŒå‰æ ‘</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">countNodes</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># è®¡ç®—å·¦å³å­æ ‘é«˜åº¦</span></span><br><span class="line">        lh, rh = self.__getHeight(root.left), self.__getHeight(root.right)</span><br><span class="line">        <span class="keyword">if</span> lh == rh:  <span class="comment"># å·¦å³å­æ ‘é«˜åº¦ç›¸åŒï¼Œè¯´æ˜å·¦å­æ ‘å¿…æ»¡ åˆ™èŠ‚ç‚¹æ•°=å·¦å­æ ‘èŠ‚ç‚¹ + rootèŠ‚ç‚¹(=1) + é€’å½’æ‰¾å³å­æ ‘</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">pow</span>(<span class="number">2</span>, lh) - <span class="number">1</span>) + <span class="number">1</span> + self.countNodes(root.right)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å·¦å­æ ‘æ¯”å³å­æ ‘é«˜ï¼Œè¯´æ˜å³å­æ ‘å¿…æ»¡ åŒç†</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">pow</span>(<span class="number">2</span>, rh) - <span class="number">1</span>) + <span class="number">1</span> + self.countNodes(root.left)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getHeight</span>(<span class="params">self, root</span>):</span></span><br><span class="line">        level = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> root:</span><br><span class="line">            level += <span class="number">1</span></span><br><span class="line">            root = root.left</span><br><span class="line">        <span class="keyword">return</span> level</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:88 ms,å‡»è´¥äº†91.26% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:20.4 MB,å‡»è´¥äº†47.22% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> lh = getHeight(root.left);</span><br><span class="line">        <span class="keyword">int</span> rh = getHeight(root.right);</span><br><span class="line">        <span class="keyword">if</span>(lh == rh) <span class="keyword">return</span> (<span class="keyword">int</span>)(Math.pow(<span class="number">2</span>, lh) - <span class="number">1</span>) + <span class="number">1</span> + countNodes(root.right);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> (<span class="keyword">int</span>)(Math.pow(<span class="number">2</span>, rh) - <span class="number">1</span>) + <span class="number">1</span> + countNodes(root.left);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">(TreeNode root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> level = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(root != <span class="keyword">null</span>)&#123;</span><br><span class="line">            level++;</span><br><span class="line">            root = root.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†50.61% çš„ç”¨æˆ·</p>
<h3 id="8-äºŒå‰æ ‘çš„å‰ªæ"><a href="#8-äºŒå‰æ ‘çš„å‰ªæ" class="headerlink" title="8.äºŒå‰æ ‘çš„å‰ªæ"></a>8.äºŒå‰æ ‘çš„å‰ªæ</h3><blockquote>
<p>å‡è®¾æœ‰ä¸€æ£µæ ‘ï¼Œæœ€ä¸Šå±‚çš„æ˜¯rootèŠ‚ç‚¹ï¼Œè€Œ<strong>çˆ¶èŠ‚ç‚¹ä¼šä¾èµ–å­èŠ‚ç‚¹</strong>ã€‚å¦‚æœç°åœ¨æœ‰ä¸€äº›èŠ‚ç‚¹å·²ç»æ ‡è®°ä¸ºæ— æ•ˆï¼Œæˆ‘ä»¬è¦åˆ é™¤è¿™äº›æ— æ•ˆèŠ‚ç‚¹ã€‚<strong>å¦‚æœæ— æ•ˆèŠ‚ç‚¹çš„ä¾èµ–çš„èŠ‚ç‚¹è¿˜æœ‰æ•ˆï¼Œé‚£ä¹ˆä¸åº”è¯¥åˆ é™¤</strong>ï¼Œå¦‚æœæ— æ•ˆèŠ‚ç‚¹å’Œå®ƒçš„å­èŠ‚ç‚¹éƒ½æ— æ•ˆï¼Œåˆ™å¯ä»¥åˆ é™¤ã€‚å‰ªæ‰è¿™äº›èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œç§°ä¸ºå‰ªæï¼Œç›®çš„æ˜¯<strong>ç”¨æ¥å¤„ç†äºŒå‰æ ‘æ¨¡å‹ä¸­çš„ä¾èµ–é—®é¢˜</strong>ã€‚</p>
</blockquote>
<p><strong>[ç¬¬814é¢˜]</strong> ç»™å®šäºŒå‰æ ‘æ ¹ç»“ç‚¹rootï¼Œæ­¤å¤–æ ‘çš„æ¯ä¸ªç»“ç‚¹çš„å€¼è¦ä¹ˆæ˜¯0ï¼Œè¦ä¹ˆæ˜¯1ã€‚è¿”å›ç§»é™¤äº†æ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘çš„åŸäºŒå‰æ ‘ã€‚( èŠ‚ç‚¹ X çš„å­æ ‘ä¸º X æœ¬èº«ï¼Œä»¥åŠæ‰€æœ‰ X çš„åä»£ã€‚) </p>
<ul>
<li><p>ç¤ºä¾‹1:<br>è¾“å…¥: [1,null,0,0,1]<br>è¾“å‡º: [1,null,0,null,1]<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/17.jpg" alt><br>è§£é‡Š:<br>åªæœ‰çº¢è‰²èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶â€œæ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘â€ã€‚<br>å³å›¾ä¸ºè¿”å›çš„ç­”æ¡ˆã€‚</p>
</li>
<li><p>ç¤ºä¾‹2:<br>è¾“å…¥: [1,0,1,0,0,0,1]<br>è¾“å‡º: [1,null,1,null,1]<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/18.jpg" alt></p>
</li>
<li><p>ç¤ºä¾‹3:<br>è¾“å…¥: [1,1,0,1,1,0,1,0]<br>è¾“å‡º: [1,1,0,1,1,null,1]<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/19.jpg" alt></p>
</li>
</ul>
<p>è¯´æ˜:<br>ç»™å®šçš„äºŒå‰æ ‘æœ€å¤šæœ‰100ä¸ªèŠ‚ç‚¹ã€‚<br>æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åªä¼šä¸º0æˆ–1ã€‚ </p>
<blockquote>
<p>å‰ªä»€ä¹ˆå¤§å®¶åº”è¯¥éƒ½èƒ½ç†è§£ã€‚é‚£å…³é”®æ˜¯æ€ä¹ˆå‰ªï¼Ÿè¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œ<strong>åœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰ç»“ç‚¹çš„å·¦å³èŠ‚ç‚¹çš†ä¸ºç©ºï¼Œä¸”å½“å‰ç»“ç‚¹ä¸º0ï¼Œæˆ‘ä»¬å°±å°†å½“å‰èŠ‚ç‚¹å‰ªæ‰å³å¯</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pruneTree</span>(<span class="params">self, root: TreeNode</span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root.left = self.pruneTree(root.left)</span><br><span class="line">        root.right = self.pruneTree(root.right)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root.left <span class="keyword">and</span> <span class="keyword">not</span> root.right <span class="keyword">and</span> root.val == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†78.18% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†5.40% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">pruneTree</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        root.left = pruneTree(root.left);</span><br><span class="line">        root.right = pruneTree(root.right);</span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span> &amp;&amp; root.val == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†37.22% çš„ç”¨æˆ·</p>
<h2 id="å›æº¯ç³»åˆ—"><a href="#å›æº¯ç³»åˆ—" class="headerlink" title="å›æº¯ç³»åˆ—"></a>å›æº¯ç³»åˆ—</h2><h3 id="1-å…¨æ’åˆ—ç®—æ³•"><a href="#1-å…¨æ’åˆ—ç®—æ³•" class="headerlink" title="1.å…¨æ’åˆ—ç®—æ³•"></a>1.å…¨æ’åˆ—ç®—æ³•</h3><blockquote>
<p>ä»€ä¹ˆæ˜¯å…¨æ’åˆ—ï¼Ÿä» n ä¸ªä¸åŒå…ƒç´ ä¸­ä»»å– mï¼ˆmâ‰¤nï¼‰ä¸ªå…ƒç´ ï¼ŒæŒ‰ç…§ä¸€å®šçš„é¡ºåºæ’åˆ—èµ·æ¥ï¼Œå«åšä» n ä¸ªä¸åŒå…ƒç´ ä¸­å–å‡º m ä¸ªå…ƒç´ çš„ä¸€ä¸ªæ’åˆ—ã€‚å½“ m=n æ—¶æ‰€æœ‰çš„æ’åˆ—æƒ…å†µå«å…¨æ’åˆ—ã€‚</p>
</blockquote>
<p><strong>[ç¬¬46é¢˜]</strong> ç»™å®šä¸€ä¸ªæ²¡æœ‰é‡å¤æ•°å­—çš„åºåˆ—ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥: [1,2,3]<br>è¾“å‡º:<br>[<br>[1,2,3],<br>[1,3,2],<br>[2,1,3],<br>[2,3,1],<br>[3,1,2],<br>[3,2,1]<br>] </li>
</ul>
<blockquote>
<p>å›æº¯æ³•ï¼ˆæ¢ç´¢ä¸å›æº¯æ³•ï¼‰æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼Œåˆç§°ä¸ºè¯•æ¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬é€‰æ‹©ä¸‰ä¸ªæ•°å­—ï¼š</p>
<ul>
<li>åœ¨æšä¸¾ç¬¬ä¸€ä½çš„æ—¶å€™ï¼Œå°±æœ‰ä¸‰ç§æƒ…å†µ</li>
<li>åœ¨æšä¸¾ç¬¬äºŒä½çš„æ—¶å€™ï¼Œå°±åªæœ‰ä¸¤ç§æƒ…å†µï¼ˆå‰é¢å·²ç»å‡ºç°çš„ä¸€ä¸ªæ•°å­—ä¸å¯ä»¥å†å‡ºç°ï¼‰</li>
<li>åœ¨æšä¸¾ç¬¬ä¸‰ä½çš„æ—¶å€™ï¼Œå°±åªæœ‰ä¸€ç§æƒ…å†µï¼ˆå‰é¢å·²ç»å‡ºç°çš„ä¸¤ä¸ªæ•°å­—ä¸å¯ä»¥å†å‡ºç°ï¼‰</li>
</ul>
<p>æ•´ä¸ªä»£ç å…¶å®å°±å¹²äº†è¿™ä¹ˆä¸€ä»¶äº‹ï¼å…¶å®å°±æ˜¯è¯´<strong>å½“æšä¸¾åˆ°æœ€åä¸€ä½çš„æ—¶å€™ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦çš„æ’åˆ—ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ”¾å…¥åˆ°å…¨æ’åˆ—ç»“æœé›†ä¸­ã€‚</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">permute</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        self.result = []</span><br><span class="line">        tmp = []</span><br><span class="line">        self.dfs(nums, tmp)</span><br><span class="line">        <span class="keyword">return</span> self.result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">self, nums, tmp</span>):</span></span><br><span class="line">        <span class="comment"># è‹¥é•¿åº¦ç›¸ç­‰ï¼Œåˆ™æ·»åŠ åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tmp) == <span class="built_in">len</span>(nums):</span><br><span class="line">            self.result.append(tmp[:])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                    <span class="comment"># æšä¸¾ç¬¬ä¸€ä½</span></span><br><span class="line">                    tmp.append(i)</span><br><span class="line">                    <span class="comment"># æ‰¾å‡ºç¬¬ä¸€ä½å›ºå®šåçš„æ’åˆ—æƒ…å†µ</span></span><br><span class="line">                    self.dfs(nums, tmp)</span><br><span class="line">                    <span class="comment"># æ¸…é™¤é€‰æ‹©è¿‡çš„æ•°å­—</span></span><br><span class="line">                    tmp.pop(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†94.22% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†67.02% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; permute(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        dfs(nums, <span class="number">0</span>, ans);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> level, List&lt;List&lt;Integer&gt;&gt; ans)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(level == nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//æ•°ç»„è½¬åˆ—è¡¨</span></span><br><span class="line">            ans.add(Arrays.stream(nums).boxed().collect(Collectors.toList()));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=level; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="comment">//ä¸å½“å‰leveläº¤æ¢çš„å¯èƒ½</span></span><br><span class="line">            <span class="comment">//i = levelæ—¶ä¸åŠ¨, i &gt; levelæ—¶äº¤æ¢</span></span><br><span class="line">            swap(nums, i, level);</span><br><span class="line">            <span class="comment">//ä¸ä¸‹ä¸€leveläº¤æ¢çš„å¯èƒ½</span></span><br><span class="line">            <span class="comment">//åŒç†level+1å¯èƒ½ä¸åŠ¨ï¼Œå¯èƒ½ä¸å¤§äºlevel+1çš„æ•°äº¤æ¢</span></span><br><span class="line">            dfs(nums, level + <span class="number">1</span>, ans);</span><br><span class="line">            <span class="comment">//æ¢å¤</span></span><br><span class="line">            swap(nums, i, level);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> i ,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">        nums[i] = nums[j];</span><br><span class="line">        nums[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ»‘åŠ¨çª—å£ç³»åˆ—"><a href="#æ»‘åŠ¨çª—å£ç³»åˆ—" class="headerlink" title="æ»‘åŠ¨çª—å£ç³»åˆ—"></a>æ»‘åŠ¨çª—å£ç³»åˆ—</h2><h3 id="1-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#1-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="1.æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a>1.æ»‘åŠ¨çª—å£æœ€å¤§å€¼</h3><p><strong>[ç¬¬239é¢˜]</strong> ç»™å®šä¸€ä¸ªæ•°ç»„numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸ºkçš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„kä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚ </p>
<ul>
<li>ç¤ºä¾‹:<br>è¾“å…¥: nums = [1,3,-1,-3,5,3,6,7], å’Œk = 3<br>è¾“å‡º: [3,3,5,5,6,7]<br>è§£é‡Š: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7 </span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šæš´åŠ›æ±‚è§£</strong></p>
<blockquote>
<p>å¯ä»¥<strong>é€šè¿‡éå†æ‰€æœ‰çš„æ»‘åŠ¨çª—å£ï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ªçª—å£çš„æœ€å¤§å€¼ï¼Œæ¥è¿›è¡Œæš´åŠ›æ±‚è§£</strong>ã€‚é‚£ä¸€å…±æœ‰å¤šå°‘ä¸ªæ»‘åŠ¨çª—å£å‘¢ï¼Œå°å­¦é¢˜ç›®ï¼Œå¯ä»¥å¾—åˆ°å…±æœ‰L-k+1ä¸ªçª—å£ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSlidingWindow</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums) - k + <span class="number">1</span>):</span><br><span class="line">            result.append(<span class="built_in">max</span>(nums[i: k + i]))</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå¤±è´¥:<br>Time Limit Exceeded<br>è¿è¡Œé€Ÿåº¦ä¸è¡Œï¼Œä¼šè¶…æ—¶ã€‚ã€‚ã€‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] maxSlidingWindow(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length &lt; k) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length - k + <span class="number">1</span>]; </span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = k-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(r &lt; nums.length)&#123;</span><br><span class="line">            res[index++] = maxArray(nums, l, r);</span><br><span class="line">            l++;</span><br><span class="line">            r++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArray</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxValue = nums[l];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = l + <span class="number">1</span>; i &lt;= r; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; maxValue) maxValue = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Javaä¹Ÿè¶…æ—¶ã€‚ã€‚ã€‚ã€‚</p>
<p><strong>æ–¹æ³•äºŒï¼šçº¿æ€§é¢˜è§£</strong></p>
<blockquote>
<p>æœ€å…¸å‹çš„è§£æ³•è¿˜æ˜¯ä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œåªè¦éå†è¯¥æ•°ç»„ï¼ŒåŒæ—¶åœ¨åŒç«¯é˜Ÿåˆ—çš„å¤´å»ç»´æŠ¤å½“å‰çª—å£çš„æœ€å¤§å€¼ï¼ˆåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå‘ç°å½“å‰å…ƒç´ æ¯”é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¤§ï¼Œå°±å°†åŸæ¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç¥­å¤©ï¼‰ï¼Œåœ¨æ•´ä¸ªéå†çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å†è®°å½•ä¸‹æ¯ä¸€ä¸ªçª—å£çš„æœ€å¤§å€¼åˆ°ç»“æœæ•°ç»„ä¸­ã€‚æœ€ç»ˆç»“æœæ•°ç»„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„</p>
<p>å‡è®¾nums = [1,3,-1,-3,5,3,6,7]ï¼Œå’Œk = 3</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/20.jpg" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSlidingWindow</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        queue = collections.deque()</span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> (<span class="built_in">len</span>(queue) &gt; <span class="number">0</span>) <span class="keyword">and</span> (nums[i] &gt; queue[-<span class="number">1</span>]):</span><br><span class="line">                <span class="comment"># å°†æ¯”å½“å‰å…ƒç´ å°çš„å…ƒç´ ç¥­å¤©</span></span><br><span class="line">                queue.pop()</span><br><span class="line">            queue.append(nums[i])</span><br><span class="line">            <span class="keyword">if</span> i &gt;= k <span class="keyword">and</span> nums[i - k] == queue[<span class="number">0</span>]:</span><br><span class="line">                <span class="comment"># ç»´æŠ¤é˜Ÿåˆ—ï¼Œä¿è¯å…¶å¤´å…ƒç´ ä¸ºå½“å‰çª—å£æœ€å¤§å€¼, è€Œä¸æ˜¯ä¹‹å‰çª—å£</span></span><br><span class="line">                <span class="comment"># å³å½“å‰çª—å£æ°å¥½ä¸ä¹‹å‰çª—å£çš„æœ€å¤§å€¼åˆ†ç¦»æ—¶ï¼Œè¦èˆå»ä¹‹å‰çª—å£çš„æœ€å¤§å€¼</span></span><br><span class="line">                queue.popleft()</span><br><span class="line">            <span class="keyword">if</span> i &gt;= k-<span class="number">1</span>:</span><br><span class="line">                <span class="comment"># æ”¾å…¥ç»“æœæ•°ç»„</span></span><br><span class="line">                result.append(queue[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:416 ms,å‡»è´¥äº†22.57% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:25.4 MB,å‡»è´¥äº†7.76% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] maxSlidingWindow(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length &lt; k) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length - k + <span class="number">1</span>]; </span><br><span class="line">        <span class="comment">//Queueçª„åŒ–äº†LinkedListçš„è®¿é—®,ç”±äºéœ€è¦ä»å³è¾¹å¼¹å‡ºï¼Œè¿™é‡Œä½¿ç”¨LinkedList</span></span><br><span class="line">        LinkedList&lt;Integer&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(i &gt; <span class="number">0</span> &amp;&amp; !queue.isEmpty() &amp;&amp; queue.peekLast() &lt; nums[i]) queue.pollLast();</span><br><span class="line">            queue.offer(nums[i]);</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= k &amp;&amp; nums[i-k] == queue.peek()) queue.poll();</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= k-<span class="number">1</span>) res[i - k + <span class="number">1</span>] = queue.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š38 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†50.52% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š52.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†52.71% çš„ç”¨æˆ·</p>
<h3 id="2-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#2-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="2.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a>2.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</h3><blockquote>
<p>å¯¹äºå¤§éƒ¨åˆ†æ»‘åŠ¨çª—å£ç±»å‹çš„é¢˜ç›®ï¼Œä¸€èˆ¬æ˜¯<strong>è€ƒå¯Ÿå­—ç¬¦ä¸²çš„åŒ¹é…</strong>ã€‚æ¯”è¾ƒæ ‡å‡†çš„é¢˜ç›®ï¼Œä¼šç»™å‡ºä¸€ä¸ª<strong>æ¨¡å¼ä¸²B</strong>ï¼Œä»¥åŠä¸€ä¸ª<strong>ç›®æ ‡ä¸²A</strong>ã€‚ç„¶åæå‡ºé—®é¢˜ï¼Œæ‰¾åˆ°<strong>Aä¸­ç¬¦åˆå¯¹Bä¸€äº›é™å®šè§„åˆ™çš„å­ä¸²æˆ–è€…å¯¹Aä¸€äº›é™å®šè§„åˆ™çš„ç»“æœ</strong>ï¼Œæœ€ç»ˆ<strong>å†å°†æœç´¢å‡ºçš„å­ä¸²å®Œæˆé¢˜æ„ä¸­è¦æ±‚çš„ç»„åˆæˆ–è€…å…¶ä»–</strong>ã€‚</p>
<p>è€Œå¯¹äºè¿™ä¸€ç±»é¢˜ç›®ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è§£é¢˜æ€è·¯ï¼Œæ˜¯å»<strong>ç»´æŠ¤ä¸€ä¸ªå¯å˜é•¿åº¦çš„æ»‘åŠ¨çª—å£</strong>ã€‚æ— è®ºæ˜¯ä½¿ç”¨<strong>åŒæŒ‡é’ˆ</strong>ï¼Œè¿˜æ˜¯ä½¿ç”¨<strong>åŒç«¯é˜Ÿåˆ—</strong>ï¼Œåˆæˆ–è€…ç”¨<strong>æ¸¸æ ‡</strong>ç­‰å…¶ä»–å¥‡æŠ€æ·«å·§ï¼Œç›®çš„éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
</blockquote>
<p><strong>[ç¬¬3é¢˜]</strong> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: â€œabcabcbbâ€<br>è¾“å‡º: 3<br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œabcâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: â€œbbbbbâ€<br>è¾“å‡º: 1<br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œbâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚ </li>
<li>ç¤ºä¾‹ 3:<br>è¾“å…¥: â€œpwwkewâ€<br>è¾“å‡º: 3<br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œwkeâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚<br>è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯å­ä¸²çš„é•¿åº¦ï¼Œâ€pwkeâ€ æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šåŒæŒ‡é’ˆ</strong></p>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬çš„è¾“å…¥ä¸ºâ€œabcabcbbâ€ï¼Œæˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªçª—å£åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸­è¿›è¡Œç§»åŠ¨ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/21.jpg" alt><br>å½“ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨çª—å£æ²¡æœ‰å‡ºç°è¿‡æ—¶ï¼Œæˆ‘ä»¬æ‰©å¤§çª—å£ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/22.jpg" alt><br>å½“ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨çª—å£ä¸­å‡ºç°è¿‡æ—¶ï¼Œæˆ‘ä»¬ç¼©å°çª—å£ï¼Œå°†<strong>å‡ºç°è¿‡çš„å…ƒç´ ä»¥åŠå…¶å·¦è¾¹çš„å…ƒç´ </strong>ç»Ÿç»Ÿç§»å‡ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/23.jpg" alt><br>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬<strong>è®°å½•ä¸‹çª—å£å‡ºç°è¿‡çš„æœ€å¤§å€¼</strong>å³å¯ã€‚è€Œæˆ‘ä»¬å”¯ä¸€è¦åšçš„ï¼Œåªéœ€è¦å°½å¯èƒ½æ‰©å¤§çª—å£ã€‚</p>
<p>é‚£æˆ‘ä»¬ä»£ç ä¸­é€šè¿‡ä»€ä¹ˆæ¥ç»´æŠ¤è¿™æ ·çš„ä¸€ä¸ªçª—å£å‘¢ï¼Ÿanyway~ ä¸ç®¡æ˜¯é˜Ÿåˆ—ï¼ŒåŒæŒ‡é’ˆï¼Œç”šè‡³é€šè¿‡mapæ¥<br>åšï¼Œéƒ½å¯ä»¥ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        result = []</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line">        maxlen = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> right &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> s[right] <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">                result.append(s[right])</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">                maxlen = <span class="built_in">max</span>(maxlen, right-left)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result.remove(s[left])</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> maxlen</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:136 ms,å‡»è´¥äº†21.58% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†5.01% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> maxLen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; s.length())&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.contains(s.charAt(right))) set.remove(s.charAt(left++));</span><br><span class="line">            <span class="keyword">else</span> set.add(s.charAt(right++));</span><br><span class="line">            maxLen = Math.max(set.size(), maxLen);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š12 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†23.70% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†23.38% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šå­—å…¸</strong></p>
<blockquote>
<p>é€šè¿‡è§‚å¯Ÿï¼Œæˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ã€‚å¦‚æœæ˜¯æœ€åæƒ…å†µçš„è¯ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å¯èƒ½ä¼šè®¿é—®ä¸¤æ¬¡ï¼Œleftä¸€æ¬¡ï¼Œrightä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº†O(2N)</p>
<p>å‡è®¾æˆ‘ä»¬çš„å­—ç¬¦ä¸²ä¸ºâ€œabcdcâ€ï¼Œå¯¹äºabcæˆ‘ä»¬éƒ½è®¿é—®äº†2æ¬¡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/24.jpg" alt><br>é‚£å¦‚ä½•æ¥è¿›ä¸€æ­¥ä¼˜åŒ–å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬å¯ä»¥å®šä¹‰<strong>å­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„</strong>ï¼Œè€Œä¸æ˜¯ç®€å•é€šè¿‡ä¸€ä¸ªé›†åˆæ¥åˆ¤æ–­å­—ç¬¦æ˜¯å¦å­˜åœ¨ã€‚è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬<strong>æ‰¾åˆ°é‡å¤çš„å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³è·³è¿‡è¯¥çª—å£</strong>ï¼Œè€Œä¸éœ€è¦å¯¹ä¹‹å‰çš„å…ƒç´ è¿›è¡Œå†æ¬¡è®¿é—®ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/25.jpg" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="built_in">map</span> = &#123;&#125;</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line">        maxlen = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> right &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="comment"># å¦‚æœæœ‰é‡å¤å­—ç¬¦ç›´æ¥è·³è¿‡è¯¥çª—å£</span></span><br><span class="line">            <span class="keyword">if</span> s[right] <span class="keyword">in</span> <span class="built_in">map</span>:</span><br><span class="line">                left = <span class="built_in">max</span>(<span class="built_in">map</span>[s[right]], left)</span><br><span class="line">            maxlen = <span class="built_in">max</span>(maxlen, right-left+<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">map</span>[s[right]] = right + <span class="number">1</span></span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> maxlen</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:68 ms,å‡»è´¥äº†86.27% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†34.59% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> maxLen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; s.length())&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(s.charAt(right))) left = Math.max(left, map.get(s.charAt(right)));</span><br><span class="line">            maxLen = Math.max(right-left+<span class="number">1</span>, maxLen);</span><br><span class="line">            map.put(s.charAt(right), right+<span class="number">1</span>);</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š9 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†40.45% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†61.39% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼šåˆ©ç”¨ASCIIæ˜ å°„ï¼Œæ•°ç»„ä»£æ›¿å­—å…¸</strong></p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª128ä½çš„æ•°ç»„æ¥æ›¿ä»£å­—å…¸ã€‚ï¼ˆå› ä¸ºASCIIç è¡¨é‡Œçš„å­—ç¬¦æ€»å…±æœ‰128ä¸ªã€‚ASCIIç çš„é•¿åº¦æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œ8ä½ï¼Œç†è®ºä¸Šå¯ä»¥è¡¨ç¤º256ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è®¸å¤šæ—¶å€™åªè°ˆ128ä¸ªã€‚å…·ä½“åŸå› å¯ä»¥ä¸‹å»è‡ªè¡Œå­¦ä¹ ~ï¼‰</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        charIndex = [<span class="number">0</span>]*<span class="number">128</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line">        maxlen = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> right &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="comment"># å¦‚æœæœ‰é‡å¤å­—ç¬¦ç›´æ¥è·³è¿‡è¯¥çª—å£</span></span><br><span class="line">            <span class="comment"># ord()å°†å­—ç¬¦è½¬ASCIIç </span></span><br><span class="line">            left = <span class="built_in">max</span>(charIndex[<span class="built_in">ord</span>(s[right])], left)</span><br><span class="line">            maxlen = <span class="built_in">max</span>(maxlen, right-left+<span class="number">1</span>)</span><br><span class="line">            charIndex[<span class="built_in">ord</span>(s[right])] = right + <span class="number">1</span></span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> maxlen</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:68 ms,å‡»è´¥äº†86.27% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†11.53% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] charIndex = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> maxLen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; s.length())&#123;</span><br><span class="line">            left = Math.max(left, charIndex[s.charAt(right) + <span class="number">0</span>]);</span><br><span class="line">            maxLen = Math.max(right-left+<span class="number">1</span>, maxLen);</span><br><span class="line">            charIndex[s.charAt(right) + <span class="number">0</span>] = right + <span class="number">1</span>;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†88.31% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†40.58% çš„ç”¨æˆ·</p>
<h3 id="3-æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯"><a href="#3-æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯" class="headerlink" title="3.æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯"></a>3.æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</h3><p><strong>[ç¬¬438é¢˜]</strong> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²så’Œä¸€ä¸ªéç©ºå­—ç¬¦ä¸²pï¼Œæ‰¾åˆ°sä¸­æ‰€æœ‰æ˜¯pçš„å­—æ¯å¼‚ä½è¯çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸² s å’Œ p çš„é•¿åº¦éƒ½ä¸è¶…è¿‡20100ã€‚<br>è¯´æ˜ï¼š<br>å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚<br>ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: s: â€œcbaebabacdâ€ p: â€œabcâ€<br>è¾“å‡º: [0, 6]<br>è§£é‡Š:<br>èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ â€œcbaâ€, å®ƒæ˜¯ â€œabcâ€ çš„å­—æ¯å¼‚ä½è¯ã€‚<br>èµ·å§‹ç´¢å¼•ç­‰äº 6 çš„å­ä¸²æ˜¯ â€œbacâ€, å®ƒæ˜¯ â€œabcâ€ çš„å­—æ¯å¼‚ä½è¯ã€‚</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: s: â€œababâ€ p: â€œabâ€<br>è¾“å‡º: [0, 1, 2]<br>è§£é‡Š:<br>èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ â€œabâ€, å®ƒæ˜¯ â€œabâ€ çš„å­—æ¯å¼‚ä½è¯ã€‚<br>èµ·å§‹ç´¢å¼•ç­‰äº 1 çš„å­ä¸²æ˜¯ â€œbaâ€, å®ƒæ˜¯ â€œabâ€ çš„å­—æ¯å¼‚ä½è¯ã€‚<br>èµ·å§‹ç´¢å¼•ç­‰äº 2 çš„å­ä¸²æ˜¯ â€œabâ€, å®ƒæ˜¯ â€œabâ€ çš„å­—æ¯å¼‚ä½è¯ã€‚</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬é€šè¿‡åŒæŒ‡é’ˆç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œç”±äºæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å­—æ¯å¼‚ä½è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†çª—å£åˆå§‹åŒ–å¤§å°å’Œç›®æ ‡ä¸²ä¿æŒä¸€è‡´ã€‚</p>
<p>è€Œåˆ¤æ–­å­—æ¯å¼‚ä½è¯ï¼Œæˆ‘ä»¬éœ€è¦<strong>ä¿è¯çª—å£ä¸­çš„å­—æ¯å‡ºç°æ¬¡æ•°ä¸ç›®æ ‡ä¸²ä¸­çš„å­—æ¯å‡ºç°æ¬¡æ•°ä¸€è‡´</strong>ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ç§»åŠ¨çª—å£ï¼Œæ¥æ›´æ–°çª—å£æ•°ç»„ï¼Œè¿›è€Œå’Œç›®æ ‡æ•°ç»„åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿›è¡Œè®°å½•ã€‚æ¯ä¸€æ¬¡çª—å£ç§»åŠ¨ï¼Œ<strong>å·¦æŒ‡é’ˆå‰ç§»</strong>ï¼ŒåŸæ¥<strong>å·¦æŒ‡é’ˆä½ç½®å¤„çš„æ•°å€¼å‡1ï¼Œè¡¨ç¤ºå­—æ¯ç§»å‡º</strong>ï¼›<strong>åŒæ—¶å³æŒ‡é’ˆå‰ç§»ï¼Œå³æŒ‡é’ˆä½ç½®å¤„çš„æ•°å€¼åŠ 1ï¼Œè¡¨ç¤ºå­—æ¯ç§»å…¥</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAnagrams</span>(<span class="params">self, s: <span class="built_in">str</span>, p: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        <span class="comment"># æ€è·¯:</span></span><br><span class="line">        <span class="comment"># æƒ³è±¡ä¸€ä¸ªçª—å£åœ¨sä¸Šå‘å³ç§»åŠ¨,çª—å£å®½åº¦ä¸ºlen(p)</span></span><br><span class="line">        <span class="comment"># åªè¦çª—å£å†…çš„å­—ç¬¦ä¸²å„å­—ç¬¦æ•°é‡ä¸pä¸­ä¸€è‡´,åˆ™åŒ¹é…æˆåŠŸ</span></span><br><span class="line">        <span class="comment"># çª—å£åœ¨å‘å³ç§»åŠ¨çš„æ—¶å€™,åªéœ€è¦å°†æœ€å·¦ç«¯çš„å€¼ä»å­—å…¸ä¸­åˆ é™¤,å°†æœ€å³ç«¯+1çš„å€¼åŠ å…¥å­—å…¸å³å¯.</span></span><br><span class="line"></span><br><span class="line">        pmap = &#123;&#125;</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–ç›®æ ‡çª—å£</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">            <span class="comment">#  get() å‡½æ•°è¿”å›æŒ‡å®šé”®çš„å€¼, å¦‚æœé”®ä¸åœ¨å­—å…¸ä¸­è¿”å›é»˜è®¤å€¼ None æˆ–è€…è®¾ç½®çš„é»˜è®¤å€¼ã€‚</span></span><br><span class="line">            pmap[i] = pmap.get(i, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        plenth = <span class="built_in">len</span>(p)</span><br><span class="line"></span><br><span class="line">        rlist = []</span><br><span class="line">        rmap = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">            <span class="comment"># æ¯æ¬¡ç§»åŠ¨çª—å£ï¼Œå³æŒ‡é’ˆå€¼åŠ 1</span></span><br><span class="line">            rmap[v] = rmap.get(v, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">            <span class="comment"># ä¸ç›®æ ‡çª—å£åŒ¹é…ï¼Œè¿”å›å·¦æŒ‡é’ˆç´¢å¼•</span></span><br><span class="line">            <span class="keyword">if</span> rmap == pmap:</span><br><span class="line">                rlist.append(i - plenth + <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># æ¯æ¬¡ç§»åŠ¨çª—å£ï¼Œå·¦æŒ‡é’ˆå€¼å‡1ï¼Œå½“ä¸º0æ—¶åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> i - plenth + <span class="number">1</span> &gt;= <span class="number">0</span>:</span><br><span class="line">                rmap[s[i - plenth + <span class="number">1</span>]] = rmap.get(s[i - plenth + <span class="number">1</span>]) - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> rmap[s[i - plenth + <span class="number">1</span>]] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">del</span> rmap[s[i - plenth + <span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rlist</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:144 ms,å‡»è´¥äº†48.40% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.2 MB,å‡»è´¥äº†87.61% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">findAnagrams</span><span class="params">(String s, String p)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; pmap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> pLength = p.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;pLength; i++) pmap.put(p.charAt(i), pmap.getOrDefault(p.charAt(i), <span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        Map&lt;Character, Integer&gt; rList = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length(); i++)&#123;</span><br><span class="line">            rList.put(s.charAt(i), rList.getOrDefault(s.charAt(i), <span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(rList.equals(pmap)) res.add(i-pLength+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>((i - pLength + <span class="number">1</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                rList.put(s.charAt(i - pLength + <span class="number">1</span>), rList.get(s.charAt(i - pLength + <span class="number">1</span>))-<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (rList.get(s.charAt(i - pLength + <span class="number">1</span>)) == <span class="number">0</span>) rList.remove(s.charAt(i - pLength + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š118 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†15.26% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†21.13% çš„ç”¨æˆ·</p>
<h3 id="4-å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—"><a href="#4-å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—" class="headerlink" title="4.å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—"></a>4.å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—</h3><p><strong>[å‰‘æŒ‡57-II]</strong> è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°target ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸ºtargetçš„è¿ç»­æ­£æ•´æ•°åºåˆ—ï¼ˆè‡³å°‘å«æœ‰ä¸¤ä¸ªæ•°ï¼‰ã€‚åºåˆ—å†…çš„æ•°å­—ç”±å°åˆ°å¤§æ’åˆ—ï¼Œä¸åŒåºåˆ—æŒ‰ç…§é¦–ä¸ªæ•°å­—ä»å°åˆ°å¤§æ’åˆ—ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼štarget = 9<br>è¾“å‡ºï¼š[[2,3,4],[4,5]]</li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼štarget = 15<br>è¾“å‡ºï¼š[[1,2,3,4,5],[4,5,6],[7,8]]</li>
</ul>
<blockquote>
<p>å‡è‹¥æˆ‘ä»¬è¾“å…¥çš„targetä¸º9ï¼Œå¤§è„‘ä¸­åº”è¯¥æœ‰ä¸‹é¢è¿™ä¹ˆä¸ªç©æ„ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/40.png" alt><br>ç„¶åæˆ‘ä»¬é€šè¿‡å·¦å³æŒ‡é’ˆæ¥ç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼ŒåŒæ—¶è®¡ç®—çª—å£å†…çš„å€¼æ˜¯å¦æ˜¯ç›®æ ‡å€¼ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/41.png" alt><br>å¦‚æœçª—å£çš„å€¼è¿‡å°ï¼Œæˆ‘ä»¬å°±ç§»åŠ¨å³è¾¹ç•Œã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/42.png" alt><br>å¦‚æœçª—å£çš„å€¼è¿‡å¤§ï¼Œæˆ‘ä»¬å°±ç§»åŠ¨å·¦è¾¹ç•Œã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/43.png" alt><br>å‰©ä¸‹çš„å°±æ˜¯åå¤ä¸Šé¢çš„æ“ä½œå°±å¯ä»¥äº†ã€‚<strong>å¯¹äºä»»æ„ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ€»æ˜¯å°äºå®ƒçš„ä¸­å€¼ä¸ä¸­å€¼+1çš„å’Œã€‚</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/44.png" alt><br>æ¯”å¦‚è¿™é‡Œçš„100ï¼Œå°±ä¸€å®šå°äº50+51ï¼Œæ¢æˆå…¶ä»–æ•°ä¹Ÿä¸€æ ·ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>ä¸€æ—¦çª—å£å·¦è¾¹ç•Œè¶…è¿‡ä¸­å€¼ï¼Œçª—å£å†…çš„å’Œä¸€å®šä¼šå¤§äºtarget</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findContinuousSequence</span>(<span class="params">self, target: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">while</span> i &lt;= target // <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">if</span> tmp &lt; target:</span><br><span class="line">                tmp += j</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> tmp &gt; target:</span><br><span class="line">                tmp -= i</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result.append([x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(i, j)])</span><br><span class="line">                tmp -= i</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:104 ms,å‡»è´¥äº†84.47% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†19.37% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[][] findContinuousSequence(<span class="keyword">int</span> target) &#123;</span><br><span class="line">        List&lt;<span class="keyword">int</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">1</span>, right = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= target / <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tmp &lt; target) tmp += right++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tmp &gt; target) tmp -= left++;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span>[] temp = <span class="keyword">new</span> <span class="keyword">int</span>[right - left];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; temp.length; i++) temp[i] = left + i;</span><br><span class="line">                list.add(temp);</span><br><span class="line">                tmp -= left++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[][] res = <span class="keyword">new</span> <span class="keyword">int</span>[list.size()][];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">            res[i] = list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†79.58% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†47.66% çš„ç”¨æˆ·</p>
<h2 id="åšå¼ˆè®ºç³»åˆ—"><a href="#åšå¼ˆè®ºç³»åˆ—" class="headerlink" title="åšå¼ˆè®ºç³»åˆ—"></a>åšå¼ˆè®ºç³»åˆ—</h2><blockquote>
<p>æœ¬ç³»åˆ—å°†ä¸ºå¤§å®¶å¸¦æ¥ä¸€æ•´å¥—çš„åšå¼ˆè®ºé—®é¢˜ã€‚å› ä¸ºåœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†å¸¸è§„çš„ç®—æ³•é¢˜ç›®ï¼Œæˆ‘ä»¬ç»<br>å¸¸ä¹Ÿä¼šè¢«é—®åˆ°ä¸€äº›è¶£å‘³é¢˜å‹æ¥è€ƒå¯Ÿæ€ç»´ï¼Œè€Œè¿™ç±»é—®é¢˜ä¸­ï¼Œå¾ˆå¤šéƒ½æœ‰åšå¼ˆè®ºçš„å½±å­å­˜åœ¨ã€‚è¿™äº›å…¬å¸é‡Œä»¥FLAGï¼ˆFacebook, LinkedIn, Amazon, Googleï¼‰ä¸ºå…¸å‹ï¼Œç‰¹åˆ«å–œæ¬¢è€ƒå¯Ÿæœ¬ç±»é¢˜å‹ã€‚åŒæ—¶ï¼Œæœ¬ç³»åˆ—å°†ä¸ä¸€å®šéƒ½æ˜¯ç®—æ³•é—®é¢˜ï¼Œä¸æ˜¯ITè¡Œä¸šçš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥è¿›è¡Œå­¦ä¹ ï¼Œæ¥æé«˜åˆ†æé—®é¢˜çš„èƒ½åŠ›~</p>
</blockquote>
<h3 id="1-å›šå¾’å›°å¢ƒ"><a href="#1-å›šå¾’å›°å¢ƒ" class="headerlink" title="1.å›šå¾’å›°å¢ƒ"></a>1.å›šå¾’å›°å¢ƒ</h3><p>ä¸€ä»¶ä¸¥é‡çš„çºµç«æ¡ˆå‘ç”Ÿåï¼Œè­¦å¯Ÿåœ¨ç°åœºæŠ“åˆ°ä¸¤ä¸ªçŠ¯ç½ªå«Œç–‘äººã€‚äº‹å®ä¸Šï¼Œæ­£æ˜¯ä»–ä»¬ä¸€èµ·æ”¾ç«çƒ§äº†è¿™åº§ä»“åº“ã€‚ä½†æ˜¯ï¼Œè­¦æ–¹æ²¡æœ‰æŒæ¡è¶³å¤Ÿçš„è¯æ®ï¼Œåªå¾—æŠŠä»–ä»¬åˆ†å¼€å›šç¦èµ·æ¥ï¼Œè¦æ±‚ä»–ä»¬å¦ç™½äº¤ä»£ã€‚</p>
<p>åœ¨åˆ†å¼€å›šç¦åï¼Œè­¦å¯Ÿå¯¹å…¶åˆ†åˆ«å‘ŠçŸ¥ï¼š<br>å¦‚æœä½ å¦ç™½ï¼Œè€Œå¯¹æ–¹ä¸å¦ç™½ï¼Œåˆ™å°†ä½ é‡Šæ”¾ï¼Œåˆ¤å¯¹æ–¹8å¹´ã€‚<br>å¦‚æœä½ ä¸å¦ç™½ï¼Œè€Œå¯¹æ–¹å¦ç™½ï¼Œåˆ™å°†å¯¹æ–¹é‡Šæ”¾ï¼Œè€Œåˆ¤ä½ 8å¹´ã€‚<br>å¦‚æœä½ ä¸¤éƒ½å¦ç™½äº†ï¼Œåˆ™åˆ¤ä½ ä¸¤å„è‡ª4å¹´ã€‚<br>é‚£ä¹ˆä¸¤ä¸ªå›šçŠ¯åº”è¯¥å¦‚ä½•åšï¼Œæ˜¯äº’ç›¸èƒŒå›è¿˜æ˜¯ä¸€èµ·åˆä½œï¼Ÿ</p>
<p><strong>é¢˜ç›®åˆ†æ</strong> ä»è¡¨é¢ä¸Šçœ‹ï¼Œå…¶å®å›šçŠ¯æœ€åº”è¯¥çš„å°±æ˜¯ä¸€èµ·åˆä½œï¼Œéƒ½ä¸å¦ç™½ï¼Œè¿™æ ·å› ä¸ºè¯æ®ä¸è¶³ï¼Œä¼šå°†ä¸¤äººéƒ½è¿›è¡Œé‡Šæ”¾ã€‚<br>ä½†æ˜¯ï¼å› ä¸ºäº‹å®ç¡®å®æ˜¯ä¸¤äººæ”¾çš„ç«ï¼Œæ‰€ä»¥ä»–ä»¬<strong>ä¸å¾—ä¸è¿›è¡Œæ€è€ƒï¼Œå¦ä¸€äººé‡‡å–äº†ä»€ä¹ˆæ ·çš„è¡Œä¸ºï¼Ÿ</strong></p>
<p>çŠ¯äººç”²å½“ç„¶ä¸å‚»ï¼Œä»–æ ¹æœ¬æ— æ³•ç›¸ä¿¡åŒä¼™ä¸ä¼šå‘è­¦æ–¹æä¾›ä»»ä½•ä¿¡æ¯ï¼å› ä¸ºå¦‚æœåŒä¼™ä¸€æ—¦å¦ç™½ï¼Œè€Œè‡ªå·±è¿™è¾¹å¦‚æœä»€ä¹ˆéƒ½æ²¡è¯´çš„è¯ï¼Œå°±å¯ä»¥æ½‡æ´’è€Œå»ã€‚ä½†ä»–åŒæ—¶ä¹Ÿæ„è¯†åˆ°ï¼Œä»–çš„åŒä¼™ä¹Ÿä¸å‚»ï¼Œä¹Ÿä¼šåŒæ ·æ¥è¿™æ ·è®¾æƒ³ä»–ã€‚</p>
<p>æ‰€ä»¥çŠ¯äººç”²çš„ç»“è®ºæ˜¯ï¼Œ<strong>å”¯ä¸€ç†æ€§çš„é€‰æ‹©å°±æ˜¯èƒŒå›åŒä¼™</strong>ï¼ŒæŠŠä¸€åˆ‡éƒ½å‘Šè¯‰è­¦æ–¹ï¼è¿™æ ·çš„è¯ï¼Œå¦‚æœä»–çš„åŒä¼™ç¬¨å¾—åªä¼šä¿æŒæ²‰é»˜ï¼Œé‚£ä¹ˆä»–å°±ä¼šæ˜¯é‚£ä¸ªç¦»å¼€çš„äººã€‚è€Œå¦‚æœä»–çš„åŒä¼™ä¹Ÿæ ¹æ®è¿™ä¸ªé€»è¾‘å‘è­¦æ–¹äº¤ä»£äº†ï¼Œé‚£ä¹ˆä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œèµ·ç ä»–ä¸å¿…æœæœ€é‡çš„åˆ‘ï¼</p>
<p>è¿™åœºåšå¼ˆçš„è¿‡ç¨‹ï¼Œ<strong>æ˜¾ç„¶ä¸æ˜¯é¡¾åŠå›¢ä½“åˆ©ç›Šçš„æœ€ä¼˜è§£å†³æ–¹æ¡ˆ</strong>ã€‚ä»¥å…¨ä½“åˆ©ç›Šè€Œè¨€ï¼Œå¦‚æœä¸¤ä¸ªå‚ä¸è€…éƒ½åˆä½œä¿æŒæ²‰é»˜ï¼Œä¸¤äººéƒ½å¯ä»¥æ— ç½ªé‡Šæ”¾ï¼Œæ€»ä½“åˆ©ç›Šæ›´é«˜ï¼ä½†æ ¹æ®å‡è®¾ï¼ˆäººæ€§ï¼‰ï¼ŒäºŒäºº<strong>å‡ä¸ºç†æ€§çš„ä¸ªäºº</strong>ï¼Œä¸”åªè¿½æ±‚è‡ªå·±çš„ä¸ªäººåˆ©ç›Šã€‚å‡è¡¡çŠ¶å†µä¼šæ˜¯ä¸¤ä¸ªå›šå¾’éƒ½é€‰æ‹©èƒŒå›ï¼Œè¿™å°±æ˜¯â€œå›°å¢ƒâ€æ‰€åœ¨ï¼</p>
<p>äº‹å®ä¸Šï¼Œè¿™ç§<strong>ä¸¤äººéƒ½é€‰æ‹©å¦ç™½çš„ç­–ç•¥ä»¥åŠå› æ­¤è¢«åˆ¤4å¹´çš„ç»“å±€</strong>è¢«ç§°ä½œâ€œ<strong>çº³ä»€å‡è¡¡</strong>â€ï¼ˆä¹Ÿå«éåˆä½œå‡è¡¡ï¼‰ï¼Œæ¢è¨€ä¹‹ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œ<strong>æ— ä¸€å‚ä¸è€…å¯ä»¥â€œç‹¬è‡ªè¡ŒåŠ¨â€ï¼ˆå³å•æ–¹é¢æ”¹å˜å†³å®šï¼‰è€Œå¢åŠ æ”¶è·</strong>ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹é‡Šæ„æ˜¯å¤šä¹ˆéš¾æ‡‚â€œæ‰€è°“çº³ä»€å‡è¡¡ï¼ŒæŒ‡çš„æ˜¯å‚ä¸äººçš„ä¸€ç§ç­–ç•¥ç»„åˆï¼Œåœ¨è¯¥ç­–ç•¥ç»„åˆä¸Šï¼Œ<strong>ä»»ä½•å‚ä¸äººå•ç‹¬æ”¹å˜ç­–ç•¥éƒ½ä¸ä¼šå¾—åˆ°å¥½å¤„</strong>ã€‚â€ç®€å•ç‚¹è®²ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç­–ç•¥ç»„åˆä¸Šï¼Œå½“æ‰€æœ‰å…¶ä»–äººéƒ½ä¸æ”¹å˜ç­–ç•¥æ—¶ï¼Œæ²¡æœ‰äººä¼šæ”¹å˜è‡ªå·±çš„ç­–ç•¥ï¼Œåˆ™è¯¥ç­–ç•¥ç»„åˆå°±æ˜¯ä¸€ä¸ªçº³ä»€å‡è¡¡ã€‚</p>
<h3 id="2-è¾›æ™®æ£®æ‚–è®º"><a href="#2-è¾›æ™®æ£®æ‚–è®º" class="headerlink" title="2.è¾›æ™®æ£®æ‚–è®º"></a>2.è¾›æ™®æ£®æ‚–è®º</h3><p>ç¾Šç¾ŠåŒ»é™¢é‡Œç»Ÿè®¡äº†ä¸¤ç§èƒ†ç»“çŸ³æ²»ç–—æ–¹æ¡ˆçš„æ²»æ„ˆç‡ã€‚åœ¨ç»Ÿè®¡è¿‡ç¨‹ä¸­ï¼ŒåŒ»ç”Ÿå°†ç—…äººåˆ†ä¸ºå¤§èƒ†ç»“çŸ³å’Œå°èƒ†ç»“çŸ³ä¸¤ç»„ã€‚ç»Ÿè®¡ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/26.jpg" alt></p>
<ul>
<li>å¯¹äºå°èƒ†ç»“çŸ³è€Œè¨€ï¼Œæ‰‹æœ¯Açš„æ²»æ„ˆç‡ï¼ˆ93%ï¼‰é«˜äºæ‰‹æœ¯Bï¼ˆ87%ï¼‰</li>
<li>å¯¹äºå¤§èƒ†ç»“çŸ³è€Œè¨€ï¼Œæ‰‹æœ¯Açš„æ²»æ„ˆç‡ï¼ˆ73%ï¼‰é«˜äºæ‰‹æœ¯Bï¼ˆ69%ï¼‰</li>
</ul>
<p><strong>ç¾Šç¾ŠåŒ»é™¢çš„åŒ»ç”Ÿå¾—å‡ºç»“è®ºï¼š</strong></p>
<p>æ— è®ºæ˜¯å¯¹äºå¤§å°èƒ†ç»“çŸ³ï¼Œæ‰‹æœ¯Açš„æ²»æ„ˆç‡éƒ½èƒœè¿‡æ‰‹æœ¯Bã€‚</p>
<p>ä½†æ˜¯çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæˆ‘ä»¬æ ¹æ®æ ·æœ¬ç»Ÿè®¡å‡ºå¤§å°èƒ†ç»“çŸ³æ€»è®¡çš„æ²»æ„ˆç‡ï¼Œå‘ç°<strong>æ‰‹æœ¯B(æ²»æ„ˆç‡83%)å…¶å®æ˜¯è¦é«˜äºæ‰‹æœ¯A(æ²»æ„ˆç‡78%)</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/27.jpg" alt></p>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„ç»“æœï¼Ÿè¿™å°±æ˜¯è‘—åçš„<strong>è¾›æ™®æ£®æ‚–è®º</strong>ã€‚</p>
<p><strong>é¢˜ç›®åˆ†æ</strong> å¾—åˆ°äº†ç»“è®ºï¼Œæˆ‘ä»¬æ¥æ€è€ƒèƒŒåçš„ä¸œè¥¿ã€‚åœ¨æˆ‘ä»¬çš„ç›´è§‰é‡Œæœ‰è¿™æ ·ä¸€ä¸ªé€»è¾‘ï¼š<strong>å¦‚æœä¸€ä¸ªäº‹ç‰©çš„å„éƒ¨åˆ†éƒ½åˆ†åˆ«å¤§äºå¦ä¸€ä¸ªäº‹ç‰©çš„å„éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ç‰©å¤§äºå¦ä¸€ä¸ªäº‹ç‰©</strong>ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬çš„ç›´è§‰å‘Šè¯‰æˆ‘ä»¬å¦‚æœæ‰‹æœ¯Aåœ¨ä¸¤ç»„ç—…äººä¸­éƒ½æ›´å¥½ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰ç—…äººä¸­ä¹Ÿåº”è¯¥æ›´å¥½ã€‚<br>æˆ‘ä»¬å¯ä»¥å°†å…¶å…¬å¼åŒ–ï¼ˆ<strong>è¯¥å…¬å¼é”™è¯¯</strong>ï¼‰ï¼Œå‡è®¾ï¼š</p>
<p>A=A1+A2+â€¦.+An<br>B=B1+B2+â€¦.+Bn<br>å¦‚æœå¯¹i=1,2â€¦,néƒ½æœ‰Ai&gt;Biï¼Œåˆ™A&gt;B</p>
<p>ä¹ä¸€çœ‹ï¼Œæˆ‘ä»¬è§‰å¾—è¯¥å…¬å¼æ²¡æœ‰é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªå…¬å¼ä¹Ÿå°±ä»£è¡¨äº†æˆ‘ä»¬å¤§éƒ¨åˆ†äººçš„æ€ç»´å·¥ä½œã€‚å…¶å®åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œéšè—æ‰äº†ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶ï¼š<strong>A1ã€A2ã€An ä»¥åŠ B1ã€B2ã€Bn å¹¶ä¸èƒ½ç®€å•çš„é€šè¿‡â€œåŠ â€æ¥å¾—åˆ° Aæˆ–è€…B</strong>ã€‚è¿™å°±æ˜¯<strong>å¯åŠ æ€§</strong>çš„å‰æã€‚åœ¨å¤§è„‘çš„æ€ç»´è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆéš¾ç›´æ¥çœ‹åˆ°è¿™ä¸ªå‰æï¼Œè¿›è€Œå°±å¯¼è‡´äº†æˆ‘ä»¬é”™è¯¯çš„æ€è€ƒï¼</p>
<p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸€äº›åœ¨ç”Ÿæ´»ä¸­å¸¸è§çš„è¾›æ™®æ£®æ‚–è®ºä¾‹å­ï¼š</p>
<ul>
<li>æ‰“éº»å°†çš„æ—¶å€™ï¼ŒæŠŠæŠŠéƒ½èµ¢å°é’±ï¼Œé€ æˆèµ¢é’±çš„å‡è±¡ï¼Œå…¶å®ä¸å¦‚åˆ«äººèµ¢ä¸€æŠŠå¤§çš„ã€‚</li>
<li>åœ¨è‹¹æœå’Œå®‰å“çš„ç«äº‰ä¸­ï¼Œä½ å¬è§èº«è¾¹çš„äººéƒ½åœ¨é€ƒç¦»è‹¹æœï¼Œå¥”å‘å®‰å“ã€‚ä½†æ˜¯å…¶å®è‹¹æœçš„æµå…¥ç‡è¿˜æ˜¯è¦é«˜äºå®‰å“ã€‚ï¼ˆæœ‰æ•°æ®è¯æ˜ï¼Œå¾ˆç»å…¸çš„æ¡ˆä¾‹ï¼‰</li>
<li>ä½ ç”·ç¥¨ï¼Œè¿™é‡Œæ¯”åˆ«äººå·®ï¼Œé‚£é‡Œæ¯”åˆ«äººå·®ï¼Œä½†æ˜¯å…¶å®ä»–çœŸçš„æ¯”åˆ«çš„ç”·ç”Ÿå·®å—ï¼Ÿï¼ˆè¿™ä¸ªçº¯å±æœ¬äººèƒ¡æ‰¯äº†..ï¼‰</li>
</ul>
<h3 id="3-çº¢çœ¼ç›å’Œè“çœ¼ç›"><a href="#3-çº¢çœ¼ç›å’Œè“çœ¼ç›" class="headerlink" title="3.çº¢çœ¼ç›å’Œè“çœ¼ç›"></a>3.çº¢çœ¼ç›å’Œè“çœ¼ç›</h3><p>ä¸€ä¸ªå²›ä¸Šæœ‰100ä¸ªäººï¼Œå…¶ä¸­æœ‰5ä¸ªçº¢çœ¼ç›ï¼Œ95ä¸ªè“çœ¼ç›ã€‚è¿™ä¸ªå²›æœ‰ä¸‰ä¸ªå¥‡æ€ªçš„å®—æ•™è§„åˆ™ã€‚</p>
<p>1.ä»–ä»¬ä¸èƒ½ç…§é•œå­ï¼Œä¸èƒ½çœ‹è‡ªå·±çœ¼ç›çš„é¢œè‰²ã€‚<br>2.ä»–ä»¬ä¸èƒ½å‘Šè¯‰åˆ«äººå¯¹æ–¹çš„çœ¼ç›æ˜¯ä»€ä¹ˆé¢œè‰²ã€‚<br>3.ä¸€æ—¦æœ‰äººçŸ¥é“äº†è‡ªå·±æ˜¯çº¢çœ¼ç›ï¼Œä»–å°±å¿…é¡»åœ¨å½“å¤©å¤œé‡Œè‡ªæ€ã€‚</p>
<p>æŸå¤©ï¼Œæœ‰ä¸ªæ—…è¡Œè€…åˆ°äº†è¿™ä¸ªå²›ä¸Šã€‚ç”±äºä¸çŸ¥é“è¿™é‡Œçš„è§„çŸ©ï¼Œæ‰€ä»¥ä»–åœ¨å’Œå…¨å²›äººä¸€èµ·ç‹‚æ¬¢çš„æ—¶å€™ï¼Œä¸ç•™ç¥å°±è¯´äº†ä¸€å¥è¯ï¼šã€ä½ ä»¬è¿™é‡Œæœ‰çº¢çœ¼ç›çš„äººã€‚ã€‘</p>
<p>é—®é¢˜ï¼šå‡è®¾è¿™ä¸ªå²›ä¸Šçš„äººæ¯å¤©éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æ‰€æœ‰äººï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥åšå‡ºç¼œå¯†çš„é€»è¾‘æ¨ç†ï¼Œè¯·é—®å²›ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p><strong>é¢˜ç›®åˆ†æ</strong> é¢˜ç›®ä¹çœ‹ä¹‹ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é€»è¾‘å¯è¨€ï¼ä»¥ç›®æµ‹æ¡ä»¶ï¼ŒåŸºæœ¬æ— æ³•å®Œæˆä»»ä½•æ­£å¸¸çš„æ¨ç†ã€‚ä½†æ˜¯åœ¨ä»”ç»†æ¨æ•²ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜ç®€åŒ–ï¼Œä»å‡è®¾åªæœ‰1ä¸ªçº¢çœ¼ç›å¼€å§‹åˆ†æã€‚</p>
<p>æˆ‘ä»¬å‡è®¾å²›ä¸Šåªæœ‰1ä¸ªçº¢çœ¼ç›çš„äººï¼Œè¿˜æœ‰99ä¸ªéƒ½æ˜¯è“çœ¼ç›ã€‚å› ä¸ºè¿™ä¸ªæ—…è¡Œè€…è¯´äº†â€œè¿™é‡Œæœ‰çº¢çœ¼ç›çš„äººâ€ï¼Œ<strong>é‚£ä¹ˆåœ¨ç¬¬ä¸€å¤©çš„æ—¶å€™ï¼Œè¿™ä¸ªçº¢çœ¼ç›ä¼šå‘ç°å…¶ä»–çš„äººéƒ½æ˜¯è“çœ¼ç›</strong>ï¼ˆä¸æ­¤åŒæ—¶ï¼Œå…¶ä»–äººå› ä¸ºçœ‹åˆ°äº†è¿™ä¸ªçº¢çœ¼ç›çš„äººï¼Œæ‰€ä»¥éƒ½ç¡®è®¤äº†è‡ªå·±çš„å®‰å…¨ï¼‰<strong>é‚£ä¹ˆè¿™å¤©æ™šä¸Šï¼Œè¿™ä¸ªçº¢çœ¼ç›çš„äººä¸€å®šä¼šè‡ªæ€ï¼</strong></p>
<p>ç»§ç»­åˆ†æï¼Œå‡è®¾è¿™ä¸ªå²›ä¸Šæœ‰2ä¸ªçº¢çœ¼ç›ï¼Œé‚£ä¹ˆå½“æ—…è¡Œè€…è¯´â€œè¿™é‡Œæœ‰çº¢çœ¼ç›çš„äººâ€ä¹‹åçš„ç¬¬ä¸€å¤©ï¼Œè¿™ä¸¤ä¸ªçº¢çœ¼ç›åˆ†åˆ«å‘ç°è¿˜æœ‰åˆ«çš„çº¢çœ¼ç›å­˜åœ¨ï¼Œæ‰€ä»¥ä»–ä»¬å½“å¤©æ™šä¸Šè®¤ä¸ºè‡ªå·±æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åˆ°äº†ç¬¬äºŒå¤©ï¼Œçº¢çœ¼ç›æƒŠè®¶çš„å‘ç°ï¼Œ<strong>å¦ä¸€ä¸ªçº¢çœ¼ç›çš„äººç«Ÿç„¶æ²¡æœ‰è‡ªæ€ï¼ˆè¯´æ˜å²›ä¸Šæœ‰ä¸æ­¢ä¸€ä¸ªçº¢çœ¼ç›ï¼‰ï¼Œå¹¶ä¸”å½“å¤©ä»–ä»¬ä¹Ÿæ²¡æœ‰å‘ç°æœ‰åˆ«çš„çº¢çœ¼ç›å­˜åœ¨ï¼ˆè¯´æ˜å¦ä¸€ä¸ªçº¢çœ¼ç›å°±æ˜¯è‡ªå·±ï¼‰</strong>WTFï¼Œé‚£è‚¯å®šå¦ä¸€ä¸ªçº¢çœ¼ç›å°±æ˜¯è‡ªå·±äº†ï¼Œæ‰€ä»¥<strong>åœ¨ç¬¬äºŒå¤©å¤œé‡Œï¼Œä¸¤ä¸ªçº¢çœ¼ç›çš„äººä¼šåŒæ—¶è‡ªæ€ï¼</strong></p>
<p>ç»§ç»­åˆ†æï¼Œå‡å¦‚å²›ä¸Šçº¢çœ¼ç›æœ‰3ä¸ªã€‚é‚£ä¹ˆåœ¨ç¬¬ä¸€å¤©ï¼Œçº¢çœ¼ç›å‘ç°äº†å²›ä¸Šè¿˜æœ‰å¦å¤–ä¸¤ä¸ªçº¢çœ¼ç›ï¼Œçº¢çœ¼ç›å‘µå‘µä¸€ç¬‘ï¼Œâ€œåæ­£ä¸æ˜¯æˆ‘â€ã€‚åˆ°äº†ç¬¬äºŒå¤©ï¼Œçº¢çœ¼ç›ä»ç„¶çœ‹åˆ°äº†å¦å¤–ä¸¤ä¸ªçº¢çœ¼ç›ï¼Œçº¢çœ¼ç›å¿ƒæƒ³ï¼Œâ€è¿™ä¸‹ä½ ä¸¤è¯¥å®Œè›‹äº†å§â€ï¼Œæ¯•ç«Ÿä½ ä¸¤éƒ½çŸ¥é“äº†è‡ªå·±æ˜¯çº¢çœ¼ç›ï¼Œæ™šä¸Šå›å»ç»Ÿç»Ÿè‡ªæ€å§ï¼ï¼ˆæ ¹æ®ä¸Šé¢çš„æ¨è®ºå¾—å‡ºï¼‰ä½†æ˜¯æƒŠå¥‡çš„æ˜¯ï¼Œ<strong>åˆ°äº†ç¬¬ä¸‰å¤©ï¼Œçº¢çœ¼ç›å‘ç°å¦å¤–ä¸¤ä¸ªçº¢çœ¼ç›ç«Ÿç„¶éƒ½æ²¡æœ‰è‡ªæ€ã€‚ï¼ˆè¯´æ˜å²›ä¸Šçº¢çœ¼ç›çš„äººä¸æ­¢ä¸¤ä¸ªï¼‰</strong>å¹¶ä¸”å½“å¤©çº¢çœ¼ç›ä¹Ÿæ²¡å‘ç°æ–°çš„çº¢çœ¼ç›ï¼ˆ<strong>è¯´æ˜è¿˜æœ‰ä¸€ä¸ªçº¢çœ¼ç›å°±æ˜¯è‡ªå·±</strong>ï¼‰æ‰€ä»¥åœ¨ç¬¬ä¸‰å¤©çš„å¤œé‡Œï¼Œä¸‰ä¸ªçº¢çœ¼ç›ä¼šåŒæ—¶è‡ªæ€ã€‚</p>
<p>æ ¹æ®ä¸Šé¢çš„æ¨è®ºï¼Œ<strong>å‡è®¾æœ‰Nä¸ªçº¢çœ¼ç›ï¼Œé‚£ä¹ˆåˆ°äº†ç¬¬Nå¤©ï¼Œè¿™Nä¸ªçº¢çœ¼ç›å°±ä¼šè‡ªæ€</strong>ã€‚æ‰€ä»¥æœ€ç»ˆè¿™ä¸ªå²›ä¸Šçº¢çœ¼ç›çš„äººä¼šç»Ÿç»Ÿè‡ªæ€ï¼è¿™å°±æ˜¯ç­”æ¡ˆï¼Œç”Ÿæ´»å°±æ˜¯è¿™ä¹ˆæœ´å®æ— åï¼Œä¸”æ¯ç‡¥ã€‚</p>
<p><strong>æ—…å®¢çš„æŒ½å›</strong><br>ä¸Šé¢çš„åˆ†æå¤§å®¶åº”è¯¥éƒ½çœ‹æ‡‚äº†ã€‚ä½†è‹¥æ˜¯åœ¨æ—…å®¢è¯´å®Œè¿™å¥è¯åï¼Œå…¶å¹¶æ²¡æœ‰ç¦»å¼€è¿™ä¸ªå²›ã€‚åŒæ—¶ä»–ä¹Ÿçœ‹åˆ°äº†å‘¨å›´äººçœ¼é‡Œçš„æƒŠæ…Œå’Œå¤±æªï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ—…å®¢ä¸ºè‡ªå·±çš„è¡Œä¸ºæ„Ÿåˆ°äº†æ‡Šæ¼å’Œæ‚”æ¨ï¼æ—…å®¢å†³å®šå¯¹è‡ªå·±çš„è¯è¿›è¡ŒæŒ½å›ï¼Œæ—…å®¢åˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘æä¾›ä¸€ç§æ€è·¯ï¼Œ<strong>æ—…å®¢å¯ä»¥åœ¨ç¬¬Næ¬¡é›†ä¼šä¸Šæ€æ‰Nä¸ªçº¢çœ¼ç›</strong>ï¼Œè®©è¿™Nä¸ªçº¢çœ¼ç› â€œGO TO SLEEPâ€ï¼Œå°±å¯ä»¥ä¸­æ–­äº‹ä»¶çš„æ¨ç†ã€‚äº‹å®ä¸Šï¼ŒåŸºäºäººé“ä¸»ä¹‰ï¼Œæ—…å®¢å¹¶ä¸éœ€è¦æ‰‹åŠ¨æ€äººï¼Œå¥¹åªéœ€è¦åœ¨ç¬¬Nå¤©çš„æ—¶å€™å‘Šè¯‰è¿™Nä¸ªäººï¼Œä½ ä»¬æ˜¯çº¢çœ¼ç›ï¼Œé‚£ä¹ˆè¿™å¤©æ™šä¸Šï¼Œè¿™Nä¸ªäººå°±ä¼šè‡ªæ€ã€‚â€All RETURNâ€ï¼Œä¸€åˆ‡å°†å›å½’ç§©åº~</p>
<h3 id="4-æµ·ç›—åˆ†é‡‘å¸"><a href="#4-æµ·ç›—åˆ†é‡‘å¸" class="headerlink" title="4.æµ·ç›—åˆ†é‡‘å¸"></a>4.æµ·ç›—åˆ†é‡‘å¸</h3><p>åœ¨å¤§æµ·ä¸Šï¼Œæœ‰5ä¸ªæµ·ç›—æŠ¢å¾—100æšé‡‘å¸ï¼Œä»–ä»¬å†³å®šæ¯ä¸€ä¸ªäººæŒ‰é¡ºåºä¾æ¬¡æå‡ºè‡ªå·±çš„åˆ†é…æ–¹æ¡ˆï¼Œå¦‚æœæå‡ºçš„æ–¹æ¡ˆæ²¡æœ‰è·å¾—åŠæ•°æˆ–åŠæ•°ä»¥ä¸Šçš„äººçš„åŒæ„ï¼Œåˆ™è¿™ä¸ªæå‡ºæ–¹æ¡ˆçš„äººå°±è¢«æ‰”åˆ°æµ·é‡Œå–‚é²¨é±¼ã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªæå‡ºæ–¹æ¡ˆçš„äººè¦æ€ä¹ˆåšï¼Œæ‰èƒ½ä½¿è‡ªå·±çš„åˆ©ç›Šæœ€å¤§åŒ–ï¼Ÿ</p>
<p>æµ·ç›—ä»¬æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š<br>1.è¶³æ™ºå¤šè°‹ï¼Œæ€»æ˜¯é‡‡å–æœ€ä¼˜ç­–ç•¥ã€‚<br>2.è´ªç”Ÿæ€•æ­»ï¼Œå°½é‡ä¿å…¨è‡ªå·±æ€§å‘½ã€‚<br>3.è´ªå¾—æ— åŒï¼Œå¸Œæœ›è‡ªå·±å¾—åˆ°è¶Šå¤šå®çŸ³è¶Šå¥½<br>4.å¿ƒç‹ æ‰‹è¾£ï¼Œåœ¨è‡ªå·±åˆ©ç›Šæœ€å¤§çš„æƒ…å†µä¸‹å¸Œæœ›è¶Šå¤šäººæ­»è¶Šå¥½ã€‚<br>5.ç–‘å¿ƒå¤šè™‘ï¼Œä¸ä¿¡ä»»å½¼æ­¤ï¼Œå°½é‡ç¡®ä¿è‡ªèº«åˆ©ç›Šä¸å¯„å¸Œæœ›ä¸åˆ«äººç»™è‡ªå·±æ›´å¤§åˆ©ç›Šã€‚</p>
<p><strong>é¢˜ç›®åˆ†æ</strong> é¦–å…ˆæˆ‘ä»¬å¾ˆå®¹æ˜“ä¼šè§‰å¾—ï¼ŒæŠ½ç­¾åˆ°ç¬¬ä¸€ä¸ªææ–¹æ¡ˆçš„æµ·ç›—ä¼šå¾ˆåƒäºï¼å› ä¸ºåªè¦æ­»çš„äººå¤Ÿå¤šï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªäººè·å–çš„é‡‘å¸å°±æœ€å¤šï¼Œè€Œç¬¬ä¸€ä¸ªææ–¹æ¡ˆçš„äººæ˜¯æœ€å®¹æ˜“æ­»çš„ã€‚ä½†æ˜¯äº‹å®æ˜¯ï¼Œåœ¨æ»¡è¶³æµ·ç›—ç‰¹ç‚¹çš„åŸºç¡€ä¸Šï¼Œ<strong>ç¬¬ä¸€ä¸ªææ–¹æ¡ˆçš„æµ·ç›—æ˜¯æœ€èµšçš„</strong>ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬è®¾æƒ³åªæœ‰ä¸¤ä¸ªæµ·ç›—ã€‚é‚£ä¹ˆä¸ç®¡ç¬¬ä¸€ä¸ªè¯´ä»€ä¹ˆï¼Œåªè¦ç¬¬äºŒä¸ªäººä¸åŒæ„ï¼Œç¬¬äºŒä¸ªäººå°±å¯ä»¥å¾—åˆ°å…¨éƒ¨çš„é‡‘å¸ï¼æ‰€ä»¥ç¬¬ä¸€ä¸ªæµ·ç›—å¿…æ­»æ— ç–‘ï¼Œè¿™ä¸ªå¤§å®¶éƒ½èƒ½ç†è§£ã€‚ï¼ˆå½“ç„¶ï¼Œè¿™æ ·çš„å‰ææ˜¯ä¸€å·æå‡ºæ–¹æ¡ˆåä¸å¯ä»¥é©¬ä¸Šè‡ªå·±åŒæ„ï¼Œä¸ç„¶å¦‚æœè‡ªå·±æå‡ºç»™è‡ªå·±å…¨éƒ¨é‡‘å¸çš„æ–¹æ¡ˆï¼Œç„¶åè‡ªå·±æ”¯æŒï¼Œè¿™æ ·å°±æ˜¯äºŒå·å¿…æ­»æ— ç–‘ï¼‰</p>
<p>å‡å¦‚ç°åœ¨æˆ‘ä»¬åŠ å…¥ç¬¬ä¸‰ä¸ªæµ·ç›—ï¼Œè¿™æ—¶å€™åŸæ¥çš„ä¸€å·æˆä¸ºäº†äºŒå·ï¼ŒäºŒå·æˆä¸ºäº†ä¸‰å·ã€‚è¿™æ—¶å€™ç°åœ¨çš„äºŒå·å¿ƒé‡Œä¼šæ¸…æ¥šï¼Œ<strong>å¦‚æœä»–æŠ•æ­»äº†ä¸€å·ï¼Œé‚£ä¹ˆè‡ªå·±å¿…æ­»æ— ç–‘ï¼</strong>æ‰€ä»¥æ ¹æ®è´ªç”Ÿæ€•æ­»çš„åŸåˆ™ï¼ŒäºŒå·è‚¯å®šä¼šè®©ä¸€å·å­˜æ´»ã€‚è€Œæ­¤æ—¶ä¸€å·å¿ƒç†ä¹Ÿæ¸…æ¥šï¼Œæ— è®ºè‡ªå·±æå‡ºä»€ä¹ˆæ ·çš„æ–¹æ¡ˆï¼ŒäºŒå·éƒ½ä¼šè®©è‡ªå·±å­˜æ´»ï¼Œè€Œè¿™æ—¶åªè¦åŠ ä¸Šè‡ªå·±çš„ä¸€ç¥¨ï¼Œå°±æœ‰åŠæ•°é€šè¿‡ï¼Œæ‰€ä»¥ä¸€å·æå‡ºæ–¹æ¡ˆï¼šæŠŠé‡‘å¸éƒ½ç»™æˆ‘ã€‚</p>
<p>ç°åœ¨åˆç»§ç»­åŠ å…¥äº†æ–°çš„æµ·ç›—ï¼åŸæ¥çš„1,2,3å·ï¼Œæˆä¸ºäº†ç°åœ¨çš„2,3,4å·ã€‚è¿™æ—¶å€™æ–°çš„ä¸€å·æµ·ç›—æ´æ‚‰äº†å¥¥ç§˜ï¼ŒçŸ¥é“äº†<strong>å¦‚æœè‡ªå·±æ­»äº†ï¼ŒäºŒå·å°±å¯ä»¥è·å–å…¨éƒ¨çš„é‡‘å¸</strong>ï¼Œæ‰€ä»¥æå‡ºç»™ä¸‰å·å’Œå››å·ä¸€äººä¸€ä¸ªé‡‘å¸ï¼Œä¸€èµ·æŠ•æ­»2å·ã€‚è€Œä¸æ­¤åŒæ—¶ï¼Œç°åœ¨çš„3å·å’Œ4å·è·å–çš„è¦æ¯”ä¸‰ä¸ªäººæ—¶å¤šï¼ˆä¸‰ä¸ªäººæ—¶è‡ªå·±è·å–ä¸äº†ä»»ä½•é‡‘å¸ï¼‰ï¼Œæ‰€ä»¥ä»–ä»¬ä¼šåŒæ„è¿™ä¸ªæ–¹æ¡ˆï¼</p>
<p>ç°åœ¨åŠ å…¥æˆ‘ä»¬çš„å¤§Bossï¼Œæœ€åä¸€ä¸ªæµ·ç›—ã€‚æ ¹æ®åˆ†æï¼Œå¤§Bossæµ·ç›—1å·æ¨çŸ¥å‡º2å·çš„æ–¹æ¡ˆåå°±å¯ä»¥æå‡º(97,0,1,2,0)æˆ–è€…(97,0,1,0,2)çš„æ–¹æ¡ˆã€‚è¿™æ ·çš„åˆ†é…æ–¹æ¡ˆå¯¹ç°åœ¨çš„3å·æµ·ç›—ç›¸æ¯”ç°åœ¨çš„2å·çš„åˆ†é…æ–¹æ¡ˆè¿˜å¤šäº†ä¸€æšé‡‘å¸ï¼Œå°±ä¼šæŠ•èµæˆç¥¨ï¼Œ4å·æˆ–è€…5å·å› ä¸ºå¾—åˆ°äº†2æšé‡‘å¸ï¼Œç›¸æ¯”2å·çš„ä¸€æšå¤šï¼Œä¹Ÿä¼šæ”¯æŒ1å·ï¼ŒåŠ ä¸Š1å·è‡ªå·±çš„èµæˆç¥¨ï¼Œæ–¹æ¡ˆå°±ä¼šé€šè¿‡ï¼Œå³1å·æå‡º(97,0,1,2,0)æˆ–(97,0,1,0,2)çš„åˆ†é…æ–¹æ¡ˆï¼Œå¤§BossæˆåŠŸè·å¾—äº†97æšé‡‘å¸ã€‚</p>
<p><strong>æ€è€ƒ</strong> æœ€ç»ˆï¼Œå¤§Bossä¸€å·æµ·ç›—å¾—åˆ°97æšé‡‘å¸ï¼ŒæŠ•æ­»äº†è€äºŒå’Œè€äº”ï¼Œè¿™ç«Ÿç„¶æ˜¯æˆ‘ä»¬åˆ†æå‡ºçš„æœ€ä½³æ–¹æ¡ˆï¼è¿™ä¸ªç­”æ¡ˆæ˜æ˜¾æ˜¯åç›´è§‰çš„ï¼Œå¦‚æœä½ æ˜¯è€å¤§ï¼Œä½ æ•¢è¿™æ ·åˆ†é‡‘å¸ï¼Œå¿…æ­»æ— ç–‘ã€‚å¯æ˜¯ï¼Œæ¨ç†è¿‡ç¨‹å´éå¸¸ä¸¥è°¨ï¼Œæ— æ‡ˆå¯å‡»ï¼Œé‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼Œåœ¨â€æµ·ç›—åˆ†èµƒâ€æ¨¡å‹ä¸­ï¼Œä»»ä½•â€åˆ†é…è€…â€æƒ³è®©è‡ªå·±çš„æ–¹æ¡ˆè·å¾—é€šè¿‡çš„å…³é”®æ˜¯ï¼Œäº‹å…ˆè€ƒè™‘æ¸…æ¥šâ€å¯¹æ‰‹â€çš„åˆ†é…æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Œ<strong>å¹¶ç”¨æœ€å°çš„ä»£ä»·è·å–æœ€å¤§æ”¶ç›Šï¼Œæ‹‰æ‹¢â€å¯¹æ‰‹â€åˆ†é…æ–¹æ¡ˆä¸­æœ€ä¸å¾—æ„çš„äººä»¬</strong>ã€‚1å·çœ‹èµ·æ¥æœ€æœ‰å¯èƒ½å–‚é²¨é±¼ï¼Œä½†ä»–ç‰¢ç‰¢åœ°æŠŠæ¡ä½å…ˆå‘ä¼˜åŠ¿ï¼Œç»“æœä¸ä½†æ¶ˆé™¤äº†æ­»äº¡å¨èƒï¼Œè¿˜æ”¶ç›Šæœ€å¤§ã€‚è€Œ5å·ï¼Œçœ‹èµ·æ¥æœ€å®‰å…¨ï¼Œæ²¡æœ‰æ­»äº¡çš„å¨èƒï¼Œç”šè‡³è¿˜èƒ½åæ”¶æ¸”äººä¹‹åˆ©ï¼Œå´å› ä¸å¾—ä¸çœ‹åˆ«äººè„¸è‰²è¡Œäº‹è€Œåªèƒ½åˆ†å¾—ä¸€å°æ¯ç¾¹ã€‚</p>
<p>ä¸è¿‡ï¼Œæ¨¡å‹ä»»æ„æ”¹å˜ä¸€ä¸ªå‡è®¾æ¡ä»¶ï¼Œæœ€ç»ˆç»“æœéƒ½ä¸ä¸€æ ·ã€‚è€Œç°å®ä¸–ç•Œè¿œæ¯”æ¨¡å‹å¤æ‚ã€‚<strong>å› ä¸ºå‡å®šæ‰€æœ‰äººéƒ½ç†æ€§ï¼Œæœ¬èº«å°±æ˜¯ä¸ç†æ€§çš„ã€‚</strong>å›åˆ°â€œæµ·ç›—åˆ†é‡‘â€çš„æ¨¡å‹ä¸­ï¼Œåªè¦3å·ã€4å·æˆ–5å·ä¸­æœ‰ä¸€ä¸ªäººåç¦»äº†ç»å¯¹èªæ˜çš„å‡è®¾ï¼Œæµ·ç›—1å·æ— è®ºæ€ä¹ˆåˆ†éƒ½å¯èƒ½ä¼šè¢«æ‰”åˆ°æµ·é‡Œå»äº†ã€‚æ‰€ä»¥ï¼Œ1å·é¦–å…ˆè¦è€ƒè™‘çš„å°±æ˜¯ä»–çš„æµ·ç›—å…„å¼Ÿä»¬çš„èªæ˜å’Œç†æ€§ç©¶ç«Ÿé å¾—ä½é ä¸ä½ï¼Œå¦åˆ™å…ˆåˆ†è€…å¿…å®šå€’éœ‰ã€‚</p>
<p>å¦‚æœæŸäººå’Œä¸€å·æœ¬èº«ä¸å¯¹çœ¼ï¼Œå°±æƒ³ä¸¢ä»–å–‚é²¨é±¼ã€‚æœçœŸå¦‚æ­¤ï¼Œ1å·è‡ªä»¥ä¸ºå¾—æ„çš„æ–¹æ¡ˆå²‚ä¸æˆäº†è‡ªæ˜åŸå¢“ã€‚å†å°±æ˜¯ä¿—è¯æ‰€è¯´çš„â€œäººå¿ƒéš”è‚šçš®â€ã€‚ç”±äºä¿¡æ¯ä¸å¯¹ç§°ï¼Œè°è¨€å’Œè™šå‡æ‰¿è¯ºå°±å¤§æœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œè€Œé˜´è°‹ä¹Ÿä¼šåƒæ‚è‰èˆ¬ç–¯é•¿ï¼Œå¹¶å€Ÿæœºè·ç›Šã€‚å¦‚æœ2å·å¯¹3ã€4ã€5å·å¤§æ”¾çƒŸå¹•å¼¹ï¼Œå®£ç§°å¯¹äº1å·æ‰€æå‡ºä»»ä½•åˆ†é…æ–¹æ¡ˆï¼Œä»–ä¸€å®šä¼šå†å¤šåŠ ä¸Šä¸€ä¸ªé‡‘å¸ç»™ä»–ä»¬ã€‚è¿™æ ·ï¼Œç»“æœåˆå½“å¦‚ä½•ï¼Ÿ</p>
<p>é€šå¸¸ï¼Œç°å®ä¸­äººäººéƒ½æœ‰è‡ªè®¤çš„å…¬å¹³æ ‡å‡†ï¼Œå› è€Œæ—¶å¸¸ä¼šå˜Ÿåš·ï¼šâ€œ<strong>è°åŠ¨äº†æˆ‘çš„å¥¶é…ªï¼Ÿ</strong>â€å¯ä»¥æ–™æƒ³ï¼Œä¸€æ—¦1å·æ‰€ææ–¹æ¡ˆå’Œå…¶æ‰€æƒ³çš„ä¸ç¬¦ï¼Œå°±ä¼šæœ‰äººå¤§é—¹ã€‚å½“å¤§å®¶éƒ½é—¹èµ·æ¥çš„æ—¶å€™ï¼Œ1å·èƒ½æ‹¿ç€97æšé‡‘å¸æ¯«å‘æ— æŸã€é•‡å®šè‡ªè‹¥åœ°èµ°å‡ºå»å—ï¼Ÿæœ€å¤§çš„å¯èƒ½å°±æ˜¯ï¼Œæµ·ç›—ä»¬ä¼šè¦æ±‚ä¿®æ”¹è§„åˆ™ï¼Œç„¶åé‡æ–°åˆ†é…ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è®²æ¸…æ¥šä¸‹æ¬¡å†å¾—100æšé‡‘å¸æ—¶ï¼Œå…ˆç”±2å·æµ·ç›—æ¥åˆ†â€¦ç„¶åæ˜¯3å·â€¦â€¦é¢‡æœ‰ç‚¹åƒç¾å›½æ€»ç»Ÿé€‰ä¸¾ï¼Œè½®æµä¸»æ”¿ã€‚è¯´ç™½äº†ï¼Œå…¶å®æ˜¯æ°‘ä¸»å½¢å¼ä¸‹çš„åˆ†èµƒåˆ¶ã€‚</p>
<p>æœ€å¯æ€•çš„æ˜¯å…¶ä»–å››äººå½¢æˆä¸€ä¸ªå1å·çš„å¤§è”ç›Ÿå¹¶åˆ¶å®šå‡ºæ–°è§„åˆ™ï¼šå››äººå¹³åˆ†é‡‘å¸ï¼Œå°†1å·æ‰”è¿›å¤§æµ·ã€‚è¿™å°±é¢‡æœ‰ç‚¹é˜¿Qå¼çš„é©å‘½ç†æƒ³ï¼šé«˜ä¸¾å¹³å‡ä¸»ä¹‰çš„æ——å¸œï¼Œå°†å¯Œäººæ‰”è¿›æ­»äº¡æ·±æ¸Šã€‚</p>
<h3 id="5-æ™ºçŒªåšå¼ˆ"><a href="#5-æ™ºçŒªåšå¼ˆ" class="headerlink" title="5.æ™ºçŒªåšå¼ˆ"></a>5.æ™ºçŒªåšå¼ˆ</h3><p>å‡è®¾çŒªåœˆé‡Œæœ‰ä¸€å¤´å¤§çŒªã€ä¸€å¤´å°çŒªã€‚çŒªåœˆçš„ä¸€å¤´æœ‰çŒªé£Ÿæ§½ï¼Œå¦ä¸€å¤´å®‰è£…ç€æ§åˆ¶çŒªé£Ÿä¾›åº”çš„æŒ‰é’®ï¼ŒæŒ‰ä¸€ä¸‹æŒ‰é’®ä¼šæœ‰10ä¸ªå•ä½çš„çŒªé£Ÿè¿›æ§½ï¼Œ,ä½†æ˜¯æŒ‰æŒ‰é’®ä»¥åè·‘åˆ°é£Ÿæ§½æ‰€éœ€è¦ä»˜å‡ºçš„åŠ³åŠ¨é‡ï¼ŒåŠ èµ·æ¥è¦æ¶ˆè€—ç›¸å½“äº2ä¸ªå•ä½çš„çŒªé£Ÿã€‚å¹¶ä¸”å› ä¸ºæŒ‰é’®å’Œé£Ÿæ§½åˆ†ç½®ç¬¼å­çš„ä¸¤ç«¯ï¼Œç­‰åˆ°æŒ‰æŒ‰é’®çš„çŒªä»˜å‡ºåŠ³åŠ¨è·‘åˆ°é£Ÿæ§½çš„æ—¶å€™ï¼Œåäº«å…¶æˆçš„å¦ä¸€å¤´çŒªæ—©å·²åƒäº†ä¸å°‘ã€‚å¦‚æœå¤§çŒªå…ˆåˆ°ï¼ˆå°çŒªæŒ‰ï¼‰ï¼Œå¤§çŒªåƒæ‰9ä¸ªå•ä½ï¼Œå°çŒªåªèƒ½åƒåˆ°1ä¸ªå•ä½ï¼›å¦‚æœåŒæ—¶åˆ°è¾¾ï¼ˆä¹Ÿå°±æ˜¯ä¸€èµ·æŒ‰ï¼‰ï¼Œå¤§çŒªåƒæ‰7ä¸ªå•ä½ï¼Œå°çŒªåƒåˆ°3ä¸ªå•ä½ï¼›å¦‚æœå°çŒªå…ˆåˆ°ï¼ˆå¤§çŒªæŒ‰ï¼‰ï¼Œå°çŒªå¯ä»¥åƒåˆ°4ä¸ªå•ä½ï¼Œè€Œå¤§çŒªåƒåˆ°6ä¸ªå•ä½ã€‚é‚£ä¹ˆï¼Œåœ¨ä¸¤å¤´çŒªéƒ½è¶³å¤Ÿèªæ˜çš„å‰æä¸‹ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>é¦–å…ˆå°çŒªå¦‚æœå»æŒ‰æŒ‰é’®ï¼Œç„¶åå†å›æ¥çš„è¯ï¼Œåªèƒ½åƒåˆ°ä¸€ä»½çŒªé£Ÿï¼Œç›´æ¥å°±å—å±äº†ï¼Œè¿™ç§å¯èƒ½æ€§è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚è‡ªç„¶ï¼Œè¿™æ—¶å¤§çŒªä¹Ÿå°±åªæœ‰å»æŒ‰æŒ‰é’®è¿™ä¸€ä¸ªé€‰é¡¹äº†ã€‚æ‰€ä»¥æœ€ç»ˆçš„ç»“æœä¼šæ˜¯ï¼š<strong>å°çŒªé€‰æ‹©ç­‰å¾…ï¼Œå¤§çŒªå»æŒ‰æŒ‰é’®</strong>ã€‚</p>
<ul>
<li><p>å¦‚æœå°çŒªå’Œå¤§çŒªåŒæ—¶è¡ŒåŠ¨çš„è¯ï¼Œåˆ™å®ƒä»¬åŒæ—¶åˆ°è¾¾é£Ÿæ§½ï¼Œåˆ†åˆ«å¾—åˆ°1ä¸ªå•ä½å’Œ5ä¸ªå•ä½çš„çº¯æ”¶ç›Šï¼ˆä»˜å‡º4ä¸ªå•ä½çš„æˆæœ¬ï¼‰</p>
</li>
<li><p>å¦‚æœå¤§çŒªè¡ŒåŠ¨ï¼Œå°çŒªç­‰å¾…ï¼Œå°çŒªå¯å¾—åˆ°4ä¸ªå•ä½çš„çº¯æ”¶ç›Šï¼Œå¤§çŒªå¾—åˆ°çš„6ä¸ªå•ä½ï¼Œä»˜å‡º2ä¸ªå•ä½çš„æˆæœ¬ï¼Œå®å¾—4ä¸ªå•ä½ï¼›</p>
</li>
<li><p>å¦‚æœå¤§çŒªç­‰å¾…ï¼Œå°çŒªè¡ŒåŠ¨ï¼Œå°çŒªåªèƒ½åƒåˆ°1ä¸ªå•ä½ï¼Œåˆ™å°çŒªçš„æ”¶å…¥å°†ä¸æŠµæˆæœ¬ï¼Œçº¯æ”¶ç›Šä¸º-1ã€‚</p>
</li>
<li><p>å¦‚æœå¤§çŒªç­‰å¾…ï¼Œå°çŒªä¹Ÿç­‰å¾…ï¼Œé‚£ä¹ˆå°çŒªçš„æ”¶ç›Šä¸ºé›¶ï¼Œæˆæœ¬ä¹Ÿä¸ºé›¶ï¼Œæ€»ä¹‹ï¼Œå°çŒªç­‰å¾…è¿˜æ˜¯è¦ä¼˜äºè¡ŒåŠ¨ã€‚</p>
</li>
</ul>
<p>è¿™é“é¢˜ç›®æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„â€œ<strong>åŠ£åŠ¿ç­–ç•¥â€ä¸‹çš„å¯é¢„æµ‹é—®é¢˜</strong>ï¼Œå…¶åœ¨å„é«˜æ ¡ç»æµå­¦è¯¾ç¨‹ä¸­ä¹Ÿè¢«æ”¾åœ¨ä¸€ä¸ªä¸¾è¶³è½»é‡çš„åœ°ä½ä¸Šã€‚åŸå› æ— ä»–ï¼Œæ­£æ˜¯å¤§çŒªåšå‡ºè¿™æ ·ä¸€ä¸ªâ€œå†³ç­–â€ï¼Œç›®çš„ä¸æ˜¯å‡ºäºå¯¹å°çŒªçš„çˆ±ï¼Œ<strong>è€Œæ˜¯åŸºäºâ€œè‡ªåˆ©â€çš„åŸåˆ™</strong>ã€‚</p>
</blockquote>
<h3 id="6-ç”Ÿç”·ç”Ÿå¥³é—®é¢˜"><a href="#6-ç”Ÿç”·ç”Ÿå¥³é—®é¢˜" class="headerlink" title="6.ç”Ÿç”·ç”Ÿå¥³é—®é¢˜"></a>6.ç”Ÿç”·ç”Ÿå¥³é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢˜ç›®ï¼šå›½å®¶ä¸ºäº†è°ƒæ§ç”·å¥³æ¯”ä¾‹ï¼Œåˆ¶å®šäº†ä¸€ä¸ªæ”¿ç­–ï¼šæ–°å©šå¤«å¦‡éƒ½å¿…é¡»ç”Ÿå¨ƒï¼ˆæ¥åœ°æ°”ï¼‰ï¼Œå¦‚æœç”Ÿå‡ºçš„æ˜¯ç”·å¨ƒå°±ä¸èƒ½å†ç”Ÿäº†ï¼Œå¦‚æœç”Ÿå‡ºçš„æ˜¯å¥³å¨ƒå°±å¿…é¡»ç»§ç»­ç”Ÿä¸‹å»ï¼Œç›´åˆ°ç”Ÿå‡ºç¬¬ä¸€ä¸ªç”·å¨ƒä¸ºæ­¢ï¼ˆå‡ºé¢˜äººç‰›Pï¼‰ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>é—®é¢˜æ˜¯ï¼šè‹¥å¹²å¹´åï¼Œè¯¥å›½çš„ç”·å¥³æ¯”ä¾‹ä¼šå‘ç”Ÿæ€æ ·çš„å˜åŒ–ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>å…¶å®è¿™ä¸ªé—®é¢˜ç­”æ¡ˆæ˜¯æ¯”è¾ƒåç›´è§‰çš„ï¼š<strong>æ²¡æœ‰å˜åŒ–</strong>ã€‚åŸå› æ˜¯å› ä¸ºï¼š<strong>ç”Ÿç”·ç”Ÿå¥³çš„æ¦‚ç‡æ°¸è¿œéƒ½æ˜¯ç™¾åˆ†ä¹‹50</strong>ã€‚</p>
<p>æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¢ä¸€ç§æ€è·¯ï¼šæˆ‘ä»¬ä¸å¦¨å‡è®¾æŠŠä¸€å¤§æ‰¹æ–°å©šå¤«å¦‡å…³åœ¨ä¸€ä¸ªè¶…å¤§çš„å±‹å­é‡Œï¼Œé€¼ç€ä»–ä»¬è¿›è¡Œä¸€è½®ä¸€è½®çš„ç”Ÿå­©å­æ¸¸æˆã€‚ç¬¬ä¸€è½®é‡Œï¼Œæœ‰ä¸€åŠçš„å¤«å¦‡ç”Ÿäº†ç”·å¨ƒï¼Œé€€å‡ºäº†æ¸¸æˆï¼›å¦ä¸€åŠå¤«å¦‡å¾—åˆ°çš„æ˜¯å¥³å¨ƒï¼Œè¿›å…¥ç¬¬äºŒè½®ã€‚åœ¨ç¬¬äºŒè½®é‡Œé¢ï¼Œåˆæœ‰ä¸€åŠç”±äºç”Ÿå‡ºç”·å¨ƒè€Œé€€å‡ºï¼Œè‡ªç„¶ï¼Œå¦ä¸€åŠç”Ÿå‡ºå¥³å¨ƒçš„å¤«å¦‡è¿›å…¥ç¬¬ä¸‰è½®â€¦â€¦æ³¨æ„åˆ°ï¼Œåœ¨æ¯ä¸€è½®é‡Œï¼Œæ–°ç”Ÿç”·å¨ƒå’Œæ–°ç”Ÿå¥³å¨ƒéƒ½æ˜¯ä¸€æ ·å¤šçš„ï¼Œå› æ­¤æŠŠæ‰€æœ‰è½®æ•°åˆåœ¨ä¸€èµ·çœ‹ï¼Œç”·å¨ƒçš„æ€»æ•°å’Œå¥³å¨ƒçš„æ€»æ•°ä¹Ÿä¸€å®šæ˜¯ç›¸åŒçš„ã€‚</p>
</blockquote>
<h3 id="7-ç¡¬å¸é—®é¢˜"><a href="#7-ç¡¬å¸é—®é¢˜" class="headerlink" title="7.ç¡¬å¸é—®é¢˜"></a>7.ç¡¬å¸é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢˜ç›®ï¼šAå’ŒBä¸¤äººä¸ºäº†ç«ä»·ä¸€ä¸ªæ‹å–å“ï¼Œå†³å®šç”¨æŠ›æ·ç¡¬å¸çš„åŠæ³•æ¥åˆ¤æ–­è°æœ‰èµ„æ ¼ã€‚ä¸ºäº†è®©æ¸¸æˆè¿‡ç¨‹æ›´åŠ åˆºæ¿€ï¼ŒAæå‡ºäº†è¿™æ ·ä¸€ä¸ªæ–¹æ¡ˆï¼šè¿ç»­æŠ›æ·ç¡¬å¸ï¼Œç›´åˆ°æœ€è¿‘ä¸‰æ¬¡ç¡¬å¸æŠ›æ·ç»“æœæ˜¯â€œæ­£ååâ€æˆ–è€…â€œååæ­£â€ã€‚å¦‚æœæ˜¯å‰è€…ï¼Œé‚£ä¹ˆAè·èƒœï¼›å¦‚æœæ˜¯åè€…ï¼Œé‚£ä¹ˆBè·èƒœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>é—®é¢˜æ˜¯ï¼šBåº”è¯¥æ¥å—Açš„æè®®å—ï¼Ÿæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ¸¸æˆæ˜¯å…¬å¹³çš„å—ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>äº‹å®ï¼Œè¯¥æ¸¸æˆå¹¶ä¸å…¬å¹³ã€‚è™½ç„¶â€œæ­£ååâ€å’Œâ€œååæ­£â€åœ¨é¢‘ç‡ä¸Šå‡ºç°çš„ä¸€æ ·ï¼Œä½†æ˜¯å…¶ä¹‹é—´å´æœ‰ä¸€ä¸ªç«äº‰å…³ç³»ï¼š<strong>ä¸€æ—¦æŠ›ç¡¬å¸äº§ç”Ÿå…¶ä¸­ä¸€ç§åºåˆ—ï¼Œæ¸¸æˆå³ç»“æŸ</strong>ã€‚æ‰€ä»¥ä¸è®ºä½•æ—¶ï¼Œåªè¦æŠ›å‡ºä¸€ä¸ªæ­£é¢ï¼Œä¹Ÿå°±æ„å‘³ç€Bå¿…è¾“æ— ç–‘ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æ•´ä¸ªæ¸¸æˆçš„å‰ä¸¤æ¬¡æŠ›æ·ä¸­ï¼Œåªè¦å‡ºç°â€œæ­£æ­£â€ï¼Œâ€œæ­£åâ€ï¼Œâ€œåæ­£â€å…¶ä¸­ä»»ä¸€ï¼ŒAåˆ™ä¸€å®šä¼šå–å¾—èƒœåˆ©ã€‚Aå’ŒBçš„æ¦‚ç‡æ¯”è¾¾åˆ°3:1ï¼Œä¼˜åŠ¿ä¸è¨€è€Œå–»ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/45.png" alt></p>
</blockquote>
<h3 id="8-ç”»åœˆåœˆçš„é—®é¢˜"><a href="#8-ç”»åœˆåœˆçš„é—®é¢˜" class="headerlink" title="8.ç”»åœˆåœˆçš„é—®é¢˜"></a>8.ç”»åœˆåœˆçš„é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢è¯•é¢˜ï¼šå°æµ©å‡ºå»é¢è¯•æ—¶ï¼Œé¢è¯•å®˜æ‹¿å‡ºä¸€å¼ çº¸ï¼Œåœ¨çº¸ä¸Šä»å·¦åˆ°å³ç”»äº†ä¸€ç™¾ä¸ªå°åœ†åœˆï¼ˆæ‰‹é€Ÿå¿«ï¼Œæ²¡åŠæ³•ï¼‰æ¥ä¸‹æ¥ï¼Œé¢è¯•å®˜è¦æ±‚ä¸¤äººè½®æµæ¶‚æ‰å…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªç›¸é‚»çš„å°åœ†åœˆã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>è§„å®šï¼šè°æ¶‚æ‰æœ€åä¸€ä¸ªå°åœ†åœˆè°å°±èµ¢äº†ï¼ˆæ¢å¥è¯è¯´ï¼Œè°æ²¡æœ‰æ¶‚çš„äº†è°å°±è¾“äº†ï¼‰ã€‚é—®é¢˜æ˜¯ï¼šå°æµ©åº”è¯¥é€‰å–å…ˆæ¶‚è¿˜æ˜¯åæ¶‚ï¼Ÿå¦‚ä½•æ‰èƒ½æœ‰å¿…èƒœç­–ç•¥ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p> ä½œä¸ºèªæ˜æœºæ™ºçš„å°æµ©ï¼ˆæ²¡è§è¿‡è¿™ä¹ˆå¤¸è‡ªå·±çš„ï¼‰ï¼Œæœ€åå½“ç„¶æ˜¯å°æµ©è·èƒœã€‚è·èƒœçš„æ–¹æ³•ï¼š<strong>å°æµ©å¼ºçƒˆè¦æ±‚å…ˆæ‰‹è¿›è¡Œæ¸¸æˆï¼Œå¹¶ä¸”åœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼Œå…ˆæŠŠæ­£ä¸­é—´çš„ä¸¤ä¸ªå°åœ†åœˆæ¶‚é»‘ï¼Œäºæ˜¯å·¦å³ä¸¤è¾¹å„å‰©ä¸‹äº†49ä¸ªåœ†åœˆ</strong>ã€‚åƒæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p> <img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/46.png" alt><br> ç„¶åå°æµ©å¼€å§‹æ¨¡ä»¿ï¼ˆé€¼æ­»ï¼‰é¢è¯•å®˜ï¼Œé¢è¯•å®˜åœ¨å·¦è¾¹æ¶‚æ‰å“ªäº›åœ†åœˆï¼Œå°æµ©å°±å¯¹ç§°åœ°åœ¨å³è¾¹æ¶‚æ‰å“ªäº›åœ†åœˆï¼›é¢è¯•å®˜åœ¨å³è¾¹æ¶‚æ‰å“ªäº›åœ†åœˆï¼Œ å°æµ©å°±å¯¹ç§°åœ°åœ¨å·¦è¾¹æ¶‚æ‰å“ªäº›åœ†åœˆã€‚å› æ­¤ï¼Œåªè¦é¢è¯•å®˜æœ‰èµ°çš„ï¼Œå°æµ©å°±ä¸€å®šæœ‰èµ°çš„ï¼Œæœ€ç»ˆä¿è¯èƒ½è·èƒœã€‚</p>
<p> åœ¨åšå¼ˆè®ºä¸­ï¼Œè¿™ç±»æ¸¸æˆå°±å«åšâ€œ<strong>æ— ååšå¼ˆ</strong>â€ï¼ˆimpartial gameï¼‰ã€‚<strong>åœ¨æ— ååšå¼ˆä¸­ï¼Œå¦‚æœå¯¹äºæŸä¸ªæ£‹å±€çŠ¶æ€ï¼Œè°é‡åˆ°äº†å®ƒè°å°±æœ‰åŠæ³•å¿…èƒœï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå«åšâ€œå¿…èƒœæ€â€ï¼›å¦‚æœå¯¹äºæŸä¸ªæ£‹å±€çŠ¶æ€ï¼Œè°é‡åˆ°äº†å®ƒå¯¹æ‰‹å°±ä¼šæœ‰åŠæ³•å¿…èƒœï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå«åšâ€œå¿…è´¥æ€â€</strong>ã€‚</p>
</blockquote>
<h3 id="9-å·§å…‹åŠ›é—®é¢˜"><a href="#9-å·§å…‹åŠ›é—®é¢˜" class="headerlink" title="9.å·§å…‹åŠ›é—®é¢˜"></a>9.å·§å…‹åŠ›é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢è¯•é¢˜ï¼šå°æµ©å‡ºå»é¢è¯•æ—¶ï¼Œé¢è¯•å®˜æå‡ºä¸€å—10Ã—10ä¸ªå°å—çš„å·§å…‹åŠ›ã€‚é¦–å…ˆï¼Œé¢è¯•å®˜æŠŠå·§å…‹åŠ›æ°æˆä¸¤å¤§å—ï¼Œå¹¶ä¸”åƒæ‰å…¶ä¸­ä¸€å—ï¼ŒæŠŠå¦ä¸€å—äº¤ç»™å°æµ©ã€‚å°æµ©å†æŠŠå‰©ä¸‹çš„å·§å…‹åŠ›æ°æˆä¸¤å¤§å—ï¼Œåƒæ‰å…¶ä¸­ä¸€å—ï¼ŒæŠŠå¦ä¸€å—äº¤å›ç»™é¢è¯•å®˜ã€‚ä¸¤ä¸ªäººå°±è¿™æ ·æ— èŠä¸”æ¯ç‡¥çš„æ°å‘€æ°ã€‚ã€‚ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>è§„å®šï¼šè°æ²¡åŠæ³•å¾€ä¸‹ç»§ç»­æ°ï¼Œè°å°±è¾“äº†ã€‚å¦‚æœé¢è¯•å®˜å…ˆå¼€å§‹æ°çš„è¯ï¼Œé¢è¯•å®˜å’Œå°æµ©è°æœ‰å¿…èƒœç­–ç•¥ï¼Ÿï¼ˆé¢è¯•å®˜è¾“äº†ï¼Œå°æµ©å°†èµ¢å¾—é¢è¯•ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>ä½œä¸ºèªæ˜æœºæ™ºçš„å°æµ©ï¼ˆæ²¡è§è¿‡è¿™ä¹ˆå¤¸è‡ªå·±çš„ï¼‰ï¼Œæœ€åå½“ç„¶æ˜¯å°æµ©è·èƒœã€‚è·èƒœçš„æ–¹æ³•ï¼š<strong>åªè¦å°æµ©ä¸€ç›´ä¿æŒå·§å…‹åŠ›æ˜¯æ­£æ–¹å½¢å°±å¯ä»¥äº†</strong>ã€‚ä¸ç®¡é¢è¯•å®˜å’‹æ°ï¼Œæœ€åéƒ½ä¼šæ°æˆä¸€ä¸ªé•¿å®½ä¸ç›¸ç­‰çš„æ­£æ–¹å½¢ã€‚ç›´åˆ°æœ€åä¸€æ¬¡å°†å…¶å˜æˆä¸€ä¸ª1Ã—1çš„å·§å…‹åŠ›ï¼Œæ­¤æ—¶é¢è¯•å®˜å°±è¾“æ‰äº†é¢è¯•ã€‚å“¦ä¸ï¼Œæ˜¯å°æµ©èµ¢å¾—äº†é¢è¯•ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/47.png" alt></p>
</blockquote>
<p><strong>[è¶…çº§æ”¹ç¼–ç‰ˆ]</strong> å¦‚æœå·§å…‹åŠ›æ¢æˆè¾¹é•¿ä¸º10çš„ç­‰è¾¹ä¸‰è§’å½¢ï¼Œé•¿è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/48.png" alt></p>
<p>æ¯æ¬¡åªèƒ½<strong>æ²¿ç€çº¿æ¡æ°ä¸‹ä¸€ä¸ªå°ç­‰è¾¹ä¸‰è§’å½¢åƒæ‰</strong>ï¼Œå‡è‹¥è¿˜æ˜¯ç”±é¢è¯•å®˜å¼€å±€ï¼Œè¯·é—®ï¼Œè°å¿…èƒœï¼Ÿ</p>
<blockquote>
<p>ç­‰è¾¹ä¸‰è§’å½¢æ˜¯å°æµ©èµ¢ã€‚</p>
<p>1.é¢è¯•å®˜å…ˆæ‰‹æ²¿ç€ä»»æ„ä¸€æ¡çº¿æ°å¼€ã€‚<br>2.å‰©ä¸‹çš„ç­‰è…°æ¢¯å½¢ä¸­ï¼Œå°æµ©ä»é¢è¯•å®˜æ°å¼€å¤„å°†ç­‰è…°æ¢¯å½¢æ°æˆç­‰è¾¹ä¸‰è§’å½¢å’Œå¹³è¡Œå››è¾¹å½¢ï¼Œå°†å¹³è¡Œå››è¾¹å½¢è¿˜ç»™é¢è¯•å®˜ã€‚<br>3.é¢è¯•å®˜åœ¨å¹³è¡Œå››è¾¹å½¢çš„ä¸¤ä¸ªè§’ä¸­ä»»æ„æ°å‡ºä¸ªç­‰è¾¹ä¸‰è§’å½¢ã€‚<br>4.å°æµ©æ°å¦ä¸€ä¸ªè§’å¤§å°è·Ÿé¢è¯•å®˜ä¸€è‡´ï¼Œæ­¤æ—¶å‰©ä¸‹çš„å·§å…‹åŠ›æœ‰ä¸‰ç§å¯èƒ½çš„å½¢æ€ï¼š</p>
<ul>
<li>å¹³è¡Œå››è¾¹å½¢ç¼ºäº†ä¸¤ä¸ªå°è§’ï¼šæ­¤å½¢çŠ¶ç»™é¢è¯•å®˜ ä»–å·²ç»æ²¡æœ‰åŠæ³•æ°å‡ºä¸€ä¸ªç­‰è¾¹ä¸‰è§’å½¢ã€‚é¢è¯•å®˜è¾“äº†ã€‚</li>
<li>ä¾ç„¶æ˜¯å¹³è¡Œå››è¾¹å½¢ï¼šé™·å…¥æ­¤æ­¥å¾ªç¯ï¼Œç›´åˆ°æ°æ²¡äº†ï¼šæœ€åçš„å¹³è¡Œå››è¾¹å½¢å¯ä»¥ç”±ä¸¤ä¸ªç­‰è¾¹ä¸‰è§’å½¢ç»„åˆè€Œæˆï¼Œå°æµ©åæ°ï¼Œå°æµ©èµ¢äº†ã€‚</li>
</ul>
</blockquote>
<h3 id="10-å¤§é±¼å’Œå°é±¼çš„é—®é¢˜"><a href="#10-å¤§é±¼å’Œå°é±¼çš„é—®é¢˜" class="headerlink" title="10.å¤§é±¼å’Œå°é±¼çš„é—®é¢˜"></a>10.å¤§é±¼å’Œå°é±¼çš„é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å¤§é±¼å°é±¼çš„é—®é¢˜ï¼šå‡è®¾æœ‰10æ¡é±¼ï¼Œå®ƒä»¬ä»å°åˆ°å¤§ä¾æ¬¡ç¼–å·ä¸º1, 2, â€¦, 10ã€‚æˆ‘ä»¬è§„å®šï¼Œåƒé±¼å¿…é¡»è¦ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§é±¼åªèƒ½åƒæ¯”è‡ªå·±å°ä¸€çº§çš„é±¼ï¼Œä¸èƒ½è¶Šçº§åƒæ›´å°çš„é±¼ï¼›å¹¶ä¸”åªæœ‰ç­‰åˆ°ç¬¬kæ¡é±¼åƒäº†ç¬¬k-1æ¡é±¼åï¼Œç¬¬k+1æ¡é±¼æ‰èƒ½åƒç¬¬kæ¡é±¼ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŒæ—¶ï¼šç¬¬1æ¡é±¼åˆ™å•¥éƒ½ä¸èƒ½åƒï¼Œåªæœ‰è¢«åƒçš„ä»½å„¿ã€‚æˆ‘ä»¬å‡è®¾ï¼Œå¦‚æœæœ‰å°é±¼åƒçš„è¯ï¼Œå¤§é±¼è‚¯å®šä¸ä¼šæ”¾è¿‡ï¼›ä½†æ˜¯ï¼Œä¿å…¨æ€§å‘½çš„ä¼˜å…ˆçº§æ˜¾ç„¶æ›´é«˜ï¼Œåœ¨åƒå°é±¼ä¹‹å‰ï¼Œå¤§é±¼å¾—å…ˆä¿è¯è‡ªå·±ä¸ä¼šè¢«åƒæ‰æ‰è¡Œã€‚å‡è®¾æ¯æ¡é±¼éƒ½æ˜¯æ— é™èªæ˜çš„ï¼ˆå¹¶ä¸”å®ƒä»¬ä¹Ÿéƒ½çŸ¥é“è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿéƒ½çŸ¥é“å®ƒä»¬çŸ¥é“è¿™ä¸€ç‚¹â€¦â€¦ï¼‰ï¼Œé‚£ä¹ˆç¬¬1æ¡é±¼èƒ½å­˜æ´»ä¸‹æ¥å—ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>æˆ‘ä»¬æ˜¯æœ‰åæ¡é±¼ï¼Œåˆ†æèµ·æ¥æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¸¤æ¡é±¼å¼€å§‹åˆ†æï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/49.png" alt><br>ä¸¤æ¡é±¼çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒæ¡é±¼å°±æ˜¯æ— æ•Œçš„å­˜åœ¨ï¼Œä»–ä¸ç”¨æ‹…å¿ƒè‡ªå·±è¢«åƒæ‰ï¼å¦‚æœæ˜¯ä¸‰æ¡é±¼ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/50.png" alt><br>3æ¡é±¼çš„æƒ…å†µä¸‹ï¼Œç¬¬2æ¡é±¼ä¸èƒ½åƒç¬¬1æ¡é±¼ï¼Œå¦åˆ™å°†åŒ–ä¸ºåªæœ‰2æ¡é±¼çš„æƒ…å½¢ï¼Œå®ƒå°†ä¼šè¢«ç¬¬3æ¡é±¼åƒæ‰ã€‚å¦‚æœæ˜¯å››æ¡é±¼ï¼Œå°±æœ‰æ„æ€äº†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/51.png" alt><br>æ­¤æ—¶ç¬¬2æ¡é±¼å¯ä»¥å¤§èƒ†åœ°åƒæ‰ç¬¬1æ¡é±¼ï¼Œå› ä¸ºæ ¹æ®å‰é¢çš„ç»“è®ºï¼Œå®ƒçŸ¥é“ç¬¬3æ¡é±¼æ˜¯ä¸æ•¢åƒå®ƒçš„ã€‚é—®é¢˜æ¥äº†ï¼Œäº”æ¡é±¼ä¼šå¦‚ä½•ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/52.png" alt><br>5æ¡é±¼çš„æƒ…å†µä¸‹ï¼Œç¬¬2æ¡é±¼æ˜¯ä¸æ•¢åƒç¬¬1æ¡é±¼çš„ï¼Œå› ä¸ºå¦‚æœå®ƒåƒäº†ç¬¬ä¸€æ¡é±¼ã€‚é—®é¢˜è½¬åŒ–ä¸º4æ¡é±¼çš„åœºæ™¯ï¼ŒåŸ3å·é±¼å°±å¯ä»¥å¤§èƒ†åƒæ‰åŸ2å·é±¼ï¼Œå› ä¸ºå®ƒçŸ¥é“4å·é±¼æ˜¯ä¸æ•¢åƒå®ƒçš„ï¼Œå¦åˆ™5å·é±¼å°±ä¼šåƒæ‰4å·é±¼ï¼ˆç»•ä¸ç»•ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç»“è®ºï¼Œåªè¦é±¼æœ‰å¥‡æ•°ä¸ªï¼Œé‚£ä¹ˆç¬¬ä¸€æ¡é±¼å°†æ€»æ˜¯å¯ä»¥æ´»ä¸‹æ¥ã€‚å¦‚æœé±¼æ˜¯å¶æ•°ä¸ªï¼Œé‚£ä¹ˆç¬¬äºŒæ¡é±¼å°†æ€»æ˜¯å¯ä»¥åƒæ‰ç¬¬ä¸€æ¡é±¼ï¼Œå°†çŠ¶æ€è½¬åŒ–åˆ°å¥‡æ•°æ¡é±¼çš„åœºæ™¯ã€‚</p>
<p>æ‰€ä»¥è¯¥é¢˜çš„ç­”æ¡ˆæ˜¯ï¼šä¸èƒ½ï¼Œåœ¨åæ¡é±¼çš„åœºæ™¯ä¸‹ï¼Œç¬¬ä¸€æ¡é±¼å¿…æ­»æ— ç–‘ã€‚</p>
</blockquote>
<h2 id="æ’åºç³»åˆ—"><a href="#æ’åºç³»åˆ—" class="headerlink" title="æ’åºç³»åˆ—"></a>æ’åºç³»åˆ—</h2><h3 id="1-æŒ‰å¥‡å¶æ’åºæ•°ç»„"><a href="#1-æŒ‰å¥‡å¶æ’åºæ•°ç»„" class="headerlink" title="1.æŒ‰å¥‡å¶æ’åºæ•°ç»„"></a>1.æŒ‰å¥‡å¶æ’åºæ•°ç»„</h3><blockquote>
<p>æ’å…¥æ’åºï¼šå°±æ˜¯ç‚¸é‡‘èŠ±çš„æ—¶å€™ï¼Œä½ æ¥ä¸€ä¸ªåŒèŠ±é¡ºçš„è¿‡ç¨‹ã€‚ï¼ˆæ ‡å‡†å®šä¹‰ï¼šåœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œå‡å®šå‰n-1ä¸ªæ•°å·²ç»æ’å¥½åºï¼Œç°åœ¨å°†ç¬¬nä¸ªæ•°æ’åˆ°å‰é¢çš„æœ‰åºæ•°åˆ—ä¸­ï¼Œä½¿å¾—è¿™nä¸ªæ•°ä¹Ÿæ˜¯æ’å¥½é¡ºåºçš„ï¼‰</p>
</blockquote>
<p><strong>[ç¬¬905é¢˜]</strong> ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„Aï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨è¯¥æ•°ç»„ä¸­ï¼Œ Açš„æ‰€æœ‰å¶æ•°å…ƒç´ ä¹‹åè·Ÿç€æ‰€æœ‰å¥‡æ•°å…ƒç´ ã€‚ä½ å¯ä»¥è¿”å›æ»¡è¶³æ­¤æ¡ä»¶çš„ä»»ä½•æ•°ç»„ä½œä¸ºç­”æ¡ˆã€‚ </p>
<ul>
<li>ç¤ºä¾‹ï¼š<br>è¾“å…¥ï¼š[3,1,2,4]<br>è¾“å‡ºï¼š[2,4,3,1]<br>è¾“å‡º [4,2,3,1]ï¼Œ[2,4,1,3] å’Œ [4,2,1,3] ä¹Ÿä¼šè¢«æ¥å—ã€‚</li>
</ul>
<blockquote>
<p>è¿™é“é¢˜ï¼ŒæŒ‰ç…§æ’å…¥æ’åºçš„æ€æƒ³ï¼Œå¾ˆå®¹æ˜“å¯ä»¥æƒ³åˆ°é¢˜è§£ã€‚æˆ‘ä»¬åªéœ€è¦éå†æ•°ç»„ï¼Œå½“æˆ‘ä»¬é‡åˆ°å¶æ•°æ—¶ï¼Œå°†å…¶æ’å…¥åˆ°æ•°ç»„å‰æœ€è¿‘çš„ä¸€ä¸ªä¸ºå¥‡æ•°çš„ä½ç½®ï¼Œ<strong>ä¸è¯¥ä½ç½®çš„å¥‡æ•°å…ƒç´ äº¤æ¢</strong>ã€‚ä¸ºäº†è¾¾æˆè¯¥ç›®çš„ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæŒ‡é’ˆ jï¼Œæ¥ç»´æŒè¿™æ ·ä¸€ä¸ªå¥‡æ•°çš„ä½ç½®ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬çš„æ•°ç»„ä¸ºï¼š[3,1,2,4]</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/28.jpg" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortArrayByParity</span>(<span class="params">self, A: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">            <span class="keyword">if</span> A[i] % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                A[j], A[i] = A[i], A[j]</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> A</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:100 ms,å‡»è´¥äº†61.73% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.9 MB,å‡»è´¥äº†50.05% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] sortArrayByParity(<span class="keyword">int</span>[] A) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; A.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(A[i] % <span class="number">2</span> == <span class="number">0</span>) swap(A, i, j++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] A, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = A[i];</span><br><span class="line">        A[i] = A[j];</span><br><span class="line">        A[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.02% çš„ç”¨æˆ·</p>
<h2 id="ä½è¿ç®—ç³»åˆ—"><a href="#ä½è¿ç®—ç³»åˆ—" class="headerlink" title="ä½è¿ç®—ç³»åˆ—"></a>ä½è¿ç®—ç³»åˆ—</h2><h3 id="1-ä½¿ç”¨ä½è¿ç®—æ±‚å’Œ"><a href="#1-ä½¿ç”¨ä½è¿ç®—æ±‚å’Œ" class="headerlink" title="1.ä½¿ç”¨ä½è¿ç®—æ±‚å’Œ"></a>1.ä½¿ç”¨ä½è¿ç®—æ±‚å’Œ</h3><blockquote>
<p>è¯¥é¢˜å¾ˆå®¹æ˜“å‡ºç°åœ¨å„å¤§å‚çš„é¢è¯•ä¸­ï¼Œå±äºå¿…é¡»æŒæ¡çš„é¢˜å‹ã€‚</p>
</blockquote>
<p><strong>[å‰‘æŒ‡offer 64]</strong> æ±‚ 1 2 â€¦ n ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€caseç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚</p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥: n = 3 è¾“å‡º: 6</li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥: n = 9 è¾“å‡º: 45</li>
<li>é™åˆ¶ï¼š<br>1 &lt;= n &lt;= 10000</li>
</ul>
<blockquote>
<p>é¢˜ç›®ä¸Šæ‰‹ï¼Œå› ä¸ºä¸èƒ½ä½¿ç”¨å…¬å¼ç›´æ¥è®¡ç®—ï¼ˆå…¬å¼ä¸­åŒ…å«ä¹˜é™¤æ³•ï¼‰ï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨é€’å½’è¿›è¡Œæ±‚è§£ï¼Œä½†æ˜¯é€’å½’ä¸­ä¸€èˆ¬åˆéœ€è¦ä½¿ç”¨ifæ¥æŒ‡å®šè¿”å›æ¡ä»¶ï¼ˆè¿™é‡Œä¸å…è®¸ä½¿ç”¨ifï¼‰ï¼Œæ‰€ä»¥æ²¡åŠæ³•ä½¿ç”¨æ™®é€šçš„é€’å½’æ€è·¯ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬äº†è§£ä¸€ä¸‹ &amp;&amp; çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æœ‰ A&amp;&amp;B<br>å¦‚æœAä¸ºtrueï¼Œè¿”å›Bçš„å¸ƒå°”å€¼ï¼ˆç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼‰<br>å¦‚æœAä¸ºfalseï¼Œç›´æ¥è¿”å›falseï¼ˆç›¸å½“äºçŸ­è·¯ï¼‰</p>
<p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†é€’å½’çš„è¿”å›æ¡ä»¶å–éç„¶åä½œä¸º &amp;&amp; çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œé€’å½’ä¸»ä½“è½¬æ¢ä¸ºç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">sumNums</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">		<span class="keyword">return</span> n <span class="keyword">and</span> (n + self.sumNums(n-<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š48 ms, åœ¨æ‰€æœ‰ Python æäº¤ä¸­å‡»è´¥äº†10.79% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š20.1 MB, åœ¨æ‰€æœ‰ Python æäº¤ä¸­å‡»è´¥äº†37.95% çš„ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumNums</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = n &gt; <span class="number">0</span> &amp;&amp; (n += sumNums(n - <span class="number">1</span>)) &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†58.91% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†28.19% çš„ç”¨æˆ·</p>
<h3 id="2-2çš„å¹‚"><a href="#2-2çš„å¹‚" class="headerlink" title="2.2çš„å¹‚"></a>2.2çš„å¹‚</h3><p><strong>[ç¬¬231é¢˜]</strong> ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚</p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: 1<br>è¾“å‡º: true<br>è§£é‡Š: $2^0 $= 1</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: 16<br>è¾“å‡º: true<br>è§£é‡Š: $2^4$ = 16</li>
<li>ç¤ºä¾‹ 3:<br>è¾“å…¥: 218<br>è¾“å‡º: false</li>
</ul>
<blockquote>
<p>å…ˆè§‚å¯Ÿä¸€äº›æ˜¯2çš„å¹‚çš„äºŒè¿›åˆ¶æ•°ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/29.jpg" alt><br>ç„¶åæˆ‘ä»¬å†è§‚å¯Ÿä¸‹é¢è¿™æ ·çš„ä¸€ç»„æ•°ï¼Œå¯¹åº”ç€ä¸Šé¢çš„æ•°å‡å»1ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/30.jpg" alt><br>æˆ‘ä»¬å¯¹ä¸¤ç»„æ•°æ±‚â€œ&amp;â€è¿ç®—ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/31.jpg" alt><br>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºNä¸º2çš„å¹‚çš„æ•°ï¼Œéƒ½æœ‰ N&amp;(N-1)=0 ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ¤æ–­æ¡ä»¶ã€‚ï¼ˆè¿™ä¸ªæŠ€å·§å¯ä»¥è®°å¿†ä¸‹æ¥ï¼Œåœ¨ä¸€äº›åˆ«çš„ä½è¿ç®—çš„é¢˜ç›®ä¸­ä¹Ÿæ˜¯ä¼šç”¨åˆ°çš„ï¼‰</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPowerOfTwo</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">return</span> n &gt; <span class="number">0</span> <span class="keyword">and</span> n &amp; (n-<span class="number">1</span>) == <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52ms,å‡»è´¥äº†17.68% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†77.73% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//a % b è‹¥bä¸º2çš„æ•´æ•°æ¬¡å¹‚ï¼Œåˆ™è¯¥å¼ç­‰ä»·äºaä¸b-1çš„ä½ä¸</span></span><br><span class="line">        <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; ((n &amp; (n-<span class="number">1</span>)) == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†28.30% çš„ç”¨æˆ·</p>
<h3 id="3-è¿”å›ä¸€ä¸ªæ•°äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a href="#3-è¿”å›ä¸€ä¸ªæ•°äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°" class="headerlink" title="3.è¿”å›ä¸€ä¸ªæ•°äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"></a>3.è¿”å›ä¸€ä¸ªæ•°äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</h3><p><strong>[ç¬¬191é¢˜]</strong> ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ±‰æ˜é‡é‡ï¼‰ã€‚ </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼š00000000000000000000000000001011<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º â€˜1â€™ã€‚</li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼š00000000000000000000000010000000<br>è¾“å‡ºï¼š1<br>è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º â€˜1â€™ã€‚</li>
<li>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼š11111111111111111111111111111101<br>è¾“å‡ºï¼š31<br>è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰31ä½ä¸º â€˜1â€™ã€‚ </li>
</ul>
<p>æç¤ºï¼š<br>è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚<br>åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹3ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°-3ã€‚ </p>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<blockquote>
<p>è¿™é“é¢˜ä»ç„¶æ˜¯é€šè¿‡ä½è¿ç®—æ¥è¿›è¡Œæ±‚è§£çš„éå¸¸å…¸å‹çš„é¢˜ç›®ã€‚æ©ç æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸²äºŒè¿›åˆ¶ä»£ç å¯¹ç›®æ ‡å­—æ®µè¿›è¡Œä½ä¸è¿ç®—ï¼Œå±è”½å½“å‰çš„è¾“å…¥ä½ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æŠŠç›®æ ‡æ•°è½¬åŒ–æˆäºŒè¿›åˆ¶æ•°ï¼Œç„¶åéå†æ¯ä¸€ä½çœ‹çœ‹æ˜¯ä¸æ˜¯1ï¼Œå¦‚æœæ˜¯1å°±è®°å½•ä¸‹æ¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªæ©ç æ¥è¿›è¡Œï¼Œå…¶å®å°±æ˜¯å¼„ä¸ª1å‡ºæ¥ï¼Œ1çš„äºŒè¿›åˆ¶æ˜¯è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/32.jpg" alt><br>æˆ‘ä»¬åªéœ€è¦è®©è¿™ä¸ªæ©ç æ¯æ¬¡å‘å·¦ç§»åŠ¨ä¸€ä½ï¼Œç„¶åä¸ç›®æ ‡å€¼æ±‚â€œ&amp;â€ï¼Œå°±å¯ä»¥åˆ¤æ–­ç›®æ ‡å€¼çš„å½“å‰ä½æ˜¯ä¸æ˜¯1ã€‚æ¯”å¦‚ç›®æ ‡å€¼ä¸º21ï¼Œ21çš„äºŒè¿›åˆ¶æ˜¯è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/33.jpg" alt><br>ç„¶åæ¯æ¬¡ç§»åŠ¨æ©ç ï¼Œæ¥å’Œå½“å‰ä½è¿›è¡Œè®¡ç®—ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/34.jpg" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hammingWeight</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        mask = <span class="number">1</span></span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            <span class="keyword">if</span> (n &amp; mask) != <span class="number">0</span>:</span><br><span class="line">                result += <span class="number">1</span></span><br><span class="line">            mask &lt;&lt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†75.02% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†26.44% çš„Python3ç”¨æˆ·</p>
<p>æ³¨æ„ï¼šè¿™é‡Œåˆ¤æ–­ n&amp;mask çš„æ—¶å€™ï¼Œåƒä¸‡ä¸è¦é”™å†™æˆ (n&amp;mask) == 1ï¼Œå› ä¸ºè¿™é‡Œä½ å¯¹æ¯”çš„æ˜¯åè¿›åˆ¶æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">// you need to treat n as an unsigned value</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hammingWeight</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">            count += n &amp; <span class="number">1</span>;    </span><br><span class="line">            n &gt;&gt;&gt;= <span class="number">1</span>; <span class="comment">//æ— ç¬¦å·å³ç§»</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.02% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒ</strong></p>
<blockquote>
<p>ä½è¿ç®—å°æŠ€å·§: å¯¹äºä»»æ„ä¸€ä¸ªæ•°ï¼Œå°† n å’Œ n-1 è¿›è¡Œ &amp; è¿ç®—ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠ n ä¸­æœ€ä½ä½çš„ 1 å˜æˆ 0</p>
<p>æˆ‘ä»¬æ‹¿ 11 ä¸¾ä¸ªä¾‹å­ï¼šï¼ˆæ³¨æ„æœ€åä¸€ä½1å˜æˆ0çš„è¿‡ç¨‹ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/35.jpg" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hammingWeight</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> n != <span class="number">0</span>:</span><br><span class="line">            n = n &amp; (n-<span class="number">1</span>)</span><br><span class="line">            result += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†75.02% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†5.40% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">// you need to treat n as an unsigned value</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hammingWeight</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(n != <span class="number">0</span>) &#123;</span><br><span class="line">            n &amp;= (n-<span class="number">1</span>);    </span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†95.92% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.71% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼šåˆ©ç”¨Pythonå†…ç½®æ–¹æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hammingWeight</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bin</span>(n).count(<span class="string">&#x27;1&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†75.02% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†5.40% çš„Python3ç”¨æˆ·</p>
<h3 id="4-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"><a href="#4-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—" class="headerlink" title="4.åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"></a>4.åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</h3><p><strong>[ç¬¬136é¢˜]</strong> ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚<br>è¯´æ˜ï¼š<br>ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: [2,2,1]<br>è¾“å‡º: 1</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: [4,1,2,1,2]<br>è¾“å‡º: 4 </li>
</ul>
<blockquote>
<p>å¯¹äºä»»æ„ä¸¤ä¸ªæ•°aå’Œbï¼Œæˆ‘ä»¬å¯¹å…¶ä½¿ç”¨ â€œå¼‚æˆ–â€æ“ä½œï¼Œåº”è¯¥æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p>
<p>ä»»æ„ä¸€ä¸ªæ•°å’Œ0å¼‚æˆ–ä»ç„¶ä¸ºè‡ªå·±ï¼šaâŠ•0 = a</p>
<p>ä»»æ„ä¸€ä¸ªæ•°å’Œè‡ªå·±å¼‚æˆ–æ˜¯0ï¼šaâŠ•a=0</p>
<p>å¼‚æˆ–æ“ä½œæ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼šaâŠ•bâŠ•a=(aâŠ•a)âŠ•b=0âŠ•b=b</p>
<p><strong>å› ä¸ºå…¶ä½™å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥æ ¹æ®å¼‚æˆ–æ“ä½œçš„äº¤æ¢å¾‹å’Œç»“åˆå¾‹å¯¹æ•°ç»„è¿›è¡Œè¿­ä»£ï¼Œæœ€ç»ˆç•™ä¸‹çš„å°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            res ^= nums[i]</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†46.94% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.1 MB,å‡»è´¥äº†34.55% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums) res ^= num;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†99.75% çš„ç”¨æˆ·</p>
<h3 id="5-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—â…¡"><a href="#5-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—â…¡" class="headerlink" title="5.åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—â…¡"></a>5.åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—â…¡</h3><p><strong>[ç¬¬137é¢˜]</strong> ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°äº†ä¸‰æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚è¯´æ˜ï¼šä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ </p>
<ul>
<li>ç¤ºä¾‹ 1:<br>è¾“å…¥: [2,2,3,2]<br>è¾“å‡º: 3</li>
<li>ç¤ºä¾‹ 2:<br>è¾“å…¥: [0,1,0,1,0,1,99]<br>è¾“å‡º: 99 </li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šHashMapæ±‚è§£</strong></p>
<blockquote>
<p>å¾ˆç®€å•å°±èƒ½æƒ³åˆ°ï¼Œè¯´ç™½äº†å°±æ˜¯<strong>ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œæœ€ç»ˆå†è¿”å›æ¬¡æ•°ä¸º1çš„å…ƒç´ </strong>ã€‚ä½†æ˜¯ä½¿ç”¨äº†é¢å¤–ç©ºé—´ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="built_in">map</span> = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> <span class="built_in">map</span>:</span><br><span class="line">                <span class="built_in">map</span>[i] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">map</span>[i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">map</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">map</span>[i] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†89.49% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†19.68% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums) map.put(num, map.getOrDefault(num, <span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> key: map.keySet())&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.get(key) == <span class="number">1</span>) <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š7 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†9.09% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†55.72% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šæ•°å­¦æ–¹å¼</strong></p>
<blockquote>
<p>åŸç†ï¼š[A,A,A,B,B,B,C,C,C] å’Œ [A,A,A,B,B,B,C]ï¼Œå·®äº†ä¸¤ä¸ªCã€‚å³ï¼š3Ã—(<em>a</em> <em>b</em> <em>c</em>)âˆ’(<em>a</em> <em>a</em> <em>a</em> <em>b</em> <em>b</em> <em>b</em> <em>c</em>)=2<em>c</em></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŠŠ<strong>åŸæ•°ç»„å»é‡ã€å†ä¹˜ä»¥3å¾—åˆ°çš„å€¼ï¼Œåˆšå¥½å°±æ˜¯è¦æ‰¾çš„å…ƒç´ çš„2å€</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>((<span class="built_in">sum</span>(<span class="built_in">set</span>(nums)) * <span class="number">3</span> - <span class="built_in">sum</span>(nums)) / <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†96.69% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†26.89% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        Set&lt;Integer&gt; key = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">long</span> sum1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums) &#123;</span><br><span class="line">            key.add(num);</span><br><span class="line">            sum1 += num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> sum2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: key) sum2 += num;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)((<span class="number">3</span> * sum2 - sum1) / <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†37.02% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†85.08% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼šä½è¿ç®—</strong></p>
<blockquote>
<p>å¯¹äºâ€œæ¯ä¸ªå…¶ä½™å…ƒç´ ï¼Œå‡å‡ºç°äº†äºŒæ¬¡â€ä¹‹æ‰€ä»¥å¯ä»¥ä½¿ç”¨â€œ<strong>å¼‚æˆ–</strong>â€è¿›è¡Œæ±‚è§£ï¼ŒåŸå› æ˜¯å› ä¸ºâ€œå¼‚æˆ–â€æ“ä½œå¯ä»¥è®©ä¸¤æ•°ç›¸åŒå½’0ã€‚é‚£å¯¹äºå…¶ä½™å…ƒç´ å‡ºç°ä¸‰æ¬¡çš„ï¼Œæ˜¯ä¸æ˜¯åªè¦å¯ä»¥è®©å…¶ä¸‰è€…ç›¸åŒå½’0ï¼Œå°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„å‘¢ï¼Ÿ</p>
<p>å› ä¸ºå„è¯­è¨€ä¸­éƒ½æ²¡æœ‰è¿™æ ·ä¸€ä¸ªç°æˆçš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªã€‚ï¼ˆæƒ³è±¡ä¸€ä¸‹ï¼Œä½è¿ç®—ä¹Ÿæ˜¯é€ å‡ºæ¥çš„å¯¹ä¸å¯¹ï¼Ÿï¼‰</p>
<p><strong>å¼‚æˆ–è¿ç®—æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸ºï¼Œå…¶å®å°±æ˜¯äºŒè¿›åˆ¶çš„åŠ æ³•ï¼Œç„¶åç æ‰è¿›ä½å‘¢ï¼Ÿç æ‰è¿›ä½çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸æ˜¯åˆå¯ä»¥ç†è§£ä¸ºå¯¹ 2 è¿›è¡Œå–æ¨¡</strong>ï¼Œä¹Ÿå°±æ˜¯å–ä½™ã€‚åˆ°äº†è¿™é‡Œï¼Œé—®é¢˜å·²ç»éå¸¸éå¸¸æ˜ç¡®äº†ã€‚é‚£æˆ‘ä»¬è¦å®Œæˆä¸€ä¸ª a ? a ? a = 0 çš„è¿ç®—ï¼Œæ˜¯ä¸æ˜¯å…¶å®å°±æ˜¯è®©å…¶äºŒè¿›åˆ¶çš„æ¯ä¸€ä½æ•°éƒ½ç›¸åŠ ï¼Œæœ€åå†å¯¹3è¿›è¡Œä¸€ä¸ªå–æ¨¡çš„è¿‡ç¨‹å‘¢ï¼Ÿï¼ˆä¸€æ ·ï¼Œå¦‚æœè¦å®šä¹‰ä¸€ä¸ª a ? a ? a ? a = 0 çš„è¿ç®—ï¼Œé‚£å°±æœ€åå¯¹4è¿›è¡Œå–æ¨¡å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># pythonä¸­intä¸ºå˜é•¿çš„ï¼Œæ‰€ä»¥å®šä¹‰32ä½çš„åˆ—è¡¨</span></span><br><span class="line">        count = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            <span class="comment"># æ¯ä¸€ä½éƒ½å¯¹å¯¹åº”ä½ä¸Šçš„æ‰€æœ‰æ•°åšå’Œ</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> nums:</span><br><span class="line">                <span class="comment"># åˆ¤æ–­è¯¥æ•°æ˜¯å¦ä¸ºè´Ÿæ•°</span></span><br><span class="line">                <span class="keyword">if</span> j &lt; <span class="number">0</span>:</span><br><span class="line">                    j = j &amp; <span class="number">0xffffffff</span></span><br><span class="line">                <span class="comment"># è®°å½•è¯¥ä½1çš„ä¸ªæ•°</span></span><br><span class="line">                <span class="keyword">if</span> (j &gt;&gt; i) &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">                    count[i] += <span class="number">1</span></span><br><span class="line">            <span class="comment"># æœ€ç»ˆå°†æŠµæ¶ˆåå‰©ä½™çš„1æ”¾åˆ°å¯¹åº”çš„ä½æ•°ä¸Š</span></span><br><span class="line">            <span class="keyword">if</span> count[i] % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">                res |= <span class="number">1</span> &lt;&lt; i</span><br><span class="line">        <span class="comment"># åˆ¤æ–­ç»“æœæ­£è´Ÿ</span></span><br><span class="line">        <span class="keyword">return</span> res <span class="keyword">if</span> res &lt;= <span class="number">0x7FFFFFFF</span> <span class="keyword">else</span> ~(res ^ <span class="number">0xFFFFFFFF</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:124 ms,å‡»è´¥äº†13.36% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†28.80% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">32</span>];</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> num: nums)&#123;</span><br><span class="line">                <span class="keyword">if</span>(((num &gt;&gt;&gt; i) &amp; <span class="number">1</span>) == <span class="number">1</span>) count[i] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count[i] % <span class="number">3</span> == <span class="number">1</span>) res += (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†37.02% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†9.53% çš„ç”¨æˆ·</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<strong>æˆ‘ä»¬è®°å½•æ¯ä¸€ä½æ•°å‡ºç°çš„æ¬¡æ•°</strong>ã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬è®°å½•äº†32ä½ã€‚é‚£å¦‚æœæˆ‘ä»¬å¯ä»¥åŒæ—¶å¯¹æ‰€æœ‰ä½è¿›è¡Œè®¡æ•°ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ç®€åŒ–è¿‡ç¨‹ã€‚å› ä¸ºæˆ‘ä»¬çš„ç›®çš„æ˜¯æŠŠæ¯ä¸€ä½ä¸3å–æ¨¡è¿›è¡Œè¿ç®—ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ç†è§£ä¸ºå…¶å®æ˜¯ä¸€ä¸ª<strong>ä¸‰è¿›åˆ¶</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬å°±åªæœ‰3ä¸ªçŠ¶æ€ï¼Œ00 - 01 - 10ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ a å’Œ b æ¥è®°å½•çŠ¶æ€ã€‚å…¶ä¸­çš„çŠ¶æ€è½¬ç§»è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/36.jpg" alt></p>
<p>è¿™é‡Œ aâ€˜ å’Œ bâ€™ çš„æ„æ€ä»£è¡¨ç€ a å’Œ b ä¸‹ä¸€æ¬¡çš„çŠ¶æ€ã€‚next ä»£è¡¨ç€ä¸‹ä¸€ä¸ª bit ä½å¯¹åº”çš„å€¼ã€‚</p>
<p>å†™å‡ºå…³ç³»å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">b = (b ^ next) &amp; ~a;</span><br><span class="line">a = (a ^ next) &amp; ~b; #æ³¨æ„è¿™é‡Œçš„bå·²ç»å˜äº†ï¼Œæ˜¯ä¸Šå¼æ±‚å¾—çš„b</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        a, b = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">next</span> <span class="keyword">in</span> nums:</span><br><span class="line">            b = (b ^ <span class="built_in">next</span>) &amp; ~a</span><br><span class="line">            a = (a ^ <span class="built_in">next</span>) &amp; ~b</span><br><span class="line">        <span class="keyword">return</span> b</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†96.69% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.6 MB,å‡»è´¥äº†38.94% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> next: nums)&#123;</span><br><span class="line">            b = (b ^ next) &amp; ~a;</span><br><span class="line">            a = (a ^ next) &amp; ~b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†58.04% çš„ç”¨æˆ·</p>
<h3 id="6-ç¼ºå¤±æ•°å­—"><a href="#6-ç¼ºå¤±æ•°å­—" class="headerlink" title="6.ç¼ºå¤±æ•°å­—"></a>6.ç¼ºå¤±æ•°å­—</h3><p><strong>[ç¬¬268é¢˜]</strong> ç»™å®šä¸€ä¸ªåŒ…å«[0, n]ä¸­nä¸ªæ•°çš„æ•°ç»„nums ï¼Œæ‰¾å‡º[0, n]è¿™ä¸ªèŒƒå›´å†…æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„é‚£ä¸ªæ•°ã€‚è¿›é˜¶ï¼š ä½ èƒ½å¦å®ç°çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€ä»…ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜? </p>
<ul>
<li>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums = [3,0,1]<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼šn = 3ï¼Œå› ä¸ºæœ‰3ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´[0,3]å†…ã€‚2æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨numsä¸­ã€‚ </li>
<li>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums = [0,1]<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼šn = 2ï¼Œå› ä¸ºæœ‰2ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´[0,2]å†…ã€‚2æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨numsä¸­ã€‚ </li>
<li>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šnums = [9,6,4,2,3,5,7,0,1]<br>è¾“å‡ºï¼š8<br>è§£é‡Šï¼šn = 9ï¼Œå› ä¸ºæœ‰9ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´[0,9]å†…ã€‚8æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨numsä¸­ã€‚ </li>
<li>ç¤ºä¾‹ 4ï¼š<br>è¾“å…¥ï¼šnums = [0]<br>è¾“å‡ºï¼š1<br>è§£é‡Šï¼šn = 1ï¼Œå› ä¸ºæœ‰1ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´[0,1]å†…ã€‚1æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨numsä¸­ã€‚</li>
</ul>
<p><strong>æ–¹æ³•ä¸€ï¼šæ•°å­¦æ–¹å¼</strong></p>
<blockquote>
<p>é¦–å…ˆæ±‚å‡ºæ•°ç»„çš„å’Œï¼Œç„¶åå†æ±‚å‡ºå‰n+1é¡¹ä¹‹å’Œï¼ˆä»0åˆ°nï¼‰ï¼Œæœ€ç»ˆæ±‚å·®å€¼ï¼Œå³ä¸ºç¼ºå¤±çš„å€¼ï¼</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">missingNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(nums) + <span class="number">1</span>)) - <span class="built_in">sum</span>(nums)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†98.84% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.3 MB,å‡»è´¥äº†81.49% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum1 = <span class="number">0</span>, sum2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt;= nums.length; i++) sum1 += i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums) sum2 += num;</span><br><span class="line">        <span class="keyword">return</span> sum1 - sum2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†75.78% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šä½è¿ç®—</strong></p>
<blockquote>
<p>åˆ©ç”¨â€œ<strong>ä¸¤ä¸ªç›¸åŒçš„æ•°ï¼Œä½¿ç”¨å¼‚æˆ–å¯ä»¥ç›¸æ¶ˆé™¤</strong>â€çš„åŸç†</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">missingNumber</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            result ^= nums[i] ^ i</span><br><span class="line">        <span class="keyword">return</span> result ^ <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:60 ms,å‡»è´¥äº†40.05% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.6 MB,å‡»è´¥äº†17.63% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) res ^= nums[i] ^ i;</span><br><span class="line">        <span class="keyword">return</span> res ^= nums.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†91.43% çš„ç”¨æˆ·</p>
<h2 id="äºŒåˆ†æ³•ç³»åˆ—"><a href="#äºŒåˆ†æ³•ç³»åˆ—" class="headerlink" title="äºŒåˆ†æ³•ç³»åˆ—"></a>äºŒåˆ†æ³•ç³»åˆ—</h2><h3 id="1-é˜¿ç‚å–œæ¬¢åƒé¦™è•‰"><a href="#1-é˜¿ç‚å–œæ¬¢åƒé¦™è•‰" class="headerlink" title="1.é˜¿ç‚å–œæ¬¢åƒé¦™è•‰"></a>1.é˜¿ç‚å–œæ¬¢åƒé¦™è•‰</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬875é¢˜ï¼šé˜¿ç‚å–œæ¬¢åƒé¦™è•‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¿™é‡Œæ€»å…±æœ‰ N å †é¦™è•‰ï¼Œç¬¬ i å †ä¸­æœ‰piles[i] æ ¹é¦™è•‰ã€‚è­¦å«å·²ç»ç¦»å¼€äº†ï¼Œå°†åœ¨ H å°æ—¶åå›æ¥ã€‚ é˜¿ç‚å¯ä»¥å†³å®šå¥¹åƒé¦™è•‰çš„é€Ÿåº¦ K ï¼ˆå•ä½ï¼šæ ¹/å°æ—¶ï¼‰ï¼Œæ¯ä¸ªå°æ—¶ï¼Œå¥¹å°†ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œä»ä¸­åƒæ‰ K æ ¹ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å¦‚æœè¿™å †é¦™è•‰å°‘äº K æ ¹ï¼Œå¥¹å°†åƒæ‰è¿™å †çš„æ‰€æœ‰é¦™è•‰ï¼Œç„¶åè¿™ä¸€å°æ—¶å†…ä¸ä¼šå†åƒæ›´å¤šçš„é¦™è•‰ã€‚</p>
<p>ç‚ç‚å–œæ¬¢æ…¢æ…¢åƒï¼Œä½†ä»ç„¶æƒ³åœ¨è­¦å«å›æ¥å‰åƒæ‰æ‰€æœ‰çš„é¦™è•‰ã€‚è¿”å›å¥¹å¯ä»¥åœ¨ H å°æ—¶å†…åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ Kï¼ˆK ä¸ºæ•´æ•°ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: piles = [3,6,7,11], H = 8</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: piles = [30,11,23,4,20], H = 5</span><br><span class="line">è¾“å‡º: 30</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: piles = [30,11,23,4,20], H = 6</span><br><span class="line">è¾“å‡º: 23</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 &lt;= piles.length &lt;= 10^4</span><br><span class="line">piles.length &lt;= H &lt;= 10^9</span><br><span class="line">1 &lt;= piles[i] &lt;= 10^9</span><br></pre></td></tr></table></figure>
<blockquote>
<p>äºŒåˆ†æŸ¥æ‰¾æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€åŸºæœ¬ã€æœ€æœ‰ç”¨çš„ç®—æ³•ä¹‹ä¸€ã€‚å®ƒæè¿°äº†<strong>åœ¨æœ‰åºé›†åˆä¸­æœç´¢ç‰¹å®šå€¼çš„è¿‡ç¨‹</strong>ã€‚ä¸€èˆ¬äºŒåˆ†æŸ¥æ‰¾ç”±ä»¥ä¸‹å‡ ä¸ªæœ¯è¯­æ„æˆï¼š</p>
<ul>
<li>ç›®æ ‡ Target â€”â€” ä½ è¦æŸ¥æ‰¾çš„å€¼</li>
<li>ç´¢å¼• Index â€”â€” ä½ è¦æŸ¥æ‰¾çš„å½“å‰ä½ç½®</li>
<li>å·¦ã€å³æŒ‡ç¤ºç¬¦ Leftï¼ŒRight â€”â€” æˆ‘ä»¬ç”¨æ¥ç»´æŒæŸ¥æ‰¾ç©ºé—´çš„æŒ‡æ ‡</li>
<li>ä¸­é—´æŒ‡ç¤ºç¬¦ Mid â€”â€” æˆ‘ä»¬ç”¨æ¥åº”ç”¨æ¡ä»¶æ¥ç¡®å®šæˆ‘ä»¬åº”è¯¥å‘å·¦æŸ¥æ‰¾è¿˜æ˜¯å‘å³æŸ¥æ‰¾çš„ç´¢å¼•</li>
</ul>
<p>åœ¨æœ€ç®€å•çš„å½¢å¼ä¸­ï¼ŒäºŒåˆ†æŸ¥æ‰¾å¯¹å…·æœ‰æŒ‡å®šå·¦ç´¢å¼•å’Œå³ç´¢å¼•çš„<strong>è¿ç»­åºåˆ—</strong>è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸º<strong>æŸ¥æ‰¾ç©ºé—´</strong>ã€‚äºŒåˆ†æŸ¥æ‰¾ç»´æŠ¤æŸ¥æ‰¾ç©ºé—´çš„å·¦ã€å³å’Œä¸­é—´æŒ‡ç¤ºç¬¦ï¼Œå¹¶æ¯”è¾ƒæŸ¥æ‰¾ç›®æ ‡ï¼›å¦‚æœæ¡ä»¶ä¸æ»¡è¶³æˆ–å€¼ä¸ç›¸ç­‰ï¼Œåˆ™æ¸…é™¤ç›®æ ‡ä¸å¯èƒ½å­˜åœ¨çš„é‚£ä¸€åŠï¼Œå¹¶åœ¨å‰©ä¸‹çš„ä¸€åŠä¸Šç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ä¸€èˆ¬å®ç°çš„å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><strong>åˆå§‹æ¡ä»¶ï¼šleft = 0, right = length-1</strong></li>
<li><strong>ç»ˆæ­¢ï¼šleft &gt; right</strong></li>
<li><strong>å‘å·¦æŸ¥æ‰¾ï¼šright = mid-1</strong></li>
<li><strong>å‘å³æŸ¥æ‰¾ï¼šleft = mid +1</strong></li>
</ul>
<p>ç»å¤§éƒ¨åˆ† <strong>ã€Œåœ¨é€’å¢é€’å‡åŒºé—´ä¸­æœç´¢ç›®æ ‡å€¼ã€</strong> çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥è½¬åŒ–ä¸ºäºŒåˆ†æŸ¥æ‰¾é—®é¢˜ã€‚å¹¶ä¸”ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„é¢˜ç›®ï¼ŒåŸºæœ¬é€ƒä¸å‡ºä¸‰ç§ï¼šæ‰¾ç‰¹å®šå€¼ï¼Œæ‰¾å¤§äºç‰¹å®šå€¼çš„å…ƒç´ ï¼ˆä¸Šç•Œï¼‰ï¼Œæ‰¾å°äºç‰¹å®šå€¼çš„å…ƒç´ ï¼ˆä¸‹ç•Œï¼‰ã€‚</p>
<p>å°†ä¸Šé¢çš„æ€æƒ³ä»£å…¥åˆ°æœ¬é¢˜ï¼Œæˆ‘ä»¬è¦æ‰¾ â€œ<strong>é˜¿ç‚åœ¨ H å°æ—¶åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ K</strong>â€ã€‚é‚£æœ€ç¬¨çš„å°±æ˜¯é˜¿ç‚åƒçš„ç‰¹åˆ«æ…¢ï¼Œæ¯å°æ—¶åªåƒæ‰ 1 æ ¹é¦™è•‰ï¼Œç„¶åæˆ‘ä»¬é€æ¸é€’å¢é˜¿ç‚åƒé¦™è•‰çš„é€Ÿåº¦åˆ° iï¼Œåˆšå¥½æ»¡è¶³åœ¨ H å°æ—¶å¯ä»¥åƒæ‰æ‰€æœ‰é¦™è•‰ï¼Œæ­¤æ—¶ i å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€å°é€Ÿåº¦ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™ä¹ˆç¬¨ï¼Œæ‰€ä»¥å¯ä»¥æƒ³åˆ°ä½¿ç”¨äºŒåˆ†çš„æ€æƒ³æ¥è¿›è¡Œä¼˜åŒ–ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minEatingSpeed</span>(<span class="params">self, piles: <span class="type">List</span>[<span class="built_in">int</span>], H: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># æœ€å°é€Ÿåº¦</span></span><br><span class="line">        low = <span class="number">1</span></span><br><span class="line">        <span class="comment"># æœ€å¤§çš„é€Ÿåº¦ï¼Œå½“ç„¶ç­‰äºåƒæ‰æœ€å¤§ä¸€å †çš„é¦™è•‰ï¼Œæ¯•ç«Ÿä¸€å°æ—¶åªèƒ½åƒä¸€å †ï¼Œå†å¤§ä¹Ÿæ²¡æœ‰æ„ä¹‰</span></span><br><span class="line">        high = <span class="built_in">max</span>(piles)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">canEat</span>(<span class="params">piles, speed, H</span>):</span></span><br><span class="line">            <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> pile <span class="keyword">in</span> piles:</span><br><span class="line">                <span class="comment"># å‘ä¸Šå–æ•´</span></span><br><span class="line">                <span class="keyword">if</span> pile % speed &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">sum</span> += pile // speed + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">sum</span> += pile // speed</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">sum</span> &gt; H</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> low &lt; high:</span><br><span class="line">            <span class="comment"># ä¸­é—´é€Ÿåº¦</span></span><br><span class="line">            mid = (low + high) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="comment"># å¦‚æœè¶…æ—¶å°±å¾€å¤§çš„æ–¹å‘æ‰¾ï¼Œå¦åˆ™å¾€å°çš„æ–¹å‘æ‰¾</span></span><br><span class="line">            <span class="keyword">if</span> canEat(piles, mid, H):</span><br><span class="line">                low = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                high = mid</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> low</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:372 ms,å‡»è´¥äº†59.53% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†9.52% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minEatingSpeed</span><span class="params">(<span class="keyword">int</span>[] piles, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> low = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> high = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> pile: piles) high = pile &gt; high? pile: high;</span><br><span class="line">        <span class="keyword">while</span>(low &lt; high)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = low + (high - low) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(canEat(piles, mid, h)) low = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> high = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> low;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canEat</span><span class="params">(<span class="keyword">int</span>[] piles, <span class="keyword">double</span> speed, <span class="keyword">int</span> h)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> pile: piles)&#123;</span><br><span class="line">            sum += Math.ceil(pile / speed);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum &gt; h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š43 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†10.82% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†80.42% çš„ç”¨æˆ·</p>
<h3 id="2-xçš„å¹³æ–¹æ ¹"><a href="#2-xçš„å¹³æ–¹æ ¹" class="headerlink" title="2.xçš„å¹³æ–¹æ ¹"></a>2.xçš„å¹³æ–¹æ ¹</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬69é¢˜ï¼šxçš„å¹³æ–¹æ ¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>è®¡ç®—å¹¶è¿”å› x çš„å¹³æ–¹æ ¹ï¼Œå…¶ä¸­ x æ˜¯éè´Ÿæ•´æ•°ã€‚ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™æ•´æ•°çš„éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><strong>æ•´æ•°å¹³æ–¹æ ¹</strong>ä¸€å®šå°äºç­‰äº x/2 ã€‚å³æœ‰ 0 &lt; æ•´æ•°å¹³æ–¹æ ¹ &lt;= x/2ã€‚æ‰€ä»¥æˆ‘ä»¬çš„é—®é¢˜è½¬åŒ–ä¸ºåœ¨ [0,x/2] ä¸­æ‰¾ä¸€ä¸ª<strong>ç‰¹å®šå€¼</strong>ï¼Œæ»¡è¶³äºŒåˆ†æŸ¥æ‰¾çš„æ¡ä»¶ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mySqrt</span>(<span class="params">self, x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        left = <span class="number">1</span></span><br><span class="line">        right = x // <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            <span class="comment"># +1é˜²æ­¢é™·å…¥æ­»å¾ªç¯</span></span><br><span class="line">            mid = (left + right + <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> mid ** <span class="number">2</span> &lt;= x:</span><br><span class="line">                left = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> left</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†92.37% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†5.34% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mySqrt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> r = x / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(x / mid &gt; mid) l = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x / l &lt; l? l-<span class="number">1</span>: l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†46.99% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†95.82% çš„ç”¨æˆ·</p>
<blockquote>
<p>ç‰›é¡¿è¿­ä»£æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mySqrt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x &lt; <span class="number">2</span>) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">long</span> a = x;</span><br><span class="line">        <span class="keyword">while</span>(x / a &lt; a)&#123;</span><br><span class="line">            a = (a + x / a) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†46.99% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†48.99% çš„ç”¨æˆ·</p>
<h3 id="3-ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬"><a href="#3-ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬" class="headerlink" title="3.ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬"></a>3.ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬278é¢˜ï¼šç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡è®¾ä½ æœ‰ n ä¸ªç‰ˆæœ¬ [1, 2, â€¦, n]ï¼Œä½ æƒ³æ‰¾å‡ºå¯¼è‡´ä¹‹åæ‰€æœ‰ç‰ˆæœ¬å‡ºé”™çš„ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ bool isBadVersion(version) æ¥å£æ¥åˆ¤æ–­ç‰ˆæœ¬å· version æ˜¯å¦åœ¨å•å…ƒæµ‹è¯•ä¸­å‡ºé”™ã€‚å®ç°ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ä½ åº”è¯¥å°½é‡å‡å°‘å¯¹è°ƒç”¨ API çš„æ¬¡æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®š n = 5ï¼Œå¹¶ä¸” version = 4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line">è°ƒç”¨ isBadVersion(3) -&gt; false</span><br><span class="line">è°ƒç”¨ isBadVersion(5) -&gt; true</span><br><span class="line">è°ƒç”¨ isBadVersion(4) -&gt; true</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ï¼Œ4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstBadVersion</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type n: int</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        left = <span class="number">1</span></span><br><span class="line">        right = n</span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> isBadVersion(mid):</span><br><span class="line">                right = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> left</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†5.21% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†6.31% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> <span class="keyword">extends</span> <span class="title">VersionControl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstBadVersion</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> right = n;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(isBadVersion(mid)) right = mid;</span><br><span class="line">            <span class="keyword">else</span> left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š18 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†29.41% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†68.44% çš„ç”¨æˆ·</p>
<h3 id="4-æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼I"><a href="#4-æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼I" class="headerlink" title="4.æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼I"></a>4.æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼I</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬153é¢˜ï¼šæ—‹è½¬æ’åºæ•°ç»„æœ€å°å€¼â… </th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,4,5,1,2]</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [4,5,6,7,0,1,2]</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ— è®ºæ€ä¹ˆæ—‹è½¬ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼Œé¦–å…ƒç´  &gt; å°¾å…ƒç´ </p>
<p>å¹¶ä¸”æˆ‘ä»¬å·²çŸ¥äº†é¦–å…ƒç´ å€¼æ€»æ˜¯å¤§äºå°¾å…ƒç´ ï¼Œé‚£æˆ‘ä»¬åªè¦æ‰¾åˆ°å°†å…¶ä¸€åˆ†ä¸ºäºŒçš„é‚£ä¸ªç‚¹ï¼ˆè¯¥ç‚¹å·¦ä¾§çš„å…ƒç´ éƒ½å¤§äºé¦–å…ƒç´ ï¼Œè¯¥ç‚¹å³ä¾§çš„å…ƒç´ éƒ½å°äºé¦–å…ƒç´ ï¼‰ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥å¯¹åº”æ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å°å€¼ã€‚</p>
<p>ç„¶åæˆ‘ä»¬é€šè¿‡äºŒåˆ†æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œå…ˆæ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹midï¼Œå¦‚æœä¸­é—´å…ƒç´ å°äºå°¾å…ƒç´ ï¼Œæˆ‘ä»¬å°±æŠŠmidå‘å·¦ç§»åŠ¨ã€‚</p>
<p>å¦‚æœä¸­é—´å…ƒç´ å¤§äºå°¾å…ƒç´ ï¼Œæˆ‘ä»¬å°±æŠŠmidå‘å³ç§»åŠ¨ã€‚</p>
<p>ä¹‹æ‰€ä»¥è·Ÿå°¾å…ƒç´ æ¯”ï¼Œæ˜¯å› ä¸ºæµ‹è¯•ç”¨ä¾‹:[11,13,15,17]ï¼Œç®—ä»–åŸåœ°ç¿»è½¬ï¼Œå…¶ç»“æœä¸º11ï¼Œè‹¥è·Ÿé¦–å…ƒç´ æ¯”ï¼Œåˆ™ç»“æœä¸º17å¯¼è‡´å‡ºé”™</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMin</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="built_in">len</span>(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> nums[mid] &gt; nums[-<span class="number">1</span>]:</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line">        <span class="keyword">return</span> nums[left]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:28 ms,å‡»è´¥äº†99.24% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†8.37% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] &gt; nums[r]) l = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[l];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†78.33% çš„ç”¨æˆ·</p>
<h3 id="5-æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II"><a href="#5-æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II" class="headerlink" title="5.æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II"></a>5.æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬154é¢˜ï¼šæ—‹è½¬æ’åºæ•°ç»„æœ€å°å€¼â…¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚  æ³¨æ„æ•°ç»„ä¸­å¯èƒ½å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,3,5]</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [2,2,2,0,1]</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>è¿™é“é¢˜æ˜¯ <a href="https://www.geekxh.com/1.9.äºŒåˆ†æ³•ç³»åˆ—/1.9/904.html">æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼(153)</a> çš„å»¶ä¼¸é¢˜ç›®ã€‚</li>
<li>å…è®¸é‡å¤ä¼šå½±å“ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šå¦‚ä½•å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li>
</ul>
<blockquote>
<p>ç›¸å¯¹æ¯”æ˜¨å¤©é¢˜ç›®è€Œè¨€ï¼Œå…¶å®åªæ˜¯å¤šäº†<strong>nums[mid] ç­‰äº nums[right] æ—¶çš„é¢å¤–å¤„ç†</strong>ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨ nums[mid] ç­‰äº nums[right] æ—¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¤šäº†ä¸€ä¸ª right-1 çš„æ“ä½œã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/64.png" alt></p>
<p>å› ä¸º mid å’Œ right ç›¸ç­‰æ—¶ï¼Œæœ€å°å€¼æ—¢å¯èƒ½åœ¨å·¦è¾¹ï¼Œåˆå¯èƒ½åœ¨å³è¾¹ï¼Œæ‰€ä»¥æ­¤æ—¶è‡ªç„¶äºŒåˆ†æ€æƒ³ä½œåºŸï¼Œå’±ä»¬å°±ç æ‰ä¸€ä¸ªå³è¾¹ç•Œã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯<strong>è®©å­å¼¹å†é£ä¸€ä¼šå„¿</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMin</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="built_in">len</span>(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> nums[mid] &gt; nums[right]:</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> nums[mid] &lt; nums[right]:</span><br><span class="line">                right = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> nums[left]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:48 ms,å‡»è´¥äº†23.32% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†27.84% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] &gt; nums[r]) l = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &lt; nums[r]) r = mid;</span><br><span class="line">            <span class="keyword">else</span> r--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[l];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†27.61% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†73.68% çš„ç”¨æˆ·</p>
<h3 id="6-ä¾›æš–å™¨"><a href="#6-ä¾›æš–å™¨" class="headerlink" title="6.ä¾›æš–å™¨"></a>6.ä¾›æš–å™¨</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬475é¢˜ï¼šä¾›æš–å™¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>å†¬å­£å·²ç»æ¥ä¸´ã€‚ä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡ä¸€ä¸ªæœ‰å›ºå®šåŠ çƒ­åŠå¾„çš„ä¾›æš–å™¨å‘æ‰€æœ‰æˆ¿å±‹ä¾›æš–ã€‚ç°åœ¨ï¼Œç»™å‡ºä½äºä¸€æ¡æ°´å¹³çº¿ä¸Šçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®ï¼Œæ‰¾åˆ°å¯ä»¥è¦†ç›–æ‰€æœ‰æˆ¿å±‹çš„æœ€å°åŠ çƒ­åŠå¾„ã€‚æ‰€ä»¥ï¼Œä½ çš„è¾“å…¥å°†ä¼šæ˜¯æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®ã€‚ä½ å°†è¾“å‡ºä¾›æš–å™¨çš„æœ€å°åŠ çƒ­åŠå¾„ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>è¯´æ˜:</strong></p>
<ul>
<li>ç»™å‡ºçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„æ•°ç›®æ˜¯éè´Ÿæ•°ä¸”ä¸ä¼šè¶…è¿‡ 25000ã€‚</li>
<li>ç»™å‡ºçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®å‡æ˜¯éè´Ÿæ•°ä¸”ä¸ä¼šè¶…è¿‡10^9ã€‚</li>
<li>åªè¦æˆ¿å±‹ä½äºä¾›æš–å™¨çš„åŠå¾„å†…(åŒ…æ‹¬åœ¨è¾¹ç¼˜ä¸Š)ï¼Œå®ƒå°±å¯ä»¥å¾—åˆ°ä¾›æš–ã€‚</li>
<li>æ‰€æœ‰ä¾›æš–å™¨éƒ½éµå¾ªä½ çš„åŠå¾„æ ‡å‡†ï¼ŒåŠ çƒ­çš„åŠå¾„ä¹Ÿä¸€æ ·ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3],[2]</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: ä»…åœ¨ä½ç½®2ä¸Šæœ‰ä¸€ä¸ªä¾›æš–å™¨ã€‚å¦‚æœæˆ‘ä»¬å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œé‚£ä¹ˆæ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3,4],[1,4]</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: åœ¨ä½ç½®1, 4ä¸Šæœ‰ä¸¤ä¸ªä¾›æš–å™¨ã€‚æˆ‘ä»¬éœ€è¦å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œè¿™æ ·æ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬è¦å¯¹ä»»æ„ä¸€ä¸ªæˆ¿å±‹ä¾›æš–ï¼Œè¦ä¹ˆç”¨å‰é¢çš„æš–æ°”ï¼Œè¦ä¹ˆç”¨åé¢çš„æš–æ°”ï¼Œä¸¤è€…ä¹‹é—´å–æœ€è¿‘çš„ï¼Œè¿™å°±æ˜¯è·ç¦»ã€‚åŒæ—¶ï¼Œå¦‚æœè¦è¦†ç›–åˆ°æ‰€æœ‰çš„æˆ¿å±‹ï¼Œæˆ‘ä»¬è¦é€‰æ‹©ä¸Šè¿°è·ç¦»ä¸­æœ€å¤§çš„ä¸€æ®µï¼Œè¿™å°±æ˜¯æœ€å°çš„åŠ çƒ­åŠå¾„ã€‚</p>
<p>ç¬¬ä¸€å±‚ï¼šéå†æ‰€æœ‰çš„æˆ¿å­ï¼Œç¬¬äºŒå±‚ï¼šéå†åŠ çƒ­å™¨ï¼Œæ‰¾å‡ºè·ç¦»è¯¥æˆ¿å­çš„æœ€å°è·ç¦»ã€‚ä½†æ˜¯æˆ‘ä»¬å…¶å®å¯ä»¥é€šè¿‡äºŒåˆ†æœç´¢æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼šæš´åŠ›æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findRadius</span>(<span class="params">self, houses: <span class="type">List</span>[<span class="built_in">int</span>], heaters: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        houses.sort()</span><br><span class="line">        heaters.sort()</span><br><span class="line">        <span class="comment"># é˜²æ­¢ä¾›æš–å™¨åªæœ‰ä¸€ä¸ªçš„æƒ…å†µ</span></span><br><span class="line">        heaters = [<span class="built_in">float</span>(<span class="string">&quot;-inf&quot;</span>)] + heaters + [<span class="built_in">float</span>(<span class="string">&quot;inf&quot;</span>)]</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> house <span class="keyword">in</span> houses:</span><br><span class="line">            <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(heaters) - <span class="number">1</span> <span class="keyword">and</span> house &gt; heaters[i]:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            res = <span class="built_in">max</span>(res, <span class="built_in">min</span>(heaters[i] - house, house - heaters[i - <span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:140 ms,å‡»è´¥äº†92.39% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16.1 MB,å‡»è´¥äº†85.24% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findRadius</span><span class="params">(<span class="keyword">int</span>[] houses, <span class="keyword">int</span>[] heaters)</span> </span>&#123;</span><br><span class="line">        Arrays.sort(houses);</span><br><span class="line">        Arrays.sort(heaters);</span><br><span class="line">        <span class="keyword">int</span>[] nheaters = <span class="keyword">new</span> <span class="keyword">int</span>[heaters.length+<span class="number">2</span>];</span><br><span class="line">        nheaters[<span class="number">0</span>] = Integer.MIN_VALUE;</span><br><span class="line">        nheaters[nheaters.length-<span class="number">1</span>] = Integer.MAX_VALUE;</span><br><span class="line">        System.arraycopy(heaters, <span class="number">0</span>, nheaters, <span class="number">1</span>, heaters.length);</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">double</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">double</span> house: houses)&#123;</span><br><span class="line">            <span class="keyword">while</span>(index &lt; nheaters.length - <span class="number">1</span> &amp;&amp; house &gt; nheaters[index]) index++;</span><br><span class="line">            res = Math.max(res, Math.min(nheaters[index] - house, house - nheaters[index-<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š9 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†89.71% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†92.17% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šäºŒåˆ†æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findRadius</span>(<span class="params">self, houses: <span class="type">List</span>[<span class="built_in">int</span>], heaters: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        houses.sort()</span><br><span class="line">        <span class="comment"># æ‰¾åˆ°æ¯ä¸ªæˆ¿å±‹ä½ç½®æ‰€éœ€è¦çš„æœ€å°åŠå¾„çš„æœ€å¤§å€¼</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="comment"># é˜²æ­¢ä¾›æš–å™¨åªæœ‰ä¸€ä¸ªçš„æƒ…å†µ</span></span><br><span class="line">        heaters = [-<span class="built_in">float</span>(<span class="string">&quot;inf&quot;</span>)] + <span class="built_in">sorted</span>(heaters) + [<span class="built_in">float</span>(<span class="string">&quot;inf&quot;</span>)]</span><br><span class="line">        <span class="comment"># æ¯ä¸ªå±‹å­éƒ½è¦è¢«è¦†ç›–åˆ°</span></span><br><span class="line">        <span class="keyword">for</span> house <span class="keyword">in</span> houses:</span><br><span class="line">            <span class="comment"># æ¯ä¸ªå±‹å­éƒ½è¦æ‰¾åˆ°1ä¸ªç¦»ä»–æœ€è¿‘çš„heaterï¼Œè¿™é‡Œç”¨äºŒåˆ†æ³•æ”¹è¿›</span></span><br><span class="line">            left, right = <span class="number">0</span>, <span class="built_in">len</span>(heaters)-<span class="number">1</span></span><br><span class="line">            <span class="comment"># æ‰¾ä¸å°äºhouseçš„ç¬¬ä¸€ä¸ªheaterå€¼</span></span><br><span class="line">            <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            	<span class="comment"># åº”è¯¥å†™mid=left+((right-left)&gt;&gt;1)ï¼Œå› ä¸ºä½è¿ç®—çš„ä¼˜å…ˆçº§ä¸å¦‚åŠ æ³•è¿ç®—</span></span><br><span class="line">                mid = left + ((right - left) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> house &gt; heaters[mid]:</span><br><span class="line">                    left = mid + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    right = mid</span><br><span class="line">            <span class="comment"># houseå¤¹åœ¨heaters[left-1] heater[left]ä¸­é—´</span></span><br><span class="line">            res = <span class="built_in">max</span>(res, <span class="built_in">min</span>(house - heaters[left - <span class="number">1</span>], heaters[left] - house))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:252 ms,å‡»è´¥äº†86.09% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.9 MB,å‡»è´¥äº†93.07% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findRadius</span><span class="params">(<span class="keyword">int</span>[] houses, <span class="keyword">int</span>[] heaters)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> res = <span class="number">0</span>;</span><br><span class="line">        Arrays.sort(heaters);</span><br><span class="line">        <span class="keyword">int</span>[] nheaters = <span class="keyword">new</span> <span class="keyword">int</span>[heaters.length+<span class="number">2</span>];</span><br><span class="line">        nheaters[<span class="number">0</span>] = Integer.MIN_VALUE;</span><br><span class="line">        nheaters[nheaters.length-<span class="number">1</span>] = Integer.MAX_VALUE;</span><br><span class="line">        System.arraycopy(heaters, <span class="number">0</span>, nheaters, <span class="number">1</span>, heaters.length);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">double</span> house: houses)&#123;</span><br><span class="line">            <span class="keyword">int</span> left = <span class="number">0</span>, right = nheaters.length;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right)&#123;</span><br><span class="line">                <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(house &gt; nheaters[mid]) left = mid + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> right = mid;</span><br><span class="line">            &#125;</span><br><span class="line">            res = Math.max(res, Math.min(nheaters[left] - house, house - nheaters[left-<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š23 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†39.37% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†84.79% çš„ç”¨æˆ·</p>
<h2 id="å…¶ä»–è¡¥å……é¢˜ç›®"><a href="#å…¶ä»–è¡¥å……é¢˜ç›®" class="headerlink" title="å…¶ä»–è¡¥å……é¢˜ç›®"></a>å…¶ä»–è¡¥å……é¢˜ç›®</h2><h3 id="1-èºæ—‹çŸ©é˜µI"><a href="#1-èºæ—‹çŸ©é˜µI" class="headerlink" title="1.èºæ—‹çŸ©é˜µI"></a>1.èºæ—‹çŸ©é˜µI</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬54é¢˜ï¼šèºæ—‹çŸ©é˜µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®šä¸€ä¸ªåŒ…å« m x n ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆm è¡Œ, n åˆ—ï¼‰ï¼Œè¯·æŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹é¡ºåºï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line"> [ 1, 2, 3 ],</span><br><span class="line"> [ 4, 5, 6 ],</span><br><span class="line"> [ 7, 8, 9 ]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: [1,2,3,6,9,8,7,4,5]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [1, 2, 3, 4],</span><br><span class="line">  [5, 6, 7, 8],</span><br><span class="line">  [9,10,11,12]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: [1,2,3,4,8,12,11,10,9,5,6,7]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åªæœ‰æˆ‘ä»¬èƒ½æ‰¾åˆ°è¾¹ç•Œï¼ˆè¾¹ç•ŒåŒ…æ‹¬ï¼š1ã€æ•°ç»„çš„è¾¹ç•Œ 2ã€å·²ç»è®¿é—®è¿‡çš„å…ƒç´ ï¼‰ï¼Œæ‰å¯ä»¥é€šè¿‡â€œ<strong>å³ï¼Œä¸‹ï¼Œå·¦ï¼Œä¸Š</strong>â€çš„æ–¹å‘æ¥è¿›è¡Œç§»åŠ¨ã€‚åŒæ—¶ï¼Œæ¯ä¸€æ¬¡<strong>ç¢°å£</strong>ï¼Œå°±å¯ä»¥è°ƒæ•´åˆ°ä¸‹ä¸€ä¸ªæ–¹å‘ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå¯¹å…¶è®¾ç½®å¥½å››ä¸ªè¾¹ç•Œ:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">up := 0</span><br><span class="line">down := len(matrix) - 1</span><br><span class="line">left := 0</span><br><span class="line">right := len(matrix[0]) - 1</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰xå’Œyï¼Œæ¥ä»£è¡¨è¡Œå’Œåˆ—ã€‚</p>
<p>ç„¶åæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è¡Œå†›ï¼ˆy=leftï¼‰ï¼Œå®Œæˆç¬¬ä¸€è¡Œçš„éå†ï¼Œç›´åˆ°ç¢°å£ã€‚ï¼ˆy&lt;=rightï¼‰</p>
<p>ä¸‹é¢å…³é”®çš„ä¸€æ­¥æ¥äº†ï¼Œ<strong>å› ä¸ºç¬¬ä¸€è¡Œå·²ç»èµ°è¿‡äº†ï¼Œæˆ‘ä»¬å°†ä¸Šç•Œä¸‹è°ƒ</strong> <strong>ï¼ˆup++ï¼‰</strong>ï¼ŒåŒæ—¶è½¬å¼¯å‘ä¸‹èµ°ã€‚</p>
<p>ç›´åˆ°ç¢°åˆ°åº•éƒ¨æ—¶ï¼ˆx&lt;=downï¼‰ï¼Œæˆ‘ä»¬å°†<strong>å³ç•Œå·¦è°ƒï¼ˆrightâ€”ï¼‰</strong>ï¼Œè½¬å¼¯å‘å·¦èµ°ã€‚</p>
<p>åé¢å‘å·¦å’Œå‘ä¸Šï¼Œåˆ†åˆ«å®Œæˆ<strong>ä¸‹ç•Œä¸Šè°ƒï¼ˆdownâ€”å’Œå·¦ç•Œå³è°ƒï¼ˆleft++ï¼‰</strong>ã€‚</p>
<p>æœ€åï¼Œå¯¹å‰©ä¸‹çš„çŸ©é˜µé‡å¤æ•´ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°ä¸Šä¸‹ã€å·¦å³çš„å£ä¸å£ç¢°åœ¨ä¸€èµ· <strong>ï¼ˆup &lt;= down &amp;&amp; left &lt;= rightï¼Œè¿™æ˜¯é¿å…ç¢°å£çš„æ¡ä»¶ï¼‰</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spiralOrder</span>(<span class="params">self, matrix: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        result = []</span><br><span class="line">        left, right, up, down = <span class="number">0</span>, <span class="built_in">len</span>(matrix[<span class="number">0</span>]) - <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">len</span>(matrix) - <span class="number">1</span></span><br><span class="line">        x, y = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> left &lt;= right <span class="keyword">and</span> up &lt;= down:</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(left, right+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> left &lt;= right <span class="keyword">and</span> up &lt;= down:</span><br><span class="line">                    result.append(matrix[x][y])</span><br><span class="line">            up += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(up, down+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> left &lt;= right <span class="keyword">and</span> up &lt;= down:</span><br><span class="line">                    result.append(matrix[x][y])</span><br><span class="line">            right -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(right, left-<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> left &lt;= right <span class="keyword">and</span> up &lt;= down:</span><br><span class="line">                    result.append(matrix[x][y])</span><br><span class="line">            down -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(down, up-<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> left &lt;= right <span class="keyword">and</span> up &lt;= down:</span><br><span class="line">                    result.append(matrix[x][y])</span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†60.32% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†73.96% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">spiralOrder</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = matrix[<span class="number">0</span>].length - <span class="number">1</span>, up = <span class="number">0</span>, down = matrix.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right &amp;&amp; up &lt;= down)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> y = left; y &lt;= right; y++) res.add(matrix[up][y]);</span><br><span class="line">            up++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> x = up; x &lt;= down; x++) res.add(matrix[x][right]);</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">if</span>(up &gt; down) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> y = right; y &gt;= left; y--) res.add(matrix[down][y]);</span><br><span class="line">            down--;</span><br><span class="line">            <span class="keyword">if</span>(left &gt; right) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> x = down; x &gt;= up; x--) res.add(matrix[x][left]);</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†76.13% çš„ç”¨æˆ·</p>
<h3 id="2-åªæœ‰ä¸¤ä¸ªé”®çš„é”®ç›˜"><a href="#2-åªæœ‰ä¸¤ä¸ªé”®çš„é”®ç›˜" class="headerlink" title="2.åªæœ‰ä¸¤ä¸ªé”®çš„é”®ç›˜"></a>2.åªæœ‰ä¸¤ä¸ªé”®çš„é”®ç›˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬650é¢˜ï¼šåªæœ‰ä¸¤ä¸ªé”®çš„é”®ç›˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ€åˆåœ¨ä¸€ä¸ªè®°äº‹æœ¬ä¸Šåªæœ‰ä¸€ä¸ªå­—ç¬¦  â€˜Aâ€™ ã€‚ä½ æ¯æ¬¡å¯ä»¥å¯¹è¿™ä¸ªè®°äº‹æœ¬è¿›è¡Œä¸¤ç§æ“ä½œï¼šCopy All (å¤åˆ¶å…¨éƒ¨) : ä½ å¯ä»¥å¤åˆ¶è¿™ä¸ªè®°äº‹æœ¬ä¸­çš„æ‰€æœ‰å­—ç¬¦(éƒ¨åˆ†çš„å¤åˆ¶æ˜¯ä¸å…è®¸çš„)ã€‚Paste (ç²˜è´´) : ä½ å¯ä»¥ç²˜è´´ä½ ä¸Šä¸€æ¬¡å¤åˆ¶çš„å­—ç¬¦ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>ç»™å®šä¸€ä¸ªæ•°å­— n ã€‚ä½ éœ€è¦ä½¿ç”¨<strong>æœ€å°‘çš„æ“ä½œæ¬¡æ•°</strong>ï¼Œåœ¨è®°äº‹æœ¬ä¸­æ‰“å°å‡ºæ°å¥½ n ä¸ª â€˜Aâ€™ã€‚è¾“å‡ºèƒ½å¤Ÿæ‰“å°å‡º n ä¸ª â€˜Aâ€™ çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 3</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š:</span><br><span class="line">æœ€åˆ, æˆ‘ä»¬åªæœ‰ä¸€ä¸ªå­—ç¬¦ &#x27;A&#x27;ã€‚</span><br><span class="line">ç¬¬ 1 æ­¥, æˆ‘ä»¬ä½¿ç”¨ Copy All æ“ä½œã€‚</span><br><span class="line">ç¬¬ 2 æ­¥, æˆ‘ä»¬ä½¿ç”¨ Paste æ“ä½œæ¥è·å¾— &#x27;AA&#x27;ã€‚</span><br><span class="line">ç¬¬ 3 æ­¥, æˆ‘ä»¬ä½¿ç”¨ Paste æ“ä½œæ¥è·å¾— &#x27;AAA&#x27;ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜:</strong></p>
<p>n çš„å–å€¼èŒƒå›´æ˜¯ [1, 1000] ã€‚</p>
<blockquote>
<p>æœ¬é¢˜çš„æ€è·¯ï¼Œåœ¨äº<strong>æƒ³æ˜ç™½å¤åˆ¶å’Œç²˜è´´è¿‡ç¨‹ä¸­çš„è§„å¾‹ï¼Œæ‰¾åˆ°å¦‚ä½•ç»„æˆNä¸ªAçš„æœ€å°æ“ä½œæ•°ã€‚</strong></p>
<p>æˆ‘ä»¬ä»æœ€ç®€å•çš„å¼€å§‹åˆ†æï¼Œå‡å¦‚æˆ‘ä»¬ç»™å®šæ•°å­—ä¸º1ï¼Œé‚£å•¥ä¹Ÿä¸ç”¨åšï¼Œå› ä¸ºé¢æ¿ä¸Šæœ¬æ¥å°±æœ‰ä¸€ä¸ªAã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/65.png" alt></p>
<p>å‡å¦‚æˆ‘ä»¬ç»™å®šæ•°å­—ä¸º2ï¼Œé‚£æˆ‘ä»¬éœ€è¦åšC-Pï¼Œå…±è®¡2æ¬¡æ“ä½œæ¥å¾—åˆ°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/66.png" alt></p>
<p>å‡å¦‚æˆ‘ä»¬ç»™å®šæ•°å­—ä¸º3ï¼Œé‚£æˆ‘ä»¬éœ€è¦åšC-P-Pï¼Œå…±è®¡3æ¬¡æ“ä½œæ¥å¾—åˆ°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/67.png" alt></p>
<p>å‡å¦‚æˆ‘ä»¬ç»™å®šæ•°å­—ä¸º4ï¼Œæˆ‘ä»¬å‘ç°å¥½åƒå˜å¾—ä¸ä¸€æ ·äº†ã€‚å› ä¸ºæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å¾—åˆ°ç›®æ ‡ã€‚ï¼ˆC-P-C-Pï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/68.png" alt></p>
<p>æˆ–è€…ï¼ˆC-P-P-Pï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/69.png" alt></p>
<p>ä½†æ˜¯éœ€è¦çš„æ­¥éª¤è¿˜æ˜¯ä¸€æ ·ã€‚</p>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒSTOPï¼é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬è‡³å°‘å¯ä»¥è§‚å¯Ÿå‡ºï¼š<strong>å¦‚æœ i ä¸ºè´¨æ•°ï¼Œé‚£ä¹ˆ i æ˜¯å¤šå°‘ï¼Œå°±éœ€è¦ç²˜è´´å¤šå°‘æ¬¡</strong>ã€‚å³ï¼šç´ æ•°æ¬¡æ•°ä¸ºæœ¬èº«çš„ç»“è®ºã€‚å¦‚ ä¸¤ä¸ªA = 2ï¼Œä¸‰ä¸ªA = 3ï¼Œäº”ä¸ªA = 5ã€‚</p>
<p>é‚£å¯¹äºåˆæ•°åˆè¯¥å¦‚ä½•åˆ†æå‘¢ï¼Ÿï¼ˆè‡ªç„¶æ•°ä¸­é™¤èƒ½è¢«1å’Œæœ¬èº«æ•´é™¤å¤–,è¿˜èƒ½è¢«å…¶ä»–çš„æ•°æ•´é™¤çš„æ•°ï¼‰è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼šåˆæ•°çš„æ¬¡æ•°ä¸º<strong>å°†å…¶åˆ†è§£è´¨å› æ•°çš„æ“ä½œæ¬¡æ•°çš„å’Œã€‚</strong> è§£é‡Šä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸ªå•¥æ„æ€ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>æ¯”å¦‚30ï¼Œå¯ä»¥åˆ†è§£ä¸ºï¼š3*2*5ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬æ¼”ç¤ºä¸€éï¼šé¦–å…ˆå¤åˆ¶1ï¼Œè¿›è¡Œ2æ¬¡ç²˜è´´å¾—åˆ°3ã€‚ç„¶åå¤åˆ¶3ï¼Œè¿›è¡Œ1æ¬¡ç²˜è´´å¾—åˆ°6ã€‚ç„¶åå¤åˆ¶6ï¼Œè¿›è¡Œ4æ¬¡ç²˜è´´å¾—åˆ°30ã€‚æ€»å…±éœ€è¦ï¼ˆCPPCPCPPPPï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/70.png" alt></p>
<blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œç”±äºæ¯ä¸€æ¬¡éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡å¤åˆ¶ï¼Œ<strong>æ‰€ä»¥ç›´æ¥å°±ç­‰äºåˆ†è§£è´¨å› æ•°çš„æ“ä½œæ¬¡æ•°çš„å’Œ</strong>ã€‚å¹¶ä¸”åˆ†è§£çš„é¡ºåºï¼Œä¸ä¼šå½±å“åˆ°ç»“æœã€‚</p>
</blockquote>
<p>ç»¼åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—å‡ºåˆ†æç»“æœï¼š</p>
<p>1ã€è´¨æ•°æ¬¡æ•°ä¸ºå…¶æœ¬èº«ã€‚</p>
<p>2ã€åˆæ•°æ¬¡æ•°ä¸ºå°†å…¶åˆ†è§£åˆ°<strong>æ‰€æœ‰ä¸èƒ½å†åˆ†è§£çš„è´¨æ•°çš„æ“ä½œæ¬¡æ•°çš„å’Œ</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSteps</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">while</span> n % i == <span class="number">0</span>:</span><br><span class="line">                res += i</span><br><span class="line">                n /= i</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†91.24% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†19.97% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minSteps</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(n % i == <span class="number">0</span>)&#123;</span><br><span class="line">                res += i;</span><br><span class="line">                n /= i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.4 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†43.12% çš„ç”¨æˆ·</p>
<h3 id="3-24ç‚¹æ¸¸æˆ"><a href="#3-24ç‚¹æ¸¸æˆ" class="headerlink" title="3.24ç‚¹æ¸¸æˆ"></a>3.24ç‚¹æ¸¸æˆ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬679é¢˜ï¼š24ç‚¹æ¸¸æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ æœ‰ 4 å¼ å†™æœ‰ 1 åˆ° 9 æ•°å­—çš„ç‰Œã€‚ä½ éœ€è¦åˆ¤æ–­æ˜¯å¦èƒ½é€š  *ï¼Œ/ï¼Œ+ï¼Œ-ï¼Œ(ï¼Œ) çš„è¿ç®—å¾—åˆ° 24 ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [4, 1, 8, 7]</span><br><span class="line">è¾“å‡º: True</span><br><span class="line">è§£é‡Š: (8-4) * (7-1) = 24</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1, 2, 1, 2]</span><br><span class="line">è¾“å‡º: False</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„:</p>
<p>â€‹    1ã€é™¤æ³•<strong>è¿ç®—ç¬¦ / è¡¨ç¤ºå®æ•°é™¤æ³•ï¼Œè€Œä¸æ˜¯æ•´æ•°é™¤æ³•</strong>ã€‚ä¾‹å¦‚ 4 / (1 - 2/3) = 12 ã€‚</p>
<p>â€‹    2ã€æ¯ä¸ªè¿ç®—ç¬¦å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œè¿ç®—ã€‚ç‰¹åˆ«æ˜¯æˆ‘ä»¬ä¸èƒ½ç”¨ - ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[1, 1, 1, 1] ä½œä¸ºè¾“å…¥æ—¶ï¼Œè¡¨è¾¾å¼ -1 - 1 - 1 - 1 æ˜¯ä¸å…è®¸çš„ã€‚</p>
<p>â€‹    3ã€ä½ ä¸èƒ½å°†æ•°å­—è¿æ¥åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥ä¸º [1, 2, 1, 2] æ—¶ï¼Œä¸èƒ½å†™æˆ 12 + 12 ã€‚</p>
<blockquote>
<p>æ‹¿åˆ°é¢˜ç›®ï¼Œç¬¬ä¸€ååº”å°±å¯ä»¥æƒ³åˆ°<strong>æš´åŠ›æ±‚è§£ã€‚å¦‚æœæˆ‘ä»¬è¦åˆ¤æ–­ç»™å‡ºçš„4å¼ ç‰Œæ˜¯å¦å¯ä»¥é€šè¿‡ç»„åˆå¾—åˆ°24ï¼Œé‚£æˆ‘ä»¬åªéœ€æ‰¾å‡ºæ‰€æœ‰çš„å¯ç»„åˆçš„æ–¹å¼è¿›è¡Œéå†ã€‚</strong></p>
<p>4ä¸ªæ•°å­—ï¼Œ3ä¸ªæ“ä½œç¬¦ï¼Œå¤–åŠ æ‹¬å·ï¼ŒåŸºæœ¬ç›®æµ‹å°±èƒ½æƒ³åˆ°ç»„åˆæ•°ä¸ä¼šå¤§åˆ°è¶…å‡ºè¾¹ç•Œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦<strong>æŠŠä»–ä»¬ç»Ÿç»Ÿåˆ—å‡ºæ¥ï¼Œä¸å°±å¯ä»¥è¿›è¡Œæ±‚è§£äº†å—</strong>?</p>
<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•å†™çš„æ­£ç¡®å—ï¼Ÿå…¶å®ä¸å¯¹ï¼å› ä¸ºåœ¨è®¡ç®—æœºä¸­ï¼Œå®æ•°åœ¨è®¡ç®—å’Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€äº›å¾®å°çš„è¯¯å·®ï¼Œ<strong>å¯¹äºä¸€äº›ä¸é›¶ä½œæ¯”è¾ƒçš„è¯­å¥æ¥è¯´ï¼Œæœ‰æ—¶ä¼šå› è¯¯å·®è€Œå¯¼è‡´åŸæœ¬æ˜¯ç­‰äºé›¶ä½†ç»“æœå´å°äºæˆ–å¤§äºé›¶ä¹‹ç±»çš„æƒ…å†µå‘ç”Ÿ</strong>ï¼Œæ‰€ä»¥å¸¸ç”¨ä¸€ä¸ªå¾ˆå°çš„æ•° <strong>1e-6</strong> ä»£æ›¿ 0ï¼Œè¿›è¡Œåˆ¤è¯»ï¼</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">judgePoint24</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        op = [<span class="keyword">lambda</span> x, y: x + y, <span class="keyword">lambda</span> x, y: x - y, <span class="keyword">lambda</span> x, y: x * y,</span><br><span class="line">              <span class="keyword">lambda</span> x, y: x / y <span class="keyword">if</span> y != <span class="number">0</span> <span class="keyword">else</span> <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)]</span><br><span class="line">        <span class="comment"># è¿”å›å¯è¿­ä»£å¯¹è±¡çš„æ‰€æœ‰æ•°å­¦å…¨æ’åˆ—æ–¹å¼</span></span><br><span class="line">        <span class="keyword">for</span> a, b, c, d <span class="keyword">in</span> itertools.permutations(nums):</span><br><span class="line">            <span class="comment"># product(list1, list2) ä¾æ¬¡å–å‡ºlist1ä¸­çš„æ¯1ä¸ªå…ƒç´ ï¼Œä¸list2ä¸­çš„æ¯1ä¸ªå…ƒç´ ï¼Œç»„æˆå…ƒç»„ï¼Œ</span></span><br><span class="line">            <span class="comment"># ç„¶åï¼Œå°†æ‰€æœ‰çš„å…ƒç»„ç»„æˆä¸€ä¸ªåˆ—è¡¨ï¼Œè¿”å›ã€‚</span></span><br><span class="line">            <span class="keyword">for</span> f, g, h <span class="keyword">in</span> itertools.product(op, repeat=<span class="number">3</span>):</span><br><span class="line">                <span class="keyword">if</span> -<span class="number">1e-6</span> &lt; f(g(h(a, b), c), d) - <span class="number">24</span> &lt; <span class="number">1e-6</span> \</span><br><span class="line">                        <span class="keyword">or</span> -<span class="number">1e-6</span> &lt; f(g(a, h(b, c)), d) - <span class="number">24</span> &lt; <span class="number">1e-6</span> \</span><br><span class="line">                        <span class="keyword">or</span> -<span class="number">1e-6</span> &lt; f(g(a, b), h(c, d)) - <span class="number">24</span> &lt; <span class="number">1e-6</span> \</span><br><span class="line">                        <span class="keyword">or</span> -<span class="number">1e-6</span> &lt; f(a, g(h(b, c), d)) - <span class="number">24</span> &lt; <span class="number">1e-6</span> \</span><br><span class="line">                        <span class="keyword">or</span> -<span class="number">1e-6</span> &lt; f(a, g(b, h(c, d))) - <span class="number">24</span> &lt; <span class="number">1e-6</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:68 ms,å‡»è´¥äº†92.38% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.3 MB,å‡»è´¥äº†68.61% çš„Python3ç”¨æˆ·</p>
<blockquote>
<p>å¯ä»¥é€šè¿‡å›æº¯çš„æ–¹æ³•éå†æ‰€æœ‰ä¸åŒçš„å¯èƒ½æ€§ã€‚å…·ä½“åšæ³•æ˜¯ï¼Œä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨å­˜å‚¨ç›®å‰çš„å…¨éƒ¨æ•°å­—ï¼Œæ¯æ¬¡ä»åˆ—è¡¨ä¸­é€‰å‡º 2 ä¸ªæ•°å­—ï¼Œå†é€‰æ‹©ä¸€ç§è¿ç®—æ“ä½œï¼Œç”¨è®¡ç®—å¾—åˆ°çš„ç»“æœå–ä»£é€‰å‡ºçš„ 2 ä¸ªæ•°å­—ï¼Œè¿™æ ·åˆ—è¡¨ä¸­çš„æ•°å­—å°±å‡å°‘äº† 1 ä¸ªã€‚é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°åˆ—è¡¨ä¸­åªå‰©ä¸‹ 1 ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—å°±æ˜¯ä¸€ç§å¯èƒ½æ€§çš„ç»“æœï¼Œå¦‚æœç»“æœç­‰äº 24ï¼Œåˆ™è¯´æ˜å¯ä»¥é€šè¿‡è¿ç®—å¾—åˆ° 24ã€‚å¦‚æœæ‰€æœ‰çš„å¯èƒ½æ€§çš„ç»“æœéƒ½ä¸ç­‰äº 24ï¼Œåˆ™è¯´æ˜æ— æ³•é€šè¿‡è¿ç®—å¾—åˆ° 24ã€‚</p>
<p>å®ç°æ—¶ï¼Œæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚</p>
<ul>
<li><p>é™¤æ³•è¿ç®—ä¸ºå®æ•°é™¤æ³•ï¼Œå› æ­¤ç»“æœä¸ºæµ®ç‚¹æ•°ï¼Œåˆ—è¡¨ä¸­å­˜å‚¨çš„æ•°å­—ä¹Ÿéƒ½æ˜¯æµ®ç‚¹æ•°ã€‚åœ¨åˆ¤æ–­ç»“æœæ˜¯å¦ç­‰äº 24 æ—¶åº”è€ƒè™‘ç²¾åº¦è¯¯å·®ï¼Œè¿™é“é¢˜ä¸­ï¼Œè¯¯å·®å°äº 10âˆ’6 å¯ä»¥è®¤ä¸ºæ˜¯ç›¸ç­‰ã€‚</p>
</li>
<li><p>è¿›è¡Œé™¤æ³•è¿ç®—æ—¶ï¼Œé™¤æ•°ä¸èƒ½ä¸º 0ï¼Œå¦‚æœé‡åˆ°é™¤æ•°ä¸º 0 çš„æƒ…å†µï¼Œåˆ™è¿™ç§å¯èƒ½æ€§å¯ä»¥ç›´æ¥æ’é™¤ã€‚ç”±äºåˆ—è¡¨ä¸­å­˜å‚¨çš„æ•°å­—æ˜¯æµ®ç‚¹æ•°ï¼Œå› æ­¤åˆ¤æ–­é™¤æ•°æ˜¯å¦ä¸º 0 æ—¶åº”è€ƒè™‘ç²¾åº¦è¯¯å·®ï¼Œè¿™é“é¢˜ä¸­ï¼Œå½“ä¸€ä¸ªæ•°å­—çš„ç»å¯¹å€¼å°äº 10âˆ’6 æ—¶ï¼Œå¯ä»¥è®¤ä¸ºè¯¥æ•°å­—ç­‰äº 0ã€‚</p>
</li>
</ul>
<p>è¿˜æœ‰ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ã€‚</p>
<ul>
<li>åŠ æ³•å’Œä¹˜æ³•éƒ½æ»¡è¶³äº¤æ¢å¾‹ï¼Œå› æ­¤å¦‚æœé€‰æ‹©çš„è¿ç®—æ“ä½œæ˜¯åŠ æ³•æˆ–ä¹˜æ³•ï¼Œåˆ™å¯¹äºé€‰å‡ºçš„ 2 ä¸ªæ•°å­—ä¸éœ€è¦è€ƒè™‘ä¸åŒçš„é¡ºåºï¼Œåœ¨é‡åˆ°ç¬¬äºŒç§é¡ºåºæ—¶å¯ä»¥ä¸è¿›è¡Œè¿ç®—ï¼Œç›´æ¥è·³è¿‡ã€‚</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç›®æ ‡å€¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TARGET = <span class="number">24</span>;</span><br><span class="line">    <span class="comment">//è¯¯å·®</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> EPSILON = <span class="number">1e-6</span>;</span><br><span class="line">    <span class="comment">//å››ç§è¿ç®—</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ADD = <span class="number">0</span>, MULTIPLY = <span class="number">1</span>, SUBTRACT = <span class="number">2</span>, DIVIDE = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">judgePoint24</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        List&lt;Double&gt; list = <span class="keyword">new</span> ArrayList&lt;Double&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">            list.add((<span class="keyword">double</span>) num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> solve(list);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å›æº¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">solve</span><span class="params">(List&lt;Double&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ—è¡¨ä¸ºç©ºï¼Œè¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span> (list.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//ç»„åˆçš„ç»“æœæ˜¯å¦ä¸ºtarget</span></span><br><span class="line">        <span class="keyword">if</span> (list.size() == <span class="number">1</span>) <span class="keyword">return</span> Math.abs(list.get(<span class="number">0</span>) - TARGET) &lt; EPSILON;</span><br><span class="line">        <span class="keyword">int</span> size = list.size();</span><br><span class="line">        <span class="comment">//ä»å½“å‰åˆ—è¡¨ä¸­é€‰å‡ºä¸¤ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i != j) &#123;</span><br><span class="line">                    <span class="comment">//æ–°å»ºåˆ—è¡¨</span></span><br><span class="line">                    List&lt;Double&gt; list2 = <span class="keyword">new</span> ArrayList&lt;Double&gt;();</span><br><span class="line">                    <span class="comment">//é€‰å‡ºçš„ä¸¤ä¸ªæ•°å¤–çš„æ•°ï¼Œä»å­˜å…¥åˆ—è¡¨</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; size; k++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (k != i &amp;&amp; k != j) list2.add(list.get(k));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//é€‰æ‹©å…¶ä¸­ä¸€ç§è¿ç®—</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                        <span class="comment">//åŠ æ³•å’Œä¹˜æ³•éƒ½æ»¡è¶³äº¤æ¢å¾‹ï¼Œå› æ­¤å¦‚æœé€‰æ‹©çš„è¿ç®—æ“ä½œæ˜¯åŠ æ³•æˆ–ä¹˜æ³•ï¼Œåˆ™å¯¹äºé€‰å‡ºçš„æ•°å­—ä¸éœ€è¦è€ƒè™‘ä¸åŒçš„é¡ºåº</span></span><br><span class="line">                        <span class="comment">//åœ¨é‡åˆ°ç¬¬äºŒç§é¡ºåºæ—¶å¯ä»¥ä¸è¿›è¡Œè¿ç®—ï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">                        <span class="keyword">if</span> (k &lt; <span class="number">2</span> &amp;&amp; i &gt; j) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//å°†ä¸¤ä¸ªæ•°çš„è¿ç®—ç»“æœå­˜å…¥æ–°æ•°ç»„</span></span><br><span class="line">                        <span class="keyword">if</span> (k == ADD) &#123;</span><br><span class="line">                            list2.add(list.get(i) + list.get(j));</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == MULTIPLY) &#123;</span><br><span class="line">                            list2.add(list.get(i) * list.get(j));</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == SUBTRACT) &#123;</span><br><span class="line">                            list2.add(list.get(i) - list.get(j));</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == DIVIDE) &#123;</span><br><span class="line">                            <span class="comment">//æ’é™¤é™¤æ•°ä¸º0çš„æƒ…å†µ</span></span><br><span class="line">                            <span class="keyword">if</span> (Math.abs(list.get(j)) &lt; EPSILON) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                list2.add(list.get(i) / list.get(j));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//é€’å½’ï¼Œä»æ–°æ•°ç»„ä¸­ç»§ç»­é€‰å–ä¸¤ä¸ªæ•°</span></span><br><span class="line">                        <span class="keyword">if</span> (solve(list2)) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        <span class="comment">//å›æº¯</span></span><br><span class="line">                        list2.remove(list2.size() - <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š5 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†67.43% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†62.84% çš„ç”¨æˆ·</p>
<h3 id="4-é£æœºåº§ä½åˆ†é…æ¦‚ç‡"><a href="#4-é£æœºåº§ä½åˆ†é…æ¦‚ç‡" class="headerlink" title="4.é£æœºåº§ä½åˆ†é…æ¦‚ç‡"></a>4.é£æœºåº§ä½åˆ†é…æ¦‚ç‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬1227é¢˜ï¼šé£æœºåº§ä½åˆ†é…æ¦‚ç‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ‰ n ä½ä¹˜å®¢å³å°†ç™»æœºï¼Œé£æœºæ­£å¥½æœ‰ n ä¸ªåº§ä½ã€‚ç¬¬ä¸€ä½ä¹˜å®¢çš„ç¥¨ä¸¢äº†ï¼Œä»–éšä¾¿é€‰äº†ä¸€ä¸ªåº§ä½åä¸‹ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å‰©ä¸‹çš„ä¹˜å®¢å°†ä¼šï¼š</p>
<ul>
<li>å¦‚æœä»–ä»¬è‡ªå·±çš„åº§ä½è¿˜ç©ºç€ï¼Œå°±ååˆ°è‡ªå·±çš„åº§ä½ä¸Šï¼Œ</li>
<li>å½“ä»–ä»¬è‡ªå·±çš„åº§ä½è¢«å ç”¨æ—¶ï¼Œéšæœºé€‰æ‹©å…¶ä»–åº§ä½</li>
</ul>
<p>ç¬¬ n ä½ä¹˜å®¢ååœ¨è‡ªå·±çš„åº§ä½ä¸Šçš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 1</span><br><span class="line">è¾“å‡ºï¼š1.00000</span><br><span class="line">è§£é‡Šï¼šç¬¬ä¸€ä¸ªäººåªä¼šååœ¨è‡ªå·±çš„ä½ç½®ä¸Šã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n = 2</span><br><span class="line">è¾“å‡º: 0.50000</span><br><span class="line">è§£é‡Šï¼šåœ¨ç¬¬ä¸€ä¸ªäººé€‰å¥½åº§ä½åä¸‹åï¼Œç¬¬äºŒä¸ªäººååœ¨è‡ªå·±çš„åº§ä½ä¸Šçš„æ¦‚ç‡æ˜¯ 0.5ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸€ä¸ªä½ç½®ä¸€ä¸ªäººï¼Œä¸€å±è‚¡è¹²ä¸‹ï¼Œæ¦‚ç‡100%ï¼Œè¿™æ²¡å•¥å¯è¯´çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/71.png" alt></p>
<p>ä¸¤ä¸ªä½ç½®ä¸¤ä¸ªäººï¼Œç¬¬ä¸€ä¸ªäººå·²ç»åä¸‹ï¼Œè¦ä¹ˆåå¯¹äº†ï¼Œè¦ä¹ˆåé”™äº†ã€‚æ‰€ä»¥ç¬¬äºŒä¸ªäººååœ¨è‡ªå·±ä½ç½®ä¸Šçš„æ¦‚ç‡æ˜¯50%ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/72.png" alt></p>
<p>é‡ç‚¹æ¥äº†ï¼Œä¸‰ä¸ªä½ç½®ä¸‰ä¸ªäººï¼Œç¬¬ä¸€ä¸ªä¸€å±è‚¡åä¸‹ï¼Œæœ‰ä¸‰ç§åæ³•ã€‚<img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/73.jpeg" alt></p>
<p>å¦‚æœæ°å¥½<strong>ç¬¬ä¸€ä¸ªäººååˆ°äº†è‡ªå·±çš„åº§ä½</strong>ä¸Šï¼ˆ1/3ï¼‰ï¼Œé‚£è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªäººä¹Ÿå°±å¯ä»¥ç›´æ¥ååœ¨è‡ªå·±çš„åº§ä½ä¸Šï¼Œç¬¬ä¸‰ä¸ªäººä¸€æ ·ã€‚æ‰€ä»¥æ­¤æ—¶ç¬¬ä¸‰äººååœ¨è‡ªå·±åº§ä½ä¸Šçš„å¯èƒ½æ€§æ˜¯ 100%ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/74.png" alt></p>
<p>å¦‚æœ<strong>ç¬¬ä¸€ä¸ªäººå æ‰äº†ç¬¬äºŒä¸ªäººçš„ä½ç½®ï¼ˆ1/3ï¼‰ã€‚</strong> æ­¤æ—¶ç¬¬äºŒäººä¸Šæ¥ä¹‹åï¼Œè¦ä¹ˆååœ¨ç¬¬ä¸€äººçš„ä½ç½®ä¸Šï¼Œè¦ä¹ˆååœ¨ç¬¬ä¸‰äººçš„ä½ç½®ä¸Šã€‚ï¼ˆ1/2ï¼‰æ‰€ä»¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸‰äººçš„åº§ä½è¢«å çš„å¯èƒ½æ€§æ˜¯ 1/3*1/2=1/6ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/75.png" alt></p>
<p>é‚£å‡å¦‚ç¬¬ä¸€äººç›´æ¥ä¸€å±è‚¡ååœ¨ç¬¬ä¸‰äººçš„åº§ä½ä¸Šï¼Œæ­¤æ—¶ç¬¬ä¸‰äººçš„åº§ä½è¢«å çš„å¯èƒ½æ€§å°±æ˜¯ç¬¬ä¸€äººé€‰æ‹©ç¬¬ä¸‰äººåº§ä½çš„å¯èƒ½æ€§ã€‚ï¼ˆ1/3ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/76.png" alt></p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä¸‰ä¸ªåº§ä½ä¸‰ä¸ªäººï¼Œç¬¬ä¸‰ä¸ªäººååˆ°è‡ªå·±ä½ç½®ä¸Šçš„æ¦‚ç‡å°±æ˜¯ï¼š1/3 <em> 1/1 + 1/3 </em> 1/2 + 1/3 * 0 = 1/2</p>
<p>è€Œå¯¹äº n&gt;3 çš„æƒ…å†µï¼Œæˆ‘ä»¬å‚ç…§ 3 ä¸ªåº§ä½æ—¶è¿›è¡Œåˆ†æï¼š</p>
<ul>
<li>å¦‚æœç¬¬1ä¸ªä¹˜å®¢é€‰æ‹©ç¬¬1ä¸ªåº§ä½ï¼Œé‚£ä¹ˆç¬¬nä¸ªäººé€‰æ‹©åˆ°ç¬¬nä¸ªåº§ä½çš„å¯èƒ½æ€§å°±æ˜¯100%ã€‚(1/n)</li>
<li>å¦‚æœç¬¬1ä¸ªä¹˜å®¢é€‰æ‹©äº†ç¬¬nä¸ªåº§ä½ï¼Œé‚£ä¹ˆç¬¬nä¸ªäººé€‰æ‹©ç¬¬nä¸ªåº§ä½çš„å¯èƒ½æ€§å°±æ˜¯0ã€‚(0)</li>
<li><strong>è€Œå¯¹äºç¬¬ 1 ä¸ªä¹˜å®¢é€‰æ‹©é™¤äº†ç¬¬ä¸€ä¸ªå’Œç¬¬ n ä¸ªåº§ä½ä¹‹å¤–çš„åº§ä½k (1&lt;k&lt;n)ï¼Œå°±ä¼šå¯¼è‡´æœ‰å¯èƒ½å‡ºç°ï¼Œå‰ n-1 ä½ä¹˜å®¢å ç¬¬ n ä½ä¹˜å®¢çš„æ¦‚ç‡å‡ºç°ã€‚</strong></li>
</ul>
<p>ç¬¬ä¸€äºŒç§æƒ…å†µéƒ½å¥½è¯´ï¼Œå¯¹äºç¬¬ä¸‰ç§æƒ…å†µã€‚å› ä¸ºæ­¤æ—¶ç¬¬kä¸ªåº§ä½è¢«å ç”¨ï¼Œäºç¬¬ k ä¸ªä¹˜å®¢è€Œè¨€ï¼Œä»–åˆä¼šé¢ä¸´å’Œç¬¬ä¸€ä¸ªä¹˜å®¢ä¸€æ ·çš„é€‰æ‹©ã€‚<strong>ç›¸å½“äºä¹˜å®¢1å°†é—®é¢˜è½¬ç§»åˆ°äº†ç¬¬kä¸ªä¹˜å®¢èº«ä¸Šï¼Œç­‰åŒäºæœ¬æ¬¡é€‰æ‹©æ— æ•ˆï¼</strong>ä¸”è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­åˆ°æ²¡æœ‰è¯¥é€‰é¡¹<strong>ã€‚</strong>äºæ˜¯ä¹ï¼Œå¯¹äºç¬¬ n ä¸ªäººï¼Œä»–æœ€åå°†åªæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š1ã€è‡ªå·±çš„ 2ã€ç¬¬ä¸€ä¸ªäººã€‚<strong>æ‰€ä»¥å¯¹äºn&gt;=3 çš„æƒ…å†µï¼Œç­‰åŒäº n=2ï¼Œå…¨éƒ¨çš„æ¦‚ç‡éƒ½ä¸º 1/2</strong>ã€‚</p>
<p>å¦‚æœè¿˜æ˜¯ä¸èƒ½ç†è§£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥è¿™æ ·æƒ³ã€‚<strong>ç™»æœºæ—¶åº§ä½è¢«å çš„ä¹˜å®¢ ï¼Œå…¶å®ç›¸å½“äºå’Œä¸Šä¸€ä½åé”™çš„ä¹˜å®¢äº¤æ¢äº†èº«ä»½</strong>ã€‚ç›´åˆ°å®Œæˆç»ˆæ­¢æ¡ä»¶ï¼ˆåå¯¹ä½ç½® æˆ–è€… ååˆ°æœ€åä¸€ä¸ªä½ç½®ï¼‰ï¼Œå¦åˆ™è¯¥äº¤æ¢å°†ä¸€ç›´è¿›è¡Œä¸‹å»ã€‚æ‰€ä»¥ç¬¬nä½ä¹˜å®¢ï¼Œååˆ°ç¬¬nä¸ªä½ç½®ï¼Œè‡ªç„¶è¿˜æ˜¯ 1/2ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nthPersonGetsNthSeat</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">float</span>:</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0.5</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†46.71% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†37.32% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">nthPersonGetsNthSeat</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†96.75% çš„ç”¨æˆ·</p>
<h3 id="5-æ°´åˆ†å­çš„äº§ç”Ÿ"><a href="#5-æ°´åˆ†å­çš„äº§ç”Ÿ" class="headerlink" title="5.æ°´åˆ†å­çš„äº§ç”Ÿ"></a>5.æ°´åˆ†å­çš„äº§ç”Ÿ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬1117é¢˜ï¼šæ°´åˆ†å­çš„äº§ç”Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç°åœ¨æœ‰ä¸¤ç§çº¿ç¨‹ï¼Œæ°¢ oxygen å’Œæ°§ hydrogenï¼Œä½ çš„ç›®æ ‡æ˜¯ç»„ç»‡è¿™ä¸¤ç§çº¿ç¨‹æ¥äº§ç”Ÿæ°´åˆ†å­ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å­˜åœ¨ä¸€ä¸ªå±éšœï¼ˆbarrierï¼‰ä½¿å¾—æ¯ä¸ªçº¿ç¨‹å¿…é¡»ç­‰å€™ç›´åˆ°ä¸€ä¸ªå®Œæ•´æ°´åˆ†å­èƒ½å¤Ÿè¢«äº§ç”Ÿå‡ºæ¥ã€‚</p>
<p>æ°¢å’Œæ°§çº¿ç¨‹ä¼šè¢«åˆ†åˆ«ç»™äºˆ releaseHydrogen å’Œ releaseOxygen æ–¹æ³•æ¥å…è®¸å®ƒä»¬çªç ´å±éšœã€‚</p>
<p>è¿™äº›çº¿ç¨‹åº”è¯¥ä¸‰ä¸‰æˆç»„çªç ´å±éšœå¹¶èƒ½ç«‹å³ç»„åˆäº§ç”Ÿä¸€ä¸ªæ°´åˆ†å­ã€‚</p>
<p>ä½ å¿…é¡»ä¿è¯äº§ç”Ÿä¸€ä¸ªæ°´åˆ†å­æ‰€éœ€çº¿ç¨‹çš„ç»“åˆå¿…é¡»å‘ç”Ÿåœ¨ä¸‹ä¸€ä¸ªæ°´åˆ†å­äº§ç”Ÿä¹‹å‰ã€‚</p>
<p>æ¢å¥è¯è¯´:</p>
<p>å¦‚æœä¸€ä¸ªæ°§çº¿ç¨‹åˆ°è¾¾å±éšœæ—¶æ²¡æœ‰æ°¢çº¿ç¨‹åˆ°è¾¾ï¼Œå®ƒå¿…é¡»ç­‰å€™ç›´åˆ°ä¸¤ä¸ªæ°¢çº¿ç¨‹åˆ°è¾¾ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ°¢çº¿ç¨‹åˆ°è¾¾å±éšœæ—¶æ²¡æœ‰å…¶å®ƒçº¿ç¨‹åˆ°è¾¾ï¼Œå®ƒå¿…é¡»ç­‰å€™ç›´åˆ°ä¸€ä¸ªæ°§çº¿ç¨‹å’Œå¦ä¸€ä¸ªæ°¢çº¿ç¨‹åˆ°è¾¾ã€‚</p>
<p>ä¹¦å†™æ»¡è¶³è¿™äº›é™åˆ¶æ¡ä»¶çš„æ°¢ã€æ°§çº¿ç¨‹åŒæ­¥ä»£ç ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;HOH&quot;</span><br><span class="line">è¾“å‡º: &quot;HHO&quot;</span><br><span class="line">è§£é‡Š: &quot;HOH&quot; å’Œ &quot;OHH&quot; ä¾ç„¶éƒ½æ˜¯æœ‰æ•ˆè§£ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;OOHHHH&quot;</span><br><span class="line">è¾“å‡º: &quot;HHOHHO&quot;</span><br><span class="line">è§£é‡Š: &quot;HOHHHO&quot;, &quot;OHHHHO&quot;, &quot;HHOHOH&quot;, &quot;HOHHOH&quot;, &quot;OHHHOH&quot;, &quot;HHOOHH&quot;, &quot;HOHOHH&quot; å’Œ &quot;OHHOHH&quot; ä¾ç„¶éƒ½æ˜¯æœ‰æ•ˆè§£ã€‚</span><br></pre></td></tr></table></figure>
<p>é™åˆ¶æ¡ä»¶:</p>
<ul>
<li>è¾“å…¥å­—ç¬¦ä¸²çš„æ€»é•¿å°†ä¼šæ˜¯ 3n, 1 â‰¤ n â‰¤ 50ï¼›</li>
<li>è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„ â€œHâ€ æ€»æ•°å°†ä¼šæ˜¯ 2nï¼›</li>
<li>è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„ â€œOâ€ æ€»æ•°å°†ä¼šæ˜¯ nã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Semaphore</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H2O</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.h = Semaphore(<span class="number">2</span>)</span><br><span class="line">        self.o = Semaphore(<span class="number">0</span>)</span><br><span class="line">        self.h_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hydrogen</span>(<span class="params">self, releaseHydrogen: <span class="string">&#x27;Callable[[], None]&#x27;</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.h.acquire(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># releaseHydrogen() outputs &quot;H&quot;. Do not change or remove this line.</span></span><br><span class="line">        releaseHydrogen()</span><br><span class="line">        self.h_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.h_num == <span class="number">2</span>:</span><br><span class="line">            self.h_num = <span class="number">0</span></span><br><span class="line">            self.o.release(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">oxygen</span>(<span class="params">self, releaseOxygen: <span class="string">&#x27;Callable[[], None]&#x27;</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.o.acquire(<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># releaseOxygen() outputs &quot;O&quot;. Do not change or remove this line.</span></span><br><span class="line">        releaseOxygen()</span><br><span class="line">        self.h.release(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š40 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†92.16% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š15.4 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†81.37% çš„ç”¨æˆ·</p>
<blockquote>
<p>Semaphoreæ˜¯ synchronized çš„åŠ å¼ºç‰ˆï¼Œä½œç”¨æ˜¯<strong>æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘æ•°é‡</strong>ã€‚å¯ä»¥é€šè¿‡ acquire å’Œ release æ¥è¿›è¡Œç±»ä¼¼ lock å’Œ unlock çš„æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯·æ±‚ä¸€ä¸ªä¿¡å·é‡ï¼Œè¿™æ—¶å€™ä¿¡å·é‡ä¸ªæ•°-1ï¼Œå½“å‡å°‘åˆ°0çš„æ—¶å€™ï¼Œä¸‹ä¸€æ¬¡acquireä¸ä¼šå†æ‰§è¡Œï¼Œåªæœ‰å½“æ‰§è¡Œä¸€ä¸ªrelease()çš„æ—¶å€™ï¼Œä¿¡å·é‡ä¸ä¸º0çš„æ—¶å€™æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œacquire</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//é‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡ï¼Œè¿™æ—¶å€™ä¿¡å·é‡ä¸ªæ•°+1ï¼Œ</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>hæ¯è·å–ä¸€æ¬¡é‡Šæ”¾ä¸€ä¸ªoè®¸å¯ï¼Œoæ¯æ¬¡è·å–ä¸¤ä¸ªè®¸å¯ï¼ˆå³2æ¬¡håæ‰§è¡Œä¸€æ¬¡oï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H2O</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Semaphore h = <span class="keyword">new</span> Semaphore(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">private</span> Semaphore o = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">H2O</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hydrogen</span><span class="params">(Runnable releaseHydrogen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		h.acquire(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// releaseHydrogen.run() outputs &quot;H&quot;. Do not change or remove this line.</span></span><br><span class="line">        releaseHydrogen.run();</span><br><span class="line">        o.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oxygen</span><span class="params">(Runnable releaseOxygen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        o.acquire(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// releaseOxygen.run() outputs &quot;O&quot;. Do not change or remove this line.</span></span><br><span class="line">		releaseOxygen.run();</span><br><span class="line">        h.release(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š19 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†78.17% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†87.10% çš„ç”¨æˆ·</p>
<h3 id="6-æ•‘ç”Ÿè‰‡"><a href="#6-æ•‘ç”Ÿè‰‡" class="headerlink" title="6.æ•‘ç”Ÿè‰‡"></a>6.æ•‘ç”Ÿè‰‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬881é¢˜ï¼šæ•‘ç”Ÿè‰‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¬¬ i ä¸ªäººçš„ä½“é‡ä¸º people[i]ï¼Œæ¯è‰˜èˆ¹å¯ä»¥æ‰¿è½½çš„æœ€å¤§é‡é‡ä¸º limitã€‚æ¯è‰˜èˆ¹æœ€å¤šå¯åŒæ—¶è½½ä¸¤äººï¼Œä½†æ¡ä»¶æ˜¯è¿™äº›äººçš„é‡é‡ä¹‹å’Œæœ€å¤šä¸º limitã€‚è¿”å›è½½åˆ°æ¯ä¸€ä¸ªäººæ‰€éœ€çš„æœ€å°èˆ¹æ•°ã€‚(ä¿è¯æ¯ä¸ªäººéƒ½èƒ½è¢«èˆ¹è½½)ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špeople = [1,2], limit = 3</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼š1 è‰˜èˆ¹è½½ (1, 2)</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špeople = [3,2,2,1], limit = 3</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š3 è‰˜èˆ¹åˆ†åˆ«è½½ (1, 2), (2) å’Œ (3)</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špeople = [3,5,3,4], limit = 5</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼š4 è‰˜èˆ¹åˆ†åˆ«è½½ (3), (3), (4), (5)</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>1 &lt;= people.length &lt;= 50000</li>
<li>1 &lt;= people[i] &lt;= limit &lt;= 30000</li>
</ul>
<blockquote>
<p>è¿™ä¸æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œè¿™æ˜¯ä¸€ä¸ªè„‘ç­‹æ€¥è½¬å¼¯ã€‚</p>
<p>ä¸€ä¸ªèˆ¹æœ€å¤šå¯ä»¥è£…ä¸¤ä¸ªäººï¼Œå¹¶ä¸”ä¸èƒ½æŠŠèˆ¹å‹å®ã€‚åŒæ—¶è¦æ±‚æŠŠè¿™äº›äººå¯ä»¥ç»Ÿç»Ÿè£…ä¸‹çš„æœ€å°èˆ¹æ•°ã€‚ç”¨è„šè¶¾å¤´ä¹Ÿå¯ä»¥æƒ³åˆ°ï¼Œæˆ‘ä»¬éœ€è¦<strong>å°½æœ€å¤§åŠªåŠ›çš„å»ç»´æŒä¸€ä¸ªåºŠä¸Šå¾—æœ‰ä¸¤ä¸ªäºº</strong>ã€‚ã€‚å“¦ï¼Œä¸ï¼Œèˆ¹ä¸Šã€‚è¿™æ˜¯ä»€ä¹ˆæ€æƒ³ï¼ŸBingoï¼Œè´ªå¿ƒã€‚</p>
<p>æ€è·¯å¾ˆç®€å•ï¼š</p>
<ol>
<li>æˆ‘ä»¬é¦–å…ˆéœ€è¦è®©è¿™äº›äºº<strong>æ ¹æ®ä½“é‡è¿›è¡Œæ’åºã€‚</strong></li>
<li>åŒæ—¶<strong>ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯æ¬¡è®©æœ€é‡çš„ä¸€åä¸Šèˆ¹ï¼ŒåŒæ—¶è®©æœ€è½»çš„ä¹Ÿä¸Šèˆ¹</strong>ã€‚ï¼ˆå› ä¸ºæœ€é‡çš„è¦ä¹ˆå’Œæœ€è½»çš„ä¸€èµ·ä¸Šèˆ¹ã€‚è¦ä¹ˆå°±æ— æ³•é…å¯¹ï¼Œåªèƒ½è‡ªå·±å ç”¨ä¸€è‰˜èˆ¹çš„èµ„æºï¼‰</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numRescueBoats</span>(<span class="params">self, people: <span class="type">List</span>[<span class="built_in">int</span>], limit: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        people.sort()</span><br><span class="line">        ans = <span class="number">0</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        j = <span class="built_in">len</span>(people) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt;= j:</span><br><span class="line">            <span class="keyword">if</span> people[i] + people[j] &lt;= limit:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">            ans += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:504 ms,å‡»è´¥äº†97.01% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:20.3 MB,å‡»è´¥äº†29.93% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numRescueBoats</span><span class="params">(<span class="keyword">int</span>[] people, <span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        Arrays.sort(people);</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = people.length -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(people[l] + people[r] &lt;= limit) l++;</span><br><span class="line">            r--;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š17 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†96.78% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š47.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†77.37% çš„ç”¨æˆ·</p>
<h3 id="7-25åŒ¹é©¬çš„ç»å…¸é—®é¢˜"><a href="#7-25åŒ¹é©¬çš„ç»å…¸é—®é¢˜" class="headerlink" title="7.25åŒ¹é©¬çš„ç»å…¸é—®é¢˜"></a>7.25åŒ¹é©¬çš„ç»å…¸é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>25åŒ¹é©¬çš„é—®é¢˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ‰ä¸€ä¸ªèµ›åœºä¸Šå…±æœ‰25åŒ¹é©¬ï¼Œèµ›åœºæœ‰5ä¸ªè·‘é“ï¼Œä¸ä½¿ç”¨è®¡æ—¶å™¨è¿›è¡Œæ¯”èµ›ï¼ˆä¹Ÿå°±æ˜¯æ¯æ¬¡æ¯”èµ›åªèƒ½å¾—åˆ°æœ¬æ¬¡çš„æ¯”èµ›çš„é¡ºåºï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>è¯•é—®æœ€å°‘æ¯”å¤šå°‘åœºæ‰èƒ½é€‰å‡ºæœ€å¿«çš„ä¸‰åŒ¹é©¬ï¼Ÿå¹¶ç»™å‡ºåˆ†æè¿‡ç¨‹ï¼</p>
<blockquote>
<p>åˆ†æè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>5æ¬¡ï¼šé¦–å…ˆæˆ‘ä»¬æŠŠ25åŒ¹é©¬åˆ†æˆ5ç»„ï¼ˆAã€Bã€Cã€Dã€Eï¼‰ï¼Œè·‘ä¸Šäº”æ¬¡ï¼Œå¾—åˆ°æ¯ç»„çš„ç¬¬ä¸€åã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/77.png" alt></p>
</li>
<li><p>1æ¬¡ï¼šç„¶åæˆ‘ä»¬è®©è¿™5ä¸ªç¬¬ä¸€åè·‘ä¸Šä¸€æ¬¡ï¼Œå¾—åˆ°å…¶ä¸­çš„å‰ä¸‰åã€‚<strong>æ³¨æ„ï¼šè¿™é‡Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰é©¬ä¸­è·‘çš„æœ€å¿«çš„ç¬¬ä¸€åA1äº†ã€‚å¹¶ä¸”ï¼ŒD1å’ŒE1æ‰€åœ¨çš„ç»„å¯ä»¥ç›´æ¥æ·˜æ±°ã€‚ç¬¬äºŒåå’Œç¬¬ä¸‰åä¸€å®šä¸ä¼šåœ¨å…¶ä¸­äº§ç”Ÿï¼</strong></p>
</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/78.png" alt></p>
<ul>
<li><p>1æ¬¡ï¼šå› ä¸ºæˆ‘ä»¬å·²ç»è·‘å‡ºäº†ç¬¬ä¸€åï¼Œæ‰€ä»¥A1ä¸éœ€è¦å†å‚åŠ æ¯”èµ›ï¼ŒåŒæ—¶ï¼ŒD1å’ŒE1æ‰€åœ¨çš„ç»„å·²ç»æ·˜æ±°ã€‚C1ä½œä¸ºç¬¬ä¸‰ç»„çš„ç¬¬ä¸€åï¼ŒCç»„ä¸ä¼šæœ‰è·‘çš„æ¯”C1å¿«çš„ã€‚è€ŒB2æœ‰å¯èƒ½æ˜¯æ¯”C1è·‘çš„å¿«çš„ç¬¬ä¸‰åã€‚åŒç†ï¼ŒA2å’ŒA3ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¯”B1å’ŒB2è·‘çš„å¿«çš„ã€‚æ‰€ä»¥ç¬¬7æ¬¡æ¯”èµ›ï¼Œæˆ‘ä»¬è®©<strong>A2ï¼ŒA3ï¼ŒB1ï¼ŒB2ï¼ŒC1</strong>æ¥ä¸€èµ·å®Œæˆã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/79.png" alt></p>
</li>
</ul>
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬<strong>é€šè¿‡7æ¬¡æ¯”èµ›</strong>ï¼Œå¾—åˆ°25åŒ¹é©¬ä¸­çš„å‰ä¸‰åã€‚</p>
</blockquote>
<p><strong>å‡çº§ç‰ˆæœ¬</strong></p>
<p>è¿˜æ˜¯25åŒ¹é©¬ï¼Œå¦‚æœæˆ‘ä»¬è¦æ‰¾åˆ°å…¶ä¸­è·‘çš„æœ€å¿«çš„<strong>å‰äº”å</strong>ï¼Œæœ€å°‘éœ€è¦æ¯”èµ›å‡ æ¬¡å‘¢ï¼Ÿï¼ˆè¿™é‡Œæˆ‘æƒ³è¯´ä¸€ä¸‹ï¼Œæˆ‘çœ‹åˆ°<strong>ç½‘ä¸Šæœ‰ä¸å°‘åœ°æ–¹æŠŠè¿™ä¸ªé¢˜è®²é”™äº†</strong>ï¼Œæ‰€ä»¥ä¸ä¼šçš„åŒå­¦å»ºè®®è¿˜æ˜¯è®¤çœŸçœ‹ä¸€çœ‹ï¼‰</p>
<blockquote>
<p>åœ¨ä¸Šé¢çš„çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å·²ç»æ˜ç¡®äº†ç¬¬ä¸€åã€‚<strong>ä½†æ˜¯ç¬¬äºŒåå’Œç¬¬ä¸‰åï¼Œæ˜¯å¯ä»¥åœ¨A2-A3-B1-B2-C1ä¸­äº§ç”Ÿçš„</strong>ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«è¿›è¡Œè®¨è®ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/80.png" alt></p>
<ul>
<li>å‡è‹¥äºŒä¸‰ååˆ†åˆ«ä¸ºï¼šA2ï¼ŒA3</li>
</ul>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œ<strong>ç¬¬å››åå¯èƒ½æ˜¯A4</strong>ï¼Œæ­¤æ—¶ç¬¬äº”åæ˜¯A5æˆ–è€…B1ã€‚<strong>ç¬¬å››åä¹Ÿå¯èƒ½æ˜¯B1</strong>ï¼Œæ­¤æ—¶ç¬¬äº”åæ˜¯B2æˆ–è€…C1ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©ï¼»A4ï¼ŒB1ï¼ŒA5ï¼ŒB2ï¼ŒC1ï¼½å‚åŠ ä¸€æ¬¡æ¯”èµ›ï¼Œå°±å¯ä»¥å¾—åˆ°å‰äº”åã€‚</p>
<ul>
<li>å‡è‹¥äºŒä¸‰ååˆ†åˆ«ä¸ºï¼šA2ï¼ŒB1</li>
</ul>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œç¬¬å››åå¯èƒ½æ˜¯A3ã€B2ã€C1ã€‚<strong>å‡è®¾ç¬¬4åä¸ºA3</strong>ï¼Œç¬¬5åå¯èƒ½ä¸ºA4ã€B2ã€C1ã€‚<strong>å‡è®¾ç¬¬4åä¸ºB2</strong>ï¼Œç¬¬5åå¯èƒ½ä¸ºA3ã€B3ã€C1ã€‚<strong>å‡è®¾ç¬¬4åä¸ºC1</strong>ï¼Œç¬¬5åå¯èƒ½ä¸ºA3ã€B2ã€C2ã€D1ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡³å°‘ä¸¤æ¬¡æ¯”èµ›ï¼Œæ‰èƒ½åœ¨ï¼»A3ï¼ŒA4ï¼ŒB2ï¼ŒB3ï¼ŒC1ï¼ŒC2ï¼ŒD1ï¼½ä¸­æ‰¾åˆ°ç¬¬å››åå’Œç¬¬äº”åï¼Œæ‰€ä»¥å°±éœ€è¦9æ¬¡ã€‚</p>
<p>å…¶ä»–çš„å¯èƒ½æ€§è¿˜æœ‰ï¼š</p>
<ul>
<li>å‡è‹¥äºŒä¸‰ååˆ†åˆ«ä¸ºï¼šB1ï¼ŒA2</li>
<li>å‡è‹¥äºŒä¸‰ååˆ†åˆ«ä¸ºï¼šB1ï¼ŒB2</li>
<li>å‡è‹¥äºŒä¸‰ååˆ†åˆ«ä¸ºï¼šB1ï¼ŒC1</li>
</ul>
<p>ä¸Šé¢è¿™ä¸‰ç§æƒ…å†µåˆ†æçš„æ–¹æ³•ä¸€è‡´ï¼Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼Œå¤§æ¦‚çš„æ€è·¯å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦<strong>æ ¹æ®ç¬¬ä¸‰åï¼Œåˆ†æå‡ºå¯èƒ½çš„ç¬¬å››å</strong>ã€‚<strong>å†æ ¹æ®ç¬¬å››åï¼Œåˆ†æå‡ºå¯¹åº”æƒ…å†µä¸‹çš„ç¬¬äº”å</strong>ã€‚æœ€ç»ˆå†åœ¨è¿™äº›é©¬åŒ¹é‡Œï¼ŒæŠ‰æ‹©å‡ºçœŸæ­£çš„ç¬¬å››åå’Œç¬¬äº”åã€‚</p>
<p>å› ä¸ºé¢˜ä¸­é—®çš„æ˜¯<strong>æœ€å°‘æ¯”å¤šå°‘åœºå¯ä»¥è·‘å‡ºå‰äº”å</strong>ã€‚æ‰€ä»¥æ ¹æ®åˆ†æï¼Œå‡å¦‚<strong>ç¬¬äºŒåå’Œç¬¬ä¸‰åæ˜¯A2å’ŒA3çš„è¯ï¼Œåªéœ€è¦8æ¬¡å°±å¯ä»¥è·‘å‡ºå‰äº”å</strong>ã€‚æœ€å°‘æ¬¡æ•°æ˜¯8ã€‚ï¼ˆè¿™ä¸ªé¢˜ç›®å…¶å®æ˜¯ä¸ä¸¥è°¨çš„ï¼Œæ‰€ä»¥å¦‚æœæœ‰é¢è¯•å®˜é—®åˆ°è¿™ä¸ªé¢˜ï¼Œæœ€å¥½æ˜¯ç»™å‡ºæ‰€æœ‰å¯èƒ½æ€§çš„æ¨å¯¼è¿‡ç¨‹ï¼‰</p>
</blockquote>
<h3 id="8-ç¯æ³¡å¼€å…³"><a href="#8-ç¯æ³¡å¼€å…³" class="headerlink" title="8.ç¯æ³¡å¼€å…³"></a>8.ç¯æ³¡å¼€å…³</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬319é¢˜ï¼šå¼€å…³ç¯æ³¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆå§‹æ—¶æœ‰ n ä¸ªç¯æ³¡å…³é—­ã€‚ç¬¬ 1 è½®ï¼Œä½ æ‰“å¼€æ‰€æœ‰çš„ç¯æ³¡ã€‚ç¬¬ 2 è½®ï¼Œæ¯ä¸¤ä¸ªç¯æ³¡å…³é—­ä¸€æ¬¡ã€‚ç¬¬ 3  è½®ï¼Œæ¯ä¸‰ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ï¼ˆå¦‚æœå…³é—­åˆ™å¼€å¯ï¼Œå¦‚æœå¼€å¯åˆ™å…³é—­ï¼‰ã€‚ç¬¬ i è½®ï¼Œæ¯ i ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ã€‚å¯¹äºç¬¬ n  è½®ï¼Œä½ åªåˆ‡æ¢æœ€åä¸€ä¸ªç¯æ³¡çš„å¼€å…³ã€‚æ‰¾å‡º n è½®åæœ‰å¤šå°‘ä¸ªäº®ç€çš„ç¯æ³¡ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 3</span><br><span class="line">è¾“å‡º: 1 </span><br><span class="line">è§£é‡Š: </span><br><span class="line">åˆå§‹æ—¶, ç¯æ³¡çŠ¶æ€ [å…³é—­, å…³é—­, å…³é—­].</span><br><span class="line">ç¬¬ä¸€è½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å¼€å¯, å¼€å¯].</span><br><span class="line">ç¬¬äºŒè½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å…³é—­, å¼€å¯].</span><br><span class="line">ç¬¬ä¸‰è½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å…³é—­, å…³é—­]. </span><br><span class="line"></span><br><span class="line">ä½ åº”è¯¥è¿”å› 1ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªç¯æ³¡è¿˜äº®ç€ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ˜¯ä¸€é“éš¾åº¦è¯„å®šä¸º<strong>å›°éš¾</strong>çš„é¢˜ç›®ã€‚ä½†æ˜¯ï¼Œå…¶å®è¿™å¹¶ä¸æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªè„‘ç­‹æ€¥è½¬å¼¯ã€‚åªè¦æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹å¼€å…³ç¯æ³¡çš„è¿‡ç¨‹ï¼Œå¤§å®¶å°±ä¼šç¬é—´getï¼Œä¸€èµ·æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹nä»1åˆ°12çš„è¿‡ç¨‹ã€‚åœ¨ç¬¬ä¸€è½®ï¼Œä½ æ‰“å¼€äº†12ä¸ªç¯æ³¡ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/81.png" alt></p>
<p>å› ä¸ºå¯¹äºå¤§äºnçš„ç¯æ³¡ä½ æ˜¯ä¸careçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨é»‘æ¡†æ¡†è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/82.png" alt></p>
<p>ç„¶åæˆ‘ä»¬åˆ—å‡ºnä»1-12çš„è¿‡ç¨‹ä¸­æ‰€æœ‰çš„ç¯æ³¡ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/83.png" alt></p>
<p>å¯ä»¥å¾—åˆ°å¦‚ä¸‹è¡¨æ ¼ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/84.png" alt></p>
<p>è§‚å¯Ÿä¸€ä¸‹ï¼Œè¿™æ˜¯ä»€ä¹ˆï¼Ÿè§‚å¯Ÿä¸å‡ºæ¥ï¼Œå’±ä»¬çœ‹çœ‹è¿™ä¸ªï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> n := <span class="number">1</span>; n &lt;= <span class="number">12</span>; n++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;n=&quot;</span>, n, <span class="string">&quot;\tç¯æ³¡æ•°\t&quot;</span>, math.Sqrt(<span class="keyword">float64</span>(n)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//print</span></span><br><span class="line">n= <span class="number">1</span>     ç¯æ³¡æ•°  <span class="number">1</span></span><br><span class="line">n= <span class="number">2</span>     ç¯æ³¡æ•°  <span class="number">1.4142135623730951</span></span><br><span class="line">n= <span class="number">3</span>     ç¯æ³¡æ•°  <span class="number">1.7320508075688772</span></span><br><span class="line">n= <span class="number">4</span>     ç¯æ³¡æ•°  <span class="number">2</span></span><br><span class="line">n= <span class="number">5</span>     ç¯æ³¡æ•°  <span class="number">2.23606797749979</span></span><br><span class="line">n= <span class="number">6</span>     ç¯æ³¡æ•°  <span class="number">2.449489742783178</span></span><br><span class="line">n= <span class="number">7</span>     ç¯æ³¡æ•°  <span class="number">2.6457513110645907</span></span><br><span class="line">n= <span class="number">8</span>     ç¯æ³¡æ•°  <span class="number">2.8284271247461903</span></span><br><span class="line">n= <span class="number">9</span>     ç¯æ³¡æ•°  <span class="number">3</span></span><br><span class="line">n= <span class="number">10</span>     ç¯æ³¡æ•°  <span class="number">3.1622776601683795</span></span><br><span class="line">n= <span class="number">11</span>     ç¯æ³¡æ•°  <span class="number">3.3166247903554</span></span><br><span class="line">n= <span class="number">12</span>     ç¯æ³¡æ•°  <span class="number">3.4641016151377544</span></span><br></pre></td></tr></table></figure>
<p>æ²¡é”™ï¼Œåªè¦æˆ‘ä»¬å¯¹nè¿›è¡Œå¼€æ–¹ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ç»ˆçš„ç¯æ³¡æ•°ã€‚æ ¹æ®åˆ†æï¼Œå¾—å‡ºä»£ç ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bulbSwitch</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(sqrt(n))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†60.08% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†7.43% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bulbSwitch</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) Math.sqrt(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†71.93% çš„ç”¨æˆ·</p>
<blockquote>
<p>è¯æ˜å¦‚ä¸‹ï¼š</p>
<p>çº¦æ•°ï¼Œåˆç§°å› æ•°ã€‚æ•´æ•°aé™¤ä»¥æ•´æ•°b(bâ‰ 0) é™¤å¾—çš„å•†æ­£å¥½æ˜¯æ•´æ•°è€Œæ²¡æœ‰ä½™æ•°ï¼Œæˆ‘ä»¬å°±è¯´aèƒ½è¢«bæ•´é™¤ï¼Œæˆ–bèƒ½æ•´é™¤aã€‚aç§°ä¸ºbçš„å€æ•°ï¼Œbç§°ä¸ºaçš„çº¦æ•°ã€‚</p>
<p>ä»æˆ‘ä»¬è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œå¦‚æœä¸€ä¸ªç¯æ³¡æœ‰å¥‡æ•°ä¸ªçº¦æ•°ï¼Œé‚£ä¹ˆæœ€åè¿™ä¸ªç¯æ³¡ä¸€å®šä¼šäº®ç€ã€‚</p>
<p>ä»€ä¹ˆï¼Œä½ é—®æˆ‘å¥‡æ•°æ˜¯ä»€ä¹ˆï¼Ÿå¥‡æ•°ï¼ˆoddï¼‰æŒ‡ä¸èƒ½è¢«2æ•´é™¤çš„æ•´æ•° ï¼Œæ•°å­¦è¡¨è¾¾å½¢å¼ä¸ºï¼š2k+1ï¼Œ å¥‡æ•°å¯ä»¥åˆ†ä¸ºæ­£å¥‡æ•°å’Œè´Ÿå¥‡æ•°ã€‚</p>
<p>æ‰€ä»¥å…¶å®æˆ‘ä»¬æ˜¯æ±‚ï¼Œ<strong>ä»1-næœ‰å¤šå°‘ä¸ªæ•°çš„çº¦æ•°æœ‰å¥‡æ•°ä¸ª</strong>ã€‚è€Œ<strong>æœ‰å¥‡æ•°ä¸ªçº¦æ•°çš„æ•°ä¸€å®šæ˜¯å®Œå…¨å¹³æ–¹æ•°ã€‚</strong> è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºæ•°nï¼Œå¦‚æœmæ˜¯å®ƒçš„çº¦æ•°ï¼Œåˆ™n/mä¹Ÿæ˜¯å®ƒçš„çº¦æ•°ï¼Œè‹¥mâ‰ n/mï¼Œåˆ™å®ƒçš„çº¦æ•°æ˜¯ä»¥mã€n/mçš„å½¢å¼æˆå¯¹å‡ºç°çš„ã€‚è€Œmï¼n/mæˆç«‹ä¸”n/mæ˜¯æ­£æ•´æ•°æ—¶ï¼Œnæ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œè€Œå®ƒæœ‰å¥‡æ•°ä¸ªçº¦æ•°ã€‚</p>
<p>æˆ‘ä»¬å†æ¬¡è½¬åŒ–é—®é¢˜ï¼Œ<strong>æ±‚1-næœ‰å¤šå°‘ä¸ªæ•°æ˜¯å®Œå…¨å¹³æ–¹æ•°</strong>ã€‚</p>
<p>ä»€ä¹ˆï¼Œä½ åˆä¸çŸ¥é“ä»€ä¹ˆæ˜¯å®Œå…¨å¹³æ–¹æ•°äº†ï¼Ÿå®Œå…¨å¹³æ–¹æŒ‡ç”¨ä¸€ä¸ªæ•´æ•°ä¹˜ä»¥è‡ªå·±ä¾‹å¦‚1Ã—1ï¼Œ2Ã—2ï¼Œ3Ã—3ç­‰ï¼Œä¾æ­¤ç±»æ¨ã€‚è‹¥ä¸€ä¸ªæ•°èƒ½è¡¨ç¤ºæˆæŸä¸ªæ•´æ•°çš„å¹³æ–¹çš„å½¢å¼ï¼Œ<strong>åˆ™ç§°è¿™ä¸ªæ•°ä¸ºå®Œå…¨å¹³æ–¹æ•°</strong>ã€‚</p>
<p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬å°±å¾ˆæ˜æœ—äº†ã€‚å‰©ä¸‹çš„ï¼Œæˆ‘æƒ³ä¸éœ€è¦å†è¯´äº†å§ï¼</p>
</blockquote>
<h3 id="9-ä¸‰é—¨é—®é¢˜"><a href="#9-ä¸‰é—¨é—®é¢˜" class="headerlink" title="9.ä¸‰é—¨é—®é¢˜"></a>9.ä¸‰é—¨é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ä¸‰é—¨é—®é¢˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‚èµ›è€…çš„é¢å‰æœ‰ä¸‰æ‰‡å…³é—­ç€çš„é—¨ï¼Œå…¶ä¸­ä¸€æ‰‡çš„åé¢æ˜¯å¤©ä½¿ï¼Œé€‰ä¸­åå¤©ä½¿ä¼šè¾¾æˆä½ çš„ä¸€ä¸ªæ„¿æœ›ï¼Œè€Œå¦å¤–ä¸¤æ‰‡é—¨åé¢åˆ™æ˜¯æ¶é­”ï¼Œé€‰ä¸­å°±ä¼šæ­»äº¡ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å½“ä½ é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä½†æœªå»å¼€å¯å®ƒçš„æ—¶å€™ï¼Œä¸Šå¸ä¼šå¼€å¯å‰©ä¸‹ä¸¤æ‰‡é—¨ä¸­çš„ä¸€æ‰‡ï¼Œéœ²å‡ºå…¶ä¸­ä¸€åªæ¶é­”ã€‚ï¼ˆä¸Šå¸æ˜¯å…¨èƒ½çš„ï¼Œå¿…ä¼šæ‰“å¼€æ¶é­”é—¨ï¼‰éšåä¸Šå¸ä¼šé—®ä½ è¦ä¸è¦æ›´æ¢é€‰æ‹©ï¼Œé€‰å¦ä¸€æ‰‡ä»ç„¶å…³ç€çš„é—¨ã€‚</p>
<blockquote>
<p>æŒ‰ç…§å¸¸ç†ï¼Œå‚èµ›è€…åœ¨åšå‡ºæœ€å¼€å§‹çš„å†³å®šæ—¶ï¼Œå¯¹ä¸‰æ‰‡é—¨åé¢çš„äº‹æƒ…ä¸€æ— æ‰€çŸ¥ï¼Œå› æ­¤ä»–é€‰æ‹©æ­£ç¡®çš„æ¦‚ç‡æ˜¯1/3ï¼Œè¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½å¯ä»¥æƒ³åˆ°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸»æŒäººæ’é™¤æ‰äº†ä¸€ä¸ªé”™è¯¯ç­”æ¡ˆï¼ˆæœ‰æ¶é­”çš„é—¨ï¼‰ï¼Œäºæ˜¯å‰©ä¸‹çš„ä¸¤æ‰‡é—¨å¿…ç„¶æ˜¯ä¸€æ‰‡æ˜¯å¤©ä½¿ï¼Œä¸€æ‰‡æ˜¯æ¶é­”ï¼Œé‚£ä¹ˆæ­¤æ—¶æ— è®ºé€‰æ‹©å“ªä¸€æ‰‡é—¨ï¼Œèƒœç‡éƒ½æ˜¯1/2ï¼Œä¾ç„¶åˆä¹ç›´è§‰ã€‚</p>
<p>æ‰€ä»¥ä½ ä½œä¸ºå‚èµ›è€…ï¼Œä½ ä¼šè®¤ä¸ºæ¢ä¸æ¢éƒ½æ— å¿…è¦ï¼Œè·èƒœæ¦‚ç‡å‡ä¸º1/2ã€‚ä½†æ˜¯ï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</p>
<p>æ­£ç¡®çš„ç­”æ¡ˆæ˜¯ï¼Œ<strong>å¦‚æœä½ é€‰æ‹©äº†æ¢ï¼Œç¢°è§å¤©ä½¿çš„æ¦‚ç‡ä¼šé«˜è¾¾2/3ï¼Œè€Œä¸ä¸æ¢çš„è¯ï¼Œç¢°è§å¤©ä½¿çš„æ¦‚ç‡åªæœ‰1/3ã€‚</strong> æ€ä¹ˆæ¥çš„ï¼Ÿ</p>
<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå¾ˆé€šä¿—çš„æ–¹æ³•ï¼Œèƒ½è®©ä½ ä¸€å¬å°±æ‡‚ã€‚é¦–å…ˆåˆšå¼€å§‹é€‰æ‹©çš„ä¸€æ‰‡é—¨çš„æ¦‚ç‡ä¸º1/3ï¼Œè€Œå¦å¤–ä¸¤æ‰‡é—¨çš„æ€»æ¦‚ç‡ä¸º2/3ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/85.png" alt><br>ç°åœ¨ä¸Šå¸æ‰“å¼€äº†å…¶ä¸­ä¸€æ‰‡ä¸ºæ¶é­”çš„é—¨ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªé—¨åé¢ä¸ä¼šå†æœ‰å¤©ä½¿ï¼Œæ‰€ä»¥ç›¸å½“äºè¿™éƒ¨åˆ†æ¦‚ç‡è¢«ç¬¬ä¸‰ä¸ªé—¨æŒæœ‰ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/86.png" alt><br>å‰©ä¸‹çš„é‚£æ‰‡é—¨çš„æ¦‚ç‡ï¼ˆ2/3ï¼‰ç›¸å½“äºåˆšå¼€å§‹é€‰æ‹©çš„é—¨ï¼ˆ1/3ï¼‰çš„äºŒå€ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—æ¢ã€‚</p>
<p>å¦‚æœè¿˜æ²¡æœ‰å¬æ‡‚ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾æœ‰ä¸€ç™¾æ‰‡é—¨ï¼Œé‡Œè¾¹æœ‰99åªéƒ½æ˜¯æ¶é­”ã€‚ç°åœ¨ä½ éšæœºé€‰æ‹©ä¸€æ‰‡é—¨ï¼Œé€‰æ‹©åˆ°å¤©ä½¿çš„æ¦‚ç‡æ˜¯1/100ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/87.jpeg" alt><br>è¿™æ—¶ï¼Œä¸Šå¸æ‰“å¼€å…¶ä¸­çš„98æ‰‡ï¼Œé‡Œè¾¹éƒ½æ˜¯æ¶é­”ã€‚è¿™æ—¶å€™å°±ç›¸å½“äº99/100çš„æ¦‚ç‡éƒ½é›†ä¸­åœ¨äº†å¦ä¸€æ‰‡é—¨é‡Œã€‚è‡ªç„¶ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æ¢</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/88.jpeg" alt></p>
</blockquote>
<p><strong>ä»£ç è¯æ˜</strong><br>ä¸ºäº†éªŒè¯ç»“æœï¼Œæˆ‘ç”¨ä»£ç è·‘äº†ä¸€ç™¾ä¸‡æ¬¡ã€‚<br><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="comment">//æ¢é—¨é‡è§å¤©ä½¿çš„æ¬¡æ•°å’Œä¸æ¢é—¨é‡è§å¤©ä½¿çš„æ¬¡æ•°     changeAngelCount, unchangeAngelCount := 0, 0     for i := 0; i &lt; 1000000; i++ &#123; </span></span><br><span class="line">        <span class="comment">//é—¨çš„æ€»æ•° </span></span><br><span class="line">        doors := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125; </span><br><span class="line">        <span class="comment">//å¤©ä½¿é—¨å’Œé€‰ä¸­çš„é—¨         angelDoor, selectedDoor := rand.Intn(3), rand.Intn(3) </span></span><br><span class="line">        <span class="comment">//ä¸Šå¸ç§»é™¤ä¸€æ‰‡æ¶é­”é—¨</span></span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="built_in">len</span>(doors); j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> doors[j] != selectedDoor &amp;&amp; doors[j] != angelDoor &#123;</span><br><span class="line">                doors = <span class="built_in">append</span>(doors[:j], doors[j+<span class="number">1</span>:]...)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡        </span></span><br><span class="line">        <span class="keyword">if</span> selectedDoor == angelDoor &#123;</span><br><span class="line">            unchangeAngelCount++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            changeAngelCount++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;ä¸æ¢é—¨é‡è§å¤©ä½¿æ¬¡æ•°:&quot;</span>, unchangeAngelCount, <span class="string">&quot;æ¯”ä¾‹ï¼š&quot;</span>, (<span class="keyword">float32</span>(unchangeAngelCount) / <span class="number">1000000</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;æ¢é—¨é‡è§å¤©ä½¿æ¬¡æ•°:&quot;</span>, changeAngelCount, <span class="string">&quot;æ¯”ä¾‹ï¼š&quot;</span>, (<span class="keyword">float32</span>(changeAngelCount) / <span class="number">1000000</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/89.png" alt></p>
<h3 id="10-çŒœæ•°å­—æ¸¸æˆ"><a href="#10-çŒœæ•°å­—æ¸¸æˆ" class="headerlink" title="10.çŒœæ•°å­—æ¸¸æˆ"></a>10.çŒœæ•°å­—æ¸¸æˆ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬299é¢˜ï¼šçŒœæ•°å­—ï¼ˆBulls and Cowsï¼‰æ¸¸æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ å†™ä¸‹ä¸€ä¸ªæ•°å­—è®©ä½ çš„æœ‹å‹çŒœã€‚æ¯æ¬¡ä»–çŒœæµ‹åï¼Œä½ ç»™ä»–ä¸€ä¸ªæç¤ºï¼Œå‘Šè¯‰ä»–æœ‰å¤šå°‘ä½æ•°å­—å’Œç¡®åˆ‡ä½ç½®éƒ½çŒœå¯¹äº†ï¼ˆç§°ä¸ºâ€œBullsâ€, å…¬ç‰›ï¼‰ï¼Œæœ‰å¤šå°‘ä½æ•°å­—çŒœå¯¹äº†ä½†æ˜¯ä½ç½®ä¸å¯¹ï¼ˆç§°ä¸ºâ€œCowsâ€, å¥¶ç‰›ï¼‰ã€‚ä½ çš„æœ‹å‹å°†ä¼šæ ¹æ®æç¤ºç»§ç»­çŒœï¼Œç›´åˆ°çŒœå‡ºç§˜å¯†æ•°å­—ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>è¯·å†™å‡ºä¸€ä¸ªæ ¹æ®ç§˜å¯†æ•°å­—å’Œæœ‹å‹çš„çŒœæµ‹æ•°è¿”å›æç¤ºçš„å‡½æ•°ï¼Œç”¨ A è¡¨ç¤ºå…¬ç‰›ï¼Œç”¨ B è¡¨ç¤ºå¥¶ç‰›ã€‚</p>
<p>è¯·æ³¨æ„ç§˜å¯†æ•°å­—å’Œæœ‹å‹çš„çŒœæµ‹æ•°éƒ½å¯èƒ½å«æœ‰é‡å¤æ•°å­—ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: secret = &quot;1807&quot;, guess = &quot;7810&quot;</span><br><span class="line">è¾“å‡º: &quot;1A3B&quot;</span><br><span class="line">è§£é‡Š: 1 å…¬ç‰›å’Œ 3 å¥¶ç‰›ã€‚å…¬ç‰›æ˜¯ 8ï¼Œå¥¶ç‰›æ˜¯ 0, 1 å’Œ 7ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: secret = &quot;1123&quot;, guess = &quot;0111&quot;</span><br><span class="line">è¾“å‡º: &quot;1A1B&quot;</span><br><span class="line">è§£é‡Š: æœ‹å‹çŒœæµ‹æ•°ä¸­çš„ç¬¬ä¸€ä¸ª 1 æ˜¯å…¬ç‰›ï¼Œç¬¬äºŒä¸ªæˆ–ç¬¬ä¸‰ä¸ª 1 å¯è¢«è§†ä¸ºå¥¶ç‰›ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜:</strong> ä½ å¯ä»¥å‡è®¾ç§˜å¯†æ•°å­—å’Œæœ‹å‹çš„çŒœæµ‹æ•°éƒ½åªåŒ…å«æ•°å­—ï¼Œå¹¶ä¸”å®ƒä»¬çš„é•¿åº¦æ°¸è¿œç›¸ç­‰ã€‚</p>
<blockquote>
<p>åŸºæœ¬æ‹¿åˆ°é¢˜ç›®ï¼Œæˆ‘ä»¬å°±èƒ½æƒ³åˆ°å¯ä»¥ä½¿ç”¨hashmapè¿›è¡Œæ±‚è§£ï¼Œä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<ul>
<li>å› ä¸ºsecretæ•°å­—å’Œguessæ•°å­—é•¿åº¦ç›¸ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éå†secretæ•°å­—ã€‚</li>
<li>å¦‚æœå½“å‰ç´¢å¼•ä¸¤ä¸ªæ•°å­—ç›¸åŒï¼Œå°±å°†å…¬ç‰›æ•°åŠ 1ã€‚</li>
<li><strong>å¦‚æœä¸ç›¸åŒï¼Œæˆ‘ä»¬å°†secretå’Œguesså½“å‰ç´¢å¼•ä½ç½®å¤„çš„æ•°å­—é€šè¿‡mapè®°å½•ä¸‹æ¥ï¼Œç»Ÿè®¡ä»–ä»¬å‡ºç°çš„æ¬¡æ•°ã€‚å½“ç„¶ï¼Œä¹‹å‰æˆ‘ä»¬è®²è¿‡ã€‚æœ‰é™çš„mapï¼Œæ¯”å¦‚æ•°å­— 0-10ï¼Œå­—æ¯ a-zï¼Œéƒ½å¯ä»¥é€šè¿‡æ•°ç»„</strong>æ¥è¿›è¡Œæ›¿æ¢ï¼Œç”¨ä»¥å‹ç¼©ç©ºé—´ã€‚</li>
<li>æœ€åï¼Œå¦‚æœè®°å½•çš„ä¸¤ä¸ªmapä¸­ï¼Œ<strong>æ•°å­—å‡ºç°é‡å </strong>ï¼ˆå¯ä»¥é€šè¿‡æœ€å°å€¼æ¥åˆ¤æ–­ï¼‰ï¼Œåˆ™æ„å‘³ç€è¯¥æ•°å­—åœ¨ä¸¤è¾¹éƒ½å‡ºç°è¿‡ï¼Œå°±å°†æ¯ç‰›æ•°åŠ ä¸€</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getHint</span>(<span class="params">self, secret: <span class="built_in">str</span>, guess: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        mapS, mapG = &#123;&#125;, &#123;&#125;</span><br><span class="line">        a, b = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(secret)):</span><br><span class="line">            <span class="keyword">if</span> secret[i] == guess[i]:</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> secret[i] <span class="keyword">not</span> <span class="keyword">in</span> mapS:</span><br><span class="line">                    mapS[secret[i]] = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    mapS[secret[i]] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> guess[i] <span class="keyword">not</span> <span class="keyword">in</span> mapG:</span><br><span class="line">                    mapG[guess[i]] = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    mapG[guess[i]] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> mapS.keys():</span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> mapG:</span><br><span class="line">                b += <span class="built_in">min</span>(mapS[key], mapG[key])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(a)+<span class="string">&#x27;A&#x27;</span>+<span class="built_in">str</span>(b)+<span class="string">&#x27;B&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†88.82% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†16.77% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHint</span><span class="params">(String secret, String guess)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] mapS = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">int</span>[] mapG = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; secret.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(secret.charAt(i) == guess.charAt(i)) a++;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                mapS[secret.charAt(i) - <span class="string">&#x27;0&#x27;</span>]++;</span><br><span class="line">                mapG[guess.charAt(i) - <span class="string">&#x27;0&#x27;</span>]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            b += Math.min(mapS[i], mapG[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a + <span class="string">&quot;A&quot;</span> + b + <span class="string">&quot;B&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š8 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†34.92% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†41.70% çš„ç”¨æˆ·</p>
<h3 id="11-LRUç¼“å­˜æœºåˆ¶"><a href="#11-LRUç¼“å­˜æœºåˆ¶" class="headerlink" title="11.LRUç¼“å­˜æœºåˆ¶"></a>11.LRUç¼“å­˜æœºåˆ¶</h3><blockquote>
<p>LRU æ˜¯ Least Recently Used çš„ç¼©å†™ï¼Œè¯‘ä¸ºæœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚å®ƒçš„ç†è®ºåŸºç¡€ä¸ºâ€œ<strong>æœ€è¿‘ä½¿ç”¨çš„æ•°æ®ä¼šåœ¨æœªæ¥ä¸€æ®µæ—¶æœŸå†…ä»ç„¶è¢«ä½¿ç”¨ï¼Œå·²ç»å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„æ•°æ®å¤§æ¦‚ç‡åœ¨æœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»ç„¶ä¸ä¼šè¢«ä½¿ç”¨</strong>â€ç”±äºè¯¥æ€æƒ³éå¸¸å¥‘åˆä¸šåŠ¡åœºæ™¯ ï¼Œå¹¶ä¸”å¯ä»¥è§£å†³å¾ˆå¤šå®é™…å¼€å‘ä¸­çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸é€šè¿‡ LRU çš„æ€æƒ³æ¥ä½œç¼“å­˜ï¼Œä¸€èˆ¬ä¹Ÿå°†å…¶ç§°ä¸º<strong>LRUç¼“å­˜æœºåˆ¶</strong>ã€‚</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬146é¢˜ï¼šLRUç¼“å­˜æœºåˆ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼šè·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å›  -1 ã€‚</p>
<p>å†™å…¥æ•°æ® put(key, value) - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p>
<p>è¿›é˜¶:ä½ æ˜¯å¦å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œï¼Ÿ</p>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );</span><br><span class="line">cache.put(1, 1);</span><br><span class="line">cache.put(2, 2);</span><br><span class="line">cache.get(1);       // è¿”å›  1</span><br><span class="line">cache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ</span><br><span class="line">cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">cache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ</span><br><span class="line">cache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">cache.get(3);       // è¿”å›  3</span><br><span class="line">cache.get(4);       // è¿”å›  4</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span></span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># æœç´¢ä¸åˆ°è¿”å›-1</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.cache:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="comment"># å–å‡ºç¼“å­˜ä¸­çš„keyå¹¶èµ‹å€¼,ä½¿æœ€è¿‘è¢«ä½¿ç”¨çš„æ’åœ¨æœ€åé¢</span></span><br><span class="line">        self.cache[key] = self.cache.pop(key)</span><br><span class="line">        <span class="keyword">return</span> self.cache[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚å­˜åœ¨å°±å…ˆåˆ é™¤key</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:</span><br><span class="line">            self.cache.pop(key)</span><br><span class="line">        <span class="comment"># å…ˆæ”¾ã€Œå¯†é’¥/æ•°æ®å€¼ã€ï¼Œä¹‹åå†åˆ¤æ–­æ˜¯å¦è¾¾åˆ°ä¸Šé™</span></span><br><span class="line">        self.cache[key] = value</span><br><span class="line">        <span class="comment">#  è‹¥è¶…å‡ºå®¹é‡åˆ™å–æœ€å‰é¢çš„åˆ é™¤ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.cache) &gt; self.capacity:</span><br><span class="line">            x = <span class="built_in">list</span>(self.cache)[<span class="number">0</span>]</span><br><span class="line">            self.cache.pop(x)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:232 ms,å‡»è´¥äº†54.22% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:21.8 MB,å‡»è´¥äº†65.84% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!map.containsKey(key)) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> value = map.remove(key);</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(key)) map.remove(key);</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        <span class="keyword">if</span>(map.size() &gt; capacity) map.remove(map.keySet().iterator().next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š21 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†45.53% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š46.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†29.06% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šä¼˜åŒ–</strong></p>
<blockquote>
<p>pyçš„åŸç”Ÿ<code>dict</code>è‡ªå¸¦é“¾è¡¨ï¼Œå·²ç»å®ç°äº†<code>collections.OrderedDict</code>çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œç»§æ‰¿å°±å¥½ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>(<span class="params"><span class="built_in">dict</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span></span><br><span class="line">        self.c = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self[key] = self.pop(key)</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        key <span class="keyword">in</span> self <span class="keyword">and</span> self.pop(key)</span><br><span class="line">        self[key] = value</span><br><span class="line">        <span class="built_in">len</span>(self) &gt; self.c <span class="keyword">and</span> self.pop(<span class="built_in">next</span>(<span class="built_in">iter</span>(self)))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:164 ms,å‡»è´¥äº†99.39% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:21.8 MB,å‡»è´¥äº†67.73% çš„Python3ç”¨æˆ·</p>
<blockquote>
<p>Javaçš„<code>LinkedHashMap</code>å·²å®ç°<strong>removeEldestEntry()æ–¹æ³•</strong>ç”¨äºæ£€æŸ¥æ˜¯å¦åˆ é™¤æœ€æ—§çš„æ¡ç›®ï¼Œåªéœ€é‡å†™å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">Integer</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åŠ è½½å› å­ï¼Œä¸€èˆ¬æ˜¯ 0.75f</span></span><br><span class="line">        <span class="comment">// true: æ˜¯è®¿é—®çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯è°æœ€å…ˆè®¿é—®ï¼Œå°±æ’åœ¨ç¬¬ä¸€ä½  </span></span><br><span class="line">        <span class="comment">// false:å­˜æ”¾é¡ºåºï¼Œå°±æ˜¯ä½ put å…ƒç´ çš„æ—¶å€™çš„é¡ºåº  </span></span><br><span class="line">        <span class="keyword">super</span>(capacity, <span class="number">0.75F</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getOrDefault(key, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;Integer, Integer&gt; eldest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š20 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†56.47% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š46.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†46.56% çš„ç”¨æˆ·</p>
<h3 id="12-æœ€å°çš„kä¸ªæ•°"><a href="#12-æœ€å°çš„kä¸ªæ•°" class="headerlink" title="12.æœ€å°çš„kä¸ªæ•°"></a>12.æœ€å°çš„kä¸ªæ•°</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‰‘æŒ‡offerç¬¬40é¢˜ï¼šæœ€å°çš„kä¸ªæ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¾“å…¥æ•´æ•°æ•°ç»„ arr ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€å°çš„ k ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥4ã€5ã€1ã€6ã€2ã€7ã€3ã€8è¿™8ä¸ªæ•°å­—ï¼Œåˆ™æœ€å°çš„4ä¸ªæ•°å­—æ˜¯1ã€2ã€3ã€4ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr = [3,2,1], k = 2</span><br><span class="line">è¾“å‡ºï¼š[1,2] æˆ–è€… [2,1]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr = [0,1,2,1], k = 1</span><br><span class="line">è¾“å‡ºï¼š[0]</span><br></pre></td></tr></table></figure>
<p><strong>é™åˆ¶ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 &lt;= k &lt;= arr.length &lt;= 10000</span><br><span class="line">0 &lt;= arr[i] &lt;= 10000</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å †çš„ç‰¹æ€§æ˜¯<strong>çˆ¶èŠ‚ç‚¹çš„å€¼æ€»æ˜¯æ¯”å…¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼å¤§æˆ–å°</strong>ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹æ¯”å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼éƒ½è¦å¤§ï¼Œæˆ‘ä»¬å«åš<strong>å¤§é¡¶å †</strong>ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹æ¯”å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼éƒ½è¦å°ï¼Œæˆ‘ä»¬å«åš<strong>å°é¡¶å †</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯¹å †ä¸­çš„ç»“ç‚¹æŒ‰å±‚è¿›è¡Œç¼–å·ï¼Œå°†è¿™ç§é€»è¾‘ç»“æ„æ˜ å°„åˆ°æ•°ç»„ä¸­å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/90.png" alt><br>å¤§é¡¶å †ï¼Œæ»¡è¶³ä»¥ä¸‹å…¬å¼: arr[i] &gt;= arr[2i+1] &amp;&amp; arr[i] &gt;= arr[2i+2]</p>
<p>å°é¡¶å †ä¹Ÿä¸€æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/91.png" alt><br>å°é¡¶å †ï¼Œæ»¡è¶³ä»¥ä¸‹å…¬å¼:     arr[i] &lt;= arr[2i+1] &amp;&amp; arr[i] &lt;= arr[2i+2]</p>
<p>ä¸Šé¢æˆ‘ä»¬å­¦ä¹ äº†å¤§é¡¶å †ï¼Œç°åœ¨è€ƒè™‘å¦‚ä½•ç”¨å¤§æ ¹å †è¿›è¡Œæ±‚è§£ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤§å°ä¸ºkçš„å¤§é¡¶å †ã€‚å‡å¦‚æ•°ç»„ä¸º[4,5,1,6,2,7,3,8]ï¼Œk=4ã€‚å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/92.png" alt><br>æˆ‘æƒ³è‚¯å®šè¿™é‡Œæœ‰ä¸çŸ¥é“å¦‚ä½•å»ºå †çš„åŒå­¦ã€‚è®°ä½ï¼š<strong>å¯¹äºä¸€ä¸ªæ²¡æœ‰ç»´æŠ¤è¿‡çš„å †ï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¼€å§‹è¿›è¡Œè°ƒæ•´</strong>ã€‚è¿™ä¸ªä¸éœ€è¦æ­»è®°ç¡¬èƒŒï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå±‚å±‚è°ƒèŠ‚çš„è¿‡ç¨‹ã€‚</p>
<p>ä»æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è°ƒæ•´</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/93.png" alt><br>ç»§ç»­å‘ä¸Šè°ƒæ•´<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/94.png" alt><br>ç»§ç»­å‘ä¸Šè°ƒæ•´<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/95.png" alt><br>ç„¶åæˆ‘ä»¬ä»ä¸‹æ ‡ k ç»§ç»­å¼€å§‹ä¾æ¬¡éå†æ•°ç»„çš„å‰©ä½™å…ƒç´ ã€‚å¦‚æœå…ƒç´ å°äºå †é¡¶å…ƒç´ ï¼Œé‚£ä¹ˆå–å‡ºå †é¡¶å…ƒç´ ï¼Œå°†å½“å‰å…ƒç´ å…¥å †ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ ï¼Œå› ä¸º2å°äºå †é¡¶å…ƒç´ 6ï¼Œæ‰€ä»¥å°†2å…¥å †ã€‚æˆ‘ä»¬å‘ç°ç°åœ¨çš„å®Œå…¨äºŒå‰æ ‘ä¸æ»¡è¶³å¤§é¡¶å †ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡Œè°ƒæ•´ã€‚<br>è°ƒæ•´å‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/96.png" alt><br>è°ƒæ•´å<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/97.png" alt><br>ç»§ç»­é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä¾æ¬¡å°†7,3,8å…¥å †ã€‚è¿™é‡Œå› ä¸º7å’Œ8éƒ½å¤§äºå †é¡¶å…ƒç´ 5ï¼Œæ‰€ä»¥åªæœ‰3ä¼šå…¥å †ã€‚<br>è°ƒæ•´å‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/98.png" alt><br>è°ƒæ•´å<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/99.png" alt><br>æœ€åå¾—åˆ°çš„å †ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ç”±äºå †çš„å¤§å°æ˜¯ Kï¼Œæ‰€ä»¥è¿™é‡Œç©ºé—´å¤æ‚åº¦æ˜¯O(K)ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(NlogK)ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="comment"># æœ€å°çš„kä¸ªæ•° æœ€å¤§å †</span></span><br><span class="line">        <span class="comment"># æœ€å¤§å † é¡¶ç‚¹æœ€å¤§</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">maxHeapfy</span>(<span class="params">maxHeap, i, n</span>):</span></span><br><span class="line">            <span class="comment"># å·¦å³å­èŠ‚ç‚¹</span></span><br><span class="line">            left = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">            right = <span class="number">2</span> * i + <span class="number">2</span></span><br><span class="line">            <span class="comment"># å‡å®šå½“å‰èŠ‚ç‚¹æœ€å¤§</span></span><br><span class="line">            maxPoint = i</span><br><span class="line">            <span class="comment"># å’Œå½“å‰èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹æ¯”è¾ƒï¼Œå¦‚æœèŠ‚ç‚¹ä¸­æœ‰æ›´å¤§çš„æ•°ï¼Œé‚£ä¹ˆäº¤æ¢ï¼Œå¹¶ç»§ç»­å¯¹äº¤æ¢åçš„èŠ‚ç‚¹è¿›è¡Œç»´æŠ¤</span></span><br><span class="line">            <span class="keyword">if</span> left &lt; n <span class="keyword">and</span> maxHeap[left] &gt; maxHeap[maxPoint]:</span><br><span class="line">                maxPoint = left</span><br><span class="line">            <span class="keyword">if</span> right &lt; n <span class="keyword">and</span> maxHeap[right] &gt; maxHeap[maxPoint]:</span><br><span class="line">                maxPoint = right</span><br><span class="line">            <span class="comment"># å¦‚æœæœ€å¤§çš„æ•°ä¸æ˜¯èŠ‚ç‚¹içš„è¯ï¼Œé‚£ä¹ˆäº¤æ¢åï¼Œè°ƒæ•´èŠ‚ç‚¹içš„å­æ ‘ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> maxPoint != i:</span><br><span class="line">                maxHeap[i], maxHeap[maxPoint] = maxHeap[maxPoint], maxHeap[i]</span><br><span class="line">                maxHeapfy(maxHeap, maxPoint, n)</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ– å–å‰kä¸ªæ ‘ï¼Œç»„æˆæœ€å¤§å †</span></span><br><span class="line">        maxHeap = arr[:k]</span><br><span class="line">        <span class="comment"># å¯¹äºä¸€ä¸ªè¿˜æ²¡ç»´æŠ¤è¿‡çš„å †ï¼Œä»ä»–çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¼€å§‹è¿›è¡Œè°ƒæ•´ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k // <span class="number">2</span> - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            maxHeapfy(maxHeap, i, k)</span><br><span class="line">        <span class="comment"># ç»§ç»­è°ƒæ•´åé¢èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k, <span class="built_in">len</span>(arr)):</span><br><span class="line">            <span class="comment"># å¦‚æœå…ƒç´ å°äºå †é¡¶å…ƒç´ ï¼Œé‚£ä¹ˆå–å‡ºå †é¡¶å…ƒç´ ï¼Œå°†å½“å‰å…ƒç´ å…¥å †</span></span><br><span class="line">            <span class="keyword">if</span> arr[i] &lt; maxHeap[<span class="number">0</span>]:</span><br><span class="line">                maxHeap[<span class="number">0</span>] = arr[i]</span><br><span class="line">                maxHeapfy(maxHeap, <span class="number">0</span>, k)</span><br><span class="line">        <span class="comment"># æœ€åå¾—åˆ°çš„å †ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> maxHeap</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:136 ms,å‡»è´¥äº†26.01% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.5 MB,å‡»è´¥äº†57.67% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] getLeastNumbers(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[k];</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        System.arraycopy(arr, <span class="number">0</span>, res, <span class="number">0</span>, k);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š7 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†72.61% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†58.60% çš„ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] getLeastNumbers(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span> || arr.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// é»˜è®¤æ˜¯å°æ ¹å †ï¼Œå®ç°å¤§æ ¹å †éœ€è¦é‡å†™ä¸€ä¸‹æ¯”è¾ƒå™¨ã€‚</span></span><br><span class="line">        Queue&lt;Integer&gt; pq = <span class="keyword">new</span> PriorityQueue&lt;&gt;((v1, v2) -&gt; v2 - v1);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num: arr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pq.size() &lt; k) &#123;</span><br><span class="line">                pq.offer(num);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num &lt; pq.peek()) &#123;</span><br><span class="line">                pq.poll();</span><br><span class="line">                pq.offer(num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿”å›å †ä¸­çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[k];</span><br><span class="line">        <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: pq) &#123;</span><br><span class="line">            res[idx++] = num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š14 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†41.61% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†57.97% çš„ç”¨æˆ·</p>
<h3 id="13-ä¸åŒè·¯å¾„"><a href="#13-ä¸åŒè·¯å¾„" class="headerlink" title="13.ä¸åŒè·¯å¾„"></a>13.ä¸åŒè·¯å¾„</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬62é¢˜ï¼šä¸åŒè·¯å¾„</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ï¼Œèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼Œåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ã€‚        é—®ï¼šæ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/100.png" alt></p>
<p>ä¾‹å¦‚ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ª7 x 3 çš„ç½‘æ ¼ã€‚æœ‰å¤šå°‘å¯èƒ½çš„è·¯å¾„ï¼Ÿ</p>
<p><strong>è¯´æ˜ï¼š</strong>m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: m = 3, n = 2</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ 3 æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚</span><br><span class="line">\1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹</span><br><span class="line">\2. å‘å³ -&gt; å‘ä¸‹ -&gt; å‘å³</span><br><span class="line">\3. å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: m = 7, n = 3</span><br><span class="line">è¾“å‡º: 28</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é“é¢˜å±äºç›¸å½“æ ‡å‡†çš„åŠ¨æ€è§„åˆ’ï¼Œè™½ç„¶è¿˜æœ‰ä¸€äº›å…¬å¼æ³•ç­‰å…¶ä»–è§£æ³•ï¼Œä½†æ˜¯å¦‚æœé¢è¯•å®˜é—®åˆ°ï¼ŒåŸºæœ¬å°±æ˜¯æƒ³è€ƒå¯Ÿä½ çš„åŠ¨æ€è§„åˆ’ã€‚</p>
<p>å› ä¸ºæœ‰æ¨ªçºµåæ ‡ï¼Œæ˜æ˜¾å±äºäºŒç»´DPã€‚æˆ‘ä»¬å®šä¹‰<strong>DP[i][j]è¡¨ç¤ºåˆ°è¾¾iè¡Œjåˆ—çš„æœ€å¤šè·¯å¾„</strong>ã€‚åŒæ—¶ï¼Œå› ä¸ºç¬¬0è¡Œå’Œç¬¬0åˆ—éƒ½åªæœ‰ä¸€æ¡è·¯å¾„ï¼Œæ‰€ä»¥éœ€è¦åˆå§‹åŒ–ä¸º1ã€‚</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸€ç›®äº†ç„¶ï¼Œdp[i][j] = dp[i-1][j]  +dp[i][j-1]</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePaths</span>(<span class="params">self, m: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–ä¸º1ï¼Œå› ä¸ºç¬¬0è¡Œå’Œç¬¬0åˆ—ä¸º1</span></span><br><span class="line">        dp = [[ <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[-<span class="number">1</span>][-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†41.96% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†5.03% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span> || j==<span class="number">0</span>) dp[i][j] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†5.30% çš„ç”¨æˆ·</p>
<p><strong>ä¼˜åŒ–</strong></p>
<blockquote>
<p>ä¸Šé¢çš„ç­”æ¡ˆï¼Œå¦‚æœåœ¨é¢è¯•æ—¶ç»™å‡ºï¼Œå¯ä»¥ç»™åˆ°7åˆ†ï¼Œåé¢3åˆ†æ€ä¹ˆæ‹¿ï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥å­˜å‚¨å—ï¼Ÿä¸€èµ·çœ‹ä¸‹ï¼</p>
<p>æˆ‘ä»¬ä½¿ç”¨<strong>äºŒç»´æ•°ç»„</strong>è®°å½•çŠ¶æ€ã€‚ä½†æ˜¯è¿™é‡Œè§‚å¯Ÿä¸€ä¸‹ï¼Œæ¯ä¸€ä¸ªæ ¼å­å¯èƒ½çš„è·¯å¾„ï¼Œ<strong>éƒ½æ˜¯ç”±å·¦è¾¹çš„æ ¼å­å’Œä¸Šé¢çš„æ ¼å­çš„æ€»è·¯å¾„è®¡ç®—è€Œæ¥ï¼Œ å¯¹äºä¹‹å‰æ›´æ—©çš„æ•°æ®ï¼Œå…¶å®å·²ç»ç”¨ä¸åˆ°äº†</strong>ã€‚å¦‚è®¡ç®—ç¬¬ä¸‰è¡Œæ—¶ï¼Œå·²ç»ç”¨ä¸åˆ°ç¬¬ä¸€è¡Œçš„æ•°æ®äº†ã€‚</p>
<p>é‚£æˆ‘ä»¬åªè¦èƒ½å®šä¹‰ä¸€ä¸ªçŠ¶æ€ï¼ŒåŒæ—¶å¯ä»¥è¡¨ç¤ºå·¦è¾¹çš„æ ¼å­å’Œä¸Šé¢çš„æ ¼å­ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Ÿæ‰€ä»¥æˆ‘ä»¬å®šä¹‰çŠ¶æ€dp[j]ï¼Œç”¨æ¥è¡¨ç¤º<strong>å½“å‰è¡Œåˆ°è¾¾ç¬¬jåˆ—çš„æœ€å¤šè·¯å¾„</strong>ã€‚è¿™ä¸ªâ€œå½“å‰è¡Œâ€ä¸‰ä¸ªå­—å¾ˆé‡è¦ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®¡ç®—dp[3]ï¼Œå› ä¸ºè¿˜æ²¡æœ‰è®¡ç®—å‡ºï¼Œæ‰€ä»¥è¿™æ—¶dp[3]ä¿å­˜çš„å…¶å®æ˜¯4ï¼ˆä¸Šä¸€è¡Œçš„æ•°æ®ï¼‰ï¼Œè€Œdp[2]ç”±äºå·²ç»è®¡ç®—å‡ºäº†ï¼Œæ‰€ä»¥ä¿å­˜çš„æ˜¯6ï¼ˆå½“å‰è¡Œçš„æ•°æ®ï¼‰ã€‚ç†è§£äº†è¿™ä¸ªï¼Œå°±ç†è§£å¦‚ä½•å‹ç¼©çŠ¶æ€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/101.png" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePaths</span>(<span class="params">self, m: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        dp = [<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">                dp[j] = dp[j] + dp[j-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†67.50% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.6 MB,å‡»è´¥äº†8.16% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span> || j==<span class="number">0</span>) dp[j] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> dp[j] = dp[j-<span class="number">1</span>] + dp[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-ä¸åŒè·¯å¾„-éšœç¢ç‰©"><a href="#14-ä¸åŒè·¯å¾„-éšœç¢ç‰©" class="headerlink" title="14.ä¸åŒè·¯å¾„-éšœç¢ç‰©"></a>14.ä¸åŒè·¯å¾„-éšœç¢ç‰©</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬63é¢˜ï¼šä¸åŒè·¯å¾„ - éšœç¢ç‰©</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n  ç½‘æ ¼çš„å·¦ä¸Šè§’ï¼Œèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼Œåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ã€‚ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ      é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/102.png" alt></p>
<p>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</p>
<p><strong>è¯´æ˜ï¼š</strong> m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [0,0,0],</span><br><span class="line">  [0,1,0],</span><br><span class="line">  [0,0,0]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚</span><br><span class="line">ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š</span><br><span class="line">\1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹ -&gt; å‘ä¸‹</span><br><span class="line">\2. å‘ä¸‹ -&gt; å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯å®šä¹‰çŠ¶æ€ï¼Œ<strong>ç”¨DP[i][j]è¡¨ç¤ºåˆ°è¾¾iè¡Œjåˆ—çš„æœ€å¤šè·¯å¾„</strong>ã€‚åŒæ—¶ï¼Œå› ä¸ºç¬¬0è¡Œå’Œç¬¬0åˆ—éƒ½åªæœ‰ä¸€æ¡è·¯å¾„ï¼Œæ‰€ä»¥éœ€è¦åˆå§‹åŒ–ä¸º1ã€‚ä½†æœ‰ä¸€ç‚¹ä¸ä¸€æ ·çš„å°±æ˜¯ï¼š<strong>å¦‚æœåœ¨0è¡Œ0åˆ—ä¸­é‡åˆ°éšœç¢ç‰©ï¼Œåé¢çš„å°±éƒ½æ˜¯0ï¼Œæ„ä¸ºæ­¤è·¯ä¸é€š</strong>ã€‚</p>
<p>å®Œæˆäº†åˆå§‹åŒ–ï¼Œä¸‹é¢å°±æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚å’Œæ²¡æœ‰éšœç¢ç‰©çš„ç›¸æ¯”æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œä»ç„¶æ˜¯dp[i][j] = dp[i-1][j]+dp[i][j-1]ã€‚å”¯ä¸€éœ€è¦å¤„ç†çš„æ˜¯ï¼š<strong>å¦‚æœæ°å¥½[i][j]ä½ç½®ä¸Šæœ‰éšœç¢ç‰©ï¼Œåˆ™dp[i][j]ä¸º0</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePathsWithObstacles</span>(<span class="params">self, obstacleGrid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [[<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>]))] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(obstacleGrid))]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>])):</span><br><span class="line">            dp[<span class="number">0</span>][j] = <span class="number">0</span> <span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][j] == <span class="number">1</span> <span class="keyword">else</span> dp[<span class="number">0</span>][j-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(obstacleGrid)):</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">0</span> <span class="keyword">if</span> obstacleGrid[i][<span class="number">0</span>] == <span class="number">1</span> <span class="keyword">else</span> dp[i-<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(obstacleGrid)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>])):</span><br><span class="line">                dp[i][j] = <span class="number">0</span> <span class="keyword">if</span> obstacleGrid[i][j] == <span class="number">1</span> <span class="keyword">else</span> dp[i-<span class="number">1</span>][j]+dp[i][j-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[-<span class="number">1</span>][-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†73.20% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.7 MB,å‡»è´¥äº†5.03% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = obstacleGrid.length;</span><br><span class="line">        <span class="keyword">int</span> n = obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; m; row++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; n; col++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(row == <span class="number">0</span> &amp;&amp; col == <span class="number">0</span>) dp[row][col] = obstacleGrid[row][col] == <span class="number">1</span>? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(row == <span class="number">0</span>) dp[row][col] = obstacleGrid[row][col] == <span class="number">1</span>? <span class="number">0</span>: dp[row][col-<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(col == <span class="number">0</span>) dp[row][col] = obstacleGrid[row][col] == <span class="number">1</span>? <span class="number">0</span>: dp[row-<span class="number">1</span>][col];</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[row][col] = obstacleGrid[row][col] == <span class="number">1</span>? <span class="number">0</span>: dp[row-<span class="number">1</span>][col]+dp[row][col-<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†60.14% çš„ç”¨æˆ·</p>
<p><strong>ä¼˜åŒ–</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePathsWithObstacles</span>(<span class="params">self, obstacleGrid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        m, n = <span class="built_in">len</span>(obstacleGrid), <span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>]),</span><br><span class="line">        dp = [<span class="number">1</span>] + [<span class="number">0</span>] * (n-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">if</span> obstacleGrid[i][j]:</span><br><span class="line">                    dp[j] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">elif</span> j &gt; <span class="number">0</span>:</span><br><span class="line">                    dp[j] = dp[j] + dp[j - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†89.96% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.4 MB,å‡»è´¥äº†54.45% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = obstacleGrid.length;</span><br><span class="line">        <span class="keyword">int</span> n = obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; m; row++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; n; col++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(obstacleGrid[row][col] == <span class="number">1</span>) dp[col] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(col &gt; <span class="number">0</span>) dp[col] = dp[col-<span class="number">1</span>] + dp[col];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†52.90% çš„ç”¨æˆ·</p>
<h3 id="15-ç››æœ€å¤šæ°´çš„å®¹å™¨"><a href="#15-ç››æœ€å¤šæ°´çš„å®¹å™¨" class="headerlink" title="15.ç››æœ€å¤šæ°´çš„å®¹å™¨"></a>15.ç››æœ€å¤šæ°´çš„å®¹å™¨</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬11é¢˜ï¼šç››æœ€å¤šæ°´çš„å®¹å™¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™ä½  n ä¸ªéè´Ÿæ•´æ•° a1ï¼Œa2ï¼Œâ€¦ï¼Œanï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (i, ai) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ i çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (i, ai) å’Œ (i, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ï¼Œä¸” n çš„å€¼è‡³å°‘ä¸º 2ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/103.jpg" alt></p>
<p>å›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[1,8,6,2,5,4,8,3,7] </span><br><span class="line">è¾“å‡ºï¼š49</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§‚å¯Ÿå¯å¾—ï¼Œå‚ç›´çš„ä¸¤æ¡çº¿æ®µå°†ä¼šä¸åæ ‡è½´æ„æˆä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œè¾ƒçŸ­çº¿æ®µçš„é•¿åº¦å°†ä¼šä½œä¸ºçŸ©å½¢åŒºåŸŸçš„å®½åº¦ï¼Œä¸¤çº¿é—´è·å°†ä¼šä½œä¸ºçŸ©å½¢åŒºåŸŸçš„é•¿åº¦ï¼Œæˆ‘ä»¬æ±‚è§£å®¹çº³æ°´çš„æœ€å¤§å€¼ï¼Œå®ä¸ºæ‰¾åˆ°è¯¥çŸ©å½¢æœ€å¤§åŒ–çš„åŒºåŸŸé¢ç§¯ã€‚</p>
<p>é¦–å…ˆï¼Œæœ¬é¢˜è‡ªç„¶å¯ä»¥æš´åŠ›æ±‚è§£ï¼Œåªè¦<strong>æ‰¾åˆ°æ¯å¯¹å¯èƒ½å‡ºç°çš„çº¿æ®µç»„åˆï¼Œç„¶åæ‰¾å‡ºè¿™äº›æƒ…å†µä¸‹çš„æœ€å¤§é¢ç§¯</strong>ã€‚è¿™ç§è§£æ³•ç›´æ¥ç•¥è¿‡ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥ä¸‹å»è‡ªå·±å°è¯•ã€‚è¿™é“é¢˜æ¯”è¾ƒç»å…¸æ˜¯æ˜¯ä½¿ç”¨åŒæŒ‡é’ˆè¿›è¡Œæ±‚è§£ï¼Œå·²ç»ä¼šçš„æœ‹å‹ä¸å¦¨å¤ä¹ å¤ä¹ ã€‚</p>
<p>æˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸¤è¾¹ï¼Œæ„æˆæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªçŸ©å½¢åŒºåŸŸã€‚</p>
<p>æ ¹æ®æœ¨æ¡¶åŸç†ï¼Œæ°´çš„é«˜åº¦å–å†³äºçŸ­çš„ä¸€ä¾§ã€‚æˆ‘ä»¬æ€»æ˜¯<strong>é€‰æ‹©å°†çŸ­çš„ä¸€ä¾§å‘é•¿çš„ä¸€ä¾§ç§»åŠ¨</strong>ã€‚å¹¶ä¸”åœ¨æ¯ä¸€æ¬¡çš„ç§»åŠ¨ä¸­ï¼Œæˆ‘ä»¬è®°å½•ä¸‹æ¥å½“å‰é¢ç§¯å¤§å°ã€‚</p>
<p>ä¸€ç›´åˆ°ä¸¤ä¸ªæ£’å­æ’åœ¨ä¸€èµ·ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxArea</span>(<span class="params">self, height: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="built_in">len</span>(height) - <span class="number">1</span></span><br><span class="line">        maxArea = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            <span class="keyword">if</span> height[left] &lt; height[right]:</span><br><span class="line">                maxArea = <span class="built_in">max</span>(maxArea, height[left] * (right - left))</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                maxArea = <span class="built_in">max</span>(maxArea, height[right] * (right - left))</span><br><span class="line">                right -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> maxArea</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:64 ms,å‡»è´¥äº†90.74% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†38.00% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = height.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> maxArea = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">            <span class="keyword">if</span>(height[left] &lt; height[right])&#123;</span><br><span class="line">                maxArea = Math.max(maxArea, height[left]*(right - left));</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                maxArea = Math.max(maxArea, height[right]*(right - left));</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxArea;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.88% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š51.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†53.67% çš„ç”¨æˆ·</p>
<h3 id="16-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­å®¹å™¨"><a href="#16-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­å®¹å™¨" class="headerlink" title="16.æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­å®¹å™¨"></a>16.æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­å®¹å™¨</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‰‘æŒ‡offerç¬¬61é¢˜ï¼šæ‰‘å…‹ç‰Œä¸­çš„é¡ºå­</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä»æ‰‘å…‹ç‰Œä¸­éšæœºæŠ½5å¼ ç‰Œï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªé¡ºå­ï¼Œå³è¿™5å¼ ç‰Œæ˜¯ä¸æ˜¯è¿ç»­çš„ã€‚2ï½10ä¸ºæ•°å­—æœ¬èº«ï¼ŒAä¸º1ï¼ŒJä¸º11ï¼ŒQä¸º12ï¼ŒKä¸º13ï¼Œè€Œå¤§ã€å°ç‹ä¸º 0 ï¼Œå¯ä»¥çœ‹æˆä»»æ„æ•°å­—ã€‚A ä¸èƒ½è§†ä¸º 14ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3,4,5]</span><br><span class="line">è¾“å‡º: True</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [0,0,1,2,5]</span><br><span class="line">è¾“å‡º: True</span><br></pre></td></tr></table></figure>
<p><strong>é™åˆ¶ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°ç»„é•¿åº¦ä¸º 5 </span><br><span class="line">æ•°ç»„çš„æ•°å–å€¼ä¸º [0, 13] </span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ•°ç»„é•¿åº¦é™åˆ¶äº†æ˜¯5ï¼Œéå¸¸çœäº‹ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦ä¸€äº›é¢å¤–çš„å¤„ç†ã€‚æ‹¿åˆ°ç‰Œï¼Œç¬¬ä¸€ä¸ªæƒ³æ³•æ’åºï¼<strong>å› ä¸ºæ˜¯5è¿ï¼Œæ— è®ºæ¥æ²¡æ¥åˆ°å¤§å°ç‹ï¼Œæœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´ï¼Œä¸€å®šå°äº5</strong>ã€‚</p>
<p>æ’åºåï¼Œæˆ‘ä»¬é€šè¿‡ç´¯ç§¯æ¯ä¸¤å¼ ç‰Œä¹‹é—´çš„å·®å€¼ï¼Œæ¥è®¡ç®—æœ€å°å€¼å’Œæœ€å¤§å€¼ä¸­é—´çš„æ€»å·®å€¼ã€‚</p>
<p>æ‹¿åˆ°äº†ç‹ï¼Œå°±ç›¸å½“äºæ‹¿åˆ°äº†é€šè¡Œè¯ï¼Œç›´æ¥è·³è¿‡ã€‚å› ä¸ºæ˜¯æ’åºçš„ç‰Œï¼Œå¦‚æœæ¥åˆ°å¯¹å­ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸æ˜¯äº”è¿ï¼Œç›´æ¥è¿”å›falseã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isStraight</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        nums.sort()</span><br><span class="line">        sub = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)-<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] == nums[i+<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            sub += nums[i+<span class="number">1</span>] - nums[i]</span><br><span class="line">        <span class="keyword">return</span> sub &lt; <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†40.35% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†16.56% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isStraight</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="keyword">int</span> sub = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length - <span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] == nums[i+<span class="number">1</span>]) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            sub += (nums[i+<span class="number">1</span>] - nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sub &lt; <span class="number">5</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†91.62% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†86.90% çš„ç”¨æˆ·</p>
<h3 id="17-æ•´æ•°æ‹†åˆ†"><a href="#17-æ•´æ•°æ‹†åˆ†" class="headerlink" title="17.æ•´æ•°æ‹†åˆ†"></a>17.æ•´æ•°æ‹†åˆ†</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬343é¢˜ï¼šæ•´æ•°æ‹†åˆ†</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° <em>n</em>ï¼Œå°†å…¶æ‹†åˆ†ä¸º<strong>è‡³å°‘</strong>ä¸¤ä¸ªæ­£æ•´æ•°çš„å’Œï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚è¿”å›ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 2</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 10</span><br><span class="line">è¾“å‡º: 36</span><br><span class="line">è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜: </strong>ä½ å¯ä»¥å‡è®¾ n ä¸å°äº 2 ä¸”ä¸å¤§äº 58ã€‚</p>
<blockquote>
<p>è¦å¯¹ä¸€ä¸ªæ•´æ•°è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä¸”è¦ä½¿è¿™äº›æ‹†åˆ†å®Œåçš„å› å­çš„ä¹˜ç§¯æœ€å¤§ã€‚æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•æ‹†åˆ†å‡ ä¸ªæ•°å€¼ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/104.png" alt></p>
<p>é€šè¿‡è§‚å¯Ÿï¼Œé¦–å…ˆè‚¯å®šå¯ä»¥æ˜ç¡®ï¼Œ<strong>2 å’Œ 3 æ˜¯æ²¡åŠæ³•è¿›è¡Œæ‹†åˆ†çš„æœ€å°å› å­</strong>ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¥½åƒèƒ½çœ‹å‡ºæ¥ï¼š</p>
<ul>
<li>åªè¦æŠŠ n å°½å¯èƒ½çš„æ‹†åˆ†æˆåŒ…å«3çš„ç»„åˆï¼Œå°±å¯ä»¥å¾—åˆ°æœ€å¤§å€¼ã€‚</li>
<li>å¦‚æœæ²¡åŠæ³•æ‹†æˆ 3 çš„ç»„åˆï¼Œå°±é€€ä¸€æ­¥æ‹†æˆ 2 çš„ç»„åˆã€‚</li>
<li>å¯¹äº 3 å’Œ 2 ï¼Œæ²¡åŠæ³•å†è¿›è¡Œæ‹†åˆ†ã€‚</li>
</ul>
<p>æ ¹æ®åˆ†æï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨<strong>è´ªå¿ƒ</strong>è¿›è¡Œæ±‚è§£ã€‚å› ä¸ºä¸€ä¸ªæ•°ï¼ˆå‡è®¾ä¸ºnï¼‰é™¤ä»¥å¦ä¸€ä¸ªæ•°ï¼Œæ€»æ˜¯åŒ…æ‹¬æ•´æ•°éƒ¨åˆ†ï¼ˆxï¼‰å’Œä½™æ•°éƒ¨åˆ†ï¼ˆyï¼‰ã€‚é‚£åˆšæ‰ä¹Ÿå¾—åˆ°äº†ï¼Œ<strong>æœ€ä¼˜å› å­æ˜¯3</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© n/3ï¼Œè¿™æ ·çš„è¯ï¼Œä½™æ•°å¯èƒ½æ˜¯ 1,2 ä¸¤ç§å¯èƒ½æ€§ã€‚</p>
<ul>
<li>å¦‚æœä½™æ•°æ˜¯ 1 ï¼Œåˆšæ‰æˆ‘ä»¬ä¹Ÿåˆ†æè¿‡ï¼Œå¯¹äº 1 çš„æ‹†åˆ†æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€€ä¸€æ­¥ï¼Œå°†æœ€åä¸€æ¬¡çš„ 3 å’Œ 1 çš„æ‹†åˆ†ï¼Œç”¨ 2 å’Œ 2 ä»£æ›¿ã€‚</li>
<li>å¦‚æœä½™æ•°æ˜¯ 2 ï¼Œé‚£ä¸æ¶ˆå¤šè¯´ï¼Œç›´æ¥ä¹˜ä»¥æœ€åçš„ 2 å³å¯ã€‚</li>
</ul>
</blockquote>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">integerBreak</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> n - <span class="number">1</span></span><br><span class="line">        <span class="comment"># æ°å¥½æ•´é™¤ï¼Œç›´æ¥ä¸º3^x</span></span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span> ** (n // <span class="number">3</span>)</span><br><span class="line">        <span class="comment"># ä½™æ•°ä¸º1ï¼Œé€€ä¸€æ­¥ 3^(x-1)*2*2</span></span><br><span class="line">        <span class="keyword">elif</span> n % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span> ** (n // <span class="number">3</span> - <span class="number">1</span>) * <span class="number">4</span></span><br><span class="line">        <span class="comment"># ä½™æ•°ä¸º2ï¼Œç›´æ¥ä¹˜ä»¥2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span> ** (n // <span class="number">3</span>) * <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†96.37% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†31.43% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">integerBreak</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">3</span>) <span class="keyword">return</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n % <span class="number">3</span> == <span class="number">0</span>) <span class="keyword">return</span> (<span class="keyword">int</span>)Math.pow(<span class="number">3</span>, n/<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(n % <span class="number">3</span> == <span class="number">1</span>) <span class="keyword">return</span> (<span class="keyword">int</span>)Math.pow(<span class="number">3</span>, n/<span class="number">3</span>-<span class="number">1</span>)*<span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> (<span class="keyword">int</span>)Math.pow(<span class="number">3</span>, n/<span class="number">3</span>)*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†31.03% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</strong></p>
<blockquote>
<p>dp[i]ä»£è¡¨ i æ‹†åˆ†ä¹‹åå¾—åˆ°çš„ä¹˜ç§¯çš„æœ€å¤§çš„å…ƒç´ ï¼Œæ¯”å¦‚dp[4]å°±ä¿å­˜å°†4æ‹†åˆ†åå¾—åˆ°çš„æœ€å¤§çš„ä¹˜ç§¯ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¼ä¸º dp[i]=max(dp[i], (i-j)*max(dp[j],j))</p>
<p>æ•´ä½“æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œå°†ä¸€ä¸ªå¤§çš„é—®é¢˜ï¼Œåˆ†è§£æˆä¸€ä¸ªä¸€ä¸ªçš„å°é—®é¢˜ï¼Œç„¶åå®Œæˆä¸€ä¸ª<strong>è‡ªåº•å‘ä¸Š</strong>çš„è¿‡ç¨‹ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è®¡ç®— 10 ï¼Œå¯ä»¥æ‹†åˆ† 6 å’Œ 4 ï¼Œå› ä¸º 6 çš„æœ€å¤§å€¼ 3x3ï¼Œä»¥åŠ 4 çš„æœ€å¤§å€¼ 2x2 éƒ½å·²ç»å¾—åˆ°ï¼Œæ‰€ä»¥å°±æ›¿æ¢æˆ 9 å’Œ 4 ï¼Œä¹Ÿå°±æ˜¯ 10=3x3x4ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">integerBreak</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">                dp[i] = <span class="built_in">max</span>(dp[i], <span class="built_in">max</span>(dp[j], j) * (i - j))</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†57.61% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†31.43% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">integerBreak</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++)&#123;</span><br><span class="line">                dp[i] = Math.max(dp[i], Math.max(dp[j], j)*(i - j));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†12.89% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†80.09% çš„ç”¨æˆ·</p>
<h3 id="18-ç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­"><a href="#18-ç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­" class="headerlink" title="18.ç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­"></a>18.ç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬1033é¢˜ï¼šç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸‰æšçŸ³å­æ”¾ç½®åœ¨æ•°è½´ä¸Šï¼Œä½ç½®åˆ†åˆ«ä¸º aï¼Œbï¼Œcã€‚æ¯ä¸€å›åˆï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸‰æšçŸ³å­å½“å‰åˆ†åˆ«ä½äºä½ç½® x, y, z ä¸” x &lt; y &lt; zã€‚ä»ä½ç½® x æˆ–è€…æ˜¯ä½ç½® z  æ‹¿èµ·ä¸€æšçŸ³å­ï¼Œå¹¶å°†è¯¥çŸ³å­ç§»åŠ¨åˆ°æŸä¸€æ•´æ•°ä½ç½® k å¤„ï¼Œå…¶ä¸­ x &lt; k &lt; z ä¸” k !=  yã€‚å½“ä½ æ— æ³•è¿›è¡Œä»»ä½•ç§»åŠ¨æ—¶ï¼Œå³ï¼Œè¿™äº›çŸ³å­çš„ä½ç½®è¿ç»­æ—¶ï¼Œæ¸¸æˆç»“æŸã€‚è¦ä½¿æ¸¸æˆç»“æŸï¼Œä½ å¯ä»¥æ‰§è¡Œçš„æœ€å°å’Œæœ€å¤§ç§»åŠ¨æ¬¡æ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿä»¥é•¿åº¦ä¸º 2  çš„æ•°ç»„å½¢å¼è¿”å›ç­”æ¡ˆï¼šanswer = [minimum_moves, maximum_moves]</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 1, b = 2, c = 5</span><br><span class="line">è¾“å‡ºï¼š[1, 2]</span><br><span class="line">è§£é‡Šï¼šå°†çŸ³å­ä» 5 ç§»åŠ¨åˆ° 4 å†ç§»åŠ¨åˆ° 3ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†çŸ³å­ç§»åŠ¨åˆ° 3ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 4, b = 3, c = 2</span><br><span class="line">è¾“å‡ºï¼š[0, 0]</span><br><span class="line">è§£é‡Šï¼šæˆ‘ä»¬æ— æ³•è¿›è¡Œä»»ä½•ç§»åŠ¨ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 &lt;= a &lt;= 100</span><br><span class="line">1 &lt;= b &lt;= 100</span><br><span class="line">1 &lt;= c &lt;= 100</span><br><span class="line">a != b, b != c, c != a</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯»æ‡‚äº†é¢˜æ„ï¼Œå¼€å§‹è¿›è¡Œåˆ†æã€‚é¦–å…ˆå¯ä»¥æ˜ç¡®ï¼Œæ¯ä¸€æ¬¡æˆ‘ä»¬å…¶å®<strong>æ˜¯ä»è¾¹ä¸Šæ¥æŒ‘é€‰çŸ³å­ï¼Œç„¶åå¾€ä¸­é—´è¿›è¡Œç§»åŠ¨</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—æ‰¾åˆ°minï¼ˆå·¦ï¼‰ï¼Œmaxï¼ˆå³ï¼‰ä»¥åŠmidï¼ˆä¸­ï¼‰ä¸‰ä¸ªå€¼ã€‚æˆ‘ä»¬è®¾ï¼Œminå’Œmidä¸­çš„è·ç¦»ä¸ºxï¼Œmaxå’Œminä¸­çš„è·ç¦»ä¸ºyã€‚å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/105.png" alt></p>
<p>ç„¶ååªéœ€è¦è®¡ç®—xå’Œyçš„å’Œï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€å¤§å€¼ã€‚è€Œæœ€å°å€¼ï¼Œå°±å¾ˆå®¹æ˜“äº†ï¼Œåªæœ‰0,1,2ä¸‰ç§å¯èƒ½æ€§ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numMovesStones</span>(<span class="params">self, a: <span class="built_in">int</span>, b: <span class="built_in">int</span>, c: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">    	<span class="comment"># å°†çŸ³å­ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">        arr = <span class="built_in">sorted</span>([a, b, c])</span><br><span class="line">        x = arr[<span class="number">1</span>] - arr[<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line">        y = arr[<span class="number">2</span>] - arr[<span class="number">1</span>] - <span class="number">1</span></span><br><span class="line">        <span class="built_in">max</span> = x + y</span><br><span class="line">        <span class="built_in">min</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> x != <span class="number">0</span> <span class="keyword">or</span> y != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> y &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">min</span> = <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">min</span> = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">min</span>, <span class="built_in">max</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:28 ms,å‡»è´¥äº†99.36% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†33.33% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] numMovesStones(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;a, b ,c&#125;;</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        <span class="keyword">int</span> x = arr[<span class="number">1</span>] - arr[<span class="number">0</span>] -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> y = arr[<span class="number">2</span>] - arr[<span class="number">1</span>] -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> max_move = x + y;</span><br><span class="line">        <span class="keyword">int</span> min_move = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(x != <span class="number">0</span> || y != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x &gt; <span class="number">1</span> &amp;&amp; y &gt; <span class="number">1</span>) min_move = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> min_move = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;min_move, max_move&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†49.13% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.1 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†93.93% çš„ç”¨æˆ·</p>
<h3 id="19-Nimæ¸¸æˆ"><a href="#19-Nimæ¸¸æˆ" class="headerlink" title="19.Nimæ¸¸æˆ"></a>19.Nimæ¸¸æˆ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬292é¢˜ï¼šNim æ¸¸æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ å’Œä½ çš„æœ‹å‹ï¼Œä¸¤ä¸ªäººä¸€èµ·ç© Nim æ¸¸æˆï¼šæ¡Œå­ä¸Šæœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯æ¬¡ä½ ä»¬è½®æµæ‹¿æ‰ 1 - 3 å—çŸ³å¤´ã€‚æ‹¿æ‰æœ€åä¸€å—çŸ³å¤´çš„äººå°±æ˜¯è·èƒœè€…ã€‚ä½ ä½œä¸ºå…ˆæ‰‹ã€‚ ä½ ä»¬æ˜¯èªæ˜äººï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯æœ€ä¼˜è§£ã€‚ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥åˆ¤æ–­ä½ æ˜¯å¦å¯ä»¥åœ¨ç»™å®šçŸ³å¤´æ•°é‡çš„æƒ…å†µä¸‹èµ¢å¾—æ¸¸æˆã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 4</span><br><span class="line">è¾“å‡º: false </span><br><span class="line">è§£é‡Š: å¦‚æœå †ä¸­æœ‰ 4 å—çŸ³å¤´ï¼Œé‚£ä¹ˆä½ æ°¸è¿œä¸ä¼šèµ¢å¾—æ¯”èµ›ï¼›</span><br><span class="line">     å› ä¸ºæ— è®ºä½ æ‹¿èµ° 1 å—ã€2 å— è¿˜æ˜¯ 3 å—çŸ³å¤´ï¼Œæœ€åä¸€å—çŸ³å¤´æ€»æ˜¯ä¼šè¢«ä½ çš„æœ‹å‹æ‹¿èµ°ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆå¦‚æœçŸ³å¤´æ•°å°äº4ä¸ªï¼Œé‚£ä¹ˆå› ä¸ºä½ æ˜¯å…ˆæ‰‹ï¼Œä¸€æŠŠæ‹¿èµ°ï¼Œè‚¯å®šä¼šèµ¢ã€‚</p>
<p>è€Œå¦‚æœçŸ³å¤´æ˜¯4ä¸ªï¼Œé‚£ä¸ç®¡ä½ æ˜¯æ‹¿äº†1,2,3ä¸ªï¼Œæœ€åä¸€ä¸ªéƒ½å¯ä»¥è¢«ä½ çš„å¯¹æ‰‹æ‹¿èµ°ï¼Œæ‰€ä»¥æ€ä¹ˆæ ·éƒ½èµ¢ä¸äº†ã€‚</p>
<p>å†ç»§ç»­åˆ†æåˆ°8ä¸ªçŸ³å¤´ï¼šå¯¹äº5,6,7è€Œè¨€ï¼Œä½ åªéœ€è¦å¯¹åº”çš„æ‹¿èµ°1,2,3ï¼Œç„¶åç•™ä¸‹4ä¸ªï¼Œåˆ™å¯¹æ–¹å¿…è¾“ã€‚ä½†æ˜¯å¦‚æœä½ è¦é¢å¯¹çš„æ˜¯8ï¼Œä¸ç®¡å…ˆæ‹¿ï¼ˆ1,2,3ï¼‰ä¸ªï¼Œå¦ä¸€ä¸ªäººéƒ½å¯ä»¥é€šè¿‡ 8-(1,2,3) ï¼Œä½¿å¾—ä½ é¢å¯¹4ä¸ªçŸ³å¤´ï¼Œåˆ™ä½ å¿…è¾“æ— ç–‘ã€‚é€šè¿‡è§‚å¯Ÿï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¥½åƒæ˜¯<strong>åªè¦Næ˜¯4çš„å€æ•°ï¼Œæˆ‘ä»¬å°±å¿…è¾“æ— ç–‘</strong>ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">canWinNim</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">return</span> n % <span class="number">4</span> != <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†55.90% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.5 MB,å‡»è´¥äº†11.08% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canWinNim</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> n % <span class="number">4</span> != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.4 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†16.27% çš„ç”¨æˆ·</p>
<h3 id="20-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"><a href="#20-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°" class="headerlink" title="20.å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"></a>20.å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬4é¢˜ï¼šå¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æœ‰åºæ•°ç»„ nums1 å’Œ nums2ã€‚è¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log(m + n))ã€‚ä½ å¯ä»¥å‡è®¾ nums1 å’Œ nums2 ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums1 = [1, 3]</span><br><span class="line">nums2 = [2]</span><br><span class="line">åˆ™ä¸­ä½æ•°æ˜¯ 2.0</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums1 = [1, 2]</span><br><span class="line">nums2 = [3, 4]</span><br><span class="line">åˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [0,0], nums2 = [0,0]</span><br><span class="line">è¾“å‡ºï¼š0.00000</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹ 4ï¼š</strong><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [], nums2 = [1]</span><br><span class="line">è¾“å‡ºï¼š1.00000</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹ 5ï¼š</strong><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [2], nums2 = []</span><br><span class="line">è¾“å‡ºï¼š2.00000</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>ä¸€èˆ¬å¦‚æœé¢˜ç›®è¦æ±‚æ—¶é—´å¤æ‚åº¦åœ¨O(log(n))ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¯ä»¥ä½¿ç”¨äºŒåˆ†çš„æ€æƒ³æ¥è¿›è¡Œæ±‚è§£</strong>ã€‚</p>
<p>å¦‚æœåªæœ‰ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸­ä½æ•°ï¼Œé‚£è‚¯å®šéœ€è¦åˆ¤æ–­å…ƒç´ æ˜¯å¥‡æ•°ä¸ªè¿˜æ˜¯å¶æ•°ä¸ªï¼Œå¦‚æœæ˜¯å¥‡æ•°ä¸ªé‚£æœ€ä¸­é—´çš„å°±æ˜¯ä¸­ä½æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°ä¸ªçš„è¯ï¼Œé‚£å°±æ˜¯æœ€ä¸­é—´ä¸¤ä¸ªæ•°çš„å’Œé™¤ä»¥2ã€‚</p>
<p>é‚£å¦‚æœæ˜¯ä¸¤ä¸ªæ•°ç»„ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å…ˆæ±‚å‡ºä¸¤ä¸ªæ•°ç»„é•¿åº¦ä¹‹å’Œã€‚å¦‚æœä¸ºå¥‡æ•°ï¼Œå°±æ‰¾ä¸­é—´çš„é‚£ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯ <strong>(é•¿åº¦ä¹‹å’Œ + 1)/2</strong> ã€‚å¦‚æœä¸ºå¶æ•°ï¼Œé‚£å°±æ‰¾ <strong>é•¿åº¦ä¹‹å’Œ/2</strong>ã€‚æ¯”å¦‚ä¸‹é¢çš„ (9 + 5)/2 = 7ï¼Œé‚£æˆ‘ä»¬æœ€ç»ˆå°±æ˜¯<strong>æ‰¾åˆ°æ’åˆ—ç¬¬7ä½çš„å€¼</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/106.jpg" alt></p>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨äºŒåˆ†çš„æ€æƒ³æ¥æ‰¾åˆ°ä¸­é—´æ’åˆ—ç¬¬7ä½çš„æ•°ã€‚è¿™é‡Œæœ‰ä¸€ç§ä¸å¤ªå¥½æƒ³åˆ°çš„æ–¹å¼ï¼Œ<strong>æ˜¯ç”¨åˆ çš„æ–¹å¼</strong>ï¼Œå› ä¸º<strong>å¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠå¤šä½™çš„æ•°æ’é™¤æ‰ï¼Œæœ€ç»ˆå‰©ä¸‹çš„é‚£ä¸ªæ•°ï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ•°ï¼Ÿ</strong> å¯¹äºä¸Šé¢çš„æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåˆ æ‰ 7/2=3 ä¸ªæ•°ã€‚é‚£è¿™é‡Œï¼Œå¯ä»¥é€‰æ‹©åˆ ä¸Šé¢çš„ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åˆ ä¸‹é¢çš„ã€‚é‚£è¿™é‡Œå› ä¸º i&lt;jï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åˆ é™¤ä¸Šé¢çš„3ä¸ªæ•°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/107.jpg" alt></p>
<p>ï¼ˆåˆ é™¤å‰ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/108.png" alt></p>
<p>ï¼ˆåˆ é™¤åï¼‰</p>
<p>ç”±äºæˆ‘ä»¬å·²ç»æ’é™¤æ‰äº† 3 ä¸ªæ•°å­—ï¼Œç°åœ¨å¯¹äºä¸¤ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°7-3=4çš„æ•°å­—ï¼Œæ¥è¿›è¡Œä¸‹ä¸€æ­¥è¿ç®—ã€‚æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ æ‰4/2=2ä¸ªæ•°ã€‚æˆ‘ä»¬æ¯”è¾ƒiå’Œjçš„å€¼ï¼Œåˆ é™¤å°çš„ä¸€è¾¹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/109.png" alt></p>
<p>ï¼ˆåˆ é™¤å‰ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/110.jpg" alt></p>
<p>ï¼ˆåˆ é™¤åï¼‰</p>
<p>ç»§ç»­ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬åˆ é™¤ 2/2=1 ä¸ªæ•°ã€‚<strong>åŒç†ï¼Œæ¯”è¾ƒ7å’Œ6çš„å¤§å°ï¼Œåˆ é™¤å°çš„ä¸€è¾¹</strong>ã€‚åˆ å®Œåæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/111.png" alt></p>
<p>ï¼ˆ7å’Œ6ï¼Œåˆ é™¤6ï¼‰</p>
<p>ä¸è¦å¿˜è®°æˆ‘ä»¬çš„ç›®çš„ï¼Œæˆ‘ä»¬æ˜¯ä¸ºäº†æ‰¾ç¬¬7å°çš„æ•°ã€‚æ­¤æ—¶ï¼Œ<strong>ä¸¤ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå“ªä¸ªå°ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªæ•°</strong>ã€‚å› ä¸º7&lt;8ï¼Œæ‰€ä»¥7å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬7å°çš„æ•°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/112.jpg" alt></p>
<p>è¿™é‡Œæœ‰ä¸€ç‚¹æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå¦‚æœåœ¨åˆ é™¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬<strong>è¦åˆ é™¤çš„K/2ä¸ªæ•°ï¼Œå¤§äºå…¶ä¸­ä¸€è¾¹çš„æ•°ç»„é•¿åº¦</strong>ï¼Œé‚£æˆ‘ä»¬å°±å°†å°çš„ä¸€ä¾§æ•°ç»„å…ƒç´ éƒ½åˆ é™¤ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼Œæ­¤æ—¶7/2=3ï¼Œä½†æ˜¯ä¸‹é¢çš„æ•°ç»„åªæœ‰2ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°±å°†å®ƒå…¨éƒ¨åˆ é™¤ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/113.jpg" alt></p>
<p>åˆ å®Œä¹‹åï¼Œæ­¤æ—¶å› ä¸ºåªåˆ é™¤äº†2ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥kå˜æˆäº†5ã€‚é‚£æˆ‘ä»¬åªéœ€è¦è¿”å›å…¶ä¸­ä¸€è¾¹çš„ç¬¬5ä¸ªå…ƒç´ å°±okã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/114.jpg" alt></p>
<p>æ•´ä¸ªä¸Šé¢çš„è¿‡ç¨‹ï¼Œå®Œæˆäº†æœ¬é¢˜çš„ç®—æ³•æ¶æ„ï¼</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMedianSortedArrays</span>(<span class="params">self, nums1: <span class="type">List</span>[<span class="built_in">int</span>], nums2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">float</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">findK</span>(<span class="params">nums1, i, nums2, j, k</span>):</span></span><br><span class="line">            <span class="comment"># ç‰¹æ®Šæƒ…å†µï¼šè¦åˆ é™¤çš„ä¸ªæ•°å¤§äºå…¶ä¸­ä¸€è¾¹çš„æ•°ç»„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">if</span> i &gt;= len1:</span><br><span class="line">                <span class="keyword">return</span> nums2[j + k - <span class="number">1</span>]</span><br><span class="line">            <span class="comment"># ç‰¹æ®Šæƒ…å†µï¼šè¦åˆ é™¤çš„ä¸ªæ•°å¤§äºå…¶ä¸­ä¸€è¾¹çš„æ•°ç»„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">if</span> j &gt;= len2:</span><br><span class="line">                <span class="keyword">return</span> nums1[i + k - <span class="number">1</span>]</span><br><span class="line">            <span class="comment"># æ­£å¸¸æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> k == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">min</span>(nums1[i], nums2[j])</span><br><span class="line">            <span class="comment"># è®¡ç®—å‡ºæ¯æ¬¡è¦æ¯”è¾ƒçš„ä¸¤ä¸ªæ•°çš„å€¼ï¼Œæ¥å†³å®š&quot;åˆ é™¤&quot;å“ªè¾¹çš„å…ƒç´ </span></span><br><span class="line">            mid1 = nums1[i + k // <span class="number">2</span> - <span class="number">1</span>] <span class="keyword">if</span> (i + k // <span class="number">2</span> - <span class="number">1</span>) &lt; len1 <span class="keyword">else</span> inf</span><br><span class="line">            mid2 = nums2[j + k // <span class="number">2</span> - <span class="number">1</span>] <span class="keyword">if</span> (j + k // <span class="number">2</span> - <span class="number">1</span>) &lt; len2 <span class="keyword">else</span> inf</span><br><span class="line">            <span class="comment">#ã€€é€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œæ¥æ¨¡æ‹Ÿåˆ é™¤æ‰å‰K//2ä¸ªå…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> mid1 &lt; mid2:</span><br><span class="line">                <span class="keyword">return</span> findK(nums1, i + k // <span class="number">2</span>, nums2, j, k - k // <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> findK(nums1, i, nums2, j + k // <span class="number">2</span>, k - k // <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        len1 = <span class="built_in">len</span>(nums1)</span><br><span class="line">        len2 = <span class="built_in">len</span>(nums2)</span><br><span class="line">        total = len1 + len2</span><br><span class="line">        <span class="comment"># æ¯”å¦‚æ€»æ•°ä¸ºå¶æ•°14ï¼Œå°±è¦æ‰¾ç¬¬7ä¸ªå’Œç¬¬8ä¸ª</span></span><br><span class="line">        <span class="comment"># æ¯”å¦‚æ€»æ•°ä¸ºå¥‡æ•°5ï¼Œå°±è¦æ‰¾ç¬¬3ä¸ª</span></span><br><span class="line">        left = (total + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">        right = (total + <span class="number">2</span>) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> (findK(nums1, <span class="number">0</span>, nums2, <span class="number">0</span>, left) + findK(nums1, <span class="number">0</span>, nums2, <span class="number">0</span>, right)) / <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†77.16% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:13.8 MB,å‡»è´¥äº†5.17% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> length1 = nums1.length, length2 = nums2.length;</span><br><span class="line">        <span class="keyword">int</span> totalLength = length1 + length2;</span><br><span class="line">        <span class="keyword">int</span> left = (totalLength + <span class="number">1</span>) / <span class="number">2</span>, right = (totalLength + <span class="number">2</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">double</span> median = (getKthElement(nums1, nums2, left) + getKthElement(nums1, nums2, right)) / <span class="number">2.0</span>;</span><br><span class="line">        <span class="keyword">return</span> median;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getKthElement</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">         <span class="comment">/* ä¸»è¦æ€è·¯ï¼šè¦æ‰¾åˆ°ç¬¬ k (k&gt;1) å°çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±å– pivot1 = nums1[k/2-1] å’Œ pivot2 = nums2[k/2-1] è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">         * è¿™é‡Œçš„ &quot;/&quot; è¡¨ç¤ºæ•´é™¤</span></span><br><span class="line"><span class="comment">         * nums1 ä¸­å°äºç­‰äº pivot1 çš„å…ƒç´ æœ‰ nums1[0 .. k/2-2] å…±è®¡ k/2-1 ä¸ª</span></span><br><span class="line"><span class="comment">         * nums2 ä¸­å°äºç­‰äº pivot2 çš„å…ƒç´ æœ‰ nums2[0 .. k/2-2] å…±è®¡ k/2-1 ä¸ª</span></span><br><span class="line"><span class="comment">         * å– pivot = min(pivot1, pivot2)ï¼Œä¸¤ä¸ªæ•°ç»„ä¸­å°äºç­‰äº pivot çš„å…ƒç´ å…±è®¡ä¸ä¼šè¶…è¿‡ (k/2-1) + (k/2-1) &lt;= k-2 ä¸ª</span></span><br><span class="line"><span class="comment">         * è¿™æ · pivot æœ¬èº«æœ€å¤§ä¹Ÿåªèƒ½æ˜¯ç¬¬ k-1 å°çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">         * å¦‚æœ pivot = pivot1ï¼Œé‚£ä¹ˆ nums1[0 .. k/2-1] éƒ½ä¸å¯èƒ½æ˜¯ç¬¬ k å°çš„å…ƒç´ ã€‚æŠŠè¿™äº›å…ƒç´ å…¨éƒ¨ &quot;åˆ é™¤&quot;ï¼Œå‰©ä¸‹çš„ä½œä¸ºæ–°çš„ nums1 æ•°ç»„</span></span><br><span class="line"><span class="comment">         * å¦‚æœ pivot = pivot2ï¼Œé‚£ä¹ˆ nums2[0 .. k/2-1] éƒ½ä¸å¯èƒ½æ˜¯ç¬¬ k å°çš„å…ƒç´ ã€‚æŠŠè¿™äº›å…ƒç´ å…¨éƒ¨ &quot;åˆ é™¤&quot;ï¼Œå‰©ä¸‹çš„ä½œä¸ºæ–°çš„ nums2 æ•°ç»„</span></span><br><span class="line"><span class="comment">         * ç”±äºæˆ‘ä»¬ &quot;åˆ é™¤&quot; äº†ä¸€äº›å…ƒç´ ï¼ˆè¿™äº›å…ƒç´ éƒ½æ¯”ç¬¬ k å°çš„å…ƒç´ è¦å°ï¼‰ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹ k çš„å€¼ï¼Œå‡å»åˆ é™¤çš„æ•°çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> length1 = nums1.length, length2 = nums2.length;</span><br><span class="line">        <span class="keyword">int</span> index1 = <span class="number">0</span>, index2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> kthElement = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> (index1 == length1) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums2[index2 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index2 == length2) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums1[index1 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (k == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Math.min(nums1[index1], nums2[index2]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ­£å¸¸æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">int</span> half = k / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">int</span> newIndex1 = Math.min(index1 + half, length1) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> newIndex2 = Math.min(index2 + half, length2) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> pivot1 = nums1[newIndex1], pivot2 = nums2[newIndex2];</span><br><span class="line">            <span class="keyword">if</span> (pivot1 &lt;= pivot2) &#123;</span><br><span class="line">                k -= (newIndex1 - index1 + <span class="number">1</span>);</span><br><span class="line">                index1 = newIndex1 + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k -= (newIndex2 - index2 + <span class="number">1</span>);</span><br><span class="line">                index2 = newIndex2 + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š3 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†82.06% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†99.34% çš„ç”¨æˆ·</p>
<h3 id="21-ç¬¬kä¸ªæœ€å¤§å…ƒç´ "><a href="#21-ç¬¬kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="21.ç¬¬kä¸ªæœ€å¤§å…ƒç´ "></a>21.ç¬¬kä¸ªæœ€å¤§å…ƒç´ </h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬215é¢˜ï¼šç¬¬Kä¸ªæœ€å¤§å…ƒç´ </th>
</tr>
</thead>
<tbody>
<tr>
<td>åœ¨æœªæ’åºçš„æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2</span><br><span class="line">è¾“å‡º: 5</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜:</strong></p>
<p>ä½ å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„çš„é•¿åº¦ã€‚</p>
<blockquote>
<p>è¿™ç§é¢˜ç›®ï¼Œä»ä¸ªäººæ¥è®²ï¼Œæˆ‘ä¸€èˆ¬æ˜¯æ¯”è¾ƒåå¥½ä½¿ç”¨å †æ¥åšçš„ã€‚æ¯•ç«Ÿå¤§å°é¡¶å †ï¼Œåˆšå¥½æœ‰ç€ä¸æœ¬ç±»é¢˜å‹å¥‘åˆçš„ç‰¹æ€§ã€‚æˆ‘ä»¬å¯¹å…¶æ„é€ ä¸€ä¸ªå°é¡¶å †ï¼ˆæ¯ä¸ªç»“ç‚¹çš„å€¼å‡ä¸å¤§äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œå †é¡¶å…ƒç´ ä¸ºæ•´ä¸ªå †çš„æœ€å°å€¼ï¼‰ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·ï¼š</p>
<p>æ„é€ ä¸€ä¸ªå°é¡¶å †ï¼Œä¾æ¬¡å°†å…ƒç´ æ”¾å…¥å †ä¸­ï¼Œå¹¶ä¿è¯å †ä¸­å…ƒç´ ä¸ºkã€‚</p>
<p>å¦‚æœå½“å‰å…ƒç´ å°äºå †é¡¶å…ƒç´ ï¼Œé‚£åŸºæœ¬å°±ä¸ç”¨çœ‹äº†ï¼ˆå› ä¸ºæˆ‘ä»¬è¦æ‰¾çš„æ˜¯ æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼‰</p>
<p>è‡ªç„¶ï¼Œå¦‚æœæˆ‘ä»¬é‡åˆ°æ¯”å †é¡¶å…ƒç´ å¤§çš„å…ƒç´ ï¼Œå°±æŠŠå®ƒæ”¾å…¥åˆ°å †ä¸­ã€‚</p>
<p>é‡å¤ä¸Šé¢çš„æ­¥éª¤ã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼šå°é¡¶å †</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="comment"># æœ€å¤§çš„kä¸ªæ•° æœ€å°å †</span></span><br><span class="line">        <span class="comment"># æœ€å°å † é¡¶ç‚¹æœ€å°</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">minHeapfy</span>(<span class="params">minHeap, i, k</span>):</span></span><br><span class="line">            <span class="comment"># å·¦å³å­èŠ‚ç‚¹</span></span><br><span class="line">            left = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">            right = <span class="number">2</span> * i + <span class="number">2</span></span><br><span class="line">            <span class="comment"># å‡å®šå½“å‰èŠ‚ç‚¹æœ€å°</span></span><br><span class="line">            minPoint = i</span><br><span class="line">            <span class="comment"># å’Œå½“å‰èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹æ¯”è¾ƒï¼Œå¦‚æœèŠ‚ç‚¹ä¸­æœ‰æ›´å°çš„æ•°ï¼Œé‚£ä¹ˆäº¤æ¢ï¼Œå¹¶ç»§ç»­å¯¹äº¤æ¢åçš„èŠ‚ç‚¹è¿›è¡Œç»´æŠ¤</span></span><br><span class="line">            <span class="keyword">if</span> left &lt; k <span class="keyword">and</span> minHeap[left] &lt; minHeap[minPoint]:</span><br><span class="line">                minPoint = left</span><br><span class="line">            <span class="keyword">if</span> right &lt; k <span class="keyword">and</span> minHeap[right] &lt; minHeap[minPoint]:</span><br><span class="line">                minPoint = right</span><br><span class="line">            <span class="comment"># å¦‚æœæœ€å°çš„æ•°ä¸æ˜¯èŠ‚ç‚¹içš„è¯ï¼Œé‚£ä¹ˆäº¤æ¢åï¼Œè°ƒæ•´èŠ‚ç‚¹içš„å­æ ‘ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> minPoint != i:</span><br><span class="line">                minHeap[i], minHeap[minPoint] = minHeap[minPoint], minHeap[i]</span><br><span class="line">                minHeapfy(minHeap, minPoint, k)</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ– å–å‰kä¸ªæ ‘ï¼Œç»„æˆæœ€å°å †</span></span><br><span class="line">        minHeap = nums[:k]</span><br><span class="line">        <span class="comment"># å¯¹äºä¸€ä¸ªè¿˜æ²¡ç»´æŠ¤è¿‡çš„å †ï¼Œä»ä»–çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¼€å§‹è¿›è¡Œè°ƒæ•´ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k // <span class="number">2</span> - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            minHeapfy(minHeap, i, k)</span><br><span class="line">        <span class="comment"># ç»§ç»­è°ƒæ•´åé¢èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k, <span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="comment"># å¦‚æœå…ƒç´ å¤§äºå †é¡¶å…ƒç´ ï¼Œé‚£ä¹ˆå–å‡ºå †é¡¶å…ƒç´ ï¼Œå°†å½“å‰å…ƒç´ å…¥å †</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] &gt; minHeap[<span class="number">0</span>]:</span><br><span class="line">                minHeap[<span class="number">0</span>] = nums[i]</span><br><span class="line">                minHeapfy(minHeap, <span class="number">0</span>, k)</span><br><span class="line">        <span class="comment"># æœ€åå¾—åˆ°çš„å †é¡¶ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> minHeap[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:64 ms,å‡»è´¥äº†44.82% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.3 MB,å‡»è´¥äº†14.45% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] minHeap = Arrays.copyOf(nums, k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = k / <span class="number">2</span> - <span class="number">1</span>; i &gt; -<span class="number">1</span>; i--) minHeap(minHeap, i, k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = k; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; minHeap[<span class="number">0</span>])&#123;</span><br><span class="line">                minHeap[<span class="number">0</span>] = nums[i];</span><br><span class="line">                minHeap(minHeap, <span class="number">0</span>, k);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minHeap[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">minHeap</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> i, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">2</span> * i + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> minPoint = i;</span><br><span class="line">        <span class="keyword">if</span>(left &lt; k &amp;&amp; nums[left] &lt; nums[minPoint]) minPoint = left;</span><br><span class="line">        <span class="keyword">if</span>(right &lt; k &amp;&amp; nums[right] &lt; nums[minPoint]) minPoint = right;</span><br><span class="line">        <span class="keyword">if</span>(minPoint != i)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = nums[i];</span><br><span class="line">            nums[i] = nums[minPoint];</span><br><span class="line">            nums[minPoint] = tmp;</span><br><span class="line">            minHeap(nums, minPoint, k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†99.35% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†51.50% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼šè°ƒç”¨å†…ç½®å‡½æ•°</strong></p>
<blockquote>
<p>pythonå¯ä»¥ä½¿ç”¨heapq.nlargest æˆ– heapq.nsmallestï¼Œæ¥æ‰¾å‡ºæŸä¸ªé›†åˆä¸­æ‰¾å‡ºæœ€å¤§æˆ–æœ€å°çš„Nä¸ªå…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> heapq.nlargest(k, nums)[-<span class="number">1</span>]  <span class="comment"># [6,5]</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†91.38% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.3 MB,å‡»è´¥äº†14.45% çš„Python3ç”¨æˆ·</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬347é¢˜ï¼šå‰ K ä¸ªé«˜é¢‘å…ƒç´ </th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,1,1,2,2,3] å’Œ k = 2</span><br><span class="line">è¾“å‡º: [1, 2]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1] å’Œ k = 1</span><br><span class="line">è¾“å‡º: [1]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é¢˜ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œåªæ˜¯éœ€è¦å…ˆç»Ÿè®¡å„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åæŒ‰ç…§æ¬¡æ•°çš„å¤§å°ä¸ºåŸºå‡†åŠ å…¥å°é¡¶å †ï¼Œè¿™é‡Œæä¾›Javaå†…ç½®å°é¡¶å †å‡½æ•°çš„ç”¨æ³•ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] topKFrequent(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums) map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        Queue&lt;Integer&gt; minHeap = <span class="keyword">new</span> PriorityQueue&lt;&gt;((v1, v2) -&gt; map.get(v1) - map.get(v2));    </span><br><span class="line">        map.forEach((num, cnt) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (minHeap.size() &lt; k) &#123;</span><br><span class="line">                minHeap.offer(num);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (map.get(minHeap.peek()) &lt; cnt) &#123;</span><br><span class="line">                minHeap.poll();</span><br><span class="line">                minHeap.offer(num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) res[i] = minHeap.poll();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š18 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†26.53% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š41 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†70.04% çš„ç”¨æˆ·</p>
<h3 id="22-é•œé¢åå°„"><a href="#22-é•œé¢åå°„" class="headerlink" title="22.é•œé¢åå°„"></a>22.é•œé¢åå°„</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬858é¢˜ï¼šé•œé¢åå°„</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ­£æ–¹å½¢æˆ¿é—´ï¼Œæ¯é¢å¢™ä¸Šéƒ½æœ‰ä¸€é¢é•œå­ã€‚é™¤è¥¿å—è§’ä»¥å¤–ï¼Œæ¯ä¸ªè§’è½éƒ½æ”¾æœ‰ä¸€ä¸ªæ¥å—å™¨ï¼Œç¼–å·ä¸º 0ï¼Œ1ï¼Œä»¥åŠ 2ã€‚æ­£æ–¹å½¢æˆ¿é—´çš„å¢™å£é•¿åº¦ä¸º pï¼Œä¸€æŸæ¿€å…‰ä»è¥¿å—è§’å°„å‡ºï¼Œé¦–å…ˆä¼šä¸ä¸œå¢™ç›¸é‡ï¼Œå…¥å°„ç‚¹åˆ°æ¥æ”¶å™¨ 0 çš„è·ç¦»ä¸º q  ã€‚è¿”å›å…‰çº¿æœ€å…ˆé‡åˆ°çš„æ¥æ”¶å™¨çš„ç¼–å·ï¼ˆä¿è¯å…‰çº¿æœ€ç»ˆä¼šé‡åˆ°ä¸€ä¸ªæ¥æ”¶å™¨ï¼‰ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š p = 2, q = 1</span><br><span class="line">è¾“å‡ºï¼š 2</span><br><span class="line">è§£é‡Šï¼š è¿™æ¡å…‰çº¿åœ¨ç¬¬ä¸€æ¬¡è¢«åå°„å›å·¦è¾¹çš„å¢™æ—¶å°±é‡åˆ°äº†æ¥æ”¶å™¨ 2 </span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„é¢˜ç›®ç»•å¾—å¾ˆï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/115.png" alt></p>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“å…‰æ˜¯ç”±è¥¿å—è§’å‘å‡ºçš„ï¼Œä¹Ÿå°±æ˜¯å·¦ä¸‹è§’ã€‚å‘å‡ºä¹‹åå¯èƒ½ä¼šå‡ºç°å¤šç§æƒ…å†µï¼ˆæ³¨æ„ï¼Œä¸‹å›¾ç•¥è¿‡äº†éƒ¨åˆ†å…‰çº¿åå°„çš„æƒ…å†µï¼‰ã€‚çœ‹èµ·æ¥æ˜¯ååˆ†å¤æ‚ï¼Œæ— è¿¹å¯å¯»ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå…‰çº¿çš„è¿åŠ¨è½¨è¿¹æ‹†å¼€æ¥çœ‹ï¼Œå°±å¯ä»¥è§‚æµ‹åˆ°ï¼Œ<strong>å…‰çº¿æ¯ç»è¿‡ä¸€æ¬¡æŠ˜åï¼Œéƒ½ä¼šåœ¨çºµå‘è·ç¦»ä¸Šç§»åŠ¨ q</strong>ï¼ˆé¦–æ¬¡ä¸ä¸œå¢™ç›¸è·çš„è·ç¦»ï¼‰ã€‚åŒæ—¶ï¼Œ<strong>ä¸€æ—¦å…¶å‘ä¸Šè¡Œèµ°çš„è·ç¦»ä¸º p çš„æ•´æ•°å€ï¼Œå°±ä¸€å®šä¼šç¢°åˆ°æŸä¸ªæ¥æ”¶ç‚¹</strong>ï¼ˆ<strong>æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘åŒ—é¢å¢™æ˜¯å¦å­˜åœ¨ï¼Œæ ¹æ®å…‰çš„åå°„å®šå¾‹å¯å¾—</strong>ï¼‰å¯ä»¥å‚è€ƒä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/116.png" alt></p>
<p>é—®é¢˜å˜å¾—ç®€å•äº†ï¼Œ<strong>å…‰çº¿æœ€ç»ˆå‘ä¸Šèµ°çš„è·ç¦»ï¼Œå…¶å®å°±æ˜¯ p å’Œ q çš„æœ€å°å…¬å€æ•°</strong>ã€‚æˆ‘ä»¬è®¾æœ€å°å…¬å€æ•°ä¸º Lï¼Œä¼šå‘ç°å¦‚æœ L æ˜¯ p çš„<strong>å¥‡æ•°å€</strong>ï¼Œå…‰çº¿åˆ™åˆ°è¾¾<strong>åŒ—å¢™</strong>ï¼ˆå¯ä»¥å‚è€ƒä¸Šé¢çš„å›¾ï¼‰å½“ L æ˜¯ p çš„ <strong>å¶æ•°å€</strong>ï¼Œå…‰çº¿å°†ä¼šå°„åˆ°<strong>å—å¢™</strong>ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼Œå¦‚æœå…‰çº¿æ˜¯å°„å‘å—å¢™ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ¥æ”¶å™¨äº†ï¼Œå¿…å®šåªèƒ½é‡åˆ°æ¥æ”¶å™¨ 0ã€‚ä½†æ˜¯å¦‚æœå°„åˆ°äº†åŒ—å¢™ï¼Œå¦‚ä½•åŒºåˆ†æ˜¯ 1 å’Œ 2ã€‚è¿™å›åˆ°äº†ä¸€ä¸ªåˆä¸­æ•°å­¦é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>å…‰çº¿ä¸ä¸œè¥¿å¢™çš„æ¥è§¦æ¬¡æ•°ï¼Œæ¥åˆ¤æ–­æœ€ç»ˆçš„è½ç‚¹æ˜¯ 1 è¿˜æ˜¯ 2ã€‚</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mirrorReflection</span>(<span class="params">self, p: <span class="built_in">int</span>, q: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        m, n = p, q</span><br><span class="line">        <span class="comment"># æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">        <span class="comment"># å‡è®¾xå’Œyçš„æœ€å¤§å…¬çº¦æ•°æ˜¯m,æœ€å°å…¬å€æ•°æ˜¯n,åˆ™xy=mn</span></span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            r = m % n</span><br><span class="line">            m = n</span><br><span class="line">            n = r</span><br><span class="line">        <span class="comment"># å‡è®¾xå’Œyçš„æœ€å¤§å…¬çº¦æ•°æ˜¯m,æœ€å°å…¬å€æ•°æ˜¯n,åˆ™xy=mn</span></span><br><span class="line">        <span class="comment"># æ‰€ä»¥æœ€å°å…¬å€æ•°ä¸ºpq/m</span></span><br><span class="line">        <span class="comment"># è‹¥q/mä¸ºå¶æ•°åˆ™æœ€å°å…¬å€æ•°ä¸ºpçš„å¶æ•°å€ï¼Œå°„å‘å—å¢™</span></span><br><span class="line">        <span class="keyword">if</span> (q / m) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># å¦åˆ™ä¸ºå¥‡æ•°å€ï¼Œåˆ¤æ–­ä¸ä¸œè¥¿å¢™çš„æ¥è§¦æ¬¡æ•°</span></span><br><span class="line">        <span class="comment"># è‹¥p/mä¸ºå¶æ•°åˆ™æœ€å°å…¬å€æ•°ä¸ºqçš„å¶æ•°å€ï¼Œè½ç‚¹ä¸º2</span></span><br><span class="line">        <span class="keyword">elif</span> (p / m) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">        <span class="comment"># å¦åˆ™è½ç‚¹ä¸º1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†83.16% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.43% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mirrorReflection</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = p, n = q;</span><br><span class="line">        <span class="keyword">while</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> r = m % n;</span><br><span class="line">            m = n;</span><br><span class="line">            n = r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (q / m % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p / m % <span class="number">2</span> == <span class="number">0</span>)  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š34.9 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†92.59% çš„ç”¨æˆ·</p>
<h3 id="23-æ•´æ•°è½¬ç½—é©¬æ•°å­—"><a href="#23-æ•´æ•°è½¬ç½—é©¬æ•°å­—" class="headerlink" title="23.æ•´æ•°è½¬ç½—é©¬æ•°å­—"></a>23.æ•´æ•°è½¬ç½—é©¬æ•°å­—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬12é¢˜ï¼šæ•´æ•°è½¬ç½—é©¬æ•°å­—</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦ï¼šIï¼Œ Vï¼Œ Xï¼ŒLï¼ŒCï¼ŒD å’Œ Mã€‚</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦          æ•°å€¼</span><br><span class="line">I             1</span><br><span class="line">V             5</span><br><span class="line">X             10</span><br><span class="line">L             50</span><br><span class="line">C             100</span><br><span class="line">D             500</span><br><span class="line">M             1000</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš II ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1ã€‚12 å†™åš XII ï¼Œå³ä¸º X + II ã€‚27 å†™åš  XXVIIï¼Œ å³ä¸º XX + V + II ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš IIIIï¼Œè€Œæ˜¯ IVã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º IXã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š</p>
<p>I å¯ä»¥æ”¾åœ¨ V (5) å’Œ X (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚</p>
<p>X å¯ä»¥æ”¾åœ¨ L (50) å’Œ C (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚</p>
<p>C å¯ä»¥æ”¾åœ¨ D (500) å’Œ M (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚</p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œå°†å…¶è½¬ä¸ºç½—é©¬æ•°å­—ã€‚è¾“å…¥ç¡®ä¿åœ¨ 1 åˆ° 3999 çš„èŒƒå›´å†…ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 3</span><br><span class="line">è¾“å‡º: &quot;III&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 4</span><br><span class="line">è¾“å‡º: &quot;IV&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 9</span><br><span class="line">è¾“å‡º: &quot;IX&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 4:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 58</span><br><span class="line">è¾“å‡º: &quot;LVIII&quot;</span><br><span class="line">è§£é‡Š: L = 50, V = 5, III = 3.</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 5:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 1994</span><br><span class="line">è¾“å‡º: &quot;MCMXCIV&quot;</span><br><span class="line">è§£é‡Š: M = 1000, CM = 900, XC = 90, IV = 4.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬æŠŠé¢˜ç›®ä¸­æ‰€æœ‰çš„å­—ç¬¦åˆ—å‡ºæ¥ï¼Œä¸€äº›ç‰¹æ®Šçš„è§„åˆ™ä¹Ÿå¾—åˆ—å‡ºæ¥ã€‚å‡è®¾æˆ‘ä»¬è¦æ‰¾çš„æ•°ä¸º2834ï¼Œå¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼ˆå…¶å®æ˜¯ä¸€ç§ç±»ä¼¼è´ªå¿ƒçš„æ€æƒ³ï¼‰ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/117.png" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intToRoman</span>(<span class="params">self, num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        nums = [<span class="number">1000</span>, <span class="number">900</span>, <span class="number">500</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">90</span>, <span class="number">50</span>, <span class="number">40</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line">        romas = [<span class="string">&quot;M&quot;</span>, <span class="string">&quot;CM&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;XC&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;XL&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;IX&quot;</span>, <span class="string">&quot;V&quot;</span>, <span class="string">&quot;IV&quot;</span>, <span class="string">&quot;I&quot;</span>]</span><br><span class="line">        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> num &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> num &gt;= nums[index]:</span><br><span class="line">                result += romas[index]</span><br><span class="line">                num -= nums[index]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†88.55% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†5.03% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] values = &#123;<span class="number">1000</span>, <span class="number">900</span>, <span class="number">500</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">90</span>, <span class="number">50</span>, <span class="number">40</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    String[] symbols = &#123;<span class="string">&quot;M&quot;</span>, <span class="string">&quot;CM&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;XC&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;XL&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;IX&quot;</span>, <span class="string">&quot;V&quot;</span>, <span class="string">&quot;IV&quot;</span>, <span class="string">&quot;I&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intToRoman</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        StringBuffer roman = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> value = values[i];</span><br><span class="line">            String symbol = symbols[i];</span><br><span class="line">            <span class="keyword">while</span> (num &gt;= value) &#123;</span><br><span class="line">                num -= value;</span><br><span class="line">                roman.append(symbol);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (num == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roman.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š6 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†47.30% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†72.05% çš„ç”¨æˆ·</p>
<h3 id="24-è·å…°å›½æ——é—®é¢˜"><a href="#24-è·å…°å›½æ——é—®é¢˜" class="headerlink" title="24.è·å…°å›½æ——é—®é¢˜"></a>24.è·å…°å›½æ——é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬75é¢˜ï¼šè·å…°å›½æ——é—®é¢˜ï¼šç°åœ¨æœ‰è‹¥å¹²ä¸ªçº¢ã€ç™½ã€è“ä¸‰ç§é¢œè‰²çš„çƒéšæœºæ’åˆ—æˆä¸€æ¡ç›´çº¿ã€‚ç°åœ¨æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æŠŠè¿™äº›çƒæŒ‰ç…§çº¢ã€ç™½ã€è“æ’åºã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¿™ä¸ªé—®é¢˜ä¹‹æ‰€ä»¥å«è·å…°å›½æ——ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥å°†çº¢ç™½è“ä¸‰è‰²å°çƒæƒ³è±¡æˆæ¡çŠ¶ç‰©ï¼Œæœ‰åºæ’åˆ—åæ­£å¥½ç»„æˆè·å…°å›½æ——ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/118.png" alt></p>
<blockquote>
<p>æ”¹æˆè¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/119.png" alt><br>é‚£æ€»å…±å°±ä¸‰ä¸ªé¢œè‰²ï¼Œæˆ‘ä»¬è¦åŒºåˆ†å¼€æ¥ï¼Œæ˜¯ä¸æ˜¯æœ€å°‘éœ€è¦ä¸¤æ¡åˆ†éš”çº¿ï¼ŸAçº¿çš„å·¦ä¾§ä¸º0ï¼Œå³ä¾§ä¸º1ã€‚Bçº¿çš„å·¦ä¾§ä¸º1ï¼Œå³ä¾§ä¸º2ã€‚</p>
<p>å‰©ä¸‹çš„æ˜¯ä¸æ˜¯åªéœ€è¦æŠŠ Açº¿ å’Œ Bçº¿ é—´çš„æ•°æ®ç»´æŠ¤æˆæ»¡è¶³ AB çº¿çš„è§„åˆ™å°±å¯ä»¥äº†ï¼Ÿé‚£è¦ç»´æŠ¤ AB çº¿é—´çš„æ•°æ®ï¼Œæ˜¯ä¸æ˜¯è‡³å°‘ä½ å¾—éå†ä¸‹ AB çº¿é—´çš„æ•°æ®ï¼Ÿæˆ‘ä»¬ä» C ä½ç½®å¤„å¼€å§‹ã€‚</p>
<ul>
<li>1ï¼‰è‹¥éå†åˆ°çš„ä½ç½®ä¸º0ï¼Œåˆ™è¯´æ˜å®ƒä¸€å®šä½äºAçš„å·¦ä¾§ã€‚äºæ˜¯å°±å’ŒAå¤„çš„å…ƒç´ äº¤æ¢ï¼ŒåŒæ—¶å‘å³ç§»åŠ¨Aå’ŒCã€‚</li>
<li>2ï¼‰è‹¥éå†åˆ°çš„ä½ç½®ä¸º1ï¼Œåˆ™è¯´æ˜å®ƒä¸€å®šä½äºABä¹‹é—´ï¼Œæ»¡è¶³è§„åˆ™ï¼Œä¸éœ€è¦åŠ¨å¼¹ã€‚åªéœ€å‘å³ç§»åŠ¨Cã€‚</li>
<li>3ï¼‰è‹¥éå†åˆ°çš„ä½ç½®ä¸º2ï¼Œåˆ™è¯´æ˜å®ƒä¸€å®šä½äºBçš„å³ä¾§ã€‚äºæ˜¯å°±å’ŒBå¤„çš„å…ƒç´ äº¤æ¢ï¼Œäº¤æ¢ååªæŠŠBå‘å·¦ç§»åŠ¨ï¼ŒCä»ç„¶æŒ‡å‘åŸä½ç½®ã€‚ï¼ˆå› ä¸ºäº¤æ¢åçš„Cå¯èƒ½æ˜¯å±äºAä¹‹å‰çš„ï¼Œæ‰€ä»¥Cä»ç„¶æŒ‡å‘åŸä½ç½®ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortColors</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        a = c = <span class="number">0</span></span><br><span class="line">        b = <span class="built_in">len</span>(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> c &lt;= b:</span><br><span class="line">            <span class="keyword">if</span> nums[c] == <span class="number">0</span>:</span><br><span class="line">                nums[a], nums[c] = nums[c], nums[a]</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">                c += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> nums[c] == <span class="number">2</span>:</span><br><span class="line">                nums[c], nums[b] = nums[b], nums[c]</span><br><span class="line">                b -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†86.24% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.10% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sortColors</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> r = nums.length;</span><br><span class="line">        <span class="keyword">int</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(cur &lt; r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[cur] &lt; <span class="number">1</span>) swap(nums, ++l, cur++);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[cur] &gt; <span class="number">1</span>) swap(nums, --r, cur);</span><br><span class="line">            <span class="keyword">else</span> cur++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†84.85% çš„ç”¨æˆ·</p>
<h3 id="25-å…­ä¹é—®é¢˜"><a href="#25-å…­ä¹é—®é¢˜" class="headerlink" title="25.å…­ä¹é—®é¢˜"></a>25.å…­ä¹é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬1323é¢˜ï¼š6 å’Œ 9 ç»„æˆçš„æœ€å¤§æ•°å­—</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™ä½ ä¸€ä¸ªä»…ç”±æ•°å­— 6 å’Œ 9 ç»„æˆçš„æ­£æ•´æ•° <code>num</code>ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/120.png" alt></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnum = 9669</span><br><span class="line">è¾“å‡ºï¼š9969</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æ”¹å˜ç¬¬ä¸€ä½æ•°å­—å¯ä»¥å¾—åˆ° 6669 ã€‚</span><br><span class="line">æ”¹å˜ç¬¬äºŒä½æ•°å­—å¯ä»¥å¾—åˆ° 9969 ã€‚</span><br><span class="line">æ”¹å˜ç¬¬ä¸‰ä½æ•°å­—å¯ä»¥å¾—åˆ° 9699 ã€‚</span><br><span class="line">æ”¹å˜ç¬¬å››ä½æ•°å­—å¯ä»¥å¾—åˆ° 9666 ã€‚</span><br><span class="line">å…¶ä¸­æœ€å¤§çš„æ•°å­—æ˜¯ 9969 ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬åªè¦æ‰¾åˆ° num ä¸­æœ€é«˜ä½çš„ 6ï¼Œå°†å…¶ç¿»è½¬æˆ 9ï¼Œå°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximum69Number</span> (<span class="params">self, num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">str</span>(num).replace(<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:60 ms,å‡»è´¥äº†5.65% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†5.20% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximum69Number</span> <span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        String res = Integer.toString(num);</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(res.replaceFirst(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;9&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š5 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†37.53% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š35.3 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†64.39% çš„ç”¨æˆ·</p>
<h3 id="26-æœ‰æ•ˆçš„æ•°ç‹¬"><a href="#26-æœ‰æ•ˆçš„æ•°ç‹¬" class="headerlink" title="26.æœ‰æ•ˆçš„æ•°ç‹¬"></a>26.æœ‰æ•ˆçš„æ•°ç‹¬</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬36é¢˜ï¼šæœ‰æ•ˆçš„æ•°ç‹¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ¤æ–­ä¸€ä¸ª 9x9 çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦æ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>æ•°å­— 1-9 åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li>
<li>æ•°å­— 1-9 åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li>
<li>æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ 3x3 å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[</span><br><span class="line"></span><br><span class="line">  [&quot;5&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;,&quot;9&quot;,&quot;5&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;.&quot;,&quot;9&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;3&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;4&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;8&quot;,&quot;.&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;4&quot;,&quot;1&quot;,&quot;9&quot;,&quot;.&quot;,&quot;.&quot;,&quot;5&quot;],</span><br><span class="line"></span><br><span class="line">  [&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;9&quot;]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: true</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line"></span><br><span class="line">æ•°ç‹¬éƒ¨åˆ†ç©ºæ ¼å†…å·²å¡«å…¥äº†æ•°å­—ï¼Œç©ºç™½æ ¼ç”¨ &#x27;.&#x27; è¡¨ç¤ºã€‚</span><br></pre></td></tr></table></figure>
<p><strong>è¯´æ˜:</strong></p>
<p><strong>ä¸€ä¸ªæœ‰æ•ˆçš„æ•°ç‹¬ï¼ˆéƒ¨åˆ†å·²è¢«å¡«å……ï¼‰ä¸ä¸€å®šæ˜¯å¯è§£çš„ã€‚</strong></p>
<p>åªéœ€è¦æ ¹æ®ä»¥ä¸Šè§„åˆ™ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚</p>
<p>ç»™å®šæ•°ç‹¬åºåˆ—åªåŒ…å«æ•°å­— 1-9 å’Œå­—ç¬¦ â€˜.â€™ ã€‚</p>
<p>ç»™å®šæ•°ç‹¬æ°¸è¿œæ˜¯ 9x9 å½¢å¼çš„ã€‚</p>
<p>ç”»å‡ºæ¥å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/121.png" alt></p>
<blockquote>
<p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯<strong>ç”¨ç¨‹åºæ¥å®Œæˆè¿™ä¸ªéªŒè¯çš„è¿‡ç¨‹</strong>ï¼Œå¦‚ä½•éªŒè¯ï¼Ÿé‚£å…¶å®å°±ä¸¤æ­¥ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šéå†æ•°ç‹¬ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ </li>
<li>ç¬¬äºŒæ­¥ï¼šéªŒè¯è¯¥å…ƒç´ æ˜¯å¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶</li>
</ul>
<p>éå†è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œ<strong>ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹è¿›è¡Œéå†å³å¯</strong>ã€‚å°±ä¸€ä¸ªä¸¤å±‚å¾ªç¯ã€‚å› ä¸ºé¢˜ç›®æœ¬èº«å°±æ˜¯å¸¸æ•°çº§çš„è§„æ¨¡ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼šå¦‚ä½•éªŒè¯å…ƒç´ åœ¨ è¡Œ / åˆ— / å­æ•°ç‹¬ä¸­æ²¡æœ‰é‡å¤é¡¹ï¼Ÿ</p>
<p>å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å»ºç«‹ä¸‰ä¸ªæ•°ç»„åˆ†åˆ«è®°å½•æ¯è¡Œï¼Œæ¯åˆ—ï¼Œæ¯ä¸ªå­æ•°ç‹¬ï¼ˆå­æ•°ç‹¬å°±æ˜¯ä¸Šé¢å„ç§é¢œè‰²çš„å°æ¡†æ¡†ï¼‰ä¸­å‡ºç°çš„æ•°å­—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JAVA</span></span><br><span class="line"><span class="keyword">int</span>[][] rows = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="keyword">int</span>[][] col = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="keyword">int</span>[][] sbox = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œåˆšå¼€å§‹çš„æ—¶å€™ä»–ä»¬éƒ½æ˜¯ç©ºçš„ã€‚ç„¶å<strong>æ¯éå†åˆ°ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹è¿™ä¸ªå…ƒç´ åœ¨é‡Œè¾¹å­˜ä¸å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±æ”¾è¿›å»ï¼Œå­˜åœ¨é‚£è¯´æ˜æ•°ç‹¬ä¸åˆæ³•ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/122.png" alt></p>
<p>æ¯”å¦‚è¿™ä¸ªæ•°ç‹¬ã€‚ç¬¬6è¡Œ5åˆ—ä¸º2ï¼Œé‚£æˆ‘ä»¬å°±å¯¹ rows å’Œ col è¿›è¡Œè®¾ç½®ï¼šï¼ˆ1è¡¨ç¤ºå…ƒç´ å­˜åœ¨)<br>    rows[å½“å‰è¡Œ-1][å½“å‰å…ƒç´ å€¼-1] = rows[6-1][2-1] = 1<br>    col[å½“å‰åˆ—-1][å½“å‰å…ƒç´ å€¼-1] = col[5-1][2-1] = 1</p>
<p>ç°åœ¨çš„é¢˜æ˜¯ï¼Œå¯¹äº sbox è¯¥å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿæˆ‘ä»¬ç”¨ä¸‹é¢çš„å…¬å¼æ¥è®¡ç®—å¾—åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">boxIndex = (row / 3) * 3 + columns / 3</span><br></pre></td></tr></table></figure>
<p>å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼šæˆ‘ä»¬æŠŠä¸Šé¢çš„ç¬¬6è¡Œ5åˆ—ä»£å…¥åˆ°è¿™ä¸ªå…¬å¼é‡Œï¼Œ(5 / 3) * 3 + 4 / 3 = 3 + 1 = 4ã€‚è¿™ä¸ª 4 ä¹Ÿå°±ä»£è¡¨æœ€ç»ˆè½åˆ° 4 çš„è¿™ä¸ªå°åŒºåŸŸä¸­ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/123.png" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidSudoku</span>(<span class="params">self, board: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        rows = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        cols = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        sbox = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board[<span class="number">0</span>])):</span><br><span class="line">                <span class="keyword">if</span> board[i][j] != <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">                    num = <span class="built_in">int</span>(board[i][j]) - <span class="number">1</span></span><br><span class="line">                    boxIndex = (i // <span class="number">3</span>) * <span class="number">3</span> + j // <span class="number">3</span></span><br><span class="line">                    <span class="keyword">if</span> rows[i][num] == <span class="number">1</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                    rows[i][num] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> cols[j][num] == <span class="number">1</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                    cols[j][num] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> sbox[boxIndex][num] == <span class="number">1</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                    sbox[boxIndex][num] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:56 ms,å‡»è´¥äº†46.19% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.10% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidSudoku</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] rows = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="keyword">int</span>[][] col = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="keyword">int</span>[][] sbox = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(board[i][j] != <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">int</span> num = board[i][j] - <span class="string">&#x27;0&#x27;</span> - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">int</span> boxIndex = i / <span class="number">3</span> * <span class="number">3</span> + j / <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">if</span>(rows[i][num] == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    rows[i][num] = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(col[j][num] == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    col[j][num] = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(sbox[boxIndex][num] == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    sbox[boxIndex][num] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š2 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.35% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†55.46% çš„ç”¨æˆ·</p>
<h3 id="27-è´¹ç±³ä¼°ç®—"><a href="#27-è´¹ç±³ä¼°ç®—" class="headerlink" title="27.è´¹ç±³ä¼°ç®—"></a>27.è´¹ç±³ä¼°ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é—®é¢˜ï¼šåŒ—äº¬æœ‰å¤šå°‘åŠ æ²¹ç«™ï¼Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯¹çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œè¿™å°±æ˜¯åŸé¢˜ã€‚ã€‚ã€‚</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>æˆªæ­¢åˆ°2019å¹´ï¼ŒåŒ—äº¬å…±æœ‰1063ä¸ªåŠ æ²¹ç«™</p>
<p>è¿™é“é¢˜ç›®ä¸»è¦è€ƒå¯Ÿäººçš„ä¼°ç®—èƒ½åŠ›ã€‚è€Œä¼°ç®—ç•Œï¼Œæœ‰ä¸€ä¸ªä¼°ç®—å¤§ç‰›å«åšè´¹ç±³ã€‚</p>
<p>è´¹ç±³ä¼°ç®—ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯å°†<strong>æ­£ç¡®ç­”æ¡ˆï¼Œè½¬åŒ–ä¸ºä¸€ç³»åˆ—ä¼°ç®—å˜é‡çš„ä¹˜æ³•</strong>ã€‚é¦–å…ˆè¦æŠŠå˜é‡é€‰çš„å‡†ç¡®ï¼Œå…¶æ¬¡è¦æŠŠå˜é‡ä¼°çš„å‡†ç¡®ã€‚å›åˆ°æœ¬é¢˜ï¼Œæˆ‘ä»¬è¦åˆ†æçš„é—®é¢˜æ˜¯ï¼šåŒ—äº¬æœ‰å¤šå°‘åŠ æ²¹ç«™ï¼Ÿ</p>
<p>é‚£æˆ‘ä»¬è‡³å°‘å¾—æœ‰å¤šå°‘è¾†è½¦å§ï¼Ÿä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„è½¦ï¼Œæ¯å¤©éƒ½ä¼šä¸Šè·¯ã€‚æ‰€ä»¥å‡†ç¡®çš„è¯´æˆ‘ä»¬éœ€è¦çŸ¥é“æ¯å¤©ä¸Šè·¯çš„è½¦æœ‰å¤šå°‘ã€‚</p>
<p>ä½†æ˜¯æ˜¯æ‰€æœ‰ä¸Šè·¯çš„è½¦éƒ½éœ€è¦åŠ æ²¹å—ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—æ”¹æ”¹ï¼šæ¯å¤©ä¸Šè·¯éœ€è¦åŠ æ²¹çš„è½¦æœ‰å¤šå°‘ï¼Ÿ</p>
<p>çŸ¥é“äº†æ¯å¤©ä¸Šè·¯éœ€è¦åŠ æ²¹çš„è½¦è¾†æ•°ï¼Œæˆ‘ä»¬å¾—çŸ¥é“æ¯ä¸ªåŠ æ²¹ç«™å¯ä»¥æ»¡è¶³å¤šå°‘è¾†è½¦å§ï¼Ÿ</p>
<p>é‚£åŠ æ²¹ç«™ç”¨ä»€ä¹ˆæ»¡è¶³è½¦ï¼Ÿè‡ªç„¶æ˜¯æ²¹å’¯ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•çŸ¥é“æ¯å¤©ä¸Šè·¯éœ€è¦åŠ æ²¹çš„è½¦è¾†æ•°ï¼Ÿæ˜¯ä¸æ˜¯æˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸º åŒ—äº¬è½¦è¾†æ€»æ•° / åŠ æ²¹é¢‘æ¬¡ã€‚</p>
<p>è¿™ä¸ªåŠ æ²¹é¢‘æ¬¡ï¼Œç›¸ä¿¡å¤§å®¶å°±å¾ˆå®¹æ˜“ä¼°ç®—å‡ºæ¥äº†ã€‚è·‘æ»´æ»´çš„ä¸€å¤©ä¸€æ¬¡æ²¹ï¼Œæ­£å¸¸å¼€çš„è¯ä¸€å‘¨ä¸€æ¬¡ï¼Œå¼€çš„å°‘ä¸€ç‚¹çš„è¯å·®ä¸å¤šåŠä¸ªæœˆä¸€æ¬¡ã€‚</p>
<p>â‘  æ¯å¤©ä¸Šè·¯éœ€è¦åŠ æ²¹çš„è½¦è¾†æ•°   â‘¡ æ¯ä¸ªåŠ æ²¹ç«™çš„å®¹é‡</p>
<p>æ‰€ä»¥æˆ‘ä»¬åªè¦å›ç­”å‡ºä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œå†ç»™å‡ºè®¡ç®—å…¬å¼ã€‚å°±å¯ä»¥å¾ˆå®Œç¾çš„è§£ç­”æœ¬é¢˜äº†ï¼</p>
</blockquote>
<h3 id="28-åˆ†å‘é¥¼å¹²"><a href="#28-åˆ†å‘é¥¼å¹²" class="headerlink" title="28.åˆ†å‘é¥¼å¹²"></a>28.åˆ†å‘é¥¼å¹²</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢˜ç›®455ï¼šåˆ†å‘é¥¼å¹²</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡è®¾ä½ æ˜¯ä¸€ä½å¾ˆæ£’ï¼ˆå¤šæ£’ï¼Ÿï¼Ÿï¼Ÿï¼‰çš„å®¶é•¿ï¼Œæƒ³è¦ç»™ä½ çš„å­©å­ä»¬ä¸€äº›å°é¥¼å¹²ï¼ˆä¸èƒ½ç»™å¤§é¥¼å¹²å—ï¼Ÿï¼Ÿï¼Ÿï¼‰ä½†æ˜¯ï¼Œæ¯ä¸ªå­©å­æœ€å¤šåªèƒ½ç»™ä¸€å—é¥¼å¹²ï¼ˆæœ‰æ¯’å§ã€‚ã€‚ã€‚ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>å¯¹æ¯ä¸ªå­©å­ i ï¼Œéƒ½æœ‰ä¸€ä¸ªèƒƒå£å€¼ gi ï¼Œè¿™æ˜¯èƒ½è®©å­©å­ä»¬æ»¡è¶³èƒƒå£çš„é¥¼å¹²çš„æœ€å°å°ºå¯¸ï¼›å¹¶ä¸”æ¯å—é¥¼å¹² j ï¼Œéƒ½æœ‰ä¸€ä¸ªå°ºå¯¸ sj ã€‚å¦‚æœ sj &gt;= gi  ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé¥¼å¹² j åˆ†é…ç»™å­©å­ i ï¼Œè¿™ä¸ªå­©å­ä¼šå¾—åˆ°æ»¡è¶³ã€‚ä½ çš„ç›®æ ‡æ˜¯å°½å¯èƒ½æ»¡è¶³è¶Šå¤šæ•°é‡çš„å­©å­ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªæœ€å¤§æ•°å€¼ã€‚</p>
<p>æ³¨æ„ï¼šä½ å¯ä»¥å‡è®¾èƒƒå£å€¼ä¸ºæ­£ï¼ˆç‰¹ä¹ˆä¸æ­£éš¾é“å¾€å¤–åå—ï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚ä¸€ä¸ªå°æœ‹å‹æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€å—é¥¼å¹²ã€‚</p>
<p><strong>ç¤ºä¾‹ :</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3], [1,1] </span><br><span class="line">è¾“å‡º: 1 </span><br><span class="line"></span><br><span class="line">è§£é‡Š: </span><br><span class="line">ä½ æœ‰ä¸‰ä¸ªå­©å­å’Œä¸¤å—å°é¥¼å¹²ï¼Œ3ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯ï¼š1,2,3ã€‚</span><br><span class="line">è™½ç„¶ä½ æœ‰ä¸¤å—å°é¥¼å¹²ï¼Œç”±äºä»–ä»¬çš„å°ºå¯¸éƒ½æ˜¯1ï¼Œä½ åªèƒ½è®©èƒƒå£å€¼æ˜¯1çš„å­©å­æ»¡è¶³ã€‚</span><br><span class="line">æ‰€ä»¥ä½ åº”è¯¥è¾“å‡º1ã€‚ </span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶å®ç­–ç•¥å°±å¾ˆç®€å•äº†ï¼š<strong>æˆ‘ä»¬åªéœ€è¦åœ¨æ»¡è¶³å­©å­èƒƒå£çš„å‰æä¸‹ï¼Œå°½å¯èƒ½åˆ†é…å°çš„é¥¼å¹²ç»™åˆ°ä»–</strong>ã€‚</p>
<p>å…·ä½“æ€ä¹ˆåšå‘¢ï¼Œæˆ‘ä»¬æŠŠé¥¼å¹²å’Œå°æœ‹å‹éƒ½æŒ‰ç…§<strong>ä»å¤§åˆ°å°</strong>æ’åˆ—ã€‚</p>
<ul>
<li>å¦‚æœæœ€å¤§çš„é¥¼å¹²å¯ä»¥æ»¡è¶³è‚šå­æœ€å¤§çš„å­©å­ï¼Œé‚£å°±ç»™ä»–åƒï¼ŒåŒæ—¶æ¯”è¾ƒä¸‹ä¸€ä¸ªã€‚</li>
<li>å¦‚æœæœ€å¤§çš„é¥¼å¹²ä¸èƒ½æ»¡è¶³è‚šå­æœ€å¤§çš„å­©å­ï¼Œ<strong>é‚£å°±è®©ä»–é¥¿ç€</strong>ï¼Œç„¶åçœ‹çœ‹èƒ½ä¸èƒ½æ»¡è¶³ç¬¬äºŒä¸ªå­©å­ã€‚ï¼ˆæœ‰ç‚¹é»‘æš—ç³»ï¼Œ<strong>æ”¾å¼ƒå°æœ‹å‹</strong>ï¼‰</li>
</ul>
<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ã€‚å‡­ä»€ä¹ˆå°±è¦å…ˆæ»¡è¶³è‚šå­æœ€å¤§çš„å­©å­ã€‚æŒ‰é“ç†è®²ï¼Œè‚šå­è¶Šå¤§åº”è¯¥è¶Šæ‰›é¥¿æ‰å¯¹å§ã€‚æ‰€ä»¥æˆ‘ä»¬æ¢ç§æ€è·¯ï¼Œä»<strong>è‚šå­æœ€å°çš„å­©å­</strong>å¼€å§‹ã€‚</p>
<ul>
<li>å¦‚æœæœ€å°çš„é¥¼å¹²å¯ä»¥æ»¡è¶³è‚šå­æœ€å°çš„å­©å­ï¼Œé‚£å°±ç»™ä»–åƒï¼ŒåŒæ—¶æ¯”è¾ƒä¸‹ä¸€ä¸ªã€‚</li>
<li>å¦‚æœæœ€å°çš„é¥¼å¹²ä¸èƒ½æ»¡è¶³è‚šå­æœ€å°çš„å­©å­ï¼Œ<strong>é‚£å°±æ‰”æ‰é¥¼å¹²</strong>ï¼Œçœ‹çœ‹ä¸‹ä¸€ä¸ªé¥¼å¹²èƒ½ä¸èƒ½ç»™ä»–åƒã€‚ï¼ˆ<strong>æ”¾å¼ƒçš„æ˜¯é¥¼å¹²</strong>ï¼‰</li>
</ul>
<p>é‚£è¿™ä¸¤ç§å…¶å®éƒ½ç®—æ˜¯è´ªå¿ƒï¼š</p>
<ul>
<li>ä¸€ç§æ˜¯èƒƒå£å¤ªå¤§è½®åˆ°ä¸‹ä¸€ä¸ªå­©å­</li>
<li>ä¸€ç§æ˜¯é¥¼å¹²å¤ªå°è½®åˆ°ä¸‹ä¸€ä¸ªé¥¼å¹²</li>
</ul>
<p>å› ä¸ºè¦åŒæ—¶æ§åˆ¶é¥¼å¹²å’Œå°å­©ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨åŒæŒ‡é’ˆã€‚è¿™é‡Œç»™å‡ºå…ˆæ»¡è¶³å°è‚šå­å­©å­çš„ä»£ç ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findContentChildren</span>(<span class="params">self, g: <span class="type">List</span>[<span class="built_in">int</span>], s: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        g.sort()</span><br><span class="line">        s.sort()</span><br><span class="line">        gi, si = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> gi &lt; <span class="built_in">len</span>(g) <span class="keyword">and</span> si &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> g[gi] &lt;= s[si]:</span><br><span class="line">                gi+=<span class="number">1</span></span><br><span class="line">            si+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> gi</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:60 ms,å‡»è´¥äº†92.10% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:16.1 MB,å‡»è´¥äº†5.14% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findContentChildren</span><span class="params">(<span class="keyword">int</span>[] g, <span class="keyword">int</span>[] s)</span> </span>&#123;</span><br><span class="line">        Arrays.sort(g);</span><br><span class="line">        Arrays.sort(s);</span><br><span class="line">        <span class="keyword">int</span> ch = <span class="number">0</span>, bis = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(ch &lt; g.length &amp;&amp; bis &lt; s.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(g[ch] &lt;= s[bis]) ch++;</span><br><span class="line">            bis++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ch;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š9 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†21.24% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š39.2 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†50.44% çš„ç”¨æˆ·</p>
<h3 id="29-ç”Ÿå‘½æ¸¸æˆ"><a href="#29-ç”Ÿå‘½æ¸¸æˆ" class="headerlink" title="29.ç”Ÿå‘½æ¸¸æˆ"></a>29.ç”Ÿå‘½æ¸¸æˆ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬289é¢˜ï¼šç”Ÿå‘½æ¸¸æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªåŒ…å« m Ã— n ä¸ªæ ¼å­çš„é¢æ¿ï¼Œæ¯ä¸€ä¸ªæ ¼å­éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç»†èƒã€‚æ¯ä¸ªç»†èƒéƒ½å…·æœ‰ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼š1 å³ä¸ºæ´»ç»†èƒï¼ˆliveï¼‰ï¼Œæˆ– 0 å³ä¸ºæ­»ç»†èƒï¼ˆdeadï¼‰ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>æ¯ä¸ªç»†èƒä¸å…¶å…«ä¸ªç›¸é‚»ä½ç½®ï¼ˆæ°´å¹³ï¼Œå‚ç›´ï¼Œå¯¹è§’çº¿ï¼‰çš„ç»†èƒéƒ½éµå¾ªä»¥ä¸‹å››æ¡ç”Ÿå­˜å®šå¾‹ï¼š</p>
<ul>
<li>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®çš„æ´»ç»†èƒæ•°å°‘äºä¸¤ä¸ªï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›</li>
<li>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒä»ç„¶å­˜æ´»ï¼›</li>
<li>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰è¶…è¿‡ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›</li>
<li>å¦‚æœæ­»ç»†èƒå‘¨å›´æ­£å¥½æœ‰ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ­»ç»†èƒå¤æ´»ï¼›</li>
</ul>
<p>æ ¹æ®å½“å‰çŠ¶æ€ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—é¢æ¿ä¸Šæ‰€æœ‰ç»†èƒçš„ä¸‹ä¸€ä¸ªï¼ˆä¸€æ¬¡æ›´æ–°åçš„ï¼‰çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯é€šè¿‡å°†ä¸Šè¿°è§„åˆ™åŒæ—¶åº”ç”¨äºå½“å‰çŠ¶æ€ä¸‹çš„æ¯ä¸ªç»†èƒæ‰€å½¢æˆçš„ï¼Œå…¶ä¸­ç»†èƒçš„å‡ºç”Ÿå’Œæ­»äº¡æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚</p>
<p>é¢˜ç›®æœ‰ç‚¹å¤æ‚ï¼Œä¸¾ä¾‹è¯´æ˜ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/124.png" alt></p>
<p>æ³¨æ„ï¼š<strong>é¢æ¿ä¸Šæ‰€æœ‰æ ¼å­éœ€è¦åŒæ—¶è¢«æ›´æ–°</strong>ï¼šä½ ä¸èƒ½å…ˆæ›´æ–°æŸäº›æ ¼å­ï¼Œç„¶åä½¿ç”¨å®ƒä»¬çš„æ›´æ–°åçš„å€¼å†æ›´æ–°å…¶ä»–æ ¼å­ã€‚</p>
<blockquote>
<p>æœ€è‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼šä¸€ä¸ªä¸ªçš„æ›´æ–°ç»†èƒçŠ¶æ€ã€‚</p>
<p><strong>å·²æ›´æ–°ç»†èƒçš„çŠ¶æ€ä¼šå½±å“åˆ°å‘¨å›´å…¶ä»–è¿˜æœªæ›´æ–°ç»†èƒçŠ¶æ€çš„è®¡ç®—</strong>ã€‚è¿™æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼</p>
<p>é‚£æˆ‘ä»¬æœ€ç®€å•çš„æ€è·¯ï¼šæ˜¯ä¸æ˜¯åªè¦æˆ‘ä»¬èƒ½ä¸€ç›´è·å–åŸå§‹æ•°ç»„çš„æ•°æ®ï¼Œä¸å°±å¯ä»¥ä¿è¯æ›´æ–°ä¸€ç›´æ­£ç¡®äº†å—ï¼è‡³äºåœ¨å“ªé‡Œï¼Œå…¶å®ä¸ç®¡æ˜¯copyä¸€ä¸ªæ•°ç»„ï¼Œè¿˜æ˜¯è¯´ç”¨hashmapå­˜ä¸€ä¸‹æ•°å€¼å…¶å®éƒ½okã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gameOfLife</span>(<span class="params">self, board: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="comment"># æ¯ä¸ªç»†èƒç»Ÿå‘¨å›´å…«ä¸ªç›¸é‚»ä½ç½®çš„åç§»é‡</span></span><br><span class="line">        neighbors = [<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># åˆ›å»ºå¤åˆ¶æ•°ç»„ copyBoard</span></span><br><span class="line">        <span class="comment"># æ³¨æ„ç›´æ¥ç”¨åˆ‡ç‰‡çš„æ–¹å¼æˆ–è€…list()æ–¹å¼æ˜¯æµ…å¤åˆ¶ï¼Œè¢«å‘äº†å¥½ä¹…ã€‚ã€‚ã€‚</span></span><br><span class="line">        copyBoard = [[<span class="number">0</span>] * <span class="built_in">len</span>(board[<span class="number">0</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board))]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board[<span class="number">0</span>])):</span><br><span class="line">                copyBoard[i][j] = board[i][j]</span><br><span class="line">        <span class="comment"># éå†é¢æ¿æ¯ä¸€ä¸ªæ ¼å­é‡Œçš„ç»†èƒ</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board)):</span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board[<span class="number">0</span>])):</span><br><span class="line">                <span class="comment"># å¯¹äºæ¯ä¸€ä¸ªç»†èƒç»Ÿè®¡å…¶å…«ä¸ªç›¸é‚»ä½ç½®é‡Œçš„æ´»ç»†èƒæ•°é‡</span></span><br><span class="line">                liveNeighbors = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                        <span class="keyword">if</span> neighbors[i] != <span class="number">0</span> <span class="keyword">or</span> neighbors[j] != <span class="number">0</span>:</span><br><span class="line">                            r = row + neighbors[i]</span><br><span class="line">                            c = col + neighbors[j]</span><br><span class="line">                            <span class="comment"># æŸ¥çœ‹ç›¸é‚»çš„ç»†èƒæ˜¯å¦æ˜¯æ´»ç»†èƒ</span></span><br><span class="line">                            <span class="keyword">if</span> r &lt; <span class="built_in">len</span>(board) <span class="keyword">and</span> r &gt;= <span class="number">0</span> <span class="keyword">and</span> c &lt; <span class="built_in">len</span>(board[<span class="number">0</span>]) <span class="keyword">and</span> c &gt;= <span class="number">0</span> <span class="keyword">and</span> copyBoard[r][c] == <span class="number">1</span>:</span><br><span class="line">                                liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># è§„åˆ™ 1 æˆ–è§„åˆ™ 3</span></span><br><span class="line">                <span class="keyword">if</span> copyBoard[row][col] == <span class="number">1</span> <span class="keyword">and</span> (liveNeighbors &lt; <span class="number">2</span> <span class="keyword">or</span> liveNeighbors &gt; <span class="number">3</span>):</span><br><span class="line">                    board[row][col] = <span class="number">0</span></span><br><span class="line">                <span class="comment"># è§„åˆ™ 4</span></span><br><span class="line">                <span class="keyword">if</span> copyBoard[row][col] == <span class="number">0</span> <span class="keyword">and</span> liveNeighbors == <span class="number">3</span>:</span><br><span class="line">                    board[row][col] = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†71.15% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†7.69% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] neighbors = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameOfLife</span><span class="params">(<span class="keyword">int</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] copyBoard = <span class="keyword">new</span> <span class="keyword">int</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; board.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++)&#123;</span><br><span class="line">                copyBoard[i][j] = board[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; board.length; row++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; board[<span class="number">0</span>].length; col++)&#123;</span><br><span class="line">                <span class="keyword">int</span> liveNeighbors = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(neighbors[i] != <span class="number">0</span> || neighbors[j] != <span class="number">0</span>)&#123;</span><br><span class="line">                            <span class="keyword">int</span> r = row + neighbors[i];</span><br><span class="line">                            <span class="keyword">int</span> c = col + neighbors[j];</span><br><span class="line">                            <span class="keyword">if</span>(r &lt; board.length &amp;&amp; r &gt;= <span class="number">0</span> &amp;&amp; c &lt; board[<span class="number">0</span>].length &amp;&amp; c &gt;= <span class="number">0</span> &amp;&amp; copyBoard[r][c] == <span class="number">1</span>)&#123;</span><br><span class="line">                                liveNeighbors++;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(copyBoard[row][col] == <span class="number">1</span> &amp;&amp; (liveNeighbors &lt; <span class="number">2</span> || liveNeighbors &gt; <span class="number">3</span>)) board[row][col] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(copyBoard[row][col] == <span class="number">0</span> &amp;&amp; liveNeighbors == <span class="number">3</span>) board[row][col] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.8 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†53.60% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒ</strong></p>
<blockquote>
<p><strong>ä½ ä¸å°±æƒ³æ—¢å¯ä»¥ä¿å­˜åŸæ•°ç»„çš„çŠ¶æ€ï¼Œè¿˜å¯ä»¥æ›´æ–°æ–°çš„çŠ¶æ€å—ï¼Ÿè¿™äº›ç»Ÿç»Ÿéƒ½å¯ä»¥åœ¨åŸæœ‰æ•°ç»„ä¸Šæ</strong>ã€‚å…·ä½“æ€ä¹ˆæå‘¢ï¼Ÿ</p>
<ul>
<li>åŸæ¥çš„ 0 å’Œ 1 ä¸å°±æ˜¯ä»£è¡¨æ­»å’Œç”Ÿå—ï¼Ÿä½†æ˜¯ä½ è¦æ›´æ–°æ–°çš„çŠ¶æ€ï¼Œæ— éå°±æ˜¯ä»ç”Ÿ-&gt;æ­»ï¼Œä»æ­»-&gt;ç”Ÿã€‚é‚£æˆ‘ä»¬åŠ ä¸ªçŠ¶æ€ 2ï¼Œä»£è¡¨ ç”Ÿ-&gt;æ­»ï¼ŒåŠ ä¸ªçŠ¶æ€ 3 è¡¨ç¤ºä» æ­»&gt;ç”Ÿã€‚</li>
<li>å¯¹äºä¸€ä¸ªèŠ‚ç‚¹æ¥è¯´ï¼Œå¦‚æœå®ƒå‘¨è¾¹çš„ç‚¹æ˜¯ 1 æˆ–è€… 2ï¼Œå°±è¯´æ˜è¯¥ç‚¹ä¸Šä¸€è½®æ˜¯æ´»çš„ã€‚</li>
<li>æ•´ä½“ç­–ç•¥æ˜¯å®Œæˆ åŸå§‹çŠ¶æ€-&gt;è¿‡æ¸¡çŠ¶æ€-&gt;çœŸå®çŠ¶æ€ çš„è¿‡ç¨‹ã€‚</li>
<li>è¿‡æ¸¡çŠ¶æ€ åˆ° çœŸå®çŠ¶æ€ï¼Œä»£ç å°±æ˜¯æŠŠ 0 å’Œ 2 å˜å› 0ï¼Œ1 å’Œ 3 å˜å›1çš„è¿‡ç¨‹ã€‚ç”¨æ¨¡åªæ˜¯ä»£ç æŠ€å·§ã€‚</li>
<li>ç­–ç•¥å®ç°çš„ç¬¬ä¸€æ­¥æ˜¯å…ˆæ‰¾åˆ°å½“å‰èŠ‚ç‚¹å‘¨å›´çš„å­˜æ´»èŠ‚ç‚¹æ•°ã€‚</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gameOfLife</span>(<span class="params">self, board: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="comment">#  åŸå§‹çŠ¶æ€ -&gt; è¿‡æ¸¡çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board[<span class="number">0</span>])):</span><br><span class="line">                liveNeighbors = <span class="number">0</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­ä¸Šè¾¹</span></span><br><span class="line">                <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i - <span class="number">1</span>][j] == <span class="number">1</span> <span class="keyword">or</span> board[i - <span class="number">1</span>][j] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å·¦è¾¹</span></span><br><span class="line">                <span class="keyword">if</span> j &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i][j - <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i][j - <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­ä¸‹è¾¹</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(board) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i + <span class="number">1</span>][j] == <span class="number">1</span> <span class="keyword">or</span> board[i + <span class="number">1</span>][j] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å³è¾¹</span></span><br><span class="line">                <span class="keyword">if</span> j &lt; <span class="built_in">len</span>(board[<span class="number">0</span>]) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i][j + <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i][j + <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å·¦ä¸Šè§’</span></span><br><span class="line">                <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> j &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i - <span class="number">1</span>][j - <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i - <span class="number">1</span>][j - <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å³ä¸‹è§’</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(board) - <span class="number">1</span> <span class="keyword">and</span> j &lt; <span class="built_in">len</span>(board[<span class="number">0</span>]) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i + <span class="number">1</span>][j + <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i + <span class="number">1</span>][j + <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å³ä¸Šè§’</span></span><br><span class="line">                <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> j &lt; <span class="built_in">len</span>(board[<span class="number">0</span>]) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i - <span class="number">1</span>][j + <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i - <span class="number">1</span>][j + <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å·¦ä¸‹è§’</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(board) - <span class="number">1</span> <span class="keyword">and</span> j &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i + <span class="number">1</span>][j - <span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> board[i + <span class="number">1</span>][j - <span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">                        liveNeighbors += <span class="number">1</span></span><br><span class="line">                <span class="comment"># æ ¹æ®å‘¨è¾¹å­˜æ´»æ•°é‡æ›´æ–°å½“å‰ç‚¹ï¼Œç»“æœæ˜¯ 0 å’Œ 1 çš„æƒ…å†µä¸ç”¨æ›´æ–°</span></span><br><span class="line">                <span class="keyword">if</span> board[i][j] == <span class="number">0</span> <span class="keyword">and</span> liveNeighbors == <span class="number">3</span>:</span><br><span class="line">                    board[i][j] = <span class="number">3</span></span><br><span class="line">                <span class="keyword">elif</span> board[i][j] == <span class="number">1</span> <span class="keyword">and</span> (liveNeighbors &lt; <span class="number">2</span> <span class="keyword">or</span> liveNeighbors &gt; <span class="number">3</span>):</span><br><span class="line">                    board[i][j] = <span class="number">2</span></span><br><span class="line">        <span class="comment"># è¿‡æ¸¡çŠ¶æ€ -&gt; çœŸå®çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(board[<span class="number">0</span>])):</span><br><span class="line">                board[i][j] = board[i][j] % <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:52 ms,å‡»è´¥äº†15.25% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†7.69% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameOfLife</span><span class="params">(<span class="keyword">int</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; board.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++)&#123;</span><br><span class="line">                <span class="keyword">int</span> liveNeighbors = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; (board[i-<span class="number">1</span>][j] == <span class="number">1</span> || board[i-<span class="number">1</span>][j] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(j &gt; <span class="number">0</span> &amp;&amp; (board[i][j-<span class="number">1</span>] == <span class="number">1</span> || board[i][j-<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(i &lt; board.length-<span class="number">1</span> &amp;&amp; (board[i+<span class="number">1</span>][j] == <span class="number">1</span> || board[i+<span class="number">1</span>][j] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(j &lt; board[<span class="number">0</span>].length-<span class="number">1</span> &amp;&amp; (board[i][j+<span class="number">1</span>] == <span class="number">1</span> || board[i][j+<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; j &gt; <span class="number">0</span> &amp;&amp; (board[i-<span class="number">1</span>][j-<span class="number">1</span>] == <span class="number">1</span> || board[i-<span class="number">1</span>][j-<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(i &lt; board.length-<span class="number">1</span> &amp;&amp; j &lt; board[<span class="number">0</span>].length-<span class="number">1</span> &amp;&amp; (board[i+<span class="number">1</span>][j+<span class="number">1</span>] == <span class="number">1</span> || board[i+<span class="number">1</span>][j+<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; j &lt; board[<span class="number">0</span>].length-<span class="number">1</span> &amp;&amp; (board[i-<span class="number">1</span>][j+<span class="number">1</span>] == <span class="number">1</span> || board[i-<span class="number">1</span>][j+<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(i &lt; board.length-<span class="number">1</span> &amp;&amp; j &gt; <span class="number">0</span> &amp;&amp; (board[i+<span class="number">1</span>][j-<span class="number">1</span>] == <span class="number">1</span> || board[i+<span class="number">1</span>][j-<span class="number">1</span>] == <span class="number">2</span>)) liveNeighbors++;</span><br><span class="line">                <span class="keyword">if</span>(board[i][j] == <span class="number">0</span> &amp;&amp; liveNeighbors == <span class="number">3</span>) board[i][j] = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(board[i][j] == <span class="number">1</span> &amp;&amp; (liveNeighbors &lt; <span class="number">2</span> || liveNeighbors &gt; <span class="number">3</span>)) board[i][j] = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; board.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) board[i][j] %= <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†93.77% çš„ç”¨æˆ·</p>
<h3 id="30-æœç´¢äºŒç»´çŸ©é˜µ"><a href="#30-æœç´¢äºŒç»´çŸ©é˜µ" class="headerlink" title="30.æœç´¢äºŒç»´çŸ©é˜µ"></a>30.æœç´¢äºŒç»´çŸ©é˜µ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬74é¢˜ï¼šæœç´¢äºŒç»´çŸ©é˜µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>æ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰å‡åºæ’åˆ—ã€‚</li>
<li>æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">matrix = [</span><br><span class="line">  [1,   3,  5,  7],</span><br><span class="line">  [10, 11, 16, 20],</span><br><span class="line">  [23, 30, 34, 50]</span><br><span class="line">]</span><br><span class="line">target = 3</span><br><span class="line"></span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">matrix = [</span><br><span class="line">  [1,   3,  5,  7],</span><br><span class="line">  [10, 11, 16, 20],</span><br><span class="line">  [23, 30, 34, 50]</span><br><span class="line">]</span><br><span class="line">target = 13</span><br><span class="line"></span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç¬¬ä¸€ä¸ªæ¡ä»¶æ„å‘³ç€å¯ä»¥é€šè¿‡äºŒåˆ†æœç´¢ç¡®å®šå“ªè¡Œï¼›</p>
<p>ç¬¬äºŒä¸ªæ¡ä»¶æ„å‘³ç€å¯ä»¥åœ¨è¡Œé‡Œè¿›è¡ŒäºŒåˆ†æœç´¢ç¡®å®šå“ªä¸ªå…ƒç´ ï¼›</p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchMatrix</span>(<span class="params">self, matrix: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(matrix) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(matrix[<span class="number">0</span>]) == <span class="number">0</span> <span class="keyword">or</span> target &lt; matrix[<span class="number">0</span>][<span class="number">0</span>] <span class="keyword">or</span> target &gt; matrix[-<span class="number">1</span>][-<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># äºŒåˆ†æ³•æ‰¾åˆ°targetæ‰€åœ¨çš„è¡Œ</span></span><br><span class="line">        top, bottom = <span class="number">0</span>, <span class="built_in">len</span>(matrix) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> top &lt; bottom:</span><br><span class="line">            mid = top + (bottom - top) // <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> matrix[mid][-<span class="number">1</span>] &lt; target:</span><br><span class="line">                top = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                bottom = mid</span><br><span class="line">        <span class="comment"># åœ¨è¡Œé‡Œè¿›è¡ŒäºŒåˆ†æœç´¢ç¡®å®šå“ªä¸ªå…ƒç´ </span></span><br><span class="line">        l, r = <span class="number">0</span>, <span class="built_in">len</span>(matrix[top]) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> matrix[top][mid] == target:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> matrix[top][mid] &lt; target:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†87.44% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15 MB,å‡»è´¥äº†5.38% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">searchMatrix</span><span class="params">(<span class="keyword">int</span>[][] matrix, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> row = matrix.length;</span><br><span class="line">        <span class="keyword">int</span> col = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">if</span>(row == <span class="number">0</span> || col == <span class="number">0</span> || target &lt; matrix[<span class="number">0</span>][<span class="number">0</span>] || target &gt; matrix[row-<span class="number">1</span>][col-<span class="number">1</span>]) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> top = <span class="number">0</span>, bottom = row;</span><br><span class="line">        <span class="keyword">while</span>(top &lt; bottom)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (bottom + top) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(matrix[mid][col-<span class="number">1</span>] &lt; target) top = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> bottom = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = col;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (right + left) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(matrix[top][mid] &lt; target) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> matrix[top][left] == target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†94.20% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒ</strong></p>
<blockquote>
<p>æ ¹æ®é¢˜ç›®ç‰¹æ€§ç›´æ¥å°†æ•°ç»„æ‹‰å¹³ï¼Œå½“ä½œä¸€ä¸ªä¸€ç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchMatrix</span>(<span class="params">self, matrix: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(matrix) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(matrix[<span class="number">0</span>]) == <span class="number">0</span> <span class="keyword">or</span> target &lt; matrix[<span class="number">0</span>][<span class="number">0</span>] <span class="keyword">or</span> target &gt; matrix[-<span class="number">1</span>][-<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        m = <span class="built_in">len</span>(matrix)</span><br><span class="line">        n = <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># æ ¹æ®é¢˜ç›®ç‰¹æ€§ç›´æ¥å°†æ•°ç»„æ‹‰å¹³ï¼Œå½“ä½œä¸€ä¸ªä¸€ç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">        l = <span class="number">0</span></span><br><span class="line">        r = m * n</span><br><span class="line">        <span class="keyword">while</span> l &lt; r:</span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line">            i = mid // n</span><br><span class="line">            j = mid % n</span><br><span class="line">            <span class="keyword">if</span> target == matrix[i][j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> target &gt; matrix[i][j]:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = mid</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†96.26% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:15.1 MB,å‡»è´¥äº†5.38% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">searchMatrix</span><span class="params">(<span class="keyword">int</span>[][] matrix, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> row = matrix.length;</span><br><span class="line">        <span class="keyword">int</span> col = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">if</span>(row == <span class="number">0</span> || col == <span class="number">0</span> || target &lt; matrix[<span class="number">0</span>][<span class="number">0</span>] || target &gt; matrix[row-<span class="number">1</span>][col-<span class="number">1</span>]) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = row * col;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(matrix[mid / col][mid % col] &lt; target) l = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> matrix[l / col][l % col] == target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š37.5 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†95.90% çš„ç”¨æˆ·</p>
<h3 id="31-å­é›†"><a href="#31-å­é›†" class="headerlink" title="31.å­é›†"></a>31.å­é›†</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬78é¢˜ï¼šå­é›†</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ç»„<strong>ä¸å«é‡å¤å…ƒç´ </strong>çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>è¯´æ˜ï¼š</strong> è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†</p>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,2,3] </span><br><span class="line"></span><br><span class="line">è¾“å‡º: [ [3], [1], [2], [1,2,3], [1,3], [2,3], [1,2], [] ] </span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥è¯æ˜ä¸€ä¸‹ N ä¸ªå…ƒç´ çš„å­é›†ä¸ªæ•°æœ‰ 2^N ä¸ª</p>
<p>å¯ä»¥ç±»æ¯”ä¸º N ä¸ªä¸åŒçš„å°çƒï¼Œä¸€æ¬¡æ‹¿å‡ºè‹¥å¹²ä¸ªå°çƒï¼ˆå¯ä»¥ä¸æ‹¿ï¼‰ï¼Œå¯¹äºæ¯ä¸€ä¸ªçƒéƒ½å¯ä»¥é€‰æ‹©æ‹¿æˆ–è€…ä¸æ‹¿ï¼Œå…±æœ‰ N ä¸ªçƒï¼Œæ€»å…±åˆ¤æ–­ N æ¬¡ï¼Œäº§ç”Ÿäº† 2^N ä¸ªå­é›†ã€‚</p>
<p><strong>æˆ‘ä»¬å…¶å®å¯ä»¥ç”¨äºŒè¿›åˆ¶æ¥æ¨¡æ‹Ÿæ¯ä¸ªå…ƒç´ æ˜¯å¦é€‰ä¸­çš„çŠ¶æ€ã€‚</strong> åˆå› ä¸ºæˆ‘ä»¬å·²çŸ¥äº†å¯¹äº N ä¸ªå…ƒç´ å…±æœ‰ 2^N ä¸ªå­é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥éå† 2^N ä¸ªå…ƒç´ ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å…·ä½“çš„å­é›†å…ƒç´ ã€‚é‚£å¦‚ä½•æ‰¾åˆ°å¯¹åº”çš„å­é›†å…ƒç´ å‘¢ï¼Ÿ<strong>å¯¹äº 2^N ä¸ª N ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»åå¾€å‰çš„ç¬¬ j ä¸ªäºŒè¿›åˆ¶ä½çš„ 0 å’Œ 1 æ¥è¡¨ç¤ºæ˜¯å¦æ”¾å…¥å­é›†é›†åˆã€‚</strong></p>
</blockquote>
<p><strong>æ–¹æ³•ä¸€ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subsets</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        k = <span class="built_in">len</span>(nums)</span><br><span class="line">        res = [[]]</span><br><span class="line">        <span class="comment"># å­é›†æ€»æ•°å…±æœ‰ 2^N ä¸ª</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> &lt;&lt; k):</span><br><span class="line">            <span class="comment"># æ‰¾åˆ°å¯¹åº”çš„å­é›†å…ƒç´ </span></span><br><span class="line">            temp = []</span><br><span class="line">            <span class="comment"># å¯¹äº 2^N ä¸ª N ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»åå¾€å‰çš„ç¬¬ j ä¸ªäºŒè¿›åˆ¶ä½çš„ 0 å’Œ 1 æ¥è¡¨ç¤ºæ˜¯å¦æ”¾å…¥å­é›†é›†åˆã€‚</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">                <span class="keyword">if</span> i &gt;&gt; j &amp; <span class="number">1</span>:</span><br><span class="line">                    temp.append(nums[j])</span><br><span class="line">            res.append(temp)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:40 ms,å‡»è´¥äº†66.14% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.37% çš„Python3ç”¨æˆ·</p>
<p>ä¸ºå¸®åŠ©å¤§å®¶ç†è§£ï¼Œå‡è®¾ nums ä¸º [1,2,3]ï¼Œres çš„å­˜å‚¨è¿‡ç¨‹ä¸ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/125.png" alt></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; subsets(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> k = nums.length;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="number">1</span> &lt;&lt; k); i++)&#123;</span><br><span class="line">            List&lt;Integer&gt; tmp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; k; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(((i &gt;&gt; j) &amp; <span class="number">1</span>) != <span class="number">0</span>) tmp.add(nums[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†87.14% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†75.78% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒï¼š</strong></p>
<blockquote>
<p>ç›´æ¥éå†ï¼Œé‡åˆ°ä¸€ä¸ªæ•°å°±æŠŠæ‰€æœ‰å­é›†åŠ ä¸Šè¯¥æ•°ç»„æˆæ–°çš„å­é›†</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subsets</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        res = [[]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums) - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> subres <span class="keyword">in</span> res[:]: res.append(subres + [nums[i]])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†40.73% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.37% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; subsets(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> all = res.size();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; all; j++)&#123;</span><br><span class="line">                List&lt;Integer&gt; tmp = <span class="keyword">new</span> ArrayList&lt;&gt;(res.get(j));</span><br><span class="line">                tmp.add(nums[i]);</span><br><span class="line">                res.add(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†87.14% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†63.70% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•ä¸‰ï¼š</strong></p>
<blockquote>
<p>é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„é€‰/ä¸é€‰ï¼Œå…¶å®æ„æˆäº†ä¸€ä¸ªæ»¡äºŒå‰æ ‘ã€‚å·¦å­æ ‘é€‰ï¼Œå³å­æ ‘ä¸é€‰ã€‚è‡ªç„¶ï¼Œé‚£ä»æ ¹èŠ‚ç‚¹åˆ°æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå°±æ„æˆäº†æ‰€æœ‰çš„å­é›†ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/126.png" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subsets</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        res = []</span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">i, tmp</span>):</span></span><br><span class="line">            res.append(tmp)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, n):</span><br><span class="line">                dfs(j + <span class="number">1</span>, tmp + [nums[j]])</span><br><span class="line">        dfs(<span class="number">0</span>, [])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†40.73% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.9 MB,å‡»è´¥äº†5.37% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; subsets(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        dfs(<span class="number">0</span>, nums, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span>[] nums, List&lt;Integer&gt; tmp)</span></span>&#123;</span><br><span class="line">        res.add(tmp);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = index; i &lt; nums.length; i++)&#123;</span><br><span class="line">            List&lt;Integer&gt; new_tmp = <span class="keyword">new</span> ArrayList&lt;&gt;(tmp);</span><br><span class="line">            new_tmp.add(nums[i]);</span><br><span class="line">            dfs(i + <span class="number">1</span>, nums, new_tmp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š1 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†87.14% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†73.80% çš„ç”¨æˆ·</p>
<h3 id="32-é‡å‡º4å‡æ°´"><a href="#32-é‡å‡º4å‡æ°´" class="headerlink" title="32.é‡å‡º4å‡æ°´"></a>32.é‡å‡º4å‡æ°´</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢˜ç›®ï¼šé‡å‡º4å‡æ°´</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ€ä¹ˆç”¨3å‡å’Œ5å‡çš„æ¡¶é‡å‡º4å‡çš„æ°´ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<p>é¢˜ç›®æ²¡ä»€ä¹ˆè¡¥å……çš„ï¼Œç›´æ¥åˆ†æï¼Œä¸€ä¸ª3å‡å’Œ5å‡çš„æ°´æ¡¶ï¼š</p>
<p>é¦–å…ˆç”¨ä¸‰å‡æ°´æ¡¶è£…æ»¡æ°´ï¼Œå€’å…¥äº”å‡æ°´æ¡¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/127.png" alt></p>
<p>å†æ¬¡å€’æ»¡ä¸‰å‡æ°´æ¡¶ï¼Œå¡«æ»¡åç»§ç»­å€’å…¥äº”å‡æ°´æ¡¶ï¼Œç›´åˆ°äº”å‡æ°´æ¡¶å€’æ»¡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/128.png" alt></p>
<p>æ¸…ç©ºäº”å‡æ°´æ¡¶ï¼Œå°†ä¸‰å‡æ°´æ¡¶çš„ä¸€å‡æ°´å€’å…¥ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/129.png" alt></p>
<p>å†æ¬¡å¡«æ»¡ä¸‰å‡æ°´æ¡¶ï¼Œå€’å…¥äº”å‡æ°´æ¡¶ä¸­ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/130.png" alt></p>
<h3 id="33-æœ€å¤§çš„é’»çŸ³"><a href="#33-æœ€å¤§çš„é’»çŸ³" class="headerlink" title="33.æœ€å¤§çš„é’»çŸ³"></a>33.æœ€å¤§çš„é’»çŸ³</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢˜ç›®ï¼šæœ€å¤§çš„é’»çŸ³</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 æ¥¼åˆ° n æ¥¼çš„æ¯å±‚ç”µæ¢¯é—¨å£éƒ½æ”¾ç€ä¸€é¢—é’»çŸ³ï¼Œé’»çŸ³å¤§å°ä¸ä¸€ã€‚ä½ ä¹˜åç”µæ¢¯ä» 1 æ¥¼åˆ° n æ¥¼ï¼Œæ¯å±‚æ¥¼ç”µæ¢¯é—¨éƒ½ä¼šæ‰“å¼€ä¸€æ¬¡ï¼Œåªèƒ½æ‹¿ä¸€æ¬¡é’»çŸ³ï¼Œé—®æ€æ ·æ‰èƒ½æ‹¿åˆ°ã€Œæœ€å¤§ã€çš„ä¸€é¢—ï¼Ÿ</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>é¢è¯•æ—¶å¦‚æœè¢«é—®åˆ°è¿™ç§é¢˜ç›®ï¼Œå…¶å®å¤§å¤šæ•°é¢è¯•å®˜å¿ƒä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†ç­”æ¡ˆã€‚ï¼ˆä¸æ’é™¤æœ‰é¢è¯•å®˜æ·±ç©¶çš„ï¼‰äº‹å®æ˜¯ä½œä¸ºé¢è¯•è€…ï¼Œæˆ‘ä»¬åªè¦æµç•…çš„ç»™å‡ºç­”æ¡ˆï¼Œå¤§æ¦‚ç‡éƒ½æ˜¯å¯ä»¥é¡ºåˆ©è¿‡å…³ã€‚</p>
<p>å›åˆ°é¢˜ç›®ã€‚å…¶å®é¢˜ä¸­åŒ…å«ä¸€ä¸ªéšè—æ¡ä»¶ï¼š<strong>éšæœºæ”¾ç½®</strong>ã€‚æ‰€æœ‰çš„åˆ†æéƒ½æ˜¯åŸºäºéšæœºæ”¾ç½®ç»™å‡ºçš„ã€‚<strong>æ¢å¥è¯è¯´ï¼Œå¦‚æœæ”¾ç½®é’»çŸ³æ˜¯äººä¸ºå¹²é¢„å¤§å°ï¼Œé‚£ä¹ˆæœ¬é¢˜çš„æ‰€ä»¥åˆ†æåˆ™å…¨éƒ¨ä¸æˆç«‹</strong>ã€‚</p>
<p>å…¶å®è¿™ä¸ªé—®é¢˜çš„åŸå‹å«åšç§˜ä¹¦é—®é¢˜ï¼Œè¯¥ç±»é—®é¢˜å…¨éƒ¨å±äº<strong>æœ€ä½³åœæ­¢é—®é¢˜</strong>ã€‚</p>
<p>è¿™ç±»é—®é¢˜éƒ½æœ‰ç€ç»Ÿä¸€çš„è§£æ³•ï¼š</p>
<p><strong>æˆ‘ä»¬è¦é€‰æ‹©å…ˆæ”¾å¼ƒå‰ 37%ï¼ˆå°±æ˜¯1/eï¼‰çš„é’»çŸ³ï¼Œæ­¤åé€‰æ‹©æ¯”å‰ 37% éƒ½å¤§çš„ç¬¬ä¸€é¢—é’»çŸ³ã€‚</strong></p>
<p>å…¶å®è¯¥æ³•åˆ™è¿˜æœ‰å¾ˆå¤šè¿ç”¨ï¼Œæ¯”å¦‚ä¸€äº›å¸¸è§çš„æ¨æ–‡ã€Šè°ˆæ‹çˆ±æ‹’ç»æ‰å‰é¢37%çš„äººã€‹ï¼Œå…¶å®å°±æ˜¯ä¸€æ ·çš„åŸå› ã€‚</p>
<p>æ”¹é¢˜ç›®è¿˜æœ‰ä¸€äº›å˜ç§ï¼Œæ¯”å¦‚ï¼š</p>
<p>ä¸€ä¸ªæ´»åŠ¨ï¼Œnä¸ªå¥³ç”Ÿæ‰‹é‡Œæ‹¿ç€é•¿çŸ­ä¸ä¸€çš„ç«ç‘°èŠ±ï¼Œæ— åºçš„æ’æˆä¸€æ’ï¼Œä¸€ä¸ªç”·ç”Ÿä»å¤´èµ°åˆ°å°¾ï¼Œè¯•å›¾æ‹¿æ›´é•¿çš„ç«ç‘°èŠ±ï¼Œä¸€æ—¦æ‹¿äº†ä¸€æœµå°±ä¸èƒ½å†æ‹¿å…¶ä»–çš„ï¼Œé”™è¿‡äº†å°±ä¸èƒ½å›å¤´ï¼Œé—®æœ€å¥½çš„ç­–ç•¥?</p>
<p>ç°åœ¨è¦è˜è¯· 1 åç§˜ä¹¦ï¼Œå…±æœ‰ n ä¸ªåº”è˜è€…ï¼Œæ¯é¢è¯• 1 äººåï¼Œå°±çŸ¥é“äº†åº”è˜è€…çš„å¥½åç¨‹åº¦ï¼Œä¸”å¿…é¡»ç«‹åˆ»å†³å®šæ˜¯å¦è˜ç”¨ï¼Œä¸å¯é‡å¤é¢è¯•ã€‚ç­–ç•¥æ˜¯æ‹’ç»å‰ k  ä¸ªåº”è˜è€…ï¼Œè€Œä»ç¬¬ k+1 ä¸ªåº”è˜è€…å¼€å§‹ï¼Œä¸€æ—¦æœ‰æ¯”å‰ k ä¸ªéƒ½å¥½çš„ï¼Œå°±ç«‹åˆ»è˜ç”¨ã€‚å¦‚ä½•å†³å®š k çš„å€¼ï¼Œä½¿å¾—è˜ç”¨åˆ°æœ€ä½³åº”è˜è€…çš„æ¦‚ç‡æœ€å¤§ï¼Ÿç­‰ç­‰ã€‚</p>
<p>è¿™é‡Œå†ç»™å‡ºä¸€ä¸ªä¸¥è°¨çš„æ¨å¯¼è¿‡ç¨‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/131.png" alt></p>
</blockquote>
<h3 id="34-æ€ç»´å®šåŠ¿"><a href="#34-æ€ç»´å®šåŠ¿" class="headerlink" title="34.æ€ç»´å®šåŠ¿"></a>34.æ€ç»´å®šåŠ¿</h3><blockquote>
<p>ä¸‹é¢è¿™é“é¢˜ä¹Ÿæ˜¯ä¸€é“å¸¸è§çš„æ™ºåŠ›é¢˜ï¼Œä½†æ˜¯è¿™é“é¢˜ç»å¯¹ä¸ä¼šå‡ºç°åœ¨é¢è¯•ä¸­äº†ã€‚æ‹¿å‡ºæ¥åˆ†äº«ç»™å¤§å®¶çš„åŸå› ï¼Œæ˜¯æœŸæœ›ä¸è¦è¢«æ€ç»´å®šåŠ¿å±€é™ã€‚</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/132.png" alt></p>
<p>è¿™é“é¢˜ä¸­æœ‰å…­ä¸ªåœè½¦ä½ï¼Œæ¯ä¸ªè½¦ä½ä¸Šéƒ½æœ‰ä¸€ä¸ªæ•°å­—ï¼Œç„¶è€Œæœ‰ä¸€ä¸ªè½¦ä½ä¸Šçš„æ•°å­—è¢«æ±½è½¦æŒ¡ä½äº†ï¼Œè¦æ±‚å­¦ç”Ÿä»¬åœ¨20ç§’å†…ç­”å‡ºè¿™ä¸ªè¢«æŒ¡ä½çš„è½¦ä½ä¸Šçš„æ•°å­—ã€‚è¿™æ˜¯ä¸­å›½é¦™æ¸¯å°å­¦ä¸€é“ç»™6å²å„¿ç«¥è®¾è®¡çš„â€œåœè½¦åœºæ™ºåŠ›é¢˜â€ã€‚</p>
<blockquote>
<p>ç­”æ¡ˆï¼šL8ï¼Œå³87</p>
</blockquote>
<h3 id="35-å›¾çš„åŸºç¡€çŸ¥è¯†"><a href="#35-å›¾çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="35.å›¾çš„åŸºç¡€çŸ¥è¯†"></a>35.å›¾çš„åŸºç¡€çŸ¥è¯†</h3><blockquote>
<p>å›¾ï¼ˆGraphï¼‰æ˜¯è¡¨ç¤ºç‰©ä»¶ä¸ç‰©ä»¶ä¹‹é—´çš„å…³ç³»çš„æ•°å­¦å¯¹è±¡ï¼Œæ˜¯å›¾è®ºçš„åŸºæœ¬ç ”ç©¶å¯¹è±¡ã€‚</p>
</blockquote>
<p>å›¾æ˜¯ä¸€ä¸ªæ¯”æ ‘å½¢å…³ç³»å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œæ¯”çº¿æ€§å…³ç³»å¤æ‚ä¸¤ç‚¹ç‚¹çš„ä¸œä¸œã€‚</p>
<ul>
<li>çº¿æ€§å…³ç³»æ˜¯ä¸€å¯¹ä¸€ï¼šä¸€ä¸ªå‰é©±ä¸€ä¸ªåç»§ã€‚</li>
<li>æ ‘å½¢ç»“æ„æ˜¯ä¸€å¯¹å¤šï¼šä¸€ä¸ªçˆ¶å¤šä¸ªå­</li>
<li>å›¾å½¢ç»“æ„æ˜¯å¤šå¯¹å¤šï¼šä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ï¼ˆå›¾ä¸­çš„èŠ‚ç‚¹å«åšé¡¶ç‚¹ï¼‰éƒ½æœ‰å¯èƒ½ç›¸å…³ï¼Œæ˜¯ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ã€‚</li>
</ul>
<p>å›¾æˆ‘ä»¬ä¸€èˆ¬è¡¨ç¤ºä¸º G = (Vï¼ŒE)</p>
<ul>
<li>Vï¼šä»£è¡¨ç‚¹</li>
<li>Eï¼šä»£è¡¨è¾¹</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/133.png" alt></p>
<p>å•¥æ„æ€å˜ï¼Œæ¯”å¦‚å°±ä¸Šé¢é‚£ä¸ªç»¿æ²¹æ²¹çš„å›¾ï¼Œå°±å¯ä»¥è¡¨ç¤ºä¸º:</p>
<ul>
<li>V={1,2,3,4,5,6}</li>
<li>E={(1,2),(1,5),(2,3),(2,5),(3,4),(4,5),(4,6)}</li>
</ul>
<p>å›¾é‡Œæœ€åŸºæœ¬çš„å•å…ƒæ˜¯é¡¶ç‚¹ï¼ˆvertexï¼‰ï¼Œç›¸å½“äºæ ‘ä¸­çš„èŠ‚ç‚¹ã€‚é¡¶ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œè¢«ç§°ä¸ºè¾¹ï¼ˆedgeï¼‰ã€‚è€Œè¾¹å¯ä»¥åˆ†é…ä¸€ä¸ªæ•°å€¼ï¼ˆæ­£è´Ÿéƒ½okï¼‰ï¼Œè¿™ä¸ªæ•°å€¼å°±å«åšæƒé‡ã€‚</p>
<p><strong>æ— å‘å›¾å’Œæœ‰å‘å›¾</strong></p>
<p>æœ‰æ–¹å‘çš„å›¾å°±æ˜¯æœ‰å‘å›¾ï¼Œæ— æ–¹å‘çš„å›¾å°±æ˜¯æ— å‘å›¾ã€‚</p>
<p><strong>å®Œå…¨å›¾</strong></p>
<p>æ‰€æœ‰çš„é¡¶ç‚¹äº’ç›¸è¿æ¥åœ¨ä¸€èµ·ï¼Œé‚£å°±æ˜¯å®Œå…¨å›¾ã€‚</p>
<p>åœ¨æ— å‘å›¾ä¸­ï¼Œè‹¥æ¯å¯¹é¡¶ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€æ¡è¾¹ç›¸è¿ï¼Œåˆ™ç§°è¯¥å›¾ä¸ºå®Œå…¨å›¾ã€‚å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/134.png" alt></p>
<p>è€Œåœ¨æœ‰å‘å›¾ä¸­ï¼Œè‹¥æ¯å¯¹é¡¶ç‚¹ä¹‹é—´éƒ½æœ‰äºŒæ¡æœ‰å‘è¾¹ç›¸äº’è¿æ¥ï¼Œä¹Ÿç®—æ˜¯å®Œå…¨å›¾ã€‚</p>
<p><strong>å¾ªç¯å›¾å’ŒDAG</strong></p>
<p>å¾ªç¯å›¾ä¸­çš„å¾ªç¯äºŒå­—ï¼ŒæŒ‡çš„æ˜¯<strong>èµ·ç‚¹å’Œç»ˆç‚¹æ˜¯åŒä¸€èŠ‚ç‚¹æ—¶</strong>äº§ç”Ÿçš„è·¯å¾„ã€‚æ‰€ä»¥ï¼Œ<strong>å¾ªç¯å›¾å’Œæœ‰å‘å›¾æˆ–æ— å‘å›¾å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå› ä¸ºéƒ½æœ‰å¯èƒ½äº§ç”Ÿå¾ªç¯</strong>ã€‚æœ‰å‘å›¾ï¼Œé‚£å°±éµå¾ªè¾¹çš„æ–¹å‘ã€‚æ— å‘å›¾ï¼Œé‚£åªè¦æˆç¯å°±è¡Œã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/135.png" alt></p>
<p>è¿™ä¸‰ä¸ªï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå°±æ˜¯æ— å‘å¾ªç¯å›¾</li>
<li>ç¬¬äºŒä¸ªå°±æ˜¯æœ‰å‘éå¾ªç¯å›¾</li>
<li>ç¬¬ä¸‰ä¸ªå°±æ˜¯æœ‰å‘å¾ªç¯å›¾</li>
</ul>
<p>ç¬¬äºŒä¸ªæ›´å¤šçš„æ˜¯è¢«ç§°ä¸ºæœ‰å‘æ— ç¯å›¾DAGï¼ˆDirected Acyclic Graphï¼‰ã€‚ä¸‹é¢è¿™ä¸ªä¹Ÿæ˜¯ ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/136.png" alt></p>
<p>é‚£ä¸Šé¢è¿™ä¸ªåƒä¸åƒä¸€æ£µæ ‘ã€‚ã€‚ã€‚ã€‚ã€‚æ‰€ä»¥è®¡ç®—æœºç»“æ„ä¸­çš„æ ‘ï¼ˆå¤§å¤šéƒ½æ˜¯æœ‰å‘çš„ï¼‰ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªDAGã€‚</p>
<p><strong>åŠ æƒå›¾</strong></p>
<blockquote>
<p> ç”¨æ•°å­¦è¯­è¨€è®²ï¼Œè®¾Gä¸ºå›¾ï¼Œå¯¹å›¾çš„æ¯ä¸€æ¡è¾¹eæ¥è¯´ï¼Œéƒ½å¯¹åº”äºä¸€ä¸ªå®æ•°W(e)ï¼ˆå¯ä»¥é€šä¿—çš„ç†è§£ä¸ºè¾¹çš„â€œé•¿åº¦â€ï¼Œåªæ˜¯åœ¨æ•°å­¦å®šä¹‰ä¸­å›¾çš„æƒå¯ä»¥ä¸ºè´Ÿæ•°ï¼‰ï¼Œæˆ‘ä»¬æŠŠW(e)ç§°ä¸ºeçš„â€œæƒâ€ã€‚æŠŠè¿™æ ·çš„å›¾Gç§°ä¸ºâ€œåŠ æƒå›¾â€ã€‚</p>
</blockquote>
<p>ä½†æ˜¯è¿™é‡Œå¦‚æœç»†åˆ†çš„è¯ï¼Œåˆåˆ†ä¸º<strong>é¡¶ç‚¹åŠ æƒå›¾å’Œè¾¹åŠ æƒå›¾ã€‚</strong> è¯´ç™½äº†ï¼Œå°±æ˜¯æœ‰äººå‘ç°å¦‚æœåªç»™è¾¹åŠ ä¸Šæƒå€¼ï¼ˆå°±æ˜¯é•¿åº¦ï¼‰å¹¶ä¸å¤Ÿç”¨ï¼Œæœ‰æ—¶å€™ä¹Ÿéœ€è¦ç»™é¡¶ç‚¹åŠ ä¸Šæƒå€¼ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/137.jpg" alt></p>
<p><strong>è¿é€šå›¾</strong></p>
<blockquote>
<p>åœ¨å›¾è®ºä¸­ï¼Œè¿é€šå›¾åŸºäºè¿é€šçš„æ¦‚å¿µã€‚åœ¨ä¸€ä¸ªæ— å‘å›¾ G ä¸­ï¼Œè‹¥ä»é¡¶ç‚¹iåˆ°é¡¶ç‚¹jæœ‰è·¯å¾„ç›¸è¿ï¼ˆå½“ç„¶ä»jåˆ°iä¹Ÿä¸€å®šæœ‰è·¯å¾„ï¼‰ï¼Œåˆ™ç§°iå’Œjæ˜¯è¿é€šçš„ã€‚</p>
</blockquote>
<p>è¿é€šçš„å›¾ï¼Œå°±æ˜¯è¿é€šå›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/138.png" alt></p>
<p>å¦‚æœä¸é€šäº†ï¼Œå°±æ˜¯éè¿é€šå›¾ï¼šï¼ˆè¿™æ˜¯ä¸€ä¸ªå›¾ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/139.png" alt></p>
<p>é‚£æ²¡æœ‰è¿é€šåœ¨ä¸€èµ·çš„è¿™ä¸¤å¨ï¼ˆæˆ–è€…è¯´ç§»åŠ¨çš„è¿™ä¸¤å¨ï¼‰ï¼Œæˆ‘ä»¬å«ä½œ<strong>å²›</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/140.png" alt></p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬çš„å›¾é‡ŒåŒ…å«å²›ï¼Œé‚£å°±æ˜¯éè¿é€šå›¾ã€‚</p>
<p><strong>ç¨ å¯†å›¾å’Œç¨€ç–å›¾</strong></p>
<p>å¦‚ä½•å®šä¹‰ç¨ å¯†å’Œç¨€ç–ï¼Ÿ<strong>æ¢µè’‚å†ˆä¹Ÿæœ‰äººè§‰å¾—ä»–ä»¬çš„åœ£å½¼å¾—å¤§æ•™å ‚æ‹¥æŒ¤</strong>ï¼Œæ‰€ä»¥ç¨ å¯†ç¨€ç–æœ¬èº«å°±æ˜¯ä¸€ä¸ªä¸»è§‚å®šä¹‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç®€å•çš„è®¤ä¸ºï¼Œç¨€ç–å›¾çš„è¾¹æ•°è¿œè¿œå°‘äºå®Œå…¨å›¾ï¼Œåä¹‹ï¼Œç¨ å¯†å›¾çš„è¾¹æ•°æ¥è¿‘äºæˆ–ç­‰äºå®Œå…¨å›¾ã€‚</p>
<h3 id="36-æ—‹è½¬å›¾åƒ"><a href="#36-æ—‹è½¬å›¾åƒ" class="headerlink" title="36.æ—‹è½¬å›¾åƒ"></a>36.æ—‹è½¬å›¾åƒ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬48é¢˜ï¼šæ—‹è½¬å›¾åƒ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ª n Ã— n çš„äºŒç»´çŸ©é˜µè¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>è¯´æ˜ï¼š</strong></p>
<p>ä½ å¿…é¡»åœ¨åŸåœ°æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚è¯·ä¸è¦ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®š matrix = </span><br><span class="line">[</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [7,8,9]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º:</span><br><span class="line">[</span><br><span class="line">  [7,4,1],</span><br><span class="line">  [8,5,2],</span><br><span class="line">  [9,6,3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®š matrix =</span><br><span class="line">[</span><br><span class="line">  [ 5, 1, 9,11],</span><br><span class="line">  [ 2, 4, 8,10],</span><br><span class="line">  [13, 3, 6, 7],</span><br><span class="line">  [15,14,12,16]</span><br><span class="line">], </span><br><span class="line"></span><br><span class="line">åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º:</span><br><span class="line">[</span><br><span class="line">  [15,13, 2, 5],</span><br><span class="line">  [14, 3, 4, 1],</span><br><span class="line">  [12, 6, 8, 9],</span><br><span class="line">  [16, 7,10,11]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<blockquote>
<p>ä¸€èˆ¬å®¹æ˜“æƒ³åˆ°çš„æ˜¯ï¼Œä¸€å±‚å±‚çš„ä»å¤–åˆ°å†…æ—‹è½¬æ¯ä¸€åœˆï¼ˆè‡³äºä¸ºä»€ä¹ˆä¸ä»å†…åˆ°å¤–ï¼Œå¦‚æœä½ è§‰å¾—æ–¹ä¾¿ï¼Œä¹Ÿokï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¿—ç§°çš„æ‰¾æ¡†æ¡†ã€‚</p>
<p>å¯¹æ¯ä¸ªæ¡†æ¡†ï¼Œå…¶å®éƒ½æœ‰ 4 ä¸ªé¡¶ç‚¹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/141.png" alt><br>äº¤æ¢å®Œæ¯•ä¹‹åï¼Œå†ç»§ç»­äº¤æ¢ç§»åŠ¨åçš„å››ä¸ªé¡¶ç‚¹ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/142.png" alt><br>é‚£ä»£ç å®ç°å…¶å®å°±å¾ˆç®€å•äº†ï¼š</p>
<ul>
<li>æˆ‘ä»¬é€šè¿‡ x å’Œ y å°±å¯ä»¥å®šä¹‰è¿™ä¸ªæ¡†æ¡†çš„è¾¹ç•Œ</li>
<li>æ‰¾åˆ°æ¡†æ¡†åï¼Œæˆ‘ä»¬å†é€šè¿‡æ¡†æ¡†è¾¹ç•Œæ¥å®šä¹‰å‡º4ä¸ªé¡¶ç‚¹</li>
<li>ç„¶åå®Œæˆäº¤æ¢</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span>(<span class="params">self, matrix: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        x, y = <span class="number">0</span>, <span class="built_in">len</span>(matrix[<span class="number">0</span>]) - <span class="number">1</span></span><br><span class="line">        <span class="comment"># ä»æœ€å¤–åœˆå¼€å§‹åˆ°æœ€å†…åœˆ</span></span><br><span class="line">        <span class="keyword">while</span> x &lt; y:</span><br><span class="line">            s = x</span><br><span class="line">            e = y</span><br><span class="line">            <span class="comment"># æ¯ä¸€åœˆæ¯è½®æ¢4ä¸ªé¡¶ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span> s &lt; y:</span><br><span class="line">                matrix[x][s], matrix[e][x], matrix[y][e], matrix[s][y] \</span><br><span class="line">                    = matrix[e][x], matrix[y][e], matrix[s][y], matrix[x][s]</span><br><span class="line">                s += <span class="number">1</span></span><br><span class="line">                e -= <span class="number">1</span></span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">            y -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> matrix</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:36 ms,å‡»è´¥äº†81.13% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†38.77% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>, y = matrix[<span class="number">0</span>].length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &lt; y)&#123;</span><br><span class="line">            <span class="keyword">int</span> s = x, e = y;</span><br><span class="line">            <span class="keyword">while</span>(s &lt; y)&#123;</span><br><span class="line">                swap(matrix, x, s, e, x);</span><br><span class="line">                swap(matrix, e, x, y, e);</span><br><span class="line">                swap(matrix, y, e, s, y);</span><br><span class="line">                s++;</span><br><span class="line">                e--;</span><br><span class="line">            &#125;</span><br><span class="line">            x++;</span><br><span class="line">            y--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[][] matrix, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = matrix[x1][y1];</span><br><span class="line">        matrix[x1][y1] = matrix[x2][y2];</span><br><span class="line">        matrix[x2][y2] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†26.87% çš„ç”¨æˆ·</p>
<p><strong>æ–¹æ³•äºŒ</strong></p>
<blockquote>
<p>æˆ‘ä»¬è§‚å¯Ÿè¿™ä¸ªçŸ©é˜µï¼Œå‘å³æ—‹è½¬90Â°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸º<strong>å…ˆä¸Šä¸‹ç¿»è½¬ï¼Œå†æ²¿å¯¹è§’çº¿ç¿»è½¬</strong>ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/143.png" alt></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span>(<span class="params">self, matrix: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="comment"># ä¸Šä¸‹ç¿»è½¬</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(matrix)//<span class="number">2</span>):</span><br><span class="line">            matrix[i], matrix[<span class="built_in">len</span>(matrix)-i-<span class="number">1</span>] = matrix[<span class="built_in">len</span>(matrix)-i-<span class="number">1</span>], matrix[i]</span><br><span class="line">        <span class="comment"># å¯¹è§’çº¿ç¿»è½¬</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(matrix)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(matrix)):</span><br><span class="line">                matrix[i][j], matrix[j][i] = matrix[j][i], matrix[i][j]</span><br><span class="line">        <span class="keyword">return</span> matrix</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:32 ms,å‡»è´¥äº†93.70% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.8 MB,å‡»è´¥äº†34.93% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; matrix.length / <span class="number">2</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span>[] tmp = matrix[i];</span><br><span class="line">            matrix[i] = matrix[matrix.length - i - <span class="number">1</span>];</span><br><span class="line">            matrix[matrix.length - i - <span class="number">1</span>] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; matrix.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; matrix.length; j++)&#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = matrix[i][j];</span><br><span class="line">                matrix[i][j] = matrix[j][i];</span><br><span class="line">                matrix[j][i] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š38.7 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†22.51% çš„ç”¨æˆ·</p>
<h3 id="37-èºæ—‹çŸ©é˜µII"><a href="#37-èºæ—‹çŸ©é˜µII" class="headerlink" title="37.èºæ—‹çŸ©é˜µII"></a>37.èºæ—‹çŸ©é˜µII</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ç¬¬59é¢˜ï¼šèºæ—‹çŸ©é˜µâ…¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å« 1 åˆ° $n^2$ æ‰€æœ‰å…ƒç´ ï¼Œä¸”å…ƒç´ æŒ‰é¡ºæ—¶é’ˆé¡ºåºèºæ—‹æ’åˆ—çš„æ­£æ–¹å½¢çŸ©é˜µã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 3</span><br><span class="line">è¾“å‡º: [ [ 1, 2, 3 ], [ 8, 9, 4 ], [ 7, 6, 5 ] ]</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®ç†è§£è¾ƒä¸ºå®¹æ˜“ï¼Œç»™å®š n = 3ï¼Œé‚£å°±ç”Ÿæˆä¸€ä¸ª 3^2 = 9 çš„çŸ©é˜µã€‚å¤§å®¶çœ‹ä¸‹é¢çš„å›¾å¯èƒ½æ›´åŠ ç›´è§‚ä¸€äº›ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/144.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateMatrix</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span></span><br><span class="line">        res = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        x, y = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="comment"># ä»å¤–åœˆåˆ°é‡Œåœˆ</span></span><br><span class="line">        <span class="keyword">while</span> x &lt;= y:</span><br><span class="line">            <span class="comment"># å‘å³å–</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x, y + <span class="number">1</span>):</span><br><span class="line">                res[x][j] = count</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="comment"># å‘ä¸‹å–</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x + <span class="number">1</span>, y + <span class="number">1</span>):</span><br><span class="line">                res[i][y] = count</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="comment"># å‘å·¦å–</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(y - <span class="number">1</span>, x - <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                res[y][j] = count</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="comment"># å‘ä¸Šå–</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(y - <span class="number">1</span>, x, -<span class="number">1</span>):</span><br><span class="line">                res[i][x] = count</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">            y -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè€—æ—¶:44 ms,å‡»è´¥äº†33.33% çš„Python3ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—:14.7 MB,å‡»è´¥äº†22.80% çš„Python3ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[][] generateMatrix(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">int</span>[][] res = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>, x = <span class="number">0</span>, y = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &lt;= y)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = x; j &lt;= y; j++) res[x][j] = count++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = x + <span class="number">1</span>; i &lt;= y; i++) res[i][y] = count++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = y - <span class="number">1</span>; j &gt;= x; j--) res[y][j] = count++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = y - <span class="number">1</span>; i &gt; x; i--) res[i][x] = count++;</span><br><span class="line">            x++;</span><br><span class="line">            y--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·<br>å†…å­˜æ¶ˆè€—ï¼š36.6 MB, åœ¨æ‰€æœ‰ Java æäº¤ä¸­å‡»è´¥äº†32.38% çš„ç”¨æˆ·</p>
<h2 id="æ’åºç³»åˆ—-1"><a href="#æ’åºç³»åˆ—-1" class="headerlink" title="æ’åºç³»åˆ—"></a>æ’åºç³»åˆ—</h2><h3 id="1-æ’åºä¸“æ "><a href="#1-æ’åºä¸“æ " class="headerlink" title="1.æ’åºä¸“æ "></a>1.æ’åºä¸“æ </h3><p>æ‰€è°“æ’åºï¼Œå°±æ˜¯ä½¿ä¸€ä¸²è®°å½•ï¼ŒæŒ‰ç…§å…¶ä¸­çš„æŸä¸ªæˆ–æŸäº›å…³é”®å­—çš„å¤§å°ï¼Œé€’å¢æˆ–é€’å‡çš„æ’åˆ—èµ·æ¥çš„æ“ä½œã€‚æ’åºç®—æ³•ï¼Œå°±æ˜¯å¦‚ä½•ä½¿å¾—è®°å½•æŒ‰ç…§è¦æ±‚æ’åˆ—çš„æ–¹æ³•ã€‚æ˜¯ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ã€‹ä¸­æœ€åŸºæœ¬çš„ç®—æ³•ä¹‹ä¸€ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¸¸è¯´çš„åå¤§æ’åºç®—æ³•ä¸ºï¼šå†’æ³¡ã€é€‰æ‹©ã€æ’å…¥ã€å¸Œå°”ã€å½’å¹¶ã€å¿«é€Ÿã€å †ã€è®¡æ•°ã€æ¡¶ã€åŸºæ•°</p>
</blockquote>
<p><strong>åŸºæœ¬åˆ†ç±»</strong><br>æˆ‘ä»¬å¸¸æ ¹æ®æ˜¯å¦å¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…æ¯”è¾ƒå¯¹å…¶åˆ†ç±»ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/145.png" alt></p>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/146.png" alt></p>
<p><strong>å¦‚ä½•è®°å¿†æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿ</strong></p>
<ol>
<li>å¹³æ–¹é˜¶ (O(n2)) æ’å…¥ã€é€‰æ‹©ã€å†’æ³¡</li>
<li>çº¿æ€§å¯¹æ•°é˜¶ (O(nlog2n)) å¿«é€Ÿã€å½’å¹¶ã€å †</li>
<li>ç‰¹æ®Šçš„å¸Œå°” O(n^(1.3â€”2))</li>
<li>ç‰›çš®çš„çº¿æ€§ åŸºæ•°ã€æ¡¶ã€ç®±ã€è®¡æ•°</li>
</ol>
<p><strong>å•¥æ˜¯ç¨³å®šï¼š</strong></p>
<p>ç¨³å®šï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a=bï¼Œæ’åºä¹‹å a ä»ç„¶åœ¨ b çš„å‰é¢ã€‚<br>ä¸ç¨³å®šï¼šå¦‚æœ a åŸæœ¬åœ¨ b çš„å‰é¢ï¼Œè€Œ a=bï¼Œæ’åºä¹‹å a å¯èƒ½ä¼šå‡ºç°åœ¨ b çš„åé¢ã€‚</p>
<p><strong>å“ªäº›ç¨³å®šï¼š</strong></p>
<p>ç¨³å®šï¼šå†’æ³¡ã€æ’å…¥ã€å½’å¹¶å’ŒåŸºæ•°ã€‚ ä¸ç¨³å®šï¼šé€‰æ‹©ã€å¿«é€Ÿã€å¸Œå°”ã€å †ã€‚</p>
<h3 id="2-å†’æ³¡æ’åº"><a href="#2-å†’æ³¡æ’åº" class="headerlink" title="2.å†’æ³¡æ’åº"></a>2.å†’æ³¡æ’åº</h3><p>å†’æ³¡æ’åºï¼ˆBubble  Sortï¼‰ä¹Ÿæ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</p>
<p>ä½œä¸ºæœ€ç®€å•çš„æ’åºç®—æ³•ä¹‹ä¸€ï¼Œå†’æ³¡æ’åºç»™æˆ‘çš„æ„Ÿè§‰å°±åƒ Abandon åœ¨å•è¯ä¹¦é‡Œå‡ºç°çš„æ„Ÿè§‰ä¸€æ ·ï¼Œæ¯æ¬¡éƒ½åœ¨ç¬¬ä¸€é¡µç¬¬ä¸€ä½ï¼Œæ‰€ä»¥æœ€ç†Ÿæ‚‰ã€‚å†’æ³¡æ’åºè¿˜æœ‰ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œå°±æ˜¯ç«‹ä¸€ä¸ª  flagï¼Œå½“åœ¨ä¸€è¶Ÿåºåˆ—éå†ä¸­å…ƒç´ æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œåˆ™è¯æ˜è¯¥åºåˆ—å·²ç»æœ‰åºã€‚ä½†è¿™ç§æ”¹è¿›å¯¹äºæå‡æ€§èƒ½æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§ä½œç”¨ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
<ol>
<li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li>
<li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚</li>
<li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li>
<li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚<br>æœ€æ…¢å’Œæœ€å¿«</li>
</ol>
</blockquote>
<p>æ­£åºæ—¶æœ€å¿«ï¼Œååºæ—¶æœ€æ…¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubbleSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr) - <span class="number">1</span>):</span><br><span class="line">    	flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr) - <span class="number">1</span> - i):</span><br><span class="line">            <span class="keyword">if</span> arr[j] &gt; arr[j + <span class="number">1</span>]:</span><br><span class="line">                arr[j], arr[j+<span class="number">1</span>] = arr[j+<span class="number">1</span>], arr[j]</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> flag: <span class="keyword">break</span> </span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt; arr.length-i-<span class="number">1</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[j] &gt; arr[j+<span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="keyword">int</span> tmp = arr[j];</span><br><span class="line">                    arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">                    arr[j+<span class="number">1</span>] = tmp;</span><br><span class="line">                    flag = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (flag) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">2</span>&#125;;</span><br><span class="line">        bubbleSort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-åŸºæ•°æ’åº"><a href="#3-åŸºæ•°æ’åº" class="headerlink" title="3.åŸºæ•°æ’åº"></a>3.åŸºæ•°æ’åº</h3><p>åŸºæ•°æ’åºæ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚</p>
<blockquote>
<p>åŸºæ•°æ’åº vs è®¡æ•°æ’åº vs æ¡¶æ’åº</p>
</blockquote>
<p>åŸºæ•°æ’åºæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>è¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚æ¡ˆä¾‹çœ‹å¤§å®¶å‘çš„ï¼š</p>
<ul>
<li>åŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶ï¼›</li>
<li>è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼ï¼›</li>
<li>æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼ï¼›</li>
</ul>
<blockquote>
<p> LSD åŸºæ•°æ’åºåŠ¨å›¾æ¼”ç¤º</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/147.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix</span>(<span class="params">arr</span>):</span></span><br><span class="line">    digit = <span class="number">0</span></span><br><span class="line">    max_digit = <span class="number">1</span></span><br><span class="line">    max_value = <span class="built_in">max</span>(arr)</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºåˆ—è¡¨ä¸­æœ€å¤§çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">10</span>**max_digit &lt; max_value:</span><br><span class="line">        max_digit = max_digit + <span class="number">1</span> </span><br><span class="line">    <span class="keyword">while</span> digit &lt; max_digit:</span><br><span class="line">        <span class="comment"># åˆ›å»ºæ¡¶</span></span><br><span class="line">        temp = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">            <span class="comment"># æ±‚å‡ºæ¯ä¸€ä¸ªå…ƒç´ çš„ä¸ªã€åã€ç™¾ä½ç›´åˆ°æœ€é«˜ä½çš„å€¼</span></span><br><span class="line">            t = <span class="built_in">int</span>((i/<span class="number">10</span>**digit)%<span class="number">10</span>)</span><br><span class="line">            <span class="comment"># æ·»åŠ è¿›ç›¸åº”çš„æ¡¶ä¸­</span></span><br><span class="line">            temp[t].append(i)</span><br><span class="line">        <span class="comment"># å°†æ¡¶ä¸­çš„æ•°æ®ä¾æ¬¡å–å‡º</span></span><br><span class="line">        coll = []</span><br><span class="line">        <span class="keyword">for</span> bucket <span class="keyword">in</span> temp:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> bucket:</span><br><span class="line">                coll.append(i)</span><br><span class="line">        <span class="comment"># ä½œä¸ºä¸‹æ¬¡è£…æ¡¶çš„æ•°æ®        </span></span><br><span class="line">        arr = coll</span><br><span class="line">        <span class="comment"># ç›´åˆ°éå†å®Œæ‰€æœ‰ä½</span></span><br><span class="line">        digit = digit + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//java</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RadixSort</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æœ€é«˜ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMaxDigit</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxValue = getMaxValue(arr);</span><br><span class="line">        <span class="keyword">return</span> getNumLenght(maxValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMaxValue</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> value : arr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (maxValue &lt; value) &#123;</span><br><span class="line">                maxValue = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getNumLenght</span><span class="params">(<span class="keyword">long</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> lenght = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">long</span> temp = num; temp != <span class="number">0</span>; temp /= <span class="number">10</span>) &#123;</span><br><span class="line">            lenght++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lenght;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] radixSort(<span class="keyword">int</span>[] arr) &#123;</span><br><span class="line">        <span class="keyword">int</span> mod = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> dev = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> maxDigit = getMaxDigit(arr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; maxDigit; i++, dev *= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="comment">// è€ƒè™‘è´Ÿæ•°çš„æƒ…å†µï¼Œè¿™é‡Œæ‰©å±•ä¸€å€é˜Ÿåˆ—æ•°ï¼Œå…¶ä¸­ [0-9]å¯¹åº”è´Ÿæ•°ï¼Œ[10-19]å¯¹åº”æ­£æ•° (bucket + 10)</span></span><br><span class="line">            List&lt;Integer&gt;[] counter = <span class="keyword">new</span> List[mod * <span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">                <span class="comment">// æ±‚æ¯ä½çš„ä½™æ•°ï¼Œå¹¶åŠ 10ï¼Œä½¿å¾—è´Ÿæ•°æ˜ å°„åˆ°0-9ï¼Œæ­£æ•°æ˜ å°„åˆ°10-19</span></span><br><span class="line">                <span class="keyword">int</span> bucket = (arr[j] / dev % mod) + mod;</span><br><span class="line">                <span class="keyword">if</span>(counter[bucket] == <span class="keyword">null</span>) counter[bucket] = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                counter[bucket].add(arr[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å°†æ¡¶ä¸­çš„æ•°æŒ‰é¡ºåºå–å‡ºï¼Œè¿›è¡Œä¸‹ä¸€ä½çš„æ’åº</span></span><br><span class="line">            <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (List&lt;Integer&gt; bucket : counter) &#123;</span><br><span class="line">                <span class="keyword">if</span>(bucket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> value : bucket) &#123;</span><br><span class="line">                        arr[pos++] = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;-<span class="number">5</span>, -<span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>, -<span class="number">9</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(radixSort(arr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-é€‰æ‹©æ’åº"><a href="#4-é€‰æ‹©æ’åº" class="headerlink" title="4.é€‰æ‹©æ’åº"></a>4.é€‰æ‹©æ’åº</h3><p>é€‰æ‹©æ’åºæ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ï¼Œæ— è®ºä»€ä¹ˆæ•°æ®è¿›å»éƒ½æ˜¯ O(nÂ²) çš„æ—¶é—´å¤æ‚åº¦ã€‚æ‰€ä»¥ç”¨åˆ°å®ƒçš„æ—¶å€™ï¼Œæ•°æ®è§„æ¨¡è¶Šå°è¶Šå¥½ã€‚å”¯ä¸€çš„å¥½å¤„å¯èƒ½å°±æ˜¯ä¸å ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´äº†å§ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®</li>
<li>å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</li>
<li>é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selectionSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr) - <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># è®°å½•æœ€å°æ•°çš„ç´¢å¼•</span></span><br><span class="line">        minIndex = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(arr)):</span><br><span class="line">            <span class="keyword">if</span> arr[j] &lt; arr[minIndex]:</span><br><span class="line">                minIndex = j</span><br><span class="line">        <span class="comment"># i ä¸æ˜¯æœ€å°æ•°æ—¶ï¼Œå°† i å’Œæœ€å°æ•°è¿›è¡Œäº¤æ¢</span></span><br><span class="line">        <span class="keyword">if</span> i != minIndex:</span><br><span class="line">            arr[i], arr[minIndex] = arr[minIndex], arr[i]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectionSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++)&#123;</span><br><span class="line">                minPos = arr[j] &lt; arr[minPos]? j: minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> tmp = arr[i];</span><br><span class="line">            arr[i] = arr[minPos];</span><br><span class="line">            arr[minPos] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        selectSort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-æ’å…¥æ’åº"><a href="#5-æ’å…¥æ’åº" class="headerlink" title="5.æ’å…¥æ’åº"></a>5.æ’å…¥æ’åº</h3><p>æ’å…¥æ’åºçš„ä»£ç å®ç°è™½ç„¶æ²¡æœ‰å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºé‚£ä¹ˆç®€å•ç²—æš´ï¼Œä½†å®ƒçš„åŸç†åº”è¯¥æ˜¯æœ€å®¹æ˜“ç†è§£çš„äº†ï¼Œå› ä¸ºåªè¦æ‰“è¿‡æ‰‘å…‹ç‰Œçš„äººéƒ½åº”è¯¥èƒ½å¤Ÿç§’æ‡‚ã€‚æ’å…¥æ’åºæ˜¯ä¸€ç§æœ€ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚</p>
<p>æ’å…¥æ’åºå’Œå†’æ³¡æ’åºä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œå«åšæ‹†åŠæ’å…¥ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>å°†ç¬¬ä¸€å¾…æ’åºåºåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ çœ‹åšä¸€ä¸ªæœ‰åºåºåˆ—ï¼ŒæŠŠç¬¬äºŒä¸ªå…ƒç´ åˆ°æœ€åä¸€ä¸ªå…ƒç´ å½“æˆæ˜¯æœªæ’åºåºåˆ—ã€‚</li>
<li>ä»å¤´åˆ°å°¾ä¾æ¬¡æ‰«ææœªæ’åºåºåˆ—ï¼Œå°†æ‰«æåˆ°çš„æ¯ä¸ªå…ƒç´ æ’å…¥æœ‰åºåºåˆ—çš„é€‚å½“ä½ç½®ã€‚ï¼ˆå¦‚æœå¾…æ’å…¥çš„å…ƒç´ ä¸æœ‰åºåºåˆ—ä¸­çš„æŸä¸ªå…ƒç´ ç›¸ç­‰ï¼Œåˆ™å°†å¾…æ’å…¥å…ƒç´ æ’å…¥åˆ°ç›¸ç­‰å…ƒç´ çš„åé¢ã€‚ï¼‰</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insertionSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr)):</span><br><span class="line">        preIndex = i-<span class="number">1</span></span><br><span class="line">        current = arr[i]</span><br><span class="line">        <span class="keyword">while</span> preIndex &gt;= <span class="number">0</span> <span class="keyword">and</span> arr[preIndex] &gt; current:</span><br><span class="line">            arr[preIndex+<span class="number">1</span>] = arr[preIndex]</span><br><span class="line">            preIndex-=<span class="number">1</span></span><br><span class="line">        arr[preIndex+<span class="number">1</span>] = current</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertionSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertionSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt; arr.length; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp =  arr[i];</span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; tmp &lt; arr[j-<span class="number">1</span>])&#123;</span><br><span class="line">                arr[j] = arr[j-<span class="number">1</span>];</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j != i) arr[j] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        insertionSort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-å¸Œå°”æ’åº"><a href="#6-å¸Œå°”æ’åº" class="headerlink" title="6.å¸Œå°”æ’åº"></a>6.å¸Œå°”æ’åº</h3><p>å¸Œå°”æ’åº(Shell  Sort)æ˜¯æ’å…¥æ’åºçš„ä¸€ç§ã€‚ä¹Ÿç§°ç¼©å°å¢é‡æ’åºï¼Œæ˜¯ç›´æ¥æ’å…¥æ’åºç®—æ³•çš„ä¸€ç§æ›´é«˜æ•ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚å¸Œå°”æ’åºæ˜¯éç¨³å®šæ’åºç®—æ³•ã€‚è¯¥æ–¹æ³•å› DLï¼Shelläº1959å¹´æå‡ºè€Œå¾—åã€‚  å¸Œå°”æ’åºæ˜¯æŠŠè®°å½•æŒ‰ä¸‹æ ‡çš„ä¸€å®šå¢é‡åˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨ç›´æ¥æ’å…¥æ’åºç®—æ³•æ’åºï¼›éšç€å¢é‡é€æ¸å‡å°‘ï¼Œæ¯ç»„åŒ…å«çš„å…³é”®è¯è¶Šæ¥è¶Šå¤šï¼Œå½“å¢é‡å‡è‡³1æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶æ°è¢«åˆ†æˆä¸€ç»„ï¼Œç®—æ³•ä¾¿ç»ˆæ­¢ã€‚</p>
<p><strong>å¸Œå°”æ’åºè¿‡ç¨‹</strong><br>å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†æ•°ç»„åˆ—åœ¨ä¸€ä¸ªè¡¨ä¸­å¹¶å¯¹åˆ—åˆ†åˆ«è¿›è¡Œæ’å…¥æ’åºï¼Œé‡å¤è¿™è¿‡ç¨‹ï¼Œä¸è¿‡æ¯æ¬¡ç”¨æ›´é•¿çš„åˆ—ï¼ˆæ­¥é•¿æ›´é•¿äº†ï¼Œåˆ—æ•°æ›´å°‘äº†ï¼‰æ¥è¿›è¡Œã€‚æœ€åæ•´ä¸ªè¡¨å°±åªæœ‰ä¸€åˆ—äº†ã€‚å°†æ•°ç»„è½¬æ¢è‡³è¡¨æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ç®—æ³•ï¼Œç®—æ³•æœ¬èº«è¿˜æ˜¯ä½¿ç”¨æ•°ç»„è¿›è¡Œæ’åºã€‚<br>   ä¾‹å¦‚ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ç»„æ•°[ 13 14 94 33 82 25 59 94 65 23 45 27 73 25 39 10  ]ï¼Œå¦‚æœæˆ‘ä»¬ä»¥æ­¥é•¿ä¸º5å¼€å§‹è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¿™åˆ—è¡¨æ”¾åœ¨æœ‰5åˆ—çš„è¡¨ä¸­æ¥æ›´å¥½åœ°æè¿°ç®—æ³•ï¼Œè¿™æ ·ä»–ä»¬å°±åº”è¯¥çœ‹èµ·æ¥æ˜¯è¿™æ ·(ç«–ç€çš„å…ƒç´ æ˜¯æ­¥é•¿ç»„æˆ)ï¼š</p>
   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">13 14 94 33 82</span><br><span class="line">25 59 94 65 23</span><br><span class="line">45 27 73 25 39</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
<p>   ç„¶åæˆ‘ä»¬å¯¹æ¯åˆ—è¿›è¡Œæ’åºï¼š</p>
   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10 14 73 25 23</span><br><span class="line">13 27 94 33 39</span><br><span class="line">25 59 94 65 82</span><br><span class="line">45</span><br></pre></td></tr></table></figure>
<p>   å°†ä¸Šè¿°å››è¡Œæ•°å­—ï¼Œä¾åºæ¥åœ¨ä¸€èµ·æ—¶æˆ‘ä»¬å¾—åˆ°ï¼š[ 10 14 73 25 23 13 27 94 33 39 25 59 94 65 82 45 ]ã€‚è¿™æ—¶10å·²ç»ç§»è‡³æ­£ç¡®ä½ç½®äº†ï¼Œç„¶åå†ä»¥3ä¸ºæ­¥é•¿è¿›è¡Œæ’åºï¼š</p>
   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10 14 73</span><br><span class="line">25 23 13</span><br><span class="line">27 94 33</span><br><span class="line">39 25 59</span><br><span class="line">94 65 82</span><br><span class="line">45</span><br></pre></td></tr></table></figure>
<p>   æ’åºä¹‹åå˜ä¸ºï¼š<br>   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10 14 13</span><br><span class="line">25 23 33</span><br><span class="line">27 25 59</span><br><span class="line">39 65 73</span><br><span class="line">45 94 82</span><br><span class="line">94</span><br></pre></td></tr></table></figure><br>   æœ€åä»¥1æ­¥é•¿è¿›è¡Œæ’åºï¼ˆæ­¤æ—¶å°±æ˜¯ç®€å•çš„æ’å…¥æ’åºäº†ï¼‰</p>
<p>   <strong>å¸Œå°”æ’åºçš„åˆ†æ</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/148.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shellSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="comment"># åˆå§‹æ­¥é•¿</span></span><br><span class="line">    gap=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(gap &lt; <span class="built_in">len</span>(arr)/<span class="number">3</span>):</span><br><span class="line">        gap = gap*<span class="number">3</span>+<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> gap &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># æŒ‰æ­¥é•¿è¿›è¡Œåˆ’åˆ†</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(gap, n):</span><br><span class="line">            j = i</span><br><span class="line">            <span class="comment"># å¯¹æ¯åˆ—è¿›è¡Œæ’å…¥æ’åº</span></span><br><span class="line">            <span class="keyword">while</span> j &gt;= gap <span class="keyword">and</span> arr[j - gap] &gt; arr[j]:</span><br><span class="line">                arr[j - gap], arr[j] = arr[j], arr[j - gap]</span><br><span class="line">                j -= gap</span><br><span class="line">        <span class="comment"># å¾—åˆ°æ–°çš„æ­¥é•¿</span></span><br><span class="line">        gap = gap // <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> gap = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (gap &lt; arr.length/<span class="number">3</span>) &#123;</span><br><span class="line">            gap = gap * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(gap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=gap; i &lt; arr.length; i++)&#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = arr[i];</span><br><span class="line">                <span class="keyword">int</span> j = i - gap;</span><br><span class="line">                <span class="keyword">while</span>(j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; tmp)&#123;</span><br><span class="line">                    arr[j+gap] = arr[j];</span><br><span class="line">                    j -= gap;</span><br><span class="line">                &#125;</span><br><span class="line">                arr[j+gap] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            gap /= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        shellSort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-å½’å¹¶æ’åº"><a href="#7-å½’å¹¶æ’åº" class="headerlink" title="7.å½’å¹¶æ’åº"></a>7.å½’å¹¶æ’åº</h3><p>å½’å¹¶æ’åºï¼ˆMerge sortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</p>
<p>ä½œä¸ºä¸€ç§å…¸å‹çš„åˆ†è€Œæ²»ä¹‹æ€æƒ³çš„ç®—æ³•åº”ç”¨ï¼Œå½’å¹¶æ’åºçš„å®ç°ç”±ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>è‡ªä¸Šè€Œä¸‹çš„é€’å½’ï¼ˆæ‰€æœ‰é€’å½’çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨è¿­ä»£é‡å†™ï¼Œæ‰€ä»¥å°±æœ‰äº†ç¬¬ 2 ç§æ–¹æ³•ï¼‰ï¼›</li>
<li>è‡ªä¸‹è€Œä¸Šçš„è¿­ä»£ï¼›</li>
</ul>
<p>åœ¨ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³• JavaScript æè¿°ã€‹ä¸­ï¼Œä½œè€…ç»™å‡ºäº†è‡ªä¸‹è€Œä¸Šçš„è¿­ä»£æ–¹æ³•ã€‚ä½†æ˜¯å¯¹äºé€’å½’æ³•ï¼Œä½œè€…å´è®¤ä¸ºï¼š</p>
<blockquote>
<p>However, it is not possible to do so in JavaScript, as the recursion goes too deep for the language to handle.</p>
<p>ç„¶è€Œï¼Œåœ¨ JavaScript ä¸­è¿™ç§æ–¹å¼ä¸å¤ªå¯è¡Œï¼Œå› ä¸ºè¿™ä¸ªç®—æ³•çš„é€’å½’æ·±åº¦å¯¹å®ƒæ¥è®²å¤ªæ·±äº†ã€‚</p>
</blockquote>
<p>å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œå½’å¹¶æ’åºçš„æ€§èƒ½ä¸å—è¾“å…¥æ•°æ®çš„å½±å“ï¼Œä½†è¡¨ç°æ¯”é€‰æ‹©æ’åºå¥½çš„å¤šï¼Œå› ä¸ºå§‹ç»ˆéƒ½æ˜¯ O(nlogn) çš„æ—¶é—´å¤æ‚åº¦ã€‚ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„åºåˆ—ï¼›</li>
<li>è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼›</li>
<li>æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½®ï¼›</li>
<li>é‡å¤æ­¥éª¤ 3 ç›´åˆ°æŸä¸€æŒ‡é’ˆè¾¾åˆ°åºåˆ—å°¾ï¼›</li>
<li>å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾ã€‚</li>
</ol>
<blockquote>
<p>åŠ¨å›¾æ¼”ç¤º</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/149.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeSort</span>(<span class="params">alist</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(alist) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> alist</span><br><span class="line">    <span class="comment"># äºŒåˆ†åˆ†è§£</span></span><br><span class="line">    num = <span class="built_in">len</span>(alist)//<span class="number">2</span></span><br><span class="line">    left = mergeSort(alist[:num])</span><br><span class="line">    right = mergeSort(alist[num:])</span><br><span class="line">    <span class="comment"># åˆå¹¶</span></span><br><span class="line">    <span class="keyword">return</span> merge(left,right)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">left, right</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;åˆå¹¶æ“ä½œï¼Œå°†ä¸¤ä¸ªæœ‰åºæ•°ç»„left[]å’Œright[]åˆå¹¶æˆä¸€ä¸ªå¤§çš„æœ‰åºæ•°ç»„&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#leftä¸rightçš„ä¸‹æ ‡æŒ‡é’ˆ</span></span><br><span class="line">    l, r = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">while</span> l&lt;<span class="built_in">len</span>(left) <span class="keyword">and</span> r&lt;<span class="built_in">len</span>(right):</span><br><span class="line">        <span class="keyword">if</span> left[l] &lt;= right[r]:</span><br><span class="line">            result.append(left[l])</span><br><span class="line">            l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(right[r])</span><br><span class="line">            r += <span class="number">1</span></span><br><span class="line">    result += left[l:]</span><br><span class="line">    result += right[r:]</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] mergeSort(<span class="keyword">int</span>[] arr)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> arr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> middle = arr.length / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] left = mergeSort(Arrays.copyOfRange(arr, <span class="number">0</span>, middle));</span><br><span class="line">        <span class="keyword">int</span>[] right = mergeSort(Arrays.copyOfRange(arr, middle, arr.length));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> merge(left, right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] merge(<span class="keyword">int</span>[] left, <span class="keyword">int</span>[] right) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[left.length + right.length];</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; left.length &amp;&amp; r &lt; right.length) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left[l] &lt;= right[r]) result[i++] = left[l++];</span><br><span class="line">            <span class="keyword">else</span> result[i++] = right[r++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; left.length) result[i++] = left[l++];</span><br><span class="line">        <span class="keyword">while</span> (r &lt; right.length) result[i++] = right[r++];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(mergeSort(arr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-å¿«é€Ÿæ’åº"><a href="#8-å¿«é€Ÿæ’åº" class="headerlink" title="8.å¿«é€Ÿæ’åº"></a>8.å¿«é€Ÿæ’åº</h3><p>å¿«é€Ÿæ’åºæ˜¯ç”±ä¸œå°¼Â·éœå°”æ‰€å‘å±•çš„ä¸€ç§æ’åºç®—æ³•ã€‚åœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åº n ä¸ªé¡¹ç›®è¦ ÎŸ(nlogn) æ¬¡æ¯”è¾ƒã€‚åœ¨æœ€åçŠ¶å†µä¸‹åˆ™éœ€è¦ ÎŸ(n2)  æ¬¡æ¯”è¾ƒï¼Œä½†è¿™ç§çŠ¶å†µå¹¶ä¸å¸¸è§ã€‚äº‹å®ä¸Šï¼Œå¿«é€Ÿæ’åºé€šå¸¸æ˜æ˜¾æ¯”å…¶ä»– ÎŸ(nlogn) ç®—æ³•æ›´å¿«ï¼Œå› ä¸ºå®ƒçš„å†…éƒ¨å¾ªç¯ï¼ˆinner  loopï¼‰å¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„æ¶æ„ä¸Šå¾ˆæœ‰æ•ˆç‡åœ°è¢«å®ç°å‡ºæ¥ã€‚</p>
<p>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•ï¼ˆDivide and conquerï¼‰ç­–ç•¥æ¥æŠŠä¸€ä¸ªä¸²è¡Œï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²è¡Œï¼ˆsub-listsï¼‰ã€‚</p>
<p>å¿«é€Ÿæ’åºåˆæ˜¯ä¸€ç§åˆ†è€Œæ²»ä¹‹æ€æƒ³åœ¨æ’åºç®—æ³•ä¸Šçš„å…¸å‹åº”ç”¨ã€‚æœ¬è´¨ä¸Šæ¥çœ‹ï¼Œå¿«é€Ÿæ’åºåº”è¯¥ç®—æ˜¯åœ¨å†’æ³¡æ’åºåŸºç¡€ä¸Šçš„é€’å½’åˆ†æ²»æ³•ã€‚</p>
<p>å¿«é€Ÿæ’åºçš„åå­—èµ·çš„æ˜¯ç®€å•ç²—æš´ï¼Œå› ä¸ºä¸€å¬åˆ°è¿™ä¸ªåå­—ä½ å°±çŸ¥é“å®ƒå­˜åœ¨çš„æ„ä¹‰ï¼Œå°±æ˜¯å¿«ï¼Œè€Œä¸”æ•ˆç‡é«˜ï¼å®ƒæ˜¯å¤„ç†å¤§æ•°æ®æœ€å¿«çš„æ’åºç®—æ³•ä¹‹ä¸€äº†ã€‚è™½ç„¶ Worst Case çš„æ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº† O(nÂ²)ï¼Œä½†æ˜¯äººå®¶å°±æ˜¯ä¼˜ç§€ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ¯”å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)  çš„æ’åºç®—æ³•è¡¨ç°è¦æ›´å¥½ï¼š</p>
<blockquote>
<p>å¿«é€Ÿæ’åºçš„æœ€åè¿è¡Œæƒ…å†µæ˜¯ O(nÂ²)ï¼Œæ¯”å¦‚è¯´é¡ºåºæ•°åˆ—çš„å¿«æ’ã€‚ä½†å®ƒçš„å¹³æ‘ŠæœŸæœ›æ—¶é—´æ˜¯ O(nlogn)ï¼Œä¸” O(nlogn) è®°å·ä¸­éšå«çš„å¸¸æ•°å› å­å¾ˆå°ï¼Œæ¯”å¤æ‚åº¦ç¨³å®šç­‰äº  O(nlogn) çš„å½’å¹¶æ’åºè¦å°å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œå¯¹ç»å¤§å¤šæ•°é¡ºåºæ€§è¾ƒå¼±çš„éšæœºæ•°åˆ—è€Œè¨€ï¼Œå¿«é€Ÿæ’åºæ€»æ˜¯ä¼˜äºå½’å¹¶æ’åºã€‚</p>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰;</li>
<li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</li>
<li>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºï¼›</li>
</ol>
<p>é€’å½’çš„æœ€åº•éƒ¨æƒ…å½¢ï¼Œæ˜¯æ•°åˆ—çš„å¤§å°æ˜¯é›¶æˆ–ä¸€ï¼Œä¹Ÿå°±æ˜¯æ°¸è¿œéƒ½å·²ç»è¢«æ’åºå¥½äº†ã€‚è™½ç„¶ä¸€ç›´é€’å½’ä¸‹å»ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•æ€»ä¼šé€€å‡ºï¼Œå› ä¸ºåœ¨æ¯æ¬¡çš„è¿­ä»£ï¼ˆiterationï¼‰ä¸­ï¼Œå®ƒè‡³å°‘ä¼šæŠŠä¸€ä¸ªå…ƒç´ æ‘†åˆ°å®ƒæœ€åçš„ä½ç½®å»ã€‚</p>
<blockquote>
<p>åŠ¨å›¾æ¼”ç¤º</p>
</blockquote>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/150.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span>(<span class="params">alist, start, end</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¿«é€Ÿæ’åº&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># é€’å½’çš„é€€å‡ºæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> start &gt;= end:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è®¾å®šèµ·å§‹å…ƒç´ ä¸ºè¦å¯»æ‰¾ä½ç½®çš„åŸºå‡†å…ƒç´ </span></span><br><span class="line">    mid = alist[start]</span><br><span class="line">    <span class="comment"># lowä¸ºåºåˆ—å·¦è¾¹çš„ç”±å·¦å‘å³ç§»åŠ¨çš„æ¸¸æ ‡</span></span><br><span class="line">    low = start</span><br><span class="line">    <span class="comment"># highä¸ºåºåˆ—å³è¾¹çš„ç”±å³å‘å·¦ç§»åŠ¨çš„æ¸¸æ ‡</span></span><br><span class="line">    high = end</span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        <span class="comment"># å¦‚æœlowä¸highæœªé‡åˆï¼ŒhighæŒ‡å‘çš„å…ƒç´ ä¸æ¯”åŸºå‡†å…ƒç´ å°ï¼Œåˆ™highå‘å·¦ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">while</span> low &lt; high <span class="keyword">and</span> alist[high] &gt;= mid:</span><br><span class="line">            high -= <span class="number">1</span></span><br><span class="line">        <span class="comment"># å°†highæŒ‡å‘çš„å…ƒç´ æ”¾åˆ°lowçš„ä½ç½®ä¸Š</span></span><br><span class="line">        alist[low] = alist[high]</span><br><span class="line">        <span class="comment"># å¦‚æœlowä¸highæœªé‡åˆï¼ŒlowæŒ‡å‘çš„å…ƒç´ æ¯”åŸºå‡†å…ƒç´ å°ï¼Œåˆ™lowå‘å³ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">while</span> low &lt; high <span class="keyword">and</span> alist[low] &lt; mid:</span><br><span class="line">            low += <span class="number">1</span></span><br><span class="line">        <span class="comment"># å°†lowæŒ‡å‘çš„å…ƒç´ æ”¾åˆ°highçš„ä½ç½®ä¸Š</span></span><br><span class="line">        alist[high] = alist[low]</span><br><span class="line">    <span class="comment"># é€€å‡ºå¾ªç¯åï¼Œlowä¸highé‡åˆï¼Œæ­¤æ—¶æ‰€æŒ‡ä½ç½®ä¸ºåŸºå‡†å…ƒç´ çš„æ­£ç¡®ä½ç½®</span></span><br><span class="line">    <span class="comment"># å°†åŸºå‡†å…ƒç´ æ”¾åˆ°è¯¥ä½ç½®</span></span><br><span class="line">    alist[low] = mid</span><br><span class="line">    <span class="comment"># å¯¹åŸºå‡†å…ƒç´ å·¦è¾¹çš„å­åºåˆ—è¿›è¡Œå¿«é€Ÿæ’åº</span></span><br><span class="line">    quick_sort(alist, start, low-<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å¯¹åŸºå‡†å…ƒç´ å³è¾¹çš„å­åºåˆ—è¿›è¡Œå¿«é€Ÿæ’åº</span></span><br><span class="line">    quick_sort(alist, low+<span class="number">1</span>, end)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start &gt;= end) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//è®¾å®šåŸºå‡†</span></span><br><span class="line">        <span class="keyword">int</span> pivot = arr[start];</span><br><span class="line">        <span class="keyword">int</span> low = start;</span><br><span class="line">        <span class="keyword">int</span> high = end;</span><br><span class="line">        <span class="keyword">while</span>(low &lt; high)&#123;</span><br><span class="line">            <span class="keyword">while</span>(low &lt; high &amp;&amp; arr[high] &gt;= pivot) high--;</span><br><span class="line">            arr[low] = arr[high];</span><br><span class="line">            <span class="keyword">while</span>(low &lt; high &amp;&amp; arr[low] &lt;= pivot) low++;</span><br><span class="line">            arr[high] = arr[low];</span><br><span class="line">        &#125;</span><br><span class="line">        arr[low] = pivot;</span><br><span class="line">        quickSort(arr, start, low - <span class="number">1</span>);</span><br><span class="line">        quickSort(arr, low + <span class="number">1</span>, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span> ,<span class="number">1</span>, <span class="number">9</span>&#125;;</span><br><span class="line">        <span class="keyword">new</span> QuickSort().quickSort(arr, <span class="number">0</span>, arr.length-<span class="number">1</span>);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//sout: [1, 2, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h3 id="9-å †æ’åº"><a href="#9-å †æ’åº" class="headerlink" title="9.å †æ’åº"></a>9.å †æ’åº</h3><p>å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å †æ’åºå¯ä»¥è¯´æ˜¯ä¸€ç§åˆ©ç”¨å †çš„æ¦‚å¿µæ¥æ’åºçš„é€‰æ‹©æ’åºã€‚åˆ†ä¸ºä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å¤§é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºå‡åºæ’åˆ—ï¼›</li>
<li>å°é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºé™åºæ’åˆ—ï¼›</li>
</ol>
<p>å †æ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º ÎŸ(nlogn)ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>å°†å¾…æ’åºåºåˆ—æ„å»ºæˆä¸€ä¸ªå † H[0â€¦â€¦n-1]ï¼Œæ ¹æ®ï¼ˆå‡åºé™åºéœ€æ±‚ï¼‰é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †ï¼›</li>
<li>æŠŠå †é¦–ï¼ˆæœ€å¤§å€¼ï¼‰å’Œå †å°¾äº’æ¢ï¼›</li>
<li>æŠŠå †çš„å°ºå¯¸ç¼©å° 1ï¼Œå¹¶è°ƒç”¨ shift_down(0)ï¼Œç›®çš„æ˜¯æŠŠæ–°çš„æ•°ç»„é¡¶ç«¯æ•°æ®è°ƒæ•´åˆ°ç›¸åº”ä½ç½®ï¼›</li>
<li>é‡å¤æ­¥éª¤ 2ï¼Œç›´åˆ°å †çš„å°ºå¯¸ä¸º 1ã€‚</li>
</ol>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/151.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="comment">#å¤§é¡¶å †</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heapify</span>(<span class="params">arr, i, length</span>):</span></span><br><span class="line">    left = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">    right = <span class="number">2</span> * i + <span class="number">2</span></span><br><span class="line">    maxIndex = i</span><br><span class="line">    <span class="keyword">if</span> left &lt; length <span class="keyword">and</span> arr[left] &gt; arr[maxIndex]:</span><br><span class="line">        maxIndex = left</span><br><span class="line">    <span class="keyword">if</span> right &lt; length <span class="keyword">and</span> arr[right] &gt; arr[maxIndex]:</span><br><span class="line">        maxIndex = right</span><br><span class="line">    <span class="keyword">if</span> maxIndex != i:</span><br><span class="line">        arr[i], arr[maxIndex] = arr[maxIndex], arr[i]</span><br><span class="line">        heapify(arr, maxIndex, length)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heapSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–å¤§é¡¶å †</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr) // <span class="number">2</span> - <span class="number">1</span> , -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        heapify(arr, i, n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># æ ¹èŠ‚ç‚¹ä¸ºæœ€å¤§</span></span><br><span class="line">        arr[<span class="number">0</span>], arr[i] =  arr[i], arr[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># æ¢å‡ºæ ¹èŠ‚ç‚¹å å†å¯¹å‰©ä¸‹çš„æ’åº æœ€åå½¢æˆå‡åº</span></span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line">        heapify(arr, <span class="number">0</span>, n)</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] heapSort(<span class="keyword">int</span>[] arr)&#123;</span><br><span class="line">        Queue&lt;Integer&gt; heap = <span class="keyword">new</span> PriorityQueue&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: arr) heap.offer(num);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) arr[i] = heap.poll();</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(heapSort(arr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-è®¡æ•°æ’åº"><a href="#10-è®¡æ•°æ’åº" class="headerlink" title="10.è®¡æ•°æ’åº"></a>10.è®¡æ•°æ’åº</h3><p>è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p>
<blockquote>
<p>ç®—æ³•æ­¥éª¤</p>
</blockquote>
<ol>
<li>æ‰¾å‡ºåŸæ•°ç»„ä¸­å…ƒç´ å€¼æœ€å¤§çš„ï¼Œè®°ä¸ºmaxã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„countï¼Œå…¶é•¿åº¦æ˜¯maxåŠ 1ï¼Œå…¶å…ƒç´ é»˜è®¤å€¼éƒ½ä¸º0ã€‚</li>
<li>éå†åŸæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä»¥åŸæ•°ç»„ä¸­çš„å…ƒç´ ä½œä¸ºcountæ•°ç»„çš„ç´¢å¼•ï¼Œä»¥åŸæ•°ç»„ä¸­çš„å…ƒç´ å‡ºç°æ¬¡æ•°ä½œä¸ºcountæ•°ç»„çš„å…ƒç´ å€¼ã€‚</li>
<li>åˆ›å»ºç»“æœæ•°ç»„resultï¼Œèµ·å§‹ç´¢å¼•indexã€‚</li>
<li>éå†countæ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­å…ƒç´ å€¼å¤§äº0çš„å…ƒç´ ï¼Œå°†å…¶å¯¹åº”çš„ç´¢å¼•ä½œä¸ºå…ƒç´ å€¼å¡«å……åˆ°resultæ•°ç»„ä¸­å»ï¼Œæ¯å¤„ç†ä¸€æ¬¡ï¼Œcountä¸­çš„è¯¥å…ƒç´ å€¼å‡1ï¼Œç›´åˆ°è¯¥å…ƒç´ å€¼ä¸å¤§äº0ï¼Œä¾æ¬¡å¤„ç†countä¸­å‰©ä¸‹çš„å…ƒç´ ã€‚</li>
<li>è¿”å›ç»“æœæ•°ç»„resultã€‚</li>
</ol>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/152.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countingSort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    maxLen = <span class="built_in">max</span>(arr) + <span class="number">1</span></span><br><span class="line">    count = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(maxLen)]</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">        count[i] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(maxLen):</span><br><span class="line">        <span class="keyword">while</span> count[i] &gt; <span class="number">0</span>:</span><br><span class="line">            result.append(i)</span><br><span class="line">            count[i] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] countSort(<span class="keyword">int</span>[] arr)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr.length &lt; <span class="number">2</span>) <span class="keyword">return</span> arr;</span><br><span class="line">        <span class="keyword">int</span> maxValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : arr) maxValue=i &gt; maxValue?i: maxValue;</span><br><span class="line">        <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[maxValue+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : arr) count[i]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>; i&lt;=maxValue; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(count[i]-- &gt; <span class="number">0</span>) res[j++]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(countSort(arr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šä¸Šè¿°å†™æ³•å¹¶ä¸æ˜¯ç¨³å®šæ’åºï¼Œå› æ­¤è¿™é‡Œåšæ”¹è¿›ï¼Œç¨³å®šçš„è®¡æ•°æ’åºå¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] countSort(<span class="keyword">int</span>[] arr)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr.length &lt; <span class="number">2</span>) <span class="keyword">return</span> arr;</span><br><span class="line">        <span class="keyword">int</span> maxValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : arr) maxValue = i &gt; maxValue?i: maxValue;</span><br><span class="line">        <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[maxValue+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : arr) count[i]++;</span><br><span class="line">        <span class="comment">//åšç´¯åŠ ï¼Œä½¿æ¡¶ä¸­è®°å½•çš„ä¸ºæ¯ä¸ªæ•°çš„æœ€åä¸€ä¸ªç´¢å¼•</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=maxValue; i++) count[i] = count[i] + count[i-<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//é€†åºéå†ï¼Œç›´æ¥å¾€ç›¸åº”ç´¢å¼•å¡«æ•°ï¼Œä½¿å¾—ç®—æ³•ç¨³å®š</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=arr.length-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">            res[--count[arr[i]]] = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(countSort(arr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-æ¡¶æ’åº"><a href="#11-æ¡¶æ’åº" class="headerlink" title="11.æ¡¶æ’åº"></a>11.æ¡¶æ’åº</h3><p>æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ä¸ºäº†ä½¿æ¡¶æ’åºæ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹ï¼š</p>
<ol>
<li>åœ¨é¢å¤–ç©ºé—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¢å¤§æ¡¶çš„æ•°é‡</li>
<li>ä½¿ç”¨çš„æ˜ å°„å‡½æ•°èƒ½å¤Ÿå°†è¾“å…¥çš„ N ä¸ªæ•°æ®å‡åŒ€çš„åˆ†é…åˆ° K ä¸ªæ¡¶ä¸­</li>
</ol>
<p>åŒæ—¶ï¼Œå¯¹äºæ¡¶ä¸­å…ƒç´ çš„æ’åºï¼Œé€‰æ‹©ä½•ç§æ¯”è¾ƒæ’åºç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ—¶å€™æœ€å¿«</p>
</blockquote>
<p>å½“è¾“å…¥çš„æ•°æ®å¯ä»¥å‡åŒ€çš„åˆ†é…åˆ°æ¯ä¸€ä¸ªæ¡¶ä¸­ã€‚ </p>
<blockquote>
<p>ä»€ä¹ˆæ—¶å€™æœ€æ…¢</p>
</blockquote>
<p>å½“è¾“å…¥çš„æ•°æ®è¢«åˆ†é…åˆ°äº†åŒä¸€ä¸ªæ¡¶ä¸­ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/leetcode_python/153.gif" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucket_sort</span>(<span class="params">array, bucketSize=<span class="number">5</span></span>):</span></span><br><span class="line">    <span class="comment"># bucketSizeè®¾ç½®æ¯ä¸ªæ¡¶çš„å®¹é‡</span></span><br><span class="line">    maxValue = <span class="built_in">max</span>(array)</span><br><span class="line">    minValue = <span class="built_in">min</span>(array)</span><br><span class="line">    <span class="comment"># 1.åˆ›å»ºç©ºæ¡¶</span></span><br><span class="line">    bucketCount = (maxValue - minValue) // bucketSize + <span class="number">1</span></span><br><span class="line">    buckets = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(bucketCount)]</span><br><span class="line">    <span class="comment"># 2.åˆ©ç”¨æ˜ å°„å‡½æ•°å°†æ•°æ®åˆ†é…åˆ°å„ä¸ªæ¡¶ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> array:</span><br><span class="line">        index = (<span class="built_in">int</span>)(data - minValue) // bucketSize</span><br><span class="line">        buckets[index].append(data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.æ¡¶å†…æ’åº</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bucketCount):</span><br><span class="line">        buckets[i].sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.äº§ç”Ÿæ–°çš„æ’åºåçš„åˆ—è¡¨</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bucketCount):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(buckets[i])):</span><br><span class="line">            array[index] = buckets[i][j]</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> array</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Java</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BucketSort</span> </span>&#123;</span><br><span class="line">    <span class="comment">//bucketSizeç”¨äºè®¾ç½®æ¯ä¸ªæ¡¶çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] bucketSort(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> bucketSize)&#123;</span><br><span class="line">        <span class="keyword">if</span> (arr.length == <span class="number">0</span>) <span class="keyword">return</span> arr;</span><br><span class="line">        <span class="comment">//å¾—åˆ°æ•°ç»„ä¸­çš„æœ€å¤§ï¼Œæœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">int</span> minValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> maxValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> value : arr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &lt; minValue) &#123;</span><br><span class="line">                minValue = value;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &gt; maxValue) &#123;</span><br><span class="line">                maxValue = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¤šå°‘ä¸ªæ¡¶</span></span><br><span class="line">        <span class="keyword">int</span> bucketCount = (maxValue - minValue) / bucketSize + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//åˆ›å»ºç©ºæ¡¶</span></span><br><span class="line">        List&lt;Integer&gt;[] buckets = <span class="keyword">new</span> List[bucketCount];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> value : arr) &#123;</span><br><span class="line">            <span class="comment">//æ˜ å°„å‡½æ•°ï¼Œå­˜æ”¾åˆ°ç›¸åº”æ¡¶ä¸­</span></span><br><span class="line">            <span class="keyword">int</span> index = (value - minValue) / bucketSize;</span><br><span class="line">            <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) buckets[index] = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">            buckets[index].add(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¯¹æ¯ä¸ªæ¡¶æ’åº</span></span><br><span class="line">        <span class="keyword">for</span> (List&lt;Integer&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="comment">//æ¡¶ä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span>(bucket != <span class="keyword">null</span>) Collections.sort(bucket);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//äº§ç”Ÿæ’åºåçš„æ–°åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (List&lt;Integer&gt; bucket : buckets)&#123;</span><br><span class="line">            <span class="comment">//æ¡¶ä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span>(bucket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Integer integer : bucket) &#123;</span><br><span class="line">                    res[index] = integer;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span> ,<span class="number">1</span>, <span class="number">9</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> BucketSort().bucketSort(arr, <span class="number">3</span>);</span><br><span class="line">        System.out.println(Arrays.toString(res));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>keras/tensorflowè½¬onnx</title>
    <url>/2021/09/25/keras%E8%BD%AConnx/</url>
    <content><![CDATA[<p>é¡¹ç›®ä¸­é‡åˆ°éœ€è¦å°†è®­ç»ƒå¥½çš„kerasæ¨¡å‹è½¬æ¢æˆonnxä»¥ä¾¿éƒ¨ç½²åˆ°åµŒå…¥å¼è®¾å¤‡è¿›è¡ŒRTåŠ é€Ÿï¼Œæœ€å¼€å§‹ä½¿ç”¨çš„<a href="[GitHub - onnx/keras-onnx: Convert tf.keras/Keras models to ONNX](https://github.com/onnx/keras-onnx">keras2onnx</a>å·¥å…·ï¼Œç„¶è€Œæ­¤å·¥å…·æ”¯æŒæ€§å¹¶ä¸å¥½ï¼Œåœ¨è½¬åŒ–è¿‡ç¨‹ä¸­é‡åˆ°è®¸å¤šé—®é¢˜ã€‚å› æ­¤å†³å®šå°†kerasè½¬æˆtensorflowæ ¼å¼ï¼Œå†ä½¿ç”¨æ”¯æŒæ€§è¾ƒå¥½çš„<a href="[GitHub - onnx/tensorflow-onnx: Convert TensorFlow, Keras, Tensorflow.js and Tflite models to ONNX](https://github.com/onnx/tensorflow-onnx">tf2onnx</a>å·¥å…·è¿›è¡Œè½¬åŒ–ã€‚</p>
<h1 id="æ–°ç‰ˆæœ¬"><a href="#æ–°ç‰ˆæœ¬" class="headerlink" title="æ–°ç‰ˆæœ¬"></a>æ–°ç‰ˆæœ¬</h1><p>ç›®å‰keras2onnxåœæ­¢æ›´æ–°ï¼ŒåŠŸèƒ½å·²æ•´åˆè¿›<a href="https://github.com/onnx/tensorflow-onnx">tf2onnx</a>ä¸­ï¼Œkerasæ¨¡å‹å¯ç›´æ¥ä½¿ç”¨ api <a href="https://github.com/onnx/tensorflow-onnx#from_keras-tf-20-and-newer">tf2onnx.convert.from_keras()</a>å®Œæˆè½¬æ¢æ“ä½œ</p>
<h2 id="è½¬æ¢æ­¥éª¤ï¼š"><a href="#è½¬æ¢æ­¥éª¤ï¼š" class="headerlink" title="è½¬æ¢æ­¥éª¤ï¼š"></a>è½¬æ¢æ­¥éª¤ï¼š</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tf2onnx</span><br><span class="line"><span class="keyword">import</span> onnxruntime <span class="keyword">as</span> rt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ¨¡å‹</span></span><br><span class="line">model = ResNet50(weights=<span class="string">&#x27;imagenet&#x27;</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®è¾“å…¥å¤§å°</span></span><br><span class="line">spec = (tf.TensorSpec((<span class="literal">None</span>, <span class="number">224</span>, <span class="number">224</span>, <span class="number">3</span>), tf.float32, name=<span class="string">&quot;input&quot;</span>),)</span><br><span class="line"><span class="comment"># ä¿å­˜onnxè·¯å¾„</span></span><br><span class="line">output_path = model.name + <span class="string">&quot;.onnx&quot;</span></span><br><span class="line"><span class="comment"># è½¬æ¢</span></span><br><span class="line">tf2onnx.convert.from_keras(model, input_signature=spec, opset=<span class="number">13</span>, output_path=output_path)</span><br></pre></td></tr></table></figure>
<h2 id="APIè¯´æ˜ï¼š"><a href="#APIè¯´æ˜ï¼š" class="headerlink" title="APIè¯´æ˜ï¼š"></a>APIè¯´æ˜ï¼š</h2><blockquote>
<p>import tf2onnx</p>
<p>model_proto, external_tensor_storage = tf2onnx.convert.from_keras(model,<br>                input_signature=None, opset=None, custom_ops=None,<br>                custom_op_handlers=None, custom_rewriter=None,<br>                inputs_as_nchw=None, extra_opset=None shape_override=None,<br>                target=None, large_model=False, output_path=None)</p>
<pre><code>Args:
    model: the tf.keras model we want to convert
    input_signature: a tf.TensorSpec or a numpy array defining the shape/dtype of the input
    opset: the opset to be used for the ONNX model, default is the latest
    custom_ops: if a model contains ops not recognized by onnx runtime,
        you can tag these ops with a custom op domain so that the
        runtime can still open the model. Type is a dictionary `&#123;op name: domain&#125;`.
    target: list of workarounds applied to help certain platforms
    custom_op_handlers: dictionary of custom ops handlers
    custom_rewriter: list of custom graph rewriters
    extra_opset: list of extra opset&#39;s, for example the opset&#39;s used by custom ops
    shape_override: dict with inputs that override the shapes given by tensorflow
    inputs_as_nchw: transpose inputs in list from nchw to nhwc
    large_model: use the ONNX external tensor storage format
    output_path: save model to output_path

Returns:
    An ONNX model_proto and an external_tensor_storage dict.
</code></pre></blockquote>
<h1 id="æ—§ç‰ˆæœ¬"><a href="#æ—§ç‰ˆæœ¬" class="headerlink" title="æ—§ç‰ˆæœ¬"></a>æ—§ç‰ˆæœ¬</h1><h2 id="ä¸€-æ‰€éœ€å·¥å…·"><a href="#ä¸€-æ‰€éœ€å·¥å…·" class="headerlink" title="ä¸€.æ‰€éœ€å·¥å…·"></a>ä¸€.æ‰€éœ€å·¥å…·</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install tf2onnx</span><br><span class="line">pip install onnx</span><br><span class="line">pip install onnxruntime</span><br></pre></td></tr></table></figure>
<h2 id="äºŒ-è½¬æ¢æµç¨‹"><a href="#äºŒ-è½¬æ¢æµç¨‹" class="headerlink" title="äºŒ.è½¬æ¢æµç¨‹"></a>äºŒ.è½¬æ¢æµç¨‹</h2><p>â‘  h5 to pb<br>â‘¡ pb to onnx</p>
<h2 id="ä¸‰-è½¬æ¢è¿‡ç¨‹"><a href="#ä¸‰-è½¬æ¢è¿‡ç¨‹" class="headerlink" title="ä¸‰.è½¬æ¢è¿‡ç¨‹"></a>ä¸‰.è½¬æ¢è¿‡ç¨‹</h2><p>é¦–å…ˆå‡†å¤‡è‡ªå·±çš„h5æ¨¡å‹ï¼›è¿™é‡Œè¦æ³¨æ„h5æ¨¡å‹çš„ä¿å­˜æ–¹å¼ï¼Œä¸åŒä¿å­˜æ–¹å¼ï¼Œå¯¹åº”ä¸åŒåŠ è½½æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">è®­ç»ƒ:  model.save()    </span><br><span class="line">åŠ è½½:  model.load_model()</span><br></pre></td></tr></table></figure><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">è®­ç»ƒ:  model.save_weights()    </span><br><span class="line">åŠ è½½:  model = LeNet()</span><br><span class="line">	  model.load_weights(weight_path) </span><br></pre></td></tr></table></figure></p>
<p>â‘  h5è½¬pb</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.framework <span class="keyword">import</span> graph_util, graph_io</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.platform <span class="keyword">import</span> gfile</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">h5_to_pb</span>(<span class="params">h5_weight_path, output_dir, out_prefix=<span class="string">&quot;output_&quot;</span>, log_tensorboard=<span class="literal">True</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_dir):</span><br><span class="line">        os.mkdir(output_dir)</span><br><span class="line">    h5_model =  load_model(h5_weight_path) </span><br><span class="line">    out_nodes = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(h5_model.outputs)):</span><br><span class="line">        out_nodes.append(out_prefix + <span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line">        tf.identity(h5_model.output[i], out_prefix + <span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    model_name = os.path.splitext(os.path.split(h5_weight_path)[-<span class="number">1</span>])[<span class="number">0</span>] + <span class="string">&#x27;.pb&#x27;</span></span><br><span class="line"></span><br><span class="line">    sess = K.get_session()</span><br><span class="line">    init_graph = sess.graph.as_graph_def()</span><br><span class="line">    main_graph = graph_util.convert_variables_to_constants(sess, init_graph, out_nodes)</span><br><span class="line">    graph_io.write_graph(main_graph, output_dir, name=model_name, as_text=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">h5_to_pb(h5_weight_path=<span class="string">&#x27;model.h5&#x27;</span>, output_dir=<span class="string">&#x27;./&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>â‘¡ pb to onnx</p>
<p>è¿™é‡Œéœ€è¦ä½¿ç”¨<a href="https://netron.app/">netron</a>æŸ¥çœ‹pbæ¨¡å‹çš„è¾“å…¥(input_image)ï¼Œè¾“å‡ºå±‚(identity)åç§°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/20210925161631.png" alt></p>
<p>è½¬åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -m tf2onnx.convert --<span class="built_in">input</span> ./model.pb  --inputs input_image:<span class="number">0</span> --outputs output_1:<span class="number">0</span> --output ./model.onnx --opset <span class="number">12</span></span><br></pre></td></tr></table></figure>
<p>â€”input: å¾…è½¬åŒ–çš„pbæ¨¡å‹</p>
<p>â€”inputs: æ¨¡å‹è¾“å…¥åç§°ï¼Œæœ‰å¤šä¸ªè¾“å…¥å¯ç”¨<code>,</code>åˆ†å‰²</p>
<p>â€”outputs: æ¨¡å‹è¾“å‡ºåç§°ï¼Œæœ‰å¤šä¸ªè¾“å‡ºå¯ç”¨<code>,</code>åˆ†å‰²</p>
<p>â€”opset: tf2onnxæ”¯æŒæ‰€æœ‰tf1.xçš„ç‰ˆæœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯opset 8ã€‚å½“ç„¶åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥æŒ‡å®šå›ºå®šçš„ç‰ˆæœ¬ â€”opset 12ï¼Œå³ä½¿ç”¨tf1.12ä»¥ä¸Šçš„ç‰ˆæœ¬</p>
<h2 id="å››-æ¨ç†æµ‹è¯•"><a href="#å››-æ¨ç†æµ‹è¯•" class="headerlink" title="å››.æ¨ç†æµ‹è¯•"></a>å››.æ¨ç†æµ‹è¯•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> onnxruntime <span class="keyword">as</span> rt</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> img_to_array</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#kerasæ¨ç†</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">img = cv2.resize(img,(<span class="number">28</span>,<span class="number">28</span>))</span><br><span class="line">img = np.array([img_to_array(img)],dtype=<span class="string">&#x27;float&#x27;</span>)/<span class="number">255.0</span></span><br><span class="line">model = load_model(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line">predict = model.predict(img)</span><br><span class="line">p = [<span class="built_in">round</span>(i,<span class="number">5</span>) <span class="keyword">for</span> i <span class="keyword">in</span> predict[<span class="number">0</span>]]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n keras :&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#opencv dnn pb</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">img = cv2.resize(img,(<span class="number">28</span>,<span class="number">28</span>))</span><br><span class="line">img = np.array([img_to_array(img)],dtype=<span class="string">&#x27;float&#x27;</span>)/<span class="number">255.0</span></span><br><span class="line">img = img.transpose((<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">net = cv2.dnn.readNetFromTensorflow(<span class="string">&quot;model.pb&quot;</span>)</span><br><span class="line">net.setInput(img)  </span><br><span class="line">out = net.forward()  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n opencv dnn pb:&#x27;</span>)</span><br><span class="line">p = [<span class="built_in">round</span>(i,<span class="number">5</span>) <span class="keyword">for</span> i <span class="keyword">in</span> out[<span class="number">0</span>]]</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#onnxruntime </span></span><br><span class="line"><span class="comment"># å‡†å¤‡è¾“å…¥</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">img = cv2.resize(img,(<span class="number">28</span>,<span class="number">28</span>))</span><br><span class="line">img = np.array([img_to_array(img)],dtype=<span class="string">&#x27;float&#x27;</span>)/<span class="number">255.0</span></span><br><span class="line"><span class="comment"># onnxè¦æ±‚è¾“å…¥æ ¼å¼ä¸ºfloat32ï¼Œéœ€è¦å°†åŒç²¾åº¦è¿›è¡Œè½¬æ¢</span></span><br><span class="line">img= img.astype(np.float32)</span><br><span class="line"><span class="comment"># åŠ è½½onnx</span></span><br><span class="line">sess=rt.InferenceSession(<span class="string">&#x27;model.onnx&#x27;</span>)</span><br><span class="line"><span class="comment"># è·å–è¾“å…¥åç§°</span></span><br><span class="line">input_name=sess.get_inputs()[<span class="number">0</span>].name</span><br><span class="line"><span class="comment"># ä»¥å­—å…¸å½¢å¼å¯¹è¾“å…¥ä¼ å‚</span></span><br><span class="line">res=sess.run(<span class="literal">None</span>,&#123;input_name:img&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n onnxruntime :&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>([<span class="built_in">round</span>(i,<span class="number">5</span>) <span class="keyword">for</span> i <span class="keyword">in</span> res[<span class="number">0</span>]])</span><br></pre></td></tr></table></figure>
<p>å¦‚å›¾æ¨ç†ç»“æœä¸€è‡´å³å¯:</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/20210925163653.png" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Tensorflow</tag>
        <tag>Keras</tag>
        <tag>onnx</tag>
      </tags>
  </entry>
  <entry>
    <title>æ±Ÿå—å¤§å­¦å­¦ä½è®ºæ–‡LaTeXæ¨¡æ¿</title>
    <url>/2021/12/06/%E6%B1%9F%E5%8D%97%E5%A4%A7%E5%AD%A6%E6%AF%95%E4%B8%9A%E8%AE%BA%E6%96%87Latex%E6%A8%A1%E6%9D%BF/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡ç”±ğŸ§ä»<a href="https://gitee.com/zhuangbo/jnthesis">zhuangbo</a>è½¬è½½</p>
</blockquote>
<h2 id="ä½¿ç”¨æ•™ç¨‹"><a href="#ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="ä½¿ç”¨æ•™ç¨‹"></a>ä½¿ç”¨æ•™ç¨‹</h2><p>æ±Ÿå—å¤§å­¦åšå£«ã€ç¡•å£«å­¦ä½ï¼ˆæ¯•ä¸šï¼‰è®ºæ–‡ LaTeX æ¨¡æ¿ã€‚<a href="https://pan.baidu.com/s/1Ps7f2OFsJX80w1wuZ57PnQ">ç‚¹æ­¤ä¸‹è½½</a>(æå–ç : 8ub7)</p>
<p>æ–‡æ¡£ç±» <code>jnthesis.cls</code> åŸºäº <code>ctex</code> å®åŒ…å®šä¹‰äº†è®ºæ–‡æ ¼å¼ï¼ŒåŒ…æ‹¬å­—ä½“ï¼Œå­—å·ï¼Œè¡Œè·ï¼Œæ ‡é¢˜ï¼Œé¡µçœ‰ï¼Œé¡µè„šï¼Œç›®å½•ï¼Œæ‘˜è¦ï¼Œæ­£æ–‡ç­‰å„ç§æ ¼å¼ã€‚</p>
<p>æ–‡ä»¶ <code>jn.bst</code> å®šä¹‰äº†å‚è€ƒæ–‡çŒ®æ ¼å¼ã€‚</p>
<p>æ¨èä½¿ç”¨ TeXlive å‘è¡Œç‰ˆï¼Œä¸æ¨èä½¿ç”¨ CTEX å‘è¡Œç‰ˆã€‚</p>
<p>ä¸ºä¾¿äºç¼–è¾‘ï¼Œé€šå¸¸å°†é•¿æ–‡æ¡£åˆ†æˆè‹¥å¹²æ–‡ä»¶ã€‚æœ¬è®ºæ–‡æ¨¡æ¿è¿˜æä¾›äº†ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ–‡ä»¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root.tex</code></td>
<td>ä¸»æ–‡æ¡£ï¼Œæ•´ä¸ªæ–‡æ¡£ç»“æ„ï¼Œç”¨ XeLaTeX ç¼–è¯‘æ­¤æ–‡æ¡£</td>
</tr>
<tr>
<td><code>main.tex</code></td>
<td>ä¸»è¦å†…å®¹ï¼ŒåŒ…å«ä¸»è¦ç« èŠ‚å†…å®¹</td>
</tr>
<tr>
<td><code>cover.doc</code></td>
<td>å°é¢ï¼ŒDOC æ–‡ä»¶ï¼Œä¿®æ”¹ç¼–è¾‘åå¦å­˜ä¸º PDF</td>
</tr>
<tr>
<td><code>cover.pdf</code></td>
<td>å°é¢ï¼ŒPDF æ–‡ä»¶ï¼Œæ’å…¥æ–‡æ¡£</td>
</tr>
<tr>
<td><code>statement.doc</code></td>
<td>å£°æ˜å’Œæˆæƒï¼ŒDOC æ–‡ä»¶ï¼Œä¿®æ”¹ç¼–è¾‘åå¦å­˜ä¸º PDF</td>
</tr>
<tr>
<td><code>statement.pdf</code></td>
<td>å£°æ˜å’Œæˆæƒï¼ŒPDF æ–‡ä»¶ï¼Œæ’å…¥æ–‡æ¡£</td>
</tr>
<tr>
<td><code>setup/settings.tex</code></td>
<td>ç”¨æˆ·è®¾ç½®ï¼Œå¦‚ï¼šæ ‡é¢˜ï¼Œä½œè€…ï¼Œå…¶ä»–å®åŒ…å’Œæ ·å¼ç­‰</td>
</tr>
<tr>
<td><code>setup/userdefs.tex</code></td>
<td>ç”¨æˆ·è‡ªå®šä¹‰ç¬¦å·</td>
</tr>
<tr>
<td><code>preface/e_abstract.tex</code></td>
<td>è‹±æ–‡æ‘˜è¦å’Œè‹±æ–‡å…³é”®è¯</td>
</tr>
<tr>
<td><code>preface/c_abstract.tex</code></td>
<td>ä¸­æ–‡æ‘˜è¦å’Œä¸­æ–‡å…³é”®è¯</td>
</tr>
<tr>
<td><code>body/*.tex</code></td>
<td>å„ç« èŠ‚å†…å®¹ï¼Œä¸éœ€è¦æ—¶åœ¨ main.tex ä¸­åˆ é™¤</td>
</tr>
<tr>
<td><code>appendix/acknowledgements.tex</code></td>
<td>è‡´è°¢</td>
</tr>
<tr>
<td><code>appendix/publications.tex</code></td>
<td>å‘è¡¨è®ºæ–‡</td>
</tr>
<tr>
<td><code>references.bib</code></td>
<td>å‚è€ƒæ–‡çŒ®æ•°æ®åº“</td>
</tr>
<tr>
<td><code>figures/...</code></td>
<td>æ’å›¾</td>
</tr>
</tbody>
</table>
</div>
<p>å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>æ‰“å¼€ <code>root.tex</code> æ–‡ä»¶ï¼Œè®¾ç½®æ–‡æ¡£å‚æ•°ä»¥æŒ‡å®šåšå£« (<code>doctor</code>)ï¼Œç¡•å£« (<code>master</code>) æˆ–æ¯•ä¸š(<code>nodegree</code>) è®ºæ–‡ã€‚</p>
</li>
<li><p>æ‰“å¼€ <code>main.tex</code> æ–‡ä»¶ï¼Œè§„åˆ’è®ºæ–‡ä¸»è¦ç« èŠ‚ã€‚ä¸éœ€è¦çš„ç« èŠ‚å¯ä»¥åˆ é™¤æˆ–æ³¨é‡Šæ‰ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>cover.doc</code> æ–‡ä»¶ç”Ÿæˆå°é¢ <code>cover.pdf</code>ã€‚</p>
</li>
<li><p>ä¿®æ”¹ (å¦‚æœ‰å¿…è¦) statement.doc<code>ç”Ÿæˆ</code>statement.pdf`ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>setup/settings.tex</code> è®¾ç½®æ ‡é¢˜ï¼Œä½œè€…ï¼ŒåŒ…å«å…¶ä»–å®åŒ…ç­‰å…¶ä»–è®¾ç½®ã€‚</p>
</li>
<li><p>ä¿®æ”¹ (å¦‚æœ‰å¿…è¦) <code>setup/userdefs.tex</code> æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰ç¬¦å·æˆ–å‘½ä»¤ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>preface/e_abstract.tex</code> æ·»åŠ è‹±æ–‡æ‘˜è¦å’Œè‹±æ–‡å…³é”®è¯ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>preface/c_abstract.tex</code> æ·»åŠ ä¸­æ–‡æ‘˜è¦å’Œä¸­æ–‡å…³é”®è¯ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>body/ch01.tex</code> ç­‰ï¼Œæ’°å†™å„ç« å†…å®¹ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>appendix/acknowledgements.tex</code> æ·»åŠ è‡´è°¢å†…å®¹ã€‚</p>
</li>
<li><p>ä¿®æ”¹ <code>appendix/publications.tex</code> æ·»åŠ å‘è¡¨è®ºæ–‡ã€‚</p>
</li>
<li><p>ä¿®æ”¹ä»»ä½•å†…å®¹åï¼Œç”¨ XeLaTeX ç¼–è¯‘ <code>root.tex</code> æ–‡ä»¶å¾—åˆ°æœ€ç»ˆè®ºæ–‡ <code>root.pdf</code>ã€‚è‹¥å‚è€ƒæ–‡çŒ®ä¸æ­£ç¡®ï¼Œé¦–å…ˆæ‰§è¡Œ BibTeXï¼Œå†å¤šæ¬¡ (ä¸‰æ¬¡ä»¥ä¸Š) æ‰§è¡Œ XeLaTeXï¼Œç›´åˆ°å¾—åˆ°æ­£ç¡®çš„å‚è€ƒæ–‡çŒ®.</p>
</li>
</ol>
<p>ä¸€æ¬¡å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹ä¸º XeLaTeX &gt; BibTeX &gt; XeLaTeX &gt; XeLaTeX &gt; XeLaTeXã€‚ é€šå¸¸åœ¨å¼•ç”¨å‚è€ƒæ–‡çŒ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä»…éœ€è¦æ‰§è¡Œä¸€æ¬¡ XeLaTeXã€‚ ç”±äºå·²ç»æŠŠæ•´ä¸ªæ–‡æ¡£åˆ’åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼ŒåŠ å¿«äº†ç¼–è¯‘é€Ÿåº¦ã€‚ å½“ bib æ–‡çŒ®æ•°æ®åº“æˆ–æ–‡çŒ®å¼•ç”¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ºç¡®ä¿æœ€ç»ˆå†…å®¹æ­£ç¡®ï¼Œå¯ä»¥æ‰§è¡Œä¸€éå®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹ã€‚</p>
<p>æœ¬æ¨¡æ¿é‡‡ç”¨ MIT åè®®æˆæƒï¼Œå¦‚æœ‰ä¸å®Œå–„ä¹‹å¤„è¯·è‡ªè¡Œä¿®æ”¹ä»£ç ã€‚</p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
  </entry>
  <entry>
    <title>Potplayeræ·»åŠ ç›´æ’­æº</title>
    <url>/2020/06/13/Potplayer%E6%B7%BB%E5%8A%A0%E7%9B%B4%E6%92%AD%E6%BA%90/</url>
    <content><![CDATA[<p>å…·ä½“æ“ä½œå…ˆæ‰“å¼€ PotPlayerï¼Œå³é”®é€‰æ‹© <strong>æ‰“å¼€</strong> -&gt; <strong>æ‰“å¼€é“¾æ¥</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/player/640.webp" alt></p>
<p>æ¥ä¸‹æ¥å¤åˆ¶<strong>ç›´æ’­æºåˆ° Potplayer é‡Œ</strong>ï¼Œç‚¹å‡»ç¡®å®š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/player/641.webp" alt></p>
<p><strong>è¿™é‡ŒæˆåŠŸæ·»åŠ äº†1015ä¸ªä¸­å›½åŒºåŸŸçš„ç”µè§†é¢‘é“ï¼Œè€Œä¸”æ¸…æ™°åº¦éƒ½åœ¨1080P</strong>ï¼Œä¸ä»…æœ‰å¤®è§†ï¼Œè¿˜æœ‰æ‰€æœ‰å«è§†å’Œä¸€äº›åœ°æ–¹å°</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/player/642.webp" alt></p>
<p>ç›´æ’­æºå¯ä»¥åœ¨Githubä¸Šæ‰¾åˆ°ï¼Œè¿™é‡Œæ”¾å‡ºé“¾æ¥ <a href="https://github.com/iptv-org/iptv/blob/master/README.md">ç‚¹æ­¤è·³è½¬</a></p>
<p>é‡Œé¢åå«iptvçš„ä»“åº“æ”¶é›†äº†å…¨ä¸–ç•Œå°†è¿‘100ä¸ªå›½å®¶çš„é¢‘é“ï¼Œæ€»è®¡è¾¾åˆ°8000å¤šã€‚å¹¶æŒ‰ç±»åˆ«ï¼Œè¯­è¨€å’Œå›½å®¶è¿›è¡Œäº†åˆ†ç±»ã€‚è¿™é‡Œå›¾ä¸­åªå±•ç¤ºäº†ä¸€å°éƒ¨åˆ†ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/player/643.webp" alt></p>
<p>æ¯”å¦‚ä¸­å›½å¯¹åº”çš„æ˜¯ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/player/644.webp" alt></p>
<p>é™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰æ—¥æœ¬ï¼Œç¾å›½ï¼Œè‹±å›½ç­‰ï¼Œéœ€è¦çš„å¯ä»¥è‡ªè¡Œå¯»æ‰¾æ·»åŠ ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>potplayer</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ é€Ÿpytorchæ•°æ®è¯»å–</title>
    <url>/2020/09/13/%E5%8A%A0%E9%80%9Fpytorch%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>prefetch_generatoræ˜¯ç¬¬ä¸‰æ–¹å¯¹åŸæœ¬çš„DataLoaderè¿›è¡Œé‡å†™çš„å‡½æ•°åŒ…ï¼Œå®ƒå°†ä»»æ„ç”Ÿæˆå™¨è½¬æ¢ä¸ºåå°theadç”Ÿæˆå™¨ï¼Œåœ¨å¹¶è¡Œåå°theadä¸­é¢„å–å¤šæ‰¹æ•°æ®ã€‚</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªè®¡ç®—é‡å¾ˆå¤§çš„è¿›ç¨‹ï¼ˆCPUæˆ–GPUï¼‰ï¼Œåœ¨ç”Ÿæˆå™¨æ¶ˆè€—å…¶ä»–èµ„æºï¼ˆç£ç›˜IO/ä»æ•°æ®åº“åŠ è½½/å¦‚æœæœ‰æœªä½¿ç”¨çš„å†…æ ¸ï¼Œåˆ™æœ‰æ›´å¤šCPUï¼‰çš„åŒæ—¶è¿­ä»£å¤„ç†ç”Ÿæˆå™¨ä¸­çš„å°æ‰¹é‡ï¼Œåˆ™è¿™éå¸¸æœ‰ç”¨ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å°†ä¸æ–­ç­‰å¾…å¯¹æ–¹å®Œæˆã€‚å¦‚æœè®©ç”Ÿæˆå™¨åœ¨é¢„å–æ¨¡å¼ä¸‹å·¥ä½œï¼Œå®ƒä»¬å°†å¹¶è¡Œå·¥ä½œï¼Œå¯èƒ½ä¼šèŠ‚çœGPUæ—¶é—´ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install prefetch_generator </span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>ä¹‹å‰åŠ è½½æ•°æ®é›†çš„æ­£ç¡®æ–¹å¼æ˜¯ä½¿ç”¨<code>torch.utils.data.DataLoader</code>ï¼Œç°åœ¨æˆ‘ä»¬åªè¦åˆ©ç”¨è¿™ä¸ªåº“ï¼Œæ–°å»ºä¸ª<code>DataLoaderX</code>ç±»ç»§æ‰¿<code>DataLoader</code>å¹¶é‡å†™<code>__iter__</code>æ–¹æ³•å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ–°å»ºDataLoaderXç±»</span><br><span class="line">from torch.utils.data import DataLoader</span><br><span class="line">from prefetch_generator import BackgroundGenerator</span><br><span class="line"></span><br><span class="line">class DataLoaderX(DataLoader):</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return BackgroundGenerator(super().__iter__())</span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨ <code>DataLoaderX</code> æ›¿æ¢åŸæœ¬çš„ <code>DataLoader</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">train_dataset = MyDataset(<span class="string">&quot;.........&quot;</span>)</span><br><span class="line">train_loader = DataLoaderX(dataset=train_dataset, </span><br><span class="line">                           batch_size=batch_size, num_workers=<span class="number">4</span>, shuffle=shuffle)</span><br></pre></td></tr></table></figure>
<h2 id="æé€ŸåŸå› "><a href="#æé€ŸåŸå› " class="headerlink" title="æé€ŸåŸå› "></a>æé€ŸåŸå› </h2><p>åŸæœ¬Pytorché»˜è®¤çš„DataLoaderä¼šåˆ›å»ºä¸€äº›workerçº¿ç¨‹æ¥é¢„è¯»å–æ–°çš„æ•°æ®ï¼Œä½†æ˜¯é™¤éè¿™äº›çº¿ç¨‹çš„æ•°æ®å…¨éƒ¨éƒ½è¢«æ¸…ç©ºï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šè¯»ä¸‹ä¸€æ‰¹æ•°æ®ã€‚ä½¿ç”¨prefetch_generatoråœ¨åå°åŠ è½½ä¸‹ä¸€batchçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯çº¿ç¨‹ä¸ä¼šç­‰å¾…ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ€»æœ‰è‡³å°‘ä¸€ä¸ªæ•°æ®åœ¨åŠ è½½ã€‚</p>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/prefetch_generator/1.png" alt></p>
<p>åœ¨ hdd ç¡¬ç›˜ä¸Šï¼Œç”¨åŒæ ·çš„å‚æ•°ã€åŒæ ·çš„æ•°æ®ï¼Œåˆ†åˆ«ç”¨ä¸åŒçš„ä¼˜åŒ–æ–¹æ³•ï¼Œè®­ç»ƒä¸¤ä¸ªepochï¼Œè®°å½•è®­ç»ƒçš„æ—¶é—´ã€‚</p>
<p>ä¼˜åŒ–æ–¹æ³•åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>original</code>ï¼šé»˜è®¤ dataloaderï¼Œä¸ä¼˜åŒ–</li>
<li><code>(1)prefetcher_generator</code>ï¼šåªç”¨ prefetcher_generator åº“ä¼˜åŒ–</li>
<li><code>(2)data_prefetcher</code>ï¼šåªç”¨ data_prefetcher ä¼˜åŒ–</li>
<li><code>(1)+(2)</code>ï¼šåŒæ—¶ç”¨ <code>prefetcher_generator</code> å’Œ <code>data_prefetcher</code> ä¼˜åŒ–</li>
</ul>
<p>æœ€åå°†å¾—åˆ°çš„æ—¶é—´ï¼Œé™¤ä»¥ä¸ä¼˜åŒ–æ—¶çš„è®­ç»ƒæ—¶é—´ã€‚</p>
<p>ä»å›¾ä¸­å¯ä»¥è§‚å¯Ÿåˆ°ï¼š</p>
<ol>
<li>(1) å’Œ (2) ä¸¤ç§ä¼˜åŒ–æ–¹æ³•éƒ½å·®ä¸å¤šæœ‰ 10% å·¦å³çš„è®­ç»ƒæ—¶é—´çš„ç¼©çŸ­ï¼›</li>
<li>(1) (2) åŒæ—¶ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¿›ä¸€æ­¥ç¼©çŸ­è®­ç»ƒæ—¶é—´ï¼Œåè€Œä¸å¦‚åªä½¿ç”¨ä¸€ç§ä¼˜åŒ–æ–¹æ³•ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>çŸ©é˜µåˆ†æï¼ˆåˆ˜ä¸é…‰ï¼‰è¯¾åç­”æ¡ˆåŠå†å¹´è¯•å·</title>
    <url>/2019/12/20/%E7%9F%A9%E9%98%B5%E5%88%86%E6%9E%90%EF%BC%88%E5%88%98%E4%B8%81%E9%85%89%EF%BC%89%E8%AF%BE%E5%90%8E%E7%AD%94%E6%A1%88%E5%8F%8A%E5%8E%86%E5%B9%B4%E8%AF%95%E5%8D%B7/</url>
    <content><![CDATA[<p>è€ƒè™‘åˆ°åˆ˜ä¸é…‰ç‰ˆæœ¬åªæœ‰éƒ¨åˆ†ä¹ é¢˜çš„è§£ç­”ï¼Œè¿˜ä¸å¤Ÿè¯¦ç»†ï¼Œäºæ˜¯æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå°†æ¯é“ä¹ é¢˜åšäº†ä¸€éï¼Œå¹¶è®°å½•äº†ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½å¯¹å­¦ä¹ çŸ©é˜µåˆ†æçš„åŒå­¦ç»™äºˆä¸€å®šçš„å‚è€ƒã€‚ç”±äºæœ¬äººä»åœ¨å­¦ä¹ é˜¶æ®µï¼Œéš¾å…ç­”æ¡ˆä¼šæœ‰åšé”™çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦å°½ä¿¡ç­”æ¡ˆï¼Œåªå½“ä½œä¸€ä¸ªæ€è·¯ä¸Šçš„å‚è€ƒæ¥çœ‹ã€‚é¡ºä¾¿é™„èµ å†å¹´çš„å·å­ä¸ç­”æ¡ˆï¼ˆçœ‹äº†ä¸€éå†å¹´çš„å·å­ï¼Œç­”æ¡ˆæœ‰é”™!@-@ï¼‰</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.jianguoyun.com/p/DQe8_9kQlZ_3Bhid4LYC">ç‚¹å‡»ä¸‹è½½</a></p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
  </entry>
  <entry>
    <title>å†å±ŠCCFé¡¶ä¼šåœ°ç‚¹æŸ¥è¯¢</title>
    <url>/2020/12/11/%E5%8E%86%E5%B1%8ACCF%E9%A1%B6%E4%BC%9A%E5%9C%B0%E7%82%B9%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é‰´äºæŸäº›å‚è€ƒæ–‡çŒ®ï¼Œåœ¨å¼•ç”¨ä¼šè®®æ—¶éœ€è¦æ³¨æ˜å¼€ä¼šåœ°ç‚¹ï¼Œç„¶è€Œè°·æ­Œå­¦æœ¯ä¸­å¹¶ä¸èƒ½æä¾›ä¼šè®®åœ°ç‚¹ï¼Œè¿™é‡Œæä¾›ä¸€äº›å¸¸ç”¨ä¼šè®®åœ°ç‚¹çš„æ£€ç´¢ç½‘å€ã€‚</p>
<h2 id="åœ°ç‚¹æŸ¥è¯¢"><a href="#åœ°ç‚¹æŸ¥è¯¢" class="headerlink" title="åœ°ç‚¹æŸ¥è¯¢"></a>åœ°ç‚¹æŸ¥è¯¢</h2><p>å†å±ŠNIPSä¼šè®®åœ°å€ï¼š<a href="https://www.datalearner.com/conference/nips/">https://www.datalearner.com/conference/nips/</a><br>å†å±ŠECCVä¼šè®®åœ°å€ï¼š<a href="https://link.springer.com/conference/eccv">https://link.springer.com/conference/eccv</a><br>å†å±ŠBMVCä¼šè®®åœ°å€ï¼š<a href="https://britishmachinevisionassociation.github.io/bmvc">https://britishmachinevisionassociation.github.io/bmvc</a><br>å†å±ŠIEEEä¸‹çš„ä¼šè®®åœ°å€ï¼ˆå¦‚CVPRï¼ŒICCVç­‰ï¼‰è¯·åˆ°IEEEä¸‹æœè®ºæ–‡å¯¼å‡ºå‚è€ƒæ–‡çŒ®å¯å¾—ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/2.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/1.jpg" alt></p>
<p>è¿™é‡Œä¹Ÿæä¾›å†å±ŠECCVã€ICCVã€CVPRã€WACVåœ°å€ï¼š<a href="https://www.thecvf.com/?page_id=100">https://www.thecvf.com/?page_id=100</a></p>
<h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>æŸ¥è¯¢åˆ°åœ°ç‚¹åæ‰‹åŠ¨æ·»åŠ è¿›EndNoteé¢˜å½•çš„å…³é”®å­—å³å¯ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/wenxian/3.png" alt></p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•ç»™çƒ­ç‚¹ç¿»å¢™</title>
    <url>/2020/02/16/%E5%A6%82%E4%BD%95%E7%BB%99%E7%83%AD%E7%82%B9%E7%BF%BB%E5%A2%99/</url>
    <content><![CDATA[<h2 id="Netchç®€ä»‹"><a href="#Netchç®€ä»‹" class="headerlink" title="Netchç®€ä»‹"></a>Netchç®€ä»‹</h2><p>Netchæ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œæ¸¸æˆå·¥å…·ï¼Œæ”¯æŒSocks5ã€55Rã€V2ç­‰åè®®ï¼ŒUDP NAT  FullConeåŠæŒ‡å®šè¿›ç¨‹åŠ é€Ÿï¼ˆä¸éœ€è¦éº»çƒ¦çš„IPè§„åˆ™ï¼‰ã€‚åŠŸèƒ½ä¸Šå’ŒSSTAPå·®ä¸å¤šï¼Œä¸è¿‡å¬è¯´åŠ é€Ÿæ•ˆæœæ¯”åè€…è¦æ›´å¥½ï¼Œç”šè‡³å ªæ¯”ä¸€äº›ä»˜è´¹çš„åŠ é€Ÿå™¨ï¼Œå½“ç„¶å‰æéœ€è¦ä½ çš„çº¿è·¯ç»™åŠ›ï¼Œä¸ç„¶åŠ é€Ÿå°±æ²¡æ„ä¹‰äº†ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-1.jpg" alt></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ä¸‹è½½ Netch å®¢æˆ·ç«¯ï¼Œè§£å‹åä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ Netch.exeã€‚è‹¥ç³»ç»Ÿæç¤ºéœ€è¦å®‰è£… .NET Frameworkï¼Œè¯·<a href="https://www.microsoft.com/net/download/dotnet-framework-runtime">ç‚¹æ­¤</a>è®¿é—®å¾®è½¯å®˜ç½‘ä¸‹è½½å®‰è£…ã€‚</p>
<p><strong>Githubåœ°å€ï¼š</strong><a href="https://github.com/netchx/Netch">https://github.com/netchx/Netch</a></p>
<p><strong>ä¸‹è½½åœ°å€ï¼š</strong><a href="https://github.com/netchx/Netch/releases">https://github.com/netchx/Netch/releases</a></p>
<p>æ‰“å¼€ç¨‹åºåï¼Œé€‰ä¸­ â€œè®¢é˜…â€ &gt; â€œç®¡ç†è®¢é˜…é“¾æ¥â€</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-2.jpg" alt></p>
<p>ç²˜è´´æœåŠ¡å•†æä¾›çš„è®¢é˜…é“¾æ¥åˆ°å·¦ä¸‹è§’çš„é“¾æ¥ï¼Œå¤‡æ³¨éšä¾¿å¡«å†™ï¼Œç‚¹å‡»æ·»åŠ ï¼Œç„¶åç‚¹å‡»ä¿å­˜</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-3.jpg" alt></p>
<p>ä¹Ÿå¯ä»¥ä»å‰ªåˆ‡æ¿æ·»åŠ èŠ‚ç‚¹</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2019-06-24_10-48-31.png" alt></p>
<p>é€‰æ‹©<code>Bypass LAN and China #ç»•è¿‡å±€åŸŸç½‘å’Œå¤§é™†</code>ï¼Œç‚¹å‡»å¯åŠ¨ï¼Œå³å¯</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_12-45-58.jpg" alt></p>
<p>æ¨¡å¼ä¸­ä¹Ÿå¯ä»¥é€‰æ‹©ç›¸åº”çš„æ¸¸æˆè¿›è¡ŒåŠ é€Ÿï¼Œä¹Ÿæ”¯æŒç»™Xshellå’ŒXftpè¿æ¥å›½å¤–æœåŠ¡å™¨è¿›è¡ŒåŠ é€Ÿ</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-7.jpg" alt></p>
<p>å¦‚æœéœ€è¦åŠ é€Ÿçš„æ¸¸æˆä¸åœ¨åˆ—è¡¨é‡Œé¢ï¼Œé‚£ä¹ˆå°±é€‰ä¸­ â€œæ¨¡å¼â€ &gt; â€œåˆ›å»ºè¿›ç¨‹æ¨¡å¼â€</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-4.jpg" alt></p>
<p>ç‚¹å‡» â€œæ‰«æâ€ é€‰å–ä½ æ¸¸æˆå®‰è£…ç›®å½•åé€‰æ‹©ç¡®å®šå³å¯æ·»åŠ ï¼Œå®ƒå°†è‡ªåŠ¨åŠ è½½å…¶ä¸­çš„exeæ–‡ä»¶ï¼Œç‚¹å‡»ä¿å­˜å³å¯é€‰æ‹©åº”ç”¨æ­¤æ¨¡å¼</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/windows-netch-6.jpg" alt>                            </p>
<p>è‹¥éœ€å¼€å¯çƒ­ç‚¹ï¼Œç»™å…¶ä»–è®¾å¤‡ä¹Ÿç¿»å¢™ï¼Œåˆ™éœ€è¦Tapè™šæ‹Ÿç½‘å¡çš„æ”¯æŒï¼Œè‡ªè¡ŒæŸ¥çœ‹è‡ªå·±ç”µè„‘æ˜¯å¦è£…æœ‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_12-58-05.jpg" alt></p>
<p>è‹¥æœªå®‰è£…åˆ™å»<a href="https://build.openvpn.net/downloads/releases/tap-windows-9.21.2.exe">TAP-Windows</a>ä¸‹è½½å®‰è£…ï¼ŒClashã€OpenVPNç­‰è½¯ä»¶ä¸­ä¹Ÿæä¾›äº†å®‰è£…</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_12-57-35.jpg" alt></p>
<p>ç¡®è®¤Tapç½‘å¡ipä¸ºè‡ªåŠ¨è·å–</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_13-21-22.jpg" alt></p>
<p>é€‰æ‹©<code>Bypass LAN and China (TUN/TAP)</code>ï¼Œç‚¹å‡»å¯åŠ¨</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_12-52-59.jpg" alt></p>
<p>å¯åŠ¨çƒ­ç‚¹ï¼Œä¼šå‘ç°åœ¨ç½‘ç»œé€‚é…å™¨ä¸­å¤šå‡ºä¸€ä¸ªæœ¬åœ°è¿æ¥</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_13-26-48.jpg" alt></p>
<p>å³é”®Tapç½‘å¡ï¼Œå±æ€§â€”å…±äº«ï¼Œé€‰æ‹©Internetè¿æ¥å…±äº«ï¼Œæ·»åŠ çƒ­ç‚¹æ‰€å¯¹åº”çš„æœ¬åœ°è¿æ¥</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/Snipaste_2020-02-16_13-28-32.jpg" alt></p>
<p>æ­¤æ—¶ï¼Œçƒ­ç‚¹å³å¯æˆåŠŸç¿»å¢™</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/netch/TIM%E5%9B%BE%E7%89%8720200216133203.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•é…ç½®SwitchyOmegaæ’ä»¶</title>
    <url>/2020/02/16/%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AESwitchyOmega%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>SwitchyOmegaæ˜¯ Chrome å’Œ Firefox æµè§ˆå™¨ä¸Šçš„ä»£ç†æ‰©å±•ç¨‹åº,å¯ä»¥è½»æ¾å¿«æ·çš„ç®¡ç†å’Œåˆ‡æ¢å¤šä¸ªä»£ç†è®¾ç½®ã€‚æ¥ç®¡æµè§ˆå™¨ä»£ç†æ–¹å¼ï¼Œå¯ç¬é—´åˆ‡æ¢ä»£ç†å’Œæœ¬åœ°è¿æ¥æ–¹å¼ï¼Œé…åˆsocks5ï¼ˆç­‰å…¶ä»–ä»£ç†å·¥å…·ï¼‰å¯å®ç°åªä»£ç†éƒ¨åˆ†å›½å†…æ— æ³•è®¿é—®çš„ç½‘ç«™ã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>è¿›å…¥æ’ä»¶é€‰é¡¹ç•Œé¢</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_13-39-31.jpg" alt></p>
<p>é€‰æ‹©æ–°å»ºæƒ…æ™¯æ¨¡å¼â€”ä»£ç†æœåŠ¡å™¨ï¼Œåç§°è‡ªå–</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_13-41-23.jpg" alt></p>
<p>æ‰¾åˆ°è½¯ä»¶æ‰€æä¾›çš„Socksç«¯å£å·ï¼Œè¿™é‡Œä»¥clashä¸ºä¾‹</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-51-02.jpg" alt></p>
<p>SSRã€Netchç­‰åŒç†</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-52-44.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-53-32.jpg" alt></p>
<p>æŒ‰ä»¥ä¸‹æ ¼å¼é…ç½®ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-49-43.jpg" alt></p>
<p>æ¥ç€æ–°å»ºæƒ…æ™¯æ¨¡å¼â€”è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåå­—è‡ªå–</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-55-29.jpg" alt></p>
<p>è§„åˆ™åˆ—è¡¨æ ¼å¼ä¸ºï¼šAutoProxy</p>
<p>è§„åˆ™åˆ—è¡¨ç½‘å€ä¸ºï¼š<code>https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</code></p>
<p>ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œåˆ™ä¼šè‡ªåŠ¨åŠ è½½PACåˆ—è¡¨</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_14-57-22.jpg" alt></p>
<p>åˆ‡æ¢è§„åˆ™æŒ‰å¦‚ä¸‹é…ç½®ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_15-01-34.jpg" alt></p>
<p>æ„æ€æ˜¯ï¼Œé€‰æ‹©autoæ¨¡å¼æ—¶ï¼Œæ’ä»¶ä¸ºæ ¹æ®PACè§„åˆ™åˆ¤æ–­æ˜¯å¦è¦èµ°ä»£ç†</p>
<p>ç°åœ¨è½¯ä»¶åœ¨åå°å¯åŠ¨ç€ï¼Œä¸éœ€è¦å¼€å¯ä»£ç†ï¼Œéƒ½å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„æ­¤æ’ä»¶è¿›è¡Œåˆ‡æ¢ï¼ŒPACæ¨¡å¼é€‰autoï¼Œå…¨å±€é€‰ä»£ç†æœåŠ¡å™¨ï¼Œä¸ä»£ç†é€‰ç›´è¿</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/switchyomega/Snipaste_2020-02-16_15-06-10.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨frpæœåŠ¡å®ç°å¯¹å†…ç½‘æœºå™¨çš„è¿œç¨‹è¿æ¥</title>
    <url>/2020/02/16/%E4%BD%BF%E7%94%A8frp%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/</url>
    <content><![CDATA[<h2 id="ä¸ºä½•è¦ç”¨"><a href="#ä¸ºä½•è¦ç”¨" class="headerlink" title="ä¸ºä½•è¦ç”¨"></a>ä¸ºä½•è¦ç”¨</h2><p>æˆ‘ä»¬å¹¶ä¸æ˜¯æ¯å¤©éƒ½ä¼šæ¥è§¦åˆ°å®éªŒå®¤å†…ç½‘ç¯å¢ƒã€‚å½“ä¸åœ¨å­¦æ ¡æ—¶ï¼Œå¦‚ä½•è®¿é—®å†…ç½‘çš„èµ„æºæˆäº†ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ã€‚æœ¬æ–‡æ—¨åœ¨æå‡ºä¸€ç§å†…ç½‘ç©¿é€è§£å†³æ–¹æ¡ˆï¼Œåœ¨å¤–ç½‘ç¯å¢ƒä¸‹ä¼˜é›…çš„è®¿é—®åˆ°å†…ç½‘çš„ä»»ä½•ç«¯å£ã€‚å³ä½¿èº«ç¦»å­¦æ ¡ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ä¿®æ”¹å†…ç½‘æ¨¡å‹ï¼Œè®¿é—®å†…ç½‘è®¡ç®—èµ„æºã€‚ </p>
<h2 id="ç‰¹æ®Šéœ€è¦"><a href="#ç‰¹æ®Šéœ€è¦" class="headerlink" title="ç‰¹æ®Šéœ€è¦"></a>ç‰¹æ®Šéœ€è¦</h2><ul>
<li><p>ä¸€å°å…¬ç½‘æœºï¼ˆæœ‰å…¬ç½‘ipçš„vpsï¼Œ æ¯”å¦‚é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼‰</p>
</li>
<li><p>frp ç«¯å£è½¬å‘è½¯ä»¶ :<a href="https://github.com/fatedier/frp/releases">ä¸‹è½½åœ°å€</a></p>
</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>windowsä¸ç”¨è¯´ï¼Œè¿™é‡Œè®²Ubuntuçš„å®‰è£…</p>
<p>é€‰æ‹©ç›¸åº”ç‰ˆæœ¬ï¼Œå³é”®å¤åˆ¶é“¾æ¥</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/Snipaste_2020-02-16_15-19-58.jpg" alt></p>
<p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥<code>wget å¤åˆ¶çš„é“¾æ¥åœ°å€</code>å³å¯å¼€å§‹ä¸‹è½½</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/Snipaste_2020-02-16_15-25-08.jpg" alt></p>
<p>ä¸‹è½½å®Œæˆåï¼Œæ‰¾åˆ°å®‰è£…åŒ…ï¼Œè§£å‹å³å¯ï¼Œè§£å‹å‘½ä»¤ä¸º<code>tar -zxvf åŒ…å</code></p>
<p><strong>å…¬ç½‘æœºã€å†…ç½‘æœºéƒ½éœ€è¦å®‰è£…ï¼Œä¸”frpç‰ˆæœ¬è¦ä¸€è‡´ã€‚</strong></p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="å…¬ç½‘æœºé…ç½®"><a href="#å…¬ç½‘æœºé…ç½®" class="headerlink" title="å…¬ç½‘æœºé…ç½®"></a>å…¬ç½‘æœºé…ç½®</h3><p>ä¿®æ”¹ <strong>frps.ini</strong> æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨äº†æœ€ç®€åŒ–çš„é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000 <span class="comment">#è¿™ä¸ªç«¯å£ä»£è¡¨å†…ç½‘æœºè¿åˆ°å…¬ç½‘æ‰€éœ€ç«¯å£ï¼Œé»˜è®¤7000ï¼Œå¯è‡ªå·±å®šä¹‰</span></span><br></pre></td></tr></table></figure>
<p>Windows å¯åŠ¨ frpsï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frps.exe -c ./frps.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu å¯åŠ¨ frps:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu åœ¨åå°å¼€å¯è¿è¡Œ frp æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nohup ./frps -c frps.ini &gt;/dev/null 2&gt;&amp;1 &amp; </span><br></pre></td></tr></table></figure>
<h3 id="å†…ç½‘æœºå™¨é…ç½®"><a href="#å†…ç½‘æœºå™¨é…ç½®" class="headerlink" title="å†…ç½‘æœºå™¨é…ç½®"></a>å†…ç½‘æœºå™¨é…ç½®</h3><p>ä¿®æ”¹ <strong>frpc.ini</strong> æ–‡ä»¶ï¼Œå‡è®¾ <strong>frps</strong> æ‰€åœ¨æœåŠ¡å™¨çš„å…¬ç½‘ IP ä¸º x.x.x.xï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = x.x.x.x #è¿™é‡Œå¯ä»¥æ˜¯å…¬ç½‘æœºçš„åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ip</span><br><span class="line">server_port = 7000 #åˆšåˆšå…¬ç½‘æœºé…ç½®çš„ä¸å†…ç½‘æœºäº¤æ¢çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22 #æœ¬åœ°ç«¯å£å·ï¼Œæœ¬åœ°éœ€è¦è½¬å‘çš„ç«¯å£ é»˜è®¤22 å¯è‡ªå·±è®¾å®š</span><br><span class="line">remote_port = 6000  #è¿œç¨‹ç«¯å£å·ï¼Œå°†ç«¯å£æ˜ å°„åˆ°å…¬ç½‘ç›¸åº”çš„ç«¯å£ å¯è‡ªå·±è®¾å®š</span><br></pre></td></tr></table></figure>
<p>Windows å¯åŠ¨ frpcï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frpc.exe -c ./frpc.ini</span><br></pre></td></tr></table></figure>
<p>Ubuntu å¯åŠ¨ frpcï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frpc -c ./frpc.ini</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œä½ å°±å¯ä»¥é€šè¿‡ä½ çš„å¤–ç½‘ IP + è¿œç¨‹ç«¯å£å·æ¥å®ç°å¯¹å†…ç½‘ç›¸å…³æœåŠ¡çš„è®¿é—®äº†ã€‚</p>
<h2 id="è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºå¯åŠ¨"></a>è®¾ç½®å¼€æœºå¯åŠ¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/systemd/system/frpc.service</span><br></pre></td></tr></table></figure>
<p>æŒ‰å¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=frpc daemon</span><br><span class="line">After=syslog.target  network.target</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/sbin/frp/frpc -c /etc/frp/frpc.ini</span><br><span class="line">Restart= always</span><br><span class="line">RestartSec=1min</span><br><span class="line">ExecStop=/usr/bin/killall frpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>sudo systemctl enable frpc.service</code>å¯ç”¨æœåŠ¡</p>
<p>æœåŠ¡å™¨ç«¯ï¼ˆå…¬ç½‘æœºå™¨ï¼‰åŒç†</p>
<h2 id="ç™½å«–ç®€åŒ–æ­¥éª¤"><a href="#ç™½å«–ç®€åŒ–æ­¥éª¤" class="headerlink" title="ç™½å«–ç®€åŒ–æ­¥éª¤"></a>ç™½å«–ç®€åŒ–æ­¥éª¤</h2><p>è€ƒè™‘åˆ°å¾ˆå¤šäººè´Ÿæ‹…ä¸èµ·å…¬ç½‘æœºçš„ä»·æ ¼ï¼Œè¿™é‡Œæä¾›å‘å¸ƒå…è´¹å…¬ç½‘åŸŸåçš„ç½‘ç«™<br><a href="http://frp.wgpro.com">frpå…è´¹å…¬å…±æœåŠ¡å™¨åˆ—è¡¨</a></p>
<p>ç”±äºåŸŸåä¾›åº”å•†å·²ç»é…ç½®å¥½äº†å…¬ç½‘æœºç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é…ç½®æˆ‘ä»¬éœ€è¦è¿æ¥çš„å†…ç½‘æœºå³å¯</p>
<p>é¦–å…ˆæ‰¾åˆ°å¯ç”¨çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/Snipaste_2020-02-16_15-47-16.jpg" alt></p>
<p>ä¸Šé¢æ˜¾ç¤ºå®ƒæ‰€ç”¨çš„frpç‰ˆæœ¬ä¸º0.14.1ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¿…é¡»å®‰è£…<strong>ç›¸åº”çš„frpç‰ˆæœ¬</strong>åœ¨å†…ç½‘æœºä¸Šï¼Œå¦åˆ™ç”±äºè½¯ä»¶ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¿ä¸ä¸Šã€‚</p>
<p>æŒ‰ç…§ä¹‹å‰çš„æ•™ç¨‹ï¼Œæ ¹æ®æ‰€æä¾›çš„ä¿¡æ¯ï¼Œä¿®æ”¹<strong>frpc.ini</strong>ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/TIM%E5%9B%BE%E7%89%8720200216154853.jpg" alt></p>
<p>è¿™é‡Œæ³¨æ„0.17.0ç‰ˆæœ¬ä¹‹å‰ç”¨çš„æ˜¯<code>privilege_token = xxxx</code>ï¼Œè€Œä¹‹åçš„ç‰ˆæœ¬ç”¨çš„æ˜¯<code>token = xxxx</code>ï¼Œ<strong>è¿œç¨‹ç«¯å£å·å¿…é¡»è®¾ç½®åœ¨æœåŠ¡å•†æ‰€æä¾›çš„èŒƒå›´å†…</strong>ï¼Œå¦‚å›¾ä¸­TCP/UDPç«¯å£ä¸º1000-65535ï¼Œåˆ™å†æ­¤åŒºé—´ä»»å–ç«¯å£å¡«å…¥å°±è¡Œã€‚</p>
<p>è®¾ç½®å®Œï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ç›¸åº”çš„SSHè½¯ä»¶ï¼Œè¿æ¥å†…ç½‘æœºå™¨ï¼Œä¸»æœºåä¸ºå…¬ç½‘åŸŸåï¼Œç«¯å£å·ä¸ºä½ è®¾ç½®çš„è¿œç¨‹ç«¯å£</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/TIM%E5%9B%BE%E7%89%8720200216155354.png" alt></p>
<p>æœ‰çš„æœåŠ¡å•†è¿˜æä¾›äº†äºŒçº§æˆ–ä¸‰çº§åŸŸåï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/frp/Snipaste_2020-02-16_15-58-29.jpg" alt></p>
<p>åˆ™ frpc.ini é…ç½®å¦‚ä¸‹æ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">#server_addrä¸€å®šè¦å†™åŸŸåå½¢å¼ï¼Œä¸è¦ç›´æ¥å†™IPåœ°å€</span><br><span class="line">server_addr = frp1.chuantou.org</span><br><span class="line">server_port = 7000</span><br><span class="line">privilege_token = www.xxorg.com</span><br><span class="line"># æ ‡æ³¨ä½ çš„ä»£ç†åå­—ï¼Œéšä¾¿é€‰æ‹©ä¸€ä¸ªè·Ÿåˆ«äººä¸ä¸€æ ·å³å¯</span><br><span class="line">user = myname</span><br><span class="line"></span><br><span class="line">[xxorg] # å¯ä»¥è‡ªå·±å–</span><br><span class="line">type = http</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 80 # æŒ‰ç…§å›¾ä¸­æ˜¾ç¤ºä¸º80</span><br><span class="line"># è‡ªå·±å–ä¸€ä¸ªå¯ç”¨çš„å­åŸŸåï¼Œä½ çš„è®¿é—®åœ°å€å°†ä¼šæ˜¯http://xxorg.frp1.chuantou.org</span><br><span class="line">subdomain = xxorg</span><br><span class="line"></span><br><span class="line">[tcp3389] # å¯ä»¥è‡ªå·±å–</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 3389 # è‡ªå·±è®¾</span><br><span class="line">remote_port = 53389 #è‡ªå·±è®¾ï¼Œå›¾ä¸­èŒƒå›´ä¸º50000-60000</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®å®Œï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ç›¸åº”çš„SSHè½¯ä»¶ï¼Œè¿æ¥å†…ç½‘æœºå™¨</p>
<p>å¦‚ï¼šä¸»æœºåä¸º<code>http://xxorg.frp1.chuantou.org</code>ï¼Œç«¯å£å·ä¸º53389</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>frp</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntué…ç½®v2rayè¯¦ç»†æ•™ç¨‹</title>
    <url>/2020/02/23/Ubuntu%E9%85%8D%E7%BD%AEv2ray%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ğŸŒŸLinux/Windows/macOS è·¨å¹³å° v2ray GUI ğŸ”¨ ä½¿ç”¨ c++ ç¼–å†™ï¼Œæ”¯æŒè®¢é˜…ï¼Œæ‰«æäºŒç»´ç ï¼Œæ”¯æŒè‡ªå®šä¹‰è·¯ç”±ç¼–è¾‘ ğŸŒŸã€‚ä½¿ç”¨ Qt æ¡†æ¶çš„è·¨å¹³å° v2ray å®¢æˆ·ç«¯ã€‚æ”¯æŒ Windows, Linux, macOSã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul>
<li><p>ä¸‹è½½<code>V2ray</code>å®¢æˆ·ç«¯ï¼Œè¿™é‡Œä»¥æœ€ç®€å•çš„<code>AppImage</code>æ–‡ä»¶ä¸ºä¾‹,ä¸‹è½½é“¾æ¥ï¼š<br><a href="https://github.com/Qv2ray/Qv2ray/releases/download/v1.99.6/Qv2ray-refs.tags.v1.99.6-linux.AppImage">https://github.com/Qv2ray/Qv2ray/releases/download/v1.99.6/Qv2ray-refs.tags.v1.99.6-linux.AppImage</a><br>æˆ–è€…æ‰“å¼€ç½‘ç«™ï¼š<a href="https://github.com/Qv2ray/Qv2ray/releases/tag/v1.99.6">https://github.com/Qv2ray/Qv2ray/releases/tag/v1.99.6</a> é€‰æ‹©ä¸‹å›¾æ–‡ä»¶<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580651760-1.png" alt><br><strong>æ³¨æ„ï¼šå»ºè®®ä¸‹è½½1.99.6åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå…¶å®ƒç‰ˆæœ¬å¯èƒ½å‡ºç°æ‰¾ä¸åˆ°opensslåº“ã€‚</strong></p>
</li>
<li><p>ä¸‹è½½æ ¸å¿ƒæ–‡ä»¶ï¼Œä¸‹è½½é“¾æ¥ï¼š<br><a href="https://github.com/v2ray/v2ray-core/releases/download/v4.22.1/v2ray-linux-64.zip">https://github.com/v2ray/v2ray-core/releases/download/v4.22.1/v2ray-linux-64.zip</a><br>æˆ–è€…æ‰“å¼€ç½‘ç«™ï¼š<a href="https://github.com/v2ray/v2ray-core/releases/">https://github.com/v2ray/v2ray-core/releases/</a> é€‰æ‹©ä¸‹å›¾æ–‡ä»¶<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580651801-2.png" alt></p>
</li>
<li><p>è¿›å…¥v2rayä¸‹è½½çš„æ ¹ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod +x ./Qv2ray-refs.tags.v1.99.6-linux.AppImage</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»ç„¶åœ¨v2rayæ ¹ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./Qv2ray-refs.tags.v1.99.6-linux.AppImage</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2></li>
</ul>
<p>æ‰§è¡Œåä¼šå‡ºç°ä¸»ç•Œé¢ï¼Œç‚¹å‡»é¦–é€‰é¡¹</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580652261-3-1580634671283.png" alt></p>
<p>åœ¨å¸¸è§„è®¾ç½®é‡Œé¢æŒ‰ç…§å›¾ç¤ºæ“ä½œ,æœ€åç‚¹å‡»okä¿å­˜ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580652339-4.png" alt></p>
<p>å›åˆ°ä¸»ç•Œé¢ï¼Œç‚¹å‡»è®¢é˜…ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580652363-5.png" alt></p>
<p>ç„¶åæŒ‰ç…§ä¸‹å›¾è¦æ±‚å¡«å…¥ç›¸åº”å†…å®¹,ç„¶åç‚¹å‡»okï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580655824-6.png" alt></p>
<p>è¿›å…¥ç½‘ç«™-&gt;ä¸ªäººä¸­å¿ƒï¼ŒæŒ‰ç…§ä¸‹å›¾è¯´æ˜å¤åˆ¶é“¾æ¥åˆ°ä¸Šå›¾ä¸­ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580652405-7.png" alt></p>
<p>å°†è½¯ä»¶çš„ä»£ç†æ¨¡å¼æ‰“å¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼›</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580653297-8.png" alt></p>
<p>ä¸€åˆ‡å‡†å¤‡å¥½åç‚¹å‡»ä¸»ç•Œé¢çš„è¿æ¥ï¼Œå¼€å§‹ç§‘å­¦ä¸Šç½‘</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580653343-9.png" alt></p>
<p>å¢™å¤–çš„ä¸–ç•Œåœ¨æ¬¢è¿ä½ !</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/v2ray/1580653648-tzyy_2020-02-02_22-27-02.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿œç¨‹ä½¿ç”¨tensorboardç­‰å¯è§†åŒ–å·¥å…·</title>
    <url>/2020/05/27/%E8%BF%9C%E7%A8%8B%E4%BD%BF%E7%94%A8tensorboard%E7%AD%89%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<p>æœ‰ä¸¤ç§è®¾ç½®æ–¹æ³•ï¼Œä¸€ç§ä»£ç è®¾ç½®ï¼Œä¸€ç§xshellç•Œé¢è®¾ç½®</p>
<h2 id="è¿æ¥SSH"><a href="#è¿æ¥SSH" class="headerlink" title="è¿æ¥SSH"></a>è¿æ¥SSH</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh -L 16006:127.0.0.1:6006 -p 31017 username@remote_server_ip</span><br></pre></td></tr></table></figure>
<p><strong>16006:127.0.0.1:6006</strong> ä»£è¡¨æœ¬æœº6006ç«¯å£æ˜ å°„ä¸º16006å·ç«¯å£ï¼Œè¿™ä¸¤ä¸ªç«¯å£å·å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¸è¦ä¸å…¶ä»–ç«¯å£å·å†²çªå³å¯</p>
<p><strong>-p 31017</strong> ä»£è¡¨æ‰€è¿è¿œç¨‹æœåŠ¡å™¨çš„ç«¯å£å·ï¼Œå³SSHæ‰€ç”¨ç«¯å£å·</p>
<p><strong>username@remote_server_ip</strong> ä»£è¡¨ä½ çš„ç”¨æˆ·åå’ŒSSHæ‰€è¿ipåœ°å€</p>
<p>åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨6006ç«¯å£æ­£å¸¸å¯åŠ¨tensorboardï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tensorboard --logdir=xxx --port=6006</span><br></pre></td></tr></table></figure>
<p><strong>â€”port=6006</strong> ä»£è¡¨å°†ç«¯å£å·æŒ‡å®šä¸º6006</p>
<p>ç”±äºä¸Šä¸€æ­¥æˆ‘ä»¬å°†ç«¯å£å·6006æ˜ å°„åˆ°16006ï¼Œå› æ­¤åœ¨æœ¬åœ°æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1:16006</span><br></pre></td></tr></table></figure>
<p>å³å¯è¿œç¨‹è®¿é—®tensorboard</p>
<h2 id="ä½¿ç”¨Xshell"><a href="#ä½¿ç”¨Xshell" class="headerlink" title="ä½¿ç”¨Xshell"></a>ä½¿ç”¨Xshell</h2><p>åœ¨Windowsç³»ç»Ÿè£…ä¸€ä¸ªXshellï¼Œåœ¨æ–‡ä»¶-&gt;å±æ€§-&gt;ssh-&gt;éš§é“-&gt;æ·»åŠ ï¼Œç±»å‹localï¼Œæºä¸»æœºå¡«127.0.0.1æˆ–è€…localhostï¼ˆæ„æ€æ˜¯æœ¬æœºï¼‰ï¼Œå€¾å¬ç«¯å£ä¸º16006ï¼Œè¡¨ç¤ºæŠŠç›®æ ‡ä¸»æœºçš„ç›®æ ‡ç«¯å£è½¬å‘åˆ°æœ¬åœ°çš„ä¾¦å¬ç«¯å£16006  ï¼ˆå¯è‡ªå·±è®¾ç½®ï¼‰ï¼Œç›®æ ‡ä¸»æœºï¼šæœåŠ¡å™¨ï¼Œå¡«å†™æœåŠ¡å™¨çš„ipï¼Œç›®æ ‡ç«¯å£ä¸€èˆ¬æ˜¯6006ï¼ˆå¯è‡ªå·±è®¾ç½®ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/1.png" alt></p>
<p>åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tensorboard --logdir=xxx --port=6006</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ¬æœºæ‰“å¼€ç½‘é¡µ127.0.0.1:16006 ï¼Œå³å¯æŸ¥çœ‹è¿œç¨‹çš„tensorboard</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntué…ç½®SSHå’ŒXshellè¿æ¥æœåŠ¡å™¨çš„æ•™ç¨‹</title>
    <url>/2020/01/26/Ubuntu%E9%85%8D%E7%BD%AESSH%E5%92%8CXshell%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>SSHåˆ†ä¸ºå®¢æˆ·ç«¯ openssh-client å’ŒæœåŠ¡å™¨ openssh-serverï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤ç¡®è®¤ç”µè„‘<br>ä¸Šæ˜¯å¦å®‰è£…äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚å¦‚æœåªæ˜¯æƒ³è¿œç¨‹ç™»é™†åˆ«çš„æœºå™¨åªéœ€è¦å®‰è£…å®¢æˆ·ç«¯ï¼ˆUbuntué»˜è®¤å®‰è£…äº†å®¢æˆ·ç«¯ï¼‰ï¼Œå¦‚æœè¦æœ¬æœºçš„SSHæœåŠ¡å°±éœ€è¦å®‰è£…æœåŠ¡å™¨ã€‚<br>é¦–å…ˆç¡®è®¤ssh-serveræ˜¯å¦å·²ç»å¯åŠ¨äº†ï¼Œä¸‹é¢æ˜¯å·²ç»å¯åŠ¨è¿‡äº†ã€‚<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg -l | grep ssh</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161410.jpg" alt><br>å®¢æˆ·ç«¯ openssh-client å’ŒæœåŠ¡å™¨ openssh-serverå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-client</span><br><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161511.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161512.jpg" alt><br>æŸ¥çœ‹ç½‘å¡å¯¹åº”çš„æœåŠ¡å™¨IPåœ°å€å’Œç”¨æˆ·å<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ifconfig | grep inet</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161513.jpg" alt><br>è¿œç¨‹ç™»å½•å’Œå¤åˆ¶æ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬è¿›å…¥Xshellè¾“å…¥å‘½ä»¤ã€‚<br>é¦–å…ˆç™»é™†Xshellï¼Œæ–°å»ºä¼šè¯ï¼Œç‚¹å‡»è¿æ¥ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161614.jpg" alt><br>è¾“å…¥ç™»é™†æœåŠ¡å™¨IPï¼ˆåˆšæ‰æŸ¥å¾—çš„ï¼‰ï¼Œç«¯å£22ï¼ˆé»˜è®¤ï¼‰ï¼Œé€‰æ‹©åè®®SSHã€‚ä¹‹åç¡®è®¤å’Œè¿æ¥ï¼Œ<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161615.jpg" alt><br>é¦–æ¬¡ç™»é™†éœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥è¿›å»ä½ Ubuntuçš„ç”¨æˆ·åå’Œå¯†ç ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161617.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161718.jpg" alt><br>æŸ¥çœ‹ä¿¡æ¯æ˜¯å¦è¿æ¥ï¼Œè¿›å…¥æœåŠ¡å™¨ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSH/2019111014161719.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>SSH</tag>
        <tag>Xshell</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuå¿«é€Ÿæ­å»ºC++å¼€å‘ç¯å¢ƒï¼ˆVS Codeç¼–è¾‘å™¨ï¼‰</title>
    <url>/2020/01/19/Ubuntu%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAC++%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%88VS-Code%E7%BC%96%E8%BE%91%E5%99%A8%EF%BC%89/</url>
    <content><![CDATA[<p>ä»¥ä¸‹å®‰è£…çš„æ˜¯g++-8å’ŒVisual Studio Codeï¼Œæ­¤æ–¹æ³•é€‚ç”¨äºUbuntu 14.04 64ä½ã€Ubuntu 16.04 32ä½/64ä½ã€Ubuntu 18.04 (Ubuntu 14.04 32ä½åŠä»¥ä¸‹ç³»ç»Ÿæ— æ•ˆ)ã€‚æ‰“å¼€ç»ˆç«¯å¹¶ä¸”è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚</p>
<h2 id="å®‰è£…g-8"><a href="#å®‰è£…g-8" class="headerlink" title="å®‰è£…g++-8"></a>å®‰è£…g++-8</h2><ul>
<li>å®‰è£…software-properties-commonï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install software-properties-common</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ PPAåˆ°åº“å¹¶æ›´æ–°ï¼ˆä¼šæç¤ºæŒ‰å›è½¦ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶æŒ‰å›è½¦å³å¯ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-toolchain-r/test</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°è½¯ä»¶ä¿¡æ¯ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…g++ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install g++-8</span><br></pre></td></tr></table></figure></li>
<li>å°†g++æŒ‡å‘g++-8ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ln -sf /usr/bin/g++-8 /usr/bin/g++</span><br></pre></td></tr></table></figure></li>
<li>æ˜¾ç¤ºg++ç‰ˆæœ¬å·ï¼Œå¦‚æœæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·æ„å‘³ç€å®‰è£…æˆåŠŸï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">g++ --version</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…Visual-Studio-Code"><a href="#å®‰è£…Visual-Studio-Code" class="headerlink" title="å®‰è£…Visual Studio Code"></a>å®‰è£…Visual Studio Code</h2></li>
<li>å®‰è£…libgconfåº“ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y libgconf-2-4</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…gitï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install git</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ PPAåˆ°åº“å¹¶æ›´æ–°ï¼ˆä¼šæç¤ºæŒ‰å›è½¦ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶æŒ‰å›è½¦å³å¯ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-desktop/ubuntu-make</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°è½¯ä»¶ä¿¡æ¯ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ubuntu-makeï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install ubuntu-make</span><br></pre></td></tr></table></figure></li>
<li>é€šè¿‡ubuntu-makeå®‰è£…Visual Studio Codeï¼›è¿‡ç¨‹ä¸­ä¼šè¯¢é—®å®‰è£…è·¯å¾„ï¼Œæ­¤æ—¶ä¸éœ€è¦ä¿®æ”¹ç›´æ¥æŒ‰å›è½¦å³å¯ï¼›ç„¶åä¼šè¯¢é—®æ˜¯å¦æ¥å—åè®®ï¼Œæ­¤æ—¶è¾“å…¥aç„¶åå›è½¦å³å¯ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo umake ide visual-studio-code</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºè½¯é“¾æ¥åˆ°ç¨‹åºç›®å½•ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ln -sf `env | grep ^HOME= | cut -c 6-`/.local/share/umake/ide/visual-studio-code/bin/code /usr/bin/code</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé¡¹ç›®ç›®å½•ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir ~/Projects</span><br></pre></td></tr></table></figure></li>
<li>æ˜¾ç¤ºVisual Studio Codeç‰ˆæœ¬å·ï¼Œå¦‚æœæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·æ„å‘³ç€å®‰è£…æˆåŠŸï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">code --version</span><br></pre></td></tr></table></figure></li>
<li>è¿è¡ŒVS Codeï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">code</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼š<br>1.æŒ‰ä¸‹é”®ç›˜Ctrl+Shift+X<br>2.åœ¨è¾“å…¥æ¡†é‡Œè¾“å…¥Chinese<br>3.æŒ‰ä¸‹ä¸­æ–‡(ç®€ä½“)åé¢çš„install<br>4.å®‰è£…å®ŒåæŒ‰ä¸‹Ctrl+Shift+Pæ‰“å¼€å‘½ä»¤é¢æ¿<br>5.è¾“å…¥configåé€‰æ‹©é…ç½®è¯­è¨€å‘½ä»¤<br>6.é€‰æ‹©Configure Display Language<br>7.å°†â€localeâ€:â€enâ€æ”¹æˆâ€localeâ€: â€œzh-cnâ€ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜Ctrl+Sä¿å­˜æºæ–‡ä»¶<br>8.å…³é—­VS Code<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-047109e9a0a075af.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-8c9880935d6bcbe8.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-43717f65ac98f10e.png" alt><h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªC-é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªC-é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š"></a>åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼ˆä»¥ä¸‹æ­¥éª¤é™¤éæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š</h2></li>
<li>åˆ›å»ºé¡¹ç›®ç›®å½•cppdemoï¼Œç”¨äºå­¦ä¹ åˆ›å»ºç¬¬ä¸€ä¸ªC++é¡¹ç›®ï¼Œå¹¶è¿›å…¥cppdemoç›®å½•ä¸­ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir ~/Projects/cppdemo &amp;&amp; cd ~/Projects/cppdemo</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé…ç½®ç›®å½•ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir ./.vscode</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat &gt; .vscode/tasks.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;2.0.0&quot;,</span><br><span class="line">    &quot;tasks&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;label&quot;: &quot;build&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;shell&quot;,</span><br><span class="line">            &quot;command&quot;: &quot;g++&quot;,</span><br><span class="line">            &quot;args&quot;: [</span><br><span class="line">                &quot;-std=c++17&quot;,</span><br><span class="line">                &quot;-Wall&quot;,</span><br><span class="line">                &quot;-Wextra&quot;,</span><br><span class="line">                &quot;-g&quot;,</span><br><span class="line">                &quot;-ggdb&quot;,</span><br><span class="line">                &quot;mycpp.cpp&quot;,</span><br><span class="line">                &quot;-o&quot;,</span><br><span class="line">                &quot;demoapp.out&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;group&quot;: &quot;build&quot;,</span><br><span class="line">            &quot;presentation&quot;: &#123;</span><br><span class="line">                &quot;reveal&quot;: &quot;always&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;problemMatcher&quot;: &quot;\$gcc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ è¿è¡Œé…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat &gt; .vscode/launch.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;(gdb) Launch&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;cppdbg&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;program&quot;: &quot;\$&#123;workspaceFolder&#125;/demoapp.out&quot;,</span><br><span class="line">            &quot;args&quot;: [],</span><br><span class="line">            &quot;stopAtEntry&quot;: false,</span><br><span class="line">            &quot;cwd&quot;: &quot;\$&#123;workspaceFolder&#125;&quot;,</span><br><span class="line">            &quot;environment&quot;: [],</span><br><span class="line">            &quot;externalConsole&quot;: true,</span><br><span class="line">            &quot;MIMode&quot;: &quot;gdb&quot;,</span><br><span class="line">            &quot;setupCommands&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;description&quot;: &quot;Enable pretty-printing for gdb&quot;,</span><br><span class="line">                    &quot;text&quot;: &quot;-enable-pretty-printing&quot;,</span><br><span class="line">                    &quot;ignoreFailures&quot;: true</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;preLaunchTask&quot;: &quot;build&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ æ™ºèƒ½æç¤ºé…ç½®æ–‡ä»¶ï¼ˆè¾“å…¥ä»¥ä¸‹å†…å®¹ç„¶åæŒ‰å›è½¦ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if [ `getconf LONG_BIT` -eq &quot;64&quot; ]; then</span><br><span class="line">cat &gt; .vscode/c_cpp_properties.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Linux&quot;,</span><br><span class="line">            &quot;includePath&quot;: [</span><br><span class="line">                &quot;/usr/include/c++/8&quot;,</span><br><span class="line">                &quot;/usr/include/x86_64-linux-gnu/c++/8&quot;,</span><br><span class="line">                &quot;/usr/include/c++/8/backward&quot;,</span><br><span class="line">                &quot;/usr/lib/gcc/x86_64-linux-gnu/8/include&quot;,</span><br><span class="line">                &quot;/usr/local/include&quot;,</span><br><span class="line">                &quot;/usr/lib/gcc/x86_64-linux-gnu/8/include-fixed&quot;,</span><br><span class="line">                &quot;/usr/include/x86_64-linux-gnu&quot;,</span><br><span class="line">                &quot;/usr/include&quot;,</span><br><span class="line">                &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;defines&quot;: [],</span><br><span class="line">            &quot;intelliSenseMode&quot;: &quot;clang-x64&quot;,</span><br><span class="line">            &quot;browse&quot;: &#123;</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;/usr/include/c++/8&quot;,</span><br><span class="line">                    &quot;/usr/include/x86_64-linux-gnu/c++/8&quot;,</span><br><span class="line">                    &quot;/usr/include/c++/8/backward&quot;,</span><br><span class="line">                    &quot;/usr/lib/gcc/x86_64-linux-gnu/8/include&quot;,</span><br><span class="line">                    &quot;/usr/local/include&quot;,</span><br><span class="line">                    &quot;/usr/lib/gcc/x86_64-linux-gnu/8/include-fixed&quot;,</span><br><span class="line">                    &quot;/usr/include/x86_64-linux-gnu&quot;,</span><br><span class="line">                    &quot;/usr/include&quot;,</span><br><span class="line">                    &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;limitSymbolsToIncludedHeaders&quot;: true,</span><br><span class="line">                &quot;databaseFilename&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 3</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">else</span><br><span class="line">cat &gt; .vscode/c_cpp_properties.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Linux&quot;,</span><br><span class="line">            &quot;includePath&quot;: [</span><br><span class="line">                &quot;/usr/include/c++/8&quot;,</span><br><span class="line">                &quot;/usr/include/i386-linux-gnu/c++/8&quot;,</span><br><span class="line">                &quot;/usr/include/c++/8/backward&quot;,</span><br><span class="line">                &quot;/usr/lib/gcc/i686-linux-gnu/8/include&quot;,</span><br><span class="line">                &quot;/usr/local/include&quot;,</span><br><span class="line">                &quot;/usr/lib/gcc/i686-linux-gnu/8/include-fixed&quot;,</span><br><span class="line">                &quot;/usr/include/i386-linux-gnu&quot;,</span><br><span class="line">                &quot;/usr/include&quot;,</span><br><span class="line">                &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;defines&quot;: [],</span><br><span class="line">            &quot;intelliSenseMode&quot;: &quot;clang-x64&quot;,</span><br><span class="line">            &quot;browse&quot;: &#123;</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;/usr/include/c++/8&quot;,</span><br><span class="line">                    &quot;/usr/include/i386-linux-gnu/c++/8&quot;,</span><br><span class="line">                    &quot;/usr/include/c++/8/backward&quot;,</span><br><span class="line">                    &quot;/usr/lib/gcc/i686-linux-gnu/8/include&quot;,</span><br><span class="line">                    &quot;/usr/local/include&quot;,</span><br><span class="line">                    &quot;/usr/lib/gcc/i686-linux-gnu/8/include-fixed&quot;,</span><br><span class="line">                    &quot;/usr/include/i386-linux-gnu&quot;,</span><br><span class="line">                    &quot;/usr/include&quot;,</span><br><span class="line">                    &quot;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;limitSymbolsToIncludedHeaders&quot;: true,</span><br><span class="line">                &quot;databaseFilename&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 3</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºC++æºæ–‡ä»¶mycpp.cppï¼ˆä»£ç å°±æ˜¯å†™åœ¨è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch mycpp.cpp</span><br></pre></td></tr></table></figure></li>
<li>ç”¨Visual Studio Codeæ‰“å¼€å½“å‰å·¥ä½œç¯å¢ƒï¼ˆä¸è¦å¿½ç•¥æœ€åçš„ç‚¹å“Ÿï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">code .</span><br></pre></td></tr></table></figure></li>
<li>åŒå‡»mycpp.cppæ‰“å¼€æ–‡ä»¶ï¼Œç¬¬ä¸€æ¬¡ä¼šæç¤ºå®‰è£…C++æ’ä»¶ï¼Œç‚¹å‡»å®‰è£…ï¼Œç„¶åç­‰å¾…å³ä¸‹è§’æ¶ˆæ¯å®‰è£…å®Œæˆï¼ˆåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸éœ€è¦å†æ‰§è¡Œï¼‰ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-84d0b75234245983.png" alt></li>
<li>åŒå‡»æ‰“å¼€mycpp.cppï¼Œç„¶åè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;å°å¤é“¶çš„C++æ•™ç¨‹&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-5c0e4151fa446bb1.png" alt></li>
<li>æŒ‰ä¸‹Ctrl+Shift+Bï¼Œç„¶åé€‰æ‹©buildï¼Œå°±ä¼šå¼€å§‹ç¼–è¯‘ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-9086cfb5ebae16ca.png" alt></li>
<li>ç¼–è¯‘å®Œåï¼Œåœ¨ç»ˆç«¯çª—å£æŒ‰å›è½¦é”®å…³é—­ç»ˆç«¯ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-422767a1784b76a6.png" alt></li>
<li>ç‚¹å‡»èœå•æ ä¸­çš„ç»ˆç«¯ï¼Œç„¶åç‚¹å‡»æ–°å»ºç»ˆç«¯ï¼Œå°±ä¼šæ‰“å¼€ç»ˆç«¯çª—å£ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-86304c028d93ecc7.png" alt></li>
<li>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œå°±ä¼šè¿è¡Œç¨‹åºï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./demoapp.out</span><br></pre></td></tr></table></figure></li>
<li>è¿è¡Œç¨‹åºå°†ä¼šæ˜¾ç¤ºå°å¤é“¶çš„C++æ•™ç¨‹ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VScode/11655830-4ecc19bb3b0c9794.png" alt><br>æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç¨‹åºå°±å®Œæˆäº†ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>C++</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuç¾åŒ–</title>
    <url>/2020/01/19/Ubuntu%E7%BE%8E%E5%8C%96/</url>
    <content><![CDATA[<ul>
<li>å®‰è£…Unity-tweak-tool<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install unity-tweak-tool</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ubuntu_modify/20180909004455285.png" alt></li>
<li>æ›´æ–°æº<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab/themes</span><br><span class="line">sudo apt-add-repository ppa:numix/ppa </span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…ä¸»é¢˜<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab/themes  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install flatabulous-theme </span><br><span class="line">sudo apt-get install arc-theme</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…å›¾æ ‡<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab/icons  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install ultra-flat-icons </span><br><span class="line">sudo apt-get install numix-icon-theme-circle</span><br></pre></td></tr></table></figure></li>
<li>é€‰æ‹©ä¸»é¢˜<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ubuntu_modify/20180909005108750.png" alt></li>
<li>é€‰æ‹©å›¾æ ‡<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ubuntu_modify/20180909005211146.png" alt></li>
<li>æœ€ç»ˆæ•ˆæœ<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ubuntu_modify/20180909005447430.jpg" alt></li>
</ul>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Latexä¸­å…¬å¼è¿‡é•¿é—®é¢˜</title>
    <url>/2020/07/18/Latex%E4%B8%AD%E5%85%AC%E5%BC%8F%E8%BF%87%E9%95%BF%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>latexä¸­å…¬å¼è¿‡é•¿é€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>(1) ä½¿ç”¨amsmath packageçš„splitç¯å¢ƒï¼Œå°†é•¿å…¬å¼åœ¨<code>\\</code>å¤„æ–­å¼€</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\begin&#123;split&#125;</span><br><span class="line">F = \&#123;F_&#123;x&#125; \in  F_&#123;c&#125; &amp;: (|S| &gt; |C|) \\</span><br><span class="line">&amp;\quad \cap (\text&#123;minPixels&#125; &lt; |S| &lt; \text&#123;maxPixels&#125;) \\</span><br><span class="line">&amp;\quad \cap (|S_&#123;\text&#123;conected&#125;&#125;| &gt; |S| - \epsilon) \&#125;</span><br><span class="line">\end&#123;split&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br></pre></td></tr></table></figure>
<p><strong>(2) åˆ©ç”¨\!å‘½ä»¤ï¼Œå¦‚åŠ åœ¨=å·ã€+å·ä¸¤ä¾§è¿›è¡Œå¾®è°ƒ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;eqnarray&#125;</span><br><span class="line">\dot&#123;x&#125;(t)\ï¼=\ï¼\bar&#123;A&#125;_&#123;i&#125;x(t)+\bar&#123;B&#125;_&#123;i_&#123;1&#125;&#125;x(t)+\bar&#123;B&#125;_&#123;i_&#123;2&#125;&#125;x(t)+\bar&#123;B&#125;_&#123;i_&#123;3&#125;&#125;[a_&#123;i&#125;(t)\ï¼+\ï¼b_&#123;i&#125;(t)].</span><br><span class="line">\end&#123;eqnarray&#125;</span><br></pre></td></tr></table></figure>
<p><strong>(3) ç¼©å°å…¬å¼</strong></p>
<ul>
<li>[ç¼–å·ä¸ç¼©å°]<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\resizebox&#123;.9\hsize&#125;&#123;!&#125;&#123;$A+B+C+D+E+F+G+H+I+J+K+L+M+N+O+P+Q+R+S+T+U+V+W+X+Y+Z$&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br></pre></td></tr></table></figure></li>
<li>[ç¼–å·åŒæ­¥ç¼©å°]<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;small&#125;</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\ldots</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">\end&#123;small&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>[è¡¥å……] LATEX ä¸­å…·ä½“çš„é—´éš”å¤§å°ä¸ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\quad           1em,emä»£è¡¨ä¸€ä¸ªå­—ç¬¦å®½åº¦</span><br><span class="line">\qquad          2em</span><br><span class="line">\,              3/18em</span><br><span class="line">\:              4/18em</span><br><span class="line">\;              5/18em</span><br><span class="line">\!             -3/18emï¼ˆä¸ä»…ä¸ä¼šå¢åŠ ç©ºæ ¼ï¼Œè¿˜ä¼šæŠŠé—´è·ç»™å‡å°1/6ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªæœ‰æ—¶å¯ä»¥ç”¨åˆ°ï¼Œæ¯”å¦‚è¾“å…¥æ¨¡çš„æ—¶å€™||x||ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæŠŠä¸¤ä¸ª|çš„é—´è·ç¼©å°ç‚¹ï¼Œè¿™æ ·æ›´åŠ ç¾è§‚ï¼‰</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Latex</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³Pycharmå¤§é‡å ç”¨Cç›˜é—®é¢˜</title>
    <url>/2020/05/05/%E8%A7%A3%E5%86%B3Pycharm%E5%A4%A7%E9%87%8F%E5%8D%A0%E7%94%A8C%E7%9B%98%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ä½¿ç”¨ PyCharm æ—¶ä¼šåœ¨ C:\Users\<username>.PyCharm&lt;ç‰ˆæœ¬å·&gt; ä¸‹åˆ›å»ºä¸€å¤§å †æ–‡ä»¶ï¼Œé‡Œè¾¹åŒ…æ‹¬äº†é…ç½®ä¿¡æ¯ï¼Œé¡¹ç›®ç¼“å­˜ä¿¡æ¯ç­‰ã€‚éšç€pycharmçš„ä½¿ç”¨ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹è¶Šæ¥è¶Šå¤§ï¼Œå ç”¨ç€ç³»ç»Ÿå†…å­˜ï¼Œå¥½ä¸éœ¸é“ï¼è¦ä¸ºäº†è§£å†³Pycharmå¤§é‡å ç”¨Cç›˜é—®é¢˜ï¼Œéœ€è¦æŠŠä¸€äº›é…ç½®ä¿¡æ¯æ¬è¿åˆ°æŒ‡å®šä½ç½®ã€‚</username></p>
<h2 id="é€šè¿‡-PyCharm-ä¿®æ”¹"><a href="#é€šè¿‡-PyCharm-ä¿®æ”¹" class="headerlink" title="é€šè¿‡ PyCharm ä¿®æ”¹"></a>é€šè¿‡ PyCharm ä¿®æ”¹</h2><p>åœ¨å¯åŠ¨ PyCharm åé€‰æ‹© Help -&gt; Edit Custom Properties çš„é€‰é¡¹ï¼Œå¼¹å‡ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/1.png" alt></p>
<p>é€‰æ‹© Create ï¼Œä¹‹ååœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå³ä½ éœ€è¦è¿ç§»åˆ°çš„è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">idea.config.path=D:/Program Files/.PyCharm&lt;ç‰ˆæœ¬å·&gt;/config</span><br><span class="line">idea.system.path=D:/Program Files/.PyCharm&lt;ç‰ˆæœ¬å·&gt;/system</span><br><span class="line">idea.plugins.path=D:/Program Files/.PyCharm&lt;ç‰ˆæœ¬å·&gt;/config/plugins</span><br></pre></td></tr></table></figure>
<p>ä¿å­˜å¹¶å…³é—­ PyCharm ä¹‹åï¼Œå°†åŸæ–‡ä»¶å¤¹ä¸‹çš„ C:\Users\<username>.PyCharm&lt;ç‰ˆæœ¬å·&gt; å¤åˆ¶åˆ°ç›®æ ‡æ¬è¿æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åå°†åŸæ–‡ä»¶å¤¹ä¸‹çš„ C:\Users\<username>.PyCharm&lt;ç‰ˆæœ¬å·&gt;åªä¿ç•™ config ç›®å½•ä¸‹çš„ä¸€ä¸ª idea.properties æ–‡ä»¶ï¼Œå…¶ä½™æ–‡ä»¶åˆ é™¤å³å¯ã€‚</username></username></p>
<h2 id="ä¿®æ”¹ç¨‹åºé…ç½®"><a href="#ä¿®æ”¹ç¨‹åºé…ç½®" class="headerlink" title="ä¿®æ”¹ç¨‹åºé…ç½®"></a>ä¿®æ”¹ç¨‹åºé…ç½®</h2><p>æ‰“å¼€ Pycharm å®‰è£…ç›®å½•ï¼ˆbinï¼‰ï¼Œæ‰¾åˆ° idea.properties æ–‡ä»¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/2.png" alt></p>
<p>ç„¶åï¼Œæ‰“å¼€ä½¿ç”¨txtæ–‡æœ¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶ç›¸åº”çš„å†™å‡ºçº¢çº¿æ ‡å‡ºçš„éƒ¨åˆ†</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/3.png" alt></p>
<p>æœ€åï¼Œæ‰“å¼€pycharmå°±å¯ä»¥äº†ã€‚è¿™æ—¶ä¸ä¼šå†åœ¨Cç›˜åˆ›å»º.pycharm2019.3ç›®å½•äº†ã€‚é—®é¢˜è§£å†³</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>åç¡•è·¯ç”±å™¨åˆ·å›ºä»¶</title>
    <url>/2020/02/03/%E5%8D%8E%E7%A1%95%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%9B%BA%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ç°åœ¨å¸‚é¢ä¸Šçš„è·¯ç”±å™¨åŸºæœ¬ä¸Šä½¿ç”¨çš„éƒ½æ˜¯å®˜æ–¹çš„å›ºä»¶ï¼Œè¿™æ˜¯å› ä¸ºè·¯ç”±å™¨çš„è®¾å¤‡å‚å•†æ˜¯ä¸ºäº†è®¾å¤‡çš„ç¨³å®šæ€§ç€æƒ³è€Œå‡ºå‘çš„ï¼Œè¿˜æœ‰å°±æ˜¯æ‰€è°“çš„åˆ·æ¢…æ—å›ºä»¶ä¹Ÿå°±æ˜¯åˆ·ç¬¬ä¸‰æ–¹çš„å›ºä»¶ï¼Œæœ€å¤§çš„ä½œç”¨å¯ä»¥è§£å°ä¸€äº›åŠŸèƒ½ã€‚å¯¹äºæ¢…æ—å›ºä»¶æ¥è¯´ï¼Œè¿™æœ‰ä¸€åŠçš„æ€§è´¨æ˜¯å±äºå®˜æ–¹çš„è·¯ç”±å™¨å›ºä»¶ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€åŠæ˜¯å¯ä»¥ç”¨æˆ·è‡ªå·±æ¥è¿›è¡Œè®¾ç½®çš„ï¼Œå…¶å®æ¢…æ—å›ºä»¶å°±æ˜¯ä¸€ä¸ªåç¡•è·¯ç”±å™¨çš„è‡ªå®šä¹‰å›ºä»¶ï¼Œæ˜¯åç¡•å®˜æ–¹çš„é—­æºé©±åŠ¨ï¼Œå› æ­¤ç¨³å®šæ€§è¦å¥½å¾ˆå¤šï¼Œä¸æ”¯æŒè¶…é¢‘ï¼Œå¾ˆå°‘å‡ºç°æ­»æœºã€å¡é¡¿çš„æƒ…å†µã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/185417q0zxbdexeze1x1nb.jpg" alt></p>
<p>å…¶æœ€å…·ç‰¹è‰²çš„ä¾¿æ˜¯å¤šäº†è½¯ä»¶ä¸­å¿ƒï¼Œåœ¨é‡Œé¢å®‰è£…å„ç§å„æ ·çš„æ’ä»¶å¯ä»¥å®ç°å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚ç¿»å¢™ï¼Œå»å¹¿å‘Šï¼Œç¦»çº¿ä¸‹è½½ï¼ŒåŒæ‹¨ç­‰ã€‚</p>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½èƒ½åˆ·æ¢…æ—å›ºä»¶ï¼Œéåç¡•çš„è·¯ç”±å™¨éœ€è¦ä¸åç¡•æŸä¸ªç‰ˆæœ¬çš„ç¡¬ä»¶ä¸€è‡´æ‰èƒ½åˆ·ï¼Œä»¥ç½‘ä»¶å’Œåç¡•è‡ªèº«çš„è·¯ç”±å™¨å±…å¤šã€‚</p>
<p>æˆ‘æ‰‹å¤´çš„è·¯ç”±å™¨ä¸ºåç¡•AC86Uï¼Œåç¡•åˆ·æ¢…æ—å›ºä»¶ç›¸å¯¹ç®€å•ï¼Œé£é™©ä½ï¼Œè‹¥å…¶ä»–å“ç‰Œçš„è·¯ç”±å™¨è¯·å»æŸ¥æ‰¾ç›¸åº”æ•™ç¨‹ï¼Œæ­¤æ•™ç¨‹åªé€‚ç”¨äºåç¡•å“ç‰Œã€‚</p>
<h2 id="å›ºä»¶ä¸‹è½½"><a href="#å›ºä»¶ä¸‹è½½" class="headerlink" title="å›ºä»¶ä¸‹è½½"></a>å›ºä»¶ä¸‹è½½</h2><p><a href="https://www.koolcenter.com/">KoolCenter</a>æ˜¯è·¯ç”±å™¨åˆ·æœºçš„è®ºå›ï¼Œå¯ä»¥å»é‡Œé¢ä¸‹è½½å›ºä»¶ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/Snipaste_2020-02-03_16-18-35.jpg" alt></p>
<p>å¸¸ç”¨åˆ°çš„ä¸ºçº¢è‰²æ¡†å‡ºæ¥çš„è¿™å››ä¸ªï¼Œåˆ†åˆ«æ˜¯åç¡•å®˜æ”¹å›ºä»¶ã€æ¢…æ—åŸç‰ˆå›ºä»¶ã€æ¢…æ—æ”¹ç‰ˆå›ºä»¶ã€ç½‘ä»¶å®˜æ”¹å›ºä»¶ã€‚</p>
<ul>
<li><p>åŸå‚å›ºä»¶ä¸ºåç¡•å®˜æ–¹çš„å›ºä»¶ã€‚</p>
</li>
<li><p>åŸç‰ˆæ¢…æ—ä¸ºå›½å¤–RMerlå¤§ç¥åŸºäºåç¡•å®˜æ–¹å›ºä»¶æºä»£ç ä¿®æ”¹è€Œæ¥çš„æ¢…æ—å›ºä»¶ã€‚</p>
</li>
<li><p>æ”¹ç‰ˆæ¢…æ—ä¸ºkoolshareå¼€å‘ç»„åŸºäºæ¢…æ—å›ºä»¶ä¿®æ”¹è€Œæ¥çš„å¸¦è½¯ä»¶ä¸­å¿ƒçš„æ¢…æ—æ”¹ç‰ˆå›ºä»¶ã€‚</p>
</li>
<li><p>å®˜æ”¹å›ºä»¶ä¸ºkoolshareå¼€å‘ç»„åŸºäºåç¡•å®˜æ–¹æºä»£ç ä¿®æ”¹è€Œæ¥çš„å¸¦è½¯ä»¶ä¸­å¿ƒçš„å®˜æ”¹å›ºä»¶ã€‚</p>
</li>
</ul>
<p>è¿™ä¹‹ä¸­å¸¸ç”¨çš„ä¸ºæ¢…æ—æ”¹å’Œå®˜æ”¹ï¼Œç›¸æ¯”å®˜æ”¹å›ºä»¶ï¼Œæ¢…æ—æ”¹ç‰ˆå›ºä»¶æœ‰æ›´å¤šçš„åŠŸèƒ½å’Œbugä¿®å¤ï¼Œè€Œå®˜æ”¹å›ºä»¶æ›´æ–°è¾ƒå¿«ã€‚å¥½ç”¨ç¨‹åº¦å·®åˆ«ä¸å¤§ï¼Œç¨³å®šæ€§æ¥è¯´ä¹ŸåŸºæœ¬æ— å·®ï¼Œé€‰å“ªä¸ªå›ºä»¶åŸºäºä¸ªäººå–œå¥½å³å¯ã€‚</p>
<p>æˆ‘ç”¨çš„æ˜¯æ¢…æ—æ”¹å›ºä»¶ï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œå¯ä»¥çœ‹åˆ°å¯ç”¨æœºå‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/Snipaste_2020-02-03_16-32-11.jpg" alt></p>
<p>é€‰æ‹©å¯¹åº”æœºå‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/Snipaste_2020-02-03_16-32-28.jpg" alt></p>
<p>é€‰æ‹©æœ€æ–°ç‰ˆæœ¬å›ºä»¶ä¸‹è½½ï¼Œå›ºä»¶ä¸º.wåç¼€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/Snipaste_2020-02-03_16-32-47.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/Snipaste_2020-02-03_16-32-57.jpg" alt></p>
<h2 id="å›ºä»¶å®‰è£…"><a href="#å›ºä»¶å®‰è£…" class="headerlink" title="å›ºä»¶å®‰è£…"></a>å›ºä»¶å®‰è£…</h2><ul>
<li>é€‰æ‹©ã€ç³»ç»Ÿç®¡ç†ã€‘-ã€å›ºä»¶å‡çº§ã€‘ï¼Œé€‰æ‹©ä¸‹å¥½çš„ .w åç¼€çš„å›ºä»¶ï¼Œä¸Šä¼ å³å¯</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/k3.png" alt></p>
<ul>
<li>åˆ·æœºå®Œæˆåä¼šè‡ªåŠ¨é‡å¯ï¼Œè¯·è€å¿ƒç­‰å¾…å®Œæˆ</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/merlin/k4.png" alt></p>
<ul>
<li><p>åˆ·æœºå®Œæˆååœ¨ã€ç³»ç»Ÿç®¡ç†ã€‘â€“ã€æ¢å¤/å¯¼å‡º/ä¸Šä¼ è®¾ç½®ã€‘æ¢å¤å‡ºå‚è®¾ç½®</p>
</li>
<li><p>åœ¨ã€ç³»ç»Ÿç®¡ç†ã€‘â€“ã€ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼šFormat JFFS partition at next boot å’Œ Enable JFFS custom scripts and configs ç„¶åç‚¹å‡»åº”ç”¨æœ¬é¡µé¢è®¾ç½®ï¼ŒæˆåŠŸåé‡å¯è·¯ç”±å™¨ï¼›</p>
</li>
</ul>
<p>ï¼ˆæ³¨ï¼šåŒæ¸…å°±æ˜¯æŒ‡æ¢å¤å‡ºå‚è®¾ç½® + æ ¼å¼åŒ–jffsåˆ†åŒºï¼‰</p>
<p>é‡å¯åå…ˆå°†è·¯ç”±å™¨è¿ä¸Šç½‘ç»œï¼Œç„¶åè¿›å…¥è½¯ä»¶ä¸­å¿ƒå°†è½¯ä»¶ä¸­å¿ƒæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p>
<h2 id="è½¯ä»¶ä¸­å¿ƒ"><a href="#è½¯ä»¶ä¸­å¿ƒ" class="headerlink" title="è½¯ä»¶ä¸­å¿ƒ"></a>è½¯ä»¶ä¸­å¿ƒ</h2><p>å®Œæˆä¸Šè¿°å·¥ä½œï¼Œæ¢…æ—å›ºä»¶å°±è£…å¥½äº†ï¼Œç°åœ¨ä½ å¯ä»¥è¿›å…¥è½¯ä»¶ä¸­å¿ƒæœªå®‰è£…ï¼Œé€‰æ‹©åˆé€‚çš„æ’ä»¶å®‰è£…äº†ï¼Œæ’ä»¶å°±ä¸ä¸€ä¸€ä»‹ç»ï¼Œå…·ä½“å¯ä»¥ç™¾åº¦ï¼Œæˆ‘å¸¸ç”¨çš„æ˜¯è™šæ‹Ÿå†…å­˜å’Œshadowsocksã€‚</p>
<p>æ–°ç‰ˆè½¯ä»¶ä¸­å¿ƒå†…ä¸æä¾›shadowsocksæ’ä»¶ï¼Œæˆ‘è¿™é‡Œé€šè¿‡<a href="https://quqi.gblhgk.com/s/2796382/045bYgimCEJLRiCe">äº‘ç›˜</a>åˆ†äº«ï¼Œå¤§å®¶å¯ä»¥åœ¨ã€è½¯ä»¶ä¸­å¿ƒã€‘-ã€ç¦»çº¿å®‰è£…ã€‘æ‰‹åŠ¨å®‰è£…æ’ä»¶ã€‚</p>
<h2 id="åç»­æ›´æ–°"><a href="#åç»­æ›´æ–°" class="headerlink" title="åç»­æ›´æ–°"></a>åç»­æ›´æ–°</h2><p>æŒ‰æ­¤æ•™ç¨‹åšçš„ï¼Œåç»­æ›´æ–°æ–°ç‰ˆçš„æ¢…æ—æ”¹æ—¶ï¼ŒæŒ‰Bæ¥å³å¯ã€‚</p>
<h5 id="A-åŸå‚å›ºä»¶-åŸç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#A-åŸå‚å›ºä»¶-åŸç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="A. åŸå‚å›ºä»¶/åŸç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>A. åŸå‚å›ºä»¶/åŸç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ol>
<li>åœ¨<code>åŸäº§å›ºä»¶</code>/<code>åŸç‰ˆæ¢…æ—</code>å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶æ–‡ä»¶ï¼›</li>
<li>åˆ·æœºå®Œæˆåä¼šè‡ªåŠ¨é‡å¯ï¼Œæ­¤æ—¶åˆ·æœºå®Œæˆï¼ˆåˆ·æœºå®Œæˆåå¯ä»¥ä¸æ¢å¤å‡ºäº§è®¾ç½®ï¼Œå½“ç„¶æ¢å¤ä¸€æ¬¡æ›´å¥½ï¼‰ï¼›</li>
<li>åˆ·æœºå®Œæˆåœ¨ã€ç³»ç»Ÿç®¡ç† ã€‘â€“ã€ ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼š<code>Format JFFS partition at next boot</code> å’Œ <code>Enable JFFS custom scripts and configs</code> ç„¶åç‚¹å‡»<code>åº”ç”¨æœ¬é¡µé¢è®¾ç½®</code>ï¼ŒæˆåŠŸåé‡å¯è·¯ç”±å™¨ï¼›</li>
<li>é‡å¯åå…ˆå°†è·¯ç”±å™¨è¿ä¸Šç½‘ç»œï¼Œç„¶åè¿›å…¥è½¯ä»¶ä¸­å¿ƒå°†è½¯ä»¶ä¸­å¿ƒæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</li>
</ol>
<h5 id="B-æ”¹ç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#B-æ”¹ç‰ˆæ¢…æ—-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="B. æ”¹ç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>B. æ”¹ç‰ˆæ¢…æ— åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ol>
<li>åˆ·è¿‡<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶çš„ï¼Œåœ¨å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>æ”¹ç‰ˆæ¢…æ—</code>æ–‡ä»¶ï¼ˆå¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œä¸éœ€è¦æ¢å¤å‡ºäº§è®¾ç½®ï¼‰ï¼›</li>
<li>åˆ·æœºåæ‰€æœ‰å·²ç»å®‰è£…çš„æ’ä»¶éƒ½ä¼šè¢«ä¿ç•™ï¼Œä¸ä¼šå—åˆ°å½±å“ã€‚</li>
</ol>
<h5 id="C-æ”¹ç‰ˆæ¢…æ—-åˆ·-å®˜æ”¹å›ºä»¶ï¼š"><a href="#C-æ”¹ç‰ˆæ¢…æ—-åˆ·-å®˜æ”¹å›ºä»¶ï¼š" class="headerlink" title="C. æ”¹ç‰ˆæ¢…æ— åˆ· å®˜æ”¹å›ºä»¶ï¼š"></a>C. æ”¹ç‰ˆæ¢…æ— åˆ· å®˜æ”¹å›ºä»¶ï¼š</h5><ul>
<li>è¯¦è§ï¼š<a href="https://www.koolcenter.com/posts/5">https://www.koolcenter.com/posts/5</a></li>
</ul>
<h5 id="D-å®˜æ”¹å›ºä»¶-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š"><a href="#D-å®˜æ”¹å›ºä»¶-åˆ·-æ”¹ç‰ˆæ¢…æ—ï¼š" class="headerlink" title="D. å®˜æ”¹å›ºä»¶ åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š"></a>D. å®˜æ”¹å›ºä»¶ åˆ· æ”¹ç‰ˆæ¢…æ—ï¼š</h5><ul>
<li>è¯¦è§ï¼š<a href="https://www.koolcenter.com/posts/5">https://www.koolcenter.com/posts/5</a></li>
</ul>
<h5 id="E-æ”¹ç‰ˆæ¢…æ—-åˆ·-åŸå‚å›ºä»¶-æ¢…æ—åŸç‰ˆï¼š"><a href="#E-æ”¹ç‰ˆæ¢…æ—-åˆ·-åŸå‚å›ºä»¶-æ¢…æ—åŸç‰ˆï¼š" class="headerlink" title="E. æ”¹ç‰ˆæ¢…æ— åˆ· åŸå‚å›ºä»¶/æ¢…æ—åŸç‰ˆï¼š"></a>E. æ”¹ç‰ˆæ¢…æ— åˆ· åŸå‚å›ºä»¶/æ¢…æ—åŸç‰ˆï¼š</h5><ol>
<li>åœ¨<code>æ”¹ç‰ˆæ¢…æ—</code>å›ºä»¶å‡çº§é¡µé¢ä¸‹ç›´æ¥ä¸Šä¼ .w åç¼€çš„<code>åŸäº§å›ºä»¶</code>/<code>æ¢…æ—åŸç‰ˆ</code>å›ºä»¶æ–‡ä»¶ï¼Œåˆ·æœºå®Œæˆåæœºå™¨ä¼šè‡ªåŠ¨é‡å¯ï¼ˆåˆ·æœºåå¯ä»¥ä¸æ¢å¤å‡ºäº§è®¾ç½®ï¼Œå½“ç„¶æ¢å¤ä¸€æ¬¡æ›´å¥½ï¼‰ï¼›</li>
<li>åˆ·æœºå®Œæˆåœ¨ã€ç³»ç»Ÿç®¡ç† ã€‘â€“ã€ ç³»ç»Ÿè®¾ç½®ã€‘å†…å‹¾é€‰ï¼š<code>Format JFFS partition at next boot</code> å’Œ <code>Enable JFFS custom scripts and configs</code> ç„¶åç‚¹å‡»<code>åº”ç”¨æœ¬é¡µé¢è®¾ç½®</code>ï¼ŒæˆåŠŸåº”ç”¨åé‡å¯è·¯ç”±å™¨å³å¯ï¼Œæ­¤æ“ä½œå¯ä»¥æ¸…é™¤å®‰è£…åœ¨jffsåˆ†åŒºçš„è½¯ä»¶ä¸­å¿ƒå’Œæ‰€æœ‰æ’ä»¶ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>è·¯ç”±å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu clashé…ç½®</title>
    <url>/2020/02/05/Ubuntu-clash%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="1-ä¸‹è½½å®‰è£…åŒ…"><a href="#1-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="1. ä¸‹è½½å®‰è£…åŒ…"></a>1. ä¸‹è½½å®‰è£…åŒ…</h2><p>æ‰§è¡Œ <code>cd &amp;&amp; mkdir clash</code>åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º clash æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾è§£å‹åçš„æ–‡ä»¶åŠé…ç½®æ–‡ä»¶,å°†ä¸‹è½½çš„å‹ç¼©æ–‡ä»¶è§£å‹è‡³æ­¤ï¼Œå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶â€œ clash-linux-amd64 â€ã€‚</p>
<p>ä¸€èˆ¬ä¸ªäººçš„64ä½ç”µè„‘ä¸‹è½½ clash-linux-amd64.tar.gz å³å¯ã€‚</p>
<p><a href="https://github.com/Dreamacro/clash/releases">ä¸‹è½½å®¢æˆ·ç«¯</a><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/windows-cfw-1.png" alt></p>
<h2 id="2-åˆå§‹åŒ–é…ç½®"><a href="#2-åˆå§‹åŒ–é…ç½®" class="headerlink" title="2. åˆå§‹åŒ–é…ç½®"></a>2. åˆå§‹åŒ–é…ç½®</h2><p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè¯¥æ–‡ä»¶<code>sudo ./clash-linux-amd64</code>ï¼Œæç¤ºç¼ºå°‘config.ymlé…ç½®æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆ/home/å½“å‰ç”¨æˆ·ID/.config/clashæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ config.yml å’Œ Country.mmdb ï¼Œè‹¥çœ‹ä¸åˆ°è¿™æ–‡ä»¶å¤¹ï¼Œåˆ™æŒ‰<code>ctrl+H</code>æ˜¾ç¤ºéšè—æ–‡ä»¶ã€‚å…¶ä¸­ Country.mmdbç”±äºå¢™çš„åŸå› ä¸‹è½½è¾ƒæ…¢ï¼Œè¿™é‡Œæä¾›<a href="https://quqi.gblhgk.com/s/2796382/PtRJqrmJaeM9Nh17">ç½‘ç›˜ä¸‹è½½</a>ï¼Œç›´æ¥æ‹·è´è¿›/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸­ã€‚<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo cp Country.mmdbçš„è·¯å¾„ ~/home/å½“å‰ç”¨æˆ·ID/.config/clash</span><br></pre></td></tr></table></figure></p>
<h2 id="3-ç¼–è¾‘é…ç½®"><a href="#3-ç¼–è¾‘é…ç½®" class="headerlink" title="3. ç¼–è¾‘é…ç½®"></a>3. ç¼–è¾‘é…ç½®</h2><p>ç¼–è¾‘/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸‹çš„ config.ymlé…ç½®æ–‡ä»¶ï¼Œå†…å®¹ä¸ºè‡ªå·±çš„æœåŠ¡å™¨åŠè§„åˆ™ç­‰ä¿¡æ¯(æœ‰äº›å•†å®¶ä¼šæä¾›ç›¸åº”çš„ymlæ–‡ä»¶ï¼Œä¸‹è½½åå°†å†…å®¹copyè‡³è¯¥æ–‡ä»¶)ï¼Œä¿å­˜æ›´æ”¹åå¤åˆ¶è¯¥æ–‡ä»¶è‡³å…ˆå‰åˆ›å»ºçš„Clashæ–‡ä»¶å¤¹(by:è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸è¦å¼„æ··ï¼Œä¸€ä¸ªæ˜¯æ‰‹åŠ¨å»ºç«‹çš„ï¼Œä¸€ä¸ªæ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œéƒ½éœ€è¦.ymlæ–‡ä»¶)ã€‚</p>
<p>åœ¨ç»ˆç«¯ cd åˆ° Clash äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œä¸‹è½½ Clash é…ç½®æ–‡ä»¶ï¼Œå¾—åˆ°å•†å®¶æä¾›çš„æœåŠ¡å™¨åŠè§„åˆ™ç­‰ä¿¡æ¯<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/linux-clash-2.jpg" alt></p>
<p>å°†å…¶åœ¨/home/å½“å‰ç”¨æˆ·ID/.config/clashä¸‹å¤åˆ¶ä¸€ä»½<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo cp ~/home/å½“å‰ç”¨æˆ·ID/clash/config.yml ~/home/å½“å‰ç”¨æˆ·ID/.config/clash</span><br></pre></td></tr></table></figure></p>
<h2 id="4-åŠ è½½é…ç½®"><a href="#4-åŠ è½½é…ç½®" class="headerlink" title="4. åŠ è½½é…ç½®"></a>4. åŠ è½½é…ç½®</h2><p>é‡å¯ç»ˆç«¯ï¼Œæ‰§è¡Œ <code>sudo ./clash-linux-amd64</code>ä»¥åŠ è½½é…ç½®æ–‡ä»¶</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/linux-clash-3.jpg" alt></p>
<h2 id="5-ç«¯å£è®¿é—®"><a href="#5-ç«¯å£è®¿é—®" class="headerlink" title="5. ç«¯å£è®¿é—®"></a>5. ç«¯å£è®¿é—®</h2><p>è®¿é—® <a href="http://clash.razord.top/">Clash Dashboard </a> å¯ä»¥è¿›è¡Œåˆ‡æ¢èŠ‚ç‚¹ã€æµ‹å»¶è¿Ÿç­‰æ“ä½œã€‚</p>
<p>Host: <code>127.0.0.1</code>ï¼Œç«¯å£: <code>9090</code><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/linux-clash-4.jpg" alt></p>
<h2 id="6-å¯åŠ¨ä»£ç†"><a href="#6-å¯åŠ¨ä»£ç†" class="headerlink" title="6. å¯åŠ¨ä»£ç†"></a>6. å¯åŠ¨ä»£ç†</h2><p>ä»¥ Ubuntu 19.04 ä¸ºä¾‹ï¼Œæ‰“å¼€ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œä»£ç†å³è¾¹çš„ âš™ æŒ‰é’®ï¼Œé€‰æ‹©æ‰‹åŠ¨ï¼Œå¡«å†™ HTTP å’Œ HTTPS ä»£ç†ä¸º <code>127.0.0.1:7890</code>ï¼Œå¡«å†™ Socks ä¸»æœºä¸º <code>127.0.0.1:7891</code>ï¼Œå³å¯å¯ç”¨ç³»ç»Ÿä»£ç†ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/linux-clash-5.jpg" alt></p>
<p>è‹¥éœ€å…³æ‰ä»£ç†ï¼Œåˆ™<code>ctrl+c</code>åœæ­¢ç»ˆç«¯ï¼Œå¹¶åœ¨ç³»ç»Ÿä»£ç†è®¾ç½®ä¸­é‡æ–°æ”¹ä¸ºæ— å³å¯ã€‚</p>
<h2 id="7-å›ºå®šä»»åŠ¡æ "><a href="#7-å›ºå®šä»»åŠ¡æ " class="headerlink" title="7. å›ºå®šä»»åŠ¡æ "></a>7. å›ºå®šä»»åŠ¡æ </h2><p>è‹¥éœ€å›ºå®šåˆ°å¯åŠ¨å™¨ï¼Œåˆ™é€‰æ‹©åˆé€‚çš„å›¾ç‰‡æ–‡ä»¶ï¼Œç”¨ä½œå›¾æ ‡ï¼Œæ”¾ç½®äºåˆ›å»ºçš„clashæ–‡ä»¶å¤¹ä¸‹</p>
<p>ä½¿ç”¨<code>sudo gedit /usr/share/applications/Clash.desktop</code>åœ¨ /usr/share/applications/ ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ Clash.desktop ï¼Œæ­¥éª¤åŠå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä»¥ä¸‹å„é¡¹æ ¹æ®è‡ªå·±çš„æƒ…å†µå¡«å†™</span><br><span class="line">[Desktop Entry]</span><br><span class="line"> Version=0.17.0</span><br><span class="line"> Name=Clash</span><br><span class="line"> Comment=A rule-based tunnel in Go</span><br><span class="line"> Exec=/full/path/to/clash-linux</span><br><span class="line"> Icon=/full/path/to/clash-logo.png</span><br><span class="line"> Terminal=false</span><br><span class="line"> Type=Application</span><br><span class="line"> Categories=Network</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>å…³é”®è¯è¯´æ˜</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Desktop Entry] æ–‡ä»¶å¤´</span><br><span class="line">Version    ç‰ˆæœ¬</span><br><span class="line">Name    åº”ç”¨åç§°</span><br><span class="line">Name[xx]    ä¸åŒè¯­è¨€çš„åº”ç”¨åç§°</span><br><span class="line">Comment æ³¨é‡Š</span><br><span class="line">Exec    æ‰§è¡Œæ–‡ä»¶è·¯å¾„</span><br><span class="line">Icon    å›¾æ ‡è·¯å¾„</span><br><span class="line">Terminal    æ˜¯å¦ä½¿ç”¨ç»ˆç«¯</span><br><span class="line">Type    å¯åŠ¨å™¨ç±»å‹</span><br><span class="line">Categories  åº”ç”¨çš„ç±»å‹ï¼ˆå†…å®¹ç›¸å…³ï¼‰</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ“ä½œå®Œæˆåï¼Œå³å¯åœ¨å¯åŠ¨å™¨ä¸­çœ‹åˆ°è¯¥åº”ç”¨å›¾æ ‡ï¼Œå¯¹å…¶å³é”®å•å‡»ï¼Œé€‰æ‹©å›ºå®šåˆ°ä»»åŠ¡æ ï¼Œæ–¹ä¾¿ä»¥åæ‰“å¼€ ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/clash/Snipaste_2020-02-05_23-07-03.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>Latexæ§åˆ¶å›¾ç‰‡ä½ç½®</title>
    <url>/2020/07/18/Latex%E6%8E%A7%E5%88%B6%E5%9B%BE%E7%89%87%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨LaTexä¸­ï¼Œ\begin{figure}[~]æ˜¯å›¾ç‰‡ç¯å¢ƒï¼Œå¸¸ç”¨é€‰æ‹©é¡¹[htbp]æ˜¯æµ®åŠ¨æ ¼å¼ï¼š</p>
<ul>
<li>[h] ~ hereï¼Œå½“å‰ä½ç½®ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨æ­£æ–‡æ–‡æœ¬ä¸­ç»™å‡ºè¯¥å›¾å½¢ç¯å¢ƒçš„åœ°æ–¹ã€‚å¦‚æœæœ¬é¡µæ‰€å‰©é¡µé¢ä¸å¤Ÿï¼Œè¿™ä¸€å‚æ•°å°†ä¸èµ·ä½œç”¨ã€‚</li>
<li>[t] ~ topï¼Œé¡¶éƒ¨ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨é¡µé¢çš„é¡¶éƒ¨ã€‚</li>
<li>[b] ~ bottomï¼Œåº•éƒ¨ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨é¡µé¢çš„åº•éƒ¨ã€‚</li>
<li>[p] ~ page of its ownï¼Œæµ®åŠ¨é¡µã€‚å°†å›¾å½¢æ”¾ç½®åœ¨ä¸€ä¸ªå…è®¸æœ‰æµ®åŠ¨å¯¹è±¡çš„é¡µé¢ä¸Šã€‚</li>
</ul>
<p>ä¸€èˆ¬ä½¿ç”¨[htb]è¿™æ ·çš„ç»„åˆï¼Œåªç”¨[h]æ˜¯æ²¡æœ‰ç”¨çš„ã€‚è¿™æ ·ç»„åˆçš„æ„æ€å°±æ˜¯LaTexä¼šå°½é‡æ»¡è¶³æ’åœ¨å‰é¢çš„æµ®åŠ¨æ ¼å¼ï¼Œå°±æ˜¯h-t-bè¿™ä¸ªé¡ºåºï¼Œè®©æ’ç‰ˆçš„æ•ˆæœå°½é‡å¥½ã€‚</p>
<p>[!h]åªæ˜¯è¯•å›¾æ”¾åœ¨å½“å‰ä½ç½®ã€‚å¦‚æœé¡µé¢å‰©ä¸‹çš„éƒ¨åˆ†æ”¾ä¸ä¸‹ï¼Œè¿˜æ˜¯ä¼šè·‘åˆ°ä¸‹ä¸€é¡µçš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç”¨[!h]é€‰é¡¹é€šå¸¸ä¼šå‡ºç°ä¸èƒ½æ­£ç¡®æ”¾ç½®çš„é—®é¢˜ï¼Œæ‰€ä»¥å¸¸ç”¨[ht]ã€[htbp]ç­‰ã€‚è¿™é‡ŒåŠ æ„Ÿå¹å·çš„æ„æ€æ˜¯å¿½ç•¥â€œç¾å­¦â€æ ‡å‡†ã€‚</p>
<p>å¦‚æœä½ ç¡®å®éœ€è¦æŠŠå›¾ç‰‡æ”¾åœ¨å½“å‰ä½ç½®ï¼Œä¸å®¹æ”¹å˜ï¼Œå¯ä»¥ç”¨ \usepackege{float} å®åŒ…çš„[H]é€‰é¡¹ã€‚ä¸è¿‡å¦‚æœè¿™æ ·åšï¼Œå‡ºç°æ”¾ä¸ä¸‹çš„é—®é¢˜æ—¶éœ€è¦æ‰‹å·¥è°ƒæ•´ã€‚ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\usepackage&#123;float&#125; </span><br><span class="line">% ... </span><br><span class="line">\begin&#123;figure&#125;[H] </span><br><span class="line">foo </span><br><span class="line">\end&#123;figure&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹åˆ«å¼ºè°ƒï¼Œå½“å›¾ç‰‡æˆ–è€…è¡¨æ ¼å æ®åŒæ æ¨¡æ¿çš„ä¸¤æ æ—¶ï¼ˆå³åœ¨\begin{figure*} æˆ– \begin{table*} æ—¶ï¼‰ï¼Œè¿™äº›æ§åˆ¶é€‰é¡¹å°±å¤±æ•ˆäº†ã€‚</strong></p>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>è®ºæ–‡å¤§å¤šéƒ½æ˜¯ä»¥åŒæ æ’ç‰ˆï¼Œé‚£ä¹ˆåœ¨åŒæ æ’ç‰ˆä¸­ï¼Œå¦‚ä½•è®©å›¾ç‰‡å’Œè¡¨æ ¼å‡ºç°åœ¨é¡µé¢åº•ç«¯ï¼Ÿä¸Šè¿°[!b]ç­‰ç­‰çš„ä¸€äº›å‘½ä»¤éƒ½æ˜¯é’ˆå¯¹å•æ æ’ç‰ˆï¼Œåœ¨åŒæ ä¸­ä¸èµ·ä½œç”¨ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜æ˜¯æ’ç‰ˆåŒæ å›¾è¡¨è¿‡ç¨‹ä¸­ï¼Œè¾ƒä¸ºå¸¸è§çš„é—®é¢˜ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ’ç‰ˆåŒæ æ–‡ç« çš„æ—¶å€™ï¼Œæœ‰äº›å›¾æ¯”è¾ƒå®½ï¼Œéœ€è¦è®©å›¾æˆ–è€…è¡¨æ ¼è·¨æ æ’ç‰ˆï¼Œè¿™æ—¶æˆ‘ä»¬ä¼šç”¨åˆ°å¦‚ä¸‹ä¸¤ä¸ªç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;table*&#125;[ht]</span><br><span class="line"> </span><br><span class="line">\end&#123;table*&#125;</span><br></pre></td></tr></table></figure>
<p>å’Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;figure*&#125;[ht]</span><br><span class="line">â€¦</span><br><span class="line">\end&#123;figure*&#125;</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸è¿™æ ·çš„è·¨æ å›¾ä¼šæ”¾åˆ°é¡µé¢çš„é¡¶éƒ¨ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>è‹¥æ˜¯æˆ‘ä»¬æƒ³è®©å›¾è¡¨æ”¾ç½®åˆ°é¡µé¢åº•éƒ¨çš„è¯ï¼Œå¯ä»¥è¿™æ ·åšï¼Œåœ¨å¯¼è¨€åŒºåŠ å…¥:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\usepackage&#123;stfloats&#125;</span><br></pre></td></tr></table></figure>
<p>æ’å›¾çš„è¯ä½¿ç”¨å¦‚ä¸‹ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;figure*&#125;[bp]</span><br><span class="line">â€¦</span><br><span class="line">\end&#123;figure*&#125;</span><br></pre></td></tr></table></figure>
<p>è¡¨æ ¼ç±»ä¼¼ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;table*&#125;[bp]</span><br><span class="line">â€¦</span><br><span class="line">\end&#123;table*&#125;</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ä»£ç ã€‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\documentclass[twocolumn]&#123;book&#125;</span><br><span class="line">\usepackage&#123;graphicx&#125;</span><br><span class="line">\usepackage&#123;xcolor,stfloats&#125;</span><br><span class="line">\usepackage&#123;lipsum&#125;%ç”Ÿæˆéšæœºæ–‡æœ¬</span><br><span class="line">\begin&#123;document&#125;</span><br><span class="line">\lipsum</span><br><span class="line">\lipsum[2-5]</span><br><span class="line">\begin&#123;figure*&#125;[b]</span><br><span class="line">\centering</span><br><span class="line">\includegraphics[width=12cm]&#123;image&#125;</span><br><span class="line">\end&#123;figure*&#125;</span><br><span class="line">\lipsum[2-5]</span><br><span class="line">\lipsum</span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Latex</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuå¢åŠ swapäº¤æ¢ç©ºé—´</title>
    <url>/2020/08/24/Ubuntu%E5%A2%9E%E5%8A%A0swap%E4%BA%A4%E6%8D%A2%E7%A9%BA%E9%97%B4/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æˆ‘åœ¨è®­ç»ƒæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸è·‘ç€ä¸­é€”å‘ç”Ÿäº†<code>can not allocate memory</code>çš„å¼‚å¸¸ï¼Œä»è€Œä½¿ç¨‹åºä¸­æ–­ï¼Œå…¶ä¸­å‘ç°æ˜¯ç”±äºswapç©ºé—´è®¾ç½®å¤ªå°ï¼Œå¯¼è‡´äº¤æ¢å†…å­˜æº¢å‡ºã€‚å› æ­¤æœ¬æ–‡ä»‹ç»å¢åŠ swapç©ºé—´çš„æ–¹æ³•ã€‚</p>
<h2 id="æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„swapå¤§å°"><a href="#æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„swapå¤§å°" class="headerlink" title="æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„swapå¤§å°"></a>æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„swapå¤§å°</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">free -m</span><br></pre></td></tr></table></figure>
<p>m æ˜¯ä»¥å…†ä¸ºå•ä½ï¼Œ gæ˜¯ä»¥GBä¸ºå•ä½ï¼Œ é»˜è®¤æ˜¯kb</p>
<p>å¦‚ä¸‹å›¾ï¼Œå½“å‰ç³»ç»Ÿåªæœ‰1Gçš„äº¤æ¢ç©ºé—´ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/1.png" alt></p>
<h2 id="åˆ›å»ºä¸€ä¸ªswapæ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ªswapæ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ªswapæ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ªswapæ–‡ä»¶</h2><p>swapäº¤æ¢ç©ºé—´å…¶å®å°±æ˜¯ç¡¬ç›˜ä¸Šä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ï¼Œåªä¸è¿‡è¿™ä¸ªæ–‡ä»¶åªæœ‰å†…å­˜åœ¨è¯»å†™ï¼Œæ¯”è¾ƒå¤§äº›ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /home/roo/swapfile</span><br><span class="line"></span><br><span class="line">cd /home/roo/swapfile</span><br><span class="line"></span><br><span class="line">sudo dd if=/dev/zero of=swap bs=1G count=61</span><br></pre></td></tr></table></figure>
<p><code>mkdir /home/roo/swapfile</code> æ˜¯å…ˆåœ¨/home/rooç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªåä¸ºswapfileçš„æ–‡ä»¶å¤¹<br>cd è¿›å…¥swapfileæ–‡ä»¶å¤¹ï¼Œ ç„¶ååˆ›å»ºä¸€ä¸ªå¤§å°ä¸º61Gçš„ï¼Œåä¸ºswapçš„ç©ºæ–‡ä»¶ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/2.png" alt></p>
<p>å‘½ä»¤è§£é‡Šï¼š</p>
<ul>
<li><code>/home/roo/</code> å¯ä»¥æ›´æ¢ä¸ºè‡ªå·±çš„è·¯å¾„</li>
<li><code>bs</code>ä¸ºå•ä½ï¼Œé»˜è®¤ä¸ºkbï¼Œ å¦‚è®¾ç½®ä¸º1024ï¼Œåˆ™ä»£è¡¨1M</li>
<li><code>count</code>ä¸ºæ•°é‡ï¼Œæ‰©å¢å¤§å°ä¸º$count \times bs$</li>
</ul>
<h2 id="è½¬æ¢swapæ–‡ä»¶"><a href="#è½¬æ¢swapæ–‡ä»¶" class="headerlink" title="è½¬æ¢swapæ–‡ä»¶"></a>è½¬æ¢swapæ–‡ä»¶</h2><p>å°†ç”Ÿæˆçš„æ–‡ä»¶è½¬æ¢æˆswapç±»å‹çš„æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mkswap -f swap</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/3.png" alt></p>
<h2 id="æ¿€æ´»swapæ–‡ä»¶"><a href="#æ¿€æ´»swapæ–‡ä»¶" class="headerlink" title="æ¿€æ´»swapæ–‡ä»¶"></a>æ¿€æ´»swapæ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo swapon swap</span><br></pre></td></tr></table></figure>
<p>å¸è½½çš„è¯ä½¿ç”¨ swapoff</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo swapoff swap</span><br></pre></td></tr></table></figure>
<p>æœ€åå†æ¬¡ä½¿ç”¨freeæŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/4.png" alt></p>
<h2 id="æ°¸ä¹…ç”Ÿæ•ˆ"><a href="#æ°¸ä¹…ç”Ÿæ•ˆ" class="headerlink" title="æ°¸ä¹…ç”Ÿæ•ˆ"></a>æ°¸ä¹…ç”Ÿæ•ˆ</h2><p>è™½ç„¶äº¤æ¢ç©ºé—´åˆ°æ­¤å·²ç»æ‰©å±•æˆåŠŸäº†ï¼Œä½†æ˜¯ç”µè„‘é‡å¯çš„è¯ï¼Œè¿˜æ˜¯ä¼šæ¢å¤é»˜è®¤çš„swapå¤§å°ã€‚å¦‚æœè¦ä¸€ç›´ä½¿ç”¨è¿™ä¸ªswapï¼Œè¦æŠŠå®ƒå†™å…¥/etc/fstabæ–‡ä»¶ä¸­ã€‚</p>
<p>ç¼–è¾‘æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/fstab</span><br></pre></td></tr></table></figure>
<p>åŠ å…¥ä»¥ä¸‹å†…å®¹(è·¯å¾„æ ¹æ®è‡ªå·±è®¾ç½®çš„ä¿®æ”¹)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/home/roo/swapfile/swap none swap defaults 0 0</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/5.png" alt></p>
<h2 id="æ¨èswapå¤§å°"><a href="#æ¨èswapå¤§å°" class="headerlink" title="æ¨èswapå¤§å°"></a>æ¨èswapå¤§å°</h2><p>ä»¥ä¸‹åˆ—å‡ºUbuntuç³»ç»Ÿæ ¹æ®RAMå¤§å°æ¨èè®¾ç½®çš„swapå¤§å°ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/swap/6.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>arxivæ–‡ç« ä¸‹è½½åŠ é€Ÿ</title>
    <url>/2020/01/26/arxiv%E6%96%87%E7%AB%A0%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F/</url>
    <content><![CDATA[<p>å¯¹äºæˆ‘ä»¬è¿™æ ·çš„æ·±åº¦å­¦ä¹ å±Œä¸æ¥è¯´ï¼Œæ²¡é’±ï¼Œæ²¡èµ„æºï¼Œæ²¡æ•°æ®ï¼Œæ²¡æ—¶é—´ï¼Œåªèƒ½çœ‹çœ‹åˆ«äººçš„è®ºæ–‡ç”Ÿå­˜äº†ï¼Œç»å¸¸ä¼šåˆ°arxivä¸Šä¸‹è½½ä¸€äº›æ–‡ç« ï¼Œæ¯”å¦‚cvprçš„æ–‡ç« ï¼Œä½†æ˜¯ï¼Œç”±äºå›½å†…å°é”ï¼Œä¸‹è½½å¾ˆæ…¢ï¼Œç”šè‡³æ¥è¿å‡ å¤©æ‰“ä¸å¼€arxivçš„ç½‘ç«™ï¼Œå’‹åŠï¼Ÿ</p>
<p>å¼ºçƒˆæ¨èä½¿ç”¨ä¸­ç§‘é™¢arxivçš„é•œåƒåœ°å€ï¼š<a href="http://xxx.itp.ac.cn">http://xxx.itp.ac.cn</a><br>å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼šæŠŠè¦è®¿é—® arxiv é“¾æ¥ä¸­çš„åŸŸåä» <a href="https://arxiv.org">https://arxiv.org</a> æ¢æˆ <a href="http://xxx.itp.ac.cn">http://xxx.itp.ac.cn</a> ,</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¯”å¦‚:</span><br><span class="line">https://arxiv.org/pdf/1608.00367</span><br><span class="line">æ¢æˆï¼š</span><br><span class="line">http://xxx.itp.ac.cn/pdf/1608.00367.pdf</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆ–è€…å°†ï¼š</span><br><span class="line">https://arxiv.org/abs/1608.00367</span><br><span class="line">æ¢æˆï¼š</span><br><span class="line">http://xxx.itp.ac.cn/abs/1608.00367</span><br></pre></td></tr></table></figure>
<p>å³å¯æ‰“å¼€ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿ</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>arxiv</tag>
      </tags>
  </entry>
  <entry>
    <title>Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨å¹¶å®ç°è¿œç¨‹è°ƒè¯•</title>
    <url>/2020/01/26/Pycharm%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<h2 id="Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨"><a href="#Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨"></a>Pycharmè¿æ¥è¿œç¨‹æœåŠ¡å™¨</h2><ul>
<li>è¿›å…¥é…ç½®é¡µé¢<br>Pycharmèœå•æ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¾æ¬¡ç‚¹å‡» Tools -&gt; Deployment -&gt; Configrationâ€¦<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161124726.png" alt></li>
<li>é…ç½®è¿æ¥æœåŠ¡å™¨<br>å¦‚ä¸‹å›¾ã€‚nameéšä¾¿å†™ä¸ªå°±è¡Œã€‚<br>Connectionä¸‹ï¼Œåè®®æœ€å¥½é€‰æ‹©sftpï¼Œæ¥ä¸‹æ¥å¡«å†™æœåŠ¡å™¨ä¸»æœºIPï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/2018082916114659.png" alt><br>ç‚¹å‡»Test SFTP connectionä¼šå‘ç°ï¼Œå¦‚æœè¿æ¥æˆåŠŸä¼šæç¤ºä½ å¦‚ä¸‹<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161158768.png" alt><br>åœ¨Mappingä¸‹ï¼Œé€‰æ‹©è¿æ¥windowsä¸‹çš„é‚£éƒ¨åˆ†ä»£ç å’ŒæœåŠ¡å™¨ä¸Šä»£ç ç›¸è¿ï¼Œæœ¬åœ°Local pathï¼ŒæœåŠ¡å™¨pathï¼Œapplyï¼ŒOKï¼Œè¡¨ç¤ºå·²ç»æŠŠæœ¬åœ°çš„ä»£ç å’ŒæœåŠ¡å™¨ä»£ç è¿æ¥ä¸Šäº†ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161217756.png" alt></li>
<li>ä¸Šä¼ ä»£ç ï¼Œä½¿å¾—æœ¬åœ°ä»£ç å’ŒæœåŠ¡å™¨ä»£ç ä¿æŒåŒæ­¥<br>ç‚¹å‡»Upload to nameï¼ˆåˆšæ‰å¡«å†™çš„è¿œç¨‹æœåŠ¡å™¨åå­—ï¼‰ï¼Œå³å¯ä¸Šä¼ ä»£ç ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161235445.png" alt><br>è‹¥é…ç½®æœ‰å¤šä¸ªä¸åŒæœåŠ¡å™¨æˆ–åŒä¸€ä¸ªæœåŠ¡å™¨é…ç½®äº†å¤šä¸ª æœåŠ¡å™¨ä¸Šä¼ è·¯å¾„ï¼ˆDeployment Pathï¼‰ï¼Œå¯é€‰æ‹© Upload toâ€¦ï¼Œä¸Šä¼ åˆ°ä¸åŒçš„æœåŠ¡å™¨/è·¯å¾„ã€‚</li>
</ul>
<h2 id="é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨"><a href="#é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨" class="headerlink" title="é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨"></a>é…ç½®è¿œç¨‹Pythonè§£é‡Šå™¨</h2><p>ä½¿ç”¨æœåŠ¡å™¨è°ƒè¯•Pythonç¨‹åºçš„å‰ææ—¶åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…äº†Pythonè§£é‡Šå™¨ï¼Œå¦‚æœæ²¡å®‰è£…ï¼Œè¯·å…ˆå®‰è£…ã€‚</p>
<ul>
<li>å°†Pythonè§£é‡Šå™¨è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„<br>åœ¨èœå•æ ï¼ŒFile -&gt; Settingsâ€¦ -&gt; Project Ã—Ã— -&gt; Project Interpreterï¼Œç‚¹å‡»å³ä¾§ AddæŒ‰é’®ï¼Œæ·»åŠ è§£é‡Šå™¨ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161249360.png" alt><br>é€‰æ‹©SSH Interpreterï¼Œå¡«å†™æœåŠ¡å™¨çš„ Host åœ°å€ï¼Œç«¯å£Portï¼Œç”¨æˆ·åUsernameï¼Œå¡«å¥½åï¼Œä¸‹ä¸€æ­¥Nextã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161306837.png" alt><br>å¡«å†™å¯†ç  Passwordï¼Œä¸‹ä¸€æ­¥Nextã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161340812.png" alt><br>é€‰æ‹©è¿œç¨‹æœåŠ¡å™¨ä¸ŠPythonè§£é‡Šå™¨çš„ä½ç½®ï¼ŒæœåŠ¡å™¨ä¸Šçš„è¿œç¨‹åŒæ­¥æ–‡ä»¶å¤¹Sync foldersï¼ˆå³ä¹‹å‰é…ç½®çš„æœåŠ¡å™¨Pathï¼‰ï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªã€‚å¦‚æœä¸çŸ¥é“Pythonå®‰è£…åœ¨å“ªï¼Œå¯ä»¥è¿œç¨‹è¿æ¥æœåŠ¡å™¨åï¼Œä½¿ç”¨ å‘½ä»¤ which python æ‰¾åˆ°Pythonå®‰è£…ä½ç½®ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm%20remote%20control/20180829161653972.jpg" alt><br>Finishï¼Œé…ç½®ç»“æŸã€‚è¯¥é¡¹ç›®ç°åœ¨ä½¿ç”¨çš„å°±æ˜¯è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„Pythonè§£é‡Šå™¨äº†ã€‚ä»¥åçš„é¡¹ç›®è‹¥æƒ³/ä¸æƒ³ä½¿ç”¨è¯¥è§£é‡Šå™¨ï¼Œæ‰‹åŠ¨æ›´æ”¹è§£é‡Šå™¨å³å¯ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº"><a href="#ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº" class="headerlink" title="ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº"></a>ä½¿ç”¨è¿œç¨‹è§£é‡Šå™¨è¿è¡Œæœ¬åœ°Pythonç¨‹åº</h2><p>å°†æµ‹è¯•ä»£ç ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ï¼ˆTooles -&gt; Deployment -&gt; Upload to Ã—Ã—ï¼‰ã€‚<br>Runæµ‹è¯•ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨ä»£ç æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œäº†ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pycharm</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹pipå®‰è£…numba</title>
    <url>/2020/05/18/Ubuntu%E4%B8%8Bpip%E5%AE%89%E8%A3%85numba/</url>
    <content><![CDATA[<h2 id="é”™è¯¯æé†’"><a href="#é”™è¯¯æé†’" class="headerlink" title="é”™è¯¯æé†’"></a>é”™è¯¯æé†’</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ImportError: No module named numba</span><br></pre></td></tr></table></figure>
<h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>æ³¨æ„ï¼šåœ¨å®‰è£…numbaä¹‹å‰å¿…é¡»å®‰è£…llvm</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install llvm-8*</span><br></pre></td></tr></table></figure>
<p>å¯¼å…¥ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alias llvm-config=&quot;llvm-config-8&quot;</span><br><span class="line">export LLVM_CONFIG=&quot;/usr/bin/llvm-config-8&quot;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®‰è£…llvm</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install llvmlite</span><br></pre></td></tr></table></figure>
<p>æœ€åå®‰è£…numba</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple numba</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ–°ç¯å¢ƒä¸‹å¿«é€Ÿå®‰è£…ä¾èµ–åŒ…çš„å°æŠ€å·§</title>
    <url>/2019/12/14/Python%E6%96%B0%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p>å½“ä½ æ–°åˆ›ä¸€ä¸ªPythonç¯å¢ƒæ—¶ï¼Œè‹¥è¿˜ç”¨pipä¸€ä¸ªä¸ªè£…ä½ æ‰€éœ€è¦çš„åº“ï¼Œæ˜æ˜¾æ•ˆç‡ååˆ†ä½ä¸‹ã€‚è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§ï¼Œä½ å¯ä»¥ä»å·²é…ç½®å¥½çš„æ—§ç¯å¢ƒä¸­ï¼Œå¯¼å‡ºä¸€ä¸ªrequirements.txt æ–‡ä»¶ï¼Œç”¨äºè®°å½•æ‰€æœ‰ä¾èµ–åŒ…åŠå…¶ç²¾ç¡®çš„ç‰ˆæœ¬å·ã€‚ä»¥ä¾¿æ–°ç¯å¢ƒéƒ¨ç½²ã€‚</p>
<p>åœ¨æ—§ç¯å¢ƒä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆrequirements.txtæ–‡ä»¶ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure><br>requirements.txtä¸­çš„å†…å®¹ç±»ä¼¼å¦‚ä¸‹ï¼Œè®°å½•äº†ä½ æ—§æœ‰ç¯å¢ƒçš„ä¾èµ–åŒ…åŠå…¶ç²¾ç¡®çš„ç‰ˆæœ¬å·ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">appdirs==1.4.3</span><br><span class="line">backports.functools-lru-cache==1.5</span><br><span class="line">beautifulsoup4==4.5.3</span><br><span class="line">bs4==0.0.1</span><br><span class="line">cycler==0.10.0</span><br><span class="line">kiwisolver==1.0.1</span><br><span class="line">lxml==3.7.3</span><br><span class="line">matplotlib==2.2.0</span><br><span class="line">numpy==1.14.1</span><br><span class="line">pandas==0.22.0</span><br><span class="line">pyparsing==2.2.0</span><br><span class="line">python-dateutil==2.6.1</span><br><span class="line">pytz==2018.3</span><br><span class="line">six==1.11.0</span><br><span class="line">virtualenv==15.1.0</span><br></pre></td></tr></table></figure><br>è¿™æ—¶ä½ å¯ä»¥æŠŠrequirements.txtæ‹·å…¥æ–°é…ç½®çš„Pythonç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><br>åˆ™ä¼šæŒ‰ç…§requirements.txtä¸­æ‰€å†™çš„ä¾èµ–åŒ…å’Œç‰ˆæœ¬ä¾åºè¿›è¡Œå®‰è£…ã€‚<br>æ³¨æ„ï¼š<br>è‹¥è¿å…¥çš„ç³»ç»Ÿä¸åŒæˆ–Pythonç‰ˆæœ¬ä¸åŒï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ°ç›¸åº”çš„ä¾èµ–åŒ…ç‰ˆæœ¬è€ŒæŠ¥é”™<br>è¿™æ—¶ä½ å¯ä»¥è¿›å…¥requirements.txtæŠŠæŠ¥é”™çš„ä¾èµ–åŒ…åçš„ç‰ˆæœ¬ä¿¡æ¯å»æ‰ï¼Œä¿å­˜ï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤å³å¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½åŒ¹é…çš„æœ€æ–°ç‰ˆæœ¬ã€‚<br>ä¹Ÿå¯ä»¥æŠŠ==æ”¹æˆ&lt;=ï¼Œä»£è¡¨å®ƒä¼šæœç´¢ä¸å¤§äºæ­¤ç‰ˆæœ¬çš„æœ€é«˜ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚<br>ç”±äºpipä¸‹è½½æºåœ¨å›½å¤–ï¼Œè‹¥æ— åˆé€‚çš„VPNï¼Œæ­¤æœŸé—´ä¸‹è½½è¿‡ç¨‹ä¼šååˆ†æ¼«é•¿ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªå¸¸ç”¨çš„å›½å†…é•œåƒæºï¼š</p>
<ul>
<li>æ¸…åå¤§å­¦ <a href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a></li>
<li>ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ <a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a></li>
<li>é˜¿é‡Œäº‘ <a href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a></li>
<li>è±†ç“£ <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></li>
<li>åä¸­ç§‘æŠ€å¤§å­¦ <a href="https://pypi.hustunique.com/">https://pypi.hustunique.com/</a></li>
</ul>
<p>å¯ä»¥åœ¨ä½¿ç”¨pipçš„æ—¶å€™ï¼ŒåŠ ä¸Šå‚æ•°-iå’Œé•œåƒåœ°å€ï¼ŒæŒ‡å®šä¸‹è½½æºï¼ŒåŠ é€Ÿä¸‹è½½è¿‡ç¨‹ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›ç™¾åº¦ç½‘ç›˜çš„ç ´è§£æ–¹æ³•</title>
    <url>/2020/02/02/%E4%B8%80%E4%BA%9B%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9A%84%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="1-è„šæœ¬"><a href="#1-è„šæœ¬" class="headerlink" title="1. è„šæœ¬"></a>1. è„šæœ¬</h2><p>æœ€æ¨èçš„æ–¹æ³•ï¼Œå¤±æ•ˆäº†å†æ¢è„šæœ¬å°±å¥½ã€‚æ­¤æ–¹æ³•é€šè¿‡æµè§ˆå™¨æ‹“å±•Violentmonkeyæˆ–è€…Tampermonkeyæ¥å¯ç”¨ï¼Œç›¸åº”è„šæœ¬å¯è‡ªå·±å»<a href="https://greasyfork.org/zh-CN">GreasyFork</a>æœå¯»ï¼ŒåŸç†æ˜¯é€šè¿‡æ˜¾ç¤ºç›´é“¾ï¼Œç„¶åä½¿ç”¨ IDM æ¥åŠ é€Ÿä¸‹è½½ï¼Œæœ‰çš„è„šæœ¬ä¹Ÿå¯é…åˆariaä¸‹è½½ï¼ˆæ›´æ¨èä½¿ç”¨ariaï¼‰<br><strong>ä½¿ç”¨æ–¹æ³•ï¼šï¼ˆä¸‹è½½éƒ¨åˆ†ï¼‰</strong><br>1ã€é€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶ï¼Œç‚¹å‡»é¡µé¢é‡Œçš„ â€œç”Ÿæˆé“¾æ¥â€ æ¥è·å–åŠ é€Ÿä¸‹è½½åœ°å€ã€‚<br>2ã€ä½¿ç”¨é¼ æ ‡å³é”®ç‚¹å‡»é“¾æ¥ï¼ˆæ³¨æ„æ˜¯å³é”®ç‚¹å‡»é“¾æ¥ï¼‰ï¼Œé€‰æ‹©â€œä½¿ç”¨ IDM ä¸‹è½½â€ï¼Œç„¶åç¡®å®šä¸‹è½½ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/7a6a15d5gy1g8s99l1zdqg20qn0euqa8.gif" alt></p>
<p>ä¹Ÿå¯ä»¥é…åˆAria2 manageræ‰©å±•ï¼Œæ·»åŠ å³é”®èœå•ï¼Œå°†ç”Ÿæˆçš„é“¾æ¥<strong>å¯¼å‡ºåˆ° ARIA2 RPC</strong>ï¼Œç”±AriaNgä¸‹è½½ï¼Œä¸ä¼šé…ç½®çš„ä¹Ÿå¯ä½¿ç”¨ä¸‹é¢ä»‹ç»çš„Motrixä»£æ›¿ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/Snipaste_2020-02-02_20-12-56.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/Snipaste_2020-02-02_20-13-39.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/7a6a15d5gy1g952lk3yu0g20sf0fy469.gif" alt></p>
<h2 id="2-Pandownload"><a href="#2-Pandownload" class="headerlink" title="2. Pandownload"></a>2. Pandownload</h2><p>Pandownloadå¯ä»¥è¯´æ˜¯å¤§åé¼é¼çš„ç™¾åº¦äº‘ä¸‹è½½å™¨äº†ï¼Œä½†å‰æ®µæ—¶é—´ç™¾åº¦ç½‘ç›˜çš„æ•´æ”¹ï¼Œä¸€åº¦è¢«å°ï¼Œæœ€è¿‘æ—¶æœ‰ç¬¬ä¸‰æ–¹ä¿®æ”¹ç‰ˆå¤æ´»ï¼Œä½†ä½“éªŒèµ·æ¥ä»ä¸ç¨³å®šï¼Œä¸”æœ‰é™é€Ÿçš„é£é™©ï¼Œæˆ‘ä¸æ¨èç”¨è¿™ä¸ªã€‚</p>
<h2 id="3-çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­"><a href="#3-çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­" class="headerlink" title="3. çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­"></a>3. çˆ±å¥‡è‰ºä¸‡èƒ½è”æ’­</h2><p>çˆ±å¥‡è‰ºä½œä¸ºç™¾åº¦ç³»ä¸‹çš„äº§å“ï¼Œå…¶åº”ç”¨å•†åº—æä¾›çš„ä¸‡èƒ½è”æ’­ä¸‹è½½å™¨ï¼Œå¯ä»¥è®¿é—®ç™¾åº¦ç½‘ç›˜ä¸‹è½½ï¼Œä¸”ä¸ä»…é’ˆå¯¹è§†é¢‘ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰åŠ é€Ÿæ•ˆæœï¼Œä½†å¹¶ä¸éƒ½æ˜¯å…¨éƒ¨ï¼Œä¸”é™é€Ÿ3Mï¼Œä½†æ¯”èµ·ç™¾åº¦è‡ªèº«é™é€Ÿ100kè¦å¥½å¾—å¤šï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒç”¨ç¬¬ä¸‰æ–¹å°å·çš„å±é™©ã€‚<br><a href="http://store.iqiyi.com/">å®˜ç½‘åœ°å€</a></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/Snipaste_2020-02-09_19-30-07.jpg" alt></p>
<h2 id="4-Motrix"><a href="#4-Motrix" class="headerlink" title="4. Motrix"></a>4. Motrix</h2><p>Motrix æ˜¯ä¸€æ¬¾å¼€æºå…è´¹ä¸”ç•Œé¢éå¸¸æ¸…çˆ½ç®€çº¦çš„å…¨èƒ½å‹ä¸‹è½½è½¯ä»¶ï¼Œå®ƒè·¨å¹³å°æ”¯æŒ Windowsã€Macã€Linux ä¸‰å¤§ç³»ç»Ÿï¼Œå¯ä»¥æ”¯æŒä¸‹è½½ HTTPã€FTPã€BTã€ç£åŠ›é“¾æ¥ä»¥åŠä¸‹è½½ç™¾åº¦ç½‘ç›˜ç­‰èµ„æºã€‚å¦‚æœä½ ç”¨è…»äº†å…¶ä»–å·¥å…·ï¼Œä¸å¦¨è¯•è¯• Motrix å§â€¦â€¦</p>
<p>ä¸»è¦æ˜¯é…åˆè„šæœ¬ï¼Œå½“åšariaä¸‹è½½å™¨ä½¿ç”¨ï¼Œç«¯å£å·é»˜è®¤ä¸º16800ï¼Œæš‚ä¸æ”¯æŒä¿®æ”¹</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/baidu_exporter_2x.png%210x0.webp" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/baiduwp/Snipaste_2020-03-21_11-32-09.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>ç™¾åº¦ç½‘ç›˜</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³è¿œç¨‹screenåï¼Œè™šæ‹Ÿç¯å¢ƒä¸­çš„åŒ…ä¸¢äº†(å¦‚torch, tensorflow)</title>
    <url>/2020/05/04/%E8%A7%A3%E5%86%B3%E8%BF%9C%E7%A8%8Bscreen%E5%90%8E%EF%BC%8C%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%8C%85%E4%B8%A2%E4%BA%86%EF%BC%88%E5%A6%82torch,tensorflow%EF%BC%89/</url>
    <content><![CDATA[<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><p>1ã€åœ¨è¿›å…¥screenä¹‹å‰ä¸è¦æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œå¾…è¿›å…¥screenåå†æ¿€æ´»æ‰€éœ€çš„è™šæ‹Ÿç¯å¢ƒã€‚</p>
<p>2ã€å‡ºç°å¦‚ä¸‹é”™è¯¯æ—¶ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ImportError: libcudart.so.10.0: cannot open shared object file...</span><br></pre></td></tr></table></figure><br>è§£å†³æ–¹å¼ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ldconfig /usr/local/cuda-10.0/lib64</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹screençš„ä½¿ç”¨</title>
    <url>/2020/03/05/Ubuntu%E4%B8%8Bscreen%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ç³»ç»Ÿç®¡ç†å‘˜ç»å¸¸éœ€è¦SSHæˆ–è€…telentè¿œç¨‹ç™»å½•åˆ°linuxæœåŠ¡å™¨ï¼Œç»å¸¸è¿è¡Œä¸€äº›éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ç³»ç»Ÿå¤‡ä»½ã€ftp ä¼ è¾“ç­‰ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯ä¸ºæ¯ä¸€ä¸ªè¿™æ ·çš„ä»»åŠ¡å¼€ä¸€ä¸ªè¿œç¨‹ç»ˆç«¯çª—å£ï¼Œå› ä¸ºå®ƒä»¬æ‰§è¡Œçš„æ—¶é—´å¤ªé•¿äº†ã€‚å¿…é¡»ç­‰å¾…å®ƒä»¬æ‰§è¡Œå®Œæ¯•ï¼Œåœ¨æ­¤æœŸé—´ä¸èƒ½å…³æ‰çª—å£æˆ–è€…æ–­å¼€è¿æ¥ï¼Œå¦åˆ™è¿™ä¸ªä»»åŠ¡å°±ä¼šè¢«æ€æ‰ï¼Œä¸€åˆ‡åŠé€”è€ŒåºŸäº†ã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>GNU Screenæ˜¯ä¸€æ¬¾ç”±GNUè®¡åˆ’å¼€å‘çš„ç”¨äºå‘½ä»¤è¡Œç»ˆç«¯åˆ‡æ¢çš„è‡ªç”±è½¯ä»¶ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥è½¯ä»¶åŒæ—¶è¿æ¥å¤šä¸ªæœ¬åœ°æˆ–è¿œç¨‹çš„å‘½ä»¤è¡Œä¼šè¯ï¼Œå¹¶åœ¨å…¶é—´è‡ªç”±åˆ‡æ¢ã€‚</p>
<p>GNU Screenå¯ä»¥çœ‹ä½œæ˜¯çª—å£ç®¡ç†å™¨çš„å‘½ä»¤è¡Œç•Œé¢ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†ç»Ÿä¸€çš„ç®¡ç†å¤šä¸ªä¼šè¯çš„ç•Œé¢å’Œç›¸åº”çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨screenå‘½ä»¤ï¼Œæ¥è®©ä¿è¯é€€å‡ºsshä¹‹åç¨‹åºç»§ç»­åœ¨åå°è·‘ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆå¯ä»¥å…ˆæŸ¥çœ‹æ˜¯å¦å®‰è£…screenï¼Œé€šè¿‡å‘½ä»¤<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">screen -ls</span><br></pre></td></tr></table></figure><br>è‹¥å‡ºç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The program &#x27;screen&#x27; is currently not installed. You can install it by typing:</span><br><span class="line">sudo apt install screen</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜å°šæœªå®‰è£…ï¼ŒæŒ‰ç…§æç¤ºï¼Œé€šè¿‡å‘½ä»¤ï¼Œå®‰è£…screenï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install screen</span><br></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ul>
<li><p>æ–°å»ºçª—å£<br>1ï¼‰å¯ç›´æ¥é€šè¿‡å‘½ä»¤<code>screen</code>æ–°å»ºä¸€ä¸ªçª—å£ï¼Œå¹¶è¿›å…¥çª—å£ã€‚ä½†é€šè¿‡è¿™ç§æ–¹å¼æ–°å»ºçš„çª—å£æ²¡æœ‰åå­—ï¼Œåªæœ‰ç³»ç»Ÿåˆ†é…ç»™å®ƒçš„ä¸€ä¸ªidã€‚å½“éœ€è¦æ¢å¤çª—å£æ—¶ï¼Œåªèƒ½é€šè¿‡idå·æ¥æ¢å¤ã€‚<br>2ï¼‰é€šè¿‡å‘½ä»¤<code>screen -S name</code>ï¼Œè¿™æ ·å°±å¯ä»¥æ–°å»ºä¸€ä¸ªåå­—ä¸ºnameçš„çª—å£ï¼ŒåŒæ ·ç³»ç»Ÿä¹Ÿä¼šåˆ†é…ç»™å®ƒä¸€ä¸ªidï¼Œå½“æ¢å¤è¯¥çª—å£æ—¶æ—¢å¯ä»¥é€šè¿‡idå·ä¹Ÿå¯ä»¥é€šè¿‡çª—å£åã€‚</p>
</li>
<li><p>åˆ†ç¦»ä¼šè¯<br>é€€å‡ºå½“å‰æ–°å»ºçš„çª—å£ï¼Œé€šè¿‡å¿«é”®é”®Ctrl+a+då®ç°åˆ†ç¦»ï¼Œæ­¤æ—¶çª—å£ä¼šè·³å‡º[detached]çš„æç¤ºï¼Œå¹¶å›åˆ°ä¸»çª—å£ã€‚</p>
</li>
<li><p>æ¢å¤ä¼šè¯çª—å£<br>é¦–å…ˆæŸ¥çœ‹å½“å‰æœ‰å“ªäº›screençª—å£ï¼Œé€šè¿‡å‘½ä»¤ï¼š<br><code>screen -ls</code> å°†åˆ—å‡ºçª—å£åˆ—è¡¨<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/screen/787798-20181026175344791-956631152.png" alt></p>
<p>ç”±ä»¥ä¸Šå¯çŸ¥ï¼Œå½“å‰æœ‰ä¸¤ä¸ªçª—å£ï¼Œå…¶ä¸­testçª—å£å·²ç»è¢«æ€æ­»ï¼Œtest2çª—å£åˆ†ç¦»ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¢å¤test2çª—å£ï¼š<code>screen -r test2</code> æˆ– <code>screen -r 27582</code>è¿™æ ·å°±è¿”å›äº†test2çª—å£</p>
</li>
<li><p>æ€æ­»ä¼šè¯çª—å£<br>é€šè¿‡å‘½ä»¤<code>kill -9 threadnum</code><br>æ³¨æ„æ­¤å¤„åªèƒ½é€šè¿‡idå·æ¥æ€æ­»çª—å£ã€‚</p>
</li>
<li><p>æ¸…é™¤æ­»å»çª—å£<br>é€šè¿‡å‘½ä»¤<code>screen -wipe</code><br>è¿™ä¸ªå‘½ä»¤å°†è‡ªåŠ¨æ¸…é™¤æ‰€æœ‰å¤„äºdeadçŠ¶æ€çš„çª—å£</p>
</li>
</ul>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10å’ŒUbuntuåŒç³»ç»Ÿä¸‹æ—¶é—´ä¸å¯¹é—®é¢˜</title>
    <url>/2020/01/19/Win10%E5%92%8CUbuntu%E5%8F%8C%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%97%B6%E9%97%B4%E4%B8%8D%E5%AF%B9%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>ç”µè„‘å®‰è£…å®Œwin10å’ŒUbuntuåŒç³»ç»Ÿåï¼ŒUbuntuæ—¶é—´æ€»ä¼šå’ŒWindowsæ—¶é—´ç›¸å·®8å°æ—¶ï¼Œè¿™æ˜¯å› ä¸ºwindowsè®¤ä¸ºbiosæ—¶é—´æ˜¯æœ¬åœ°æ—¶é—´ï¼ŒUbuntuè®¤ä¸ºbiosæ—¶é—´æ˜¯UTCæ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Ubuntuæ—¶é—´æ”¹æˆæœ¬åœ°æ—¶é—´ã€‚</p>
<p>æ‰§è¡Œè¿™æ¡è¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">timedatectl set-local-rtc 1 --adjust-system-clock</span><br></pre></td></tr></table></figure>
<p>é‡å¯è¿›å…¥windowsï¼Œæ—¶é—´è®¾ç½®ä¸­ç‚¹å‡»ç«‹å³åŒæ­¥å³å¯è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowsä¸‹VSCodeä½¿ç”¨SSHè¿æ¥æŠ¥Bad owner or permissions on C:\\Users\\Administrator/.ssh/configé”™è¯¯é—®é¢˜è§£å†³</title>
    <url>/2020/02/25/Windows%E4%B8%8BVSCode%E4%BD%BF%E7%94%A8SSH%E8%BF%9E%E6%8E%A5%E6%8A%A5Bad-owner-or-permissions-on-CUsersAdministrator.sshconfig%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ Windows ç³»ç»Ÿä¸‹çš„ VSCode å®‰è£… <strong>Remote - SSH</strong> æ‰©å±•åï¼Œä½¿ç”¨æ‰©å±•é…ç½® SSH å¹¶è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œå¯èƒ½ä¼šå‘ç”Ÿ <strong>Bad owner or permissions on C:\Users\Administrator/.ssh/config</strong> é”™è¯¯ï¼Œé€ æˆæ— æ³•è¿›è¡Œ SSH è¿œç¨‹è¿æ¥çš„é—®é¢˜ã€‚</p>
<p>åŸå› æ˜¯ç”±äºä½¿ç”¨ <strong>Remote - SSH</strong> æ‰©å±•æ‰€ä¾èµ–çš„ <strong>Remote - SSH: Editing Configuration Files</strong> æ‰©å±•ç¼–è¾‘äº† <strong>C:\Users\Administrator.ssh\config</strong> æ–‡ä»¶åï¼Œæ­¤æ–‡ä»¶çš„æƒé™å‘ç”Ÿäº†æ”¹å˜ï¼š<br> <img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode ssh/image-2fd80730.png.jfif" alt></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¼–è¾‘äº† <strong>%USER_HOME%.ssh\config</strong> æ–‡ä»¶åï¼Œä¸ä½†åœ¨ VSCode ä¸­ç”±äºé…ç½®æ–‡ä»¶æƒé™é—®é¢˜è€Œæ— æ³•è¿›è¡Œ SSH è¿œç¨‹è¿æ¥ï¼Œå°±è¿ä½¿ç”¨ç³»ç»Ÿçš„ <strong>PowerShell</strong> è¿›è¡Œ SSH è¿æ¥æ—¶ä¹Ÿä¼šæŠ¥æ­¤é”™è¯¯ï¼Œè€ŒæŠŠæ­¤é…ç½®æ–‡ä»¶åˆ é™¤åï¼Œä½¿ç”¨  <strong>PowerShell</strong> å³å¯æ­£å¸¸è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚ä½† VSCode çš„ SSH è¿æ¥åˆä¾èµ–æ­¤é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†å†²çªï¼Œè¦ä¹ˆåªæœ‰ <strong>PowerShell</strong> èƒ½ç”¨ï¼Œè¦ä¹ˆå°±éƒ½ä¸èƒ½ç”¨ã€‚</p>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><ol>
<li><p>åœ¨ GitHub ä¸Šä¸‹è½½ <a href="https://github.com/PowerShell/openssh-portable"><strong>openssh-portable</strong></a> é¡¹ç›®ï¼Œå…¶ Git å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/PowerShell/openssh-portable.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½å®Œæˆåè¿›å…¥ <strong>openssh-portable</strong> é¡¹ç›®ä¸­çš„ <a href="https://github.com/PowerShell/openssh-portable/tree/latestw_all/contrib/win32/openssh"><code>contrib\win32\openssh</code></a> ç›®å½•ï¼Œåœ¨æ­¤ç›®å½•ä¸­æ‰“å¼€ PowerShell å‘½ä»¤è¡Œï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.\FixUserFilePermissions.ps1 -Confirm:$false</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ‰§è¡Œæ­¤å‘½ä»¤æ—¶è‹¥æç¤ºé”™è¯¯ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ— æ³•åŠ è½½æ–‡ä»¶ FixUserFil ePermissions.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬</span><br></pre></td></tr></table></figure>
<p>åˆ™å…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-ExecutionPolicy RemoteSigned</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¾“å…¥ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Y</span><br></pre></td></tr></table></figure>
<p> å›è½¦ç¡®è®¤åå†é‡æ–°æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åå¯ä»¥å†æ‰§è¡Œ<code>Set-ExecutionPolicy RemoteSigned</code>è¾“å…¥ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">N</span><br></pre></td></tr></table></figure>
<p> æ¢å¤é»˜è®¤é…ç½®</p>
</li>
</ul>
</li>
<li><p>æ“ä½œå®Œæˆåï¼Œåœ¨ VSCode ä¸­ç¼–è¾‘ <strong>C:\Users\Administrator.ssh\config</strong> æ–‡ä»¶å°†ä¸ä¼šå½±å“æ­¤æ–‡ä»¶çš„æƒé™ï¼Œåœ¨ VSCode å’Œ PowerShell ä¸­å‡å¯æ­£å¸¸è¿›è¡Œ SSH è¿œç¨‹è¿æ¥ï¼š</p>
<ul>
<li><p>åœ¨ VSCode ä¸­é€šè¿‡ Remote - SSH è¿›è¡Œ SSH è¿œç¨‹è¿æ¥ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode ssh/image-c923ced8.png" alt></p>
</li>
<li><p>åœ¨ PowerShell ä¸­è¿›è¡Œ SSH è¿œç¨‹è¿æ¥ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode ssh/93310FA6D4F64FA7BF7BEBE7357A79E6-cf86116a.jpeg" alt></p>
</li>
</ul>
</li>
</ol>
<h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>åœ¨å…¶ä»–ä½ç½®å»ºå¥½configæ–‡ä»¶ï¼Œå¹¶åœ¨æ’ä»¶è®¾ç½®ä¸­æ·»åŠ è·¯å¾„å³å¯</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode ssh/20200212142410779.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨VS Code+SSHè¿›è¡Œè¿œç¨‹å¼€å‘</title>
    <url>/2020/02/14/%E4%BD%BF%E7%94%A8VS-Code+SSH%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘"></a>ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹å¼€å‘</h2><p>åœ¨è¿›è¡ŒLinuxå¼€å‘çš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸åœ¨Windowsä¸Šä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ç¼–è¾‘ä»£ç ï¼Œäº¤å‰ç¼–è¯‘å·¥å…·åœ¨Linuxè™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨ä¸Šï¼Œåœ¨å¼€å‘æœŸé—´éœ€è¦ä¸åœçš„è¿›è¡Œå¦‚ä¸‹çš„å¾ªç¯æ“ä½œï¼š</p>
<ul>
<li>ç¼–è¾‘å¥½ä»£ç ï¼Œä½¿ç”¨<strong>åŸºäºSSHçš„ftp</strong>å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</li>
<li><strong>ä½¿ç”¨SSHè¿œç¨‹ç»ˆç«¯</strong>ï¼Œåœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>ç¼–è¯‘å®Œæˆåä½¿ç”¨<strong>åŸºäºSSHçš„ftp</strong>å°†æ–‡ä»¶ä¼ å›åˆ°æœ¬åœ°</li>
</ul>
<p>è¿™äº›æ“ä½œéƒ½æ˜¯åŸºäºSSHçš„ï¼Œä½†æ˜¯éœ€è¦ç»ˆç«¯è½¯ä»¶ï¼Œæ–‡ä»¶ä¼ è¾“è½¯ä»¶ï¼Œ å¹¶ä¸”ä¸åœåœ°åˆ‡æ¢æ“ä½œï¼Œè¿‡ç¨‹å¾ˆéº»çƒ¦ã€‚</p>
<p>å¦‚æœ<strong>æœ¬åœ°çš„ç¼–è¾‘å™¨å¯ä»¥ç›´æ¥é€šè¿‡SSHæ‰“å¼€è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ï¼Œæ“ä½œæ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤</strong>ï¼Œè¿™å°±ç§°ä¹‹ä¸ºè¿œç¨‹å¼€å‘ï¼Œä½¿ç”¨è¿œç¨‹å¼€å‘å¯ä»¥å¤§å¤§æ–¹ä¾¿æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ã€‚</p>
<h2 id="Visual-Studio-Code-Remote-SSHæ‰©å±•"><a href="#Visual-Studio-Code-Remote-SSHæ‰©å±•" class="headerlink" title="Visual Studio Code Remote - SSHæ‰©å±•"></a>Visual Studio Code Remote - SSHæ‰©å±•</h2><p>Remote Development extension packæ˜¯VS Codeåœ¨ä»Šå¹´5æœˆä»½å‘å¸ƒçš„æ‰©å±•ï¼Œè¯¥æ‰©å±•åŒ…æ‹¬ä¸‰ä¸ªæ‰©å±•ï¼š</p>
<ul>
<li>Remote - SSH</li>
<li>Remote - Containers</li>
<li>Remote - WSL</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ‰©å±•åˆ†åˆ«æ”¯æŒå°†è¿œç¨‹è®¡ç®—æœºï¼Œå®¹å™¨ï¼Œæˆ–Windowså­ç³»ç»ŸLinuxï¼ˆWSLï¼‰ç”¨ä½œåŠŸèƒ½é½å…¨çš„åå°å¼€å‘ç¯å¢ƒï¼Œæœ¬åœ°çš„VS Codeåªæ˜¯ä¸€ä¸ªå‰ç«¯çš„ç•Œé¢ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨SSHæ‰©å±•ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522113131209.png" alt></p>
<h2 id="ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤"><a href="#ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤" class="headerlink" title="ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤"></a>ç¡®ä¿åœ¨å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨sshå‘½ä»¤</h2><ul>
<li>å¦‚æœä½¿ç”¨çš„ç³»ç»Ÿæ˜¯<code>Windows10</code>ï¼Œç³»ç»Ÿä¸­å·²ç»è‡ªå¸¦äº†<code>SSH</code>ï¼Œ<strong>ä¸èƒ½å†ä½¿ç”¨Gitçš„ssh</strong>ï¼šå¦‚å›¾ï¼š</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190630104856278.png" alt></p>
<ul>
<li>å¦‚æœä½¿ç”¨çš„ç³»ç»Ÿæ˜¯<code>Windows7</code>ï¼Œ<strong>ä¸èƒ½å®‰è£…OpenSSH</strong>ï¼Œåªèƒ½ä½¿ç”¨Gitä¸­çš„sshå‘½ä»¤ï¼Œå°†Gitå®‰è£…ç›®å½•ä¸­çš„<code>usr\bin</code>æ–‡ä»¶å¤¹æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œè¯¥ç›®å½•ä¸‹åŒ…å«sshå‘½ä»¤çš„å¯æ‰§è¡Œç¨‹åºï¼›</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522115459170.png" alt></p>
<h2 id="å®‰è£…SSHæ‰©å±•"><a href="#å®‰è£…SSHæ‰©å±•" class="headerlink" title="å®‰è£…SSHæ‰©å±•"></a>å®‰è£…SSHæ‰©å±•</h2><p>åœ¨VS  Codeæ‰©å±•å¸‚åœºæœç´¢<code>remote</code>ï¼Œé€‰æ‹©<code>Remote-SSH</code>ï¼Œç‚¹å‡»å®‰è£…ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522114027910.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522114100203.png" alt></p>
<h2 id="è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨"><a href="#è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨" class="headerlink" title="è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨"></a>è¿œç¨‹ä¸»æœºå®‰è£…SSHæœåŠ¡å™¨</h2><p>ç‰¹åˆ«æ³¨æ„ï¼š<strong>SSHæ‰©å±•åªèƒ½è¿æ¥64ä½çš„Linuxæ“ä½œç³»ç»Ÿã€‚</strong><br>åœ¨è¿œç¨‹Linuxä¸»æœºä¸Šå®‰è£…sshæœåŠ¡å™¨ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure></p>
<h2 id="è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯"><a href="#è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯" class="headerlink" title="è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯"></a>è®¾ç½®SSHæ‰©å±•æ˜¾ç¤ºç™»å½•ç»ˆç«¯</h2><p>æ‰“å¼€å‘½ä»¤é¢æ¿<code>ctrl+shift+p</code>ï¼Œè¾“å…¥<code>ssh</code>ï¼Œé€‰æ‹©è®¾ç½®ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523120834360.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523120925461.png" alt></p>
<h2 id="å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº"><a href="#å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº" class="headerlink" title="å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº"></a>å¯åŠ¨SSHè¿æ¥è¿œç¨‹ä¸»æœº</h2><p>SSHå¯åŠ¨çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>Ctrl+Shift+P</code>æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥<code>ssh</code>ï¼Œé€‰æ‹©<code>Connect to Host</code>ï¼š</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522120252523.png" alt></p>
<ul>
<li><p>ç›´æ¥ç‚¹å‡»å·¦ä¸‹è§’çš„sshå›¾æ ‡ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190522120345995.png" alt></p>
</li>
</ul>
<p>å¯åŠ¨ä¹‹åè¾“å…¥è¿œç¨‹ä¸»æœºçš„<code>ç”¨æˆ·å@ipåœ°å€</code>ï¼ŒæŒ‰å›è½¦è¿›è¡Œè¿æ¥ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523121056234.png" alt></p>
<p>ä¼šæ˜¾ç¤ºå‡ºSSHç™»å½•ç»ˆç«¯ï¼Œè¾“å…¥ç”¨æˆ·çš„å¯†ç å³å¯ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523115727683.png" alt></p>
<p>é¦–æ¬¡ç™»å½•åï¼ŒVS Codeä¼šè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªæ–°çš„çª—å£ç”¨äºè¿œç¨‹å·¥ä½œï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åœ¨è¿œç¨‹ä¸»æœºä¸Šå®‰è£…VS Code serverï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523115814332.png" alt></p>
<p>ç™»å½•æˆåŠŸåå¦‚å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523122154883.png" alt></p>
<h2 id="æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº"><a href="#æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº" class="headerlink" title="æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº"></a>æ‰“å¼€è¿œç¨‹ç›®å½•ä½œä¸ºå·¥ä½œåŒº</h2><p>ç‚¹å‡»æ–‡ä»¶è§†å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523122256594.png" alt></p>
<p>ç„¶åé€‰æ‹©è¦æ‰“å¼€çš„ç›®å½•ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523122341344.png" alt></p>
<p>æ‰“å¼€æˆåŠŸå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523122740634.png" alt></p>
<h2 id="ä½¿ç”¨è¿œç¨‹ç»ˆç«¯"><a href="#ä½¿ç”¨è¿œç¨‹ç»ˆç«¯" class="headerlink" title="ä½¿ç”¨è¿œç¨‹ç»ˆç«¯"></a>ä½¿ç”¨è¿œç¨‹ç»ˆç«¯</h2><p><strong>ç›´æ¥ç‚¹å‡»æ–°å»ºç»ˆç«¯å³å¯æ‰“å¼€Bash</strong>ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523122927502.png" alt></p>
<h2 id="å®‰è£…æ‰©å±•"><a href="#å®‰è£…æ‰©å±•" class="headerlink" title="å®‰è£…æ‰©å±•"></a>å®‰è£…æ‰©å±•</h2><p>æ³¨æ„ï¼Œåœ¨è¿œç¨‹å¼€å‘çš„æ—¶å€™æ‰©å±•åˆ†ä¸ºæœ¬åœ°æ‰©å±•å’Œè¿œç¨‹æ‰©å±•ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190523123334817.png" alt></p>
<h2 id="è®°ä½å¸¸ç”¨ä¸»æœº"><a href="#è®°ä½å¸¸ç”¨ä¸»æœº" class="headerlink" title="è®°ä½å¸¸ç”¨ä¸»æœº"></a>è®°ä½å¸¸ç”¨ä¸»æœº</h2><p>å¦‚å›¾ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190524091244209.png" alt></p>
<p>é€‰æ‹© ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/2019052409132074.png" alt></p>
<p>æŒ‰å¦‚ä¸‹æ ¼å¼å¡«å†™å†…å®¹ï¼Œä¿å­˜ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190524091455578.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/vscode%20ssh/20190524091601192.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>C++</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>windowså’ŒubuntuåŒç³»ç»Ÿä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹</title>
    <url>/2020/03/08/windows%E5%92%8Cubuntu%E5%8F%8C%E7%B3%BB%E7%BB%9F%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E9%A1%B9/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>å®‰è£…å®Œubuntuç³»ç»Ÿåï¼Œæ‰“å¼€ç”µè„‘åˆ°é€‰æ‹©ç³»ç»Ÿçš„ç•Œé¢æˆ‘ä»¬å‘ç°é»˜è®¤çš„æ˜¯ubuntuç³»ç»Ÿï¼Œå¦‚æœä½ æ˜¯ç»å¸¸è¦è¿›å…¥windowsç³»ç»Ÿçš„ï¼Œä½ æ‰‹åŠ¨é€‰æ‹©ç¬¬ä¸‰ä¸ªwindowså¯åŠ¨é¡¹å°±è¡Œï¼Œä½†æ˜¯ï¼Œå‡è®¾ä½ æŒ‰äº†ç”µæºé”®ä¹‹åå°±å»æå…¶ä»–äº‹æƒ…äº†ï¼Œé‚£é»˜è®¤å°±è¿›å…¥ubuntuç³»ç»Ÿäº†ï¼Œè¿™ä¸ªæ—¶å€™ä½ è¿˜è¦å†å…³æœºé‡å¼€æˆ–è€…é‡å¯ï¼Œéå¸¸éº»çƒ¦ï¼›æˆ–è€…ä½ è·Ÿæˆ‘ä¸€æ ·æ˜¯ä¸ªå¼ºè¿«ç—‡ï¼Œä¸ç®¡æ€ä¹ˆæ ·éƒ½è¦è®©å®ƒé»˜è®¤windowsç³»ç»Ÿï¼Œä¸‹é¢å°±æ•™ä½ æ€ä¹ˆåšã€‚</p>
<h2 id="æ›´æ”¹-etc-default-grubæ–‡ä»¶ï¼š"><a href="#æ›´æ”¹-etc-default-grubæ–‡ä»¶ï¼š" class="headerlink" title="æ›´æ”¹/etc/default/grubæ–‡ä»¶ï¼š"></a>æ›´æ”¹/etc/default/grubæ–‡ä»¶ï¼š</h2><p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/default/grub</span><br></pre></td></tr></table></figure><br>å›è½¦ï¼Œå³å¯æ‰“å¼€æ–‡ä»¶ï¼Œå¦‚å›¾ï¼Œé¼ æ ‡æ‰€ç¤ºä½ç½®å³ä¸ºé»˜è®¤ä¼˜å…ˆå¯åŠ¨é¡¹çš„åºå·ï¼Œubuntuä¸º0ï¼Œwindowsä¸º2ï¼Œé»˜è®¤æ˜¯0ï¼Œæ”¹ä¸º2å³å¯è®¾ç½®ä¼˜å…ˆå¯åŠ¨é¡¹ä¸ºwindowsï¼ˆå¦‚æœåœ¨ä¿®æ”¹æ–‡ä»¶å†…å®¹çš„æ—¶å€™å› ä¸ºæ˜¯åªè¯»æ–‡ä»¶éœ€è¦æƒé™æ‰èƒ½ä¿®æ”¹ï¼Œç»ˆç«¯è¾“å…¥ï¼š<code>sudo chmod +x /etc/default/grub</code>å›è½¦å³å¯ï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/boot/1628751-20190421140348008-170002217.png" alt></p>
<p>ä»¥ä¸Šï¼Œæ›´æ”¹é»˜è®¤å¯åŠ¨é¡¹çš„ç›®æ ‡å®Œæˆï¼Œä¸‹é¢å†<strong>æ‹“å±•ä¸€ç‚¹ä¸œè¥¿</strong>ï¼š</p>
<p>å¦‚å›¾å…‰æ ‡å¤„ä¸ºå¯åŠ¨ç•Œé¢ç­‰å¾…é€‰æ‹©çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º10,å¯æ”¹å°ä¸€ç‚¹ï¼Œæ¯”å¦‚8ï¼Œå•ä½æ˜¯ç§’</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/boot/1628751-20190421140829066-310267031.png" alt></p>
<p>ä¿®æ”¹å¥½ä¹‹åç‚¹ä¿å­˜ï¼Œå‘½ä»¤è¡Œè¾“å…¥ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><br>å›è½¦ï¼Œå®Œæˆã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 16.04ä¸‹é…ç½®GPUç‰ˆCUDAå’ŒcuDNN</title>
    <url>/2019/12/14/Ubuntu-16.04%E4%B8%8B%E9%85%8D%E7%BD%AEGPU%E7%89%88CUDA%E5%92%8CcuDNN/</url>
    <content><![CDATA[<p>å…ˆä»‹ç»ä¸‹æˆ‘è‡ªå·±é…ç½®çš„ç¯å¢ƒ</p>
<ul>
<li>Ubuntu 16.04</li>
<li>GTX2080tiæ˜¾å¡</li>
<li>NVIDIA 418.3</li>
<li>CUDA 10.0</li>
<li>cuDNN 7.6.2</li>
</ul>
<p>ä»¥ä¸‹æ•™ç¨‹é’ˆå¯¹ä»é›¶å¼€å§‹çš„ç”¨æˆ·ï¼Œè‹¥ç³»ç»Ÿä¸­å·²è£…æœ‰CUDAå’ŒcuDNNï¼Œå´åœ¨å½“å‰ç”¨æˆ·ä¸‹æ— æ³•ä½¿ç”¨ï¼Œè¯·<a href="#æ·»åŠ ç¯å¢ƒå˜é‡">æ·»åŠ ç¯å¢ƒå˜é‡</a></p>
<h2 id="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"><a href="#å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨" class="headerlink" title="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"></a>å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨</h2><p>1.å…ˆåœ¨<a href="https://www.nvidia.cn/Download/index.aspx?lang=cn">NVIDIAå®˜ç½‘</a>ä¸Šä¸‹è½½å¯¹åº”çš„é©±åŠ¨ç¨‹åºï¼Œå¯æ ¹æ®è‡ªå·±çš„GPUçš„å‹å·ä¸‹è½½ç›¸åº”çš„.runæ–‡ä»¶<br>ä¾‹å¦‚NVIDIA-Linux-x86_64-3xx.xx.runå½¢å¼çš„æ–‡ä»¶å</p>
<p>2.ç¦ç”¨å¼€æºnouveaué©±åŠ¨<strong>ï¼ˆéå¸¸é‡è¦ï¼‰</strong><br>Ubuntuç³»ç»Ÿé›†æˆçš„æ˜¾å¡é©±åŠ¨ç¨‹åºæ˜¯nouveauï¼Œå®ƒæ˜¯ç¬¬ä¸‰æ–¹ä¸ºNVIDIAå¼€å‘çš„å¼€æºé©±åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å…¶å±è”½æ‰èƒ½å®‰è£…NVIDIAå®˜æ–¹é©±åŠ¨ã€‚<br>å°†é©±åŠ¨æ·»åŠ åˆ°é»‘åå•blacklist.confä¸­ï¼Œä½†æ˜¯ç”±äºè¯¥æ–‡ä»¶çš„å±æ€§ä¸å…è®¸ä¿®æ”¹ã€‚æ‰€ä»¥éœ€è¦å…ˆä¿®æ”¹æ–‡ä»¶å±æ€§ã€‚<br>æŸ¥çœ‹å±æ€§<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ls -lh /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><br>ä¿®æ”¹å±æ€§<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod 666 /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><br>ç”¨geditç¼–è¾‘å™¨æ‰“å¼€<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><br>åœ¨è¯¥æ–‡ä»¶åæ·»åŠ ä¸€ä¸‹å‡ è¡Œï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">blacklist vga16fb</span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist rivafb</span><br><span class="line">blacklist rivatv</span><br><span class="line">blacklist nvidiafb</span><br></pre></td></tr></table></figure><br>3.å¼€å§‹å®‰è£…<br>å…ˆæŒ‰Ctrl + Alt + F1åˆ°æ§åˆ¶å°ï¼Œå…³é—­å½“å‰å›¾å½¢ç¯å¢ƒ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service lightdm stop</span><br></pre></td></tr></table></figure><br>å†å®‰è£…é©±åŠ¨ç¨‹åº<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod a+x NVIDIA-Linux-x86_64-xxx.run</span><br><span class="line">sudo ./NVIDIA-Linux-x86_64-xxx.run -no-x-check -no-nouveau-check -no-opengl-files</span><br></pre></td></tr></table></figure><br>æœ€åé‡æ–°å¯åŠ¨å›¾å½¢ç¯å¢ƒ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service lightdm start</span><br></pre></td></tr></table></figure><br>åœ¨ç»ˆç«¯é‡Œè¾“å…¥ï¼šnvidia-smi ï¼Œè¾“å‡ºä»¥ä¸‹å›¾ç‰‡çš„ä»£ç åˆ™å®‰è£…æˆåŠŸ<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CUDA%26cuDNN/2019051413224071.png" alt></p>
<h2 id="cuda-10-0å®‰è£…"><a href="#cuda-10-0å®‰è£…" class="headerlink" title="cuda 10.0å®‰è£…"></a>cuda 10.0å®‰è£…</h2><p><a href="https://developer.nvidia.com/cuda-toolkit-archive">å®˜æ–¹ä¸‹è½½</a><br><a href="https://pan.baidu.com/s/1piTbzIIL3wTx1dCeUDDiOw">ç½‘ç›˜ä¸‹è½½</a> æå–ç : aarn<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod a+x cuda_10.0.130_410.48_linux.run // è·å–æƒé™</span><br><span class="line">sudo sh cuda_10.0.130_410.48_linux.run --tmpdir=/home/max/temp</span><br></pre></td></tr></table></figure><br>è¿™é‡ŒåŠ  â€”tmpdir ä¸»è¦æ˜¯ç›´æ¥è¿è¡Œåï¼Œä¼šæç¤ºç©ºé—´ä¸è¶³çš„é—®é¢˜<br>æ¥ä¸‹æ¥è¿›å…¥è‹±æ–‡é€‰æ‹©ç•Œé¢æŒ‰ä½ç©ºæ ¼é”®å¯ä»¥å¿«é€Ÿæµè§ˆ<br>åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€‰é¡¹é€‰æ‹©ï¼š<br>accept #åŒæ„å®‰è£…<br>n #ä¸å®‰è£…Driverï¼Œå› ä¸ºå·²å®‰è£…é©±åŠ¨<strong>ï¼ˆè¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼‰</strong><br>y #å®‰è£…CUDA Toolkit</p>
<h1 id="å®‰è£…åˆ°é»˜è®¤ç›®å½•"><a href="#å®‰è£…åˆ°é»˜è®¤ç›®å½•" class="headerlink" title="å®‰è£…åˆ°é»˜è®¤ç›®å½•"></a>å®‰è£…åˆ°é»˜è®¤ç›®å½•</h1><p>y #åˆ›å»ºå®‰è£…ç›®å½•çš„è½¯é“¾æ¥<br>n #ä¸å¤åˆ¶Samplesï¼Œå› ä¸ºåœ¨å®‰è£…ç›®å½•ä¸‹æœ‰/samples</p>
<h2 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h2><p>homeæ–‡ä»¶ä¸‹ ctrl+Hæ˜¾ç¤ºéšè—æ–‡ä»¶ æ‰“å¼€ .bashrcæ–‡ä»¶åœ¨æœ€åæ·»åŠ <br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export PATH=/usr/local/cuda-10.0/bin$&#123;PATH:+:$&#123;PATH&#125;&#125;</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib64$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;&#125;</span><br></pre></td></tr></table></figure><br>ç»ˆç«¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¿å­˜æ“ä½œ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure><br>æ£€æŸ¥cudaæ˜¯å¦å®‰è£…æˆåŠŸ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nvcc -V</span><br><span class="line">nvcc --version</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CUDA%26cuDNN/20190514132130343.png" alt></p>
<h2 id="cuDnn-10-0å®‰è£…"><a href="#cuDnn-10-0å®‰è£…" class="headerlink" title="cuDnn 10.0å®‰è£…"></a>cuDnn 10.0å®‰è£…</h2><p><a href="https://developer.nvidia.com/rdp/cudnn-archive">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DdS0_A4QlZ_3Bhjw8LEC">ç½‘ç›˜ä¸‹è½½</a><br>æ³¨æ„ï¼šéœ€è·ŸCUDAç‰ˆæœ¬å¯¹åº”<br>åˆ‡æ¢åˆ°ä¸‹è½½ç›®å½•è¿›è¡Œè§£å‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo tar -zxvf ./cudnn-10.0-linux-x64-xxx.tgz </span><br></pre></td></tr></table></figure><br>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°cudaæ–‡ä»¶å¤¹ï¼Œåœ¨å½“å‰ç›®å½•æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo cp cuda/include/cudnn.h /usr/local/cuda/include/</span><br><span class="line"> </span><br><span class="line">sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/</span><br><span class="line"> </span><br><span class="line">sudo chmod a+r /usr/local/cuda/include/cudnn.h</span><br><span class="line"> </span><br><span class="line">sudo chmod a+r /usr/local/cuda/lib64/libcudnn*</span><br></pre></td></tr></table></figure><br>åœ¨ç»ˆç«¯è¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</span><br></pre></td></tr></table></figure><br>å¦‚æœå‡ºç°ä¸‹å›¾æ‰€ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CUDA%26cuDNN/20180815114007852.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Python</tag>
        <tag>CUDA</tag>
        <tag>cuDNN</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹virtualenvçš„ä½¿ç”¨ä¸pycharmçš„åŸºæœ¬é…ç½®</title>
    <url>/2019/12/13/Ubuntu%E4%B8%8Bvirtualenv%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8Epycharm%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å®‰è£…virtualenv"><a href="#å®‰è£…virtualenv" class="headerlink" title="å®‰è£…virtualenv"></a>å®‰è£…virtualenv</h2><p>virtualenvæ˜¯ Python å¤šç‰ˆæœ¬ç®¡ç†çš„åˆ©å™¨ï¼Œä¸åŒç‰ˆæœ¬çš„å¼€å‘è°ƒè¯•å…¨é å®ƒäº†ï¼ˆæ²¡æœ‰å¤šç‰ˆæœ¬å°½é‡ä¹Ÿè£…ä¸Šå§ï¼‰<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pip install virtualenv</span><br></pre></td></tr></table></figure></p>
<h2 id="åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ"><a href="#åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ"></a>åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒ</h2><p>ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">virtualenv + è·¯å¾„</span><br></pre></td></tr></table></figure><br>ä»¥è¿™ç§æ–¹å¼åˆ›å»ºç¯å¢ƒå°†ä¸åŒ…å«ç³»ç»Ÿçš„pythonåŒ…ï¼Œæ–°çš„ç¯å¢ƒé‡Œé¢åªæœ‰pipã€setuptoolså’Œwheelè¿™äº›åŒ…ï¼Œåˆ™è®¸å¤šåŒ…è¦ç”¨pipé‡æ–°å®‰è£…ã€‚</p>
<p>è‹¥éœ€æŒ‡å®špythonç‰ˆæœ¬ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">virtualenv â€“p python3 + è·¯å¾„</span><br></pre></td></tr></table></figure></p>
<h2 id="æ¿€æ´»virtualenvç¯å¢ƒ"><a href="#æ¿€æ´»virtualenvç¯å¢ƒ" class="headerlink" title="æ¿€æ´»virtualenvç¯å¢ƒ"></a>æ¿€æ´»virtualenvç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source è·¯å¾„/bin/activate</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç›´æ¥è¿›åˆ°æ‰€åˆ›ç¯å¢ƒçš„binç›®å½•ä¸­å³é”®ç»ˆç«¯ï¼Œè¿è¡Œsource activate<br>æ³¨æ„ï¼šæ¿€æ´»åªå¯¹å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼Œå¦‚æœæ–°æ‰“å¼€äº†ä¸€ä¸ªç»ˆç«¯çš„è¯ï¼Œé‡æ–°è¿è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚ æ¿€æ´»åç»ˆç«¯å‰é¢ä¼šå¤šä¸€ä¸ª(**)çš„ä¸œè¥¿ï¼Œæç¤ºå½“å‰virtualenvçš„åç§°ã€‚</p>
<p>æ¿€æ´»åå¯ä»¥åœ¨å½“å‰ç»ˆç«¯é€šè¿‡python æ–‡ä»¶å.pyçš„æ–¹å¼è¿è¡Œpythonè„šæœ¬ï¼Œå¦‚æœè„šæœ¬ä¸­ä½¿ç”¨äº†å½“å‰ç¯å¢ƒä¸­æ²¡æœ‰çš„åŒ…ï¼Œå°†ä¼šæŠ¥é”™ã€‚</p>
<p>å¯ä»¥åœ¨æ¿€æ´»ç¯å¢ƒåä½¿ç”¨pipå®‰è£…å¯¹åº”çš„åŒ…ã€‚<strong>æ³¨æ„ä¸è¦ä½¿ç”¨sudo</strong>ï¼Œå¦åˆ™åŒ…ä¼šå®‰è£…åˆ°ç³»ç»Ÿå½“ä¸­å»ï¼Œè€Œä¸æ˜¯å½“å‰çš„virtualenvç›®å½•ä¸­ã€‚</p>
<h2 id="é€€å‡ºvirtualenvç¯å¢ƒ"><a href="#é€€å‡ºvirtualenvç¯å¢ƒ" class="headerlink" title="é€€å‡ºvirtualenvç¯å¢ƒ"></a>é€€å‡ºvirtualenvç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ç›´æ¥å…³é—­å½“å‰ç»ˆç«¯ã€‚</p>
<h2 id="åˆ é™¤virtualenvç¯å¢ƒ"><a href="#åˆ é™¤virtualenvç¯å¢ƒ" class="headerlink" title="åˆ é™¤virtualenvç¯å¢ƒ"></a>åˆ é™¤virtualenvç¯å¢ƒ</h2><p>ç›´æ¥åˆ é™¤å¯¹åº”ç›®å½•å³å¯åˆ é™¤virtualenvç¯å¢ƒï¼Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿä»»ä½•å½±å“ï¼Œæ‰€ä»¥åœ¨virtualenvä¸­å¯ä»¥æ”¾å¿ƒæ“ä½œã€‚<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rm -rvf  + è·¯å¾„</span><br></pre></td></tr></table></figure><br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafafdaa2aca.webp" alt></p>
<h2 id="Pycharmé…ç½®"><a href="#Pycharmé…ç½®" class="headerlink" title="Pycharmé…ç½®"></a>Pycharmé…ç½®</h2><p>æ–°å»ºé¡¹ç›®<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb0d3811f2.webp" alt></p>
<ul>
<li><p>New environment using Virtualenv: å°†åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªvirtualenvç¯å¢ƒï¼Œç„¶åä½¿ç”¨å®ƒå½“ä½œå½“å‰é¡¹ç›®çš„pythonè§£é‡Šå™¨ï¼Œé»˜è®¤ä¸åŒ…å«ç³»ç»Ÿçš„pythonåŒ…ã€‚<br>ç›¸å½“äºï¼š virtualenv + è·¯å¾„</p>
</li>
<li><p>location:ä¸ºæ–°å»ºçš„ç¯å¢ƒçš„ä½ç½®ï¼Œé»˜è®¤ä¸ºå½“å‰å·¥ç¨‹ä¸‹çš„venvã€‚</p>
</li>
<li><p>Base interpreter:åŸºäºç³»ç»Ÿä¸­çš„pythonç‰ˆæœ¬ï¼Œæ–°å»ºçš„ç¯å¢ƒä¸­çš„pythonç‰ˆæœ¬ä¸æ­¤ä¸€è‡´ï¼Œå¯ä»¥é€‰æ‹©python2æˆ–è€…python3, å–å†³äºé¡¹ç›®çš„éœ€è¦ï¼Œç›¸å½“äºvirtualenv â€“p pythonç‰ˆæœ¬ +è·¯å¾„ã€‚<br>å‹¾é€‰Inherit global site-packagesï¼ŒåŒ…å«ç³»ç»Ÿçš„pythonåŒ…ï¼Œç›¸å½“äºï¼š virtualenv â€“system-site-packages + è·¯å¾„<br>å‹¾é€‰Make available to all projectsï¼Œä¸‹æ¬¡æ–°å»ºé¡¹ç›®çš„æ—¶å€™ä¼šåœ¨Existing interpreterä¸­æ‰¾åˆ°è¿™ä¸ªç¯å¢ƒï¼Œ å¯ä»¥é‡å¤ä½¿ç”¨è¿™ä¸ªç¯å¢ƒã€‚</p>
</li>
<li><p>Existing interpreterï¼šä½¿ç”¨å·²æœ‰çš„pythonç¯å¢ƒï¼Œç‚¹å‡»åä¼šå‡ºç°åé¢çš„è®¾ç½®ä¼šå‡ºç°è¿™ä¸ªç•Œé¢ï¼Œåˆ†åˆ«æ˜¯virtualenv, condaå’Œç³»ç»Ÿçš„pythonç¯å¢ƒã€‚å¯ä»¥é€‰æ‹©å·²æœ‰çš„virtualenvç¯å¢ƒï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„pythonè§£é‡Šå™¨ã€‚ Condaæ˜¯anaconda(ä¸€ä¸ªç§‘å­¦è®¡ç®—çš„pythonå‘è¡Œç‰ˆ)çš„åŒ…ç®¡ç†å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å»ºç«‹pythonç¯å¢ƒã€‚</p>
</li>
</ul>
<p>ä¼šå‘ç°ç”Ÿæˆçš„é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªå«venvçš„æ–‡ä»¶å¤¹ï¼Œå®ƒå®è´¨ä¸Šå’Œç›´æ¥ç”¨virtualenvåˆ›å»ºçš„ä¸€æ ·ã€‚<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb2bd99f29.webp" alt><br>å¯ä»¥ç”¨virtualenvçš„ç®¡ç†æ–¹æ³•ç®¡ç†å®ƒï¼Œæ¯”å¦‚å®‰è£…numpyï¼Œå®‰è£…ä¹‹åå¯ä»¥åœ¨pycharmæ­£å¸¸ä½¿ç”¨ã€‚ï¼ˆæ³¨æ„åœ¨virtualenvä¸­<strong>ä¸è¦ä½¿ç”¨sudo</strong>ï¼‰<br><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/virtualenv/5aafb2bdb011c.webp" alt><br>ä¹Ÿå¯ä»¥åœ¨pycharmä¸­ä½¿ç”¨ file-settings-project-project interpreterä¸­ç®¡ç†ç¯å¢ƒä¸­çš„pythonåŒ…ï¼Œå¯ä»¥å¯¹è¯¥ç¯å¢ƒä¸‹çš„pythonåŒ…è¿›è¡Œåˆ é™¤å’Œå®‰è£…ã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Python</tag>
        <tag>virtualenv</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows10å®‰è£…ubuntu16.04åŒç³»ç»Ÿæ•™ç¨‹</title>
    <url>/2020/01/19/Windows10%E5%AE%89%E8%A3%85ubuntu16.04%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>BIOSæ¨¡å¼æœ‰ä¼ ç»Ÿçš„MBRæ¨¡å¼å’Œæ–°å¼UEFIæ¨¡å¼ï¼Œè¿™å°†å¯¹å®‰è£…åŒç³»ç»Ÿçš„æ–¹æ³•äº§ç”Ÿç›´æ¥å½±å“ã€‚ç›®å‰æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ç”µè„‘éƒ½å±äºæ–°å¼UEFIæ¨¡å¼ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸€äº›è€æœºå­ä»ç„¶å±äºä¼ ç»ŸMBRæ¨¡å¼ã€‚æœ¬æ•™ç¨‹åªä»‹ç»æ–°å¼UEFIæ¨¡å¼ä¸‹çš„åŒç³»ç»Ÿå®‰è£…æ–¹æ³•ï¼Œå¦‚æœä½ çš„ç”µè„‘å±äºä¼ ç»ŸMBRæ¨¡å¼ï¼Œå¼ºçƒˆå»ºè®®ä½ é‡è£…windowsç³»ç»Ÿæ¥æ›´æ–°BIOSæ¨¡å¼åˆ°UEFIã€‚</p>
<h2 id="åˆ¶ä½œç³»ç»Ÿç›˜"><a href="#åˆ¶ä½œç³»ç»Ÿç›˜" class="headerlink" title="åˆ¶ä½œç³»ç»Ÿç›˜"></a>åˆ¶ä½œç³»ç»Ÿç›˜</h2><p>éœ€è¦å‡†å¤‡ä»¥ä¸‹å·¥å…·ï¼š<br>â‘ ubuntuç³»ç»Ÿé•œåƒ<br>â‘¡åˆ»å½•è½¯ä»¶ï¼Œæ¨èâ€è½¯ç¢Ÿé€šâ€ï¼Œä¼šæç¤ºæ³¨å†Œï¼Œé€‰æ‹©ç»§ç»­è¯•ç”¨å°±å¥½<br>â‘¢ä¸€ä¸ªå¤§äº 2G çš„ U ç›˜<br>1.å®‰è£…å¹¶æ‰“å¼€è½¯ç¢Ÿé€šï¼Œæ’ä¸Š U ç›˜ï¼Œå¹¶ä¸”æœ€å¥½å¤‡ä»½ä½ çš„ U ç›˜ï¼Œå› ä¸ºä¹‹åéœ€è¦æ ¼å¼åŒ–ï¼›<br>2.è¿›å…¥è½¯ç¢Ÿé€šï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œæµè§ˆåˆ°ä½ çš„ubuntué•œåƒæ‰€åœ¨çš„ç›®å½•ï¼Œé€‰æ‹©ubuntué•œåƒæ–‡ä»¶ï¼ŒåŒå‡»æ‰“å¼€ï¼Œå¦‚å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422030.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422031.jpg" alt><br>3.åœ¨è½¯ç¢Ÿé€šç•Œé¢èœå•æ é€‰æ‹©â€å¯åŠ¨â€ï¼Œé€‰æ‹©â€å†™å…¥ç¡¬ç›˜æ˜ åƒâ€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422032.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422033.jpg" alt><br>æ¥ä¸‹æ¥å¾ˆé‡è¦ï¼Œæ³¨æ„æ¬¡åºï¼š<br>1ï¼‰çœ‹ä½ çš„ç¡¬ç›˜é©±åŠ¨å™¨æ˜¯å¦å¯¹åº”çš„æ˜¯ä½ çš„ U ç›˜ï¼ˆå¿…é¡»æ˜¯ï¼‰ ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯ï¼›<br>2ï¼‰çœ‹æ˜ åƒæ–‡ä»¶æ˜¯å¦å¯¹åº”ä½ çš„ ubuntu é•œåƒï¼›<br>3ï¼‰å¦‚æœä¸Šè¿°å‡æ²¡æœ‰é”™è¯¯ï¼Œé€‰æ‹©æ ¼å¼åŒ–ï¼Œä¹‹åå°±ä¼šæ ¼å¼åŒ–ä½ çš„ U ç›˜ï¼›<br>4ï¼‰åœ¨ U ç›˜æ ¼å¼åŒ–å®Œæ¯•ä¹‹åï¼Œé€‰æ‹©å†™å…¥ï¼Œä¹‹åå°±æ˜¯æ…¢æ…¢ç­‰å¾…äº†ï¼Œç­‰å¾…å†™å…¥å®Œæ¯•ï¼›</p>
<h2 id="åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº"><a href="#åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº" class="headerlink" title="åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº"></a>åœ¨windowsä¸‹åˆ›å»ºç©ºç™½åˆ†åŒº</h2><p>è¯´æ˜ï¼šè¿™ä¸€æ­¥æ˜¯ä¸ºubuntuç³»ç»Ÿåˆ†é…ç©ºé—´ï¼Œå•ç¡¬ç›˜å’ŒåŒç¡¬ç›˜å­˜åœ¨ä¸€ç‚¹åŒºåˆ«ã€‚<br>1.â€æ­¤ç”µè„‘â€ç‚¹å‡»å³é”®ï¼Œç‚¹å‡»â€ç®¡ç†â€ï¼Œç‚¹å‡»â€ç£ç›˜ç®¡ç†â€ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422034.jpg" alt><br>2.ä¸ºubuntuåˆ†é…ç©ºé—´<br>ï¼ˆ1ï¼‰å¦‚æœæ˜¯å•ç¡¬ç›˜ï¼Œä»»é€‰ä¸€ä¸ªç›˜ï¼Œåœ¨è¯¥ç›˜ç‚¹å‡»å³é”®ï¼Œé€‰æ‹©å‹ç¼©å·ï¼Œå¦‚ä¸‹ï¼Œè¾“å…¥å‹ç¼©ç©ºé—´é‡ï¼Œå•ä½ä¸ºMï¼Œå¦‚æœç©ºé—´å……è¶³ï¼Œå»ºè®®åˆ†å‡º80Gæˆ–100Gï¼Œç©ºé—´ä¸è¶³ä¹Ÿå¯ä»¥åˆ†60Gï¼ˆ1G=1024Mï¼‰ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/20190520082545559.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422136.jpg" alt><br>ï¼ˆ2ï¼‰å¦‚æœæ˜¯åŒç¡¬ç›˜ï¼Œéœ€è¦å…ˆåœ¨ç³»ç»Ÿç›˜åˆ†å‡º200Mçš„ç©ºç™½åˆ†åŒºç”¨æ¥å®‰è£…ubuntuçš„å¯åŠ¨é¡¹ï¼Œç„¶åå†åœ¨å¦ä¸€å—ç¡¬ç›˜åˆ†å‡ºç©ºé—´ï¼Œåœ¨è¯¥ç›˜ç‚¹å‡»å³é”®ï¼Œé€‰æ‹©å‹ç¼©å·ï¼Œå¦‚ä¸‹ï¼Œè¾“å…¥å‹ç¼©ç©ºé—´é‡ï¼Œå•ä½ä¸ºM,å¦‚æœç©ºé—´å……è¶³ï¼Œå»ºè®®åˆ†å‡º80Gæˆ–100Gï¼Œç©ºé—´ä¸è¶³ä¹Ÿå¯ä»¥åˆ†60Gï¼ˆ1G=1024Mï¼‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422138.jpg" alt></p>
<h2 id="ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ"><a href="#ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ" class="headerlink" title="ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ"></a>ç”¨åšå¥½çš„ç³»ç»Ÿç›˜å®‰è£…ç³»ç»Ÿ</h2><p>å…ˆç‚¹å‡»æ¡Œé¢å³ä¸‹è§’ï¼šç”µæºå›¾æ ‡â†’ç”µæºè®¾ç½®â†’ç”µæºå’Œç¡çœ â†’å…¶ä»–ç”µæºè®¾ç½®â†’é€‰æ‹©ç”µæºæŒ‰é’®çš„åŠŸèƒ½â†’æ›´æ”¹å½“å‰ä¸å¯ç”¨çš„è®¾ç½®ï¼Œå°†â€œå…³æœºè®¾ç½®â€ä¸­çš„å¿«é€Ÿå¯åŠ¨é¡¹å…³é—­ï¼Œä¿å­˜ä¿®æ”¹ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/20190520084629381.png" alt>è‹¥å‘ˆç°è‰²ï¼Œæ— æ³•ä¿®æ”¹ï¼Œwin+rè¿›å…¥gpedit.mscå°†ç³»ç»Ÿé…ç½®ä¸­çš„å…³æœºé€‰é¡¹ï¼Œå¿«é€Ÿå¯åŠ¨æ”¹ä¸ºç¦ç”¨ï¼Œé‡å¯å®Œå³å¯æ›´æ”¹ã€‚<br>1.æ’å¥½ç³»ç»Ÿç›˜ï¼Œé‡å¯ç”µè„‘ï¼Œå¼€æœºè¿›biosï¼Œåœ¨Securityé¡µé¢ï¼Œå…³æ‰secure bootï¼ˆä¸åŒç”µè„‘secure bootå¯èƒ½åœ¨ä¸åŒä½ç½®ï¼‰ï¼Œç„¶ååˆ°Booté¡µé¢ï¼Œå¦‚æœæœ‰Fast Bootè¿™ä¸€é¡¹ï¼ˆéƒ¨åˆ†è”æƒ³ç”µè„‘æœ‰ï¼‰ï¼Œä¹ŸæŠŠå®ƒå…³æ‰ï¼Œæ²¡æœ‰å¿½ç•¥ï¼›ç„¶åä¿å­˜æ›´æ”¹ï¼Œåœ¨Booté¡µé¢ä¸‹æ–¹å¯åŠ¨é¡¹é€‰æ‹© USBå¯åŠ¨ï¼Œå›è½¦ï¼Œå¦‚æœé¡ºåˆ©è¿›å…¥å®‰è£…é¡µé¢ï¼Œç»§ç»­å¾€ä¸‹åšï¼›å¦‚æœç‚¹å‡»USBå¯åŠ¨é¡¹æ— æ³•è¿›å…¥ï¼Œä¿å­˜å¹¶é€€å‡ºï¼Œç”µè„‘ä¼šé‡å¯ï¼Œæ ¹æ®è‡ªå·±ç”µè„‘æŒ‰ç›¸åº”çš„é”®è¿›boot managerï¼Œæ‰¾åˆ°USBå¯åŠ¨é¡¹ï¼Œå›è½¦å³å¯è¿›å…¥ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422139.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422140.jpg" alt><br>2.ç„¶åä¼šè¿›å…¥è¿™ä¸ªç•Œé¢ï¼Œé€‰æ‹©Install Ubuntuï¼Œå›è½¦ç¡®è®¤<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422141.jpg" alt><br>3.å®‰è£…è¿‡ç¨‹è®°ä½æ–­ç½‘ï¼Œå¦åˆ™å¾ˆæ…¢<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422143.jpg" alt><br>å…¨ä¸é€‰ï¼Œè¾¹å®‰è£…è¾¹ä¸‹è½½æ›´æ–°å¾ˆæ…¢ï¼Œç‚¹å‡»â€ç»§ç»­â€<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/20171229140050194.png" alt><br>å‡ºç°ä»¥ä¸‹æˆ–ç±»ä¼¼ç•Œé¢ï¼Œä¸€å®šè¦é€‰æ‹©â€å…¶ä»–é€‰é¡¹â€ï¼Œå› ä¸ºéœ€è¦æ‰‹åŠ¨åˆ†åŒº<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422145.jpg" alt><br>åˆ†åŒºç•Œé¢å¦‚ä¸‹<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422246.jpg" alt><br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿›è¡Œæ‰‹åŠ¨åˆ†åŒºï¼Œé€‰æ‹©ç•™å‡ºçš„ç©ºé—²åˆ†åŒºï¼Œç‚¹å‡»â€+â€è¿›è¡Œåˆ†åŒºï¼Œå¦‚ä¸‹ï¼š<br>1ï¼‰efiï¼šå¦‚æœæ˜¯å•ç¡¬ç›˜ï¼Œåœ¨å”¯ä¸€çš„ä¸€ä¸ªç©ºé—²åˆ†åŒºä¸Šæ·»åŠ ï¼Œå¤§å°200Mï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºefiï¼›å¦‚æœæ˜¯åŒç¡¬ç›˜ï¼Œæ‰¾åˆ°äº‹å…ˆåˆ†å¥½çš„200Mç©ºé—²åˆ†åŒºæ·»åŠ ï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºefiã€‚è¿™ä¸ªåˆ†åŒºå¿…ä¸å¯å°‘ï¼Œç”¨äºå®‰è£…ubuntuå¯åŠ¨é¡¹ã€‚<br>2ï¼‰swap:ä¸­æ–‡æ˜¯â€äº¤æ¢ç©ºé—´â€ï¼Œå……å½“ubuntuçš„è™šæ‹Ÿå†…å­˜ï¼Œä¸€èˆ¬çš„å¤§å°ä¸ç”µè„‘ç‰©ç†å†…å­˜ä¸€æ ·ï¼Œå¯ä»¥å°†å…¶åˆ†ä¸º 8Gï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€swapâ€æˆ–â€äº¤æ¢ç©ºé—´â€<br>3ï¼‰/:è¿™æ˜¯ubuntu çš„æ ¹ç›®å½•,ç”¨äºå®‰è£…ç³»ç»Ÿå’Œè½¯ä»¶ï¼Œç›¸å½“äºwindowsçš„Cç›˜ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸º 20Gï¼Œä¸»åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€ext4æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿâ€ï¼ŒæŒ‚è½½ç‚¹ä¸ºâ€/â€œï¼ˆæ ¹æ®ä½ çš„ç£ç›˜ç©ºé—´è°ƒæ•´ï¼Œå¯ä»¥å¤§ä¸€ç‚¹ï¼Œæ¯•ç«Ÿubuntuè£…è½¯ä»¶éƒ½æ˜¯é»˜è®¤è£…åœ¨æ ¹ç›®å½•çš„ï¼‰<br>4ï¼‰/home:ç›¸å½“äºwindowsçš„å…¶ä»–ç›˜ï¼Œå‰©ä¸‹çš„å…¨åˆ†ç»™å®ƒï¼Œé€»è¾‘åˆ†åŒºï¼Œç©ºé—´èµ·å§‹ä½ç½®ï¼Œç”¨äºâ€ext4æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿâ€ï¼ŒæŒ‚è½½ç‚¹ä¸ºâ€/homeâ€<br>åˆ†åŒºå®Œæ¯•ï¼Œåœ¨åˆ†åŒºç•Œé¢çš„ä¸‹æ–¹ï¼Œé€‰æ‹©å®‰è£…å¯åŠ¨é¡¹çš„ä½ç½®ï¼Œæˆ‘ä»¬åˆšåˆšä¸æ˜¯åˆ›å»ºäº†200Mçš„efiåˆ†åŒºå—ï¼Œç°åœ¨ä½ çœ‹çœ‹è¿™ä¸ªåŒºå‰é¢çš„ç¼–å·æ˜¯å¤šå°‘ï¼Œæ¯”å¦‚æ˜¯/dev/sda1,ä¸åŒçš„æœºå­ä¼šæœ‰ä¸åŒçš„ç¼–å·ï¼Œä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¿™ä¸ªefiåˆ†åŒºç¼–å·ï¼ˆè¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼Œwindowsçš„å¯åŠ¨é¡¹ä¹Ÿæ˜¯efiæ–‡ä»¶ï¼Œå¤§å°å¤§æ¦‚æ˜¯100Mï¼Œè€Œæˆ‘ä»¬åˆ›å»ºçš„ubuntuçš„efiå¤§å°æ˜¯200Mï¼Œä¸€å®šè¦é€‰å¯¹ï¼‰ï¼Œä¹‹åç‚¹å‡»â€Install Nowâ€<br>è®¾ç½®åœ°åŒºä¸é‡è¦ï¼ŒæŒ‰ä½ éœ€è¦è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç»§ç»­ï¼Œä¸å½±å“<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422248.jpg" alt><br>é”®ç›˜å¸ƒå±€é»˜è®¤æ˜¯è‹±è¯­çš„ï¼Œå»ºè®®ä¸æ”¹ï¼ˆé»˜è®¤ä¸­æ–‡ä¹Ÿè¡Œï¼‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422249.jpg" alt><br>è¿™é‡Œè®¾ç½®ç”¨æˆ·ï¼Œè‡ªå·±è¾“å…¥å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚è‹±æ–‡å­—æ¯ï¼Œå°½é‡ç®€å•ç‚¹ï¼Œå¯†ç ä¹Ÿç®€å•ç‚¹<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422250.jpg" alt><br>ç³»ç»Ÿå¼€å§‹å®‰è£…ï¼Œè€å¿ƒç­‰å¾…å®‰è£…å®Œæ¯•å°±å¯ä»¥äº†<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422251.jpg" alt><br>å…¨éƒ¨å®Œæˆä¹‹åï¼Œä¼šæé†’ä½ é‡å¯ï¼ŒæŠŠUç›˜æ‹”äº†ï¼Œç‚¹â€ç°åœ¨é‡å¯â€ï¼Œå¦‚æœå¡æ­»å°±å¼ºåˆ¶å…³æœºå†é‡å¯å°±å¥½<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422252.jpg" alt><br>é‡å¯åä½ ä¼šçœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼Œç¬¬ä¸€é¡¹æ˜¯ubuntuå¯åŠ¨é¡¹ï¼Œç¬¬äºŒé¡¹æ˜¯ubuntué«˜çº§è®¾ç½®ï¼Œç¬¬ä¸‰é¡¹æ˜¯windowså¯åŠ¨é¡¹ï¼Œç¬¬å››é¡¹ä¸ç”¨ç®¡ï¼Œé»˜è®¤é€‰æ‹©çš„æ˜¯ç¬¬ä¸€ä¸ªï¼Œå›è½¦è¿›ubuntuç³»ç»Ÿ<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/dual_system/2019121214422253.jpg" alt><br>è‹¥æ²¡æœ‰å‡ºç°ï¼Œåˆ™è¿›å…¥bioså°†å¯åŠ¨é¡ºåºæ”¹ä¸ºUbuntuå…ˆã€‚</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Windows10</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾ç½®Pycharm plotsä¸åœ¨tool windowæ˜¾ç¤º</title>
    <url>/2020/01/26/%E8%AE%BE%E7%BD%AEPycharm-plots%E4%B8%8D%E5%9C%A8tool-window%E6%98%BE%E7%A4%BA/</url>
    <content><![CDATA[<p>Pycharmç”»å›¾é»˜è®¤åœ¨tool windowsæ˜¾ç¤ºï¼Œå¯¹äºè§‚çœ‹ã€æ“ä½œå…¶æä¸æ–¹ä¾¿ï¼Œç‰¹åˆ«æ˜¯ç”»åŠ¨æ€å›¾æ—¶ï¼Œè¿˜ä¼šæŠŠæ¯å¸§éƒ½è¾“å‡ºï¼Œå› æ­¤æœ€å¥½è®¾ç½®è®©å®ƒå•ç‹¬çª—å£æ˜¾ç¤ºã€‚<br>å¦‚ä¸‹å›¾ï¼ŒæŠŠå‹¾å»æ‰å³å¯ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/plot/Snipaste_2020-01-26_14-14-13.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pycharm</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿OnedriveåŒæ­¥ä»»æ„æ–‡ä»¶å¤¹</title>
    <url>/2020/01/16/%E4%BD%BFOnedrive%E5%90%8C%E6%AD%A5%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
    <content><![CDATA[<p>onedriveé»˜è®¤åªåŒæ­¥æŒ‡å®šçš„onedriveæ–‡ä»¶å¤¹ï¼Œä¸ºäº†è®©å®ƒåŒæ­¥å…¶ä»–çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ï¼‰ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ã€‚<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mklink /j &quot;onedriveæ–‡ä»¶å¤¹åœ°å€\éœ€è¦åŒæ­¥çš„æ–‡ä»¶å¤¹å&quot; &quot;éœ€è¦åŒæ­¥çš„æ–‡ä»¶å¤¹åœ°å€&quot;</span><br></pre></td></tr></table></figure><br>æ¯”å¦‚è¯´æˆ‘çš„onedriveåœ¨D:\Onedriveï¼Œæˆ‘çš„ç›®æ ‡æ–‡ä»¶å¤¹teståœ¨D:\ã€‚é‚£ä¹ˆ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mklink /j &quot;D:\Onedrive\test&quot; &quot;D:\test&quot;</span><br></pre></td></tr></table></figure><br>å¦‚æœæˆåŠŸçš„çš„è¯ï¼Œä¼šæç¤º<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/onedrive/1392594-20181005094204092-1998469109.png" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Onedrive</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntuä¸‹teamviewerçš„å®‰è£…æ–¹æ³•</title>
    <url>/2019/12/21/ubuntu%E4%B8%8Bteamviewer%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"><a href="#å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"></a>å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…</h2><p><a href="https://www.teamviewer.com/zhcn/download/linux/">å®˜ç½‘é“¾æ¥</a><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/teamviewer/20180128120840387.png" alt></p>
<h2 id="åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…"><a href="#åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…" class="headerlink" title="åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…"></a>åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®‰è£…</h2><p>ï¼ˆåœ¨ä¸‹è½½æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼šsudo dpkg -i  teamviewer_13.0.6634_amd64.debï¼‰ï¼ˆteamviewer_13.0.6634_amd64.debä¸ºå®‰è£…åŒ…åï¼Œæ ¹æ®è‡ªå·±å®‰è£…åŒ…ï¼‰<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i  teamviewer_13.0.6634_amd64.deb</span><br></pre></td></tr></table></figure></p>
<h2 id="å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»"><a href="#å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»" class="headerlink" title="å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»"></a>å®‰è£…å‡ºé”™ï¼Œä¸€è¡Œè¯­å¥æå®šä¾èµ–å…³ç³»</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/teamviewer/20180128120923823.png" alt><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -f</span><br></pre></td></tr></table></figure></p>
<h2 id="å†æ¬¡å®‰è£…"><a href="#å†æ¬¡å®‰è£…" class="headerlink" title="å†æ¬¡å®‰è£…"></a>å†æ¬¡å®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i  teamviewer_13.0.6634_amd64.deb</span><br></pre></td></tr></table></figure>
<h2 id="æ‰“å¼€teamview"><a href="#æ‰“å¼€teamview" class="headerlink" title="æ‰“å¼€teamview"></a>æ‰“å¼€teamview</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/teamviewer/20180128121156354.png" alt><br>æˆ–ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo teamviewer --daemon start </span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Teamviewer</tag>
      </tags>
  </entry>
  <entry>
    <title>PyQt5ä¸Opencvçš„å°å°èåˆ</title>
    <url>/2019/12/19/PyQt5%E4%B8%8EOpencv%E7%9A%84%E5%B0%8F%E5%B0%8F%E8%9E%8D%E5%90%88/</url>
    <content><![CDATA[<h2 id="ä¸€äº›æ ¸å¿ƒä»£ç "><a href="#ä¸€äº›æ ¸å¿ƒä»£ç " class="headerlink" title="ä¸€äº›æ ¸å¿ƒä»£ç "></a>ä¸€äº›æ ¸å¿ƒä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myLabel</span>(<span class="params">QLabel</span>):</span></span><br><span class="line">    x0 = <span class="number">0</span></span><br><span class="line">    y0 = <span class="number">0</span></span><br><span class="line">    x1 = <span class="number">0</span></span><br><span class="line">    y1 = <span class="number">0</span></span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mousePressEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        self.flag = <span class="literal">True</span></span><br><span class="line">        self.x0 = event.x()</span><br><span class="line">        self.y0 = event.y()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mouseReleaseEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        self.flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mouseMoveEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.flag:</span><br><span class="line">            self.x1 = event.x()</span><br><span class="line">            self.y1 = event.y()</span><br><span class="line">            self.update()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">paintEvent</span>(<span class="params">self, event</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().paintEvent(event)</span><br><span class="line">        rect =QRect(self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br><span class="line">        painter = QPainter(self)</span><br><span class="line">        painter.setPen(QPen(Qt.red,<span class="number">4</span>,Qt.SolidLine))</span><br><span class="line">        painter.drawRect(rect)</span><br><span class="line"></span><br><span class="line">        pqscreen  = QGuiApplication.primaryScreen()</span><br><span class="line">        pixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br><span class="line">        pixmap2.save(<span class="string">&#x27;555.png&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span>(<span class="params">QWidget</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.initUI()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initUI</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.resize(<span class="number">675</span>, <span class="number">300</span>)</span><br><span class="line">        self.setWindowTitle(<span class="string">&#x27;å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šå­¦ç‚¹ç¼–ç¨‹å§--opencvã€PyQt5çš„å°å°èåˆ&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.lb = myLabel(self)</span><br><span class="line">        self.lb.setGeometry(QRect(<span class="number">140</span>, <span class="number">30</span>, <span class="number">511</span>, <span class="number">241</span>))</span><br><span class="line"></span><br><span class="line">        img = cv2.imread(<span class="string">&#x27;xxx.jpg&#x27;</span>)</span><br><span class="line">        height, width, bytesPerComponent = img.shape</span><br><span class="line">        bytesPerLine = <span class="number">3</span> * width</span><br><span class="line">        cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br><span class="line">        QImg = QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br><span class="line">        pixmap = QPixmap.fromImage(QImg)</span><br><span class="line"></span><br><span class="line">        self.lb.setPixmap(pixmap)</span><br><span class="line">        self.lb.setCursor(Qt.CrossCursor)</span><br><span class="line"></span><br><span class="line">        self.show()</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°å¤§ä½“æ€è·¯"><a href="#å®ç°å¤§ä½“æ€è·¯" class="headerlink" title="å®ç°å¤§ä½“æ€è·¯"></a>å®ç°å¤§ä½“æ€è·¯</h2><ul>
<li>é‡æ–°å®ç°QLabelç±»ï¼Œåœ¨ç±»ä¸­é‡æ–°å®ç°äº†é¼ æ ‡çš„ç‚¹å‡»ã€æ‹–åŠ¨ã€é‡Šæ”¾ã€ä»¥åŠç»˜ç”»äº‹ä»¶</li>
<li>åœ¨çª—ä½“ä¸Šæ–°å»ºäº†ä¸€ä¸ªlabelæ ‡ç­¾ï¼Œç„¶åè½½å…¥å›¾ç‰‡</li>
<li>labelæ ‡ç­¾è½½å…¥çš„å›¾åƒæ˜¯ç”±Opencvå®ç°çš„</li>
</ul>
<h2 id="é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯"><a href="#é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯" class="headerlink" title="é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯"></a>é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯</h2><ul>
<li>æ–°å»ºä¸€ä¸ªçŸ©å½¢æ˜¯å¦å®Œæˆæ ‡å¿—flagï¼Œé»˜è®¤æ˜¯Flaseï¼Œè¡¨ç¤ºæœªå®Œæˆ</li>
<li>é¼ æ ‡ç‚¹å‡»çš„æ—¶å€™ï¼Œè®°å½•å½“å‰é¼ æ ‡æ‰€åœ¨ä½ç½®çš„åæ ‡ï¼Œflagæ ‡å¿—ç½®ä¸ºTrueï¼Œè¡¨ç¤ºå¼€å§‹ç”»çŸ©å½¢äº†</li>
<li>é¼ æ ‡æ‹–åŠ¨çš„æ—¶å€™ï¼Œå› ä¸ºflagä¸ºTrueï¼Œæ‰€ä»¥è®°å½•å½“å‰é¼ æ ‡æ‰€åœ¨ä½ç½®çš„åæ ‡</li>
<li>é¼ æ ‡é‡Šæ”¾çš„æ—¶å€™ï¼Œflagç½®ä¸ºFalseï¼Œè¡¨ç¤ºçŸ©å½¢ç”»å®Œäº†ï¼Œå‡†å¤‡ç”»ä¸‹ä¸€ä¸ªäº†</li>
</ul>
<h2 id="ä»£ç è®²è§£"><a href="#ä»£ç è®²è§£" class="headerlink" title="ä»£ç è®²è§£"></a>ä»£ç è®²è§£</h2><h3 id="Opencvå›¾åƒçš„è½¬æ¢"><a href="#Opencvå›¾åƒçš„è½¬æ¢" class="headerlink" title="Opencvå›¾åƒçš„è½¬æ¢"></a>Opencvå›¾åƒçš„è½¬æ¢</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">&#x27;xxx.jpg&#x27;</span>)</span><br><span class="line">height, width, bytesPerComponent = img.shape</span><br><span class="line">bytesPerLine = <span class="number">3</span> * width</span><br><span class="line">cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br><span class="line">QImg = QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br><span class="line">pixmap = QPixmap.fromImage(QImg)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå°±æ˜¯Opencvå’ŒPyQtå¯¹è±¡çš„è½¬åŒ–äº†ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">&#x27;xxx.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure><br>ä½¿ç”¨Opencvè¯»å–å›¾åƒã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">height, width, bytesPerComponent = img.shape</span><br></pre></td></tr></table></figure><br>åœ¨OpenCV-Pythonç»‘å®šä¸­ï¼Œå›¾åƒä½¿ç”¨NumPyæ•°ç»„çš„å±æ€§(è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè¦æ›´æ–°numpy)æ¥è¡¨ç¤ºå›¾åƒçš„å°ºå¯¸å’Œé€šé“ä¿¡æ¯ã€‚æ­¤æ—¶å¦‚æœæˆ‘ä»¬è¾“å‡ºimg.shapeï¼Œå°†å¾—åˆ°(200, 360, 3)ã€‚æœ€åçš„3è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªRGBå›¾åƒã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cv2.cvtColor(img, cv2.COLOR_BGR2RGB, img)</span><br></pre></td></tr></table></figure><br>å°†å›¾åƒä»ä¸€ä¸ªé¢œè‰²ç©ºé—´è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢œè‰²ç©ºé—´ã€‚<br>Pythonä¸­çš„å‡½æ•°è¦æ±‚æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Pythonï¼šcv2.cvtColorï¼ˆsrcï¼Œcode [ï¼Œdst [ï¼ŒdstCn]]ï¼‰â†’dst</span><br></pre></td></tr></table></figure><br>å‚æ•°ï¼š</p>
<ol>
<li>src - è¾“å…¥å›¾åƒï¼š8ä½æ— ç¬¦å·ï¼Œ16ä½æ— ç¬¦å·ï¼ˆCV_16UC â€¦ï¼‰æˆ–å•ç²¾åº¦æµ®ç‚¹æ•°ã€‚</li>
<li>dst - è¾“å‡ºä¸srcç›¸åŒå¤§å°å’Œæ·±åº¦çš„å›¾åƒã€‚</li>
<li>code - é¢œè‰²ç©ºé—´è½¬æ¢ä»£ç ï¼ˆè¯·å‚é˜…ä¸‹é¢çš„è¯´æ˜ï¼‰ã€‚</li>
<li>dstCn - ç›®æ ‡å›¾åƒä¸­çš„é€šé“æ•°é‡ï¼›å¦‚æœå‚æ•°æ˜¯0ï¼Œåˆ™é€šé“çš„æ•°é‡æ˜¯ä»srcå’Œä»£ç è‡ªåŠ¨å¯¼å‡ºçš„ã€‚</li>
</ol>
<p>è¯¥å‡½æ•°å°†è¾“å…¥å›¾åƒä»ä¸€ä¸ªé¢œè‰²ç©ºé—´è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢œè‰²ç©ºé—´ã€‚åœ¨ä»RGBé¢œè‰²ç©ºé—´è½¬æ¢åˆ°RGBé¢œè‰²ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œé€šé“çš„é¡ºåºåº”æ˜ç¡®æŒ‡å®šï¼ˆRGBæˆ–BGRï¼‰ã€‚è¯·æ³¨æ„ï¼ŒOpenCVä¸­çš„é»˜è®¤é¢œè‰²æ ¼å¼é€šå¸¸è¢«ç§°ä¸ºRGBï¼Œä½†å®é™…ä¸Šæ˜¯BGRï¼ˆå­—èŠ‚ç›¸åï¼‰ã€‚å› æ­¤ï¼Œæ ‡å‡†ï¼ˆ24ä½ï¼‰å½©è‰²å›¾åƒä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å°†æ˜¯ä¸€ä¸ª8ä½è“è‰²åˆ†é‡ï¼Œç¬¬äºŒä¸ªå­—èŠ‚å°†æ˜¯ç»¿è‰²ï¼Œè€Œç¬¬ä¸‰ä¸ªå­—èŠ‚å°†æ˜¯çº¢è‰²ã€‚ç¬¬å››ï¼Œäº”ï¼Œå…­å­—èŠ‚å°†æ˜¯ç¬¬äºŒä¸ªåƒç´ ï¼ˆè“è‰²ï¼Œç„¶åæ˜¯ç»¿è‰²ï¼Œç„¶åæ˜¯çº¢è‰²ï¼‰ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°±æ˜¯è¦æ±‚ä»Opencvçš„BGRå›¾åƒè½¬æ¢æˆRGBå›¾åƒäº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¦è½¬æ¢æˆPyQt5å¯ä»¥è¯†åˆ«çš„å•Šï¼<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bytesPerLine = <span class="number">3</span> * width</span><br><span class="line">QImg = QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br></pre></td></tr></table></figure><br>QImageç±»æä¾›äº†ç‹¬ç«‹äºç¡¬ä»¶çš„å›¾åƒè¡¨ç¤ºå½¢å¼ï¼Œå…è®¸ç›´æ¥è®¿é—®åƒç´ æ•°æ®ï¼Œå¹¶å¯ç”¨ä½œç»˜ç”»è®¾å¤‡ã€‚Qtæä¾›äº†å››ä¸ªç±»æ¥å¤„ç†å›¾åƒæ•°æ®ï¼šQImageï¼ŒQPixmapï¼ŒQBitmapå’ŒQPictureã€‚QImageæ˜¯ä¸ºI/Oè®¾è®¡å’Œä¼˜åŒ–çš„ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è¿›è¡Œåƒç´ è®¿é—®å’Œæ“ä½œï¼Œè€ŒQPixmapåˆ™æ˜¯é’ˆå¯¹åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå›¾åƒè€Œè®¾è®¡å’Œä¼˜åŒ–çš„ã€‚ </p>
<p>QBitmapåªæ˜¯ä¸€ä¸ªç»§æ‰¿QPixmapçš„ä¾¿åˆ©ç±»ï¼Œæ·±åº¦ä¸º1ã€‚æœ€åï¼ŒQPictureç±»æ˜¯ä¸€ä¸ªè®°å½•å’Œé‡æ”¾QPainterå‘½ä»¤çš„ç»˜å›¾è®¾å¤‡ã€‚</p>
<p>å› ä¸ºQImageæ˜¯ä¸€ä¸ªQPaintDeviceå­ç±»ï¼ŒQPainterå¯ä»¥ç”¨æ¥ç›´æ¥ç»˜åˆ¶å›¾åƒã€‚åœ¨QImageä¸Šä½¿ç”¨QPainteræ—¶ï¼Œå¯ä»¥åœ¨å½“å‰GUIçº¿ç¨‹ä¹‹å¤–çš„å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œç»˜åˆ¶ã€‚QImageæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¯ç”¨äºè·å–æœ‰å…³å›¾åƒçš„å„ç§ä¿¡æ¯ã€‚ä¹Ÿæœ‰å‡ ä¸ªåŠŸèƒ½ï¼Œä½¿å›¾åƒè½¬æ¢ã€‚<br>è¯¦è§å®˜ç½‘ä»‹ç»ï¼š<a href="https://doc.qt.io/qt-5/qimage.html">QImage Class | Qt GUI 5.10</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">QImg = QImage(img.data, width, height, bytesPerLine, QImage.Format_RGB888)</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°åŸå‹æ˜¯ï¼š<strong>QImage(str, int, int, int, QImage.Format)</strong>ï¼Œç”¨ç»™å®šçš„å®½åº¦ï¼Œé«˜åº¦å’Œæ ¼å¼æ„é€ ä¸€ä¸ªä½¿ç”¨ç°æœ‰å†…å­˜ç¼“å†²åŒºæ•°æ®çš„å›¾åƒã€‚å®½åº¦å’Œé«˜åº¦å¿…é¡»ä»¥åƒç´ æŒ‡å®šã€‚bytesPerLineæŒ‡å®šæ¯è¡Œçš„å­—èŠ‚æ•°ã€‚</p>
<p><strong>è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆbytesPerLine = 3 * widthï¼Ÿ</strong><br>æˆ‘çš„ç†è§£æ˜¯ï¼šå½“1ä¸ªåƒç´ å 3ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶å›¾åƒä¸ºçœŸå½©è‰²å›¾åƒã€‚</p>
<p><strong>QImage.Format_RGB888</strong>è¡¨ç¤ºçš„æ˜¯å›¾åƒå­˜å‚¨ä½¿ç”¨8-8-8 24ä½RGBæ ¼å¼ã€‚å½“ç„¶è¿˜æœ‰æ›´å¤šçš„æ ¼å¼ï¼Œè¯¦è§QImageçš„å®˜æ–¹ä»‹ç»ï¼Œé™äºç¯‡å¹…è¿™é‡Œä¸å±•å¼€ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pixmap = QPixmap.fromImage(QImg)</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æƒ³QImageå¯¹è±¡è½¬æ¢æˆQPixmapå¯¹è±¡ï¼Œä¾¿äºä¸‹æ­¥æˆ‘ä»¬å°†Labelæ ‡ç­¾ä¸­è®¾ç½®å›¾åƒã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.lb.setPixmap(pixmap)</span><br></pre></td></tr></table></figure><br>è®¾ç½®æ ‡ç­¾çš„å›¾åƒä¿¡æ¯ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.lb.setCursor(Qt.CrossCursor)</span><br></pre></td></tr></table></figure><br>è®¾ç½®é¼ æ ‡åœ¨QLabelå¯¹è±¡ä¸­çš„æ ·å¼ï¼Œåªæ˜¯ä¸ºäº†ç”»ç”»å¥½çœ‹äº›è€Œå·²ï¼Œæ²¡å…¶å®ƒçš„æ„æ€ã€‚é™¤äº†è¿™ä¸ªåå­—æ¶çš„ï¼Œè¿˜æœ‰å…¶å®ƒå¾ˆå¤šæ ·å¼ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/opencv/v2-cf7bf8978adbaa898f059207f52f3d5b_hd.jpg" alt></p>
<h3 id="é¼ æ ‡äº‹ä»¶"><a href="#é¼ æ ‡äº‹ä»¶" class="headerlink" title="é¼ æ ‡äº‹ä»¶"></a>é¼ æ ‡äº‹ä»¶</h3><p>æŒ‰ç…§ä¸Šæ–‡ä¸­æˆ‘ä»¬ä»‹ç»çš„æ€è·¯ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªQLabelç±»myLabelï¼Œå½“ç„¶æ˜¯ç»§æ‰¿äº†QLabelã€‚ç„¶åæˆ‘ä»¬ç”¨å‡ ä¸ªç±»å˜é‡è®°å½•é¼ æ ‡çš„åæ ‡å’ŒçŸ©å½¢æ˜¯å¦å®Œæˆçš„æ ‡å¿—ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mousePressEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">    self.flag = <span class="literal">True</span></span><br><span class="line">    self.x0 = event.x()</span><br><span class="line">    self.y0 = event.y()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mouseReleaseEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">    self.flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mouseMoveEvent</span>(<span class="params">self,event</span>):</span></span><br><span class="line">    <span class="keyword">if</span> self.flag:</span><br><span class="line">        self.x1 = event.x()</span><br><span class="line">        self.y1 = event.y()</span><br><span class="line">        self.update()</span><br></pre></td></tr></table></figure><br>è¿™é‡Œå°±æ˜¯é‡è½½äº†é¼ æ ‡äº§ç”Ÿçš„å‡ ä¸ªäº‹ä»¶ï¼Œæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ã€‚åˆ†åˆ«è®°å½•äº†ç‚¹å‡»é¼ æ ‡ååˆå§‹çš„é¼ æ ‡åæ ‡ï¼Œä»¥åŠé‡Šæ”¾é¼ æ ‡åçš„é¼ æ ‡åæ ‡ã€‚å¹¶åœ¨é¼ æ ‡ç§»åŠ¨çš„æ—¶å€™æ›´æ–°UIã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„é¼ æ ‡ç”»çŸ©å½¢çš„æ€è·¯ã€‚</p>
<h3 id="ç”»çŸ©å½¢"><a href="#ç”»çŸ©å½¢" class="headerlink" title="ç”»çŸ©å½¢"></a>ç”»çŸ©å½¢</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">paintEvent</span>(<span class="params">self, event</span>):</span></span><br><span class="line">    <span class="built_in">super</span>().paintEvent(event)</span><br><span class="line">    rect =QRect(self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br><span class="line">    painter = QPainter(self)</span><br><span class="line">    painter.setPen(QPen(Qt.red,<span class="number">4</span>,Qt.SolidLine))</span><br><span class="line">    painter.drawRect(rect)</span><br><span class="line"></span><br><span class="line">    pqscreen  = QGuiApplication.primaryScreen()</span><br><span class="line">    pixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br><span class="line">    pixmap2.save(<span class="string">&#x27;555.png&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜¯å…³é”®ç‚¹å•Šï¼<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">super</span>().paintEvent(event)</span><br></pre></td></tr></table></figure><br>è°ƒç”¨çˆ¶ç±»çš„paintEvent()ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†æ˜¾ç¤ºä½ è®¾ç½®çš„æ•ˆæœã€‚å¦åˆ™ä¼šæ˜¯ä¸€ç‰‡ç©ºç™½ã€‚å¤§å®¶å¯ä»¥è¯•è¯•æ³¨é‡Šè¿™å¥è¯ï¼Œçœ‹çœ‹æ•ˆæœå•Šï¼<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rect =QRect(self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br></pre></td></tr></table></figure><br>QRectç±»ä½¿ç”¨æ•´æ•°ç²¾åº¦åœ¨å¹³é¢ä¸­å®šä¹‰ä¸€ä¸ªçŸ©å½¢ã€‚çŸ©å½¢é€šå¸¸è¡¨ç¤ºä¸ºå·¦ä¸Šè§’å’Œå¤§å°ã€‚QRectçš„å¤§å°ï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰å§‹ç»ˆç­‰åŒäºæ„æˆå…¶æ¸²æŸ“åŸºç¡€çš„æ•°å­¦çŸ©å½¢ã€‚QRectå¯ä»¥ç”¨ä¸€ç»„å·¦ï¼Œä¸Šï¼Œå®½å’Œé«˜æ•´æ•°ï¼Œæˆ–è€…ä»QPointå’ŒQSizeæ„æˆã€‚ä»¥ä¸‹ä»£ç åˆ›å»ºä¸¤ä¸ªç›¸åŒçš„çŸ©å½¢ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">QRect(<span class="number">100</span>, <span class="number">200</span>, <span class="number">11</span>, <span class="number">16</span>)</span><br><span class="line">QRect(QPoint(<span class="number">100</span>, <span class="number">200</span>), QSize(<span class="number">11</span>, <span class="number">16</span>))</span><br><span class="line">painter = QPainter(self)</span><br><span class="line">painter.setPen(QPen(Qt.red,<span class="number">4</span>,Qt.SolidLine))</span><br><span class="line">painter.drawRect(rect)</span><br></pre></td></tr></table></figure><br>æ„å»ºä¸€ä¸ªQPainterå¯¹è±¡ï¼Œè®¾ç½®å®ƒçš„ç”»ç¬”ï¼Œç„¶åç”»ä¸€ä¸ªçŸ©å½¢ã€‚è²Œä¼¼æ„Ÿè§‰å¥½ç®€å•ï¼^_^â€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pqscreen  = QGuiApplication.primaryScreen()</span><br><span class="line">pixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, <span class="built_in">abs</span>(self.x1-self.x0), <span class="built_in">abs</span>(self.y1-self.y0))</span><br><span class="line">pixmap2.save(<span class="string">&#x27;555.png&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æˆªå±çš„åŸç†å‘¢ï¼Œä¸»è¦è¿˜æ˜¯è¿ç”¨QScreenç±»ä¸­çš„grabWindowæ–¹æ³•ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">QScreen.grabWindow(WId window, <span class="built_in">int</span> x = <span class="number">0</span>, <span class="built_in">int</span> y = <span class="number">0</span>, <span class="built_in">int</span> width = -<span class="number">1</span>, <span class="built_in">int</span> height = -<span class="number">1</span>)</span><br></pre></td></tr></table></figure><br>å¤§è‡´æ„æ€æ˜¯åˆ›å»ºå¹¶è¿”å›é€šè¿‡æŠ“å–ç”±QRectï¼ˆxï¼Œyï¼Œwidthï¼Œheightï¼‰é™åˆ¶çš„ç»™å®šçª—å£æ„é€ çš„åƒç´ å›¾ã€‚</p>
<p>å‚æ•°ï¼ˆxï¼Œyï¼‰æŒ‡å®šçª—å£ä¸­çš„åç§»é‡ï¼Œè€Œï¼ˆå®½åº¦ï¼Œé«˜åº¦ï¼‰æŒ‡å®šè¦å¤åˆ¶çš„åŒºåŸŸã€‚å¦‚æœå®½åº¦ä¸ºè´Ÿæ•°ï¼Œåˆ™è¯¥å‡½æ•°å°†æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°çª—å£çš„å³è¾¹ç•Œã€‚å¦‚æœé«˜åº¦ä¸ºè´Ÿæ•°ï¼Œåˆ™è¯¥å‡½æ•°å°†æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°çª—å£çš„åº•éƒ¨ã€‚</p>
<p>çª—å£ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆWIdï¼‰å¯ä»¥ä½¿ç”¨QWidget.winIdï¼ˆï¼‰å‡½æ•°è¿›è¡Œæ£€ç´¢ã€‚grabWindowï¼ˆï¼‰å‡½æ•°ä»å±å¹•æŠ“å–åƒç´ ï¼Œè€Œä¸æ˜¯ä»çª—å£æŠ“å–åƒç´ ï¼Œå³ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªçª—å£éƒ¨åˆ†æˆ–å…¨éƒ¨è¦†ç›–æŠ“å–çš„åƒç´ ï¼Œåˆ™ä¹Ÿä¼šä»ä¸Šé¢çš„çª—å£è·å–åƒç´ ã€‚é¼ æ ‡å…‰æ ‡ä¸€èˆ¬ä¸ä¼šè¢«æŠ“å–ã€‚è¯¦è§å®˜ç½‘ä»‹ç»ï¼šQScreen Class | Qt GUI 5.10</p>
<p>ç”±äºQScreenç±»æ— æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨QGuiApplication.primaryScreen()åˆ›å»ºäº†ä¸€ä¸ªQscreenç±»å¯¹è±¡ã€‚æœ€åä½¿ç”¨pixmap2.save(â€˜555.pngâ€™)ï¼Œä¿å­˜å…·ä½“çš„æˆªå›¾ã€‚</p>
<p>å¦‚æœä½ æƒ³ä¿å­˜çš„å›¾ç‰‡æ²¡æœ‰çº¢æ¡†ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼š<br><a href="http://www.xdbcb8.com/forum/topic/%e3%80%8apyqt5%e4%b8%8eopencv%e7%9a%84%e5%b0%8f%e5%b0%8f%e8%9e%8d%e5%90%88%e3%80%8b%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e4%b8%ad%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e4%bf%9d%e5%ad%98%e4%b8%8b%e6%9d%a5">ã€Špyqt5ä¸opencvçš„å°å°èåˆã€‹è¿™ç¯‡æ–‡ç« ä¸­å¦‚ä½•å®ç°ä¿å­˜ä¸‹æ¥</a></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Opencv</tag>
        <tag>PyQt5</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowså¦‚ä½•é€šè¿‡VNCä»è¿œç¨‹æ§åˆ¶Ubuntu</title>
    <url>/2020/02/18/Windows%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87VNC%E4%BB%8E%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6Ubuntu/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>VNC å·¥å…·æ˜¯æä¾›ä½ ä¸€ä¸ªå¯ä»¥è¿œç¨‹å›¾åƒåŒ–æ¡Œé¢çš„æ–¹å¼ã€‚å…¶å® VNC æ˜¯ä¸€ç§è½¯ä»¶çš„ç»Ÿç§°ã€‚åªè¦ä½ çš„ Linux æ¶è®¾å¥½äº†ä¸€ä¸ªæœåŠ¡å™¨ (Server) çš„ VNCï¼Œå®¢æˆ·ç«¯æ¯”å¦‚ä½ çš„ Macï¼Œæ‰‹æœºï¼Œåªè¦å®‰è£…ä»»ä½•ä¸€ç§ VNC å®¢æˆ·ç«¯è½¯ä»¶å°±èƒ½é“¾æ¥ä¸ŠæœåŠ¡å™¨ç«¯çš„ç”µè„‘ã€‚</p>
<h2 id="UbuntuæœåŠ¡ç«¯å®‰è£…"><a href="#UbuntuæœåŠ¡ç«¯å®‰è£…" class="headerlink" title="UbuntuæœåŠ¡ç«¯å®‰è£…"></a>UbuntuæœåŠ¡ç«¯å®‰è£…</h2><p>æ‰“å¼€ Terminalï¼Œè¾“å…¥:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install x11vnc</span><br></pre></td></tr></table></figure><br>ç¡®è®¤ä½ çš„ Linux ç”¨æˆ·å¯†ç ï¼Œå°±èƒ½å®‰è£…è¿™ä¸ªæœ€å¸¸ç”¨çš„ x11vnc è½¯ä»¶ã€‚è¿™ä¸ªè½¯ä»¶çš„ä½¿ç”¨ï¼Œè®¾ç½®éå¸¸ç®€å•ã€‚å®‰è£…å¥½åï¼Œæœ€å¥½ç»™ä½ çš„ x11vnc è®¾ç½®ä¸€ä¸ªç”¨äºè¿æ¥çš„å¯†ç ï¼Œè¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">x11vnc -storepasswd</span><br></pre></td></tr></table></figure><br>ä¼šå‡ºç°ä»¥ä¸‹ç”»é¢ï¼Œè®¾ç½®ä½ çš„å¯†ç ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Enter VNC password:</span><br><span class="line">Verify password:</span><br><span class="line">Write password to /home/morvan/.vnc/passwd?  [y]/n y</span><br><span class="line">Password written to: /home/morvan/.vnc/passwd</span><br></pre></td></tr></table></figure><br>å¼€å¯æœåŠ¡:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">x11vnc -auth guess -once -loop -noxdamage -repeat -rfbauth /home/USERNAME/.vnc/passwd -rfbport 5900 -shared</span><br></pre></td></tr></table></figure></p>
<p><strong>æ³¨æ„ï¼š/home/USERNAME/.vnc/passwd ä¸­çš„USERNAMEéœ€è¦æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åã€‚</strong></p>
<p>è®¾ä¸ºå¼€æœºå¯åŠ¨ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /lib/systemd/system/x11vnc.service</span><br></pre></td></tr></table></figure><br>åœ¨æ‰“å¼€çš„é¡µé¢ä¸­æ’å…¥ä»¥ä¸‹ä»£ç ï¼Œä¿å­˜<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Start x11vnc at startup.</span><br><span class="line">After=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/x11vnc -auth guess -once -loop -noxdamage -repeat -rfbauth /home/USERNAME/.vnc/passwd -rfbport 5900 -shared</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>æ¥ç€æ‰§è¡Œï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable x11vnc.service</span><br></pre></td></tr></table></figure><br>å¥½äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯é…ç½®å®Œæ¯•ã€‚</p>
<h2 id="Windowså®¢æˆ·ç«¯å®‰è£…"><a href="#Windowså®¢æˆ·ç«¯å®‰è£…" class="headerlink" title="Windowså®¢æˆ·ç«¯å®‰è£…"></a>Windowså®¢æˆ·ç«¯å®‰è£…</h2><p>æˆ‘è¿™é‡Œç”¨çš„æ˜¯RealVNCçš„VNC Viewerï¼Œ<a href="https://www.realvnc.com/en/connect/download/viewer/">ä¸‹è½½åœ°å€</a></p>
<p>æ‰“å¼€å®¢æˆ·ç«¯ï¼Œè¾“å…¥ä½ è¦è¿æ¥çš„æœåŠ¡ç«¯çš„IP</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VNC/Snipaste_2020-02-18_18-11-36.jpg" alt></p>
<p>æ¥ç€è¾“å…¥ä½ æ‰€è®¾ç½®çš„å¯†ç å³å¯è¿æ¥ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/VNC/Snipaste_2020-02-18_18-12-44.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>VNC</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å®‰è£…Pycharm</title>
    <url>/2019/12/13/Ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85Pycharm/</url>
    <content><![CDATA[<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>æœ‰ç¤¾åŒºç‰ˆå’Œä¸“ä¸šç‰ˆï¼Œä¸“ä¸šç‰ˆéœ€è¦æ¿€æ´»ï¼Œç¤¾åŒºç‰ˆå…è´¹ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯ç¤¾åŒºç‰ˆã€‚<br><a href="https://www.jetbrains.com/pycharm/download/#section=linux">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DfZJG3QQlZ_3Bhj8mrEC">ç½‘ç›˜ä¸‹è½½</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿›å…¥downloadç›®å½•ï¼Œå¯¹ä¸‹è½½å¥½çš„Pycharmå‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œé€‰ä¸­æ–‡ä»¶å³é”®æå–åˆ°æ­¤å¤„å³å¯ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D1664510513%2C942693123%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>è¿›å…¥è§£å‹åçš„Pycharmæ–‡ä»¶å¤¹ï¼Œè¿›å…¥binç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶å«åšpycharm.shã€‚ä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­æ‰€é€‰ä¸­çš„æ–‡ä»¶ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D101055722%2C4258535600%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>æ­¤æ—¶åœ¨binæ–‡ä»¶å¤¹ä¸‹å³é”®æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥è¿è¡Œå‘½ä»¤, æ‰§è¡ŒPycharmç¨‹åº<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./pycharm.sh</span><br></pre></td></tr></table></figure><br>å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œå¤§å®¶å¯ä»¥æ·»åŠ sudoå‘½ä»¤è¿›è¡Œæ“ä½œï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ./pycharm.sh</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D805484803%2C1629350165%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>å¤§å®¶ç‚¹å‡»OKå³å¯è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œï¼Œæ ¹æ®æç¤ºçš„å†…å®¹è¿›è¡Œå‹¾é€‰åŒæ„åè®®ï¼Œç„¶åç‚¹å‡»continueè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»donâ€™t sendè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œé€‰æ‹©å–œæ¬¢çš„ç•Œé¢é£æ ¼ï¼Œç„¶åå†æ¬¡ç‚¹å‡»nextè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°æç¤ºstartå¯åŠ¨ç¨‹åºã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D227808303%2C3066408894%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D22323540%2C1357101677%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D1914658415%2C2906990210%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt><br>ä¸ºäº†æ–¹ä¾¿ä»¥åçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†Pycharmçš„å›¾æ ‡ï¼ˆå¿«æ·é”®ï¼‰é”å®šåˆ°å¯åŠ¨å™¨ã€‚ä¹‹åä¸ç”¨å†å»åœ¨ç»ˆç«¯ä¸­å¯åŠ¨Pycharmäº†ï¼Œç›´æ¥ç‚¹å‡»å›¾æ ‡å¯åŠ¨å³å¯ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pycharm/u%3D1149108563%2C3867497858%26fm%3D173%26app%3D49%26f%3DJPEG.jpg" alt></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹Rimeå®‰è£…é…ç½®</title>
    <url>/2020/01/26/Ubuntu%E4%B8%8BRime%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>å®˜æ–¹ç½‘ç«™åŠæ–‡æ¡£ï¼š<a href="https://rime.im/">https://rime.im/</a><br>è¾“å…¥æ³•å¹³å°ï¼šiBus</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install ibus-rime</span><br></pre></td></tr></table></figure>
<p>åœ¨è®¾ç½®åŒºåŸŸå’Œè¯­è¨€é€‰æ‹©è¾“å…¥æ³•ä¸ºRime<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/rime/1762213-d899b160aa87f944.png" alt><br>æ ¹æ®ä¸ªäººå–œå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šä¸€èˆ¬ç”¨æˆ·ç›´æ¥ä¿®æ”¹default.yamlå³å¯ã€‚ä¿®æ”¹å‰æœ€å¥½å¤‡ä»½ä¸€ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">~/.config/ibus/rime/default.yaml</span><br><span class="line"></span><br><span class="line">schema_list:   </span><br><span class="line">  - schema: luna_pinyin_simp #simpæ˜¯ç®€ä½“ï¼Œç¬¬ä¸€ä½æ˜¯é»˜è®¤è¾“å…¥æ³• </span><br><span class="line">menu:</span><br><span class="line">  page_size: 9 #æ¯é¡µå€™é€‰è¯ä¸ªæ•°</span><br><span class="line">ascii_composer:</span><br><span class="line">  switch_key:</span><br><span class="line">    Shift_L: commit_code #å·¦shiftæäº¤å­—æ¯</span><br></pre></td></tr></table></figure>
<p>é‡å¯ibus-deamon<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ibus restart</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>CMake Error at /usr/share/cmake-3.5/Modules/FindQt4.cmake:634 (message)</title>
    <url>/2020/01/19/CMake%20Error/</url>
    <content><![CDATA[<p>ç¼–è¯‘å·¥ç¨‹æ—¶å‡ºç°cmakeæ‰¾ä¸åˆ°Qt4çš„é—®é¢˜,å¦‚ä¸‹:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CMake Warning at /usr/share/cmake-3.5/Modules/FindQt4.cmake:626 (message):</span><br><span class="line">/usr/bin/qmake-qt4 reported QT_INSTALL_LIBS as &quot;/usr/lib/x86_64-linux-gnu&quot;</span><br><span class="line"> but QtCore could not be found there.  </span><br><span class="line"> Qt is NOT installed correctly for the target build environment.</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CMake Error at /usr/share/cmake-3.5/Modules/FindQt4.cmake:634 (message):</span><br><span class="line">  Could NOT find QtCore. </span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install cmake gcc g++ qt&#123;4,5&#125;-qmake libqt4-dev</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Permmision deniedè§£å†³æ–¹æ³•</title>
    <url>/2019/12/21/Permmision%20denied%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>è¿™æ˜¯å› ä¸ºè¦ç®¡ç†å‘˜æƒé™çš„ï¼Œè€Œubuntuåˆä¸æƒ³ç»™æ™®é€šç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚æ‰€ä»¥è¿™é‡Œå¼€å¯rootè´¦å·</p>
<h2 id="é¦–å…ˆè®¾ç½®-root-å¯†ç "><a href="#é¦–å…ˆè®¾ç½®-root-å¯†ç " class="headerlink" title="é¦–å…ˆè®¾ç½® root å¯†ç "></a>é¦–å…ˆè®¾ç½® root å¯†ç </h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo passwd</span><br></pre></td></tr></table></figure>
<p>ä¼šå‡ºç°ä»¥ä¸‹ç”»é¢ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[sudo] password for luban: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â //è¾“å…¥å½“å‰æ™®é€šç”¨æˆ·çš„å¯†ç </span><br><span class="line"></span><br><span class="line">Enter new UNIX password: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   //ç»™rootè®¾ç½®å¯†ç </span><br><span class="line"></span><br><span class="line">Retype new UNIX password: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //ç¡®è®¤è¾“å…¥å¯†ç </span><br><span class="line"></span><br><span class="line">passwd: password updated successfully</span><br></pre></td></tr></table></figure></p>
<h2 id="å¼€å¯root"><a href="#å¼€å¯root" class="headerlink" title="å¼€å¯root"></a>å¼€å¯root</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>
<h2 id="ä¿®æ”¹æ–‡ä»¶æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æƒé™</h2><p>ä¸ºäº†è·å¾—æ‰§è¡Œæƒé™ï¼Œå€ŸåŠ©chmodæŒ‡ä»¤ä¿®æ”¹æ–‡ä»¶æƒé™å³å¯ã€‚<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod 777 æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu16.04å®‰è£…opencvæ•™ç¨‹</title>
    <url>/2020/01/19/ubuntu16.04%E5%AE%89%E8%A3%85opencv%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>1.å»å®˜ç½‘ä¸‹è½½opencvï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­é€‰ç”¨çš„æ˜¯opencv3.4.1ï¼Œå…¶ä»–ç‰ˆæœ¬çš„é…ç½®æ–¹æ³•å¼‚æ›²åŒå·¥ã€‚<a href="http://opencv.org/releases.html">ä¸‹è½½é“¾æ¥</a>ï¼Œé€‰æ‹©sourcesç‰ˆæœ¬ </p>
<p>2.è§£å‹ä¸‹è½½ä¸‹æ¥çš„zipåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unzip opencv-3.4.1.zip</span><br></pre></td></tr></table></figure>
<p>3.è¿›å…¥åˆ°è§£å‹åçš„æ–‡ä»¶åŒ…ä¸­</p>
<p>4.å®‰è£…ä¾èµ–åº“å’Œcmake ï¼Œå¦‚æœæé†’éœ€è¦apt-get updateï¼Œé‚£å°±å…ˆsudo suè¿›å…¥rootæƒé™ï¼Œå†sudo apt-get updateï¼Œç„¶ååœ¨æ‰§è¡Œä¸‹é¢å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install cmake</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libtiff4.dev libswscale-dev libjasper-dev  </span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬äºŒæ­¥ä¸­è‹¥æç¤ºä¾èµ–ç‰ˆæœ¬é—®é¢˜ï¼ŒåŸå› åœ¨äºaptæºå¤ªæ—§ï¼Œæ›´æ¢æ–°çš„æºï¼Œå†è¿›è¡Œå®‰è£…ã€‚</p>
<p>5.å®‰è£…å®Œcmakeä¹‹åæ‰§è¡Œå‘½ä»¤ ,åˆ›å»ºç¼–è¯‘æ–‡ä»¶å¤¹ï¼Œä¸åˆ›å»ºçš„ä¼šæç¤ºï¼ˆå¦‚ä¸‹å›¾ï¼‰<br>In-source builds are not allowed.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir my_build_dir</span><br><span class="line">cd my_build_dir</span><br></pre></td></tr></table></figure>
<p>6.cmakeä¸€ä¸‹<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/local ..</span><br></pre></td></tr></table></figure><br>æ³¨æ„ï¼šå¦‚æœå·²ç»åœ¨æ–°çš„æ–‡ä»¶å¤¹ä¸­ç¼–è¯‘ï¼Œä½†æ˜¯è¿˜ä¼šå‡ºç°ä¹‹å‰çš„æŠ¥é”™ï¼ŒæŠŠcmakecache.txtåˆ äº†å†ç¼–è¯‘å°±å¯<br>æœŸé—´å¯èƒ½ä¼šä¸‹è½½ä¸€ä¸ªä¸œè¥¿ï¼Œç­‰å¾…ä¸€ä¼šå„¿å°±OK<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/opencv/20171005220631735.png" alt><br>7.æ‰§è¡Œå‘½ä»¤ï¼Œæ¼«é•¿çš„ç¼–è¯‘è¿‡ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo make</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/opencv/20171005214720292.png" alt><br>8.æ‰§è¡Œå‘½ä»¤<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo make install</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/opencv/20171005214847504.png" alt><br>9.sudo make install æ‰§è¡Œå®Œæ¯•åOpenCVç¼–è¯‘è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦é…ç½®ä¸€äº›OpenCVçš„ç¼–è¯‘ç¯å¢ƒé¦–å…ˆå°†OpenCVçš„åº“æ·»åŠ åˆ°è·¯å¾„ï¼Œä»è€Œå¯ä»¥è®©ç³»ç»Ÿæ‰¾åˆ°<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/ld.so.conf.d/opencv.conf </span><br></pre></td></tr></table></figure><br>æ‰§è¡Œæ­¤å‘½ä»¤åæ‰“å¼€çš„å¯èƒ½æ˜¯ä¸€ä¸ªç©ºç™½çš„æ–‡ä»¶ï¼Œä¸ç”¨ç®¡ï¼Œåªéœ€è¦åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ <br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/local/lib  </span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/opencv/20171005215009149.png" alt><br>10.æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿å¾—åˆšæ‰çš„é…ç½®è·¯å¾„ç”Ÿæ•ˆ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ldconfig  </span><br></pre></td></tr></table></figure><br>11.é…ç½®bash<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/bash.bashrc  </span><br></pre></td></tr></table></figure><br>åœ¨æœ€æœ«å°¾æ·»åŠ <br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig  </span><br><span class="line">export PKG_CONFIG_PATH  </span><br></pre></td></tr></table></figure><br>ä¿å­˜ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿å¾—é…ç½®ç”Ÿæ•ˆ<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source /etc/bash.bashrc  </span><br></pre></td></tr></table></figure><br>æ›´æ–°<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo updatedb  </span><br></pre></td></tr></table></figure><br>12.è‡³æ­¤æ‰€æœ‰çš„é…ç½®éƒ½å·²ç»å®Œæˆ<br>ä¸‹é¢ç”¨ä¸€ä¸ªå°ç¨‹åºæµ‹è¯•ä¸€ä¸‹<br>cdåˆ°opencv-3.4.1/samples/cpp/example_cmakeç›®å½•ä¸‹<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç›®å½•é‡Œå®˜æ–¹å·²ç»ç»™å‡ºäº†ä¸€ä¸ªcmakeçš„exampleæˆ‘ä»¬å¯ä»¥æ‹¿æ¥æµ‹è¯•ä¸‹<br>æŒ‰é¡ºåºæ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">./opencv_example</span><br></pre></td></tr></table></figure>
<p>å³å¯çœ‹åˆ°æ‰“å¼€äº†æ‘„åƒå¤´ï¼Œåœ¨å·¦ä¸Šè§’æœ‰ä¸€ä¸ªhello opencv<br>å³è¡¨ç¤ºé…ç½®æˆåŠŸ</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Opencv</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu16.04ä¸‹Tensorflow-gpuå®‰è£…</title>
    <url>/2019/12/14/Ubuntu16.04%E4%B8%8BTensorflow-gpu%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆç¡®å®šå®‰è£…å¥½æ˜¾å¡é©±åŠ¨ã€CUDAã€cuDNNï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a href="https://qiyuan-z.github.io/2019/03/19/Ubuntu-16.04ä¸‹é…ç½®GPUç‰ˆCUDAå’ŒcuDNN/">å¦ä¸€ç¯‡åšå®¢</a></p>
<ol>
<li>å®‰è£…Numpy<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install numpy</span><br></pre></td></tr></table></figure></li>
<li>å®‰è£…Tensorflow-gpu<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install tensorflow-gpu</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Python</tag>
        <tag>Tensorflow</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu aptæ›´æ¢ä¸ºå›½å†…çš„æº</title>
    <url>/2020/01/19/ubuntu-apt%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%9B%BD%E5%86%85%E7%9A%84%E6%BA%90/</url>
    <content><![CDATA[<p>å¤‡ä»½åŸæ¥çš„æºï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></pre></td></tr></table></figure><br>æ›´æ¢æº:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo gedit /etc/apt/sources.list</span><br></pre></td></tr></table></figure><br>å°†é‡Œé¢æ–‡ä»¶å†…å®¹å…¨éƒ¨æ›¿æ¢æˆä¸‹é¢ï¼š<br><a href="https://wiki.ubuntu.org.cn/%E6%A8%A1%E6%9D%BF:16.04source">ç‚¹å‡»æ­¤å¤„è·å¾—æœ€æ–°æº</a><br>ä¿å­˜é€€å‡º<br>æ‰§è¡Œæ›´æ–°ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¹ç›®å½•/var/lib/apt/lists/åŠ é”é—®é¢˜è§£å†³æ–¹æ³•</title>
    <url>/2020/01/19/%E5%AF%B9%E7%9B%AE%E5%BD%95varlibaptlists%E5%8A%A0%E9%94%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo rm /var/lib/apt/lists/lock</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å®‰è£…æ›´æ–°pip</title>
    <url>/2019/12/13/Ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85%E6%9B%B4%E6%96%B0pip/</url>
    <content><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install python-pip</span><br></pre></td></tr></table></figure>
<p>è‹¥åŒæ—¶è£…æœ‰Python2ã€Python3ä¸Šæ¡å‘½ä»¤è£…çš„æ˜¯pip2ï¼Œè‹¥è¿˜éœ€è£…pip3ï¼Œåˆ™å†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br></pre></td></tr></table></figure></p>
<h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>å®‰è£…æˆåŠŸåè¿›è¡Œæ›´æ–°ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pip install --upgrade pip</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pip3 install --upgrade pip</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è§£å†³å‡ºç° unable to resolve host é—®é¢˜</title>
    <url>/2019/12/21/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%87%BA%E7%8E%B0unable-to-resolve-host%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>Ubuntuç¯å¢ƒï¼Œæœ‰æ—¶å€™æ‰§è¡Œsudo å°±å‡ºç°è¿™ä¸ªè­¦å‘Šè®¯æ¯: </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo: unable to resolve host abcÂ </span><br></pre></td></tr></table></figure>
<p>è™½ç„¶sudo è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œ, ä½†æ˜¯çœ‹åˆ°è¿™æ ·çš„é€šçŸ¥è¿˜æ˜¯ä¼šè§‰å¾—çƒ¦ï¼Œæ€ä¹ˆå»é™¤è¿™ä¸ªè­¦å‘Šå‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªè­¦å‘Šæ˜¯å› ä¸ºç³»ç»Ÿæ‰¾ä¸åˆ°ä¸€ä¸ªå«åšabcçš„hostname </p>
<p>é€šè¿‡ ä¿®æ”¹ /etc/hosts è®¾å®š, å¯ä»¥è§£å†³<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nano /etc/hostname</span><br></pre></td></tr></table></figure></p>
<p>åœ¨127.0.0.1 localhost åé¢åŠ ä¸Šä¸»æœºåç§°(hostname) å³å¯:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1 localhost abc</span><br></pre></td></tr></table></figure><br>é—®é¢˜è§£å†³ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å¦‚ä½•å®‰è£…æœç‹—è¾“å…¥æ³•</title>
    <url>/2019/12/13/sougou/</url>
    <content><![CDATA[<h2 id="Ubuntuç³»ç»Ÿé…ç½®"><a href="#Ubuntuç³»ç»Ÿé…ç½®" class="headerlink" title="Ubuntuç³»ç»Ÿé…ç½®"></a>Ubuntuç³»ç»Ÿé…ç½®</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">system settings-&gt;language support-&gt;install/remove languages</span><br></pre></td></tr></table></figure>
<p>åœ¨å¼¹å‡ºçš„èœå•ä¸­é€‰æ‹©Chinese(simplified),ç‚¹å‡»apply<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/20180729142927736.png" alt><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/20180729142927712.png" alt></p>
<h2 id="é…ç½®è¾“å…¥æ³•æ¡†æ¶"><a href="#é…ç½®è¾“å…¥æ³•æ¡†æ¶" class="headerlink" title="é…ç½®è¾“å…¥æ³•æ¡†æ¶"></a>é…ç½®è¾“å…¥æ³•æ¡†æ¶</h2><p>æœç‹—è¾“å…¥æ³•æ˜¯å»ºç«‹åœ¨fcitxæ¡†æ¶ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥è¦å°†è¾“å…¥æ³•æ¡†æ¶é€‰æ‹©ä¸ºfictx<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/20180729142927666.png" alt><br>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰fcitxé€‰é¡¹ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å®‰è£…fcitxæ¡†æ¶ä¹‹ååœ¨è¿›è¡Œé…ç½®ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:fcitx-team/nightly Â  //æ·»åŠ FCITXä»“åº“</span><br><span class="line"></span><br><span class="line">sudo apt-get updateÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  //æ›´æ–°ä»“åº“</span><br><span class="line"></span><br><span class="line">sudo apt-get install fcitxÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â  //å®‰è£…fcitxè¾“å…¥æ³•æ¡†æ¶</span><br></pre></td></tr></table></figure>
<p>é…ç½®å¥½è¾“å…¥æ³•æ¡†æ¶ä¹‹åï¼Œé‡å¯ubuntuç³»ç»Ÿã€‚é‡å¯ä¹‹åå¦‚æœé…ç½®æˆåŠŸï¼Œåœ¨ä»»åŠ¡æ çš„å³ä¸Šè§’ä¼šå‡ºç°fcitxçš„è®¾ç½®é€‰é¡¹ï¼ˆä¸€ä¸ªå°é”®ç›˜å›¾æ ‡ï¼‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/20180729142927651.png" alt></p>
<h2 id="å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for-Linux"><a href="#å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for-Linux" class="headerlink" title="å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for Linux"></a>å»æœç‹—å®˜ç½‘ä¸‹è½½è¾“å…¥æ³•for Linux</h2><p><a href="https://pinyin.sogou.com/linux/">å®˜æ–¹ä¸‹è½½</a><br><a href="https://www.jianguoyun.com/p/DeShNo0QlZ_3Bhic5rAC">ç½‘ç›˜ä¸‹è½½</a><br>ä¸‹è½½å®Œæˆä¹‹åï¼Œåœ¨downloadç›®å½•ä¸‹æ‰¾åˆ°ä¸‹è½½çš„æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…å³å¯ï¼Œç‚¹å‡»installå³å¯<br>æˆ–è€…åœ¨ç»ˆç«¯çš„å‘½ä»¤çª—å£ä¸­è¾“å…¥å¦‚ä¸‹çš„æŒ‡ä»¤å®‰è£…ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i å®‰è£…åŒ…åç§°.deb</span><br></pre></td></tr></table></figure><br>å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°ç›¸å…³ä¾èµ–æ–‡ä»¶çš„é”™è¯¯ã€‚åˆ™éœ€è¦å…ˆå®‰è£…å…¶ä¾èµ–çš„è½¯ä»¶åŒ…<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/Snipaste_2019-12-13_14-33-14.jpg" alt><br>åœ¨ç»ˆç«¯çª—å£æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…ç¼ºå°‘çš„ä¾èµ–æ–‡ä»¶:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/Snipaste_2019-12-13_14-33-49.jpg" alt><br>å®‰è£…å®Œæˆåï¼Œé¦–å…ˆæ‰“å¼€å³ä¸Šè§’ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç¬¬ä¸€è¡Œçš„æœ€åä¸€ä¸ªé€‰é¡¹â€Text Entryâ€œï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„+å·ï¼Œåœ¨æ‰“å¼€çš„çª—å£ä¸­æ‰¾åˆ°æœç‹—è¾“å…¥æ³•Sogou pinyinç‚¹å‡»Addæ·»åŠ è¿›å»<br>ä»…æ˜¾ç¤ºå½“å‰è¯­è¨€ä¸€å®šè¦å»æ‰é‚£ä¸ªå‹¾ï¼Œæ‰å¯ä»¥æ‰¾åˆ°æœç‹—è¾“å…¥æ³•ï¼Œç„¶åæ·»åŠ å°±æ˜¯<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/sougou/2019050512074094.png" alt><br>è¿™æ—¶å°±å¯ä»¥åœ¨å³ä¸Šæ–¹å°é”®ç›˜é€‰æ‹©æœç‹—è¾“å…¥æ³•äº†ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸‹å¦‚ä½•æ·»åŠ æ–°ç”¨æˆ·å¹¶å¢åŠ ç®¡ç†å‘˜æƒé™</title>
    <url>/2019/12/12/Ubuntu%E4%B8%8B%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7%E5%B9%B6%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<h2 id="æ·»åŠ æ–°ç”¨æˆ·"><a href="#æ·»åŠ æ–°ç”¨æˆ·" class="headerlink" title="æ·»åŠ æ–°ç”¨æˆ·"></a>æ·»åŠ æ–°ç”¨æˆ·</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo adduser xxx #xxxä¸ºç”¨æˆ·å</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥å¯†ç åï¼Œå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ­£åœ¨æ·»åŠ ç”¨æˆ·&quot;xxx&quot;â€¦</span><br><span class="line">æ­£åœ¨æ·»åŠ æ–°ç»„&quot;xxx&quot; (1003)â€¦</span><br><span class="line">æ­£åœ¨æ·»åŠ æ–°ç”¨æˆ·&quot;xxx&quot; (1003) åˆ°ç»„&quot;xxx&quot;â€¦</span><br><span class="line">åˆ›å»ºä¸»ç›®å½•&quot;/home/xxx&quot;â€¦</span><br><span class="line">æ­£åœ¨ä»&quot;/etc/skel&quot;å¤åˆ¶æ–‡ä»¶â€¦</span><br><span class="line">è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">é‡æ–°è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">passwdï¼šå·²æˆåŠŸæ›´æ–°å¯†ç </span><br><span class="line">æ­£åœ¨æ”¹å˜ xxx çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">è¯·è¾“å…¥æ–°å€¼ï¼Œæˆ–ç›´æ¥æ•²å›è½¦ä»¥ä½¿ç”¨é»˜è®¤å€¼</span><br><span class="line">        å…¨å [ ]ï¼š</span><br><span class="line">        æˆ¿é—´å·ç  [ ]ï¼š</span><br><span class="line">        å·¥ä½œç”µè¯ [ ]ï¼š</span><br><span class="line">        å®¶åº­ç”µè¯ [ ]ï¼š</span><br><span class="line">        å…¶å®ƒ [ ]ï¼š</span><br><span class="line">è¿™äº›ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Ÿ [Y/n] y</span><br></pre></td></tr></table></figure><br>åˆ°è¿™é‡Œï¼Œæ–°ç”¨æˆ·æ·»åŠ æˆåŠŸã€‚</p>
<h2 id="å¢åŠ ç®¡ç†å‘˜æƒé™"><a href="#å¢åŠ ç®¡ç†å‘˜æƒé™" class="headerlink" title="å¢åŠ ç®¡ç†å‘˜æƒé™"></a>å¢åŠ ç®¡ç†å‘˜æƒé™</h2><p>éœ€è¦è®©æ­¤ç”¨æˆ·æœ‰rootæƒé™ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/sudoers</span><br></pre></td></tr></table></figure><br>å¾€ä¸‹æ‹‰ï¼Œä¿®æ”¹æ–‡ä»¶å¹¶æ·»åŠ ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xxx ALL=(ALLï¼šALL) ALL #xxxä¸ºä½ ä¹‹å‰æ‰€åˆ›çš„ç”¨æˆ·å</span><br></pre></td></tr></table></figure><br>æ·»åŠ å®ŒæˆæŒ‰ä¸‹Ctrl + Xä¿å­˜å¹¶é€€å‡ºï¼Œå†æ¬¡æŒ‰ä¸‹Enter,å®Œæˆ<br>ç°åœ¨ä½ å¯ä»¥ç‚¹å‡»å³ä¸Šè§’ï¼Œçœ‹åˆ°ä½ æ–°åˆ›çš„ç”¨æˆ·ï¼Œç‚¹å‡»å¹¶åˆ‡æ¢äº†ï¼</p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorchå¿«é€Ÿå®‰è£…æ•™ç¨‹</title>
    <url>/2020/01/26/Pytorch%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>è¿›å…¥<a href="https://pytorch.org/">å®˜ç½‘</a>ï¼ŒæŒ‰ç…§ä½ çš„ç¯å¢ƒé€‰æ‹©ï¼Œå¾—åˆ°ä¸‹è½½å‘½ä»¤ï¼Œè¿™é‡Œä»¥windowsä¸ºä¾‹ï¼ŒUbuntuåŒç†</p>
<h2 id="condaå®‰è£…"><a href="#condaå®‰è£…" class="headerlink" title="condaå®‰è£…"></a>condaå®‰è£…</h2><p>å®˜ç½‘å¾—åˆ°å‘½ä»¤å¦‚å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pytorch_install/Snipaste_2020-01-26_14-06-32.jpg" alt><br>ä½†ç”±äºå¢™çš„åŸå› ç›´æ¥ä½¿ç”¨æ­¤å‘½ä»¤ä¸‹è½½å¾ˆæ…¢ï¼Œå› æ­¤è¯·æ›´æ¢condaæºä¸ºå›½å†…é•œåƒ<br>å¹¶å°†å‘½ä»¤ä¸­ -c pytorchå»æ‰<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">conda install pytorch torchvision cudatoolkit=10.1</span><br></pre></td></tr></table></figure><br>å³å¯è°ƒç”¨å›½å†…é•œåƒä¸‹è½½ã€‚</p>
<h2 id="pipå®‰è£…"><a href="#pipå®‰è£…" class="headerlink" title="pipå®‰è£…"></a>pipå®‰è£…</h2><p>å®˜ç½‘å¾—åˆ°å‘½ä»¤å¦‚å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pytorch_install/Snipaste_2020-01-26_14-06-05.jpg" alt><br>çº¢è‰²æ¡†å‡ºéƒ¨åˆ†ä¸ºå®˜ç½‘å»ºè®®ç‰ˆæœ¬ï¼Œä½†ç”±äºå¢™çš„åŸå› ç›´æ¥ä½¿ç”¨æ­¤å‘½ä»¤ä¸‹è½½å¾ˆæ…¢ï¼Œå› æ­¤å°†pipä¸‹è½½åœ°å€æ”¹æˆå›½å†…é•œåƒå³å¯<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip3 install torch==1.4.0 torchvision==0.5.0 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Pytorch</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>å·ç§¯å±‚æœ‰å“ªäº›å‚æ•°åŠå¸¸ç”¨å·ç§¯æ ¸ç±»å‹ç›˜ç‚¹</title>
    <url>/2020/03/04/%E5%8D%B7%E7%A7%AF%E5%B1%82%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8F%82%E6%95%B0%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%8D%B7%E7%A7%AF%E6%A0%B8%E7%B1%BB%E5%9E%8B%E7%9B%98%E7%82%B9/</url>
    <content><![CDATA[<h2 id="å·ç§¯æ ¸çš„åŸºæœ¬å‚æ•°"><a href="#å·ç§¯æ ¸çš„åŸºæœ¬å‚æ•°" class="headerlink" title="å·ç§¯æ ¸çš„åŸºæœ¬å‚æ•°"></a>å·ç§¯æ ¸çš„åŸºæœ¬å‚æ•°</h2><p>å·ç§¯ç¥ç»ç½‘ç»œçš„æ ¸å¿ƒæ“ä½œå°±æ˜¯å·ç§¯å±‚ï¼Œè¿™é‡Œä»¥caffeæ¡†æ¶ä¸ºä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹å·ç§¯æ ¸éƒ½æœ‰å“ªäº›åŸºæœ¬çš„å‚æ•°ã€‚ä¸‹é¢å…ˆä¸Šä¸€æ®µä»£ç ï¼Œæ˜¯caffeçš„å·ç§¯å±‚çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  name: &quot;conv1&quot;</span><br><span class="line">  type: &quot;Convolution&quot;</span><br><span class="line">  bottom: &quot;data&quot;</span><br><span class="line">  top: &quot;conv1&quot;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 1</span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 2</span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: 20</span><br><span class="line">    kernel_size: 5</span><br><span class="line">    stride: 1</span><br><span class="line">    weight_filler &#123;</span><br><span class="line">      type: &quot;xavier&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    bias_filler &#123;</span><br><span class="line">      type: &quot;constant&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·ç§¯å±‚çš„å‚æ•°æœ‰ï¼š</p>
<ul>
<li><code>lr_mult</code>ï¼šå­¦ä¹ ç‡çš„ç³»æ•°ï¼Œæœ€ç»ˆçš„å­¦ä¹ ç‡æ˜¯è¿™ä¸ªå‚æ•°ä¹˜ä»¥caffeçš„solver.prototxté…ç½®æ–‡ä»¶ä¸­çš„åŸºç¡€å­¦ä¹ ç‡<code>base_lr</code>ã€‚å¦‚æœæœ‰2ä¸ª<code>lr_mult</code>ï¼Œåˆ™ç¬¬ä¸€ä¸ªè¡¨ç¤ºæƒå€¼çš„å­¦ä¹ ç‡ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºåç½®é¡¹çš„å­¦ä¹ ç‡ã€‚ä¸€èˆ¬åç½®é¡¹çš„å­¦ä¹ ç‡æ˜¯æƒå€¼é¡¹çš„å­¦ä¹ ç‡çš„2å€ã€‚</li>
<li><code>num_output</code>ï¼šå·ç§¯æ ¸çš„è¾“å‡ºé€šé“æ•°ã€‚è‹¥è®¾ç½®ä¸ºä¸è¾“å…¥é€šé“æ•°ä¸€æ ·çš„å¤§å°ï¼Œå¯ä»¥ä¿æŒè¾“å…¥è¾“å‡ºç»´åº¦çš„ä¸€è‡´æ€§ï¼›è‹¥é‡‡ç”¨æ¯”è¾“å…¥é€šé“æ•°æ›´å°çš„å€¼ï¼Œåˆ™å¯ä»¥å‡å°‘æ•´ä½“ç½‘ç»œçš„å‚æ•°é‡</li>
<li><code>kernel_size</code>ï¼šå·ç§¯æ ¸çš„å¤§å°ã€‚å¦‚æœå·ç§¯æ ¸çš„é•¿å’Œå®½ä¸ç­‰ï¼Œéœ€è¦ç”¨<code>kernel_h</code>å’Œ<code>kernel_w</code>åˆ†åˆ«è®¾å®šå…¶å®ƒå‚æ•°ã€‚</li>
<li><code>stride</code>ï¼šå·ç§¯æ ¸çš„æ­¥é•¿ï¼Œé»˜è®¤ä¸º1ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>stride_h</code>å’Œ<code>stride_w</code>æ¥è®¾ç½®ã€‚</li>
<li><p><code>pad</code>ï¼šæ‰©å……è¾¹ç¼˜ï¼Œé»˜è®¤ä¸º0ï¼Œä¸æ‰©å……ã€‚æ‰©å……çš„æ—¶å€™æ˜¯å·¦å³ã€ä¸Šä¸‹å¯¹ç§°çš„ï¼Œæ¯”å¦‚å·ç§¯æ ¸çš„å¤§å°ä¸º5 x 5ï¼Œé‚£ä¹ˆ<code>pad</code>è®¾ç½®ä¸º2ï¼Œåˆ™å››ä¸ªè¾¹ç¼˜éƒ½æ‰©å……2ä¸ªåƒç´ ï¼Œå³å®½åº¦å’Œé«˜åº¦éƒ½æ‰©å……äº†4ä¸ªåƒç´ ,è¿™æ ·å·ç§¯è¿ç®—ä¹‹åçš„ç‰¹å¾å›¾å°±ä¸ä¼šå˜å°ã€‚ä¹Ÿå¯ä»¥é€šè¿‡<code>pad_h</code>å’Œ<code>pad_w</code>æ¥åˆ†åˆ«è®¾å®šã€‚</p>
</li>
<li><p><code>weight_filler</code>ï¼šæƒé‡åˆå§‹åŒ–æ–¹å¼ã€‚æœ‰<code>xavier</code>ï¼Œ<code>gaussian</code>ï¼ŒåŠ<code>constant</code>ç­‰æ–¹å¼ã€‚</p>
</li>
<li><p><code>bias_filler</code>: åç½®é¡¹çš„åˆå§‹åŒ–ã€‚ä¸€èˆ¬è®¾ç½®ä¸º<code>constant</code>,å€¼å…¨ä¸º0ã€‚</p>
</li>
<li><p><code>bias_term</code>ï¼šæ˜¯å¦å¼€å¯åç½®é¡¹ï¼Œé»˜è®¤ä¸ºtrueï¼Œå¼€å¯ã€‚</p>
</li>
<li><p><code>group</code>ï¼šåˆ†ç»„ï¼Œé»˜è®¤ä¸º1ç»„ã€‚å¦‚æœå¤§äº1ï¼Œæˆ‘ä»¬é™åˆ¶å·ç§¯çš„è¿æ¥æ“ä½œåœ¨ä¸€ä¸ªå­é›†å†…ã€‚å¦‚æœæˆ‘ä»¬æ ¹æ®å›¾åƒçš„é€šé“æ¥åˆ†ç»„ï¼Œé‚£ä¹ˆç¬¬<code>i</code>ä¸ªè¾“å‡ºåˆ†ç»„åªèƒ½ä¸ç¬¬<code>i</code>ä¸ªè¾“å…¥åˆ†ç»„è¿›è¡Œè¿æ¥ã€‚</p>
</li>
<li><p><code>num_input</code>ï¼šè¾“å…¥é€šé“æ•°ï¼Œè¿™ä¸ªåŒ…å«åœ¨bottomä¸­ï¼Œæ‰€ä»¥å®é™…ä¸Šæ²¡æœ‰è¿™ä¸ªå‚æ•°å“¦ï¼Œåªæ˜¯å¯ä»¥è¿™æ ·ç†è§£ã€‚</p>
</li>
</ul>
<p>ç°åœ¨è®¾è¾“å…¥é€šé“æ•°ä¸º<code>c0</code>ï¼Œè¾“å‡ºé€šé“æ•°ä¸º<code>c1</code>ï¼Œé‚£ä¹ˆè¾“å…¥å¯ä»¥è¡¨ç¤ºä¸º$[n, c 0, w 0, h 0]$ï¼Œè¾“å‡ºå¯ä»¥è¡¨ç¤ºä¸ºï¼š$[n, c 1, w 1, h 1]$ã€‚å…¶ä¸­$w 0, h 0$è¡¨ç¤ºè¾“å…¥ç‰¹å¾å›¾çš„é•¿å®½ï¼Œé‚£ä¹ˆè¾“å‡ºç‰¹å¾å›¾çš„é•¿å®½$w 1, h 1$å¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼è®¡ç®—ï¼š  </p>
<script type="math/tex; mode=display">
w 1=\left(w 0+2 \times p a d-k e r n e l_{w}\right) / s t r i d e+1</script><script type="math/tex; mode=display">
h 1=\left(h 0+2 \times p a d-\text {kernel}_{h}\right) /stride+1</script><p>å¦‚æœå°†<code>stride</code>è®¾ä¸º1ï¼Œå‰åä¸¤æ¬¡å·ç§¯éƒ¨åˆ†å­˜åœ¨é‡å ï¼Œå¦‚æœè®¾ç½®<code>pad=(kernel_size-1)/2</code>ï¼Œé‚£ä¹ˆè¾“å‡ºç‰¹å¾å›¾çš„é«˜å®½éƒ½ä¸å˜ã€‚</p>
<h2 id="å¸¸ç”¨å·ç§¯æ ¸ç±»å‹ç›˜ç‚¹"><a href="#å¸¸ç”¨å·ç§¯æ ¸ç±»å‹ç›˜ç‚¹" class="headerlink" title="å¸¸ç”¨å·ç§¯æ ¸ç±»å‹ç›˜ç‚¹"></a>å¸¸ç”¨å·ç§¯æ ¸ç±»å‹ç›˜ç‚¹</h2><p>å·ç§¯æ ¸çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œåœ¨å·¥ä¸šä¸Šåšçš„ä¸€äº›ä»»åŠ¡æ¥çœ‹ï¼Œæœ€å¸¸ç”¨çš„å·ç§¯æ ¸ç±»å‹å¤§æ¦‚æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†å·ç§¯ï¼Œæ‰©å¼ å·ç§¯ï¼Œè½¬ç½®å·ç§¯å’Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€‚è¿™é‡Œè¦å…ˆè¯´ä¸€ä¸ªæ„Ÿå—é‡çš„æ¦‚å¿µï¼Œæ‰€è°“æ„Ÿå—é‡å°±æ˜¯æ˜¯å·ç§¯ç¥ç»ç½‘ç»œæ¯ä¸€å±‚è¾“å‡ºçš„ç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ä¸Šçš„åƒç´ ç‚¹åœ¨è¾“å…¥å›¾ç‰‡ä¸Šæ˜ å°„çš„åŒºåŸŸå¤§å°ã€‚å†é€šä¿—ç‚¹çš„è§£é‡Šæ˜¯ï¼Œç‰¹å¾å›¾ä¸Šçš„ä¸€ä¸ªç‚¹å¯¹åº”è¾“å…¥å›¾ä¸Šçš„åŒºåŸŸã€‚</p>
<h3 id="æ ‡å‡†å·ç§¯"><a href="#æ ‡å‡†å·ç§¯" class="headerlink" title="æ ‡å‡†å·ç§¯"></a>æ ‡å‡†å·ç§¯</h3><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å·ç§¯ï¼Œè¿ç»­ç´§å¯†çš„çŸ©é˜µå½¢å¼å¯ä»¥æå–å›¾åƒåŒºåŸŸä¸­ç›¸é‚»åƒç´ ä¹‹é—´çš„å…³è”æ€§ï¼Œä¾‹å¦‚ä¸€ä¸ª3 x 3çš„å·ç§¯æ ¸å¯ä»¥è·å¾—3 x 3çš„æ„Ÿå—é‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/640.webp" alt></p>
<h3 id="è½¬ç½®å·ç§¯"><a href="#è½¬ç½®å·ç§¯" class="headerlink" title="è½¬ç½®å·ç§¯"></a>è½¬ç½®å·ç§¯</h3><p>è½¬ç½®å·ç§¯æ˜¯å…ˆå¯¹åŸå§‹ç‰¹å¾çŸ©é˜µè¿›è¡Œå¡«å……ä½¿å…¶ç»´åº¦æ‰©å¤§åˆ°ç›®æ ‡è¾“å‡ºç»´åº¦ï¼Œç„¶åè¿›è¡Œæ™®é€šçš„å·ç§¯æ“ä½œçš„è¿‡ç¨‹ï¼Œå…¶è¾“å…¥åˆ°è¾“å‡ºçš„ç»´åº¦å˜æ¢å…³ç³»æ°å¥½å’Œæ™®é€šçš„å·ç§¯å˜æ¢å…³ç³»ç›¸åï¼Œä½†è¿™ä¸ªå˜æ¢å¹¶ä¸æ˜¯å·ç§¯çœŸæ­£çš„é€†å˜æ¢æ“ä½œï¼Œæˆ‘ä»¬é€šå¸¸å°†å…¶ç§°ä¸ºè½¬ç½®å·ç§¯(Transpose  Convolution)è€Œä¸æ˜¯åå·ç§¯(Deconvolution)ã€‚è½¬ç½®å·ç§¯å¸¸è§äºç›®æ ‡æ£€æµ‹é¢†åŸŸä¸­å¯¹å°ç›®æ ‡çš„æ£€æµ‹ä»¥åŠå›¾åƒåˆ†å‰²é¢†åŸŸè¿˜åŸè¾“å…¥å›¾åƒå°ºåº¦å¦‚FCNä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­ä¸‹å›¾æ˜¯è¾“å…¥ï¼Œä¸Šå›¾æ˜¯è¾“å‡ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/641.webp" alt></p>
<h3 id="æ‰©å¼ å·ç§¯ï¼ˆå¸¦å­”å·ç§¯æˆ–ç©ºæ´å·ç§¯ï¼‰"><a href="#æ‰©å¼ å·ç§¯ï¼ˆå¸¦å­”å·ç§¯æˆ–ç©ºæ´å·ç§¯ï¼‰" class="headerlink" title="æ‰©å¼ å·ç§¯ï¼ˆå¸¦å­”å·ç§¯æˆ–ç©ºæ´å·ç§¯ï¼‰"></a>æ‰©å¼ å·ç§¯ï¼ˆå¸¦å­”å·ç§¯æˆ–ç©ºæ´å·ç§¯ï¼‰</h3><p>è¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„å·ç§¯ï¼Œå¼•å…¥äº†ä¸€ä¸ªç§°ä¸ºæ‰©å±•ç‡(Dilation Rate)çš„å‚æ•°ï¼Œä½¿å¾—åŒæ ·å°ºå¯¸çš„å·ç§¯æ ¸å¯ä»¥è·å¾—æ›´å¤§çš„æ„Ÿå—é‡ï¼Œç›¸åº”çš„åœ¨ç›¸åŒæ„Ÿå—è§†é‡çš„å‰æä¸‹æ¯”æ™®é€šå·ç§¯é‡‡ç”¨æ›´å°‘çš„å‚æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒåŒæ ·æ˜¯3 x 3å·ç§¯æ ¸ï¼Œæ‰©å¼ å·ç§¯å¯ä»¥è·å¾—èŒƒå›´çš„åŒºåŸŸç‰¹å¾ï¼Œåœ¨å›¾åƒåˆ†å‰²é¢†åŸŸè¢«å¹¿æ³›åº”ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/642.webp" alt></p>
<h3 id="æ·±åº¦å¯åˆ†ç¦»å·ç§¯"><a href="#æ·±åº¦å¯åˆ†ç¦»å·ç§¯" class="headerlink" title="æ·±åº¦å¯åˆ†ç¦»å·ç§¯"></a>æ·±åº¦å¯åˆ†ç¦»å·ç§¯</h3><p>è¿™æ˜¯åœ¨è½»é‡çº§æ¨¡å‹ç®—æ³•ä¼˜åŒ–ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ä¸€ç§å·ç§¯æ–¹å¼ï¼Œæ ‡å‡†çš„å·ç§¯æ“ä½œæ˜¯å¯¹åŸå§‹å›¾åƒ$H \times W \times C$ä¸‰ä¸ªæ–¹å‘çš„å·ç§¯è¿ç®—ï¼Œå‡è®¾ç°åœ¨æœ‰$K$ä¸ªç›¸åŒå°ºå¯¸å·ç§¯æ ¸ï¼Œè¿™æ ·çš„æ“ä½œè®¡ç®—é‡ä¸º$H \times W \times C \times K$ä¸ªã€‚è‹¥å°†é•¿å®½ä¸æ·±åº¦æ–¹å‘çš„å·ç§¯æ“ä½œåˆ†ç¦»å‡ºå˜ä¸º$H \times W$ä¸$C$çš„ä¸¤ä¸ªå·ç§¯æ“ä½œï¼Œåˆ™åŒæ ·çš„å·ç§¯æ ¸æ•°é‡$K$ï¼Œç°åœ¨çš„è®¡ç®—é‡å˜æˆäº†$(H \times W+C) \times K$ä¸ªï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ç›¸åŒç»´åº¦çš„è¾“å‡ºã€‚æ·±åº¦å¯åˆ†ç¦»å·ç§¯åœ¨æ¨¡å‹å‹ç¼©å’Œä¸€äº›è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å·ç§¯ç¥ç»ç½‘ç»œå‚æ•°è®¾ç½®ï¼Œæé«˜æ³›åŒ–èƒ½åŠ›</title>
    <url>/2020/03/05/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE%EF%BC%8C%E6%8F%90%E9%AB%98%E6%B3%9B%E5%8C%96%E8%83%BD%E5%8A%9B/</url>
    <content><![CDATA[<h2 id="å·ç§¯ç¥ç»ç½‘ç»œçš„å‚æ•°è®¾ç½®"><a href="#å·ç§¯ç¥ç»ç½‘ç»œçš„å‚æ•°è®¾ç½®" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œçš„å‚æ•°è®¾ç½®"></a>å·ç§¯ç¥ç»ç½‘ç»œçš„å‚æ•°è®¾ç½®</h2><p>è¿™ä¸ªä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºç›´æ¥è¯´ä¼šæŠ½è±¡ä¸€äº›ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªcaffe-ssdçš„å‚æ•°è®¾ç½®é…ç½®æ–‡ä»¶<code>solver.prototxt</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">train_net:&quot;train.prototxt&quot;</span><br><span class="line">test_net:&quot;test.prototxt&quot;</span><br><span class="line">test_iter: 299</span><br><span class="line">test_interval: 200</span><br><span class="line">base_lr: 0.01</span><br><span class="line">display: 20</span><br><span class="line">max_iter: 6720</span><br><span class="line">lr_policy: &quot;step&quot;</span><br><span class="line">gamma: 0.1</span><br><span class="line">power: 0.75</span><br><span class="line">momentum: 0.9</span><br><span class="line">weight_decay: 0.0001</span><br><span class="line">snapshot: 224</span><br><span class="line">snapshot_prefix: &quot;snapshot&quot;</span><br><span class="line">solver_mode: GPU</span><br><span class="line">device_id:0</span><br><span class="line">debug_info:false</span><br><span class="line">snapshot_after_train:true</span><br><span class="line">test_initialization:false</span><br><span class="line">average_loss:10</span><br><span class="line">iter_size:1</span><br><span class="line">stepsize:2000</span><br><span class="line">type: SGD</span><br><span class="line">eval_type:&quot;detection&quot;</span><br><span class="line">ap_version:&quot;11point&quot;</span><br><span class="line">show_per_class_result:true</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°±ä¸€ä¸ªä¸ªæ¥è§£æä¸€ä¸‹ã€‚</p>
<ul>
<li><code>train_net</code>ï¼šè®­ç»ƒçš„æ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li><code>test_net</code>ï¼šæµ‹è¯•çš„æ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li><code>test_iter</code>ï¼šç½‘ç»œçš„è¿­ä»£æµ‹è¯•æ¬¡æ•°ã€‚ç½‘ç»œä¸€æ¬¡æµ‹è¯•<code>batch_size</code>å¼ å›¾ç‰‡ï¼Œå› ä¸ºä¸ºäº†å¯ä»¥å°†éªŒè¯é›†ä¸­æ‰€æœ‰å›¾ç‰‡éƒ½æµ‹è¯•ä¸€æ¬¡ï¼Œè¿™ä¸ªå‚æ•°ä¹˜ä»¥<code>batch_size</code>åº”è¯¥ç­‰äºéªŒè¯é›†ä¸­çš„å›¾ç‰‡æ•°ã€‚</li>
<li><code>test_interval</code>ï¼šç½‘ç»œè¿­ä»£å¤šå°‘æ¬¡è¿›è¡Œä¸€æ¬¡æµ‹è¯•ã€‚ä¸€æ¬¡è¿­ä»£å³æ˜¯å°†ä¸€ä¸ª<code>batch_size</code>çš„å›¾ç‰‡è¿›è¡Œè®­ç»ƒã€‚è¿™ä¸ªæ–‡ä»¶ä¸­<code>test_interval</code>è®¾ä¸ºäº†<code>200</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯éš”<code>200</code>æ¬¡å¯¹ç½‘ç»œçš„å‡†ç¡®ç‡è¿›è¡Œä¸€æ¬¡éªŒè¯ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å°†è®­ç»ƒé›†åˆä¸­çš„æ‰€æœ‰å›¾ç‰‡éƒ½è·‘ä¸€æ¬¡å†å¯¹å‡†ç¡®ç‡è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯<code>test_interval</code>ä¹˜ä»¥<code>batch_size</code>ä¸å°äºè®­ç»ƒé›†ä¸­çš„å›¾ç‰‡æ€»æ•°ã€‚</li>
<li><code>base_lr</code>ï¼šè¡¨ç¤ºç½‘ç»œçš„åŸºç¡€å­¦ä¹ ç‡ï¼Œå­¦ä¹ ç‡è¿‡é«˜å¯èƒ½ä¼šæ— æ³•æ¢¯åº¦ä¸‹é™ï¼Œlossä¿æŒä¸å˜ï¼Œä¹Ÿå¯èƒ½lossä¸èƒ½æ”¶æ•›ã€‚è€Œå­¦ä¹ ç‡è¿‡ä½ä¼šä½¿ç½‘ç»œæ”¶æ•›é€Ÿåº¦ç¼“æ…¢ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚ä¸€èˆ¬åˆå§‹å­¦ä¹ ç‡è®¾ä¸º<code>0.01</code>ã€‚</li>
<li><code>display</code>ï¼šæ¯éš”å¤šå°‘æ¬¡æ˜¾ç¤ºä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯åœ¨å±å¹•ä¸Šæ‰“å°ä¸€æ¬¡<code>loss</code>å’Œå‡†ç¡®ç‡ã€‚</li>
<li><code>max_iter</code>ï¼šç½‘ç»œçš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚è®­ç»ƒé›†ä¸­çš„å›¾ç‰‡éœ€è¦è®­ç»ƒå¤šæ¬¡ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ¯”è¾ƒå¤§ã€‚</li>
<li><code>lr_policy</code>ï¼šå­¦ä¹ ç‡å˜åŒ–ç­–ç•¥ï¼Œè¿™é‡Œé¢åˆåˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š<ul>
<li><code>fixed</code>ï¼šä¿æŒ<code>base_lr</code>ä¸å˜ã€‚</li>
<li><code>step</code>ï¼šå¦‚æœè®¾ç½®ä¸º<code>step</code>,åˆ™è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª<code>stepsize</code>,  è¿”å› <code>base_lr * gamma ^ (floor(iter / stepsize))</code>,å…¶ä¸­<code>iter</code>è¡¨ç¤ºå½“å‰çš„è¿­ä»£æ¬¡æ•°ã€‚</li>
<li><code>exp</code>ï¼šè¿”å›<code>base_lr * gamma^ iter</code>ï¼Œ<code>iter</code>è¡¨ç¤ºå½“å‰çš„è¿­ä»£æ¬¡æ•°ã€‚</li>
<li><code>inv</code>: å¦‚æœè®¾ç½®ä¸º<code>inv</code>,è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª<code>power</code>, è¿”å›<code>base_lr * (1 + gamma * iter) ^ (- power)</code>ã€‚</li>
<li><code>multistep</code>ï¼šå¦‚æœè®¾ç½®ä¸º<code>multistep</code>,åˆ™è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª<code>stepvalue</code>ã€‚è¿™ä¸ªå‚æ•°å’Œ<code>step</code>å¾ˆç›¸ä¼¼ï¼Œ<code>step</code>æ˜¯å‡åŒ€ç­‰é—´éš”å˜åŒ–ï¼Œè€Œ<code>multistep</code>åˆ™æ˜¯æ ¹æ® <code>stepvalue</code>å€¼å˜åŒ–ã€‚</li>
<li><code>poly</code>ï¼šå­¦ä¹ ç‡è¿›è¡Œå¤šé¡¹å¼è¯¯å·®, è¿”å› <code>base_lr (1 - iter/max_iter) ^ (power)</code></li>
<li><code>sigmoid</code>ï¼šå­¦ä¹ ç‡è¿›è¡Œ<code>sigmod</code>è¡°å‡ï¼Œè¿”å› <code>base_lr ( 1/(1 + exp(-gamma * (iter - stepsize))))</code></li>
</ul>
</li>
<li><code>gamma</code>ï¼šå› ä¸ºè¿™é‡Œå­¦ä¹ ç‡è¡°å‡ç­–ç•¥ä¸º<code>step</code>ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®<code>gamma</code>å’Œ<code>power</code>ä¸¤ä¸ªå‚æ•°ã€‚</li>
<li><code>power</code>ï¼šåŒä¸Šã€‚</li>
<li><code>momentum</code>ï¼šä¸Šä¸€æ¬¡æ¢¯åº¦æ›´æ–°çš„æƒé‡ï¼Œä¸€èˆ¬å–å€¼åœ¨<code>0.5--0.99</code>ä¹‹é—´ã€‚é€šå¸¸è®¾ä¸º<code>0.9</code>ï¼Œ<code>momentum</code>å¯ä»¥è®©ä½¿ç”¨<code>SGD</code>çš„æ·±åº¦å­¦ä¹ æ–¹æ³•æ›´åŠ ç¨³å®šä»¥åŠå¿«é€Ÿã€‚</li>
<li><code>weight_decay</code>ï¼šæƒé‡è¡°å‡é¡¹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„ä¸€ä¸ªå‚æ•°ã€‚åœ¨æŸå¤±å‡½æ•°ä¸­ï¼Œ<code>weight decay</code>æ˜¯æ”¾åœ¨æ­£åˆ™é¡¹ï¼ˆ<code>regularization</code>ï¼‰å‰é¢çš„ä¸€ä¸ªç³»æ•°ï¼Œæ­£åˆ™é¡¹ä¸€èˆ¬æŒ‡ç¤ºæ¨¡å‹çš„å¤æ‚åº¦ï¼Œæ‰€ä»¥<code>weight decay</code>çš„ä½œç”¨æ˜¯è°ƒèŠ‚æ¨¡å‹å¤æ‚åº¦å¯¹æŸå¤±å‡½æ•°çš„å½±å“ï¼Œè‹¥<code>weight decay</code>å¾ˆå¤§ï¼Œåˆ™å¤æ‚çš„æ¨¡å‹æŸå¤±å‡½æ•°çš„å€¼ä¹Ÿå°±å¤§ã€‚</li>
<li><code>sanpshot</code>ï¼šæ¯å¤šå°‘æ¬¡ä¿å­˜ä¸€æ¬¡å­¦ä¹ çš„ç»“æœï¼Œåœ¨caffeæ¡†æ¶ä¸‹å°±æ˜¯<code>caffemodel</code>ã€‚</li>
<li><code>snapshot_prefix</code>ï¼šæ¨¡å‹ä¿å­˜çš„è·¯å¾„ã€‚</li>
<li><code>solver_model</code>ï¼šè®¾ç½®ä½¿ç”¨<code>GPU</code>è¿˜æ˜¯<code>CPU</code>è¿›è¡Œå­¦ä¹ è®­ç»ƒã€‚</li>
<li><code>device_id</code>ï¼šGPUåºåˆ—å·ï¼Œé»˜è®¤ä»<code>ï¼</code>å¼€å§‹ã€‚</li>
<li><code>debug_info</code>ï¼šæ˜¯å¦æ˜¾ç¤º<code>debug</code>ä¿¡æ¯ã€‚</li>
<li><code>snapshot_after_train</code>ï¼šæ˜¯å¦åœ¨è®­ç»ƒç»“æŸåä¿å­˜ä¸€ä¸ªsnapshotæ–‡ä»¶ã€‚ä¾¿äºä»¥åå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­è®­ç»ƒã€‚</li>
<li><code>test_initialization</code>ï¼šç¡®ä¿å†…å­˜å¯ä»¥ç”¨å¹¶è¾“å‡º<code>loss</code>çš„åˆå§‹å€¼ã€‚</li>
<li><code>average_loss</code>ï¼šæ˜¾ç¤º<code>loss</code>ä¸ºä¹‹å‰<code>average_loss</code>ä¸ª<code>loss</code>çš„å¹³å‡å€¼ã€‚</li>
<li><code>iter_size</code>ï¼šæ¯å¤„ç†<code>iter_size*batch_size</code>å¼ å›¾ç‰‡åè¿›è¡Œä¸€æ¬¡æ¢¯åº¦è®¡ç®—ã€‚</li>
<li><code>stepsize</code>ï¼šæ¯å¤šå°‘æ¬¡å­¦ä¹ ç‡é€’å‡ã€‚è¿™é‡Œæ˜¯è¿­ä»£<code>2000</code>æ¬¡å­¦ä¹ ç‡é€’å‡ã€‚</li>
<li><code>type</code>ï¼šä¼˜åŒ–ç®—æ³•çš„é€‰æ‹©ï¼Œä¸€å…±æœ‰å…­ç§å¯é€‰ï¼š<code>SGDã€AdaDeltaã€AdaGradã€Adamã€Nesterovå’ŒRMSProp</code>ã€‚é»˜è®¤ä¸º<code>SGD</code>ã€‚</li>
<li><code>eval_type</code>ï¼šè¯„ä»·ç±»å‹ã€‚</li>
<li><code>ap_version</code>ï¼šè®¡ç®—å¹³å‡å‡†ç¡®ç‡(mapå€¼)çš„æ–¹æ³•ï¼Œæœ‰<code>11pointã€MaxIntegralã€Integral</code>ä¸‰ç§ï¼Œ<code>l1point</code>æ˜¯SSDåœ¨VOC2007ä¸­è®¡ç®—APçš„æ–¹æ³•ï¼Œä½¿ç”¨äº†ç®€å•çš„å‡å€¼è®¡ç®—ã€‚<code>MaxInterral</code>æ˜¯SSDåœ¨VOC2012ä¸­ä½¿ç”¨çš„æœ€å¤§å€¼ç§¯åˆ†æ³•ã€‚<code>Integral</code>æ˜¯æ™®é€šç§¯åˆ†æ–¹æ³•ã€‚</li>
<li><code>show_per_class_result</code>ï¼šåœ¨ç»ˆç«¯è¾“å‡ºæ¯ä¸€ç±»çš„APï¼ˆæ¯ä¸€ç±»çš„æ£€æµ‹ç²¾åº¦ï¼‰ä¿¡æ¯ã€‚</li>
</ul>
<h2 id="æé«˜å·ç§¯ç¥ç»ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›"><a href="#æé«˜å·ç§¯ç¥ç»ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›" class="headerlink" title="æé«˜å·ç§¯ç¥ç»ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›"></a>æé«˜å·ç§¯ç¥ç»ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›</h2><p>åœ¨åšå·¥ç¨‹çš„æ—¶å€™å¦‚ä½•æé«˜è‡ªå·±è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æ˜¯ä¸€é¡¹å…·æœ‰æŒ‘æˆ˜æ€§åŒæ—¶ä¹Ÿæ˜¯ä¸€ä»¶å……æ»¡â€ç„å­¦â€çš„äº‹æƒ…ã€‚å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢è¿™å‡ ç‚¹ã€‚</p>
<ul>
<li>ä½¿ç”¨æ›´å¤šçš„æ•°æ®ã€‚ç«Ÿå¯èƒ½æ ‡æ³¨æ›´å¤šçš„è®­ç»ƒæ•°æ®ï¼Œè¿™æ˜¯æé«˜æ³›åŒ–èƒ½åŠ›æœ€ç†æƒ³çš„æ–¹æ³•ï¼Œæ›´å¤šçš„æ•°æ®è®©æ¨¡å‹å¾—åˆ°æ›´å……åˆ†çš„å­¦ä¹ ï¼Œè‡ªç„¶æé«˜äº†æ³›åŒ–èƒ½åŠ›ï¼Œä½†å®é™…åœºæ™¯ä¸­è€ƒè™‘åˆ°æ ‡æ³¨æˆæœ¬çš„é—®é¢˜ï¼Œå¯èƒ½å¹¶ä¸èƒ½æ— è„‘åŠ æ•°æ®ã€‚</li>
<li>ä½¿ç”¨æ›´å¤§çš„<code>batch_size</code>ã€‚åœ¨ç›¸åŒè¿­ä»£æ¬¡æ•°å’Œå­¦ä¹ ç‡çš„æ¡ä»¶ä¸‹ï¼Œæ¯æ‰¹æ¬¡é‡‡ç”¨æ›´å¤šçš„æ•°æ®å°†æœ‰åŠ©äºæ¨¡å‹æ›´å¥½çš„å­¦ä¹ åˆ°æ­£ç¡®çš„æ¨¡å¼ï¼Œæ¨¡å‹è¾“å‡ºç»“æœä¹Ÿä¼šæ›´åŠ ç¨³å®šã€‚</li>
<li>æ•°æ®è¿‡é‡‡æ ·ã€‚å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ‹¿åˆ°æ‰‹çš„æ•°æ®éƒ½å­˜åœ¨ç±»åˆ«ä¸å‡åŒ€çš„æƒ…å†µï¼Œæ¨¡å‹è¿™ä¸ªæ—¶å€™è¿‡å¤šçš„æ‹ŸåˆæŸç±»æ•°é‡å¤šçš„æ•°æ®å¯¼è‡´å…¶è¾“å‡ºç»“æœåå‘äºè¯¥ç±»æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬è¿‡é‡‡æ ·å…¶ä»–ç±»åˆ«çš„æ•°æ®ï¼Œä½¿å¾—æ•°æ®é‡æ¯”è¾ƒå‡è¡¡å¯ä»¥ä¸€å®šç¨‹åº¦æé«˜æ³›åŒ–èƒ½åŠ›ã€‚</li>
<li>æ•°æ®å¢å¼ºã€‚æ•°æ®å¢å¼ºæ˜¯æŒ‡åœ¨æ•°æ®æœ‰é™çš„æƒ…å†µé€šè¿‡ä¸€äº›å‡ ä½•æ“ä½œå¯¹å›¾åƒè¿›è¡Œå˜æ¢ï¼Œä½¿å¾—åŒç±»æ•°æ®çš„è¡¨ç°å½¢å¼æ›´åŠ ä¸°å¯Œï¼Œä»¥æ­¤æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æ•°æ®å¢å¼ºæ˜¯ä¸€é—¨æ¯”è¾ƒå¤§çš„å­¦é—®ï¼Œåœ¨åˆ†ç±»ï¼Œæ£€æµ‹ï¼Œåˆ†å‰²ä¸­æ•°æ®å¢å¼ºçš„æ–¹å¼éƒ½æœ‰åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç ”ç©¶ä¼˜ç§€çš„å¼€æºä»£ç å®ç°çš„æ•°æ®å¢å¼ºç­–ç•¥æ¥åº”ç”¨åˆ°æˆ‘ä»¬è‡ªå·±çš„ä»»åŠ¡ä¸­ã€‚</li>
<li>ä¿®æ”¹æŸå¤±å‡½æ•°ã€‚è¿™æ–¹é¢æœ‰å¤§é‡çš„å·¥ä½œï¼Œå¦‚ç›®æ ‡æ£€æµ‹ä¸­çš„Focal Loss, GHM Lossï¼ŒIOU Lossç­‰éƒ½æ˜¯ä¸ºäº†æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</li>
<li>ä¿®æ”¹ç½‘ç»œã€‚å¦‚æœç½‘ç»œè¿‡æµ…å¹¶ä¸”å‚æ•°é‡è¿‡å°‘å¾€å¾€ä¼šä½¿å¾—æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ä¸è¶³å¯¼è‡´æ¬ æ‹Ÿåˆï¼Œæ­¤æ—¶ä¸€èˆ¬è€ƒè™‘ä½¿ç”¨ç®€å•çš„å †å å·ç§¯å±‚å¢åŠ ç½‘ç»œçš„å‚æ•°ï¼Œæé«˜æ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚è€Œå¦‚æœç½‘ç»œè¿‡æ·±ä¸”è®­ç»ƒæ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆå°±å®¹æ˜“å¯¼è‡´æ¨¡å‹è¿‡æ‹Ÿåˆï¼Œæ­¤æ—¶ä¸€èˆ¬éœ€è¦ç®€åŒ–ç½‘ç»œç»“æ„å‡å°‘ç½‘ç»œå±‚æ•°æˆ–è€…ä½¿ç”¨<code>resnet</code>çš„æ®‹å·®ç»“æ„ä»¥åŠ<code>bn</code>å±‚ã€‚</li>
<li>æƒé‡æƒ©ç½šã€‚æƒé‡æƒ©ç½šä¹Ÿå³æ˜¯æ­£åˆ™åŒ–æ“ä½œï¼Œä¸€èˆ¬æ˜¯åœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ ä¸€é¡¹æƒé‡çŸ©é˜µçš„æ­£åˆ™é¡¹ä½œä¸ºæƒ©ç½šé¡¹ï¼Œç”¨æ¥æƒ©ç½šæŸå¤±å€¼è¾ƒå°æ—¶ç½‘ç»œæƒé‡è¿‡å¤§çš„æƒ…å†µï¼Œæ­¤æ—¶å¾€å¾€æ˜¯ç½‘ç»œæƒå€¼è¿‡æ‹Ÿåˆäº†æ•°æ®æ ·æœ¬ã€‚</li>
<li>Dropoutç­–ç•¥ã€‚å¦‚æœç½‘ç»œæœ€åæœ‰å…¨è¿æ¥å±‚å¯ä»¥ä½¿ç”¨<code>Dropout</code>ç­–ç•¥ï¼Œç›¸å½“äºå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹åšäº†<code>Ensemble</code>ï¼Œæœ‰åŠ©äºæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</li>
</ul>
<h2 id="ä¸€äº›è°ƒå‚æŠ€å·§"><a href="#ä¸€äº›è°ƒå‚æŠ€å·§" class="headerlink" title="ä¸€äº›è°ƒå‚æŠ€å·§"></a>ä¸€äº›è°ƒå‚æŠ€å·§</h2><h3 id="åšå·¥ç¨‹"><a href="#åšå·¥ç¨‹" class="headerlink" title="åšå·¥ç¨‹"></a>åšå·¥ç¨‹</h3><ul>
<li><p>3 x 3å·ç§¯æ˜¯CNNçš„ä¸»æµç»„ä»¶ã€‚å¹³æ—¶æœ‰è®¾è®¡ä¸€äº›è§£å†³åˆ†ç±»ï¼Œå›å½’ä»»åŠ¡çš„ç½‘ç»œï¼Œé‡Œé¢çš„å·ç§¯æ ¸åŸºæœ¬éƒ½è®¾ç½®ä¸º3 x 3ï¼Œè¦è¯´åŸå› çš„è¯åº”è¯¥å»é—®é—®<code>VGG16</code>å§ã€‚ä¸¤ä¸ª3 x 3çš„å·ç§¯æ ¸å †å èƒ½è·å¾—5 x 5å·ç§¯æ ¸çš„æ„Ÿå—é‡å¹¶ä¸”å‚æ•°æ¯”5 x 5å·ç§¯æ ¸å°‘ï¼Œæ‰€ä»¥æ˜¯å¤§é‡æ¨èä½¿ç”¨çš„ã€‚</p>
</li>
<li><p>å¯ä»¥é€‚å½“ä½¿ç”¨1 x Nå·ç§¯ã€‚ä¸ºä»€ä¹ˆè¦æè¿™ä¸€ç‚¹å‘¢ï¼Œè¿™æ˜¯å› ä¸º1 X Nå·ç§¯å¯ä»¥å‡å°‘è®¡ç®—é‡ï¼Œå¹¶ä¸”1 X Nå·ç§¯å¯ä»¥åœ¨æŸä¸ªæ–¹å‘å¼ºè°ƒæ„Ÿå—é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚å¦‚æœä½ è¦å¯¹ä¸€ä¸ªé•¿æ–¹å½¢å½¢çŠ¶çš„ç›®æ ‡è¿›è¡Œåˆ†ç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨1 X Nçš„å·ç§¯æ ¸æ­é…3 X 3çš„å·ç§¯æ ¸å¯¹é•¿è¾¹æ–¹å‘è®¾å®šæ›´å¤§çš„æ„Ÿå—é‡ï¼Œæˆ–è®¸å¯ä»¥è·å¾—æ³›åŒ–æ€§èƒ½çš„æå‡ã€‚</p>
</li>
<li>ACNetç»“æ„ã€‚è¿™ä¸ªç ”ç©¶æ¥è‡ªäºICCV2019ï¼Œå¯ä»¥åœ¨3 X 3å·ç§¯çš„åŸºç¡€ä¸ŠåŠ ä¸Š1 X 3å’Œ3 X 1çš„æ—è·¯å·ç§¯æ ¸ï¼Œæœ€ååœ¨æ¨ç†é˜¶æ®µæŠŠä¸‰ä¸ªå·ç§¯æ ¸éƒ½<code>fusion</code>åˆ°3 X 3å·ç§¯æ ¸ä¸Šï¼Œåœ¨è®¸å¤šç»å…¸CVä»»åŠ¡ä¸Šéƒ½å¯ä»¥è·å¾—å¤§æ¦‚1ä¸ªç‚¹çš„æå‡ã€‚</li>
<li>å·ç§¯æ ¸æƒé‡åˆå§‹åŒ–æ–¹å¼ã€‚å¯¹äº<code>weight</code>çš„åˆå§‹åŒ–ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨<code>xavier</code>åˆå§‹åŒ–ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å¯ä»¥å°è¯•ä½•å‡¯æ˜å¤§ç¥çš„Heåˆå§‹åŒ–ã€‚å¯¹äºbiasçš„åˆå§‹åŒ–å…¨ç½®äº0ã€‚</li>
<li><code>Batch Normalization</code>ã€‚è¿™æ˜¯ä¸€ç›´åœ¨ä½¿ç”¨çš„æŠ€å·§ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦çš„åŠ å¿«æ”¶æ•›é€Ÿåº¦ã€‚å»ºè®®æ­å»ºè‡ªå·±ç½‘ç»œçš„æ—¶å€™å°½é‡åŠ ä¸Š<code>BN</code>ï¼Œå¦‚æœæœ‰<code>BN</code>äº†å…¨è¿æ¥å±‚å°±æ²¡å¿…è¦åŠ <code>Dropout</code>äº†ã€‚</li>
<li>ç›®æ ‡æ£€æµ‹ä¸èƒ½ç›²ç›®å»æ‰<code>fpn</code>ç»“æ„ã€‚åœ¨é’ˆå¯¹è‡ªå·±çš„æ•°æ®è°ƒæ£€æµ‹ä»»åŠ¡å¦‚<code>yolov3</code>çš„æ—¶å€™ä¸èƒ½ç›²ç›®ç æ‰<code>fpn</code>ç»“æ„ï¼Œå°½ç®¡ä½ åˆ†æå‡ºæŸä¸ªåˆ†æ”¯çš„AnchoråŸºæœ¬ä¸å¯èƒ½ä¼šå¯¹ä½ é¢„æµ‹çš„ç›®æ ‡èµ·ä½œç”¨ï¼Œä½†å¦‚æœä½ ç›´æ¥å»æ‰åˆ†æ”¯å¾ˆå¯èƒ½ä¼šå¸¦æ¥æ¼æ£€ã€‚</li>
<li>ä¼˜åŒ–å™¨çš„é€‰æ‹©ã€‚åŸºæœ¬éƒ½æ˜¯å¸¦åŠ¨é‡çš„<code>SGD</code>ã€‚å¦‚æœä¼˜åŒ–ä¸åŠ¨å¯ä»¥è¯•è¯•<code>Adam</code>ã€‚</li>
<li>æ¿€æ´»å‡½æ•°ã€‚å¯ä»¥å…ˆç”¨<code>ReLU</code>åšä¸€ç‰ˆï¼Œå¦‚æœæƒ³å†æå‡ç²¾åº¦å¯ä»¥å°†<code>ReLU</code>æ”¹æˆ<code>PReLU</code>è¯•è¯•ã€‚æˆ‘æ›´å€¾å‘äºç›´æ¥ä½¿ç”¨<code>ReLU</code>ã€‚</li>
<li><code>batch_size</code>ï¼šåœ¨ä¸åŒç±»å‹çš„ä»»åŠ¡ä¸­ï¼Œ<code>batch_size</code>çš„å½±å“ä¹Ÿä¸åŒã€‚</li>
<li>åˆå§‹å­¦ä¹ ç‡ã€‚ä¸€èˆ¬æ˜¯ä»<code>0.01</code>å¼€å§‹è®¾ç½®ï¼Œä¸ªäººè®¤ä¸ºè¿™ä¸ªå­¦ä¹ ç‡å’Œå­¦ä¹ ç‡è¡°å‡ç­–ç•¥æ˜¯ç›¸å…³çš„ï¼Œä½†ä¸å®œè®¾ç½®çš„è¿‡å¤§è¿‡å°ï¼Œ<code>0.01</code>å’Œ<code>0.1</code>åº”è¯¥æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ã€‚å­¦ä¹ ç‡è¡°å‡ç­–ç•¥ä¸€èˆ¬ä½¿ç”¨<code>multistep</code>æ–¹å¼ï¼Œ<code>step_size</code>çš„è®¾ç½®è¦çœ‹è§†ä½ çš„çš„<code>max_iter</code>è€Œå®šã€‚</li>
<li>æ•°æ®ä¸å¤„ç†ä¹‹<code>zero-center</code>ã€‚ä¸»è¦æœ‰2ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‡å‡å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯é™¤ä»¥æ–¹å·®ã€‚è¿™æ ·åšä¸‹æ¥æœ€åçš„è¾“å…¥å€¼åŸŸä¸º<code>[-1,1]</code>ï¼Œä¸€èˆ¬å‡å‡å€¼æ˜¯æœ€å¸¸ç”¨çš„ï¼Œåé¢çš„é™¤ä»¥æ–¹å·®ç”¨ä¸ç”¨å¯èƒ½éœ€è¦è‡ªå·±åŠ¨æ‰‹è¯•éªŒä¸€ä¸‹çœ‹çœ‹æ•ˆæœã€‚</li>
<li>æ®‹å·®ç»“æ„å’Œå¯†é›†è¿æ¥ã€‚<code>resnet</code>çš„æ®‹å·®ç»“æ„å’Œ<code>dense net</code>å¯†é›†è¿æ¥ç»“æ„ï¼Œåšå·¥ç¨‹çš„æ—¶å€™è€ƒè™‘åˆ°é€Ÿåº¦è¿‘ä¹ä¸å¯èƒ½è¯´å®Œå…¨ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬çš„<code>resnet</code>å’Œ<code>densenet</code>çš„å®Œæ•´ç»“æ„ï¼Œä½†æˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ¨æ‰‹å°†æˆ‘ä»¬ç½‘ç»œçš„æŸäº›æ¨¡å—æ›¿æ¢ä¸ºæ®‹å·®ç»“æ„å’Œå¯†é›†è¿æ¥ï¼Œæ›¿æ¢çš„æ—¶å€™å¯ä»¥é€‚å½“é™ä½è¿™ä¿©ç»“æ„çš„å¤æ‚åº¦ï¼Œç±»ä¼¼äºé€šé“æ•°å‡åŠï¼Œå¯†é›†è¿æ¥ä¸­åªä¿ç•™ä¸€åŠè¿æ¥ç­‰ç­‰ã€‚è¿™é‡Œéœ€è¦åšä¸€äº›æ¶ˆèå®éªŒæ¥éªŒè¯æ”¹è¿›åçš„ç²¾åº¦ã€‚</li>
<li>å…³äºlossã€‚ä¼˜ç§€çš„<code>loss</code>ä¸€èˆ¬æ˜¯å¯¹æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½æœ‰æ‰€æ”¹å–„çš„ï¼Œä½†åœ¨ç”¨<code>loss</code>çš„æ—¶å€™å¾€å¾€å¹¶ä¸æ˜¯ç›´æ¥æ›¿æ¢<code>loss</code>é‚£ä¹ˆç®€å•ï¼Œéœ€è¦ä»”ç»†æ€è€ƒ<code>loss</code>èƒŒåçš„æ•°å­¦åŸç†ï¼Œè¦ç”¨å¯¹åœ°æ–¹æ‰å¯æœ‰æå‡ã€‚</li>
<li>æ‰¾åˆ°æ¨¡å‹è°ƒå‚æ—¶çš„å¯é è¯„ä»·æŒ‡æ ‡ã€‚åœ¨è°ƒæ•´å‚æ•°è®­ç»ƒæ¨¡å‹æ—¶ä¸€å®šè¦æ‰¾åˆ°æ­£ç¡®çš„è¯„ä»·æŒ‡æ ‡ï¼Œæ²¡è°ƒæ•´ä¸€ä¸ªå‚æ•°å°±è¦è®°å½•ä¸€ä¸‹æ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡å¦‚å‡†ç¡®ç‡ï¼Œ<code>map</code>å€¼ï¼Œ<code>miou</code>å€¼ç­‰ã€‚å¹¶ä¸”åœ¨è°ƒå‚æ—¶å»ºè®®å°†è°ƒæ•´çš„å‚æ•°å’Œåœ¨æµ‹è¯•é›†ä¸Šçš„ç²¾åº¦ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ç»™æ¨¡å‹é‡å‘½ä»¤ï¼Œæ–¹ä¾¿ä¹‹åå¿«é€Ÿ<code>review</code>ã€‚</li>
<li>ä½¿ç”¨äº†å¸¦<code>backbone</code>çš„ç½‘ç»œï¼Œå¦‚è®­ç»ƒ<code>VGG16-SSD</code>å»ºè®®é€‰æ‹©<code>finetune</code>çš„æ–¹å¼ï¼Œä»å¤´è®­ç»ƒä¸ä»…è´¹æ—¶è´¹åŠ›ï¼Œç”šè‡³éš¾ä»¥æ”¶æ•›ã€‚</li>
</ul>
<h3 id="åšæ¯”èµ›"><a href="#åšæ¯”èµ›" class="headerlink" title="åšæ¯”èµ›"></a>åšæ¯”èµ›</h3><ul>
<li><p>ç‰¹å¾æå–ã€‚VGG16ï¼ŒVGG19ï¼ŒResNet50ï¼ŒXceptionæ˜¯éå¸¸å¥½ç”¨çš„å‡ ä¸ªç‰¹å¾æå–æ¨¡å‹ã€‚å»ºè®®ä½¿ç”¨è®­ç»ƒå¥½çš„ç»å…¸æ¨¡å‹å¯¹æ•°æ®é›†æå–ç‰¹å¾å‘é‡å­˜å‚¨åˆ°æœ¬åœ°ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶å¯ä»¥å¤§å¹…åº¦é™ä½æ˜¾å­˜æ¶ˆè€—ã€‚</p>
</li>
<li><p>ensemleï¼š</p>
<ul>
<li>å°†ä¸åŒçš„ç»å…¸ç½‘ç»œæå–å‡ºçš„ç‰¹å¾å‘é‡ï¼Œå‡è®¾<code>VGG16</code>æå–å‡ºçš„ç‰¹å¾å‘é‡ç»´åº¦æ˜¯<code>[N,c1]</code>,<code>ResNet50</code>æå–çš„ç‰¹å¾å‘é‡ç»´åº¦æ˜¯<code>[Nï¼Œc2]</code>,<code>Xception</code>æå–çš„ç‰¹å¾å‘é‡ç»´åº¦æ˜¯<code>[N, c3]</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªç³»æ•°<code>aã€bã€c</code>å°†å…¶ç»„åˆä¸ºå½¢çŠ¶ä¸º<code>[N, a*c1+b*c2+c*c3]</code>ï¼Œå…¶ä¸­<code>aã€bã€c</code>ä¸‰ä¸ªå‚æ•°çš„å–å€¼ä»£è¡¨æˆ‘ä»¬ä½¿ç”¨å“ªä¸ªæ¨¡å‹çš„ç‰¹å¾å¤šä¸€äº›ï¼Œå¦‚æœæ˜¯åˆ†ç±»å›å½’æ¯”èµ›ï¼Œæˆ‘ä»¬åœ¨åé¢æ¥ç‰¹å¾å¤„ç†ç½‘ç»œå°±å¯ä»¥äº†ã€‚å¯ä»¥å–ä¸åŒçš„<code>aã€bã€c</code>å¾—åˆ°ä¸åŒçš„ç‰¹å¾ï¼Œç„¶åå¯¹ç»“æœåš<code>voting</code>ï¼Œ<code>soft-voting</code>ç­‰å¤šç§å¤„ç†ï¼Œä¸€èˆ¬ç»“æœä¸ä¼šå¤ªå·®ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ä¸åŒçš„åˆå§‹åŒ–æ–¹å¼è®­ç»ƒå‡ºæ¨¡å‹ï¼Œç„¶ååšensembleã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ç”¨ä¸åŒè¶…å‚æ•°(å¦‚å­¦ä¹ ç‡ï¼Œ<code>batch_size</code>ï¼Œä¼˜åŒ–å™¨)è®­ç»ƒå‡ºä¸åŒæ¨¡å‹ï¼Œç„¶ååšensembleã€‚</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›˜ç‚¹ä¸åŒç±»å‹çš„æ± åŒ–å±‚ã€1x1å·ç§¯çš„ä½œç”¨å’Œå·ç§¯æ ¸æ˜¯å¦ä¸€å®šè¶Šå¤§è¶Šå¥½ï¼Ÿ</title>
    <url>/2020/03/03/%E7%9B%98%E7%82%B9%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B1%A0%E5%8C%96%E5%B1%82%E3%80%811x1%E5%8D%B7%E7%A7%AF%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8C%E5%8D%B7%E7%A7%AF%E6%A0%B8%E6%98%AF%E5%90%A6%E4%B8%80%E5%AE%9A%E8%B6%8A%E5%A4%A7%E8%B6%8A%E5%A5%BD%EF%BC%9F/</url>
    <content><![CDATA[<h2 id="æ± åŒ–å±‚çš„ä¸åŒç±»å‹"><a href="#æ± åŒ–å±‚çš„ä¸åŒç±»å‹" class="headerlink" title="æ± åŒ–å±‚çš„ä¸åŒç±»å‹"></a>æ± åŒ–å±‚çš„ä¸åŒç±»å‹</h2><p>æ± åŒ–é€šå¸¸ä¹Ÿè¢«ç§°ä¸ºä¸‹é‡‡æ ·(Downsampling)ï¼Œä¸€èˆ¬æ˜¯ç”¨åœ¨å·ç§¯å±‚ä¹‹åï¼Œé€šè¿‡æ± åŒ–æ¥é™ä½å·ç§¯å±‚è¾“å‡ºç‰¹å¾å›¾çš„ç»´åº¦ï¼Œæœ‰æ•ˆå‡å°‘ç½‘ç»œå‚æ•°çš„åŒæ—¶è¿˜å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆç°è±¡ã€‚æ± åŒ–å±‚å®é™…ä¸ŠçœŸæ­£èµ·ä½œç”¨çš„åœ°æ–¹åœ¨äºä»–çš„éçº¿æ€§æ˜ å°„èƒ½åŠ›å’Œå¯ä»¥ä¿æŒä¸€å®šé‡çš„å¹³ç§»ä¸å˜æ€§çš„èƒ½åŠ›ã€‚è¿™ä¸ªèƒ½åŠ›æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªå›¾åƒåŒºåŸŸæœ‰ç”¨çš„ç‰¹å¾å¾ˆæœ‰å¯èƒ½åœ¨å¦ä¸€ä¸ªåŒºåŸŸåŒæ ·æœ‰ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†æè¿°ä¸€ä¸ªå¤§åˆ†è¾¨ç‡çš„å›¾åƒç‰¹å¾ï¼Œä¸€ä¸ªç›´è§‚çš„æ–¹æ³•å°±æ˜¯å¯¹å¤§åˆ†è¾¨ç‡å›¾åƒä¸­çš„ä¸åŒä½ç½®çš„ç‰¹å¾è¿›è¡Œèšåˆç»Ÿè®¡ã€‚å…·ä½“æ¥è¯´ï¼Œå¸¸è§æ± åŒ–çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ ‡å‡†æ± åŒ–</li>
<li>é‡å æ± åŒ–</li>
<li>ç©ºé—´é‡‘å­—å¡”æ± åŒ–</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»”ç»†ä»‹ç»ä¸€ä¸‹æ¯ç§æ± åŒ–ã€‚</p>
<h2 id="æ ‡å‡†æ± åŒ–"><a href="#æ ‡å‡†æ± åŒ–" class="headerlink" title="æ ‡å‡†æ± åŒ–"></a>æ ‡å‡†æ± åŒ–</h2><p>é€šå¸¸åŒ…æ‹¬æœ€å¤§æ± åŒ–(MaxPooling)å’Œå¹³å‡æ± åŒ–(AveragePooling)ã€‚ä»¥æœ€å¤§æ± åŒ–ä¸ºä¾‹ï¼Œæ± åŒ–æ ¸å°ºå¯¸ä¸º2 x 2ï¼Œæ± åŒ–æ­¥é•¿ä¸º2ï¼Œå¯ä»¥çœ‹åˆ°ç‰¹å¾å›¾ä¸­çš„æ¯ä¸€ä¸ªåƒç´ ç‚¹åªä¼šå‚ä¸ä¸€æ¬¡ç‰¹å¾æå–å·¥ä½œã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pooling/640.webp" alt></p>
<h2 id="é‡å æ± åŒ–"><a href="#é‡å æ± åŒ–" class="headerlink" title="é‡å æ± åŒ–"></a>é‡å æ± åŒ–</h2><p>æ“ä½œå’Œæ ‡å‡†æ± åŒ–ç›¸åŒï¼Œä½†å”¯ä¸€ä¸åŒåœ°æ–¹åœ¨äºæ»‘åŠ¨æ­¥é•¿strideå°äºæ± åŒ–æ ¸çš„å°ºå¯¸kï¼Œå¯ä»¥æƒ³è±¡åˆ°è¿™æ ·çš„è¯ç‰¹å¾å›¾ä¸­çš„æŸäº›åŒºåŸŸä¼šå‚ä¸åˆ°å¤šæ¬¡ç‰¹å¾æå–å·¥ä½œï¼Œæœ€åå¾—åˆ°çš„ç‰¹å¾è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pooling/641.webp" alt></p>
<h2 id="ç©ºé—´é‡‘å­—å¡”æ± åŒ–"><a href="#ç©ºé—´é‡‘å­—å¡”æ± åŒ–" class="headerlink" title="ç©ºé—´é‡‘å­—å¡”æ± åŒ–"></a>ç©ºé—´é‡‘å­—å¡”æ± åŒ–</h2><p>è¿™ç§æ± åŒ–æ˜¯åœ¨è¿›è¡Œå¤šå°ºåº¦è®­ç»ƒçš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ç§æ“ä½œçš„æ—¶å€™æ˜¯è¯»ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹Fast RCNNç®—æ³•çš„æ—¶å€™ã€‚å¯¹ä¸åŒè¾“å‡ºå°ºåº¦é‡‡ç”¨ä¸åŒçš„æ»‘çª—å¤§å°å’Œæ­¥é•¿ä»¥ç¡®ä¿è¾“å‡ºå°ºåº¦ç›¸åŒ($w i n_{s i z e}=\left\lceil\frac{i n}{o u t}\right\rceil$;$stride =\left\lfloor\frac{i n}{o u t}\right\rfloor$)ï¼ŒåŒæ—¶ç”¨å¦‚é‡‘å­—å¡”å¼å åŠ çš„å¤šç§æ± åŒ–å°ºåº¦ç»„åˆï¼Œä»¥æå–æ›´åŠ ä¸°å¯Œçš„å›¾åƒç‰¹å¾ã€‚å¸¸ç”¨äºå¤šå°ºåº¦è®­ç»ƒå’Œç›®æ ‡æ£€æµ‹ä¸­çš„åŒºåŸŸæè®®ç½‘ç»œ(Region Proposal Network)çš„å…´è¶£åŒºåŸŸ(Region of Interest)æå–ã€‚ç©ºé—´é‡‘å­—å¡”æ± åŒ–å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pooling/642.gif" alt></p>
<h2 id="1-1å·ç§¯çš„ä½œç”¨"><a href="#1-1å·ç§¯çš„ä½œç”¨" class="headerlink" title="1*1å·ç§¯çš„ä½œç”¨"></a>1*1å·ç§¯çš„ä½œç”¨</h2><p>æˆ‘æœ€å¼€å§‹æ¥è§¦åˆ°1 x 1å·ç§¯åº”è¯¥æ˜¯åœ¨é˜…è¯»ç»å…¸è®ºæ–‡GoogleNetçš„æ—¶å€™ï¼Œå½“ç„¶æˆ‘è¯´çš„æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œå¹¶ä¸ä»£è¡¨GoogleNet(åŒ…å«äº†InceptionV1-V4)æ˜¯ç¬¬ä¸€ä¸ªä½¿ç”¨å·ç§¯çš„ã€‚åœ¨InceptionV1ç½‘ç»œä¸­ï¼ŒInceptionæ¨¡å—é•¿ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pooling/643.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªInceptionæ¨¡å—ä¸­ï¼Œç”±äºæ¯ä¸€å±‚ç½‘ç»œé‡‡ç”¨äº†æ›´å¤šçš„å·ç§¯æ ¸ï¼Œå¤§å¤§å¢åŠ äº†æ¨¡å‹çš„å‚æ•°é‡ã€‚è¿™æ—¶å€™ä¸ºäº†å‡å°‘æ¨¡å‹å‚æ•°é‡ï¼Œåœ¨æ¯ä¸€ä¸ªè¾ƒå¤§å·ç§¯æ ¸çš„å·ç§¯å±‚å‰å¼•å…¥1 x 1å·ç§¯ï¼Œå°†å®½é«˜å’Œé€šé“æ–¹å‘çš„å·ç§¯è¿›è¡Œäº†åˆ†ç¦»ã€‚ä¿®æ”¹åçš„Inceptionæ¨¡å—è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pooling/644.webp" alt></p>
<p>è¿™æ ·å°±å®ç°äº†åœ¨ä¸å½±å“æ¨¡å‹çš„ç‰¹å¾è¡¨è¾¾èƒ½åŠ›æ¡ä»¶ä¸‹å¤§å¤§å‡å°‘äº†æ¨¡å‹çš„å‚æ•°é‡ã€‚æˆ‘ä»¬å®šé‡è®¡ç®—ä¸€ä¸‹ä¸Šä¸‹ä¸¤ä¸ªInceptionæ¨¡å—çš„å‚æ•°é‡ï¼Œå‡è®¾è¾“å…¥$C_1$è¾“å‡º$C_2$é€šé“æ•°éƒ½æ˜¯16ï¼Œåˆ™åŸå§‹çš„Inceptionæ¨¡å—çš„å‚æ•°é‡æ˜¯ï¼š$(1 \times 1+3 \times 3+5 \times 5+0) \times C_{1} \times C_{2}=8960$ï¼Œè€Œä½¿ç”¨äº†1 x 1å·ç§¯çš„Inceptionæ¨¡å—çš„å‚æ•°é‡ä¸ºï¼š$\left(1 \times 1 \times\left(3 C_{1}+C_{2}\right)+3 \times 3 \times C_{2}+5 \times 5 \times C_{2}\right) \times C_{1}=5248$ï¼Œå¯ä»¥çœ‹åˆ°è®¡ç®—é‡å‡å°‘äº†æ¥è¿‘ä¸€åŠã€‚</p>
<p>å› æ­¤ï¼Œ1 x 1å·ç§¯çš„ä½œç”¨å¯ä»¥æ€»ç»“ä¸ºå¯ä»¥å®ç°ä¿¡æ¯çš„é€šé“æ•´åˆå’Œäº¤äº’ï¼Œä»¥åŠå…·æœ‰å‡ç»´/é™ç»´çš„èƒ½åŠ›ã€‚</p>
<h2 id="å·ç§¯æ ¸æ˜¯å¦è¶Šå¤§è¶Šå¥½ï¼Ÿ"><a href="#å·ç§¯æ ¸æ˜¯å¦è¶Šå¤§è¶Šå¥½ï¼Ÿ" class="headerlink" title="å·ç§¯æ ¸æ˜¯å¦è¶Šå¤§è¶Šå¥½ï¼Ÿ"></a>å·ç§¯æ ¸æ˜¯å¦è¶Šå¤§è¶Šå¥½ï¼Ÿ</h2><p>è¿™æ˜¯æœ¬æ–‡çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæ˜¾ç„¶è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è‚¯å®šä¼šå›ç­”å¦ã€‚ä½†ä½ æ˜¯å¦çœŸçš„è®¤çœŸæ€è€ƒè¿‡å…¶ä¸­çš„åŸå› ï¼Ÿåœ¨æ—©æœŸçš„ä¸€äº›ç»å…¸ç½‘ç»œä¸­å¦‚Lenet-5å’ŒAlexNetï¼Œç”¨åˆ°äº†ä¸€äº›å¤§çš„å·ç§¯æ ¸ä¾‹å¦‚11 x 11ï¼Œ5 x 5ï¼Œå—é™äºå½“æ—¶çš„è®¡ç®—èµ„æºï¼Œæ— æ³•å°†ç½‘ç»œå †å å¾—å¾ˆæ·±ï¼Œå› æ­¤éœ€è¦å°†å·ç§¯æ ¸è®¾å¾—æ¯”è¾ƒå¤§ä»¥è·å¾—æ›´å¤§çš„æ„Ÿå—é‡ã€‚ä½†è¿™ç§å¤§å·ç§¯æ ¸å¯¼è‡´è®¡ç®—é‡å¤§å¹…å¢åŠ ï¼Œè®­ç»ƒè¿‡ç¨‹ç¼“æ…¢ï¼Œæ›´ä¸åˆ©äºè®­ç»ƒæ·±å±‚æ¨¡å‹ã€‚åæ¥VGGNetï¼ŒGoogleNetæ—¶ä»£å‘ç°é€šè¿‡å †å 2ä¸ª3 x 3å·ç§¯æ ¸å¯ä»¥è·å¾—å’Œ5 x 5å·ç§¯æ ¸ç›¸åŒçš„æ„Ÿå—é‡ï¼ŒåŒæ—¶å‚æ•°é‡ä¹Ÿä¼šå‡å°‘ï¼Œå¦‚$2 \times 3 \times 3&lt;5 \times 5$ã€‚å› æ­¤ï¼Œ3 x 3å·ç§¯æ ¸è¢«å¹¿æ³›åº”ç”¨åœ¨è®¸å¤šå·ç§¯ç¥ç»ç½‘ç»œä¸­ã€‚æ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹é€šè¿‡å †å è¾ƒå°çš„å·ç§¯æ ¸æ¯”ç›´æ¥é‡‡ç”¨å•ä¸ªæ›´å¤§çš„å·ç§¯æ ¸æ›´åŠ æœ‰æ•ˆå¹¶ä¸”èƒ½è·å¾—è®¡ç®—èµ„æºèŠ‚çº¦ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼ŒCVé¢†åŸŸå°å·ç§¯æ ¸å †å æ˜¯å¥½äºå¤§å·ç§¯æ ¸çš„ã€‚</p>
<p>é‚£ä¹ˆæ˜¯ä¸æ˜¯å…¶ä»–é¢†åŸŸä¹Ÿæ˜¯è¿™æ ·å‘¢ï¼Ÿå¹¶ä¸æ˜¯ã€‚åœ¨NLPé¢†åŸŸï¼Œç”±äºæ–‡æœ¬å†…å®¹ä¸åƒå›¾åƒæ•°æ®ä¸€æ ·å¯ä»¥å¯¹ç‰¹å¾è¿›è¡Œå¾ˆæ·±å±‚çš„æŠ½è±¡ï¼Œå› æ­¤è¯¥é¢†åŸŸçš„ç‰¹å¾æå–ç½‘ç»œéƒ½æ˜¯æ¯”è¾ƒæµ…çš„ã€‚è¿™ä¸ªæ—¶å€™ä¸ºäº†è·å¾—è¾ƒå¤§çš„æ„Ÿå—é‡ï¼Œå°±éœ€è¦ä½¿ç”¨å¤§çš„å·ç§¯æ ¸ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºåœ¨NLPé¢†åŸŸå¤§å·ç§¯æ˜¯å¥½äºå°å·ç§¯æ ¸çš„ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå·ç§¯æ ¸æ˜¯å¦è¶Šå¤§è¶Šå¥½å‘¢ï¼Ÿè¿™ä¸ªè¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œåœ¨ä¸åŒçš„é¢†åŸŸå¤§å·ç§¯æ ¸å’Œå°å·ç§¯æ ¸åˆ†åˆ«èƒ½å–å¾—ä¸é”™çš„æ•ˆæœã€‚å¹¶ä¸”åœ¨è®¾ç½®å·ç§¯æ ¸çš„æ—¶å€™ä¸€ä¸ªå¸¸è¯†æ˜¯ä¸èƒ½è®¾å¾—è¿‡å¤§ä¹Ÿä¸èƒ½è¿‡å°ï¼Œ1 x 1å·ç§¯åªé€‚åˆåšåˆ†ç¦»å·ç§¯ä»»åŠ¡è€Œä¸èƒ½å¯¹è¾“å…¥çš„åŸå§‹ç‰¹å¾åšæœ‰æ•ˆçš„ç‰¹å¾æŠ½å–ï¼Œè€Œæå¤§çš„å·ç§¯æ ¸é€šå¸¸ä¼šç»„åˆè¿‡å¤šæ— ç”¨çš„ç‰¹å¾æµªè´¹å¤§é‡çš„è®¡ç®—èµ„æºã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å‡å°‘å·ç§¯å±‚è®¡ç®—é‡ï¼Œä½¿ç”¨å®½å·ç§¯çš„å¥½å¤„åŠè½¬ç½®å·ç§¯ä¸­çš„æ£‹ç›˜æ•ˆåº”</title>
    <url>/2020/03/04/%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E5%8D%B7%E7%A7%AF%E5%B1%82%E8%AE%A1%E7%AE%97%E9%87%8F%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%AE%BD%E5%8D%B7%E7%A7%AF%E7%9A%84%E5%A5%BD%E5%A4%84%E5%8F%8A%E8%BD%AC%E7%BD%AE%E5%8D%B7%E7%A7%AF%E4%B8%AD%E7%9A%84%E6%A3%8B%E7%9B%98%E6%95%88%E5%BA%94/</url>
    <content><![CDATA[<h2 id="å¦‚ä½•å‡å°‘å·ç§¯å±‚è®¡ç®—é‡ï¼Ÿ"><a href="#å¦‚ä½•å‡å°‘å·ç§¯å±‚è®¡ç®—é‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•å‡å°‘å·ç§¯å±‚è®¡ç®—é‡ï¼Ÿ"></a>å¦‚ä½•å‡å°‘å·ç§¯å±‚è®¡ç®—é‡ï¼Ÿ</h2><p>å‡å°‘å·ç§¯å±‚çš„è®¡ç®—é‡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨æ± åŒ–æ“ä½œã€‚åœ¨å·ç§¯å±‚å‰ä½¿ç”¨æ± åŒ–æ“ä½œé™ä½ç‰¹å¾å›¾åˆ†è¾¨ç‡ã€‚</li>
<li><p>ä½¿ç”¨å †å çš„å°å·ç§¯æ ¸ä»£æ›¿å¤§å·ç§¯æ ¸ã€‚VGG16ä¸­ä½¿ç”¨2ä¸ª3 x 3å·ç§¯ä»£æ›¿ä¸€ä¸ª5 x 5å·ç§¯ã€‚</p>
</li>
<li><p>ä½¿ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€‚å°†åŸå§‹çš„$K \times K \times C$çš„å·ç§¯æ ¸åˆ†æˆ$K \times K \times 1$å’Œ$1 \times 1 \times C$ä¸¤éƒ¨åˆ†æ“ä½œã€‚</p>
</li>
<li><p>åº”ç”¨1 x 1å·ç§¯ã€‚å°†1 x 1å·ç§¯ï¼ˆå‡è®¾é€šé“æ•°ä¸º$C_2$ï¼‰ç›´æ¥åº”ç”¨åœ¨æŸä¸ªå·ç§¯å±‚ï¼ˆå‡è®¾ç»´åº¦ä¸º$K \times K \times C_{1}$ï¼‰ä¹‹å‰</p>
</li>
</ul>
<h2 id="ä½¿ç”¨å®½å·ç§¯çš„å¥½å¤„ï¼Ÿ"><a href="#ä½¿ç”¨å®½å·ç§¯çš„å¥½å¤„ï¼Ÿ" class="headerlink" title="ä½¿ç”¨å®½å·ç§¯çš„å¥½å¤„ï¼Ÿ"></a>ä½¿ç”¨å®½å·ç§¯çš„å¥½å¤„ï¼Ÿ</h2><p>æ‰€è°“å®½å·ç§¯å°±æ˜¯æŒ‡åœ¨å·ç§¯æ“ä½œæ—¶å¡«å……æ–¹å¼ä¸º<code>same</code>æ–¹å¼ã€‚è€Œä¸ä¹‹å¯¹åº”çš„çª„å·ç§¯å°±æ˜¯æŒ‡åœ¨å·ç§¯æ“ä½œæ—¶å¡«å……æ–¹å¼ä¸º<code>valid</code>æ–¹å¼ã€‚<code>same</code>æ–¹å¼çš„å¡«å……é€šå¸¸ä½¿ç”¨0å¡«å……çš„æ–¹å¼å¯¹å·ç§¯æ ¸ä¸æ»¡è¶³æ•´é™¤æ¡ä»¶çš„è¾“å…¥ç‰¹å¾å›¾è¿›è¡Œè¡¥å…¨ï¼Œä½¿å¾—å·ç§¯å±‚çš„è¾“å‡ºç»´åº¦å’Œè¾“å…¥ç»´åº¦ä¸€è‡´ã€‚<code>valid</code>æ–¹å¼çš„å¡«å……å°±æ˜¯ä¸è¿›è¡Œä»»ä½•å¡«å……ï¼Œåœ¨è¾“å…¥ç‰¹å¾è¾¹ç¼˜ä½ç½®è‹¥ä¸è¶³ä»¥è¿›è¡Œå·ç§¯æ“ä½œï¼Œåˆ™å¯¹è¾¹ç¼˜ä¿¡æ¯è¿›è¡Œèˆå¼ƒï¼Œå› æ­¤åœ¨æ­¥é•¿ä¸º1çš„æƒ…å†µä¸‹è¯¥å¡«å……æ–¹å¼çš„å·ç§¯å±‚è¾“å‡ºç‰¹å¾ç»´åº¦å¯èƒ½ä¼šç•¥å°äºè¾“å…¥ç‰¹å¾çš„ç»´åº¦ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°å®½å·ç§¯(<code>same</code>å¡«å……æ–¹å¼å·ç§¯)çš„å¥½å¤„å°±æ˜¯é€šè¿‡è¡¥0æ“ä½œå¯ä»¥æœ‰æ•ˆçš„ä¿ç•™åŸå§‹è¾“å…¥ç‰¹å¾å›¾çš„è¾¹ç•Œç‰¹å¾ä¿¡æ¯ã€‚</p>
<h2 id="è½¬ç½®å·ç§¯å’Œæ£‹ç›˜æ•ˆåº”ï¼Ÿ"><a href="#è½¬ç½®å·ç§¯å’Œæ£‹ç›˜æ•ˆåº”ï¼Ÿ" class="headerlink" title="è½¬ç½®å·ç§¯å’Œæ£‹ç›˜æ•ˆåº”ï¼Ÿ"></a>è½¬ç½®å·ç§¯å’Œæ£‹ç›˜æ•ˆåº”ï¼Ÿ</h2><p>å½“æˆ‘ä»¬åœ¨ç”¨åå·ç§¯ï¼ˆè½¬ç½®å·ç§¯ï¼‰åšå›¾åƒç”Ÿæˆæˆ–è€…ä¸Šé‡‡æ ·çš„æ—¶å€™æˆ–è®¸æˆ‘ä»¬ä¼šè§‚å¯Ÿåˆ°æˆ‘ä»¬ç”Ÿæˆçš„å›¾ç‰‡ä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„æ£‹ç›˜å›¾æ¡ˆæˆ–è€…è¯´ä½ æ„Ÿè§‰åˆ°ä½ ç”Ÿæˆçš„å›¾ç‰‡æœ‰é¢—ç²’æ„Ÿã€‚æ£‹ç›˜æ ¼æ•ˆåº”è¶‹å‘äºå‡ºç°åœ¨<strong>å›¾åƒä¸­æœ€æ˜¾è‘—çš„åœ°æ–¹ (é¢œè‰²æœ€å¼ºçƒˆ)</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/643.webp" alt></p>
<p>è¿™ç§ç°è±¡ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿæ˜¯å› ä¸ºåœ¨ä¸Šé‡‡æ ·ä½¿ç”¨åå·ç§¯çš„æ—¶å€™ï¼Œå·ç§¯æ ¸çš„å¤§å°ä¸èƒ½è¢«æ­¥é•¿æ•´é™¤å¯¼è‡´çš„ã€‚å…ˆçœ‹ä¸€ä¸‹æ²¡æœ‰æ£‹ç›˜æ•ˆåº”çš„æƒ…å†µï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/644.webp" alt></p>
<p>å†çœ‹ä¸€ä¸‹å‡ºç°æ£‹ç›˜æ•ˆåº”çš„æƒ…å†µï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/645.webp" alt></p>
<p>å³å®ƒå¾ˆå®¹æ˜“é‡åˆ°ä¸€ç§å«åš <strong>â€œuneven overlapâ€(ä¸å‡åŒ€é‡å )</strong> çš„ç°è±¡ã€‚å…·ä½“æ¥è¯´, å½“kernel_size æ— æ³•è¢« strideæ•´é™¤æ—¶, åå·ç§¯å°±ä¼šå‡ºç°è¿™ç§ä¸å‡åŒ€é‡å çš„ç°è±¡ã€‚åŸåˆ™ä¸Šï¼Œç¥ç»ç½‘ç»œå¯ä»¥é€šè¿‡ä»”ç»†å­¦ä¹ æƒå€¼æ¥é¿å…è¿™ç§æƒ…å†µï¼Œä½†åœ¨å®è·µä¸­ï¼Œç¥ç»ç½‘ç»œå¾ˆéš¾å®Œå…¨é¿å…è¿™ç§æƒ…å†µ.</p>
<p>å¹¶ä¸”åœ¨äºŒç»´å›¾ç‰‡ä¸Šæ£‹ç›˜æ•ˆåº”ä¼šæ›´åŠ ä¸¥é‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/20190809192609235.png" alt></p>
<p>å› æ­¤ä¸ºäº†é¿å…æ£‹ç›˜æ•ˆåº”çš„å‘ç”Ÿï¼Œä¸€èˆ¬æœ‰ä¸€ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>æ–¹æ³•1ï¼šç°åœ¨ï¼Œç¥ç»ç½‘ç»œåœ¨åˆ›å»ºå›¾åƒæ—¶é€šå¸¸ä½¿ç”¨å¤šå±‚åå·ç§¯ï¼Œä»ä¸€ç³»åˆ—è¾ƒä½åˆ†è¾¨ç‡çš„æè¿°ä¸­è¿­ä»£åœ°æ„å»ºè¾ƒå¤§çš„å›¾åƒã€‚è™½ç„¶è¿™äº›å †å çš„åå·ç§¯å¯èƒ½ä¼šæ¶ˆé™¤æ£‹ç›˜æ•ˆåº”ï¼Œä½†å®ƒä»¬é€šå¸¸ä¼šå¤åˆï¼Œä»è€Œåœ¨å„ç§å°ºåº¦ä¸Šäº§ç”Ÿæ£‹ç›˜æ•ˆåº”ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/646.png" alt></p>
</li>
<li><p>æ–¹æ³•2ï¼šåœ¨åå·ç§¯åé¢ï¼Œå†æ¥ä¸€ä¸ªæ­¥é•¿ä¸º1çš„å·ç§¯ï¼Œæ•ˆæœæœ‰é™ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/647.webp" alt></p>
</li>
<li><p>æ–¹æ³•3ï¼šè°ƒæ•´å·ç§¯æ ¸çš„æƒé‡ï¼Œé€‚å½“åŠ å¤§é‡å éƒ¨åˆ†å°‘çš„æƒé‡ï¼Œè™½ç„¶ç†è®ºæœ‰æ•ˆï¼Œä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œä¸ä»…æœ‰å›°éš¾ä¹Ÿä¼šå‡å¼±æ¨¡å‹çš„è¡¨è¾¾åŠ›ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/648.webp" alt></p>
</li>
<li><p>æ–¹æ³•4ï¼šä½¿å¾—å·ç§¯æ ¸å¤§å°èƒ½è¢«æ­¥é•¿æ•´é™¤ï¼Œä½†å·ç§¯æ ¸æƒé‡çš„å­¦ä¹ ä¸å‡åŒ€ä¹Ÿä¼šå¯¼è‡´æ£‹ç›˜æ•ˆåº”ç°è±¡ï¼ˆä¸‹å›¾ä¸ºæ­¥é•¿ä¸º2ï¼Œæ ¸å¤§å°ä¸º4æ‰€äº§ç”Ÿçš„æ£‹ç›˜æ•ˆåº”ç°è±¡ï¼‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/649.webp" alt></p>
</li>
<li><p>æ–¹æ³•5ï¼šè°ƒæ•´å›¾åƒå¤§å°ï¼ˆä½¿ç”¨æœ€è¿‘é‚»æ’å€¼æˆ–åŒçº¿æ€§æ’å€¼ï¼‰ï¼Œç„¶åæ‰§è¡Œå·ç§¯æ“ä½œã€‚è¿™ä¼¼ä¹æ˜¯ä¸€ç§è‡ªç„¶çš„æ–¹æ³•ï¼Œå¤§è‡´ç›¸ä¼¼çš„æ–¹æ³•åœ¨å›¾åƒè¶…åˆ†è¾¨ç‡æ–¹é¢è¡¨ç°è‰¯å¥½ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/convolution/650.png" alt></p>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å‡è®¾åå·ç§¯ç”Ÿæˆçš„å›¾åƒä¸­ï¼ŒåŒ…å«1åªé»‘çŒ«ï¼Œé»‘çŒ«èº«ä½“éƒ¨åˆ†çš„åƒç´ é¢œè‰²åº”è¯¥æ˜¯å¹³æ»‘è¿‡æ¸¡çš„ã€‚æˆ–è€…æç«¯çš„è¯´ï¼Œèº«ä½“éƒ¨åˆ†åº”è¯¥å…¨éƒ¨éƒ½æ˜¯é»‘è‰²çš„ã€‚è€Œåœ¨å®é™…ç”Ÿæˆçš„å›¾åƒä¸­ï¼Œè¯¥éƒ¨åˆ†å´æ˜¯ç”±æ·±æ·±æµ…æµ…çš„è¿‘é»‘æ–¹å—ç»„æˆçš„ï¼Œå¾ˆåƒæ£‹ç›˜çš„ç½‘ç»œã€‚è¿™å°±æ˜¯æ‰€è°“çš„æ£‹ç›˜æ•ˆåº”ã€‚ä¹‹æ‰€ä»¥ä¼šå‡ºç°æ£‹ç›˜æ•ˆåº”æ˜¯å› ä¸ºæ’å…¥çš„å€¼ä¸º0ï¼Œä½¿å¾—å·ç§¯çš„input feature mapæœ¬èº«å°±æ˜¯æ£‹ç›˜çŠ¶ï¼Œæ‰€ä»¥å¾—åˆ°çš„å¤§åˆ†è¾¨ç‡feature mapä¹Ÿä¼šäº§ç”Ÿæ£‹ç›˜æ ¼ã€‚åå·ç§¯äº§ç”Ÿçš„æ£‹ç›˜æ ¼ï¼Œåœ¨strideå’Œå·ç§¯æ ¸sizeæ˜¯æ•´æ•°å€çš„æ—¶å€™èƒ½å¤Ÿæœ‰æ‰€ç¼“è§£ï¼Œå› ä¸ºäºŒè€…æ•´é™¤å…³ç³»ä½¿å¾—å·ç§¯æ ¸æ¯æ¬¡æ»‘åŠ¨èƒ½ç”¨åˆ°çš„éé›¶åƒç´ çš„ä¸ªæ•°æ˜¯ä¸€æ ·çš„æˆ–è€…ä¸­é—´åŒºåŸŸå‘ä¸¤è¾¹é€æ¸å‡å°‘(è€Œä¸æ˜¯éšç€æ»‘åŠ¨åå¤å˜åŒ–äº§ç”Ÿæ£‹ç›˜æ ¼å½¢çŠ¶)ï¼Œä½†æ˜¯ä¾ç„¶ä¸èƒ½å®Œå…¨æ¶ˆé™¤ã€‚</p>
<p>ä»åŸå§‹è‹±æ–‡åšå®¢ä¸Šçš„å®éªŒç»“è®ºæ¥çœ‹ï¼Œä½¿ç”¨ä¸Šé‡‡æ ·+å·ç§¯å±‚çš„å›¾åƒæ”¾å¤§æ–¹æ³•æœ‰æ•ˆçš„æ”¹å–„äº†æ£‹ç›˜æ•ˆåº”ï¼Œå³ä¸æ˜¯å°†å°åˆ†è¾¨ç‡çš„feature mapçš„åƒç´ ä¹‹é—´æ’0ï¼Œè€Œæ˜¯é‡‡ç”¨æ’å€¼çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¦æ˜¯å›¾åƒç”Ÿæˆçš„æ—¶å€™é‡åˆ°äº†æ£‹ç›˜æ•ˆåº”ä½ çŸ¥é“æ€ä¹ˆåšäº†å—ï¼ŸUpsamping+Convolutionæ¥å¸®ä½ ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦å­¦ä¹ ä¸­çš„batchå¤§å°å¯¹å­¦ä¹ æ•ˆæœçš„å½±å“</title>
    <url>/2020/03/04/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84batch%E5%A4%A7%E5%B0%8F%E5%AF%B9%E5%AD%A6%E4%B9%A0%E6%95%88%E6%9E%9C%E6%9C%89%E4%BD%95%E5%BD%B1%E5%93%8D%EF%BC%9F/</url>
    <content><![CDATA[<h2 id="è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„Batch-Size"><a href="#è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„Batch-Size" class="headerlink" title="è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„Batch_Size"></a>è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„Batch_Size</h2><p>Batch_Sizeï¼ˆæ‰¹å°ºå¯¸ï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œæ¶‰åŠè¯¸å¤šçŸ›ç›¾ï¼Œä¸‹é¢é€ä¸€å±•å¼€ã€‚</p>
<h2 id="é¦–å…ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æœ‰-Batch-Size-è¿™ä¸ªå‚æ•°ï¼Ÿ"><a href="#é¦–å…ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æœ‰-Batch-Size-è¿™ä¸ªå‚æ•°ï¼Ÿ" class="headerlink" title="é¦–å…ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æœ‰ Batch_Size è¿™ä¸ªå‚æ•°ï¼Ÿ"></a>é¦–å…ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æœ‰ Batch_Size è¿™ä¸ªå‚æ•°ï¼Ÿ</h2><p>Batch çš„é€‰æ‹©ï¼Œ<strong>é¦–å…ˆå†³å®šçš„æ˜¯ä¸‹é™çš„æ–¹å‘</strong>ã€‚å¦‚æœæ•°æ®é›†æ¯”è¾ƒå°ï¼Œå®Œå…¨å¯ä»¥é‡‡ç”¨<strong>å…¨æ•°æ®é›† ï¼ˆ Full Batch Learning ï¼‰</strong>çš„å½¢å¼ï¼Œè¿™æ ·åšè‡³å°‘æœ‰ 2 ä¸ªå¥½å¤„ï¼šå…¶ä¸€ï¼Œç”±å…¨æ•°æ®é›†ç¡®å®šçš„æ–¹å‘èƒ½å¤Ÿæ›´å¥½åœ°ä»£è¡¨æ ·æœ¬æ€»ä½“ï¼Œä»è€Œæ›´å‡†ç¡®åœ°æœå‘æå€¼æ‰€åœ¨çš„æ–¹å‘ã€‚å…¶äºŒï¼Œç”±äºä¸åŒæƒé‡çš„æ¢¯åº¦å€¼å·®åˆ«å·¨å¤§ï¼Œå› æ­¤é€‰å–ä¸€ä¸ªå…¨å±€çš„å­¦ä¹ ç‡å¾ˆå›°éš¾ã€‚ Full Batch Learning å¯ä»¥ä½¿ç”¨ <strong>Rprop</strong> åªåŸºäºæ¢¯åº¦ç¬¦å·å¹¶ä¸”é’ˆå¯¹æ€§å•ç‹¬æ›´æ–°å„æƒå€¼ã€‚</p>
<p>å¯¹äºæ›´å¤§çš„æ•°æ®é›†ï¼Œä»¥ä¸Š 2 ä¸ªå¥½å¤„åˆå˜æˆäº† 2 ä¸ªåå¤„ï¼šå…¶ä¸€ï¼Œéšç€æ•°æ®é›†çš„æµ·é‡å¢é•¿å’Œå†…å­˜é™åˆ¶ï¼Œä¸€æ¬¡æ€§è½½å…¥æ‰€æœ‰çš„æ•°æ®è¿›æ¥å˜å¾—è¶Šæ¥è¶Šä¸å¯è¡Œã€‚å…¶äºŒï¼Œä»¥ Rprop çš„æ–¹å¼è¿­ä»£ï¼Œä¼šç”±äºå„ä¸ª Batch ä¹‹é—´çš„é‡‡æ ·å·®å¼‚æ€§ï¼Œå„æ¬¡æ¢¯åº¦ä¿®æ­£å€¼ç›¸äº’æŠµæ¶ˆï¼Œæ— æ³•ä¿®æ­£ã€‚è¿™æ‰æœ‰äº†åæ¥ <strong>RMSProp</strong> çš„å¦¥åæ–¹æ¡ˆã€‚</p>
<h2 id="æ—¢ç„¶-Full-Batch-Learning-å¹¶ä¸é€‚ç”¨å¤§æ•°æ®é›†ï¼Œé‚£ä¹ˆèµ°å‘å¦ä¸€ä¸ªæç«¯æ€ä¹ˆæ ·ï¼Ÿ"><a href="#æ—¢ç„¶-Full-Batch-Learning-å¹¶ä¸é€‚ç”¨å¤§æ•°æ®é›†ï¼Œé‚£ä¹ˆèµ°å‘å¦ä¸€ä¸ªæç«¯æ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="æ—¢ç„¶ Full Batch Learning å¹¶ä¸é€‚ç”¨å¤§æ•°æ®é›†ï¼Œé‚£ä¹ˆèµ°å‘å¦ä¸€ä¸ªæç«¯æ€ä¹ˆæ ·ï¼Ÿ"></a>æ—¢ç„¶ Full Batch Learning å¹¶ä¸é€‚ç”¨å¤§æ•°æ®é›†ï¼Œé‚£ä¹ˆèµ°å‘å¦ä¸€ä¸ªæç«¯æ€ä¹ˆæ ·ï¼Ÿ</h2><p>æ‰€è°“å¦ä¸€ä¸ªæç«¯ï¼Œå°±æ˜¯æ¯æ¬¡åªè®­ç»ƒä¸€ä¸ªæ ·æœ¬ï¼Œå³ Batch_Size = 1ã€‚è¿™å°±æ˜¯<strong>åœ¨çº¿å­¦ä¹ ï¼ˆOnline Learningï¼‰</strong>ã€‚çº¿æ€§ç¥ç»å…ƒåœ¨å‡æ–¹è¯¯å·®ä»£ä»·å‡½æ•°çš„é”™è¯¯é¢æ˜¯ä¸€ä¸ªæŠ›ç‰©é¢ï¼Œæ¨ªæˆªé¢æ˜¯æ¤­åœ†ã€‚å¯¹äºå¤šå±‚ç¥ç»å…ƒã€éçº¿æ€§ç½‘ç»œï¼Œåœ¨å±€éƒ¨ä¾ç„¶è¿‘ä¼¼æ˜¯æŠ›ç‰©é¢ã€‚ä½¿ç”¨åœ¨çº¿å­¦ä¹ ï¼Œæ¯æ¬¡ä¿®æ­£æ–¹å‘ä»¥å„è‡ªæ ·æœ¬çš„æ¢¯åº¦æ–¹å‘ä¿®æ­£ï¼Œæ¨ªå†²ç›´æ’å„è‡ªä¸ºæ”¿ï¼Œ<strong>éš¾ä»¥è¾¾åˆ°æ”¶æ•›</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Batch/640.jpg" alt></p>
<h2 id="å¯ä¸å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„-Batch-Size-å€¼å‘¢ï¼Ÿ"><a href="#å¯ä¸å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„-Batch-Size-å€¼å‘¢ï¼Ÿ" class="headerlink" title="å¯ä¸å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„ Batch_Size å€¼å‘¢ï¼Ÿ"></a>å¯ä¸å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„ Batch_Size å€¼å‘¢ï¼Ÿ</h2><p>å½“ç„¶å¯ä»¥ï¼Œè¿™å°±æ˜¯<strong>æ‰¹æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMini-batches Learningï¼‰</strong>ã€‚å› ä¸ºå¦‚æœæ•°æ®é›†è¶³å¤Ÿå……åˆ†ï¼Œé‚£ä¹ˆç”¨ä¸€åŠï¼ˆç”šè‡³å°‘å¾—å¤šï¼‰çš„æ•°æ®è®­ç»ƒç®—å‡ºæ¥çš„æ¢¯åº¦ä¸ç”¨å…¨éƒ¨æ•°æ®è®­ç»ƒå‡ºæ¥çš„æ¢¯åº¦æ˜¯å‡ ä¹ä¸€æ ·çš„ã€‚</p>
<h2 id="åœ¨åˆç†èŒƒå›´å†…ï¼Œå¢å¤§-Batch-Size-æœ‰ä½•å¥½å¤„ï¼Ÿ"><a href="#åœ¨åˆç†èŒƒå›´å†…ï¼Œå¢å¤§-Batch-Size-æœ‰ä½•å¥½å¤„ï¼Ÿ" class="headerlink" title="åœ¨åˆç†èŒƒå›´å†…ï¼Œå¢å¤§ Batch_Size æœ‰ä½•å¥½å¤„ï¼Ÿ"></a>åœ¨åˆç†èŒƒå›´å†…ï¼Œå¢å¤§ Batch_Size æœ‰ä½•å¥½å¤„ï¼Ÿ</h2><ul>
<li>å†…å­˜åˆ©ç”¨ç‡æé«˜äº†ï¼Œå¤§çŸ©é˜µä¹˜æ³•çš„å¹¶è¡ŒåŒ–æ•ˆç‡æé«˜ã€‚</li>
<li>è·‘å®Œä¸€æ¬¡ epochï¼ˆå…¨æ•°æ®é›†ï¼‰æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°å‡å°‘ï¼Œå¯¹äºç›¸åŒæ•°æ®é‡çš„å¤„ç†é€Ÿåº¦è¿›ä¸€æ­¥åŠ å¿«ã€‚</li>
<li>åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œä¸€èˆ¬æ¥è¯´ Batch_Size è¶Šå¤§ï¼Œå…¶ç¡®å®šçš„ä¸‹é™æ–¹å‘è¶Šå‡†ï¼Œå¼•èµ·è®­ç»ƒéœ‡è¡è¶Šå°ã€‚</li>
</ul>
<h2 id="ç›²ç›®å¢å¤§-Batch-Size-æœ‰ä½•åå¤„ï¼Ÿ"><a href="#ç›²ç›®å¢å¤§-Batch-Size-æœ‰ä½•åå¤„ï¼Ÿ" class="headerlink" title="ç›²ç›®å¢å¤§ Batch_Size æœ‰ä½•åå¤„ï¼Ÿ"></a>ç›²ç›®å¢å¤§ Batch_Size æœ‰ä½•åå¤„ï¼Ÿ</h2><ul>
<li>å†…å­˜åˆ©ç”¨ç‡æé«˜äº†ï¼Œä½†æ˜¯å†…å­˜å®¹é‡å¯èƒ½æ’‘ä¸ä½äº†ã€‚</li>
<li>è·‘å®Œä¸€æ¬¡ epochï¼ˆå…¨æ•°æ®é›†ï¼‰æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°å‡å°‘ï¼Œè¦æƒ³è¾¾åˆ°ç›¸åŒçš„ç²¾åº¦ï¼Œå…¶æ‰€èŠ±è´¹çš„æ—¶é—´å¤§å¤§å¢åŠ äº†ï¼Œä»è€Œå¯¹å‚æ•°çš„ä¿®æ­£ä¹Ÿå°±æ˜¾å¾—æ›´åŠ ç¼“æ…¢ã€‚</li>
<li>Batch_Size å¢å¤§åˆ°ä¸€å®šç¨‹åº¦ï¼Œå…¶ç¡®å®šçš„ä¸‹é™æ–¹å‘å·²ç»åŸºæœ¬ä¸å†å˜åŒ–ã€‚</li>
</ul>
<h2 id="è°ƒèŠ‚-Batch-Size-å¯¹è®­ç»ƒæ•ˆæœå½±å“åˆ°åº•å¦‚ä½•ï¼Ÿ"><a href="#è°ƒèŠ‚-Batch-Size-å¯¹è®­ç»ƒæ•ˆæœå½±å“åˆ°åº•å¦‚ä½•ï¼Ÿ" class="headerlink" title="è°ƒèŠ‚ Batch_Size å¯¹è®­ç»ƒæ•ˆæœå½±å“åˆ°åº•å¦‚ä½•ï¼Ÿ"></a>è°ƒèŠ‚ Batch_Size å¯¹è®­ç»ƒæ•ˆæœå½±å“åˆ°åº•å¦‚ä½•ï¼Ÿ</h2><p>è¿™é‡Œæ˜¯ä¸€ä¸ª LeNet åœ¨ MNIST æ•°æ®é›†ä¸Šçš„æ•ˆæœã€‚MNIST æ˜¯ä¸€ä¸ªæ‰‹å†™ä½“æ ‡å‡†åº“ï¼Œä½¿ç”¨çš„æ˜¯ Theano æ¡†æ¶ã€‚è¿™æ˜¯ä¸€ä¸ª Python  çš„æ·±åº¦å­¦ä¹ åº“ã€‚å®‰è£…æ–¹ä¾¿ï¼ˆå‡ è¡Œå‘½ä»¤è€Œå·²ï¼‰ï¼Œè°ƒè¯•ç®€å•ï¼ˆè‡ªå¸¦ Profileï¼‰ï¼ŒGPU / CPU  é€šåƒï¼Œå®˜æ–¹æ•™ç¨‹ç›¸å½“å®Œå¤‡ï¼Œæ”¯æŒæ¨¡å—ååˆ†ä¸°å¯Œï¼ˆé™¤äº† CNNsï¼Œæ›´æ˜¯æ”¯æŒ RBM / DBN / LSTM / RBM-RNN / SdA / MLPsï¼‰ã€‚åœ¨å…¶ä¸Šå±‚æœ‰ Keras å°è£…ï¼Œæ”¯æŒ GRU / JZS1,  JZS2, JZS3 ç­‰è¾ƒæ–°ç»“æ„ï¼Œæ”¯æŒ Adagrad / Adadelta / RMSprop / Adam ç­‰ä¼˜åŒ–ç®—æ³•ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Batch/641.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Batch/642.jpg" alt></p>
<p>è¿è¡Œç»“æœå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶ä¸­ç»å¯¹æ—¶é—´åšäº†æ ‡å¹ºåŒ–å¤„ç†ã€‚è¿è¡Œç»“æœä¸ä¸Šæ–‡åˆ†æç›¸å°è¯ï¼š</p>
<ul>
<li>Batch_Size å¤ªå°ï¼Œç®—æ³•åœ¨ 200 epoches å†…ä¸æ”¶æ•›ã€‚</li>
<li>éšç€ Batch_Size å¢å¤§ï¼Œå¤„ç†ç›¸åŒæ•°æ®é‡çš„é€Ÿåº¦è¶Šå¿«ã€‚</li>
<li>éšç€ Batch_Size å¢å¤§ï¼Œè¾¾åˆ°ç›¸åŒç²¾åº¦æ‰€éœ€è¦çš„ epoch æ•°é‡è¶Šæ¥è¶Šå¤šã€‚</li>
<li>ç”±äºä¸Šè¿°ä¸¤ç§å› ç´ çš„çŸ›ç›¾ï¼Œ Batch_Size å¢å¤§åˆ°æŸä¸ªæ—¶å€™ï¼Œè¾¾åˆ°<strong>æ—¶é—´ä¸Š</strong>çš„æœ€ä¼˜ã€‚</li>
<li>ç”±äºæœ€ç»ˆæ”¶æ•›ç²¾åº¦ä¼šé™·å…¥ä¸åŒçš„å±€éƒ¨æå€¼ï¼Œå› æ­¤ Batch_Size å¢å¤§åˆ°æŸäº›æ—¶å€™ï¼Œè¾¾åˆ°æœ€ç»ˆæ”¶æ•›<strong>ç²¾åº¦ä¸Š</strong>çš„æœ€ä¼˜ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å›¾åƒåˆ†ç±»ç®—æ³•ä¼˜åŒ–æŠ€å·§</title>
    <url>/2020/04/08/%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ç¯‡è®ºæ–‡çš„å…¨åæ˜¯ï¼š<strong>Bag of Tricks for Image Classification with Convolutional Neural Networks</strong>ã€‚è¿™ç¯‡è®ºæ–‡æ˜¯äºšé©¬é€Šå›¢é˜Ÿå¯¹CNNç½‘ç»œè°ƒä¼˜çš„ç»éªŒæ€»ç»“ï¼Œå®éªŒåŸºæœ¬æ˜¯åœ¨åˆ†ç±»ç½‘ç»œå®éªŒä¸Šåšçš„ã€‚ç›®å‰ï¼Œè®ºæ–‡çš„å¤ç°ç»“æœéƒ½å¯ä»¥åœ¨GluonCVæ‰¾åˆ°ï¼Œåœ°å€ä¸ºï¼š<a href="https://github.com/dmlc/gluon-cvã€‚">https://github.com/dmlc/gluon-cvã€‚</a></p>
<h2 id="æˆæœ"><a href="#æˆæœ" class="headerlink" title="æˆæœ"></a>æˆæœ</h2><p>ä¸‹é¢çš„Table1å±•ç¤ºäº†æœ¬æ–‡çš„ä¸€ç³»åˆ—Tricksè¢«ç”¨åœ¨ResNet50ç½‘ç»œåšåˆ†ç±»ä»»åŠ¡ä¸Šè·å¾—çš„ç»“æœã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/640.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨æœ¬æ–‡çš„æŠ€å·§ï¼ŒTop1å‡†ç¡®ç‡ä»75.3%æå‡åˆ°äº†79.29%ã€‚æ‰€ä»¥è¿™ä¸€ç³»åˆ—æŠ€å·§è¿˜æ˜¯éå¸¸ç»™åŠ›çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·æ¥æ¢ç´¢æ¢ç´¢ã€‚</p>
<h2 id="BaseLine"><a href="#BaseLine" class="headerlink" title="BaseLine"></a>BaseLine</h2><p>æ—¢ç„¶æ¶‰åŠåˆ°è°ƒå‚ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°±å¾—æœ‰ä¸€ä¸ªBaseLineçš„ç»“æœä½œä¸ºå‚è€ƒï¼Œè¿™ä¸€BaseLineå¹¶éç›´æ¥æˆªå–ä¹‹å‰å¯¹åº”çš„è®ºæ–‡çš„ç»“æœï¼Œè€Œæ˜¯ä½œè€…åŸºäºGluonCVå¤ç°çš„ã€‚å…³äºå¤ç°çš„ç»†èŠ‚ä½œè€…åœ¨è®ºæ–‡2.1èŠ‚ä¸­è¯´çš„å¾ˆæ¸…æ¥šï¼ŒåŒ…æ‹¬æ•°æ®é¢„å¤„ç†çš„æ–¹å¼å’Œé¡ºåºï¼Œç½‘ç»œå±‚çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œè¿­ä»£æ¬¡æ•°ï¼Œå­¦ä¹ ç‡å˜åŒ–ç­–ç•¥ç­‰ç­‰ã€‚</p>
<p>ä¸‹é¢çš„Table2å±•ç¤ºäº†ä½œè€…å¤ç°çš„ResNet-50ï¼ŒInception-V3ï¼ŒMobileNetä¸‰ä¸ªBaseLineã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/641.jpg" alt></p>
<h2 id="è®­ç»ƒè°ƒå‚ç»éªŒ"><a href="#è®­ç»ƒè°ƒå‚ç»éªŒ" class="headerlink" title="è®­ç»ƒè°ƒå‚ç»éªŒ"></a>è®­ç»ƒè°ƒå‚ç»éªŒ</h2><p>ä»‹ç»å®ŒBaseLineï¼Œæ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹ä½œè€…çš„ä¼˜åŒ–æ–¹æ³•ã€‚è®ºæ–‡ä»åŠ å¿«æ¨¡å‹è®­ç»ƒï¼Œç½‘ç»œç»“æ„ä¼˜åŒ–ä»¥åŠè®­ç»ƒå‚æ•°è°ƒä¼˜ä¸‰ä¸ªéƒ¨åˆ†åˆ†åˆ«ä»‹ç»å¦‚ä½•æå‡æ¨¡å‹çš„æ•ˆæœã€‚</p>
<h3 id="æ¨¡å‹è®­ç»ƒåŠ é€Ÿ"><a href="#æ¨¡å‹è®­ç»ƒåŠ é€Ÿ" class="headerlink" title="æ¨¡å‹è®­ç»ƒåŠ é€Ÿ"></a>æ¨¡å‹è®­ç»ƒåŠ é€Ÿ</h3><p>å…³äºæ¨¡å‹è®­ç»ƒåŠ é€Ÿï¼Œè®ºæ–‡æåˆ°äº†2ç‚¹ï¼Œä¸€æ˜¯<strong>ä½¿ç”¨æ›´å¤§çš„Batch Size</strong>ï¼ŒäºŒæ˜¯<strong>ä½¿ç”¨ä½ç²¾åº¦(å¦‚FP16)è¿›è¡Œè®­ç»ƒ</strong>ï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ··åˆç²¾åº¦è®­ç»ƒï¼‰ã€‚å…³äºä½¿ç”¨æ›´å¤§çš„Batch Sizeè¿›è¡Œè®­ç»ƒåŠ é€Ÿï¼Œä½œè€…æŒ‡å‡ºä¸€èˆ¬åªå¢åŠ Batch Sizeçš„è¯ï¼Œæ•ˆæœä¸ä¼šå¤ªç†æƒ³ï¼Œä¾‹å¦‚FaceBookè¿™ç¯‡å¤§åé¼é¼çš„è®ºæ–‡æœ‰è¯æ˜ï¼š</p>
<p><strong>Accurate, Large Minibatch SGD: Training ImageNet in 1 Hour</strong></p>
<p>ç„¶åæœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªé‡è¦è¦çš„è°ƒå‚æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å¢å¤§å­¦ä¹ ç‡</strong>ã€‚å› ä¸ºæ›´å¤§çš„Batch Sizeæ„å‘³ç€æ¯ä¸ªBatchæ•°æ®è®¡ç®—å¾—åˆ°çš„æ¢¯åº¦æ›´åŠ è´´è¿‘æ•´ä¸ªæ•°æ®é›†ï¼Œä»æ•°å­¦ä¸Šæ¥è¯´å°±æ˜¯æ–¹å·®æ›´å°ï¼Œå› æ­¤å½“æ›´æ–°æ–¹å‘æ›´åŠ å‡†ç¡®ä¹‹åï¼Œè¿ˆçš„æ­¥å­ä¹Ÿå¯ä»¥æ›´å¤§ï¼Œä¸€èˆ¬æ¥è¯´Batch Sizeå˜æˆåŸå§‹å‡ å€ï¼Œå­¦ä¹ ç‡å°±å¢åŠ å‡ å€ã€‚</li>
<li><p><strong>Warm up</strong>ã€‚Warm  upæŒ‡çš„æ˜¯ç”¨ä¸€ä¸ªå°çš„å­¦ä¹ ç‡å…ˆè®­ç»ƒå‡ ä¸ªepochï¼Œè¿™æ˜¯å› ä¸ºç½‘ç»œçš„å‚æ•°æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œå‡å¦‚ä¸€å¼€å§‹å°±é‡‡ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡å®¹æ˜“å‡ºç°æ•°å€¼ä¸ç¨³å®šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Warm upã€‚ç„¶åç­‰åˆ°è®­ç»ƒè¿‡ç¨‹åŸºæœ¬ä¸Šç¨³å®šäº†å°±å¯ä»¥ä½¿ç”¨åŸå§‹çš„åˆå§‹å­¦ä¹ ç‡è¿›è¡Œè®­ç»ƒäº†ã€‚ä½œè€…åœ¨ä½¿ç”¨Warm  upçš„è¿‡ç¨‹ä¸­ä½¿ç”¨çº¿æ€§å¢åŠ çš„ç­–ç•¥ã€‚ä¸¾ä¸ªä¾‹å­å‡å¦‚Warm  upé˜¶æ®µçš„åˆå§‹å­¦ä¹ ç‡æ˜¯0ï¼Œwarmupé˜¶æ®µå…±éœ€è¦è®­ç»ƒmä¸ªbatchçš„æ•°æ®ï¼ˆè®ºæ–‡å®ç°ä¸­mä¸ªbatchå…±5ä¸ªepochï¼‰ï¼Œå‡è®¾è®­ç»ƒé˜¶æ®µçš„åˆå§‹å­¦ä¹ ç‡æ˜¯Lï¼Œé‚£ä¹ˆåœ¨ç¬¬iä¸ªbatchçš„å­¦ä¹ ç‡å°±è®¾ç½®ä¸º$i \times L / m$ã€‚</p>
</li>
<li><p><strong>æ¯ä¸€ä¸ªæ®‹å·®å—åçš„æœ€åä¸€ä¸ªBNå±‚çš„$\gamma$å‚æ•°åˆå§‹åŒ–ä¸º0</strong>ã€‚æˆ‘ä»¬çŸ¥é“BNå±‚çš„$\gamma$ï¼Œ$\beta$å‚æ•°æ˜¯ç”¨æ¥å¯¹æ ‡å‡†åŒ–åçš„æ•°æ®åšçº¿æ€§å˜æ¢çš„ï¼Œå…¬å¼è¡¨ç¤ºä¸ºï¼š$y=\gamma x+\beta$ï¼Œå…¶ä¸­æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠ$\gamma$è®¾ä¸º1ï¼Œè€Œè¿™ç¯‡è®ºæ–‡æå‡ºåˆå§‹åŒ–ä¸º0åˆ™æ›´å®¹æ˜“è®­ç»ƒã€‚</p>
</li>
<li><p><strong>ä¸å¯¹Biaså‚æ•°åšæƒé‡æƒ©ç½š</strong>ã€‚ä½†æ˜¯å¯¹æƒé‡è¿˜æ˜¯è¦åšçš„ã€‚ã€‚</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥ä½œè€…æåˆ°äº†ä½¿ç”¨ä½ç²¾åº¦(16-Bitæµ®ç‚¹å‹)æ¥åšè®­ç»ƒåŠ é€Ÿï¼Œä¹Ÿå³æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ··åˆç²¾åº¦è®­ç»ƒã€‚ä½†ä¸æ˜¯æ‰€æœ‰çš„NVIDIA GPUéƒ½æ”¯æŒFP16ï¼Œæˆ‘å¤§æ¦‚åªçŸ¥é“V100å’Œ2080 Tiæ˜¯æ”¯æŒæ··åˆç²¾åº¦è®­ç»ƒçš„ã€‚</p>
<p>ä½œè€…å°†ä¸Šé¢çš„Tricksç»“åˆåœ¨ä¸€èµ·è¿›è¡Œè®­ç»ƒï¼Œ<strong>ä¸‹é¢çš„Table3å±•ç¤ºäº†ä½¿ç”¨æ›´å¤§çš„Batch Sizeå’Œ16ä½æµ®ç‚¹å‹è¿›è¡Œè®­ç»ƒçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¿©Tricksç›¸æ¯”äºBaseLineè®­ç»ƒé€Ÿåº¦æå‡äº†è®¸å¤šï¼Œå¹¶ä¸”ç²¾åº¦ä¹Ÿæ›´å¥½äº†ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/642.png" alt></p>
<p>è€Œä¸‹é¢çš„Table4åˆ™è¿›ä¸€æ­¥å±•ç¤ºäº†è¿™äº›Tricksçš„æ¶ˆèå®éªŒï¼Œè¯æ˜ç¡®å®æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/643.png" alt></p>
<h3 id="ç½‘ç»œç»“æ„è°ƒä¼˜"><a href="#ç½‘ç»œç»“æ„è°ƒä¼˜" class="headerlink" title="ç½‘ç»œç»“æ„è°ƒä¼˜"></a>ç½‘ç»œç»“æ„è°ƒä¼˜</h3><p>è¿™ä¸€å°èŠ‚ä»¥ResNet-50ä¸ºä¾‹å­å±•å¼€ï¼Œä¸‹é¢çš„Figure1è¡¨ç¤ºResNetç½‘ç»œçš„åŸå§‹ç»“æ„å›¾ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªè¾“å…¥æµåŠ 4ä¸ªstageå’Œä¸€ä¸ªè¾“å‡ºæµã€‚å…¶ä¸­è¾“å…¥æµå’Œæ¯ä¸ªstageçš„è¯¦ç»†ç»“æ„åœ¨Figure1ä¸­é—´é‚£ä¸€åˆ—æ˜¾ç¤ºï¼Œè€Œæ®‹å·®ç»“æ„åˆ™åœ¨Figure1ä¸­æœ€å³è¾¹è¿›è¡Œæ˜¾ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/644.png" alt></p>
<p>è®ºæ–‡åœ¨ç½‘ç»œç»“æ„éƒ¨åˆ†è¿›è¡Œæ”¹è¿›è·å¾—çš„3ç§ç»“æ„å¦‚<code>Figure2(a)ï¼Œ(b)ï¼Œ(c)</code>æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/645.jpg" alt></p>
<ul>
<li><p><strong>ResNet-B</strong>ã€‚ResNet-Bæ”¹è¿›çš„åœ°æ–¹å°±æ˜¯å°†4ä¸ªStageä¸­åšä¸‹é‡‡æ ·çš„æ®‹å·®æ¨¡å—çš„ä¸‹é‡‡æ ·æ“ä½œä»ç¬¬ä¸€ä¸ªå·ç§¯å±‚æ¢åˆ°ç¬¬ä¸‰ä¸ªå·ç§¯å±‚ï¼Œå¦‚æœä¸‹é‡‡æ ·æ“ä½œæ”¾åœ¨çš„å·ç§¯å±‚ï¼Œé‚£ä¹ˆä¼šä¸¢å¤±æ¯”è¾ƒå¤šçš„ç‰¹å¾ä¿¡æ¯(é€šé“ç¼©å‡é»˜è®¤æ˜¯$\frac{1}{4}$ï¼Œæ‰€ä»¥ä¼šä¸¢å¤±$\frac{3}{4}$)ï¼Œè€Œå°†ä¸‹é‡‡æ ·æ“ä½œæ”¾åœ¨ç¬¬3ä¸ªå·ç§¯å±‚åˆ™å¯ä»¥å‡å°‘è¿™ç§æŸå¤±ï¼Œå› ä¸ºå³ä¾¿stride=2ï¼Œä½†æ˜¯å·ç§¯æ ¸å°ºå¯¸æ›´å¤§ï¼Œä¿ç•™æœ‰æ•ˆä¿¡æ¯æ›´å¤šã€‚</p>
</li>
<li><p><strong>ResNet-C</strong>ã€‚ResNet-Cæ”¹è¿›çš„åœ°æ–¹æ˜¯å°†Figure1ä¸­çš„è¾“å…¥æµéƒ¨åˆ†çš„7 x 7å·ç§¯ç”¨ä¸¤ä¸ª3 x 3å·ç§¯æ¥æ›¿æ¢ï¼Œè¿™éƒ¨åˆ†å€Ÿé‰´äº†Inception V2çš„æ€æƒ³ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡å°‘è¿ç®—é‡ã€‚ä½†å¾ˆé—æ†¾ï¼Œä»åé¢çš„Table5å¯ä»¥çœ‹å‡º3ä¸ª3 x 3å·ç§¯çš„FLOPSæ¯”åŸå§‹çš„7 x 7 + 5 x 5å·ç§¯çš„FLOPSè¿˜å¤šã€‚ã€‚</p>
</li>
<li><p><strong>ResNet-D</strong>ã€‚ResNet-Dæ”¹è¿›çš„åœ°æ–¹æ˜¯å°†Stageéƒ¨åˆ†åšä¸‹é‡‡æ ·çš„æ®‹å·®æ¨¡å—çš„æ”¯è·¯ä»stride=2çš„1 x 1å·ç§¯å±‚æ¢æˆstride=1çš„å·ç§¯å±‚ï¼Œå¹¶åœ¨å‰é¢æ·»åŠ ä¸€ä¸ªpå¹³å‡æ± åŒ–å±‚æ¥åšä¸‹é‡‡æ ·ã€‚ä¸ªäººçŒœæµ‹è¿™å¯ä»¥å‡å°‘ä¿¡æ¯æŸå¤±ï¼Ÿ</p>
</li>
</ul>
<p>æœ€ç»ˆå…³äºè¿™äº›æ”¹è¿›çš„ç½‘ç»œç»“æ„çš„æ•ˆæœå¦‚Table5æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœæå‡è¿˜æ˜¯æœ‰çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/646.png" alt></p>
<h3 id="æ¨¡å‹è®­ç»ƒè°ƒå‚"><a href="#æ¨¡å‹è®­ç»ƒè°ƒå‚" class="headerlink" title="æ¨¡å‹è®­ç»ƒè°ƒå‚"></a>æ¨¡å‹è®­ç»ƒè°ƒå‚</h3><p>è¿™éƒ¨åˆ†ä½œè€…æåˆ°äº†4ä¸ªè°ƒå‚æŠ€å·§ï¼š</p>
<ul>
<li><p><strong>å­¦ä¹ ç‡è¡°å‡ç­–ç•¥é‡‡ç”¨cosineå‡½æ•°</strong>ã€‚è¿™éƒ¨åˆ†çš„å®éªŒç»“æœå¯ä»¥çœ‹Figure3ï¼Œå…¶ä¸­Figure3(a)è¡¨ç¤º<strong>cosine decay</strong>å’Œ<strong>step decay</strong>çš„ç¤ºæ„å›¾ï¼Œè€Œcosineè¡°å‡çš„å…¬å¼ä¸ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/647.png" alt><br>è€ŒFigure3(b)åˆ™è¡¨ç¤º2ç§å­¦ä¹ ç‡è¡°å‡ç­–ç•¥åœ¨æ•ˆæœä¸Šçš„å¯¹æ¯”ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/648.png" alt></p>
</li>
<li><p><strong>ä½¿ç”¨æ ‡ç­¾å¹³æ»‘(label smooth)</strong>ã€‚è¿™éƒ¨åˆ†æ˜¯æŠŠåŸå§‹çš„one-hotç±»å‹æ ‡ç­¾åšè½¯åŒ–ï¼Œè¿™æ ·å¯ä»¥åœ¨è®¡ç®—æŸå¤±æ—¶ä¸€å®šç¨‹åº¦çš„å‡å°è¿‡æ‹Ÿåˆã€‚ä»äº¤å‰ç†µæŸå¤±å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰çœŸå®æ ‡ç­¾å¯¹åº”çš„ç±»åˆ«æ¦‚ç‡æ‰ä¼šå¯¹æŸå¤±å€¼è®¡ç®—æœ‰æ‰€å¸®åŠ©ï¼Œå› æ­¤æ ‡ç­¾å¹³æ»‘ç›¸å½“äºå‡å°‘çœŸå®æ ‡ç­¾çš„ç±»åˆ«æ¦‚ç‡åœ¨è®¡ç®—æŸå¤±å€¼æ—¶çš„æƒé‡ï¼ŒåŒæ—¶å¢åŠ å…¶ä»–ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡åœ¨æœ€ç»ˆæŸå¤±å‡½æ•°ä¸­çš„æƒé‡ã€‚<strong>è¿™æ ·çœŸå®ç±»åˆ«æ¦‚ç‡å’Œå…¶ä»–ç±»åˆ«çš„æ¦‚ç‡å‡å€¼ä¹‹é—´çš„gapï¼ˆå€æ•°ï¼‰å°±ä¼šä¸‹é™ä¸€äº›</strong>ï¼ŒLable Smoothå®é™…çš„å…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/649.png" alt><br>ä»£ç å®ç°å¯ä»¥ç®€å•è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new_labels = (<span class="number">1.0</span> - label_smoothing) * one_hot_labels +  label_smoothing / num_classes</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´çš„Pytorchä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelSmoothing</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    NLL loss with label smoothing.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, smoothing=<span class="number">0.0</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Constructor for the LabelSmoothing module.</span></span><br><span class="line"><span class="string">        :param smoothing: label smoothing factor</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(LabelSmoothing, self).__init__()</span><br><span class="line">        self.confidence = <span class="number">1.0</span> - smoothing</span><br><span class="line">        self.smoothing = smoothing</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x, target</span>):</span></span><br><span class="line">        logprobs = torch.nn.functional.log_softmax(x, dim=-<span class="number">1</span>)</span><br><span class="line">      </span><br><span class="line">        nll_loss = -logprobs.gather(dim=-<span class="number">1</span>, index=target.unsqueeze(<span class="number">1</span>))</span><br><span class="line">        nll_loss = nll_loss.squeeze(<span class="number">1</span>)</span><br><span class="line">        smooth_loss = -logprobs.mean(dim=-<span class="number">1</span>)</span><br><span class="line">        loss = self.confidence * nll_loss + self.smoothing * smooth_loss</span><br><span class="line">        <span class="keyword">return</span> loss.mean()</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ç»†èŠ‚å’Œå…¬å¼å¯ä»¥å†é˜…è¯»åŸæ–‡ï¼Œè¿™é‡Œå±•ç¤ºä¸€ä¸‹Lable Smoothçš„æ•ˆæœã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/650.png" alt><br>æ€»ç»“å°±ä¸€å¥è¯ï¼Œone-hotç¼–ç ä¼šè‡ªé©±çš„å‘æ­£ç±»å’Œè´Ÿç±»çš„å·®å€¼æ‰©å¤§çš„æ–¹å‘å­¦ä¹ (è¿‡åº¦çš„ä¿¡ä»»æ ‡ç­¾ä¸º1çš„ä¸ºæ­£ç±»)ï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸è¶³çš„æƒ…å†µå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œæ‰€ä»¥ä½¿ç”¨Label Smoothæ¥è½¯åŒ–ä¸€ä¸‹ï¼Œä½¿å¾—æ²¡é‚£ä¹ˆå®¹æ˜“è¿‡æ‹Ÿåˆã€‚</p>
</li>
<li><p><strong>çŸ¥è¯†è’¸é¦(knowledge distillation)</strong>ã€‚çŸ¥è¯†è’¸é¦æ—¶æ¨¡å‹å‹ç¼©é¢†åŸŸçš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œå³é‡‡ç”¨ä¸€ä¸ªæ•ˆæœæ›´å¥½çš„<strong>teacher model</strong>è®­ç»ƒ<strong>student model</strong>ï¼Œä½¿å¾—<strong>student model</strong>åœ¨æ¨¡å‹ç»“æ„ä¸æ”¹å˜çš„æƒ…å†µä¸‹æå‡æ•ˆæœã€‚è¿™ç¯‡è®ºæ–‡ä½¿ç”¨ResNet-152ä½œä¸º<strong>teacher model</strong>ï¼Œç”¨ResNet-50ä½œ<strong>student model</strong>ã€‚ä»£ç å®ç°ç»†èŠ‚ä¸Šï¼Œé€šè¿‡åœ¨ResNetç½‘ç»œåæ·»åŠ ä¸€ä¸ªè’¸é¦æŸå¤±å‡½æ•°å®ç°ï¼Œè¿™ä¸ªæŸå¤±å‡½æ•°ç”¨æ¥è¯„ä»·<strong>teacher model</strong>è¾“å‡ºå’Œ<strong>student model</strong>è¾“å‡ºçš„å·®å¼‚ï¼Œå› æ­¤æ•´ä½“çš„æŸå¤±å‡½æ•°åŸæŸå¤±å‡½æ•°å’Œè’¸é¦æŸå¤±å‡½æ•°çš„ç»“åˆï¼Œå¦‚å…¬å¼(6)æ‰€ç¤ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/651.png" alt><br>æ³¨æ„ï¼Œpä»£è¡¨çœŸå®æ¦‚ç‡ï¼Œzå’Œrè¡¨ç¤ºstudnet modelå’Œtecher modelçš„æœ€åä¸€ä¸ªå…¨è¿æ¥å±‚çš„è¾“å‡ºï¼ŒTæ˜¯è¶…å‚æ•°ï¼Œç”¨æ¥å¹³æ»‘softmaxå‡½æ•°çš„è¾“å‡ºã€‚</p>
</li>
<li><p><strong>Mixup</strong>ã€‚è®ºæ–‡è¿˜å¼•å…¥äº†Mixupè¿™ç§æ•°æ®å¢å¼ºæ–¹å¼ï¼Œå¦‚æœä½¿ç”¨äº†Mixupæ•°æ®å¢å¼ºæ¥è¿›è¡Œè®­ç»ƒï¼Œé‚£ä¹ˆæ¯æ¬¡éœ€è¦è¯»å–2å¼ è¾“å…¥å›¾åƒï¼Œè¿™é‡Œç”¨$\left(x_{i}, y_{i}\right)$,$\left(x_{j}, y_{j}\right)$æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆé€šè¿‡ä¸‹é¢çš„å…¬å¼å°±å¯ä»¥åˆæˆè·å¾—ä¸€å¼ æ–°çš„å›¾åƒå’Œæ ‡ç­¾$(\hat{x}, \hat{y})$ï¼Œç„¶åä½¿ç”¨è¿™å¼ æ–°å›¾åƒå’Œæ–°æ ‡ç­¾è¿›è¡Œè®­ç»ƒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼è®­ç»ƒæ¨¡å‹æ—¶è¦è®­æ›´å¤š<code>epoch</code>ã€‚å¼å­ä¸­çš„$\lambda$æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œç”¨æ¥è°ƒèŠ‚åˆæˆçš„æ¯”é‡ï¼Œå–å€¼èŒƒå›´æ˜¯[0,1]ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/652.png" alt><br>æœ€ç»ˆï¼Œåœ¨ä½¿ç”¨äº†è¿™4ä¸ªTricksåçš„æ¶ˆèå®éªŒç»“æœå¦‚Table6æ‰€ç¤ºã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/653.jpg" alt></p>
</li>
</ul>
<h2 id="è¿ç§»å­¦ä¹ "><a href="#è¿ç§»å­¦ä¹ " class="headerlink" title="è¿ç§»å­¦ä¹ "></a>è¿ç§»å­¦ä¹ </h2><p>å½“æŠŠä¸Šé¢çš„Tricksè¿ç§»åˆ°ç›®æ ‡æ£€æµ‹å’Œè¯­ä¹‰åˆ†å‰²ä»»åŠ¡åŒæ ·æ˜¯æœ‰æ•ˆçš„ï¼Œå®éªŒç»“æœå¦‚Table8å’ŒTable9æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/image_optimize/654.webp" alt></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ€»çš„æ¥è¯´ï¼Œè¿™ç¯‡è®ºæ–‡ç»™äº†æˆ‘ä»¬éå¸¸å¤šçš„ç‚¼ä¸¹æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æŠ€å·§æ”¾è¿ç§»åˆ°æˆ‘ä»¬è‡ªå·±çš„æ•°æ®é›†ä¸Šè·å¾—æ•ˆæœæå‡ï¼Œæ˜¯éå¸¸å®ç”¨çš„ä¸€ç¯‡è®ºæ–‡äº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹è°ƒç ”</title>
    <url>/2020/01/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E8%B0%83%E7%A0%94/</url>
    <content><![CDATA[<h3 id="ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡"><a href="#ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡" class="headerlink" title="ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡"></a>ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡</h3><ul>
<li><strong>åˆ†ç±»-Classification</strong>ï¼šè§£å†³â€œæ˜¯ä»€ä¹ˆï¼Ÿâ€çš„é—®é¢˜ï¼Œå³ç»™å®šä¸€å¼ å›¾ç‰‡æˆ–ä¸€æ®µè§†é¢‘åˆ¤æ–­é‡Œé¢åŒ…å«ä»€ä¹ˆç±»åˆ«çš„ç›®æ ‡ã€‚</li>
<li><strong>å®šä½-Location</strong>ï¼šè§£å†³â€œåœ¨å“ªé‡Œï¼Ÿâ€çš„é—®é¢˜ï¼Œå³å®šä½å‡ºè¿™ä¸ªç›®æ ‡çš„çš„ä½ç½®ã€‚</li>
<li><strong>æ£€æµ‹-Detection</strong>ï¼šè§£å†³â€œæ˜¯ä»€ä¹ˆï¼Ÿåœ¨å“ªé‡Œï¼Ÿâ€çš„é—®é¢˜ï¼Œå³å®šä½å‡ºè¿™ä¸ªç›®æ ‡çš„çš„ä½ç½®å¹¶ä¸”çŸ¥é“ç›®æ ‡ç‰©æ˜¯ä»€ä¹ˆã€‚</li>
<li><strong>åˆ†å‰²-Segmentation</strong>ï¼šåˆ†ä¸ºå®ä¾‹çš„åˆ†å‰²ï¼ˆInstance-levelï¼‰å’Œåœºæ™¯åˆ†å‰²ï¼ˆScene-levelï¼‰ï¼Œè§£å†³â€œæ¯ä¸€ä¸ªåƒç´ å±äºå“ªä¸ªç›®æ ‡ç‰©æˆ–åœºæ™¯â€çš„é—®é¢˜ã€‚</li>
</ul>
<h3 id="æ‰€é¢ä¸´çš„æŒ‘æˆ˜"><a href="#æ‰€é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="æ‰€é¢ä¸´çš„æŒ‘æˆ˜"></a>æ‰€é¢ä¸´çš„æŒ‘æˆ˜</h3><ul>
<li>ç›®æ ‡å¯èƒ½å‡ºç°åœ¨å›¾åƒçš„ä»»ä½•ä½ç½®ã€‚</li>
<li>ç›®æ ‡æœ‰å„ç§ä¸åŒçš„å¤§å°ã€‚</li>
<li>ç›®æ ‡å¯èƒ½æœ‰å„ç§ä¸åŒçš„å½¢çŠ¶ã€‚</li>
</ul>
<h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/deep_learning_object_detection_dataset.PNG" alt></p>
<ul>
<li><p>Pascal Visual Object Classes(05-12) æ˜¯è®¡ç®—æœºè§†è§‰é¢†åŸŸæœ€é‡è¦çš„èµ›äº‹ä¹‹ä¸€ã€‚åŒ…å«å¤šä»»åŠ¡ï¼Œå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²å’Œè¡Œä¸ºæ£€æµ‹ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ Pascal-VOC ç”¨äºæ£€æµ‹ï¼šVOC07 å’Œ VOC12ï¼Œå‰è€…åŒ…å« 5K å¼ è®­ç»ƒå›¾åƒï¼Œå…± 12K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚åè€…åŒ…å« 11K å¼ è®­ç»ƒå›¾åƒï¼Œå…± 27K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚ä¸¤ä¸ªæ•°æ®é›†ä¸­åŒ…å«äº† 20 ä¸ªç”Ÿæ´»ä¸­å¸¸è§çš„ç›®æ ‡ç±»ï¼ˆPersonï¼šperson; Animalï¼šbird, cat, cow, dog, horse, sheep; Vehicleï¼šaeroplane, bicycle, boat, bus, car, motor-bike, train; Indoor: bottle, chair, dining table, potted plant, sofa, tv/monitorï¼‰</p>
</li>
<li><p>ImageNet Large Scale Visual Recognition Challenge(10-17) åŒ…å«æ£€æµ‹æŒ‘æˆ˜èµ›ã€‚Imagenetæ•°æ®é›†æœ‰1400å¤šä¸‡å¹…å›¾ç‰‡ï¼Œæ¶µç›–2ä¸‡å¤šä¸ªç±»åˆ«ï¼ŒILSVRCæ¯”èµ›ä¼šæ¯å¹´ä»ImageNetæ•°æ®é›†ä¸­æŠ½å‡ºéƒ¨åˆ†æ ·æœ¬, æ£€æµ‹æ•°æ®é›†åŒ…æ‹¬ 200 ç±»è§†è§‰ç›®æ ‡ï¼Œå›¾åƒ/ç›®æ ‡æ¯” VOC å¤§ä¸¤ä¸ªæ•°é‡çº§ã€‚ä¾‹å¦‚ï¼ŒILSVRC-14 åŒ…å«517K å›¾åƒä»¥åŠ 534K æ³¨é‡Šç›®æ ‡ã€‚</p>
</li>
<li><p>MS-COCO æ˜¯å½“å‰æœ€æœ‰æŒ‘æˆ˜æ€§çš„ç›®æ ‡æ£€æµ‹æ•°æ®é›†ã€‚ä» 15 å¹´å¼€å§‹ä¸¾åŠæ¯”èµ›ã€‚å®ƒçš„ç›®æ ‡ç±»åˆ«æ¯” ILSVRC å°‘ï¼Œä½†æ˜¯ç›®æ ‡å®ä¾‹æ›´å¤šã€‚ä¾‹å¦‚ï¼ŒMS-COCO-17 åŒ…å« 164K å¼ å›¾åƒï¼Œæ¥è‡ª 80 ç±»çš„ 897K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚ä¸ VOC å’Œ ILSVRC ç›¸æ¯”ï¼ŒMS-COCO é™¤äº†è¾¹ç•Œæ¡†æ³¨é‡Šä»¥å¤–ï¼Œæ¯ä¸ªç›®æ ‡é€šè¿‡å®ä¾‹åˆ†å‰²è¿›ä¸€æ­¥æ ‡æ³¨æ¥å¸®åŠ©ç²¾ç¡®å®šä½ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…å«æ›´å¤šå°ç›®æ ‡ï¼ˆé¢ç§¯å°äºå›¾åƒçš„ 1%ï¼‰ï¼Œä»¥åŠå¯†é›†å®šä½ç›®æ ‡ã€‚è¿™äº›ç‰¹ç‚¹ä½¿ MSâˆ’COCOä¸­çš„ç›®æ ‡åˆ†å¸ƒæ›´æ¥è¿‘äºçœŸå®ä¸–ç•Œã€‚</p>
</li>
<li><p>Open Images</p>
<p>2018 å¹´æ¨å‡ºäº† Open ImagesOpen~ImagesOpen Images æ£€æµ‹æŒ‘æˆ˜èµ›ã€‚åŒ…å«ä¸¤ä¸ªä»»åŠ¡ï¼š</p>
<p>æ ‡å‡†ç›®æ ‡æ£€æµ‹<br>è§†è§‰å…³ç³»æ£€æµ‹ï¼Œç”¨äºæ£€æµ‹ç‰¹å®šå…³ç³»ä¸­çš„åŒ¹é…ç›®æ ‡</p>
<p>ç›®æ ‡æ£€æµ‹ï¼Œæ•°æ®é›†åŒ…å« 1910K å¼ å›¾åƒï¼Œ600 ä¸ªç›®æ ‡ç±»åˆ«çš„ 15440K ä¸ªæ ‡æ³¨ç›®æ ‡ã€‚</p>
</li>
</ul>
<h3 id="è¯„ä»·æŒ‡æ ‡"><a href="#è¯„ä»·æŒ‡æ ‡" class="headerlink" title="è¯„ä»·æŒ‡æ ‡"></a>è¯„ä»·æŒ‡æ ‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é¢„æµ‹\å®é™…</th>
<th>æ­£</th>
<th>è´Ÿ  </th>
</tr>
</thead>
<tbody>
<tr>
<td>æ­£</td>
<td>TP</td>
<td>FP</td>
<td></td>
</tr>
<tr>
<td>è´Ÿ</td>
<td>FN</td>
<td>TN</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Recall=TP/(TP+FN)ï¼Œå¬å›ç‡ï¼Œ<strong>å¯ç†è§£ä¸ºæ­£ç¡®çš„è¢«åˆ¤æ–­ä¸ºæ­£ç¡®çš„</strong></p>
<p>Precision=TP/(TP+FP)ï¼Œå‡†ç¡®åº¦ï¼Œ<strong>é¢„æµ‹ä¸ºæ­£ç±»ä¸­ï¼Œå®é™…ä¸ºæ­£ç±»çš„æ¯”ä¾‹</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2018042521300715.png" alt></p>
<p><strong>å‡†ç¡®ç‡-å¬å›ç‡æ›²çº¿ï¼ˆP-Ræ›²çº¿ï¼‰</strong>ï¼šä»¥å¬å›ç‡ä¸ºæ¨ªåæ ‡ï¼Œç²¾ç¡®ç‡ä¸ºçºµåæ ‡</p>
<script type="math/tex; mode=display">
\mathrm{AP}=\int_{0}^{1} P(R) d(R)</script><script type="math/tex; mode=display">
\mathrm{mAP}=\frac{1}{\text { classes }} \sum_{i=1}^{\text {classes }} \int_{0}^{1} P(R) d(R)</script><p><strong>IoU</strong>ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180423003716617.png" alt></p>
<p>VOC07 ä»¥åä½¿ç”¨ AP è¯„ä»·æ£€æµ‹æ€§èƒ½ã€‚AP å®šä¹‰ä¸ºä¸åŒå¬å›ç‡ä¸‹çš„å¹³å‡æ£€æµ‹ç²¾åº¦ï¼Œé€šå¸¸åœ¨æŸä¸€ç‰¹å®šç±»åˆ«ä¸‹è¿›è¡Œè¯„ä¼°ã€‚ä¸ºæ¯”è¾ƒæ‰€æœ‰ç›®æ ‡ç±»çš„æ£€æµ‹æ€§èƒ½ï¼Œé€šå¸¸ä½¿ç”¨ mAP ä½œä¸ºæœ€ç»ˆæ€§èƒ½æŒ‡æ ‡ã€‚</p>
<p>ä¸ºåº¦é‡ç›®æ ‡å®šä½ç²¾åº¦ï¼Œä½¿ç”¨äº¤å¹¶æ¯”ï¼ˆIoUï¼‰æ¥æ£€æŸ¥é¢„æµ‹æ¡†å’Œ GT æ¡†ä¹‹é—´çš„ IoUæ˜¯å¦å¤§äºé¢„å®šä¹‰çš„é˜ˆå€¼ï¼Œå¦‚ï¼Œ0.5ã€‚å¦‚æœå¤§äºé˜ˆå€¼åˆ™è¡¨ç¤ºæˆåŠŸæ£€æµ‹ï¼Œå¦åˆ™è¡¨ç¤ºæ¼æ£€ã€‚åŸºäº 0.5IoU çš„ mAP å·²ç»æˆä¸ºå¤šå¹´æ¥ç”¨äºç›®æ ‡æ£€æµ‹é—®é¢˜çš„äº‹å®ä¸Šçš„åº¦é‡æ ‡å‡†ã€‚</p>
<p>MSâˆ’COCO çš„ AP æ˜¯åœ¨ 0.5âˆ’0.95å¤šä¸ª IoU é˜ˆå€¼ä¸Šçš„å¹³å‡å€¼ã€‚</p>
<h3 id="æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•"><a href="#æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•" class="headerlink" title="æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•"></a>æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹æ–¹æ³•</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/deep_learning_object_detection_history.PNG" alt></p>
<p><strong>Two-stage Detectorsï¼ˆä¸¤é˜¶æ®µç›®æ ‡æ£€æµ‹å™¨ï¼‰</strong></p>
<p>é¦–å…ˆç”±ç®—æ³•ï¼ˆalgorithmï¼‰ç”Ÿæˆä¸€ç³»åˆ—ä½œä¸ºæ ·æœ¬çš„å€™é€‰æ¡†ï¼Œå†é€šè¿‡å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œæ ·æœ¬ï¼ˆSampleï¼‰åˆ†ç±»ã€‚</p>
<p>è¯¸å¦‚R-CNNï¼ŒFast R-CNNï¼ŒFaster R-CNNåˆ°æœ€æ–°çš„Mask Scoring R-CNNç­‰ç½‘ç»œç»“æ„ï¼Œéƒ½å±äºTwo-stageæ£€æµ‹æ–¹æ³•ã€‚</p>
<p><strong>One-stage Detectorsï¼ˆå•é˜¶æ®µç›®æ ‡æ£€æµ‹å™¨ï¼‰</strong></p>
<p>ä¸éœ€è¦äº§ç”Ÿå€™é€‰æ¡†ï¼Œç›´æ¥å°†ç›®æ ‡æ¡†å®šä½çš„é—®é¢˜è½¬åŒ–ä¸ºå›å½’ï¼ˆRegressionï¼‰é—®é¢˜å¤„ç†(Process)ã€‚</p>
<p>ä»æœ€æ—©çš„OverFeatåˆ°ç°åœ¨çš„YOLOï¼ŒSSDï¼ŒRetinaNetï¼ŒYOLOv2ï¼ŒCornerNetç­‰éƒ½å±äºone stageç›®æ ‡æ£€æµ‹æ–¹æ³•ã€‚</p>
<p>å³ï¼š</p>
<p><strong>åŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰</strong>çš„ï¼Œå¦‚R-CNNã€SPP-netã€Fast R-CNNã€Faster R-CNNã€R-FCNï¼›</p>
<p><strong>åŸºäºç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰</strong>ï¼Œæ— éœ€å€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„ï¼Œå¦‚YOLOã€SSDã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180509095302426.png" alt></p>
<p>å¯¹äºä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼ŒåŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„æ–¹æ³•åœ¨æ£€æµ‹å‡†ç¡®ç‡å’Œå®šä½ç²¾åº¦ä¸Šå ä¼˜ï¼ŒåŸºäºç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰çš„ç®—æ³•é€Ÿåº¦å ä¼˜ã€‚ç›¸å¯¹äºR-CNNç³»åˆ—çš„â€œçœ‹ä¸¤çœ¼â€ï¼ˆå€™é€‰æ¡†æå–å’Œåˆ†ç±»ï¼‰ï¼ŒYOLOåªéœ€è¦â€œçœ‹ä¸€çœ¼â€ã€‚æ€»ä¹‹ï¼Œç›®å‰æ¥è¯´ï¼ŒåŸºäºå€™é€‰åŒºåŸŸï¼ˆRegion Proposalï¼‰çš„æ–¹æ³•ä¾ç„¶å æ®ä¸Šé£ï¼Œä½†ç«¯åˆ°ç«¯çš„æ–¹æ³•é€Ÿåº¦ä¸Šä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<h3 id="å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦"><a href="#å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦" class="headerlink" title="å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦"></a>å„æ–¹æ³•åœ¨å„æ•°æ®é›†ä¸Šçš„ç²¾åº¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Detector</th>
<th style="text-align:center">VOC07 (mAP@IoU=0.5)</th>
<th style="text-align:center">VOC12 (mAP@IoU=0.5)</th>
<th style="text-align:center">COCO (mAP@IoU=0.5:0.95)</th>
<th style="text-align:center">Published In</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">R-CNN</td>
<td style="text-align:center">58.5</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™14</td>
</tr>
<tr>
<td style="text-align:center">SPP-Net</td>
<td style="text-align:center">59.2</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™14</td>
</tr>
<tr>
<td style="text-align:center">MR-CNN</td>
<td style="text-align:center">78.2 (07+12)</td>
<td style="text-align:center">73.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™15</td>
</tr>
<tr>
<td style="text-align:center">Fast R-CNN</td>
<td style="text-align:center">70.0 (07+12)</td>
<td style="text-align:center">68.4 (07++12)</td>
<td style="text-align:center">19.7</td>
<td style="text-align:center">ICCVâ€™15</td>
</tr>
<tr>
<td style="text-align:center">Faster R-CNN</td>
<td style="text-align:center">73.2 (07+12)</td>
<td style="text-align:center">70.4 (07++12)</td>
<td style="text-align:center">21.9</td>
<td style="text-align:center">NIPSâ€™15</td>
</tr>
<tr>
<td style="text-align:center">YOLO v1</td>
<td style="text-align:center">66.4 (07+12)</td>
<td style="text-align:center">57.9 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">G-CNN</td>
<td style="text-align:center">66.8</td>
<td style="text-align:center">66.4 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">AZNet</td>
<td style="text-align:center">70.4</td>
<td style="text-align:center">-</td>
<td style="text-align:center">22.3</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">ION</td>
<td style="text-align:center">80.1</td>
<td style="text-align:center">77.9</td>
<td style="text-align:center">33.1</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">HyperNet</td>
<td style="text-align:center">76.3 (07+12)</td>
<td style="text-align:center">71.4 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">OHEM</td>
<td style="text-align:center">78.9 (07+12)</td>
<td style="text-align:center">76.3 (07++12)</td>
<td style="text-align:center">22.4</td>
<td style="text-align:center">CVPRâ€™16</td>
</tr>
<tr>
<td style="text-align:center">MPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">33.2</td>
<td style="text-align:center">BMVCâ€™16</td>
</tr>
<tr>
<td style="text-align:center">SSD</td>
<td style="text-align:center">76.8 (07+12)</td>
<td style="text-align:center">74.9 (07++12)</td>
<td style="text-align:center">31.2</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">GBDNet</td>
<td style="text-align:center">77.2 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">27.0</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">CPF</td>
<td style="text-align:center">76.4 (07+12)</td>
<td style="text-align:center">72.6 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™16</td>
</tr>
<tr>
<td style="text-align:center">R-FCN</td>
<td style="text-align:center">79.5 (07+12)</td>
<td style="text-align:center">77.6 (07++12)</td>
<td style="text-align:center">29.9</td>
<td style="text-align:center">NIPSâ€™16</td>
</tr>
<tr>
<td style="text-align:center">DeepID-Net</td>
<td style="text-align:center">69.0</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">PAMIâ€™16</td>
</tr>
<tr>
<td style="text-align:center">NoC</td>
<td style="text-align:center">71.6 (07+12)</td>
<td style="text-align:center">68.8 (07+12)</td>
<td style="text-align:center">27.2</td>
<td style="text-align:center">TPAMIâ€™16</td>
</tr>
<tr>
<td style="text-align:center">DSSD</td>
<td style="text-align:center">81.5 (07+12)</td>
<td style="text-align:center">80.0 (07++12)</td>
<td style="text-align:center">33.2</td>
<td style="text-align:center">arXivâ€™17</td>
</tr>
<tr>
<td style="text-align:center">TDM</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">37.3</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">FPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">36.2</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">YOLO v2</td>
<td style="text-align:center">78.6 (07+12)</td>
<td style="text-align:center">73.4 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">RON</td>
<td style="text-align:center">77.6 (07+12)</td>
<td style="text-align:center">75.4 (07++12)</td>
<td style="text-align:center">27.4</td>
<td style="text-align:center">CVPRâ€™17</td>
</tr>
<tr>
<td style="text-align:center">DeNet</td>
<td style="text-align:center">77.1 (07+12)</td>
<td style="text-align:center">73.9 (07++12)</td>
<td style="text-align:center">33.8</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">CoupleNet</td>
<td style="text-align:center">82.7 (07+12)</td>
<td style="text-align:center">80.4 (07++12)</td>
<td style="text-align:center">34.4</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">RetinaNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">39.1</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">DSOD</td>
<td style="text-align:center">77.7 (07+12)</td>
<td style="text-align:center">76.3 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">SMN</td>
<td style="text-align:center">70.0</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ICCVâ€™17</td>
</tr>
<tr>
<td style="text-align:center">Light-Head R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.5</td>
<td style="text-align:center">arXivâ€™17</td>
</tr>
<tr>
<td style="text-align:center">YOLO v3</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">33.0</td>
<td style="text-align:center">arXivâ€™18</td>
</tr>
<tr>
<td style="text-align:center">SIN</td>
<td style="text-align:center">76.0 (07+12)</td>
<td style="text-align:center">73.1 (07++12)</td>
<td style="text-align:center">23.2</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">STDN</td>
<td style="text-align:center">80.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">RefineDet</td>
<td style="text-align:center">83.8 (07+12)</td>
<td style="text-align:center">83.5 (07++12)</td>
<td style="text-align:center">41.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">SNIP</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">45.7</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Relation-Network</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">32.5</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Cascade R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">MLKP</td>
<td style="text-align:center">80.6 (07+12)</td>
<td style="text-align:center">77.2 (07++12)</td>
<td style="text-align:center">28.6</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Fitness-NMS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.8</td>
<td style="text-align:center">CVPRâ€™18</td>
</tr>
<tr>
<td style="text-align:center">RFBNet</td>
<td style="text-align:center">82.2 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">CornerNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.1</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">PFPNet</td>
<td style="text-align:center">84.1 (07+12)</td>
<td style="text-align:center">83.7 (07++12)</td>
<td style="text-align:center">39.4</td>
<td style="text-align:center">ECCVâ€™18</td>
</tr>
<tr>
<td style="text-align:center">Pelee</td>
<td style="text-align:center">70.9 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">NIPSâ€™18</td>
</tr>
<tr>
<td style="text-align:center">HKRM</td>
<td style="text-align:center">78.8 (07+12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">37.8</td>
<td style="text-align:center">NIPSâ€™18</td>
</tr>
<tr>
<td style="text-align:center">M2Det</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.2</td>
<td style="text-align:center">AAAIâ€™19</td>
</tr>
<tr>
<td style="text-align:center">R-DAD</td>
<td style="text-align:center">81.2 (07++12)</td>
<td style="text-align:center">82.0 (07++12)</td>
<td style="text-align:center">43.1</td>
<td style="text-align:center">AAAIâ€™19</td>
</tr>
<tr>
<td style="text-align:center">ScratchDet</td>
<td style="text-align:center">84.1 (07++12)</td>
<td style="text-align:center">83.6 (07++12)</td>
<td style="text-align:center">39.1</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Libra R-CNN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">43.0</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Reasoning-RCNN</td>
<td style="text-align:center">82.5 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">43.2</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FSAF</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.6</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">AmoebaNet + NAS-FPN</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">47.0</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Cascade-RetinaNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">41.1</td>
<td style="text-align:center">CVPRâ€™19</td>
</tr>
<tr>
<td style="text-align:center">TridentNet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">48.4</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">DAFS</td>
<td style="text-align:center"><strong>85.3 (07+12)</strong></td>
<td style="text-align:center">83.1 (07++12)</td>
<td style="text-align:center">40.5</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">Auto-FPN</td>
<td style="text-align:center">81.8 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">40.5</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FCOS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.7</td>
<td style="text-align:center">ICCVâ€™19</td>
</tr>
<tr>
<td style="text-align:center">FreeAnchor</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">44.8</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">DetNAS</td>
<td style="text-align:center">81.5 (07++12)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.0</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">NATS</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">42.0</td>
<td style="text-align:center">NeurIPSâ€™19</td>
</tr>
<tr>
<td style="text-align:center">AmoebaNet + NAS-FPN + AA</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">50.7</td>
<td style="text-align:center">arXivâ€™19</td>
</tr>
<tr>
<td style="text-align:center">EfficientDet</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center"><strong>51.0</strong></td>
<td style="text-align:center">arXivâ€™19</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†-Proposal"><a href="#ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†-Proposal" class="headerlink" title="ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†(Proposal)"></a>ç›®æ ‡æ£€æµ‹çš„å€™é€‰æ¡†(Proposal)</h3><p>ç‰©ä½“å€™é€‰æ¡†è·å–ï¼Œå½“å‰ä¸»è¦ä½¿ç”¨å›¾åƒåˆ†å‰²ä¸åŒºåŸŸç”Ÿé•¿æŠ€æœ¯ã€‚åŒºåŸŸç”Ÿé•¿(åˆå¹¶)ä¸»è¦ç”±äºæ£€æµ‹å›¾åƒä¸­å­˜åœ¨çš„ç‰©ä½“å…·æœ‰å±€éƒ¨åŒºåŸŸç›¸ä¼¼æ€§(é¢œè‰²ã€çº¹ç†ç­‰)ã€‚</p>
<p>æ ¹æ®ç›®æ ‡å€™é€‰åŒºåŸŸçš„æå–æ–¹å¼ä¸åŒï¼Œä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•å¯ä»¥åˆ†ä¸ºåŸºäºæ»‘åŠ¨çª—å£çš„ç›®æ ‡æ£€æµ‹ç®—æ³•å’ŒåŸºäºé€‰æ‹©æ€§æœç´¢çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚</p>
<p><strong>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/1423648-20190316210029111-840970217.png" alt></p>
<p>åŸºæœ¬åŸç†å°±æ˜¯é‡‡ç”¨ä¸åŒå¤§å°å’Œæ¯”ä¾‹ï¼ˆå®½é«˜æ¯”ï¼‰çš„çª—å£åœ¨æ•´å¼ å›¾ç‰‡ä¸Šä»¥ä¸€å®šçš„æ­¥é•¿è¿›è¡Œæ»‘åŠ¨ï¼Œç„¶åå¯¹è¿™äº›çª—å£å¯¹åº”çš„åŒºåŸŸåšå›¾åƒåˆ†ç±»</p>
<p>ç¼ºç‚¹ï¼šä¸çŸ¥é“è¦æ£€æµ‹çš„ç›®æ ‡å¤§å°æ˜¯ä»€ä¹ˆè§„æ¨¡ï¼Œæ‰€ä»¥è¦è®¾ç½®ä¸åŒå¤§å°å’Œæ¯”ä¾‹çš„çª—å£å»æ»‘åŠ¨ï¼Œè€Œä¸”è¿˜è¦é€‰å–åˆé€‚çš„æ­¥é•¿ã€‚ä½†æ˜¯è¿™æ ·ä¼šäº§ç”Ÿå¾ˆå¤šçš„å­åŒºåŸŸï¼Œå¹¶ä¸”éƒ½è¦ç»è¿‡åˆ†ç±»å™¨å»åšé¢„æµ‹ï¼Œè¿™éœ€è¦å¾ˆå¤§çš„è®¡ç®—é‡ã€‚</p>
<p>å…·ä½“æ­¥éª¤ï¼šé¦–å…ˆå¯¹è¾“å…¥å›¾åƒè¿›è¡Œä¸åŒçª—å£å¤§å°çš„æ»‘çª—è¿›è¡Œä»å·¦å¾€å³ã€ä»ä¸Šåˆ°ä¸‹çš„æ»‘åŠ¨ã€‚æ¯æ¬¡æ»‘åŠ¨æ—¶å€™å¯¹å½“å‰çª—å£æ‰§è¡Œåˆ†ç±»å™¨(åˆ†ç±»å™¨æ˜¯äº‹å…ˆè®­ç»ƒå¥½çš„)ã€‚å¦‚æœå½“å‰çª—å£å¾—åˆ°è¾ƒé«˜çš„åˆ†ç±»æ¦‚ç‡ï¼Œåˆ™è®¤ä¸ºæ£€æµ‹åˆ°äº†ç‰©ä½“ã€‚å¯¹æ¯ä¸ªä¸åŒçª—å£å¤§å°çš„æ»‘çª—éƒ½è¿›è¡Œæ£€æµ‹åï¼Œä¼šå¾—åˆ°ä¸åŒçª—å£æ£€æµ‹åˆ°çš„ç‰©ä½“æ ‡è®°ï¼Œè¿™äº›çª—å£å¤§å°ä¼šå­˜åœ¨é‡å¤è¾ƒé«˜çš„éƒ¨åˆ†ï¼Œæœ€åé‡‡ç”¨éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum Suppression, NMS)çš„æ–¹æ³•è¿›è¡Œç­›é€‰ã€‚æœ€ç»ˆï¼Œç»è¿‡NMSç­›é€‰åè·å¾—æ£€æµ‹åˆ°çš„ç‰©ä½“ã€‚</p>
<p><strong>éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum Suppression,NMS)</strong></p>
<p>æ ¹æ®åˆ†ç±»å™¨ç±»åˆ«åˆ†ç±»æ¦‚ç‡åšæ’åº</p>
<p>ã€€ã€€(1)ä»æœ€å¤§æ¦‚ç‡çŸ©å½¢æ¡†å¼€å§‹ï¼Œåˆ†åˆ«å¾—åˆ†åé¢çš„çŸ©å½¢æ¡†ä¸å…¶çš„é‡å åº¦IOUæ˜¯å¦å¤§äºæŸä¸ªè®¾å®šçš„é˜ˆå€¼;</p>
<p>ã€€ã€€(2)å‡è®¾é‡å åº¦è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±æ‰”æ‰ï¼›å¹¶æ ‡è®°ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œæ˜¯æˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ã€‚</p>
<p>ã€€ã€€(3)ä»å‰©ä¸‹çš„çŸ©å½¢æ¡†ä¸­ï¼Œé€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ï¼Œç„¶ååˆ¤æ–­å¾—åˆ†åé¢çš„çŸ©å½¢æ¡†ä¸å…¶çš„é‡å åº¦ï¼Œé‡å åº¦å¤§äºä¸€å®šçš„é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±æ‰”æ‰ï¼›å¹¶æ ‡è®°æ˜¯æˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ã€‚</p>
<p>ã€€ã€€å¦‚æ­¤å¾ªç¯å¾€å¤çŸ¥é“æ²¡æœ‰å‰©ä½™çš„çŸ©å½¢æ¡†ï¼Œç„¶åæ‰¾åˆ°æ‰€æœ‰è¢«ä¿ç•™ä¸‹æ¥çš„çŸ©å½¢æ¡†ï¼Œå°±æ˜¯æˆ‘ä»¬è®¤ä¸ºæœ€å¯èƒ½åŒ…å«ç›®æ ‡çš„çŸ©å½¢æ¡†ã€‚</p>
<p><strong>R-CNNç®—æ³•ä¸­NMSçš„å…·ä½“åšæ³•</strong>ï¼š</p>
<p>ã€€ã€€å‡è®¾æœ‰20ç±»ï¼Œ2000ä¸ªå»ºè®®æ¡†ï¼Œæœ€åè¾“å‡ºå‘é‡ç»´æ•°2000*20ï¼Œåˆ™æ¯åˆ—å¯¹åº”ä¸€ç±»ï¼Œä¸€è¡Œæ˜¯å„ä¸ªå»ºè®®æ¡†çš„å¾—åˆ†ï¼ŒNMSç®—æ³•æ­¥éª¤å¦‚ä¸‹ï¼š<br>ã€€ã€€â‘  å¯¹2000Ã—20ç»´çŸ©é˜µä¸­æ¯åˆ—æŒ‰ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼›<br>ã€€ã€€â‘¡ ä»æ¯åˆ—æœ€å¤§çš„å¾—åˆ†å»ºè®®æ¡†å¼€å§‹ï¼Œåˆ†åˆ«ä¸è¯¥åˆ—åé¢çš„å¾—åˆ†å»ºè®®æ¡†è¿›è¡ŒIoUè®¡ç®—ï¼Œè‹¥IoU&gt;é˜ˆå€¼ï¼Œåˆ™å‰”é™¤å¾—åˆ†è¾ƒå°çš„å»ºè®®æ¡†ï¼Œå¦åˆ™è®¤ä¸ºå›¾åƒä¸­å­˜åœ¨å¤šä¸ªåŒä¸€ç±»ç‰©ä½“ï¼›<br>ã€€ã€€â‘¢ ä»æ¯åˆ—æ¬¡å¤§çš„å¾—åˆ†å»ºè®®æ¡†å¼€å§‹ï¼Œé‡å¤æ­¥éª¤â‘¡ï¼›<br>ã€€ã€€â‘£ é‡å¤æ­¥éª¤â‘¢ç›´åˆ°éå†å®Œè¯¥åˆ—æ‰€æœ‰å»ºè®®æ¡†ï¼›<br>ã€€ã€€â‘¤ éå†å®Œ2000Ã—20ç»´çŸ©é˜µæ‰€æœ‰åˆ—ï¼Œå³æ‰€æœ‰ç‰©ä½“ç§ç±»éƒ½åšä¸€ééæå¤§å€¼æŠ‘åˆ¶ï¼›<br>ã€€ã€€â‘¥ æœ€åå‰”é™¤å„ä¸ªç±»åˆ«ä¸­å‰©ä½™å»ºè®®æ¡†å¾—åˆ†å°‘äºè¯¥ç±»åˆ«é˜ˆå€¼çš„å»ºè®®æ¡†ã€‚</p>
<p><strong>é€‰æ‹©æ€§æœç´¢(Selective Search)</strong></p>
<p>æ»‘çª—æ³•ç±»ä¼¼ç©·ä¸¾è¿›è¡Œå›¾åƒå­åŒºåŸŸæœç´¢ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹å›¾åƒä¸­å¤§éƒ¨åˆ†å­åŒºåŸŸæ˜¯æ²¡æœ‰ç‰©ä½“çš„ã€‚å­¦è€…ä»¬è‡ªç„¶è€Œç„¶æƒ³åˆ°åªå¯¹å›¾åƒä¸­æœ€æœ‰å¯èƒ½åŒ…å«ç‰©ä½“çš„åŒºåŸŸè¿›è¡Œæœç´¢ä»¥æ­¤æ¥æé«˜è®¡ç®—æ•ˆç‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/1423648-20190317100459585-1587811888.png" alt></p>
<p>é€‰æ‹©æœç´¢ç®—æ³•çš„ä¸»è¦è§‚ç‚¹ï¼šå›¾åƒä¸­ç‰©ä½“å¯èƒ½å­˜åœ¨çš„åŒºåŸŸåº”è¯¥æ˜¯æœ‰æŸäº›ç›¸ä¼¼æ€§æˆ–è€…è¿ç»­æ€§åŒºåŸŸçš„ã€‚å› æ­¤ï¼Œé€‰æ‹©æœç´¢åŸºäºä¸Šé¢è¿™ä¸€æƒ³æ³•é‡‡ç”¨å­åŒºåŸŸåˆå¹¶çš„æ–¹æ³•è¿›è¡Œæå–å€™é€‰è¾¹ç•Œæ¡†ï¼ˆbounding boxesï¼‰ã€‚é¦–å…ˆï¼Œå¯¹è¾“å…¥å›¾åƒè¿›è¡Œåˆ†å‰²ç®—æ³•äº§ç”Ÿè®¸å¤šå°çš„å­åŒºåŸŸ(å¤§çº¦2000ä¸ªå­åŒºåŸŸ)ã€‚å…¶æ¬¡ï¼Œæ ¹æ®è¿™äº›å­åŒºåŸŸä¹‹é—´ç›¸ä¼¼æ€§(ç›¸ä¼¼æ€§æ ‡å‡†ä¸»è¦æœ‰é¢œè‰²ã€çº¹ç†ã€å¤§å°ç­‰ç­‰)è¿›è¡ŒåŒºåŸŸåˆå¹¶ï¼Œä¸æ–­çš„è¿›è¡ŒåŒºåŸŸè¿­ä»£åˆå¹¶ã€‚æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­å¯¹è¿™äº›åˆå¹¶çš„å­åŒºåŸŸåšå¤–åˆ‡çŸ©å½¢ï¼ˆbounding boxesï¼‰ï¼Œè¿™äº›å­åŒºåŸŸå¤–åˆ‡çŸ©å½¢å°±æ˜¯é€šå¸¸æ‰€è¯´çš„å€™é€‰æ¡†ã€‚</p>
<p>ä¼˜ç‚¹ï¼š<br>ã€€ã€€ã€€ã€€ï¼ˆaï¼‰è®¡ç®—æ•ˆç‡ä¼˜äºæ»‘çª—æ³•ã€‚<br>ã€€ã€€ã€€ã€€ï¼ˆbï¼‰ç”±äºé‡‡ç”¨å­åŒºåŸŸåˆå¹¶ç­–ç•¥ï¼Œæ‰€ä»¥å¯ä»¥åŒ…å«å„ç§å¤§å°çš„ç–‘ä¼¼ç‰©ä½“æ¡†ã€‚<br>ã€€ã€€ã€€ã€€ï¼ˆcï¼‰åˆå¹¶åŒºåŸŸç›¸ä¼¼çš„æŒ‡æ ‡å¤šæ ·æ€§ï¼Œæé«˜äº†æ£€æµ‹ç‰©ä½“çš„æ¦‚ç‡ã€‚</p>
<h3 id="è¾¹ç•Œæ¡†å›å½’-Bounding-Box-regression"><a href="#è¾¹ç•Œæ¡†å›å½’-Bounding-Box-regression" class="headerlink" title="è¾¹ç•Œæ¡†å›å½’(Bounding-Box regression)"></a>è¾¹ç•Œæ¡†å›å½’(Bounding-Box regression)</h3><p>çª—å£ä¸€èˆ¬ä½¿ç”¨å››ç»´å‘é‡$(x,y,w,h)$æ¥è¡¨ç¤ºï¼Œ åˆ†åˆ«è¡¨ç¤ºçª—å£çš„ä¸­å¿ƒç‚¹åæ ‡å’Œå®½é«˜ã€‚ å¯¹äºä¸‹å›¾, çº¢è‰²çš„æ¡† $P$ ä»£è¡¨åŸå§‹çš„Proposal, ç»¿è‰²çš„æ¡† $G$ ä»£è¡¨ç›®æ ‡çš„ Ground Truthï¼Œ ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ç§å…³ç³»ä½¿å¾—è¾“å…¥åŸå§‹çš„çª—å£ $P$ ç»è¿‡æ˜ å°„å¾—åˆ°ä¸€ä¸ªè·ŸçœŸå®çª—å£ $G$ æ›´æ¥è¿‘çš„å›å½’çª—å£$\hat{G}$ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/TIM%E5%9B%BE%E7%89%8720200106182123.png" alt></p>
<p>è¾¹æ¡†å›å½’çš„ç›®çš„æ—¢æ˜¯ï¼šç»™å®š$\left(P_{x}, P_{y}, P_{w}, P_{h}\right)$å¯»æ‰¾ä¸€ç§æ˜ å°„$f$ï¼Œ ä½¿å¾—$f\left(P_{x}, P_{y}, P_{w}, P_{h}\right)=\left(\hat{G}_{x}, \hat{G}_{y}, \hat{G}_{w}, \hat{G}_{h}\right)$å¹¶ä¸”$\left(\hat{G}_{x}, \hat{G}_{y}, \hat{G}_{w}, \hat{G}_{h}\right) \approx\left(G_{x}, G_{y}, G_{w}, G_{h}\right)$</p>
<p>æ€è·¯: å¹³ç§» + å°ºåº¦æ”¾ç¼©</p>
<ol>
<li><p>å…ˆåšå¹³ç§»$(\Delta x, \Delta y), \quad \Delta x=P_{w} d_{x}(P), \Delta y=P_{h} d_{y}(P)$</p>
<p>$\hat{G}_{x}=P_{w} d_{x}(P)+P_{x}$<br>$\hat{G}_{y}=P_{h} d_{y}(P)+P_{y}$</p>
</li>
<li><p>ç„¶åå†åšå°ºåº¦ç¼©æ”¾$\left(S_{w}, S_{h}\right), S_{w}=\exp \left(d_{w}(P)\right), S_{h}=\exp \left(d_{h}(P)\right)$</p>
<p>$\hat{G}_{w}=P_{w} \exp \left(d_{w}(P)\right)$<br>$\hat{G}_{h}=P_{h} \exp \left(d_{h}(P)\right)$</p>
</li>
</ol>
<p>è¾¹æ¡†å›å½’å°±æ˜¯å­¦ä¹ $d_{x}(P), d_{y}(P), d_{w}(P), d_{h}(P)$è¿™å››ä¸ªå˜æ¢ã€‚</p>
<p>çº¿æ€§å›å½’å°±æ˜¯ç»™å®šè¾“å…¥çš„ç‰¹å¾å‘é‡$X$, å­¦ä¹ ä¸€ç»„å‚æ•° $W$, ä½¿å¾—ç»è¿‡çº¿æ€§å›å½’åçš„å€¼è·ŸçœŸå®å€¼ $Y$(Ground Truth)éå¸¸æ¥è¿‘. å³$Y â‰ˆ WX$ã€‚</p>
<p>è¾“å…¥ä¸ºï¼š$P=\left(P_{x}, P_{y}, P_{w}, P_{h}\right)$è¿™ä¸ªçª—å£å¯¹åº”çš„ CNN ç‰¹å¾(æ³¨ï¼šè®­ç»ƒé˜¶æ®µè¾“å…¥è¿˜åŒ…æ‹¬ Ground Truthï¼Œ ä¹Ÿå°±æ˜¯ä¸‹è¾¹æåˆ°çš„$t_{*}=\left(t_{x}, t_{y}, t_{w}, t_{h}\right)$ )</p>
<p>è¾“å‡ºä¸ºï¼šå››ä¸ªå˜æ¢ï¼Œå› ä¸ºæœ‰äº†è¿™å››ä¸ªå˜æ¢æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¾—åˆ° Ground Truthï¼ŒçœŸå®å€¼æ‰€å¯¹åº”çš„çœŸæ­£çš„å˜åŒ–ä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned}
&t_{x}=\left(G_{x}-P_{x}\right) / P_{w}\\
&t_{y}=\left(G_{y}-P_{y}\right) / P_{h}\\
&t_{w}=\log \left(G_{w} / P_{w}\right)\\
&t_{h}=\log \left(G_{h} / P_{h}\right)
\end{aligned}</script><p>ç›®æ ‡å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸º$d_{<em>}(P)=w_{</em>}^{T} \Phi_{5}(P)$ï¼Œ $\Phi_{5}(P)$æ˜¯è¾“å…¥ Proposal çš„ç‰¹å¾å‘é‡ï¼Œ $w_{<em>}$æ˜¯è¦å­¦ä¹ çš„å‚æ•°ï¼ˆ</em> è¡¨ç¤º $x,y,w,h$ï¼Œ ä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå˜æ¢å¯¹åº”ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼‰, $d_{*}(P)$ æ˜¯å¾—åˆ°çš„é¢„æµ‹å€¼ã€‚</p>
<p>æŸå¤±å‡½æ•°ï¼šè¦è®©é¢„æµ‹å€¼è·ŸçœŸå®å€¼$t_{*}=\left(t_{x}, t_{y}, t_{w}, t_{h}\right)$å·®è·æœ€å°</p>
<script type="math/tex; mode=display">
Loss=\sum_{i}^{N}\left(t_{*}^{i}-\hat{w}_{*}^{T} \phi_{5}\left(P^{i}\right)\right)^{2}</script><p>å‡½æ•°ä¼˜åŒ–ç›®æ ‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
W_{*}=\operatorname{argmin}_{w_{*}} \sum_{i}^{N}\left(t_{*}^{i}-\hat{w}_{*}^{T} \phi_{5}\left(P^{i}\right)\right)^{2}+\lambda\left\|\hat{w}_{*}\right\|^{2}</script><h3 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h3><p>Rich feature hierarchies for accurate object detection and semantic segmentation(CVPR 2014)</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_09-57-14.jpg" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨Selective Searchæå–å¤§çº¦2000ä¸ªå€™é€‰åŒºåŸŸï¼ˆproposalï¼‰;</li>
<li>å¯¹æ¯ä¸ªå€™é€‰åŒºåŸŸçš„å›¾åƒè¿›è¡Œæ‹‰ä¼¸å½¢å˜ï¼Œä½¿ä¹‹æˆä¸ºå›ºå®šå¤§å°çš„æ­£æ–¹å½¢å›¾åƒï¼Œå¹¶å°†è¯¥å›¾åƒè¾“å…¥åˆ°CNNä¸­æå–ç‰¹å¾;</li>
<li>ä½¿ç”¨çº¿æ€§çš„SVMå¯¹æå–çš„ç‰¹å¾è¿›è¡Œåˆ†ç±»ã€‚</li>
</ul>
<p><strong>åˆ›æ–°ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†å¤§å‹å·ç§¯ç¥ç»ç½‘ç»œ(CNNs)åº”ç”¨äºè‡ªä¸‹è€Œä¸Šçš„å€™é€‰åŒºåŸŸä»¥å®šä½å’Œåˆ†å‰²ç‰©ä½“ã€‚</li>
<li>å½“å¸¦æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ä¸è¶³æ—¶ï¼Œå…ˆé’ˆå¯¹è¾…åŠ©ä»»åŠ¡è¿›è¡Œæœ‰ç›‘ç£é¢„è®­ç»ƒï¼Œå†è¿›è¡Œç‰¹å®šä»»åŠ¡çš„è°ƒä¼˜ï¼Œå°±å¯ä»¥äº§ç”Ÿæ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚</li>
</ul>
<p><strong>R-CNNå›¾ç‰‡ç¼©æ”¾</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180425214236957.png" alt></p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><p><strong>é‡å¤è®¡ç®—</strong> R-CNNè™½ç„¶ä¸å†æ˜¯ç©·ä¸¾ï¼Œä½†é€šè¿‡Proposalï¼ˆSelective Searchï¼‰çš„æ–¹æ¡ˆä¾ç„¶æœ‰ä¸¤åƒä¸ªå·¦å³çš„å€™é€‰æ¡†ï¼Œè¿™äº›å€™é€‰æ¡†éƒ½éœ€è¦å•ç‹¬ç»è¿‡backboneç½‘ç»œæå–ç‰¹å¾ï¼Œè®¡ç®—é‡ä¾ç„¶å¾ˆå¤§ï¼Œå€™é€‰æ¡†ä¹‹é—´ä¼šæœ‰é‡å ï¼Œå› æ­¤æœ‰ä¸å°‘å…¶å®æ˜¯é‡å¤è®¡ç®—ã€‚</p>
</li>
<li><p><strong>è®­ç»ƒæµ‹è¯•ä¸ç®€æ´</strong> å€™é€‰åŒºåŸŸæå–ã€ç‰¹å¾æå–ã€åˆ†ç±»ã€å›å½’éƒ½æ˜¯åˆ†å¼€æ“ä½œï¼Œä¸­é—´æ•°æ®è¿˜éœ€è¦å•ç‹¬ä¿å­˜ã€‚</p>
</li>
<li><p><strong>é€Ÿåº¦æ…¢</strong> å‰é¢çš„ç¼ºç‚¹æœ€ç»ˆå¯¼è‡´R-CNNå‡ºå¥‡çš„æ…¢ï¼ŒGPUä¸Šå¤„ç†ä¸€å¼ å›¾ç‰‡éœ€è¦åå‡ ç§’ï¼ŒCPUä¸Šåˆ™éœ€è¦æ›´é•¿æ—¶é—´ã€‚</p>
</li>
<li><p><strong>è¾“å…¥çš„å›¾ç‰‡Patchå¿…é¡»å¼ºåˆ¶ç¼©æ”¾æˆå›ºå®šå¤§å°</strong> ï¼ˆåŸæ–‡é‡‡ç”¨227Ã—227ï¼‰ï¼Œä¼šé€ æˆç‰©ä½“å½¢å˜ï¼Œå¯¼è‡´æ£€æµ‹æ€§èƒ½ä¸‹é™ã€‚</p>
</li>
</ul>
<h3 id="SPP-Net"><a href="#SPP-Net" class="headerlink" title="SPP-Net"></a>SPP-Net</h3><p>Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition(ECCV 2014)</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_10-28-09.jpg" alt></p>
<p>å·ç§¯å±‚çš„å‚æ•°å’Œè¾“å…¥å›¾åƒçš„å°ºå¯¸æ— å…³ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå·ç§¯æ ¸åœ¨å›¾åƒä¸Šæ»‘åŠ¨ï¼Œä¸ç®¡è¾“å…¥å›¾åƒæ˜¯å¤šå°‘éƒ½æ²¡å…³ç³»ï¼Œåªæ˜¯å¯¹ä¸åŒå¤§å°çš„å›¾ç‰‡å·ç§¯å‡ºä¸åŒå¤§å°çš„ç‰¹å¾å›¾ï¼Œæ± åŒ–å±‚å¯¹è¾“å…¥å›¾åƒçš„å°ºå¯¸ä¹Ÿæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œåªæ˜¯è·å¾—ä¸åŒçš„ç‰¹å¾å›¾è€Œå·²ï¼Œä½†æ˜¯å…¨è¿æ¥å±‚çš„å‚æ•°å°±å’Œè¾“å…¥å›¾åƒå¤§å°æœ‰å…³ï¼Œå› ä¸ºå®ƒè¦æŠŠè¾“å…¥çš„æ‰€æœ‰åƒç´ ç‚¹è¿æ¥èµ·æ¥,éœ€è¦æŒ‡å®šè¾“å…¥å±‚ç¥ç»å…ƒä¸ªæ•°å’Œè¾“å‡ºå±‚ç¥ç»å…ƒä¸ªæ•°ï¼Œæ‰€ä»¥éœ€è¦è§„å®šè¾“å…¥çš„featureçš„å¤§å°ã€‚</p>
<p>é€šè¿‡åœ¨å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚ä¹‹é—´åŠ å…¥ç©ºé—´é‡‘å­—å¡”æ± åŒ–ç»“æ„ï¼ˆSpatial Pyramid Poolingï¼‰ä»£æ›¿R-CNNç®—æ³•åœ¨è¾“å…¥å·ç§¯ç¥ç»ç½‘ç»œå‰å¯¹å„ä¸ªå€™é€‰åŒºåŸŸè¿›è¡Œå‰ªè£ã€ç¼©æ”¾æ“ä½œä½¿å…¶å›¾åƒå­å—å°ºå¯¸ä¸€è‡´çš„åšæ³•ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹</strong>ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡é€‰æ‹©æ€§æœç´¢ï¼Œå¯¹å¾…æ£€æµ‹çš„å›¾ç‰‡è¿›è¡Œæœç´¢å‡º2000ä¸ªå€™é€‰çª—å£ã€‚è¿™ä¸€æ­¥å’ŒR-CNNä¸€æ ·ã€‚</li>
<li>ç‰¹å¾æå–é˜¶æ®µã€‚è¿™ä¸€æ­¥å°±æ˜¯å’ŒR-CNNæœ€å¤§çš„åŒºåˆ«äº†ï¼ŒåŒæ ·æ˜¯ç”¨å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œç‰¹å¾æå–ï¼Œä½†æ˜¯SPP-Netç”¨çš„æ˜¯é‡‘å­—å¡”æ± åŒ–ã€‚è¿™ä¸€æ­¥éª¤çš„å…·ä½“æ“ä½œå¦‚ä¸‹ï¼šæŠŠæ•´å¼ å¾…æ£€æµ‹çš„å›¾ç‰‡ï¼Œè¾“å…¥CNNä¸­ï¼Œè¿›è¡Œä¸€æ¬¡æ€§ç‰¹å¾æå–ï¼Œå¾—åˆ°feature mapsï¼Œç„¶ååœ¨feature mapsä¸­æ‰¾åˆ°å„ä¸ªå€™é€‰æ¡†çš„åŒºåŸŸï¼Œå†å¯¹å„ä¸ªå€™é€‰æ¡†é‡‡ç”¨é‡‘å­—å¡”ç©ºé—´æ± åŒ–ï¼Œæå–å‡ºå›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡ã€‚è€ŒR-CNNè¾“å…¥çš„æ˜¯æ¯ä¸ªå€™é€‰æ¡†ï¼Œç„¶ååœ¨è¿›å…¥CNNï¼Œå› ä¸ºSPP-Netåªéœ€è¦ä¸€æ¬¡å¯¹æ•´å¼ å›¾ç‰‡è¿›è¡Œç‰¹å¾æå–ï¼Œé€Ÿåº¦æ›´å¿«å•Šã€‚</li>
<li>æœ€åä¸€æ­¥ä¹Ÿæ˜¯å’ŒR-CNNä¸€æ ·ï¼Œé‡‡ç”¨SVMç®—æ³•è¿›è¡Œç‰¹å¾å‘é‡åˆ†ç±»è¯†åˆ«ã€‚</li>
</ul>
<p><strong>ä¸€æ¬¡ç‰¹å¾æå–</strong><br>RCNNæ˜¯å¤šä¸ªregions+å¤šæ¬¡CNN+å•ä¸ªpoolingï¼Œè€ŒSPPåˆ™æ˜¯å•ä¸ªå›¾åƒ+å•æ¬¡CNN+å¤šä¸ªregion+å¤šä¸ªpooling<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180425215129861.png" alt></p>
<p><strong>é‡‘å­—å¡”æ± åŒ–ç»“æ„</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_10-41-12.jpg" alt><br>åˆ©ç”¨ä¸åŒå¤§å°çš„åˆ»åº¦ï¼Œå¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œäº†åˆ’åˆ†ã€‚å›¾ä¸­ï¼Œåˆ©ç”¨äº†ä¸‰ç§ä¸åŒå¤§å°çš„åˆ»åº¦ï¼Œå¯¹ä¸€å¼ è¾“å…¥çš„å›¾ç‰‡è¿›è¡Œäº†åˆ’åˆ†ï¼Œæœ€åæ€»å…±å¯ä»¥å¾—åˆ°16+4+1=21ä¸ªå—ï¼Œä»è¿™21ä¸ªå›¾ç‰‡å—ä¸­ï¼Œåˆ†åˆ«è®¡ç®—æ¯ä¸ªå—çš„æœ€å¤§å€¼ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªè¾“å‡ºç‰¹å¾å‘é‡ã€‚æœ€åæŠŠä¸€å¼ ä»»æ„å¤§å°çš„å›¾ç‰‡è½¬æ¢æˆäº†ä¸€ä¸ªå›ºå®šå¤§å°çš„21ç»´ç‰¹å¾ï¼ˆå½“ç„¶å¯ä»¥è®¾è®¡å…¶å®ƒç»´æ•°çš„è¾“å‡ºï¼Œå¢åŠ é‡‘å­—å¡”çš„å±‚æ•°ï¼Œæˆ–è€…æ”¹å˜åˆ’åˆ†ç½‘æ ¼çš„å¤§å°ï¼‰ã€‚ä¸Šé¢çš„ä¸‰ç§ä¸åŒåˆ»åº¦çš„åˆ’åˆ†ï¼Œæ¯ä¸€ç§åˆ»åº¦ç§°ä¹‹ä¸ºé‡‘å­—å¡”çš„ä¸€å±‚ï¼Œä½¿ç”¨å¤šä¸ªä¸åŒåˆ»åº¦çš„å±‚ï¼Œå¯ä»¥æé«˜æ‰€æå–ç‰¹å¾çš„é²æ£’æ€§ã€‚æ¯ä¸€ä¸ªå›¾ç‰‡å—å¤§å°ç§°ä¹‹ä¸ºï¼šSliding Windows Sizeã€‚å¦‚æœå¸Œæœ›é‡‘å­—å¡”çš„æŸä¸€å±‚è¾“å‡ºnxnä¸ªç‰¹å¾ï¼Œé‚£ä¹ˆå°±è¦ç”¨Windows Sizeå¤§å°ä¸ºï¼š(w/n,h/n)è¿›è¡Œæ± åŒ–ã€‚ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœ(5x5ï¼‰ä¹Ÿè¦å¾—åˆ°3x3çš„è¯ï¼Œè®¡ç®—å¾—åˆ°çš„size=2ï¼Œstride=1ï¼Œåˆ©ç”¨å…¬å¼ç®—å‡ºæ¥å¾—åˆ°çš„æ± åŒ–ä¸ºï¼ˆ4x4ï¼‰ä¸é¢„æœŸçš„3x3ä¸ç¬¦ï¼Œè¿™é‡Œæš‚æ—¶è¿˜æœ‰é—®é¢˜ï¼Œä¸æ¸…æ¥šå…·ä½“åŸå› æ˜¯ä»€ä¹ˆï¼‰ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_10-46-02.jpg" alt></p>
<p><strong>åˆ›æ–°ç‚¹ï¼š</strong></p>
<ul>
<li>åˆ©ç”¨ç©ºé—´é‡‘å­—å¡”æ± åŒ–ç»“æ„ï¼›</li>
<li>å¯¹æ•´å¼ å›¾ç‰‡åªè¿›è¡Œäº†ä¸€æ¬¡ç‰¹å¾æå–ï¼ŒåŠ å¿«è¿ç®—é€Ÿåº¦ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong><br>ã€€    å’ŒR-CNNä¸€æ ·ï¼Œå®ƒçš„è®­ç»ƒè¦ç»è¿‡å¤šä¸ªé˜¶æ®µï¼Œç‰¹å¾ä¹Ÿè¦å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¦å¤–ï¼ŒSPPä¸­çš„å¾®è°ƒåªæ›´æ–°SPPå±‚åé¢çš„å…¨è¿æ¥å±‚ï¼Œå¯¹å¾ˆæ·±çš„ç½‘ç»œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p>
<h3 id="Fast-R-CNN"><a href="#Fast-R-CNN" class="headerlink" title="Fast R-CNN"></a>Fast R-CNN</h3><p>Girshick, R., Fast R-CNN, in 2015 IEEE International Conference on Computer Vision (ICCV). 2015. p. 1440-1448.</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/3940902-7569280b566d0e58.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/3940902-5519b489e581557a.png" alt></p>
<p>Fast R-CNNåœ¨ç‰¹å¾æå–ä¸Šå¯ä»¥è¯´å¾ˆå¤§ç¨‹åº¦å€Ÿé‰´äº†SPPnetï¼Œé¦–å…ˆå°†å›¾ç‰‡ç”¨é€‰æ‹©æœç´¢ç®—æ³•ï¼ˆselective searchï¼‰å¾—åˆ°2000ä¸ªå€™é€‰åŒºåŸŸï¼ˆregion proposalsï¼‰çš„åæ ‡ä¿¡æ¯ã€‚å¦ä¸€æ–¹é¢ï¼Œç›´æ¥å°†å›¾ç‰‡å½’ä¸€åŒ–åˆ°CNNéœ€è¦çš„æ ¼å¼ï¼Œæ•´å¼ å›¾ç‰‡é€å…¥CNNï¼ˆæœ¬æ–‡é€‰æ‹©çš„ç½‘ç»œæ˜¯VGGï¼‰ï¼Œå°†ç¬¬äº”å±‚çš„æ™®é€šæ± åŒ–å±‚æ›¿æ¢ä¸ºRoIæ± åŒ–å±‚ï¼Œå›¾ç‰‡ç„¶åç»è¿‡5å±‚å·ç§¯æ“ä½œåï¼Œå¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾ï¼ˆfeature mapsï¼‰ï¼Œå¼€å§‹å¾—åˆ°çš„åæ ‡ä¿¡æ¯é€šè¿‡ä¸€å®šçš„æ˜ å°„å…³ç³»è½¬æ¢ä¸ºå¯¹åº”ç‰¹å¾å›¾çš„åæ ‡ï¼Œæˆªå–å¯¹åº”çš„å€™é€‰åŒºåŸŸï¼Œç»è¿‡RoIå±‚åæå–åˆ°å›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡ï¼Œé€å…¥å…¨è¿æ¥å±‚ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹</strong>:</p>
<ul>
<li>è¾“å…¥çš„æ˜¯ä¸€å¼ å®Œæ•´å›¾ç‰‡å›¾åƒå½’ä¸€åŒ–ä¸º224Ã—224å’Œä¸€ç»„ï¼ˆçº¦2000ä¸ªï¼‰ç‰©ä½“å»ºè®®æ¡†ï¼ˆä¹Ÿå«RoIsï¼‰é€å…¥ç½‘ç»œã€‚</li>
<li>å¯¹Conv feature mapè¿›è¡Œç‰¹å¾æå–ã€‚æ¯ä¸€ä¸ªåŒºåŸŸç»è¿‡RoI pooling layerå’ŒFC layerså¾—åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„feature vectorï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥åˆ°åé¢RoI pooling layerçš„feature mapæ˜¯åœ¨Conv feature mapä¸Šæå–çš„ã€‚è™½ç„¶åœ¨æœ€å¼€å§‹ä¹Ÿæå–å‡ºäº†å¤§é‡çš„RoIï¼Œä½†ä»–ä»¬è¿˜æ˜¯ä½œä¸ºæ•´ä½“è¾“å…¥è¿›å·ç§¯ç½‘ç»œçš„ï¼Œæœ€å¼€å§‹æå–å‡ºçš„RoIåŒºåŸŸåªæ˜¯ä¸ºäº†æœ€åçš„Bounding box å›å½’æ—¶ä½¿ç”¨ï¼Œç”¨æ¥è¾“å‡ºåŸå›¾ä¸­çš„ä½ç½®ã€‚</li>
<li>è¿™äº›ç‰¹å¾å‘é‡åœ¨ç»è¿‡å…¨æ¥è¿å±‚ä¹‹åè¿›å…¥ä¸¤ä¸ªå¹¶åˆ—çš„è¾“å‡ºå±‚ã€‚ç¬¬ä¸€ä¸ªæ˜¯åˆ†ç±»ï¼Œä½¿ç”¨softmaxï¼Œç¬¬äºŒä¸ªæ˜¯æ¯ä¸€ç±»çš„bounding boxå›å½’ã€‚åˆ©ç”¨SoftMax Losså’ŒSmooth L1 Losså¯¹åˆ†ç±»æ¦‚ç‡å’Œè¾¹æ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰è”åˆè®­ç»ƒã€‚<br>æ•´ä¸ªç»“æ„æ˜¯ä½¿ç”¨å¤šä»»åŠ¡æŸå¤±çš„ç«¯åˆ°ç«¯è®­ç»ƒï¼ˆtrained end-to-end with a multi-task lossï¼‰ã€‚</li>
</ul>
<p><strong>ä»€ä¹ˆæ˜¯ROIå‘¢ï¼Ÿ</strong></p>
<p>RoIæ˜¯Region of Interestçš„ç®€å†™ï¼ŒæŒ‡çš„æ˜¯åœ¨â€œ<strong>ç‰¹å¾å›¾ä¸Šçš„æ¡†</strong>â€ï¼›åœ¨Fast RCNNä¸­ï¼Œ RoIæ˜¯æŒ‡Selective Searchå®Œæˆåå¾—åˆ°çš„â€œå€™é€‰æ¡†â€åœ¨ç‰¹å¾å›¾ä¸Šçš„æ˜ å°„;</p>
<p><strong>ROI Poolingçš„è¾“å…¥</strong><br>è¾“å…¥æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç‰¹å¾å›¾ï¼šæŒ‡çš„æ˜¯ç‰¹å¾å›¾ï¼Œåœ¨Fast RCNNä¸­ï¼Œå®ƒä½äºRoI Poolingä¹‹å‰ï¼Œé€šå¸¸æˆ‘ä»¬å¸¸å¸¸ç§°ä¹‹ä¸ºâ€œshare_convâ€ï¼›</li>
<li>ROIS ï¼šåœ¨Fast RCNNä¸­ï¼ŒæŒ‡çš„æ˜¯Selective Searchçš„è¾“å‡ºï¼Œä¸€å †çŸ©å½¢å€™é€‰æ¡†æ¡†ï¼Œå½¢çŠ¶ä¸º1x5x1x1ï¼ˆ4ä¸ªåæ ‡+ç´¢å¼•indexï¼‰ï¼Œå…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåæ ‡çš„å‚è€ƒç³»ä¸æ˜¯é’ˆå¯¹feature mapè¿™å¼ å›¾çš„ï¼Œè€Œæ˜¯é’ˆå¯¹åŸå›¾çš„ï¼ˆç¥ç»ç½‘ç»œæœ€å¼€å§‹çš„è¾“å…¥ï¼‰ã€‚</li>
</ul>
<p><strong>ROI Poolingçš„è¾“å‡º</strong><br>ã€€ã€€è¾“å‡ºæ˜¯batchä¸ªvectorï¼Œå…¶ä¸­batchçš„å€¼ç­‰äºRoIçš„ä¸ªæ•°ï¼Œvectorçš„å¤§å°ä¸ºchannel x w x hï¼›RoI Poolingçš„è¿‡ç¨‹å°±æ˜¯å°†ä¸€ä¸ªä¸ªå¤§å°ä¸åŒçš„boxçŸ©å½¢æ¡†ï¼Œéƒ½æ˜ å°„æˆå¤§å°å›ºå®šï¼ˆw x hï¼‰çš„çŸ©å½¢æ¡†ï¼›</p>
<p><strong>ROI Poolingçš„è¿‡ç¨‹</strong><br>ã€€ã€€å…ˆæŠŠRoIä¸­çš„åæ ‡æ˜ å°„åˆ°feature mapä¸Šï¼Œæ˜ å°„è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠå„ä¸ªåæ ‡é™¤ä»¥â€œè¾“å…¥å›¾ç‰‡ä¸feature mapçš„å¤§å°çš„æ¯”å€¼â€ï¼Œå¾—åˆ°äº†feature mapä¸Šçš„boxåæ ‡åï¼Œä½¿ç”¨Poolingå¾—åˆ°è¾“å‡ºï¼›ç”±äºè¾“å…¥çš„å›¾ç‰‡å¤§å°ä¸ä¸€ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„ç±»ä¼¼Spp Poolingï¼Œåœ¨Poolingçš„è¿‡ç¨‹ä¸­éœ€è¦è®¡ç®—Poolingåçš„ç»“æœå¯¹åº”åˆ°feature mapä¸Šæ‰€å çš„èŒƒå›´ï¼Œç„¶ååœ¨é‚£ä¸ªèŒƒå›´ä¸­è¿›è¡Œå–maxæˆ–è€…å–averageã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/3940902-a6127730f6d21abd.png" alt></p>
<ul>
<li>cls_scoreå±‚ç”¨äºåˆ†ç±»ï¼Œè¾“å‡ºK+1ç»´æ•°ç»„pï¼Œè¡¨ç¤ºå±äºKç±»å’ŒèƒŒæ™¯çš„æ¦‚ç‡ã€‚</li>
<li>bbox_prdictå±‚ç”¨äºè°ƒæ•´å€™é€‰åŒºåŸŸä½ç½®ï¼Œè¾“å‡º4*Kç»´æ•°ç»„tï¼Œè¡¨ç¤ºåˆ†åˆ«å±äºKç±»æ—¶ï¼Œåº”è¯¥å¹³ç§»ç¼©æ”¾çš„å‚æ•°ã€‚</li>
</ul>
<p><strong>æœ€åä¸€ä¸ªé˜¶æ®µçš„ç‰¹å¾è¾“å…¥åˆ°ä¸¤ä¸ªå¹¶è¡Œçš„å…¨è¿å±‚ä¸­ã€‚</strong><br>ä¸€ä¸ªæ˜¯å¯¹åŒºåŸŸçš„åˆ†ç±»Softmaxï¼ˆåŒ…æ‹¬èƒŒæ™¯ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹bounding boxå›å½’çš„å¾®è°ƒã€‚åœ¨SVMå’ŒSoftmaxçš„å¯¹æ¯”å®éªŒä¸­è¯´æ˜ï¼ŒSVMçš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ï¼Œæ•…ç›´æ¥ç”¨Softmaxå°†æ•´ä¸ªç½‘ç»œæ•´åˆè®­ç»ƒæ›´å¥½ã€‚æ€»ä»£ä»·ä¸ºä¸¤è€…åŠ æƒå’Œï¼ŒFast-RCNNæŠŠä¸¤ä¸ªå›å½’çš„lossè¿›è¡Œè”åˆè®­ç»ƒã€‚</p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>æå‡ºRoI Pooling å±‚ï¼Œå®ƒå°†ä¸åŒå¤§å°å€™é€‰æ¡†çš„å·ç§¯ç‰¹å¾å›¾ç»Ÿä¸€é‡‡æ ·æˆå›ºå®šå¤§å°çš„ç‰¹å¾ã€‚</li>
<li>ç‹¬ç«‹çš„SVMåˆ†ç±»å™¨å’Œå›å½’å™¨éœ€è¦å¤§é‡ç‰¹å¾ä½œä¸ºè®­ç»ƒæ ·æœ¬ï¼Œéœ€è¦å¤§é‡çš„ç¡¬ç›˜ç©ºé—´ï¼ŒFast-RCNNæŠŠç±»åˆ«åˆ¤æ–­å’Œä½ç½®å›å½’ç»Ÿä¸€ç”¨æ·±åº¦ç¥ç»ç½‘ç»œå®ç°ï¼Œä¸å†éœ€è¦é¢å¤–å­˜å‚¨ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š<br>æ£€æµ‹é€Ÿåº¦ä»ç„¶å—é™äº Selective Search</p>
<h3 id="Faster-R-CNN"><a href="#Faster-R-CNN" class="headerlink" title="Faster R-CNN"></a>Faster R-CNN</h3><p>Ren, S., et al., Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks. IEEE Trans Pattern Anal Mach Intell, 2017. 39(6): p. 1137-1149.</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/v2-e64a99b38f411c337f538eb5f093bdf3_r.jpg" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong>:</p>
<ul>
<li>æŠŠæ•´å¼ å›¾ç‰‡é€å…¥CNNï¼Œè¿›è¡Œç‰¹å¾æå–ï¼›</li>
<li>åœ¨æœ€åä¸€å±‚å·ç§¯feature mapä¸Šç”Ÿæˆregion proposalï¼ˆé€šè¿‡RPNï¼‰ï¼Œæ¯å¼ å›¾ç‰‡å¤§çº¦300ä¸ªå»ºè®®çª—å£ï¼›</li>
<li>é€šè¿‡RoI poolingå±‚ï¼ˆå…¶å®æ˜¯å•å±‚çš„SPP layerï¼‰ä½¿å¾—æ¯ä¸ªå»ºè®®çª—å£ç”Ÿæˆå›ºå®šå¤§å°çš„feature mapï¼›</li>
<li>ç»§ç»­ç»è¿‡ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼ˆFCï¼‰å¾—åˆ°ç‰¹å¾å‘é‡ã€‚ç‰¹å¾å‘é‡ç»ç”±å„è‡ªçš„FCå±‚ï¼Œå¾—åˆ°ä¸¤ä¸ªè¾“å‡ºå‘é‡ã€‚ç¬¬ä¸€ä¸ªæ˜¯åˆ†ç±»ï¼Œä½¿ç”¨softmaxï¼Œç¬¬äºŒä¸ªæ˜¯æ¯ä¸€ç±»çš„bounding boxå›å½’ã€‚åˆ©ç”¨SoftMax Losså’ŒSmooth L1 Losså¯¹åˆ†ç±»æ¦‚ç‡å’Œè¾¹æ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰è”åˆè®­ç»ƒã€‚</li>
</ul>
<p><strong>Region Proposal Networks</strong>ã€‚RPNç½‘ç»œç”¨äºç”Ÿæˆregion proposalsã€‚è¯¥å±‚é€šè¿‡softmaxåˆ¤æ–­anchorså±äºpositiveæˆ–è€…negativeï¼Œå†åˆ©ç”¨bounding box regressionä¿®æ­£anchorsè·å¾—ç²¾ç¡®çš„proposalsã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/v2-1908feeaba591d28bee3c4a754cca282_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°RPNç½‘ç»œå®é™…åˆ†ä¸º2æ¡çº¿ï¼Œä¸Šé¢ä¸€æ¡é€šè¿‡softmaxåˆ†ç±»anchorsè·å¾—positiveå’Œnegativeåˆ†ç±»ï¼Œä¸‹é¢ä¸€æ¡ç”¨äºè®¡ç®—å¯¹äºanchorsçš„bounding box regressionåç§»é‡ï¼Œä»¥è·å¾—ç²¾ç¡®çš„proposalã€‚è€Œæœ€åçš„Proposalå±‚åˆ™è´Ÿè´£ç»¼åˆpositive anchorså’Œå¯¹åº”bounding box regressionåç§»é‡è·å–proposalsï¼ŒåŒæ—¶å‰”é™¤å¤ªå°å’Œè¶…å‡ºè¾¹ç•Œçš„proposalsã€‚</p>
<p>æ‰€è°“anchorsï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç»„ç”±rpn/generate_anchors.pyç”Ÿæˆçš„çŸ©å½¢ã€‚ç›´æ¥è¿è¡Œä½œè€…demoä¸­çš„generate_anchors.pyå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[[ -84.  -40.   99.   55.]</span><br><span class="line"> [-176.  -88.  191.  103.]</span><br><span class="line"> [-360. -184.  375.  199.]</span><br><span class="line"> [ -56.  -56.   71.   71.]</span><br><span class="line"> [-120. -120.  135.  135.]</span><br><span class="line"> [-248. -248.  263.  263.]</span><br><span class="line"> [ -36.  -80.   51.   95.]</span><br><span class="line"> [ -80. -168.   95.  183.]</span><br><span class="line"> [-168. -344.  183.  359.]]</span><br></pre></td></tr></table></figure><br>å…¶ä¸­æ¯è¡Œçš„4ä¸ªå€¼$\left(x_{1}, y_{1}, x_{2}, y_{2}\right)$è¡¨çŸ©å½¢å·¦ä¸Šå’Œå³ä¸‹è§’ç‚¹åæ ‡ã€‚9ä¸ªçŸ©å½¢å…±æœ‰3ç§å½¢çŠ¶ï¼Œé•¿å®½æ¯”ä¸ºå¤§çº¦ä¸ºwidth: height $\in\{1: 1,1: 2,2: 1\}$ä¸‰ç§ï¼Œå¦‚å›¾ã€‚å®é™…ä¸Šé€šè¿‡anchorså°±å¼•å…¥äº†æ£€æµ‹ä¸­å¸¸ç”¨åˆ°çš„å¤šå°ºåº¦æ–¹æ³•ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/v2-7abead97efcc46a3ee5b030a2151643f_hd.jpg" alt></p>
<p>æ³¨ï¼šå…³äºä¸Šé¢çš„anchors sizeï¼Œå…¶å®æ˜¯æ ¹æ®æ£€æµ‹å›¾åƒè®¾ç½®çš„ã€‚åœ¨python demoä¸­ï¼Œä¼šæŠŠä»»æ„å¤§å°çš„è¾“å…¥å›¾åƒreshapeæˆ800x600ã€‚å†å›å¤´æ¥çœ‹anchorsçš„å¤§å°ï¼Œanchorsä¸­é•¿å®½1:2ä¸­æœ€å¤§ä¸º352x704ï¼Œé•¿å®½2:1ä¸­æœ€å¤§736x384ï¼ŒåŸºæœ¬æ˜¯coveräº†800x600çš„å„ä¸ªå°ºåº¦å’Œå½¢çŠ¶ã€‚</p>
<p><strong>é‚£ä¹ˆè¿™9ä¸ªanchorsæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</strong>éå†Conv layersè®¡ç®—è·å¾—çš„feature mapsï¼Œä¸ºæ¯ä¸€ä¸ªç‚¹éƒ½é…å¤‡è¿™9ç§anchorsä½œä¸ºåˆå§‹çš„æ£€æµ‹æ¡†ã€‚è¿™æ ·åšè·å¾—æ£€æµ‹æ¡†å¾ˆä¸å‡†ç¡®ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåé¢è¿˜æœ‰2æ¬¡bounding box regressionå¯ä»¥ä¿®æ­£æ£€æµ‹æ¡†ä½ç½®ã€‚</p>
<p><strong>å…¶å®RPNæœ€ç»ˆå°±æ˜¯åœ¨åŸå›¾å°ºåº¦ä¸Šï¼Œè®¾ç½®äº†å¯†å¯†éº»éº»çš„å€™é€‰Anchorã€‚ç„¶åç”¨cnnå»åˆ¤æ–­å“ªäº›Anchoræ˜¯é‡Œé¢æœ‰ç›®æ ‡çš„positive anchorï¼Œå“ªäº›æ˜¯æ²¡ç›®æ ‡çš„negative anchorã€‚æ‰€ä»¥ï¼Œä»…ä»…æ˜¯ä¸ªäºŒåˆ†ç±»è€Œå·²ï¼</strong></p>
<p>ä¸€å‰¯MxNå¤§å°çš„çŸ©é˜µé€å…¥Faster RCNNç½‘ç»œåï¼Œåˆ°RPNç½‘ç»œå˜ä¸º(M/16)x(N/16)ï¼Œä¸å¦¨è®¾ W=M/16ï¼ŒH=N/16ã€‚åœ¨è¿›å…¥reshapeä¸softmaxä¹‹å‰ï¼Œå…ˆåšäº†1x1å·ç§¯<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/v2-1ab4b6c3dd607a5035b5203c76b078f3_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°å…¶num_output=18ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡è¯¥å·ç§¯çš„è¾“å‡ºå›¾åƒä¸ºWxHx18å¤§å°ã€‚è¿™ä¹Ÿå°±åˆšå¥½å¯¹åº”äº†feature mapsæ¯ä¸€ä¸ªç‚¹éƒ½æœ‰9ä¸ªanchorsï¼ŒåŒæ—¶æ¯ä¸ªanchorsåˆæœ‰å¯èƒ½æ˜¯positiveå’Œnegativeï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜WxHx(9<em>2)å¤§å°çš„çŸ©é˜µã€‚<em>*ä¸ºä½•è¿™æ ·åšï¼Ÿ</em></em>åé¢æ¥softmaxåˆ†ç±»è·å¾—positive anchorsï¼Œä¹Ÿå°±ç›¸å½“äºåˆæ­¥æå–äº†æ£€æµ‹ç›®æ ‡å€™é€‰åŒºåŸŸboxï¼ˆä¸€èˆ¬è®¤ä¸ºç›®æ ‡åœ¨positive anchorsä¸­ï¼‰ã€‚</p>
<p><strong>é‚£ä¹ˆä¸ºä½•è¦åœ¨softmaxå‰åéƒ½æ¥ä¸€ä¸ªreshape layerï¼Ÿ</strong>å…¶å®åªæ˜¯ä¸ºäº†ä¾¿äºsoftmaxåˆ†ç±»,å­˜å‚¨å½¢å¼ä¸º[1, 2x9, H, W]ã€‚è€Œåœ¨softmaxåˆ†ç±»æ—¶éœ€è¦è¿›è¡Œpositive/negativeäºŒåˆ†ç±»ï¼Œæ‰€ä»¥reshape layerä¼šå°†å…¶å˜ä¸º[1, 2, 9xH, W]å¤§å°ï¼Œå³å•ç‹¬â€œè…¾ç©ºâ€å‡ºæ¥ä¸€ä¸ªç»´åº¦ä»¥ä¾¿softmaxåˆ†ç±»ï¼Œä¹‹åå†reshapeå›å¤åŸçŠ¶ã€‚</p>
<p>RPNç½‘ç»œä¸­åˆ©ç”¨anchorså’Œsoftmaxåˆæ­¥æå–å‡ºpositive anchorsä½œä¸ºå€™é€‰åŒºåŸŸï¼ˆå¦å¤–ä¹Ÿæœ‰å®ç°ç”¨sigmoidä»£æ›¿softmaxï¼ŒåŸç†ç±»ä¼¼ï¼‰ã€‚</p>
<p><strong>å¯¹proposalsè¿›è¡Œbounding box regression</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/v2-8241c8076d60156248916fe2f1a5674a_r.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°å…¶ num_output=36ï¼Œå³ç»è¿‡è¯¥å·ç§¯è¾“å‡ºå›¾åƒä¸ºWxHx36ï¼Œè¿™é‡Œç›¸å½“äºfeature mapsæ¯ä¸ªç‚¹éƒ½æœ‰9ä¸ªanchorsï¼Œæ¯ä¸ªanchorsåˆéƒ½æœ‰4ä¸ªç”¨äºå›å½’çš„$\left[d_{x}(A), d_{y}(A), d_{w}(A), d_{h}(A)\right]$å˜åŒ–é‡</p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>é‡‡ç”¨RPN(Region Proposal Network)ä»£æ›¿é€‰æ‹©æ€§æœç´¢(Selective Search)ï¼Œåˆ©ç”¨GPUè¿›è¡Œè®¡ç®—å¤§å¹…åº¦ç¼©å‡æå–region proposalçš„é€Ÿåº¦ã€‚</li>
<li>äº§ç”Ÿå»ºè®®çª—å£çš„CNNå’Œç›®æ ‡æ£€æµ‹çš„CNNå…±äº«ã€‚</li>
</ul>
<p>åœ¨ä¸»å¹²ç½‘ç»œä¸­å¢åŠ äº†RPN ï¼ˆRegion Proposal Networkï¼‰ç½‘ç»œï¼Œé€šè¿‡ä¸€å®šè§„åˆ™è®¾ç½®ä¸åŒå°ºåº¦çš„é”šç‚¹ï¼ˆAnchorï¼‰åœ¨RPNçš„å·ç§¯ç‰¹å¾å±‚æå–å€™é€‰æ¡†æ¥ä»£æ›¿Selective Searchç­‰ä¼ ç»Ÿçš„å€™é€‰æ¡†ç”Ÿæˆæ–¹æ³•ï¼Œå®ç°äº†ç½‘ç»œçš„ç«¯åˆ°ç«¯è®­ç»ƒã€‚å€™é€‰åŒºåŸŸç”Ÿæˆã€å€™é€‰åŒºåŸŸç‰¹å¾æå–ã€æ¡†å›å½’å’Œåˆ†ç±»å…¨è¿‡ç¨‹ä¸€æ°”å‘µæˆï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¨¡å‹å„éƒ¨åˆ†ä¸ä»…å­¦ä¹ å¦‚ä½•å®Œæˆè‡ªå·±çš„ä»»åŠ¡ï¼Œè¿˜è‡ªä¸»å­¦ä¹ å¦‚ä½•ç›¸äº’é…åˆã€‚è¿™ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚</p>
<h3 id="YOLO"><a href="#YOLO" class="headerlink" title="YOLO"></a>YOLO</h3><p>Redmon, J., et al., You Only Look Once: Unified, Real-Time Object Detection, in 2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). 2016. p. 779-788.</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/6983308-d54136f1eb0cd733.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/6983308-0d1e8d42480e1c1a.png" alt></p>
<p><strong>ç®—æ³•æµç¨‹</strong></p>
<ul>
<li>å°†å›¾åƒresizeåˆ°448 * 448ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ ï¼›</li>
<li>è¿è¡Œç¥ç»ç½‘ç»œï¼Œå¾—åˆ°ä¸€äº›bounding boxåæ ‡ã€boxä¸­åŒ…å«ç‰©ä½“çš„ç½®ä¿¡åº¦å’Œclass probabilities ï¼›</li>
<li>è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶ï¼Œç­›é€‰Boxesã€‚</li>
</ul>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li>YOLOå°†ç›®æ ‡æ£€æµ‹é—®é¢˜è½¬åŒ–ä¸ºå›å½’é—®é¢˜ï¼Œä¸éœ€è¦å¤æ‚çš„æµç¨‹ã€‚åœ¨å®æ—¶æ£€æµ‹ç³»ç»Ÿä¸­ï¼Œ YOLOçš„æ•ˆæœæ˜¯æœ€å¥½çš„ã€‚</li>
<li>YOLO åœ¨åšå‡ºé¢„æµ‹æ—¶æ˜¯æ¨ç†æ•´ä¸ªå›¾åƒçš„ã€‚ä¸æ»‘åŠ¨çª—å£å’Œå€™é€‰åŒºåŸŸç®—æ³•ä¸åŒï¼Œ YOLO åœ¨è®­ç»ƒå’Œæµ‹è¯•æ—¶ï¼Œä»æ•´ä¸ªå›¾åƒç»¼åˆè€ƒè™‘ï¼Œä¸ä»…åˆ†æç‰©ä½“çš„ appearance è¿˜åˆ†æå…¶ contextual ä¿¡æ¯ã€‚Fast R-CNN æ¯”è¾ƒå®¹æ˜“å°†èƒŒæ™¯è¯¯æ£€æµ‹ä¸ºç‰©ä½“ï¼Œå› ä¸ºå®ƒä¸è€ƒè™‘ contextual ä¿¡æ¯ã€‚YOLO æŠŠèƒŒæ™¯è¯¯æ£€æµ‹ä¸ºç‰©ä½“çš„æ¦‚ç‡ä¸åˆ° Fast R-CNN çš„ä¸€åŠã€‚</li>
<li>YOLO å¯¹ç‰©ä½“çš„æ³›åŒ–èƒ½åŠ›æ¯”è¾ƒå¥½ã€‚å½“åœ¨è‡ªç„¶å›¾åƒä¸Šè®­ç»ƒï¼Œåœ¨è‰ºæœ¯å›¾åƒä¸Šæ£€æµ‹æ—¶ï¼ŒYOLOçš„æ•ˆæœè¦æ¯” DPM å’Œ R-CNN å¥½å¾ˆå¤šã€‚</li>
</ul>
<p>YOLOæ²¡æœ‰é€‰æ‹©æ»‘åŠ¨çª—å£ï¼ˆsilding windowï¼‰æˆ–æå–proposalçš„æ–¹å¼è®­ç»ƒç½‘ç»œï¼Œè€Œæ˜¯ç›´æ¥é€‰ç”¨æ•´å›¾è®­ç»ƒæ¨¡å‹ï¼Œå°† Object Detection çš„é—®é¢˜è½¬åŒ–æˆä¸€ä¸ª Regression é—®é¢˜ã€‚</p>
<p>å°†å›¾ç‰‡åˆ†ä¸º$S\times S$ä¸ªå•å…ƒæ ¼(åŸæ–‡ä¸­S=7)ï¼Œä¹‹åçš„è¾“å‡ºæ˜¯ä»¥å•å…ƒæ ¼ä¸ºå•ä½è¿›è¡Œçš„ï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªobjectçš„ä¸­å¿ƒè½åœ¨æŸä¸ªå•å…ƒæ ¼ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªå•å…ƒæ ¼è´Ÿè´£é¢„æµ‹è¿™ä¸ªç‰©ä½“ã€‚</li>
<li>æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹Bä¸ªbboxå€¼(bboxå€¼åŒ…æ‹¬åæ ‡å’Œå®½é«˜ï¼ŒåŸæ–‡ä¸­B=2)ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªbboxå€¼é¢„æµ‹ä¸€ä¸ªç½®ä¿¡åº¦(confidence scores)ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹BÃ—(4+1)ä¸ªå€¼ã€‚</li>
<li>æ¯ä¸ªå•å…ƒæ ¼éœ€è¦é¢„æµ‹C(ç‰©ä½“ç§ç±»ä¸ªæ•°ï¼ŒåŸæ–‡C=20ï¼Œè¿™ä¸ªä¸ä½¿ç”¨çš„æ•°æ®åº“æœ‰å…³)ä¸ªæ¡ä»¶æ¦‚ç‡å€¼.</li>
</ul>
<p>æ‰€ä»¥ï¼Œæœ€åç½‘ç»œçš„è¾“å‡ºç»´åº¦ä¸º$S \times S \times (B\times 5 + C)$ï¼Œè¿™é‡Œè¾“å‡ºä¸º$7\times7\times(2\times5+20)$, è™½ç„¶æ¯ä¸ªå•å…ƒæ ¼è´Ÿè´£é¢„æµ‹ä¸€ç§ç‰©ä½“(è¿™ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« çš„é—®é¢˜ï¼Œå½“æœ‰å°ç‰©ä½“æ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜)ï¼Œä½†æ˜¯æ¯ä¸ªå•å…ƒæ ¼å¯ä»¥é¢„æµ‹å¤šä¸ªbboxå€¼(è¿™é‡Œå¯ä»¥è®¤ä¸ºæœ‰å¤šä¸ªä¸åŒå½¢çŠ¶çš„bboxï¼Œä¸ºäº†æ›´å‡†ç¡®çš„å®šä½å‡ºç‰©ä½“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º)ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/6983308-29a33d2e79ed722b.png" alt></p>
<p><strong>(x,y)æ˜¯bboxçš„ä¸­å¿ƒç›¸å¯¹äºå•å…ƒæ ¼çš„offset</strong><br>å•å…ƒæ ¼åæ ‡ä¸º$(x_{col},y_{row})$ï¼Œå‡è®¾å®ƒé¢„æµ‹çš„è¾“å‡ºçš„bboxä¸­å¿ƒåæ ‡ä¸º$(x_c,y_c)$,é‚£ä¹ˆæœ€ç»ˆé¢„æµ‹å‡ºæ¥çš„(x,y)æ˜¯ç»è¿‡å½’ä¸€åŒ–å¤„ç†çš„ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸­å¿ƒç›¸å¯¹äºå•å…ƒæ ¼çš„offset</p>
<p><strong>(w,h)æ˜¯bboxç›¸å¯¹äºæ•´ä¸ªå›¾ç‰‡çš„æ¯”ä¾‹</strong><br>é¢„æµ‹çš„bboxçš„å®½é«˜ä¸º$w_b,h_b$ï¼Œ(w,h)è¡¨ç¤ºçš„æ˜¯bboxçš„æ˜¯ç›¸å¯¹äºæ•´å¼ å›¾ç‰‡çš„å æ¯”</p>
<p><strong>confidence</strong><br>è¿™ä¸ªç½®ä¿¡åº¦æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€æ˜¯æ ¼å­å†…æ˜¯å¦æœ‰ç›®æ ‡ï¼ŒäºŒæ˜¯bboxçš„å‡†ç¡®åº¦ã€‚å®šä¹‰ç½®ä¿¡åº¦ä¸º$P_r(Object)âˆ—IOU^{truth}_{pred}$<br>è¿™é‡Œï¼Œå¦‚æœæ ¼å­å†…æœ‰ç‰©ä½“ï¼Œåˆ™$P_r(Object)=1$ï¼Œæ­¤æ—¶ç½®ä¿¡åº¦ç­‰äºIoUã€‚å¦‚æœæ ¼å­å†…æ²¡æœ‰ç‰©ä½“ï¼Œåˆ™$P_r(Object)=0$ï¼Œæ­¤æ—¶ç½®ä¿¡åº¦ä¸º0</p>
<p><strong>Cç±»çš„æ¡ä»¶æ¦‚ç‡</strong><br>æ¡ä»¶æ¦‚ç‡å®šä¹‰ä¸º$P_r(Class_i |Object)$ï¼Œè¡¨ç¤ºè¯¥å•å…ƒæ ¼å­˜åœ¨ç‰©ä½“ä¸”å±äºç¬¬iç±»çš„æ¦‚ç‡ã€‚</p>
<p>åœ¨æµ‹è¯•çš„æ—¶å€™æ¯ä¸ªå•å…ƒæ ¼é¢„æµ‹æœ€ç»ˆè¾“å‡ºçš„æ¦‚ç‡å®šä¹‰ä¸ºï¼Œå¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºï¼ˆä¸¤å¹…å›¾ä¸ä¸€æ ·ï¼Œä»£è¡¨ä¸€ä¸ªæ¡†ä¼šè¾“å‡ºBåˆ—æ¦‚ç‡å€¼ï¼‰<br>$P_r(Class_i|Object) âˆ— P_r(Object) âˆ— IOU^{truth}_{pred} = P_r(Class_i) âˆ— IOU^{truth}_{pred}$</p>
<p>æœ€åå°†$(S\times S)\times B\times20$ åˆ—çš„ç»“æœé€å…¥NMSï¼Œæœ€åå³å¯å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºæ¡†ç»“æœ</p>
<p><strong>æŸå¤±å‡½æ•°</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180511204751564.png" alt></p>
<p>è¿™é‡Œå¼ºè°ƒä¸¤ç‚¹ï¼š<br> 1.æ¯ä¸ªå›¾ç‰‡çš„æ¯ä¸ªå•å…ƒæ ¼ä¸ä¸€å®šéƒ½åŒ…å«objectï¼Œå¦‚æœæ²¡æœ‰objectï¼Œé‚£ä¹ˆconfidenceå°±ä¼šå˜æˆ0ï¼Œè¿™æ ·åœ¨ä¼˜åŒ–æ¨¡å‹çš„æ—¶å€™å¯èƒ½ä¼šè®©æ¢¯åº¦è·¨è¶Šå¤ªå¤§ï¼Œæ¨¡å‹ä¸ç¨³å®šè·‘é£äº†ã€‚ä¸ºäº†å¹³è¡¡è¿™ä¸€ç‚¹ï¼Œåœ¨æŸå¤±å‡½æ•°ä¸­ï¼Œè®¾ç½®ä¸¤ä¸ªå‚æ•°$Î»_{corrd}$å’Œ$Î»_{noobj}$ï¼Œå…¶ä¸­$Î»_{corrd}$æ§åˆ¶bboxé¢„æµ‹ä½ç½®çš„æŸå¤±ï¼Œ$Î»_{noobj}$æ§åˆ¶å•ä¸ªæ ¼å†…æ²¡æœ‰ç›®æ ‡çš„æŸå¤±ã€‚<br> 2.å¯¹äºå¤§çš„ç‰©ä½“ï¼Œå°çš„åå·®å¯¹äºå°çš„ç‰©ä½“å½±å“è¾ƒå¤§ï¼Œä¸ºäº†å‡å°‘è¿™ä¸ªå½±å“ï¼Œæ‰€ä»¥å¯¹bboxçš„å®½é«˜éƒ½å¼€æ ¹å·ã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>YOLOçš„ç‰©ä½“æ£€æµ‹ç²¾åº¦ä½äºå…¶ä»–state-of-the-artçš„ç‰©ä½“æ£€æµ‹ç³»ç»Ÿã€‚</li>
<li>YOLOå®¹æ˜“äº§ç”Ÿç‰©ä½“çš„å®šä½é”™è¯¯ã€‚</li>
<li>YOLOå¯¹å°ç‰©ä½“çš„æ£€æµ‹æ•ˆæœä¸å¥½ï¼ˆå°¤å…¶æ˜¯å¯†é›†çš„å°ç‰©ä½“ï¼Œå› ä¸ºä¸€ä¸ªæ …æ ¼åªèƒ½é¢„æµ‹2ä¸ªç‰©ä½“ï¼‰ã€‚</li>
</ul>
<h3 id="YOLO-v2"><a href="#YOLO-v2" class="headerlink" title="YOLO v2"></a>YOLO v2</h3><p>Redmon, J. and A. Farhadi, YOLO9000: Better, Faster, Stronger. (CVPR 2017)</p>
<p><strong>æ”¹è¿›</strong>ï¼š</p>
<ul>
<li><p><strong>Batch Normalization</strong></p>
<p>Batch Normalizationå¯ä»¥æå‡æ¨¡å‹æ”¶æ•›é€Ÿåº¦ï¼Œè€Œä¸”å¯ä»¥èµ·åˆ°ä¸€å®šæ­£åˆ™åŒ–æ•ˆæœï¼Œé™ä½æ¨¡å‹çš„è¿‡æ‹Ÿåˆã€‚åœ¨YOLOv2ä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚åé¢éƒ½æ·»åŠ äº†Batch Normalizationå±‚ï¼Œå¹¶ä¸”ä¸å†ä½¿ç”¨droputã€‚ä½¿ç”¨Batch Normalizationåï¼ŒYOLOv2çš„mAPæå‡äº†2.4%ã€‚</p>
</li>
<li><p><strong>High Resolution Classifier</strong></p>
<p>ç›®å‰å¤§éƒ¨åˆ†çš„æ£€æµ‹æ¨¡å‹éƒ½ä¼šåœ¨å…ˆåœ¨ImageNetåˆ†ç±»æ•°æ®é›†ä¸Šé¢„è®­ç»ƒæ¨¡å‹çš„ä¸»ä½“éƒ¨åˆ†ï¼ˆCNNç‰¹å¾æå–å™¨ï¼‰ï¼Œç”±äºå†å²åŸå› ï¼ŒImageNetåˆ†ç±»æ¨¡å‹åŸºæœ¬é‡‡ç”¨å¤§å°ä¸º$224 \times 224$çš„å›¾ç‰‡ä½œä¸ºè¾“å…¥ï¼Œåˆ†è¾¨ç‡ç›¸å¯¹è¾ƒä½ï¼Œä¸åˆ©äºæ£€æµ‹æ¨¡å‹ã€‚æ‰€ä»¥YOLOv1åœ¨é‡‡ç”¨$224 \times 224$åˆ†ç±»æ¨¡å‹é¢„è®­ç»ƒåï¼Œå°†åˆ†è¾¨ç‡å¢åŠ è‡³$448 \times 448$ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªé«˜åˆ†è¾¨ç‡åœ¨æ£€æµ‹æ•°æ®é›†ä¸Šfine tuneã€‚ä½†æ˜¯ç›´æ¥åˆ‡æ¢åˆ†è¾¨ç‡ï¼Œæ£€æµ‹æ¨¡å‹å¯èƒ½éš¾ä»¥å¿«é€Ÿé€‚åº”é«˜åˆ†è¾¨ç‡ã€‚æ‰€ä»¥YOLOv2å¢åŠ äº†åœ¨ImageNetæ•°æ®é›†ä¸Šä½¿ç”¨$448 \times 448$æ¥fine tuneåˆ†ç±»ç½‘ç»œè¿™ä¸€ä¸­é—´è¿‡ç¨‹ï¼ˆ10 epochsï¼‰ï¼Œè¿™å¯ä»¥ä½¿å¾—æ¨¡å‹åœ¨æ£€æµ‹æ•°æ®é›†ä¸Šfine tuneä¹‹å‰å·²ç»é€‚ç”¨é«˜åˆ†è¾¨ç‡è¾“å…¥ã€‚ä½¿ç”¨é«˜åˆ†è¾¨ç‡åˆ†ç±»å™¨åï¼ŒYOLOv2çš„mAPæå‡äº†çº¦4%ã€‚</p>
</li>
<li><p><strong>Convolutionlal With Anchor Boxes</strong></p>
<p>anchoræ˜¯RNPç½‘ç»œä¸­çš„ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œè¯´çš„æ˜¯åœ¨å·ç§¯ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ»‘çª—æ“ä½œï¼Œæ¯ä¸€ä¸ªä¸­å¿ƒå¯ä»¥é¢„æµ‹9ç§ä¸åŒå¤§å°çš„å»ºè®®æ¡†ã€‚</p>
<p><strong>YOLO v1ï¼š S*S* (B*5 + C) =&gt; 7*7ï¼ˆ2*5+20ï¼‰</strong><br>ã€€ã€€ å…¶ä¸­Bå¯¹åº”Boxæ•°é‡ï¼Œ5å¯¹åº” Rect å®šä½+ç½®ä¿¡åº¦ã€‚æ¯ä¸ªGridåªèƒ½é¢„æµ‹å¯¹åº”ä¸¤ä¸ªBoxï¼Œè¿™ä¸¤ä¸ªBoxå…±ç”¨ä¸€ä¸ªåˆ†ç±»ç»“æœï¼ˆ20 classesï¼‰ï¼Œè¿™æ˜¯å¾ˆä¸åˆç†çš„ä¸´æ—¶æ–¹æ¡ˆã€‚</p>
<p><strong>YOLO v2ï¼š S*S*K* (5 + C) =&gt; 13*13*9ï¼ˆ5+20ï¼‰</strong><br>ã€€ã€€åˆ†è¾¨ç‡æ”¹æˆäº†13*13ï¼Œæ›´ç»†çš„æ ¼å­åˆ’åˆ†å¯¹å°ç›®æ ‡é€‚åº”æ›´å¥½ï¼Œå†åŠ ä¸Šä¸Fasterä¸€æ ·çš„K=9ï¼Œè®¡ç®—é‡å¢åŠ äº†ä¸å°‘ã€‚é€šè¿‡Anchor Boxæ”¹è¿›ï¼ŒmAPç”±69.5ä¸‹é™åˆ°69.2ï¼ŒRecallç”±81%æå‡åˆ°äº†88%ã€‚<br>ã€€ã€€<br>ã€€ã€€ä¸ºäº†å¼•å…¥anchor boxesæ¥é¢„æµ‹bounding boxesï¼Œä½œè€…åœ¨ç½‘ç»œä¸­æœæ–­å»æ‰äº†å…¨è¿æ¥å±‚ã€‚é¦–å…ˆï¼Œä½œè€…å»æ‰äº†åé¢çš„ä¸€ä¸ªæ± åŒ–å±‚ä»¥ç¡®ä¿è¾“å‡ºçš„å·ç§¯ç‰¹å¾å›¾æœ‰æ›´é«˜çš„åˆ†è¾¨ç‡ã€‚ç„¶åï¼Œé€šè¿‡ç¼©å‡ç½‘ç»œï¼Œè®©å›¾ç‰‡è¾“å…¥åˆ†è¾¨ç‡ä¸º416x416ï¼Œè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºäº†è®©åé¢äº§ç”Ÿçš„å·ç§¯ç‰¹å¾å›¾å®½é«˜éƒ½ä¸ºå¥‡æ•°ï¼Œè¿™æ ·å°±å¯ä»¥äº§ç”Ÿä¸€ä¸ªcenter cellã€‚ä½œè€…è§‚å¯Ÿåˆ°ï¼Œå¤§ç‰©ä½“é€šå¸¸å æ®äº†å›¾åƒçš„ä¸­é—´ä½ç½®ï¼Œ å°±å¯ä»¥åªç”¨ä¸­å¿ƒçš„ä¸€ä¸ªcellæ¥é¢„æµ‹è¿™äº›ç‰©ä½“çš„ä½ç½®ï¼Œå¦åˆ™å°±è¦ç”¨ä¸­é—´çš„4ä¸ªcellæ¥è¿›è¡Œé¢„æµ‹ï¼Œè¿™ä¸ªæŠ€å·§å¯ç¨ç¨æå‡æ•ˆç‡ã€‚æœ€åï¼ŒYOLOv2ä½¿ç”¨äº†å·ç§¯å±‚é™é‡‡æ ·ï¼ˆfactorä¸º32ï¼‰ï¼Œä½¿å¾—è¾“å…¥å·ç§¯ç½‘ç»œçš„416x416å›¾ç‰‡æœ€ç»ˆå¾—åˆ°13x13çš„å·ç§¯ç‰¹å¾å›¾ï¼ˆ416/32=13ï¼‰ã€‚<br>ã€€ã€€åŠ å…¥äº†anchor boxesåï¼Œå¯ä»¥é¢„æ–™åˆ°çš„ç»“æœæ˜¯å¬å›ç‡ä¸Šå‡ï¼Œå‡†ç¡®ç‡ä¸‹é™ã€‚æˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹ï¼Œå‡è®¾æ¯ä¸ªcellé¢„æµ‹9ä¸ªå»ºè®®æ¡†ï¼Œé‚£ä¹ˆæ€»å…±ä¼šé¢„æµ‹13x13x9 = 1521ä¸ªboxesï¼Œè€Œä¹‹å‰çš„ç½‘ç»œä»…ä»…é¢„æµ‹7x7x2 = 98ä¸ªboxesã€‚å…·ä½“æ•°æ®ä¸ºï¼šæ²¡æœ‰anchor boxesï¼Œæ¨¡å‹recallä¸º81%ï¼ŒmAPä¸º69.5%ï¼›åŠ å…¥anchor boxesï¼Œæ¨¡å‹recallä¸º88%ï¼ŒmAPä¸º69.2%ã€‚è¿™æ ·çœ‹æ¥ï¼Œå‡†ç¡®ç‡åªæœ‰å°å¹…åº¦çš„ä¸‹é™ï¼Œè€Œå¬å›ç‡åˆ™æå‡äº†7%ï¼Œè¯´æ˜å¯ä»¥é€šè¿‡è¿›ä¸€æ­¥çš„å·¥ä½œæ¥åŠ å¼ºå‡†ç¡®ç‡ï¼Œçš„ç¡®æœ‰æ”¹è¿›ç©ºé—´ã€‚</p>
</li>
<li><p><strong>New Networkâ€”â€”Darknet-19</strong></p>
<p>YOLOv2ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„åˆ†ç±»ç½‘ç»œä½œä¸ºç‰¹å¾æå–éƒ¨åˆ†ï¼Œå‚è€ƒäº†å‰äººçš„å…ˆè¿›ç»éªŒï¼Œæ¯”å¦‚ç±»ä¼¼äºVGGï¼Œä½œè€…ä½¿ç”¨äº†è¾ƒå¤šçš„3x3å·ç§¯æ ¸ï¼Œåœ¨æ¯ä¸€æ¬¡æ± åŒ–æ“ä½œåæŠŠé€šé“æ•°ç¿»å€ã€‚å€Ÿé‰´äº†network in networkçš„æ€æƒ³ï¼Œç½‘ç»œä½¿ç”¨äº†å…¨å±€å¹³å‡æ± åŒ–ï¼ˆglobal average poolingï¼‰ï¼ŒæŠŠ1x1çš„å·ç§¯æ ¸ç½®äº3x3çš„å·ç§¯æ ¸ä¹‹é—´ï¼Œç”¨æ¥å‹ç¼©ç‰¹å¾ã€‚ä¹Ÿç”¨äº†batch normalizationç¨³å®šæ¨¡å‹è®­ç»ƒã€‚æ¨¡å‹å‚æ•°ç›¸å¯¹å°ä¸€äº›ã€‚ä½¿ç”¨Darknet-19ä¹‹åï¼ŒYOLOv2çš„mAPå€¼æ²¡æœ‰æ˜¾è‘—æå‡ï¼Œä½†æ˜¯è®¡ç®—é‡å´å¯ä»¥å‡å°‘çº¦33%ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_18-40-15.jpg" alt></p>
</li>
</ul>
<ul>
<li><p><strong>Dimension Clusters</strong></p>
<p>åœ¨Faster R-CNNå’ŒSSDä¸­ï¼Œå…ˆéªŒæ¡†çš„ç»´åº¦ï¼ˆé•¿å’Œå®½ï¼‰éƒ½æ˜¯æ‰‹åŠ¨è®¾å®šçš„ï¼Œå¸¦æœ‰ä¸€å®šçš„ä¸»è§‚æ€§ã€‚å¦‚æœé€‰å–çš„å…ˆéªŒæ¡†ç»´åº¦æ¯”è¾ƒåˆé€‚ï¼Œé‚£ä¹ˆæ¨¡å‹æ›´å®¹æ˜“å­¦ä¹ ï¼Œä»è€Œåšå‡ºæ›´å¥½çš„é¢„æµ‹ã€‚å› æ­¤ï¼ŒYOLOv2é‡‡ç”¨k-meansèšç±»æ–¹æ³•å¯¹è®­ç»ƒé›†ä¸­çš„è¾¹ç•Œæ¡†åšäº†èšç±»åˆ†æã€‚å› ä¸ºè®¾ç½®å…ˆéªŒæ¡†çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä½¿å¾—é¢„æµ‹æ¡†ä¸ground truthçš„IOUæ›´å¥½ï¼Œæ‰€ä»¥èšç±»åˆ†ææ—¶é€‰ç”¨boxä¸èšç±»ä¸­å¿ƒboxä¹‹é—´çš„IOUå€¼ä½œä¸ºè·ç¦»æŒ‡æ ‡ï¼š $d(\text { box }, \text { centroid })=1-\mathrm{IOU}(\text { box }, \text { centroid })$</p>
</li>
<li><p><strong>Direct location prediction</strong></p>
<script type="math/tex; mode=display">
x=\left(t_{x} * w_{a}\right)-x_{a}</script><script type="math/tex; mode=display">
y=\left(t_{y} * h_{a}\right)-y_{a}</script><p>è¿™ä¸ªå…¬å¼çš„ç†è§£ä¸ºï¼šå½“é¢„æµ‹tx=1ï¼Œå°±ä¼šæŠŠboxå‘å³è¾¹ç§»åŠ¨ä¸€å®šè·ç¦»ï¼ˆå…·ä½“ä¸ºanchor boxçš„å®½åº¦ï¼‰ï¼Œé¢„æµ‹tx=-1ï¼Œå°±ä¼šæŠŠboxå‘å·¦è¾¹ç§»åŠ¨ç›¸åŒçš„è·ç¦»ï¼Œè¯¥å…¬å¼æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œä¸­å¿ƒç‚¹å¯èƒ½ä¼šå‡ºç°åœ¨å›¾åƒä»»ä½•ä½ç½®ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´å›å½’è¿‡ç¨‹éœ‡è¡ï¼Œç”šè‡³æ— æ³•æ”¶æ•›ã€‚</p>
<p><strong>å¼ºçº¦æŸæ–¹æ³•</strong>ï¼š</p>
<ul>
<li>å¯¹åº” Cell è·ç¦»å·¦ä¸Šè§’çš„è¾¹è·ä¸º$\left(C_{x}, C_{y}\right)$ï¼ŒÏƒå®šä¹‰ä¸ºsigmoidæ¿€æ´»å‡½æ•°ï¼Œå°†å‡½æ•°å€¼çº¦æŸåˆ°ï¼»0ï¼Œ1ï¼½ï¼Œç”¨æ¥é¢„æµ‹ç›¸å¯¹äºè¯¥Cellä¸­å¿ƒçš„åç§»ï¼ˆä¸ä¼šåç¦»cellï¼‰ï¼›</li>
<li>é¢„å®šAnchorï¼ˆæ–‡ä¸­æè¿°ä¸ºbounding box priorï¼‰å¯¹åº”çš„å®½é«˜ä¸º$\left(P_{w}, P_{h}\right)$ï¼Œé¢„æµ‹ Location æ˜¯ç›¸å¯¹äºAnchorçš„å®½é«˜ä¹˜ä»¥ç³»æ•°å¾—åˆ°ï¼›</li>
</ul>
</li>
</ul>
<p>  å¦‚æœè¿™ä¸ªcellè·ç¦»å›¾åƒå·¦ä¸Šè§’çš„è¾¹è·ä¸º$\left(C_{x}, C_{y}\right)$ä»¥åŠè¯¥cellå¯¹åº”çš„boxç»´åº¦ï¼ˆbounding box priorï¼‰çš„é•¿å’Œå®½åˆ†åˆ«ä¸º$\left(P_{w}, P_{h}\right)$ï¼Œé‚£ä¹ˆé¢„æµ‹å€¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š </p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_18-53-58.jpg" alt></p>
<ul>
<li><p><strong>Fine-Grained Features</strong><br>YOLOæœ€ç»ˆåœ¨13x13çš„ç‰¹å¾å›¾ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œè™½ç„¶è¿™è¶³ä»¥èƒœä»»å¤§å°ºåº¦ç‰©ä½“çš„æ£€æµ‹ï¼Œä½†å¯¹äºå°ç‰©ä½“è¿˜éœ€è¦æ›´ç²¾ç»†çš„ç‰¹å¾å›¾ï¼ˆFine-Grained Featuresï¼‰ï¼Œå‰é¢æ›´ç²¾ç»†çš„ç‰¹å¾å›¾å¯ä»¥ç”¨æ¥é¢„æµ‹å°ç‰©ä½“ã€‚<br>YOLOv2æå‡ºäº†ä¸€ç§passthroughå±‚æ¥åˆ©ç”¨æ›´ç²¾ç»†çš„ç‰¹å¾å›¾ã€‚YOLOv2æ‰€åˆ©ç”¨çš„Fine-Grained Featuresæ˜¯26x26å¤§å°çš„ç‰¹å¾å›¾ï¼ˆæœ€åä¸€ä¸ªmaxpoolingå±‚çš„è¾“å…¥ï¼‰ï¼Œå¯¹äºDarknet-19æ¨¡å‹æ¥è¯´å°±æ˜¯å¤§å°ä¸º26x26x512çš„ç‰¹å¾å›¾ã€‚passthroughå±‚ä¸ResNetç½‘ç»œçš„shortcutç±»ä¼¼ï¼Œä»¥å‰é¢æ›´é«˜åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸ºè¾“å…¥ï¼Œç„¶åå°†å…¶è¿æ¥åˆ°åé¢çš„ä½åˆ†è¾¨ç‡ç‰¹å¾å›¾ä¸Šã€‚å‰é¢çš„ç‰¹å¾å›¾ç»´åº¦æ˜¯åé¢çš„ç‰¹å¾å›¾çš„2å€ï¼Œpassthroughå±‚æŠ½å–å‰é¢å±‚çš„æ¯ä¸ª2x2çš„å±€éƒ¨åŒºåŸŸï¼Œç„¶åå°†å…¶è½¬åŒ–ä¸ºchannelç»´åº¦ï¼Œå¯¹äº26x26x512çš„ç‰¹å¾å›¾ï¼Œç»passthroughå±‚å¤„ç†ä¹‹åå°±å˜æˆäº†13x13x2048çš„æ–°ç‰¹å¾å›¾ï¼ˆç‰¹å¾å›¾å¤§å°é™ä½4å€ï¼Œè€Œchannleså¢åŠ 4å€ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ä¸åé¢çš„13x13x1024ç‰¹å¾å›¾è¿æ¥åœ¨ä¸€èµ·å½¢æˆ13x13x3072çš„ç‰¹å¾å›¾ï¼Œç„¶ååœ¨æ­¤ç‰¹å¾å›¾åŸºç¡€ä¸Šå·ç§¯åšé¢„æµ‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_19-14-51.jpg" alt></p>
</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20161229150249883.jpg" alt></p>
<ul>
<li><p><strong>Multi-Scale Training</strong><br>ã€€ã€€ä¸ºäº†è®© YOLOv2 é€‚åº”ä¸åŒScaleä¸‹çš„æ£€æµ‹ä»»åŠ¡ï¼Œä½œè€…å°è¯•é€šè¿‡ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡çš„è®­ç»ƒæ¥æé«˜ç½‘ç»œçš„é€‚åº”æ€§ã€‚(ç½‘ç»œåªç”¨åˆ°äº†å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œå¯ä»¥è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼ˆæ£€æµ‹ä»»æ„å¤§å°å›¾ç‰‡ï¼‰)<br>å…·ä½“åšæ³•æ˜¯ï¼š<br>ã€€ã€€ æ¯ç»è¿‡10æ¬¡è®­ç»ƒï¼ˆ10 epochï¼‰ï¼Œå°±ä¼šéšæœºé€‰æ‹©æ–°çš„å›¾ç‰‡å°ºå¯¸ã€‚YOLOç½‘ç»œä½¿ç”¨çš„é™é‡‡æ ·å‚æ•°ä¸º32ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨32çš„å€æ•°è¿›è¡Œå°ºåº¦æ± åŒ–{320,352ï¼Œâ€¦ï¼Œ608}ã€‚æœ€ç»ˆæœ€å°çš„å°ºå¯¸ä¸º320 <em> 320ï¼Œæœ€å¤§çš„å°ºå¯¸ä¸º608 </em> 608ã€‚æ¥ç€æŒ‰ç…§è¾“å…¥å°ºå¯¸è°ƒæ•´ç½‘ç»œè¿›è¡Œè®­ç»ƒã€‚</p>
<p>â€‹         è¿™ç§æœºåˆ¶ä½¿å¾—ç½‘ç»œå¯ä»¥æ›´å¥½åœ°é¢„æµ‹ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œæ„å‘³ç€åŒä¸€ä¸ªç½‘ç»œå¯ä»¥è¿›è¡Œä¸åŒåˆ†è¾¨ç‡çš„æ£€æµ‹ä»»åŠ¡ï¼Œåœ¨å°å°ºå¯¸å›¾ç‰‡ä¸ŠYOLOv2è¿è¡Œæ›´å¿«ï¼Œåœ¨é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¾¾åˆ°äº†å¹³è¡¡ã€‚</p>
</li>
<li><p><strong>äº¤å‰æ•°æ®è®­ç»ƒ</strong></p>
<p>YOLO9000æ˜¯åœ¨YOLOv2çš„åŸºç¡€ä¸Šæå‡ºçš„ä¸€ç§å¯ä»¥æ£€æµ‹è¶…è¿‡9000ä¸ªç±»åˆ«çš„æ¨¡å‹ï¼Œå…¶ä¸»è¦è´¡çŒ®ç‚¹åœ¨äºæå‡ºäº†ä¸€ç§åˆ†ç±»å’Œæ£€æµ‹çš„è”åˆè®­ç»ƒç­–ç•¥ã€‚ä¼—å¤šå‘¨çŸ¥ï¼Œæ£€æµ‹æ•°æ®é›†çš„æ ‡æ³¨è¦æ¯”åˆ†ç±»æ•°æ®é›†æ‰“æ ‡ç­¾ç¹ççš„å¤šï¼Œæ‰€ä»¥ImageNetåˆ†ç±»æ•°æ®é›†æ¯”VOCç­‰æ£€æµ‹æ•°æ®é›†é«˜å‡ºå‡ ä¸ªæ•°é‡çº§ã€‚åœ¨YOLOä¸­ï¼Œè¾¹ç•Œæ¡†çš„é¢„æµ‹å…¶å®å¹¶ä¸ä¾èµ–äºç‰©ä½“çš„æ ‡ç­¾ï¼Œæ‰€ä»¥YOLOå¯ä»¥å®ç°åœ¨åˆ†ç±»å’Œæ£€æµ‹æ•°æ®é›†ä¸Šçš„è”åˆè®­ç»ƒã€‚å¯¹äºæ£€æµ‹æ•°æ®é›†ï¼Œå¯ä»¥ç”¨æ¥å­¦ä¹ é¢„æµ‹ç‰©ä½“çš„è¾¹ç•Œæ¡†ã€ç½®ä¿¡åº¦ä»¥åŠä¸ºç‰©ä½“åˆ†ç±»ï¼Œè€Œå¯¹äºåˆ†ç±»æ•°æ®é›†å¯ä»¥ä»…ç”¨æ¥å­¦ä¹ åˆ†ç±»ï¼Œä½†æ˜¯å…¶å¯ä»¥å¤§å¤§æ‰©å……æ¨¡å‹æ‰€èƒ½æ£€æµ‹çš„ç‰©ä½“ç§ç±»ã€‚</p>
<p>ä½œè€…é€‰æ‹©åœ¨COCOå’ŒImageNetæ•°æ®é›†ä¸Šè¿›è¡Œè”åˆè®­ç»ƒï¼Œä½†æ˜¯é‡åˆ°çš„ç¬¬ä¸€é—®é¢˜æ˜¯ä¸¤è€…çš„ç±»åˆ«å¹¶ä¸æ˜¯å®Œå…¨äº’æ–¥çš„ï¼Œæ¯”å¦‚â€Norfolk terrierâ€æ˜æ˜¾å±äºâ€dogâ€ï¼Œæ‰€ä»¥ä½œè€…æå‡ºäº†ä¸€ç§å±‚çº§åˆ†ç±»æ–¹æ³•ï¼ˆHierarchical classificationï¼‰ï¼Œä¸»è¦æ€è·¯æ˜¯æ ¹æ®å„ä¸ªç±»åˆ«ä¹‹é—´çš„ä»å±å…³ç³»ï¼ˆæ ¹æ®WordNetï¼‰å»ºç«‹ä¸€ç§æ ‘ç»“æ„WordTreeï¼Œç»“åˆCOCOå’ŒImageNetå»ºç«‹çš„WordTreeå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_09-22-20.jpg" alt><br>åˆ†ç±»æ—¶çš„æ¦‚ç‡è®¡ç®—å€Ÿç”¨äº†å†³ç­–æ ‘æ€æƒ³ï¼ŒæŸä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡å€¼ç­‰äº è¯¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰æ¡ä»¶æ¦‚ç‡ä¹‹ç§¯ã€‚<br>å¦‚æœæƒ³æ±‚å¾—ç‰¹å®šèŠ‚ç‚¹çš„ç»å¯¹æ¦‚ç‡ï¼Œåªéœ€è¦æ²¿ç€è·¯å¾„åšè¿ç»­ä¹˜ç§¯ã€‚ä¾‹å¦‚ å¦‚æœæƒ³çŸ¥é“ä¸€å¼ å›¾ç‰‡æ˜¯ä¸æ˜¯â€œNorfolk terrier â€éœ€è¦è®¡ç®—ï¼š</p>
<p>$\operatorname{Pr}(\text { Norfolk terrier })=\operatorname{Pr}(\text { Norfolk terrier } | \text { terrier })$<br>*$\operatorname{Pr}(\text { terrier } | \text { hunting dog })$</p>
<p><em>. . . </em></p>
<p><em>$\operatorname{Pr}(\text { mammal } |\text { animal })$
  </em>$\operatorname{Pr}(\text { animal } | \text { physical object })$<br>softmaxæ“ä½œä¹ŸåŒæ—¶åº”è¯¥é‡‡ç”¨åˆ†ç»„æ“ä½œï¼ŒåŸºäºæ‰€æœ‰â€œåŒä¹‰è¯é›†â€è®¡ç®—softmaxï¼Œå…¶ä¸­â€œåŒä¹‰è¯é›†â€æ˜¯åŒä¸€æ¦‚å¿µçš„ä¸‹ä½è¯ã€‚</p>
</li>
</ul>
<h3 id="YOLO-v3"><a href="#YOLO-v3" class="headerlink" title="YOLO v3"></a>YOLO v3</h3><p>Redmon, J. and A. Farhadi, YOLOv3: An Incremental Improvement. 2018.</p>
<ul>
<li><p><strong>æ–°çš„ç½‘ç»œç»“æ„Darknet-53</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-e65c08c61bfaa7c7.png" alt></p>
<p>å€Ÿé‰´äº†æ®‹å·®ç½‘ç»œresidual networkçš„åšæ³•ï¼Œåœ¨ä¸€äº›å±‚ä¹‹é—´è®¾ç½®äº†å¿«æ·é“¾è·¯ï¼ˆshortcut connectionsï¼‰ã€‚æ¯ä¸ªæ®‹å·®ç»„ ä»¶æœ‰ä¸¤ä¸ªå·ç§¯å±‚å’Œä¸€ä¸ªå¿«æ·é“¾è·¯ã€‚</p>
</li>
<li><p><strong>åˆ©ç”¨å¤šå°ºåº¦ç‰¹å¾è¿›è¡Œå¯¹è±¡æ£€æµ‹</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-bc5def91d05e4d3a.png" alt><br>YOLO2æ›¾é‡‡ç”¨passthroughç»“æ„æ¥æ£€æµ‹ç»†ç²’åº¦ç‰¹å¾ï¼Œåœ¨YOLO3æ›´è¿›ä¸€æ­¥é‡‡ç”¨äº†3ä¸ªä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾æ¥è¿›è¡Œå¯¹è±¡æ£€æµ‹ã€‚</p>
<p>ç»“åˆä¸Šå›¾çœ‹ï¼Œå·ç§¯ç½‘ç»œåœ¨79å±‚åï¼Œç»è¿‡ä¸‹æ–¹å‡ ä¸ªé»„è‰²çš„å·ç§¯å±‚å¾—åˆ°ä¸€ç§å°ºåº¦çš„æ£€æµ‹ç»“æœã€‚ç›¸æ¯”è¾“å…¥å›¾åƒï¼Œè¿™é‡Œç”¨äºæ£€æµ‹çš„ç‰¹å¾å›¾æœ‰32å€çš„ä¸‹é‡‡æ ·ã€‚æ¯”å¦‚è¾“å…¥æ˜¯416x416çš„è¯ï¼Œè¿™é‡Œçš„ç‰¹å¾å›¾å°±æ˜¯13x13äº†ã€‚ç”±äºä¸‹é‡‡æ ·å€æ•°é«˜ï¼Œè¿™é‡Œç‰¹å¾å›¾çš„æ„Ÿå—é‡æ¯”è¾ƒå¤§ï¼Œå› æ­¤é€‚åˆæ£€æµ‹å›¾åƒä¸­å°ºå¯¸æ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚</p>
<p>ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æ£€æµ‹ï¼Œç¬¬79å±‚çš„ç‰¹å¾å›¾åˆå¼€å§‹ä½œä¸Šé‡‡æ ·ï¼ˆä»79å±‚å¾€å³å¼€å§‹ä¸Šé‡‡æ ·å·ç§¯ï¼‰ï¼Œç„¶åä¸ç¬¬61å±‚ç‰¹å¾å›¾èåˆï¼ˆConcatenationï¼‰ï¼Œè¿™æ ·å¾—åˆ°ç¬¬91å±‚è¾ƒç»†ç²’åº¦çš„ç‰¹å¾å›¾ï¼ŒåŒæ ·ç»è¿‡å‡ ä¸ªå·ç§¯å±‚åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ16å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒå…·æœ‰ä¸­ç­‰å°ºåº¦çš„æ„Ÿå—é‡ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å°ºåº¦çš„å¯¹è±¡ã€‚</p>
<p>æœ€åï¼Œç¬¬91å±‚ç‰¹å¾å›¾å†æ¬¡ä¸Šé‡‡æ ·ï¼Œå¹¶ä¸ç¬¬36å±‚ç‰¹å¾å›¾èåˆï¼ˆConcatenationï¼‰ï¼Œæœ€åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ8å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒçš„æ„Ÿå—é‡æœ€å°ï¼Œé€‚åˆæ£€æµ‹å°å°ºå¯¸çš„å¯¹è±¡ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-9b28d0f1c682b80a.png" alt></p>
<p>å¯¹äºä¸€ä¸ª416x416çš„è¾“å…¥å›¾åƒï¼Œåœ¨æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾çš„æ¯ä¸ªç½‘æ ¼è®¾ç½®3ä¸ªå…ˆéªŒæ¡†ï¼Œæ€»å…±æœ‰ 13x13x3 + 26x26x3 + 52x52x3 = 10647 ä¸ªé¢„æµ‹ã€‚æ¯ä¸€ä¸ªé¢„æµ‹æ˜¯ä¸€ä¸ª(4+1+80)=85ç»´å‘é‡ï¼Œè¿™ä¸ª85ç»´å‘é‡åŒ…å«è¾¹æ¡†åæ ‡ï¼ˆ4ä¸ªæ•°å€¼ï¼‰ï¼Œè¾¹æ¡†ç½®ä¿¡åº¦ï¼ˆ1ä¸ªæ•°å€¼ï¼‰ï¼Œå¯¹è±¡ç±»åˆ«çš„æ¦‚ç‡ï¼ˆå¯¹äºCOCOæ•°æ®é›†ï¼Œæœ‰80ç§å¯¹è±¡ï¼‰ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹ï¼ŒYOLO2é‡‡ç”¨13x13x5 = 845ä¸ªé¢„æµ‹ï¼ŒYOLO3çš„å°è¯•é¢„æµ‹è¾¹æ¡†æ•°é‡å¢åŠ äº†10å¤šå€ï¼Œè€Œä¸”æ˜¯åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸Šè¿›è¡Œï¼Œæ‰€ä»¥mAPä»¥åŠå¯¹å°ç‰©ä½“çš„æ£€æµ‹æ•ˆæœæœ‰ä¸€å®šçš„æå‡ã€‚</p>
</li>
<li><p><strong>9ç§å°ºåº¦çš„å…ˆéªŒæ¡†</strong><br>éšç€è¾“å‡ºçš„ç‰¹å¾å›¾çš„æ•°é‡å’Œå°ºåº¦çš„å˜åŒ–ï¼Œå…ˆéªŒæ¡†çš„å°ºå¯¸ä¹Ÿéœ€è¦ç›¸åº”çš„è°ƒæ•´ã€‚YOLO2å·²ç»å¼€å§‹é‡‡ç”¨K-meansèšç±»å¾—åˆ°å…ˆéªŒæ¡†çš„å°ºå¯¸ï¼ŒYOLO3å»¶ç»­äº†è¿™ç§æ–¹æ³•ï¼Œä¸ºæ¯ç§ä¸‹é‡‡æ ·å°ºåº¦è®¾å®š3ç§å…ˆéªŒæ¡†ï¼Œæ€»å…±èšç±»å‡º9ç§å°ºå¯¸çš„å…ˆéªŒæ¡†ã€‚åœ¨COCOæ•°æ®é›†è¿™9ä¸ªå…ˆéªŒæ¡†æ˜¯ï¼š(10x13)ï¼Œ(16x30)ï¼Œ(33x23)ï¼Œ(30x61)ï¼Œ(62x45)ï¼Œ(59x119)ï¼Œ(116x90)ï¼Œ(156x198)ï¼Œ(373x326)ã€‚</p>
<p>åˆ†é…ä¸Šï¼Œåœ¨æœ€å°çš„13x13ç‰¹å¾å›¾ä¸Šï¼ˆæœ‰æœ€å¤§çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå¤§çš„å…ˆéªŒæ¡†(116x90)ï¼Œ(156x198)ï¼Œ(373x326)ï¼Œé€‚åˆæ£€æµ‹è¾ƒå¤§çš„å¯¹è±¡ã€‚ä¸­ç­‰çš„26x26ç‰¹å¾å›¾ä¸Šï¼ˆä¸­ç­‰æ„Ÿå—é‡ï¼‰åº”ç”¨ä¸­ç­‰çš„å…ˆéªŒæ¡†(30x61)ï¼Œ(62x45)ï¼Œ(59x119)ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å¤§å°çš„å¯¹è±¡ã€‚è¾ƒå¤§çš„52x52ç‰¹å¾å›¾ä¸Šï¼ˆè¾ƒå°çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå°çš„å…ˆéªŒæ¡†(10x13)ï¼Œ(16x30)ï¼Œ(33x23)ï¼Œé€‚åˆæ£€æµ‹è¾ƒå°çš„å¯¹è±¡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-5cc00a60004e0473.png" alt></p>
</li>
<li><p><strong>å¯¹è±¡åˆ†ç±»softmaxæ”¹æˆlogistic</strong><br>YOLOv3 ä¸ä½¿ç”¨ Softmax å¯¹æ¯ä¸ªæ¡†è¿›è¡Œåˆ†ç±»ï¼Œä¸»è¦è€ƒè™‘å› ç´ æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>Softmax ä½¿å¾—æ¯ä¸ªæ¡†åˆ†é…ä¸€ä¸ªç±»åˆ«ï¼ˆå¾—åˆ†æœ€é«˜çš„ä¸€ä¸ªï¼‰ï¼Œè€Œå¯¹äº Open Imagesè¿™ç§æ•°æ®é›†ï¼Œç›®æ ‡å¯èƒ½æœ‰é‡å çš„ç±»åˆ«æ ‡ç­¾ï¼Œå› æ­¤ Softmaxä¸é€‚ç”¨äºå¤šæ ‡ç­¾åˆ†ç±»ã€‚</li>
<li>Softmax å¯è¢«ç‹¬ç«‹çš„å¤šä¸ª logistic åˆ†ç±»å™¨æ›¿ä»£ï¼Œä¸”å‡†ç¡®ç‡ä¸ä¼šä¸‹é™ã€‚<br>æ‰€ä»¥é¢„æµ‹å¯¹è±¡ç±»åˆ«æ—¶ä¸ä½¿ç”¨softmaxï¼Œæ”¹æˆä½¿ç”¨logisticçš„è¾“å‡ºè¿›è¡Œé¢„æµ‹ã€‚è¿™æ ·èƒ½å¤Ÿæ”¯æŒå¤šæ ‡ç­¾å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<h3 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h3><p>Liu, W., et al., SSD: Single Shot MultiBox Detector. (ECCV 2016)</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_14-51-11.jpg" alt></p>
<p><strong>åˆ›æ–°ç‚¹</strong></p>
<ul>
<li><p><strong>åœ¨å¤šå±‚å¤šå°ºåº¦ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ£€æµ‹</strong></p>
<p>ä½å±‚ç‰¹å¾å›¾å…·æœ‰ç»†èŠ‚ä¿¡æ¯ï¼Œçœ‹å¾—æ¯”è¾ƒç»†ï¼Œè€Œé«˜å±‚ç‰¹å¾å›¾ä¸­å…·æœ‰é«˜çº§è¯­ä¹‰ä¿¡æ¯ï¼Œçœ‹å¾—æ¯”è¾ƒå¹¿ï¼ŒSSDæå‡ºåŒæ—¶åˆ©ç”¨ä½å±‚ç‰¹å¾å›¾å’Œé«˜å±‚ç‰¹å¾å›¾è¿›è¡Œæ£€æµ‹ã€‚SSDä¸ºäº†é¿å…åˆ©ç”¨å¤ªä½å±‚çš„ç‰¹å¾ï¼Œä»VGGåé¢å¼€å§‹ï¼Œåˆå¾€åæ·»åŠ äº†4å±‚å·ç§¯å±‚ï¼Œå¦‚æ­¤å°±å¾—åˆ°äº†å¤šå±‚æ¬¡çš„ç‰¹å¾å›¾ã€‚è¿™6å±‚ç‰¹å¾å›¾çš„å¤§å°åˆ†åˆ«ä¸ºï¼š38x38, 19x19, 10x10, 5x5, 3x3, 1x1</p>
</li>
<li><p><strong>default boxes</strong></p>
<p>two-stage æ–¹æ³•å¤ªæ…¢ï¼Œè®¡ç®—ä»£ä»·å¤§ã€‚SSDä¸­é¿å…ä½¿ç”¨region proposals,è€Œé‡‡ç”¨default boxesã€‚SSDå€Ÿé‰´RPNç½‘ç»œä¸­çš„anchor boxæ¦‚å¿µã€‚é¦–å…ˆå°†feature mapåˆ’åˆ†ä¸ºå°æ ¼å­å«åšfeature map cellï¼Œå†åœ¨æ¯ä¸ªcellä¸­è®¾ç½®ä¸€ç³»åˆ—ä¸åŒé•¿å®½æ¯”çš„default boxã€‚å°†å…¶åº”ç”¨äºä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸­ã€‚åœ¨å¤šä¸ªç‰¹å¾å›¾ä¸­ä½¿ç”¨ä¸åŒçš„é»˜è®¤æ¡†å½¢çŠ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç¦»æ•£å¯èƒ½çš„è¾“å‡ºæ¡†å½¢çŠ¶ç©ºé—´ã€‚</p>
</li>
<li><p><strong>ç”¨å·ç§¯å±‚æ¥é¢„</strong><br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2148039-cec47c5d71ce8f22.png" alt>3x3çš„å·ç§¯åœ¨ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ“ä½œï¼Œåœ¨ç‰¹å¾å›¾çš„æ¯ä¸ªç‚¹æå–ç‰¹å¾ï¼Œç„¶åå¯¹æ¯ä¸ªdefault boxç”Ÿæˆå››ä¸ªåç§»é‡æ¥è¡¨ç¤ºç”Ÿæˆçš„bounding boxï¼Œè¿™å››ä¸ªåç§»é‡åˆ†åˆ«è¡¨ç¤ºç”Ÿæˆæ¡†ä¸­å¿ƒxåæ ‡ã€yåæ ‡ã€å®½åº¦ã€é«˜åº¦å¯¹åº”äºå½“å‰default boxçš„åç§»é‡ï¼Œè¿™é‡Œçš„è®¡ç®—æ–¹æ³•é‡‡ç”¨äº†RPNä¸­çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œé’ˆå¯¹æ¯ä¸ªbounding box, å·ç§¯ä¼šè¿›è¡Œåˆ†ç±»æ“ä½œï¼Œè¾“å‡ºCä¸ªåˆ†ç±»æ•°å€¼ï¼Œæ³¨æ„è¿™é‡Œçš„CåŒ…æ‹¬èƒŒæ™¯ç±»ã€‚å› æ­¤å¯¹äºæ¯ä¸ªdefault boxæœ‰C+4ä¸ªè¾“å‡ºå€¼ï¼Œè€ŒKä¸ªdefault boxå°±æœ‰K(C+4)ä¸ªè¾“å‡ºå€¼ï¼Œå› æ­¤ï¼Œæ€»å…±éœ€è¦K*(C+4)ä¸ª3x3å·ç§¯ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯é‡‡ç”¨default boxçš„æ–¹å¼ï¼Œåœ¨å¤šå±‚å¤šå°ºåº¦çš„ç‰¹å¾å›¾ä¸Šä½¿ç”¨å·ç§¯è¿›è¡Œæ£€æµ‹ï¼ˆåˆ†ç±»+å›å½’ï¼‰ã€‚</p>
</li>
<li><p><strong>æ•°æ®å¢å¹¿</strong><br>ä¸ºäº†ä½¿å¾—æ¨¡å‹å¯¹äºä¸åŒå¤§å°ã€ä¸åŒå½¢çŠ¶çš„ç‰©ä½“å…·æœ‰é²æ£’æ€§ï¼Œå› æ­¤é‡‡ç”¨äº†data augmentationã€‚è¿™ç¯‡è®ºæ–‡åœ¨è®­ç»ƒæ—¶ï¼Œé¦–å…ˆå¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œrandom cropï¼Œç„¶åå°†å…¶resizeçš„åŸå›¾å°ºåº¦ï¼Œç„¶åä»¥0.5çš„æ¦‚ç‡è¿›è¡Œæ°´å¹³ç¿»è½¬ã€åŒæ—¶æ·»åŠ ä¸€äº›è‰²å½©å˜æ¢ã€‚</p>
</li>
<li><p><strong>åŠ å…¥atrous</strong><br>å°† VGG ä¸­çš„ FC6 layerã€FC7 layer è½¬æˆä¸º å·ç§¯å±‚ï¼Œå¹¶ä»æ¨¡å‹çš„ FC6ã€FC7 ä¸Šçš„å‚æ•°ï¼Œè¿›è¡Œé‡‡æ ·å¾—åˆ°è¿™ä¸¤ä¸ªå·ç§¯å±‚çš„ parametersã€‚è¿˜å°† Pool5 layer çš„å‚æ•°ï¼Œä»2Ã—2âˆ’s2è½¬å˜æˆ 3Ã—3âˆ’s4ï¼Œå¤–åŠ ä¸€ä¸ª padï¼ˆ1ï¼‰ï¼ˆçŒœæƒ³æ˜¯ä¸æƒ³reduceç‰¹å¾å›¾å¤§å°ï¼‰ï¼Œä¸ºäº†é…åˆè¿™ç§å˜åŒ–ï¼Œé‡‡ç”¨äº†ä¸€ç§Atrous Algorithmï¼Œå…¶å®å°±æ˜¯conv6é‡‡ç”¨æ‰©å±•å·ç§¯æˆ–å¸¦å­”å·ç§¯ï¼ˆDilation Convï¼‰ï¼Œå…¶åœ¨ä¸å¢åŠ å‚æ•°ä¸æ¨¡å‹å¤æ‚åº¦çš„æ¡ä»¶ä¸‹æŒ‡æ•°çº§æ‰©å¤§å·ç§¯çš„è§†é‡ï¼Œå…¶ä½¿ç”¨æ‰©å¼ ç‡(dilation rate)å‚æ•°ï¼Œæ¥è¡¨ç¤ºæ‰©å¼ çš„å¤§å°ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_15-32-00.jpg" alt><br>å¸¦å­”å·ç§¯å¹¶ä¸æ˜¯å·ç§¯æ ¸é‡Œå¸¦å­”ï¼Œè€Œæ˜¯åœ¨å·ç§¯çš„æ—¶å€™ï¼Œè·³ç€çš„å»å·ç§¯mapï¼ˆæ¯”å¦‚dilatedï¼2çš„å­”å·ç§¯ï¼Œå°±æ˜¯éš”ä¸€ä¸ªåƒç´ ç‚¹ï¼Œâ€œå·â€ä¸€ä¸‹ï¼Œè¿™å°±ç›¸å½“äºæŠŠå·ç§¯æ ¸ç»™æ”¾å¤§äº†ï¼ˆ3x3çš„æ ¸å˜æˆ7x7çš„æ ¸ï¼Œå¤šå‡ºä½ç½®çš„weightsç»™0å°±æ˜¯ã€‚ï¼‰è¿™æ ·å°±ä½¿å¾—3x3çš„å·ç§¯æ ¸ä¹Ÿèƒ½è¾¾åˆ°7x7å·ç§¯æ ¸çš„æ„Ÿå—é‡</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2018051716490729.png" alt></p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong><br>SSDå­˜åœ¨çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>éœ€è¦æ‰‹åŠ¨è®¾ç½®å‚æ•°prior boxï¼Œæ— æ³•é€šè¿‡è®­ç»ƒå¾—åˆ°ï¼Œä¾èµ–ç»éªŒã€‚</li>
<li>å­˜åœ¨ç€å¯¹å°ç›®æ ‡æ£€æµ‹æ•ˆæœä¸å¥½çš„ç°è±¡ã€‚</li>
</ul>
<h3 id="DSSD"><a href="#DSSD" class="headerlink" title="DSSD"></a>DSSD</h3><p>Fu, C., et al., DSSD : Deconvolutional Single Shot Detector. (CVPR 2017)</p>
<p>DSSDé’ˆå¯¹å°ç›®æ ‡é²æ£’æ€§å¤ªå·®ï¼Œæå‡ºäº†ä»¥ä¸‹ä¸¤ä¸ªè´¡çŒ®ï¼š</p>
<ul>
<li>æŠŠSSDçš„åŸºå‡†ç½‘ç»œä»VGGæ¢æˆäº†Resnet-101ï¼Œå¢å¼ºäº†ç‰¹å¾æå–èƒ½åŠ›ï¼›</li>
<li>ä½¿ç”¨åå·ç§¯å±‚ï¼ˆdeconvolution layer ï¼‰å¢åŠ äº†å¤§é‡ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-00-32.jpg" alt></p>
<p>æ¢å®Œbase networkä¹‹åï¼Œä½œè€…é€šè¿‡å®éªŒå‘ç°ï¼Œå‡†ç¡®ç‡ä»77.5%é™è‡³äº†76.4%ï¼Œè¯´æ˜åªæ¢ç½‘ç»œå¹¶ä¸èƒ½å¤Ÿæé«˜å‡†ç¡®ç‡ã€‚å¦‚æœèƒ½å¤Ÿæé«˜æ¯ä¸€ä¸ªå­ç½‘ç»œçš„å‡†ç¡®ç‡ï¼Œé‚£æ•´ä¸ªç½‘ç»œçš„å‡†ç¡®ç‡ä¹Ÿä¼šå¾—åˆ°æå‡ã€‚æ‰€ä»¥ä½œè€…åœ¨æ¯æ¬¡é¢„æµ‹ä¹‹å‰åŠ å…¥äº†ä¸€ä¸ªâ€œé¢„æµ‹æ¨¡å—â€ï¼ˆprediction moduleï¼‰ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-11-49.jpg" alt><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š<br>(a)ä¸ºåŸSSDå¯¹äºç‰¹å¾ä¿¡æ¯è¿›è¡Œåˆ†ç±»ä¸å®šä½çš„æ¨¡å‹ï¼Œå…¶å®å¹¶æ²¡æœ‰é¢„æµ‹æ¨¡å—ï¼Œç›´æ¥è¿›è¡Œé¢„æµ‹ï¼›<br>(b)ä¸ºä½œè€…åœ¨é¢„æµ‹ä¹‹å‰åŠ å…¥äº†residual blockæ¨¡å—ï¼›<br>(c)å°†residual blockæ¨¡å—ä¸­ç›´æ¥æ˜ å°„identity mappingæ¢æˆäº†1x1å·ç§¯<br>(d)å †ç§¯residual blockæ¨¡å—</p>
<p>ç»è¿‡å®éªŒè¯æ˜ï¼Œï¼ˆcï¼‰èƒ½å¤Ÿè·å¾—æ›´å¥½çš„å‡†ç¡®ç‡ã€‚</p>
<p>ç¬¬äºŒä¸ªè´¡çŒ®å°±æ˜¯æ·»åŠ äº†åå·ç§¯æ¨¡å—ï¼Œå¼•å…¥äº†ç©ºé—´ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œå¤§å¤§æé«˜äº†æ£€æµ‹å‡†ç¡®ç‡ã€‚æ·»åŠ äº†åå·ç§¯ä¹‹åï¼Œæ•´ä¸ªç½‘ç»œå½¢æˆä¸å¯¹ç§°çš„æ²™æ¼ç»“æ„ã€‚</p>
<p>è“è‰²å—ä¸ºå·ç§¯å±‚ï¼Œçº¢è‰²å—ä¸ºåå·ç§¯å±‚ã€‚çº¢è‰²å—åšåå·ç§¯æ“ä½œï¼Œç„¶åä¸åŒå¤§å°çš„å·ç§¯å±‚èåˆï¼Œä¹‹åå†è¿›è¡Œç‰©ä½“æ£€æµ‹ã€‚å…¶ä¸­çš„â€œåå·ç§¯æ¨¡å—â€ï¼ˆDeconvolution moduleï¼‰</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-17-17.jpg" alt></p>
<p>å…¶ä¸­Eltw Productæ˜¯å…ƒç´ ç‚¹ç§¯æ“ä½œã€‚ä½œè€…ä¹Ÿå°è¯•äº†å…ƒç´ æ±‚å’Œï¼Œä½†æ˜¯ç‚¹ç§¯æ“ä½œçš„å‡†ç¡®ç‡ç¨é«˜ä¸€äº›ã€‚</p>
<h3 id="ç›®æ ‡æ£€æµ‹è¿›å±•"><a href="#ç›®æ ‡æ£€æµ‹è¿›å±•" class="headerlink" title="ç›®æ ‡æ£€æµ‹è¿›å±•"></a>ç›®æ ‡æ£€æµ‹è¿›å±•</h3><ul>
<li><p>ç”¨æ›´å¥½çš„å¼•æ“æ£€æµ‹</p>
<p>AlexNet<br>VGGï¼š 16â€”19å±‚ï¼Œä½¿ç”¨ 3Ã—3 å·ç§¯æ ¸å–ä»£ 5Ã—5 å’Œ 7Ã—7ã€‚<br>GoogLeNetï¼š å³ï¼ŒInception ç½‘ç»œå®¶æ—ï¼Œå¢åŠ å·ç§¯ç¥ç»ç½‘ç»œæ·±åº¦å’Œå®½åº¦ã€‚<br>ResNet<br>DenseNetï¼š å— short cut è¿æ¥çš„å½±å“ï¼Œä½œè€…å°†æ¯ä¸€å±‚ä»¥å‰é¦ˆçš„æ–¹å¼å’Œå…¶ä»–æ‰€æœ‰å±‚ç›¸è¿ã€‚<br>SENetï¼š ä¸»è¦è´¡çŒ®æ˜¯å°†å…¨å±€æ± åŒ–ä¸ shuffling ç»“åˆï¼Œå­¦ä¹ ç‰¹å¾å›¾é€šé“çš„é‡è¦æ€§ã€‚</p>
</li>
<li><p>ç”¨æ›´å¥½çš„ç‰¹å¾æ£€æµ‹<br>ç ”ç©¶è€…åœ¨æœ€æ–°æ£€æµ‹å¼•æ“çš„åŸºç¡€ä¸Šï¼ŒåŠªåŠ›æé«˜å›¾åƒç‰¹å¾è´¨é‡ï¼Œæœ€é‡è¦çš„ä¸¤ç»„æ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>ç‰¹å¾èåˆ<br>-è‡ªåº•å‘ä¸Šèåˆï¼šé€šè¿‡è·³è·ƒè¿æ¥å°†æµ…å±‚ç‰¹å¾ä¼ é€’åˆ°æ·±å±‚<br>-è‡ªé¡¶å‘ä¸‹èåˆï¼šå°†æ·±å±‚ç‰¹å¾åé¦ˆç»™æµ…å±‚<br>ç‰¹å¾èåˆå¯ä»¥è¢«çœ‹åšæ˜¯ä¸åŒç‰¹å¾å›¾é—´çš„å…ƒç´ è¿ç®—ã€‚ä¸»è¦æœ‰å‡ ç»„æ–¹æ³•ï¼š<br>å…ƒç´ æ±‚å’Œ<br>å…ƒç´ ä¹˜ç§¯<br>ä¸²è”<br>å…ƒç´ ä¹˜ç§¯çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æŠ‘åˆ¶æˆ–è€…å¼ºè°ƒæŸä¸€åŒºåŸŸå†…ç‰¹å¾ï¼Œå¯èƒ½æœ‰åˆ©äºå°ç›®æ ‡æ£€æµ‹ã€‚ç‰¹å¾ä¸²è”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ•´åˆä¸åŒåŒºåŸŸçš„ä¸Šä¸‹æ–‡ç‰¹å¾ï¼Œç¼ºç‚¹æ˜¯å¢åŠ å†…å­˜æ¶ˆè€—ã€‚</li>
<li>å­¦ä¹ å…·æœ‰å¤§æ„Ÿå—é‡çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾<br>å°æ„Ÿå—é‡æ›´å…³æ³¨å±€éƒ¨ç»†èŠ‚ã€‚ç‰¹å¾å›¾åˆ†è¾¨ç‡è¶Šå°ï¼Œè¶Šéš¾æ£€æµ‹å°ç›®æ ‡ã€‚å¢åŠ ç‰¹å¾åˆ†è¾¨ç‡æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å»é™¤æ± åŒ–å±‚ï¼Œæˆ–è€…å‡å°å·ç§¯ä¸‹é‡‡æ ·ç‡ã€‚ä½†æ˜¯è¿™æ ·åŒæ—¶ä¼šå‡å°æ„Ÿå—é‡ã€‚<br>åŒæ—¶å¢åŠ æ„Ÿå—é‡å’Œåˆ†è¾¨ç‡çš„æ–¹æ³•æ˜¯å¼•å…¥ç©ºæ´å·ç§¯ã€‚</li>
</ul>
</li>
<li>å®šä½æå‡<br>ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>è¾¹ç•Œæ¡†ç²¾ç‚¼<br>è®¾è®¡æ–°çš„æŸå¤±å‡½æ•°</li>
<li>å¯¹æ—‹è½¬å’Œå°ºåº¦å˜åŒ–é²æ£’çš„æ£€æµ‹<br>æ•°æ®å¢å¼º<br>ä¸ºä¸åŒæ–¹ä½è®­ç»ƒç‹¬ç«‹æ£€æµ‹å™¨</li>
</ul>
<h3 id="æœªæ¥çš„ç ”ç©¶"><a href="#æœªæ¥çš„ç ”ç©¶" class="headerlink" title="æœªæ¥çš„ç ”ç©¶"></a>æœªæ¥çš„ç ”ç©¶</h3><ul>
<li>è½»é‡çº§ç›®æ ‡æ£€æµ‹ï¼šåŠ é€Ÿæ£€æµ‹ç®—æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¹³ç¨³è¿è¡Œã€‚</li>
<li>æ£€æµ‹ä¸AutoMLï¼šæœªæ¥çš„ä¸€ä¸ªæ–¹å‘æ˜¯ä½¿ç”¨ç¥ç»ç»“æ„æœç´¢ï¼Œå‡å°‘è®¾è®¡æ£€æµ‹æ¨¡å‹æ—¶çš„äººä¸ºå¹²é¢„(ä¾‹å¦‚ï¼Œå¦‚ä½•è®¾è®¡å¼•æ“ï¼Œå¦‚ä½•è®¾ç½®Anchor)</li>
<li>Proposalçš„Anchorç”Ÿæˆæ–¹å¼</li>
<li>å¼±ç›‘ç£æ£€æµ‹</li>
<li>å°ç›®æ ‡æ£€æµ‹</li>
<li>è§†é¢‘ä¸­çš„æ£€æµ‹ï¼ˆå®æ—¶ï¼‰</li>
<li>ä¿¡æ¯èåˆæ£€æµ‹</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹å¸¸è§è¯„ä»·æŒ‡æ ‡(mAP)çš„è¯¦ç»†è®¡ç®—æ–¹æ³•åŠä»£ç è§£æ</title>
    <url>/2020/02/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E4%B9%8B%E5%B8%B8%E8%A7%81%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87(mAP)%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%E5%8F%8A%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p>å®šä¹‰ä¸€äº›è¯„ä»·æ ‡å‡†ï¼š</p>
<ul>
<li><p>å‡†ç¡®ç‡(Acc)ï¼šå‡†ç¡®ç‡(Acc)çš„è®¡ç®—å…¬å¼ä¸º$A c c=\frac{T P+T N}{N}$ï¼Œå³é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ¯”ä¾‹ï¼Œ$N$ä»£è¡¨æµ‹è¯•çš„æ ·æœ¬æ•°ã€‚åœ¨æ£€æµ‹ä»»åŠ¡ä¸­æ²¡æœ‰é¢„æµ‹æ­£ç¡®çš„è´Ÿæ ·æœ¬çš„æ¦‚å¿µï¼Œæ‰€ä»¥Accè‡ªç„¶ç”¨ä¸åˆ°äº†ã€‚</p>
</li>
<li><p>æŸ¥å‡†ç‡(Precision)ï¼šæŸ¥å‡†ç‡æ˜¯é’ˆå¯¹æŸä¸€ä¸ªå…·ä½“ç±»åˆ«è€Œè¨€çš„ï¼Œå…¬å¼ä¸ºï¼šPrecision $=\frac{T P}{T P+F P}=\frac{T P}{N}$ï¼Œå…¶ä¸­$N$ä»£è¡¨æ‰€æœ‰æ£€æµ‹åˆ°çš„æŸä¸ªå…·ä½“ç±»çš„ç›®æ ‡æ¡†ä¸ªæ•°ã€‚</p>
</li>
<li><p>å¬å›ç‡(Recall)ï¼šå¬å›ç‡ä»ç„¶æ˜¯é’ˆå¯¹æŸä¸€ä¸ªå…·ä½“ç±»åˆ«è€Œè¨€çš„ï¼Œå…¬å¼ä¸ºï¼šRecall$=\frac{T P}{T P+F N}$ï¼Œå³é¢„æµ‹æ­£ç¡®çš„ç›®æ ‡æ¡†å’Œæ‰€æœ‰Ground Truthæ¡†çš„æ¯”å€¼ã€‚</p>
</li>
<li><p>F1 Scoreï¼šå®šä½æŸ¥å‡†ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F_{1}=2 \times \frac{\text {Precision} * \text {Recall}}{\text {Precision}+\text {Recall}}=\frac{2 T P}{2 T P+F N+F P}</script></li>
<li><p>IOUï¼šå…ˆä¸ºè®¡ç®—mAPå€¼åšä¸€ä¸ªé“ºå«ï¼Œå³IOUé˜ˆå€¼æ˜¯å¦‚ä½•å½±å“Precisionå’ŒRecallå€¼çš„ï¼Ÿæ¯”å¦‚åœ¨PASCAL  VOCç«èµ›ä¸­é‡‡ç”¨çš„IoUé˜ˆå€¼ä¸º0.5ï¼Œè€ŒCOCOç«èµ›ä¸­åœ¨è®¡ç®—mAPè¾ƒå¤æ‚ï¼Œå…¶è®¡ç®—äº†ä¸€ç³»åˆ—IoUé˜ˆå€¼ï¼ˆ0.05è‡³0.95ï¼‰ä¸‹çš„mAPå½“æˆæœ€åçš„mAPå€¼ã€‚</p>
</li>
<li><p>mAPï¼šå…¨ç§°ä¸ºAverage Precisionï¼ŒAPå€¼æ˜¯Precision-Recallæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç›®æ ‡æ£€æµ‹ä¸­PRæ›²çº¿æ€ä¹ˆæ¥çš„ï¼Ÿå¯ä»¥åœ¨è¿™ç¯‡è®ºæ–‡æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<p><img src="https://blog-1300912400.cos.ap-shanghai.myqcloud.com/map%20code/640.webp" alt></p>
<p>æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼Œè¦å¾—åˆ°Precision-Recallæ›²çº¿(ä»¥ä¸‹ç®€ç§°PR)æ›²çº¿ï¼Œé¦–å…ˆè¦å¯¹æ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæŒ‰ç…§ç›®æ ‡ç½®ä¿¡åº¦é™åºæ’åˆ—ã€‚ç„¶åç»™å®šä¸€ä¸ª<code>rank</code>å€¼ï¼ŒRecallå’ŒPrecisionä»…åœ¨ç½®ä¿¡åº¦é«˜äºè¯¥<code>rank</code>å€¼çš„é¢„æµ‹ç»“æœä¸­è®¡ç®—ï¼Œæ”¹å˜<code>rank</code>å€¼ä¼šç›¸åº”çš„æ”¹å˜Recallå€¼å’ŒPrecisionå€¼ã€‚è¿™é‡Œé€‰æ‹©äº†11ä¸ªä¸åŒçš„<code>rank</code>å€¼ï¼Œä¹Ÿå°±å¾—åˆ°äº†11ç»„Precisionå’ŒRecallå€¼ï¼Œç„¶åAPå€¼å³å®šä¹‰ä¸ºåœ¨è¿™11ä¸ªRecallä¸‹Precisionå€¼çš„å¹³å‡å€¼ï¼Œå…¶å¯ä»¥è¡¨å¾æ•´ä¸ªPRæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ã€‚å³ï¼š</p>
<script type="math/tex; mode=display">
A P=\frac{1}{11} \sum_{r \in\{0,0.1, \ldots, 1\}} p_{i n t e r p}(r)</script><p>è¿˜æœ‰å¦å¤–ä¸€ç§æ’å€¼çš„è®¡ç®—æ–¹æ³•ï¼Œå³å¯¹äºæŸä¸ªRecallå€¼<code>r</code>ï¼ŒPrecisionå–æ‰€æœ‰Recallå€¼å¤§äº<code>r</code>ä¸­çš„æœ€å¤§å€¼ï¼Œè¿™æ ·ä¿è¯äº†PRæ›²çº¿æ˜¯å•è°ƒé€’å‡çš„ï¼Œé¿å…æ›²çº¿å‡ºç°æ‘‡æ‘†ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯åœ¨2010å¹´åè®¡ç®—APå€¼æ—¶æ˜¯å–äº†æ‰€æœ‰çš„æ•°æ®ç‚¹ï¼Œè€Œä¸ä»…ä»…åªæ˜¯11ä¸ªRecallå€¼ã€‚æˆ‘ä»¬åœ¨è®¡ç®—å‡ºAPä¹‹åï¼Œå¯¹æ‰€æœ‰ç±»åˆ«æ±‚å¹³å‡ä¹‹åå°±æ˜¯mAPå€¼äº†ï¼Œä¹Ÿæ˜¯å½“å‰ç›®æ ‡æ£€æµ‹ç”¨çš„æœ€å¤šçš„è¯„åˆ¤æ ‡å‡†ã€‚</p>
<ul>
<li>AP50ï¼ŒAP60ï¼ŒAP70ç­‰ç­‰ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿä»£è¡¨IOUé˜ˆå€¼åˆ†åˆ«å–0.5ï¼Œ0.6ï¼Œ0.7ç­‰å¯¹åº”çš„APå€¼ã€‚</li>
</ul>
<h1 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h1><p>ä¸‹é¢è§£æä¸€ä¸‹Faster-RCNNä¸­å¯¹VOCæ•°æ®é›†è®¡ç®—æ¯ä¸ªç±»åˆ«APå€¼çš„ä»£ç ï¼ŒmAPå°±æ˜¯æ‰€æœ‰ç±»çš„APå€¼å¹³å‡å€¼ã€‚ä»£ç æ¥è‡ªpy-faster-rcnné¡¹ç›®ã€‚ä»£ç è§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Fast/er R-CNN</span></span><br><span class="line"><span class="comment"># Licensed under The MIT License [see LICENSE for details]</span></span><br><span class="line"><span class="comment"># Written by Bharath Hariharan</span></span><br><span class="line"><span class="comment"># --------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET <span class="comment">#è¯»å–xmlæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> cPickle <span class="comment">#åºåˆ—åŒ–å­˜å‚¨æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_rec</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Parse a PASCAL VOC xml file &quot;&quot;&quot;</span></span><br><span class="line">    tree = ET.parse(filename)</span><br><span class="line">    objects = []</span><br><span class="line">    <span class="comment"># è§£æxmlæ–‡ä»¶ï¼Œå°†GTæ¡†ä¿¡æ¯æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> tree.findall(<span class="string">&#x27;object&#x27;</span>):</span><br><span class="line">        obj_struct = &#123;&#125;</span><br><span class="line">        obj_struct[<span class="string">&#x27;name&#x27;</span>] = obj.find(<span class="string">&#x27;name&#x27;</span>).text</span><br><span class="line">        obj_struct[<span class="string">&#x27;pose&#x27;</span>] = obj.find(<span class="string">&#x27;pose&#x27;</span>).text</span><br><span class="line">        obj_struct[<span class="string">&#x27;truncated&#x27;</span>] = <span class="built_in">int</span>(obj.find(<span class="string">&#x27;truncated&#x27;</span>).text)</span><br><span class="line">        obj_struct[<span class="string">&#x27;difficult&#x27;</span>] = <span class="built_in">int</span>(obj.find(<span class="string">&#x27;difficult&#x27;</span>).text)</span><br><span class="line">        bbox = obj.find(<span class="string">&#x27;bndbox&#x27;</span>)</span><br><span class="line">        obj_struct[<span class="string">&#x27;bbox&#x27;</span>] = [<span class="built_in">int</span>(bbox.find(<span class="string">&#x27;xmin&#x27;</span>).text),</span><br><span class="line">                              <span class="built_in">int</span>(bbox.find(<span class="string">&#x27;ymin&#x27;</span>).text),</span><br><span class="line">                              <span class="built_in">int</span>(bbox.find(<span class="string">&#x27;xmax&#x27;</span>).text),</span><br><span class="line">                              <span class="built_in">int</span>(bbox.find(<span class="string">&#x27;ymax&#x27;</span>).text)]</span><br><span class="line">        objects.append(obj_struct)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objects</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•ä¸ªè®¡ç®—APçš„å‡½æ•°ï¼Œè¾“å…¥å‚æ•°ä¸ºç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼ŒåŸç†è§ä¸Šé¢</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">voc_ap</span>(<span class="params">rec, prec, use_07_metric=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; ap = voc_ap(rec, prec, [use_07_metric])</span></span><br><span class="line"><span class="string">    Compute VOC AP given precision and recall.</span></span><br><span class="line"><span class="string">    If use_07_metric is true, uses the</span></span><br><span class="line"><span class="string">    VOC 07 11 point method (default:False).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å¦‚æœä½¿ç”¨2007å¹´çš„è®¡ç®—APçš„æ–¹å¼(æ’å€¼çš„æ–¹å¼)</span></span><br><span class="line">    <span class="keyword">if</span> use_07_metric:</span><br><span class="line">        <span class="comment"># 11 point metric</span></span><br><span class="line">        ap = <span class="number">0.</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> np.arange(<span class="number">0.</span>, <span class="number">1.1</span>, <span class="number">0.1</span>):</span><br><span class="line">            <span class="keyword">if</span> np.<span class="built_in">sum</span>(rec &gt;= t) == <span class="number">0</span>:</span><br><span class="line">                p = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p = np.<span class="built_in">max</span>(prec[rec &gt;= t])</span><br><span class="line">            ap = ap + p / <span class="number">11.</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       <span class="comment"># ä½¿ç”¨2010å¹´åçš„è®¡ç®—APå€¼çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œæ˜¯æ–°å¢ä¸€ä¸ª(0,0)ï¼Œæ–¹ä¾¿è®¡ç®—</span></span><br><span class="line">        mrec = np.concatenate(([<span class="number">0.</span>], rec, [<span class="number">1.</span>]))</span><br><span class="line">        mpre = np.concatenate(([<span class="number">0.</span>], prec, [<span class="number">0.</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># compute the precision envelope</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mpre.size - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            mpre[i - <span class="number">1</span>] = np.maximum(mpre[i - <span class="number">1</span>], mpre[i])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># to calculate area under PR curve, look for points</span></span><br><span class="line">        <span class="comment"># where X axis (recall) changes value</span></span><br><span class="line">        i = np.where(mrec[<span class="number">1</span>:] != mrec[:-<span class="number">1</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># and sum (\Delta recall) * prec</span></span><br><span class="line">        ap = np.<span class="built_in">sum</span>((mrec[i + <span class="number">1</span>] - mrec[i]) * mpre[i + <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> ap</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">voc_eval</span>(<span class="params">detpath,</span></span></span><br><span class="line"><span class="params"><span class="function">             annopath,</span></span></span><br><span class="line"><span class="params"><span class="function">             imagesetfile,</span></span></span><br><span class="line"><span class="params"><span class="function">             classname,</span></span></span><br><span class="line"><span class="params"><span class="function">             cachedir,</span></span></span><br><span class="line"><span class="params"><span class="function">             ovthresh=<span class="number">0.5</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">             use_07_metric=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;rec, prec, ap = voc_eval(detpath,</span></span><br><span class="line"><span class="string">                                annopath,</span></span><br><span class="line"><span class="string">                                imagesetfile,</span></span><br><span class="line"><span class="string">                                classname,</span></span><br><span class="line"><span class="string">                                [ovthresh],</span></span><br><span class="line"><span class="string">                                [use_07_metric])</span></span><br><span class="line"><span class="string">    Top level function that does the PASCAL VOC evaluation.</span></span><br><span class="line"><span class="string">    detpath: äº§ç”Ÿçš„txtæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯ä¸€å¼ å›¾ç‰‡çš„å„ä¸ªæ£€æµ‹æ¡†ç»“æœã€‚</span></span><br><span class="line"><span class="string">    annopath: xml æ–‡ä»¶ä¸å¯¹åº”çš„å›¾åƒç›¸å‘¼åº”ã€‚</span></span><br><span class="line"><span class="string">    imagesetfile: ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æ¯ä¸ªå›¾ç‰‡çš„åœ°å€ï¼Œæ¯è¡Œä¸€ä¸ªåœ°å€ã€‚</span></span><br><span class="line"><span class="string">    classname: ç§ç±»çš„åå­—ï¼Œå³ç±»åˆ«ã€‚</span></span><br><span class="line"><span class="string">    cachedir: ç¼“å­˜æ ‡æ³¨çš„ç›®å½•ã€‚</span></span><br><span class="line"><span class="string">    [ovthresh]: IOUé˜ˆå€¼ï¼Œé»˜è®¤ä¸º0.5ï¼Œå³mAP50ã€‚</span></span><br><span class="line"><span class="string">    [use_07_metric]: æ˜¯å¦ä½¿ç”¨2007çš„è®¡ç®—APçš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºFasle</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># assumes detections are in detpath.format(classname)</span></span><br><span class="line">    <span class="comment"># assumes annotations are in annopath.format(imagename)</span></span><br><span class="line">    <span class="comment"># assumes imagesetfile is a text file with each line an image name</span></span><br><span class="line">    <span class="comment"># cachedir caches the annotations in a pickle file</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é¦–å…ˆåŠ è½½Ground Truthæ ‡æ³¨ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(cachedir):</span><br><span class="line">        os.mkdir(cachedir)</span><br><span class="line">    <span class="comment"># å³å°†æ–°å»ºæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">    cachefile = os.path.join(cachedir, <span class="string">&#x27;annots.pkl&#x27;</span>)</span><br><span class="line">    <span class="comment"># è¯»å–æ–‡æœ¬é‡Œçš„æ‰€æœ‰å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(imagesetfile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">    <span class="comment"># è·å–æ–‡ä»¶åï¼Œstripç”¨æ¥å»é™¤å¤´å°¾å­—ç¬¦ã€ç©ºç™½ç¬¦(åŒ…æ‹¬\nã€\rã€\tã€&#x27; &#x27;ï¼Œå³ï¼šæ¢è¡Œã€å›è½¦ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼)</span></span><br><span class="line">    imagenames = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> lines]</span><br><span class="line">    <span class="comment">#å¦‚æœcachefileæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(cachefile):</span><br><span class="line">        <span class="comment"># load annots</span></span><br><span class="line">        recs = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i, imagename <span class="keyword">in</span> <span class="built_in">enumerate</span>(imagenames):</span><br><span class="line">            <span class="comment">#annopath.format(imagename): labelçš„xmlæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„</span></span><br><span class="line">            recs[imagename] = parse_rec(annopath.<span class="built_in">format</span>(imagename))</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Reading annotation for &#123;:d&#125;/&#123;:d&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    i + <span class="number">1</span>, <span class="built_in">len</span>(imagenames))</span><br><span class="line">        <span class="comment"># save</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Saving cached annotations to &#123;:s&#125;&#x27;</span>.<span class="built_in">format</span>(cachefile)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(cachefile, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment">#å†™å…¥cPickleæ–‡ä»¶é‡Œé¢ã€‚å†™å…¥çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå·¦ä¾§ä¸ºxmlæ–‡ä»¶åï¼Œå³ä¾§ä¸ºæ–‡ä»¶é‡Œé¢ä¸ªå„ä¸ªå‚æ•°ã€‚</span></span><br><span class="line">            cPickle.dump(recs, f)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># load</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(cachefile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            recs = cPickle.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹æ¯å¼ å›¾ç‰‡çš„xmlè·å–å‡½æ•°æŒ‡å®šç±»çš„bboxç­‰</span></span><br><span class="line">    class_recs = &#123;&#125;<span class="comment"># ä¿å­˜çš„æ˜¯ Ground Truthçš„æ•°æ®</span></span><br><span class="line">    npos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> imagename <span class="keyword">in</span> imagenames:</span><br><span class="line">        <span class="comment"># è·å–Ground Truthæ¯ä¸ªæ–‡ä»¶ä¸­æŸç§ç±»åˆ«çš„ç‰©ä½“</span></span><br><span class="line">        R = [obj <span class="keyword">for</span> obj <span class="keyword">in</span> recs[imagename] <span class="keyword">if</span> obj[<span class="string">&#x27;name&#x27;</span>] == classname]</span><br><span class="line">        bbox = np.array([x[<span class="string">&#x27;bbox&#x27;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> R])</span><br><span class="line">        <span class="comment">#  differentåŸºæœ¬éƒ½ä¸º0/False</span></span><br><span class="line">        difficult = np.array([x[<span class="string">&#x27;difficult&#x27;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> R]).astype(np.<span class="built_in">bool</span>)</span><br><span class="line">        det = [<span class="literal">False</span>] * <span class="built_in">len</span>(R)</span><br><span class="line">        npos = npos + <span class="built_in">sum</span>(~difficult) <span class="comment">#è‡ªå¢ï¼Œ~difficultå–å,ç»Ÿè®¡æ ·æœ¬ä¸ªæ•°</span></span><br><span class="line">        <span class="comment"># # è®°å½•Ground Truthçš„å†…å®¹</span></span><br><span class="line">        class_recs[imagename] = &#123;<span class="string">&#x27;bbox&#x27;</span>: bbox,</span><br><span class="line">                                 <span class="string">&#x27;difficult&#x27;</span>: difficult,</span><br><span class="line">                                 <span class="string">&#x27;det&#x27;</span>: det&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># read dets è¯»å–æŸç±»åˆ«é¢„æµ‹è¾“å‡º</span></span><br><span class="line">    detfile = detpath.<span class="built_in">format</span>(classname)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(detfile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readlines()</span><br><span class="line"></span><br><span class="line">    splitlines = [x.strip().split(<span class="string">&#x27; &#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> lines]</span><br><span class="line">    image_ids = [x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> splitlines] <span class="comment"># å›¾ç‰‡ID</span></span><br><span class="line">    confidence = np.array([<span class="built_in">float</span>(x[<span class="number">1</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> splitlines]) <span class="comment"># IOUå€¼</span></span><br><span class="line">    BB = np.array([[<span class="built_in">float</span>(z) <span class="keyword">for</span> z <span class="keyword">in</span> x[<span class="number">2</span>:]] <span class="keyword">for</span> x <span class="keyword">in</span> splitlines]) <span class="comment"># bounding boxæ•°å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹confidenceçš„indexæ ¹æ®å€¼å¤§å°è¿›è¡Œé™åºæ’åˆ—ã€‚</span></span><br><span class="line">    sorted_ind = np.argsort(-confidence)</span><br><span class="line">    sorted_scores = np.sort(-confidence)</span><br><span class="line">    <span class="comment">#é‡æ’bboxï¼Œç”±å¤§æ¦‚ç‡åˆ°å°æ¦‚ç‡ã€‚</span></span><br><span class="line">    BB = BB[sorted_ind, :]</span><br><span class="line">    <span class="comment"># å›¾ç‰‡é‡æ’ï¼Œç”±å¤§æ¦‚ç‡åˆ°å°æ¦‚ç‡ã€‚</span></span><br><span class="line">    image_ids = [image_ids[x] <span class="keyword">for</span> x <span class="keyword">in</span> sorted_ind]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># go down dets and mark TPs and FPs</span></span><br><span class="line">    nd = <span class="built_in">len</span>(image_ids)</span><br><span class="line">    tp = np.zeros(nd)</span><br><span class="line">    fp = np.zeros(nd)</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(nd):</span><br><span class="line">        R = class_recs[image_ids[d]]</span><br><span class="line">        bb = BB[d, :].astype(<span class="built_in">float</span>)</span><br><span class="line">        ovmax = -np.inf</span><br><span class="line">        BBGT = R[<span class="string">&#x27;bbox&#x27;</span>].astype(<span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> BBGT.size &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># compute overlaps</span></span><br><span class="line">            <span class="comment"># intersection</span></span><br><span class="line">            ixmin = np.maximum(BBGT[:, <span class="number">0</span>], bb[<span class="number">0</span>])</span><br><span class="line">            iymin = np.maximum(BBGT[:, <span class="number">1</span>], bb[<span class="number">1</span>])</span><br><span class="line">            ixmax = np.minimum(BBGT[:, <span class="number">2</span>], bb[<span class="number">2</span>])</span><br><span class="line">            iymax = np.minimum(BBGT[:, <span class="number">3</span>], bb[<span class="number">3</span>])</span><br><span class="line">            iw = np.maximum(ixmax - ixmin + <span class="number">1.</span>, <span class="number">0.</span>)</span><br><span class="line">            ih = np.maximum(iymax - iymin + <span class="number">1.</span>, <span class="number">0.</span>)</span><br><span class="line">            inters = iw * ih</span><br><span class="line"></span><br><span class="line">            <span class="comment"># union</span></span><br><span class="line">            uni = ((bb[<span class="number">2</span>] - bb[<span class="number">0</span>] + <span class="number">1.</span>) * (bb[<span class="number">3</span>] - bb[<span class="number">1</span>] + <span class="number">1.</span>) +</span><br><span class="line">                   (BBGT[:, <span class="number">2</span>] - BBGT[:, <span class="number">0</span>] + <span class="number">1.</span>) *</span><br><span class="line">                   (BBGT[:, <span class="number">3</span>] - BBGT[:, <span class="number">1</span>] + <span class="number">1.</span>) - inters)</span><br><span class="line"></span><br><span class="line">            overlaps = inters / uni</span><br><span class="line">            ovmax = np.<span class="built_in">max</span>(overlaps)</span><br><span class="line">            jmax = np.argmax(overlaps)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ovmax &gt; ovthresh:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> R[<span class="string">&#x27;difficult&#x27;</span>][jmax]:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> R[<span class="string">&#x27;det&#x27;</span>][jmax]:</span><br><span class="line">                    tp[d] = <span class="number">1.</span></span><br><span class="line">                    R[<span class="string">&#x27;det&#x27;</span>][jmax] = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    fp[d] = <span class="number">1.</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fp[d] = <span class="number">1.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># compute precision recall</span></span><br><span class="line">    fp = np.cumsum(fp)</span><br><span class="line">    tp = np.cumsum(tp)</span><br><span class="line">    rec = tp / <span class="built_in">float</span>(npos)</span><br><span class="line">    <span class="comment"># avoid divide by zero in case the first detection matches a difficult</span></span><br><span class="line">    <span class="comment"># ground truth</span></span><br><span class="line">    prec = tp / np.maximum(tp + fp, np.finfo(np.float64).eps)</span><br><span class="line">    ap = voc_ap(rec, prec, use_07_metric)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rec, prec, ap</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè„šæœ¬å¯ä»¥ç›´æ¥è°ƒç”¨æ¥è®¡ç®—mAPå€¼ï¼Œå…·ä½“ä¾‹å­å¯ä»¥çœ‹è¿™ä¸ªï¼š<a href="https://blog.csdn.net/amusi1994/article/details/81564504">åœ¨Darknetä¸­è°ƒç”¨ä¸Šé¢çš„è„šæœ¬æ¥è®¡ç®—mAPå€¼</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹ç®—æ³•ä¼˜åŒ–æŠ€å·§</title>
    <url>/2020/04/08/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ç›®æ ‡æ£€æµ‹æ¨¡å‹ç›¸æ¯”äºåˆ†ç±»æ¨¡å‹çš„ç ”ç©¶ç›¸æ¯”ï¼Œæ›´ç¼ºå°‘æ™®éæ€§ï¼Œå¹¶ä¸”ç½‘ç»œç»“æ„å’Œä¼˜åŒ–ç›®æ ‡æ›´åŠ å¤æ‚ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯åŸºäºFaster R-CNNå’ŒYOLOv3æ¥æ¢ç´¢ç›®æ ‡æ£€æµ‹ç½‘ç»œçš„è°ƒæ•´ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸ä¼šæ”¹å˜æ¨¡å‹çš„ç»“æ„ï¼Œä¹Ÿä¸ä¼šå¼•å…¥é¢å¤–çš„è®¡ç®—ä»£ä»·ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›trickï¼Œå¯ä»¥æ¯”SOTAæé«˜æœ€å¤š5ä¸ªç™¾åˆ†ç‚¹ã€‚</p>
<p>19å¹´ç”±äºšé©¬é€Šå›¢é˜Ÿå‘è¡¨çš„ã€ŠBag of Freebies for Training Object Detection Neural  Networksã€‹ã€‚åœ¨ä½¿ç”¨äº†trickåï¼ŒFaster R-CNNèƒ½æé«˜1-2ä¸ªç™¾åˆ†ç‚¹ï¼Œè€ŒYOLOv3åˆ™æé«˜äº†5ä¸ªç™¾åˆ†ç‚¹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/640.png" alt></p>
<h2 id="Trick"><a href="#Trick" class="headerlink" title="Trick"></a>Trick</h2><h3 id="mixup"><a href="#mixup" class="headerlink" title="mixup"></a>mixup</h3><p>mixupä¹Ÿæ˜¯å›¾ç‰‡åˆ†ç±»ä¸­çš„ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„trick, å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/641.jpg" alt></p>
<p>ç®€å•æ¥è®²å°±æ˜¯å°†ä¸¤å¼ å›¾ç‰‡é€šè¿‡ä¸åŒçš„æ¯”ä¾‹è¿›è¡Œèåˆï¼ŒåŒæ—¶å›¾ç‰‡å¯¹åº”çš„one-hotç¼–ç ä¹Ÿä»¥ç›¸åŒçš„æ¯”ä¾‹ç›¸ä¹˜ï¼Œä»è€Œæ„é€ å‡ºæ–°çš„æ•°æ®é›†ã€‚æœ¬è´¨ä¸Šï¼Œmixupåœ¨æˆå¯¹æ ·æœ¬åŠå…¶æ ‡ç­¾çš„å‡¸ç»„åˆï¼ˆconvex combinationsï¼‰ä¸Šè®­ç»ƒç¥ç»ç½‘ç»œï¼Œå¯ä»¥è§„èŒƒç¥ç»ç½‘ç»œï¼Œå¢å¼ºè®­ç»ƒæ ·æœ¬ä¹‹é—´çš„çº¿æ€§è¡¨è¾¾ã€‚å…¶ä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ”¹å–„äº†ç½‘ç»œæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</li>
<li>å‡å°‘å¯¹é”™è¯¯æ ‡ç­¾çš„è®°å¿†</li>
<li>å¢åŠ å¯¹æŠ—æ ·æœ¬çš„é²æ£’æ€§</li>
<li>ç¨³å®šè®­ç»ƒè¿‡ç¨‹</li>
</ul>
<p>æœ¬æ–‡æå‡ºäº†é’ˆå¯¹ç›®æ ‡æ£€æµ‹çš„<strong>è§†è§‰è¿è´¯çš„mixup</strong>æ–¹æ³•ï¼ˆVisually Coherent Image Mixup for Object Detectionï¼‰ï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/642.jpg" alt></p>
<p>é€šè¿‡ä¸Šå›¾ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†åœ¨è¿™é‡Œè¦å¼•å…¥ä¸€ç¯‡æœ‰æ„æ€çš„å·¥ä½œï¼ŒæŒ‡å‡ºäº†å½“æ—¶SOTAçš„ç›®æ ‡æ£€æµ‹å™¨çš„ç¼ºé™·ï¼Œè®ºæ–‡åç§°ä¸ºï¼šâ€œ<strong>Elephant in the room</strong>â€ã€‚æ³¨æ„ä¸¤å¼ å›¾ç»“åˆçš„æ–¹å¼æ˜¯ç›´æ¥å åŠ ï¼Œ å–æœ€å¤§çš„å®½é«˜ï¼Œä¸è¿›è¡Œresizeã€‚</p>
<p>å¤§è±¡é€šå¸¸éƒ½å‡ºç°åœ¨è‡ªç„¶åœºæ™¯ä¸‹ï¼Œæ•°æ®é›†ä¸­æ˜¯ä¸å­˜åœ¨èƒŒæ™¯æ˜¯å®¤å†…çš„å›¾ç‰‡çš„ï¼ŒElephant in the roomå°±æ˜¯ä½œè€…å°†å¤§è±¡å›¾ç‰‡æŠ å‡ºï¼Œç„¶åç›´æ¥æ”¾åœ¨å®¤å†…åœºæ™¯ä¸‹ï¼Œå¹¶ä½¿ç”¨SOTAç›®æ ‡æ£€æµ‹å™¨è¿›è¡Œæ£€æµ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/643.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨SOTA(faster rcnn nas coco)æ£€æµ‹å¤§è±¡çš„æ•ˆæœå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè€Œä¸”å¤§è±¡ä½ç½®ä¸åŒï¼Œä¹Ÿä¼šç»™å…¶ä»–ç›®æ ‡æ£€æµ‹çš„æ•ˆæœå¸¦æ¥å½±å“ï¼Œæ¯”å¦‚è¯´ä¸Šå›¾ä¸­ï¼ˆdï¼‰å’Œï¼ˆfï¼‰å›¾ä¸­cupè¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«æ£€æµ‹å‡ºæ¥ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/644.jpg" alt></p>
<p>ä¸Šå›¾æ˜¯ä¸€ä¸ªçŒ«åœ¨ä¸åŒçš„èƒŒæ™¯ä¸‹çš„æ£€æµ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è™½ç„¶ROIä¸­å†…å®¹å¤§ä½“ä¸å˜ï¼Œä½†æ˜¯ç»“æœå´æœ‰æ¯”è¾ƒå¤§çš„å˜åŒ–ï¼Œè¿™å«åšç‰¹å¾å¹²æ‰°ï¼ŒåŒä¸€ä¸ªç›®æ ‡åœ¨ä¸åŒèƒŒæ™¯è¢«æ£€æµ‹ä¸ºä¸åŒçš„ç‰©ä½“ï¼Œåœ¨ROIä¹‹å¤–çš„ç‰¹å¾å¯¹æœ€ç»ˆç»“æœä¼šäº§ç”Ÿå½±å“ï¼Œè¿™ä»£è¡¨ç‰¹å¾å¹²æ‰°å¯¹æ£€æµ‹è¿‡ç¨‹äº§ç”Ÿå¹²æ‰°ï¼Œå¯¹æ£€æµ‹ç»“æœäº§ç”Ÿä¸åˆ©å½±å“ã€‚</p>
<p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæœ¬æ–‡æå‡ºçš„æ˜¯è§†è§‰è¿è´¯çš„mixupæ–¹æ³•å¯ä»¥æ¯”è¾ƒå¥½çš„è§£å†³ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/645.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šå›¾ä¸­ä½¿ç”¨äº†è§†è§‰è¿è´¯çš„mixupæ–¹æ³•ä¹‹åï¼Œâ€œElephant in the roomâ€ä¹Ÿå¯ä»¥å¾ˆæœ‰æ•ˆçš„è¢«æ£€æµ‹å‡ºæ¥ï¼Œå¯ä»¥æ¯”è¾ƒå¥½çš„è§£å†³â€œElephant in the roomâ€è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/646.png" alt></p>
<p>ä½œè€…ä¹Ÿç”¨å®éªŒè¯æ˜äº†ä½¿ç”¨è¿™ç§mixupå¯ä»¥è®©å¤§è±¡çš„å¬å›ç‡å¤§å¹…åº¦æå‡ï¼Œå¹¶ä¸”å¯¹å…¶ä»–ç›®æ ‡å½±å“é™ä½åˆ°äº†1.27%</p>
<h3 id="Classfication-Head-Label-Smoothing"><a href="#Classfication-Head-Label-Smoothing" class="headerlink" title="Classfication Head Label Smoothing"></a>Classfication Head Label Smoothing</h3><p>Label Smoothingä¹Ÿæ˜¯åˆ†ç±»ä¸­ä½¿ç”¨åˆ°çš„trick, åœ¨ç›®æ ‡æ£€æµ‹é—®é¢˜ä¸­ä¹Ÿä¸€æ ·é€‚ç”¨ã€‚Label Smoothing  åŸç†ç®€å•æ¥è¯´å°±æ˜¯ï¼šåœ¨åˆ†ç±»çš„æ—¶å€™ï¼Œæ¯”å¦‚äºŒåˆ†ç±»æŠŠåŸå…ˆçš„æ ‡ç­¾(0,1) (ç§°ä¸ºhard targetï¼‰ è½¬æˆ soft targetï¼Œå…·ä½“æ–¹æ³•å°±æ˜¯  yâ€˜ = y (1 âˆ’ Î±) + Î±/K è¿™é‡ŒÎ± æ˜¯ä¸ªè¶…å‚æ•°å¸¸é‡ï¼ŒKå°±æ˜¯ç±»åˆ«çš„ä¸ªæ•° ã€‚</p>
<h3 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><p>åœ¨å›¾åƒåˆ†ç±»é—®é¢˜ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨éšæœºæ‰°ä¹±å›¾ç‰‡çš„ç©ºé—´ç‰¹å¾çš„æ–¹æ³•æ¥è¿›è¡Œæ•°æ®å¢å¼ºï¼Œ æ¯”å¦‚éšæœºç¿»è½¬ã€æ—‹è½¬ã€æŠ å›¾ç­‰ã€‚è¿™äº›æ–¹æ³•éƒ½å¯ä»¥æé«˜æ¨¡å‹çš„å‡†ç¡®ç‡ã€é¿å…è¿‡æ‹Ÿåˆã€‚</p>
<p>è¿™éƒ¨åˆ†ä¸»è¦å¯¹ä»¥ä¸‹å‡ ç§å¢å¼ºæ–¹æ³•è¿›è¡Œè¯•éªŒï¼š</p>
<ul>
<li>éšæœºå‡ ä½•å˜æ¢ï¼šéšæœºæŠ å›¾ã€éšæœºè†¨èƒ€ã€éšæœºæ°´å¹³ç¿»è½¬å’Œéšæœºresizeã€‚</li>
<li>éšæœºé¢œè‰²æŠ–åŠ¨ï¼šäº®åº¦ã€è‰²è°ƒã€é¥±å’Œåº¦ã€å¯¹æ¯”åº¦ã€‚</li>
</ul>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul>
<li><p>è®­ç»ƒç­–ç•¥ï¼šä½¿ç”¨ä½™å¼¦å­¦ä¹ ç‡+warmupçš„æ–¹æ³•ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/647.png" alt><br>ä¸Šå›¾æ˜¯stepæ–¹æ³•å’Œcosineæ–¹æ³•çš„å¯¹æ¯”ï¼Œé¢„å…ˆçš„æ–¹æ³•ä¸Šå‡æ›´å¿«ï¼Œä¸è¿‡æœ€ç»ˆç»“æœæ¯”è¾ƒæ¥è¿‘ï¼Œå·®çš„ä¹Ÿä¸æ˜¯å¾ˆå¤šã€‚</p>
</li>
<li><p>è·¨å¡åŒæ­¥Batch Normalizationã€‚</p>
</li>
<li>å¤šå°ºåº¦è®­ç»ƒï¼Œå’ŒYOLOv3ä¸­çš„è®­ç»ƒæ–¹å¼ä¸€æ ·ã€‚ä»{320,352,384,416,448,480,512,544,576,608 }ä¸­é€‰æ‹©ä¸€ä¸ªå°ºåº¦è¿›è¡Œè®­ç»ƒã€‚</li>
</ul>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/648.jpg" alt></p>
<p>ä¸Šå›¾åˆ†åˆ«å±•ç¤ºäº†åœ¨YOLOv3å’ŒFaster-RCNNä¸Šä½¿ç”¨ä»¥ä¸Štrickåçš„æ•ˆæœã€‚å…¶ä»–å®éªŒç»“æœå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥ä»”ç»†è¯»ä¸€ä¸‹paperã€‚</p>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>ASFFè¿™ç¯‡è®ºæ–‡è¢«å¾ˆå¤šäººè®¤ä¸ºæ˜¯YOLOä¸­æœ€å¼ºçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œä¸ä»…ä»…æ˜¯ä»–æå‡ºçš„ASFFæ¨¡å—ï¼Œæ›´å› ä¸ºä»–æœ‰ä¸€ä¸ªéå¸¸å¼ºçš„ã€èåˆäº†å¾ˆå¤štrickçš„baselineã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/649.png" alt></p>
<p>ä¸Šè¡¨ä¸­çš„BoFä»£è¡¨çš„å°±æ˜¯ä»¥ä¸Šè§£è¯»çš„è¿™ç¯‡ï¼šã€ŠBag of Freebies for Training Object Detection  Neural Networksã€‹ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯”çœ‹åˆ°æé«˜äº†å¤§çº¦4ä¸ªç™¾åˆ†ç‚¹ã€‚IoUä»£è¡¨çš„æ˜¯ä½¿ç”¨äº†IoU lossï¼ŒGAä»£è¡¨Guided  Anchoring,  GAä¸»è¦æ˜¯ç”¨äºè§£å†³ç‰¹å¾ä¸å¯¹é½å’Œanchorè®¾ç½®çš„é—®é¢˜ï¼ˆè¿™ä¹Ÿæ˜¯ä¸€é˜¶æ®µæ£€æµ‹æ–¹æ³•çš„å¼±ç‚¹ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…·ä½“è®²è§£å¯ä»¥çœ‹ï¼š<a href="https://zhuanlan.zhihu.com/p/55854246">https://zhuanlan.zhihu.com/p/55854246</a></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_optimize/650.jpg" alt></p>
<p>å®é™…ä¸ŠASFFæ¨¡å‹å¸¦æ¥çš„æå‡åªæœ‰1ä¸ªç™¾åˆ†ç‚¹å·¦å³ï¼Œè€Œä»¥ä¸Šç»“åˆäº†å„ç§trickçš„å¼ºå¤§çš„baselineæ˜¯ASFFå‡ºå½©çš„ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ä¿è¯ã€‚</p>
<p>ä»¥ä¸Šæ¶‰åŠåˆ°çš„trickçš„å…·ä½“å®ç°åº”è¯¥å¯ä»¥åœ¨ASFFå®˜æ–¹å®ç°ä¸­æ‰¾åˆ°ï¼š<a href="https://github.com/ruinmessi/ASFF">https://github.com/ruinmessi/ASFF</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡æ£€æµ‹ç®—æ³•çš„è¯„ä»·æ ‡å‡†å’Œå¸¸è§æ•°æ®é›†</title>
    <url>/2020/02/14/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E7%9A%84%E8%AF%84%E4%BB%B7%E6%A0%87%E5%87%86%E5%92%8C%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E9%9B%86/</url>
    <content><![CDATA[<h2 id="è¯„ä»·æŒ‡æ ‡"><a href="#è¯„ä»·æŒ‡æ ‡" class="headerlink" title="è¯„ä»·æŒ‡æ ‡"></a>è¯„ä»·æŒ‡æ ‡</h2><h3 id="1-å‡†ç¡®ç‡-Accuracy"><a href="#1-å‡†ç¡®ç‡-Accuracy" class="headerlink" title="1.å‡†ç¡®ç‡(Accuracy)"></a>1.å‡†ç¡®ç‡(Accuracy)</h3><p>æ£€æµ‹æ—¶åˆ†å¯¹çš„æ ·æœ¬æ•°é™¤ä»¥æ‰€æœ‰çš„æ ·æœ¬æ•°ã€‚å‡†ç¡®ç‡ä¸€èˆ¬è¢«ç”¨æ¥è¯„ä¼°æ£€æµ‹æ¨¡å‹çš„å…¨å±€å‡†ç¡®ç¨‹åº¦ï¼ŒåŒ…å«çš„ä¿¡æ¯æœ‰é™ï¼Œä¸èƒ½å®Œå…¨è¯„ä»·ä¸€ä¸ªæ¨¡å‹æ€§èƒ½ã€‚</p>
<h3 id="2-æ··æ·†çŸ©é˜µ-Confusion-Matrix"><a href="#2-æ··æ·†çŸ©é˜µ-Confusion-Matrix" class="headerlink" title="2.æ··æ·†çŸ©é˜µ(Confusion Matrix)"></a>2.æ··æ·†çŸ©é˜µ(Confusion Matrix)</h3><p>æ··æ·†çŸ©é˜µæ˜¯ä»¥æ¨¡å‹é¢„æµ‹çš„ç±»åˆ«æ•°é‡ç»Ÿè®¡ä¿¡æ¯ä¸ºæ¨ªè½´ï¼ŒçœŸå®æ ‡ç­¾çš„æ•°é‡ç»Ÿè®¡ä¿¡æ¯ä¸ºçºµè½´ç”»å‡ºçš„çŸ©é˜µã€‚å¯¹è§’çº¿ä»£è¡¨äº†æ¨¡å‹é¢„æµ‹å’Œæ•°æ®æ ‡ç­¾ä¸€è‡´çš„æ•°ç›®ï¼Œæ‰€ä»¥å‡†ç¡®ç‡ä¹Ÿå¯ä»¥ç”¨<strong>æ··æ·†çŸ©é˜µå¯¹è§’çº¿ä¹‹å’Œé™¤ä»¥æµ‹è¯•é›†å›¾ç‰‡æ•°é‡</strong>æ¥è®¡ç®—ã€‚å¯¹è§’çº¿ä¸Šçš„æ•°å­—è¶Šå¤§è¶Šå¥½ï¼Œåœ¨æ··æ·†çŸ©é˜µå¯è§†åŒ–ç»“æœä¸­é¢œè‰²è¶Šæ·±ï¼Œä»£è¡¨æ¨¡å‹åœ¨è¯¥ç±»çš„é¢„æµ‹ç»“æœæ›´å¥½ã€‚å…¶ä»–åœ°æ–¹è‡ªç„¶æ˜¯é¢„æµ‹é”™è¯¯çš„åœ°æ–¹ï¼Œè‡ªç„¶å€¼è¶Šå°ï¼Œé¢œè‰²è¶Šæµ…è¯´æ˜æ¨¡å‹é¢„æµ‹çš„æ›´å¥½ã€‚</p>
<h3 id="3-ç²¾ç¡®ç‡-Precision-å’Œå¬å›ç‡-Recall-å’ŒPRæ›²çº¿"><a href="#3-ç²¾ç¡®ç‡-Precision-å’Œå¬å›ç‡-Recall-å’ŒPRæ›²çº¿" class="headerlink" title="3.ç²¾ç¡®ç‡(Precision)å’Œå¬å›ç‡(Recall)å’ŒPRæ›²çº¿"></a>3.ç²¾ç¡®ç‡(Precision)å’Œå¬å›ç‡(Recall)å’ŒPRæ›²çº¿</h3><p>ä¸€ä¸ªç»å…¸ä¾‹å­æ˜¯å­˜åœ¨ä¸€ä¸ªæµ‹è¯•é›†åˆï¼Œæµ‹è¯•é›†åˆåªæœ‰å¤§é›å’Œé£æœºä¸¤ç§å›¾ç‰‡ç»„æˆï¼Œå‡è®¾ä½ çš„åˆ†ç±»ç³»ç»Ÿæœ€ç»ˆçš„ç›®çš„æ˜¯ï¼šèƒ½å–å‡ºæµ‹è¯•é›†ä¸­æ‰€æœ‰é£æœºçš„å›¾ç‰‡ï¼Œè€Œä¸æ˜¯å¤§é›çš„å›¾ç‰‡ã€‚ç„¶åå°±å¯ä»¥å®šä¹‰ï¼š</p>
<ul>
<li>True positives: ç®€ç§°ä¸ºTPï¼Œå³æ­£æ ·æœ¬è¢«æ­£ç¡®è¯†åˆ«ä¸ºæ­£æ ·æœ¬ï¼Œé£æœºçš„å›¾ç‰‡è¢«æ­£ç¡®çš„è¯†åˆ«æˆäº†é£æœºã€‚</li>
<li>True negatives: ç®€ç§°ä¸ºTNï¼Œå³è´Ÿæ ·æœ¬è¢«æ­£ç¡®è¯†åˆ«ä¸ºè´Ÿæ ·æœ¬ï¼Œå¤§é›çš„å›¾ç‰‡æ²¡æœ‰è¢«è¯†åˆ«å‡ºæ¥ï¼Œç³»ç»Ÿæ­£ç¡®åœ°è®¤ä¸ºå®ƒä»¬æ˜¯å¤§é›ã€‚</li>
<li>False Positives: ç®€ç§°ä¸ºFPï¼Œå³è´Ÿæ ·æœ¬è¢«é”™è¯¯è¯†åˆ«ä¸ºæ­£æ ·æœ¬ï¼Œå¤§é›çš„å›¾ç‰‡è¢«é”™è¯¯åœ°è¯†åˆ«æˆäº†é£æœºã€‚</li>
<li>False negatives: ç®€ç§°ä¸ºFNï¼Œå³æ­£æ ·æœ¬è¢«é”™è¯¯è¯†åˆ«ä¸ºè´Ÿæ ·æœ¬ï¼Œé£æœºçš„å›¾ç‰‡æ²¡æœ‰è¢«è¯†åˆ«å‡ºæ¥ï¼Œç³»ç»Ÿé”™è¯¯åœ°è®¤ä¸ºå®ƒä»¬æ˜¯å¤§é›ã€‚</li>
</ul>
<p><strong>ç²¾ç¡®ç‡</strong>å°±æ˜¯åœ¨è¯†åˆ«å‡ºæ¥çš„å›¾ç‰‡ä¸­ï¼ŒTrue positivesæ‰€å çš„æ¯”ç‡ã€‚ä¹Ÿå°±æ˜¯æœ¬å‡è®¾ä¸­ï¼Œæ‰€æœ‰è¢«è¯†åˆ«å‡ºæ¥çš„é£æœºä¸­ï¼ŒçœŸæ­£çš„é£æœºæ‰€å çš„æ¯”ä¾‹ï¼Œå…¬å¼å¦‚ä¸‹ï¼šPrecision $=\frac{T P}{T P+F P}=\frac{T P}{N}$ ï¼Œå…¶ä¸­Nä»£è¡¨æµ‹è¯•é›†æ ·æœ¬æ•°ã€‚</p>
<p><strong>å¬å›ç‡</strong>æ˜¯æµ‹è¯•é›†ä¸­æ‰€æœ‰æ­£æ ·æœ¬æ ·ä¾‹ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«ä¸ºæ­£æ ·æœ¬çš„æ¯”ä¾‹ã€‚ä¹Ÿå°±æ˜¯æœ¬å‡è®¾ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«å‡ºæ¥çš„é£æœºä¸ªæ•°ä¸æµ‹è¯•é›†ä¸­æ‰€æœ‰çœŸå®é£æœºçš„ä¸ªæ•°çš„æ¯”å€¼ï¼Œå…¬å¼å¦‚ä¸‹ï¼š Recall$=\frac{T P}{T P+F N}$</p>
<p>æ‰€è°“<strong>PRæ›²çº¿</strong>å°±æ˜¯æ”¹å˜è¯†åˆ«é˜ˆå€¼ï¼Œä½¿å¾—ç³»ç»Ÿä¾æ¬¡èƒ½å¤Ÿè¯†åˆ«å‰Kå¼ å›¾ç‰‡ï¼Œé˜ˆå€¼çš„å˜åŒ–åŒæ—¶ä¼šå¯¼è‡´Precisionä¸Recallå€¼å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¾—åˆ°æ›²çº¿ã€‚æ›²çº¿å›¾å¤§æ¦‚å¦‚ä¸‹ï¼Œè¿™é‡Œæœ‰3æ¡PRæ›²çº¿ï¼Œå‘¨å¿—åæœºå™¨å­¦ä¹ çš„è§£é‡Šå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/metrics/640.webp" alt></p>
<h3 id="4-å¹³å‡ç²¾åº¦-Average-Precisionï¼ŒAP-å’ŒmAP"><a href="#4-å¹³å‡ç²¾åº¦-Average-Precisionï¼ŒAP-å’ŒmAP" class="headerlink" title="4.å¹³å‡ç²¾åº¦(Average-Precisionï¼ŒAP)å’ŒmAP"></a>4.å¹³å‡ç²¾åº¦(Average-Precisionï¼ŒAP)å’ŒmAP</h3><p><strong>AP</strong>å°±æ˜¯Precision-recall æ›²çº¿ä¸‹é¢çš„é¢ç§¯ï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªè¶Šå¥½çš„åˆ†ç±»å™¨ï¼ŒAPå€¼è¶Šé«˜ã€‚<strong>mAP</strong>æ˜¯å¤šä¸ªç±»åˆ«APçš„å¹³å‡å€¼ã€‚è¿™ä¸ªmeançš„æ„æ€æ˜¯å¯¹æ¯ä¸ªç±»çš„APå†æ±‚å¹³å‡ï¼Œå¾—åˆ°çš„å°±æ˜¯mAPçš„å€¼ï¼ŒmAPçš„å¤§å°ä¸€å®šåœ¨[0,1]åŒºé—´ï¼Œè¶Šå¤§è¶Šå¥½ã€‚è¯¥æŒ‡æ ‡æ˜¯ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­æœ€é‡è¦çš„ä¸€ä¸ªã€‚</p>
<h3 id="5-ROCæ›²çº¿"><a href="#5-ROCæ›²çº¿" class="headerlink" title="5.ROCæ›²çº¿"></a>5.ROCæ›²çº¿</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/metrics/641.webp" alt></p>
<p>ROCçš„æ¨ªè½´æ˜¯å‡æ­£ç‡(False positive rateï¼Œ FPR)ï¼ŒFPR = FP / [ FP + TN]  ï¼Œä»£è¡¨æ‰€æœ‰è´Ÿæ ·æœ¬ä¸­é”™è¯¯é¢„æµ‹ä¸ºæ­£æ ·æœ¬çš„æ¦‚ç‡ï¼Œå‡è­¦æŠ¥ç‡ã€‚ROCçš„çºµè½´æ˜¯çœŸæ­£ç‡(True positive rateï¼Œ TPR)ï¼ŒTPR  = TP / [ TP + FN]  ï¼Œä»£è¡¨æ‰€æœ‰æ­£æ ·æœ¬ä¸­é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡ï¼Œå‘½ä¸­ç‡ã€‚ROCæ›²çº¿çš„å¯¹è§’çº¿åæ ‡å¯¹åº”äºéšå³çŒœæµ‹ï¼Œè€Œåæ ‡ç‚¹(0,1)ä¹Ÿå³æ˜¯å·¦ä¸Šè§’åæ ‡å¯¹åº”ç†æƒ³æ¨¡å‹ã€‚æ›²çº¿è¶Šæ¥è¿‘å·¦ä¸Šè§’ä»£è¡¨æ£€æµ‹æ¨¡å‹çš„æ•ˆæœè¶Šå¥½ã€‚</p>
<p>å³ï¼šä» (0, 0) åˆ° (1,1) çš„å¯¹è§’çº¿å°†ROCç©ºé—´åˆ’åˆ†ä¸ºå·¦ä¸Šï¼å³ä¸‹ä¸¤ä¸ªåŒºåŸŸï¼Œåœ¨è¿™æ¡çº¿çš„ä»¥ä¸Šçš„ç‚¹ä»£è¡¨äº†ä¸€ä¸ªå¥½çš„åˆ†ç±»ç»“æœï¼ˆèƒœè¿‡éšæœºåˆ†ç±»ï¼‰ï¼Œè€Œåœ¨è¿™æ¡çº¿ä»¥ä¸‹çš„ç‚¹ä»£è¡¨äº†å·®çš„åˆ†ç±»ç»“æœï¼ˆåŠ£äºéšæœºåˆ†ç±»ï¼‰ã€‚</p>
<p>å®Œç¾çš„é¢„æµ‹æ˜¯ä¸€ä¸ªåœ¨å·¦ä¸Šè§’çš„ç‚¹ï¼Œåœ¨ROCç©ºé—´åº§æ ‡ (0,1)ç‚¹ï¼ŒX=0 ä»£è¡¨ç€æ²¡æœ‰ä¼ªé˜³æ€§ï¼ŒY=1  ä»£è¡¨ç€æ²¡æœ‰ä¼ªé˜´æ€§ï¼ˆæ‰€æœ‰çš„é˜³æ€§éƒ½æ˜¯çœŸé˜³æ€§ï¼‰ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡åˆ†ç±»å™¨è¾“å‡ºç»“æœæ˜¯é˜³æ€§æˆ–é˜´æ€§ï¼Œéƒ½æ˜¯100%æ­£ç¡®ã€‚ä¸€ä¸ªéšæœºçš„é¢„æµ‹ä¼šå¾—åˆ°ä½äºä» (0, 0) åˆ° (1, 1) å¯¹è§’çº¿ï¼ˆä¹Ÿå«æ— è¯†åˆ«ç‡çº¿ï¼‰ä¸Šçš„ä¸€ä¸ªç‚¹ï¼›æœ€ç›´è§‚çš„éšæœºé¢„æµ‹çš„ä¾‹å­å°±æ˜¯æŠ›ç¡¬å¸ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/metrics/v2-fc750883be72300fa2373d1c5b81ee9e_hd.jpg" alt></p>
<p>é‚£ä¹ˆROCæ›²çº¿æ˜¯æ€ä¹ˆç»˜åˆ¶çš„å‘¢ï¼Ÿæœ‰å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ ¹æ®æ¯ä¸ªæµ‹è¯•æ ·æœ¬å±äºæ­£æ ·æœ¬çš„æ¦‚ç‡å€¼ä»å¤§åˆ°å°æ’åºã€‚</li>
<li>ä»é«˜åˆ°ä½ï¼Œä¾æ¬¡å°†â€œScoreâ€å€¼ä½œä¸ºé˜ˆå€¼thresholdï¼Œå½“æµ‹è¯•æ ·æœ¬å±äºæ­£æ ·æœ¬çš„æ¦‚ç‡å¤§äºæˆ–ç­‰äºè¿™ä¸ªthresholdæ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä¸ºæ­£æ ·æœ¬ï¼Œå¦åˆ™ä¸ºè´Ÿæ ·æœ¬ã€‚</li>
<li>æ¯æ¬¡é€‰å–ä¸€ä¸ªä¸åŒçš„thresholdï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ç»„FPRå’ŒTPRï¼Œå³ROCæ›²çº¿ä¸Šçš„ä¸€ç‚¹ã€‚å½“æˆ‘ä»¬å°†thresholdè®¾ç½®ä¸º1å’Œ0æ—¶ï¼Œåˆ†åˆ«å¯ä»¥å¾—åˆ°ROCæ›²çº¿ä¸Šçš„(0,0)å’Œ(1,1)ä¸¤ä¸ªç‚¹ã€‚å°†è¿™äº›(FPR,TPR)å¯¹è¿æ¥èµ·æ¥ï¼Œå°±å¾—åˆ°äº†ROCæ›²çº¿ã€‚å½“thresholdå–å€¼è¶Šå¤šï¼ŒROCæ›²çº¿è¶Šå¹³æ»‘ã€‚</li>
</ul>
<h3 id="6-AUC-Area-Uner-Curve"><a href="#6-AUC-Area-Uner-Curve" class="headerlink" title="6.AUC(Area Uner Curve)"></a>6.AUC(Area Uner Curve)</h3><p>å³ä¸ºROCæ›²çº¿ä¸‹çš„é¢ç§¯ã€‚AUCè¶Šæ¥è¿‘äº1ï¼Œåˆ†ç±»å™¨æ€§èƒ½è¶Šå¥½ã€‚AUCå€¼æ˜¯ä¸€ä¸ªæ¦‚ç‡å€¼ï¼Œå½“ä½ éšæœºæŒ‘é€‰ä¸€ä¸ªæ­£æ ·æœ¬ä»¥åŠä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œå½“å‰çš„åˆ†ç±»ç®—æ³•æ ¹æ®è®¡ç®—å¾—åˆ°çš„Scoreå€¼å°†è¿™ä¸ªæ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢çš„æ¦‚ç‡å°±æ˜¯AUCå€¼ã€‚å½“ç„¶ï¼ŒAUCå€¼è¶Šå¤§ï¼Œå½“å‰çš„åˆ†ç±»ç®—æ³•è¶Šæœ‰å¯èƒ½å°†æ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢ï¼Œå³èƒ½å¤Ÿæ›´å¥½çš„åˆ†ç±»ã€‚AUCçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
A U C=\frac{\sum p r e d_{p o s}>p r e d_{n e g}}{p o s i t i v e N u m * n e g a t i v e N  u m}</script><p>å³ï¼šåˆ†åˆ«éšæœºä»æ ·æœ¬é›†ä¸­æŠ½å–ä¸€ä¸ªæ­£è´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬çš„é¢„æµ‹å€¼å¤§äºè´Ÿæ ·æœ¬çš„æ¦‚ç‡ã€‚</p>
<h3 id="PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº"><a href="#PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº" class="headerlink" title="PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº"></a>PRæ›²çº¿å’ŒROCæ›²çº¿é€‰ç”¨æ—¶æœº</h3><p>ç›®æ ‡æ£€æµ‹ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯MAPå€¼ï¼Œä½†æˆ‘ä»¬æœ€å¥½å†äº†è§£ä¸€ä¸‹PRæ›²çº¿å’ŒROCæ›²çº¿çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨ä¸åŒçš„æ•°æ®é›†ä¸­é€‰æ‹©åˆé€‚çš„è¯„ä»·æ ‡å‡†æ›´å¥½çš„åˆ¤æ–­æˆ‘ä»¬çš„æ¨¡å‹æ˜¯å¦è®­å¥½äº†ã€‚</p>
<h3 id="PRæ›²çº¿"><a href="#PRæ›²çº¿" class="headerlink" title="PRæ›²çº¿"></a>PRæ›²çº¿</h3><p>ä»PRçš„è®¡ç®—å…¬å¼å¯ä»¥çœ‹å‡ºï¼ŒPRæ›²çº¿èšç„¦äºæ­£ä¾‹ã€‚ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ä¸­ç”±äºä¸»è¦å…³å¿ƒæ­£ä¾‹ï¼Œæ‰€ä»¥åœ¨æ­¤æƒ…å†µä¸‹PRæ›²çº¿è¢«å¹¿æ³›è®¤ä¸ºä¼˜äºROCæ›²çº¿ã€‚</p>
<h3 id="ROCæ›²çº¿"><a href="#ROCæ›²çº¿" class="headerlink" title="ROCæ›²çº¿"></a>ROCæ›²çº¿</h3><p>å½“æµ‹è¯•é›†ä¸­çš„æ­£è´Ÿæ ·æœ¬çš„åˆ†å¸ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒROCæ›²çº¿å¯ä»¥ä¿æŒä¸å˜ã€‚å› ä¸ºTPRèšç„¦äºæ­£ä¾‹ï¼ŒFPRèšç„¦äºä¸è´Ÿä¾‹ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ¯”è¾ƒå‡è¡¡çš„è¯„ä¼°æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å…³å¿ƒæ­£ä¾‹çš„é¢„æµ‹å‡†ç¡®æ€§çš„åœºæ™¯ï¼ŒROCæ›²çº¿å°±ä¸èƒ½æ›´å¥½çš„ååº”æ¨¡å‹çš„æ€§èƒ½äº†ï¼Œå› ä¸ºROCæ›²çº¿çš„æ¨ªè½´é‡‡ç”¨FPRï¼Œæ ¹æ®FPRå…¬å¼ ï¼Œå½“è´Ÿä¾‹Nçš„æ•°é‡è¿œè¶…æ­£ä¾‹Pæ—¶ï¼ŒFPçš„å¤§å¹…å¢é•¿åªèƒ½æ¢æ¥FPRçš„å¾®å°æ”¹å˜ã€‚ç»“æœæ˜¯è™½ç„¶å¤§é‡è´Ÿä¾‹è¢«é”™åˆ¤æˆæ­£ä¾‹ï¼Œåœ¨ROCæ›²çº¿ä¸Šå´æ— æ³•ç›´è§‚åœ°çœ‹å‡ºæ¥ã€‚</p>
<p>å› æ­¤ï¼ŒPRæ›²çº¿å’ŒROCæ›²çº¿çš„é€‰ç”¨æ—¶æœºå¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/metrics/642.webp" alt></p>
<p>ä»ç›®æ ‡æ£€æµ‹ä»»åŠ¡æ¥è®²ï¼Œä¸€èˆ¬å…³å¿ƒMAPå€¼å³å¯ã€‚</p>
<h2 id="æ•°æ®é›†ä»‹ç»"><a href="#æ•°æ®é›†ä»‹ç»" class="headerlink" title="æ•°æ®é›†ä»‹ç»"></a>æ•°æ®é›†ä»‹ç»</h2><p>åˆšæ‰ä»‹ç»äº†ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å¸¸è§è¯„ä»·æ ‡å‡†ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸‹ç›®æ ‡æ£€æµ‹å¸¸ç”¨çš„æ•°æ®é›†ã€‚ä»¥ä¸‹ä»‹ç»æ¥è‡ªäºgithubå·¥ç¨‹æ•´ç†ï¼šDeepLearning-500-questions</p>
<h3 id="PASCAL-VOCæ•°æ®é›†"><a href="#PASCAL-VOCæ•°æ®é›†" class="headerlink" title="PASCAL VOCæ•°æ®é›†"></a>PASCAL VOCæ•°æ®é›†</h3><p>VOCæ•°æ®é›†æ˜¯ç›®æ ‡æ£€æµ‹ç»å¸¸ç”¨çš„ä¸€ä¸ªæ•°æ®é›†ï¼Œè‡ª2005å¹´èµ·æ¯å¹´ä¸¾åŠä¸€æ¬¡æ¯”èµ›ï¼Œæœ€å¼€å§‹åªæœ‰4ç±»ï¼Œåˆ°2007å¹´æ‰©å……ä¸º20ä¸ªç±»ï¼Œå…±æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„ç‰ˆæœ¬ï¼š2007å’Œ2012ã€‚å­¦æœ¯ç•Œå¸¸ç”¨5kçš„train/val 2007å’Œ16kçš„train/val 2012ä½œä¸ºè®­ç»ƒé›†ï¼Œtest 2007ä½œä¸ºæµ‹è¯•é›†ï¼Œç”¨10kçš„train/val 2007+test  2007å’Œ16kçš„train/val 2012ä½œä¸ºè®­ç»ƒé›†ï¼Œtest2012ä½œä¸ºæµ‹è¯•é›†ï¼Œåˆ†åˆ«æ±‡æŠ¥ç»“æœã€‚</p>
<h3 id="MSCOCOæ•°æ®é›†"><a href="#MSCOCOæ•°æ®é›†" class="headerlink" title="MSCOCOæ•°æ®é›†"></a>MSCOCOæ•°æ®é›†</h3><p>COCOæ•°æ®é›†æ˜¯å¾®è½¯å›¢é˜Ÿå‘å¸ƒçš„ä¸€ä¸ªå¯ä»¥ç”¨æ¥å›¾åƒrecognition+segmentation+captioningçš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†æ”¶é›†äº†å¤§é‡åŒ…å«å¸¸è§ç‰©ä½“çš„æ—¥å¸¸åœºæ™¯å›¾ç‰‡ï¼Œå¹¶æä¾›åƒç´ çº§çš„å®ä¾‹æ ‡æ³¨ä»¥æ›´ç²¾ç¡®åœ°è¯„ä¼°æ£€æµ‹å’Œåˆ†å‰²ç®—æ³•çš„æ•ˆæœï¼Œè‡´åŠ›äºæ¨åŠ¨åœºæ™¯ç†è§£çš„ç ”ç©¶è¿›å±•ã€‚ä¾æ‰˜è¿™ä¸€æ•°æ®é›†ï¼Œæ¯å¹´ä¸¾åŠä¸€æ¬¡æ¯”èµ›ï¼Œç°å·²æ¶µç›–æ£€æµ‹ã€åˆ†å‰²ã€å…³é”®ç‚¹è¯†åˆ«ã€æ³¨é‡Šç­‰æœºå™¨è§†è§‰çš„ä¸­å¿ƒä»»åŠ¡ï¼Œæ˜¯ç»§ImageNet Chanllengeä»¥æ¥æœ€æœ‰å½±å“åŠ›çš„å­¦æœ¯ç«èµ›ä¹‹ä¸€ã€‚ç›¸æ¯”ImageNetï¼ŒCOCOæ›´åŠ åå¥½ç›®æ ‡ä¸å…¶åœºæ™¯å…±åŒå‡ºç°çš„å›¾ç‰‡ï¼Œå³non-iconic  imagesã€‚è¿™æ ·çš„å›¾ç‰‡èƒ½å¤Ÿåæ˜ è§†è§‰ä¸Šçš„è¯­ä¹‰ï¼Œæ›´ç¬¦åˆå›¾åƒç†è§£çš„ä»»åŠ¡è¦æ±‚ã€‚è€Œç›¸å¯¹çš„iconic  imagesåˆ™æ›´é€‚åˆæµ…è¯­ä¹‰çš„å›¾åƒåˆ†ç±»ç­‰ä»»åŠ¡ã€‚COCOçš„æ£€æµ‹ä»»åŠ¡å…±å«æœ‰80ä¸ªç±»ï¼Œåœ¨2014å¹´å‘å¸ƒçš„æ•°æ®è§„æ¨¡åˆ†train/val/teståˆ†åˆ«ä¸º80k/40k/40kï¼Œå­¦æœ¯ç•Œè¾ƒä¸ºé€šç”¨çš„åˆ’åˆ†æ˜¯ä½¿ç”¨trainå’Œ35kçš„valå­é›†ä½œä¸ºè®­ç»ƒé›†ï¼ˆtrainval35kï¼‰ï¼Œä½¿ç”¨å‰©ä½™çš„valä½œä¸ºæµ‹è¯•é›†ï¼ˆminivalï¼‰ï¼ŒåŒæ—¶å‘å®˜æ–¹çš„evaluation serveræäº¤ç»“æœï¼ˆtest-devï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCOCOå®˜æ–¹ä¹Ÿä¿ç•™ä¸€éƒ¨åˆ†testæ•°æ®ä½œä¸ºæ¯”èµ›çš„è¯„æµ‹é›†ã€‚</p>
<h3 id="Google-Open-Imageæ•°æ®é›†"><a href="#Google-Open-Imageæ•°æ®é›†" class="headerlink" title="Google Open Imageæ•°æ®é›†"></a>Google Open Imageæ•°æ®é›†</h3><p>pen Imageæ˜¯è°·æ­Œå›¢é˜Ÿå‘å¸ƒçš„æ•°æ®é›†ã€‚æœ€æ–°å‘å¸ƒçš„Open Images  V4åŒ…å«190ä¸‡å›¾åƒã€600ä¸ªç§ç±»ï¼Œ1540ä¸‡ä¸ªbounding-boxæ ‡æ³¨ï¼Œæ˜¯å½“å‰æœ€å¤§çš„å¸¦ç‰©ä½“ä½ç½®æ ‡æ³¨ä¿¡æ¯çš„æ•°æ®é›†ã€‚è¿™äº›è¾¹ç•Œæ¡†å¤§éƒ¨åˆ†éƒ½æ˜¯ç”±ä¸“ä¸šæ³¨é‡Šäººå‘˜æ‰‹åŠ¨ç»˜åˆ¶çš„ï¼Œç¡®ä¿äº†å®ƒä»¬çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚å¦å¤–ï¼Œè¿™äº›å›¾åƒæ˜¯éå¸¸å¤šæ ·åŒ–çš„ï¼Œå¹¶ä¸”é€šå¸¸åŒ…å«æœ‰å¤šä¸ªå¯¹è±¡çš„å¤æ‚åœºæ™¯ï¼ˆå¹³å‡æ¯ä¸ªå›¾åƒ 8 ä¸ªï¼‰ã€‚</p>
<h3 id="ImageNetæ•°æ®é›†"><a href="#ImageNetæ•°æ®é›†" class="headerlink" title="ImageNetæ•°æ®é›†"></a>ImageNetæ•°æ®é›†</h3><p>ImageNetæ˜¯ä¸€ä¸ªè®¡ç®—æœºè§†è§‰ç³»ç»Ÿè¯†åˆ«é¡¹ç›®ï¼Œ  æ˜¯ç›®å‰ä¸–ç•Œä¸Šå›¾åƒè¯†åˆ«æœ€å¤§çš„æ•°æ®åº“ã€‚ImageNetæ˜¯ç¾å›½æ–¯å¦ç¦çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼Œæ¨¡æ‹Ÿäººç±»çš„è¯†åˆ«ç³»ç»Ÿå»ºç«‹çš„ã€‚èƒ½å¤Ÿä»å›¾ç‰‡è¯†åˆ«ç‰©ä½“ã€‚Imagenetæ•°æ®é›†æ–‡æ¡£è¯¦ç»†ï¼Œæœ‰ä¸“é—¨çš„å›¢é˜Ÿç»´æŠ¤ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸç ”ç©¶è®ºæ–‡ä¸­åº”ç”¨éå¸¸å¹¿ï¼Œå‡ ä¹æˆä¸ºäº†ç›®å‰æ·±åº¦å­¦ä¹ å›¾åƒé¢†åŸŸç®—æ³•æ€§èƒ½æ£€éªŒçš„â€œæ ‡å‡†â€æ•°æ®é›†ã€‚Imagenetæ•°æ®é›†æœ‰1400å¤šä¸‡å¹…å›¾ç‰‡ï¼Œæ¶µç›–2ä¸‡å¤šä¸ªç±»åˆ«ï¼›å…¶ä¸­æœ‰è¶…è¿‡ç™¾ä¸‡çš„å›¾ç‰‡æœ‰æ˜ç¡®çš„ç±»åˆ«æ ‡æ³¨å’Œå›¾åƒä¸­ç‰©ä½“ä½ç½®çš„æ ‡æ³¨ã€‚</p>
<h3 id="DOTAæ•°æ®é›†"><a href="#DOTAæ•°æ®é›†" class="headerlink" title="DOTAæ•°æ®é›†"></a>DOTAæ•°æ®é›†</h3><p>DOTAæ˜¯é¥æ„Ÿèˆªç©ºå›¾åƒæ£€æµ‹çš„å¸¸ç”¨æ•°æ®é›†ï¼ŒåŒ…å«2806å¼ èˆªç©ºå›¾åƒï¼Œå°ºå¯¸å¤§çº¦ä¸º4k x 4kï¼ŒåŒ…å«15ä¸ªç±»åˆ«å…±è®¡188282ä¸ªå®ä¾‹ï¼Œå…¶ä¸­14ä¸ªä¸»ç±»ï¼Œsmall vehicle å’Œ large  vehicleéƒ½æ˜¯vehicleçš„å­ç±»ã€‚å…¶æ ‡æ³¨æ–¹å¼ä¸ºå››ç‚¹ç¡®å®šçš„ä»»æ„å½¢çŠ¶å’Œæ–¹å‘çš„å››è¾¹å½¢ã€‚èˆªç©ºå›¾åƒåŒºåˆ«äºä¼ ç»Ÿæ•°æ®é›†ï¼Œæœ‰å…¶è‡ªå·±çš„ç‰¹ç‚¹ï¼Œå¦‚ï¼šå°ºåº¦å˜åŒ–æ€§æ›´å¤§ï¼›å¯†é›†çš„å°ç‰©ä½“æ£€æµ‹ï¼›æ£€æµ‹ç›®æ ‡çš„ä¸ç¡®å®šæ€§ã€‚æ•°æ®åˆ’åˆ†ä¸º1/6éªŒè¯é›†ï¼Œ1/3æµ‹è¯•é›†ï¼Œ1/2è®­ç»ƒé›†ã€‚ç›®å‰å‘å¸ƒäº†è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå›¾åƒå°ºå¯¸ä»800 x 800åˆ°4000 x 4000ä¸ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>NMSåå¤„ç†ç›¸å…³</title>
    <url>/2020/03/03/NMS%E5%90%8E%E5%A4%84%E7%90%86%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum  Suppressionï¼ŒNMS)ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æŠ‘åˆ¶ä¸æ˜¯æå¤§å€¼çš„å…ƒç´ ã€‚åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œä¾‹å¦‚è¡Œäººæ£€æµ‹ä¸­ï¼Œæ»‘åŠ¨çª—å£ç»è¿‡ç‰¹å¾æå–å’Œåˆ†ç±»å™¨è¯†åˆ«åï¼Œæ¯ä¸ªçª—å£éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªåˆ†æ•°ã€‚ä½†æ»‘åŠ¨çª—å£ä¼šå¯¼è‡´å¾ˆå¤šçª—å£å’Œå…¶å®ƒçª—å£å­˜åœ¨åŒ…å«å¤§éƒ¨åˆ†äº¤å‰çš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°NMSæ¥é€‰å–é‚£äº›é‚»åŸŸé‡Œåˆ†æ•°æœ€é«˜ï¼ŒåŒæ—¶æŠ‘åˆ¶é‚£äº›åˆ†æ•°ä½çš„çª—å£ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ï¼Œå®šä¹‰æœ€åçš„å€™é€‰æ¡†é›†åˆä¸º$B$ï¼Œæ¯ä¸ªå€™é€‰æ¡†å¯¹åº”çš„ç½®ä¿¡åº¦æ˜¯$S$ï¼ŒIOUé˜ˆå€¼è®¾ä¸º$T$ï¼Œç„¶åNMSçš„ç®—æ³•è¿‡ç¨‹å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<ul>
<li><p>é€‰æ‹©å…·æœ‰æœ€å¤§scoreçš„å€™é€‰æ¡†$M$</p>
</li>
<li><p>å°†$M$ä»é›†åˆ$B$ä¸­ç§»é™¤å¹¶åŠ å…¥åˆ°æœ€ç»ˆçš„æ£€æµ‹ç»“æœ$D$ä¸­</p>
</li>
<li><p>å°†$B$ä¸­å‰©ä½™æ£€æµ‹æ¡†ä¸­å’Œ$M$çš„äº¤å¹¶æ¯”(IOU)å¤§äºé˜ˆå€¼$T$çš„æ¡†ä»$B$ä¸­ç§»é™¤</p>
</li>
<li><p>é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°$B$ä¸ºç©º</p>
</li>
</ul>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>rgbå¤§ç¥å®ç°Faster-RCNNä¸­çš„å•ç±»åˆ«ç‰©ä½“nmsä»£ç è§£é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> --------------------------------------------------------</span><br><span class="line"><span class="comment"># Fast R-CNN</span></span><br><span class="line"><span class="comment"># Copyright (c) 2015 Microsoft</span></span><br><span class="line"><span class="comment"># Licensed under The MIT License [see LICENSE for details]</span></span><br><span class="line"><span class="comment"># Written by Ross Girshick</span></span><br><span class="line"><span class="comment"># --------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">py_cpu_nms</span>(<span class="params">dets, thresh</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Pure Python NMS baseline.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#x1ã€y1ã€x2ã€y2ã€ä»¥åŠscoreèµ‹å€¼</span></span><br><span class="line">    x1 = dets[:, <span class="number">0</span>]</span><br><span class="line">    y1 = dets[:, <span class="number">1</span>]</span><br><span class="line">    x2 = dets[:, <span class="number">2</span>]</span><br><span class="line">    y2 = dets[:, <span class="number">3</span>]</span><br><span class="line">    scores = dets[:, <span class="number">4</span>]</span><br><span class="line">	<span class="comment">#æ¯ä¸€ä¸ªæ£€æµ‹æ¡†çš„é¢ç§¯</span></span><br><span class="line">    areas = (x2 - x1 + <span class="number">1</span>) * (y2 - y1 + <span class="number">1</span>)</span><br><span class="line">    <span class="comment">#æŒ‰ç…§scoreç½®ä¿¡åº¦é™åºæ’åº</span></span><br><span class="line">    order = scores.argsort()[::-<span class="number">1</span>]</span><br><span class="line">    <span class="comment">#ä¿ç•™çš„ç»“æœæ¡†é›†åˆ</span></span><br><span class="line">    keep = []</span><br><span class="line">    <span class="keyword">while</span> order.size &gt; <span class="number">0</span>:</span><br><span class="line">        i = order[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#ä¿ç•™è¯¥ç±»å‰©ä½™boxä¸­å¾—åˆ†æœ€é«˜çš„ä¸€ä¸ª</span></span><br><span class="line">        keep.append(i)</span><br><span class="line">        <span class="comment"># å¾—åˆ°ç›¸äº¤åŒºåŸŸ,å·¦ä¸ŠåŠå³ä¸‹</span></span><br><span class="line">        xx1 = np.maximum(x1[i], x1[order[<span class="number">1</span>:]])</span><br><span class="line">        yy1 = np.maximum(y1[i], y1[order[<span class="number">1</span>:]])</span><br><span class="line">        xx2 = np.minimum(x2[i], x2[order[<span class="number">1</span>:]])</span><br><span class="line">        yy2 = np.minimum(y2[i], y2[order[<span class="number">1</span>:]])</span><br><span class="line">	    <span class="comment">#è®¡ç®—ç›¸äº¤çš„é¢ç§¯,ä¸é‡å æ—¶é¢ç§¯ä¸º0</span></span><br><span class="line">        w = np.maximum(<span class="number">0.0</span>, xx2 - xx1 + <span class="number">1</span>)</span><br><span class="line">        h = np.maximum(<span class="number">0.0</span>, yy2 - yy1 + <span class="number">1</span>)</span><br><span class="line">        inter = w * h</span><br><span class="line">        <span class="comment">#è®¡ç®—IoUï¼šé‡å é¢ç§¯ /ï¼ˆé¢ç§¯1+é¢ç§¯2-é‡å é¢ç§¯ï¼‰</span></span><br><span class="line">        ovr = inter / (areas[i] + areas[order[<span class="number">1</span>:]] - inter)</span><br><span class="line">		<span class="comment"># ä¿ç•™IoUå°äºé˜ˆå€¼çš„box</span></span><br><span class="line">        inds = np.where(ovr &lt;= thresh)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># å› ä¸ºovræ•°ç»„çš„é•¿åº¦æ¯”orderæ•°ç»„å°‘ä¸€ä¸ª,æ‰€ä»¥è¿™é‡Œè¦å°†æ‰€æœ‰ä¸‹æ ‡åç§»ä¸€ä½</span></span><br><span class="line">        order = order[inds + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> keep</span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/nms/640.webp" alt></p>
<h2 id="Soft-NMS"><a href="#Soft-NMS" class="headerlink" title="Soft-NMS"></a>Soft-NMS</h2><p>ä¸Šé¢è¯´çš„NMSç®—æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å½“ä¸¤ä¸ªå€™é€‰æ¡†çš„é‡å åº¦å¾ˆé«˜æ—¶ï¼ŒNMSä¼šå°†å…·æœ‰è¾ƒä½ç½®ä¿¡åº¦çš„æ¡†å»æ‰ï¼Œä¹Ÿå°±æ˜¯å°†å…¶ç½®ä¿¡åº¦å˜æˆ0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²æ¡†å’Œç»¿è‰²æ¡†æ˜¯å½“å‰çš„æ£€æµ‹ç»“æœï¼ŒäºŒè€…çš„å¾—åˆ†åˆ†åˆ«æ˜¯0.95å’Œ0.80ã€‚å¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„NMSè¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆé€‰ä¸­å¾—åˆ†æœ€é«˜çš„çº¢è‰²æ¡†ï¼Œç„¶åç»¿è‰²æ¡†å°±ä¼šå› ä¸ºä¸ä¹‹é‡å é¢ç§¯è¿‡å¤§è€Œè¢«åˆ æ‰ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/nms/641.webp" alt></p>
<p>å› æ­¤ä¸ºäº†æ”¹å–„è¿™ä¸ªç¼ºç‚¹ï¼ŒSoft-NMSè¢«æå‡ºï¼Œæ ¸å¿ƒæ€è·¯å°±æ˜¯ä¸è¦ç²—é²åœ°åˆ é™¤æ‰€æœ‰IOUå¤§äºé˜ˆå€¼çš„æ¡†ï¼Œè€Œæ˜¯é™ä½å…¶ç½®ä¿¡åº¦ã€‚è¿™ä¸ªæ–¹æ³•çš„è®ºæ–‡åœ°å€ä¸ºï¼š<a href="https://arxiv.org/pdf/1704.04503.pdf">https://arxiv.org/pdf/1704.04503.pdf</a> ã€‚ç®—æ³•ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/nms/642.jpg" alt></p>
<p>æ­£å¦‚ä½œè€…æ‰€è¯´ï¼Œæ”¹ä¸€è¡Œä»£ç å°±OKäº†ã€‚è¿™é‡Œçš„$f$å‡½æ•°å¯ä»¥æ˜¯çº¿æ€§å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯é«˜æ–¯å‡½æ•°ã€‚æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<ul>
<li><p>çº¿æ€§å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
s_{i}=\left\{\begin{array}{ll}s_{i}, & \text { iou }\left(\mathcal{M}, b_{i}\right)<N_{t} \\ s_{i}\left(1-\mathrm{i} o \mathrm{u}\left(\mathcal{M}, b_{i}\right)\right), & \text { iou }\left(\mathcal{M}, b_{i}\right) \geq N_{t}\end{array}\right.</script></li>
<li><p>é«˜æ–¯å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\boldsymbol{s}_{i}=\boldsymbol{s}_{i} e^{\frac{-\mathrm{iou}\left(\mathcal{M}, \boldsymbol{b}_{i}\right)^{2}}{\sigma}}, \forall b_{i} \notin \mathcal{D}</script></li>
</ul>
<h2 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ä½œè€…çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cpu_soft_nms</span>(<span class="params">np.ndarray[<span class="built_in">float</span>, ndim=<span class="number">2</span>] boxes, <span class="built_in">float</span> sigma=<span class="number">0.5</span>, <span class="built_in">float</span> Nt=<span class="number">0.3</span>, <span class="built_in">float</span> threshold=<span class="number">0.001</span>, unsigned <span class="built_in">int</span> method=<span class="number">0</span></span>):</span></span><br><span class="line">    cdef unsigned <span class="built_in">int</span> N = boxes.shape[<span class="number">0</span>]</span><br><span class="line">    cdef <span class="built_in">float</span> iw, ih, box_area</span><br><span class="line">    cdef <span class="built_in">float</span> ua</span><br><span class="line">    cdef <span class="built_in">int</span> pos = <span class="number">0</span></span><br><span class="line">    cdef <span class="built_in">float</span> maxscore = <span class="number">0</span></span><br><span class="line">    cdef <span class="built_in">int</span> maxpos = <span class="number">0</span></span><br><span class="line">    cdef <span class="built_in">float</span> x1,x2,y1,y2,tx1,tx2,ty1,ty2,ts,area,weight,ov</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        maxscore = boxes[i, <span class="number">4</span>]</span><br><span class="line">        maxpos = i</span><br><span class="line"></span><br><span class="line">        tx1 = boxes[i,<span class="number">0</span>]</span><br><span class="line">        ty1 = boxes[i,<span class="number">1</span>]</span><br><span class="line">        tx2 = boxes[i,<span class="number">2</span>]</span><br><span class="line">        ty2 = boxes[i,<span class="number">3</span>]</span><br><span class="line">        ts = boxes[i,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">        pos = i + <span class="number">1</span></span><br><span class="line">    <span class="comment"># get max box</span></span><br><span class="line">        <span class="keyword">while</span> pos &lt; N:</span><br><span class="line">            <span class="keyword">if</span> maxscore &lt; boxes[pos, <span class="number">4</span>]:</span><br><span class="line">                maxscore = boxes[pos, <span class="number">4</span>]</span><br><span class="line">                maxpos = pos</span><br><span class="line">            pos = pos + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># add max box as a detection</span></span><br><span class="line">        boxes[i,<span class="number">0</span>] = boxes[maxpos,<span class="number">0</span>]</span><br><span class="line">        boxes[i,<span class="number">1</span>] = boxes[maxpos,<span class="number">1</span>]</span><br><span class="line">        boxes[i,<span class="number">2</span>] = boxes[maxpos,<span class="number">2</span>]</span><br><span class="line">        boxes[i,<span class="number">3</span>] = boxes[maxpos,<span class="number">3</span>]</span><br><span class="line">        boxes[i,<span class="number">4</span>] = boxes[maxpos,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># swap ith box with position of max box</span></span><br><span class="line">        boxes[maxpos,<span class="number">0</span>] = tx1</span><br><span class="line">        boxes[maxpos,<span class="number">1</span>] = ty1</span><br><span class="line">        boxes[maxpos,<span class="number">2</span>] = tx2</span><br><span class="line">        boxes[maxpos,<span class="number">3</span>] = ty2</span><br><span class="line">        boxes[maxpos,<span class="number">4</span>] = ts</span><br><span class="line"></span><br><span class="line">        tx1 = boxes[i,<span class="number">0</span>]</span><br><span class="line">        ty1 = boxes[i,<span class="number">1</span>]</span><br><span class="line">        tx2 = boxes[i,<span class="number">2</span>]</span><br><span class="line">        ty2 = boxes[i,<span class="number">3</span>]</span><br><span class="line">        ts = boxes[i,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">        pos = i + <span class="number">1</span></span><br><span class="line">    <span class="comment"># NMS iterations, note that N changes if detection boxes fall below threshold</span></span><br><span class="line">        <span class="keyword">while</span> pos &lt; N:</span><br><span class="line">            x1 = boxes[pos, <span class="number">0</span>]</span><br><span class="line">            y1 = boxes[pos, <span class="number">1</span>]</span><br><span class="line">            x2 = boxes[pos, <span class="number">2</span>]</span><br><span class="line">            y2 = boxes[pos, <span class="number">3</span>]</span><br><span class="line">            s = boxes[pos, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">            area = (x2 - x1 + <span class="number">1</span>) * (y2 - y1 + <span class="number">1</span>)</span><br><span class="line">            iw = (<span class="built_in">min</span>(tx2, x2) - <span class="built_in">max</span>(tx1, x1) + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> iw &gt; <span class="number">0</span>:</span><br><span class="line">                ih = (<span class="built_in">min</span>(ty2, y2) - <span class="built_in">max</span>(ty1, y1) + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> ih &gt; <span class="number">0</span>:</span><br><span class="line">                    ua = <span class="built_in">float</span>((tx2 - tx1 + <span class="number">1</span>) * (ty2 - ty1 + <span class="number">1</span>) + area - iw * ih)</span><br><span class="line">                    ov = iw * ih / ua <span class="comment">#iou between max box and detection box</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> method == <span class="number">1</span>: <span class="comment"># linear</span></span><br><span class="line">                        <span class="keyword">if</span> ov &gt; Nt:</span><br><span class="line">                            weight = <span class="number">1</span> - ov</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            weight = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> method == <span class="number">2</span>: <span class="comment"># gaussian</span></span><br><span class="line">                        weight = np.exp(-(ov * ov)/sigma)</span><br><span class="line">                    <span class="keyword">else</span>: <span class="comment"># original NMS</span></span><br><span class="line">                        <span class="keyword">if</span> ov &gt; Nt:</span><br><span class="line">                            weight = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            weight = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    boxes[pos, <span class="number">4</span>] = weight*boxes[pos, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if box score falls below threshold, discard the box by swapping with last box</span></span><br><span class="line">            <span class="comment"># update N</span></span><br><span class="line">                    <span class="keyword">if</span> boxes[pos, <span class="number">4</span>] &lt; threshold:</span><br><span class="line">                        boxes[pos,<span class="number">0</span>] = boxes[N-<span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">                        boxes[pos,<span class="number">1</span>] = boxes[N-<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">                        boxes[pos,<span class="number">2</span>] = boxes[N-<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">                        boxes[pos,<span class="number">3</span>] = boxes[N-<span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">                        boxes[pos,<span class="number">4</span>] = boxes[N-<span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line">                        N = N - <span class="number">1</span></span><br><span class="line">                        pos = pos - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            pos = pos + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    keep = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">    <span class="keyword">return</span> keep</span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœ-1"><a href="#æ•ˆæœ-1" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/nms/643.webp" alt></p>
<p>å·¦è¾¹æ˜¯ä½¿ç”¨äº†NMSçš„æ•ˆæœï¼Œå³è¾¹æ˜¯ä½¿ç”¨äº†Soft-NMSçš„æ•ˆæœ</p>
<h2 id="è®ºæ–‡çš„å®éªŒç»“æœ"><a href="#è®ºæ–‡çš„å®éªŒç»“æœ" class="headerlink" title="è®ºæ–‡çš„å®éªŒç»“æœ"></a>è®ºæ–‡çš„å®éªŒç»“æœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/nms/644.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨MS-COCOæ•°æ®é›†ä¸ŠmAP[0.5:0.95]å¯ä»¥è·å¾—å¤§çº¦1%çš„æå‡ï¼Œå¦‚æœåº”ç”¨åˆ°è®­ç»ƒé˜¶æ®µçš„proposalé€‰å–è¿‡ç¨‹ç†è®ºä¸Šä¹Ÿèƒ½è·å¾—æå‡ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œsoft-NMSåœ¨ä¸æ˜¯åŸºäºProposalçš„æ–¹æ³•å¦‚SSDï¼ŒYOLOä¸­æ²¡ä»€ä¹ˆæå‡ã€‚è¿™é‡ŒçŒœæµ‹åŸå› å¯èƒ½æ˜¯å› ä¸ºYOLOå’ŒSSDäº§ç”Ÿçš„æ¡†é‡å ç‡è¾ƒä½å¼•èµ·çš„ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å›å½’æŸå¤±å‡½æ•°ï¼šL1 loss, L2 lossä»¥åŠSmooth L1 Lossçš„å¯¹æ¯”</title>
    <url>/2020/05/08/%E5%9B%9E%E5%BD%92%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%EF%BC%9AL1-loss,-L2-loss%E4%BB%A5%E5%8F%8ASmooth-L1-Loss%E7%9A%84%E5%AF%B9%E6%AF%94/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ€»ç»“å¯¹æ¯”ä¸‹$L_{1}$æŸå¤±å‡½æ•°ï¼Œ$L_{2}$æŸå¤±å‡½æ•°ä»¥åŠæŸ$SmoothL_{1}$å¤±å‡½æ•°çš„ä¼˜ç¼ºç‚¹ã€‚</p>
<h2 id="å‡æ–¹è¯¯å·®MSE-L-2-Loss"><a href="#å‡æ–¹è¯¯å·®MSE-L-2-Loss" class="headerlink" title="å‡æ–¹è¯¯å·®MSE ($L_{2}$ Loss)"></a>å‡æ–¹è¯¯å·®MSE ($L_{2}$ Loss)</h2><p>å‡æ–¹è¯¯å·®ï¼ˆMean Square Error,MSEï¼‰æ˜¯æ¨¡å‹é¢„æµ‹å€¼$f(x)$ä¸çœŸå®æ ·æœ¬å€¼$y$ä¹‹é—´å·®å€¼å¹³æ–¹çš„å¹³å‡å€¼ï¼Œå…¶å…¬å¼å¦‚ä¸‹</p>
<script type="math/tex; mode=display">
M S E=\frac{\sum_{i=1}^{n}\left(f_{x_{i}}-y_{i}\right)^{2}}{n}</script><p>å…¶ä¸­ï¼Œ$\boldsymbol{y}_{i}$å’Œ$f\left(x_{i}\right)$åˆ†åˆ«è¡¨ç¤ºç¬¬$i$ä¸ªæ ·æœ¬çš„çœŸå®å€¼åŠå…¶å¯¹åº”çš„é¢„æµ‹å€¼ï¼Œ$n$ä¸ºæ ·æœ¬çš„ä¸ªæ•°ã€‚</p>
<p>å¿½ç•¥ä¸‹æ ‡$i$ ï¼Œè®¾$n=1$ï¼Œä»¥$f(x)âˆ’y$ä¸ºæ¨ªè½´ï¼ŒMSEçš„å€¼ä¸ºçºµè½´ï¼Œå¾—åˆ°å‡½æ•°çš„å›¾å½¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/loss/1.png" alt></p>
<p>MSEçš„å‡½æ•°æ›²çº¿å…‰æ»‘ã€è¿ç»­ï¼Œå¤„å¤„å¯å¯¼ï¼Œä¾¿äºä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„æŸå¤±å‡½æ•°ã€‚ è€Œä¸”ï¼Œéšç€è¯¯å·®çš„å‡å°ï¼Œæ¢¯åº¦ä¹Ÿåœ¨å‡å°ï¼Œè¿™æœ‰åˆ©äºæ”¶æ•›ï¼Œå³ä½¿ä½¿ç”¨å›ºå®šçš„å­¦ä¹ é€Ÿç‡ï¼Œä¹Ÿèƒ½è¾ƒå¿«çš„æ”¶æ•›åˆ°æœ€å°å€¼ã€‚</p>
<p>å½“$y$å’Œ$f(x)$ä¹Ÿå°±æ˜¯çœŸå®å€¼å’Œé¢„æµ‹å€¼çš„å·®å€¼å¤§äº1æ—¶ï¼Œä¼šæ”¾å¤§è¯¯å·®ï¼›è€Œå½“å·®å€¼å°äº1æ—¶ï¼Œåˆ™ä¼šç¼©å°è¯¯å·®ï¼Œè¿™æ˜¯å¹³æ–¹è¿ç®—å†³å®šçš„ã€‚MSEå¯¹äºè¾ƒå¤§çš„è¯¯å·®ï¼ˆ&gt;1ï¼‰ç»™äºˆè¾ƒå¤§çš„æƒ©ç½šï¼Œè¾ƒå°çš„è¯¯å·®ï¼ˆ&lt;1ï¼‰ç»™äºˆè¾ƒå°çš„æƒ©ç½šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹ç¦»ç¾¤ç‚¹æ¯”è¾ƒæ•æ„Ÿï¼Œå—å…¶å½±å“è¾ƒå¤§ã€‚</p>
<p>å¦‚æœæ ·æœ¬ä¸­å­˜åœ¨ç¦»ç¾¤ç‚¹ï¼ŒMSEä¼šç»™ç¦»ç¾¤ç‚¹æ›´é«˜çš„æƒé‡ï¼Œè¿™å°±ä¼šç‰ºç‰²å…¶ä»–æ­£å¸¸ç‚¹æ•°æ®çš„é¢„æµ‹æ•ˆæœï¼Œæœ€ç»ˆé™ä½æ•´ä½“çš„æ¨¡å‹æ€§èƒ½ã€‚ å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/loss/2.png" alt></p>
<p>å¯è§ï¼Œä½¿ç”¨ MSE æŸå¤±å‡½æ•°ï¼Œå—ç¦»ç¾¤ç‚¹çš„å½±å“è¾ƒå¤§ï¼Œè™½ç„¶æ ·æœ¬ä¸­åªæœ‰ 5 ä¸ªç¦»ç¾¤ç‚¹ï¼Œä½†æ˜¯æ‹Ÿåˆçš„ç›´çº¿è¿˜æ˜¯æ¯”è¾ƒåå‘äºç¦»ç¾¤ç‚¹ã€‚</p>
<h2 id="å¹³å‡ç»å¯¹è¯¯å·®-L-1-Loss"><a href="#å¹³å‡ç»å¯¹è¯¯å·®-L-1-Loss" class="headerlink" title="å¹³å‡ç»å¯¹è¯¯å·®($L_{1}$ Loss)"></a>å¹³å‡ç»å¯¹è¯¯å·®($L_{1}$ Loss)</h2><p>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMean Absolute Error,MAE) æ˜¯æŒ‡æ¨¡å‹é¢„æµ‹å€¼$f(x)$å’ŒçœŸå®å€¼$y$ä¹‹é—´è·ç¦»ç»å¯¹å€¼çš„å¹³å‡å€¼ï¼Œå…¶å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
M A E=\frac{\sum_{n=1}^{n}\left|f\left(x_{i}\right)-y_{i}\right|}{n}</script><p>å¿½ç•¥ä¸‹æ ‡$i$ ï¼Œè®¾$n=1$ï¼Œä»¥$f(x)âˆ’y$ä¸ºæ¨ªè½´ï¼ŒMAEçš„å€¼ä¸ºçºµè½´ï¼Œå¾—åˆ°å‡½æ•°çš„å›¾å½¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/loss/3.png" alt></p>
<p>MAEæ›²çº¿è¿ç»­ï¼Œä½†æ˜¯åœ¨$yâˆ’f(x)=0$å¤„ä¸å¯å¯¼ã€‚è€Œä¸” MAE å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ¢¯åº¦éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œè¿™æ„å‘³ç€å³ä½¿å¯¹äºå°çš„æŸå¤±å€¼ï¼Œå…¶æ¢¯åº¦ä¹Ÿæ˜¯å¤§çš„ã€‚è¿™ä¸åˆ©äºå‡½æ•°çš„æ”¶æ•›å’Œæ¨¡å‹çš„å­¦ä¹ ã€‚ä½†æ˜¯ï¼Œæ— è®ºå¯¹äºä»€ä¹ˆæ ·çš„è¾“å…¥å€¼ï¼Œéƒ½æœ‰ç€ç¨³å®šçš„æ¢¯åº¦ï¼Œä¸ä¼šå¯¼è‡´æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œå…·æœ‰è¾ƒä¸ºç¨³å¥æ€§çš„è§£ã€‚</p>
<p>ç›¸æ¯”äºMSEï¼ŒMAEæœ‰ä¸ªä¼˜ç‚¹å°±æ˜¯ï¼Œå¯¹äºç¦»ç¾¤ç‚¹ä¸é‚£ä¹ˆæ•æ„Ÿã€‚å› ä¸ºMAEè®¡ç®—çš„æ˜¯è¯¯å·®$yâˆ’f(x)$çš„ç»å¯¹å€¼ï¼Œå¯¹äºä»»æ„å¤§å°çš„å·®å€¼ï¼Œå…¶æƒ©ç½šéƒ½æ˜¯å›ºå®šçš„ã€‚</p>
<p>é’ˆå¯¹ä¸Šé¢å¸¦æœ‰ç¦»ç¾¤ç‚¹çš„æ•°æ®ï¼ŒMAEçš„æ•ˆæœè¦å¥½äºMSEã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/loss/4.png" alt></p>
<p>æ˜¾ç„¶ï¼Œä½¿ç”¨ MAE æŸå¤±å‡½æ•°ï¼Œå—ç¦»ç¾¤ç‚¹çš„å½±å“è¾ƒå°ï¼Œæ‹Ÿåˆç›´çº¿èƒ½å¤Ÿè¾ƒå¥½åœ°è¡¨å¾æ­£å¸¸æ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<h2 id="MSEå’ŒMAEçš„é€‰æ‹©"><a href="#MSEå’ŒMAEçš„é€‰æ‹©" class="headerlink" title="MSEå’ŒMAEçš„é€‰æ‹©"></a>MSEå’ŒMAEçš„é€‰æ‹©</h2><ul>
<li>ä»æ¢¯åº¦çš„æ±‚è§£ä»¥åŠæ”¶æ•›ä¸Šï¼ŒMSEæ˜¯ä¼˜äºMAEçš„ã€‚MSEå¤„å¤„å¯å¯¼ï¼Œè€Œä¸”æ¢¯åº¦å€¼ä¹Ÿæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„æ”¶æ•›ï¼›è€ŒMAEåœ¨0ç‚¹å¤„ä¸å¯å¯¼ï¼Œä¸”å…¶æ¢¯åº¦ä¿æŒä¸å˜ã€‚å¯¹äºå¾ˆå°çš„æŸå¤±å€¼å…¶æ¢¯åº¦ä¹Ÿå¾ˆå¤§ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨å˜åŒ–çš„å­¦ä¹ ç‡ï¼Œåœ¨æŸå¤±å€¼å¾ˆå°æ—¶é™ä½å­¦ä¹ ç‡ã€‚</li>
<li>å¯¹ç¦»ç¾¤ï¼ˆå¼‚å¸¸ï¼‰å€¼çš„å¤„ç†ä¸Šï¼ŒMAEè¦æ˜æ˜¾å¥½äºMSEã€‚</li>
</ul>
<p>å¦‚æœç¦»ç¾¤ç‚¹ï¼ˆå¼‚å¸¸å€¼ï¼‰éœ€è¦è¢«æ£€æµ‹å‡ºæ¥ï¼Œåˆ™å¯ä»¥é€‰æ‹©MSEä½œä¸ºæŸå¤±å‡½æ•°ï¼›å¦‚æœç¦»ç¾¤ç‚¹åªæ˜¯å½“åšå—æŸçš„æ•°æ®å¤„ç†ï¼Œåˆ™å¯ä»¥é€‰æ‹©MAEä½œä¸ºæŸå¤±å‡½æ•°ã€‚</p>
<p>æ€»ä¹‹ï¼ŒMAEä½œä¸ºæŸå¤±å‡½æ•°æ›´ç¨³å®šï¼Œå¹¶ä¸”å¯¹ç¦»ç¾¤å€¼ä¸æ•æ„Ÿï¼Œä½†æ˜¯å…¶å¯¼æ•°ä¸è¿ç»­ï¼Œæ±‚è§£æ•ˆç‡ä½ã€‚å¦å¤–ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæ”¶æ•›è¾ƒæ…¢ã€‚MSEå¯¼æ•°æ±‚è§£é€Ÿåº¦é«˜ï¼Œä½†æ˜¯å…¶å¯¹ç¦»ç¾¤å€¼æ•æ„Ÿï¼Œä¸è¿‡å¯ä»¥å°†ç¦»ç¾¤å€¼çš„å¯¼æ•°è®¾ä¸º0ï¼ˆå¯¼æ•°å€¼å¤§äºæŸä¸ªé˜ˆå€¼ï¼‰æ¥é¿å…è¿™ç§æƒ…å†µã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸Šè¿°ä¸¤ç§æŸå¤±å‡½æ•°éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œè‹¥æ•°æ®ä¸­90%çš„æ ·æœ¬å¯¹åº”çš„ç›®æ ‡å€¼ä¸º150ï¼Œå‰©ä¸‹10%åœ¨0åˆ°30ä¹‹é—´ã€‚é‚£ä¹ˆä½¿ç”¨MAEä½œä¸ºæŸå¤±å‡½æ•°çš„æ¨¡å‹å¯èƒ½ä¼šå¿½è§†10%çš„å¼‚å¸¸ç‚¹ï¼Œè€Œå¯¹æ‰€æœ‰æ ·æœ¬çš„é¢„æµ‹å€¼éƒ½ä¸º150ã€‚è¿™æ˜¯å› ä¸ºæ¨¡å‹ä¼šæŒ‰ä¸­ä½æ•°æ¥é¢„æµ‹ã€‚è€Œä½¿ç”¨MSEçš„æ¨¡å‹åˆ™ä¼šç»™å‡ºå¾ˆå¤šä»‹äº0åˆ°30çš„é¢„æµ‹å€¼ï¼Œå› ä¸ºæ¨¡å‹ä¼šå‘å¼‚å¸¸ç‚¹åç§»ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼ŒMSEå’ŒMAEéƒ½æ˜¯ä¸å¯å–çš„ï¼Œç®€å•çš„åŠæ³•æ˜¯å¯¹ç›®æ ‡å˜é‡è¿›è¡Œå˜æ¢ï¼Œæˆ–è€…ä½¿ç”¨åˆ«çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚ï¼šHuber,Log-Coshä»¥åŠåˆ†ä½æ•°æŸå¤±ç­‰ã€‚</p>
<h2 id="Smooth-L-1-Loss"><a href="#Smooth-L-1-Loss" class="headerlink" title="Smooth $L_{1}$ Loss"></a>Smooth $L_{1}$ Loss</h2><p>åœ¨Faster R-CNNä»¥åŠSSDä¸­å¯¹è¾¹æ¡†çš„å›å½’ä½¿ç”¨çš„æŸå¤±å‡½æ•°éƒ½æ˜¯Smooth $L_{1}$ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œ</p>
<script type="math/tex; mode=display">
\operatorname{Smooth} L_{1}(x)=\left\{\begin{array}{cc}0.5 x^{2} & \text { if }|x|<1 \\ |x|-0.5 & \text { otherwise }\end{array}\right.</script><p>å…¶ä¸­ï¼Œ$x=f(x_{i})âˆ’y_{i}$ä¸ºçœŸå®å€¼å’Œé¢„æµ‹å€¼çš„å·®å€¼ã€‚</p>
<p>Smooth $L_{1}$èƒ½ä»ä¸¤ä¸ªæ–¹é¢é™åˆ¶æ¢¯åº¦ï¼š</p>
<ol>
<li>å½“é¢„æµ‹æ¡†ä¸ ground truth å·®åˆ«è¿‡å¤§æ—¶ï¼Œæ¢¯åº¦å€¼ä¸è‡³äºè¿‡å¤§ï¼›</li>
<li>å½“é¢„æµ‹æ¡†ä¸ ground truth å·®åˆ«å¾ˆå°æ—¶ï¼Œæ¢¯åº¦å€¼è¶³å¤Ÿå°ã€‚</li>
</ol>
<h2 id="å¯¹æ¯”-L-1-Losså’Œ-L-2-Loss"><a href="#å¯¹æ¯”-L-1-Losså’Œ-L-2-Loss" class="headerlink" title="å¯¹æ¯”$L_{1}$ Losså’Œ $L_{2}$ Loss"></a>å¯¹æ¯”$L_{1}$ Losså’Œ $L_{2}$ Loss</h2><p>å…¶ä¸­$x$ä¸ºé¢„æµ‹æ¡†ä¸groud truthä¹‹é—´çš„å·®å¼‚ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned} L_{2}(x) &=x^{2}\\ L_{1}(x) &=x\\ \operatorname{smooth}_{L_{1}}(x) &=\left\{\begin{array}{cc}0.5 x^{2} & \text { if }|x|<1 \\ |x|-0.5 & \text { otherwise }\end{array}\right.\end{aligned}</script><p>ä¸Šé¢æŸå¤±å‡½æ•°å¯¹$x$çš„å¯¼æ•°ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned} \frac{\partial L_{2}(x)}{\partial x} &=2 x \\ \frac{\partial L_{1}(x)}{\partial x} &=\left\{\begin{array}{cc}1 & \text { if } x \geq 0 \\ -1 & \text { otherwise }\end{array}\right.\\ \frac{\partial s m o o t h_{L_{1}}(x)}{\partial x} &=\left\{\begin{array}{cc}x & \text { if }|x|<1 \\ \pm 1 & \text { otherwise }\end{array}\right.\end{aligned}</script><p>ä¸Šé¢å¯¼æ•°å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><p>æ ¹æ®å…¬å¼-4ï¼Œå½“$x$å¢å¤§æ—¶ï¼Œ$L_{2}$çš„æŸå¤±ä¹Ÿå¢å¤§ã€‚ è¿™å°±å¯¼è‡´åœ¨è®­ç»ƒåˆæœŸï¼Œé¢„æµ‹å€¼ä¸groud truthå·®å¼‚è¿‡äºå¤§æ—¶ï¼ŒæŸå¤±å‡½æ•°å¯¹é¢„æµ‹å€¼çš„æ¢¯åº¦ååˆ†å¤§ï¼Œè®­ç»ƒä¸ç¨³å®šã€‚</p>
</li>
<li><p>æ ¹æ®å…¬å¼-5ï¼Œ$L_{1}$å¯¹$x$çš„å¯¼æ•°ä¸ºå¸¸æ•°ï¼Œåœ¨è®­ç»ƒçš„åæœŸï¼Œé¢„æµ‹å€¼ä¸ground truthå·®å¼‚å¾ˆå°æ—¶ï¼Œ$L_{1}$çš„å¯¼æ•°çš„ç»å¯¹å€¼ä»ç„¶ä¸º1ï¼Œè€Œlearning rateå¦‚æœä¸å˜ï¼ŒæŸå¤±å‡½æ•°å°†åœ¨ç¨³å®šå€¼é™„è¿‘æ³¢åŠ¨ï¼Œéš¾ä»¥ç»§ç»­æ”¶æ•›ä»¥è¾¾åˆ°æ›´é«˜ç²¾åº¦ã€‚</p>
</li>
<li><p>æ ¹æ®å…¬å¼-6ï¼Œ$Smooth L_{1}$åœ¨$x$è¾ƒå°æ—¶ï¼Œå¯¹$x$çš„æ¢¯åº¦ä¹Ÿä¼šå˜å°ã€‚ è€Œå½“$x$è¾ƒå¤§æ—¶ï¼Œå¯¹$x$çš„æ¢¯åº¦çš„ä¸Šé™ä¸º1ï¼Œä¹Ÿä¸ä¼šå¤ªå¤§ä»¥è‡³äºç ´åç½‘ç»œå‚æ•°ã€‚$Smooth L_{1}$å®Œç¾çš„é¿å¼€äº†$L_{1}$å’Œ$L_{2}$ä½œä¸ºæŸå¤±å‡½æ•°çš„ç¼ºé™·ã€‚</p>
</li>
</ul>
<p>$L_{1}$ Lossï¼Œ$L_{2}$ Lossä»¥åŠ$Smooth L_{1}$æ”¾åœ¨ä¸€èµ·çš„å‡½æ•°æ›²çº¿å¯¹æ¯”</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/loss/5.png" alt></p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œè¯¥å‡½æ•°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåˆ†æ®µå‡½æ•°ï¼Œåœ¨[-1,1]ä¹‹é—´å®é™…ä¸Šå°±æ˜¯L2æŸå¤±ï¼Œè¿™æ ·è§£å†³äº†L1çš„ä¸å…‰æ»‘é—®é¢˜ï¼Œåœ¨[-1,1]åŒºé—´å¤–ï¼Œå®é™…ä¸Šå°±æ˜¯L1æŸå¤±ï¼Œè¿™æ ·å°±è§£å†³äº†ç¦»ç¾¤ç‚¹æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜</p>
<h2 id="å®ç°-PyTorch"><a href="#å®ç°-PyTorch" class="headerlink" title="å®ç° (PyTorch)"></a>å®ç° (PyTorch)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_smooth_l1_loss</span>(<span class="params"><span class="built_in">input</span>, target, reduction=<span class="string">&#x27;none&#x27;</span></span>):</span></span><br><span class="line">    <span class="comment"># type: (Tensor, Tensor) -&gt; Tensor</span></span><br><span class="line">    t = torch.<span class="built_in">abs</span>(<span class="built_in">input</span> - target)</span><br><span class="line">    ret = torch.where(t &lt; <span class="number">1</span>, <span class="number">0.5</span> * t ** <span class="number">2</span>, t - <span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">if</span> reduction != <span class="string">&#x27;none&#x27;</span>:</span><br><span class="line">        ret = torch.mean(ret) <span class="keyword">if</span> reduction == <span class="string">&#x27;mean&#x27;</span> <span class="keyword">else</span> torch.<span class="built_in">sum</span>(ret)</span><br><span class="line">    <span class="keyword">return</span> ret      </span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ·»åŠ ä¸ªå‚æ•°<code>beta</code> è¿™æ ·å°±å¯ä»¥æ§åˆ¶ï¼Œä»€ä¹ˆèŒƒå›´çš„è¯¯å·®ä½¿ç”¨MSEï¼Œä»€ä¹ˆèŒƒå›´å†…çš„è¯¯å·®ä½¿ç”¨MAEäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">smooth_l1_loss</span>(<span class="params"><span class="built_in">input</span>, target, beta=<span class="number">1.</span> / <span class="number">9</span>, reduction = <span class="string">&#x27;none&#x27;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    very similar to the smooth_l1_loss from pytorch, but with</span></span><br><span class="line"><span class="string">    the extra beta parameter</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    n = torch.<span class="built_in">abs</span>(<span class="built_in">input</span> - target)</span><br><span class="line">    cond = n &lt; beta</span><br><span class="line">    ret = torch.where(cond, <span class="number">0.5</span> * n ** <span class="number">2</span> / beta, n - <span class="number">0.5</span> * beta)</span><br><span class="line">    <span class="keyword">if</span> reduction != <span class="string">&#x27;none&#x27;</span>:</span><br><span class="line">        ret = torch.mean(ret) <span class="keyword">if</span> reduction == <span class="string">&#x27;mean&#x27;</span> <span class="keyword">else</span> torch.<span class="built_in">sum</span>(ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹äºå¤§å¤šæ•°CNNç½‘ç»œï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä½¿ç”¨L2-lossè€Œä¸æ˜¯L1-lossï¼Œå› ä¸ºL2-lossçš„æ”¶æ•›é€Ÿåº¦è¦æ¯”L1-lossè¦å¿«å¾—å¤šã€‚</p>
<p>å¯¹äºè¾¹æ¡†é¢„æµ‹å›å½’é—®é¢˜ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥é€‰æ‹©å¹³æ–¹æŸå¤±å‡½æ•°ï¼ˆL2æŸå¤±ï¼‰ï¼Œä½†L2èŒƒæ•°çš„ç¼ºç‚¹æ˜¯å½“å­˜åœ¨ç¦»ç¾¤ç‚¹ï¼ˆoutliers)çš„æ—¶å€™ï¼Œè¿™äº›ç‚¹ä¼šå lossçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚æ¯”å¦‚è¯´çœŸå®å€¼ä¸º1ï¼Œé¢„æµ‹10æ¬¡ï¼Œæœ‰ä¸€æ¬¡é¢„æµ‹å€¼ä¸º1000ï¼Œå…¶ä½™æ¬¡çš„é¢„æµ‹å€¼ä¸º1å·¦å³ï¼Œæ˜¾ç„¶losså€¼ä¸»è¦ç”±1000å†³å®šã€‚æ‰€ä»¥FastRCNNé‡‡ç”¨ç¨å¾®ç¼“å’Œä¸€ç‚¹ç»å¯¹æŸå¤±å‡½æ•°ï¼ˆsmooth L1æŸå¤±ï¼‰ï¼Œå®ƒæ˜¯éšç€è¯¯å·®çº¿æ€§å¢é•¿ï¼Œè€Œä¸æ˜¯å¹³æ–¹å¢é•¿ã€‚</p>
<p>Smooth L1 å’Œ L1 Loss å‡½æ•°çš„åŒºåˆ«åœ¨äºï¼ŒL1 Loss åœ¨0ç‚¹å¤„å¯¼æ•°ä¸å”¯ä¸€ï¼Œå¯èƒ½å½±å“æ”¶æ•›ã€‚Smooth L1çš„è§£å†³åŠæ³•æ˜¯åœ¨ 0 ç‚¹é™„è¿‘ä½¿ç”¨å¹³æ–¹å‡½æ•°ä½¿å¾—å®ƒæ›´åŠ å¹³æ»‘ã€‚</p>
<p>Smooth L1çš„ä¼˜ç‚¹</p>
<ul>
<li>ç›¸æ¯”äºL1æŸå¤±å‡½æ•°ï¼Œå¯ä»¥æ”¶æ•›å¾—æ›´å¿«ã€‚</li>
<li>ç›¸æ¯”äºL2æŸå¤±å‡½æ•°ï¼Œå¯¹ç¦»ç¾¤ç‚¹ã€å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼Œæ¢¯åº¦å˜åŒ–ç›¸å¯¹æ›´å°ï¼Œè®­ç»ƒæ—¶ä¸å®¹æ˜“è·‘é£ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>CNNç»“æ„æ— ç—›æ¶¨ç‚¹æŠ€å·§ï¼šACNet</title>
    <url>/2020/04/17/CNN%E7%BB%93%E6%9E%84%E6%97%A0%E7%97%9B%E6%B6%A8%E7%82%B9%E6%8A%80%E5%B7%A7%EF%BC%9AACNet/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>CNNçš„ç»“æ„åˆ›æ–°åœ¨è¿™ä¸¤å¹´å·²ç»å˜å¾—ç›¸å¯¹å¾ˆå°‘äº†ï¼ŒåŒæ—¶è¦åšå‡ºæœ‰å½±å“åŠ›å¹¶ä¸”Solidçš„å·¥ä½œä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾ï¼Œæœ€è¿‘CNNç»“æ„æ–¹é¢çš„åˆ›æ–°ä¸»è¦åŒ…å«ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ç½‘ç»œç»“æ„æœç´¢ï¼Œä»¥Google Brainçš„EfficientNetä¸ºä»£è¡¨ä½œã€‚</li>
<li>è·å–æ›´å¥½çš„ç‰¹å¾è¡¨è¾¾ï¼Œä¸»è¦æ˜¯å°†ç‰¹å¾å¤ç”¨ï¼Œç‰¹å¾ç»†åŒ–åšå¾—æ›´åŠ æè‡´ï¼Œä»¥HRNetï¼ŒRes2Netç­‰ä¸ºä»£è¡¨ä½œã€‚</li>
</ul>
<p>æœ¬æ–‡è¦ä»‹ç»çš„æ˜¯ICCV 2019çš„ä¸€ä¸ªæ–°CNNæ¶æ„ACNetï¼ˆå…¨ç§°ä¸ºAsymmetric Convolution  Netï¼‰ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯è®²æ¸…æ¥šACNetçš„åŸç†å¹¶æ€»ç»“å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼Œå¦å¤–å€ŸåŠ©ä½œè€…å¼€æºçš„Pytorchä»£ç ç«¯æ¥åŠ æ·±ç†è§£ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ACNetçš„åˆ‡å…¥ç‚¹ä¸ºè·å–æ›´å¥½çš„ç‰¹å¾è¡¨è¾¾ï¼Œä½†å’Œå…¶å®ƒæ–¹æ³•æœ€å¤§çš„åŒºåˆ«åœ¨äºå®ƒæ²¡æœ‰å¸¦æ¥é¢å¤–çš„è¶…å‚æ•°ï¼Œè€Œä¸”åœ¨æ¨ç†é˜¶æ®µæ²¡æœ‰å¢åŠ è®¡ç®—é‡ï¼Œè¿™æ˜¯ååˆ†å…·æœ‰å¸å¼•åŠ›çš„ã€‚</p>
<p>åœ¨æ­£å¼ä»‹ç»ACNetä¹‹å‰ï¼Œé¦–å…ˆæ¥æ˜ç¡®ä¸€ä¸‹å…³äºå·ç§¯è®¡ç®—çš„ä¸€ä¸ªç­‰å¼ï¼Œè¿™ä¸ªç­‰å¼è¡¨è¾¾çš„æ„æ€å°±æ˜¯<strong>ã€Œå¯¹äºè¾“å…¥ç‰¹å¾å›¾$I$ï¼Œå…ˆè¿›è¡Œ$K^{(1)}$å’Œ$I$å·ç§¯ï¼Œ$K^{(2)}$å’Œ$I$å·ç§¯åå†å¯¹ç»“æœè¿›è¡Œç›¸åŠ ï¼Œä¸å…ˆè¿›è¡Œ$K^{(1)}$å’Œ$K^{(2)}$çš„é€ç‚¹ç›¸åŠ åå†å’Œ$I$è¿›è¡Œå·ç§¯å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€</strong>ã€‚è¿™ä¹Ÿæ˜¯ACNetåœ¨æ¨ç†é˜¶æ®µä¸å¢åŠ ä»»ä½•è®¡ç®—é‡çš„ç†è®ºåŸºç¡€ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/640.png" alt></p>
<h2 id="ACNetåŸç†"><a href="#ACNetåŸç†" class="headerlink" title="ACNetåŸç†"></a>ACNetåŸç†</h2><p>ä¸‹é¢çš„Figure1å±•ç¤ºäº†ACNetçš„æ€æƒ³ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/641.png" alt></p>
<p>å®è§‚ä¸Šæ¥çœ‹<strong>ã€ŒACNetåˆ†ä¸ºè®­ç»ƒå’Œæ¨ç†é˜¶æ®µï¼Œè®­ç»ƒé˜¶æ®µé‡ç‚¹åœ¨äºå¼ºåŒ–ç‰¹å¾æå–ï¼Œå®ç°æ•ˆæœæå‡ã€‚è€Œæµ‹è¯•é˜¶æ®µé‡ç‚¹åœ¨äºå·ç§¯æ ¸èåˆï¼Œä¸å¢åŠ ä»»ä½•è®¡ç®—é‡ã€</strong>ã€‚</p>
<ul>
<li><p><strong>ã€Œè®­ç»ƒé˜¶æ®µã€</strong>ï¼šå› ä¸º3 x 3å·ç§¯æ˜¯å¤§å¤šæ•°ç½‘ç»œçš„åŸºç¡€ç»„ä»¶ï¼Œå› æ­¤ACNetçš„å®éªŒéƒ½æ˜¯é’ˆå¯¹3 x 3å·ç§¯è¿›è¡Œçš„ã€‚è®­ç»ƒé˜¶æ®µå°±æ˜¯å°†ç°æœ‰ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ª3 x 3å·ç§¯æ¢æˆ3 x 1å·ç§¯+1 x 3å·ç§¯+3 x 3å·ç§¯å…±ä¸‰ä¸ªå·ç§¯å±‚ï¼Œæœ€ç»ˆå°†è¿™ä¸‰ä¸ªå·ç§¯å±‚çš„è®¡ç®—ç»“æœè¿›è¡Œèåˆè·å¾—å·ç§¯å±‚çš„è¾“å‡ºã€‚å› ä¸ºè¿™ä¸ªè¿‡ç¨‹ä¸­å¼•å…¥çš„1 x 3å·ç§¯å’Œ3 x 1å·ç§¯æ˜¯éå¯¹ç§°çš„ï¼Œæ‰€ä»¥å°†å…¶å‘½åä¸ºAsymmetric Convolutionã€‚</p>
</li>
<li><p><strong>ã€Œæ¨ç†é˜¶æ®µã€</strong>ï¼šå¦‚ä¸Šå›¾å³åŠéƒ¨åˆ†æ‰€ç¤ºï¼Œè¿™éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹ä¸‰ä¸ªå·ç§¯æ ¸è¿›è¡Œèåˆã€‚è¿™éƒ¨åˆ†åœ¨å®ç°è¿‡ç¨‹ä¸­å°±æ˜¯ä½¿ç”¨èåˆåçš„å·ç§¯æ ¸å‚æ•°æ¥åˆå§‹åŒ–ç°æœ‰çš„ç½‘ç»œï¼Œå› æ­¤åœ¨æ¨ç†é˜¶æ®µï¼Œç½‘ç»œç»“æ„å’ŒåŸå§‹ç½‘ç»œæ˜¯å®Œå…¨ä¸€æ ·çš„äº†ï¼Œåªä¸è¿‡ç½‘ç»œå‚æ•°é‡‡ç”¨äº†ç‰¹å¾æå–èƒ½åŠ›æ›´å¼ºçš„å‚æ•°å³èåˆåçš„å·ç§¯æ ¸å‚æ•°ï¼Œå› æ­¤åœ¨æ¨ç†é˜¶æ®µä¸ä¼šå¢åŠ è®¡ç®—é‡ã€‚</p>
</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ACNetåœ¨è®­ç»ƒé˜¶æ®µå¼ºåŒ–äº†åŸå§‹ç½‘ç»œçš„ç‰¹å¾æå–èƒ½åŠ›ï¼Œåœ¨æ¨ç†é˜¶æ®µèåˆå·ç§¯æ ¸è¾¾åˆ°ä¸å¢åŠ è®¡ç®—é‡çš„ç›®çš„ã€‚è™½ç„¶è®­ç»ƒæ—¶é—´å¢åŠ äº†ä¸€äº›æ—¶é—´ï¼Œä½†å´æ¢æ¥äº†åœ¨æ¨ç†é˜¶æ®µé€Ÿåº¦æ— ç—›çš„ç²¾åº¦æå‡ï¼Œæ€ä¹ˆçœ‹éƒ½æ˜¯ä¸€ç¬”éå¸¸åˆ’ç®—çš„äº¤æ˜“ã€‚ä¸‹é¢çš„Table3å±•ç¤ºäº†åœ¨ä¸€äº›ç»å…¸ç½‘ç»œä¸Šåº”ç”¨ACNetçš„ç»“æœï¼Œå¯¹äºAlexNetç²¾åº¦æå‡äº†æ¯”è¾ƒå¤šï¼Œè€Œå¯¹ResNetå’ŒDenseNetç²¾åº¦åˆ™æå‡ä¸åˆ°ä¸€ä¸ªç™¾åˆ†ç‚¹ï¼Œä¸è¿‡è€ƒè™‘åˆ°è¿™ä¸ªæå‡æ˜¯ç™½èµšçš„ä¹Ÿè¿˜æ˜¯éå¸¸å€¼å¾—è‚¯å®šçš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/642.png" alt></p>
<h2 id="ä¸ºä»€ä¹ˆACNetèƒ½æ¶¨ç‚¹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆACNetèƒ½æ¶¨ç‚¹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆACNetèƒ½æ¶¨ç‚¹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆACNetèƒ½æ¶¨ç‚¹ï¼Ÿ</h2><p>ä¸ºä»€ä¹ˆACNetè¿™ä¸ªçœ‹èµ·æ¥ååˆ†ç®€å•çš„æ“ä½œèƒ½ä¸ºå„ç§ç½‘ç»œå¸¦æ¥æ¶¨ç‚¹ï¼Ÿè®ºæ–‡ä¸­æåˆ°ï¼ŒACNetæœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯<strong>ã€Œå®ƒæå‡äº†æ¨¡å‹å¯¹å›¾åƒç¿»è½¬å’Œæ—‹è½¬çš„é²æ£’æ€§ã€</strong>ï¼Œä¾‹å¦‚è®­ç»ƒå¥½åçš„1 x 3å·ç§¯å’Œåœ¨å›¾åƒç¿»è½¬åä»ç„¶èƒ½æå–æ­£ç¡®çš„ç‰¹å¾ï¼ˆå¦‚Figure4å·¦å›¾æ‰€ç¤ºï¼Œ2ä¸ªçº¢è‰²çŸ©å½¢æ¡†å°±æ˜¯å›¾åƒç¿»è½¬å‰åçš„ç‰¹å¾æå–æ“ä½œï¼Œåœ¨è¾“å…¥å›¾åƒçš„ç›¸åŒä½ç½®å¤„æå–å‡ºæ¥çš„ç‰¹å¾è¿˜æ˜¯ä¸€æ ·çš„ï¼‰ã€‚é‚£ä¹ˆå‡è®¾è®­ç»ƒé˜¶æ®µåªç”¨3 x 3å·ç§¯æ ¸ï¼Œå½“å›¾åƒä¸Šä¸‹ç¿»è½¬ä¹‹åï¼Œå¦‚Figure4å³å›¾æ‰€ç¤ºï¼Œæå–å‡ºæ¥çš„ç‰¹å¾æ˜¾ç„¶æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å› æ­¤ï¼Œå¼•å…¥1 x 3è¿™æ ·çš„æ°´å¹³å·ç§¯æ ¸å¯ä»¥æå‡æ¨¡å‹å¯¹å›¾åƒä¸Šä¸‹ç¿»è½¬çš„é²æ£’æ€§ï¼Œç«–ç›´æ–¹å‘çš„å·ç§¯æ ¸åŒç†ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/643.png" alt></p>
<p>ä¸‹é¢çš„Table4åˆ™ç»§ç»­ä»å®éªŒè§’åº¦è§£é‡Šäº†è¿™ç§é²æ£’æ€§ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/644.png" alt></p>
<h2 id="æ¨ç†é˜¶æ®µçš„å·ç§¯æ ¸èåˆ"><a href="#æ¨ç†é˜¶æ®µçš„å·ç§¯æ ¸èåˆ" class="headerlink" title="æ¨ç†é˜¶æ®µçš„å·ç§¯æ ¸èåˆ"></a>æ¨ç†é˜¶æ®µçš„å·ç§¯æ ¸èåˆ</h2><p>æ¨ç†é˜¶æ®µçš„èåˆæ“ä½œå¦‚Figure3æ‰€ç¤ºï¼Œåœ¨è®ºæ–‡ä¸­æåˆ°å…·ä½“çš„èåˆæ“ä½œæ˜¯å’ŒBNå±‚ä¸€èµ·çš„ï¼Œç„¶åèåˆæ“ä½œæ—¶å‘ç”Ÿåœ¨BNä¹‹åçš„ã€‚ä½†æ˜¯å…¶å®ä¹Ÿå¯ä»¥æŠŠèåˆæ“ä½œæ”¾åœ¨BNå±‚ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªå·ç§¯å±‚è®¡ç®—å®Œä¹‹åå°±å¼€å§‹èåˆã€‚è®ºæ–‡å¯¹è¿™ä¸¤ç§èåˆæ–¹å¼è¿›è¡Œäº†å®éªŒï¼Œåœ¨ä¸Šé¢çš„Table4ä¸­BN in branchè¿™ä¸€åˆ—æœ‰âˆšçš„è¯è¡¨ç¤ºèåˆæ˜¯åœ¨BNä¹‹åï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼ä½¿å¾—æ•ˆæœç¡®å®ä¼šæ›´å¥½ä¸€äº›ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ACNet/645.png" alt></p>
<h2 id="Pytorchä»£ç å®ç°"><a href="#Pytorchä»£ç å®ç°" class="headerlink" title="Pytorchä»£ç å®ç°"></a>Pytorchä»£ç å®ç°</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä½œè€…çš„ACNetåŸºç¡€ç»“æ„Pytorchå®ç°ï¼Œå³å°†åŸå§‹çš„3 x 3å·ç§¯å˜æˆï¼š3 x 3 + 3 x 1 + 1 x 3ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å»æ‰å› ä¸º3x3å·ç§¯çš„paddingå¤šå‡ºæ¥çš„è¡Œæˆ–è€…åˆ—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CropLayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#   E.g., (-1, 0) means this layer should crop the first and last rows of the feature map. And (0, -1) crops the first and last columns</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, crop_set</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(CropLayer, self).__init__()</span><br><span class="line">        self.rows_to_crop = - crop_set[<span class="number">0</span>]</span><br><span class="line">        self.cols_to_crop = - crop_set[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">assert</span> self.rows_to_crop &gt;= <span class="number">0</span></span><br><span class="line">        <span class="keyword">assert</span> self.cols_to_crop &gt;= <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">input</span>[:, :, self.rows_to_crop:-self.rows_to_crop, self.cols_to_crop:-self.cols_to_crop]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®ºæ–‡æå‡ºçš„3x3+1x3+3x1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ACBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels, kernel_size, stride=<span class="number">1</span>, padding=<span class="number">0</span>, dilation=<span class="number">1</span>, groups=<span class="number">1</span>, padding_mode=<span class="string">&#x27;zeros&#x27;</span>, deploy=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ACBlock, self).__init__()</span><br><span class="line">        self.deploy = deploy</span><br><span class="line">        <span class="keyword">if</span> deploy:</span><br><span class="line">            self.fused_conv = nn.Conv2d(in_channels=in_channels, out_channels=out_channels, kernel_size=(kernel_size,kernel_size), stride=stride,</span><br><span class="line">                                      padding=padding, dilation=dilation, groups=groups, bias=<span class="literal">True</span>, padding_mode=padding_mode)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.square_conv = nn.Conv2d(in_channels=in_channels, out_channels=out_channels,</span><br><span class="line">                                         kernel_size=(kernel_size, kernel_size), stride=stride,</span><br><span class="line">                                         padding=padding, dilation=dilation, groups=groups, bias=<span class="literal">False</span>,</span><br><span class="line">                                         padding_mode=padding_mode)</span><br><span class="line">            self.square_bn = nn.BatchNorm2d(num_features=out_channels)</span><br><span class="line"></span><br><span class="line">            center_offset_from_origin_border = padding - kernel_size // <span class="number">2</span></span><br><span class="line">            ver_pad_or_crop = (center_offset_from_origin_border + <span class="number">1</span>, center_offset_from_origin_border)</span><br><span class="line">            hor_pad_or_crop = (center_offset_from_origin_border, center_offset_from_origin_border + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> center_offset_from_origin_border &gt;= <span class="number">0</span>:</span><br><span class="line">                self.ver_conv_crop_layer = nn.Identity()</span><br><span class="line">                ver_conv_padding = ver_pad_or_crop</span><br><span class="line">                self.hor_conv_crop_layer = nn.Identity()</span><br><span class="line">                hor_conv_padding = hor_pad_or_crop</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.ver_conv_crop_layer = CropLayer(crop_set=ver_pad_or_crop)</span><br><span class="line">                ver_conv_padding = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                self.hor_conv_crop_layer = CropLayer(crop_set=hor_pad_or_crop)</span><br><span class="line">                hor_conv_padding = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            self.ver_conv = nn.Conv2d(in_channels=in_channels, out_channels=out_channels, kernel_size=(<span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">                                      stride=stride,</span><br><span class="line">                                      padding=ver_conv_padding, dilation=dilation, groups=groups, bias=<span class="literal">False</span>,</span><br><span class="line">                                      padding_mode=padding_mode)</span><br><span class="line"></span><br><span class="line">            self.hor_conv = nn.Conv2d(in_channels=in_channels, out_channels=out_channels, kernel_size=(<span class="number">1</span>, <span class="number">3</span>),</span><br><span class="line">                                      stride=stride,</span><br><span class="line">                                      padding=hor_conv_padding, dilation=dilation, groups=groups, bias=<span class="literal">False</span>,</span><br><span class="line">                                      padding_mode=padding_mode)</span><br><span class="line">            self.ver_bn = nn.BatchNorm2d(num_features=out_channels)</span><br><span class="line">            self.hor_bn = nn.BatchNorm2d(num_features=out_channels)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># forwardå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.deploy:</span><br><span class="line">            <span class="keyword">return</span> self.fused_conv(<span class="built_in">input</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            square_outputs = self.square_conv(<span class="built_in">input</span>)</span><br><span class="line">            square_outputs = self.square_bn(square_outputs)</span><br><span class="line">            <span class="comment"># print(square_outputs.size())</span></span><br><span class="line">            <span class="comment"># return square_outputs</span></span><br><span class="line">            vertical_outputs = self.ver_conv_crop_layer(<span class="built_in">input</span>)</span><br><span class="line">            vertical_outputs = self.ver_conv(vertical_outputs)</span><br><span class="line">            vertical_outputs = self.ver_bn(vertical_outputs)</span><br><span class="line">            <span class="comment"># print(vertical_outputs.size())</span></span><br><span class="line">            horizontal_outputs = self.hor_conv_crop_layer(<span class="built_in">input</span>)</span><br><span class="line">            horizontal_outputs = self.hor_conv(horizontal_outputs)</span><br><span class="line">            horizontal_outputs = self.hor_bn(horizontal_outputs)</span><br><span class="line">            <span class="comment"># print(horizontal_outputs.size())</span></span><br><span class="line">            <span class="keyword">return</span> square_outputs + vertical_outputs + horizontal_outputs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æ¨ç†é˜¶æ®µè¿›è¡Œå·ç§¯æ ¸èåˆçš„ä»£ç å®ç°åœ°å€ä¸ºï¼š<code>https://github.com/DingXiaoH/ACNet/blob/master/acnet/acnet_fusion.py</code>ï¼Œå¯¹ç…§Figure3å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œä»‹äºç¯‡å¹…è¿™é‡Œå°±ä¸è´´è¿™æ®µä»£ç äº†ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ä»å®éªŒç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¨ç†é˜¶æ®µå³ä½¿èåˆæ“ä½œæ”¾åœ¨BNå±‚ä¹‹å‰ï¼Œç›¸æ¯”åŸå§‹ç½‘ç»œä»æœ‰ä¸€å®šæå‡ï¼ˆAlexNetçš„56.18% vs 55.92%ï¼ŒResNet-18çš„70.82% vs 70.36%ï¼‰ï¼Œä½œè€…æ²¡æœ‰è®²è§£è¿™éƒ¨åˆ†çš„åŸç†ï¼ŒæŸä½å¤§ä½¬æå‡ºçš„è§‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>è¿™éƒ¨åˆ†çš„åŸå› ä¸ªäººç†è§£æ˜¯æ¥è‡ªæ¢¯åº¦å·®å¼‚åŒ–ï¼ŒåŸæ¥åªæœ‰ä¸€ä¸ª3 x 3å·ç§¯å±‚ï¼Œæ¢¯åº¦å¯ä»¥çœ‹å‡ºä¸€ä»½ï¼Œè€Œæ·»åŠ äº†1 x 3å’Œ3 x 1å·ç§¯å±‚åï¼Œéƒ¨åˆ†ä½ç½®çš„æ¢¯åº¦å˜ä¸º2ä»½å’Œ3ä»½ï¼Œä¹Ÿæ˜¯æ›´åŠ ç»†åŒ–äº†ã€‚è€Œä¸”ç†è®ºä¸Šå¯ä»¥èåˆæ— æ•°ä¸ªå·ç§¯å±‚ä¸æ–­é€¼è¿‘ç°æœ‰ç½‘ç»œçš„æ•ˆæœæé™ï¼Œèåˆæ–¹å¼ä¸é™äºç›¸åŠ ï¼ˆè®­ç»ƒå’Œæ¨ç†é˜¶æ®µä¸€è‡´å³å¯ï¼‰ï¼Œèåˆçš„å·ç§¯å±‚ä¹Ÿä¸é™äº1 x 3æˆ–3 x 1å°ºå¯¸ã€‚</p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ç®€è¦è®²è¿°äº†ACNetè¿™ä¸ªæ— ç—›çš„è°ƒå‚æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•åˆ›æ–°ç‚¹æ˜¯éå¸¸æ£’çš„ï¼Œæˆ‘ä»¬ä¸ä¸€å®šéœ€è¦é‡å‹BackBoneå»æå–ç‰¹å¾ï¼Œä¹Ÿä¸ä¸€å®šéœ€è¦å¤æ‚çš„ç»“æ„å¤ç”¨ç‰¹å¾ï¼ŒåƒACNetè¿™æ ·çš„ä¼˜é›…å¹¶ä¸”æœ‰æ•ˆçš„ä½œå“ç¡®å®è®©äººçœ¼å‰ä¸€äº®ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Perceptual Generative Adversarial Networks for Small Object Detection</title>
    <url>/2020/05/09/Perceptual-Generative-Adversarial-Networks-for-Small-Object-Detection/</url>
    <content><![CDATA[<h2 id="è¯¦è§£"><a href="#è¯¦è§£" class="headerlink" title="è¯¦è§£"></a>è¯¦è§£</h2><ul>
<li>å°ç›®æ ‡æ£€æµ‹çš„ä¸€ä¸ªå¸¸ç”¨æ€è·¯æ˜¯æå‡å›¾ç‰‡è¾“å…¥åˆ†è¾¨ç‡ï¼Œæ¥å¢å¼ºå°ç›®æ ‡çš„åˆ†è¾¨ç‡å’Œç”Ÿæˆé«˜åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ï¼Œä½†è¿™ä¼šå¯¼è‡´è®­ç»ƒå’ŒéªŒè¯æåº¦è´¹æ—¶ã€‚</li>
<li>æœ¬æ–‡æå‡ºçš„PGANæ–¹æ³•å¯¹å°ç›®æ ‡ç”Ÿæˆé«˜åˆ†è¾¨ç‡ç‰¹å¾è¡¨ç¤ºï¼Œä½¿å°ç›®æ ‡çš„ç‰¹å¾è¡¨ç¤ºä¸å¤§ç›®æ ‡ç‰¹å¾è¡¨ç¤ºç±»ä¼¼ã€‚</li>
<li>ç”Ÿæˆå™¨ç½‘ç»œé€šè¿‡è¾ƒå‰å±‚æå–ç»†ç²’åº¦ç‰¹å¾å°†å°ç›®æ ‡åˆ†è¾¨ç‡è¾ƒä½çš„ç‰¹å¾è½¬æ¢ä¸ºåˆ†è¾¨ç‡è¾ƒé«˜çš„ç‰¹å¾ã€‚</li>
<li>åˆ¤åˆ«å™¨ç½‘ç»œä¸ä»…ç”¨äºç”Ÿæˆå°ç›®æ ‡é«˜åˆ†è¾¨è¡¨ç¤ºï¼ŒåŒæ—¶è¯æ˜å¸¦æ„ŸçŸ¥æŸå¤±çš„ç”Ÿæˆé«˜åˆ†è¾¨ç‡ç‰¹å¾å¯¹æ£€æµ‹å‡†ç¡®ç‡æ˜¯æœ‰å¸®åŠ©çš„ã€‚</li>
<li>ç”Ÿæˆå™¨ç½‘ç»œè¢«è®­ç»ƒæ¬ºéª—è¾¨åˆ«å™¨é€šè¿‡äº§ç”Ÿæœ€åƒå¤§ç›®æ ‡è¡¨å¾çš„å°ç›®æ ‡ï¼ŒåŒæ—¶æå‡æ£€æµ‹å‡†ç¡®ç‡ã€‚</li>
<li>è¾¨åˆ«å™¨è¢«è®­ç»ƒç”¨äºæå‡æ­£ç¡®ä»å®é™…å¤§ç›®æ ‡ä¸­åˆ†è¾¨å‡ºç”Ÿæˆçš„é«˜åˆ†è¾¨ç‡è¡¨å¾ï¼ŒåŒæ—¶å°†å®šä½å‡†ç¡®ç‡åé¦ˆç»™ç”Ÿæˆå™¨ã€‚</li>
<li>å°ç›®æ ‡æ£€æµ‹å…¸å‹åº”ç”¨é¢†åŸŸï¼šäº¤é€šæ ‡å¿—æ£€æµ‹ã€è¡Œäººæ£€æµ‹</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/PGAN/11659928-8837870deae1ed8d.png" alt></p>
<p>perception branchï¼ˆæ„ŸçŸ¥åˆ†æ”¯ï¼‰é¦–å…ˆåˆ©ç”¨ä»…åŒ…å«å¤§ç›®æ ‡çš„å›¾ç‰‡è¿›è¡Œè®­ç»ƒï¼Œç„¶ååˆ©ç”¨ä»…åŒ…å«å°ç›®æ ‡çš„å›¾ç‰‡è¿›è¡Œè®­ç»ƒï¼Œgenerator network è¢«è®­ç»ƒç”¨äºå¯¹å°ç›®æ ‡ç”Ÿæˆé«˜åˆ†è¾¨ç‡çš„ç±»ä¼¼å¤§ç›®æ ‡çš„è¡¨å¾ã€‚adversarial branchè¢«è®­ç»ƒç”¨äºåŒºåˆ†ç”Ÿæˆçš„å°ç›®æ ‡é«˜åˆ†è¾¨ç‡è¡¨å¾ä¸å®é™…å¤§ç›®æ ‡çš„åŸå§‹è¡¨å¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/PGAN/11659928-0359caab80a4ee3a.png" alt></p>
<p>generator ä»åº•å±‚æå–ç»†ç²’åº¦ç‰¹å¾ï¼Œæ”¾å…¥æ·±åº¦æ®‹å·®ç½‘ç»œï¼Œé€šè¿‡element-wiseåŠ å’Œæ“ä½œï¼Œå°†æ·±åº¦æ®‹å·®ç½‘ç»œå­¦ä¹ åˆ°çš„æ®‹å·®ç‰¹å¾ä¸conv5å­¦ä¹ åˆ°çš„ç‰¹å¾ç»“åˆï¼Œå¾—åˆ°é«˜åˆ†è¾¨ç‡ç‰¹å¾å›¾ï¼›discriminatorå°†å¤§ç›®æ ‡å’Œå°ç›®æ ‡çš„é«˜åˆ†è¾¨ç‰¹å¾ä½œä¸ºè¾“å…¥ï¼Œadversarialåˆ†æ”¯ç”¨äºåˆ¤æ–­è¾“å…¥ç›¸ç‰‡å±äºçœŸçš„å¤§ç›®æ ‡çš„æ¦‚ç‡å€¼ï¼Œperceptionåˆ†æ”¯ç”¨äºåˆ†ç±»å’Œè¾¹ç•Œæ¡†å›å½’ï¼ŒéªŒè¯ä»ç”Ÿæˆé«˜åˆ†è¾¨ç‡ç‰¹å¾è·å¾—çš„æ£€æµ‹å‡†ç¡®ç‡æå‡ã€‚</p>
<p><strong>æŸå¤±å‡½æ•°</strong></p>
<p>$F_{l}$å’Œ $F_{s}$ä»£è¡¨å¤§ç›®æ ‡å’Œå°ç›®æ ‡ç‰¹å¾ï¼Œ$G$å’Œ$D$ä»£è¡¨ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ï¼Œ$\Theta_{g}$å’Œ$\Theta_{a}$ä»£è¡¨ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„ç½‘ç»œå‚æ•°</p>
<ul>
<li><p>ç”Ÿæˆå™¨<br>$\Theta_{g}=\arg \min _{\Theta_{g}} L_{d i s}\left(G_{\Theta_{g}}\left(F_{s}\right)\right)$<br>$L_{d i s}$æ˜¯åˆ¤åˆ«å™¨ç½‘ç»œäº§ç”Ÿçš„å¯¹æŠ—æ€§æŸå¤±$L_{d i s_{-} a}$å’Œæ„ŸçŸ¥æŸå¤±$L_{d i s_ p}$çš„åŠ æƒç»„åˆ<br>$L_{d i s}=w_{1} \times L_{d i s_{-} a}+w_{2} \times L_{d i s_{p}}$ï¼ˆä½œè€…è®¾w1å’Œw2ä¸º1ï¼‰</p>
<ul>
<li><p>å¯¹æŠ—æ€§æŸå¤±<br>$L_{d i s_{-}a}=-\log D_{\Theta_{a}}\left(G_{\Theta_{g}}\left(F_{s}\right)\right)$ï¼ˆä½¿$D_{\Theta_{a}}\left(G_{ \Theta_{g}}\left(F_{s}\right)\right)$å°½å¯èƒ½å¤§ï¼‰</p>
</li>
<li><p>æ„ŸçŸ¥æŸå¤±</p>
<p>$L_{d i s_{-p}}=L_{c l s}(p, g)+1[g \geq 1] L_{l o c}\left(r_{g}, r^{*}\right)$</p>
<p>$L_{c l s}$å’Œ$L_{l o c}$æ˜¯åˆ†ç±»å’Œè¾¹ç•Œæ¡†å›å½’çš„æŸå¤±</p>
<p>æ„ŸçŸ¥åˆ†æ”¯è¾“å‡ºK + 1ä¸ªç±»åˆ«çš„ç±»åˆ«çº§åˆ«ç½®ä¿¡åº¦$p=\left(p_{0}, \dots, p_{k}\right)$ï¼Œå¯¹äºæ¯ä¸ªKå¯¹è±¡ç±»ï¼Œè¾¹ç•Œæ¡†å›å½’åç§»$r_{k} = \left(r_{x}^{k}, r_{y}^{k}, r_{w}^{k}, r_{h}^{k}\right)$ï¼ŒçœŸå®ç±»åˆ«ä¸º$g$ï¼ŒçœŸå®è¾¹ç•Œæ¡†å›å½’ç›®æ ‡$r^{*}$</p>
</li>
</ul>
</li>
<li><p>åˆ¤åˆ«å™¨ç½‘ç»œçš„å¯¹æŠ—åˆ†æ”¯ï¼š<br>$\Theta_{a}=\arg \min _{\Theta_{a}} L_{a}\left(G_{\Theta_{g}}\left(F_{s}\right), F_{l}\right)$<br>$L_{a}=-\log D_{\Theta_{a}}\left(F_{l}\right)-\log \left(1-D_{\Theta_{a}}\left(G_{\Theta_{g}}\left(F_{s}\right)\right)\right)$<br>åŒºåˆ†å½“å‰ç”Ÿæˆçš„å°å¯¹è±¡è¶…åˆ†è¾¨è¡¨ç¤ºå’ŒåŸå§‹å¯¹è±¡ä¸çœŸå®å¤§å¯¹è±¡ä¹‹é—´çš„å·®å¼‚ã€‚ å³ä½¿$D_{\Theta_{a}}$å°½å¯èƒ½å¤§ï¼Œ$D _{\Theta_{a}}\left(G _{Theta_{g}}\left(F_{s}\right)\right)$å°½å¯èƒ½å°ã€‚</p>
</li>
</ul>
<p><strong>è”åˆå¯¹æŠ—æŸå¤± </strong><br>$\begin{array}{rl}{\min _{G} \max _{D}} &amp; {L(D, G) \triangleq \mathbb{E}_{F_{l} \sim p_{ \text {data(F }\left._{l}\right)}} \log D\left(F_{l}\right)} \\ {} &amp; {+\mathbb{E}_{F_{s} \sim p_{F_{s}}}\left(F_{s} | f\right)[\log (1-D(\underbrace{F_{s}+G\left(F_{s} | f\right)}_{\text {residual learning }}))]}\end{array}$</p>
<p>å³Gçš„ç›®æ ‡æ˜¯ä½¿å®ƒæœ€å°ï¼ŒDçš„ç›®æ ‡ä½¿å®ƒæœ€å¤§ï¼Œç”±äº$F_{s}$ä¸­åŒ…å«çš„ä¿¡æ¯æœ‰é™ã€‚å› æ­¤ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¡ä»¶ç”Ÿæˆå™¨æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä»¥é¢å¤–çš„è¾…åŠ©ä¿¡æ¯ä¸ºæ¡ä»¶ï¼Œå³å°å¯¹è±¡$f$çš„ä½çº§ç‰¹å¾ï¼Œç”Ÿæˆå™¨ä»ä¸­é€šè¿‡æ®‹å·®å­¦ä¹ åœ¨å¤§å¯¹è±¡å’Œå°å¯¹è±¡è¡¨ç¤ºä¹‹é—´ç”Ÿæˆæ®‹å·®è¡¨ç¤ºã€‚</p>
<p>ä¸ªäººç†è§£ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/PGAN/1.png" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>An Analysis of Scale Invariance in Object Detection â€“ SNIP</title>
    <url>/2020/05/08/An-Analysis-of-Scale-Invariance-in-Object-Detection-%E2%80%93-SNIP/</url>
    <content><![CDATA[<h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>æ¦‚æ‹¬è€Œè¨€ï¼Œè¿™ç¯‡æ–‡ç« ä»COCOæ•°æ®é›†å¼€å§‹åˆ†æï¼Œè®¤ä¸ºç›®å‰ç›®æ ‡æ£€æµ‹ç®—æ³•çš„éš¾ç‚¹åœ¨äºæ•°æ®é›†ä¸­objectçš„å°ºå¯¸åˆ†å¸ƒè¾ƒå¤§ï¼Œå°¤å…¶å¯¹äºå°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœä¹Ÿæœ‰å¾…æé«˜ï¼Œå› æ­¤æå‡ºScale Normalization for Image Pyramids (SNIP)ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä½œè€…å°†æ•°æ®é›†æŒ‰ç…§å›¾åƒä¸­ç›®æ ‡çš„å°ºå¯¸/å›¾åƒå°ºå¯¸è¿›è¡Œæ’åºï¼Œåœ¨ImageNetæ•°æ®é›†ä¸­ï¼Œè¿™ä¸ªå€æ•°çš„ä¸­ä½æ•°å·®ä¸å¤š0.554ï¼Œè€Œåœ¨COCOæ•°æ®é›†ä¸­ï¼Œè¿™ä¸ªæ•°æ˜¯0.106ã€‚å¦‚Figure1ä¸­ä¸¤æ¡çº¿æ ‡å‡ºçš„Medianç‚¹æ‰€ç¤ºã€‚Figure1æ˜¯å…³äºImageNetå’ŒCOCOæ•°æ®é›†ä¸­objectå°ºå¯¸å’Œå›¾åƒå°ºå¯¸çš„å€æ•°å…³ç³»æ›²çº¿ï¼Œæ¨ªåæ ‡è¡¨ç¤ºobjectçš„å°ºå¯¸/å›¾åƒå°ºå¯¸çš„å€¼ï¼Œçºµåæ ‡è¡¨ç¤ºå æ¯”ã€‚<strong>ä¹Ÿå°±æ˜¯è¯´åœ¨COCOæ•°æ®é›†ä¸­ï¼Œå¤§éƒ¨åˆ†çš„objecté¢ç§¯åªæœ‰å›¾åƒé¢ç§¯çš„1%ä»¥ä¸‹ï¼Œè¿™è¯´æ˜åœ¨COCOæ•°æ®é›†ä¸­å°ç›®æ ‡å æ¯”è¦æ¯”ImageNetæ•°æ®é›†å¤§</strong>ã€‚å¦å¤–ï¼Œä»Figure1ä¸­çš„COCOæ›²çº¿å¯ä»¥çœ‹å‡ºï¼Œç¬¬90%çš„å€æ•°ï¼ˆ0.472ï¼‰å·®ä¸å¤šæ˜¯ç¬¬10%çš„å€æ•°ï¼ˆ0.106ï¼‰çš„20å€ï¼<strong>è¿™è¯´æ˜åœ¨COCOæ•°æ®é›†ä¸­çš„objectå°ºå¯¸å˜åŒ–èŒƒå›´éå¸¸å¤§</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/v2-61cd98f989aba662764ae4930f6a3c82_hd.jpg" alt></p>
<p><strong>é‚£ä¹ˆè¿™ç§å·®å¼‚ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</strong>å› ä¸ºåœ¨ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­å¸¸ç”¨åŸºäºImageNetæ•°æ®é›†é¢„è®­ç»ƒçš„æ¨¡å‹æ¥æå–ç‰¹å¾ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„è¿ç§»å­¦ä¹ ï¼Œä½†æ˜¯<strong>ä»Figure1çš„ä¸¤æ¡æ›²çº¿å¯ä»¥çœ‹å‡ºImageNetå’ŒCOCOæ•°æ®é›†åœ¨objectçš„å°ºå¯¸åˆ†å¸ƒä¸Šå·®å¼‚æ¯”è¾ƒå¤§</strong>ï¼Œè¿™æ ·åœ¨åšè¿ç§»å­¦ä¹ æ—¶å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ–‡ç« ä¸­å°†è¿™ä¸ªé—®é¢˜æ¦‚æ‹¬ä¸º<strong>domain-shift</strong>ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†å¸ƒå­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œåé¢ä¼šæœ‰å®éªŒæ¥è¯æ˜è¿™ç§å·®å¼‚å¯¹æ•ˆæœçš„å½±å“ã€‚å…¶å®YOLO v2ä¹Ÿç ”ç©¶äº†ç±»ä¼¼çš„é—®é¢˜ï¼ŒYOLO v2è€ƒè™‘åˆ°åœ¨ImageNetæ•°æ®é›†ä¸Šé¢„è®­ç»ƒæ¨¡å‹æ—¶è¾“å…¥å›¾åƒå¤§å°æ˜¯224x224ï¼Œå’Œæ£€æµ‹ç½‘ç»œç”¨çš„å°ºå¯¸å·®åˆ«è¾ƒå¤§ï¼ˆYOLO v2ä¸­å¸¸ç”¨416x416ï¼‰ï¼Œæ‰€ä»¥å°±å°†é¢„è®­ç»ƒæ¨¡å‹åœ¨416x416çš„ImageNetæ•°æ®é›†ä¸Šç»§ç»­é¢„è®­ç»ƒï¼Œç„¶åå†ç”¨åˆ°æ£€æµ‹æ¨¡å‹æç‰¹å¾ï¼Œè¿™æ ·å°±å®ç°äº†é¢„è®­ç»ƒæ¨¡å‹å’Œæ£€æµ‹æ¨¡å‹çš„è‰¯å¥½è¿‡æ¸¡ã€‚ï¼ˆ<strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨Imagnetä¸Šåšé¢„è®­ç»ƒï¼Œç„¶åè¿›è¡Œè¿ç§»å­¦ä¹ æ—¶å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç®€å•ç†è§£ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†å¸ƒå­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚</strong>ï¼‰</p>
<p>å…¶å®ä¹‹å‰å°±æœ‰ä¸å°‘ç®—æ³•é’ˆå¯¹æ•°æ®é›†ä¸­ä¸åŒå°ºå¯¸çš„objectæ£€æµ‹è¿›è¡Œæ”¹è¿›ï¼Œæ¯”å¦‚ä»¥Feature Pyramid Network(FPN)ä¸ºä¾‹çš„é€šè¿‡èåˆé«˜ä½å±‚ç‰¹å¾å¹¶åŸºäºå¤šå±‚èåˆç‰¹å¾å•ç‹¬é¢„æµ‹çš„ç®—æ³•ï¼›ä»¥Dilated/Deformable Convolutionä¸ºä¾‹çš„é€šè¿‡æ”¹å˜å·ç§¯æ ¸çš„æ„Ÿå—é‡æ¥æå‡æ£€æµ‹æ•ˆæœï¼›ä»¥multi-scale training/inferenceä¸ºä¾‹çš„é€šè¿‡å¼•å…¥å›¾åƒé‡‘å­—å¡”æ¥è®­ç»ƒæˆ–éªŒè¯å›¾åƒã€‚<strong>è¿™ç¯‡æ–‡ç« åŸºäºå¯¹æ•°æ®é›†çš„åˆ†æï¼Œæå‡ºä¸€ç§æ–°çš„è®­ç»ƒæ¨¡å‹çš„æ–¹å¼ï¼šScale Normalization for Image Pyramids (SNIP)ï¼Œè¯¥ç®—æ³•ä¸»è¦åŒ…å«ä¸¤ä¸ªæ”¹è¿›ç‚¹ï¼š</strong></p>
<p><strong>1ã€ä¸ºäº†å‡å°‘å‰é¢æ‰€æåˆ°çš„domain-shiftï¼Œåœ¨æ¢¯åº¦å›ä¼ æ—¶åªå°†å’Œé¢„è®­ç»ƒæ¨¡å‹æ‰€åŸºäºçš„è®­ç»ƒæ•°æ®å°ºå¯¸ç›¸å¯¹åº”çš„ROIçš„æ¢¯åº¦è¿›è¡Œå›ä¼ ã€‚</strong></p>
<p><strong>2ã€å€Ÿé‰´äº†multi-scale trainingçš„æ€æƒ³ï¼Œå¼•å…¥å›¾åƒé‡‘å­—å¡”æ¥å¤„ç†æ•°æ®é›†ä¸­ä¸åŒå°ºå¯¸çš„æ•°æ®ã€‚</strong></p>
<h2 id="å‡ ç»„å®éªŒ"><a href="#å‡ ç»„å®éªŒ" class="headerlink" title="å‡ ç»„å®éªŒ"></a>å‡ ç»„å®éªŒ</h2><p><strong>â‘ ImageNetæ•°æ®é›†å®éªŒéªŒè¯å°ºå¯¸å˜åŒ–å¯¹ç½‘ç»œäº§ç”Ÿçš„å½±å“</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/v2-62f2ddd1572194258dfb44896f96a61e_hd.jpg" alt></p>
<p><strong>CNN-Bï¼š</strong>é¢„è®­ç»ƒï¼šImageNetæ•°æ®é›†å¸¸è§„çš„224x224å¤§å°æ¥è®­ç»ƒ<br>                éªŒè¯é›†ï¼šé¦–å…ˆå°†ImageNetçš„éªŒè¯æ•°æ®ç¼©å°åˆ°48x48ã€64x64ã€80x80ã€96x96å’Œ128x128ï¼Œç„¶åå†å°†è¿™äº›å°ºå¯¸æ”¾å¤§åˆ°224x224ä½œä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œå¯ä»¥çœ‹å‡ºæ”¾å¤§åçš„å›¾åƒåˆ†è¾¨ç‡è¾ƒä½ã€‚<strong>å› æ­¤è¿™ä¸ªå®éªŒæ¨¡æ‹Ÿçš„å°±æ˜¯ä½ è®­ç»ƒæ•°æ®çš„åˆ†è¾¨ç‡ï¼ˆresolutionï¼‰å’ŒéªŒè¯æ•°æ®çš„åˆ†è¾¨ç‡ä¸ä¸€è‡´ï¼ˆç”šè‡³æ˜¯å·®åˆ«å¾ˆå¤§ï¼‰çš„æ—¶å€™å¯¹æ•ˆæœçš„å½±å“ï¼Œè¯¥å®éªŒçš„ç»“æœå¯ä»¥çœ‹Figure4(a)ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/v2-2ee48ab51574f5b084232195fcf2220d_hd.jpg" alt></p>
<p><strong>CNN-Sï¼š</strong>è®­ç»ƒæ•°æ®çš„åˆ†è¾¨ç‡å’ŒéªŒè¯æ•°æ®çš„åˆ†è¾¨ç‡ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œä¸»è¦é’ˆå¯¹48x48å’Œ96x96åˆ†è¾¨ç‡ï¼ŒåŒæ—¶å¯¹ç½‘ç»œç»“æ„çš„ç¬¬ä¸€å±‚åšäº†ä¿®æ”¹ã€‚æ¯”å¦‚åŸºäº48x48çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå°†å·ç§¯æ ¸å¤§å°ä¸º7x7çš„å·ç§¯å±‚æ¢æˆå·ç§¯æ ¸ä¸º3x3ï¼Œstrideä¸º1çš„å·ç§¯å±‚ï¼ˆå› ä¸ºå¦‚æœä¸ä¿®æ”¹strideçš„è¯å¾ˆå®¹æ˜“å°±å·æ²¡äº†ï¼‰ã€‚åŸºäº96x96çš„æ•°æ®è¿›è¡Œè®­ç»ƒæ—¶ï¼Œå°†å·ç§¯æ ¸å¤§å°ä¸º7x7çš„å·ç§¯å±‚æ¢æˆå·ç§¯æ ¸å°ºå¯¸ä¸º5x5ï¼Œstrideä¸º2çš„å·ç§¯å±‚ã€‚<strong>æ˜¾ç„¶ï¼Œè¯¥å®éªŒæ¨¡æ‹Ÿçš„æ˜¯è®­ç»ƒæ•°æ®åˆ†è¾¨ç‡å’ŒéªŒè¯æ•°æ®åˆ†è¾¨ç‡ä¸€è‡´æ—¶çš„æ•ˆæœï¼Œå®éªŒç»“æœå¯ä»¥çœ‹Figure4(b)(c)ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/v2-342b6b8c14dd6086af6864f7609ee0a6_hd.jpg" alt></p>
<p><strong>CNN-B-FTï¼š</strong>æ˜¯CNN-Båœ¨æ”¾å¤§çš„ä½åˆ†è¾¨ç‡å›¾åƒä¸Šå¾®è°ƒåçš„æ¨¡å‹ï¼ŒåŒæ—¶è¾“å…¥å›¾åƒä¹Ÿé‡‡ç”¨æ”¾å¤§çš„ä½åˆ†è¾¨ç‡å›¾åƒã€‚<strong>å¯ä»¥çœ‹å‡ºè¯¥å®éªŒä¸»è¦éªŒè¯åŸºäºé«˜åˆ†è¾¨ç‡å›¾åƒè®­ç»ƒçš„æ¨¡å‹æ˜¯å¦èƒ½æœ‰æ•ˆæå–ä½åˆ†è¾¨ç‡å›¾åƒçš„ç‰¹å¾ï¼Œå®éªŒç»“æœå¯ä»¥çœ‹Figure4(b)(c)ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/v2-342b6b8c14dd6086af6864f7609ee0a6_hd.jpg" alt></p>
<p><strong>ä»ï¼ˆaï¼‰å¯ä»¥çœ‹å‡ºå¦‚æœéªŒè¯æ•°æ®çš„åˆ†è¾¨ç‡å’Œè®­ç»ƒæ•°æ®çš„åˆ†è¾¨ç‡å·®åˆ«è¶Šå¤§ï¼Œåˆ™å®éªŒç»“æœè¶Šå·®ã€‚è¿™è¯´æ˜å…¶å®CNNç½‘ç»œå¯¹å°ºå¯¸å˜åŒ–çš„è¾“å…¥å›¾åƒçš„é²æ£’æ€§ï¼ˆrobustï¼‰è¿˜ä¸å¤Ÿå¥½ã€‚</strong>ä»ï¼ˆbï¼‰å’Œï¼ˆcï¼‰ä¸­CNN-Bå’ŒCNN-Sçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºå½“è®­ç»ƒæ•°æ®çš„åˆ†è¾¨ç‡å’ŒéªŒè¯æ•°æ®çš„åˆ†è¾¨ç‡ç›¸åŒæ—¶ï¼Œæ•ˆæœè¦å¥½å¾ˆå¤šã€‚ä»ï¼ˆbï¼‰å’Œï¼ˆcï¼‰ä¸­CNN-Bå’ŒCNN-B-FTçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºåè€…çš„æ•ˆæœè¦æ›´å¥½ï¼ŒäºŒè€…çš„å·®åˆ«ä»…ä»…åœ¨äºæ¨¡å‹æ˜¯å¦åœ¨æ”¾å¤§çš„ä½åˆ†è¾¨ç‡å›¾åƒä¸Šåšfine tuneï¼Œå› æ­¤å¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>åŸºäºé«˜åˆ†è¾¨ç‡å›¾åƒè®­ç»ƒçš„æ¨¡å‹åŒæ ·èƒ½æœ‰æ•ˆæå–æ”¾å¤§çš„ä½åˆ†è¾¨ç‡å›¾åƒçš„ç‰¹å¾ã€‚</strong></p>
<p><strong>â‘¡COCOæ•°æ®é›†ä¸Šå…³äºå¤šå°ºåº¦å’Œä¸åŒå°ºå¯¸çš„è®­ç»ƒå¯¹äºå®éªŒç»“æœçš„å½±å“</strong></p>
<p><strong>Table1æ˜¯å…³äºåœ¨å°ç›®æ ‡éªŒè¯é›†ä¸Šçš„æ£€æµ‹æ•ˆæœå¯¹æ¯”ï¼Œæ‰€ç”¨çš„éªŒè¯å›¾åƒå°ºå¯¸éƒ½æ˜¯1400x2000ã€‚</strong></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/18194124-b67e299cac5ef81d.png" alt></p>
<p><strong>800allå’Œ1400allï¼š</strong>åˆ†åˆ«è¡¨ç¤ºæ£€æµ‹ç½‘ç»œåŸºäº800x1400å’Œ1400x2000å¤§å°çš„å›¾åƒè¿›è¡Œè®­ç»ƒï¼Œä»äºŒè€…çš„mAPç»“æœå¯¹æ¯”å¯ä»¥çœ‹å‡º1400allçš„æ•ˆæœè¦æ›´å¥½ä¸€äº›ï¼Œä¸»è¦åŸå› å°±åœ¨äºè®­ç»ƒå›¾åƒçš„åˆ†è¾¨ç‡å’ŒéªŒè¯å›¾åƒçš„åˆ†è¾¨ç‡ä¸€è‡´ï¼Œè¿™å’Œå‰é¢åŸºäºImageNetæ•°æ®é›†çš„å®éªŒç»“æœä¹Ÿå»åˆï¼Œä½†è¿™ä¸ªæå‡éå¸¸å°ï¼Œ<strong>çŒœæµ‹åŸå› åœ¨äºè™½ç„¶åŸºäºæ”¾å¤§å›¾åƒï¼ˆåŸå§‹å›¾åƒå¤§æ¦‚640x480ï¼Œæ”¾å¤§æˆ1400x2000ï¼‰è®­ç»ƒçš„æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥æé«˜å¯¹å°ç›®æ ‡ç‰©ä½“çš„æ£€æµ‹</strong>ï¼Œä½†æ˜¯ç”±äºè®­ç»ƒæ•°æ®ä¸­å°ºå¯¸ä¸­ç­‰æˆ–è¾ƒå¤§çš„ç›®æ ‡çš„å°ºå¯¸å¤ªå¤§æ‰€ä»¥éš¾ä»¥è®­ç»ƒï¼Œè¿™å°±å½±å“äº†æ¨¡å‹æœ€ç»ˆçš„æ•ˆæœã€‚æ£€æµ‹ç»“æœå¯ä»¥å‚è€ƒFigure5(1)ã€‚ </p>
<p><strong>1400&lt;80pxï¼š</strong>è¡¨ç¤ºè®­ç»ƒæ•°æ®å°ºå¯¸æ˜¯1400x2000ï¼Œä½†æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­å¿½ç•¥ä¸­ç­‰å°ºå¯¸å’Œå¤§å°ºå¯¸çš„ç›®æ ‡ï¼ˆä¸­ç­‰å’Œå¤§å°ºå¯¸ç›®æ ‡çš„æ ‡å‡†æ˜¯åœ¨åŸå§‹å›¾åƒä¸­ç›®æ ‡å®½é«˜çš„åƒç´ ç‚¹å¤§äº80ï¼‰ï¼Œä¹Ÿå°±æ˜¯åŸºäºå•ä¸€å°ºå¯¸èŒƒå›´(<strong>scale-specific detector</strong>)çš„è¾“å…¥è¿›è¡Œè®­ç»ƒï¼Œç›®çš„æ˜¯å‡å°‘è¿ç§»è¯¯å·®ã€‚<strong>å› æ­¤åšè¿™ä¸ªå®éªŒçš„ç›®çš„æ˜¯åŸºäºå‰é¢é‚£ä¸ªå®éªŒä¸­çš„çŒœæƒ³ï¼šåŸºäº1400x2000å¤§å°çš„å›¾åƒè®­ç»ƒæ—¶ç”±äºè®­ç»ƒæ•°æ®ä¸­å°ºå¯¸ä¸­ç­‰åŠè¾ƒå¤§çš„ç›®æ ‡å¯¹æ¨¡å‹è®­ç»ƒæœ‰è´Ÿä½œç”¨ï¼Œå› æ­¤è¿™é‡Œç›´æ¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¿½ç•¥è¿™æ ·çš„æ•°æ®ã€‚ä½†æ˜¯ä»Table1å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ¨¡å‹çš„æ•ˆæœéå¸¸å·®ï¼ŒçŒœæƒ³åŸå› æ˜¯å¿½ç•¥è¿™äº›è®­ç»ƒæ•°æ®ï¼ˆå æ¯”å¤§çº¦30%ï¼‰æ‰€å¸¦æ¥çš„æ•°æ®æŸå¤±å¯¹æ¨¡å‹æ•ˆæœçš„å½±å“æ›´å¤§ã€‚</strong>å…·ä½“çš„æ£€æµ‹ç»“æœå¯ä»¥å‚è€ƒFigure5(2)ã€‚ </p>
<p><strong>Multi-Scale Training(MST)ï¼š</strong>è¡¨ç¤ºè®­ç»ƒä¸€ä¸ªæ£€æµ‹å™¨æ—¶é‡‡ç”¨ä¸åŒå°ºåº¦çš„å›¾åƒè¿›è¡Œè®­ç»ƒï¼ˆåŒ…æ‹¬480x800ï¼‰ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ‰€è¯´çš„<strong>scale invariant detector</strong>ã€‚ç…§ç†æ¥è¯´è¿™ä¸ªå®éªŒçš„æ•ˆæœåº”è¯¥ä¼šæ¯”è¾ƒå¥½çš„ï¼Œå› ä¸ºæ¯ä¸ªobjectéƒ½ä¼šæœ‰å¤šç§å°ºå¯¸æ¥è®­æ£€æµ‹æ¨¡å‹ï¼Œä½†æ˜¯ä»Table1å¯ä»¥çœ‹å‡ºè¯¥æ¨¡å‹çš„æ•ˆæœå’Œ800allå·®ä¸å¤šï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<strong>ä¸»è¦åŸå› åœ¨äºè®­ç»ƒæ•°æ®ä¸­é‚£äº›å°ºå¯¸éå¸¸å¤§æˆ–éå¸¸å°çš„objectä¼šå½±å“è®­ç»ƒæ•ˆæœã€‚</strong></p>
<p>Scale Normalization for Image Pyramids(SNIP)æ˜¯è¿™ç¯‡æ–‡ç« æå‡ºçš„ç®—æ³•ï¼Œåœ¨å¼•å…¥MSTæ€æƒ³çš„åŒæ—¶é™å®šäº†ä¸åŒå°ºå¯¸çš„objectåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦å›ä¼ ï¼Œè¿™å°±æ˜¯SNIPã€‚ ä»Table1å¯ä»¥çœ‹å‡ºæ•ˆæœæå‡éå¸¸æ˜æ˜¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/18194124-d9b20915b3d90d57.png" alt></p>
<p>â€‹                                                    Figure5æ˜¯å…³äºTable1ä¸­ä¸åŒå®éªŒçš„è®­ç»ƒæ•°æ®å±•ç¤ºã€‚</p>
<h2 id="SNIP"><a href="#SNIP" class="headerlink" title="SNIP"></a>SNIP</h2><p>è¿™ç¯‡æ–‡ç« åŸºäºå¯¹æ•°æ®é›†çš„åˆ†æï¼Œæå‡ºä¸€ç§æ–°çš„è®­ç»ƒæ¨¡å‹çš„æ–¹å¼ï¼šScale Normalization for Image Pyramids (SNIP)ï¼Œè¯¥ç®—æ³•ä¸»è¦åŒ…å«ä¸¤ä¸ªæ”¹è¿›ç‚¹ï¼š</p>
<p><strong>1ã€ä¸ºäº†å‡å°‘å‰é¢æ‰€æåˆ°çš„domain-shiftï¼Œåœ¨æ¢¯åº¦å›ä¼ æ—¶åªå°†å’Œé¢„è®­ç»ƒæ¨¡å‹æ‰€åŸºäºçš„è®­ç»ƒæ•°æ®å°ºå¯¸ç›¸å¯¹åº”çš„ROIçš„æ¢¯åº¦è¿›è¡Œå›ä¼ ã€‚</strong></p>
<p><strong>2ã€å€Ÿé‰´äº†multi-scale trainingçš„æ€æƒ³ï¼Œå¼•å…¥å›¾åƒé‡‘å­—å¡”æ¥å¤„ç†æ•°æ®é›†ä¸­ä¸åŒå°ºå¯¸çš„æ•°æ®ã€‚</strong></p>
<p><strong>ä»å‰é¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªç®—æ³•èƒ½å¤Ÿæ—¢getåˆ°å¤šå°ºåº¦çš„ç›®æ ‡ä¿¡æ¯ï¼Œåˆèƒ½å‡å°‘è¿ç§»è¯¯å·®å¸¦æ¥çš„å½±å“ï¼Œå› æ­¤å°±è¯ç”Ÿäº†SNIPã€‚SNIPå€Ÿé‰´äº†Multi-Scale Training(MST)çš„æ€æƒ³ï¼Œåœ¨MSTæ–¹æ³•ä¸­ï¼Œç”±äºè®­ç»ƒæ•°æ®ä¸­å°ºå¯¸æå¤§æˆ–æå°çš„ç›®æ ‡ä¼šå½±å“å®éªŒç»“æœï¼Œå› æ­¤SNIPçš„åšæ³•å°±æ˜¯åªå¯¹å°ºå¯¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„ç›®æ ‡å›ä¼ æŸå¤±ï¼ˆè¯¥èŒƒå›´éœ€æ¥è¿‘é¢„è®­ç»ƒæ¨¡å‹çš„è®­ç»ƒæ•°æ®å°ºå¯¸ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è®­ç»ƒè¿‡ç¨‹å®é™…ä¸Šåªæ˜¯é’ˆå¯¹è¿™äº›ç›®æ ‡è¿›è¡Œçš„ï¼Œè¿™æ ·å°±èƒ½å‡å°‘è¿ç§»è¯¯å·®å¸¦æ¥çš„å½±å“ã€‚åˆå› ä¸ºè®­ç»ƒè¿‡ç¨‹é‡‡ç”¨äº†ç±»ä¼¼MSTçš„åšæ³•ï¼Œæ‰€ä»¥æ¯ä¸ªç›®æ ‡åœ¨è®­ç»ƒæ—¶éƒ½ä¼šæœ‰å‡ ä¸ªä¸åŒçš„å°ºå¯¸ï¼Œé‚£ä¹ˆæ€»æœ‰ä¸€ä¸ªå°ºå¯¸åœ¨æŒ‡å®šçš„å°ºå¯¸èŒƒå›´å†…ã€‚</strong>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹ç›®æ ‡çš„å°ºå¯¸åšé™åˆ¶æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯é¢„å…ˆå¯¹è®­ç»ƒæ•°æ®åšè¿‡æ»¤ï¼Œè®­ç»ƒæ•°æ®è¿˜æ˜¯åŸºäºæ‰€æœ‰æ•°æ®è¿›è¡Œ</p>
<p><strong>Figure6æ˜¯SNIPç®—æ³•çš„ç¤ºæ„å›¾ã€‚</strong>ä¸ç®¡æ˜¯è®­ç»ƒæ£€æµ‹å™¨è¿˜æ˜¯RPNç½‘ç»œï¼Œéƒ½æ˜¯åŸºäºæ‰€æœ‰ground truthæ¥å®šä¹‰proposalå’Œanchorçš„æ ‡ç­¾ã€‚æ­£å¦‚å‰é¢æ‰€è¿°ï¼ŒæŸä¸ªROIåœ¨æŸæ¬¡è®­ç»ƒä¸­æ˜¯å¦å›ä¼ æ¢¯åº¦æ˜¯å’Œé¢„è®­ç»ƒæ¨¡å‹çš„æ•°æ®å°ºå¯¸ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æŸä¸ªROIçš„é¢ç§¯åœ¨æŒ‡å®šèŒƒå›´å†…æ—¶ï¼Œè¯¥ROIå°±æ˜¯validï¼Œä¹Ÿå°±æ˜¯ä¼šåœ¨æ­¤æ¬¡è®­ç»ƒä¸­å›ä¼ æ¢¯åº¦ï¼Œå¦åˆ™å°±æ˜¯æ— æ•ˆçš„ï¼ˆå¦‚Figure6ä¸­å³è¾¹çš„ç´«è‰²æ¡†æ‰€ç¤ºï¼‰ã€‚</p>
<p>å…¶å®å°±æ˜¯å…ˆé€‰æ‹©å‡ ä¸ªå°ºå¯¸ä¸‹ç›¸ä¼¼çš„ç›®æ ‡å°ºå¯¸â€”â€”&gt;ç„¶åé€‰å®šè¿™äº›ç›®æ ‡å»å›ä¼ æ¢¯åº¦â€”â€”&gt;è¿™äº›æ— æ•ˆçš„ROIæ‰€å¯¹åº”çš„invalid ground truthä¼šç”¨æ¥å†³å®šRPNç½‘ç»œä¸­å…ˆéªŒæ¡†â€”â€”&gt;æ— æ•ˆå…ˆéªŒæ¡†çš„å®šä¹‰æ˜¯å’Œinvalid ground truthçš„IOUå¤§äº0.3çš„anchorã€‚æ‰€ä»¥å¦‚å›¾æ‰€ç¤ºä¸‰ä¸ªä¸åŒå°ºåº¦ä¸‹æ£€æµ‹çš„ç›®æ ‡å¤§å°è¿‘ä¼¼ï¼Œæœ‰æ•ˆé˜²æ­¢äº†è¿‡å¤§æˆ–è€…è¿‡å°ç›®æ ‡å¯¹è®­ç»ƒçš„å½±å“ã€‚<br>å³ï¼š</p>
<ul>
<li>æ¯ä¸ªpipe-lineçš„RPNåªè´Ÿè´£ä¸€ä¸ªscale rangeçš„proposalç”Ÿæˆã€‚</li>
<li>å¯¹äºå¤§sizeçš„feature mapï¼Œå¯¹åº”çš„RPNåªè´Ÿè´£é¢„æµ‹è¢«æ”¾å¤§çš„å°ç‰©ä½“ï¼›å¯¹äºå°sizeçš„feature mapï¼Œå¯¹åº”çš„RPNåªè´Ÿè´£é¢„æµ‹è¢«ç¼©å°çš„å¤§ç‰©ä½“ï¼›è¿™æ ·çš„è®¾è®¡ä¿è¯äº†æ¯ä¸ªCNNåˆ†æ”¯åœ¨åˆ¤åˆ«proposalæ˜¯å¦ä¸ºå‰æ™¯æ—¶ï¼Œåªéœ€é’ˆå¯¹æœ€æ˜“åˆ†ç±»çš„ä¸­ç­‰rangeçš„proposalè¿›è¡Œè®­ç»ƒã€‚</li>
<li>åœ¨Image Pyramidçš„åŸºç¡€ä¸ŠåŠ å…¥äº† æ¯å±‚scale çš„ proposalæœ‰æ•ˆç”ŸæˆèŒƒå›´ï¼Œå‘æ‰¬æœ¬scaleçš„ä¼˜åŠ¿ï¼Œå›é¿å…¶ä»–scaleçš„åŠ£åŠ¿ï¼Œå¤§å¤§é™ä½äº†å‰æ™¯åˆ†ç±»ä»»åŠ¡çš„éš¾åº¦ï¼Œä»è€Œâ€œä½œå¼Šå¼â€åœ°å®ç°äº†Scale Invarianceã€‚</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/18194124-c5b361a53d0a4132.jpg" alt></p>
<p><strong>å…³äºRPNç½‘ç»œä¸­ä¸åŒæ ‡ç­¾çš„anchoræ¯”ä¾‹ä½œè€…ä¹Ÿåšäº†åˆ†æ</strong>ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨RPNç½‘ç»œä¸­ï¼Œä¸€ä¸ªanchorçš„æ ‡ç­¾æ˜¯æ ¹æ®è¯¥anchorå’Œground truthçš„IOUæ¥å†³å®šçš„ï¼Œ<strong>åªæœ‰ä¸¤ç§æƒ…å†µä¸‹æ‰ä¼šè®¤ä¸ºæŸä¸ªanchorçš„æ ‡ç­¾æ˜¯æ­£æ ·æœ¬ï¼ˆæ ‡ç­¾ä¸º1ï¼‰ï¼š</strong></p>
<p><strong>1ã€å‡å¦‚è¯¥anchorå’ŒæŸä¸ªground truthçš„IOUè¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼ˆé˜ˆå€¼é»˜è®¤é‡‡ç”¨æ˜¯0.7ï¼‰ï¼Œé‚£ä¹ˆè¯¥anchoå°±æ˜¯æ­£æ ·æœ¬ã€‚</strong></p>
<p><strong>2ã€å‡å¦‚ä¸€ä¸ªground truthå’Œæ‰€æœ‰anchorçš„IOUéƒ½æ²¡è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œé‚£ä¹ˆå’Œè¯¥ground truthçš„IOUæœ€å¤§çš„é‚£ä¸ªanchorå°±æ˜¯æ­£æ ·æœ¬ã€‚</strong></p>
<p>åŒæ ·ï¼Œä½œè€…å°†conv4çš„è¾“å‡ºä½œä¸ºRPNç½‘ç»œçš„è¾“å…¥ï¼Œç„¶åè®¾ç½®äº†15ç§anchorï¼ˆ5 scalesï¼Œ3 aspect ratiosï¼‰ï¼Œæ¥ä¸‹æ¥å°±æœ‰æ„æ€äº†ï¼Œä½œè€…å‘ç°åœ¨COCOæ•°æ®é›†ä¸Šï¼ˆå›¾åƒå¤§å°ä¸º800 x 1200ï¼‰ï¼Œåªæœ‰30%çš„ground truthæ»¡è¶³å‰é¢ç¬¬ä¸€ç§æƒ…å†µï¼å³ä¾¿å°†é˜ˆå€¼è°ƒæ•´ä¸º0.5ï¼Œä¹Ÿåªæœ‰58%çš„ground truthæ»¡è¶³ç¬¬ä¸€ç§æƒ…å†µï¼è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿ</p>
<p><strong>è¯´æ˜å³ä¾¿é˜ˆå€¼ç­‰äº0.5ï¼Œä»æœ‰40%çš„æ­£æ ·æœ¬anchorå’Œground truthçš„IOUå°äº0.5</strong>ï¼ˆè¿™äº›anchoræ˜¯å› ä¸ºæ»¡è¶³å‰é¢çš„æƒ…å†µ2æ‰è¢«å®šä¹‰ä¸ºæ­£æ ·æœ¬ï¼‰ï¼æ˜¾ç„¶ï¼Œè¿™æ ·çš„æ­£æ ·æœ¬è´¨é‡ä¸ç®—å¾ˆé«˜ã€‚è€Œè¿™ç¯‡æ–‡ç« å› ä¸ºå¼•å…¥å¤šç§åˆ†è¾¨ç‡çš„å›¾åƒä½œä¸ºè¾“å…¥ï¼Œæ‰€ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†è¿™ç§ç°è±¡ã€‚å¦å¤–ï¼Œä½œè€…ä¹Ÿå°è¯•å°†conv4å’Œconv5çš„ç‰¹å¾åšèåˆå¹¶é¢„æµ‹ï¼Œä¸è¿‡è¿™éƒ¨åˆ†æ–‡ç« åªæ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œè¿˜éœ€è¦çœ‹æºç æ‰èƒ½çŸ¥é“å…·ä½“æ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<h2 id="å®éªŒç»“è®º"><a href="#å®éªŒç»“è®º" class="headerlink" title="å®éªŒç»“è®º"></a>å®éªŒç»“è®º</h2><p>Table2æ˜¯SNIPç®—æ³•å’Œå…¶ä»–ç®—æ³•çš„å¯¹æ¯”ã€‚ç¬¬äºŒè¡Œçš„multi-scale testæ˜¾ç„¶æ¯”ç¬¬ä¸€è¡Œçš„single scaleæ•ˆæœè¦å¥½ã€‚ç¬¬ä¸‰è¡Œï¼Œåœ¨multi-scale testçš„åŸºç¡€ä¸ŠåŠ å…¥multi-scale trainçš„æ—¶å€™ï¼Œä¼šå‘ç°åœ¨å¤§å°ºå¯¸ç›®æ ‡ï¼ˆAPLï¼‰çš„æ£€æµ‹æ•ˆæœä¸Šè¦æ¯”åªæœ‰multi-scale testçš„æ—¶å€™å·®ã€‚è¿™ä¸ªåŸå› æˆ‘ä»¬åœ¨å‰é¢ä¹Ÿä»‹ç»è¿‡äº†ï¼Œä¸»è¦æ˜¯å› ä¸ºè®­ç»ƒæ•°æ®ä¸­é‚£äº›å°ºå¯¸æå¤§å’Œæå°çš„objectå¯¹è®­ç»ƒäº§ç”Ÿäº†è´Ÿä½œç”¨ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/18194124-9c7a6d9280067a8a.png" alt></p>
<p>Table4æ˜¯å‡ ä¸ªç›®æ ‡æ£€æµ‹ç®—æ³•ç»“æœçš„å¯¹æ¯”ã€‚D-RFCNè¡¨ç¤ºDeformable RFCNã€‚D-RFCN+SNIP(RCN+RPN)è¡¨ç¤ºåœ¨Deformable RFCNç®—æ³•çš„æ£€æµ‹æ¨¡å—å’ŒRPNç½‘ç»œä¸­åŒæ—¶åŠ å…¥SNIPã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SNIP/18194124-466c29b67f2c10d5.png" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ICCV 2019 TridentNetï¼ˆä¸‰å‰æˆŸç½‘ç»œï¼Œåˆ·æ–°COCOçºªå½•ï¼Œå·²å¼€æºï¼‰</title>
    <url>/2020/04/18/ICCV-2019-TridentNet%EF%BC%88%E4%B8%89%E5%8F%89%E6%88%9F%E7%BD%91%E7%BB%9C%EF%BC%8C%E5%88%B7%E6%96%B0COCO%E7%BA%AA%E5%BD%95%EF%BC%8C%E5%B7%B2%E5%BC%80%E6%BA%90%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯ä¸€ç¯‡å›¾æ£®ç§‘æŠ€åœ¨ICCV 2019çš„ç›®æ ‡æ£€æµ‹è®ºæ–‡ã€ŠScale-Aware Trident Networks for Object Detectionã€‹ï¼Œç®€ç§°TridentNetï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºä¸‰å‰æˆŸç½‘ç»œã€‚</p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ï¼Œå°ºåº¦å˜åŒ–ä¸€ç›´æ˜¯å¾ˆå…³é”®çš„é—®é¢˜ã€‚é’ˆå¯¹å°ºåº¦å˜åŒ–é—®é¢˜ï¼Œä¹Ÿæœ‰å¾ˆå¤šçš„æ–¹æ¡ˆè¢«æå‡ºï¼Œå¦‚Figure 1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/640.jpg" alt></p>
<p>å…¶ä¸­</p>
<p>(a)å›¾è¡¨ç¤ºå¤šå°ºåº¦å›¾åƒé‡‘å­—å¡”ç½‘ç»œï¼Œç›´æ¥å¯¹å›¾åƒè¿›è¡Œä¸åŒå°ºåº¦çš„ç¼©æ”¾ã€‚</p>
<p>(b)æ˜¯FPNç½‘ç»œï¼Œå€Ÿé‰´äº†é‡‘å­—å¡”ç»“æ„å°†åˆ†è¾¨ç‡ä¿¡æ¯å’Œè¯­ä¹‰ä¿¡æ¯ç›¸ç»“åˆï¼Œå…‹æœä¸åŒå±‚ï¼Œä¸åŒå°ºåº¦å¸¦æ¥çš„é—®é¢˜ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹æ³•çš„ç›®çš„éƒ½æ˜¯è®©æ¨¡å‹å¯¹å°ºå¯¸ä¸åŒçš„ç›®æ ‡å…·æœ‰ä¸åŒçš„æ„Ÿå—é‡ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰SNIPï¼ŒSNIPä¸»è¦åŒ…å«äº†ä¸¤ä¸ªæ”¹è¿›ç‚¹ï¼š</p>
<p>1ã€ä¸ºäº†å‡å°‘domain-shiftï¼Œåœ¨æ¢¯åº¦å›ä¼ çš„æ—¶å€™åªå°†å’Œé¢„è®­ç»ƒæ¨¡å‹æ‰€åŸºäºçš„è®­ç»ƒæ•°æ®å°ºå¯¸ç›¸åº”çš„ROIçš„æ¢¯åº¦è¿›è¡Œå›ä¼ ã€‚</p>
<p>2ã€å€Ÿé‰´äº†å¤šå°ºåº¦è®­ç»ƒæ€æƒ³ï¼Œå¼•å…¥å›¾åƒé‡‘å­—å¡”æ¥å¤„ç†æ•°æ®é›†ä¸­ä¸åŒå°ºå¯¸çš„æ•°æ®ã€‚è™½ç„¶å›¾åƒé‡‘å­—å¡”çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œä½†é€šè¿‡å¯¹åŸå›¾ä¸åŒæ¯”ä¾‹çš„ç¼©æ”¾ï¼Œå……åˆ†åˆ©ç”¨äº†æ¨¡å‹çš„è¡¨å¾èƒ½åŠ›ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒFPNäº§ç”Ÿå¤šå±‚æ¬¡çš„ç‰¹å¾ï¼Œä½†ä¹Ÿç‰ºç‰²äº†ä¸åŒå°ºåº¦ä¸‹çš„ç‰¹å¾ä¸€è‡´æ€§ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå›¾åƒé‡‘å­—å¡”è™½ç„¶æ…¢ä½†æ˜¯ç²¾åº¦é«˜ã€‚è€ŒFPNè™½ç„¶å¿«ï¼Œä½†ç›¸æ¯”äºå›¾åƒé‡‘å­—å¡”ç‰ºç‰²äº†ç²¾åº¦ã€‚æœ‰æ²¡æœ‰åŠæ³•å°†è¿™ä¸¤è€…ç»Ÿä¸€èµ·æ¥å‘¢ï¼ŸTridentNetæ¨ªç©ºå‡ºä¸–ã€‚</p>
<h2 id="ä¸»è¦è´¡çŒ®"><a href="#ä¸»è¦è´¡çŒ®" class="headerlink" title="ä¸»è¦è´¡çŒ®"></a>ä¸»è¦è´¡çŒ®</h2><p>è®ºæ–‡æå‡ºäº†TridentNetï¼ŒåŸºäºResNet-101éª¨æ¶ç½‘ç»œåœ¨COCOæ•°æ®é›†ä¸Šè¾¾åˆ°äº†å•æ¨¡å‹48.4çš„å‡†ç¡®ç‡ï¼Œåˆ·æ–°COCOçºªå½•ã€‚TridentNetçš„ä¸»è¦è´¡çŒ®åœ¨äºï¼š</p>
<ul>
<li>é¦–æ¬¡æå‡ºæ„Ÿå—é‡(receptive filed)å¯¹ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ä¸åŒå°ºåº¦å¤§å°ç›®æ ‡çš„å½±å“ï¼Œå¹¶è¿›è¡Œç›¸å…³å®éªŒéªŒè¯ã€‚</li>
<li>æå‡ºäº†é€‚åº”äºå¤šå°ºåº¦çš„ç›®æ ‡æ£€æµ‹æ¡†æ¶TridentNetã€‚</li>
<li>ä½¿ç”¨å‚æ•°å…±äº«çš„æ–¹æ³•ï¼Œæå‡ºäº†è®­ç»ƒ3ä¸ªåˆ†æ”¯ï¼Œä½†æµ‹è¯•æ—¶åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œè¿™æ ·ä¿è¯å‰å‘æ¨ç†çš„æ—¶å€™ä¸ä¼šæœ‰é¢å¤–çš„å‚æ•°å’Œè®¡ç®—é‡å¢åŠ ã€‚</li>
<li>ä½¿ç”¨ResNet-101ä¸ºbackboneçš„TridentNetåœ¨COCOæ•°æ®é›†ä¸Šè¾¾åˆ°äº†48.4çš„mapï¼ŒçœŸæ­£çš„SOTAã€‚</li>
</ul>
<h2 id="è†¨èƒ€å·ç§¯"><a href="#è†¨èƒ€å·ç§¯" class="headerlink" title="è†¨èƒ€å·ç§¯"></a>è†¨èƒ€å·ç§¯</h2><p>å‡è®¾è†¨èƒ€ç‡ä¸º$ds$ï¼Œä½¿ç”¨çš„å·ç§¯æ ¸å¤§å°ä¸º3 x 3ï¼Œåˆ™ä½¿ç”¨è†¨èƒ€å·ç§¯çš„æ„Ÿå—é‡å¤§å°ä¸º$3 + 2\times2\times(ds -1)$ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>$ds=1$ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè†¨èƒ€ï¼Œæ„Ÿå—é‡å¤§å°ä¸º3 x 3</li>
<li>$ds = 2$ï¼Œè¡¨ç¤ºè†¨èƒ€å·ç§¯ç³»æ•°ä¸º2ï¼Œæ„Ÿå—é‡å¤§å°ä¸º7 x 7</li>
<li>$ds = 4$ï¼Œè¡¨ç¤ºè†¨èƒ€å·ç§¯ç³»æ•°ä¸º4ï¼Œæ„Ÿå—é‡å¤§å°ä¸º15 x 15</li>
</ul>
<p>ä»Table1å¯ä»¥çœ‹åˆ°ï¼Œéšç€æ„Ÿå—é‡çš„å¢å¤§ï¼Œå°ç›®æ ‡çš„æ£€æµ‹å‡†ç¡®æ€§ä¹Ÿå¼€å§‹ä¸‹é™ï¼Œä½†æ˜¯å¤§ç›®æ ‡çš„æ£€æµ‹å‡†ç¡®æ€§å¼€å§‹ä¸Šå‡ï¼ŒTable1å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/641.webp" alt></p>
<h2 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h2><p>Figure2å±•ç¤ºäº†TridentNetçš„ç½‘ç»œç»“æ„ã€‚</p>
<p>åœ¨åŸå§‹çš„backboneä¸Šåšäº†ä¸‰ç‚¹å˜åŒ–ï¼šç¬¬ä¸€ç‚¹æ˜¯æ„é€ äº†ä¸åŒreceptive fieldçš„parallel multi-branchï¼Œç¬¬äºŒç‚¹æ˜¯å¯¹äºtrident blockä¸­æ¯ä¸€ä¸ªbranchçš„weightæ˜¯shareçš„ã€‚ç¬¬ä¸‰ç‚¹æ˜¯å¯¹äºæ¯ä¸ªbranchï¼Œè®­ç»ƒå’Œæµ‹è¯•éƒ½åªè´Ÿè´£ä¸€å®šå°ºåº¦èŒƒå›´å†…çš„æ ·æœ¬ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„scale-aware</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/642.webp" alt></p>
<p>TridentNetæ¨¡å—åŒ…å«3ä¸ªå®Œå…¨ä¸€æ ·çš„åˆ†æ”¯ï¼Œå”¯ä¸€ä¸åŒçš„åªæ˜¯è†¨èƒ€å·ç§¯çš„è†¨èƒ€é€Ÿç‡ã€‚ä»ä¸Šåˆ°ä¸‹ï¼Œè†¨èƒ€ç‡åˆ†åˆ«ä¸º1,2,3ï¼Œåˆ†åˆ«æ£€æµ‹å°ï¼Œä¸­ï¼Œå¤§çš„ç›®æ ‡ã€‚TridentNetçš„æ„é€ å’Œæ”¹è¿›æ˜¯é€šè¿‡å°†ä¸€äº›å¸¸è§„å·ç§¯å¿«æ›¿æ¢ä¸ºä¸‰å‰æˆŸå—(Trident Block)ã€‚å…¶ä¸­Trident  Blockç”±å¤šä¸ªå¹³è¡Œåˆ†æ”¯ç»„æˆï¼Œé™¤äº†è†¨èƒ€å·ç§¯çš„è†¨èƒ€é€Ÿç‡ä¹‹å¤–ï¼Œæ¯ä¸ªåˆ†æ”¯å’ŒåŸå§‹çš„å·ç§¯å—æœ‰å®Œå…¨ç›¸åŒçš„ç»“æ„ã€‚ä¸‹é¢ä»¥ResNetä¸ºä¾‹ï¼Œå¯¹äºä¸€ä¸ªæ®‹å·®æ¨¡å—ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå·ç§¯æ ¸å³1 x 1ï¼Œ3 x 3ï¼Œ1 x 1ã€‚è¯¦ç»†ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/643.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªåˆ†æ”¯ç”±äºè†¨èƒ€å·ç§¯çš„è†¨èƒ€é€Ÿç‡ä¸åŒä½¿å¾—ç½‘ç»œæ‹¥æœ‰äº†æ›´å¤šå¯ä¾›é€‰æ‹©çš„æ„Ÿå—é‡ã€‚é€šå¸¸ç”¨ä¸‰å‰æˆŸå—æ›¿æ¢ä¸»å¹²çš„æœ€åä¸€ä¸ªé˜¶æ®µçš„å·ç§¯å—ï¼Œå› ä¸ºä¸‰å‰æˆŸå—äº§ç”Ÿçš„æ„Ÿå—é‡æœ‰è¾ƒå¤§çš„å·®å¼‚ï¼Œè¶³ä»¥æ‰§è¡Œç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚åŒæ—¶ï¼Œä¸‰å‰æˆŸå—çš„ä¸‰ä¸ªåˆ†æ”¯ä¹‹é—´çš„æƒé‡æ˜¯å…±äº«çš„ï¼Œåªæœ‰è†¨èƒ€é€Ÿç‡ä¸åŒï¼Œè¿™ç§è®¾ç½®ä½¿å¾—æƒå€¼å…±äº«æ›´åŠ ç®€å•ã€‚æƒå€¼å…±äº«æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥ä¸å¢åŠ é¢å¤–çš„å‚æ•°é‡ã€‚</li>
<li>å’Œè®ºæ–‡çš„å‡ºå‘ç‚¹ä¸€è‡´ï¼Œå³ä¸åŒå°ºåº¦çš„ç‰©ä½“åº”è¯¥ä»¥åŒæ ·çš„è¡¨å¾èƒ½åŠ›è¿›è¡Œç»Ÿä¸€çš„è½¬åŒ–ã€‚</li>
<li>åœ¨ä¸åŒçš„æ„Ÿå—é‡ä¸‹ï¼Œå¯ä»¥å¯¹ä¸åŒå°ºåº¦èŒƒå›´è®­ç»ƒç›¸åŒçš„å‚æ•°ã€‚</li>
</ul>
<h2 id="è®­ç»ƒå’Œæµ‹è¯•"><a href="#è®­ç»ƒå’Œæµ‹è¯•" class="headerlink" title="è®­ç»ƒå’Œæµ‹è¯•"></a>è®­ç»ƒå’Œæµ‹è¯•</h2><p>TridentNetåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå¯¹æ¯ä¸€ä¸ªåˆ†æ”¯è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œéœ€è¦å¯¹ç›®æ ‡çš„ground truthçš„å¤§å°è¿›è¡Œæµ‹è¯•ï¼Œå³ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/644.webp" alt></p>
<p>å…¶ä¸­ï¼Œ$w$ï¼Œ$h$ä»£è¡¨ground truthçš„å®½å’Œé«˜ã€‚$l_{i}$ï¼Œ$u_{i}$ä»£è¡¨å®éªŒä¸­å®šä¹‰çš„ç¬¬$i$ä¸ªåˆ†æ”¯çš„ç›®æ ‡æœ€å°é¢ç§¯å’Œæœ€å¤§é¢ç§¯ ã€‚åœ¨COCOæ•°æ®é›†ä¸Šåˆ†åˆ«ä¸º32 x 32å’Œ96 x 96ã€‚åŸºäºæ­¤å…¬å¼å®ç°ç›®æ ‡åŒ¹é…åŸåˆ™ï¼Œå³å°çš„ç›®æ ‡èµ°ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸­ç­‰ç›®æ ‡èµ°ç¬¬äºŒä¸ªåˆ†æ”¯ï¼Œå¤§çš„ç›®æ ‡èµ°ç¬¬ä¸‰ä¸ªåˆ†æ”¯ã€‚è€Œä¸æ˜¯æ‰€æœ‰çš„ç›®æ ‡éƒ½èµ°ä¸€ä¸ªåˆ†æ”¯ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„è®­ç»ƒã€‚åœ¨æµ‹è¯•æ—¶ï¼Œåªç”¨ä¸­é—´çš„åˆ†æ”¯è¿›è¡Œæ¨ç†ï¼Œç„¶åå¯¹ç»“æœè¿›è¡ŒNMSåå¤„ç†ï¼Œæœ€åè¾“å‡ºé¢„æµ‹çš„ç›®æ ‡ä¿¡æ¯ã€‚å½“ç„¶è¿™æ ·åšä¼šå¸¦æ¥ä¸€äº›ç²¾åº¦æŸå¤±ï¼Œå¤§æ¦‚åœ¨0.5-1ä¸ªmapå€¼ï¼Œä½†è¿™æ ·çš„å¥½å¤„åœ¨äºä¸ä¼šå¼•å…¥é¢å¤–çš„å‚æ•°ï¼Œä¸ä¼šå¢åŠ é¢å¤–çš„è®¡ç®—é‡ã€‚</p>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>æœ¬æ–‡çš„å¦å¤–ä¸€ä¸ªå€¼å¾—ç§°é“çš„åœ°æ–¹å°±æ˜¯å®éªŒåšçš„éå¸¸æ£’ã€‚é¦–å…ˆæ¥çœ‹Multi-branch ï¼ŒWeight-sharingï¼Œ  Scale-awareæœ‰æ•ˆæ€§è¯æ˜ï¼Œå¦‚Table2æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°éƒ½æ¯”baselineå¥½å¹¶ä¸”å½“ä¸‰éƒ¨åˆ†éƒ½åŠ ä¸Šçš„æ—¶å€™æ€§èƒ½è¾¾åˆ°æœ€é«˜ã€‚æ³¨æ„ä¸€ä¸‹ï¼ŒTable2æ˜¯åœ¨COCOéªŒè¯é›†ä¸Šè¿›è¡Œçš„æµ‹è¯•ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/645.webp" alt></p>
<p>ç„¶åTable3å±•ç¤ºäº†TridentNetæ¨¡å—åˆ†æ”¯ä¸ªæ•°å¯¹APå€¼çš„å½±å“ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/646.webp" alt></p>
<p>ç„¶åTridentNetæ¨¡å—åœ¨ResNetä¸åŒblockä¸­çš„å®éªŒç»“æœå¦‚Table4æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/647.webp" alt></p>
<p>ç„¶åè®ºæ–‡æ¢ç´¢äº†TridentNetå„ä¸ªåˆ†æ”¯çš„æ£€æµ‹ç²¾åº¦ï¼Œå¦‚Table5æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/648.webp" alt></p>
<p>ç„¶åè®ºæ–‡è¿˜ç»™å‡ºäº†TridentNet ä¸­é—´åˆ†æ”¯åœ¨cocoæµ‹è¯•çš„ç»“æœï¼Œå¦‚Table6æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/649.webp" alt></p>
<p>ä¸Šé¢çš„å®éªŒéƒ½æ˜¯åœ¨COCOéªŒè¯é›†ä¸Šçš„ç»“æœï¼Œæ¥ä¸‹æ¥ç»™å‡ºæ¨¡å‹åœ¨COCOæµ‹è¯•é›†ä¸Šç›¸å¯¹äºå…¶ä»–SOATç½‘ç»œçš„ç²¾åº¦ï¼Œå¦‚Table 7æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/TridentNet/650.webp" alt></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>TridentNetæ˜¯ä¸€ç§å°ºåº¦æ•æ„Ÿçš„æ£€æµ‹ç½‘ç»œï¼Œå¹¶ä¸”è®­ç»ƒè¿‡ç¨‹ä¹Ÿè¦è¿›è¡Œå¤šå°ºåº¦è®­ç»ƒã€‚æ£€æµ‹å‡†ç¡®æ€§å¾ˆé«˜ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰é¢å¤–çš„å‚æ•°ï¼Œé¢å¤–çš„è®¡ç®—é‡ï¼Œæ˜¯ASPPç»“æ„çš„çµæ´»åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸¤é˜¶æ®µå®æ—¶æ£€æµ‹ç½‘ç»œThunderNet</title>
    <url>/2020/04/30/%E4%B8%A4%E9%98%B6%E6%AE%B5%E5%AE%9E%E6%97%B6%E6%A3%80%E6%B5%8B%E7%BD%91%E7%BB%9CThunderNet/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ThunderNetæ˜¯æ—·è§†å’Œå›½é˜²ç§‘æŠ€å¤§å­¦åˆä½œæå‡ºçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œç›®æ ‡æ˜¯åœ¨è®¡ç®—åŠ›å—é™çš„å¹³å°è¿›è¡Œå®æ—¶ç›®æ ‡æ£€æµ‹ã€‚éœ€è¦å…³æ³¨çš„åœ°æ–¹ä¸»è¦å°±æ˜¯æå‡ºçš„ä¸¤ä¸ªç‰¹å¾å¢å¼ºæ¨¡å—CEMå’ŒSAM,å…¶è®¾è®¡ç†å¿µå’Œåº”ç”¨çš„æ–¹æ³•éƒ½éå¸¸å€¼å¾—å€Ÿé‰´ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>åœ¨ç§»åŠ¨ç«¯çš„å®æ—¶ç›®æ ‡æ£€æµ‹æ˜¯ä¸€ä¸ªæä¸ºé‡è¦å¹¶ä¸”æœ‰æŒ‘æˆ˜æ€§çš„è§†è§‰é—®é¢˜ã€‚å¾ˆå¤šåŸºäºCNNçš„æ£€æµ‹å™¨éƒ½æœ‰å·¨å¤§çš„è®¡ç®—é‡ï¼Œæ‰€ä»¥åœ¨è®¡ç®—å—é™çš„åœºæ™¯ä¸‹éš¾ä»¥è¿›è¡Œå®æ—¶æ¨ç†ã€‚è®ºæ–‡æå‡ºäº†ä¸€ä¸ªè½»é‡çº§çš„ä¸¤é˜¶æ®µçš„æ£€æµ‹æ–¹æ³•-ThunderNetã€‚</p>
<ul>
<li><p>åœ¨backboneéƒ¨åˆ†ï¼Œåˆ†æäº†ä»¥å¾€çš„è½»é‡çº§backboneçš„ä¸è¶³å¹¶æå‡ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºç›®æ ‡æ£€æµ‹çš„è½»é‡çº§åŸºç¡€ç½‘ç»œ-SNetã€‚</p>
</li>
<li><p>åœ¨detectionéƒ¨åˆ†ï¼Œæå‡ºä¸€ä¸ªæœ‰æ•ˆçš„RPNå’Œæ£€æµ‹å¤´ã€‚å…¶ä¸­æ¶‰åŠåˆ°ä¸¤ä¸ªç‰¹å¾å¢å¼ºæ¨¡å—ï¼š</p>
<ul>
<li>Context Enhancement Module(CEM) ç”¨äºæ•´åˆå±€éƒ¨å’Œå…¨å±€ç‰¹å¾ã€‚</li>
<li>Spatial Attention Module(SAM)å¼•å…¥RPNå‰åèƒŒæ™¯ä¿¡æ¯ç”¨ä»¥ä¼˜åŒ–ç‰¹å¾åˆ†å¸ƒã€‚</li>
</ul>
</li>
<li><p>å¯¹ç›®æ ‡è¾“å…¥åˆ†è¾¨ç‡ã€Backboneã€æ£€æµ‹å¤´ä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œäº†å¹³è¡¡ã€‚</p>
</li>
</ul>
<p>æœ€ç»ˆThunderNetå¯ä»¥åœ¨ARMè®¾å¤‡ä¸Šè¾¾åˆ°24.1fpsçš„é€Ÿåº¦ï¼Œç²¾åº¦å’Œé€Ÿåº¦ä¸Šè¶…è¿‡äº†å¾ˆå¤šä¸€é˜¶æ®µæ£€æµ‹å™¨ã€‚</p>
<h2 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/640.png" alt></p>
<p>é¦–å…ˆå¯ä»¥çœ‹ä¸€ä¸‹åœ¨COCOæ•°æ®é›†ä¸Šè½»é‡çº§ç›®æ ‡æ£€æµ‹ç½‘ç»œçš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºæ¥å…¶æ•ˆç‡å’Œå‡†ç¡®ç‡éƒ½è¶…è¿‡äº†Peleeï¼ŒSSDç­‰ä¸€é˜¶æ®µçš„æ£€æµ‹å™¨ã€‚</p>
<h3 id="backbone"><a href="#backbone" class="headerlink" title="backbone"></a>backbone</h3><p>ThunderNetçš„Backboneæ˜¯åŸºäºShuffleNetv2æ”¹è¿›å¾—åˆ°çš„<strong>SNet</strong>ã€‚ç”±äº<strong>è¾“å…¥çš„åˆ†è¾¨ç‡åº”è¯¥å’Œbackboneçš„å®¹é‡ç›¸åŒ¹é…</strong>ï¼Œå›¾ç‰‡çš„è¾“å…¥åˆ†è¾¨ç‡è°ƒæ•´ä¸º320x320ï¼Œè¿™æå¤§çš„é™ä½äº†æ¨¡å‹çš„è®¡ç®—é‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/641.webp" alt></p>
<p>SNetä¸ShuffleNetV2åŒºåˆ«åœ¨äºSNetå°†ShuffleNetä¸­æ‰€æœ‰çš„3x3çš„å¯åˆ†ç¦»å·ç§¯æ›¿æ¢ä¸º5x5çš„å¯åˆ†ç¦»å·ç§¯ã€‚ä¸‹å›¾æ˜¯shuffleNetv2ä¸­çš„ç½‘ç»œç»“æ„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/642.png" alt></p>
<p>Backboneé€‰å–è€ƒè™‘åˆ°ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š</p>
<ol>
<li><p><strong>è¿ç§»å­¦ä¹ ï¼š</strong> ç›®æ ‡æ£€æµ‹éœ€è¦çš„backboneä¸€èˆ¬éƒ½æ˜¯åœ¨ImageNetä¸Šä¸è®­ç»ƒå¾—åˆ°çš„ï¼Œä½†æ˜¯ç›®æ ‡æ£€æµ‹çš„backboneå’Œåˆ†ç±»å™¨æ‰€éœ€è¦æå–çš„ç‰¹å¾æ˜¯ä¸ä¸€è‡´çš„ï¼Œç®€å•åœ°å°†åˆ†ç±»æ¨¡å‹è¿ç§»å­¦ä¹ åˆ°ç›®æ ‡æ£€æµ‹ä¸­ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
</li>
<li><p><strong>æ„Ÿå—é‡ï¼š</strong> CNNä¸­æ„Ÿå—é‡æ˜¯éå¸¸é‡è¦çš„å‚æ•°ï¼ŒCNNåªèƒ½è·å–åˆ°æ„Ÿå—é‡ä»¥å†…çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æ›´å¤§çš„æ„Ÿå—é‡é€šå¸¸å¯ä»¥è·å–æ›´å¤šåœ°è¯­ä¹‰ä¿¡æ¯ï¼Œå¯ä»¥æ›´å¥½åœ°ç¼–ç é•¿è·ç¦»å…³ç³»ã€‚</p>
</li>
<li><p><strong>æµ…å±‚å’Œæ·±å±‚çš„ç‰¹å¾ï¼š</strong> æµ…å±‚çš„feature mapåˆ†è¾¨ç‡æ¯”è¾ƒå¤§ï¼Œè·å–åˆ°çš„æ˜¯æè¿°ç©ºé—´ç»†èŠ‚çš„åº•å±‚ç‰¹å¾ã€‚æ·±å±‚çš„feature mapåˆ†è¾¨ç‡æ¯”è¾ƒå°ï¼Œä½†æ˜¯ä¿å­˜çš„æ˜¯æ›´å…·æœ‰é‰´åˆ«æ€§çš„é«˜çº§è¯­ä¹‰ç‰¹å¾ã€‚</p>
<p>é€šå¸¸æ¥è®²ï¼Œå¯¹äºæ¯”è¾ƒå¤§çš„backboneæ¥è¯´ï¼Œå®šä½è¦æ¯”åˆ†ç±»éš¾å¾—å¤šï¼Œè¿™æ ·å°±è¯æ˜äº†æµ…å±‚ç‰¹å¾å¯¹äºå®šä½çš„é‡è¦æ€§ã€‚ä½†æ˜¯å¯¹äºéå¸¸å°çš„backboneæ¥è¯´ï¼Œå…¶ç‰¹å¾è¡¨è¾¾èƒ½åŠ›æ¯”è¾ƒå·®ï¼Œè¿™æ ·å°±é™åˆ¶äº†å‡†ç¡®ç‡çš„ç‰¹å¾ã€‚æ‰€ä»¥æ·±å±‚å’Œæµ…å±‚çš„ç‰¹å¾éƒ½éå¸¸é‡è¦ã€‚</p>
</li>
</ol>
<p>ä½œè€…è€ƒè™‘åˆ°ä»¥ä¸Šä¸‰ä¸ªå› ç´ ï¼Œå¹¶åˆ†æäº†å…ˆå‰è½»é‡çº§backboneçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>ShuffleNetV1çš„æ„Ÿå—é‡åªæœ‰121ä¸ªåƒç´ ï¼ŒShuffleNetv2çš„æ„Ÿå—é‡åªæœ‰320ä¸ªåƒç´ ï¼Œ<strong>æ„Ÿå—é‡æ¯”è¾ƒå°</strong>ã€‚</li>
<li>ShuffleNetv2å’ŒMobileNetv2éƒ½<strong>ç¼ºå°‘æµ…å±‚çš„ç‰¹å¾</strong>ã€‚</li>
<li>Xceptionç”±äºå¯¹è®¡ç®—é‡çš„é™åˆ¶å¯¼è‡´<strong>é«˜çº§è¯­ä¹‰ä¿¡æ¯ä¸è¶³ã€‚</strong></li>
</ul>
<p>æ‰€ä»¥åœ¨è®¾è®¡SNetçš„æ—¶å€™ï¼Œç€é‡è€ƒè™‘ä»¥ä¸Šçš„å› ç´ ï¼Œå¹¶æå‡ºäº†ä¸‰ä¸ªæ¨¡å‹ï¼šSNet49ï¼ˆspeedï¼‰ã€SNet146(trade off)ã€SNet535(accuracy)ã€‚ä¸»è¦æ”¹è¿›ç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†ShuffleNetv2ä¸­çš„æ‰€æœ‰3x3çš„æ·±åº¦å¯åˆ†ç¦»å·ç§¯<strong>æ›¿æ¢ä¸º5x5çš„æ·±åº¦å¯åˆ†ç¦»å·ç§¯</strong>ï¼Œä¸¤è€…å®é™…è¿è¡Œé€Ÿåº¦ç›¸å·®ä¸å¤šï¼Œä½†æ˜¯æœ‰æ•ˆæ‰©å¤§äº†æœ‰æ•ˆæ„Ÿå—é‡ï¼ˆå‚è€ƒä¹‹å‰æ–‡ç« ç›®æ ‡æ£€æµ‹å’Œæ„Ÿå—é‡çš„æ€»ç»“å’Œæ€è€ƒï¼‰</li>
<li>SNet146å’ŒSNet535ä¸­å»æ‰äº†Conv5ï¼Œå¹¶ä¸”<strong>åŠ å®½äº†æµ…å±‚ç½‘ç»œ</strong>ï¼Œè¿›è€Œç”Ÿæˆæ›´å¤šçš„åº•å±‚ç‰¹å¾ã€‚</li>
<li>SNet49å°†Conv5ä¸­çš„é€šé“ä¸ªæ•°æ”¹ä¸º512ï¼Œä¹ŸåŠ å®½äº†æµ…å±‚ç½‘ç»œã€‚é€šè¿‡è¿™æ ·æ“ä½œæ˜¯ä¸ºäº†<strong>å¹³è¡¡æµ…å±‚ç½‘ç»œå’Œæ·±å±‚ç½‘ç»œ</strong>ã€‚</li>
</ol>
<h3 id="Detection"><a href="#Detection" class="headerlink" title="Detection"></a>Detection</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/643.webp" alt></p>
<p>åœ¨ä»¥å¾€çš„ä¸¤é˜¶æ®µæ£€æµ‹å™¨ä¸­ï¼ŒRPNå’ŒDetectionå¤´éƒ½å¤ªé‡äº†ï¼Œä¸ºäº†å’Œè½»é‡çº§çš„ç½‘ç»œè¿›è¡Œé…åˆä»¥åŠé™ä½è®¡ç®—é‡ï¼ŒThunderNetæ²¿ç”¨äº†Light-Head R-CNNä¸­çš„å¤§éƒ¨åˆ†è®¾ç½®ï¼Œå¹¶é’ˆå¯¹è®¡ç®—é‡æ¯”è¾ƒå¤§çš„éƒ¨åˆ†è¿›è¡Œæ”¹åŠ¨ï¼š</p>
<ul>
<li>å°†RPNä¸­åŸæœ‰256ç»´çš„3x3å·ç§¯æ›¿æ¢ä¸º5x5çš„dwconv+1x1conv</li>
<li>è®¾ç½®äº”ä¸ªscale{32,64,128,256,512}å’Œ5ä¸ªæ¯”ä¾‹{1:2,3:4,1:1,4:3,2:1}</li>
<li>æå‡ºPSRoI alignæ¥å–ä»£RoI warping, å‡å°‘RoIä¸ªæ•°ç­‰</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šç»†èŠ‚éƒ¨åˆ†çš„è°ƒæ•´ï¼Œå¤§éƒ¨åˆ†ç»†èŠ‚éƒ½å’ŒLight-Head R-CNNæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¸¤ä¸ªé‡è¦çš„æ¨¡å—,CEMå’ŒSAM:</p>
<p><strong>CEM</strong></p>
<p>åœ¨Light-Head R-CNNä¸­ï¼Œä½¿ç”¨äº†Global Convolutional  Networkæ¥å¢å¤§æ¨¡å‹çš„æ„Ÿå—é‡ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æå¤§çš„è®¡ç®—é‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒThunderNetä¸­æå‡ºäº†CEMæ¥å¢å¤§æ„Ÿå—é‡ï¼Œèåˆå¤šå°ºåº¦å±€éƒ¨ä¿¡æ¯å’Œå…¨å±€ä¿¡æ¯æ¥è·å–æ›´æœ‰é‰´åˆ«æ€§çš„ç‰¹å¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/644.webp" alt></p>
<p>ä¸Šå›¾æ˜¯CEMå±‚çš„ç»“æ„ï¼Œå…¶ä¸­C4æ¥è‡ªbackboneçš„Stage3ï¼ŒC5æ¥è‡ªbackboneçš„Stage4ã€‚å…·ä½“æ“ä½œè¿‡ç¨‹ä¸Šå›¾å¾ˆæ˜æ˜¾ï¼Œæ„é€ äº†ä¸€ä¸ªå¤šå°ºåº¦çš„ç‰¹å¾é‡‘å­—å¡”ï¼Œç„¶åä¸‰ä¸ªå±‚ç›¸åŠ ï¼Œå®Œæˆç‰¹å¾çš„ä¼˜åŒ–ã€‚</p>
<p>æ¥è§¦è¿‡SENetçš„è¯»è€…å¯èƒ½å¯¹è¿™ä¸ªç»“æ„æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œä½¿ç”¨Global Avg  poolä»¥åå®é™…ä¸Šå¾—åˆ°äº†ä¸€ä¸ªé€šé“çš„Attention,åªä¸è¿‡SENetæ˜¯ç›¸ä¹˜ï¼Œè€Œè¿™é‡Œç›´æ¥ç›¸åŠ ã€‚æ€»ä½“æ¥è¯´è¿™ä¸ªæ¨¡å—æ„é€ çš„å¾ˆå¥½ï¼Œä»¥æ¯”è¾ƒå°çš„è®¡ç®—ä»£ä»·æ‰©å¤§äº†æ„Ÿå—é‡ï¼Œæä¾›äº†å¤šå°ºåº¦ç‰¹å¾ã€‚åŒæ—¶ä¹Ÿæœ‰ä¸€äº›åœ°æ–¹éœ€è¦å•†é‡ï¼Œæ¯”å¦‚æ˜¯SENetä¸­çš„ä¹˜æ³•æ›´é€‚åˆå‘¢ï¼Ÿè¿˜æ˜¯ç›´æ¥ç›¸åŠ æ›´é€‚åˆï¼Ÿ</p>
<p><strong>SAM</strong></p>
<p>SAMå®é™…ä¸Šå°±æ˜¯åˆ©ç”¨RPNå¾—åˆ°çš„feature map,ç„¶åç”¨ä¸€ä¸ªAttentionæœºåˆ¶å¯¹ç‰¹å¾è¿›è¡Œä¼˜åŒ–ï¼Œå…·ä½“å®ç°æ–¹å¼è§ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/645.png" alt></p>
<p>è¿™ä¸ªéƒ¨åˆ†è®¾è®¡å®é™…ä¸Šæ˜¯æ¯”è¾ƒå¥½çš„ç»“åˆäº†ä¸¤é˜¶æ®µæ¨¡å‹çš„RPNç½‘ç»œã€‚RPNç½‘ç»œæ˜¯ç”¨æ¥æå‡ºproposalçš„ï¼Œåœ¨RPNä¸­ï¼Œæˆ‘ä»¬æœŸæœ›èƒŒæ™¯åŒºåŸŸç‰¹å¾ä¸è¢«å…³æ³¨ï¼Œè€Œæ›´å¤šåœ°å…³æ³¨å‰æ™¯ç‰©ä½“ç‰¹å¾ã€‚RPNæœ‰è¾ƒå¼ºçš„åˆ¤åˆ«å‰æ™¯å’ŒèƒŒæ™¯çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¿™é‡Œçš„å°±ç”¨RPNçš„ç‰¹å¾æ¥æŒ‡å¯¼åŸæœ‰ç‰¹å¾ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªSpatial Attentionï¼Œé€šè¿‡1x1å·ç§¯ã€BNã€Sigmoidå¾—åˆ°åŠ æƒçš„ç‰¹å¾å›¾ï¼Œå¼•å¯¼ç½‘ç»œå­¦ä¹ åˆ°æ­£ç¡®çš„å‰æ™¯èƒŒæ™¯ç‰¹å¾åˆ†å¸ƒã€‚</p>
<p>è¿™ä¸ªæ¨¡å—ä¹Ÿæ˜¯éå¸¸ç²¾å¦™çš„ç»“åˆäº†RPNä»¥åŠç©ºé—´Attentionæœºåˆ¶ï¼Œéå¸¸insightï¼Œæœ‰æ•ˆåœ°å¯¹è½»é‡çº§ç½‘ç»œç‰¹å¾è¿›è¡Œäº†ä¼˜åŒ–,å¼¥è¡¥äº†è½»é‡ç½‘ç»œç‰¹å¾æ¯”è¾ƒå¼±çš„ç¼ºç‚¹ã€‚</p>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/646.jpg" alt></p>
<p>ä¸Šè¡¨æ˜¯åœ¨VOC2007æ•°æ®é›†ä¸Šçš„ç»“æœï¼Œå¯ä»¥çœ‹å‡ºï¼ŒThunderNetåœ¨æ¯”è¾ƒå¥½åœ°åšåˆ°äº†ç²¾åº¦å’Œè®¡ç®—é‡çš„æƒè¡¡ï¼Œå¹¶ä¸”è¯æ˜äº†ä¸¤é˜¶æ®µç½‘ç»œä¹Ÿæœ‰è¶…è¶Šä¸€é˜¶æ®µç½‘ç»œçš„æ½œåŠ›ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ThunderNet/647.jpg" alt></p>
<p>ä¸Šè¡¨æ˜¯åœ¨COCOæ•°æ®é›†ä¸Šçš„ç»“æœï¼Œå¯ä»¥çœ‹å‡ºæ•ˆæœä¾ç„¶éå¸¸å‡ºä¼—ã€‚SNet49çš„ThunderNetåœ¨ä¸MobileNet-SSDç›¸è¿‘çš„ç²¾åº¦ä¸‹ï¼Œé€Ÿåº¦å¿«äº†5å€ï¼›SNet146çš„ThunderNetä¸one-stageç›¸æ¯”ï¼Œæœ‰æ›´é«˜çš„ç²¾åº¦ï¼›SNet535çš„ThunderNetç²¾åº¦åœ¨å’Œå¤§å‹çš„ä¸€é˜¶æ®µç½‘ç»œï¼ˆSSD,DSSDï¼‰ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—é‡æ˜¾è‘—é™ä½ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ThunderNetä½œè€…éå¸¸å–„äºæ€è€ƒï¼Œåœ¨å°†ä¸¤é˜¶æ®µæ£€æµ‹å™¨è¿›è¡Œè½»é‡åŒ–è®¾è®¡çš„è¿™ä¸ªé—®é¢˜ä¸Šæœ‰ç‹¬ç‰¹çš„æƒ³æ³•ï¼Œå¾ˆå¤šæ”¹è¿›çš„ç‚¹éƒ½æ˜¯æ¥è‡ªæ„Ÿå—é‡çš„åˆ†æã€‚ä¸»è¦æå‡ºäº†ä¸¤ä¸ªé‡è¦çš„æ¨¡å—ï¼š<strong>CEM å’ŒSAM</strong></p>
<p>CEMæ€»çš„æ¥è¯´æ˜¯èåˆäº†ä¸€ä¸ªå°å‹çš„<strong>FPN+é€šé“æ³¨æ„åŠ›æœºåˆ¶</strong>ï¼Œä»¥éå¸¸å°‘çš„è®¡ç®—ä»£ä»·æé«˜äº†æ¨¡å‹çš„æ„Ÿå—é‡ï¼Œä¼˜åŒ–äº†backboneçš„ç‰¹å¾ã€‚</p>
<p>SAMæ€»çš„æ¥è¯´æ˜¯ç”¨<strong>RPN</strong>çš„ç‰¹å¾åŠ å¼ºåŸæœ‰ç‰¹å¾ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶</strong>ï¼Œè¿™ç§æ–¹æ³•æˆ–è®¸å¯ä»¥æ‰©å±•åˆ°æ‰€æœ‰çš„å¤šé˜¶æ®µæ£€æµ‹å™¨ä¸­ã€‚</p>
<p>è€ŒSNetå¯¹ShuffleNetV2çš„æ”¹è¿›ä¹Ÿåœ¨æ¶ˆèå®éªŒä¸­å¾—åˆ°è¯æ˜ï¼Œæ‰€ä»¥æˆ–è®¸å…¶ä»–è½»é‡çº§ç½‘ç»œä¹Ÿå¯ä»¥<strong>å€Ÿé‰´ç”¨5x5dwconvæ›¿æ¢æ‰3x3convçš„æ€è·¯</strong>ã€‚</p>
<p>ThunderNetæˆåŠŸè¶…è¶Šäº†å¾ˆå¤šä¸€é˜¶æ®µçš„æ–¹æ³•ï¼Œä¹Ÿè®©æˆ‘ä»¬æ”¹å˜äº†ä¼ ç»Ÿä¸¤é˜¶æ®µç½‘ç»œè®¡ç®—é‡å¤§ä½†ç²¾åº¦é«˜çš„å°è±¡ã€‚è™½ç„¶å¾ˆå¤šè®ºæ–‡ä¸­éƒ½ç”¨åˆ°äº†ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶å’Œé€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼ŒThunderNetä¸­é€šè¿‡è‡ªå·±ç‹¬åˆ°çš„æƒ³æ³•ï¼Œæ¯”è¾ƒå®Œç¾åœ°èåˆäº†è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæœ‰ç†æœ‰æ®ï¼Œéå¸¸æœ‰åŠ›ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆ (ASFF)</title>
    <url>/2020/04/20/%E8%87%AA%E9%80%82%E5%BA%94%E7%A9%BA%E9%97%B4%E7%89%B9%E5%BE%81%E8%9E%8D%E5%90%88-(ASFF)/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯2019å¹´çš„ä¸€ç¯‡è®ºæ–‡ <strong>ã€ŠLearning Spatial Fusion for Single-Shot Object Detectionã€‹</strong>ï¼Œè¿™ç¯‡è®ºæ–‡ä¸»è¦æ˜¯å› ä¸ºå…¶æå‡ºçš„ <strong>è‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆ</strong>  (ASFF)è¢«å¤§å®¶æ‰€ç†ŸçŸ¥ã€‚é‡‘å­—å¡”ç‰¹å¾è¡¨ç¤ºæ³•(FPN)æ˜¯è§£å†³ç›®æ ‡æ£€æµ‹å°ºåº¦å˜åŒ–æŒ‘æˆ˜çš„å¸¸ç”¨æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¯¹äºåŸºäºFPNçš„å•çº§æ£€æµ‹å™¨æ¥è¯´ï¼Œä¸åŒç‰¹å¾å°ºåº¦ä¹‹é—´çš„ä¸ä¸€è‡´æ˜¯å…¶ä¸»è¦é™åˆ¶ã€‚å› æ­¤è¿™ç¯‡è®ºæ–‡æå‡ºäº†ä¸€ç§æ–°çš„æ•°æ®é©±åŠ¨çš„é‡‘å­—å¡”ç‰¹å¾èåˆæ–¹å¼ï¼Œç§°ä¹‹ä¸ºè‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆï¼ˆASFFï¼‰ã€‚å®ƒå­¦ä¹ äº†åœ¨ç©ºé—´ä¸Šè¿‡æ»¤å†²çªä¿¡æ¯ä»¥æŠ‘åˆ¶æ¢¯åº¦åä¼ çš„æ—¶å€™ä¸ä¸€è‡´çš„æ–¹æ³•ï¼Œä»è€Œæ”¹å–„äº†ç‰¹å¾çš„æ¯”ä¾‹ä¸å˜æ€§ï¼Œå¹¶ä¸”æ¨ç†å¼€é”€é™ä½ã€‚å€ŸåŠ©ASFFç­–ç•¥å’Œå¯é çš„YOLOV3 BaseLineï¼Œåœ¨COCOæ•°æ®é›†ä¸Šå®ç°äº†45FPS/42.4%APä»¥åŠ29FPS/43.9%APã€‚ä¸‹é¢å…ˆæ”¾ä¸€å¼ è®ºæ–‡çš„ç»“æœå›¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/640.png" alt></p>
<h2 id="ä¸€ä¸ªæ›´å¼ºçš„YOLOV3åŸºå‡†"><a href="#ä¸€ä¸ªæ›´å¼ºçš„YOLOV3åŸºå‡†" class="headerlink" title="ä¸€ä¸ªæ›´å¼ºçš„YOLOV3åŸºå‡†"></a>ä¸€ä¸ªæ›´å¼ºçš„YOLOV3åŸºå‡†</h2><p>è¿™ç¯‡æ–‡ç« ä¹‹æ‰€ä»¥å–å¾—è¿™ä¹ˆå¥½çš„æ•ˆæœä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒæå‡ºçš„ASFFè¿™ç§ç‰¹å¾è‡ªé€‚åº”èåˆæ–¹å¼ï¼Œè®ºæ–‡åœ¨YOLOV3çš„åŸºç¡€ä¸Šé›†ç™¾å®¶ä¹‹é•¿ï¼Œæ„å»ºäº†ä¸€ä¸ªéå¸¸å¼ºçš„YOLOV3  BaseLineï¼Œè¿™ä¸ªBaseLineåœ¨MSCOCOä¸Šçš„mAPå°±è¾¾åˆ°äº†38.8%ã€‚ç›¸æ¯”äºåŸå§‹çš„YOLOV3çš„33%ï¼Œæå‡äº†æ¥è¿‘6ä¸ªç‚¹ã€‚ã€‚è®ºæ–‡ä½¿ç”¨çš„æŠ€å·§åŒ…æ‹¬ï¼š</p>
<ul>
<li>Guided Anchoring</li>
<li>Bag of Tricks</li>
<li>Additional IoU Loss</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/641.png" alt></p>
<h2 id="è‡ªé€‚åº”ç‰¹å¾èåˆ-ASFF"><a href="#è‡ªé€‚åº”ç‰¹å¾èåˆ-ASFF" class="headerlink" title="è‡ªé€‚åº”ç‰¹å¾èåˆ(ASFF)"></a>è‡ªé€‚åº”ç‰¹å¾èåˆ(ASFF)</h2><p>ä¸ºäº†æ›´åŠ å……åˆ†çš„åˆ©ç”¨é«˜å±‚ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯å’Œåº•å±‚ç‰¹å¾çš„ç»†ç²’åº¦ç‰¹å¾ï¼Œå¾ˆå¤šç½‘ç»œéƒ½ä¼šé‡‡ç”¨FPNçš„æ–¹å¼è¾“å‡ºå¤šå±‚ç‰¹å¾ï¼Œä½†æ˜¯æ— è®ºæ˜¯ç±»ä¼¼äºYOLOv3è¿˜æ˜¯RetinaNetï¼Œå®ƒä»¬éƒ½å¤šç”¨concatenationæˆ–è€…element-wiseè¿™ç§ç›´æ¥è¡”æ¥æˆ–è€…ç›¸åŠ çš„æ–¹å¼ï¼Œè®ºæ–‡è®¤ä¸ºè¿™æ ·å¹¶ä¸èƒ½å……åˆ†çš„åˆ©ç”¨ä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼Œæ‰€ä»¥æå‡ºäº†<strong>Adaptively Spatial Feature Fusion</strong>ï¼ˆè‡ªé€‚åº”ç‰¹å¾èåˆæ–¹å¼ï¼‰ã€‚ä»¥ASFF-3ä¸ºä¾‹ï¼Œå…¶ç»“æ„å¯ä»¥è¡¨ç¤ºä¸ºFigure2ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/642.jpg" alt></p>
<p>åœ¨Figure2ä¸­ï¼Œç»¿è‰²æ¡†æè¿°äº†å¦‚ä½•å°†ç‰¹å¾è¿›è¡Œèåˆï¼Œå…¶ä¸­$X^{1}$ï¼Œ$X^{2}$ï¼Œ$X^{3}$åˆ†åˆ«ä¸ºæ¥è‡ªlevel1ï¼Œlevel2ï¼Œlevel3è¿™ä¸‰ä¸ªå±‚çš„ç‰¹å¾ã€‚ç„¶ålevel1ï¼Œlevel2ï¼Œlevel3è¿™ä¸‰ä¸ªå±‚çš„ç‰¹å¾åˆ†åˆ«ä¹˜ä¸Šæƒé‡å‚æ•°å¹¶æ±‚å’Œï¼Œå°±å¯ä»¥å¾—åˆ°æ–°çš„èåˆåçš„ç‰¹å¾ASFF-3ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨å…¬å¼(1)æ¥è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/643.png" alt></p>
<p>å› æ­¤è¿™é‡Œæ˜¯ç›¸åŠ çš„æ“ä½œï¼Œæ‰€ä»¥éœ€è¦åŠ çš„æ—¶å€™å¿…é¡»ä¿è¯leve1ï¼Œlevel2ï¼Œlevel3è¾“å‡ºçš„ç‰¹å¾ç›¸åŒï¼Œä¸”é€šé“æ•°ä¹Ÿè¦ç›¸åŒï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¸åŒçš„ç‰¹å¾å±‚åšä¸Šé‡‡æ ·æˆ–è€…ä¸‹é‡‡æ ·å¹¶è°ƒæ•´é€šé“æ•°æ¥æ»¡è¶³æ¡ä»¶ã€‚å¯¹äºéœ€è¦ä¸Šé‡‡æ ·çš„å±‚ï¼Œå¦‚æƒ³å¾—åˆ°ASFF3ï¼Œéœ€è¦å°†level1çš„ç‰¹å¾å›¾è°ƒæ•´åˆ°å’Œlevel3çš„ç‰¹å¾å›¾å°ºå¯¸ä¸€è‡´ï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯å…ˆé€šè¿‡1 x 1å·ç§¯è°ƒæ•´åˆ°å’Œlevel3é€šé“æ•°ä¸€è‡´ï¼Œå†ç”¨æ’å€¼çš„æ–¹å¼å°†å°ºå¯¸è°ƒæ•´åˆ°ä¸€è‡´ã€‚è€Œå¯¹äºéœ€è¦ä¸‹é‡‡æ ·çš„å±‚ï¼Œæ¯”å¦‚æƒ³å¾—åˆ°ASFF1ï¼Œå¯¹äºlevel2çš„ç‰¹å¾å›¾åˆ°level1çš„ç‰¹å¾å›¾åªéœ€è¦ç”¨ä¸€ä¸ª3 x 3å¹¶ä¸”stride=2çš„å·ç§¯å°±OKäº†ï¼Œå¦‚æœæ˜¯level3çš„ç‰¹å¾å›¾åˆ°level1çš„ç‰¹å¾å›¾åˆ™éœ€è¦åœ¨3 x 3å·ç§¯çš„åŸºç¡€ä¸Šå†åŠ ä¸Šä¸€ä¸ªstride=2çš„æœ€å¤§æ± åŒ–å±‚ã€‚</p>
<p>å¯¹äºæƒé‡å‚æ•°$\alpha$ï¼Œ$\beta$ï¼Œ$\gamma$ï¼Œåˆ™æ˜¯é€šè¿‡resizeåçš„level1~level3ç‰¹å¾å›¾ç»è¿‡1 x 1å·ç§¯è·å¾—çš„ã€‚å¹¶ä¸”å‚æ•°$\alpha$ï¼Œ$\beta$ï¼Œ$\gamma$ç»è¿‡concatä¹‹åé€šè¿‡<code>softmax</code>ä½¿å¾—å®ƒä»¬çš„èŒƒå›´éƒ½åœ¨<code>[0,1]</code>å¹¶ä¸”å’Œä¸º<code>1</code>ã€‚</p>
<h2 id="ASFFçš„å¯è§£é‡Šæ€§"><a href="#ASFFçš„å¯è§£é‡Šæ€§" class="headerlink" title="ASFFçš„å¯è§£é‡Šæ€§"></a>ASFFçš„å¯è§£é‡Šæ€§</h2><p>è®ºæ–‡é€šè¿‡æ¢¯åº¦å’Œåå‘ä¼ æ’­æ¥è§£é‡Šä¸ºä»€ä¹ˆASFFä¼šæœ‰æ•ˆã€‚è®ºæ–‡ä»¥YOLOv3ä¸ºä¾‹ï¼ŒåŠ å…¥FPNåé€šè¿‡é“¾å¼æ³•åˆ™æˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨åå‘ä¼ æ’­çš„æ—¶å€™æ¢¯åº¦è®¡ç®—å¦‚å…¬å¼(3)æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/644.png" alt></p>
<p>ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œå·¦è¾¹çš„ç¬¬ä¸€é¡¹$\frac{\partial L}{\partial x_{i j}^{1}}$ä»£è¡¨çš„æ˜¯æŸå¤±å‡½æ•°å¯¹level1çš„ç‰¹å¾å›¾çš„æŸä¸ªåƒç´ æ±‚å¯¼ï¼Œåœ¨YOLOV3ä¸­ä¸åŒå°ºåº¦çš„å±‚ä¹‹é—´çš„å°ºåº¦å˜åŒ–ä¸€èˆ¬å°±æ˜¯ä¸‹é‡‡æ ·å’Œä¸Šé‡‡æ ·ï¼Œå› æ­¤è¿™ä¸€é¡¹$\frac{\partial x_{i j}^{1-&gt;l}}{\partial x_{i j}^{1}}$é€šå¸¸ä¸ºå›ºå®šå€¼ï¼Œä¸ºäº†ç®€åŒ–è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸º1ï¼Œå³ï¼š$\frac{\partial x_{i j}^{1-&gt;l}}{\partial x_{i j}^{1}} \approx 1$ï¼Œé‚£ä¹ˆå…¬å¼(3)å¯ä»¥ç®€åŒ–ä¸ºå…¬å¼(4)ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/645.png" alt></p>
<p>è¿›ä¸€æ­¥ï¼Œè¿™ä¸€é¡¹$\frac{\partial y_{i j}^{1}}{\partial x_{i j}^{1}}$ç›¸å½“äºå¯¹è¾“å‡ºç‰¹å¾çš„activationæ“ä½œï¼Œå¯¼æ•°ä¹Ÿå°†ä¸ºå›ºå®šå€¼ï¼Œ$\frac{\partial y_{i j}^{l}}{\partial x_{i j}^{1-&gt;l}}$ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒçš„å€¼åŒæ ·ç®€åŒ–ä¸º1ï¼Œåˆ™è¡¨è¾¾å¼è¿›ä¸€æ­¥ç®€åŒ–æˆäº†å…¬å¼(5)ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/646.png" alt></p>
<p>å‡è®¾$\operatorname{level} 1(i, j)$å¯¹åº”ç‰¹å¾å›¾ä½ç½®åˆšå¥½æœ‰ç‰©ä½“å¹¶ä¸”ä¸ºæ­£æ ·æœ¬ï¼Œé‚£å…¶ä»–ä¸Šå¯¹åº”çš„ä½ç½®ä¸Šå°±å¯èƒ½åˆšå¥½ä¸ºè´Ÿæ ·æœ¬ï¼Œè¿™æ ·åå‘ä¼ æ’­çš„æ¢¯åº¦ä¸­æ—¢åŒ…å«äº†æ­£æ ·æœ¬åˆåŒ…å«äº†è´Ÿæ ·æœ¬ï¼Œè¿™ç§ä¸è¿ç»­æ€§ä¼šå¯¹æ¢¯åº¦ç»“æœé€ æˆå¹²æ‰°ï¼Œå¹¶ä¸”é™ä½è®­ç»ƒçš„æ•ˆç‡ã€‚è€Œé€šè¿‡ASFFçš„æ–¹å¼ï¼Œåå‘ä¼ æ’­çš„æ¢¯åº¦è¡¨è¾¾å¼å°±å˜æˆäº†(6)ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/647.png" alt></p>
<p>å› æ­¤ï¼Œå¦‚æœå‡ºç°åˆšæ‰çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†$\alpha^{2}$å’Œ$\alpha^{3}$è®¾ç½®ä¸º0æ¥è§£å†³ï¼Œå› ä¸ºè¿™æ ·è´Ÿæ ·æœ¬çš„æ¢¯åº¦ä¸ä¼šç»“æœé€ æˆå¹²æ‰°ã€‚</p>
<p><strong>åŒæ—¶è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆç‰¹å¾èåˆçš„æƒé‡å‚æ•°æ¥æºäºè¾“å‡ºç‰¹å¾+å·ç§¯ï¼Œå› ä¸ºèåˆçš„æƒé‡å‚æ•°å’Œç‰¹å¾æ˜¯æ¯æ¯ç›¸å…³çš„ã€‚</strong></p>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>ä¸‹é¢çš„Table3å±•ç¤ºäº†ASFFç›¸æ¯”äºconcatå’Œsumçš„æ–¹å¼çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°åŠ å…¥äº†ASFFåœ¨BaseLineçš„åŸºç¡€ä¸Šæå‡äº†2ä¸ªå¤šä¸ªmAPã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/648.png" alt></p>
<p>æ¥ç€ä½œè€…åˆå¯¹ASFFåšäº†å¯è§†åŒ–åˆ†æï¼Œå¦‚Figure3æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ASFF/649.jpg" alt></p>
<p>å¯è§†åŒ–çš„ç»“æœè¿›ä¸€æ­¥è§£é‡Šäº†ASFFçš„æœ‰æ•ˆæ€§ã€‚æ¯”å¦‚å¯¹äºæ–‘é©¬çš„æ£€æµ‹ï¼Œå¯ä»¥çœ‹åˆ°æ–‘é©¬å®é™…ä¸Šæ˜¯åœ¨level1è¿™ä¸ªç‰¹å¾å›¾ä¸Šè¢«æ£€æµ‹åˆ°çš„ï¼ˆå“åº”è¶Šå¤§ï¼Œheatmapè¶Šçº¢ï¼‰ï¼Œå¹¶ä¸”è§‚å¯Ÿlevel1è¿™ä¸€å±‚çš„$\alpha$ï¼Œ$\beta$ï¼Œ$\gamma$çš„æƒé‡å¯ä»¥å‘ç°ï¼Œå¯¹äºå›¾ä¸­æ–‘é©¬è¿™ç§å¤§ç›®æ ‡æ›´å®¹æ˜“è¢«é«˜å±‚çš„ç‰¹å¾æ•æ‰åˆ°ï¼Œå› ä¸ºå¯¹äºå¤§ç‰©ä½“æˆ‘ä»¬éœ€è¦æ›´å¤§çš„æ„Ÿå—é‡å’Œé«˜çº§è¯­ä¹‰ç‰¹å¾ã€‚è€Œå¯¹äºä¸‹é¢çš„ç¾Šç¾¤çš„æ£€æµ‹æ¥è®²ï¼Œå¯ä»¥çœ‹åˆ°ç¾Šæ›´å¤šçš„æ˜¯è¢«level2å’Œlevel3æ£€æµ‹åˆ°ï¼Œè¿™ä¹Ÿè¯´æ˜äº†å¯¹äºå°ç‰©ä½“ï¼Œæˆ‘ä»¬æ›´éœ€è¦åº•å±‚ç‰¹å¾ä¸­çš„ç»†ç²’åº¦ç‰¹å¾æ¥è¾¨åˆ«ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>è¿™ç¯‡è®ºæ–‡å°†YOLOv3çš„ç»“æœåšå¾—éå¸¸å¥½ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒçš„ç²¾åº¦éå¸¸å¼ºï¼Œè€Œä¸”ä»æ•°å­¦è§’åº¦æ¥ç®€æ´çš„è¯´æ˜è¿™ä¸ªæ–¹æ³•çš„æœ‰æ•ˆæ€§ä¹Ÿæ˜¯æ£’çš„ã€‚æ˜¯å…·æœ‰å¾ˆå¤§çš„å·¥ç¨‹å®è·µæ„ä¹‰çš„ï¼Œè®ºæ–‡å…·ä½“æ˜¯å¦‚ä½•åšå‡ºçš„Stronger YOLOv3  BaseLineï¼Œè¿™ä¸ªå¯ä»¥å»æºç ä¸€æ¢ç©¶ç«Ÿäº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€ç®€å•æœ€æ˜“å®ç°çš„SEæ¨¡å—</title>
    <url>/2020/02/19/%E6%9C%80%E7%AE%80%E5%8D%95%E6%9C%80%E6%98%93%E5%AE%9E%E7%8E%B0%E7%9A%84SE%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h2 id="Squeeze-and-Excitation-Networks"><a href="#Squeeze-and-Excitation-Networks" class="headerlink" title="Squeeze-and-Excitation Networks"></a>Squeeze-and-Excitation Networks</h2><p>SENetæ˜¯Squeeze-and-Excitation  Networksçš„ç®€ç§°ï¼Œæ‹¿åˆ°äº†ImageNet2017åˆ†ç±»æ¯”èµ›å† å†›ï¼Œå…¶æ•ˆæœå¾—åˆ°äº†è®¤å¯ï¼Œå…¶æå‡ºçš„SEæ¨¡å—æ€æƒ³ç®€å•ï¼Œæ˜“äºå®ç°ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å¯ä»¥åŠ è½½åˆ°ç°æœ‰çš„ç½‘ç»œæ¨¡å‹æ¡†æ¶ä¸­ã€‚SENetä¸»è¦æ˜¯å­¦ä¹ äº†channelä¹‹é—´çš„ç›¸å…³æ€§ï¼Œç­›é€‰å‡ºäº†é’ˆå¯¹é€šé“çš„æ³¨æ„åŠ›ï¼Œç¨å¾®å¢åŠ äº†ä¸€ç‚¹è®¡ç®—é‡ï¼Œä½†æ˜¯æ•ˆæœæ¯”è¾ƒå¥½ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/se/640.webp" alt></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥ç†è§£ä»–çš„å®ç°è¿‡ç¨‹ï¼Œé€šè¿‡å¯¹å·ç§¯çš„åˆ°çš„feature  mapè¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªå’Œé€šé“æ•°ä¸€æ ·çš„ä¸€ç»´å‘é‡ä½œä¸ºæ¯ä¸ªé€šé“çš„è¯„ä»·åˆ†æ•°ï¼Œç„¶åå°†ä¿®æ”¹çš„åˆ†æ•°åˆ†åˆ«æ–½åŠ åˆ°å¯¹åº”çš„é€šé“ä¸Šï¼Œå¾—åˆ°å…¶ç»“æœï¼Œå°±åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šåªæ·»åŠ äº†ä¸€ä¸ªæ¨¡å—ï¼Œä¸‹è¾¹æˆ‘ä»¬ç”¨pytorchå®ç°è¿™ä¸ªå¾ˆç®€å•çš„æ¨¡å—ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/se/641.webp" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SELayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, channel, reduction=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SELayer, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.fc = nn.Sequential(</span><br><span class="line">            nn.Linear(channel, channel // reduction, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Linear(channel // reduction, channel, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        b, c, _, _ = x.size()</span><br><span class="line">        y = self.avg_pool(x).view(b, c)</span><br><span class="line">        y = self.fc(y).view(b, c, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x * y.expand_as(x)</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æ ¸å¿ƒå°±æ˜¯ä»¥ä¸Šçš„å†…å®¹ï¼Œä¸è¿‡ä¸èƒ½ç®€å•åœ°ç»“æŸï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li><p>ä½œä¸ºä¸€ä¸ªé‡è¦çš„attentionæœºåˆ¶çš„æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« å¦‚ä½•æè¿°attentionï¼Œrelated workå¦‚ä½•ç»„ç»‡ï¼Ÿ</p>
<p>attentionæœºåˆ¶å½“æ—¶å·²ç»æœ‰ä¸€å®šçš„ç ”ç©¶å’Œå‘å±•ï¼Œä¹Ÿæ˜¯é›†ä¸­äºåºåˆ—å­¦ä¹ ï¼Œimage captioning, understanding in  imagesè¿™äº›å·¥ä½œï¼Œä¹Ÿå·²ç»æœ‰å¾ˆå¤šå‡ºè‰²çš„å·¥ä½œæ˜¯æ¢ç´¢äº†attentionæœºåˆ¶ã€‚senetè¿™ç¯‡æ–‡ç« ä¸»è¦æ¢ç´¢äº†é€šè¿‡å¯¹é€šé“é—´å…³ç³»è¿›è¡Œå»ºæ¨¡æ¥æå‡æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚related work ä¸»è¦ä»æ›´æ·±çš„ç½‘ç»œæ¶æ„ï¼Œæ¶æ„æœç´¢ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä¸‰ä¸ªè§’åº¦è¿›è¡Œäº†æ¢³ç†ï¼Œç¡®å®éå¸¸å…¨é¢ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£é‡ŠSEæ¨¡å—ï¼Ÿ</p>
<p><strong>Sequeeze</strong>ï¼šå¯¹$C \times H \times W$è¿›è¡Œglobal average poolingï¼Œå¾—åˆ° $1 \times 1 \times C$å¤§å°çš„ç‰¹å¾å›¾ï¼Œè¿™ä¸ªç‰¹å¾å›¾å¯ä»¥ç†è§£ä¸ºå…·æœ‰å…¨å±€æ„Ÿå—é‡ã€‚</p>
<p><strong>Excitation</strong>ï¼šä½¿ç”¨ä¸€ä¸ªå…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå¯¹Sequeezeä¹‹åçš„ç»“æœåšä¸€ä¸ªéçº¿æ€§å˜æ¢ã€‚</p>
<p><strong>ç‰¹å¾é‡æ ‡å®š</strong>ï¼šä½¿ç”¨Excitation å¾—åˆ°çš„ç»“æœä½œä¸ºæƒé‡ï¼Œä¹˜åˆ°è¾“å…¥ç‰¹å¾ä¸Šã€‚</p>
</li>
<li><p>SEæ¨¡å—å¦‚ä½•åŠ åˆ°åˆ†ç±»ç½‘ç»œï¼Œæ•ˆæœå¦‚ä½•ï¼Ÿ</p>
<p>åˆ†ç±»ç½‘ç»œç°åœ¨ä¸€èˆ¬éƒ½æ˜¯æˆä¸€ä¸ªblockä¸€ä¸ªblockï¼Œseæ¨¡å—å°±å¯ä»¥åŠ åˆ°ä¸€ä¸ªblockç»“æŸçš„ä½ç½®ï¼Œè¿›è¡Œä¸€ä¸ªä¿¡æ¯refineã€‚è¿™é‡Œç”¨äº†ä¸€äº›STOAçš„åˆ†ç±»æ¨¡å‹å¦‚ï¼šresnet50ï¼Œresnext50ï¼Œbn-inceptionç­‰ç½‘ç»œã€‚é€šè¿‡æ·»åŠ SEæ¨¡å—ï¼Œèƒ½ä½¿æ¨¡å‹æå‡0.5-1.5%,æ•ˆæœè¿˜å¯ä»¥ï¼Œå¢åŠ çš„è®¡ç®—é‡ä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚åœ¨è½»é‡çº§ç½‘ç»œMobileNetï¼ŒShuffleNetä¸Šä¹Ÿè¿›è¡Œäº†å®éªŒï¼Œå¯ä»¥æå‡çš„ç‚¹æ›´å¤šä¸€ç‚¹å¤§æ¦‚åœ¨1.5-2%ã€‚</p>
</li>
<li><p>SEæ¨¡å—å¦‚ä½•åŠ åˆ°ç›®æ ‡æ£€æµ‹ç½‘ç»œï¼Œæ•ˆæœå¦‚ä½•ï¼Ÿ</p>
<p>ä¸»è¦è¿˜æ˜¯å°†SEæ¨¡å—æ·»åŠ åˆ°backboneéƒ¨åˆ†ï¼Œä¼˜åŒ–å­¦ä¹ åˆ°çš„å†…å®¹ã€‚ç›®æ ‡æ£€æµ‹æ•°æ®é›†ä½¿ç”¨çš„æ˜¯benchmark MSCOCO, ä½¿ç”¨çš„Faster  R-CNNä½œä¸ºç›®æ ‡æ£€æµ‹å™¨ï¼Œä½¿ç”¨backboneä»ResNet50æ›¿æ¢ä¸ºSE-ResNet50ä»¥åå¸¦äº†äº†ä¸¤ä¸ªç‚¹çš„APæå‡ï¼Œç¡®å®æœ‰æ•ˆæœã€‚</p>
</li>
<li><p>è¿™ç¯‡æ–‡ç« çš„å®éªŒéƒ¨åˆ†æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ</p>
<p>è¿™ç¯‡æ–‡ç« ä¸­ä¹Ÿè¿›è¡Œäº†æ¶ˆèå®éªŒï¼Œæ¥è¯æ˜SEæ¨¡å—çš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿè¯´æ˜äº†è®¾ç½®reduction=16çš„åŸå› ã€‚</p>
<ul>
<li>squeezeæ–¹å¼ï¼šä»…ä»…æ¯”è¾ƒäº†maxå’Œavgï¼Œå‘ç°avgè¦å¥½ä¸€ç‚¹ã€‚</li>
<li>excitationæ–¹å¼ï¼šä½¿ç”¨äº†ReLUï¼ŒTanhï¼ŒSigmoidï¼Œå‘ç°Sigmoidå¥½ã€‚</li>
<li>stage: resnet50æœ‰ä¸åŒçš„é˜¶æ®µï¼Œé€šè¿‡å®éªŒå‘ç°ï¼Œå°†seæ–½åŠ åˆ°æ‰€æœ‰çš„é˜¶æ®µæ•ˆæœæœ€å¥½ã€‚</li>
<li>é›†æˆç­–ç•¥ï¼šå°†seæ”¾åœ¨æ®‹å·®å•å…ƒçš„å‰éƒ¨ï¼Œåéƒ¨è¿˜æ˜¯å¹³è¡Œäºæ®‹å·®å•å…ƒï¼Œæœ€ç»ˆå‘ç°ï¼Œæ”¾åˆ°å‰éƒ¨æ¯”è¾ƒå¥½ã€‚</li>
</ul>
</li>
<li><p>å¦‚ä½•æŸ¥çœ‹æ¯ä¸ªé€šé“å­¦åˆ°çš„attentionä¿¡æ¯å¹¶è¯æ˜å…¶æœ‰æ•ˆæ€§ï¼Ÿ</p>
<p>ä½œè€…é€‰å–äº†ImageNetä¸­çš„å››ä¸ªç±»åˆ«è¿›è¡Œäº†ä¸€ä¸ªå®éªŒï¼Œæµ‹è¯•backboneæœ€åä¸€ä¸ªSEå±‚çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/se/642.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºè¿™ä¸¤ä¸ªç±»æ¿€æ´»å‡ºæ¥çš„å†…å®¹æœ‰ä¸€å®šçš„å·®è·ï¼Œèµ·åˆ°äº†ä¸€å®šçš„ä½œç”¨ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>Attentionæœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ECCV 2018 Convolutional Block Attention Module</title>
    <url>/2020/02/19/ECCV-2018-Convolutional-Block-Attention-Module/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›®å‰cvé¢†åŸŸå€Ÿé‰´äº†nlpé¢†åŸŸçš„attentionæœºåˆ¶ä»¥åç”Ÿäº§å‡ºäº†å¾ˆå¤šæœ‰ç”¨çš„åŸºäºattentionæœºåˆ¶çš„è®ºæ–‡ï¼Œattentionæœºåˆ¶ä¹Ÿæ˜¯åœ¨2019å¹´è®ºæ–‡ä¸­éå¸¸ç«ã€‚è¿™ç¯‡cbamè™½ç„¶æ˜¯åœ¨2018å¹´æå‡ºçš„ï¼Œä½†æ˜¯å…¶å½±å“åŠ›æ¯”è¾ƒæ·±è¿œï¼Œåœ¨å¾ˆå¤šé¢†åŸŸéƒ½ç”¨åˆ°äº†è¯¥æ¨¡å—ï¼Œæ‰€ä»¥ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¨¡å—æœ‰ä»€ä¹ˆç‹¬åˆ°ä¹‹å¤„ï¼Œå¹¶å­¦ç€å®ç°å®ƒã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ</h2><p>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ç§æ•°æ®å¤„ç†æ–¹æ³•ï¼Œå¹¿æ³›åº”ç”¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ã€å›¾åƒè¯†åˆ«åŠè¯­éŸ³è¯†åˆ«ç­‰å„ç§ä¸åŒç±»å‹çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ã€‚</p>
<p>é€šä¿—æ¥è®²ï¼šæ³¨æ„åŠ›æœºåˆ¶å°±æ˜¯å¸Œæœ›ç½‘ç»œèƒ½å¤Ÿè‡ªåŠ¨å­¦å‡ºæ¥å›¾ç‰‡æˆ–è€…æ–‡å­—åºåˆ—ä¸­çš„éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚æ¯”å¦‚äººçœ¼åœ¨çœ‹ä¸€å¹…ç”»çš„æ—¶å€™ï¼Œä¸ä¼šå°†æ³¨æ„åŠ›å¹³ç­‰åœ°åˆ†é…ç»™ç”»ä¸­çš„æ‰€æœ‰åƒç´ ï¼Œè€Œæ˜¯å°†æ›´å¤šæ³¨æ„åŠ›åˆ†é…ç»™äººä»¬å…³æ³¨çš„åœ°æ–¹ã€‚</p>
<p>ä»å®ç°çš„è§’åº¦æ¥è®²ï¼šæ³¨æ„åŠ›æœºåˆ¶é€šè¿‡ç¥ç»ç½‘ç»œçš„æ“ä½œç”Ÿæˆä¸€ä¸ªæ©ç mask,ï¼Œmaskä¸Šçš„å€¼ä¸€ä¸ªæ‰“åˆ†ï¼Œè¯„ä»·å½“å‰éœ€è¦å…³æ³¨çš„ç‚¹çš„è¯„åˆ†ã€‚</p>
<p>æ³¨æ„åŠ›æœºåˆ¶å¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li>é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼šå¯¹é€šé“ç”Ÿæˆæ©ç maskï¼Œè¿›è¡Œæ‰“åˆ†ï¼Œä»£è¡¨æ˜¯SENet, Channel Attention Module</li>
<li>ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼šå¯¹ç©ºé—´è¿›è¡Œæ©ç çš„ç”Ÿæˆï¼Œè¿›è¡Œæ‰“åˆ†ï¼Œä»£è¡¨æ˜¯Spatial Attention Module</li>
<li>æ··åˆåŸŸæ³¨æ„åŠ›æœºåˆ¶ï¼šåŒæ—¶å¯¹é€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›è¿›è¡Œè¯„ä»·æ‰“åˆ†ï¼Œä»£è¡¨çš„æœ‰BAM, CBAM</li>
</ul>
<h2 id="æ€ä¹ˆå®ç°CBAMï¼Ÿ-pytorchä¸ºä¾‹"><a href="#æ€ä¹ˆå®ç°CBAMï¼Ÿ-pytorchä¸ºä¾‹" class="headerlink" title="æ€ä¹ˆå®ç°CBAMï¼Ÿ(pytorchä¸ºä¾‹)"></a><strong>æ€ä¹ˆå®ç°CBAMï¼Ÿ(pytorchä¸ºä¾‹)</strong></h2><p>CBAMå…¨ç§°æ˜¯Convolutional Block Attention Module, æ˜¯åœ¨ECCV2018ä¸Šå‘è¡¨çš„æ³¨æ„åŠ›æœºåˆ¶ä»£è¡¨ä½œä¹‹ä¸€ï¼Œ<a href="http://openaccess.thecvf.com/content_ECCV_2018/papers/Sanghyun_Woo_Convolutional_Block_Attention_ECCV_2018_paper.pdf">è®ºæ–‡ä¸‹è½½åœ°å€</a>ã€‚</p>
<p>åœ¨è¯¥è®ºæ–‡ä¸­ï¼Œä½œè€…ç ”ç©¶äº†ç½‘ç»œæ¶æ„ä¸­çš„æ³¨æ„åŠ›ï¼Œæ³¨æ„åŠ›ä¸ä»…è¦å‘Šè¯‰æˆ‘ä»¬é‡ç‚¹å…³æ³¨å“ªé‡Œï¼Œè¿˜è¦æé«˜å…³æ³¨ç‚¹çš„è¡¨ç¤ºã€‚ç›®æ ‡æ˜¯é€šè¿‡ä½¿ç”¨æ³¨æ„æœºåˆ¶æ¥å¢åŠ è¡¨ç°åŠ›ï¼Œå…³æ³¨é‡è¦ç‰¹å¾å¹¶æŠ‘åˆ¶ä¸å¿…è¦çš„ç‰¹å¾ã€‚ä¸ºäº†å¼ºè°ƒç©ºé—´å’Œé€šé“è¿™ä¸¤ä¸ªç»´åº¦ä¸Šçš„æœ‰æ„ä¹‰ç‰¹å¾ï¼Œä½œè€…ä¾æ¬¡åº”ç”¨<strong>é€šé“å’Œç©ºé—´æ³¨æ„æ¨¡å—</strong>ï¼Œæ¥åˆ†åˆ«åœ¨é€šé“å’Œç©ºé—´ç»´åº¦ä¸Šå­¦ä¹ å…³æ³¨ä»€ä¹ˆã€åœ¨å“ªé‡Œå…³æ³¨ã€‚æ­¤å¤–ï¼Œé€šè¿‡äº†è§£è¦å¼ºè°ƒæˆ–æŠ‘åˆ¶çš„ä¿¡æ¯ä¹Ÿæœ‰åŠ©äºç½‘ç»œå†…çš„ä¿¡æ¯æµåŠ¨ã€‚</p>
<p>ä¸»è¦ç½‘ç»œæ¶æ„ä¹Ÿå¾ˆç®€å•ï¼Œä¸€ä¸ªæ˜¯é€šé“æ³¨æ„åŠ›æ¨¡å—ï¼Œå¦ä¸€ä¸ªæ˜¯ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼ŒCBAMå°±æ˜¯å…ˆåé›†æˆäº†é€šé“æ³¨æ„åŠ›æ¨¡å—å’Œç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚</p>
<h3 id="2-1-é€šé“æ³¨æ„åŠ›æœºåˆ¶"><a href="#2-1-é€šé“æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.1 é€šé“æ³¨æ„åŠ›æœºåˆ¶"></a>2.1 é€šé“æ³¨æ„åŠ›æœºåˆ¶</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/640.webp" alt></p>
<p>é€šé“æ³¨æ„åŠ›æœºåˆ¶æŒ‰ç…§ä¸Šå›¾è¿›è¡Œå®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChannelAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_planes, rotio=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.AdaptiveMaxPool2d(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.sharedMLP = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_planes, in_planes // ratio, <span class="number">1</span>, bias=<span class="literal">False</span>), nn.ReLU(),</span><br><span class="line">            nn.Conv2d(in_planes // rotio, in_planes, <span class="number">1</span>, bias=<span class="literal">False</span>))</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avgout = self.sharedMLP(self.avg_pool(x))</span><br><span class="line">        maxout = self.sharedMLP(self.max_pool(x))</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(avgout + maxout)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶"><a href="#2-2-ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.2 ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶"></a>2.2 ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/641.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpatialAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, kernel_size=<span class="number">7</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SpatialAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> kernel_size <span class="keyword">in</span> (<span class="number">3</span>,<span class="number">7</span>), <span class="string">&quot;kernel size must be 3 or 7&quot;</span></span><br><span class="line">        padding = <span class="number">3</span> <span class="keyword">if</span> kernel_size == <span class="number">7</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.conv = nn.Conv2d(<span class="number">2</span>,<span class="number">1</span>,kernel_size, padding=padding, bias=<span class="literal">False</span>)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avgout = torch.mean(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        maxout, _ = torch.<span class="built_in">max</span>(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        x = torch.cat([avgout, maxout], dim=<span class="number">1</span>)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(x)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-Convolutional-bottleneck-attention-module"><a href="#2-3-Convolutional-bottleneck-attention-module" class="headerlink" title="2.3 Convolutional bottleneck attention module"></a>2.3 Convolutional bottleneck attention module</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/642.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    expansion = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inplanes, planes, stride=<span class="number">1</span>, downsample=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock, self).__init__()</span><br><span class="line">        self.conv1 = conv3x3(inplanes, planes, stride)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(planes)</span><br><span class="line">        self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        self.conv2 = conv3x3(planes, planes)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(planes)</span><br><span class="line">        self.ca = ChannelAttention(planes)</span><br><span class="line">        self.sa = SpatialAttention()</span><br><span class="line">        self.downsample = downsample</span><br><span class="line">        self.stride = stride</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        residual = x</span><br><span class="line">        out = self.conv1(x)</span><br><span class="line">        out = self.bn1(out)</span><br><span class="line">        out = self.relu(out)</span><br><span class="line">        out = self.conv2(out)</span><br><span class="line">        out = self.bn2(out)</span><br><span class="line">        out = self.ca(out) * out  <span class="comment"># å¹¿æ’­æœºåˆ¶</span></span><br><span class="line">        out = self.sa(out) * out  <span class="comment"># å¹¿æ’­æœºåˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> self.downsample <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            residual = self.downsample(x)</span><br><span class="line">        out += residual</span><br><span class="line">        out = self.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<p>ä¸ºä½•è¦å…ˆä½¿ç”¨é€šé“æ³¨æ„åŠ›æœºåˆ¶ç„¶åå†ä½¿ç”¨ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿä½¿ç”¨é¡ºåºä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å—è¿˜æ˜¯å¹¶è¡Œçš„ä½¿ç”¨ä¸¤ä¸ªæ¨¡å—ï¼Ÿå…¶å®æ˜¯ä½œè€…å·²ç»åšè¿‡äº†ç›¸å…³å®éªŒï¼Œå¹¶ä¸”è¯æ˜äº†å…ˆè¯•ç”¨é€šé“ç„¶åå†ä½¿ç”¨ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶è¿™æ ·çš„ç»„åˆæ•ˆæœæ¯”è¾ƒå¥½ï¼Œè¿™ä¹Ÿæ˜¯CBAMçš„é€šç”¨ç»„åˆæ¨¡å¼ã€‚</p>
<h2 id="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ"><a href="#åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ" class="headerlink" title="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ"></a>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼Ÿ</h2><p>æå‡ºCBAMçš„ä½œè€…ä¸»è¦å¯¹åˆ†ç±»ç½‘ç»œå’Œç›®æ ‡æ£€æµ‹ç½‘ç»œè¿›è¡Œäº†å®éªŒ,è¯æ˜äº†CBAMæ¨¡å—ç¡®å®æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>ä»¥ResNetä¸ºä¾‹ï¼Œè®ºæ–‡ä¸­æä¾›äº†æ”¹é€ çš„ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/643.webp" alt></p>
<p>ä¹Ÿå°±æ˜¯åœ¨ResNetä¸­çš„æ¯ä¸ªblockä¹‹é—´æ·»åŠ äº†CBAMæ¨¡å—ï¼Œè®­ç»ƒæ•°æ®æ¥è‡ªbenchmark ImageNet-1Kã€‚æ£€æµ‹ä½¿ç”¨çš„æ˜¯Faster  R-CNNï¼Œ Backboneé€‰æ‹©çš„ResNet34ï¼ŒResNet50ï¼ŒWideResNet18ï¼ŒResNet50ç­‰ï¼Œè¿˜è·ŸSEç­‰è¿›è¡Œäº†å¯¹æ¯”ã€‚</p>
<p><strong>æ¶ˆèå®éªŒ</strong>ï¼šæ¶ˆèå®éªŒä¸€èˆ¬æ˜¯æ§åˆ¶å˜é‡ï¼Œæœ€èƒ½çœ‹å‡ºæ¨¡å‹å˜å¥½èµ·ä½œç”¨çš„éƒ¨åˆ†åœ¨é‚£é‡Œã€‚åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>å¦‚ä½•æ›´æœ‰æ•ˆåœ°è®¡ç®—channel attention?</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/644.webp" alt>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä½¿ç”¨avgpoolå’Œmaxpoolå¯ä»¥æ›´å¥½çš„é™ä½é”™è¯¯ç‡ï¼Œå¤§æ¦‚æœ‰1-2%çš„æå‡ï¼Œè¿™ä¸ªç»„åˆå°±æ˜¯dual poolingï¼Œèƒ½æä¾›æ›´åŠ ç²¾ç»†çš„ä¿¡æ¯ï¼Œæœ‰åˆ©äºæå‡æ¨¡å‹çš„è¡¨ç°ã€‚</p>
</li>
<li><p>å¦‚ä½•æ›´æœ‰æ•ˆåœ°è®¡ç®—spatial attention?</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/645.webp" alt></p>
<p>è¿™é‡Œçš„ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶å‚æ•°ä¹Ÿæ˜¯æœ‰avgï¼Œmaxç»„æˆï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªå·ç§¯çš„å‚æ•°kernel_size(k)ï¼Œé€šè¿‡ä»¥ä¸Šå®éªŒï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“å‰ä½¿ç”¨é€šé“çš„å¹³å‡å’Œé€šé“çš„æœ€å¤§åŒ–ï¼Œå¹¶ä¸”è®¾ç½®kernel size=7æ˜¯æœ€å¥½çš„ã€‚</p>
</li>
<li><p>å¦‚ä½•ç»„ç»‡è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Ÿ</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/646.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œä¸SENetä¸­çš„SEæ¨¡å—ä¹Ÿè¿›è¡Œäº†æ¯”è¾ƒï¼Œè¿™é‡Œä½¿ç”¨CBAMä¹Ÿæ˜¯è¶…å‡ºäº†SEçš„è¡¨ç°ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜è¿›è¡Œäº†é¡ºåºå’Œå¹¶è¡Œçš„æµ‹è¯•ï¼Œå‘ç°ï¼Œå…ˆchannel attentionç„¶åspatial attentionæ•ˆæœæœ€å¥½ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æœ€ç»ˆçš„CBAMæ¨¡å—çš„ç»„æˆã€‚</p>
<p>åœ¨MSCOCOæ•°æ®åŠä½¿ç”¨äº†ResNet50ï¼ŒResNet101ä¸ºbackboneï¼ŒFaster RCNNä¸ºæ£€æµ‹å™¨çš„æ¨¡å‹è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/647.webp" alt></p>
<p>åœ¨VOC2007æ•°æ®é›†ä¸­é‡‡ç”¨äº†StairNetè¿›è¡Œäº†æµ‹è¯•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/CBAM/648.webp" alt></p>
<p>è²Œä¼¼æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡æ£€æµ‹éƒ¨åˆ†çš„ä»£ç ï¼ŒCBAMçš„ä½œç”¨åœ¨äºå¯¹ä¿¡æ¯è¿›è¡Œç²¾ç»†åŒ–åˆ†é…å’Œå¤„ç†ï¼Œæ‰€ä»¥çŒœæµ‹æ˜¯åœ¨backboneçš„åˆ†ç±»å™¨ä¹‹å‰æ·»åŠ çš„CBAMæ¨¡å—ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>Attentionæœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ECCV 2018 RFBNetï¼Œåœ¨æ£€æµ‹ä¸­è°ƒæ„Ÿå—é‡</title>
    <url>/2020/03/07/ECCV-2018-RFBNet%EF%BC%8C%E5%9C%A8%E6%A3%80%E6%B5%8B%E4%B8%AD%E8%B0%83%E6%84%9F%E5%8F%97%E9%87%8E/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çœ‹äº†ä¸å°‘çš„ç›®æ ‡æ£€æµ‹è®ºæ–‡äº†ï¼Œä¸ªäººè®¤ä¸ºå¤šæ•°è®ºæ–‡çš„å‡ºå‘ç‚¹å°±ä¸¤ä¸ªï¼Œä¸€æ˜¯æ„Ÿå—é‡ï¼ŒäºŒæ˜¯ç‰¹å¾èåˆã€‚æ­¤å¤–ï¼Œè§£å†³æ•°æ®ä¸å¹³è¡¡å’Œè½»é‡åŒ–ä¹Ÿæ˜¯å¦å¤–ä¸¤ä¸ªé‡è¦çš„æ–¹å‘ã€‚ä»Šå¤©ä¸ºå¤§å®¶ç§‘æ™®ä¸€ç¯‡ECCV 2018çš„ä¸€ç¯‡ç›®æ ‡æ£€æµ‹ç½‘ç»œRFBNetå°±æ˜¯ä»æ„Ÿå—é‡è§’åº¦æ¥æ”¹å–„äº†SSDæ£€æµ‹å™¨ï¼Œè®ºæ–‡å…¨åä¸ºï¼š<strong>Receptive Field Block Net for Accurate and Fast Object Detection</strong>  ã€‚è¿™ç¯‡è®ºæ–‡ä¸»è¦çš„è´¡çŒ®ç‚¹ä¸»è¦æ˜¯åœ¨SSDç½‘ç»œä¸­æå‡ºäº†ä¸€ä¸ª<strong>Receptive Field Block (RFB)</strong> æ¨¡å—ï¼ŒRFBæ¨¡å—ä¸»è¦æ˜¯åœ¨Inceptionçš„åŸºç¡€ä¸ŠåŠ å…¥äº†ç©ºæ´å·ç§¯å±‚ä»è€Œæœ‰æ•ˆçš„å¢å¤§äº†æ„Ÿå—é‡ã€‚å¦å¤–ï¼ŒRFBæ¨¡å—æ˜¯åµŒåœ¨SSDä¸Šçš„ï¼Œæ‰€ä»¥æ£€æµ‹çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œç²¾åº¦æ¯”SSDæ›´é«˜ã€‚</p>
<h2 id="RFBæ¨¡å—"><a href="#RFBæ¨¡å—" class="headerlink" title="RFBæ¨¡å—"></a>RFBæ¨¡å—</h2><p>RFBæ¨¡å—çš„æ•ˆæœç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºï¼Œå…¶ä¸­è™šçº¿éƒ¨åˆ†å°±æ˜¯æŒ‡RFBæ¨¡å—ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/640.jpg" alt></p>
<p>RFBæ¨¡å—ä¸»è¦æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>RFBæ¨¡å—æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯çš„ç¬¬ä¸€å±‚éƒ½ç”±ç‰¹å®šå¤§å°å·ç§¯æ ¸çš„å·ç§¯æ ¸æ„æˆï¼Œä¾‹å¦‚å›¾ä¸Šçš„1 x 1ï¼Œ 3 x 3ï¼Œ5 x 5ã€‚</p>
</li>
<li><p>RFBæ¨¡å—å¼•å…¥äº†ç©ºæ´å·ç§¯ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†å¢åŠ æ„Ÿå—é‡ï¼Œç©ºæ´å·ç§¯ä¹‹å‰æ˜¯åº”ç”¨åœ¨åˆ†å‰²ç½‘ç»œDeepLabä¸­ï¼Œè¿™é‡Œå°†å…¶åº”ç”¨åœ¨æ£€æµ‹ä»»åŠ¡ä¸­ï¼Œä»¥è·å¾—æ›´å¤§çš„æ„Ÿå—é‡ï¼Œå¯ä»¥æ›´å¥½çš„ç¼–ç ç©ºé—´é•¿è·ç¦»è¯­ä¹‰ã€‚</p>
</li>
</ul>
<p>åœ¨RFBæ¨¡å—ä¸­ï¼Œæœ€åå°†ä¸åŒå°ºå¯¸å’Œæ„Ÿå—é‡çš„è¾“å‡ºç‰¹å¾å›¾è¿›è¡ŒConcatæ“ä½œï¼Œä»¥è¾¾åˆ°èåˆä¸åŒç‰¹å¾çš„ç›®çš„ã€‚åœ¨å›¾ä¸­ï¼ŒRFBæ¨¡å—ä¸­ä½¿ç”¨ä¸‰ç§ä¸åŒå¤§å°å’Œé¢œè‰²çš„è¾“å‡ºå åŠ æ¥å±•ç¤ºã€‚åœ¨å›¾çš„æœ€åä¸€åˆ—ä¸­å°†èåˆåçš„ç‰¹å¾ä¸äººç±»è§†è§‰æ„Ÿå—é‡åšå¯¹æ¯”ï¼Œä»å›¾ä¸­çœ‹å‡ºæ˜¯éå¸¸æ¥è¿‘çš„ï¼Œè¿™ä¹Ÿæ˜¯è¿™ç¯‡è®ºæ–‡çš„å‡ºå‘ç‚¹ã€‚</p>
<h2 id="ä¸¤ç§RFBç»“æ„ç¤ºæ„å›¾"><a href="#ä¸¤ç§RFBç»“æ„ç¤ºæ„å›¾" class="headerlink" title="ä¸¤ç§RFBç»“æ„ç¤ºæ„å›¾"></a>ä¸¤ç§RFBç»“æ„ç¤ºæ„å›¾</h2><p>ä¸‹é¢çš„Figure4å±•ç¤ºäº†RFBNetçš„ä¸¤ç§ç»“æ„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/641.jpg" alt></p>
<ul>
<li><p>Figure4(a)è¡¨ç¤ºRFBç»“æ„ï¼Œæ•´ä½“ä¸Šå€Ÿé‰´äº†Inceptionçš„æ€æƒ³ã€‚ä¸»è¦ä¸åŒç‚¹åœ¨äºå¼•å…¥3ä¸ªç©ºæ´å·ç§¯å±‚ã€‚</p>
</li>
<li><p>Figure4(b)è¡¨ç¤ºRFB-sç»“æ„ã€‚RFB-så’ŒRFBç›¸æ¯”ä¸»è¦æœ‰ä¸¤ä¸ªæ”¹è¿›ï¼Œä¸€æ–¹é¢ç”¨3 x 3å·ç§¯å±‚ä»£æ›¿5 x 5å·ç§¯å±‚ï¼Œå¦ä¸€æ–¹é¢ç”¨1 x 3å’Œ3 x 1å·ç§¯å±‚ä»£æ›¿3 x 3å·ç§¯å±‚ï¼Œä¸»è¦ç›®çš„åº”è¯¥æ˜¯ä¸ºäº†å‡å°‘è®¡ç®—é‡ï¼Œç±»ä¼¼Inceptionåé¢çš„ç‰ˆæœ¬å¯¹Inceptionç»“æ„çš„æ”¹è¿›ã€‚</p>
</li>
</ul>
<h2 id="RFBNet-300çš„ç»“æ„"><a href="#RFBNet-300çš„ç»“æ„" class="headerlink" title="RFBNet-300çš„ç»“æ„"></a>RFBNet-300çš„ç»“æ„</h2><p>ä¸‹é¢çš„Figure5ä»£è¡¨RFBNet-300çš„æ•´ä½“ç»“æ„å›¾ï¼ŒåŸºæœ¬æ˜¯ç…§æ¬äº†SSDï¼Œä¸»è¦æœ‰2ç‚¹ä¸åŒï¼š</p>
<ul>
<li>BackBoneéƒ¨åˆ†ç”¨ä¸¤ä¸ªRFBç»“æ„æ›¿æ¢åŸæ¥æ–°å¢çš„ä¸¤å±‚ã€‚</li>
<li><code>conv4_3</code>å’Œ<code>conv7_fc</code>åœ¨æ¥é¢„æµ‹å±‚ä¹‹å‰åˆ†åˆ«æ¥RFB-så’ŒRFBç»“æ„ã€‚</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/642.jpg" alt></p>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>ä¸‹é¢çš„Table1å±•ç¤ºäº†RFBNet-300åœ¨PASCAL VOC2007 test devä¸Šçš„æµ‹è¯•ç»“æœï¼Œè®­ç»ƒé›†åŸºäº2007å’Œ2012çš„trainvalã€‚RFBNet-300åœ¨mAPå’ŒFPSä¸¤æ–¹é¢æ•ˆæœéƒ½ä¸é”™ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/643.jpg" alt></p>
<p>è€Œä¸‹é¢çš„Table4æ˜¯åœ¨COCO test dev 2015æ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœã€‚æœ€åçš„RFBNet-512Eåšäº†ä¸¤ä¸ªæ”¹å˜ï¼š</p>
<ul>
<li>å¯¹<code>conv7_fc</code>çš„è¾“å‡ºç‰¹å¾åšäº†<code>up-sample</code>ï¼Œç„¶åå’Œ<code>conv4_3</code>çš„è¾“å‡ºç‰¹å¾åšèåˆï¼ŒåŸºäºèåˆåçš„ç‰¹å¾åšé¢„æµ‹ã€‚è¿™ç§åšæ³•å®é™…ä¸Šæ˜¯å€Ÿé‰´äº†FPNç®—æ³•çš„æ€æƒ³ã€‚</li>
<li>RFBç»“æ„ä¸­å¢åŠ äº†<code>7x7</code>å¤§å°çš„å·ç§¯åˆ†æ”¯ã€‚è¿™ä¸¤ç‚¹æ”¹è¿›å¯¹æ•ˆæœçš„æå‡æœ‰ä¸€å®šå¸®åŠ©ï¼Œè€Œä¸”å¸¦æ¥çš„è®¡ç®—é‡ä¹Ÿå°‘ã€‚</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/644.jpg" alt></p>
<p>ä¸‹é¢çš„Figure6å±•ç¤ºäº†å’ŒRFBNetåŒæ—¶æœŸçš„ä¸€äº›ç›®æ ‡æ£€æµ‹ç®—æ³•åœ¨COCO test-devæ•°æ®é›†ä¸Šå…³äºæ•ˆæœå’Œé€Ÿåº¦çš„ç›´è§‚å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°RFBNetçš„é€Ÿåº¦å’Œç²¾åº¦å¹³è¡¡è¿˜æ˜¯ä¸é”™çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RFBNet/645.jpg" alt></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>RFBNetè¯´ç™½äº†å°±æ˜¯ç©ºæ´å·ç§¯çš„åº”ç”¨ï¼Œè™½ç„¶çœ‹èµ·æ¥è®ºæ–‡æ¯”è¾ƒæ°´ï¼Œä½†è‡³å°‘ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé‡è¦ä¿¡æ¯ï¼Œåœ¨æ£€æµ‹ä¸­è°ƒæ„Ÿå—é‡æ˜¯è¡Œä¹‹æœ‰æ•ˆçš„ã€‚</p>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><ul>
<li>è®ºæ–‡åŸæ–‡ï¼š<a href="https://arxiv.org/pdf/1711.07767.pdf">https://arxiv.org/pdf/1711.07767.pdf</a></li>
<li>ä»£ç å®ç°ï¼š<a href="https://github.com/ruinmessi/RFBNet">https://github.com/ruinmessi/RFBNet</a></li>
<li>å‚è€ƒï¼š<a href="https://blog.csdn.net/u014380165/article/details/81556769">https://blog.csdn.net/u014380165/article/details/81556769</a></li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>RetinaNetï¼ˆå¼•å…¥Focal Lossï¼‰</title>
    <url>/2020/03/06/RetinaNet%EF%BC%88%E5%BC%95%E5%85%A5Focal-Loss%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©æ¥ä»‹ç»ä¸€ä¸‹ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­RetinaNetï¼Œè¿™ç¯‡è®ºæ–‡æ˜¯CVPR2018çš„ä½œå“ï¼ŒKaiming Heå¤§ç¥ä¹Ÿæ˜¯ä½œè€…ä¹‹ä¸€ï¼ŒåŒæ—¶è¿™ç¯‡è®ºæ–‡æå‡ºçš„Focal  Lossä¹Ÿå¯¹å·¥ç¨‹ä¸Šè®­ç»ƒæ›´å¥½çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹åšå‡ºäº†å¾ˆå¤§è´¡çŒ®ï¼Œè®ºæ–‡åœ°å€ä¸ºï¼š<a href="https://arxiv.org/pdf/1708.02002.pdf">https://arxiv.org/pdf/1708.02002.pdf</a></p>
<h2 id="ç ”ç©¶èƒŒæ™¯"><a href="#ç ”ç©¶èƒŒæ™¯" class="headerlink" title="ç ”ç©¶èƒŒæ™¯"></a>ç ”ç©¶èƒŒæ™¯</h2><p>å‰é¢ä»‹ç»äº†ä¸€äº›One-Stageç›®æ ‡æ£€æµ‹ç®—æ³•å’ŒTwo-Stageç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œè¿™äº›ç®—æ³•åœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸Šéƒ½å„æœ‰ç‰¹ç‚¹ï¼Œç°åœ¨ç”»ä¸ªå›¾æ€»ç»“ä¸€ä¸‹ä¹‹å‰ä»‹ç»çš„å„ç§ç®—æ³•çš„é€Ÿåº¦å’Œç²¾åº¦ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/640.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°One-Stageç®—æ³•çš„ç²¾åº¦ç›¸å¯¹äºTwo_Stageåä½ï¼Œç„¶åä½œè€…æŠŠè¿™ç§é—®é¢˜çš„åŸå› å½’ç»“äº<strong>æ­£è´Ÿç±»åˆ«ä¸å¹³è¡¡</strong>ï¼ˆç®€å•éš¾åˆ†ç±»åˆ«ä¸å¹³è¡¡ï¼‰ã€‚å› æ­¤è®ºæ–‡é€šè¿‡é‡æ–°è®¾è®¡æ ‡å‡†çš„äº¤å‰ç†µæŸå¤±æ¥è§£å†³è¿™ç§éš¾æ˜“æ ·æœ¬ä¸å¹³è¡¡çš„é—®é¢˜ï¼Œå³æ–‡ç« çš„æ ¸å¿ƒFocal Lossã€‚ç»“åˆäº†Focal  Lossçš„One-Stageçš„ç›®æ ‡æ£€æµ‹å™¨è¢«ç§°ä¸ºRetinaNetï¼Œè¯¥æ£€æµ‹å™¨åœ¨COCOæ•°æ®é›†ä¸ŠMAPå€¼å¯ä»¥å’ŒFPNï¼ˆç‰¹å¾é‡‘å­—å¡”ç›®æ ‡æ£€æµ‹å™¨ï¼‰å’ŒMaskRCNNæ¥è¿‘ã€‚</p>
<h2 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯hard-esay-postive-negtive-example"><a href="#ä»€ä¹ˆæ˜¯hard-esay-postive-negtive-example" class="headerlink" title="ä»€ä¹ˆæ˜¯hard/esay postive/negtive example"></a>ä»€ä¹ˆæ˜¯hard/esay postive/negtive example</h3><p>ç½‘ä¸Šæ‰¾åˆ°ä¸€å¼ å›¾è§£é‡Šåœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡çš„ä¸€å¼ å›¾ä¸­ä»€ä¹ˆæ˜¯hard/easy postive/negtive exampleã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/641.webp" alt></p>
<p>å€™é€‰æ¡†å¯ä»¥åˆ†æˆpostive/negtiveä¸¤ç±»ã€‚å½“bbox(ç”±anchoråŠ ä¸Šåç§»é‡å¾—åˆ°)ä¸ground  truthé—´çš„IOUå¤§äºæˆ‘ä»¬è®¾ç½®çš„é˜ˆå€¼ï¼ˆä¸€èˆ¬å–0.5ï¼‰æ—¶ï¼Œä¼šè®¤ä¸ºè¯¥bboxå±äºpositive  exampleï¼Œå¦‚æœIOUå°äºä¸‹é—¨é™å°±è®¤ä¸ºè¯¥bboxå±äºnegative exampleã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆOne-Stageæ£€æµ‹ç®—æ³•ç²¾åº¦åä½"><a href="#ä¸ºä»€ä¹ˆOne-Stageæ£€æµ‹ç®—æ³•ç²¾åº¦åä½" class="headerlink" title="ä¸ºä»€ä¹ˆOne-Stageæ£€æµ‹ç®—æ³•ç²¾åº¦åä½"></a>ä¸ºä»€ä¹ˆOne-Stageæ£€æµ‹ç®—æ³•ç²¾åº¦åä½</h3><p>è®ºæ–‡è®¤ä¸ºOne-Stageç®—æ³•å‡†ç¡®åº¦ä½æ˜¯ç”±äºç±»åˆ«å¤±è¡¡å¼•èµ·çš„ã€‚å› ä¸ºåœ¨ä¸€å¼ æ™®é€šå›¾ç‰‡ä¸­ï¼Œç›®æ ‡çš„æ‰€å çš„æ¯”ä¾‹è¿œè¿œå°äºèƒŒæ™¯æ‰€å çš„æ¯”ä¾‹ï¼Œæ‰€ä»¥ä¸¤ç±»å€™é€‰æ¡†ä¾‹å­ä¸­ä»¥negtive exampleä¸ºä¸»ã€‚è¿™å°±å¯¼è‡´äº†ï¼š</p>
<ul>
<li>(1)é’ˆå¯¹æ‰€æœ‰çš„negtive exampleï¼Œæ•°é‡è¿‡å¤šé€ æˆå®ƒçš„losså¤ªå¤§ï¼Œä»¥è‡³äºä¸»å¯¼äº†æŸå¤±å‡½æ•°ï¼Œä¸åˆ©äºæ”¶æ•›ã€‚</li>
<li>(2)é’ˆå¯¹å•ä¸ªnegtive exampleæ¥è¯´ï¼Œå¤§å¤šæ•°çš„negative exampleä¸åœ¨å‰æ™¯å’ŒèƒŒæ™¯çš„è¿‡æ¸¡åŒºåŸŸä¸Šï¼Œåˆ†ç±»å¾ˆæ˜ç¡®(è¿™ç§æ˜“åˆ†ç±»çš„negativeç§°ä¸ºeasy  negative)ï¼Œè®­ç»ƒæ—¶å¯¹åº”çš„èƒŒæ™¯ç±»scoreä¼šå¾ˆå¤§ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å•ä¸ªexampleçš„losså¾ˆå°ï¼Œåå‘è®¡ç®—æ—¶æ¢¯åº¦å°ã€‚æ¢¯åº¦å°é€ æˆeasy  negative exampleå¯¹å‚æ•°çš„æ”¶æ•›ä½œç”¨å¾ˆæœ‰é™ï¼Œæˆ‘ä»¬æ›´éœ€è¦losså¤§çš„å¯¹å‚æ•°æ”¶æ•›å½±å“ä¹Ÿæ›´å¤§çš„exampleï¼Œå³hard  positive/negative exampleã€‚</li>
</ul>
<p>å› æ­¤å¦‚æœOne-Stageç®—æ³•å¦‚æœæ— è„‘çš„å°†æ‰€æœ‰bboxæ‹¿å»åšåˆ†ç±»æŸå¤±ï¼Œå› ä¸ºbboxä¸­å±äºbackgroundçš„bboxå¤ªå¤šäº†ï¼Œæ‰€ä»¥å¦‚æœåˆ†ç±»å™¨æ— è„‘åœ°æŠŠæ‰€æœ‰bboxç»Ÿä¸€å½’ç±»ä¸ºbackgroundï¼Œaccuracyä¹Ÿå¯ä»¥åˆ·å¾—å¾ˆé«˜ã€‚è¿™å°±å¯¼è‡´åˆ†ç±»å™¨è®­ç»ƒå¤±è´¥äº†ï¼Œè‡ªç„¶æ£€æµ‹ç²¾åº¦å°±åä½äº†ã€‚å¯¹äºYOLOå’ŒSSDæ¥è®²ï¼Œä»–ä»¬ä¹Ÿç¡®å®æ²¡æœ‰æ— è„‘å°†æ‰€æœ‰çš„bboxæ‹¿å»åšåˆ†ç±»æŸå¤±ï¼Œå¦‚åœ¨SSDä¸­åˆ©ç”¨Hard-Negtive-Miningçš„æ–¹å¼å°†æ­£è´Ÿæ ·æœ¬çš„æ¯”ä¾‹æ§åˆ¶åœ¨1:3ï¼ŒYOLOé€šè¿‡æŸå¤±å‡½æ•°ä¸­æƒé‡æƒ©ç½šçš„æ–¹å¼å¢å¤§æ­£æ ·æœ¬å¯¹æŸå¤±å‡½æ•°çš„å½±å“ç­‰ã€‚ä½†å®ƒä»¬è™½ç„¶å¯ä»¥å¤„ç†ç¬¬1ä¸ªé—®é¢˜ï¼Œä½†å¯¹äºç¬¬2ä¸ªé—®é¢˜å°±æ— èƒ½ä¸ºäº†ï¼Œè¿™ä¹Ÿæ˜¯Focal Losså‡ºç°çš„åŸå› ã€‚</p>
<h3 id="Faster-RCNNä¸ºä»€ä¹ˆç²¾åº¦æ›´é«˜"><a href="#Faster-RCNNä¸ºä»€ä¹ˆç²¾åº¦æ›´é«˜" class="headerlink" title="Faster-RCNNä¸ºä»€ä¹ˆç²¾åº¦æ›´é«˜"></a>Faster-RCNNä¸ºä»€ä¹ˆç²¾åº¦æ›´é«˜</h3><p>Faster-RCNNåœ¨FPNé˜¶æ®µä¼šæ ¹æ®å‰æ™¯åˆ†æ•°æå‡ºæœ€å¯èƒ½æ˜¯å‰æ™¯çš„exampleï¼Œè¿™å°±ä¼šæ»¤é™¤å¤§é‡èƒŒæ™¯æ¦‚ç‡é«˜çš„easy  negtiveæ ·æœ¬ï¼Œè¿™ä¾¿è§£å†³äº†ä¸Šé¢æå‡ºçš„ç¬¬2ä¸ªé—®é¢˜ã€‚åŒæ—¶ï¼Œåœ¨ç”Ÿæˆæ ·æœ¬ç»™ROIPoolingå±‚çš„æ—¶å€™ï¼Œä¼šæ®IOUçš„å¤§å°æ¥è°ƒæ•´positiveå’Œnegative exampleçš„æ¯”ä¾‹ï¼Œæ¯”å¦‚è®¾ç½®æˆ1ï¼š3ï¼Œè¿™æ ·é˜²æ­¢äº†negativeè¿‡å¤šçš„æƒ…å†µ(åŒæ—¶é˜²æ­¢äº†easy negativeå’Œhard  negative)ï¼Œå°±è§£å†³äº†å‰é¢çš„ç¬¬1ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œç›¸å¯¹äºOne-Stageæ£€æµ‹å™¨ï¼ŒFaster-RCNNçš„ç²¾åº¦æ›´é«˜ã€‚</p>
<h2 id="Focal-Loss"><a href="#Focal-Loss" class="headerlink" title="Focal Loss"></a>Focal Loss</h2><p>è®ºæ–‡å¼•å…¥äº†Focal Lossæ¥è§£å†³<strong>éš¾æ˜“æ ·æœ¬æ•°é‡ä¸å¹³è¡¡</strong>ã€‚One-Stageçš„æ¨¡æ¿æ£€æµ‹å™¨é€šå¸¸ä¼šäº§ç”Ÿ10kæ•°é‡çº§çš„æ¡†ï¼Œä½†åªæœ‰æå°‘æ•°æ˜¯æ­£æ ·æœ¬ï¼Œæ­£è´Ÿæ ·æœ¬æ•°é‡éå¸¸ä¸å¹³è¡¡ã€‚æˆ‘ä»¬åœ¨è®¡ç®—åˆ†ç±»çš„æ—¶å€™å¸¸ç”¨çš„æŸå¤±â€”â€”äº¤å‰ç†µçš„å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/651.JPG" alt></p>
<p>ä¸ºäº†è§£å†³<strong>æ­£è´Ÿæ ·æœ¬æ•°é‡ä¸å¹³è¡¡</strong>çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨äº¤å‰ç†µæŸå¤±å‰é¢åŠ ä¸€ä¸ªå‚æ•°$\alpha$ï¼Œå³ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/643.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/652.JPG" alt></p>
<p>è™½ç„¶$\alpha$å¹³è¡¡äº†æ­£è´Ÿæ ·æœ¬çš„æ•°é‡ï¼Œä½†å®é™…ä¸Šï¼Œç›®æ ‡æ£€æµ‹ä¸­å¤§é‡çš„å€™é€‰ç›®æ ‡éƒ½æ˜¯æ˜“åˆ†æ ·æœ¬ã€‚è¿™äº›æ ·æœ¬çš„æŸå¤±å¾ˆä½ï¼Œä½†æ˜¯ç”±äºæ•°é‡æä¸å¹³è¡¡ï¼Œæ˜“åˆ†æ ·æœ¬çš„æ•°é‡ç›¸å¯¹æ¥è®²å¤ªå¤šï¼Œæœ€ç»ˆä¸»å¯¼äº†æ€»çš„æŸå¤±ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç¯‡è®ºæ–‡è®¤ä¸º<strong>æ˜“åˆ†æ ·æœ¬ï¼ˆå³ï¼Œç½®ä¿¡åº¦é«˜çš„æ ·æœ¬ï¼‰å¯¹æ¨¡å‹çš„æå‡æ•ˆæœéå¸¸å°ï¼Œæ¨¡å‹åº”è¯¥ä¸»è¦å…³æ³¨ä¸é‚£äº›éš¾åˆ†æ ·æœ¬</strong> ã€‚æ‰€ä»¥Focal Lossæ¨ªç©ºå‡ºä¸–äº†ã€‚ä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯åªè¦æˆ‘ä»¬å°†é«˜ç½®ä¿¡åº¦(p)æ ·æœ¬çš„æŸå¤±é™ä½ä¸€äº›å°±å¥½äº†å§ï¼Ÿä¹Ÿå³æ˜¯ä¸‹é¢çš„å…¬å¼ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/644.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/653.JPG" alt></p>
<p>æˆ‘ä»¬å–$\gamma$ç­‰äº2æ¥åªç®¡æ„Ÿå—ä¸€ä¸‹ï¼Œå¦‚æœ$p=0.9$ï¼Œé‚£ä¹ˆï¼Œ$(1-0.9)^{2}=0.001$ï¼ŒæŸå¤±é™ä½äº†1000å€ã€‚ä»ä¸­ï¼Œæˆ‘ä»¬æ˜“çœ‹å‡ºfocal lossæ‰€åŠ çš„æŒ‡æ•°å¼ç³»æ•°å¯å¯¹æ­£è´Ÿæ ·æœ¬å¯¹lossçš„è´¡çŒ®è‡ªåŠ¨è°ƒèŠ‚ã€‚å½“æŸæ ·æœ¬ç±»åˆ«æ¯”è¾ƒæ˜ç¡®äº›ï¼Œå®ƒå¯¹æ•´ä½“lossçš„è´¡çŒ®å°±æ¯”è¾ƒå°‘ï¼›è€Œè‹¥æŸæ ·æœ¬ç±»åˆ«ä¸æ˜“åŒºåˆ†ï¼Œåˆ™å¯¹æ•´ä½“lossçš„è´¡çŒ®å°±ç›¸å¯¹åå¤§ã€‚è¿™æ ·å¾—åˆ°çš„lossæœ€ç»ˆå°†é›†ä¸­ç²¾åŠ›å»è¯±å¯¼æ¨¡å‹å»åŠªåŠ›åˆ†è¾¨é‚£äº›éš¾åˆ†çš„ç›®æ ‡ç±»åˆ«ï¼Œäºæ˜¯å°±æœ‰æ•ˆæå‡äº†æ•´ä½“çš„ç›®æ ‡æ£€æµ‹å‡†åº¦ã€‚</p>
<p>æœ€ç»ˆFocal Lossè¿˜ç»“åˆäº†å…¬å¼(2)ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œå…¬å¼(3)è§£å†³äº†éš¾æ˜“æ ·æœ¬çš„ä¸å¹³è¡¡ï¼Œå…¬å¼(2)è§£å†³äº†æ­£è´Ÿæ ·æœ¬çš„ä¸å¹³è¡¡ï¼Œå°†å…¬å¼(2)ä¸(3)ç»“åˆä½¿ç”¨ï¼ŒåŒæ—¶è§£å†³æ­£è´Ÿéš¾æ˜“2ä¸ªé—®é¢˜ï¼æ‰€ä»¥æœ€ç»ˆFocal Lossçš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/645.png" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/654.png" alt></p>
<p>ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†Focal Losså–ä¸åŒçš„$\gamma$æ—¶çš„æŸå¤±å‡½æ•°ä¸‹é™ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/646.jpg" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/655.png" alt></p>
<p>å®éªŒç»“æœå±•ç¤ºï¼Œå½“$\gamma=2$ï¼Œ$\alpha=0.25$æ—¶ï¼Œæ•ˆæœæœ€å¥½ï¼Œè¿™æ ·æŸå¤±å‡½æ•°è®­ç»ƒçš„è¿‡ç¨‹ä¸­å…³æ³¨çš„æ ·æœ¬ä¼˜å…ˆçº§å°±æ˜¯æ­£éš¾&gt;è´Ÿéš¾&gt;æ­£æ˜“&gt;è´Ÿæ˜“äº†ã€‚</p>
<h2 id="RetinaNet"><a href="#RetinaNet" class="headerlink" title="RetinaNet"></a>RetinaNet</h2><p>è¯´å®Œäº†Focal Losså°±å›åˆ°æ–‡ç« RetinaNetï¼ŒFocal Lossä¸ResNet-101-FPN  backboneç»“åˆå°±æ„æˆäº†RetinaNetï¼ˆone-stageæ£€æµ‹å™¨ï¼‰ï¼ŒRetinaNetåœ¨COCO  test-devä¸Šè¾¾åˆ°39.1mAPï¼Œé€Ÿåº¦ä¸º5FPSã€‚ä¸‹å›¾å±•ç¤ºäº†RetinaNetçš„ç½‘ç»œç»“æ„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/647.jpg" alt></p>
<p>è®­ç»ƒRetinaNetæ—¶æœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„å…³é”®ç‚¹ï¼š</p>
<ul>
<li>è®­ç»ƒæ—¶FPNæ¯ä¸€çº§çš„æ‰€æœ‰exampleéƒ½è¢«ç”¨äºè®¡ç®—Focal Lossï¼Œlosså€¼åŠ åˆ°ä¸€èµ·ç”¨æ¥è®­ç»ƒã€‚</li>
<li>æµ‹è¯•æ—¶FPNæ¯ä¸€çº§åªé€‰å–scoreæœ€å¤§çš„1000ä¸ªexampleæ¥åšnmsã€‚</li>
<li>æ•´ä¸ªç»“æ„ä¸åŒå±‚çš„headéƒ¨åˆ†(ä¸Šå›¾ä¸­çš„cå’Œdéƒ¨åˆ†)å…±äº«å‚æ•°ï¼Œä½†åˆ†ç±»å’Œå›å½’åˆ†æ”¯é—´çš„å‚æ•°ä¸å…±äº«ã€‚</li>
<li>åˆ†ç±»åˆ†æ”¯çš„æœ€åä¸€çº§å·ç§¯çš„biasåˆå§‹åŒ–æˆ-log((1-Ï€)/Ï€)ã€‚è¿™é‡ŒÏ€è¢«æŒ‡å®šåœ¨è®­ç»ƒå¼€å§‹æ—¶ï¼Œæ‰€æœ‰çš„anchoréƒ½éœ€è¦è¢«æ ‡æ³¨ä¸ºå¸¦æœ‰Ï€ç½®ä¿¡ç‡çš„å‰æ™¯ã€‚è¿™é‡Œå–Ï€=0.01ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åœ¨è®­ç»ƒçš„ç¬¬ä¸€ä¸ªå‘¨æœŸå¤§é‡çš„èƒŒæ™¯anchorsç”Ÿæˆä¸€ä¸ªå·¨å¤§çš„ä¸ç¨³å®šçš„losså€¼ã€‚</li>
</ul>
<p>RetinaNetå’Œå½“æ—¶æµè¡Œçš„æ£€æµ‹ç®—æ³•é€Ÿåº¦å’Œç²¾åº¦å¯¹æ¯”å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä»é€Ÿåº¦å’Œç²¾åº¦éƒ½å®Œæˆäº†å¯¹å…¶ä»–ç®—æ³•çš„å‹åˆ¶ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/648.webp" alt></p>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>Table1æ˜¯å…³äºRetinaNetå’ŒFocal Lossçš„ä¸€äº›å®éªŒç»“æœã€‚å…¶ä¸­(a)æ˜¯åœ¨äº¤å‰ç†µçš„åŸºç¡€ä¸ŠåŠ ä¸Šå‚æ•°$\alpha$ï¼Œ$\alpha=0.5$å°±è¡¨ç¤ºä¼ ç»Ÿçš„äº¤å‰ç†µï¼Œå¯ä»¥çœ‹å‡ºå½“$\alpha=0.75$çš„æ—¶å€™æ•ˆæœæœ€å¥½ï¼ŒAPå€¼æå‡äº†0.9ã€‚(b)æ˜¯å¯¹æ¯”ä¸åŒçš„å‚æ•°$\gamma$å’Œ$\alpha$çš„å®éªŒç»“æœï¼Œå¯ä»¥çœ‹å‡ºéšç€$\gamma$çš„å¢åŠ ï¼ŒAPæå‡æ¯”è¾ƒæ˜æ˜¾ã€‚(c)æ˜¯anchorå¯¹APå€¼çš„å½±å“ã€‚(d)æ˜¯é€šè¿‡å’ŒOHEMçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºæœ€å¥½çš„Focal  Lossæ¯”æœ€å¥½çš„OHEMæé«˜äº†3.2APã€‚è¿™é‡ŒOHEM1:3è¡¨ç¤ºåœ¨é€šè¿‡OHEMå¾—åˆ°çš„minibatchä¸Šå¼ºåˆ¶positiveå’Œnegativeæ ·æœ¬çš„æ¯”ä¾‹ä¸º1:3ï¼Œé€šè¿‡å¯¹æ¯”å¯ä»¥çœ‹å‡ºè¿™ç§å¼ºåˆ¶çš„æ“ä½œå¹¶æ²¡æœ‰æå‡APã€‚(e)åŠ å…¥äº†è¿ç®—æ—¶é—´çš„å¯¹æ¯”ï¼Œå¯ä»¥å’Œå‰é¢çš„Figure2ç»“åˆèµ·æ¥çœ‹ï¼Œé€Ÿåº¦æ–¹é¢ä¹Ÿæœ‰ä¼˜åŠ¿ã€‚Table2è¡¨ç¤ºRetinaNetå’ŒOne-Stageæ£€æµ‹å™¨çš„æ¯”è¾ƒï¼Œå¯ä»¥çœ‹åˆ°RetinaNetä¹Ÿæ˜¯æ¯«ä¸é¡ºè‰²çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RetinaNet/649.jpg" alt></p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>kerasç‰ˆæœ¬ï¼š<a href="https://github.com/fizyr/keras-retinanet">https://github.com/fizyr/keras-retinanet</a><br>pytorchç‰ˆæœ¬: <a href="https://github.com/yhenon/pytorch-retinanet">https://github.com/yhenon/pytorch-retinanet</a><br>caffe-focal loss: <a href="https://github.com/chuanqi305/FocalLoss">https://github.com/chuanqi305/FocalLoss</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>CVPR 2018 Cascade R-CNN</title>
    <url>/2020/04/07/CVPR-2018-Cascade-R-CNN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Cascade R-CNNè¿™ä¸ªç®—æ³•æ˜¯CVPR 2018æå‡ºçš„ï¼Œé€šè¿‡çº§è”å¤šä¸ªæ£€æµ‹ç½‘ç»œè¾¾åˆ°ä¸æ–­ä¼˜åŒ–é¢„æµ‹ç»“æœçš„ç›®çš„ã€‚ä½†æ˜¯å’Œæ™®é€šçš„çº§è”æ£€æµ‹å™¨ä¸åŒï¼ŒCascade R-CNNçš„å¤šä¸ªæ£€æµ‹ç½‘ç»œæ˜¯åŸºäºä¸åŒçš„IOUé˜ˆå€¼è¿›è€Œç¡®å®šä¸åŒçš„æ­£è´Ÿæ ·æœ¬è®­ç»ƒå‡ºæ¥çš„ï¼Œåœ¨COCOæ•°æ®é›†ä¸ŠCascade  R-CNNå–å¾—äº†éå¸¸å‡ºè‰²çš„ç»“æœï¼Œå¹¶ä¸”ä¹Ÿæˆä¸ºäº†å½“å‰ç›®æ ‡æ£€æµ‹æ¯”èµ›ä¸­çš„æœ‰åŠ›Trickã€‚</p>
<h2 id="ç®€å•å›é¡¾R-CNNç»“æ„"><a href="#ç®€å•å›é¡¾R-CNNç»“æ„" class="headerlink" title="ç®€å•å›é¡¾R-CNNç»“æ„"></a>ç®€å•å›é¡¾R-CNNç»“æ„</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/v2-11788fb6c9bb4840e17be9a63ab38759_hd.jpg" alt></p>
<p>é¦–å…ˆï¼Œä»¥ç»å…¸çš„Faster R-CNNä¸ºä¾‹ã€‚æ•´ä¸ªç½‘ç»œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œtrainingé˜¶æ®µå’Œinferenceé˜¶æ®µï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<ul>
<li>trainingé˜¶æ®µï¼ŒRPNç½‘ç»œæå‡ºäº†2000å·¦å³çš„proposalsï¼Œè¿™äº›proposalsè¢«é€å…¥åˆ°Fast R-CNNç»“æ„ä¸­ï¼Œåœ¨Fast  R-CNNç»“æ„ä¸­ï¼Œé¦–å…ˆè®¡ç®—æ¯ä¸ªproposalå’Œgtä¹‹é—´çš„iouï¼Œé€šè¿‡äººä¸ºçš„è®¾å®šä¸€ä¸ªIoUé˜ˆå€¼ï¼ˆé€šå¸¸ä¸º0.5ï¼‰ï¼ŒæŠŠè¿™äº›Proposalsåˆ†ä¸ºæ­£æ ·æœ¬ï¼ˆå‰æ™¯ï¼‰å’Œè´Ÿæ ·æœ¬ï¼ˆèƒŒæ™¯ï¼‰ï¼Œå¹¶å¯¹è¿™äº›æ­£è´Ÿæ ·æœ¬é‡‡æ ·ï¼Œä½¿å¾—ä»–ä»¬ä¹‹é—´çš„æ¯”ä¾‹å°½é‡æ»¡è¶³ï¼ˆ1:3ï¼ŒäºŒè€…æ€»æ•°é‡é€šå¸¸ä¸º128ï¼‰ï¼Œä¹‹åè¿™äº›proposalsï¼ˆ128ä¸ªï¼‰è¢«é€å…¥åˆ°Roi Poolingï¼Œæœ€åè¿›è¡Œç±»åˆ«åˆ†ç±»å’Œboxå›å½’ã€‚</li>
<li>inferenceé˜¶æ®µï¼ŒRPNç½‘ç»œæå‡ºäº†300å·¦å³çš„proposalsï¼Œè¿™äº›proposalsè¢«é€å…¥åˆ°Fast R-CNNç»“æ„ä¸­ï¼Œ<strong>å’Œtrainingé˜¶æ®µä¸åŒçš„æ˜¯ï¼Œinferenceé˜¶æ®µæ²¡æœ‰åŠæ³•å¯¹è¿™äº›proposalsé‡‡æ ·ï¼ˆinferenceé˜¶æ®µè‚¯å®šä¸çŸ¥é“gtçš„ï¼Œä¹Ÿå°±æ²¡æ³•è®¡ç®—iouï¼‰</strong>ï¼Œæ‰€ä»¥ä»–ä»¬ç›´æ¥è¿›å…¥Roi Poolingï¼Œä¹‹åè¿›è¡Œç±»åˆ«åˆ†ç±»å’Œboxå›å½’ã€‚</li>
</ul>
<p>åœ¨è¿™é‡Œæ’ä¸€å¥ï¼Œåœ¨R-CNNä¸­ç”¨åˆ°IoUé˜ˆå€¼çš„æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼Œåˆ†åˆ«æ˜¯Trainingæ—¶<strong>Positive</strong>ä¸<strong>Negative</strong>åˆ¤å®šï¼Œå’ŒInferenceæ—¶è®¡ç®—mAPã€‚è®ºæ–‡ä¸­å¼ºè°ƒçš„IoUé˜ˆå€¼æŒ‡çš„æ˜¯Trainingæ—¶<strong>Positive</strong>å’Œ<strong>Negative</strong>åˆ¤å®šå¤„ã€‚</p>
<h2 id="å‡ºå‘ç‚¹"><a href="#å‡ºå‘ç‚¹" class="headerlink" title="å‡ºå‘ç‚¹"></a>å‡ºå‘ç‚¹</h2><p>ä¸‹é¢çš„Figure1å±•ç¤ºäº†Cascade R-CNNçš„å‡ºå‘ç‚¹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/640.jpg" alt></p>
<ul>
<li><p><code>Figure1(a)</code>å±•ç¤ºäº†å½“IOUé˜ˆå€¼ç­‰äº0.5æ—¶çš„æ£€æµ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ç»“æœå›¾ä¸­å­˜åœ¨è¾ƒå¤šè¯¯æ£€ï¼Œå› ä¸º0.5çš„é˜ˆå€¼ä¼šä½¿å¾—æ­£æ ·æœ¬ä¸­æœ‰è¾ƒå¤šçš„èƒŒæ™¯ï¼Œè¿™æ˜¯äº§ç”Ÿè¯¯æ£€çš„ä¸»è¦åŸå› ã€‚</p>
</li>
<li><p><code>Figure1(b)</code>å±•ç¤ºäº†å½“IOUé˜ˆå€¼ç­‰äº0.7æ—¶çš„æ£€æµ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¯¯æ£€å˜å°‘äº†ï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šè¯¯æ£€å˜å°‘äº†ç»“æœå°±ä¸€å®šæ›´å¥½ï¼Œå› ä¸ºIOUé˜ˆå€¼æ›´å¤§å¯¼è‡´æ­£æ ·æœ¬è¶Šå°‘ï¼Œé‚£ä¹ˆè¿‡æ‹Ÿåˆçš„é£é™©å°±è¶Šå¤§ã€‚</p>
</li>
<li><p><code>Figure1(c)</code>å±•ç¤ºäº†æ¨¡å‹å®šä½è¡¨ç°ï¼Œå…¶ä¸­æ¨ªåæ ‡è¡¨ç¤ºè¾“å…¥å€™é€‰æ¡†å’ŒGTæ¡†çš„IOUå€¼ï¼Œå³proposalçš„IoUï¼Œçºµåæ ‡è¡¨ç¤ºè¾“å‡ºçš„å€™é€‰æ¡†å’ŒGTæ¡†çš„IOUå€¼ï¼Œ å³ç»è¿‡box regå¾—åˆ°çš„æ–°çš„IoUã€‚ç„¶åï¼Œçº¢ï¼Œç»¿ï¼Œè“ä¸‰æ¡æ›²çº¿åˆ†åˆ«ä»£è¡¨è®­ç»ƒæ£€æµ‹æ¨¡å‹æ—¶ç”¨çš„æ­£è´Ÿæ ·æœ¬æ ‡ç­¾çš„é˜ˆå€¼åˆ†åˆ«æ˜¯0.7ï¼Œ0.6ï¼Œ0.5ã€‚å¯ä»¥çœ‹åˆ°<strong>å½“ä¸€ä¸ªæ£€æµ‹æ¨¡å‹é‡‡ç”¨æŸä¸ªIOUé˜ˆå€¼ï¼ˆå‡è®¾u=0.6ï¼‰æ¥åˆ¤å®šæ­£è´Ÿæ ·æœ¬æ—¶ï¼Œé‚£ä¹ˆå½“è¾“å…¥å€™é€‰æ¡†å’ŒGTçš„IOUåœ¨è¿™ä¸ªé˜ˆå€¼ï¼ˆu=0.6ï¼‰é™„è¿‘æ—¶ï¼Œè¯¥æ£€æµ‹æ¨¡å‹æ¯”åŸºäºå…¶å®ƒé˜ˆå€¼çš„æ£€æµ‹æ¨¡å‹æ•ˆæœæ›´å¥½</strong>ã€‚</p>
</li>
<li><p><code>Figure1(d)</code>å±•ç¤ºäº†ä½¿ç”¨ä¸åŒé˜ˆå€¼æ¥è®­ç»ƒæ£€æµ‹æ¨¡å‹çš„è¡¨ç°ï¼Œå¯ä»¥çœ‹å‡ºå½“IOUé˜ˆå€¼ç­‰äº0.7çš„æ—¶å€™æ•ˆæœä¸‹é™æ¯”è¾ƒæ˜æ˜¾ï¼ŒåŸå› æ˜¯IOUé˜ˆå€¼è¿‡é«˜å¯¼è‡´æ­£æ ·æœ¬æ•°é‡æ›´å°‘ï¼Œè¿™æ ·<strong>æ ·æœ¬</strong>ä¼šæ›´åŠ ä¸å¹³è¡¡å¹¶ä¸”å®¹æ˜“å¯¼è‡´è¿‡æ‹Ÿåˆã€‚</p>
</li>
</ul>
<h2 id="Cascade-R-CNNåŸç†"><a href="#Cascade-R-CNNåŸç†" class="headerlink" title="Cascade R-CNNåŸç†"></a>Cascade R-CNNåŸç†</h2><p>åŸºäºä¸Šé¢çš„å‡ºå‘ç‚¹ï¼ŒCascade R-CNNæ¨ªç©ºå‡ºä¸–ã€‚ç®€å•æ¥è¯´ï¼ŒCascade  R-CNNå°±æ˜¯ç”±ä¸€ç³»åˆ—æ£€æµ‹å™¨ç»„æˆçš„çº§è”æ£€æµ‹æ¨¡å‹ï¼Œå¹¶ä¸”æ¯ä¸ªæ£€æµ‹å™¨éƒ½åŸºäºä¸åŒIOué˜ˆå€¼çš„æ­£è´Ÿæ ·æœ¬è®­ç»ƒå¾—åˆ°ï¼Œå‰ä¸€ä¸ªæ£€æµ‹å™¨çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªæ£€æµ‹å™¨çš„è¾“å…¥ï¼Œå¹¶ä¸”è¶Šå¾€åèµ°ï¼Œæ£€æµ‹å™¨çš„é˜ˆå€¼æ˜¯è¶Šå¤§çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆCascade R-CNNè¦è¿™æ ·æ¥è®¾è®¡å‘¢ï¼Ÿè¿™å’Œä¸Šé¢çš„å‡ºå‘ç‚¹å¯†åˆ‡ç›¸å…³ï¼Œä»<code>Figure1(c)</code>ä¸­æˆ‘ä»¬çœ‹å‡ºä½¿ç”¨ä¸åŒçš„IOUé˜ˆå€¼è®­ç»ƒå¾—åˆ°çš„æ£€æµ‹æ¨¡å‹å¯¹æœ‰ä¸åŒIOUé˜ˆå€¼çš„è¾“å…¥å€™é€‰æ¡†çš„ç»“æœå·®åˆ«è¾ƒå¤§ï¼Œå› æ­¤<strong>æˆ‘ä»¬å¸Œæœ›è®­ç»ƒæ¯ä¸ªæ£€æµ‹æ¨¡å‹ç”¨çš„IOUé˜ˆå€¼è¦å°½å¯èƒ½å’Œè¾“å…¥å€™é€‰æ¡†çš„IOUæ¥è¿‘</strong>ã€‚å¹¶ä¸”ä»<code>Figure1(c)</code>ä¸­å¯ä»¥çœ‹å‡ºä¸‰æ¡å½©è‰²æ›²çº¿éƒ½åœ¨ç°åº¦æ›²çº¿ä¸Šæ–¹ï¼Œè¿™è¯´æ˜å¯¹äºè¿™å‡ ä¸ªé˜ˆå€¼æ¥è¯´ï¼Œ<strong>è¾“å‡ºçš„IOUé˜ˆå€¼éƒ½å¤§äºè¾“å…¥çš„IOUé˜ˆå€¼</strong>ã€‚æ ¹æ®è¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿ä¸Šä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°è¶Šæ¥è¶Šé«˜çš„IOUã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>æˆ‘ä»¬å¾ˆéš¾è®©ä¸€ä¸ªåœ¨æŒ‡å®šIOUé˜ˆå€¼ç•Œå®šçš„è®­ç»ƒé›†ä¸Šè®­ç»ƒå¾—åˆ°çš„æ£€æµ‹æ¨¡å‹å¯¹IOUè·¨åº¦è¾ƒå¤§çš„è¾“å…¥å€™é€‰æ¡†éƒ½è¾¾åˆ°æœ€ä½³ï¼Œå› æ­¤é‡‡å–çº§è”çš„æ–¹å¼èƒ½å¤Ÿè®©æ¯ä¸€ä¸ªé˜¶æ®µçš„æ£€æµ‹å™¨éƒ½ä¸“æ³¨äºæ£€æµ‹IOUåœ¨æŸä¸€èŒƒå›´å†…çš„å€™é€‰æ¡†ï¼Œå› ä¸ºè¾“å‡ºIOUæ™®éå¤§äºè¾“å…¥IOUï¼Œå› æ­¤æ£€æµ‹æ•ˆæœä¼šè¶Šæ¥è¶Šå¥½ã€‚</strong></p>
<h2 id="Cascade-R-CNNç½‘ç»œç»“æ„"><a href="#Cascade-R-CNNç½‘ç»œç»“æ„" class="headerlink" title="Cascade R-CNNç½‘ç»œç»“æ„"></a>Cascade R-CNNç½‘ç»œç»“æ„</h2><p>ä¸‹é¢çš„Figure3å±•ç¤ºäº†å’ŒCascade R-CNNæœ‰å…³çš„å‡ ç§ç»å…¸æ£€æµ‹ç½‘ç»œç»“æ„çš„ç¤ºæ„å›¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/641.webp" alt></p>
<ul>
<li><p><code>Figure3(a)</code>è¡¨ç¤ºFaster RCNNï¼Œå› ä¸ºåŒé˜¶æ®µç±»å‹çš„ç›®æ ‡æ£€æµ‹ç®—æ³•åŸºæœ¬ä¸Šéƒ½åŸºäºFaster RCNNï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä»¥è¯¥ç®—æ³•ä¸ºBaseLineã€‚å…¶ä¸­H0ä»£è¡¨çš„æ˜¯RPNç½‘ç»œï¼ŒH1ä»£è¡¨çš„æ˜¯Faster R-CNNè¿›è¡Œæ£€æµ‹ä¸åˆ†ç±»çš„headï¼ŒC1ä»£è¡¨æœ€ç»ˆçš„åˆ†ç±»ç»“æœï¼ŒB1ä»£è¡¨æœ€ç»ˆçš„bounding boxå›å½’ç»“æœã€‚</p>
</li>
<li><p><code>Figure3(b)</code>è¡¨ç¤ºè¿­ä»£å¼çš„è¾¹ç•Œæ¡†å›å½’ï¼Œä»å›¾ä¹Ÿéå¸¸å®¹æ˜“çœ‹å‡ºæ€æƒ³ï¼Œå°±æ˜¯å‰ä¸€ä¸ªæ£€æµ‹æ¨¡å‹å›å½’å¾—åˆ°çš„è¾¹ç•Œæ¡†åæ ‡åˆå§‹åŒ–ä¸‹ä¸€ä¸ªæ£€æµ‹æ¨¡å‹çš„è¾¹ç•Œæ¡†ï¼Œç„¶åç»§ç»­å›å½’ï¼Œè¿™æ ·è¿­ä»£ä¸‰æ¬¡åå¾—åˆ°ç»“æœã€‚</p>
</li>
<li><p><code>Figure3(c)</code>è¡¨ç¤ºIntegral Lossï¼Œè¡¨ç¤ºå¯¹è¾“å‡ºè¾¹ç•Œæ¡†çš„æ ‡ç­¾ç•Œå®šé‡‡ç”¨ä¸åŒçš„IOUé˜ˆå€¼ï¼Œå› ä¸ºå½“IOUè¾ƒé«˜æ—¶ï¼Œè™½ç„¶é¢„æµ‹å¾—åˆ°è¾¹ç•Œæ¡†å¾ˆå‡†ç¡®ï¼Œä½†æ˜¯ä¹Ÿä¼šä¸¢å¤±ä¸€äº›è¾¹ç•Œæ¡†ã€‚ï¼ˆå³åˆ†ç±»ç»“æœåŸºäºä¸åŒIOUï¼Œbboxå¹¶æ²¡æœ‰ï¼‰å…³äºè¿™ä¸ªç½‘ç»œçš„è§£é‡Šçœ‹åŸæ–‡æ›´å®¹æ˜“ç†è§£ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/646.webp" alt><br>è¿™ç§Trickåœ¨æ¯”èµ›ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå°±æ˜¯è¯´æŒ‰ç…§æ•°æ®é›†çš„è¯„ä»·æŒ‡æ ‡æ¥è‡ªå®šä¹‰Lossï¼ˆä¸€èˆ¬æ˜¯æŠŠå’ŒæŒ‡æ ‡ç›¸å…³çš„é‚£ä¸€é¡¹åŠ åœ¨åŸå§‹çš„Lossåé¢ï¼‰å¾€å¾€å¯ä»¥å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</p>
</li>
<li><p><code>Figure3(d)</code>è¡¨ç¤ºCascade R-CNNï¼Œ<strong>H1é‚£ä¸€éƒ¨åˆ†æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯Cascade R-CNNå¾—åˆ°B1å›å½’åçš„æ£€æµ‹æ¡†åï¼Œå°†å…¶è¾“å…¥åˆ°H2éƒ¨åˆ†ï¼Œç»§ç»­å›å½’ï¼Œä»¥æ­¤ç±»æ¨åˆ°H3éƒ¨åˆ†ï¼Œä½¿å¾—æ¯æ¬¡å¯¹bounding boxéƒ½æé«˜ä¸€å®šçš„ç²¾åº¦ï¼Œå·²è¾¾åˆ°æé«˜æ£€æµ‹æ¡†å‡†ç¡®åº¦çš„ä½œç”¨ã€‚(æ³¨ï¼šçº§è”çš„æ–¹å¼ï¼Œä¸å†æ˜¯ä¸ºäº†æ‰¾åˆ°hard negativesï¼Œè€Œæ˜¯é€šè¿‡è°ƒæ•´bounding boxesï¼Œç»™ä¸‹ä¸€é˜¶æ®µæ‰¾åˆ°ä¸€ä¸ªIoUæ›´é«˜çš„æ­£æ ·æœ¬æ¥è®­ç»ƒã€‚)</strong>ï¼Œå’Œ<code>Figure3(b)</code>ï¼Œ<code>Figure3(c)</code>çš„ç»“æ„æ¯”è¾ƒåƒã€‚ä½†å’Œ<code>Figure3(b)</code>æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯Cascade R-CNNä¸­çš„æ£€æµ‹æ¨¡å‹æ˜¯åŸºäºå‰ä¸€é˜¶æ®µçš„è¾“å‡ºè¿›è¡Œè®­ç»ƒï¼Œè€Œä¸æ˜¯<code>Figure3(b)</code>ä¸­3ä¸ªæ£€æµ‹æ¨¡å‹éƒ½æ˜¯åŸºäºæœ€åˆå§‹çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œï¼ˆä¸ªäººç†è§£ï¼š<strong>headç›¸åŒ</strong>ï¼Œç›¸å½“äºåŸºäºæœ€å¼€å§‹è®­ç»ƒï¼‰è€Œä¸”(b)æ˜¯åœ¨éªŒè¯é˜¶æ®µé‡‡ç”¨çš„æ–¹å¼ï¼Œè€Œcascade-R-CNNæ˜¯åœ¨è®­ç»ƒå’ŒéªŒè¯é˜¶æ®µé‡‡ç”¨çš„æ–¹å¼ã€‚è€Œå’Œ<code>Figure3(c)</code>çš„åŒºåˆ«æ›´åŠ æ˜æ˜¾ï¼ŒCascade R-CNNä¸­æ¯ä¸ªStageçš„è¾“å…¥å€™é€‰æ¡†éƒ½æ˜¯å‰ä¸€ä¸ªé˜¶æ®µçš„å€™é€‰æ¡†è¾“å‡ºï¼Œè€Œå´æ²¡æœ‰è¿™ç§çº§è”çš„æ€æƒ³ï¼Œä»…ä»…æ˜¯æ¨¡å‹åŸºäºä¸åŒçš„IOUé˜ˆå€¼è¿›è¡Œè®­ç»ƒå¾—åˆ°ã€‚</p>
</li>
</ul>
<h2 id="Cascade-R-CNNçš„å¯è¡Œæ€§åˆ†æ"><a href="#Cascade-R-CNNçš„å¯è¡Œæ€§åˆ†æ" class="headerlink" title="Cascade R-CNNçš„å¯è¡Œæ€§åˆ†æ"></a>Cascade R-CNNçš„å¯è¡Œæ€§åˆ†æ</h2><p>ä¸Šé¢çš„<code>Figure3(b)</code>ä¸­çš„è¿­ä»£å›å½’æœ‰ä¸¤ä¸ªè‡´å‘½ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä»<code>Figure1(c)</code>çš„å®éªŒçŸ¥é“åŸºäºä¸åŒIOUé˜ˆå€¼è®­ç»ƒçš„æ£€æµ‹æ¨¡å‹å¯¹ä¸åŒIOUçš„å€™é€‰æ¡†è¾“å…¥æ•ˆæœå·®åˆ«å¾ˆå¤§ï¼Œå› æ­¤å¦‚æœæ¯æ¬¡è¿­ä»£éƒ½åŸºäºç›¸åŒIOUé˜ˆå€¼çš„æ•°æ®è¿›è¡Œè®­ç»ƒè·å¾—çš„æ£€æµ‹æ¨¡å‹ï¼Œé‚£ä¹ˆå½“è¾“å…¥å€™é€‰æ¡†çš„IOUä¸åœ¨è®­ç»ƒçš„æ£€æµ‹æ¨¡å‹çš„IOUé™„è¿‘æ—¶ï¼Œæ•ˆæœä¸ä¼šæœ‰å¤ªå¤§æå‡ã€‚</li>
<li>ä¸‹é¢çš„<code>Figure2</code>ä¸ºæˆ‘ä»¬å±•ç¤ºäº†<code>Figure3(b)</code>è¿™ç§å€™é€‰æ¡†å›å½’åœ¨ä¸åŒé˜¶æ®µçš„4ä¸ªåæ ‡å›å½’å€¼çš„åˆ†å¸ƒæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„é˜¶æ®µåæ ‡çš„åˆ†å¸ƒå·®å¼‚æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œ<code>Figure3(b)</code>çš„è¿­ä»£å›å½’æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/642.jpg" alt><br>ç¬¬ä¸€è¡Œæ¨ªçºµè½´åˆ†åˆ«æ˜¯å›å½’ç›®æ ‡ä¸­çš„boxçš„xæ–¹å‘å’Œyæ–¹å‘åç§»é‡ï¼›ç¬¬äºŒè¡Œæ¨ªçºµè½´åˆ†åˆ«æ˜¯å›å½’ç›®æ ‡ä¸­çš„boxçš„å®½ã€é«˜åå·®é‡ï¼Œ$\delta_{x}=\left(g_{x}-b_{x}\right) / b_{w}$, $\delta_{y}=\left(g_{y}-b_{y}\right) / b_{h}$ï¼Œ$\delta_{w}=\log \left(g_{w} / b_{w}\right)$, $\delta_{h}=\log \left(g_{h} / b_{h}\right)$ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»1st stageåˆ°2nd stageï¼Œproposalçš„åˆ†å¸ƒå…¶å®å·²ç»å‘ç”Ÿå¾ˆå¤§å˜åŒ–äº†ï¼Œå› ä¸ºå¾ˆå¤šå™ªå£°ç»è¿‡box regå®é™…ä¸Šä¹Ÿæé«˜äº†IoUï¼Œ2ndå’Œ3rdä¸­çš„é‚£äº›çº¢è‰²ç‚¹å·²ç»å±äºoutliersï¼Œå¦‚æœä¸æé«˜é˜ˆå€¼æ¥å»æ‰å®ƒä»¬ï¼Œå°±ä¼šå¼•å…¥å¤§é‡å™ªå£°å¹²æ‰°ï¼Œå¯¹ç»“æœå¾ˆä¸åˆ©ã€‚(headä¸å˜ï¼ŒIOUä¸å˜è¿˜ä¸º0.5ï¼Œå»ä¸æ‰å·²æé«˜IOUçš„å™ªå£°ï¼Œä¹Ÿå°±æ˜¯çº¢ç‚¹)ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œé˜ˆå€¼çš„é‡æ–°é€‰å–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>resample</strong>çš„è¿‡ç¨‹ï¼Œå®ƒä¿è¯äº†æ ·æœ¬çš„è´¨é‡ã€‚</li>
</ul>
<p>é‚£ä¹ˆCascade R-CNNæ˜¯å¦å¯ä»¥æ”¹å–„ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿä¸‹é¢çš„<code>Figure4</code>å±•ç¤ºäº†Cascade R-CNNåœ¨ä¸åŒé˜¶æ®µé¢„æµ‹å¾—åˆ°çš„å€™é€‰æ¡†çš„IOUå€¼åˆ†å¸ƒæƒ…å†µã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ¯ç»è¿‡ä¸€ä¸ªæ£€æµ‹å™¨è¿›è¡Œåæ ‡å›å½’ï¼Œå€™é€‰æ¡†è¶Šå‡†ç¡®ï¼Œä¹Ÿå³æ˜¯è¯´å€™é€‰æ¡†å’ŒGTæ¡†çš„IOUæ›´å¤§ã€‚ä»<code>Figure4</code>å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡æ£€æµ‹å™¨ä¹‹åIOUå¤§çš„æ ·æœ¬å¢åŠ äº†ï¼Œè¿™å°±è¯´æ˜äº†Cascade R-CNNæ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå› ä¸ºåé¢çš„æ£€æµ‹å™¨æé«˜é˜ˆå€¼å¯¼è‡´æ­£æ ·æœ¬è¿‡å°‘è€Œè¿‡æ‹Ÿåˆã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/643.png" alt></p>
<p>ä»è¿™å¼ å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ1st stageå¤§äº0.5çš„ï¼Œåˆ°2nd stageå¤§äº0.6çš„ï¼Œåˆ°3rd stageå¤§äº0.7çš„â€¦â€¦åœ¨è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸­proposalçš„æ ·æœ¬æ•°é‡ç¡®å®æ²¡æœ‰ç‰¹åˆ«å¤§çš„æ”¹å˜ï¼Œç”šè‡³è¿˜æœ‰ç¨è®¸æå‡ï¼Œå’Œ2å›¾ç»“åˆèµ·æ¥çœ‹ï¼Œåº”è¯¥å¯ä»¥è¯´æ˜¯éå¸¸å¼ºæœ‰åŠ›çš„è¯æ˜äº†ã€‚<br>æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯ï¼š</p>
<ul>
<li>cascaded regressionä¸æ–­æ”¹å˜äº†proposalçš„åˆ†å¸ƒï¼Œå¹¶ä¸”é€šè¿‡è°ƒæ•´é˜ˆå€¼çš„æ–¹å¼é‡é‡‡æ ·ï¼ˆå³ï¼š$f^{\prime}(x, b)=f_{T} \cdot f_{T-1} \cdot f_{T-2} \cdots f_{1}(x, b)$ï¼‰</li>
<li>cascadedåœ¨trainå’Œinferenceæ—¶éƒ½ä¼šä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰åå·®é—®é¢˜</li>
<li>cascadedé‡é‡‡æ ·åçš„æ¯ä¸ªæ£€æµ‹å™¨ï¼Œéƒ½å¯¹é‡é‡‡æ ·åçš„æ ·æœ¬æ˜¯æœ€ä¼˜çš„ï¼Œæ²¡æœ‰mismatché—®é¢˜</li>
</ul>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>ä¸‹é¢çš„Table1å±•ç¤ºäº†<code>Figure3</code>ä¸­å‡ ç§æ¨¡å‹å’ŒCascade R-CNNçš„ç»“æœå¯¹æ¯”ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/644.png" alt></p>
<p>ç„¶åå†æ¥çœ‹ä¸€ä¸‹åœ¨COCOæ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼Œå¯ä»¥çœ‹åˆ°Cascade R-CNNéå¸¸çš„SOTAäº†ï¼ŒYOLOV3åªæœ‰33%çš„mAPï¼Œè€ŒCascade R-CNNåˆ™æœ‰42.8%çš„mAPå€¼ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Cascade_R-CNN/645.jpg" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>CVPR 2017 ResNeXtï¼ˆResNetè¿›åŒ–ç‰ˆï¼‰</title>
    <url>/2020/04/10/CVPR-2017-ResNeXt%EF%BC%88ResNet%E8%BF%9B%E5%8C%96%E7%89%88%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¼ ç»Ÿçš„å·ç§¯ç¥ç»ç½‘ç»œåœ¨æé«˜æ€§èƒ½æ—¶éƒ½æ˜¯åŠ æ·±å’ŒåŠ å®½ç½‘ç»œï¼Œä½†éšç€è¶…å‚æ•°æ•°é‡çš„å¢åŠ (å¦‚é€šé“æ•°ï¼Œå·ç§¯æ ¸å¤§å°ç­‰)ç½‘ç»œå˜å¾—éå¸¸éš¾è°ƒï¼Œä¸”ç½‘ç»œçš„è®¡ç®—å¼€é”€å’Œç½‘ç»œç»“æ„è®¾è®¡ä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾ã€‚æ­¤å¤–è¿™äº›å¤§æ¨¡å‹é’ˆå¯¹æ€§æ¯”è¾ƒå¼ºï¼Œå³åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šè¡¨ç°å¥½çš„ç½‘ç»œæ”¾åˆ°æ–°æ•°æ®é›†ä¸Šå°±éœ€è¦ä¿®æ”¹å¾ˆå¤šçš„å‚æ•°æ‰èƒ½å·¥ä½œè‰¯å¥½ï¼Œå› æ­¤å¯æ‰©å±•æ€§æ¯”è¾ƒä¸€èˆ¬ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼ŒSaining Xie, Ross Girshick, Kaiming Heåœ¨CVPR2017ä¸Šæå‡ºäº†ResNeXtã€‚</p>
<h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><ul>
<li>ç½‘ç»œç»“æ„æ›´åŠ ç®€å•å’Œæ¨¡å—åŒ–ã€‚</li>
<li>å¤§é‡å‡å°‘äº†éœ€è¦æ‰‹åŠ¨è°ƒèŠ‚çš„è¶…å‚æ•°ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</li>
<li>å’ŒResNetç›¸æ¯”ï¼Œç›¸åŒçš„å‚æ•°ä¸ªæ•°ï¼Œç»“æœæ›´å¥½ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€ä¸ª101å±‚çš„ResNeXtç½‘ç»œå’Œ200å±‚çš„ResNetå‡†ç¡®åº¦å·®ä¸å¤šï¼Œä½†æ˜¯è®¡ç®—é‡åªæœ‰åè€…çš„ä¸€åŠã€‚</li>
</ul>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><h3 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h3><p>ResNeXtçš„ç½‘ç»œç»“æ„å¦‚Table1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/640.webp" alt></p>
<p>Table 1çš„å·¦è¾¹ç½‘ç»œä¸ºResNet-50ï¼ŒTable 1çš„å³è¾¹ç½‘ç»œä¸ºResNeXt-50ï¼Œæ‹¬å·ä»£è¡¨æ®‹å·®å—ï¼Œæ‹¬å·å¤–é¢çš„æ•°å­—ä»£è¡¨æ®‹å·®å—çš„å †å æ¬¡æ•°ï¼Œè€ŒCä»£è¡¨çš„ResNeXtå¼•å…¥çš„å·ç§¯åˆ†ç»„æ•°ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªç½‘ç»œçš„FLOPsåŸºæœ¬ä¸€è‡´ï¼Œä¹Ÿå³æ˜¯è¯´æ¨¡å‹å¤æ‚åº¦ä¸€è‡´ã€‚é‚£ResNeXtæœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼Ÿè¿™è¦å…ˆä»åˆ†ç»„æ¥è¯´èµ·ã€‚</p>
<h3 id="ResNeXtæ®‹å·®æ¨¡å—"><a href="#ResNeXtæ®‹å·®æ¨¡å—" class="headerlink" title="ResNeXtæ®‹å·®æ¨¡å—"></a>ResNeXtæ®‹å·®æ¨¡å—</h3><p>åˆ†ç»„æ•°åœ¨è®ºæ–‡ä¸­åˆè¢«ç§°ä¸ºåŸºæ•°(cardinality)ï¼Œæ˜¯å¯¹GoogleNetä¸­åˆ†ç«‹åˆå¹¶æ€æƒ³å’ŒVGG/ResNetä¸­å †å æ€æƒ³çš„ä¸€ç§ç»“åˆï¼ŒResNetçš„æ®‹å·®æ¨¡å—å’ŒResNeXtçš„æ®‹å·®æ¨¡å—å¦‚Figure1æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ResNeXtæ®‹å·®æ¨¡å—æœ‰32ä¸ªåŸºæ•°(åˆ†ç»„æ•°)ï¼Œå¹¶ä¸”æ¯ä¸ªè¢«èšåˆçš„æ‹“æ‰‘ç»“æ„å°±å®Œå…¨ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯1 x 1 + 3 x 3 + 1 x 1çš„ç»„ä»¶ï¼Œè¿™ä¹Ÿæ˜¯å’ŒInceptionç»“æ„çš„æœ€å¤§åŒºåˆ«ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/641.webp" alt></p>
<p>ç„¶åè®ºæ–‡ä»ç†è®ºè§’åº¦æ¥åˆ†æäº†ä¸€ä¸‹è¿™ä¸ªResNeXtæ®‹å·®æ¨¡å—ï¼Œç”¨å…¨è¿æ¥å±‚ä¸¾ä¾‹æ¥è®²ï¼Œå…¨è¿æ¥å±‚çš„å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/642.webp" alt></p>
<p>ç„¶åFigure2å°±æ¸…æ™°çš„å±•ç¤ºäº†å…¨è¿æ¥å±‚åˆ†ç¦»å˜åŒ–åˆå¹¶(<code>split-transform-merge</code>)çš„å¤„ç†è¿‡ç¨‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/643.webp" alt></p>
<p>è€ŒResNeXtæ®‹å·®æ¨¡å—å®é™…ä¸Šå°±æ˜¯å°†å…¶ä¸­çš„$w_{i} x_{i}$æ›¿æ¢æˆäº†æ›´ä¸€èˆ¬çš„å‡½æ•°ï¼Œç”¨å…¬å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/644.png" alt></p>
<p>å…¶ä¸­$C$å°±æ˜¯ä¸Šä¸€èŠ‚æåˆ°çš„åˆ†ç»„æ•°/åŸºæ•°ï¼Œè€Œ$T_{i}(x)$ä»£è¡¨çš„æ˜¯ç›¸åŒçš„æ‹“æ‰‘ç»“æ„ï¼Œåœ¨Figure1ä¸­å°±æ˜¯<code>1x1+3x3+1x1</code>å·ç§¯å †å ã€‚</p>
<h3 id="ç­‰ä»·æ¨¡å¼"><a href="#ç­‰ä»·æ¨¡å¼" class="headerlink" title="ç­‰ä»·æ¨¡å¼"></a>ç­‰ä»·æ¨¡å¼</h3><p>è€ŒFigure1ä¸­çš„ResNeXtæ®‹å·®æ¨¡å—æœ‰ä¸¤ç§ç­‰ä»·çš„æ¨¡å‹ï¼Œå¦‚Figure3æ‰€ç¤ºã€‚å…¶ä¸­Figure3ï¼ˆaï¼‰å‰é¢å·²ç»è®²è¿‡äº†ã€‚è€ŒFigure3ï¼ˆbï¼‰è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨äº†ä¸¤å±‚å·ç§¯åconcatï¼Œç„¶åå†å·ç§¯ï¼Œæ¯”è¾ƒç±»ä¼¼äºInception-ResNetã€‚Figure3ï¼ˆcï¼‰ä½¿ç”¨çš„æ˜¯åŸå§‹çš„ç»„å·ç§¯ã€‚è®ºæ–‡æŒ‡å‡ºè¿™ä¸‰ç§ç»“æ„æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œå¹¶ä¸”æœ€ååšå‡ºæ¥çš„å®éªŒç»“æœå®Œå…¨ä¸€æ ·ï¼Œè€Œåœ¨å®éªŒéƒ¨åˆ†å±•ç¤ºçš„æ˜¯Figure3ï¼ˆcï¼‰çš„ç»“æœï¼Œå› ä¸ºFigure3ï¼ˆcï¼‰çš„ç»“æ„æ¯”è¾ƒç®€æ´å¹¶ä¸”é€Ÿåº¦æ›´å¿«ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/645.webp" alt></p>
<h3 id="æ¨¡å‹å®¹é‡"><a href="#æ¨¡å‹å®¹é‡" class="headerlink" title="æ¨¡å‹å®¹é‡"></a>æ¨¡å‹å®¹é‡</h3><p>ä¸‹é¢çš„Table2è¯´æ˜äº†Figure1å·¦å³ä¸¤ä¸ªç»“æ„å³ResNetç»“æ„å’ŒResNeXtç»“æ„çš„å‚æ•°é‡å·®ä¸å¤šï¼Œå…¶ä¸­ç¬¬äºŒè¡Œçš„$d$è¡¨ç¤ºæ¯ä¸ªè·¯å¾„çš„ä¸­é—´channelæ•°é‡ï¼Œè€Œç¬¬ä¸‰è¡Œä»£è¡¨æ•´ä¸ªæ¨¡å—çš„å®½åº¦ï¼Œæ˜¯ç¬¬ä¸€è¡Œ$C$å’Œç¬¬äºŒè¡Œ$d$çš„ä¹˜ç§¯ã€‚å…³äºè¿™ä¸¤ä¸ªæ¨¡å‹å®¹é‡ä¹Ÿå°±æ˜¯FLOPsçš„è®¡ç®—å¦‚å…¬å¼(4)ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/646.png" alt></p>
<p>FLOPsè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°FLOPsåŸºæœ¬ç›¸ç­‰ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/647.webp" alt></p>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>åœ¨å®éªŒä¸­ResNeXtç›¸æ¯”äºResNetåŒºåˆ«ä»…ä»…æ˜¯å…¶ä¸­çš„blockï¼Œå…¶ä»–éƒ½ä¸å˜ï¼Œä½œè€…çš„å®éªŒç»“æœå¦‚Figure5æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ç›¸åŒå±‚æ•°çš„ResNetå’ŒResNeXtçš„å¯¹æ¯”ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/648.webp" alt></p>
<p>å…¶ä¸­ï¼Œ32 x 4dè¡¨ç¤ºçš„æ˜¯æœ‰32ä¸ªç›¸åŒçš„è·¯å¾„ï¼Œç„¶åæ¯ä¸ªè·¯å¾„çš„å®½åº¦éƒ½ä¸º4ï¼Œå³å¦‚Figure3å±•ç¤ºçš„é‚£æ ·ã€‚å¯ä»¥çœ‹åˆ°ResNeXtå’ŒResNetçš„å‚æ•°å¤æ‚åº¦å·®ä¸å¤šï¼Œä½†æ˜¯å…¶è®­ç»ƒè¯¯å·®å’Œæµ‹è¯•è¯¯å·®éƒ½é™ä½äº†ã€‚</p>
<p>ResNetå’ŒResNeXtåœ¨ImageNetä¸Šçš„å¯¹æ¯”ç»“æœå¦‚Table3æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/649.jpg" alt></p>
<p>å¦å¤–ä¸€ä¸ªé‡è¦çš„å®éªŒç»“æœå¦‚Table4æ‰€ç¤ºï¼Œä¸»è¦è¯´æ˜äº†å¢åŠ åŸºæ•°/åˆ†ç»„æ•°å’Œå¢åŠ å®½åº¦å’Œæ·±åº¦çš„åŒºåˆ«ã€‚ç¬¬ä¸€ä¸ªæ˜¯åŸºå‡†æ¨¡å‹ï¼Œå¢åŠ æ·±åº¦å’Œå®½åº¦åˆ†åˆ«æ˜¯ç¬¬ä¸‰ï¼Œç¬¬å››ä¸ªï¼Œå¯ä»¥çœ‹åˆ°Top1è¯¯å·®åˆ†åˆ«é™ä½äº†0.3%å’Œ0.7%ã€‚åŒæ—¶ç¬¬äº”ä¸ªåŠ å€äº†åˆ†ç»„æ•°Top1è¯¯å·®é™ä½äº†1.3%ï¼Œç¬¬å…­ä¸ªåˆ™æŠŠåˆ†ç»„æ•°åŠ åˆ°äº†64ï¼ŒTop1è¯¯å·®é™ä½äº†1.6ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå¢åŠ åˆ†ç»„æ•°æ¯”å¢åŠ æ·±åº¦æˆ–å®½åº¦ä¼šæ›´åŠ æœ‰æ•ˆã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ResNeXt/650.webp" alt></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ResNeXtè¿™ç¯‡è®ºæ–‡æå‡ºäº†ä½¿ç”¨ä¸€ç§å¹³è¡Œå †å ç›¸åŒæ‹“æ‰‘ç»“æ„çš„æ®‹å·®æ¨¡å—æ¥ä»£æ›¿åŸå§‹çš„æ®‹å·®æ¨¡å—ï¼Œåœ¨ä¸æ˜æ˜¾å¢åŠ å‚æ•°é‡çš„åŒæ—¶æå‡äº†æ¨¡å‹çš„å‡†ç¡®ç‡ï¼ŒåŒæ—¶ç”±äºæ‹“æ‰‘ç»“æ„ç›¸åŒï¼Œéœ€è¦è‡ªå·±è°ƒçš„è¶…å‚æ•°ä¹Ÿå‡å°‘å› æ­¤æ›´ä¾¿äºæ¨¡å‹çš„æ‰©å±•å’Œç§»å€¼ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸éœ€è¦é¢„è®­ç»ƒæ¨¡å‹çš„ç›®æ ‡æ£€æµ‹ç®—æ³•DSOD</title>
    <url>/2020/04/10/%E4%B8%8D%E9%9C%80%E8%A6%81%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95DSOD/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>DSOD(Deeply Supervised Object Detectors)æ˜¯ICCV  2017çš„ä¸€ç¯‡æ–‡ç« ï¼Œå®ƒè¡¨è¾¾äº†ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„ä¸œè¥¿ã€‚è¿™ç¯‡è®ºæ–‡ä¸æ˜¯ä»ç›®æ ‡æ£€æµ‹çš„é«˜mAPå€¼æˆ–è€…é€Ÿåº¦æ›´å¿«å‡ºå‘ï¼Œè€Œæ˜¯ä»å¦å¤–ä¸€ä¸ªè§’åº¦åˆ‡å…¥æ¥è¯´æ˜fine-tuneåçš„æ£€æµ‹æ¨¡å‹å’Œç›´æ¥è®­ç»ƒçš„æ£€æµ‹æ¨¡å‹çš„å·®è·å…¶å®æ˜¯å¯ä»¥å‡å°‘çš„ï¼Œä¹Ÿå³æ˜¯è¯´ä¸€äº›æ£€æµ‹æ¨¡å‹å¯ä»¥æ‘†è„±fine-tuneè¿™ä¸€è¿‡ç¨‹ï¼Œå¹¶ä¸”ç›¸æ¯”äºfine-tuneè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹æ•ˆæœå¹¶ä¸ä¼šå˜å·®ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>DSODè¿™ä¸€ç®—æ³•æ˜¯åœ¨SSDçš„åŸºç¡€ä¸Šè¿›è¡Œçš„æ”¹è¿›ï¼Œå¯ä»¥ç®€å•çš„çœ‹æˆï¼š</p>
<p><strong>DSOD=SSD+DenseNet</strong></p>
<p>ä½œè€…åœ¨è®ºæ–‡ä¸­æåˆ°ä»–ä¹Ÿå®éªŒäº†ä»0å¼€å§‹è®­ç»ƒ<strong>Region Proposal Based</strong>çš„æ£€æµ‹ç®—æ³•æ¯”å¦‚Faster RCNNï¼ŒR-FCNç­‰ï¼Œä½†è¿™äº›æ¨¡å‹å¾ˆéš¾æ”¶æ•›ã€‚è€ŒOne-Stageçš„ç›®æ ‡æ£€æµ‹ç®—æ³•æ¯”å¦‚SSDå´å¯ä»¥æ”¶æ•›ï¼Œè™½ç„¶æ•ˆæœå¾ˆä¸€èˆ¬ï¼Œå› æ­¤æœ€åä½œè€…ä½¿ç”¨SSDä½œä¸ºäº†è¿™ç¯‡è®ºæ–‡æ¥ä¸‹æ¥è®¨è®ºçš„BaseLineã€‚</p>
<p>ç„¶åæœ¬æ–‡åŸºäºSSDæ”¹è¿›çš„DSODåœ¨VOC2007 trainvalå’Œ2012 trainvalæ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œç„¶ååœ¨VOC2007  testsetä¸Šæµ‹è¯•çš„è¡¨ç°(77.7%mAP)è¶…è¿‡äº†ä½¿ç”¨fine-tuneç­–ç•¥çš„SSD300Sï¼ˆ69.6%mAPï¼‰å’ŒSSD300ï¼ˆ75.8mAPï¼‰ï¼ŒåŸæ–‡æ˜¯è¿™æ ·æè¿°çš„ã€‚</p>
<blockquote>
<p>Our DSOD300 achieves 77.7% mAP, which is much better than the SSD300S  that is trained from scratch using VGG16 (69.6%) without deep  supervision. It is also much better than the fine-tuned results by  SSD300 (75.8%)</p>
</blockquote>
<h2 id="å‡ºå‘ç‚¹"><a href="#å‡ºå‘ç‚¹" class="headerlink" title="å‡ºå‘ç‚¹"></a>å‡ºå‘ç‚¹</h2><p>è¿™ç¯‡æ–‡ç« çš„å‡ºå‘ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½œè€…è®¤ä¸ºå‡ ä¹çš„æ‰€æœ‰æ£€æµ‹ç½‘ç»œéƒ½åœ¨ä½¿ç”¨fine-tuneè¿™ä¸€æŠ€å·§ï¼Œé‚£ä¹ˆä¸€å®šè¦ç”¨fine-tuneå—ï¼Ÿä½œè€…åˆ—å‡ºæ¥äº†3ä¸ªåŸå› æ¥å°è¯•è¯´æ˜fine-tuneä¸æ˜¯å¿…é¡»çš„ã€‚åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¢„è®­ç»ƒçš„æ¨¡å‹ä¸€èˆ¬æ˜¯åœ¨åˆ†ç±»å›¾åƒæ•°æ®é›†æ¯”å¦‚Imagenetä¸Šè®­ç»ƒçš„ï¼Œä¸ä¸€å®šå¯ä»¥è¿ç§»åˆ°æ£€æµ‹æ¨¡å‹çš„æ•°æ®ä¸Šï¼ˆæ¯”å¦‚åŒ»å­¦å›¾åƒï¼‰ã€‚</li>
<li>é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œå…¶ç»“æ„éƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤å¦‚æœæƒ³è¦å†ä¿®æ”¹çš„è¯æ¯”è¾ƒéº»çƒ¦ã€‚</li>
<li>é¢„è®­ç»ƒçš„åˆ†ç±»ç½‘ç»œçš„è®­ç»ƒç›®æ ‡ä¸€èˆ¬å’Œæ£€æµ‹ç›®æ ‡ä¸ä¸€è‡´ï¼Œå› æ­¤é¢„è®­ç»ƒçš„æ¨¡å‹å¯¹äºæ£€æµ‹ç®—æ³•è€Œè¨€ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚</li>
</ul>
<p>åŸºäºä¸Šé¢è¿™å‡ ç‚¹åŸå› ï¼Œè®ºæ–‡æå‡ºäº†ä¸€ä¸ªä»0å¼€å§‹çš„æ£€æµ‹æ¨¡å‹DSODï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆè®¾è®¡çš„å§ã€‚</p>
<h2 id="DSODç½‘ç»œç»“æ„"><a href="#DSODç½‘ç»œç»“æ„" class="headerlink" title="DSODç½‘ç»œç»“æ„"></a>DSODç½‘ç»œç»“æ„</h2><p>ä¸‹é¢çš„Figure1åˆ†åˆ«å±•ç¤ºäº†SSDçš„æ•´ä½“ç»“æ„å’ŒDSODçš„æ•´ä½“ç»“æ„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSOD/640.webp" alt></p>
<p>Figure1å·¦å›¾çš„<code>plain connection</code>è¡¨ç¤ºSSDç½‘ç»œä¸­çš„ç‰¹å¾èåˆæ“ä½œï¼Œè¿™é‡Œå¯¹äºçš„è¾“å…¥300 x 300å›¾åƒæ¥è¯´ï¼Œä¸€å…±èåˆäº†6ç§ä¸åŒscaleçš„ç‰¹å¾ã€‚åœ¨æ¯ä¸ªè™šçº¿çŸ©å½¢æ¡†å†…éƒ½æœ‰ä¸€ä¸ª1 x 1çš„å·ç§¯å’Œä¸€ä¸ª3 x 3çš„å·ç§¯æ“ä½œï¼Œè¿™ä¹Ÿå¯ä»¥è¢«å«ä½œBottleNeckï¼Œä¹Ÿå°±æ˜¯1 x 1å·ç§¯ä¸»è¦èµ·åˆ°é™ç»´ä»è€Œé™ä½3 x 3å·ç§¯è®¡ç®—é‡çš„ä½œç”¨ã€‚</p>
<p>Figure1å³å›¾çš„<code>dense connection</code>è¡¨ç¤ºæœ¬æ–‡çš„DSODå¼•å…¥äº†DenseNetçš„æ€æƒ³ã€‚<code>dense connection</code>å·¦è¾¹çš„è™šçº¿æ¡†éƒ¨åˆ†å’Œ<code>plain connection</code>å³è¾¹çš„è™šçº¿æ¡†éƒ¨åˆ†ç»“æ„ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºé‡Œé¢çš„<code>channel</code>ä¸ªæ•°ï¼Œ<code>dense connection</code>ä¸­3 x 3å·ç§¯çš„<code>channel</code>ä¸ªæ•°æ˜¯<code>plain connection</code>ä¸­3 x 3å·ç§¯çš„ä¸€åŠã€‚ä¸»è¦æ˜¯å› ä¸ºåœ¨<code>plain connection</code>ä¸­æ¯ä¸ªBottleNeckçš„è¾“å…¥æ˜¯å‰é¢ä¸€ä¸ªBottleNeckçš„è¾“å‡ºï¼Œè€Œåœ¨<code>dense connection</code>ä¸­ï¼Œ<strong>æ¯ä¸ªbottleneckçš„è¾“å…¥æ˜¯å‰é¢æ‰€æœ‰bottleneckçš„è¾“å‡ºçš„concate</strong>ï¼Œæ‰€ä»¥ä¸ºäº†é™ä½è®¡ç®—é‡å‡å°‘äº†é€šé“æ•°ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>dense connection</code>éƒ¨åˆ†å³è¾¹çš„çŸ©å½¢æ¡†æ˜¯ä¸‹é‡‡æ ·æ¨¡å—ï¼ŒåŒ…å«ä¸€ä¸ª2 x 2çš„æœ€å¤§æ± åŒ–å±‚ï¼ˆé™é‡‡æ ·ä½œç”¨ï¼‰å’Œä¸€ä¸ªçš„1 x 1å·ç§¯å±‚ï¼ˆé™ä½<code>channel</code>ä¸ªæ•°çš„ä½œç”¨ï¼‰ï¼Œä½œè€…ä¹Ÿæåˆ°å…ˆè¿›è¡Œé™é‡‡æ ·å†è¿›è¡Œ1 x 1å·ç§¯å¯ä»¥è¿›ä¸€æ­¥å‡å°‘è®¡ç®—é‡ã€‚</p>
<p>å› æ­¤å¯ä»¥çœ‹å‡ºDSODå³æ˜¯<strong>SSD+DenseNet</strong>çš„ç»“æœã€‚</p>
<p>DSODæ˜¯åœ¨SSDçš„åŸºç¡€ä¸Šå‘å±•è€Œæ¥çš„ï¼ŒDSODçš„ä¸åŒåœ¨äºï¼Œä¸ç®¡æ˜¯åœ¨backbongè¿˜æ˜¯headéƒ¨åˆ†ï¼ŒDSODéƒ½å€Ÿé‰´äº†DenseNetçš„è®¾è®¡æ€æƒ³ã€‚</p>
<p>DSOD ç½‘ç»œåˆ†ä¸¤ä¸ªéƒ¨åˆ†ï¼šç”¨äºç‰¹å¾æå–çš„backboneï¼Œç”¨äºç›®æ ‡é¢„æµ‹çš„front-endã€‚backboneå­ç½‘ç»œç±»ä¼¼äºDenseNetsï¼ŒåŒ…å«Stem blockï¼Œ4ä¸ªdense blockï¼Œ2ä¸ªè¿‡æ¸¡å±‚ï¼Œ2ä¸ªæ— æ± åŒ–å±‚çš„è¿‡æ¸¡å±‚ã€‚front-endå­ç½‘ç»œä½¿ç”¨è‡´å¯†çš„ç»“æ„èåˆå¤šå°ºåº¦é¢„æµ‹å“åº”ã€‚å…¶ä¸­Dense Blockå°±æ˜¯DenseNetç½‘ç»œçš„å­æ¨¡å—ï¼Œç„¶å<code>stem block</code>ç”±3 x 3å·ç§¯å’Œ2 x 2æ± åŒ–ç»„æˆï¼Œåé¢å®éªŒè¯æ˜äº†è¿™ä¸ª<code>stem block</code>å¯ä»¥æé«˜mAPå€¼ã€‚ä¸‹é¢çš„Table1è¯¦ç»†å±•ç¤ºäº†DSOSç½‘ç»œçš„ç»“æ„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSOD/641.jpg" alt></p>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>ä¸‹é¢çš„Table3å±•ç¤ºäº†åœ¨VOC2007 testsetä¸Šä¸åŒå‚æ•°çš„å®éªŒç»“æœã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSOD/642.webp" alt></p>
<p>ç¬¬3ï¼Œ4è¡Œçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºBottleNeckçš„channelä¸ªæ•°è¶Šå¤šï¼ŒmAPç›¸å¯¹è¶Šé«˜ã€‚ç¬¬5ã€6è¡Œçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºgrowth rateä»16å˜æˆ48ï¼Œå¯ä»¥æé«˜4.8%çš„mAPã€‚ç¬¬6ï¼Œ9è¡Œçš„å¯¹æ¯”å¯ä»¥çœ‹å‡ºstem blockçš„å­˜åœ¨å¯ä»¥æé«˜2.8%çš„mAPã€‚</p>
<p>ä¸‹é¢çš„Table4åˆ™å±•ç¤ºäº†æ›´ä¸°å¯Œçš„ç»“æœã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSOD/643.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºSSDåœ¨æ²¡æœ‰é¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯å¯ä»¥æ”¶æ•›çš„ï¼Œä¸è¿‡æ•ˆæœä¸€èˆ¬ã€‚ä½†å¦‚æœä½¿ç”¨æœ¬æ–‡çš„DSODåˆ™å¯ä»¥è¾¾åˆ°ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœï¼Œå¹¶ä¸”ç»“æœè¿˜åå¥½ä¸€ç‚¹ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>DSODæ˜¯åœ¨SSDçš„åŸºç¡€ä¸Šç»“åˆäº†DenseNetçš„æ€æƒ³ï¼Œä½¿å¾—ç½‘ç»œå¯ä»¥åœ¨ä¸ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„æ¡ä»¶ä¸‹æ”¶æ•›å¾—å’Œä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„BaseLineæ¨¡å‹ä¸€æ ·å¥½ï¼Œå¦å¤–DenseNetçš„å¼•å…¥ä¹Ÿä½¿å¾—ç›¸æ¯”SSDæ¥è¯´DSODçš„å‚æ•°æ•°é‡å¤§å¤§å‡å°‘ï¼Œæ³¨æ„å‚æ•°é‡ä¸ç­‰äºæ¨ç†é€Ÿåº¦ä¼šå˜å¿«ã€‚å¦‚æœä¸“æ³¨äºç‰¹æ®Šå›¾åƒæ£€æµ‹æˆ–è€…éš¾ä»¥æå®šé¢„è®­ç»ƒæ¨¡å‹çš„åœºæ™¯è¿™ç¯‡æ–‡ç« çš„æ€æƒ³æ˜¯å€¼å¾—å€Ÿé‰´çš„ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>FPN</title>
    <url>/2020/03/02/FPN/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>Faster-RCNNé€‰å–ä¸€ä¸ªç‰¹å¾æå–ç½‘ç»œå¦‚VGG16åšbackboneï¼Œç„¶ååœ¨é«˜å±‚ç‰¹å¾ï¼ˆå¦‚VGG16åé¢çš„conv4ï¼‰æ¥RPNå’Œæ£€æµ‹å¤´è¿›è¡Œç½‘ç»œã€‚æ­£æ˜¯ç”±äºFaster-RCNNåŸºäºå›¾åƒçš„é«˜çº§ç‰¹å¾ï¼Œè¿™å°±å¯¼è‡´å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœå¾ˆå·®ã€‚è€ŒCVé¢†åŸŸå¸¸ç”¨çš„å¤„ç†å°ºåº¦é—®é¢˜çš„åŠæ³•å°±æ˜¯ç‰¹å¾é‡‘å­—å¡”ï¼Œå°†åŸå›¾ä»¥ä¸åŒçš„æ¯”ä¾‹é‡‡æ ·ï¼Œç„¶åå¾—åˆ°ä¸åŒåˆ†è¾¨ç‡çš„å›¾åƒè¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ç¡®å®æ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ç‰¹å¾é‡‘å­—å¡”çš„æ—¶é—´å¼€é”€éå¸¸å¤§ï¼Œå¯¼è‡´åœ¨å·¥ç¨‹ä¸­åº”ç”¨æ˜¯åŠå…¶å›°éš¾ã€‚FPNä»æ–°çš„è§’åº¦å‡ºå‘æå‡ºäº†ä¸€ä¸ªç‹¬ç‰¹çš„ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œæ¥é¿å…å›¾åƒé‡‘å­—å¡”äº§ç”Ÿçš„è¶…é«˜è®¡ç®—é‡ï¼ŒåŒæ—¶å¯ä»¥è¾ƒå¥½çš„å¤„ç†ç›®æ ‡æ£€æµ‹ä¸­çš„å°ºåº¦å˜åŒ–é—®é¢˜ï¼Œå¯¹å°ç›®æ ‡æ£€æµ‹æ›´é²æ£’ï¼ŒåŒæ—¶åœ¨VOCå’ŒCOCOæ•°æ®é›†ä¸ŠMAPå€¼å‡è¶…è¿‡äº†Faster-RCNNã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä½¿ç”¨ä¸‹å›¾æ¥é˜é‡Šæ˜¯å¦‚ä½•å¤„ç†å°ºåº¦å˜åŒ–å¤§çš„ç‰©ä½“æ£€æµ‹çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/640.webp" alt></p>
<ul>
<li>ä¸Šå›¾(a)æ˜¯å¤„ç†è¿™ç±»é—®é¢˜æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå³ç‰¹å¾é‡‘å­—å¡”ï¼Œè¿™ç§æ–¹æ³•åœ¨ä¼ ç»Ÿçš„æ‰‹åŠ¨è®¾è®¡ç‰¹å¾çš„æ–¹æ³•ä¸­éå¸¸å¸¸ç”¨ï¼Œä¾‹å¦‚DPMæ–¹æ³•ä½¿ç”¨äº†æ¥è¿‘10ç§ä¸åŒçš„å°ºåº¦è·å¾—äº†ä¸é”™çš„æ•ˆæœã€‚</li>
<li>ä¸Šå›¾(b)æ˜¯åœ¨CNNæå‡ºä¹‹åå‡ºç°çš„ï¼Œå› ä¸ºç¥ç»ç½‘ç»œæ¨¡å‹å¯¹ç‰©ä½“å°ºåº¦æœ¬èº«æœ‰ä¸€å®šçš„é²æ£’æ€§ï¼Œæ‰€ä»¥ä¹Ÿå–å¾—äº†ä¸é”™çš„æ€§èƒ½ï¼Œä½†æœ€è¿‘çš„ç ”ç©¶è¡¨æ˜å°†ç‰¹å¾é‡‘å­—å¡”å’ŒCNNç»“åˆä»å¯ä»¥æå‡æ€§èƒ½ï¼Œè¿™è¯´æ˜åŸºäºå•å±‚ç‰¹å¾çš„æ£€æµ‹ç³»ç»Ÿä»å­˜åœ¨å¯¹å°ºåº¦å˜åŒ–æ•æ„Ÿçš„ç¼ºç‚¹ã€‚</li>
<li>ä¸Šå›¾(c)è¡¨ç¤ºé™¤äº†ä½¿ç”¨å›¾åƒé‡‘å­—å¡”ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ æœ¬èº«çš„å¤šå±‚æ¬¡ç»“æ„æ¥æå–å¤šå°ºåº¦ç‰¹å¾ã€‚æœ€å¸¸è§çš„å°±æ˜¯SSDç®—æ³•ä¸­åˆ©ç”¨å¤šä¸ªç‰¹å¾å±‚æ¥åˆ†åˆ«åšé¢„æµ‹ã€‚ä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹å°±æ˜¯æµ…å±‚çš„è¯­ä¹‰ç‰¹å¾æ¯”è¾ƒå¼±ï¼Œåœ¨å¤„ç†å°ç‰©ä½“æ—¶è¡¨ç°å¾—ä¸å¤Ÿå¥½ã€‚</li>
<li>ä¸Šå›¾(d)è¡¨ç¤ºæœ¬æ–‡æå‡ºçš„FPNï¼ˆFeature Pyramid Network ï¼‰ï¼Œå®ƒèƒ½è¾ƒå¥½çš„è®©å„ä¸ªä¸åŒå°ºåº¦çš„ç‰¹å¾éƒ½å…·æœ‰è¾ƒå¼ºçš„è¯­ä¹‰ä¿¡æ¯ã€‚FPNç»“åˆFaster  RCNNå¯ä»¥åœ¨COCOç‰©ä½“æ£€æµ‹æ¯”èµ›ä¸­å–å¾—å½“å‰å•æ¨¡å‹çš„æœ€ä½³æ€§èƒ½ï¼ˆSOTAï¼‰ã€‚å¦å¤–ï¼Œé€šè¿‡å¯¹æ¯”å®éªŒå‘ç°ï¼ŒFPNèƒ½è®©Faster  RCNNä¸­çš„RPNç½‘ç»œçš„å¬å›ç‡æé«˜8ä¸ªç‚¹ï¼›å¹¶ä¸”å®ƒä¹Ÿèƒ½ä½¿Fast RCNNçš„æ£€æµ‹æ€§èƒ½æå‡2.3ä¸ªç‚¹ï¼ˆCOCOï¼‰å’Œ3.8ä¸ªç‚¹ï¼ˆVOCï¼‰ã€‚</li>
</ul>
<h2 id="FPNç»“æ„"><a href="#FPNç»“æ„" class="headerlink" title="FPNç»“æ„"></a>FPNç»“æ„</h2><p>ä¸‹å›¾è¡¨ç¤ºFPNçš„æ•´ä½“ç»“æ„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/641.webp" alt></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°FPNçš„æ•´ä½“ç»“æ„åˆ†ä¸º<strong>è‡ªåº•å‘ä¸Š</strong>å’Œ<strong>è‡ªé¡¶å‘ä¸‹å’Œä¾§å‘è¿æ¥</strong>çš„è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ã€‚</p>
<h3 id="è‡ªåº•å‘ä¸Š"><a href="#è‡ªåº•å‘ä¸Š" class="headerlink" title="è‡ªåº•å‘ä¸Š"></a>è‡ªåº•å‘ä¸Š</h3><p>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯æ™®é€šçš„ç‰¹å¾æå–ç½‘ç»œï¼Œç‰¹å¾åˆ†è¾¨ç‡ä¸æ–­ç¼©å°ï¼Œå®¹æ˜“æƒ³åˆ°è¿™ä¸ªç‰¹å¾æå–ç½‘ç»œå¯ä»¥æ¢æˆä»»æ„Backboneï¼Œå¹¶ä¸”CNNç½‘ç»œä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§ç‰¹å¾å›¾å¤§å°åˆ†ä¸ºä¸åŒçš„stageï¼Œæ¯ä¸ªstageçš„ç‰¹å¾å›¾é•¿å®½å·®è·ä¸º2å€ã€‚åœ¨è¿™ä¸ªè‡ªåº•å‘ä¸Šçš„ç»“æ„ä¸­ï¼Œä¸€ä¸ªstageå¯¹åº”ç‰¹å¾é‡‘å­—å¡”çš„ä¸€ä¸ªlevelã€‚ä»¥æˆ‘ä»¬è¦ç”¨çš„ResNetä¸ºä¾‹ï¼Œé€‰å–conv2ã€conv3ã€conv4ã€conv5å±‚çš„æœ€åä¸€ä¸ªæ®‹å·®blockå±‚ç‰¹å¾ä½œä¸ºFPNçš„ç‰¹å¾ï¼Œè®°ä¸º{C2ã€C3ã€C4ã€C5}ï¼Œä¹Ÿå³æ˜¯FPNç½‘ç»œçš„4ä¸ªçº§åˆ«ã€‚è¿™å‡ ä¸ªç‰¹å¾å±‚ç›¸å¯¹äºåŸå›¾çš„æ­¥é•¿åˆ†åˆ«ä¸º4ã€8ã€16ã€32ã€‚</p>
<h3 id="è‡ªä¸Šå‘ä¸‹å’Œä¾§å‘è¿æ¥"><a href="#è‡ªä¸Šå‘ä¸‹å’Œä¾§å‘è¿æ¥" class="headerlink" title="è‡ªä¸Šå‘ä¸‹å’Œä¾§å‘è¿æ¥"></a>è‡ªä¸Šå‘ä¸‹å’Œä¾§å‘è¿æ¥</h3><p>è‡ªä¸Šå‘ä¸‹æ˜¯ç‰¹å¾å›¾æ”¾å¤§çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ä¸Šé‡‡æ ·æ¥å®ç°ã€‚FPNçš„å·§å¦™ä¹‹å¤„å°±åœ¨äºä»é«˜å±‚ç‰¹å¾ä¸Šé‡‡æ ·æ—¢å¯ä»¥åˆ©ç”¨é¡¶å±‚çš„é«˜çº§è¯­ä¹‰ç‰¹å¾ï¼ˆæœ‰åŠ©äºåˆ†ç±»ï¼‰åˆå¯ä»¥åˆ©ç”¨åº•å±‚çš„é«˜åˆ†è¾¨ç‡ä¿¡æ¯ï¼ˆæœ‰åŠ©äºå®šä½ï¼‰ã€‚ä¸Šé‡‡æ ·å¯ä»¥ä½¿ç”¨æ’å€¼çš„æ–¹å¼å®ç°ã€‚ä¸ºäº†å°†é«˜å±‚è¯­ä¹‰ç‰¹å¾å’Œåº•å±‚çš„ç²¾ç¡®å®šä½èƒ½åŠ›ç»“åˆï¼Œè®ºæ–‡æå‡ºäº†ç±»ä¼¼äºæ®‹å·®ç»“æ„çš„ä¾§å‘è¿æ¥ã€‚è¿æ¥å°†ä¸Šä¸€å±‚ç»è¿‡ä¸Šé‡‡æ ·åå’Œå½“å‰å±‚åˆ†è¾¨ç‡ä¸€è‡´çš„ç‰¹å¾ï¼Œé€šè¿‡ç›¸åŠ çš„æ–¹æ³•è¿›è¡Œèåˆã€‚åŒæ—¶ä¸ºäº†ä¿æŒæ‰€æœ‰çº§åˆ«çš„ç‰¹å¾å±‚é€šé“æ•°éƒ½ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œä½¿ç”¨1*1å·ç§¯æ¥å®ç°ã€‚åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€å¼ å›¾ï¼Œæ¯”è¾ƒå¥½çš„è§£é‡Šäº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/642.webp" alt></p>
<p>FPNåªæ˜¯ä¸€ä¸ªç‰¹å¾é‡‘å­—å¡”ç»“æ„ï¼Œéœ€è¦é…åˆå…¶ä»–ç›®æ ‡æ£€æµ‹ç®—æ³•æ‰èƒ½ä½¿ç”¨ã€‚</p>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><h3 id="1-FPNå¯¹RPNç½‘ç»œçš„å½±å“"><a href="#1-FPNå¯¹RPNç½‘ç»œçš„å½±å“" class="headerlink" title="1.FPNå¯¹RPNç½‘ç»œçš„å½±å“"></a>1.FPNå¯¹RPNç½‘ç»œçš„å½±å“</h3><p>å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œè®ºæ–‡åšäº†6ä¸ªå®éªŒã€‚</p>
<ul>
<li>(a)åŸºäºconv4çš„RPNï¼ŒåŸå§‹çš„RPNã€‚</li>
<li>(b)åŸºäºconv5çš„RPNã€‚</li>
<li>(c) å®Œæ•´FPNã€‚</li>
<li>(d)åªç”¨äº†è‡ªåº•å‘ä¸Šçš„å¤šå±‚ç‰¹å¾ï¼Œæ²¡æœ‰è‡ªé¡¶å‘ä¸‹çš„ç‰¹å¾ã€‚</li>
<li>(e)ç”¨äº†è‡ªé¡¶å‘ä¸‹çš„ç‰¹å¾ï¼Œä½†ä¸ç”¨ä¾§å‘è¿æ¥ã€‚</li>
<li>(f)ç”¨äº†è‡ªé¡¶å‘ä¸‹çš„ç‰¹å¾ï¼Œä¹Ÿç”¨äº†æ¨ªå‘ç‰¹å¾èåˆï¼Œä½†åªç”¨æœ€åçš„P2åšé¢„æµ‹ã€‚ï¼ˆå®Œæ•´çš„é¢„æµ‹æ˜¯ä½¿ç”¨æ¯ä¸€ä¸ªlevelçš„ç‰¹å¾$P_{k}$åšé¢„æµ‹ï¼‰</li>
</ul>
<p>åˆ†æè¡¨æ ¼å¯çŸ¥ï¼Œè‡ªé¡¶å‘ä¸‹çš„ç‰¹å¾ã€æ¨ªå‘è¿æ¥ã€å°ºåº¦åˆ†ç¦»ã€å¤šä¸ªå±‚æ¬¡çš„é¢„æµ‹æ˜¯æå‡FPNæ€§èƒ½çš„å…³é”®ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/643.webp" alt></p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæ”¾ä¸€å¼ Faster-RCNNç»“åˆFPNçš„ç»†è‡´ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/644.webp" alt></p>
<h2 id="2-FPNå¯¹Fast-RCNNçš„å½±å“"><a href="#2-FPNå¯¹Fast-RCNNçš„å½±å“" class="headerlink" title="2.FPNå¯¹Fast RCNNçš„å½±å“"></a>2.FPNå¯¹Fast RCNNçš„å½±å“</h2><p>ä½¿ç”¨å’Œå®éªŒ1ç›¸åŒçš„è§„åˆ™å¯¹Fast RCNNåšäº†å®éªŒï¼Œç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN2/645.png" alt></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æœ¬æ–‡æå‡ºäº†ä¸€ç§ç®€å•ã€æœ‰æ•ˆçš„å»ºç«‹ç‰¹å¾é‡‘å­—å¡”çš„æ–¹å¼ã€‚å®ƒçš„ä½¿ç”¨å¯¹RPNæ–¹æ³•å’ŒFast/Faster RCNNæ–¹æ³•éƒ½æœ‰æå¤§çš„æ€§èƒ½æå‡ã€‚å¦å¤–ï¼Œå®ƒçš„è®­ç»ƒå’Œæµ‹è¯•æ—¶é—´å’Œæ™®é€šçš„Faster RCNNæ–¹æ³•ç›¸å·®å¾ˆå°ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥ä½œä¸ºå›¾åƒç‰¹å¾é‡‘å­—å¡”çš„ä¸€ç§è¾ƒå¥½çš„æ›¿ä»£ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Feature Pyramid Network</title>
    <url>/2020/04/20/Feature-Pyramid-Network/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>FPNå…¨ç§°æ˜¯Feature Pyramid Network,  ä¹Ÿå°±æ˜¯ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼Œä¸»è¦æ˜¯é’ˆå¯¹å›¾åƒä¸­ç›®æ ‡çš„å¤šå°ºåº¦çš„è¿™ä¸ªç‰¹ç‚¹æå‡ºçš„ï¼Œå¤šå°ºåº¦åœ¨ç›®æ ‡æ£€æµ‹ä¸­éå¸¸å¸¸è§ï¼Œè€Œä¸”å¯¹åº”ä¸åŒçš„é—®é¢˜åº”è¯¥è®¾è®¡ä¸åŒçš„FPNã€‚FPNæ˜¯Facebookäº2017å¹´æå‡ºçš„ç”¨äºç›®æ ‡æ£€æµ‹çš„æ¨¡å—åŒ–ç»“æ„ï¼Œä½†FPNåœ¨å¾ˆå¤šè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­éƒ½æœ‰ä½¿ç”¨ï¼Œæ¯”å¦‚å§¿æ€ä¼°è®¡ã€è¯­ä¹‰åˆ†å‰²ç­‰é¢†åŸŸã€‚</p>
<h2 id="FPN"><a href="#FPN" class="headerlink" title="FPN"></a>FPN</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/640.webp" alt></p>
<p>åœ¨æ·±åº¦å­¦ä¹ å…´èµ·ä»¥å‰ï¼Œå¾ˆå¤šä¼ ç»Ÿæ–¹æ³•éƒ½ä¼šä½¿ç”¨åˆ°<strong>å›¾åƒé‡‘å­—å¡”</strong>ã€‚å›¾åƒé‡‘å­—å¡”å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå°±æ˜¯å°†å›¾ç‰‡resizeåˆ°ä¸åŒçš„å¤§å°ï¼Œç„¶ååˆ†åˆ«å¾—åˆ°å¯¹åº”å¤§å°çš„ç‰¹å¾ï¼Œç„¶åè¿›è¡Œé¢„æµ‹ã€‚è¿™ç§æ–¹æ³•è™½ç„¶å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³å¤šå°ºåº¦çš„é—®é¢˜ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œå¸¦æ¥çš„è®¡ç®—é‡ä¹Ÿéå¸¸å¤§ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/641.webp" alt></p>
<p>ä¸Šå›¾æ˜¯ä½¿ç”¨å•ä¸ªfeature mapè¿›è¡Œæ£€æµ‹ï¼Œè¿™ç§ç»“æ„åœ¨17å¹´çš„æ—¶å€™æ˜¯å¾ˆå¤šäººåœ¨ä½¿ç”¨çš„ç»“æ„ï¼Œæ¯”å¦‚YOLOv1ã€YOLOv2ã€Faster  R-CNNä¸­ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ¶æ„ã€‚ç›´æ¥ä½¿ç”¨è¿™ç§æ¶æ„å¯¼è‡´é¢„æµ‹å±‚çš„ç‰¹å¾å°ºåº¦æ¯”è¾ƒå•ä¸€ï¼Œå¯¹å°ç›®æ ‡æ£€æµ‹æ•ˆæœæ¯”è¾ƒå·®ã€‚ps:  YOLOv2ä¸­ä½¿ç”¨äº†multi-scale trainingçš„æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†å°ºåº¦å•ä¸€çš„é—®é¢˜ï¼Œèƒ½å¤Ÿè®©æ¨¡å‹é€‚åº”æ›´å¤šè¾“å…¥å°ºåº¦ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/642.webp" alt></p>
<p>ä¸Šå›¾è¿›è¡Œäº†åœ¨ä¸åŒå¤§å°çš„feature mapä¸Šåˆ†åˆ«è¿›è¡Œé¢„æµ‹ï¼Œå…·æœ‰äº†å¤šå°ºåº¦é¢„æµ‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´æ²¡æœ‰èåˆï¼Œéµä»è¿™ç§æ¶æ„çš„ç»å…¸çš„ç›®æ ‡æ£€æµ‹æ¶æ„å°±æ˜¯SSD, SSDç”¨äº†éå¸¸å¤šçš„å°ºåº¦æ¥è¿›è¡Œæ£€æµ‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/643.webp" alt></p>
<p>ç„¶åå°±æ˜¯éå¸¸ç»å…¸çš„FPNæ¶æ„ï¼ŒFPNå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åº”ç”¨åˆ°ä¸¤é˜¶æ®µç½‘ç»œå¦‚Faster  R-CNNç­‰æˆ–è€…ä¸€é˜¶æ®µç½‘ç»œYOLOã€SSDç­‰ã€‚FPNé€šè¿‡æ„é€ ä¸€ç§ç‹¬ç‰¹çš„ç‰¹å¾é‡‘å­—å¡”æ¥é¿å…å›¾åƒé‡‘å­—å¡”ä¸­è®¡ç®—é‡è¿‡é«˜çš„é—®é¢˜ï¼ŒåŒæ—¶èƒ½å¤Ÿè¾ƒå¥½åœ°å¤„ç†ç›®æ ‡æ£€æµ‹ä¸­çš„å¤šå°ºåº¦å˜åŒ–é—®é¢˜ï¼Œæ•ˆæœèƒ½å¤Ÿè¾¾åˆ°å½“æ—¶çš„STOAã€‚SSDçš„ä¸€ä¸ªæ”¹è¿›ç‰ˆDSSDå°±æ˜¯ä½¿ç”¨äº†FPNï¼Œå–å¾—äº†æ¯”SSDæ›´å¥½çš„æ•ˆæœã€‚</p>
<p>è¿™é‡Œå±•å¼€æè¿°ä¸€ä¸‹FPNçš„ç»†èŠ‚ï¼š</p>
<p>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œåšå‡ºä»¥ä¸‹è§„å®šï¼š</p>
<ul>
<li><p>å›¾åƒbackboneéƒ¨åˆ†æ¯ä¸ªå±‚feature mapç”¨$C_{i}$æ¥æ ‡è®°ï¼Œæ¯”å¦‚è¯´$C_{3}$ä»£è¡¨å¯¹åº”stride$=2^{3}=8$çš„feature mapï¼Œé€šå¸¸ç”¨$C_{1}, \ldots C_{6}$ä»£è¡¨æ¯ä¸ªfeature mapã€‚</p>
</li>
<li><p>å›¾åƒå³ä¾§çš„top-downç»“æ„æ¯ä¸ªfeature mapç”¨$P_{i}$æ¥æ ‡è®°ï¼Œæ¯”å¦‚è¯´$P_{3}$ä»£è¡¨å¯¹åº”$C_{3}$å¤§å°çš„feature mapã€‚</p>
</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/644.webp" alt></p>
<p>å‡è®¾å½“å‰å±‚ä¸ºç¬¬ä¸‰å±‚stride=8, è¦ä¸stride=16çš„ç‰¹å¾è¿›è¡Œèåˆï¼Œé‚£ä¹ˆ$C_{3}$å…ˆé€šè¿‡1 x 1å·ç§¯çº¦æŸé€šé“æ•°å’Œ$P_{4}$å±‚è¾¾åˆ°ä¸€è‡´ï¼›æ¥è‡ª$P_{4}$é€šè¿‡2å€ä¸Šé‡‡æ ·å¾—åˆ°çš„feature mapå¤§å°å’Œ$C_{3}$ä¸€è‡´ï¼Œæœ€ç»ˆ$P_{3}$æ˜¯é€šè¿‡$P_{4}$ä¸Šé‡‡æ ·ç»“æœå’Œ$C_{3}$è¿›è¡Œelement wise addå¾—åˆ°ç»“æœã€‚</p>
<p>é‚£ä¹ˆ<strong>ä¸ºä»€ä¹ˆFPNé‡‡ç”¨èåˆä»¥åæ•ˆæœè¦æ¯”ä½¿ç”¨pyramidal feature hierarchyè¿™ç§æ–¹å¼è¦å¥½</strong>å‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p>
<ul>
<li>å·ç§¯è™½ç„¶èƒ½å¤Ÿé«˜æ•ˆåœ°å‘ä¸Šæå–è¯­ä¹‰ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨<strong>åƒç´ é”™ä½é—®é¢˜</strong>ï¼Œé€šè¿‡ä¸Šé‡‡æ ·è¿˜åŸç‰¹å¾å›¾çš„æ–¹å¼å¾ˆå¥½åœ°ç¼“è§£äº†åƒç´ ä¸å‡†çš„é—®é¢˜ã€‚</li>
<li>backboneå¯ä»¥åˆ†ä¸ºæµ…å±‚ç½‘ç»œå’Œæ·±å±‚ç½‘ç»œï¼Œæµ…å±‚ç½‘ç»œè´Ÿè´£æå–ç›®æ ‡è¾¹ç¼˜ç­‰åº•å±‚ç‰¹å¾ï¼Œè€Œæ·±å±‚ç½‘ç»œå¯ä»¥æ„å»ºé«˜çº§çš„è¯­ä¹‰ä¿¡æ¯ï¼Œé€šè¿‡ä½¿ç”¨FPNè¿™ç§æ–¹å¼ï¼Œè®©æ·±å±‚ç½‘ç»œæ›´<strong>é«˜çº§è¯­ä¹‰çš„éƒ¨åˆ†çš„ä¿¡æ¯èƒ½å¤Ÿèåˆåˆ°ç¨æµ…å±‚çš„ç½‘ç»œ</strong>ï¼ŒæŒ‡å¯¼æµ…å±‚ç½‘ç»œè¿›è¡Œè¯†åˆ«ã€‚</li>
<li>ä»æ„Ÿå—é‡çš„è§’åº¦æ€è€ƒï¼Œæµ…å±‚ç‰¹å¾çš„æ„Ÿå—é‡æ¯”è¾ƒå°ï¼Œæ·±å±‚ç½‘ç»œçš„æ„Ÿå—é‡æ¯”è¾ƒå¤§ï¼Œæµ…å±‚ç½‘ç»œä¸»è¦è´Ÿè´£å°ç›®æ ‡çš„æ£€æµ‹ï¼Œæ·±å±‚çš„ç½‘ç»œè´Ÿè´£å¤§ç›®æ ‡çš„æ£€æµ‹ï¼ˆæ¯”å¦‚äººè„¸æ£€æµ‹ä¸­çš„SSHå°±ä½¿ç”¨åˆ°äº†è¿™ä¸ªç‰¹ç‚¹ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/645.webp" alt></p>
<p>é»‘è‰²çš„æ¡†æ˜¯ç†è®ºæ„Ÿå—é‡ï¼Œä¸­å¿ƒå‘ˆé«˜æ–¯åˆ†å¸ƒçš„äº®ç‚¹æ˜¯å®é™…æ„Ÿå—é‡ï¼ŒFPNä¸­çš„top-downä¹‹è·¯é€šè¿‡èåˆä¸åŒæ„Ÿå—é‡ï¼Œ<strong>ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒçš„å®é™…æ„Ÿå—é‡è¿›è¡Œèåˆï¼Œèƒ½å¤Ÿè®©é«˜å±‚åŠ å¼ºä½å±‚æ‰€å¯¹åº”çš„æ„Ÿå—é‡</strong>ã€‚</p>
<p>å…³äºæ„Ÿå—é‡è¿™ä¸ªè§‚ç‚¹ï¼ŒFPNè®ºæ–‡æœ‰ä¸€å¼ å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/646.webp" alt></p>
<p>è¿™å¼ å›¾è®²çš„æ˜¯FPNåº”ç”¨åœ¨DeepMaskä¸­åšå®ä¾‹åˆ†å‰²ï¼Œå…¶ä¸­ä½¿ç”¨äº†ä¸€ä¸ª5Ã—5çš„å¤šå±‚æ„ŸçŸ¥æœºæ¥ç”Ÿæˆä¸€ä¸ª14Ã—14çš„åˆ†å‰²ç»“æœã€‚å¯¹åº”çš„æµ…æ©™è‰²çš„åŒºåŸŸä»£è¡¨çš„æ˜¯å¯¹åº”åˆ°åŸå›¾çš„åŒºåŸŸï¼ˆä¸ç†è®ºæ„Ÿå—é‡ç›¸ä¼¼ï¼‰ï¼Œæ·±æ©™è‰²åŒºåŸŸå¯¹åº”çš„æ˜¯å…¸å‹çš„ç›®æ ‡åŒºåŸŸï¼ˆä¸å®é™…æ„Ÿå—é‡ç±»ä¼¼ï¼‰ï¼Œè§‚å¯Ÿè¿™ä¸ªå›¾æˆ‘ä»¬å¯ä»¥å¾—åˆ°å‡ ä¸ªç»“è®ºï¼š</p>
<ul>
<li><p>ç½‘ç»œè¶Šæ·±ã€ç‰¹å¾å›¾è¶Šå°å¯¹åº”åˆ°åŸå›¾çš„èŒƒå›´ä¹Ÿå°±è¶Šå¤§ã€‚è¿™ä¹Ÿå°±å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆåŠ ä¸ŠFPNä»¥åï¼Œå°ç›®æ ‡çš„æ•ˆæœæå‡äº†ï¼Œæ¯”å¦‚åœ¨ä¸Šå›¾çš„$P_{3}$åˆ°$P_{5}$ä¸­ï¼Œ$P_{3}$å¯¹åº”çš„ç›®æ ‡åŒºåŸŸè¦å°ä¸€äº›ï¼Œæ›´ç¬¦åˆå°ç›®æ ‡çš„å¤§å°ã€‚</p>
</li>
<li><p>åœ¨åŒä¸€å±‚ä¸­ï¼Œç†è®ºæ„Ÿå—é‡çš„èŒƒå›´è¦å¤§äºå®é™…æ„Ÿå—é‡ã€‚</p>
</li>
</ul>
<h2 id="æ¶ˆèå®éªŒ"><a href="#æ¶ˆèå®éªŒ" class="headerlink" title="æ¶ˆèå®éªŒ"></a>æ¶ˆèå®éªŒ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/647.webp" alt></p>
<p>ä»¥ä¸Šæ˜¯FPNå„éƒ¨åˆ†çš„ä¸“æœ‰åç§°ï¼Œä½œè€…è¯¦ç»†å¯¹æ¯”äº†top-down pathwayå¸¦æ¥çš„å¢ç›Šï¼Œlateral connectionå¸¦æ¥çš„å¢ç›Šï¼Œ</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/FPN/648.webp" alt></p>
<p>ä¸Šè¡¨ä¸­çš„å®éªŒä¸­èƒ½å¾—åˆ°å‡ ä¸ªç»“è®ºï¼š</p>
<ul>
<li>é€šè¿‡(a)å’Œ(b)æ¯”è¾ƒï¼Œè¯´æ˜éšç€ç½‘ç»œæ·±å…¥ï¼Œå°ç›®æ ‡æ£€æµ‹æ•ˆæœä¼šå˜å·®ï¼Œå¤§ç›®æ ‡æ£€æµ‹æ•ˆæœä¼šå˜å¥½ã€‚</li>
<li>é€šè¿‡(d)å’Œ(e)æ¯”è¾ƒï¼Œè¯´æ˜lateral connectionsæ˜¯éå¸¸æœ‰å¿…è¦çš„</li>
<li><p>é€šè¿‡(f)å’Œ(c)æ¯”è¾ƒï¼Œè¯´æ˜åªç”¨æœ€æµ…å±‚$P_{2}$æ•ˆæœä¸å¦‚ä½¿ç”¨$P_{2}, P_{3}, P_{4}$</p>
</li>
<li><p>é€šè¿‡(f)å’Œ(c)æ¯”è¾ƒï¼Œè¿˜å¯ä»¥å‘ç°ç”±äº$P_{2}$çš„ç©ºé—´åˆ†è¾¨ç‡æ¯”è¾ƒé«˜ï¼Œanchoréå¸¸å¤šï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“è®ºå°±æ˜¯ï¼šä»…ä»…æ˜¯ä½¿ç”¨éå¸¸å¤šçš„anchorè¿™ä¸€ç‚¹æœ¬èº«æ˜¯ä¸è¶³ä»¥æå‡å‡†ç¡®ç‡çš„ã€‚</p>
</li>
</ul>
<p>æ–‡ç« ä¸­è¿˜æœ‰å‡ ä¸ªå®éªŒå°†FPNæ·»åŠ åˆ°RPNç½‘ç»œã€DeepMaskç»“æ„ä¸­ï¼Œéƒ½å¸¦æ¥ä¸é”™çš„æ•ˆæœï¼ŒFPNç¡®å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„feature fusionæ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹åï¼Œæœ‰å¾ˆå¤šæ¶æ„çš„ç½‘ç»œä¹Ÿä¸æ–­åœ°è¢«æå‡ºæ¥ï¼Œéƒ½å¸¦æ¥äº†ä¸€å®šçš„æå‡ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><ul>
<li>æµ…å±‚ç½‘ç»œè´Ÿè´£å°ç›®æ ‡æ£€æµ‹ï¼Œæ·±å±‚ç½‘ç»œè´Ÿè´£å¤§ç›®æ ‡æ£€æµ‹ï¼Œè¿™ä¸¤éƒ¨åˆ†èåˆçš„æ—¶å€™ä¸€èˆ¬æ˜¯é€šè¿‡ç®€å•çš„addæˆ–è€…concateè¿›è¡Œèåˆçš„ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·èåˆï¼Ÿ</li>
<li>æµ…å±‚å°ç›®æ ‡ä¿¡æ¯æ¯”è¾ƒä¸°å¯Œï¼Œæ·±å±‚ç½‘ç»œå…·æœ‰é«˜çº§è¯­ä¹‰ï¼Œèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸ŠæŒ‡å¯¼å°ç›®æ ‡çš„æ£€æµ‹ï¼Œè¿™é‡Œçš„æµ…å±‚å’Œæ·±å±‚èƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªæƒé‡æ¥å…·ä½“å†³å®šå“ªä¸ªéƒ¨åˆ†å æ¯”æ¯”è¾ƒå¤§å—ï¼Ÿ</li>
<li>å…·ä½“æ€ä¹ˆå†³å®šæµ…å±‚ç½‘ç»œå’Œæ·±å±‚ç½‘ç»œçš„å æ¯”ï¼Ÿé€šè¿‡å…ˆéªŒæ¥å›ºå®šå–å€¼ï¼Œè¿˜æ˜¯è‡ªé€‚åº”é€šè¿‡ç½‘ç»œå­¦ä¹ å¾—åˆ°ç›¸åº”é˜ˆå€¼ï¼Ÿ</li>
</ul>
<p>å…¶å®çœ‹è®ºæ–‡æ¯”è¾ƒå¤šçš„è¯»è€…å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼ŒASFF, BiFPNï¼ŒBiSeNetï¼ŒThunderNetç­‰ï¼Œè¿™éƒ½æ˜¯æ¯”è¾ƒå¥½è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚</p>
<p><strong>ç‰¹å¾èåˆæ–¹å¼æ€»ç»“</strong></p>
<ul>
<li>ä¸¤å±‚ç‰¹å¾addï¼Œeg: FPN</li>
<li>ä¸¤å±‚ç‰¹å¾concateï¼Œeg: YOLOv3</li>
<li>ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶, eg: BiSeNet, ThunderNet</li>
<li>weighted add, eg: BiFPN</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>SSDç®—æ³•çš„æ”¹è¿›ç‰ˆRainbow SSD</title>
    <url>/2020/04/19/SSD%E7%AE%97%E6%B3%95%E7%9A%84%E6%94%B9%E8%BF%9B%E7%89%88Rainbow-SSD/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯BMVC 2017çš„ä¸€ä¸ªSSDçš„æ”¹è¿›ç®—æ³•R-SSDã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸‹SSDçš„ç½‘ç»œç»“æ„å›¾å§ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/640.png" alt></p>
<p>å¸¦æœ‰ç‰¹å¾å›¾ç»´åº¦ä¿¡æ¯çš„æ›´æ¸…æ™°çš„éª¨å¹²ç½‘ç»œå’ŒVGG16çš„å¯¹æ¯”å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/641.png" alt></p>
<h2 id="å‡ºå‘ç‚¹"><a href="#å‡ºå‘ç‚¹" class="headerlink" title="å‡ºå‘ç‚¹"></a>å‡ºå‘ç‚¹</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œçš„ç‰¹å¾å›¾æ•°é‡è¶Šå¤šï¼Œæˆ‘ä»¬è·å¾—çš„æ€§èƒ½ä¸€èˆ¬ä¼šæ›´å¥½ã€‚ä½†æ˜¯è¿™å¹¶ä¸ä¸€å®šä»£è¡¨ç€ç®€å•çš„å¢åŠ ç‰¹å¾å›¾çš„æ•°é‡å°±èƒ½ä½¿å¾—æ•ˆæœå˜å¥½ï¼Œè¿™ä¸€ç‚¹åœ¨å®éªŒéƒ¨åˆ†æœ‰è¯´æ˜ã€‚è¿™ç¯‡è®ºæ–‡åœ¨SSDçš„åŸºç¡€ä¸Šå¹¶æ²¡æœ‰æ”¹å˜BackBoneç½‘ç»œï¼Œå³è¿˜æ˜¯åº”ç”¨ç¨åŠ ä¿®æ”¹çš„VGG16ä¸ºBackBoneã€‚è¿™ç¯‡è®ºæ–‡çš„è´¡çŒ®æ˜¯æå‡ºäº†æ–°çš„ç‰¹å¾èåˆæ–¹å¼æ¥æå‡äº†SSDçš„æ•ˆæœï¼Œè¿™ä¸€æ”¹è¿›ä½¿å¾—SSDå¯ä»¥å……åˆ†åˆ©ç”¨ç‰¹å¾ï¼Œè™½ç„¶é€Ÿåº¦ç¨æ…¢äºåŸå§‹çš„SSDç®—æ³•ï¼Œä½†mAPå´è·å¾—äº†è¾ƒå¤§çš„æå‡ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ä¼ ç»Ÿçš„SSDç®—æ³•é€šè¿‡ä¸åŒå±‚çš„ç‰¹å¾æ¥åšæ£€æµ‹ï¼Œä½¿å¾—å…¶å¯¹å°ºåº¦å˜åŒ–æœ‰è¾ƒå¥½çš„é²æ£’æ€§ï¼Œåœ¨é€Ÿåº¦å’Œç²¾åº¦çš„Trade-Offä¸Šä¹Ÿåšå¾—æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯SSDæœ‰2ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š</p>
<ul>
<li>åœ¨SSDä¸­ï¼Œä¸åŒå±‚çš„ç‰¹å¾å›¾éƒ½æ˜¯ç‹¬ç«‹ä½œä¸ºåˆ†ç±»ç½‘ç»œçš„è¾“å…¥ï¼Œå› æ­¤å®¹æ˜“å‡ºç°ç›¸åŒç‰©ä½“è¢«ä¸åŒå¤§å°çš„æ¡†åŒæ—¶æ£€æµ‹å‡ºæ¥çš„æƒ…å†µã€‚</li>
<li>å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœæ¯”è¾ƒå·®ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°ç›®æ ‡æ£€æµ‹ç®—æ³•çš„é€šç—…äº†ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œè¿™ç¯‡ç®—æ³•ä¹Ÿä¸»è¦ä»è¿™ä¸¤ç‚¹å‡ºå‘æ¥æ”¹è¿›ä¼ ç»Ÿçš„SSDç®—æ³•ã€‚é¦–å…ˆï¼Œæœ¬æ–‡åˆ©ç”¨åˆ†ç±»ç½‘ç»œå¢åŠ ä¸åŒå±‚ä¹‹é—´çš„ç‰¹å¾å›¾è”ç³»ï¼Œå‡å°‘é‡å¤æ¡†çš„å‡ºç°ã€‚ç„¶åï¼Œå¢åŠ ç‰¹å¾é‡‘å­—å¡”ä¸­ç‰¹å¾å›¾çš„ä¸ªæ•°ï¼Œä½¿å¾—ç½‘ç»œå¯ä»¥æ£€æµ‹æ›´å¤šçš„å°ç›®æ ‡ã€‚ä¸‹é¢çš„<code>Figure5(a),(c)</code>åˆ†åˆ«å±•ç¤ºäº†SSDç®—æ³•å‡ºç°çš„ä¸Šè¿°2ä¸ªé—®é¢˜ï¼Œè€Œ<code>Figure5(b),(d)</code>åˆ†åˆ«å±•ç¤ºäº†æœ¬æ–‡æå‡ºçš„R-SSDç®—æ³•çš„æ”¹è¿›æ•ˆæœå›¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/642.png" alt></p>
<h2 id="Rainbow-SSDæ ¸å¿ƒåŸç†"><a href="#Rainbow-SSDæ ¸å¿ƒåŸç†" class="headerlink" title="Rainbow SSDæ ¸å¿ƒåŸç†"></a>Rainbow SSDæ ¸å¿ƒåŸç†</h2><p>ä¸‹é¢çš„Figure3å±•ç¤ºäº†å‡ ç§ä¸åŒçš„ç‰¹å¾èåˆæ–¹å¼ã€‚</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/643.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å‡ ç§ä¸åŒçš„ç‰¹å¾èåˆæ–¹å¼</div>
</center>

<p>æˆ‘ä»¬æ¥å°è¯•è§£æä¸€ä¸‹è¿™äº›å›¾éƒ½è¡¨ç¤ºä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><p><code>Figure3(a)</code>ï¼šè¿™è¡¨ç¤ºä½¿ç”¨<code>pooling</code>æ–¹å¼çš„ç‰¹å¾å›¾èåˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>(a)</code>æœ€å·¦è¾¹çš„38 x 38çš„ç‰¹å¾å›¾å°†å…¶åšä¸€ä¸ª<code>pooling</code>ä¹‹åå’Œæ¥ä¸‹æ¥é‚£ä¸ª19 x 19çš„ç‰¹å¾å›¾è¿›è¡Œconcateï¼Œè·å¾—äº†é‚£ä¸ªä¸€ä¸ªçº¢åŠ ä¸€ä¸ªæ©™çš„ç‰¹å¾å›¾ã€‚åé¢åŒç†ã€‚</p>
</li>
<li><p><code>Figure3(b)</code>ï¼šè¿™è¡¨ç¤ºä½¿ç”¨åå·ç§¯çš„æ–¹å¼è¿›è¡Œç‰¹å¾èåˆï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä»å³è¾¹çš„1 x 1çš„ç´«è‰²ç‰¹å¾å›¾å¾€å·¦åšconcateï¼Œå› ä¸ºåå·ç§¯æ˜¯å‡ç»´ï¼Œæ‰€ä»¥ä»å³è‡³å·¦ã€‚</p>
</li>
<li><p><code>Figure3(c)</code>ï¼šè¡¨ç¤º<strong>ã€ŒåŒæ—¶ä½¿ç”¨Poolingå’Œåå·ç§¯åšç‰¹å¾èåˆã€‚ã€</strong> è¿™ä¸ªç»“æ„å°±æ˜¯æœ¬æ–‡çš„Radinbow SSDçš„æ ¸å¿ƒäº†ï¼Œå³åŒæ—¶ä»å·¦è‡³å³ï¼ˆ<code>pooling</code>ï¼Œ<code>concate</code>ï¼‰å’Œä»å³è‡³å·¦ï¼ˆ<code>deconvolution</code>ï¼Œ<code>concate</code>ï¼‰ã€‚</p>
</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°Rainbow SSDé‡Œèåˆåçš„ç‰¹å¾å›¾è‰²å½©å¾ˆåƒå½©è™¹ï¼Œè¿™å¤§æ¦‚å°±æ˜¯è¿™ä¸ªåå­—çš„ç”±æ¥äº†ã€‚å¦å¤–ä¸€ä¸ªå…³é”®ç‚¹æ˜¯<strong>ã€Œåœ¨åšconcateä¹‹å‰éƒ½ä¼šå¯¹ç‰¹å¾å›¾åšä¸€ä¸ªnormalizationæ“ä½œï¼Œå› ä¸ºä¸åŒå±‚çš„ç‰¹å¾å›¾çš„scaleæ˜¯ä¸åŒçš„ï¼Œæœ¬æ–‡ä¸­çš„normalizationæ–¹å¼é‡‡ç”¨Batch Normalizationã€‚ã€</strong></p>
<p>ç”±äºFigure3ä¸­çš„ç‰¹å¾èåˆæ–¹å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè¿™å°±å¯¼è‡´èåˆåçš„æ¯ä¸€å±‚ç‰¹å¾å›¾çš„ä¸ªæ•°éƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½ä¸º2816ï¼Œå› æ­¤å¯ä»¥å…±äº«éƒ¨åˆ†å‚æ•°ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯default boxesçš„å‚æ•°å…±äº«</p>
<p>ä¸‹é¢çš„Table1å±•ç¤ºäº†å’ŒSSDç®—æ³•ä¸­çš„default boxesçš„æ•°é‡å¯¹æ¯”ã€‚</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/644.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">æ¯ä¸€ä¸ªåˆ†ç±»ç½‘ç»œ(æ£€æµ‹å¤´)ä¸ªæ•°ä»¥åŠboxçš„æ€»ä¸ªæ•°</div>
</center>

<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>ä¸‹é¢çš„Table3å±•ç¤ºäº†ä¸åŒçš„å®éªŒå¯¹æ¯”ç»“æœï¼ŒåŒæ—¶Table2è¡¨ç¤ºåªåœ¨åŸå§‹çš„SSDåŸºç¡€ä¸Šå¢åŠ ä¸åŒç‰¹å¾å±‚æ•°é‡çš„<strong>ã€ŒI-SSDã€</strong>ç®—æ³•ã€‚é€šè¿‡Table3çš„å®éªŒç»“æœå¯ä»¥çœ‹å‡ºè™½ç„¶ISSDä¹Ÿè·å¾—äº†ä¸é”™çš„æ•ˆæœï¼Œä½†æ˜¯å®ƒçš„FPSå´åä½ã€‚æœ¬æ–‡çš„Rainbow SSDæ•ˆæœå’ŒFPSéƒ½è¡¨ç°ä¸é”™ã€‚R-FCNè™½ç„¶æ•ˆæœä¸é”™ï¼Œä½†æ˜¯é€Ÿåº¦ä¸Šä¸å ä¼˜åŠ¿ã€‚</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/645.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å®éªŒç»“æœ</div>
</center>

<p>ä¸‹é¢çš„Figure4å±•ç¤ºäº†åœ¨VOC 2007 testä¸Šçš„PRæ›²çº¿ã€‚</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/646.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">PRæ›²çº¿ï¼Œä¸€èˆ¬ä¸€ä¸ªPRæ›²çº¿åŒ…ä½å¦å¤–ä¸€ä¸ªè¯´æ˜è¿™ä¸ªæ¨¡å‹æ›´å¥½</div>
</center>

<p>ä¸‹é¢çš„Table4åˆ™å±•ç¤ºäº†APå’ŒmAPçš„è¯¦ç»†å¯¹æ¯”ã€‚</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/647.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">ç›¸æ¯”äºåŸå§‹çš„SSDï¼Œæœ¬æ–‡çš„Rainbow SSDæç‚¹æ˜æ˜¾</div>
</center>

<p>ä¸‹é¢çš„Table5å±•ç¤ºäº†ä¸åŒScaleçš„ç›®æ ‡å¬å›ç‡çš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°Rainbow SSDå¯¹å°ç›®æ ‡æ£€æµ‹çš„å¬å›ç‡æå‡æ›´åŠ æ˜æ˜¾ã€‚</p>
<p><center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RSSD/648.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">Rainbow SSDå¯¹å°ç›®æ ‡æ£€æµ‹çš„å¬å›ç‡æå‡æ›´åŠ æ˜æ˜¾</div>
</center></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡è®ºæ–‡æå‡ºäº†ä¸€ç§rainbow concatenationæ–¹å¼æ¥ç»„åˆç‰¹å¾ï¼Œåœ¨å¢åŠ ä¸åŒå±‚ä¹‹é—´ç‰¹å¾å›¾å…³ç³»çš„åŒæ—¶ä¹Ÿå¢åŠ äº†ç‰¹å¾å›¾çš„ä¸ªæ•°ã€‚<strong>ã€Œè¿™ç§èåˆæ–¹å¼ä¸ä»…è§£å†³äº†ä¼ ç»ŸSSDç®—æ³•å­˜åœ¨çš„é‡å¤æ¡†é—®é¢˜ï¼ŒåŒæ—¶ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å°ç›®æ ‡çš„æ£€æµ‹é—®é¢˜ã€‚ã€</strong></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>SSDçš„æ”¹è¿›ç‰ˆä¹‹DSSD</title>
    <url>/2020/04/19/SSD%E7%9A%84%E6%94%B9%E8%BF%9B%E7%89%88%E4%B9%8BDSSD/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>DSSDå…¨ç§°ä¸º<strong>Deconvolutional Single Shot Detector</strong>ï¼Œå³åœ¨SSDç®—æ³•çš„å‰é¢åŠ äº†ä¸€ä¸ªåå·ç§¯å•è¯ï¼Œè¿™æ˜¯CVPR 2017çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ˜¯å¯¹SSDè¿›è¡Œäº†ä¸€ä¸ªæ”¹è¿›ã€‚</p>
<h2 id="DSSDç®—æ³•çš„è´¡çŒ®"><a href="#DSSDç®—æ³•çš„è´¡çŒ®" class="headerlink" title="DSSDç®—æ³•çš„è´¡çŒ®"></a>DSSDç®—æ³•çš„è´¡çŒ®</h2><p>è¿™ç¯‡è®ºæ–‡çš„ä¸»è¦è´¡çŒ®æ˜¯åœ¨å¸¸ç”¨çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­åŠ å…¥äº†ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œå¸¸è§„çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸€ä¸ª(YOLOï¼ŒFaster-RCNN)æˆ–è€…å¤šä¸ªç‰¹å¾å›¾ä¸Šè¿›è¡Œæ£€æµ‹ï¼ˆSSDï¼‰ï¼Œä½†æ˜¯å„ä¸ªç‰¹å¾å±‚ä¹‹é—´çš„ä¿¡æ¯å¹¶æ²¡æœ‰æœ‰æ•ˆçš„ç»“åˆä»¥åŠåˆ©ç”¨ï¼ŒDSSDçš„è´¡çŒ®æ­£æ˜¯è§£å†³äº†è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="å‡ºå‘ç‚¹"><a href="#å‡ºå‘ç‚¹" class="headerlink" title="å‡ºå‘ç‚¹"></a>å‡ºå‘ç‚¹</h2><p>æˆ‘ä»¬çŸ¥é“SSDæœ€æ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯å¯¹å°ç›®æ ‡ä¸å¤Ÿé²æ£’ï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“SSDä¸ºäº†è§£å†³å°ç›®æ ‡æ£€æµ‹çš„æ€è·¯æ˜¯åœ¨å°½é‡å¤šçš„ç‰¹å¾å±‚ä¸Šè¿›è¡Œæ£€æµ‹ï¼Œæ¥æ›´å¥½çš„åŒ¹é…å°ç›®æ ‡ï¼Œå› ä¸ºåˆ†è¾¨ç‡è¶Šå¤§çš„ç‰¹å¾å›¾å°ç›®æ ‡çš„ç©ºé—´ä¿¡æ¯å°±ä¿ç•™å¾—è¶Šå¤šã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšæœ‰ä¸ªé—®é¢˜ï¼Œé‚£<strong>å°±æ˜¯æµ…å±‚æå–çš„ç‰¹å¾å›¾è¡¨è¾¾èƒ½åŠ›ä¸å¤Ÿå¼ºï¼Œä¹Ÿå³æ˜¯è¯´æµ…å±‚ç‰¹å¾å›¾ä¸­æ¯ä¸ªæ ¼å­ä¹Ÿå¯ä»¥åˆ¤æ–­è¿™ä¸ªæ ¼å­ä¸­åŒ…å«çš„æ˜¯å“ªä¸€ä¸ªç±»ï¼Œä½†æ˜¯ä¸å¤Ÿé‚£ä¹ˆç¡®å®š</strong>ã€‚å…·ä½“æ¥è¯´æœ‰å¯èƒ½å‡ºç° æ¡†å¯¹äº†ï¼Œä½†æ˜¯åˆ†ç±»å‡ºé”™æˆ–è€…ç½®ä¿¡åº¦ä¸å¤Ÿå¥½æˆ–è€…å°†èƒŒæ™¯è¯¯è®¤ä¸ºç›®æ ‡ç­‰ç­‰ï¼Œä¹Ÿå°±æ˜¯è¯´SSDåŒæ ·è¿˜æ˜¯å­˜åœ¨è¯¯æ£€å’Œæ¼æ£€çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µå¯¹äºå°ç›®æ ‡åœºæ™¯å‡ºç°çš„æ¦‚ç‡æ›´å¤§ï¼Œå› æ­¤SSDå¯¹äºå°ç›®æ ‡çš„æ£€æµ‹ä»ç„¶ä¸å¤Ÿé²æ£’ã€‚</p>
<h2 id="DSSDçš„ç½‘ç»œç»“æ„"><a href="#DSSDçš„ç½‘ç»œç»“æ„" class="headerlink" title="DSSDçš„ç½‘ç»œç»“æ„"></a>DSSDçš„ç½‘ç»œç»“æ„</h2><p>SSDå’ŒDSSDçš„ç½‘ç»œç»“æ„å¦‚Figure1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-00-32.jpg" alt></p>
<p>ç»è¿‡ä¸Šä¸€èŠ‚çš„åˆ†ææˆ‘ä»¬çŸ¥é“SSDå¯¹å°ç›®æ ‡ä¸å¤Ÿé²æ£’çš„ä¸»è¦åŸå› å°±æ˜¯ç‰¹å¾å›¾çš„è¡¨å¾èƒ½åŠ›ä¸å¤Ÿå¼ºã€‚ä¸ºäº†è§£å†³è¿™ä¸€ç‚¹ï¼ŒDSSDå°±ä½¿ç”¨äº†æ›´å¥½çš„BackBoneç½‘ç»œï¼ˆResNetï¼‰å’Œåå·ç§¯å±‚ï¼Œè·³è·ƒé“¾æ¥æ¥ç»™æµ…å±‚ç‰¹å¾å›¾æ›´å¥½çš„è¡¨å¾èƒ½åŠ›ã€‚é‚£ä¹ˆå…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>
<p>æ—¢ç„¶DSSDç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æé«˜æµ…å±‚ç‰¹å¾å›¾çš„è¡¨å¾èƒ½åŠ›ï¼Œé¦–å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯å°†åŸºç¡€ç½‘ç»œç”±VGGæ¢æˆResNetï¼Œä¸‹é¢çš„Table2è¯´æ˜äº†åœ¨VGGå’ŒResNetä¸Šå“ªäº›å±‚ä½œä¸ºæœ€åçš„é¢„æµ‹ç‰¹å¾å›¾ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/640.png" alt></p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›å±‚å¯ä¸æ˜¯éšä¾¿é€‰æ‹©çš„ï¼Œå¤§è‡´è¦å’ŒVGGç›¸äº’å¯¹åº”æ„Ÿå—é‡ä¹Ÿè¦å¯¹åº”ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•ˆæœä¼šå˜å¥½ï¼Œä¸ç„¶ä¹Ÿæœ‰å¯èƒ½ä¼šå˜å·®ã€‚ä¸‹é¢Table3ä¸­çš„å®éªŒç»“æœä¹Ÿå±•ç¤ºå‡ºäº†æµ…å±‚çš„ç‰¹å¾æ›´å…·æœ‰è¡¨ç¤ºèƒ½åŠ›æ—¶ï¼Œåœ¨å°ç›®æ ‡ä¸Šçš„æ•ˆæœå°±ä¼šæ›´å¥½ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/641.png" alt></p>
<p>å›¾ç‰‡å¤§å°ä¸å¤Ÿçš„æ—¶å€™ï¼ŒResNetçš„SSDå’ŒVGGçš„SSDæ•ˆæœå…¶å®ç›¸å½“ï¼Œæ•´ä½“ç”šè‡³è¿˜ä¼šç¨å¾®å·®ä¸€äº›ï¼Œåˆ°äº†512*512çš„å°ºåº¦ä¸Šæ—¶ï¼ŒResNetçš„ä¸‹è¿‡å°±æ˜æ˜¾è¦å¥½äº†ã€‚å°¤å…¶æ˜¯æ ‡ç²—çš„å°ç›®æ ‡ï¼ˆbirdï¼‰ã€‚</p>
<h2 id="é¢„æµ‹æ¨¡å—"><a href="#é¢„æµ‹æ¨¡å—" class="headerlink" title="é¢„æµ‹æ¨¡å—"></a>é¢„æµ‹æ¨¡å—</h2><p>åŸºäºResNetçš„å®éªŒè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä¿®æ”¹ç½‘ç»œçš„é¢„æµ‹æ¨¡å—ï¼Œä½œè€…ä½¿ç”¨äº†4ç§ä¸åŒçš„é¢„æµ‹æ¨¡å—ï¼Œå¦‚Figure2æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-11-49.jpg" alt></p>
<p>ä»ä¸‹é¢çš„Table4å¯ä»¥çœ‹åˆ°è¿™ç¡®å®æå‡äº†æ•ˆæœï¼Œå¹¶ä¸”cè¿™ç§ç»“æ„æ¯”dè¿™ç§ç»“æ„æ›´å¥½ä¸€äº›ï¼Œ<strong>è¿™ä¸ªè®¾è®¡çš„çµæ„Ÿæ®è¯´æ¥è‡ªäºMS-CNNï¼Œå®ƒæŒ‡å‡ºæ”¹å–„æ¯ä¸ªä»»åŠ¡çš„åˆ†æ”¯ç½‘ç»œåŒæ ·å¯ä»¥æé«˜å‡†ç¡®ç‡</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/642.png" alt></p>
<p>æ³¨æ„æœ€åä¸€è¡Œæ˜¯ä½¿ç”¨äº†<strong>approximate bilinear pooling</strong>(CVPR 2016)çš„ç»“æœã€‚</p>
<h2 id="åå·ç§¯æ¨¡å—"><a href="#åå·ç§¯æ¨¡å—" class="headerlink" title="åå·ç§¯æ¨¡å—"></a>åå·ç§¯æ¨¡å—</h2><p>åœ¨SSDçš„ç½‘ç»œç»“æ„å›¾ä¸­çš„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/645.png" alt></p>
<p>å°±ä»£è¡¨äº†æœ¬æ–‡çš„ä¸»è¦åˆ›æ–°ç‚¹ï¼Œå³åå·ç§¯æ¨¡å—ï¼Œå®ƒçš„å…·ä½“ç»“æ„å¦‚Figure3æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_16-17-17.jpg" alt></p>
<p>è¿™ä¸ªæ¨¡å—é‡Œé¢è¢«çº¢è‰²æ¡†éƒ¨åˆ†åœˆä½çš„å¯ä»¥æœ‰ä¸¤ç§è¿æ¥æ–¹å¼ï¼ŒEltw Productå…¶å®å°±æ˜¯çŸ©é˜µçš„ç‚¹ç§¯ï¼Œè¿˜æœ‰sumçš„å½¢å¼å°±æ˜¯æ±‚å’Œã€‚ä¸Šä¸€èŠ‚çš„Table4å±•ç¤ºäº†è¿™ä¸¤ç§æ“ä½œçš„ç²¾åº¦å·®è·ï¼Œç›¸å…³éƒ¨åˆ†æˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/643.png" alt></p>
<p>å°†ResNetï¼Œåå·ç§¯æ¨¡å—å’Œé¢„æµ‹æ¨¡å—ç»“åˆåœ¨ä¸€èµ·å°±æ„æˆäº†æœ€ç»ˆçš„DSSDç®—æ³•ã€‚</p>
<h2 id="æ¨¡å‹è®­ç»ƒ"><a href="#æ¨¡å‹è®­ç»ƒ" class="headerlink" title="æ¨¡å‹è®­ç»ƒ"></a>æ¨¡å‹è®­ç»ƒ</h2><p>åœ¨å®éªŒæ—¶ï¼Œä½¿ç”¨SSDæ¨¡å‹åˆå§‹åŒ–DSSDç½‘ç»œï¼Œä½†æ˜¯å¯¹äºdefault boxé€‰å–çš„é•¿å®½æ¯”ä¾‹ï¼Œä½œè€…åœ¨è®ºæ–‡ä¸­åšäº†è¯¦ç»†çš„åˆ†æå’Œæ”¹è¿›ã€‚ä¸ºäº†å¾—åˆ°PASCAL VOC 2007å’Œ2012  trainvalå›¾ç‰‡é‡Œå„ä¸ªç‰©ä½“å¯¹åº”çš„çœŸå®ä½ç½®æ¡†çš„é•¿å®½æ¯”ä¾‹ï¼Œä½œè€…ç”¨K-meansä»¥è¿™äº›çœŸå®æ¡†å†…åŒºåŸŸé¢ç§¯çš„å¹³æ–¹æ ¹ä½œä¸ºç‰¹å¾åšäº†ä¸€ä¸ªèšç±»åˆ†æï¼Œåšèšç±»çš„æ—¶å€™å¢åŠ èšç±»çš„ä¸ªæ•°æ¥æå‡èšç±»çš„å‡†ç¡®åº¦ï¼Œæœ€åç¡®å®šä¸ƒç±»çš„æ—¶å€™æ”¶æ•›çš„é”™è¯¯ç‡æœ€ä½å¦‚Table1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/DSSD/644.png" alt></p>
<p>å› ä¸ºSSDè®­ç»ƒæ—¶ä½¿ç”¨çš„è®­ç»ƒå›¾ç‰‡ä¼šé‡æ–°è°ƒæ•´æ¯”ä¾‹å˜æˆæ–¹å½¢çš„å°ºå¯¸ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°çš„è®­ç»ƒå›¾ç‰‡éƒ½æ˜¯æ¯”è¾ƒå®½çš„å›¾ç‰‡ï¼Œæ‰€ä»¥ç›¸åº”çš„çœŸå®æ¡†çš„å®½åº¦ä¼šå˜å°ä¸€ç‚¹ã€‚é€šè¿‡è¿™ç§èšç±»å®éªŒæœ€åç¡®å®šäº†é¢„æµ‹ä½¿ç”¨çš„default boxçš„é•¿å®½æ¯”ä¾‹ä¸º1ã€1.6ã€2å’Œ3ï¼Œä½œä¸ºæ¯ä¸€ä¸ªç‰¹å¾å›¾çš„default boxæ‰€ä½¿ç”¨çš„é•¿å®½æ¯”ä¾‹ã€‚</p>
<p>DSSDçš„ä½œè€…WeiLiuå¤§ç¥åœ¨Caffeæ¡†æ¶ä¸­å°†SSDçš„åŸºç¡€ç½‘ç»œæ”¹æˆResNet101ç„¶åé‡æ–°è®­ç»ƒäº†ä¸€ä¸ªæ–°çš„SSDæ¨¡å‹ï¼Œä»¥VOCçš„æ•°æ®é›†ä¸ºä¾‹ï¼Œè®­ç»ƒé›†ä½¿ç”¨çš„æ•°æ®æ˜¯VOC2007å’ŒVOC2012çš„trainvalæ•°æ®é›†ï¼Œæµ‹è¯•ç”¨çš„æ˜¯07çš„æµ‹è¯•é›†ï¼Œè®­ç»ƒæ—¶ä¸€å…±è¿­ä»£äº†70kæ¬¡ï¼Œä½¿ç”¨å­¦ä¹ ç‡ä¸º1e-3åœ¨å‰40kæ¬¡iterationsï¼Œç„¶åè°ƒæ•´å­¦ä¹ ç‡ä¸º1e-4ã€1e-5å†åˆ†åˆ«è®­ç»ƒ20kæ¬¡ã€10kæ¬¡iterationsã€‚ç„¶åç”¨ç”¨è®­ç»ƒå¥½çš„SSDæ¨¡å‹æ¥åˆå§‹åŒ–DSSDç½‘ç»œã€‚è®­ç»ƒDSSDçš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒåŠ è½½SSDæ¨¡å‹åˆå§‹åŒ–DSSDç½‘ç»œï¼Œå¹¶å†»ç»“SSDç½‘ç»œçš„å‚æ•°ï¼Œç„¶ååªå¢åŠ åå·ç§¯æ¨¡å‹(ä¸æ·»åŠ é¢„æµ‹æ¨¡å‹)ï¼Œåœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹åªè®­ç»ƒåå·ç§¯æ¨¡å‹ï¼Œè®¾ç½®å­¦ä¹ ç‡ä¸º1e-3ã€1e-4åˆ†åˆ«è¿­ä»£20kæ¬¡å’Œ10kæ¬¡ï¼›ç¬¬äºŒä¸ªé˜¶æ®µï¼Œfine-tuneç¬¬ä¸€é˜¶æ®µçš„æ¨¡å‹ï¼Œè§£å†»ç¬¬ä¸€é˜¶æ®µè®­ç»ƒæ—¶å€™å†»ç»“çš„æ‰€æœ‰å‚æ•°ï¼Œå¹¶æ·»åŠ é¢„æµ‹æ¨¡å‹ï¼Œè®¾ç½®å­¦ä¹ ç‡ä¸º1e-3ã€1e-4å†åˆ†åˆ«è®­ç»ƒ20kæ¬¡ã€20kæ¬¡iterationsã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡è®ºæ–‡è¡¨è¾¾å‡ºï¼Œæå‡æµ…å±‚ç‰¹å¾å›¾çš„è¡¨è¾¾èƒ½åŠ›æ˜¯å¯ä»¥æé«˜ç±»ä¼¼çš„ç›®æ ‡æ£€æµ‹å™¨å¯¹å°ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›çš„ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬æ€è€ƒçš„ä¸€ä¸ªæ–¹å‘ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>SSDä»£ç è§£æ</title>
    <url>/2020/04/23/SSD%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç¯‡æ–‡ç« æ˜¯åœ¨SSDç®—æ³•åŸç†è§£æçš„åŸºç¡€ä¸Šåšçš„ä»£ç è§£æï¼Œä»Šå¤©è¦è§£æçš„SSDæºç æ¥è‡ªäºgithubä¸€ä¸ªéå¸¸ç«çš„Pytorchå®ç°ï¼Œå·²ç»æœ‰3K+æ˜Ÿï¼Œåœ°å€ä¸ºï¼š<a href="https://github.com/amdegroot/ssd.pytorch/">https://github.com/amdegroot/ssd.pytorch/</a></p>
<h2 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h2><p>ä¸ºäº†æ¯”è¾ƒå¥½çš„å¯¹åº”SSDçš„ç»“æ„æ¥çœ‹ä»£ç ï¼Œæˆ‘ä»¬é¦–å…ˆæ”¾å‡ºSSDçš„ç½‘ç»œç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ssd/640.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°åŸå§‹çš„SSDç½‘ç»œæ˜¯ä»¥VGG-16ä½œBackboneï¼ˆéª¨å¹²ç½‘ç»œï¼‰çš„ã€‚ä¸ºäº†æ›´åŠ æ¸…æ™°çœ‹åˆ°ç›¸æ¯”äºVGG16ï¼ŒSSDçš„ç½‘ç»œä½¿ç”¨äº†å“ªäº›å˜åŒ–ï¼Œå¸¦æœ‰ç‰¹å¾å›¾ç»´åº¦ä¿¡æ¯çš„æ›´æ¸…æ™°çš„éª¨å¹²ç½‘ç»œå’ŒVGG16çš„å¯¹æ¯”å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ssd/641.webp" alt></p>
<h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><p>OKï¼Œç°åœ¨æˆ‘ä»¬å°±è¦å¼€å§‹ä»æºç å‰–æSSDäº† ã€‚ä¸»è¦å¼„æ¸…æ¥šä¸‰ä¸ªæ–¹é¢ï¼Œç½‘ç»œç»“æ„çš„æ­å»ºï¼ŒAnchorè¿˜æœ‰æŸå¤±å‡½æ•°ï¼Œå°±ç®—æ˜¯ç†è§£è¿™ä¸ªæºç äº†ã€‚</p>
<h3 id="ç½‘ç»œæ­å»º"><a href="#ç½‘ç»œæ­å»º" class="headerlink" title="ç½‘ç»œæ­å»º"></a>ç½‘ç»œæ­å»º</h3><p>ä»ä¸Šé¢çš„å›¾ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°åœ¨ä»¥VGG16åšéª¨å¹²ç½‘ç»œæ—¶ï¼Œåœ¨conv5åä¸¢å¼ƒäº†VGG16ä¸­çš„å…¨è¿æ¥å±‚æ”¹ä¸ºäº†1024 x 3 x 3å’Œ1024 x 1 x 1 çš„å·ç§¯å±‚ã€‚å…¶ä¸­<code>conv4-1</code>å·ç§¯å±‚å‰é¢çš„<code>maxpooling</code>å±‚çš„<code>ceil_model=True</code>ï¼Œä½¿å¾—è¾“å‡ºç‰¹å¾å›¾é•¿å®½ä¸º38 x 38ã€‚è¿˜æœ‰<code>conv5-3</code>åé¢çš„ä¸€å±‚<code>maxpooling</code>å±‚å‚æ•°ä¸º$(\text {kernelsize}=3, \text {stride}=1, \text {padding}=1)$ï¼Œä¸è¿›è¡Œä¸‹é‡‡æ ·ã€‚ç„¶ååœ¨<code>fc7</code>åé¢æ¥ä¸Šå¤šå°ºåº¦æå–çš„å¦å¤–4ä¸ªå·ç§¯å±‚å°±æ„æˆäº†å®Œæ•´çš„SSDç½‘ç»œã€‚è¿™é‡ŒVGG16ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼Œæ¥è‡ªssd.pyï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vgg</span>(<span class="params">cfg, i, batch_norm=<span class="literal">False</span></span>):</span></span><br><span class="line">    layers = []</span><br><span class="line">    in_channels = i</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> cfg:</span><br><span class="line">        <span class="keyword">if</span> v == <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">            layers += [nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>)]</span><br><span class="line">        <span class="keyword">elif</span> v == <span class="string">&#x27;C&#x27;</span>:</span><br><span class="line">            layers += [nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>, ceil_mode=<span class="literal">True</span>)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            conv2d = nn.Conv2d(in_channels, v, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> batch_norm:</span><br><span class="line">                layers += [conv2d, nn.BatchNorm2d(v), nn.ReLU(inplace=<span class="literal">True</span>)]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                layers += [conv2d, nn.ReLU(inplace=<span class="literal">True</span>)]</span><br><span class="line">            in_channels = v</span><br><span class="line">    pool5 = nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>)</span><br><span class="line">    conv6 = nn.Conv2d(<span class="number">512</span>, <span class="number">1024</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">6</span>, dilation=<span class="number">6</span>)</span><br><span class="line">    conv7 = nn.Conv2d(<span class="number">1024</span>, <span class="number">1024</span>, kernel_size=<span class="number">1</span>)</span><br><span class="line">    layers += [pool5, conv6,</span><br><span class="line">               nn.ReLU(inplace=<span class="literal">True</span>), conv7, nn.ReLU(inplace=<span class="literal">True</span>)]</span><br><span class="line">    <span class="keyword">return</span> layers</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢çš„é‚£å¼ å›¾æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ä»£ç é‡Œé¢æœ€åè·å¾—çš„<code>conv7</code>å°±æ˜¯æˆ‘ä»¬ä¸Šé¢å›¾é‡Œé¢çš„<code>fc7</code>ï¼Œç‰¹å¾ç»´åº¦æ˜¯ï¼š$[\text { None }, 1024,19,19]$ã€‚ç°åœ¨å¯ä»¥å¼€å§‹æ­å»ºSSDç½‘ç»œåé¢çš„å¤šå°ºåº¦æå–ç½‘ç»œäº†ã€‚ä¹Ÿå°±æ˜¯ç½‘ç»œç»“æ„å›¾ä¸­çš„Extra Feature Layersã€‚æˆ‘ä»¬ä»å¼€ç¯‡çš„ç»“æ„å›¾ä¸­æˆªå–ä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç…§ä»£ç ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ssd/642.webp" alt></p>
<p>å®ç°çš„ä»£ç å¦‚ä¸‹ï¼ˆåŒæ ·æ¥è‡ªssd.pyï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_extras</span>(<span class="params">cfg, i, batch_norm=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="comment"># Extra layers added to VGG for feature scaling</span></span><br><span class="line">    layers = []</span><br><span class="line">    in_channels = i</span><br><span class="line">    flag = <span class="literal">False</span> <span class="comment">#flag ç”¨æ¥æ§åˆ¶ kernel_size= 1 or 3</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(cfg):</span><br><span class="line">        <span class="keyword">if</span> in_channels != <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> v == <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">                layers += [nn.Conv2d(in_channels, cfg[k + <span class="number">1</span>],</span><br><span class="line">                           kernel_size=(<span class="number">1</span>, <span class="number">3</span>)[flag], stride=<span class="number">2</span>, padding=<span class="number">1</span>)]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                layers += [nn.Conv2d(in_channels, v, kernel_size=(<span class="number">1</span>, <span class="number">3</span>)[flag])]</span><br><span class="line">            flag = <span class="keyword">not</span> flag</span><br><span class="line">        in_channels = v</span><br><span class="line"><span class="keyword">return</span> layers</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç½‘ç»œç»“æ„ä¸­é™¤äº†é­”æ”¹åçš„VGG16å’ŒExtra  Layersè¿˜æœ‰6ä¸ªæ¨ªç€çš„çº¿ï¼Œè¿™ä»£è¡¨çš„æ˜¯å¯¹6ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾è¿›è¡Œå·ç§¯è·å¾—é¢„æµ‹æ¡†çš„å›å½’(loc)å’Œç±»åˆ«(cls)ä¿¡æ¯ï¼Œæ³¨æ„SSDå°†èƒŒæ™¯ä¹Ÿçœ‹æˆç±»åˆ«äº†ï¼Œæ‰€ä»¥å¯¹äºVOCæ•°æ®é›†ç±»åˆ«æ•°å°±æ˜¯20+1=21ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multibox</span>(<span class="params">vgg, extra_layers, cfg, num_classes</span>):</span></span><br><span class="line">    loc_layers = []<span class="comment">#å¤šå°ºåº¦åˆ†æ”¯çš„å›å½’ç½‘ç»œ</span></span><br><span class="line">    conf_layers = []<span class="comment">#å¤šå°ºåº¦åˆ†æ”¯çš„åˆ†ç±»ç½‘ç»œ</span></span><br><span class="line">    <span class="comment"># ç¬¬ä¸€éƒ¨åˆ†ï¼Œvgg ç½‘ç»œçš„ Conv2d-4_3(21å±‚)ï¼Œ Conv2d-7_1(-2å±‚)</span></span><br><span class="line">    vgg_source = [<span class="number">21</span>, -<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(vgg_source):</span><br><span class="line">        <span class="comment"># å›å½’ box*4(åæ ‡)</span></span><br><span class="line">        loc_layers += [nn.Conv2d(vgg[v].out_channels,</span><br><span class="line">                                 cfg[k] * <span class="number">4</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)]</span><br><span class="line">        <span class="comment"># ç½®ä¿¡åº¦ box*(num_classes)</span></span><br><span class="line">        conf_layers += [nn.Conv2d(vgg[v].out_channels,</span><br><span class="line">                        cfg[k] * num_classes, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)]</span><br><span class="line">    <span class="comment"># ç¬¬äºŒéƒ¨åˆ†ï¼Œcfgä»ç¬¬ä¸‰ä¸ªå¼€å§‹ä½œä¸ºboxçš„ä¸ªæ•°ï¼Œè€Œä¸”ç”¨äºå¤šå°ºåº¦æå–çš„ç½‘ç»œåˆ†åˆ«ä¸º1,3,5,7å±‚</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(extra_layers[<span class="number">1</span>::<span class="number">2</span>], <span class="number">2</span>):</span><br><span class="line">        loc_layers += [nn.Conv2d(v.out_channels, cfg[k]</span><br><span class="line">                                 * <span class="number">4</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)]</span><br><span class="line">        conf_layers += [nn.Conv2d(v.out_channels, cfg[k]</span><br><span class="line">                                  * num_classes, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> vgg, extra_layers, (loc_layers, conf_layers)</span><br><span class="line"><span class="comment"># ç”¨ä¸‹é¢çš„æµ‹è¯•ä»£ç æµ‹è¯•ä¸€ä¸‹</span></span><br><span class="line"><span class="keyword">if</span> __name__  == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    vgg, extra_layers, (l, c) = multibox(vgg(base[<span class="string">&#x27;300&#x27;</span>], <span class="number">3</span>),</span><br><span class="line">                                         add_extras(extras[<span class="string">&#x27;300&#x27;</span>], <span class="number">1024</span>),</span><br><span class="line">                                         [<span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">4</span>], <span class="number">21</span>)</span><br><span class="line">    <span class="built_in">print</span>(nn.Sequential(*l))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;---------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(nn.Sequential(*c))</span><br></pre></td></tr></table></figure>
<p>åœ¨jupter notebookè¾“å‡ºä¿¡æ¯ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">loc layers:</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">Sequential(</span><br><span class="line">  (0): Conv2d(512, 16, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (1): Conv2d(1024, 24, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (2): Conv2d(512, 24, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (3): Conv2d(256, 24, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (4): Conv2d(256, 16, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (5): Conv2d(256, 16, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">)</span><br><span class="line">---------------------------</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">conf layers:</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">Sequential(</span><br><span class="line">  (0): Conv2d(512, 84, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (1): Conv2d(1024, 126, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (2): Conv2d(512, 126, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (3): Conv2d(256, 126, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (4): Conv2d(256, 84, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">  (5): Conv2d(256, 84, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Anchorç”Ÿæˆ-Prior-Boxå±‚"><a href="#Anchorç”Ÿæˆ-Prior-Boxå±‚" class="headerlink" title="Anchorç”Ÿæˆ(Prior_Boxå±‚)"></a>Anchorç”Ÿæˆ(Prior_Boxå±‚)</h3><p>è¿™ä¸ªåœ¨å‰é¢SSDçš„åŸç†ç¯‡ä¸­è®²è¿‡äº†ï¼Œè¿™é‡Œä¸å¦¨å†å›å¿†ä¸€ä¸‹ï¼ŒSSDä»é­”æ”¹åçš„VGG16çš„<code>conv4_3</code>å¼€å§‹ä¸€å…±ä½¿ç”¨äº†6ä¸ªä¸åŒå¤§å°çš„ç‰¹å¾å›¾ï¼Œå¤§å°åˆ†åˆ«ä¸º<code>(38,28),(19,19),(10,10),(5,5),(3,3),(1,1)</code>ï¼Œä½†æ¯ä¸ªç‰¹å¾å›¾ä¸Šè®¾ç½®çš„å…ˆéªŒæ¡†(Anchor)çš„æ•°é‡ä¸åŒã€‚å…ˆéªŒæ¡†çš„è®¾ç½®åŒ…å«å°ºåº¦å’Œé•¿å®½æ¯”ä¸¤ä¸ªæ–¹é¢ã€‚å¯¹äºå…ˆéªŒæ¡†çš„è®¾ç½®ï¼Œå…¬å¼å¦‚ä¸‹ï¼š $s_{k}=s_{\min }+\frac{s_{m a x}-s_{\min }}{m-1}(k-1), k \in[1, m]$ï¼Œå…¶ä¸­$m$æŒ‡çš„æ˜¯ç‰¹å¾å›¾ä¸ªæ•°ï¼Œè¿™é‡Œä¸º5ï¼Œå› ä¸ºç¬¬ä¸€å±‚<code>conv4_3</code>çš„Anchoræ˜¯å•ç‹¬è®¾ç½®çš„ï¼Œ$s_{k}$ä»£è¡¨å…ˆéªŒæ¡†å¤§å°ç›¸å¯¹äºåŸå›¾çš„æ¯”ä¾‹ã€‚æœ€åï¼Œ$s_{min}$å’Œ$s_{max}$è¡¨ç¤ºæ¯”ä¾‹çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œè®ºæ–‡ä¸­åˆ†åˆ«å–0.2å’Œ0.9ã€‚å¯¹äºç¬¬ä¸€ä¸ªç‰¹å¾å›¾ï¼Œå®ƒçš„å…ˆéªŒæ¡†å°ºåº¦æ¯”ä¾‹è®¾ç½®ä¸º$s_{min}/2=0.1$ï¼Œåˆ™ä»–çš„å°ºåº¦ä¸º300 x 0.1 = 30ï¼Œåé¢çš„ç‰¹å¾å›¾å¸¦å…¥å…¬å¼è®¡ç®—ï¼Œè®¡ç®—æ—¶$\frac{s_{m a x}-s_{\min }}{m-1}$ä¿ç•™ä¸¤ä½å°æ•°ä¸º0.17ï¼Œæ¯”å¦‚300 x (0.17 x 0 + 0.2) = 60ï¼Œ300 x  (0.17 x 1 + 0.2) = 111ï¼Œæ‰€ä»¥å‰©ä¸‹çš„5ä¸ªç‰¹å¾å›¾çš„min_sizeå°ºåº¦$s_{k}$ä¸º60ï¼Œ111ï¼Œ162ï¼Œ213ï¼Œ264ã€‚ç»¼åˆèµ·æ¥ï¼Œ6ä¸ªç‰¹å¾å›¾çš„min_sizeå°ºåº¦$s_{k}$ä¸º30ï¼Œ60ï¼Œ111ï¼Œ162ï¼Œ213ï¼Œ264ã€‚æœ‰äº†Anchorçš„å°ºåº¦ï¼Œæ¥ä¸‹æ¥è®¾ç½®Anchorçš„é•¿å®½ï¼Œè®ºæ–‡ä¸­é•¿å®½è®¾ç½®ä¸€èˆ¬ä¸º$a_{r}=1,2,3, \frac{1}{2}, \frac{1}{3}$ï¼Œæ ¹æ®é¢ç§¯å’Œé•¿å®½æ¯”å¯ä»¥å¾—åˆ°å…ˆéªŒæ¡†çš„å®½åº¦å’Œé«˜åº¦ï¼š$w_{k}^{a}=s_{k} \sqrt{a_{r}}, h_{k}^{a}=s_{k} / \sqrt{a_{r}}$ ã€‚è¿™é‡Œæœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li><p>ä¸Šé¢çš„$s_{k}$æ˜¯ç›¸å¯¹äºåŸå›¾çš„å¤§å°ã€‚</p>
</li>
<li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç‰¹å¾å›¾é™¤äº†ä¸Šé¢5ä¸ªæ¯”ä¾‹çš„Anchorï¼Œè¿˜ä¼šè®¾ç½®ä¸€ä¸ªå°ºåº¦ä¸º$s_{k}^{\prime}=\sqrt{s_{k} s_{k+1}}$ä¸”$a_{r}=1$çš„å…ˆéªŒæ¡†ï¼Œè¿™æ ·æ¯ä¸ªç‰¹å¾å›¾éƒ½è®¾ç½®äº†ä¸¤ä¸ªé•¿å®½æ¯”ä¸º1ä½†å¤§å°ä¸åŒçš„æ­£æ–¹å½¢å…ˆéªŒæ¡†ã€‚æœ€åä¸€ä¸ªç‰¹å¾å›¾éœ€è¦å‚è€ƒä¸€ä¸ªè™šæ‹Ÿ$s_{k+1}=300\times(0.17\times5 + 0.2) = 315$æ‰€ä»¥ç»¼åˆèµ·æ¥ï¼Œ6ä¸ªç‰¹å¾å›¾çš„max_sizeå°ºåº¦$s_{k}$ä¸º60ï¼Œ111ï¼Œ162ï¼Œ213ï¼Œ264ï¼Œ315ã€‚</p>
</li>
<li><p>åœ¨å®ç°<code>conv4_3</code>,<code>conv10_2</code>,<code>conv11_2</code>å±‚æ—¶ä»…ä½¿ç”¨4ä¸ªå…ˆéªŒæ¡†ï¼Œä¸ä½¿ç”¨é•¿å®½æ¯”ä¸º$3, \frac{1}{3}$çš„Anchorã€‚</p>
</li>
<li><p>æ¯ä¸ªå•å…ƒçš„å…ˆéªŒæ¡†ä¸­å¿ƒç‚¹åˆ†å¸ƒåœ¨æ¯ä¸ªå•å…ƒçš„ä¸­å¿ƒï¼Œå³ï¼š$\left[\frac{i+0.5}{\left|f_{k}\right|}, \frac{j+0.5}{\left|f_{k}\right|}\right], i, j \in\left[0,\left|f_{k}\right|\right]$ ï¼Œå…¶ä¸­$f_{k}$æ˜¯ç‰¹å¾å›¾çš„å¤§å°ã€‚</p>
</li>
</ul>
<p>ä»Anchorçš„å€¼æ¥çœ‹ï¼Œè¶Šå‰é¢çš„ç‰¹å¾å›¾Anchorçš„å°ºå¯¸è¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹å°ç›®æ ‡çš„æ•ˆæœè¶Šå¥½ã€‚å…ˆéªŒæ¡†çš„æ€»æ•°ä¸º<code>num_priors = 38x38x4+19x19x6+10x10x6+5x5x6+3x3x4+1x1x4=8732</code>ã€‚</p>
<p>ç”Ÿæˆå…ˆéªŒæ¡†çš„ä»£ç å¦‚ä¸‹ï¼ˆæ¥è‡ªlayers/functions/prior_box.pyï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorBox</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Compute priorbox coordinates in center-offset form for each source</span></span><br><span class="line"><span class="string">    feature map.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cfg</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(PriorBox, self).__init__()</span><br><span class="line">        self.image_size = cfg[<span class="string">&#x27;min_dim&#x27;</span>]</span><br><span class="line">        <span class="comment"># number of priors for feature map location (either 4 or 6)</span></span><br><span class="line">        self.num_priors = <span class="built_in">len</span>(cfg[<span class="string">&#x27;aspect_ratios&#x27;</span>])</span><br><span class="line">        self.variance = cfg[<span class="string">&#x27;variance&#x27;</span>] <span class="keyword">or</span> [<span class="number">0.1</span>]</span><br><span class="line">        self.feature_maps = cfg[<span class="string">&#x27;feature_maps&#x27;</span>]</span><br><span class="line">        self.min_sizes = cfg[<span class="string">&#x27;min_sizes&#x27;</span>]</span><br><span class="line">        self.max_sizes = cfg[<span class="string">&#x27;max_sizes&#x27;</span>]</span><br><span class="line">        self.steps = cfg[<span class="string">&#x27;steps&#x27;</span>]</span><br><span class="line">        self.aspect_ratios = cfg[<span class="string">&#x27;aspect_ratios&#x27;</span>]</span><br><span class="line">        self.clip = cfg[<span class="string">&#x27;clip&#x27;</span>]</span><br><span class="line">        self.version = cfg[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> self.variance:</span><br><span class="line">            <span class="keyword">if</span> v &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Variances must be greater than 0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self</span>):</span></span><br><span class="line">        mean = []</span><br><span class="line">        <span class="comment"># éå†å¤šå°ºåº¦çš„ ç‰¹å¾å›¾: [38, 19, 10, 5, 3, 1]</span></span><br><span class="line">        <span class="keyword">for</span> k, f <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.feature_maps):</span><br><span class="line">            <span class="comment"># éå†æ¯ä¸ªåƒç´ </span></span><br><span class="line">            <span class="keyword">for</span> i, j <span class="keyword">in</span> product(<span class="built_in">range</span>(f), repeat=<span class="number">2</span>):</span><br><span class="line">                <span class="comment"># k-th å±‚çš„feature map å¤§å°</span></span><br><span class="line">                f_k = self.image_size / self.steps[k]</span><br><span class="line">                <span class="comment"># # æ¯ä¸ªæ¡†çš„ä¸­å¿ƒåæ ‡</span></span><br><span class="line">                cx = (j + <span class="number">0.5</span>) / f_k</span><br><span class="line">                cy = (i + <span class="number">0.5</span>) / f_k</span><br><span class="line"></span><br><span class="line">                <span class="comment"># aspect_ratio: 1 å½“ ratio==1çš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸¤ä¸ª box</span></span><br><span class="line">                <span class="comment"># r==1, size = s_kï¼Œ æ­£æ–¹å½¢</span></span><br><span class="line">                s_k = self.min_sizes[k]/self.image_size</span><br><span class="line">                mean += [cx, cy, s_k, s_k]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># r==1, size = sqrt(s_k * s_(k+1)), æ­£æ–¹å½¢</span></span><br><span class="line">                <span class="comment"># rel size: sqrt(s_k * s_(k+1))</span></span><br><span class="line">                s_k_prime = sqrt(s_k * (self.max_sizes[k]/self.image_size))</span><br><span class="line">                mean += [cx, cy, s_k_prime, s_k_prime]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å½“ ratio != 1 çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„boxä¸ºçŸ©å½¢</span></span><br><span class="line">                <span class="keyword">for</span> ar <span class="keyword">in</span> self.aspect_ratios[k]:</span><br><span class="line">                    mean += [cx, cy, s_k*sqrt(ar), s_k/sqrt(ar)]</span><br><span class="line">                    mean += [cx, cy, s_k/sqrt(ar), s_k*sqrt(ar)]</span><br><span class="line">        <span class="comment"># è½¬åŒ–ä¸º torchçš„Tensor</span></span><br><span class="line">        output = torch.Tensor(mean).view(-<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">        <span class="comment">#å½’ä¸€åŒ–ï¼ŒæŠŠè¾“å‡ºè®¾ç½®åœ¨ [0,1]</span></span><br><span class="line">        <span class="keyword">if</span> self.clip:</span><br><span class="line">            output.clamp_(<span class="built_in">max</span>=<span class="number">1</span>, <span class="built_in">min</span>=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<h3 id="ç½‘ç»œç»“æ„-1"><a href="#ç½‘ç»œç»“æ„-1" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h3><p>ç»“åˆäº†å‰é¢ä»‹ç»çš„é­”æ”¹åçš„VGG16ï¼Œè¿˜æœ‰Extra Layersï¼Œè¿˜æœ‰ç”ŸæˆAnchorçš„Prioboxç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºSSDçš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼ˆä»£ç åœ¨ssd.pyï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SSD</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Single Shot Multibox Architecture</span></span><br><span class="line"><span class="string">    The network is composed of a base VGG network followed by the</span></span><br><span class="line"><span class="string">    added multibox conv layers.  Each multibox layer branches into</span></span><br><span class="line"><span class="string">        1) conv2d for class conf scores</span></span><br><span class="line"><span class="string">        2) conv2d for localization predictions</span></span><br><span class="line"><span class="string">        3) associated priorbox layer to produce default bounding</span></span><br><span class="line"><span class="string">           boxes specific to the layer&#x27;s feature map size.</span></span><br><span class="line"><span class="string">    See: https://arxiv.org/pdf/1512.02325.pdf for more details.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        phase: (string) Can be &quot;test&quot; or &quot;train&quot;</span></span><br><span class="line"><span class="string">        size: input image size</span></span><br><span class="line"><span class="string">        base: VGG16 layers for input, size of either 300 or 500</span></span><br><span class="line"><span class="string">        extras: extra layers that feed to multibox loc and conf layers</span></span><br><span class="line"><span class="string">        head: &quot;multibox head&quot; consists of loc and conf conv layers</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, phase, size, base, extras, head, num_classes</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SSD, self).__init__()</span><br><span class="line">        self.phase = phase</span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line">        <span class="comment"># é…ç½®config</span></span><br><span class="line">        self.cfg = (coco, voc)[num_classes == <span class="number">21</span>]</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–å…ˆéªŒæ¡†</span></span><br><span class="line">        self.priorbox = PriorBox(self.cfg)</span><br><span class="line">        self.priors = Variable(self.priorbox.forward(), volatile=<span class="literal">True</span>)</span><br><span class="line">        self.size = size</span><br><span class="line"></span><br><span class="line">        <span class="comment"># SSD network</span></span><br><span class="line">        <span class="comment"># backboneç½‘ç»œ</span></span><br><span class="line">        self.vgg = nn.ModuleList(base)</span><br><span class="line">        <span class="comment"># Layer learns to scale the l2 normalized features from conv4_3</span></span><br><span class="line">        <span class="comment"># conv4_3åé¢çš„ç½‘ç»œï¼ŒL2 æ­£åˆ™åŒ–</span></span><br><span class="line">        self.L2Norm = L2Norm(<span class="number">512</span>, <span class="number">20</span>)</span><br><span class="line">        self.extras = nn.ModuleList(extras)</span><br><span class="line">        <span class="comment"># å›å½’å’Œåˆ†ç±»ç½‘ç»œ</span></span><br><span class="line">        self.loc = nn.ModuleList(head[<span class="number">0</span>])</span><br><span class="line">        self.conf = nn.ModuleList(head[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> phase == <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">            self.softmax = nn.Softmax(dim=-<span class="number">1</span>)</span><br><span class="line">            self.detect = Detect(num_classes, <span class="number">0</span>, <span class="number">200</span>, <span class="number">0.01</span>, <span class="number">0.45</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Applies network layers and ops on input image(s) x.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input image or batch of images. Shape: [batch,3,300,300].</span></span><br><span class="line"><span class="string">        Return:</span></span><br><span class="line"><span class="string">            Depending on phase:</span></span><br><span class="line"><span class="string">            test:</span></span><br><span class="line"><span class="string">                Variable(tensor) of output class label predictions,</span></span><br><span class="line"><span class="string">                confidence score, and corresponding location predictions for</span></span><br><span class="line"><span class="string">                each object detected. Shape: [batch,topk,7]</span></span><br><span class="line"><span class="string">            train:</span></span><br><span class="line"><span class="string">                list of concat outputs from:</span></span><br><span class="line"><span class="string">                    1: confidence layers, Shape: [batch*num_priors,num_classes]</span></span><br><span class="line"><span class="string">                    2: localization layers, Shape: [batch,num_priors*4]</span></span><br><span class="line"><span class="string">                    3: priorbox layers, Shape: [2,num_priors*4]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        sources = <span class="built_in">list</span>()</span><br><span class="line">        loc = <span class="built_in">list</span>()</span><br><span class="line">        conf = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply vgg up to conv4_3 relu</span></span><br><span class="line">        <span class="comment"># vggç½‘ç»œåˆ°conv4_3</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">            x = self.vgg[k](x)</span><br><span class="line">        <span class="comment"># l2 æ­£åˆ™åŒ–</span></span><br><span class="line">        s = self.L2Norm(x)</span><br><span class="line">        sources.append(s)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply vgg up to fc7</span></span><br><span class="line">        <span class="comment"># conv4_3 åˆ° fc</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>, <span class="built_in">len</span>(self.vgg)):</span><br><span class="line">            x = self.vgg[k](x)</span><br><span class="line">        sources.append(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply extra layers and cache source layer outputs</span></span><br><span class="line">        <span class="comment"># extras ç½‘ç»œ</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.extras):</span><br><span class="line">            x = F.relu(v(x), inplace=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">if</span> k % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># æŠŠéœ€è¦è¿›è¡Œå¤šå°ºåº¦çš„ç½‘ç»œè¾“å‡ºå­˜å…¥ sources</span></span><br><span class="line">                sources.append(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply multibox head to source layers</span></span><br><span class="line">        <span class="comment"># å¤šå°ºåº¦å›å½’å’Œåˆ†ç±»ç½‘ç»œ</span></span><br><span class="line">        <span class="keyword">for</span> (x, l, c) <span class="keyword">in</span> <span class="built_in">zip</span>(sources, self.loc, self.conf):</span><br><span class="line">            loc.append(l(x).permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>).contiguous())</span><br><span class="line">            conf.append(c(x).permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>).contiguous())</span><br><span class="line"></span><br><span class="line">        loc = torch.cat([o.view(o.size(<span class="number">0</span>), -<span class="number">1</span>) <span class="keyword">for</span> o <span class="keyword">in</span> loc], <span class="number">1</span>)</span><br><span class="line">        conf = torch.cat([o.view(o.size(<span class="number">0</span>), -<span class="number">1</span>) <span class="keyword">for</span> o <span class="keyword">in</span> conf], <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> self.phase == <span class="string">&quot;test&quot;</span>:</span><br><span class="line">            output = self.detect(</span><br><span class="line">                loc.view(loc.size(<span class="number">0</span>), -<span class="number">1</span>, <span class="number">4</span>),                   <span class="comment"># loc preds</span></span><br><span class="line">                self.softmax(conf.view(conf.size(<span class="number">0</span>), -<span class="number">1</span>,</span><br><span class="line">                             self.num_classes)),                <span class="comment"># conf preds</span></span><br><span class="line">                self.priors.<span class="built_in">type</span>(<span class="built_in">type</span>(x.data))                  <span class="comment"># default boxes</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output = (</span><br><span class="line">                <span class="comment"># locçš„è¾“å‡ºï¼Œsize:(batch, 8732, 4)</span></span><br><span class="line">                loc.view(loc.size(<span class="number">0</span>), -<span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">                <span class="comment"># confçš„è¾“å‡ºï¼Œsize:(batch, 8732, 21)</span></span><br><span class="line">                conf.view(conf.size(<span class="number">0</span>), -<span class="number">1</span>, self.num_classes),</span><br><span class="line">                <span class="comment"># ç”Ÿæˆæ‰€æœ‰çš„å€™é€‰æ¡† size([8732, 4])</span></span><br><span class="line">                self.priors</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    <span class="comment"># åŠ è½½æ¨¡å‹å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_weights</span>(<span class="params">self, base_file</span>):</span></span><br><span class="line">        other, ext = os.path.splitext(base_file)</span><br><span class="line">        <span class="keyword">if</span> ext == <span class="string">&#x27;.pkl&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;.pth&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Loading weights into state dict...&#x27;</span>)</span><br><span class="line">            self.load_state_dict(torch.load(base_file,</span><br><span class="line">                                 map_location=<span class="keyword">lambda</span> storage, loc: storage))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Finished!&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;Sorry only .pth and .pkl files supported.&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¸ºäº†å¢åŠ å¯è¯»æ€§ï¼Œé‡æ–°å°è£…äº†ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">base = &#123;</span><br><span class="line">    <span class="string">&#x27;300&#x27;</span>: [<span class="number">64</span>, <span class="number">64</span>, <span class="string">&#x27;M&#x27;</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="string">&#x27;M&#x27;</span>, <span class="number">256</span>, <span class="number">256</span>, <span class="number">256</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="string">&#x27;M&#x27;</span>,</span><br><span class="line">            <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>],</span><br><span class="line">    <span class="string">&#x27;512&#x27;</span>: [],</span><br><span class="line">&#125;</span><br><span class="line">extras = &#123;</span><br><span class="line">    <span class="string">&#x27;300&#x27;</span>: [<span class="number">256</span>, <span class="string">&#x27;S&#x27;</span>, <span class="number">512</span>, <span class="number">128</span>, <span class="string">&#x27;S&#x27;</span>, <span class="number">256</span>, <span class="number">128</span>, <span class="number">256</span>, <span class="number">128</span>, <span class="number">256</span>],</span><br><span class="line">    <span class="string">&#x27;512&#x27;</span>: [],</span><br><span class="line">&#125;</span><br><span class="line">mbox = &#123;</span><br><span class="line">    <span class="string">&#x27;300&#x27;</span>: [<span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">4</span>],  <span class="comment"># number of boxes per feature map location</span></span><br><span class="line">    <span class="string">&#x27;512&#x27;</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_ssd</span>(<span class="params">phase, size=<span class="number">300</span>, num_classes=<span class="number">21</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> phase != <span class="string">&quot;test&quot;</span> <span class="keyword">and</span> phase != <span class="string">&quot;train&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ERROR: Phase: &quot;</span> + phase + <span class="string">&quot; not recognized&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> size != <span class="number">300</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ERROR: You specified size &quot;</span> + <span class="built_in">repr</span>(size) + <span class="string">&quot;. However, &quot;</span> +</span><br><span class="line">              <span class="string">&quot;currently only SSD300 (size=300) is supported!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨multiboxï¼Œç”Ÿæˆvgg,extras,head</span></span><br><span class="line">    base_, extras_, head_ = multibox(vgg(base[<span class="built_in">str</span>(size)], <span class="number">3</span>),</span><br><span class="line">                                     add_extras(extras[<span class="built_in">str</span>(size)], <span class="number">1024</span>),</span><br><span class="line">                                     mbox[<span class="built_in">str</span>(size)], num_classes)</span><br><span class="line">	<span class="keyword">return</span> SSD(phase, size, base_, extras_, head_, num_classes)</span><br></pre></td></tr></table></figure>
<h3 id="Lossè§£æ"><a href="#Lossè§£æ" class="headerlink" title="Lossè§£æ"></a>Lossè§£æ</h3><p>SSDçš„æŸå¤±å‡½æ•°åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯å®šä½æŸå¤±$L_{l o c}$ï¼Œä¸€ä¸ªæ˜¯åˆ†ç±»æŸå¤±$L_{conf}$ï¼Œæ•´ä¸ªæŸå¤±å‡½æ•°è¡¨è¾¾å¦‚ä¸‹ï¼š$L(x, c, l, g)=\frac{1}{N}\left(L_{c o n f}(x, c)+\alpha L_{l o c}(x, l, g)\right)$ å…¶ä¸­ï¼Œ$N$æ˜¯å…ˆéªŒæ¡†çš„æ­£æ ·æœ¬æ•°é‡ï¼Œ$c$æ˜¯ç±»åˆ«ç½®ä¿¡åº¦é¢„æµ‹å€¼ï¼Œ$l$æ˜¯å…ˆéªŒæ¡†å¯¹åº”çš„è¾¹ç•Œæ¡†é¢„æµ‹å€¼ï¼Œ$g$æ˜¯ground truthçš„ä½ç½®å‚æ•°ï¼Œ$x$ä»£è¡¨ç½‘ç»œçš„é¢„æµ‹å€¼ã€‚å¯¹äºä½ç½®æŸå¤±ï¼Œé‡‡ç”¨Smooth L1 Lossï¼Œä½ç½®ä¿¡æ¯éƒ½æ˜¯<code>encode</code>ä¹‹åçš„æ•°å€¼ï¼Œåé¢ä¼šè®²è¿™ä¸ªencodeçš„è¿‡ç¨‹ã€‚è€Œå¯¹äºåˆ†ç±»æŸå¤±ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨<code>hard negtive mining</code>å°†æ­£è´Ÿæ ·æœ¬æŒ‰ç…§<code>1:3</code> çš„æ¯”ä¾‹æŠŠè´Ÿæ ·æœ¬æŠ½æ ·å‡ºæ¥ï¼ŒæŠ½æ ·çš„æ–¹æ³•æ˜¯ï¼šé’ˆå¯¹æ‰€æœ‰batchçš„confidenceï¼ŒæŒ‰ç…§ç½®ä¿¡åº¦è¯¯å·®è¿›è¡Œé™åºæ’åˆ—ï¼Œå–å‡ºå‰<code>top_k</code>ä¸ªè´Ÿæ ·æœ¬ã€‚æŸå¤±å‡½æ•°å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ssd/643.png" alt></p>
<h4 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><ul>
<li>Reshapeæ‰€æœ‰batchä¸­çš„confï¼Œå³ä»£ç ä¸­çš„<code>batch_conf = conf_data.view(-1, self.num_classes)</code>ï¼Œæ–¹ä¾¿åç»­æ’åºã€‚</li>
<li>ç½®ä¿¡åº¦è¯¯å·®è¶Šå¤§ï¼Œå®é™…ä¸Šå°±æ˜¯é¢„æµ‹èƒŒæ™¯çš„ç½®ä¿¡åº¦è¶Šå°ã€‚</li>
<li>æŠŠæ‰€æœ‰confè¿›è¡Œ<code>logsoftmax</code>å¤„ç†(å‡ä¸ºè´Ÿå€¼)ï¼Œé¢„æµ‹çš„ç½®ä¿¡åº¦è¶Šå°ï¼Œåˆ™<code>logsoftmax</code>è¶Šå°ï¼Œå–ç»å¯¹å€¼ï¼Œåˆ™<code>|logsoftmax|</code>è¶Šå¤§ï¼Œé™åºæ’åˆ—<code>-logsoftmax</code>ï¼Œå–å‰<code>top_k</code>çš„è´Ÿæ ·æœ¬ã€‚å…¶ä¸­ï¼Œlog_sum_expå‡½æ•°çš„ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_sum_exp</span>(<span class="params">x</span>):</span></span><br><span class="line">    x_max = x.detach().<span class="built_in">max</span>()</span><br><span class="line">    <span class="keyword">return</span> torch.log(torch.<span class="built_in">sum</span>(torch.exp(x-x_max), <span class="number">1</span>, keepdim=<span class="literal">True</span>))+x_max</span><br></pre></td></tr></table></figure>
<p>åˆ†ç±»æŸå¤±<code>conf_logP</code>å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conf_logP = log_sum_exp(batch_conf) - batch_conf.gather(<span class="number">1</span>, conf_t.view(-<span class="number">1</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è®¡ç®—çš„åŸå› ä¸»è¦æ˜¯ä¸ºäº†å¢å¼º<code>logsoftmax</code>æŸå¤±çš„æ•°å€¼ç¨³å®šæ€§ã€‚æ”¾ä¸€å¼ æ‰‹æ¨å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ssd/644.webp" alt></p>
<p>æŸå¤±å‡½æ•°å®Œæ•´ä»£ç å®ç°ï¼Œæ¥è‡ª<code>layers/modules/multibox_loss.py</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiBoxLoss</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;SSD Weighted Loss Function</span></span><br><span class="line"><span class="string">    Compute Targets:</span></span><br><span class="line"><span class="string">        1) Produce Confidence Target Indices by matching  ground truth boxes</span></span><br><span class="line"><span class="string">           with (default) &#x27;priorboxes&#x27; that have jaccard index &gt; threshold parameter</span></span><br><span class="line"><span class="string">           (default threshold: 0.5).</span></span><br><span class="line"><span class="string">        2) Produce localization target by &#x27;encoding&#x27; variance into offsets of ground</span></span><br><span class="line"><span class="string">           truth boxes and their matched  &#x27;priorboxes&#x27;.</span></span><br><span class="line"><span class="string">        3) Hard negative mining to filter the excessive number of negative examples</span></span><br><span class="line"><span class="string">           that comes with using a large number of default bounding boxes.</span></span><br><span class="line"><span class="string">           (default negative:positive ratio 3:1)</span></span><br><span class="line"><span class="string">    Objective Loss:</span></span><br><span class="line"><span class="string">        L(x,c,l,g) = (Lconf(x, c) + Î±Lloc(x,l,g)) / N</span></span><br><span class="line"><span class="string">        Where, Lconf is the CrossEntropy Loss and Lloc is the SmoothL1 Loss</span></span><br><span class="line"><span class="string">        weighted by Î± which is set to 1 by cross val.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            c: class confidences,</span></span><br><span class="line"><span class="string">            l: predicted boxes,</span></span><br><span class="line"><span class="string">            g: ground truth boxes</span></span><br><span class="line"><span class="string">            N: number of matched default boxes</span></span><br><span class="line"><span class="string">        See: https://arxiv.org/pdf/1512.02325.pdf for more details.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes, overlap_thresh, prior_for_matching,</span></span></span><br><span class="line"><span class="params"><span class="function">                 bkg_label, neg_mining, neg_pos, neg_overlap, encode_target,</span></span></span><br><span class="line"><span class="params"><span class="function">                 use_gpu=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(MultiBoxLoss, self).__init__()</span><br><span class="line">        self.use_gpu = use_gpu</span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line">        self.threshold = overlap_thresh</span><br><span class="line">        self.background_label = bkg_label</span><br><span class="line">        self.encode_target = encode_target</span><br><span class="line">        self.use_prior_for_matching = prior_for_matching</span><br><span class="line">        self.do_neg_mining = neg_mining</span><br><span class="line">        self.negpos_ratio = neg_pos</span><br><span class="line">        self.neg_overlap = neg_overlap</span><br><span class="line">        self.variance = cfg[<span class="string">&#x27;variance&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, predictions, targets</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Multibox Loss</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            predictions (tuple): A tuple containing loc preds, conf preds,</span></span><br><span class="line"><span class="string">            and prior boxes from SSD net.</span></span><br><span class="line"><span class="string">                conf shape: torch.size(batch_size,num_priors,num_classes)</span></span><br><span class="line"><span class="string">                loc shape: torch.size(batch_size,num_priors,4)</span></span><br><span class="line"><span class="string">                priors shape: torch.size(num_priors,4)</span></span><br><span class="line"><span class="string">            targets (tensor): Ground truth boxes and labels for a batch,</span></span><br><span class="line"><span class="string">                shape: [batch_size,num_objs,5] (last idx is the label).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        loc_data, conf_data, priors = predictions</span><br><span class="line">        num = loc_data.size(<span class="number">0</span>)<span class="comment"># batch_size</span></span><br><span class="line">        priors = priors[:loc_data.size(<span class="number">1</span>), :]</span><br><span class="line">        num_priors = (priors.size(<span class="number">0</span>)) <span class="comment"># å…ˆéªŒæ¡†ä¸ªæ•°</span></span><br><span class="line">        num_classes = self.num_classes <span class="comment">#ç±»åˆ«æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># match priors (default boxes) and ground truth boxes</span></span><br><span class="line">        <span class="comment"># è·å–åŒ¹é…æ¯ä¸ªprior boxçš„ ground truth</span></span><br><span class="line">        <span class="comment"># åˆ›å»º loc_t å’Œ conf_t ä¿å­˜çœŸå®boxçš„ä½ç½®å’Œç±»åˆ«</span></span><br><span class="line">        loc_t = torch.Tensor(num, num_priors, <span class="number">4</span>)</span><br><span class="line">        conf_t = torch.LongTensor(num, num_priors)</span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            truths = targets[idx][:, :-<span class="number">1</span>].data <span class="comment">#ground truth boxä¿¡æ¯</span></span><br><span class="line">            labels = targets[idx][:, -<span class="number">1</span>].data <span class="comment"># ground truth confä¿¡æ¯</span></span><br><span class="line">            defaults = priors.data <span class="comment"># priorsçš„ box ä¿¡æ¯</span></span><br><span class="line">            <span class="comment"># åŒ¹é… ground truth</span></span><br><span class="line">            match(self.threshold, truths, defaults, self.variance, labels,</span><br><span class="line">                  loc_t, conf_t, idx)</span><br><span class="line">        <span class="keyword">if</span> self.use_gpu:</span><br><span class="line">            loc_t = loc_t.cuda()</span><br><span class="line">            conf_t = conf_t.cuda()</span><br><span class="line">        <span class="comment"># wrap targets</span></span><br><span class="line">        loc_t = Variable(loc_t, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        conf_t = Variable(conf_t, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># åŒ¹é…ä¸­æ‰€æœ‰çš„æ­£æ ·æœ¬mask,shape[b,M]</span></span><br><span class="line">        pos = conf_t &gt; <span class="number">0</span></span><br><span class="line">        num_pos = pos.<span class="built_in">sum</span>(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># Localization Loss,ä½¿ç”¨ Smooth L1</span></span><br><span class="line">        <span class="comment"># shape[b,M]--&gt;shape[b,M,4]</span></span><br><span class="line">        pos_idx = pos.unsqueeze(pos.dim()).expand_as(loc_data)</span><br><span class="line">        loc_p = loc_data[pos_idx].view(-<span class="number">1</span>, <span class="number">4</span>) <span class="comment">#é¢„æµ‹çš„æ­£æ ·æœ¬boxä¿¡æ¯</span></span><br><span class="line">        loc_t = loc_t[pos_idx].view(-<span class="number">1</span>, <span class="number">4</span>) <span class="comment">#çœŸå®çš„æ­£æ ·æœ¬boxä¿¡æ¯</span></span><br><span class="line">        loss_l = F.smooth_l1_loss(loc_p, loc_t, size_average=<span class="literal">False</span>) <span class="comment">#Smooth L1 æŸå¤±</span></span><br><span class="line">		</span><br><span class="line">		<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Targetï¼›</span></span><br><span class="line"><span class="string">            ä¸‹é¢è¿›è¡Œhard negative mining</span></span><br><span class="line"><span class="string">        è¿‡ç¨‹:</span></span><br><span class="line"><span class="string">            1ã€ é’ˆå¯¹æ‰€æœ‰batchçš„confï¼ŒæŒ‰ç…§ç½®ä¿¡åº¦è¯¯å·®(é¢„æµ‹èƒŒæ™¯çš„ç½®ä¿¡åº¦è¶Šå°ï¼Œè¯¯å·®è¶Šå¤§)è¿›è¡Œé™åºæ’åˆ—;</span></span><br><span class="line"><span class="string">            2ã€ è´Ÿæ ·æœ¬çš„labelå…¨æ˜¯èƒŒæ™¯ï¼Œé‚£ä¹ˆåˆ©ç”¨log softmax è®¡ç®—å‡ºlogP,</span></span><br><span class="line"><span class="string">               logPè¶Šå¤§ï¼Œåˆ™èƒŒæ™¯æ¦‚ç‡è¶Šä½,è¯¯å·®è¶Šå¤§;</span></span><br><span class="line"><span class="string">            3ã€ é€‰å–è¯¯å·®è¾ƒå¤§çš„top_kä½œä¸ºè´Ÿæ ·æœ¬ï¼Œä¿è¯æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹æ¥è¿‘1:3;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># Compute max conf across batch for hard negative mining</span></span><br><span class="line">        <span class="comment"># shape[b*M,num_classes]</span></span><br><span class="line">        batch_conf = conf_data.view(-<span class="number">1</span>, self.num_classes)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨logsoftmaxï¼Œè®¡ç®—ç½®ä¿¡åº¦,shape[b*M, 1]</span></span><br><span class="line">        loss_c = log_sum_exp(batch_conf) - batch_conf.gather(<span class="number">1</span>, conf_t.view(-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Hard Negative Mining</span></span><br><span class="line">        loss_c[pos] = <span class="number">0</span>  <span class="comment"># æŠŠæ­£æ ·æœ¬æ’é™¤ï¼Œå‰©ä¸‹çš„å°±å…¨æ˜¯è´Ÿæ ·æœ¬ï¼Œå¯ä»¥è¿›è¡ŒæŠ½æ ·</span></span><br><span class="line">        loss_c = loss_c.view(num, -<span class="number">1</span>)<span class="comment"># shape[b, M]</span></span><br><span class="line">        <span class="comment"># éš¾é¢„æµ‹çš„æŸå¤±å¤§</span></span><br><span class="line">        <span class="comment"># ä¸¤æ¬¡sortæ’åºï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸ªå…ƒç´ åœ¨é™åºæ’åˆ—ä¸­çš„ä½ç½®idx_rank</span></span><br><span class="line">        <span class="comment"># å³å¾—åˆ°åŸTensorçš„å…ƒç´ æŒ‰dimæŒ‡å®šç»´åº¦ï¼Œæ’ç¬¬å‡ ï¼Œç´¢å¼•å˜æˆäº†æ’å</span></span><br><span class="line">        <span class="comment"># æ¯”å¦‚[4, 9, 7, 8, 5]</span></span><br><span class="line">        <span class="comment"># ç¬¬ä¸€æ¬¡sortæ’åºç»“æœä¸º[9,8,7,5,4] å¯¹åº”ç´¢å¼•ä¸º[1,3,2,4,0]</span></span><br><span class="line">        <span class="comment"># ç¬¬äºŒæ¬¡sortæ’åºç»“æœä¸º[0,1,2,3,4] å¯¹åº”ç´¢å¼•ä¸º[4,0,2,1,3]</span></span><br><span class="line">        <span class="comment"># å³ç¬¬ä¸€æ’çš„å…ƒç´ 9ï¼Œå®ƒæ˜¯ç¬¬ä¸€æ’ï¼ˆä¹Ÿå°±æ˜¯æŒ‰dim=1çœ‹ï¼‰é‡Œé¢æœ€å¤§çš„ï¼Œæ‰€ä»¥å®ƒçš„æ’åæ˜¯0ï¼ŒåŸTensorç¬¬ä¸€æ’çš„å…ƒç´ 4ï¼Œå®ƒæ˜¯ç¬¬ä¸€æ’é‡Œé¢æœ€å°çš„ï¼Œæ‰€ä»¥å®ƒçš„æ’åæ˜¯4</span></span><br><span class="line">        _, loss_idx = loss_c.sort(<span class="number">1</span>, descending=<span class="literal">True</span>) </span><br><span class="line">        _, idx_rank = loss_idx.sort(<span class="number">1</span>) </span><br><span class="line">        <span class="comment"># æŠ½å–è´Ÿæ ·æœ¬</span></span><br><span class="line">        <span class="comment"># æ¯ä¸ªbatchä¸­æ­£æ ·æœ¬çš„æ•°ç›®ï¼Œshape[b,1]</span></span><br><span class="line">        num_pos = pos.long().<span class="built_in">sum</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        num_neg = torch.clamp(self.negpos_ratio*num_pos, <span class="built_in">max</span>=pos.size(<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å°äºnum_negä¸ºTrueï¼Œé™åˆ¶è´Ÿæ ·æœ¬çš„æ•°é‡ï¼Œshape[b, M]</span></span><br><span class="line">        <span class="comment"># æ’åé å‰çš„ç•™ä¸‹</span></span><br><span class="line">        neg = idx_rank &lt; num_neg.expand_as(idx_rank)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Confidence Loss Including Positive and Negative Examples</span></span><br><span class="line">        <span class="comment"># shape[b,M] --&gt; shape[b,M,num_classes]</span></span><br><span class="line">        pos_idx = pos.unsqueeze(<span class="number">2</span>).expand_as(conf_data)</span><br><span class="line">        neg_idx = neg.unsqueeze(<span class="number">2</span>).expand_as(conf_data)</span><br><span class="line">        <span class="comment"># æå–å‡ºæ‰€æœ‰ç­›é€‰å¥½çš„æ­£è´Ÿæ ·æœ¬(é¢„æµ‹çš„å’ŒçœŸå®çš„)</span></span><br><span class="line">        conf_p = conf_data[(pos_idx+neg_idx).gt(<span class="number">0</span>)].view(-<span class="number">1</span>, self.num_classes)</span><br><span class="line">        targets_weighted = conf_t[(pos+neg).gt(<span class="number">0</span>)]</span><br><span class="line">        <span class="comment"># è®¡ç®—confäº¤å‰ç†µ</span></span><br><span class="line">        loss_c = F.cross_entropy(conf_p, targets_weighted, size_average=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sum of losses: L(x,c,l,g) = (Lconf(x, c) + Î±Lloc(x,l,g)) / N</span></span><br><span class="line">		<span class="comment"># æ­£æ ·æœ¬ä¸ªæ•°</span></span><br><span class="line">        N = num_pos.data.<span class="built_in">sum</span>()</span><br><span class="line">        loss_l /= N</span><br><span class="line">        loss_c /= N</span><br><span class="line">		<span class="keyword">return</span> loss_l, loss_c</span><br></pre></td></tr></table></figure>
<h4 id="å…ˆéªŒæ¡†åŒ¹é…ç­–ç•¥"><a href="#å…ˆéªŒæ¡†åŒ¹é…ç­–ç•¥" class="headerlink" title="å…ˆéªŒæ¡†åŒ¹é…ç­–ç•¥"></a>å…ˆéªŒæ¡†åŒ¹é…ç­–ç•¥</h4><p>ä¸Šé¢çš„ä»£ç ä¸­è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡è®²åˆ°ï¼Œå°±æ˜¯matchå‡½æ•°ã€‚è¿™æ˜¯SSDç®—æ³•çš„å…ˆéªŒæ¡†åŒ¹é…å‡½æ•°ã€‚åœ¨è®­ç»ƒæ—¶é¦–å…ˆéœ€è¦ç¡®å®šè®­ç»ƒå›¾ç‰‡ä¸­çš„ground truthæ˜¯ç”±å“ªä¸€ä¸ªå…ˆéªŒæ¡†æ¥åŒ¹é…ï¼Œä¸ä¹‹åŒ¹é…çš„å…ˆéªŒæ¡†æ‰€å¯¹åº”çš„è¾¹ç•Œæ¡†å°†è´Ÿè´£é¢„æµ‹å®ƒã€‚SSDçš„å…ˆéªŒæ¡†å’Œground  truthåŒ¹é…åŸåˆ™ä¸»è¦æœ‰2ç‚¹ã€‚ç¬¬ä¸€ç‚¹æ˜¯å¯¹äºå›¾ç‰‡ä¸­çš„æ¯ä¸ªground  truthï¼Œæ‰¾åˆ°å’Œå®ƒIOUæœ€å¤§çš„å…ˆéªŒæ¡†ï¼Œè¯¥å…ˆéªŒæ¡†ä¸å…¶åŒ¹é…ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªground  truthä¸€å®šä¸æŸä¸ªprioråŒ¹é…ã€‚ç¬¬äºŒç‚¹æ˜¯å¯¹äºå‰©ä½™çš„æœªåŒ¹é…çš„å…ˆéªŒæ¡†ï¼Œè‹¥æŸä¸ªground  truthå’Œå®ƒçš„IOUå¤§äºæŸä¸ªé˜ˆå€¼(ä¸€èˆ¬è®¾ä¸º0.5)ï¼Œé‚£ä¹ˆè¯¥priorå’Œè¿™ä¸ªground  truthåŒ¹é…ï¼Œå‰©ä¸‹æ²¡æœ‰åŒ¹é…ä¸Šçš„å…ˆéªŒæ¡†éƒ½æ˜¯è´Ÿæ ·æœ¬ï¼ˆå¦‚æœå¤šä¸ªground  truthå’ŒæŸä¸€ä¸ªå…ˆéªŒæ¡†çš„IOUå‡å¤§äºé˜ˆå€¼ï¼Œé‚£ä¹ˆprioråªä¸IOUæœ€å¤§çš„é‚£ä¸ªè¿›è¡ŒåŒ¹é…ï¼‰ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼Œæ¥è‡ª<code>layers/box_utils.py</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">match</span>(<span class="params">threshold, truths, priors, variances, labels, loc_t, conf_t, idx</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æŠŠå’Œæ¯ä¸ªprior box æœ‰æœ€å¤§çš„IOUçš„ground truth boxè¿›è¡ŒåŒ¹é…ï¼Œ</span></span><br><span class="line"><span class="string">    åŒæ—¶ï¼Œç¼–ç åŒ…å›´æ¡†ï¼Œè¿”å›åŒ¹é…çš„ç´¢å¼•ï¼Œå¯¹åº”çš„ç½®ä¿¡åº¦å’Œä½ç½®</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        threshold: IOUé˜ˆå€¼ï¼Œå°äºé˜ˆå€¼è®¾ä¸ºèƒŒæ™¯</span></span><br><span class="line"><span class="string">        truths: ground truth boxes, shape[N,4]</span></span><br><span class="line"><span class="string">        priors: å…ˆéªŒæ¡†ï¼Œ shape[M,4]</span></span><br><span class="line"><span class="string">        variances: priorçš„æ–¹å·®, list(float)</span></span><br><span class="line"><span class="string">        labels: å›¾ç‰‡çš„æ‰€æœ‰ç±»åˆ«ï¼Œshape[num_obj]</span></span><br><span class="line"><span class="string">        loc_t: ç”¨äºå¡«å……encoded loc ç›®æ ‡å¼ é‡</span></span><br><span class="line"><span class="string">        conf_t: ç”¨äºå¡«å……encoded conf ç›®æ ‡å¼ é‡</span></span><br><span class="line"><span class="string">        idx: ç°åœ¨çš„batch index</span></span><br><span class="line"><span class="string">        The matched indices corresponding to 1)location and 2)confidence preds.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># jaccard index</span></span><br><span class="line">    <span class="comment"># è®¡ç®—IOU</span></span><br><span class="line">    overlaps = jaccard(</span><br><span class="line">        truths,</span><br><span class="line">        point_form(priors)</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># (Bipartite Matching)</span></span><br><span class="line">    <span class="comment"># [1,num_objects] å’Œæ¯ä¸ªground truth box äº¤é›†æœ€å¤§çš„ prior box</span></span><br><span class="line">    best_prior_overlap, best_prior_idx = overlaps.<span class="built_in">max</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># [1,num_priors] å’Œæ¯ä¸ªprior box äº¤é›†æœ€å¤§çš„ ground truth box</span></span><br><span class="line">    best_truth_overlap, best_truth_idx = overlaps.<span class="built_in">max</span>(<span class="number">0</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">    best_truth_idx.squeeze_(<span class="number">0</span>) <span class="comment">#M</span></span><br><span class="line">    best_truth_overlap.squeeze_(<span class="number">0</span>) <span class="comment">#M</span></span><br><span class="line">    best_prior_idx.squeeze_(<span class="number">1</span>) <span class="comment">#N</span></span><br><span class="line">    best_prior_overlap.squeeze_(<span class="number">1</span>) <span class="comment">#N</span></span><br><span class="line">    <span class="comment"># ä¿è¯æ¯ä¸ªground truth box ä¸æŸä¸€ä¸ªprior box åŒ¹é…ï¼Œå›ºå®šå€¼ä¸º 2 &gt; threshold</span></span><br><span class="line">    best_truth_overlap.index_fill_(<span class="number">0</span>, best_prior_idx, <span class="number">2</span>)  <span class="comment"># ensure best prior</span></span><br><span class="line">    <span class="comment"># TODO refactor: index  best_prior_idx with long tensor</span></span><br><span class="line">    <span class="comment"># ensure every gt matches with its prior of max overlap</span></span><br><span class="line">    <span class="comment"># ä¿è¯æ¯ä¸€ä¸ªground truth åŒ¹é…å®ƒçš„éƒ½æ˜¯å…·æœ‰æœ€å¤§IOUçš„prior</span></span><br><span class="line">    <span class="comment"># æ ¹æ® best_prior_dix é”å®š best_truth_idxé‡Œé¢çš„æœ€å¤§IOU prior</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(best_prior_idx.size(<span class="number">0</span>)):</span><br><span class="line">        best_truth_idx[best_prior_idx[j]] = j</span><br><span class="line">    matches = truths[best_truth_idx]          <span class="comment"># æå–å‡ºæ‰€æœ‰åŒ¹é…çš„ground truth box, Shape: [M,4]</span></span><br><span class="line">    conf = labels[best_truth_idx] + <span class="number">1</span>         <span class="comment"># æå–å‡ºæ‰€æœ‰GTæ¡†çš„ç±»åˆ«ï¼Œ Shape:[M]</span></span><br><span class="line">    <span class="comment"># æŠŠ iou &lt; threshold çš„æ¡†ç±»åˆ«è®¾ç½®ä¸º bg,å³ä¸º0</span></span><br><span class="line">    conf[best_truth_overlap &lt; threshold] = <span class="number">0</span>  <span class="comment"># label as background</span></span><br><span class="line">    <span class="comment"># ç¼–ç åŒ…å›´æ¡†</span></span><br><span class="line">    loc = encode(matches, priors, variances)</span><br><span class="line">    <span class="comment"># ä¿å­˜åŒ¹é…å¥½çš„locå’Œconfåˆ°loc_tå’Œconf_tä¸­</span></span><br><span class="line">    loc_t[idx] = loc    <span class="comment"># [num_priors,4] encoded offsets to learn</span></span><br><span class="line">    conf_t[idx] = conf  <span class="comment"># [num_priors] top class label for each prior</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½ç½®åæ ‡è½¬æ¢"><a href="#ä½ç½®åæ ‡è½¬æ¢" class="headerlink" title="ä½ç½®åæ ‡è½¬æ¢"></a>ä½ç½®åæ ‡è½¬æ¢</h3><p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢å‡ºç°äº†ä¸€ä¸ªpoint_formå‡½æ•°ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºç›®æ ‡æ¡†æœ‰2ç§è¡¨ç¤ºæ–¹å¼ï¼š</p>
<ul>
<li>$\left(x_{\min }, y_{\min }, x_{\max }, y_{\max }\right)$</li>
<li>$(x, y, w, h)$è¿™éƒ¨åˆ†çš„ä»£ç åœ¨<code>layers/box_utils.py</code>ä¸‹ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">point_form</span>(<span class="params">boxes</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Convert prior_boxes to (xmin, ymin, xmax, ymax)</span></span><br><span class="line"><span class="string">   æŠŠ prior_box (cx, cy, w, h)è½¬åŒ–ä¸º(xmin, ymin, xmax, ymax)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> torch.cat((boxes[:, :<span class="number">2</span>] - boxes[:, <span class="number">2</span>:]/<span class="number">2</span>,     <span class="comment"># xmin, ymin</span></span><br><span class="line">                     boxes[:, :<span class="number">2</span>] + boxes[:, <span class="number">2</span>:]/<span class="number">2</span>), <span class="number">1</span>)  <span class="comment"># xmax, ymax</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">center_size</span>(<span class="params">boxes</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Convert prior_boxes to (cx, cy, w, h)</span></span><br><span class="line"><span class="string">    æŠŠ prior_box (xmin, ymin, xmax, ymax) è½¬åŒ–ä¸º (cx, cy, w, h)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> torch.cat((boxes[:, <span class="number">2</span>:] + boxes[:, :<span class="number">2</span>])/<span class="number">2</span>,  <span class="comment"># cx, cy</span></span><br><span class="line">                            boxes[:, <span class="number">2</span>:] - boxes[:, :<span class="number">2</span>], <span class="number">1</span>) <span class="comment"># w, h</span></span><br></pre></td></tr></table></figure>
<h3 id="IOUè®¡ç®—"><a href="#IOUè®¡ç®—" class="headerlink" title="IOUè®¡ç®—"></a>IOUè®¡ç®—</h3><p>è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œå¯¹äºä¸¤ä¸ªBoxæ¥è®²ï¼Œé¦–å…ˆè®¡ç®—ä¸¤ä¸ªboxå·¦ä¸Šè§’ç‚¹åæ ‡çš„æœ€å¤§å€¼å’Œå³ä¸‹è§’åæ ‡çš„æœ€å°å€¼ï¼Œç„¶åè®¡ç®—äº¤é›†é¢ç§¯ï¼Œæœ€åæŠŠäº¤é›†é¢ç§¯é™¤ä»¥å¯¹åº”çš„å¹¶é›†é¢ç§¯ã€‚ä»£ç ä»åœ¨<code>layers/box_utils.py</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">intersect</span>(<span class="params">box_a, box_b</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; We resize both tensors to [A,B,2] without new malloc:</span></span><br><span class="line"><span class="string">    [A,2] -&gt; [A,1,2] -&gt; [A,B,2]</span></span><br><span class="line"><span class="string">    [B,2] -&gt; [1,B,2] -&gt; [A,B,2]</span></span><br><span class="line"><span class="string">    Then we compute the area of intersect between box_a and box_b.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      box_a: (tensor) bounding boxes, Shape: [A,4].</span></span><br><span class="line"><span class="string">      box_b: (tensor) bounding boxes, Shape: [B,4].</span></span><br><span class="line"><span class="string">    Return:</span></span><br><span class="line"><span class="string">      (tensor) intersection area, Shape: [A,B].</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    A = box_a.size(<span class="number">0</span>)</span><br><span class="line">    B = box_b.size(<span class="number">0</span>)</span><br><span class="line">     <span class="comment"># å³ä¸‹è§’ï¼Œé€‰å‡ºæœ€å°å€¼</span></span><br><span class="line">    max_xy = torch.<span class="built_in">min</span>(box_a[:, <span class="number">2</span>:].unsqueeze(<span class="number">1</span>).expand(A, B, <span class="number">2</span>),</span><br><span class="line">                       box_b[:, <span class="number">2</span>:].unsqueeze(<span class="number">0</span>).expand(A, B, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># å·¦ä¸Šè§’ï¼Œé€‰å‡ºæœ€å¤§å€¼</span></span><br><span class="line">    min_xy = torch.<span class="built_in">max</span>(box_a[:, :<span class="number">2</span>].unsqueeze(<span class="number">1</span>).expand(A, B, <span class="number">2</span>),</span><br><span class="line">                       box_b[:, :<span class="number">2</span>].unsqueeze(<span class="number">0</span>).expand(A, B, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># è´Ÿæ•°ç”¨0æˆªæ–­ï¼Œä¸º0ä»£è¡¨äº¤é›†ä¸º0</span></span><br><span class="line">    inter = torch.clamp((max_xy - min_xy), <span class="built_in">min</span>=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> inter[:, :, <span class="number">0</span>] * inter[:, :, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jaccard</span>(<span class="params">box_a, box_b</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Compute the jaccard overlap of two sets of boxes.  The jaccard overlap</span></span><br><span class="line"><span class="string">    is simply the intersection over union of two boxes.  Here we operate on</span></span><br><span class="line"><span class="string">    ground truth boxes and default boxes.</span></span><br><span class="line"><span class="string">    E.g.:</span></span><br><span class="line"><span class="string">        A âˆ© B / A âˆª B = A âˆ© B / (area(A) + area(B) - A âˆ© B)</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        box_a: (tensor) Ground truth bounding boxes, Shape: [num_objects,4]</span></span><br><span class="line"><span class="string">        box_b: (tensor) Prior boxes from priorbox layers, Shape: [num_priors,4]</span></span><br><span class="line"><span class="string">    Return:</span></span><br><span class="line"><span class="string">        jaccard overlap: (tensor) Shape: [box_a.size(0), box_b.size(0)]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    inter = intersect(box_a, box_b)<span class="comment"># Aâˆ©B</span></span><br><span class="line">     <span class="comment"># box_aå’Œbox_bçš„é¢ç§¯</span></span><br><span class="line">    area_a = ((box_a[:, <span class="number">2</span>]-box_a[:, <span class="number">0</span>]) *</span><br><span class="line">              (box_a[:, <span class="number">3</span>]-box_a[:, <span class="number">1</span>])).unsqueeze(<span class="number">1</span>).expand_as(inter)  <span class="comment"># [A,B]#(N,)</span></span><br><span class="line">    area_b = ((box_b[:, <span class="number">2</span>]-box_b[:, <span class="number">0</span>]) *</span><br><span class="line">              (box_b[:, <span class="number">3</span>]-box_b[:, <span class="number">1</span>])).unsqueeze(<span class="number">0</span>).expand_as(inter)  <span class="comment"># [A,B]#(M,)</span></span><br><span class="line">    union = area_a + area_b - inter</span><br><span class="line">    <span class="keyword">return</span> inter / union  <span class="comment"># [A,B]</span></span><br></pre></td></tr></table></figure>
<h3 id="L2æ ‡å‡†åŒ–"><a href="#L2æ ‡å‡†åŒ–" class="headerlink" title="L2æ ‡å‡†åŒ–"></a>L2æ ‡å‡†åŒ–</h3><p>VGG16çš„<code>conv4_3</code>ç‰¹å¾å›¾çš„å¤§å°ä¸º38 x 38ï¼Œç½‘ç»œå±‚é å‰ï¼Œæ–¹å·®æ¯”è¾ƒå¤§ï¼Œéœ€è¦åŠ ä¸€ä¸ªL2æ ‡å‡†åŒ–ï¼Œä»¥ä¿è¯å’Œåé¢çš„æ£€æµ‹å±‚å·®å¼‚ä¸æ˜¯å¾ˆå¤§ã€‚L2æ ‡å‡†åŒ–çš„å…¬å¼å¦‚ä¸‹ï¼š$\hat{x}=\frac{x}{|x|^{2}}$ ï¼Œå…¶ä¸­$x=\left(x_{1} \ldots x_{d}\right)|x|_{2}=\left(\sum_{i=1}^{d}\left|x_{i}\right|^{2}\right)^{1 / 2}$ã€‚åŒæ—¶ï¼Œè¿™é‡Œè¿˜è¦æ³¨æ„çš„æ˜¯å¦‚æœç®€å•çš„å¯¹ä¸€ä¸ªlayerçš„è¾“å…¥è¿›è¡ŒL2æ ‡å‡†åŒ–å°±ä¼šæ”¹å˜è¯¥å±‚çš„è§„æ¨¡ï¼Œå¹¶ä¸”ä¼šå‡æ…¢å­¦ä¹ é€Ÿåº¦ï¼Œå› æ­¤è¿™é‡Œå¼•å…¥äº†ä¸€ä¸ªç¼©æ”¾ç³»æ•°$\gamma_{i}$ ï¼Œå¯¹äºæ¯ä¸€ä¸ªé€šé“l2æ ‡å‡†åŒ–åçš„ç»“æœä¸ºï¼š$y_{i}=\gamma_{i} \hat{x}_{i}$ ï¼Œé€šå¸¸çš„å€¼è®¾10æˆ–è€…20ï¼Œæ•ˆæœæ¯”è¾ƒå¥½ã€‚ä»£ç æ¥è‡ªlayers/modules/l2norm.pyã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">L2Norm</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    conv4_3ç‰¹å¾å›¾å¤§å°38x38ï¼Œç½‘ç»œå±‚é å‰ï¼Œnormè¾ƒå¤§ï¼Œéœ€è¦åŠ ä¸€ä¸ªL2 Normalization,ä»¥ä¿è¯å’Œåé¢çš„æ£€æµ‹å±‚å·®å¼‚ä¸æ˜¯å¾ˆå¤§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼šParseNetã€‚è¿™ä¸ªå‰é¢çš„æ¨æ–‡é‡Œé¢æœ‰è®²ã€‚</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n_channels, scale</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(L2Norm, self).__init__()</span><br><span class="line">        self.n_channels = n_channels</span><br><span class="line">        self.gamma = scale <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line">        self.eps = <span class="number">1e-10</span></span><br><span class="line">        <span class="comment"># å°†ä¸€ä¸ªä¸å¯è®­ç»ƒçš„ç±»å‹Tensorè½¬æ¢æˆå¯ä»¥è®­ç»ƒçš„ç±»å‹ parameter</span></span><br><span class="line">        self.weight = nn.Parameter(torch.Tensor(self.n_channels))</span><br><span class="line">        self.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_parameters</span>(<span class="params">self</span>):</span></span><br><span class="line">        nn.init.constant_(self.weight, self.gamma)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment"># è®¡ç®—xçš„2èŒƒæ•°</span></span><br><span class="line">        norm = x.<span class="built_in">pow</span>(<span class="number">2</span>).<span class="built_in">sum</span>(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>).sqrt()+self.eps <span class="comment"># shape[b,1,38,38]</span></span><br><span class="line">        x = torch.div(x,norm)   <span class="comment"># shape[b,512,38,38]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰©å±•self.weightçš„ç»´åº¦ä¸ºshape[1,512,1,1]ï¼Œç„¶åå‚è€ƒå…¬å¼è®¡ç®—</span></span><br><span class="line">        out = self.weight.unsqueeze(<span class="number">0</span>).unsqueeze(<span class="number">2</span>).unsqueeze(<span class="number">3</span>).expand_as(x) * x</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="ä½ç½®ä¿¡æ¯ç¼–è§£ç "><a href="#ä½ç½®ä¿¡æ¯ç¼–è§£ç " class="headerlink" title="ä½ç½®ä¿¡æ¯ç¼–è§£ç "></a>ä½ç½®ä¿¡æ¯ç¼–è§£ç </h3><p>ä¸Šé¢æåˆ°äº†è®¡ç®—åæ ‡æŸå¤±çš„æ—¶å€™ï¼Œåæ ‡æ˜¯<code>encoding</code>ä¹‹åçš„ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæ ¹æ®è®ºæ–‡çš„æè¿°ï¼Œé¢„æµ‹æ¡†å’Œground truthè¾¹ç•Œæ¡†å­˜åœ¨ä¸€ä¸ªè½¬æ¢å…³ç³»ï¼Œå…ˆå®šä¹‰ä¸€äº›å˜é‡ï¼š</p>
<ul>
<li><p>å…ˆéªŒæ¡†ä½ç½®ï¼š$d=\left(d^{c x}, d^{c y}, d^{w}, d^{h}\right)$</p>
</li>
<li><p>ground truthæ¡†ä½ç½®ï¼š$g=\left(g^{c x}, g^{c y}, g^{w}, g^{h}\right)$</p>
</li>
<li><p>varianceæ˜¯å…ˆéªŒæ¡†çš„åæ ‡æ–¹å·®ã€‚ç„¶å<strong>ç¼–ç </strong>çš„è¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š$g_{j}^{\hat{c} x}=\left(g_{j}^{c x}-d_{i}^{c x}\right) / d_{i}^{w} /$varicance[0]ï¼Œ$g_{j}^{\hat{c} y}=\left(g_{j}^{c y}-d_{i}^{c y}\right) / d_{i}^{h} /$varicance[1]ï¼Œ$g_{j}^{\hat{w}}=\log \left(\frac{g_{j}^{w}}{d_{i}^{w}}\right) /$variance[2]ï¼Œ$g_{j}^{\hat{h}}=\log \left(\frac{g_{j}^{h}}{d_{i}^{h}}\right) /$variance[3]</p>
</li>
</ul>
<p><strong>è§£ç </strong>çš„è¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š$g_{\text {predict}}^{c x}=d^{w} <em>\left(\text {variance}[0] </em> l^{c x}\right)+d^{c x}$ï¼Œ$g_{\text {predict}}^{c y}=d^{h} <em>\left(\text {variance}[1] </em> l^{c y}\right)+d^{c y}$ï¼Œ$g_{\text {predict}}^{w}=d^{w} \exp \left(\text {vairance}[2] <em> l^{w}\right)$ï¼Œ$g_{\text {predict}}^{h}=d^{h} \exp \left(\text {vairance}[3] </em> l^{h}\right)$</p>
<p>è¿™éƒ¨åˆ†å¯¹åº”çš„ä»£ç åœ¨<code>layers/box_utils.py</code>é‡Œé¢ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">matched, priors, variances</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Encode the variances from the priorbox layers into the ground truth boxes</span></span><br><span class="line"><span class="string">    we have matched (based on jaccard overlap) with the prior boxes.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        matched: (tensor) Coords of ground truth for each prior in point-form</span></span><br><span class="line"><span class="string">            Shape: [num_priors, 4].</span></span><br><span class="line"><span class="string">        priors: (tensor) Prior boxes in center-offset form</span></span><br><span class="line"><span class="string">            Shape: [num_priors,4].</span></span><br><span class="line"><span class="string">        variances: (list[float]) Variances of priorboxes</span></span><br><span class="line"><span class="string">    Return:</span></span><br><span class="line"><span class="string">        encoded boxes (tensor), Shape: [num_priors, 4]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># dist b/t match center and prior&#x27;s center</span></span><br><span class="line">    g_cxcy = (matched[:, :<span class="number">2</span>] + matched[:, <span class="number">2</span>:])/<span class="number">2</span> - priors[:, :<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># encode variance</span></span><br><span class="line">    g_cxcy /= (variances[<span class="number">0</span>] * priors[:, <span class="number">2</span>:])</span><br><span class="line">    <span class="comment"># match wh / prior wh</span></span><br><span class="line">    g_wh = (matched[:, <span class="number">2</span>:] - matched[:, :<span class="number">2</span>]) / priors[:, <span class="number">2</span>:]</span><br><span class="line">    g_wh = torch.log(g_wh) / variances[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># return target for smooth_l1_loss</span></span><br><span class="line">    <span class="keyword">return</span> torch.cat([g_cxcy, g_wh], <span class="number">1</span>)  <span class="comment"># [num_priors,4]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Adapted from https://github.com/Hakuyume/chainer-ssd</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">loc, priors, variances</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Decode locations from predictions using priors to undo</span></span><br><span class="line"><span class="string">    the encoding we did for offset regression at train time.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        loc (tensor): location predictions for loc layers,</span></span><br><span class="line"><span class="string">            Shape: [num_priors,4]</span></span><br><span class="line"><span class="string">        priors (tensor): Prior boxes in center-offset form.</span></span><br><span class="line"><span class="string">            Shape: [num_priors,4].</span></span><br><span class="line"><span class="string">        variances: (list[float]) Variances of priorboxes</span></span><br><span class="line"><span class="string">    Return:</span></span><br><span class="line"><span class="string">        decoded bounding box predictions</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    boxes = torch.cat((</span><br><span class="line">        priors[:, :<span class="number">2</span>] + loc[:, :<span class="number">2</span>] * variances[<span class="number">0</span>] * priors[:, <span class="number">2</span>:],</span><br><span class="line">        priors[:, <span class="number">2</span>:] * torch.exp(loc[:, <span class="number">2</span>:] * variances[<span class="number">1</span>])), <span class="number">1</span>)</span><br><span class="line">    boxes[:, :<span class="number">2</span>] -= boxes[:, <span class="number">2</span>:] / <span class="number">2</span></span><br><span class="line">    boxes[:, <span class="number">2</span>:] += boxes[:, :<span class="number">2</span>]</span><br><span class="line"><span class="keyword">return</span> boxes</span><br></pre></td></tr></table></figure>
<h3 id="åå¤„ç†NMS"><a href="#åå¤„ç†NMS" class="headerlink" title="åå¤„ç†NMS"></a>åå¤„ç†NMS</h3><p>è¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚è¿™é‡ŒIOUé˜ˆå€¼å–äº†0.5ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ä¹Ÿåœ¨<code>layers/box_utils.py</code>é‡Œé¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nms</span>(<span class="params">boxes, scores, overlap=<span class="number">0.5</span>, top_k=<span class="number">200</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Apply non-maximum suppression at test time to avoid detecting too many</span></span><br><span class="line"><span class="string">    overlapping bounding boxes for a given object.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        boxes: (tensor) The location preds for the img, Shape: [num_priors,4].</span></span><br><span class="line"><span class="string">        scores: (tensor) The class predscores for the img, Shape:[num_priors].</span></span><br><span class="line"><span class="string">        overlap: (float) The overlap thresh for suppressing unnecessary boxes.</span></span><br><span class="line"><span class="string">        top_k: (int) The Maximum number of box preds to consider.</span></span><br><span class="line"><span class="string">    Return:</span></span><br><span class="line"><span class="string">        The indices of the kept boxes with respect to num_priors.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    keep = scores.new(scores.size(<span class="number">0</span>)).zero_().long()</span><br><span class="line">    <span class="keyword">if</span> boxes.numel() == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> keep</span><br><span class="line">    x1 = boxes[:, <span class="number">0</span>]</span><br><span class="line">    y1 = boxes[:, <span class="number">1</span>]</span><br><span class="line">    x2 = boxes[:, <span class="number">2</span>]</span><br><span class="line">    y2 = boxes[:, <span class="number">3</span>]</span><br><span class="line">    area = torch.mul(x2 - x1, y2 - y1)</span><br><span class="line">    v, idx = scores.sort(<span class="number">0</span>)  <span class="comment"># sort in ascending order</span></span><br><span class="line">    <span class="comment"># I = I[v &gt;= 0.01]</span></span><br><span class="line">    idx = idx[-top_k:]  <span class="comment"># indices of the top-k largest vals</span></span><br><span class="line">    xx1 = boxes.new()</span><br><span class="line">    yy1 = boxes.new()</span><br><span class="line">    xx2 = boxes.new()</span><br><span class="line">    yy2 = boxes.new()</span><br><span class="line">    w = boxes.new()</span><br><span class="line">    h = boxes.new()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># keep = torch.Tensor()</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx.numel() &gt; <span class="number">0</span>:</span><br><span class="line">        i = idx[-<span class="number">1</span>]  <span class="comment"># index of current largest val</span></span><br><span class="line">        <span class="comment"># keep.append(i)</span></span><br><span class="line">        keep[count] = i</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> idx.size(<span class="number">0</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        idx = idx[:-<span class="number">1</span>]  <span class="comment"># remove kept element from view</span></span><br><span class="line">        <span class="comment"># load bboxes of next highest vals</span></span><br><span class="line">        torch.index_select(x1, <span class="number">0</span>, idx, out=xx1)</span><br><span class="line">        torch.index_select(y1, <span class="number">0</span>, idx, out=yy1)</span><br><span class="line">        torch.index_select(x2, <span class="number">0</span>, idx, out=xx2)</span><br><span class="line">        torch.index_select(y2, <span class="number">0</span>, idx, out=yy2)</span><br><span class="line">        <span class="comment"># store element-wise max with next highest score</span></span><br><span class="line">        xx1 = torch.clamp(xx1, <span class="built_in">min</span>=x1[i])</span><br><span class="line">        yy1 = torch.clamp(yy1, <span class="built_in">min</span>=y1[i])</span><br><span class="line">        xx2 = torch.clamp(xx2, <span class="built_in">max</span>=x2[i])</span><br><span class="line">        yy2 = torch.clamp(yy2, <span class="built_in">max</span>=y2[i])</span><br><span class="line">        w.resize_as_(xx2)</span><br><span class="line">        h.resize_as_(yy2)</span><br><span class="line">        w = xx2 - xx1</span><br><span class="line">        h = yy2 - yy1</span><br><span class="line">        <span class="comment"># check sizes of xx1 and xx2.. after each iteration</span></span><br><span class="line">        w = torch.clamp(w, <span class="built_in">min</span>=<span class="number">0.0</span>)</span><br><span class="line">        h = torch.clamp(h, <span class="built_in">min</span>=<span class="number">0.0</span>)</span><br><span class="line">        inter = w*h</span><br><span class="line">        <span class="comment"># IoU = i / (area(a) + area(b) - i)</span></span><br><span class="line">        rem_areas = torch.index_select(area, <span class="number">0</span>, idx)  <span class="comment"># load remaining areas)</span></span><br><span class="line">        union = (rem_areas - inter) + area[i]</span><br><span class="line">        IoU = inter/union  <span class="comment"># store result in iou</span></span><br><span class="line">        <span class="comment"># keep only elements with an IoU &lt;= overlap</span></span><br><span class="line">        idx = idx[IoU.le(overlap)]</span><br><span class="line">    <span class="keyword">return</span> keep, count</span><br></pre></td></tr></table></figure>
<h3 id="æ£€æµ‹å‡½æ•°"><a href="#æ£€æµ‹å‡½æ•°" class="headerlink" title="æ£€æµ‹å‡½æ•°"></a>æ£€æµ‹å‡½æ•°</h3><p>æ¨¡å‹åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦æŠŠlocå’Œconfè¾“å…¥åˆ°detectå‡½æ•°è¿›è¡Œnmsï¼Œç„¶åç»™å‡ºç»“æœã€‚è¿™éƒ¨åˆ†çš„ä»£ç åœ¨<code>layers/functions/detection.py</code>é‡Œé¢ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Detect</span>(<span class="params">Function</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;At test time, Detect is the final layer of SSD.  Decode location preds,</span></span><br><span class="line"><span class="string">    apply non-maximum suppression to location predictions based on conf</span></span><br><span class="line"><span class="string">    scores and threshold to a top_k number of output predictions for both</span></span><br><span class="line"><span class="string">    confidence score and locations.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes, bkg_label, top_k, conf_thresh, nms_thresh</span>):</span></span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line">        self.background_label = bkg_label</span><br><span class="line">        self.top_k = top_k</span><br><span class="line">        <span class="comment"># Parameters used in nms.</span></span><br><span class="line">        self.nms_thresh = nms_thresh</span><br><span class="line">        <span class="keyword">if</span> nms_thresh &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;nms_threshold must be non negative.&#x27;</span>)</span><br><span class="line">        self.conf_thresh = conf_thresh</span><br><span class="line">        self.variance = cfg[<span class="string">&#x27;variance&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, loc_data, conf_data, prior_data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            loc_data: é¢„æµ‹å‡ºçš„locå¼ é‡ï¼Œshape[b,M,4], eg:[b, 8732, 4]</span></span><br><span class="line"><span class="string">            conf_data:é¢„æµ‹å‡ºçš„ç½®ä¿¡åº¦ï¼Œshape[b,M,num_classes], eg:[b, 8732, 21]</span></span><br><span class="line"><span class="string">            prior_data:å…ˆéªŒæ¡†ï¼Œshape[M,4], eg:[8732, 4]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        num = loc_data.size(<span class="number">0</span>)  <span class="comment"># batch size</span></span><br><span class="line">        num_priors = prior_data.size(<span class="number">0</span>)</span><br><span class="line">        output = torch.zeros(num, self.num_classes, self.top_k, <span class="number">5</span>)<span class="comment"># åˆå§‹åŒ–è¾“å‡º</span></span><br><span class="line">        conf_preds = conf_data.view(num, num_priors,</span><br><span class="line">                                    self.num_classes).transpose(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ç locçš„ä¿¡æ¯ï¼Œå˜ä¸ºæ­£å¸¸çš„bboxes</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            <span class="comment"># è§£ç loc</span></span><br><span class="line">            decoded_boxes = decode(loc_data[i], prior_data, self.variance)</span><br><span class="line">            <span class="comment"># æ‹·è´æ¯ä¸ªbatchå†…çš„confï¼Œç”¨äºnms</span></span><br><span class="line">            conf_scores = conf_preds[i].clone()</span><br><span class="line">            <span class="comment"># éå†æ¯ä¸€ä¸ªç±»åˆ«</span></span><br><span class="line">            <span class="keyword">for</span> cl <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.num_classes):</span><br><span class="line">                <span class="comment"># ç­›é€‰æ‰ conf &lt; conf_thresh çš„conf</span></span><br><span class="line">                c_mask = conf_scores[cl].gt(self.conf_thresh)</span><br><span class="line">                scores = conf_scores[cl][c_mask]</span><br><span class="line">                <span class="comment"># å¦‚æœéƒ½è¢«ç­›æ‰äº†ï¼Œåˆ™è·³å…¥ä¸‹ä¸€ç±»</span></span><br><span class="line">                <span class="keyword">if</span> scores.size(<span class="number">0</span>) == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># ç­›é€‰æ‰ conf &lt; conf_thresh çš„æ¡†</span></span><br><span class="line">                l_mask = c_mask.unsqueeze(<span class="number">1</span>).expand_as(decoded_boxes)</span><br><span class="line">                boxes = decoded_boxes[l_mask].view(-<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                <span class="comment"># idx of highest scoring and non-overlapping boxes per class</span></span><br><span class="line">                <span class="comment"># nms</span></span><br><span class="line">                ids, count = nms(boxes, scores, self.nms_thresh, self.top_k)</span><br><span class="line">                <span class="comment"># nms åå¾—åˆ°çš„è¾“å‡ºæ‹¼æ¥</span></span><br><span class="line">                output[i, cl, :count] = \</span><br><span class="line">                    torch.cat((scores[ids[:count]].unsqueeze(<span class="number">1</span>),</span><br><span class="line">                               boxes[ids[:count]]), <span class="number">1</span>)</span><br><span class="line">        flt = output.contiguous().view(num, -<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">        _, idx = flt[:, :, <span class="number">0</span>].sort(<span class="number">1</span>, descending=<span class="literal">True</span>)</span><br><span class="line">        _, rank = idx.sort(<span class="number">1</span>)</span><br><span class="line">        flt[(rank &lt; self.top_k).unsqueeze(-<span class="number">1</span>).expand_as(flt)].fill_(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>SSD</title>
    <url>/2020/02/29/SSD/</url>
    <content><![CDATA[<h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>æœ¬æ–‡æå‡ºäº†ä»…éœ€è¦å•ä¸ªå·ç§¯ç¥ç»ç½‘ç»œå°±èƒ½å®Œæˆç›®æ ‡æ£€æµ‹çš„ç®—æ³•ï¼Œå¹¶å‘½åä¸ºSSD(Single Shot Detector)ã€‚SSDç®—æ³•å°†ç›®æ ‡æ¡†çš„è¾“å‡ºç©ºé—´ç¦»æ•£åŒ–ä¸ºä¸€ç»„åœ¨æ¯ä¸ªç‰¹å¾å›¾ä½ç½®ä¸åŒå¤§å°å’Œå½¢çŠ¶çš„é»˜è®¤æ¡†ã€‚é¢„æµ‹æ—¶ï¼Œç½‘ç»œå¯¹ä½äºæ¯ä¸ªé»˜è®¤æ¡†ç±»çš„ç‰©ä½“ç±»åˆ«è¿›è¡Œæ‰“åˆ†ï¼Œå¹¶ä¿®æ­£é»˜è®¤æ¡†ä½ç½®æ¥æ›´å¥½çš„åŒ¹é…ç‰©ä½“çš„ä½ç½®ã€‚æ­¤å¤–ï¼ŒSSDç½‘ç»œåœ¨ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸Šé¢„æµ‹ï¼Œè¿™æ ·å°±å¯ä»¥å¤„ç†å¤§å°ä¸åŒçš„ç‰©ä½“ã€‚SSDæ¯”é‚£äº›éœ€è¦æœç´¢ç‰©ä½“å€™é€‰æ¡†çš„ç®—æ³•ç®€å•ï¼Œå› ä¸ºå®ƒå®Œå…¨å»é™¤äº†proposalç”Ÿæˆå’Œéšåçš„ç‰¹å¾å†ç­›é€‰çš„è¿‡ç¨‹ï¼ŒæŠŠæ‰€æœ‰çš„è®¡ç®—å°è£…åœ¨ä¸€ä¸ªç½‘ç»œé‡Œé¢ã€‚è¿™ä½¿å¾—SSDè®­ç»ƒèµ·æ¥å¾ˆå®¹æ˜“ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥åˆ°æ£€æµ‹ç³»ç»Ÿé‡Œé¢ã€‚åœ¨PASCAL VOCï¼ŒCOCO,å’ŒILSVRCæ•°æ®é›†ä¸Šçš„å®éªŒä¹Ÿè¯æ˜ï¼Œä¸é‚£äº›éœ€è¦object  proposalçš„ç®—æ³•ç›¸æ¯”ï¼ŒSSDåœ¨ä¿è¯å‡†ç¡®æ€§çš„åŒæ—¶ï¼Œé€Ÿåº¦æ›´å¿«ã€‚SSDåªéœ€ä¸€ä¸ªå®Œæ•´çš„æ¡†æ¶æ¥è®­ç»ƒå’Œæµ‹è¯•ã€‚åœ¨NVIDIA Titan  Xå¯¹äºä¸€ä¸ªå¤§å°æ˜¯300 x 300çš„è¾“å…¥å›¾åƒï¼ŒSSDåœ¨VOC2007æµ‹è¯•ä¸Šçš„MAPæ˜¯74.3%ï¼Œé€Ÿåº¦æ˜¯59FPSã€‚å¯¹äº512 x 512çš„è¾“å…¥ï¼ŒSSDçš„MAPæ˜¯76.9%ï¼Œæ¯”Faster RCNNæ›´å‡†ã€‚å’Œå…¶ä»–å•é˜¶æ®µçš„æ–¹æ³•æ¯”ï¼Œå³ä¾¿æ˜¯è¾“å…¥è¾ƒå°çš„å›¾åƒï¼ŒSSDçš„å‡†ç¡®æ€§ä¹Ÿä¼šæ›´é«˜ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ç›®å‰ï¼Œç›®æ ‡æ£€æµ‹ç³»ç»ŸåŸºæœ¬é‡‡ç”¨ä»¥ä¸‹çš„æµç¨‹ï¼šå‡è®¾ç‰©ä½“è¾¹æ¡†ï¼Œå¯¹æ¯ä¸ªè¾¹æ¡†å†…è¿›è¡Œç‰¹å¾å†é‡‡æ ·ï¼Œæœ€åä½¿ç”¨åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»ã€‚è¿™ä¸ªæµç¨‹æ¯”è¾ƒæµè¡Œï¼ŒåŸºäºFaster-RCNNçš„æ–¹æ³•é€šè¿‡é€‰æ‹©æ€§æœç´¢åœ¨PASCAL VOC,  COCOå’ŒILSVRCä¸Šæ£€æµ‹æ•ˆæœéƒ½å¾ˆå¥½ã€‚ä½†æ˜¯è¿™äº›æ–¹æ³•å¯¹äºåµŒå…¥å¼è®¾å¤‡æ¥è¯´è®¡ç®—é‡è¿‡å¤§ï¼Œç”šè‡³éœ€è¦é«˜ç«¯ç¡¬ä»¶çš„æ”¯æŒï¼Œå¯¹äºå®æ—¶ç³»ç»Ÿæ¥è¯´å¤ªæ…¢ã€‚æœ€å¿«çš„æ£€æµ‹å™¨Faster  RCNNçš„æ£€æµ‹é€Ÿåº¦ä¹Ÿåªèƒ½åˆ°7FPSã€‚äººä»¬å°è¯•äº†å¾ˆå¤šå…¶ä»–æ–¹æ³•æ¥æ„å»ºæ›´å¿«çš„æ£€æµ‹å™¨ï¼Œä½†æ˜¯å¢åŠ é€Ÿåº¦å¤§å¤šä»¥æŸå¤±æ£€æµ‹ç²¾åº¦ä¸ºä»£ä»·ã€‚æœ¬æ–‡æå‡ºäº†åŸºäºç›®æ ‡æ£€æµ‹å™¨çš„ç½‘ç»œ(object detector)ï¼Œå®ƒä¸éœ€è¦ä¸ºè¾¹æ¡†è¿›è¡Œæœç´¢ï¼Œä½†æ˜¯ç²¾åº¦å´ä¸é™åå‡ã€‚æ­¤æ–¹æ³•å®ç°äº†é«˜ç²¾åº¦å’Œé«˜é€Ÿåº¦ï¼Œåœ¨VOC2007  ä¸Šçš„æµ‹è¯•é€Ÿåº¦æ˜¯59FPSï¼ŒmAPæ˜¯74.3%ï¼›è€ŒFaster  R-CNNçš„mAPæ˜¯73.2%ï¼Œé€Ÿåº¦æ˜¯7FPSï¼›YOLOçš„mAPæ˜¯63.4%ï¼Œé€Ÿåº¦çš„æ˜¯45FPSã€‚é€Ÿåº¦çš„æå‡å¾—ç›Šäºå»é™¤äº†è¾¹æ¡†æè®®(RPNæˆ–è€…Selective  Search)å’Œéšåçš„ç‰¹å¾å†é‡‡æ ·ã€‚ä½¿ç”¨äº†ä¸€ä¸ªå°å·ç§¯æ»¤æ³¢å™¨æ¥é¢„æµ‹ç›®æ ‡åˆ†ç±»å’Œè¾¹æ¡†ä½ç½®çš„åç§»ï¼Œå¯¹äºä¸åŒæ¨ªçºµæ¯”æ£€æµ‹ä½¿ç”¨ä¸åŒçš„æ»¤æ³¢å™¨å»å¤„ç†ï¼Œç„¶åæŠŠè¿™äº›æ»¤æ³¢å™¨åº”ç”¨åœ¨åé¢ç½‘ç»œé˜¶æ®µçš„ç‰¹å¾å›¾ä¸Šï¼Œè¿™æ˜¯ä¸ºäº†ç”¨æ£€æµ‹å™¨æ£€æµ‹ä¸åŒæ¯”ä¾‹çš„å›¾ç‰‡ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç›¸å¯¹ä½åˆ†è¾¨ç‡çš„å›¾åƒä¸Šä¹Ÿèƒ½è·å¾—é«˜ç²¾åº¦çš„è¾“å‡ºï¼Œè¿˜æå‡äº†æ£€æµ‹é€Ÿåº¦ã€‚æœ¬æ–‡çš„è´¡çŒ®å¦‚ä¸‹ï¼š</p>
<ul>
<li>æå‡ºäº†SSDç®—æ³•â€”-å¤šç±»åˆ«å•é˜¶æ£€æµ‹å™¨ï¼Œ è¦æ¯”å…¶å®ƒçš„å•é˜¶æ®µæ£€æµ‹å™¨ï¼ˆYOLOï¼‰å¿«ï¼Œè€Œä¸”æ›´å‡†ç¡®ï¼›</li>
<li>SSDçš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ï¼Œåœ¨ç‰¹å¾å›¾ä¸Šåº”ç”¨å°å·ç§¯æ»¤æ³¢å™¨ï¼Œé¢„æµ‹åˆ†ç±»å¾—åˆ†å’Œä¸€ä¸ªå›ºå®šé›†åˆçš„é»˜è®¤è¾¹ç•Œæ¡†çš„åç§»ï¼›</li>
<li>ä¸ºäº†å®ç°é«˜æ£€æµ‹ç²¾åº¦ï¼Œåœ¨ä¸åŒæ¯”ä¾‹çš„ç‰¹å¾å›¾ä¸Šäº§ç”Ÿä¸åŒçš„é¢„æµ‹ï¼Œé€šè¿‡çºµæ¨ªæ¯”æ¥åˆ†å¼€é¢„æµ‹ï¼›</li>
<li>ä»¥ä¸Šçš„è®¾è®¡å¯ä»¥ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç²¾åº¦è¿˜é«˜ï¼Œç”šè‡³åœ¨ä½åˆ†è¾¨ç‡çš„å›¾åƒä¸Šæ•ˆæœä¹Ÿä¸é”™ï¼›</li>
<li>å…³äºé€Ÿåº¦å’Œç²¾åº¦çš„è¯•éªŒï¼Œä¸»è¦åœ¨PASCAL VOC, COCO å’Œ ILSVRCæ•°æ®é›†ä¸Šè¿›è¡Œï¼Œä¸å…¶å®ƒæ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚</li>
</ul>
<h2 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h2><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>SSDåŸºäºå‰é¦ˆå¼å·ç§¯ç¥ç»ç½‘ç»œï¼Œé’ˆå¯¹é‚£äº›æ–¹æ¡†é‡Œçš„ç›®æ ‡æ£€æµ‹å®ä¾‹ï¼Œäº§ç”Ÿä¸€ä¸ªå›ºå®šå¤§å°è¾¹ç•Œæ¡†é›†åˆå’Œåˆ†æ•°ï¼Œç´§æ¥ç€æ˜¯ä¸€ä¸ªéæå¤§å€¼æŠ‘åˆ¶æ­¥éª¤æ¥äº§ç”Ÿæœ€åçš„æ£€æµ‹ã€‚ç½‘ç»œå‰åŠéƒ¨åˆ†æ˜¯ä¸ªæ ‡å‡†ç»“æ„(ç”¨äºé«˜è´¨é‡å›¾ç‰‡åˆ†ç±»)ï¼Œæˆä¸ºåŸºç½‘ç»œã€‚ç„¶åå¯¹ç½‘ç»œå¢åŠ äº†è¾…åŠ©ç»“æ„æ¥å®ç°ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li><p><strong>å¤šæ¯”ä¾‹ç‰¹å¾å›¾æ£€æµ‹</strong>ï¼šåœ¨åŸºç½‘ç»œåå¢åŠ å·ç§¯ç‰¹å¾å±‚ï¼Œè¿™äº›å±‚æŒ‰å¤§å°å‡å°‘çš„æ¬¡åºè¿æ¥ï¼Œèƒ½å¤Ÿè¿›è¡Œå¤šå°ºåº¦é¢„æµ‹ã€‚</p>
</li>
<li><p><strong>å·ç§¯æ£€æµ‹é¢„æµ‹å™¨</strong>ï¼šé€šè¿‡ä¸€ä¸ªå·ç§¯æ»¤æ³¢å™¨é›†åˆï¼Œæ¯ä¸ªæ–°å¢çš„ç‰¹å¾å±‚å¯ä»¥äº§ç”Ÿä¸€ä¸ªé¢„æµ‹é›†åˆã€‚å‡è®¾ç‰¹å¾å±‚å¤§å°ä¸ºm x nï¼Œpä¸ªé€šé“ï¼Œé¢„æµ‹å‚æ•°çš„åŸºæœ¬å•å…ƒæ˜¯ä¸€ä¸ª3 x 3 x pçš„å°æ ¸ï¼Œå®ƒè¦ä¹ˆäº§ç”Ÿä¸€ä¸ªç±»åˆ«çš„å¾—åˆ†ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ªç›¸å¯¹äºé»˜è®¤æ–¹æ¡†çš„ä½ç½®åç§»ã€‚æ ¸ä¸€å…±è¦åº”ç”¨åœ¨m x nä¸ªä½ç½®ä¸Šï¼Œåœ¨æ¯ä¸ªä½ç½®ä¸Šå®ƒéƒ½æœ‰ä¸€ä¸ªè¾“å‡ºå€¼ã€‚è¾¹ç•Œæ¡†çš„åç§»è¾“å‡ºå€¼æ˜¯ç›¸å¯¹äºé»˜è®¤çš„ä½ç½®çš„ã€‚</p>
</li>
</ul>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-08_14-51-11.jpg" alt></p>
<ul>
<li><strong>é»˜è®¤æ–¹æ¡†å’Œçºµæ¨ªæ¯”</strong>ï¼šå°†æ¯ä¸ªç‰¹å¾å›¾å•å…ƒ(cell) ä¸é»˜è®¤è¾¹ç•Œæ¡†çš„é›†åˆå…³è”èµ·æ¥ï¼Œè¿™æ˜¯å¯¹äºç½‘ç»œé¡¶å±‚çš„å¤šç‰¹å¾å›¾æ¥è¯´çš„ã€‚é»˜è®¤æ–¹æ¡†ç”¨å·ç§¯çš„æ–¹å¼è¦†ç›–ç‰¹å¾å›¾ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªæ–¹æ¡†å¯¹åº”çš„å•å…ƒ(cell)æ˜¯å›ºå®šçš„ã€‚åœ¨æ¯ä¸ªç‰¹å¾æ˜ å°„å•å…ƒä¸Šï¼Œæˆ‘ä»¬é¢„æµ‹ç›¸å¯¹äºé»˜è®¤æ–¹æ¡†å½¢çŠ¶çš„åç§»ï¼Œä»¥åŠæ¯ä¸€ç±»åˆ«çš„åˆ†æ•°ï¼ˆè¡¨æ˜æ¯ä¸€ä¸ªæ–¹æ¡†ä¸­ä¸€ä¸ªç±»çš„å‡ºç°ï¼‰ã€‚åœ¨ç»™å®šçš„ä½ç½®æœ‰kä¸ªæ¡†ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸€ä¸ªï¼Œè®¡ç®—cç±»ç±»åˆ«çš„åˆ†æ•°ï¼Œå’Œç›¸å¯¹äºåŸæ¥é»˜è®¤æ–¹æ¡†å½¢çŠ¶çš„4ä¸ªåç§»ã€‚è¿™å°±ä¸€å…±æœ‰(c + 4) x kä¸ªæ»¤æ³¢å™¨è¢«åº”ç”¨åˆ°ç‰¹å¾å›¾çš„æ¯ä¸ªä½ç½®ä¸Šï¼›å¯¹äºm x nçš„ç‰¹å¾å›¾ï¼Œäº§ç”Ÿ(c + 4) x k x m x nä¸ªè¾“å‡ºã€‚é»˜è®¤æ–¹æ¡†è·ŸFaster R-CNNä¸­çš„Anchorç±»ä¼¼ï¼Œä½†æ˜¯ä½œè€…å°†å®ƒä»¬åº”ç”¨åˆ°ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ä¸Šæ—¶ï¼Œç”±äºåœ¨ä¸€äº›ç‰¹å¾å›¾ä¸Šæœ‰ä¸åŒçš„é»˜è®¤æ¡†å½¢çŠ¶ï¼Œè¿™ä½¿å¾—ç®—æ³•å¯¹ä¸åŒå°ºåº¦çš„ç›®æ ‡æœ‰è¾ƒå¥½çš„æ¢æµ‹ä½œç”¨ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/640.jfif" alt><br>SSDåœ¨è®­ç»ƒä¸­åªéœ€ä¸€å¼ è¾“å…¥å›¾åƒå’Œå›¾åƒä¸­æ¯ä¸ªç›®æ ‡çš„ground truthè¾¹ç•Œæ¡†ä¿¡æ¯ã€‚åœ¨å·ç§¯æ“ä½œä¸­ï¼Œæˆ‘ä»¬äº§ç”Ÿä¸€ä¸ªé»˜è®¤æ–¹æ¡†çš„é›†åˆï¼Œè¿™äº›æ–¹æ¡†åœ¨æ¯ä¸ªä½ç½®æœ‰ä¸åŒçš„çºµæ¨ªæ¯”ï¼Œåœ¨ä¸€äº›ç‰¹å¾å›¾ä¸­æœ‰ä¸åŒçš„æ¯”ä¾‹ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å¯¹äºæ¯ä¸ªé»˜è®¤æ–¹æ¡†ï¼Œé¢„æµ‹å®ƒå½¢çŠ¶çš„åç§»å’Œç±»åˆ«çš„ç½®ä¿¡åº¦$\left(c_{1}, c_{2}, c_{3}, \dots, c_{p}\right)$ã€‚è®­ç»ƒæ—¶ï¼Œé¦–å…ˆå°†è¿™äº›é»˜è®¤æ–¹æ¡†å’Œ ground truth è¾¹ç•Œæ¡†å¯¹åº”ä¸Šã€‚å°±åƒå›¾ä¸­ï¼Œä½œè€…åŒ¹é…äº†2ä¸ªé»˜è®¤æ–¹æ¡†ï¼Œä¸€ä¸ªæ˜¯çŒ«ï¼Œä¸€ä¸ªæ˜¯ç‹—ï¼Œå®ƒä»¬è¢«è®¤å®šä¸ºpositive, å…¶ä½™éƒ¨åˆ†è¢«è®¤å®šä¸º negative. æ¨¡å‹æŸå¤±å‡½æ•°æ˜¯ localization loss(smooth L1) å’Œ confidence  loss(Softmax) çš„åŠ æƒä¹‹å’Œã€‚</li>
</ul>
<h2 id="æ€ä¹ˆè®¾ç½®default-boxesï¼Ÿ"><a href="#æ€ä¹ˆè®¾ç½®default-boxesï¼Ÿ" class="headerlink" title="æ€ä¹ˆè®¾ç½®default boxesï¼Ÿ"></a>æ€ä¹ˆè®¾ç½®default boxesï¼Ÿ</h2><p>SSDä¸­default boxçš„æ¦‚å¿µæœ‰ç‚¹ç±»ä¼¼äºFaster R-CNNä¸­çš„anchorã€‚ä¸åŒäºFaster  R-CNNåªåœ¨æœ€åä¸€ä¸ªç‰¹å¾å±‚å–anchorï¼ŒSSDåœ¨å¤šä¸ªç‰¹å¾å±‚ä¸Šå–default boxï¼Œå¯ä»¥å¾—åˆ°ä¸åŒå°ºåº¦çš„default  boxã€‚åœ¨ç‰¹å¾å›¾çš„æ¯ä¸ªå•å…ƒä¸Šå–ä¸åŒå®½é«˜æ¯”çš„default  box,ä¸€èˆ¬å®½é«˜æ¯”åœ¨{1ï¼Œ2ï¼Œ3ï¼Œ1/2ï¼Œ1/3}ä¸­é€‰å–ï¼Œæœ‰æ—¶è¿˜ä¼šé¢å¤–å¢åŠ ä¸€ä¸ªå®½é«˜æ¯”ä¸º1ä½†å…·æœ‰ç‰¹æ®Šå°ºåº¦çš„boxã€‚ä¸Šé¢é‚£å¼ å›¾å±•ç¤ºäº†åœ¨8 x 8çš„feature mapå’Œ4 x 4çš„feature mapä¸Šçš„æ¯ä¸ªå•å…ƒå–4ä¸ªä¸åŒçš„default boxã€‚åŸæ–‡å¯¹äº300 x 300çš„è¾“å…¥ï¼Œåˆ†åˆ«åœ¨conv4_3ï¼Œconv7ï¼Œconv8_2ï¼Œconv9_2ï¼Œconv10_2ï¼Œconv11_2çš„ç‰¹å¾å›¾ä¸Šçš„æ¯ä¸ªå•å…ƒå–4ï¼Œ6ï¼Œ6ï¼Œ6ï¼Œ4ï¼Œ4ä¸ªdefault  box.  ç”±äºä»¥ä¸Šç‰¹å¾å›¾çš„å¤§å°åˆ†åˆ«æ˜¯38x38ï¼Œ19x19ï¼Œ10x10ï¼Œ5x5ï¼Œ3x3ï¼Œ1x1ï¼Œæ‰€ä»¥ä¸€å…±å¾—åˆ°38 x 38 x 4 + 19 x 19 x 6 + 10 x 10 x 6 + 5 x 5 x 6 + 3 x 3 x 4 + 1 x 1 x 4 = 8732ä¸ªdefault box.å¯¹ä¸€å¼ 300x300çš„å›¾ç‰‡è¾“å…¥ç½‘ç»œå°†ä¼šé’ˆå¯¹è¿™8732ä¸ªdefault  boxé¢„æµ‹8732ä¸ªè¾¹ç•Œæ¡†ã€‚</p>
<h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>è®­ç»ƒSSDå’Œè®­ç»ƒå…¶ä»–ä½¿ç”¨åŒºåŸŸæè®®æ£€æµ‹å™¨çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œground  truthä¿¡æ¯åœ¨å›ºå®šæ£€æµ‹å™¨è¾“å‡ºçš„æƒ…å†µä¸‹éœ€è¦æŒ‡å®šåˆ°ç‰¹å®šçš„è¾“å‡ºã€‚è¿™æ ·ï¼ŒæŸå¤±å‡½æ•°å’Œåå‘ä¼ æ’­å°±å¯ä»¥ç«¯åˆ°ç«¯çš„åº”ç”¨ã€‚è®­ç»ƒéœ€è¦é€‰æ‹©é»˜è®¤æ–¹æ¡†çš„é›†åˆï¼Œæ£€æµ‹æ¯”ä¾‹ï¼Œä»¥åŠhard negative miningï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨ç›®æ ‡çš„æ ·æœ¬é›†åˆï¼‰å’Œæ•°æ®å¢å¼ºç­–ç•¥ã€‚</p>
<ul>
<li><p><strong>Matching strategy</strong>ï¼Œ åœ¨è®­ç»ƒä¸­ï¼Œéœ€è¦å†³å®šå“ªä¸ªé»˜è®¤æ¡†åŒ¹é…ä¸€ä¸ª ground truthï¼Œç”±æ­¤æ¥è®­ç»ƒç½‘ç»œã€‚å¯¹äºæ¯ä¸ªä»é»˜è®¤æ–¹æ¡†ï¼ˆä¸åŒä½ç½®ï¼Œä¸åŒçºµæ¨ªæ¯”ï¼Œä¸åŒæ¯”ä¾‹ä¸Šï¼‰ä¸­é€‰æ‹©çš„ ground truth è¾¹ç•Œæ¡†ï¼Œå¼€å§‹æ—¶ï¼Œæ ¹æ®æœ€é«˜çš„ jaccard overlap æ¥åŒ¹é… ground truth  è¾¹ç•Œæ¡†å’Œé»˜è®¤æ–¹æ¡†ï¼ˆä¸MultiBoxä¸€æ ·ï¼‰ã€‚å®é™…æ“ä½œä¸­ï¼Œä¸ MultiBox ä¸åŒï¼Œå½“å®ƒä»¬çš„ jaccard  overlapé«˜äºé˜ˆå€¼0.5æ—¶ï¼Œä½œè€…å°±å°†é»˜è®¤æ–¹æ¡†è®¤ä¸º ground  truthã€‚è¿™ç®€åŒ–äº†å­¦ä¹ é—®é¢˜ï¼Œä½¿å¾—ç½‘ç»œå¯ä»¥å¯¹å¤šä¸ªé‡å çš„é»˜è®¤æ–¹æ¡†é¢„æµ‹å¾—åˆ°é«˜åˆ†ï¼Œè€Œä¸æ˜¯ä»…æŒ‘é€‰ä¸€ä¸ªé‡åˆåº¦æœ€é«˜çš„æ–¹æ¡†ã€‚</p>
</li>
<li><p><strong>Training objective</strong>ï¼Œ SSDçš„è®­ç»ƒç›®æ ‡æ¥è‡ªäºMultiBoxï¼Œä½†æ˜¯ä½œè€…å°†ä¹‹æ‰©å±•æˆå¯å¤„ç†å¤šç›®æ ‡åˆ†ç±»çš„é—®é¢˜ã€‚$x_{i j}^{p}=1,0$è¡¨ç¤ºåŒ¹é…ç¬¬$i$ä¸ªé»˜è®¤æ–¹æ¡†å’Œ$p$ç±»åˆ«ç¬¬$j$ä¸ªground truthè¾¹ç•Œæ¡†ã€‚è¿™ç§åŒ¹é…ç­–ç•¥ä¼šå‡ºç°$\sum_{i} x_{i, j}^{p}&gt;=1$ã€‚æ•´ä½“çš„ç›®æ ‡æŸå¤±å‡½æ•°æ˜¯å®šä½æŸå¤±åŠ åˆ†ç±»æŸå¤±ï¼š $L(x, c, l, g)=\frac{1}{N}\left(L_{c o n f}(x, c)+\alpha L_{l o c}(x, l, g)\right)$ï¼Œå…¶ä¸­$N$æ˜¯åŒ¹é…é»˜è®¤æ¡†çš„ä¸ªæ•°ï¼Œå¦‚æœ$N=0$ï¼Œlossè®¾ä¸º0ã€‚å®šä½æŸå¤±æ˜¯é¢„æµ‹è¾¹ç•Œæ¡†$l$å’ŒçœŸå€¼è¾¹ç•Œæ¡†å‚æ•°$g$çš„Smooth L1 lossã€‚ä¸Faster R-CNNç±»ä¼¼ï¼Œå¯¹é»˜è®¤è¾¹ç•Œæ¡†$d$ä¸­å¿ƒ$(cx, cy)$çš„åç§»é‡è¿›è¡Œå›å½’ï¼Œ$w$æ˜¯å®½ï¼Œ$h$æ˜¯é«˜ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/641.webp" alt><br>åˆ†ç±»æŸå¤±æ˜¯å¤šä¸ªç±»åˆ«ç½®ä¿¡åº¦çš„ softmax lossï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/642.webp" alt><br>$\alpha$åœ¨äº¤å‰éªŒè¯ä¸­è®¾ä¸º1ã€‚</p>
</li>
<li><p><strong>Choosing scales and aspect ratio for default boxes</strong>ï¼Œä¸ºäº†å¤„ç†ä¸åŒçš„ç›®æ ‡æ¯”ä¾‹ï¼Œæœ‰äº›æ–¹æ³•æ˜¯æŠŠå›¾ç‰‡å¤„ç†æˆä¸åŒçš„å¤§å°ï¼Œç„¶åç»“åˆä¸åŒå¤§å°å›¾ç‰‡çš„ç»“æœã€‚ä½†æ˜¯åœ¨ä¸€ä¸ªç½‘ç»œä¸­åˆ©ç”¨å¤šä¸ªä¸åŒå±‚äº§ç”Ÿçš„ç‰¹å¾å›¾æ¥é¢„æµ‹ä¹Ÿèƒ½äº§ç”Ÿç±»ä¼¼çš„ç»“æœï¼Œæ‰€æœ‰æ¯”ä¾‹çš„ç›®æ ‡è¿˜å¯ä»¥å…±äº«å‚æ•°ã€‚å‰é¢çš„ç ”ç©¶å·²ç»è¯æ˜ä½¿ç”¨åº•å±‚çš„ç‰¹å¾å›¾å¯ä»¥æå‡è¯­ä¹‰åˆ†å‰²è´¨é‡ï¼Œå› ä¸ºåº•å±‚èƒ½æ•æ‰åˆ°è¾“å…¥å›¾åƒä¸­çš„ç»†èŠ‚ä¿¡æ¯ã€‚å—è¿™äº›æ–¹æ³•å¯å‘ï¼Œæœ¬æ–‡ä½¿ç”¨äº†ç‰¹å¾å›¾ä¸­çš„é«˜å±‚å’Œä½å±‚ç‰¹å¾æ¥è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚ç½‘ç»œä¸­ä¸åŒå±‚çº§çš„ç‰¹å¾å›¾ä¼šæœ‰ä¸åŒçš„æ„Ÿå—é‡ï¼Œåœ¨SSDä¸­ï¼Œé»˜è®¤æ¡†ä¸ä¸€å®šè¦å’Œæ¯å±‚ä¸­çš„å®é™…æ„Ÿå—é‡å¯¹åº”ã€‚å‡è®¾æˆ‘ä»¬è¦ç”¨$m$ä¸ªç‰¹å¾å›¾æ¥é¢„æµ‹ï¼Œæ¯ä¸ªç‰¹å¾å›¾çš„é»˜è®¤æ¡†å°ºåº¦è®¡ç®—å¦‚ä¸‹ï¼š$s_{k}=s_{\min }+\frac{s_{\max }-s_{\min }}{m-1}(k-1, k \in[1, m])$ ï¼Œå…¶ä¸­$s_{m i n}$æ˜¯0.2ï¼Œ$s_{m a x}$æ˜¯0.9ï¼Œæ„å‘³ç€æœ€ä½çš„å±‚çš„å°ºåº¦æ˜¯0.2ï¼Œæœ€é«˜çš„å±‚çš„å°ºåº¦æ˜¯0.9ï¼Œä¸­é—´å±‚æ­£å¸¸é—´éš”åˆ†å¸ƒã€‚å¯¹äºé»˜è®¤æ¡†ï¼Œä½¿ç”¨ä¸åŒçš„é«˜å®½æ¯”ï¼Œ$a_{r} \in 1,2,3, \frac{1}{2}, \frac{1}{3}$ã€‚å¯ä»¥è®¡ç®—æ¯ä¸ªé»˜è®¤æ¡†çš„å®½åº¦$w_{k}^{a}=s_{k} \sqrt{a}_{r}$å’Œé«˜åº¦$h_{k}^{a}=s_{k} / \sqrt{a_{r}}$ã€‚å¯¹äºå®½é«˜æ¯”æ˜¯1çš„æƒ…å†µï¼Œå¢åŠ ä¸€ä¸ªå°ºåº¦æ˜¯$s_{k}^{\prime}=\sqrt{s_{k} s_{k+1}}$çš„é»˜è®¤æ¡†ï¼Œè¿™æ ·å°±åœ¨æ¯ä¸ªç‰¹å¾å›¾ä½ç½®æœ‰6ä¸ªé»˜è®¤æ¡†ã€‚å°†æ¡†çš„ä¸­å¿ƒè®¾ä¸º$\left(\frac{i+0.5}{\left|f_{k}\right|}, \frac{j+0.5}{\left|f_{k}\right|}\right)$ï¼Œå…¶ä¸­$\left|f_{k}\right|$æ˜¯ç¬¬$k$ä¸ªæ­£æ–¹å½¢ç‰¹å¾å›¾çš„å¤§å°ã€‚ç»“åˆè¯¸å¤šç‰¹å¾å›¾çš„ä¸åŒä½ç½®ä¸‹æ‰€æœ‰ä¸åŒå°ºåº¦å’Œå®½é«˜æ¯”çš„é»˜è®¤æ¡†ï¼Œå°±æœ‰äº†ä¸€ä¸ªé¢„æµ‹ç»“æœçš„é›†åˆï¼Œè¦†ç›–ä¸åŒå¤§å°å’Œå½¢çŠ¶çš„è¾“å…¥å¯¹è±¡ã€‚ä¾‹å¦‚å›¾ä¸€ä¸­ï¼Œé‚£æ¡ç‹—ä¸ç‰¹å¾å›¾ä¸­4 x 4çš„é»˜è®¤æ¡†åŒ¹é…ï¼Œä½†æ˜¯ä¸å’Œä»»ä½•8 x 8ç‰¹å¾å›¾ä¸­çš„é»˜è®¤æ¡†åŒ¹é…ï¼Œå› ä¸ºè¿™äº›é»˜è®¤æ¡†æœ‰ç€ä¸åŒçš„å°ºåº¦ï¼Œä¸ç‹—çš„é»˜è®¤æ¡†ä¸åŒ¹é…ï¼Œå› æ­¤åœ¨è®­ç»ƒä¸­è¢«è®¤ä¸ºæ˜¯negativeã€‚</p>
</li>
<li><p><strong>Hard Negative Mining</strong> ï¼ŒåŒ¹é…æ­¥éª¤åï¼Œé»˜è®¤æ¡†ä¸­çš„å¤§å¤šæ•°éƒ½æ˜¯negativeï¼Œå°¤å…¶æ˜¯å€™é€‰æ¡†ä¸ªæ•°ä¼—å¤šçš„æ—¶å€™ã€‚è¿™å°±å¯¼è‡´ positive å’Œ negative è®­ç»ƒæ ·æœ¬ä¸å¹³è¡¡ã€‚è¿™äº› negative æ ·æœ¬ä¸å…¨ç”¨ï¼Œè€Œæ˜¯å¯¹äºæ¯ä¸€ä¸ªé»˜è®¤æ¡†ï¼Œé€šè¿‡æœ€é«˜ç½®ä¿¡åº¦æŸå¤±æ¥å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œé€‰æ‹©æœ€é«˜çš„å‡ ä¸ªï¼Œè¿™æ ·negative å’Œ positiveçš„æ¯”ä¾‹æœ€å¤šæ˜¯3:1ã€‚è¿™æ ·è®­ç»ƒæ›´ç¨³å®šä¹Ÿæ›´å¿«ã€‚</p>
</li>
<li><p><strong>Data augmentation</strong> ä¸ºäº†è®©æ¨¡å‹å¯¹ä¸åŒçš„è¾“å…¥å¤§å°å’Œå½¢çŠ¶æ›´é²æ£’ï¼Œæ¯å¼ è®­ç»ƒå›¾ç‰‡éƒ½é€šè¿‡ä»¥ä¸‹æ­¥éª¤éšæœºé€‰æ‹©ï¼š(1)ä½¿ç”¨æ•´å¼ åŸå§‹å›¾ç‰‡è¾“å…¥ï¼›(2)é€‰æ‹©å›¾ç‰‡ä¸­çš„ä¸€å—ï¼Œä¸ç‰©ä½“æœ€ä½çš„  jaccard overlap å€¼ä¸º0.1, 0.3, 0.5, 0.7,  0.9ï¼›(3)éšæœºé‡‡æ ·æŸä¸€å—ã€‚é‡‡æ ·åŒºå—çš„å¤§å°åœ¨åŸå›¾ç‰‡[0.1,1]ä¹‹é—´ï¼Œé«˜å®½æ¯”ä»‹äº0.5å’Œ2ä¹‹é—´ã€‚ä¿ç•™çœŸå€¼è¾¹ç•Œæ¡†ä¸­çš„é‡å éƒ¨åˆ†ï¼Œå¦‚æœå®ƒçš„ä¸­å¿ƒåœ¨é‡‡æ ·åŒºå—å†…ã€‚åœ¨é‡‡æ ·æ­¥éª¤åï¼Œæ¯ä¸ªé‡‡æ ·åŒºå—ç¼©æ”¾åˆ°å›ºå®šå¤§å°ï¼Œä»¥0.5çš„æ¦‚ç‡æ¥æ°´å¹³ç¿»è½¬ã€‚</p>
</li>
</ul>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p>åœ¨PSCAL VOC2012ä¸Šé¢ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/643.webp" alt></p>
<p>åœ¨COCOæ•°æ®é›†ä¸Šé¢ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/644.webp" alt></p>
<p>é€Ÿåº¦å’Œç²¾åº¦çš„æ•´ä½“å¯¹æ¯”ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/SSD/645.png" alt></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>SSDä¼˜åŠ¿æ˜¯é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œæ•´ä¸ªè¿‡ç¨‹åªéœ€è¦ä¸€æ­¥ï¼Œé¦–å…ˆåœ¨å›¾ç‰‡ä¸åŒä½ç½®æŒ‰ç…§ä¸åŒå°ºåº¦å’Œå®½é«˜æ¯”è¿›è¡Œå¯†é›†æŠ½æ ·ï¼Œç„¶ååˆ©ç”¨CNNæå–ç‰¹å¾åç›´æ¥è¿›è¡Œåˆ†ç±»ä¸å›å½’ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†å‡åŒ€å¯†é›†é‡‡æ ·ä¼šé€ æˆæ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡çš„æƒ…å†µä½¿å¾—è®­ç»ƒæ¯”è¾ƒå›°éš¾ï¼Œå¯¼è‡´æ¨¡å‹å‡†ç¡®åº¦æœ‰æ‰€é™ä½ã€‚å¦å¤–ï¼ŒSSDå¯¹å°ç›®æ ‡çš„æ£€æµ‹æ²¡æœ‰å¤§ç›®æ ‡å¥½ï¼Œå› ä¸ºéšç€ç½‘ç»œçš„åŠ æ·±ï¼Œåœ¨é«˜å±‚ç‰¹å¾å›¾ä¸­å°ç›®æ ‡çš„ä¿¡æ¯ä¸¢å¤±æ‰äº†ï¼Œé€‚å½“å¢å¤§è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸å¯ä»¥æå‡å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœã€‚</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><a href="https://github.com/weiliu89/caffe/tree/ssd">https://github.com/weiliu89/caffe/tree/ssd</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Faster-RCNN</title>
    <url>/2020/02/26/Faster-RCNN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬çŸ¥é“RCNNå’ŒFast-RCNNéƒ½æ˜¯åŒé˜¶æ®µçš„ç®—æ³•ï¼Œä¾èµ–äºå€™é€‰æ¡†æœç´¢ç®—æ³•ã€‚è€Œæœç´¢ç®—æ³•æ˜¯å¾ˆæ…¢çš„ï¼Œè¿™å°±å¯¼è‡´è¿™ä¸¤ä¸ªç®—æ³•ä¸èƒ½å®æ—¶ã€‚åŸºäºè¿™ä¸ªé‡å¤§ç¼ºç‚¹ï¼ŒFaster-RCNNç®—æ³•é—®ä¸–ã€‚</p>
<h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><p>Fast-RCNNä»ä¾èµ–äºæœç´¢å€™é€‰æ¡†æ–¹æ³•ï¼Œå…¶ä¸­ä»¥Selective  Searchä¸ºä¸»ã€‚åœ¨Fast-RCNNç»™å‡ºçš„æ—¶é—´æµ‹è¯•ç»“æœä¸­ï¼Œä¸€å¼ å›¾ç‰‡éœ€è¦2.3sçš„å‰å‘æ¨ç†æ—¶é—´ï¼Œå…¶ä¸­2sç”¨äºç”Ÿæˆ2000ä¸ªROIã€‚å¯ä»¥çœ‹åˆ°æ•´ä¸ªç®—æ³•çš„æ—¶é—´æ¶ˆè€—å‡ ä¹éƒ½åœ¨åŒºåŸŸå€™é€‰æ¡†æœç´¢è¿™ä¸ªæ­¥éª¤äº†ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å»æ‰å€™é€‰æ¡†æœç´¢è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æ˜¯å®æ—¶æœ‰å¸Œæœ›äº†ï¼ŸFaster-RCNNå°±å¹²äº†è¿™ä»¶äº‹ï¼Œè®ºæ–‡æå‡ºåœ¨å†…éƒ¨ä½¿ç”¨æ·±å±‚ç½‘ç»œä»£æ›¿å€™é€‰åŒºåŸŸã€‚æ–°çš„å€™é€‰åŒºåŸŸç½‘ç»œ(RPN)åœ¨ç”ŸæˆROIçš„æ•ˆç‡å¤§å¤§æå‡ï¼Œä¸€å¼ å›¾ç‰‡åªéœ€è¦10æ¯«ç§’ï¼ï¼ï¼</p>
<h2 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h2><p>Faster-RCNNçš„ç½‘ç»œç»“æ„å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Faster_RCNN/640.png" alt></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°é™¤äº†æ·»åŠ ä¸€ä¸ªRPNç½‘ç»œä¹‹å¤–ï¼Œå…¶ä»–åœ°æ–¹å’ŒFast-RCNNæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚å¼•ç”¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„ä¸€å¼ æ›´è¯¦ç»†çš„ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Faster_RCNN/641.jfif" alt></p>
<h2 id="RPNç½‘ç»œ"><a href="#RPNç½‘ç»œ" class="headerlink" title="RPNç½‘ç»œ"></a>RPNç½‘ç»œ</h2><p>RPNç½‘ç»œå°†ç¬¬ä¸€ä¸ªå·ç§¯ç½‘ç»œ(backboneï¼Œå¦‚VGG16,ResNet)çš„è¾“å‡ºç‰¹å¾å›¾ä½œä¸ºè¾“å…¥ã€‚å®ƒåœ¨ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ä¸€ä¸ª$3 \times 3$çš„å·ç§¯æ ¸ï¼Œä»¥ä½¿ç”¨å·ç§¯ç½‘ç»œæ„å»ºä¸ç±»åˆ«æ— å…³çš„å€™é€‰åŒºåŸŸï¼ˆå€™é€‰æ¡†å»ºè®®ç½‘ç»œåªç”¨å…³å¿ƒå»ºè®®å‡ºæ¥çš„æ¡†æ˜¯å¦åŒ…å«ç‰©ä½“ï¼Œè€Œä¸ç”¨å…³ç³»é‚£ä¸ªç‰©ä½“æ˜¯å“ªä¸€ç±»çš„ï¼‰ï¼Œæˆ‘ä»¬å°†RPNäº§ç”Ÿçš„æ¯ä¸ªæ¡†å«åšAnchorã€‚</p>
<p>è¿™é‡Œè¿™æ ·è¯´è‚¯å®šè¿˜æ˜¯æ¯”è¾ƒæ¨¡ç³Šï¼Œæˆ‘å¼•ç”¨ä¸€å¼ è®­ç»ƒæ—¶å€™çš„RPNçš„ç»“æ„å›¾ç„¶åå›ºå®šè¾“å…¥åˆ†è¾¨ç‡å’Œbackboneä¸ºVGG16æ¥è§£é‡Šä¸€ä¸‹ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯RPNæ¶æ„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Faster_RCNN/642.jfif" alt></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°anchorçš„æ•°é‡æ˜¯å’ŒFeature Mapçš„å¤§å°ç›¸å…³ï¼Œå¯¹äºç‰¹å¾å›¾ä¸­çš„æ¯ä¸€ä¸ªä½ç½®ï¼ŒRPNä¼šåš$k$æ¬¡é¢„æµ‹ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œå¯¹æ¯ä¸ªåƒç´ ï¼ŒRPNå°†è¾“å‡º$4 \times k$ä¸ªåæ ‡å’Œ$2 \times k$ä¸ªå¾—åˆ†ã€‚ç„¶åç”±äºä½¿ç”¨äº†VGG16åšBackboneï¼Œæ‰€ä»¥è¾“å…¥åˆ°RPNçš„ç‰¹å¾å›¾å¤§å°æ˜¯åŸå›¾çš„$H, W$çš„$\frac{1}{16}$ã€‚å¯¹äºä¸€ä¸ª$512 \times 62 \times 37$çš„feature mapï¼Œæœ‰$62 \times 37 \times 9$çº¦ç­‰äº20000ä¸ªanchorã€‚ä¹Ÿå°±æ˜¯å¯¹ä¸€å¼ å›¾ç‰‡ï¼Œæœ‰20000ä¸ªå·¦å³çš„anchorã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°RPNçš„é«˜æ˜ä¹‹å¤„ï¼Œä¸€å¼ å›¾ç‰‡20000ä¸ªå€™é€‰æ¡†å°±æ˜¯çŒœä¹Ÿèƒ½çŒœå¾—ä¸ƒä¸ƒå…«å…«ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯20000ä¸ªæ¡†æˆ‘ä»¬éƒ½éœ€è¦ï¼Œæˆ‘ä»¬åªéœ€è¦é€‰å–å…¶ä¸­çš„256ä¸ªã€‚å…·ä½“çš„é€‰å–è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹äºæ¯ä¸€ä¸ªGround Truth Bounding Boxï¼Œé€‰æ‹©å’Œå®ƒIOUæœ€é«˜çš„ä¸€ä¸ªanchorä½œä¸ºæ­£æ ·æœ¬ã€‚</li>
<li>å¯¹äºå‰©ä¸‹çš„anchorï¼Œé€‰æ‹©å’Œä»»æ„ä¸€ä¸ªGround Truth Bounding Box çš„IOUå¤§äº0.7çš„anchorä½œä¸ºæ­£æ ·æœ¬ï¼Œæ­£æ ·æœ¬çš„æ•°ç›®ä¸è¶…è¿‡128ä¸ªã€‚</li>
<li>è´Ÿæ ·æœ¬ç›´æ¥é€‰æ‹©å’ŒGround Truth Bounding Box çš„IOU&lt;0.3çš„anchorã€‚æ­£è´Ÿæ ·æœ¬çš„æ€»æ•°ä¿è¯ä¸º256ä¸ªã€‚</li>
</ul>
<p>RPNåœ¨äº§ç”Ÿæ­£è´Ÿæ ·æœ¬è®­ç»ƒçš„æ—¶å€™ï¼Œè¿˜ä¼šäº§ç”ŸROIsä½œä¸ºFaster-RCNN(ROI-Head)çš„è®­ç»ƒæ ·æœ¬ã€‚RPNç”ŸæˆROIsçš„è¿‡ç¨‹ï¼ˆç½‘ç»œç»“æ„å›¾ä¸­çš„ProposalCreatorï¼‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹äºæ¯å¼ å›¾ç‰‡ï¼Œåˆ©ç”¨å®ƒçš„feature mapï¼Œ è®¡ç®— (H/16)Ã— (W/16)Ã—9ï¼ˆå¤§æ¦‚20000ï¼‰ä¸ªanchorå±äºå‰æ™¯çš„æ¦‚ç‡ï¼Œä»¥åŠå¯¹åº”çš„ä½ç½®å‚æ•°ã€‚</li>
<li>é€‰å–æ¦‚ç‡è¾ƒå¤§çš„12000ä¸ªanchor</li>
<li>åˆ©ç”¨å›å½’çš„ä½ç½®å‚æ•°ï¼Œä¿®æ­£è¿™12000ä¸ªanchorçš„ä½ç½®ï¼Œå¾—åˆ°RoIs</li>
<li>åˆ©ç”¨éæå¤§å€¼ï¼ˆ(Non-maximum suppression, NMSï¼‰æŠ‘åˆ¶ï¼Œé€‰å‡ºæ¦‚ç‡æœ€å¤§çš„2000ä¸ªRoIs</li>
</ul>
<p>åœ¨å‰å‘æ¨ç†é˜¶æ®µï¼Œ12000å’Œ2000åˆ†åˆ«å˜ä¸º6000å’Œ3000ä»¥æé«˜é€Ÿåº¦ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦åå‘ä¼ æ’­ï¼Œæ‰€ä»¥æ›´å®¹æ˜“å®ç°ã€‚</p>
<p>æœ€åRPNçš„è¾“å‡ºç»´åº¦æ˜¯$2000 \times 4$æˆ–è€…$300 \times 4$çš„tensorã€‚</p>
<h2 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h2><p>åœ¨RPNç½‘ç»œä¸­ï¼Œå¯¹äºæ¯ä¸ªAnchorï¼Œå®ƒä»¬å¯¹åº”çš„gt_labelï¼ˆå°±æ˜¯ç­›é€‰åˆ°è¿™ä¸ªAnchorçš„é‚£ä¸ªground truthæ¡†çš„labelï¼‰è¦ä¹ˆæ˜¯1è¦ä¹ˆæ˜¯0ï¼Œ1ä»£è¡¨å‰æ™¯ï¼Œ0ä»£è¡¨èƒŒæ™¯ã€‚è€Œgt_locåˆ™æ˜¯ç”±4ä¸ªä½ç½®å‚æ•°$(t x, t y, t w, t h)$ç»„æˆï¼Œè¿™æ ·æ¯”ç›´æ¥å›å½’åæ ‡æ›´å¥½ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Faster_RCNN/643.webp" alt></p>
<p>è®¡ç®—åˆ†ç±»ç”¨çš„æ˜¯äº¤å‰ç†µæŸå¤±ï¼Œè€Œè®¡ç®—å›å½’æŸå¤±ç”¨çš„æ˜¯SmoothL1Lossã€‚åœ¨è®¡ç®—å›å½’æŸå¤±çš„æ—¶å€™åªç»Ÿè®¡å‰æ™¯çš„æŸå¤±ï¼Œå¿½ç•¥èƒŒæ™¯çš„æŸå¤±ã€‚</p>
<p>ç½‘ç»œåœ¨æœ€åå¯¹æ¯ä¸€ä¸ªæ¡†éƒ½æœ‰ä¸¤ç§æŸå¤±ï¼Œå³ç‰©ä½“å±äºå“ªä¸€ç±»çš„åˆ†ç±»æŸå¤±(21ç±»ï¼ŒåŠ äº†ä¸ªèƒŒæ™¯)ï¼Œä½ç½®åœ¨å“ªçš„å›å½’æŸå¤±ã€‚æ‰€ä»¥æ•´ä¸ªFaster-RCNNçš„æŸå¤±æ˜¯è¿™4ä¸ªæŸå¤±ä¹‹å’Œã€‚ç½‘ç»œçš„ç›®æ ‡å°±æ˜¯æœ€å°åŒ–è¿™å››ä¸ªæŸå¤±ä¹‹å’Œã€‚</p>
<h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>ä¸Šé¢è®²äº†ï¼ŒRPNä¼šäº§ç”Ÿå¤§çº¦2000ä¸ªROIsï¼Œè¿™2000ä¸ªROIså¹¶ä¸éƒ½æ‹¿å»è®­ç»ƒï¼Œè€Œæ˜¯åˆ©ç”¨Proposal Target Creatoré€‰æ‹©128ä¸ªROIsç”¨ä»¥è®­ç»ƒã€‚é€‰æ‹©çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>RoIså’Œgt_bboxes çš„IoUå¤§äº0.5çš„ï¼Œé€‰æ‹©ä¸€äº›ï¼ˆæ¯”å¦‚32ä¸ªï¼‰</li>
<li>é€‰æ‹© RoIså’Œgt_bboxesçš„IoUå°äºç­‰äº0ï¼ˆæˆ–è€…0.1ï¼‰çš„é€‰æ‹©ä¸€äº›ï¼ˆæ¯”å¦‚ 128-32=96ä¸ªï¼‰ä½œä¸ºè´Ÿæ ·æœ¬</li>
</ul>
<p>åŒæ—¶ä¸ºäº†ä¾¿äºè®­ç»ƒï¼Œå¯¹é€‰æ‹©å‡ºçš„128ä¸ªROIsçš„å¯¹åº”çš„ground truth  bboxçš„åæ ‡è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œå³å‡å»å‡å€¼é™¤ä»¥æ ‡å‡†å·®ã€‚å¯¹äºåˆ†ç±»é—®é¢˜,ç›´æ¥åˆ©ç”¨äº¤å‰ç†µæŸå¤±ã€‚è€Œå¯¹äºä½ç½®çš„å›å½’æŸå¤±ï¼Œä¸€æ ·é‡‡ç”¨Smooth_L1Lossï¼Œåªä¸è¿‡åªå¯¹æ­£æ ·æœ¬è®¡ç®—æŸå¤±ã€‚è€Œä¸”æ˜¯åªå¯¹æ­£æ ·æœ¬ä¸­çš„è¿™ä¸ªç±»åˆ«4ä¸ªå‚æ•°è®¡ç®—æŸå¤±ã€‚ä¸¾ä¾‹æ¥è¯´:</p>
<ul>
<li>ä¸€ä¸ªRoIåœ¨ç»è¿‡FC 84åä¼šè¾“å‡ºä¸€ä¸ª84ç»´çš„loc å‘é‡ã€‚å¦‚æœè¿™ä¸ªRoIæ˜¯è´Ÿæ ·æœ¬,åˆ™è¿™84ç»´å‘é‡ä¸å‚ä¸è®¡ç®— L1_Lossã€‚</li>
<li>å¦‚æœè¿™ä¸ªRoIæ˜¯æ­£æ ·æœ¬,å±äºlabel K,é‚£ä¹ˆå®ƒçš„ç¬¬ KÃ—4ï¼ŒKÃ—4+1ï¼ŒKÃ—4+2ï¼Œ KÃ—4+3 è¿™4ä¸ªæ•°å‚ä¸è®¡ç®—æŸå¤±ï¼Œå…¶ä½™çš„ä¸å‚ä¸è®¡ç®—æŸå¤±ã€‚</li>
</ul>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æµ‹è¯•çš„æ—¶å€™ä¿ç•™å¤§çº¦300ä¸ªROIsï¼Œå¯¹æ¯ä¸€ä¸ªè®¡ç®—æ¦‚ç‡ï¼Œå¹¶åˆ©ç”¨ä½ç½®å‚æ•°è°ƒæ•´å€™é€‰æ¡†çš„ä½ç½®ã€‚æœ€åç”¨NMSç­›ä¸€éï¼Œå°±å¾—åˆ°ç»“æœäº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Fast RCNN</title>
    <url>/2020/02/24/Fast-RCNN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬çŸ¥é“RCNNéœ€è¦æŠŠæ¯ä¸€ä¸ªå¯èƒ½æœ‰ç›®æ ‡çš„å€™é€‰æ¡†æœç´¢å‡ºæ¥ï¼Œç„¶åæŠŠæ¯ä¸ªå€™é€‰æ¡†ä¼ å…¥CNNæå–ç‰¹å¾ï¼Œæ¯ä¸€å¼ å›¾ç‰‡è¦äº§ç”Ÿå¤§çº¦2Kä¸ªå€™é€‰æ¡†ï¼Œè€Œæ¯ä¸ªæ¡†å¯¹åº”çš„å›¾åƒéƒ½è¦ä¼ å…¥CNNï¼Œè¿™ä¸ªæ—¶é—´å¼€é”€è‚¯å®šæ˜¯å¾ˆéš¾æ‰¿å—çš„ã€‚åŸºäºRCNNè¿™ä¸ªè‡´å‘½é—®é¢˜ï¼ŒFast-RCNNå‡ºç°äº†ã€‚</p>
<h2 id="ç®—æ³•ä»‹ç»"><a href="#ç®—æ³•ä»‹ç»" class="headerlink" title="ç®—æ³•ä»‹ç»"></a>ç®—æ³•ä»‹ç»</h2><p>Fast-RCNNæ˜¯åœ¨SPPNetå’ŒRCNNçš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›çš„ã€‚SPPNetçš„ä¸»è¦è´¡çŒ®æ˜¯åœ¨æ•´å¼ å›¾åƒä¸Šè®¡ç®—å…¨å±€ç‰¹å¾å›¾ï¼Œç„¶åå¯¹äºç‰¹å®šçš„proposalï¼Œåªéœ€è¦åœ¨å…¨å±€ç‰¹å¾å›¾ä¸Šå–å‡ºå¯¹åº”åæ ‡çš„ç‰¹å¾å›¾å°±å¯ä»¥äº†ã€‚ä½†SPPNetä»ç„¶éœ€è¦å°†ç‰¹å¾ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé€Ÿåº¦è¿˜æ˜¯å¾ˆæ…¢ã€‚ç»“åˆRCNNçš„æ€æƒ³ï¼Œè®ºæ–‡æå‡ºç›´æ¥å°†å€™é€‰æ¡†åŒºåŸŸåº”ç”¨äºç‰¹å¾å›¾ï¼Œå¹¶ä½¿ç”¨ROI Poolingå°†å…¶è½¬åŒ–ä¸ºå›ºå®šå¤§å°çš„ç‰¹å¾å›¾ï¼Œæœ€åå†è¿æ¥ä¸¤ä¸ªå¹¶è¡Œçš„åˆ†ç±»å¤´å’Œå›å½’å¤´å®Œæˆæ£€æµ‹ä»»åŠ¡ã€‚æ•´ä¸ªç®—æ³•å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/3940902-7569280b566d0e58.png" alt></p>
<h2 id="è´¡çŒ®-amp-åˆ›æ–°ç‚¹"><a href="#è´¡çŒ®-amp-åˆ›æ–°ç‚¹" class="headerlink" title="è´¡çŒ®&amp;åˆ›æ–°ç‚¹"></a>è´¡çŒ®&amp;åˆ›æ–°ç‚¹</h2><ul>
<li>Fast-RCNN åªå¯¹æ•´ä¸ªå›¾åƒè¿›è¡Œä¸€æ¬¡ç‰¹å¾æå–ï¼Œé¿å…R-CNNçš„ä¸Šåƒæ¬¡ç‰¹å¾æå–ã€‚</li>
<li>ä½¿ç”¨ROI Poolingå±‚æ›¿æ¢æœ€åä¸€å±‚çš„Max Poolingå±‚ï¼Œå·§å¦™é¿å…RCNNä¸­çš„å°†æ¯ä¸ªå€™é€‰æ¡†Resizeåˆ°å›ºå®šå¤§å°çš„æ“ä½œã€‚</li>
<li>Fast RCNNåœ¨ç½‘ç»œçš„å°¾éƒ¨é‡‡ç”¨å¹¶è¡Œçš„å…¨è¿æ¥å±‚ï¼Œå¯åŒæ—¶è¾“å‡ºåˆ†ç±»ç»“æœå’Œçª—å£å›å½’ç»“æœï¼Œå®ç°äº†ç«¯åˆ°ç«¯çš„å¤šä»»åŠ¡è®­ç»ƒï¼Œä¸”ä¸éœ€è¦é¢å¤–çš„ç‰¹å¾å­˜å‚¨ç©ºé—´(åœ¨R-CNNä¸­ç‰¹å¾éœ€è¦ä¿å­˜åˆ°ç£ç›˜ï¼Œä»¥ä¾›SVMå’Œçº¿æ€§å›å½’å™¨è®­ç»ƒ)ã€‚</li>
<li>ä½¿ç”¨SVDçŸ©é˜µåˆ†è§£ç®—æ³•å¯¹ç½‘ç»œæœ«ç«¯å¹¶è¡Œçš„å…¨è¿æ¥å±‚è¿›è¡Œåˆ†è§£ï¼ŒåŠ é€Ÿè¿ç®—ã€‚</li>
</ul>
<h2 id="ROI-Poolingå±‚"><a href="#ROI-Poolingå±‚" class="headerlink" title="ROI Poolingå±‚"></a>ROI Poolingå±‚</h2><p>Fast-RCNNçš„æ ¸å¿ƒæ˜¯ROIæ± åŒ–å±‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¾“å…¥ç‰¹å¾å›¾çš„å¤§å°ä¸å®šï¼Œä½†è¾“å‡ºå¤§å°å›ºå®šçš„è¾“å‡ºç‰¹å¾å›¾ã€‚è€Œä»€ä¹ˆæ˜¯ROIå‘¢ï¼ŸROIå°±æ˜¯ç»è¿‡åŒºåŸŸå»ºè®®ç®—æ³•(Selective Search)ç”Ÿæˆçš„æ¡†ç»è¿‡å·ç§¯ç¥ç»ç½‘ç»œç½‘ç»œæå–ç‰¹å¾åçš„ç‰¹å¾å›¾ä¸Šçš„åŒºåŸŸï¼Œæ¯ä¸€ä¸ªROIå¯¹åº”äº†åŸå›¾çš„ä¸€ä¸ªåŒºåŸŸå»ºè®®æ¡†ï¼Œåªæœ‰å¤§å°å˜åŒ–äº†ï¼Œç›¸å¯¹ä½ç½®æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Fast_RCNN/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200224140858.jpg" alt></p>
<p>ROI Poolingå±‚çš„è¾“å…¥æœ‰ç‰¹å¾å›¾å’ŒROIsï¼Œç‰¹å¾å›¾æ˜¯ç»è¿‡CNNæå–åçš„ç»“æœï¼ŒROIsè¡¨ç¤ºSelective Searchçš„ç»“æœï¼Œå½¢çŠ¶ä¸º$N \times 5 \times 1 \times 1$ï¼Œå…¶ä¸­$N$ä»£è¡¨ROIçš„ä¸ªæ•°ï¼Œ5ä»£è¡¨$x, y, w, h$ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåæ ‡ç³»çš„å‚æ•°æ˜¯é’ˆå¯¹åŸå›¾çš„ã€‚</p>
<h2 id="ROI-Poolingçš„å…·ä½“æ“ä½œ"><a href="#ROI-Poolingçš„å…·ä½“æ“ä½œ" class="headerlink" title="ROI Poolingçš„å…·ä½“æ“ä½œ"></a>ROI Poolingçš„å…·ä½“æ“ä½œ</h2><ul>
<li>æ ¹æ®è¾“å…¥å›¾ç‰‡ï¼Œå°†ROIæ˜ å°„åˆ°ç‰¹å¾å›¾å¯¹åº”ä½ç½®ï¼ˆæ˜ å°„è§„åˆ™å°±æ˜¯ç›´æ¥æŠŠå„ä¸ªåæ ‡é™¤ä»¥â€œè¾“å…¥å›¾ç‰‡å’Œç‰¹å¾å›¾å¤§å°çš„æ¯”å€¼â€ï¼‰</li>
<li>å°†æ˜ å°„åçš„åŒºåŸŸåˆ’åˆ†ä¸ºç›¸åŒå¤§å°çš„sectionsï¼Œå…¶ä¸­sectionsä»£è¡¨è¾“å‡ºç»´åº¦ï¼Œä¾‹å¦‚7ã€‚</li>
<li>å¯¹æ¯ä¸ªsectionsè¿›è¡Œæœ€å¤§æ± åŒ–æ“ä½œã€‚</li>
</ul>
<p>æœ€åä¸Šä¼ ä¸€å¼ ç»å…¸åŠ¨æ€å›¾ç‰‡ï¼Œæ›´å¥½çš„è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/Fast_RCNN/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200224140920.gif" alt></p>
<h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>Fast-RCNNçš„ä½œè€…rgbirshickä¾ç„¶ç»™å‡ºäº†æºç ï¼Œæœ‰å…´è¶£å¯ä»¥è¯»ä¸€ä¸‹ï¼š<a href="https://github.com/rbgirshick/fast-rcnn">https://github.com/rbgirshick/fast-rcnn</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>Fast RCNN</tag>
      </tags>
  </entry>
  <entry>
    <title>RCNN</title>
    <url>/2020/02/24/RCNN/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹"><a href="#ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹" class="headerlink" title="ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹"></a>ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹</h3><p>æ‰€è°“ç›®æ ‡æ£€æµ‹å°±æ˜¯åœ¨ä¸€å¼ å›¾åƒä¸­æ‰¾åˆ°æˆ‘ä»¬å…³æ³¨çš„ç›®æ ‡ï¼Œå¹¶ç¡®å®šå®ƒçš„ç±»åˆ«å’Œä½ç½®ï¼Œè¿™æ˜¯è®¡ç®—æœºè§†è§‰é¢†åŸŸæœ€æ ¸å¿ƒçš„é—®é¢˜ä¹‹ä¸€ã€‚ç”±äºå„ç±»ç›®æ ‡ä¸åŒçš„å¤–è§‚ï¼Œé¢œè‰²ï¼Œå¤§å°ä»¥åŠåœ¨æˆåƒæ—¶å…‰ç…§ï¼Œé®æŒ¡ç­‰å…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œç›®æ ‡æ£€æµ‹ä¸€ç›´å¤„äºä¸æ–­çš„ä¼˜åŒ–å’Œç ”ç©¶ä¸­ã€‚</p>
<h3 id="ç›®æ ‡æ£€æµ‹ç®—æ³•åˆ†ç±»"><a href="#ç›®æ ‡æ£€æµ‹ç®—æ³•åˆ†ç±»" class="headerlink" title="ç›®æ ‡æ£€æµ‹ç®—æ³•åˆ†ç±»"></a>ç›®æ ‡æ£€æµ‹ç®—æ³•åˆ†ç±»</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180509095302426.png" alt></p>
<p>è¿™å¼ ç”˜ç‰¹å›¾å·²ç»è¯´æ˜äº†ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼Œå³ï¼š</p>
<ul>
<li>Two Stageç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚è¿™ç±»ç®—æ³•éƒ½æ˜¯å…ˆè¿›è¡ŒåŒºåŸŸå€™é€‰æ¡†ç”Ÿæˆï¼Œå°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯èƒ½åŒ…å«ç‰©ä½“çš„é¢„é€‰æ¡†ï¼Œå†é€šè¿‡å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œåˆ†ç±»å’Œå›å½’ä¿®æ­£ï¼Œå¸¸è§ç®—æ³•æœ‰R-CNNï¼ŒSPP-Netï¼ŒFast-RCNNï¼ŒFaster-RCNNå’ŒR-FCNç­‰ã€‚</li>
<li>One Stageç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚è¿™ç±»ç®—æ³•ä¸ä½¿ç”¨å€™é€‰æ¡†ç”Ÿæˆï¼Œç›´æ¥åœ¨ç½‘ç»œä¸­æå–ç‰¹å¾æ¥é¢„æµ‹ç‰©ä½“çš„åˆ†ç±»å’Œä½ç½®ã€‚å¸¸è§çš„One-Stageç®—æ³•æœ‰ï¼šYOLOç³»åˆ—ï¼ŒSSDï¼ŒRetinaNetã€‚</li>
</ul>
<h2 id="RCNNç®—æ³•"><a href="#RCNNç®—æ³•" class="headerlink" title="RCNNç®—æ³•"></a>RCNNç®—æ³•</h2><h3 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h3><p>RCNNæ˜¯ç¬¬ä¸€ä¸ªä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œæ¥å¯¹ç›®æ ‡å€™é€‰æ¡†æå–ç‰¹å¾çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚åŒæ—¶ï¼ŒRCNNä½¿ç”¨äº†å¾®è°ƒ(finetune)çš„æŠ€æœ¯ï¼Œä½¿ç”¨å¤§æ•°æ®é›†ä¸Šè®­ç»ƒå¥½çš„åˆ†ç±»æ¨¡å‹çš„å‰å‡ å±‚åšbackboneï¼Œè¿›è¡Œæ›´æœ‰æ•ˆçš„ç‰¹å¾æå–ã€‚</p>
<h3 id="RCNNæ€»è§ˆ"><a href="#RCNNæ€»è§ˆ" class="headerlink" title="RCNNæ€»è§ˆ"></a>RCNNæ€»è§ˆ</h3><p>çœ‹ä¸‹å›¾ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/Snipaste_2020-01-07_09-57-14.jpg" alt></p>
<p>é¦–å…ˆï¼ŒR-CNNæ˜¯å°†ä¼ ç»Ÿå›¾åƒç®—æ³•å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯ç»“åˆèµ·æ¥çš„ç»“æ„ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯éœ€è¦å€™é€‰æ¡†åŒºåŸŸå»ºè®®ï¼Œè¿™é‡Œä¸€èˆ¬ä½¿ç”¨Selective Searchçš„æ–¹æ³•æå–å‡ºå€™é€‰æ¡†ï¼Œç„¶åå†ä¼ å…¥CNNåšç‰¹å¾æå–åŠåˆ†ç±»ï¼Œåé¢è¿˜å€ŸåŠ©äº†æœºå™¨å­¦ä¹ ç®—æ³•åšå›å½’ä¿®æ­£ã€‚</p>
<h3 id="RCNNç®—æ³•æ­¥éª¤"><a href="#RCNNç®—æ³•æ­¥éª¤" class="headerlink" title="RCNNç®—æ³•æ­¥éª¤"></a>RCNNç®—æ³•æ­¥éª¤</h3><ul>
<li>é€‰æ‹©ä¸€ä¸ªé¢„è®­ç»ƒ ï¼ˆpre-trainedï¼‰ç¥ç»ç½‘ç»œï¼ˆå¦‚AlexNetã€VGGï¼‰ã€‚</li>
<li>é‡æ–°è®­ç»ƒå…¨è¿æ¥å±‚ã€‚ä½¿ç”¨éœ€è¦æ£€æµ‹çš„ç›®æ ‡é‡æ–°è®­ç»ƒï¼ˆre-trainï¼‰æœ€åå…¨è¿æ¥å±‚ï¼ˆconnected layerï¼‰ã€‚å³æ˜¯fintuneæŠ€æœ¯çš„åº”ç”¨ã€‚</li>
<li><p>ç”Ÿæˆå€™é€‰æ¡†ã€‚åˆ©ç”¨Selective Searchç®—æ³•æå–æ‰€æœ‰çš„Proposalsï¼Œä¸€å¼ å›¾ç‰‡å¤§æ¦‚äº§ç”Ÿ2000å¼ ï¼Œç„¶åå°†å›¾ç‰‡è§„æ•´åŒ–å›ºå®šå¤§å°ï¼Œä½¿å¾—å…¶æ»¡è¶³CNNçš„è¾“å…¥è¦æ±‚ï¼Œæœ€åå°†feature mapå­˜åˆ°ç£ç›˜(æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼ŒRCNNè¦æŠŠæå–åˆ°çš„ç‰¹å¾å­˜å‚¨åˆ°ç£ç›˜)ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RCNN/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200224135208.jpg" alt></p>
</li>
<li><p>åˆ©ç”¨feature mapè®­ç»ƒSVMæ¥å¯¹ç›®æ ‡å’ŒèƒŒæ™¯è¿›è¡Œåˆ†ç±»ï¼Œè¿™é‡Œæ¯ä¸€ä¸ªç±»ä¸€ä¸ªäºŒå…ƒSVMã€‚</p>
</li>
<li><p>è®­ç»ƒçº¿æ€§å›å½’å™¨ä¿®æ­£ç›®æ ‡çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RCNN/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200224135251.jpg" alt></p>
</li>
</ul>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/RCNN/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200224135256.jpg" alt></p>
<p>RCNNæˆä¸ºäº†å½“æ—¶ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„SOATç®—æ³•ï¼Œè™½ç„¶ç°åœ¨å¾ˆå°‘æœ‰äººä½¿ç”¨åˆ°äº†ï¼Œä½†è®ºæ–‡çš„æ€æƒ³æˆ‘ä»¬ä»å¯ä»¥å€Ÿé‰´ã€‚ä»»ä½•äº‹æƒ…éƒ½è¦ç»å†ä¸€ä¸ªä»æ— åˆ°æœ‰çš„è¿‡ç¨‹ã€‚</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>rgbirshickå¤§ç¥ï¼Œä¹Ÿå°±æ˜¯RCNNä½œè€…ï¼Œæä¾›äº†æºç ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š<a href="https://github.com/rbgirshick/rcnn">https://github.com/rbgirshick/rcnn</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>RCNN</tag>
      </tags>
  </entry>
  <entry>
    <title>NIPS 2016 R-FCNï¼ˆæ¥è‡ªå¾®è½¯ä½•å‡¯æ˜å›¢é˜Ÿï¼‰</title>
    <url>/2020/03/05/NIPS-2016-R-FCN%EF%BC%88%E6%9D%A5%E8%87%AA%E5%BE%AE%E8%BD%AF%E4%BD%95%E5%87%AF%E6%98%8E%E5%9B%A2%E9%98%9F%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>R-FCNå…¨ç§°ä¸ºRegion-based Fully Convolutional Networksï¼Œæ˜¯ç”±å¾®è½¯çš„ä½•å‡¯æ˜å›¢é˜Ÿåœ¨NIPS 2016ä¸Šæå‡ºæ¥çš„ï¼Œä»ç„¶æ˜¯åŒé˜¶æ®µçš„ç›®æ ‡æ£€æ£€æµ‹ç®—æ³•ã€‚è®ºæ–‡åœ°å€å’Œå®˜æ–¹å¼€æºä»£ç è§æ–‡åã€‚</p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>R-FCNè®ºæ–‡çš„å‘è¡¨æ—¶é—´æ¯”YOLO,SSDå‡ºæ¥çš„éƒ½æ™šä¸€äº›ï¼Œå¹¶ä¸”è¿™ä¸ªç®—æ³•æ›´åƒæ˜¯é’ˆå¯¹Faster-RCNNçš„ä¸€ç§æ”¹è¿›ï¼Œå¹¶ä¸”æ‰”å±äºtwo-stageç®—æ³•ã€‚é‚£ä¸ªR-FCNå…·ä½“è¦è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨å…ˆæ¥çœ‹çœ‹R-FCNä¹‹å‰çš„å…¸å‹çš„two-stageç®—æ³•åˆ†åˆ«æ˜¯åœ¨è§£å†³ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>rcnnè¯æ˜cnnå…·æœ‰è‰¯å¥½çš„ç‰¹å¾æå–èƒ½åŠ›ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå°†cnnç”¨æ¥åšç›®æ ‡æ£€æµ‹ä»»åŠ¡çš„ç®—æ³•ã€‚</li>
<li>fast-rcnnæå‡ºROI-Poolingå°†éœ€è¦åº”ç”¨åˆ°å¤šä¸ªå€™é€‰æ¡†çš„éª¨å¹²CNNç½‘ç»œè¿›è¡Œå…±äº«ï¼ŒåŠ å¿«é€Ÿåº¦çš„åŒæ—¶ä¹Ÿæå‡äº†å‡†ç¡®ç‡ã€‚</li>
<li>faster-rcnnè§£å†³äº†å€™é€‰æ¡†æœç´¢è€—æ—¶è¿‡å¤šçš„é—®é¢˜ï¼Œæå‡ºRPNå…¨å·ç§¯ç½‘ç»œç”¨äºå­¦ä¹ æå–å€™é€‰æ¡†ï¼Œé€Ÿåº¦æ›´å¿«ä¸”ç²¾åº¦æ›´é«˜ã€‚</li>
</ul>
<p>è€ŒFaster-RCNNçš„ä¸€ä¸ªç¼ºç‚¹åœ¨äºåœ¨ROI Poolingä¹‹åå…¨æ˜¯å…¨è¿æ¥å±‚ï¼Œä»è€Œå°†ROI  Poolingä¹‹åçš„ç‰¹å¾å›¾æ˜ å°„ä¸ºåˆ†ç±»å’Œå›å½’ä¸¤ä¸ªä»»åŠ¡ã€‚è€Œè¶Šæ¥è¶Šå¤šçš„åŸºç¡€CNNæ¶æ„å¦‚GoogleNetï¼ŒResNetç­‰å…¨å·ç§¯ç½‘ç»œè¯æ˜ä¸è¦å…¨è¿æ¥å±‚ï¼Œç½‘ç»œçš„æ•ˆæœä¸ä»…ä¼šæ›´å¥½å¹¶ä¸”è¿˜å¯ä»¥é€‚åº”ä¸åŒå°ºåº¦çš„è¾“å…¥å›¾ç‰‡ã€‚å› ä¸ºç€çœ¼äºFaster-RCNNçš„å…¨è¿æ¥å±‚è´Ÿè½½å¾ˆé‡è¿™ä¸€ç—›ç‚¹ï¼ŒR-FCNå‡ºä¸–äº†ã€‚</p>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>R-FCNä¸­ä¸»è¦æœ‰2ä¸ªé‡è¦çš„ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯å°†ROI Poolingåé¢çš„å…¨è¿æ¥å±‚éƒ½ç”¨å·ç§¯å±‚æ‰€ä»£æ›¿ï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹ROI Poolingçš„é­”æ”¹ã€‚</p>
<h2 id="R-FCNæ•´ä½“ç»“æ„"><a href="#R-FCNæ•´ä½“ç»“æ„" class="headerlink" title="R-FCNæ•´ä½“ç»“æ„"></a>R-FCNæ•´ä½“ç»“æ„</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºFaster-RCNNæ˜¯ä¼šå¯¹æ¯ä¸€ä¸ªå€™é€‰æ¡†åŒºåŸŸæ‰§è¡ŒROI  Poolingæ“ä½œä¹‹åå•ç‹¬è·‘åé¢çš„åˆ†ç±»å’Œå›å½’åˆ†æ”¯çš„ã€‚å®é™…ä¸Šæ˜¯åˆ†æˆäº†å‡ ä¸ªsubnetworkï¼Œç¬¬ä¸€ä¸ªç”¨æ¥åœ¨æ•´å¼ å›¾ä¸Šåšæ¯”è¾ƒè€—æ—¶çš„convï¼Œè¿™äº›æ“ä½œä¸regionæ— å…³ï¼Œæ˜¯è®¡ç®—å…±äº«çš„ã€‚ç¬¬äºŒä¸ªsubnetworkæ˜¯ç”¨æ¥äº§ç”Ÿå€™é€‰çš„boundingboxï¼ˆå¦‚RPNï¼‰ï¼Œç¬¬ä¸‰ä¸ªsubnetworkç”¨æ¥åˆ†ç±»æˆ–è¿›ä¸€æ­¥å¯¹boxè¿›è¡Œregressionï¼ˆå¦‚Fast RCNNï¼‰ï¼Œè¿™ä¸ªsubnetworkå’Œregionæ˜¯æœ‰å…³ç³»çš„ï¼Œå¿…é¡»æ¯ä¸ªregionå•ç‹¬è·‘ç½‘ç»œï¼Œè¡”æ¥åœ¨è¿™ä¸ªsubnetworkå’Œå‰ä¸¤ä¸ªsubnetworkä¸­é—´çš„å°±æ˜¯ROI poolingã€‚æˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼Œè€—æ—¶çš„å·ç§¯éƒ½å°½é‡ç§»åˆ°å‰é¢å…±äº«çš„subnetworkä¸Šã€‚å› æ­¤R-FCNå¸Œæœ›è€—æ—¶çš„å·ç§¯éƒ½å°½é‡ç§»åŠ¨åˆ°å‰é¢å…±äº«çš„ç½‘ç»œä¸­ã€‚åŸºäºæ­¤ï¼Œå’ŒFaster-RCNNç”¨ResNetåšBackboneçš„å¤„ç†æ–¹å¼ä¸åŒ(å‰é¢<code>91</code>å±‚å…±äº«ï¼Œç„¶åæ’å…¥<code>ROIPooling</code>ï¼Œåé¢<code>10</code>å±‚ä¸å…±äº«)ï¼ŒR-FCNæŠŠæ‰€æœ‰çš„<code>101</code>å±‚éƒ½è®¾ç½®ä¸ºå…±äº«ç½‘ç»œï¼Œæœ€åç”¨æ¥åšé¢„æµ‹çš„åªæœ‰ä¸€ä¸ªå·ç§¯å±‚ï¼Œå¤§å¤§å‡å°‘äº†è®¡ç®—é‡ã€‚è¿™ä¸€ç‚¹å‚è§Table1ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/640.webp" alt></p>
<p>R-FCNå¯ä»¥åˆ†æˆä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>Backboneç½‘ç»œï¼Œå¦‚ResNet101ç½‘ç»œã€‚</li>
<li>ä¸€ä¸ªåŒºåŸŸå»ºè®®ç½‘ç»œ(RPN)ã€‚</li>
<li>ä¸€ä¸ªæ­£ä¾‹æ•æ„Ÿçš„é¢„æµ‹å±‚ã€‚</li>
<li>æœ€åçš„ROI Pooling+æŠ•ç¥¨çš„å†³ç­–å±‚ã€‚</li>
</ul>
<p>R-FCNçš„ç½‘ç»œç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/641.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°æ•´ä½“ç»“æ„å’ŒFaster-RCNNæ¯”è¾ƒåƒï¼Œéƒ½æœ‰RPNç½‘ç»œæ¥è®­ç»ƒç”Ÿæˆå€™é€‰æ¡†ï¼Œè€ŒROI Poolingæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥å°±ä»”ç»†è®²è®²ã€‚</p>
<h2 id="R-FCNçš„ROIPooling"><a href="#R-FCNçš„ROIPooling" class="headerlink" title="R-FCNçš„ROIPooling"></a>R-FCNçš„ROIPooling</h2><p>æˆ‘ä»¬çœç•¥ä¸€ä¸‹R-FCNå’ŒFaster-RCNNç½‘ç»œç»“æ„å®Œå…¨ç›¸åŒçš„éƒ¨åˆ†ï¼Œç€çœ¼äºR-FCNçš„å˜åŒ–ä¹‹å¤„å³ROIPoolingï¼Œå…³é”®éƒ¨åˆ†å¦‚è®ºæ–‡ä¸­çš„Figure1æ‰€ç¤ºã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°±é’ˆå¯¹è¿™å¼ å›¾æ¥ä»”ç»†åˆ†æã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/642.webp" alt></p>
<ul>
<li><strong>Backbone architecture</strong>: ResNet 101â€”å»æ‰åŸå§‹ResNet101çš„æœ€åä¸€å±‚å…¨è¿æ¥å±‚ï¼Œä¿ç•™å‰100å±‚ï¼Œå†æ¥ä¸€ä¸ª1 x 1 x 1024çš„å…¨å·ç§¯å±‚ï¼ˆ100å±‚è¾“å‡ºæ˜¯2048ï¼Œä¸ºäº†é™ç»´ï¼Œå†å¼•å…¥äº†ä¸€ä¸ª1 x 1çš„å·ç§¯å±‚ï¼‰ã€‚</li>
<li><strong>$k^{2} \times(C+1)$çš„conv</strong>: ResNet101çš„è¾“å‡ºæ˜¯W x H x 1024ï¼Œç”¨$k^{2} \times(C+1)$ä¸ª1024 x 1 x 1çš„å·ç§¯æ ¸å»å·ç§¯å³å¯å¾—åˆ°$k^{2} \times(C+1)$ä¸ªå¤§å°ä¸ºW x Hçš„position sensitiveçš„score mapã€‚è¿™æ­¥çš„å·ç§¯æ“ä½œå°±æ˜¯åœ¨åšpredictionã€‚k = 3ï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªROIåˆ’åˆ†æˆ3 x 3ï¼Œå¯¹åº”çš„9ä¸ªä½ç½®åˆ†åˆ«æ˜¯ï¼šä¸Šå·¦ï¼ˆå·¦ä¸Šè§’ï¼‰ï¼Œä¸Šä¸­ï¼Œä¸Šå³ï¼Œä¸­å·¦ï¼Œä¸­ä¸­ï¼Œä¸­å³ï¼Œä¸‹å·¦ï¼Œä¸‹ä¸­ï¼Œä¸‹å³ï¼ˆå³ä¸‹è§’ï¼‰</li>
<li><strong>$k^{2} \times(C+1)$ä¸ªfeature mapçš„ç‰©ç†æ„ä¹‰</strong>: å…±æœ‰k x k = 9ä¸ªé¢œè‰²ï¼Œæ¯ä¸ªé¢œè‰²çš„ç«‹ä½“å—ï¼ˆW x H x (C+1)ï¼‰è¡¨ç¤ºçš„æ˜¯ä¸åŒä½ç½®å­˜åœ¨ç›®æ ‡çš„æ¦‚ç‡å€¼ï¼ˆç¬¬ä¸€å—é»„è‰²è¡¨ç¤ºçš„æ˜¯å·¦ä¸Šè§’ä½ç½®ï¼Œæœ€åä¸€å—æ·¡è“è‰²è¡¨ç¤ºçš„æ˜¯å³ä¸‹è§’ä½ç½®ï¼‰ã€‚å…±æœ‰$k^{2} \times(C+1)$ä¸ªfeature mapã€‚æ¯ä¸ªfeature mapï¼Œz(i,j,c)æ˜¯ç¬¬i+k(j-1)ä¸ªç«‹ä½“å—ä¸Šçš„ç¬¬cä¸ªmapï¼ˆ1&lt;= i,j &lt;=3ï¼‰ã€‚(i,j)å†³å®šäº†9ç§ä½ç½®çš„æŸä¸€ç§ä½ç½®ï¼Œå‡è®¾ä¸ºå·¦ä¸Šè§’ä½ç½®ï¼ˆi=j=1ï¼‰ï¼Œcå†³å®šäº†å“ªä¸€ç±»ï¼Œå‡è®¾ä¸ºpersonç±»ã€‚åœ¨z(i,j,c)è¿™ä¸ªfeature mapä¸Šçš„æŸä¸€ä¸ªåƒç´ çš„ä½ç½®æ˜¯ï¼ˆx,yï¼‰ï¼Œåƒç´ å€¼æ˜¯valueï¼Œåˆ™valueè¡¨ç¤ºçš„æ˜¯åŸå›¾å¯¹åº”çš„(x,y)è¿™ä¸ªä½ç½®ä¸Šå¯èƒ½æ˜¯äººï¼ˆc=â€˜personâ€™ï¼‰ä¸”æ˜¯äººçš„å·¦ä¸Šéƒ¨ä½ï¼ˆi=j=1ï¼‰çš„æ¦‚ç‡å€¼ã€‚</li>
<li><strong>ROI pooling</strong>: å°±æ˜¯faster RCNNä¸­çš„ROI poolingï¼Œä¹Ÿå°±æ˜¯ä¸€å±‚çš„SPPç»“æ„ã€‚ä¸»è¦ç”¨æ¥å°†ä¸åŒå¤§å°çš„ROIå¯¹åº”çš„feature mapæ˜ å°„æˆåŒæ ·ç»´åº¦çš„ç‰¹å¾ï¼Œæ€è·¯æ˜¯ä¸è®ºå¯¹å¤šå¤§çš„ROIï¼Œè§„å®šåœ¨ä¸Šé¢ç”»ä¸€ä¸ªn x n ä¸ªbinçš„ç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼é‡Œçš„æ‰€æœ‰åƒç´ å€¼åšä¸€ä¸ªpoolingï¼ˆå¹³å‡ï¼‰ï¼Œè¿™æ ·ä¸è®ºå›¾åƒå¤šå¤§ï¼Œpoolingåçš„ROIç‰¹å¾ç»´åº¦éƒ½æ˜¯n x nã€‚æ³¨æ„ä¸€ç‚¹ROI poolingæ˜¯æ¯ä¸ªfeature mapå•ç‹¬åšï¼Œä¸æ˜¯å¤šä¸ªchannelä¸€èµ·çš„ã€‚</li>
<li><strong>voteæŠ•ç¥¨</strong>ï¼šk x kä¸ªbinç›´æ¥è¿›è¡Œæ±‚å’Œï¼ˆæ¯ä¸ªç±»å•ç‹¬åšï¼‰å¾—åˆ°æ¯ä¸€ç±»çš„scoreï¼Œå¹¶è¿›è¡Œsoftmaxå¾—åˆ°æ¯ç±»çš„æœ€ç»ˆå¾—åˆ†ï¼Œå¹¶ç”¨äºè®¡ç®—æŸå¤±</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°åŸå§‹å›¾åƒç»è¿‡Backboneçš„å·ç§¯ç¥ç»ç½‘ç»œä¹‹åå¾—åˆ°äº†æœ€åä¸€å±‚ç‰¹å¾å›¾ï¼Œæ¥ä¸‹æ¥å°±åº”è¯¥æ˜¯æå–å½“å‰ç‰¹å¾å›¾çš„ROIåŒºåŸŸäº†ã€‚è¿™ä¸ªåœ°æ–¹ROIPoolingä¸åƒFaster-RCNNé‚£æ ·ç›´æ¥æå–ï¼Œè€Œæ˜¯é‡æ–°è®¾è®¡äº†ä¸€ä¸ªä½ç½®æ•æ„Ÿçš„ROIPoolingï¼šå°†Faster-RCNNä¸­çš„ROIåˆ’åˆ†æˆk x kå¤§å°ï¼Œå³æ˜¯è¯´å°†ROIåŒºåŸŸåˆ†æˆk x kä¸ªå°åŒºåŸŸï¼ˆè®ºæ–‡ä¸­å–k = 3ï¼Œå³å°†ROIåŒºåŸŸåˆ†æˆ9ä¸ªéƒ¨åˆ†ï¼‰ã€‚ç„¶åå‡è®¾ç›®æ ‡æ£€æµ‹æ•°æ®é›†çš„ç›®æ ‡ç±»åˆ«ä¸€å…±æœ‰Cç±»ï¼ŒåŒæ—¶åŠ ä¸Šä¸€ä¸ªèƒŒæ™¯ç±»å°±æ˜¯C + 1ç±»ï¼Œæœ€åæˆ‘ä»¬å¸Œæœ›ç½‘ç»œå¯¹æ¯ä¸ªç±»åˆ«éƒ½æœ‰å„è‡ªçš„ä½ç½®å“åº”ã€‚å› æ­¤æœ€åROIPoolingå±‚çš„ç‰¹å¾ç»´åº¦æ˜¯$k^{2} \times(C+1)$ä»£è¡¨æ¯ä¸€ä¸ªç±»åˆ«åœ¨æŸä¸ªä½ç½®(ä¸€å…±9ä¸ª)çš„ä½ç½®æ•æ„Ÿåº¦mapï¼Œå…¶ä¸­æ¯ä¸ªmapçš„å¤§å°å’ŒROIPoolingå‰é¢é‚£ä¸ªBackboneç½‘ç»œå¾—åˆ°çš„ç‰¹å¾å›¾å°ºå¯¸å®Œå…¨ä¸€è‡´ã€‚</p>
<p>é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•ä»ä½ç½®æ•æ„Ÿ<code>map</code>å¾—åˆ°æœ€åé‚£ä¸ªC + 1ä¸ªé€šé“ï¼Œå¹¶ä¸”å°ºå¯¸ä¸ºk x kçš„ç‰¹å¾å›¾å‘¢ï¼Ÿå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/643.jpg" alt></p>
<p>Figure3å±•ç¤ºäº†åœ¨äººè¿™<strong>ä¸€ç±»</strong>ç›®æ ‡ä¸Šæ˜¯å¦‚ä½•ä»ä½ç½®æ•æ„Ÿmapå¾—åˆ°æœ€åè¾“å‡ºå›¾ï¼Œè¿™é‡Œk = 3ï¼Œé‚£ä¹ˆä½ç½®æ•æ„Ÿ<code>map</code>å¯ä»¥ç”¨ä¸‹é¢çš„è¡¨æ ¼æ¥è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/644.webp" alt></p>
<p>å…¶ä¸­$\operatorname{Pos}_{x}^{y}$ä»£è¡¨ä½ç½®ä¸º$x$ï¼ˆå³å›¾ä¸­çš„<code>å·¦ä¸Š</code>ï¼Œ<code>ä¸­ä¸Š</code>ï¼Œ<code>å³ä¸‹</code>ï¼Œ<code>å·¦ä¸­</code>ï¼Œ<code>ä¸­é—´</code>ï¼Œ<code>å³ä¸­</code>ï¼Œ<code>å·¦ä¸‹</code>ï¼Œ<code>ä¸­ä¸‹</code>ï¼Œ<code>å³ä¸‹</code>9ä¸ªä½ç½®ï¼‰å¯¹åº”çš„ç±»åˆ«é›†åˆä¸º$y$çš„ä½ç½®æ•æ„Ÿ<code>map</code>ï¼Œæ¯ä¸ªè¡¨æ ¼çš„å†…å®¹å¯¹åº”ä½ç½®æ•æ„Ÿ<code>map</code>ä¸­ä¸€ç§é¢œè‰²çš„éƒ¨åˆ†ç‰¹å¾å›¾(C + 1ä¸ªé€šé“)ï¼Œä½ç½®æ•æ„Ÿ<code>map</code>æ¯ä¸ªC + 1é€šé“åˆ†åˆ«ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³å¯¹åº”äº†ä¸Šé¢çš„è¡¨æ ¼ã€‚è¿™é‡Œå‡è®¾Figure3ä¸­çš„Personç±»å¯¹åº”çš„æ˜¯ç¬¬ä¸€ä¸ªåˆ†ç±»ï¼Œé‚£ä¹ˆFigure3çš„å¤„ç†è¿‡ç¨‹å°±æ˜¯å¯¹ä¸‹è¡¨å¯¹åº”çš„ç‰¹å¾å›¾è¿›è¡Œæ“ä½œï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/645.webp" alt></p>
<p>å…·ä½“çš„æ“ä½œæµç¨‹è¡¨ç¤ºä¸ºï¼š</p>
<ul>
<li><p>1ã€æŠ½å–ç‰¹å®šç±»åˆ«(è¿™é‡Œä¸ºäººè¿™ä¸ªç±»åˆ«)å¯¹åº”çš„$k \times k=3 \times 3=9$ä¸ªä½ç½®çš„ç‰¹å¾å›¾ï¼Œå¦‚Figure3ä¸­éƒ¨æ‰€ç¤ºã€‚</p>
</li>
<li><p>2ã€å¯¹æŠ½å–å‡ºæ¥çš„éƒ¨åˆ†è¿›è¡Œæ±‚å‡å€¼ï¼Œç„¶åæŒ‰ç…§ä½ç½®ç»„æˆä¸€ä¸ª$k \times k=3 \times 3$å¤§å°çš„çŸ©é˜µã€‚</p>
</li>
<li><p>3ã€å¯¹è¿™ä¸ª$k \times k$å¤§å°çš„çŸ©é˜µæ±‚å’Œï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚</p>
</li>
<li><p>4ã€å¯¹å…¶ä»–æ¯ä¸ªç±»åˆ«éƒ½æ‰§è¡Œ1-3æ­¥éª¤ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª$1 \times(C+1)$çš„å‘é‡ã€‚å°†è¿™ä¸ªå‘é‡è¿›è¡Œ<code>softmax</code>ï¼Œä»è€Œåˆ¤åˆ«ç‰¹å¾å›¾ä¸Šçš„è¿™ä¸ªROIåŒºåŸŸå¯¹åº”çš„ç›®æ ‡ç±»åˆ«æ˜¯ä»€ä¹ˆã€‚</p>
</li>
</ul>
<h2 id="R-FCNçš„ç›®æ ‡æ¡†å›å½’"><a href="#R-FCNçš„ç›®æ ‡æ¡†å›å½’" class="headerlink" title="R-FCNçš„ç›®æ ‡æ¡†å›å½’"></a><strong>R-FCNçš„ç›®æ ‡æ¡†å›å½’</strong></h2><p>ä¸Šé¢è¯¦ç»†è®²è§£äº†R-FCNæå‡ºçš„ROIPoolingçš„æ”¹è¿›ä¹‹å¤„ä»¥åŠå¯¹äºç›®æ ‡åˆ†ç±»çš„å¤„ç†æ–¹æ³•ï¼Œä¸è¦å¿˜è®°ç›®æ ‡æ£€æµ‹è¿˜æœ‰ä¸€ä¸ªæ¡†å›å½’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œæ¥è¯´ä¸€ä¸‹å¦‚ä½•å¾®è°ƒROIåŒºåŸŸä½¿å¾—æ¡†æ›´åŠ ç²¾ç¡®ï¼Œè¿™éƒ¨åˆ†å’Œåˆ†ç±»å®é™…ä¸Šæ˜¯ç±»ä¼¼çš„ã€‚æˆ‘ä»¬çŸ¥é“ä½ç½®æ•æ„Ÿ<code>map</code>æ˜¯æœ‰$k^{2}(C+1)$ä¸ªé€šé“çš„ï¼Œæˆ‘ä»¬ä¾ç„¶ä»Backboneçš„æœ€åä¸€ä¸ªç‰¹å¾å±‚éƒ¨åˆ†æ¥è§¦ä¸€ä¸ªæœ‰$4 \times k^{2}$ä¸ªé€šé“çš„ç‰¹å¾å›¾(å’Œä½ç½®æ•æ„Ÿmapå¹¶åˆ—)ï¼Œç”¨æ¥åšROIæ¡†å›å½’ï¼Œå¦‚ä¸‹é¢çš„è¡¨æ ¼æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/646.webp" alt></p>
<p>ç„¶åæ‰§è¡Œå’Œåˆ†ç±»ä¸€æ ·çš„æ­¥éª¤å¾—åˆ°ä¸€ä¸ª1 x 4çš„å‘é‡å³ä»£è¡¨ROIåŒºåŸŸçš„$x, y, w, h$ã€‚è®¡ç®—æŸå¤±å‡½æ•°å’Œå‰é¢Faster-RCNNçš„ä¸€è‡´ï¼Œå‡ä¸ºå¤šä»»åŠ¡æŸå¤±è”åˆè®­ç»ƒï¼Œåˆ†ç±»ä½¿ç”¨äº¤å‰ç†µï¼Œå®šä½ä½¿ç”¨L1-smoothæŸå¤±å‡½æ•°ã€‚</p>
<h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><ul>
<li><p>è®­ç»ƒçš„æ ·æœ¬é€‰æ‹©ç­–ç•¥ï¼šä½¿ç”¨OHEMç­–ç•¥ï¼ŒåŸç†å°±æ˜¯å¯¹æ ·æœ¬æŒ‰lossè¿›è¡Œæ’åºï¼Œé€‰æ‹©å‰é¢lossè¾ƒå°çš„ï¼Œè¿™ä¸ªç­–ç•¥ä¸»è¦ç”¨æ¥å¯¹è´Ÿæ ·æœ¬è¿›è¡Œç­›é€‰ï¼Œä½¿å¾—æ­£è´Ÿæ ·æœ¬æ›´åŠ å¹³è¡¡ã€‚</p>
</li>
<li><p>è®­ç»ƒç»†èŠ‚ï¼š</p>
<ul>
<li>SGD+å¸¦åŠ¨é‡çš„ä¼˜åŒ–æ–¹å¼ï¼Œå…¶ä¸­åŠ¨é‡momentum = 0.9ã€‚</li>
<li>æƒé‡æƒ©ç½šä¸º0.0005ã€‚</li>
<li>å•å°ºåº¦è®­ç»ƒï¼Œå°†å›¾ç‰‡$\min (\text {height}, \text {width})$è®¾ç½®ä¸º600ã€‚</li>
<li>8å—GPUï¼Œæ¯ä¸€å—GPUè®­ç»ƒä¸€å¼ å›¾ç‰‡å¹¶ä¸”éšæœºé€‰æ‹©128ä¸ªROIåŒºåŸŸè¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚</li>
<li>åœ¨å‰20kæ¬¡è¿­ä»£ï¼Œå­¦ä¹ ç‡ä¸º0.001ï¼Œåé¢10kæ¬¡è¿­ä»£ä¸º0.0001ã€‚</li>
<li>ä½¿ç”¨å’ŒFaster-RCNNä¸­ä¸€è‡´çš„è®­ç»ƒæ–¹å¼ã€‚</li>
<li>ä½¿ç”¨<code>atrous</code>ï¼ˆholeï¼‰ç®—æ³•ã€‚å¢åŠ æ„Ÿå—é‡çš„åŒæ—¶é™ä½ä¸‹é‡‡æ ·æ¬¡æ•°ã€‚å¹¶ä¸”ä½¿ç”¨äº†è¿™ä¸€ç­–ç•¥åœ¨VOC 2007ä¸Šå¯ä»¥æå‡2ä¸ªç‚¹çš„mapã€‚</li>
</ul>
</li>
</ul>
<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/647.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°R-FCNåœ¨æ²¡æœ‰OHEMçš„ç­–ç•¥ä¸‹ç²¾åº¦å®Œå…¨åŠæ‰“äº†Faster-RCNNï¼Œå…¶ä¸­<code>fail</code>è¡¨ç¤ºçš„åº”è¯¥æ˜¯å½“k = 1çš„æ—¶å€™åº”è¯¥æ˜¯æ¨¡å‹æ— æ³•æ”¶æ•›ã€‚</p>
<h3 id="åœ¨PASCAL-VOCæ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœ"><a href="#åœ¨PASCAL-VOCæ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœ" class="headerlink" title="åœ¨PASCAL VOCæ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœ"></a>åœ¨PASCAL VOCæ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœ</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/648.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°R-FCNä½¿ç”¨ResNet101åšç‰¹å¾æå–ç½‘ç»œï¼Œæœ€ç»ˆåœ¨VOCçš„æµ‹è¯•é›†ä¸Šè·å¾—äº†83.6%çš„mapå€¼ï¼Œå¹¶ä¸”ç›¸æ¯”äºFaster-RCNNæµ‹è¯•æ—¶é—´åŠ é€Ÿäº†2å€ä»¥ä¸Šã€‚è®ºæ–‡è¿˜ç»™å‡ºäº†ä¸€äº›æ¶ˆèç ”ç©¶ï¼š</p>
<ul>
<li><p>æ·±åº¦å½±å“å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºResNet-101è¡¨ç°æœ€å¥½ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/649.png" alt></p>
</li>
<li><p>å€™é€‰åŒºåŸŸé€‰æ‹©ç®—æ³•å¯¹æ¯”ï¼šRPNæ¯”SSï¼ŒEBå¥½ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/650.png" alt></p>
</li>
</ul>
<h3 id="åœ¨MS-COCOæ•°æ®é›†çš„æµ‹è¯•ç»“æœ"><a href="#åœ¨MS-COCOæ•°æ®é›†çš„æµ‹è¯•ç»“æœ" class="headerlink" title="åœ¨MS COCOæ•°æ®é›†çš„æµ‹è¯•ç»“æœ"></a>åœ¨MS COCOæ•°æ®é›†çš„æµ‹è¯•ç»“æœ</h3><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/651.png" alt></p>
<h2 id="å¯è§†åŒ–æ•ˆæœå±•ç¤º"><a href="#å¯è§†åŒ–æ•ˆæœå±•ç¤º" class="headerlink" title="å¯è§†åŒ–æ•ˆæœå±•ç¤º"></a>å¯è§†åŒ–æ•ˆæœå±•ç¤º</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/R-FCN/652.webp" alt></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>R-FCNåœ¨Faster-RCNNçš„åŸºç¡€ä¸Šè‡´åŠ›äºè§£å†³å…¨è¿æ¥ç½‘ç»œåšåˆ†ç±»å’Œå›å½’é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ï¼Œå°†åˆ†ç±»å’Œå›å½’åˆ†æ”¯æ¢æˆäº†å…¨å·ç§¯ç½‘ç»œï¼Œå¹¶æå‡ºäº†ä¸€ä¸ªä½ç½®æ•æ„ŸROIPoolingç”¨äºæŒ‡å®šä¸åŒç‰¹å¾å›¾æ˜¯è´Ÿè´£æ£€æµ‹ç›®æ ‡çš„ä¸åŒä½ç½®ï¼Œç„¶åROIPoolingä¹‹åæŠŠä¸åŒä½ç½®å¾—åˆ°çš„ç‰¹å¾å›¾è¿›è¡Œç»„åˆå°±èƒ½å¤ç°åŸæ¥çš„ä½ç½®ä¿¡æ¯ã€‚ä¸ä»…åœ¨ç²¾åº¦ä¸Šå¤§å¹…åº¦è¶…è¶ŠFaster-RCNNï¼Œå¹¶ä¸”é€Ÿåº¦æ˜¯Faster-RCNNçš„2å€ä»¥ä¸Šã€‚</p>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><p>è®ºæ–‡åŸæ–‡ï¼š<a href="https://arxiv.org/pdf/1605.06409v2.pdf">https://arxiv.org/pdf/1605.06409v2.pdf</a></p>
<p>å®˜æ–¹æºç å¤ç°ï¼š<a href="https://github.com/daijifeng001/r-fcn">https://github.com/daijifeng001/r-fcn</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨YOLOv3æ¨¡å‹ä¸­æ·»åŠ Attentionæœºåˆ¶</title>
    <url>/2020/02/18/%E5%9C%A8YOLOv3%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B7%BB%E5%8A%A0Attention%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="1-è§„å®šæ ¼å¼"><a href="#1-è§„å®šæ ¼å¼" class="headerlink" title="1. è§„å®šæ ¼å¼"></a>1. è§„å®šæ ¼å¼</h2><p>æ­£å¦‚<code>[convolutional]</code>,<code>[maxpool]</code>,<code>[net]</code>,<code>[route]</code>ç­‰å±‚åœ¨cfgä¸­çš„å®šä¹‰ä¸€æ ·ï¼Œæˆ‘ä»¬å†æ·»åŠ å…¨æ–°çš„æ¨¡å—çš„æ—¶å€™ï¼Œè¦è§„å®šä¸€ä¸‹cfgçš„æ ¼å¼ã€‚åšå‡ºä»¥ä¸‹è§„å®šï¼š</p>
<p>åœ¨SEæ¨¡å—ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°ä¸º<code>reduction</code>,è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯16ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ¨¡å—ä¸­çš„è¯¦ç»†å‚æ•°æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹å†…å®¹è¿›è¡Œè®¾ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[se]</span><br><span class="line">reduction=16</span><br></pre></td></tr></table></figure>
<p>åœ¨CBAMæ¨¡å—ä¸­ï¼Œç©ºé—´æ³¨æ„åŠ›æœºåˆ¶å’Œé€šé“æ³¨æ„åŠ›æœºåˆ¶ä¸­ä¸€å…±å­˜åœ¨ä¸¤ä¸ªå‚æ•°ï¼š<code>ratio</code>å’Œ<code>kernel_size</code>, æ‰€ä»¥è¿™æ ·è§„å®šCBAMåœ¨cfgæ–‡ä»¶ä¸­çš„æ ¼å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[cbam]</span><br><span class="line">ratio=16</span><br><span class="line">kernelsize=7</span><br></pre></td></tr></table></figure>
<h2 id="2-ä¿®æ”¹è§£æéƒ¨åˆ†"><a href="#2-ä¿®æ”¹è§£æéƒ¨åˆ†" class="headerlink" title="2. ä¿®æ”¹è§£æéƒ¨åˆ†"></a>2. ä¿®æ”¹è§£æéƒ¨åˆ†</h2><p>ç”±äºæ·»åŠ çš„è¿™äº›å‚æ•°éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è§£æcfgæ–‡ä»¶çš„å‡½æ•°ï¼Œä¹‹å‰è®²è¿‡ï¼Œéœ€è¦ä¿®æ”¹<code>parse_config.py</code>ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_model_cfg</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="comment"># pathå‚æ•°ä¸º: cfg/yolov3-tiny.cfg</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> path.endswith(<span class="string">&#x27;.cfg&#x27;</span>):</span><br><span class="line">        path += <span class="string">&#x27;.cfg&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path) <span class="keyword">and</span> \</span><br><span class="line">    	   os.path.exists(<span class="string">&#x27;cfg&#x27;</span> + os.sep + path):</span><br><span class="line">        path = <span class="string">&#x27;cfg&#x27;</span> + os.sep + path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å»é™¤ä»¥#å¼€å¤´çš„ï¼Œå±äºæ³¨é‡Šéƒ¨åˆ†çš„å†…å®¹</span></span><br><span class="line">    lines = [x <span class="keyword">for</span> x <span class="keyword">in</span> lines <span class="keyword">if</span> x <span class="keyword">and</span> <span class="keyword">not</span> x.startswith(<span class="string">&#x27;#&#x27;</span>)]</span><br><span class="line">    lines = [x.rstrip().lstrip() <span class="keyword">for</span> x <span class="keyword">in</span> lines]</span><br><span class="line">    mdefs = []  <span class="comment"># æ¨¡å—çš„å®šä¹‰</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">&#x27;[&#x27;</span>):  <span class="comment"># æ ‡å¿—ç€ä¸€ä¸ªæ¨¡å—çš„å¼€å§‹</span></span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            eg:</span></span><br><span class="line"><span class="string">            [shortcut]</span></span><br><span class="line"><span class="string">            from=-3</span></span><br><span class="line"><span class="string">            activation=linear</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            mdefs.append(&#123;&#125;)</span><br><span class="line">            mdefs[-<span class="number">1</span>][<span class="string">&#x27;type&#x27;</span>] = line[<span class="number">1</span>:-<span class="number">1</span>].rstrip()</span><br><span class="line">            <span class="keyword">if</span> mdefs[-<span class="number">1</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;convolutional&#x27;</span>:</span><br><span class="line">                mdefs[-<span class="number">1</span>][<span class="string">&#x27;batch_normalize&#x27;</span>] = <span class="number">0</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            key, val = line.split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">            key = key.rstrip()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;anchors&#x27;</span> <span class="keyword">in</span> key:</span><br><span class="line">                mdefs[-<span class="number">1</span>][key] = np.array([<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> val.split(<span class="string">&#x27;,&#x27;</span>)]).reshape((-<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                mdefs[-<span class="number">1</span>][key] = val.strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check all fields are supported</span></span><br><span class="line">    supported = [<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;batch_normalize&#x27;</span>, <span class="string">&#x27;filters&#x27;</span>, <span class="string">&#x27;size&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;stride&#x27;</span>, <span class="string">&#x27;pad&#x27;</span>, <span class="string">&#x27;activation&#x27;</span>, <span class="string">&#x27;layers&#x27;</span>, \</span><br><span class="line">                 <span class="string">&#x27;groups&#x27;</span>,<span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;mask&#x27;</span>, <span class="string">&#x27;anchors&#x27;</span>, \</span><br><span class="line">                 <span class="string">&#x27;classes&#x27;</span>, <span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;jitter&#x27;</span>, <span class="string">&#x27;ignore_thresh&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;truth_thresh&#x27;</span>, <span class="string">&#x27;random&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;stride_x&#x27;</span>, <span class="string">&#x27;stride_y&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    f = []  <span class="comment"># fields</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> mdefs[<span class="number">1</span>:]:</span><br><span class="line">        [f.append(k) <span class="keyword">for</span> k <span class="keyword">in</span> x <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> f]</span><br><span class="line">    u = [x <span class="keyword">for</span> x <span class="keyword">in</span> f <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> supported]  <span class="comment"># unsupported fields</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> <span class="built_in">any</span>(u), <span class="string">&quot;Unsupported fields %s in %s. See https://github.com/ultralytics/yolov3/issues/631&quot;</span> % (u, path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mdefs</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå†…å®¹ä¸­ï¼Œéœ€è¦æ”¹çš„æ˜¯supportedä¸­çš„å­—æ®µï¼Œå°†æˆ‘ä»¬çš„å†…å®¹æ·»åŠ è¿›å»ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">supported = [<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;batch_normalize&#x27;</span>, <span class="string">&#x27;filters&#x27;</span>, <span class="string">&#x27;size&#x27;</span>,\</span><br><span class="line">            <span class="string">&#x27;stride&#x27;</span>, <span class="string">&#x27;pad&#x27;</span>, <span class="string">&#x27;activation&#x27;</span>, <span class="string">&#x27;layers&#x27;</span>, \</span><br><span class="line">            <span class="string">&#x27;groups&#x27;</span>,<span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;mask&#x27;</span>, <span class="string">&#x27;anchors&#x27;</span>, \</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>, <span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;jitter&#x27;</span>, <span class="string">&#x27;ignore_thresh&#x27;</span>,\</span><br><span class="line">            <span class="string">&#x27;truth_thresh&#x27;</span>, <span class="string">&#x27;random&#x27;</span>,\</span><br><span class="line">            <span class="string">&#x27;stride_x&#x27;</span>, <span class="string">&#x27;stride_y&#x27;</span>,\</span><br><span class="line">            <span class="string">&#x27;ratio&#x27;</span>, <span class="string">&#x27;reduction&#x27;</span>, <span class="string">&#x27;kernelsize&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="3-å®ç°SEå’ŒCBAM"><a href="#3-å®ç°SEå’ŒCBAM" class="headerlink" title="3. å®ç°SEå’ŒCBAM"></a>3. å®ç°SEå’ŒCBAM</h2><p><strong>SE</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SELayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, channel, reduction=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SELayer, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.fc = nn.Sequential(</span><br><span class="line">            nn.Linear(channel, channel // reduction, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Linear(channel // reduction, channel, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        b, c, _, _ = x.size()</span><br><span class="line">        y = self.avg_pool(x).view(b, c)</span><br><span class="line">        y = self.fc(y).view(b, c, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x * y.expand_as(x)</span><br></pre></td></tr></table></figure>
<p><strong>CBAM</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpatialAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, kernel_size=<span class="number">7</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SpatialAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> kernel_size <span class="keyword">in</span> (<span class="number">3</span>,<span class="number">7</span>), <span class="string">&quot;kernel size must be 3 or 7&quot;</span></span><br><span class="line">        padding = <span class="number">3</span> <span class="keyword">if</span> kernel_size == <span class="number">7</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.conv = nn.Conv2d(<span class="number">2</span>,<span class="number">1</span>,kernel_size, padding=padding, bias=<span class="literal">False</span>)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avgout = torch.mean(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        maxout, _ = torch.<span class="built_in">max</span>(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        x = torch.cat([avgout, maxout], dim=<span class="number">1</span>)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(x)</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChannelAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_planes, rotio=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.AdaptiveMaxPool2d(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.sharedMLP = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_planes, in_planes // ratio, <span class="number">1</span>, bias=<span class="literal">False</span>), nn.ReLU(),</span><br><span class="line">            nn.Conv2d(in_planes // rotio, in_planes, <span class="number">1</span>, bias=<span class="literal">False</span>))</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avgout = self.sharedMLP(self.avg_pool(x))</span><br><span class="line">        maxout = self.sharedMLP(self.max_pool(x))</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(avgout + maxout)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯ä¸¤ä¸ªæ¨¡å—çš„ä»£ç ï¼Œæ·»åŠ åˆ°<code>models.py</code>æ–‡ä»¶ä¸­ã€‚</p>
<h2 id="4-è®¾è®¡cfgæ–‡ä»¶"><a href="#4-è®¾è®¡cfgæ–‡ä»¶" class="headerlink" title="4. è®¾è®¡cfgæ–‡ä»¶"></a>4. è®¾è®¡cfgæ–‡ä»¶</h2><p>è¿™é‡Œä»¥<code>yolov3-tiny.cfg</code>ä¸ºbaselineï¼Œç„¶åæ·»åŠ æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ã€‚</p>
<p>CBAMä¸SEç±»ä¼¼ï¼Œæ‰€ä»¥ä»¥SEä¸ºä¾‹ï¼Œæ·»åŠ åˆ°backboneä¹‹åçš„éƒ¨åˆ†ï¼Œè¿›è¡Œä¿¡æ¯é‡æ„(refinement)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[net]</span><br><span class="line"># Testing</span><br><span class="line">batch=1</span><br><span class="line">subdivisions=1</span><br><span class="line"># Training</span><br><span class="line"># batch=64</span><br><span class="line"># subdivisions=2</span><br><span class="line">width=416</span><br><span class="line">height=416</span><br><span class="line">channels=3</span><br><span class="line">momentum=0.9</span><br><span class="line">decay=0.0005</span><br><span class="line">angle=0</span><br><span class="line">saturation = 1.5</span><br><span class="line">exposure = 1.5</span><br><span class="line">hue=.1</span><br><span class="line"></span><br><span class="line">learning_rate=0.001</span><br><span class="line">burn_in=1000</span><br><span class="line">max_batches = 500200</span><br><span class="line">policy=steps</span><br><span class="line">steps=400000,450000</span><br><span class="line">scales=.1,.1</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=16</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=32</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=64</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=256</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=512</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=1</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=1024</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[se]</span><br><span class="line">reduction=16</span><br><span class="line"></span><br><span class="line"># åœ¨backboneç»“æŸçš„åœ°æ–¹æ·»åŠ seæ¨¡å—</span><br><span class="line">#####backbone######</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=256</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=512</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=18</span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask = 3,4,5</span><br><span class="line">anchors = 10,14,  23,27,  37,58,  81,82,  135,169,  344,319</span><br><span class="line">classes=1</span><br><span class="line">num=6</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .7</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers = -4</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[upsample]</span><br><span class="line">stride=2</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers = -1, 8</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=256</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=18</span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask = 0,1,2</span><br><span class="line">anchors = 10,14,  23,27,  37,58,  81,82,  135,169,  344,319</span><br><span class="line">classes=1</span><br><span class="line">num=6</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .7</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1</span><br></pre></td></tr></table></figure>
<h2 id="5-æ¨¡å‹æ„å»º"><a href="#5-æ¨¡å‹æ„å»º" class="headerlink" title="5. æ¨¡å‹æ„å»º"></a>5. æ¨¡å‹æ„å»º</h2><p>ä»¥ä¸Šéƒ½æ˜¯å‡†å¤‡å·¥ä½œï¼Œä»¥SEä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¿®æ”¹<code>model.py</code>æ–‡ä»¶ä¸­çš„æ¨¡å‹åŠ è½½éƒ¨åˆ†ï¼Œå¹¶ä¿®æ”¹forwardå‡½æ•°éƒ¨åˆ†çš„ä»£ç ï¼Œè®©å…¶æ­£å¸¸å‘æŒ¥ä½œç”¨ï¼š</p>
<p>åœ¨<code>model.py</code>ä¸­çš„<code>create_modules</code>å‡½æ•°ä¸­è¿›è¡Œæ·»åŠ ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;se&#x27;</span>:</span><br><span class="line">    modules.add_module(</span><br><span class="line">        <span class="string">&#x27;se_module&#x27;</span>,</span><br><span class="line">        SELayer(output_filters[-<span class="number">1</span>], reduction=<span class="built_in">int</span>(mdef[<span class="string">&#x27;reduction&#x27;</span>])))</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹Darknetä¸­çš„forwardéƒ¨åˆ†çš„å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x, var=<span class="literal">None</span></span>):</span></span><br><span class="line">    img_size = x.shape[-<span class="number">2</span>:]</span><br><span class="line">    layer_outputs = []</span><br><span class="line">    output = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (mdef,</span><br><span class="line">            module) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(self.module_defs, self.module_list)):</span><br><span class="line">        mtype = mdef[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> mtype <span class="keyword">in</span> [<span class="string">&#x27;convolutional&#x27;</span>, <span class="string">&#x27;upsample&#x27;</span>, <span class="string">&#x27;maxpool&#x27;</span>]:</span><br><span class="line">            x = module(x)</span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;route&#x27;</span>:</span><br><span class="line">            layers = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> mdef[<span class="string">&#x27;layers&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(layers) == <span class="number">1</span>:</span><br><span class="line">                x = layer_outputs[layers[<span class="number">0</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    x = torch.cat([layer_outputs[i] <span class="keyword">for</span> i <span class="keyword">in</span> layers], <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">except</span>:  <span class="comment"># apply stride 2 for darknet reorg layer</span></span><br><span class="line">                    layer_outputs[layers[<span class="number">1</span>]] = F.interpolate(</span><br><span class="line">                        layer_outputs[layers[<span class="number">1</span>]], scale_factor=[<span class="number">0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">                    x = torch.cat([layer_outputs[i] <span class="keyword">for</span> i <span class="keyword">in</span> layers], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;shortcut&#x27;</span>:</span><br><span class="line">            x = x + layer_outputs[<span class="built_in">int</span>(mdef[<span class="string">&#x27;from&#x27;</span>])]</span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;yolo&#x27;</span>:</span><br><span class="line">            output.append(module(x, img_size))</span><br><span class="line">        layer_outputs.append(x <span class="keyword">if</span> i <span class="keyword">in</span> self.routs <span class="keyword">else</span> [])</span><br></pre></td></tr></table></figure>
<p>åœ¨forwardä¸­åŠ å…¥SEæ¨¡å—ï¼Œå…¶å®å¾ˆç®€å•ã€‚SEæ¨¡å—ä¸å·ç§¯å±‚ï¼Œä¸Šé‡‡æ ·ï¼Œæœ€å¤§æ± åŒ–å±‚åœ°ä½æ˜¯ä¸€æ ·çš„ï¼Œä¸éœ€è¦æ›´å¤šæ“ä½œï¼Œåªéœ€è¦å°†ä»¥ä¸Šéƒ¨åˆ†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i, (mdef, module) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(self.module_defs, self.module_list)):</span><br><span class="line">       mtype = mdef[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">       <span class="keyword">if</span> mtype <span class="keyword">in</span> [<span class="string">&#x27;convolutional&#x27;</span>, <span class="string">&#x27;upsample&#x27;</span>, <span class="string">&#x27;maxpool&#x27;</span>, <span class="string">&#x27;se&#x27;</span>]:</span><br><span class="line">           x = module(x)</span><br></pre></td></tr></table></figure>
<p>CBAMçš„æ•´ä½“è¿‡ç¨‹ç±»ä¼¼ï¼Œå¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹YOLOv3çš„æ•´ä½“æµç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3æ¨¡å‹æ„å»ºä¸­çš„YOLOLayer</title>
    <url>/2020/02/18/YOLOv3%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E4%B8%AD%E7%9A%84YOLOLayer/</url>
    <content><![CDATA[<h2 id="1-Gridåˆ›å»º"><a href="#1-Gridåˆ›å»º" class="headerlink" title="1. Gridåˆ›å»º"></a>1. Gridåˆ›å»º</h2><p>YOLOv3æ˜¯ä¸€ä¸ªå•é˜¶æ®µçš„ç›®æ ‡æ£€æµ‹å™¨ï¼Œå°†ç›®æ ‡åˆ’åˆ†ä¸ºä¸åŒçš„gridï¼Œæ¯ä¸ªgridåˆ†é…3ä¸ªanchorä½œä¸ºå…ˆéªŒæ¡†æ¥è¿›è¡ŒåŒ¹é…ã€‚é¦–å…ˆè¯»ä¸€ä¸‹ä»£ç ä¸­å…³äºgridåˆ›å»ºçš„éƒ¨åˆ†ã€‚</p>
<p>é¦–å…ˆäº†è§£ä¸€ä¸‹pytorchä¸­çš„APIï¼š<code>torch.mershgrid</code></p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Python <span class="number">3.7</span><span class="number">.3</span> (default, Apr <span class="number">24</span> <span class="number">2019</span>, <span class="number">15</span>:<span class="number">29</span>:<span class="number">51</span>) [MSC v<span class="number">.1915</span> <span class="number">64</span> bit (AMD64)] :: Anaconda, Inc. on win32</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = torch.arange(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = torch.arange(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y = torch.meshgrid(a,b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">tensor([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">tensor([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">tensor([[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line">tensor([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å•çº¯çœ‹è¾“å…¥è¾“å‡ºï¼Œå¯èƒ½ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œåˆ—ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&quot;(&quot;</span>, x[i,j], <span class="string">&quot;,&quot;</span> ,y[i,j],<span class="string">&quot;)&quot;</span>)</span><br><span class="line">...</span><br><span class="line">( tensor(<span class="number">0</span>) , tensor(<span class="number">0</span>) )</span><br><span class="line">( tensor(<span class="number">0</span>) , tensor(<span class="number">1</span>) )</span><br><span class="line">( tensor(<span class="number">0</span>) , tensor(<span class="number">2</span>) )</span><br><span class="line">( tensor(<span class="number">0</span>) , tensor(<span class="number">3</span>) )</span><br><span class="line">( tensor(<span class="number">1</span>) , tensor(<span class="number">0</span>) )</span><br><span class="line">( tensor(<span class="number">1</span>) , tensor(<span class="number">1</span>) )</span><br><span class="line">( tensor(<span class="number">1</span>) , tensor(<span class="number">2</span>) )</span><br><span class="line">( tensor(<span class="number">1</span>) , tensor(<span class="number">3</span>) )</span><br><span class="line">( tensor(<span class="number">2</span>) , tensor(<span class="number">0</span>) )</span><br><span class="line">( tensor(<span class="number">2</span>) , tensor(<span class="number">1</span>) )</span><br><span class="line">( tensor(<span class="number">2</span>) , tensor(<span class="number">2</span>) )</span><br><span class="line">( tensor(<span class="number">2</span>) , tensor(<span class="number">3</span>) )</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.stack((x,y),<span class="number">2</span>)</span><br><span class="line">tensor([[[<span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">         [<span class="number">0</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">0</span>, <span class="number">4</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">4</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">4</span>]]])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œåˆ’åˆ†äº†3Ã—4çš„ç½‘æ ¼ï¼Œé€šè¿‡éå†å¾—åˆ°çš„xå’Œyå°±èƒ½éå†å…¨éƒ¨æ ¼å­ã€‚</p>
<p>ä¸‹é¢æ˜¯yolov3ä¸­æä¾›çš„ä»£ç (éœ€è¦æ³¨æ„çš„æ˜¯è¿™æ˜¯é’ˆå¯¹æŸä¸€å±‚YOLOLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„YOLOLayerï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_grids</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">                 img_size=<span class="number">416</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 ng=(<span class="params"><span class="number">13</span>, <span class="number">13</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="function">                 device=<span class="string">&#x27;cpu&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 <span class="built_in">type</span>=torch.float32</span>):</span></span><br><span class="line">    nx, ny = ng  <span class="comment"># ç½‘æ ¼å°ºå¯¸</span></span><br><span class="line">    self.img_size = <span class="built_in">max</span>(img_size)</span><br><span class="line">    <span class="comment">#ä¸‹é‡‡æ ·å€æ•°ä¸º32</span></span><br><span class="line">    self.stride = self.img_size / <span class="built_in">max</span>(ng)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ’åˆ†ç½‘æ ¼ï¼Œæ„å»ºç›¸å¯¹å·¦ä¸Šè§’çš„åç§»é‡</span></span><br><span class="line">    yv, xv = torch.meshgrid([torch.arange(ny), torch.arange(nx)])</span><br><span class="line">    <span class="comment"># é€šè¿‡ä»¥ä¸Šä¾‹å­å¾ˆå®¹æ˜“ç†è§£</span></span><br><span class="line">    self.grid_xy = torch.stack((xv, yv), <span class="number">2</span>).to(device).<span class="built_in">type</span>(<span class="built_in">type</span>).view(</span><br><span class="line">        (<span class="number">1</span>, <span class="number">1</span>, ny, nx, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†anchorï¼Œå°†å…¶é™¤ä»¥ä¸‹é‡‡æ ·å€æ•°</span></span><br><span class="line">    self.anchor_vec = self.anchors.to(device) / self.stride</span><br><span class="line">    self.anchor_wh = self.anchor_vec.view(<span class="number">1</span>, self.na, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                          <span class="number">2</span>).to(device).<span class="built_in">type</span>(<span class="built_in">type</span>)</span><br><span class="line">    self.ng = torch.Tensor(ng).to(device)</span><br><span class="line">    self.nx = nx</span><br><span class="line">    self.ny = ny</span><br></pre></td></tr></table></figure>
<h2 id="2-YOLOLayer"><a href="#2-YOLOLayer" class="headerlink" title="2. YOLOLayer"></a>2. YOLOLayer</h2><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®²è¿‡ï¼ŒYOLOå±‚å‰ä¸€å±‚å·ç§¯å±‚çš„filterä¸ªæ•°å…·æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œè®¡ç®—æ–¹æ³•ä¸ºï¼š</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/653.webp" alt></p>
<p><strong>è®­ç»ƒè¿‡ç¨‹ï¼š</strong></p>
<p>YOLOLayerçš„ä½œç”¨å°±æ˜¯å¯¹ä¸Šä¸€ä¸ªå·ç§¯å±‚å¾—åˆ°çš„å¼ é‡è¿›è¡Œå¤„ç†ï¼Œå…·ä½“å¯ä»¥çœ‹trainingè¿‡ç¨‹æ¶‰åŠçš„ä»£ç (æš‚æ—¶ä¸å…³å¿ƒONNXéƒ¨åˆ†çš„ä»£ç )ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YOLOLayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, anchors, nc, img_size, yolo_index, arc</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(YOLOLayer, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.anchors = torch.Tensor(anchors)</span><br><span class="line">        self.na = <span class="built_in">len</span>(anchors)  <span class="comment"># è¯¥YOLOLayeråˆ†é…ç»™æ¯ä¸ªgridçš„anchorçš„ä¸ªæ•°</span></span><br><span class="line">        self.nc = nc  <span class="comment"># ç±»åˆ«ä¸ªæ•°</span></span><br><span class="line">        self.no = nc + <span class="number">5</span>  <span class="comment"># æ¯ä¸ªæ ¼å­å¯¹åº”è¾“å‡ºçš„ç»´åº¦ class + 5 ä¸­5ä»£è¡¨x,y,w,h,conf</span></span><br><span class="line">        self.nx = <span class="number">0</span>  <span class="comment"># åˆå§‹åŒ–xæ–¹å‘ä¸Šçš„æ ¼å­æ•°é‡</span></span><br><span class="line">        self.ny = <span class="number">0</span>  <span class="comment"># åˆå§‹åŒ–yæ–¹å‘ä¸Šçš„æ ¼å­æ•°é‡</span></span><br><span class="line">        self.arc = arc</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ONNX_EXPORT:  <span class="comment"># grids must be computed in __init__</span></span><br><span class="line">            stride = [<span class="number">32</span>, <span class="number">16</span>, <span class="number">8</span>][yolo_index]  <span class="comment"># stride of this layer</span></span><br><span class="line">            nx = <span class="built_in">int</span>(img_size[<span class="number">1</span>] / stride)  <span class="comment"># number x grid points</span></span><br><span class="line">            ny = <span class="built_in">int</span>(img_size[<span class="number">0</span>] / stride)  <span class="comment"># number y grid points</span></span><br><span class="line">            create_grids(self, img_size, (nx, ny))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, p, img_size, var=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        onnxä»£è¡¨å¼€æ”¾å¼ç¥ç»ç½‘ç»œäº¤æ¢</span></span><br><span class="line"><span class="string">        pytorchä¸­çš„æ¨¡å‹éƒ½å¯ä»¥å¯¼å‡ºæˆ–è½¬æ¢ä¸ºæ ‡å‡†ONNXæ ¼å¼</span></span><br><span class="line"><span class="string">        åœ¨æ¨¡å‹é‡‡ç”¨ONNXæ ¼å¼åï¼Œå³å¯åœ¨å„ç§å¹³å°å’Œè®¾å¤‡ä¸Šè¿è¡Œ</span></span><br><span class="line"><span class="string">        åœ¨è¿™é‡ŒONNXä»£è¡¨è§„èŒƒåŒ–çš„æ¨ç†è¿‡ç¨‹</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> ONNX_EXPORT:</span><br><span class="line">            bs = <span class="number">1</span>  <span class="comment"># batch size</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bs, _, ny, nx = p.shape  <span class="comment"># bs, 255, 13, 13</span></span><br><span class="line">            <span class="keyword">if</span> (self.nx, self.ny) != (nx, ny):</span><br><span class="line">                create_grids(self, img_size, (nx, ny), p.device, p.dtype)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># p.view(bs, 255, 13, 13) -- &gt; (bs, 3, 13, 13, 85)</span></span><br><span class="line">        <span class="comment"># (bs, anchors, grid, grid, classes + xywh)</span></span><br><span class="line">        p = p.view(bs, self.na, self.no, self.ny,</span><br><span class="line">                   self.nx).permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>).contiguous()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.training:</span><br><span class="line">            <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure>
<p>åœ¨ç†è§£ä»¥ä¸Šä»£ç çš„æ—¶å€™ï¼Œéœ€è¦ç†è§£æ¯ä¸€ä¸ªé€šé“æ‰€ä»£è¡¨çš„æ„ä¹‰ï¼ŒåŸå…ˆçš„Pæ˜¯ç”±ä¸Šä¸€å±‚å·ç§¯å¾—åˆ°çš„feature map, å½¢çŠ¶ä¸º(ä»¥80ä¸ªç±»åˆ«ã€è¾“å…¥416ã€ä¸‹é‡‡æ ·32å€ä¸ºä¾‹)ï¼šã€batch size, anchorÃ—(80+5), 13,  13ã€‘ï¼Œåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå°†feature mapé€šè¿‡å¼ é‡æ“ä½œè½¬åŒ–çš„å½¢çŠ¶ä¸ºï¼šã€batch size, anchor, 13, 13, 85ã€‘ã€‚</p>
<p><strong>æµ‹è¯•è¿‡ç¨‹ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pçš„å½¢çŠ¶ç›®å‰ä¸ºï¼šã€bs, anchor_num, gridx,gridy,xywhc+classã€‘</span></span><br><span class="line"><span class="keyword">else</span>:  <span class="comment"># æµ‹è¯•æ¨ç†è¿‡ç¨‹</span></span><br><span class="line">   <span class="comment"># s = 1.5  # scale_xy  (pxy = pxy * s - (s - 1) / 2)</span></span><br><span class="line">   io = p.clone()  <span class="comment"># æµ‹è¯•è¿‡ç¨‹è¾“å‡ºå°±æ˜¯io</span></span><br><span class="line">   io[..., :<span class="number">2</span>] = torch.sigmoid(io[..., :<span class="number">2</span>]) + self.grid_xy  <span class="comment"># xy</span></span><br><span class="line">   <span class="comment"># grid_xyæ˜¯å·¦ä¸Šè§’å†åŠ ä¸Šåç§»é‡io[...:2]ä»£è¡¨xyåç§»</span></span><br><span class="line">   io[..., <span class="number">2</span>:<span class="number">4</span>] = torch.exp(</span><br><span class="line">       io[..., <span class="number">2</span>:<span class="number">4</span>]) * self.anchor_wh  <span class="comment"># wh yolo method</span></span><br><span class="line">   <span class="comment"># io[..., 2:4] = ((torch.sigmoid(io[..., 2:4]) * 2) ** 3) * self.anchor_wh</span></span><br><span class="line">   <span class="comment"># wh power method</span></span><br><span class="line">   io[..., :<span class="number">4</span>] *= self.stride</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> <span class="string">&#x27;default&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># seperate obj and cls</span></span><br><span class="line">       torch.sigmoid_(io[..., <span class="number">4</span>])</span><br><span class="line">   <span class="keyword">elif</span> <span class="string">&#x27;BCE&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># unified BCE (80 classes)</span></span><br><span class="line">       torch.sigmoid_(io[..., <span class="number">5</span>:])</span><br><span class="line">       io[..., <span class="number">4</span>] = <span class="number">1</span></span><br><span class="line">   <span class="keyword">elif</span> <span class="string">&#x27;CE&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># unified CE (1 background + 80 classes)</span></span><br><span class="line">       io[..., <span class="number">4</span>:] = F.softmax(io[..., <span class="number">4</span>:], dim=<span class="number">4</span>)</span><br><span class="line">       io[..., <span class="number">4</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> self.nc == <span class="number">1</span>:</span><br><span class="line">       io[..., <span class="number">5</span>] = <span class="number">1</span></span><br><span class="line">       <span class="comment"># single-class model https://github.com/ultralytics/yolov3/issues/235</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># reshape from [1, 3, 13, 13, 85] to [1, 507, 85]</span></span><br><span class="line">   <span class="keyword">return</span> io.view(bs, -<span class="number">1</span>, self.no), p</span><br></pre></td></tr></table></figure>
<p>ç†è§£ä»¥ä¸Šå†…å®¹æ˜¯éœ€è¦å¯¹åº”ä»¥ä¸‹å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned} b_{x}=& \sigma\left(t_{x}\right)+c_{x} \\ b_{y}=& \sigma\left(t_{y}\right)+c_{y} \\ b_{w}=& p_{w} e^{t_{x}} \\ b_{h}=& p_{h} e^{t_{h}} \end{aligned}</script><p><strong>xyéƒ¨åˆ†:</strong></p>
<script type="math/tex; mode=display">
b_{x}=\sigma\left(t_{x}\right)+c_{x}\\
b_{y}=\sigma\left(t_{y}\right)+c_{y}</script><p>$c_{x}, c_{y}$ä»£è¡¨çš„æ˜¯æ ¼å­çš„å·¦ä¸Šè§’åæ ‡ï¼›$t_{x}, t_{y}$ä»£è¡¨çš„æ˜¯ç½‘ç»œé¢„æµ‹çš„ç»“æœï¼› $\sigma$ä»£è¡¨sigmoidæ¿€æ´»å‡½æ•°ã€‚å¯¹åº”ä»£ç ç†è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">io[..., :<span class="number">2</span>] = torch.sigmoid(io[..., :<span class="number">2</span>]) + self.grid_xy  <span class="comment"># xy</span></span><br><span class="line"><span class="comment"># grid_xyæ˜¯å·¦ä¸Šè§’å†åŠ ä¸Šåç§»é‡io[...:2]ä»£è¡¨xyåç§»</span></span><br></pre></td></tr></table></figure>
<p><strong>whéƒ¨åˆ†:</strong></p>
<script type="math/tex; mode=display">
b_{w}=p_{w} e^{t_{x}}\\
b_{h}=p_{h} e^{t_{h}}</script><p>$p_{w}, p_{h}$ä»£è¡¨çš„æ˜¯anchorå…ˆéªŒæ¡†åœ¨feature mapä¸Šå¯¹åº”çš„å¤§å°ã€‚$t_{w}, t_{h}$ä»£è¡¨çš„æ˜¯ç½‘ç»œå­¦ä¹ å¾—åˆ°çš„ç¼©æ”¾ç³»æ•°ã€‚å¯¹åº”ä»£ç ç†è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># wh yolo method</span></span><br><span class="line">io[..., <span class="number">2</span>:<span class="number">4</span>] = torch.exp(io[..., <span class="number">2</span>:<span class="number">4</span>]) * self.anchor_wh</span><br></pre></td></tr></table></figure>
<p><strong>classéƒ¨åˆ†ï¼š</strong></p>
<p>åœ¨ç±»åˆ«éƒ¨åˆ†ï¼Œæä¾›äº†å‡ ç§æ–¹æ³•ï¼Œæ ¹æ®arcå‚æ•°æ¥è¿›è¡Œä¸åŒæ¨¡å¼çš„é€‰æ‹©ã€‚ä»¥CEï¼ˆcrossEntropyï¼‰ä¸ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ioï¼š(bs, anchors, grid, grid, xywh+classes)</span></span><br><span class="line">io[..., <span class="number">4</span>:] = F.softmax(io[..., <span class="number">4</span>:], dim=<span class="number">4</span>)<span class="comment"># ä½¿ç”¨softmax</span></span><br><span class="line">io[..., <span class="number">4</span>] = <span class="number">1</span> </span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3ç½‘ç»œæ¨¡å‹çš„æ„å»º</title>
    <url>/2020/02/18/YOLOv3%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="1-cfgæ–‡ä»¶"><a href="#1-cfgæ–‡ä»¶" class="headerlink" title="1. cfgæ–‡ä»¶"></a>1. cfgæ–‡ä»¶</h2><p>åœ¨YOLOv3ä¸­ï¼Œä¿®æ”¹ç½‘ç»œç»“æ„å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ä¿®æ”¹cfgæ–‡ä»¶å³å¯ã€‚ç›®å‰ï¼Œcfgæ–‡ä»¶æ”¯æŒconvolutional, maxpool, unsample, route, shortcut, yoloè¿™å‡ ä¸ªå±‚ã€‚</p>
<p>è€Œä¸”ä½œè€…ä¹Ÿæä¾›äº†å¤šä¸ªcfgæ–‡ä»¶æ¥è¿›è¡Œç½‘ç»œæ„å»ºï¼Œæ¯”å¦‚ï¼šyolov3.cfgã€yolov3-tiny.cfgã€yolov3-spp.cfgã€csresnext50-panet-spp.cfgæ–‡ä»¶ï¼ˆæä¾›çš„yolov3-spp-pan-scale.cfgæ–‡ä»¶ï¼Œåœ¨ä»£ç çº§åˆ«è¿˜æ²¡æœ‰æä¾›æ”¯æŒï¼‰ã€‚</p>
<p>å¦‚æœæƒ³è¦æ·»åŠ è‡ªå®šä¹‰çš„æ¨¡å—ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæ¯”å¦‚è¯´æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ã€ç©ºæ´å·ç§¯ç­‰ï¼Œéƒ½å¯ä»¥ç®€å•åœ°å¾—åˆ°æ·»åŠ æˆ–è€…ä¿®æ”¹ã€‚</p>
<p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ç†è§£cfgæ–‡ä»¶ç½‘ç»œæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œåœ¨è¿™é‡Œæ¨èä¸€ä¸ªGithubä¸Šçš„ç½‘ç»œç»“æ„å¯è§†åŒ–è½¯ä»¶ï¼š<code>Netron</code>ï¼Œä¸‹å›¾æ˜¯å¯è§†åŒ–yolov3-tinyçš„ç»“æœï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/648.jpg" alt></p>
<h2 id="2-ç½‘ç»œæ¨¡å‹æ„å»º"><a href="#2-ç½‘ç»œæ¨¡å‹æ„å»º" class="headerlink" title="2. ç½‘ç»œæ¨¡å‹æ„å»º"></a>2. ç½‘ç»œæ¨¡å‹æ„å»º</h2><p>ä»<code>train.py</code>æ–‡ä»¶å…¥æ‰‹ï¼Œå…¶ä¸­æ¶‰åŠçš„ç½‘ç»œæ„å»ºçš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Initialize model</span></span><br><span class="line">model = Darknet(cfg, arc=opt.arc).to(device)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ²¿ç€Darknetå®ç°è¿›è¡Œè®²è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Darknet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># YOLOv3 object detection model</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cfg, img_size=(<span class="params"><span class="number">416</span>, <span class="number">416</span></span>), arc=<span class="string">&#x27;default&#x27;</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Darknet, self).__init__()</span><br><span class="line">        self.module_defs = parse_model_cfg(cfg)</span><br><span class="line">        self.module_list, self.routs = create_modules(self.module_defs, img_size, arc)</span><br><span class="line">        self.yolo_layers = get_yolo_layers(self)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Darknet Header</span></span><br><span class="line">        self.version = np.array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>], dtype=np.int32)</span><br><span class="line">        <span class="comment"># (int32) version info: major, minor, revision</span></span><br><span class="line">        self.seen = np.array([<span class="number">0</span>], dtype=np.int64)</span><br><span class="line">        <span class="comment"># (int64) number of images seen during training</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ–‡ä»¶ä¸­ï¼Œæ¯”è¾ƒå…³é”®çš„å°±æ˜¯æˆå‘˜å‡½å˜é‡<code>module_defs</code>ã€<code>module_list</code>ã€<code>routs</code>ã€<code>yolo_layers</code>å››ä¸ªæˆå‘˜å‡½æ•°ï¼Œå…ˆå¯¹è¿™å‡ ä¸ªå‚æ•°çš„æ„ä¹‰è¿›è¡Œè§£é‡Šï¼š</p>
<h3 id="2-1-module-defs"><a href="#2-1-module-defs" class="headerlink" title="2.1 module_defs"></a>2.1 module_defs</h3><p>è°ƒç”¨äº†<code>parse_model_cfg</code>å‡½æ•°ï¼Œå¾—åˆ°äº†<code>module_defs</code>å¯¹è±¡ã€‚å®é™…ä¸Šè¯¥å‡½æ•°æ˜¯é€šè¿‡è§£æcfgæ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªlistï¼Œlistä¸­åŒ…å«å¤šä¸ªå­—å…¸ï¼Œæ¯ä¸ªå­—å…¸ä¿å­˜çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªæ¨¡å—å†…å®¹ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=3</span><br><span class="line">stride=2</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_model_cfg</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="comment"># pathå‚æ•°ä¸º: cfg/yolov3-tiny.cfg</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> path.endswith(<span class="string">&#x27;.cfg&#x27;</span>):</span><br><span class="line">        path += <span class="string">&#x27;.cfg&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path) <span class="keyword">and</span> os.path.exists(<span class="string">&#x27;cfg&#x27;</span> + os.sep + path):</span><br><span class="line">        path = <span class="string">&#x27;cfg&#x27;</span> + os.sep + path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å»é™¤ä»¥#å¼€å¤´çš„ï¼Œå±äºæ³¨é‡Šéƒ¨åˆ†çš„å†…å®¹</span></span><br><span class="line">    lines = [x <span class="keyword">for</span> x <span class="keyword">in</span> lines <span class="keyword">if</span> x <span class="keyword">and</span> <span class="keyword">not</span> x.startswith(<span class="string">&#x27;#&#x27;</span>)]</span><br><span class="line">    lines = [x.rstrip().lstrip() <span class="keyword">for</span> x <span class="keyword">in</span> lines]</span><br><span class="line">    mdefs = []  <span class="comment"># æ¨¡å—çš„å®šä¹‰</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">&#x27;[&#x27;</span>):  <span class="comment"># æ ‡å¿—ç€ä¸€ä¸ªæ¨¡å—çš„å¼€å§‹</span></span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            æ¯”å¦‚:</span></span><br><span class="line"><span class="string">            [shortcut]</span></span><br><span class="line"><span class="string">            from=-3</span></span><br><span class="line"><span class="string">            activation=linear</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            mdefs.append(&#123;&#125;)</span><br><span class="line">            mdefs[-<span class="number">1</span>][<span class="string">&#x27;type&#x27;</span>] = line[<span class="number">1</span>:-<span class="number">1</span>].rstrip()</span><br><span class="line">            <span class="keyword">if</span> mdefs[-<span class="number">1</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;convolutional&#x27;</span>:</span><br><span class="line">                mdefs[-<span class="number">1</span>][<span class="string">&#x27;batch_normalize&#x27;</span>] = <span class="number">0</span>  </span><br><span class="line">                <span class="comment"># pre-populate with zeros (may be overwritten later)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å°†é”®å’Œé”®å€¼æ”¾å…¥å­—å…¸</span></span><br><span class="line">            key, val = line.split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">            key = key.rstrip()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;anchors&#x27;</span> <span class="keyword">in</span> key:</span><br><span class="line">                mdefs[-<span class="number">1</span>][key] = np.array([<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> val.split(<span class="string">&#x27;,&#x27;</span>)]).reshape((-<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># np anchors</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                mdefs[-<span class="number">1</span>][key] = val.strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ”¯æŒçš„å‚æ•°ç±»å‹</span></span><br><span class="line">    supported = [<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;batch_normalize&#x27;</span>, <span class="string">&#x27;filters&#x27;</span>, <span class="string">&#x27;size&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;stride&#x27;</span>, <span class="string">&#x27;pad&#x27;</span>, <span class="string">&#x27;activation&#x27;</span>, <span class="string">&#x27;layers&#x27;</span>, <span class="string">&#x27;groups&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;mask&#x27;</span>, <span class="string">&#x27;anchors&#x27;</span>, <span class="string">&#x27;classes&#x27;</span>, <span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;jitter&#x27;</span>, \</span><br><span class="line">                 <span class="string">&#x27;ignore_thresh&#x27;</span>, <span class="string">&#x27;truth_thresh&#x27;</span>, <span class="string">&#x27;random&#x27;</span>,\</span><br><span class="line">                 <span class="string">&#x27;stride_x&#x27;</span>, <span class="string">&#x27;stride_y&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ‰€æœ‰å‚æ•°ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆè¦æ±‚çš„key</span></span><br><span class="line">    f = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> mdefs[<span class="number">1</span>:]:</span><br><span class="line">        [f.append(k) <span class="keyword">for</span> k <span class="keyword">in</span> x <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> f]</span><br><span class="line">    u = [x <span class="keyword">for</span> x <span class="keyword">in</span> f <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> supported]  <span class="comment"># unsupported fields</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> <span class="built_in">any</span>(u), <span class="string">&quot;Unsupported fields %s in %s. See https://github.com/ultralytics/yolov3/issues/631&quot;</span> % (u, path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mdefs</span><br></pre></td></tr></table></figure>
<p>è¿”å›çš„å†…å®¹é€šè¿‡debugæ¨¡å¼è¿›è¡ŒæŸ¥çœ‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/649.webp" alt></p>
<p>å…¶ä¸­éœ€è¦å…³æ³¨çš„å°±æ˜¯anchorçš„ç»„ç»‡ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/650.webp" alt></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œanchoræ˜¯æŒ‰ç…§æ¯ä¸¤ä¸ªä¸€å¯¹è¿›è¡Œç»„ç»‡çš„ï¼Œä¸æˆ‘ä»¬çš„ç†è§£ä¸€è‡´ã€‚</p>
<h3 id="2-2-module-list-amp-routs"><a href="#2-2-module-list-amp-routs" class="headerlink" title="2.2 module_list&amp;routs"></a>2.2 module_list&amp;routs</h3><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ç†è§£æ¨¡å‹æ„å»ºçš„å…³é”®ã€‚</p>
<p>åœ¨pytorchä¸­ï¼Œæ„å»ºæ¨¡å‹å¸¸è§çš„æœ‰é€šè¿‡Sequentialæˆ–è€…ModuleListè¿›è¡Œæ„å»ºã€‚</p>
<p><strong>é€šè¿‡Sequentialæ„å»º</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model=nn.Sequential()</span><br><span class="line">model.add_module(<span class="string">&#x27;conv&#x27;</span>,nn.Conv2d(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>))</span><br><span class="line">model.add_module(<span class="string">&#x27;batchnorm&#x27;</span>,nn.BatchNorm2d(<span class="number">3</span>))</span><br><span class="line">model.add_module(<span class="string">&#x27;activation_layer&#x27;</span>,nn.ReLU())</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model=nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>),</span><br><span class="line">    nn.BatchNorm2d(<span class="number">3</span>),</span><br><span class="line">    nn.ReLU()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line">model=nn.Sequential(OrderedDict([</span><br><span class="line">    (<span class="string">&#x27;conv&#x27;</span>,nn.Conv2d(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>)),</span><br><span class="line">    (<span class="string">&#x27;batchnorm&#x27;</span>,nn.BatchNorm2d(<span class="number">3</span>)),</span><br><span class="line">    (<span class="string">&#x27;activation_layer&#x27;</span>,nn.ReLU())</span><br><span class="line">]))</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡sequentialæ„å»ºçš„æ¨¡å—å†…éƒ¨<strong>å®ç°äº†forwardå‡½æ•°</strong>ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥å‚æ•°ï¼Œè¿›è¡Œè°ƒç”¨ã€‚</p>
<p><strong>é€šè¿‡ModuleListæ„å»º</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model=nn.ModuleList([nn.Linear(<span class="number">3</span>,<span class="number">4</span>),</span><br><span class="line">						 nn.ReLU(),</span><br><span class="line">						 nn.Linear(<span class="number">4</span>,<span class="number">2</span>)])</span><br></pre></td></tr></table></figure>
<p>ModuleListç±»ä¼¼listï¼Œå†…éƒ¨<strong>æ²¡æœ‰å®ç°forwardå‡½æ•°</strong>ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ„å»ºforwardå‡½æ•°,æ„å»ºè‡ªå·±æ¨¡å‹å¸¸ç”¨ModuleListå‡½æ•°å»ºç«‹å­æ¨¡å‹,å»ºç«‹forwardå‡½æ•°å®ç°å‰å‘ä¼ æ’­ã€‚</p>
<p>åœ¨YOLOv3ä¸­ï¼Œçµæ´»åœ°ç»“åˆäº†ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œé€šè¿‡è§£æä»¥ä¸Šå¾—åˆ°çš„module_defsï¼Œè¿›è¡Œæ„å»ºä¸€ä¸ªModuleListï¼Œç„¶åå†é€šè¿‡æ„å»ºforwardå‡½æ•°è¿›è¡Œå‰å‘ä¼ æ’­å³å¯ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_modules</span>(<span class="params">module_defs, img_size, arc</span>):</span></span><br><span class="line">    <span class="comment"># é€šè¿‡module_defsè¿›è¡Œæ„å»ºæ¨¡å‹</span></span><br><span class="line">    hyperparams = module_defs.pop(<span class="number">0</span>)</span><br><span class="line">    output_filters = [<span class="built_in">int</span>(hyperparams[<span class="string">&#x27;channels&#x27;</span>])]</span><br><span class="line">    module_list = nn.ModuleList()</span><br><span class="line">    routs = []  <span class="comment"># å­˜å‚¨äº†æ‰€æœ‰çš„å±‚ï¼Œåœ¨routeã€shortcutä¼šä½¿ç”¨åˆ°ã€‚</span></span><br><span class="line">    yolo_index = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, mdef <span class="keyword">in</span> <span class="built_in">enumerate</span>(module_defs):</span><br><span class="line">        modules = nn.Sequential()</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        é€šè¿‡typeå­—æ ·ä¸åŒçš„ç±»å‹ï¼Œæ¥è¿›è¡Œæ¨¡å‹æ„å»º</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;convolutional&#x27;</span>:</span><br><span class="line">            bn = <span class="built_in">int</span>(mdef[<span class="string">&#x27;batch_normalize&#x27;</span>])</span><br><span class="line">            filters = <span class="built_in">int</span>(mdef[<span class="string">&#x27;filters&#x27;</span>])</span><br><span class="line">            size = <span class="built_in">int</span>(mdef[<span class="string">&#x27;size&#x27;</span>])</span><br><span class="line">            stride = <span class="built_in">int</span>(mdef[<span class="string">&#x27;stride&#x27;</span>]) <span class="keyword">if</span> <span class="string">&#x27;stride&#x27;</span> <span class="keyword">in</span> mdef <span class="keyword">else</span> (<span class="built_in">int</span>(</span><br><span class="line">                mdef[<span class="string">&#x27;stride_y&#x27;</span>]), <span class="built_in">int</span>(mdef[<span class="string">&#x27;stride_x&#x27;</span>]))</span><br><span class="line">            pad = (size - <span class="number">1</span>) // <span class="number">2</span> <span class="keyword">if</span> <span class="built_in">int</span>(mdef[<span class="string">&#x27;pad&#x27;</span>]) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            modules.add_module(</span><br><span class="line">                <span class="string">&#x27;Conv2d&#x27;</span>,</span><br><span class="line">                nn.Conv2d(</span><br><span class="line">                    in_channels=output_filters[-<span class="number">1</span>],</span><br><span class="line">                    out_channels=filters,</span><br><span class="line">                    kernel_size=size,</span><br><span class="line">                    stride=stride,</span><br><span class="line">                    padding=pad,</span><br><span class="line">                    groups=<span class="built_in">int</span>(mdef[<span class="string">&#x27;groups&#x27;</span>]) <span class="keyword">if</span> <span class="string">&#x27;groups&#x27;</span> <span class="keyword">in</span> mdef <span class="keyword">else</span> <span class="number">1</span>,</span><br><span class="line">                    bias=<span class="keyword">not</span> bn))</span><br><span class="line">            <span class="keyword">if</span> bn:</span><br><span class="line">                modules.add_module(<span class="string">&#x27;BatchNorm2d&#x27;</span>,</span><br><span class="line">                                   nn.BatchNorm2d(filters, momentum=<span class="number">0.1</span>))</span><br><span class="line">            <span class="keyword">if</span> mdef[<span class="string">&#x27;activation&#x27;</span>] == <span class="string">&#x27;leaky&#x27;</span>:  <span class="comment"># <span class="doctag">TODO:</span> activation study https://github.com/ultralytics/yolov3/issues/441</span></span><br><span class="line">                modules.add_module(<span class="string">&#x27;activation&#x27;</span>, nn.LeakyReLU(<span class="number">0.1</span>,</span><br><span class="line">                                                              inplace=<span class="literal">True</span>))</span><br><span class="line">            <span class="keyword">elif</span> mdef[<span class="string">&#x27;activation&#x27;</span>] == <span class="string">&#x27;swish&#x27;</span>:</span><br><span class="line">                modules.add_module(<span class="string">&#x27;activation&#x27;</span>, Swish())</span><br><span class="line">            <span class="comment"># åœ¨æ­¤å¤„å¯ä»¥æ·»åŠ æ–°çš„æ¿€æ´»å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;maxpool&#x27;</span>:</span><br><span class="line">            <span class="comment"># æœ€å¤§æ± åŒ–æ“ä½œ</span></span><br><span class="line">            size = <span class="built_in">int</span>(mdef[<span class="string">&#x27;size&#x27;</span>])</span><br><span class="line">            stride = <span class="built_in">int</span>(mdef[<span class="string">&#x27;stride&#x27;</span>])</span><br><span class="line">            maxpool = nn.MaxPool2d(kernel_size=size,</span><br><span class="line">                                   stride=stride,</span><br><span class="line">                                   padding=<span class="built_in">int</span>((size - <span class="number">1</span>) // <span class="number">2</span>))</span><br><span class="line">            <span class="keyword">if</span> size == <span class="number">2</span> <span class="keyword">and</span> stride == <span class="number">1</span>:  <span class="comment"># yolov3-tiny</span></span><br><span class="line">                modules.add_module(<span class="string">&#x27;ZeroPad2d&#x27;</span>, nn.ZeroPad2d((<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)))</span><br><span class="line">                modules.add_module(<span class="string">&#x27;MaxPool2d&#x27;</span>, maxpool)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                modules = maxpool</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;upsample&#x27;</span>:</span><br><span class="line">            <span class="comment"># é€šè¿‡è¿‘é‚»æ’å€¼å®Œæˆä¸Šé‡‡æ ·</span></span><br><span class="line">            modules = nn.Upsample(scale_factor=<span class="built_in">int</span>(mdef[<span class="string">&#x27;stride&#x27;</span>]),</span><br><span class="line">                                  mode=<span class="string">&#x27;nearest&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;route&#x27;</span>:</span><br><span class="line">            <span class="comment"># nn.Sequential() placeholder for &#x27;route&#x27; layer</span></span><br><span class="line">            layers = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> mdef[<span class="string">&#x27;layers&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">            filters = <span class="built_in">sum</span>(</span><br><span class="line">                [output_filters[i + <span class="number">1</span> <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">else</span> i] <span class="keyword">for</span> i <span class="keyword">in</span> layers])</span><br><span class="line">            <span class="comment"># extendè¡¨ç¤ºæ·»åŠ ä¸€ç³»åˆ—å¯¹è±¡</span></span><br><span class="line">            routs.extend([l <span class="keyword">if</span> l &gt; <span class="number">0</span> <span class="keyword">else</span> l + i <span class="keyword">for</span> l <span class="keyword">in</span> layers])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;shortcut&#x27;</span>:</span><br><span class="line">            <span class="comment"># nn.Sequential() placeholder for &#x27;shortcut&#x27; layer</span></span><br><span class="line">            filters = output_filters[<span class="built_in">int</span>(mdef[<span class="string">&#x27;from&#x27;</span>])]</span><br><span class="line">            layer = <span class="built_in">int</span>(mdef[<span class="string">&#x27;from&#x27;</span>])</span><br><span class="line">            routs.extend([i + layer <span class="keyword">if</span> layer &lt; <span class="number">0</span> <span class="keyword">else</span> layer])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mdef[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;yolo&#x27;</span>:</span><br><span class="line">            yolo_index += <span class="number">1</span></span><br><span class="line">            mask = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> mdef[<span class="string">&#x27;mask&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)]  <span class="comment"># anchor mask</span></span><br><span class="line">            modules = YOLOLayer(</span><br><span class="line">                anchors=mdef[<span class="string">&#x27;anchors&#x27;</span>][mask],  <span class="comment"># anchor list</span></span><br><span class="line">                nc=<span class="built_in">int</span>(mdef[<span class="string">&#x27;classes&#x27;</span>]),  <span class="comment"># number of classes</span></span><br><span class="line">                img_size=img_size,  <span class="comment"># (416, 416)</span></span><br><span class="line">                yolo_index=yolo_index,  <span class="comment"># 0, 1 or 2</span></span><br><span class="line">                arc=arc)  <span class="comment"># yolo architecture</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¿™æ˜¯åœ¨focal lossæ–‡ç« ä¸­æåˆ°çš„ä¸ºå·ç§¯å±‚æ·»åŠ bias</span></span><br><span class="line">            <span class="comment"># ä¸»è¦ç”¨äºè§£å†³æ ·æœ¬ä¸å¹³è¡¡é—®é¢˜</span></span><br><span class="line">            <span class="comment"># (è®ºæ–‡åœ°å€ https://arxiv.org/pdf/1708.02002.pdf section 3.3)</span></span><br><span class="line">            <span class="comment"># å…·ä½“è®²è§£è§ä¸‹æ–¹</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> arc == <span class="string">&#x27;defaultpw&#x27;</span> <span class="keyword">or</span> arc == <span class="string">&#x27;Fdefaultpw&#x27;</span>:</span><br><span class="line">                    <span class="comment"># default with positive weights</span></span><br><span class="line">                    b = [-<span class="number">5.0</span>, -<span class="number">5.0</span>]  <span class="comment"># obj, cls</span></span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;default&#x27;</span>:</span><br><span class="line">                    <span class="comment"># default no pw (40 cls, 80 obj)</span></span><br><span class="line">                    b = [-<span class="number">5.0</span>, -<span class="number">5.0</span>]</span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;uBCE&#x27;</span>:</span><br><span class="line">                    <span class="comment"># unified BCE (80 classes)</span></span><br><span class="line">                    b = [<span class="number">0</span>, -<span class="number">9.0</span>]</span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;uCE&#x27;</span>:</span><br><span class="line">                    <span class="comment"># unified CE (1 background + 80 classes)</span></span><br><span class="line">                    b = [<span class="number">10</span>, -<span class="number">0.1</span>]</span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;Fdefault&#x27;</span>:</span><br><span class="line">                    <span class="comment"># Focal default no pw (28 cls, 21 obj, no pw)</span></span><br><span class="line">                    b = [-<span class="number">2.1</span>, -<span class="number">1.8</span>]</span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;uFBCE&#x27;</span> <span class="keyword">or</span> arc == <span class="string">&#x27;uFBCEpw&#x27;</span>:</span><br><span class="line">                    <span class="comment"># unified FocalBCE (5120 obj, 80 classes)</span></span><br><span class="line">                    b = [<span class="number">0</span>, -<span class="number">6.5</span>]</span><br><span class="line">                <span class="keyword">elif</span> arc == <span class="string">&#x27;uFCE&#x27;</span>:</span><br><span class="line">                    <span class="comment"># unified FocalCE (64 cls, 1 background + 80 classes)</span></span><br><span class="line">                    b = [<span class="number">7.7</span>, -<span class="number">1.1</span>]</span><br><span class="line"></span><br><span class="line">                bias = module_list[-<span class="number">1</span>][<span class="number">0</span>].bias.view(<span class="built_in">len</span>(mask), -<span class="number">1</span>)</span><br><span class="line">                <span class="comment"># 255 to 3x85</span></span><br><span class="line">                bias[:, <span class="number">4</span>] += b[<span class="number">0</span>] - bias[:, <span class="number">4</span>].mean()  <span class="comment"># obj</span></span><br><span class="line">                bias[:, <span class="number">5</span>:] += b[<span class="number">1</span>] - bias[:, <span class="number">5</span>:].mean()  <span class="comment"># cls</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å°†æ–°çš„åç§»é‡èµ‹å€¼å›æ¨¡å‹ä¸­</span></span><br><span class="line">                module_list[-<span class="number">1</span>][<span class="number">0</span>].bias = torch.nn.Parameter(bias.view(-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;WARNING: smart bias initialization failure.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Warning: Unrecognized Layer Type: &#x27;</span> + mdef[<span class="string">&#x27;type&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†moduleå†…å®¹ä¿å­˜åœ¨module_listä¸­ã€‚</span></span><br><span class="line">        module_list.append(modules)</span><br><span class="line">        <span class="comment"># ä¿å­˜æ‰€æœ‰çš„filterä¸ªæ•°</span></span><br><span class="line">        output_filters.append(filters)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> module_list, routs</span><br></pre></td></tr></table></figure>
<p><strong>biaséƒ¨åˆ†è®²è§£</strong></p>
<p>å…¶ä¸­åœ¨YOLO Layeréƒ¨åˆ†æ¶‰åŠåˆ°ä¸€ä¸ªåˆå§‹åŒ–çš„trickï¼Œæ¥è‡ªFocal Lossä¸­å…³äºæ¨¡å‹åˆå§‹åŒ–çš„è®¨è®ºï¼Œå…·ä½“å†…å®¹è¯·é˜…è¯»è®ºæ–‡ï¼Œ<code>https://arxiv.org/pdf/1708.02002.pdf</code> çš„ç¬¬3.3èŠ‚ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/651.webp" alt></p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªéå¸¸insightçš„ç‚¹ï¼Œåœ¨ç¬¬ä¸€ç¯‡ä¸­ä»‹ç»äº†ï¼ŒYOLOå±‚å‰ä¸€ä¸ªå·ç§¯çš„filterä¸ªæ•°è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
filter=(c l a s s+5) \times 3</script><p>5ä»£è¡¨x,y,w,h, scoreï¼Œscoreä»£è¡¨è¯¥æ ¼å­ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡ï¼Œ3ä»£è¡¨è¿™ä¸ªæ ¼å­ä¸­ä¼šåˆ†é…3ä¸ªanchorè¿›è¡ŒåŒ¹é…ã€‚åœ¨YOLOLayerä¸­çš„forwardå‡½æ•°ä¸­ï¼Œæœ‰ä»¥ä¸‹ä»£ç ï¼Œéœ€è¦é€šè¿‡sigmoidæ¿€æ´»å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;default&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># seperate obj and cls</span></span><br><span class="line">	torch.sigmoid_(io[..., <span class="number">4</span>])</span><br><span class="line"><span class="keyword">elif</span> <span class="string">&#x27;BCE&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># unified BCE (80 classes)</span></span><br><span class="line">	torch.sigmoid_(io[..., <span class="number">5</span>:])</span><br><span class="line">	io[..., <span class="number">4</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">elif</span> <span class="string">&#x27;CE&#x27;</span> <span class="keyword">in</span> self.arc:  <span class="comment"># unified CE (1 background + 80 classes)</span></span><br><span class="line">	io[..., <span class="number">4</span>:] = F.softmax(io[..., <span class="number">4</span>:], dim=<span class="number">4</span>)</span><br><span class="line">	io[..., <span class="number">4</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/652.png" alt></p>
<p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼ŒSigmoidæ¢¯åº¦æ˜¯æœ‰é™çš„ï¼Œåœ¨<code>[-5,5]</code>ä¹‹é—´ã€‚</p>
<p>è€Œpytorchä¸­çš„å·ç§¯å±‚é»˜è®¤çš„åˆå§‹åŒ–æ˜¯ä»¥0ä¸ºä¸­å¿ƒç‚¹çš„æ­£æ€åˆ†å¸ƒï¼Œè¿™æ ·è¿›è¡Œçš„åˆå§‹åŒ–ä¼šå¯¼è‡´å¾ˆå¤šgirdä¸­å¤§çº¦ä¸€åŠå¾—åˆ°äº†æ¿€æ´»ï¼Œåœ¨è®¡ç®—lossçš„æ—¶å€™å°±ä¼šè®¡ç®—ä¸Šæ‰€æœ‰çš„æ¿€æ´»çš„ç‚¹å¯¹åº”çš„åæ ‡ä¿¡æ¯ï¼Œè¿™æ ·è®¡ç®—losså°±ä¼šå˜å¾—å¾ˆå¤§ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªç°è±¡ï¼Œä½œè€…é€‰æ‹©åœ¨YOLOLayerçš„å‰ä¸€ä¸ªå·ç§¯å±‚æ·»åŠ biasï¼Œæ¥é¿å…è¿™ç§æƒ…å†µï¼Œå®é™…æ“ä½œå°±æ˜¯åœ¨åŸæœ‰çš„biasä¸Šå‡å»5ï¼Œè¿™æ ·é€šè¿‡å·ç§¯å¾—åˆ°çš„æ•°å€¼å°±ä¸ä¼šè¢«æ¿€æ´»ï¼Œå¯ä»¥é˜²æ­¢åœ¨åˆå§‹é˜¶æ®µçš„ç¬¬ä¸€ä¸ªbatchä¸­å°±è¿›è¡Œè¿‡æ‹Ÿåˆã€‚é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œèƒ½å¤Ÿè®©æ‰€æœ‰çš„ç¥ç»å…ƒåœ¨å‰å‡ ä¸ªbatchä¸­è¾“å‡ºç©ºçš„æ£€æµ‹ã€‚</p>
<p>ç»è¿‡ä½œè€…çš„å®éªŒï¼Œé€šè¿‡ä½¿ç”¨biasçš„trickï¼Œå¯ä»¥æå‡mAPã€F1ã€Pã€Rç­‰æŒ‡æ ‡ï¼Œè¿˜èƒ½è®©è®­ç»ƒè¿‡ç¨‹æ›´åŠ å¹³æ»‘ã€‚</p>
<h3 id="2-3-yolo-layers"><a href="#2-3-yolo-layers" class="headerlink" title="2.3 yolo_layers"></a>2.3 yolo_layers</h3><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_yolo_layers</span>(<span class="params">model</span>):</span></span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(model.module_defs) <span class="keyword">if</span> x[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;yolo&#x27;</span>]</span><br><span class="line">    <span class="comment"># [82, 94, 106] for yolov3</span></span><br></pre></td></tr></table></figure>
<p>yolo layerçš„è·å–æ˜¯é€šè¿‡è§£æmodule_defsè¿™ä¸ªå­˜å‚¨cfgæ–‡ä»¶ä¸­çš„ä¿¡æ¯çš„å˜é‡å¾—åˆ°çš„ã€‚ä»¥yolov3.cfgä¸ºä¾‹ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯yoloå±‚åœ¨æ•´ä¸ªmoduleçš„åºå·ã€‚æ¯”å¦‚ï¼šç¬¬83,94,106ä¸ªå±‚æ˜¯YOLOå±‚ã€‚</p>
<h2 id="3-forwardå‡½æ•°"><a href="#3-forwardå‡½æ•°" class="headerlink" title="3. forwardå‡½æ•°"></a>3. forwardå‡½æ•°</h2><p>åœ¨YOLOä¸­ï¼Œå¦‚æœèƒ½ç†è§£å‰å‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œé‚£æ•´ä¸ªç½‘ç»œçš„æ„å»ºä¹Ÿå°±å¾ˆæ¸…æ¥šæ˜äº†äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x, var=<span class="literal">None</span></span>):</span></span><br><span class="line">    img_size = x.shape[-<span class="number">2</span>:]</span><br><span class="line">    layer_outputs = []</span><br><span class="line">    output = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (mdef,</span><br><span class="line">            module) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(self.module_defs, self.module_list)):</span><br><span class="line">        mtype = mdef[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> mtype <span class="keyword">in</span> [<span class="string">&#x27;convolutional&#x27;</span>, <span class="string">&#x27;upsample&#x27;</span>, <span class="string">&#x27;maxpool&#x27;</span>]:</span><br><span class="line">            <span class="comment"># å·ç§¯å±‚ï¼Œä¸Šé‡‡æ ·ï¼Œæ± åŒ–å±‚åªéœ€è¦ç»è¿‡å³å¯</span></span><br><span class="line">            x = module(x)</span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;route&#x27;</span>:</span><br><span class="line">            <span class="comment"># routeæ“ä½œå°±æ˜¯å°†å‡ ä¸ªå±‚çš„å†…å®¹æ‹¼æ¥èµ·æ¥ï¼Œå…·ä½“å¯ä»¥çœ‹cfgæ–‡ä»¶è§£æ</span></span><br><span class="line">            layers = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> mdef[<span class="string">&#x27;layers&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(layers) == <span class="number">1</span>:</span><br><span class="line">                x = layer_outputs[layers[<span class="number">0</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    x = torch.cat([layer_outputs[i] <span class="keyword">for</span> i <span class="keyword">in</span> layers], <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="comment"># apply stride 2 for darknet reorg layer</span></span><br><span class="line">                    layer_outputs[layers[<span class="number">1</span>]] = F.interpolate(</span><br><span class="line">                        layer_outputs[layers[<span class="number">1</span>]], scale_factor=[<span class="number">0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">                    x = torch.cat([layer_outputs[i] <span class="keyword">for</span> i <span class="keyword">in</span> layers], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;shortcut&#x27;</span>:</span><br><span class="line">            x = x + layer_outputs[<span class="built_in">int</span>(mdef[<span class="string">&#x27;from&#x27;</span>])]</span><br><span class="line">        <span class="keyword">elif</span> mtype == <span class="string">&#x27;yolo&#x27;</span>:</span><br><span class="line">            output.append(module(x, img_size))</span><br><span class="line">        <span class="comment">#è®°å½•routeå¯¹åº”çš„å±‚</span></span><br><span class="line">        layer_outputs.append(x <span class="keyword">if</span> i <span class="keyword">in</span> self.routs <span class="keyword">else</span> [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.training:</span><br><span class="line">        <span class="comment"># å¦‚æœè®­ç»ƒï¼Œç›´æ¥è¾“å‡ºYOLOè¦æ±‚çš„Tensor</span></span><br><span class="line">        <span class="comment"># 3*(class+5)</span></span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> ONNX_EXPORT:<span class="comment"># è¿™ä¸ªæ˜¯å¯¹åº”çš„onnxå¯¼å‡ºçš„å†…å®¹</span></span><br><span class="line">        x = [torch.cat(x, <span class="number">0</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">zip</span>(*output)]</span><br><span class="line">        <span class="keyword">return</span> x[<span class="number">0</span>], torch.cat(x[<span class="number">1</span>:<span class="number">3</span>], <span class="number">1</span>)  <span class="comment"># scores, boxes: 3780x80, 3780x4</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¯¹åº”æµ‹è¯•é˜¶æ®µ</span></span><br><span class="line">        io, p = <span class="built_in">list</span>(<span class="built_in">zip</span>(*output))  <span class="comment"># inference output, training output</span></span><br><span class="line">        <span class="keyword">return</span> torch.cat(io, <span class="number">1</span>), p</span><br></pre></td></tr></table></figure>
<p>forwardçš„è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡å¾—åˆ°çš„module_defså’Œmodule_listå˜é‡ï¼Œé€šè¿‡forå¾ªç¯å°†æ•´ä¸ªmodule_listä¸­çš„å†…å®¹è¿›è¡Œä¸€éä¸²è”ï¼Œéœ€è¦å¾—åˆ°çš„æœ€ç»ˆç»“æœæ˜¯YOLOå±‚çš„è¾“å‡ºã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3ä¸­çš„å‚æ•°è¿›åŒ–</title>
    <url>/2020/02/15/YOLOv3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E8%BF%9B%E5%8C%96/</url>
    <content><![CDATA[<p>YOLOv3ä»£ç ä¸­ä¹Ÿæä¾›äº†å‚æ•°è¿›åŒ–(æœç´¢)ï¼Œå¯ä»¥ä¸ºå¯¹åº”çš„æ•°æ®é›†è¿›åŒ–ä¸€å¥—åˆé€‚çš„è¶…å‚æ•°ã€‚æœ¬æ–‡å»ºæ¡£åˆ†æä¸€ä¸‹æœ‰å…³è¿™éƒ¨åˆ†çš„æ“ä½œæ–¹æ³•ä»¥åŠå…¶å‚æ•°çš„å…·ä½“è¿›åŒ–æ–¹æ³•ã€‚</p>
<h2 id="1-è¶…å‚æ•°"><a href="#1-è¶…å‚æ•°" class="headerlink" title="1. è¶…å‚æ•°"></a>1. è¶…å‚æ•°</h2><p>YOLOv3ä¸­çš„è¶…å‚æ•°åœ¨train.pyä¸­æä¾›ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›æ•°æ®å¢å¼ºå‚æ•°è®¾ç½®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hyp = &#123;&#x27;giou&#x27;: 3.54,  # giou loss gain</span><br><span class="line">       &#x27;cls&#x27;: 37.4,  # cls loss gain</span><br><span class="line">       &#x27;cls_pw&#x27;: 1.0,  # cls BCELoss positive_weight</span><br><span class="line">       &#x27;obj&#x27;: 49.5,  # obj loss gain (*=img_size/320 if img_size != 320)</span><br><span class="line">       &#x27;obj_pw&#x27;: 1.0,  # obj BCELoss positive_weight</span><br><span class="line">       &#x27;iou_t&#x27;: 0.225,  # iou training threshold</span><br><span class="line">       &#x27;lr0&#x27;: 0.00579,  # initial learning rate (SGD=1E-3, Adam=9E-5)</span><br><span class="line">       &#x27;lrf&#x27;: -4.,  # final LambdaLR learning rate = lr0 * (10 ** lrf)</span><br><span class="line">       &#x27;momentum&#x27;: 0.937,  # SGD momentum</span><br><span class="line">       &#x27;weight_decay&#x27;: 0.000484,  # optimizer weight decay</span><br><span class="line">       &#x27;fl_gamma&#x27;: 0.5,  # focal loss gamma</span><br><span class="line">       &#x27;hsv_h&#x27;: 0.0138,  # image HSV-Hue augmentation (fraction)</span><br><span class="line">       &#x27;hsv_s&#x27;: 0.678,  # image HSV-Saturation augmentation (fraction)</span><br><span class="line">       &#x27;hsv_v&#x27;: 0.36,  # image HSV-Value augmentation (fraction)</span><br><span class="line">       &#x27;degrees&#x27;: 1.98,  # image rotation (+/- deg)</span><br><span class="line">       &#x27;translate&#x27;: 0.05,  # image translation (+/- fraction)</span><br><span class="line">       &#x27;scale&#x27;: 0.05,  # image scale (+/- gain)</span><br><span class="line">       &#x27;shear&#x27;: 0.641&#125;  # image shear (+/- deg)</span><br></pre></td></tr></table></figure>
<h2 id="2-ä½¿ç”¨æ–¹æ³•"><a href="#2-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2. ä½¿ç”¨æ–¹æ³•"></a>2. ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œtrain.pyæä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°<code>--evolve</code>, è¿™ä¸ªå‚æ•°å†³å®šäº†æ˜¯å¦è¿›è¡Œè¶…å‚æ•°æœç´¢ä¸è¿›åŒ–ï¼ˆé»˜è®¤æ˜¯ä¸å¼€å¯è¶…å‚æ•°æœç´¢çš„ï¼‰ã€‚</p>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python train.py --data data/voc.data</span><br><span class="line">				--cfg cfg/yolov3-tiny.cfg</span><br><span class="line">				--img-size 416 </span><br><span class="line">				--epochs 273 </span><br><span class="line">				--evolve</span><br></pre></td></tr></table></figure>
<p>å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œtrain.pyä¸­çš„çº¦444è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):  <span class="comment"># generations to evolve</span></span><br></pre></td></tr></table></figure>
<p>å°†å…¶ä¸­çš„1ä¿®æ”¹ä¸ºä½ æƒ³è®¾ç½®çš„è¿­ä»£æ•°ï¼Œæ¯”å¦‚200ä»£ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œç»“æœå°†ä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®é™…ä¸Šå°±æ˜¯åªæœ‰ä¸€ä»£ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/646.webp" alt></p>
<h2 id="3-åŸç†"><a href="#3-åŸç†" class="headerlink" title="3. åŸç†"></a>3. åŸç†</h2><p>æ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå¯¹äºè¿›åŒ–è¿‡ç¨‹ä¸­çš„æ–°ä¸€ä»£ï¼Œéƒ½é€‰äº†äº†é€‚åº”æ€§æœ€é«˜çš„å‰ä¸€ä»£ï¼ˆåœ¨å‰å‡ ä»£ä¸­ï¼‰è¿›è¡Œçªå˜ã€‚ä»¥ä¸Šæ‰€æœ‰çš„å‚æ•°å°†æœ‰çº¦20%çš„ 1-sigmaçš„æ­£æ€åˆ†å¸ƒå‡ ç‡åŒæ—¶çªå˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="number">0.2</span> <span class="comment"># sigma</span></span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªè¿›åŒ–è¿‡ç¨‹éœ€è¦ææ¸…æ¥šä¸¤ä¸ªç‚¹ï¼š</p>
<ol>
<li>å¦‚ä½•è¯„åˆ¤å…¶ä¸­ä¸€ä»£çš„å¥½åï¼Ÿ</li>
<li>ä¸‹ä¸€ä»£å¦‚ä½•æ ¹æ®ä¸Šä¸€ä»£è¿›è¡Œè¿›åŒ–ï¼Ÿ</li>
</ol>
<p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</strong>åˆ¤æ–­å¥½åçš„æ ‡å‡†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fitness</span>(<span class="params">x</span>):</span></span><br><span class="line">    w = [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.8</span>, <span class="number">0.2</span>]</span><br><span class="line">    <span class="comment"># weights for [P, R, mAP, F1]@0.5</span></span><br><span class="line">    <span class="keyword">return</span> (x[:, :<span class="number">4</span>] * w).<span class="built_in">sum</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>YOLOv3è¿›åŒ–éƒ¨åˆ†æ˜¯é€šè¿‡ä»¥ä¸Šçš„é€‚åº”åº¦å‡½æ•°åˆ¤æ–­çš„ï¼Œé€‚åº”åº¦è¶Šé«˜ï¼Œä»£è¡¨è¿™ä¸€ä»£çš„æ€§èƒ½è¶Šå¥½ã€‚è€Œåœ¨é€‚åº”åº¦ä¸­ï¼Œæ˜¯é€šè¿‡Precision,Recall ,mAP,F1è¿™å››ä¸ªæŒ‡æ ‡ä½œä¸ºé€‚åº”åº¦çš„è¯„ä»·æ ‡å‡†ã€‚</p>
<p>å…¶ä¸­çš„wæ˜¯è®¾ç½®çš„åŠ æƒï¼Œå¦‚æœæ›´å…³å¿ƒmAPçš„å€¼ï¼Œå¯ä»¥æé«˜mAPçš„æƒé‡ï¼›å¦‚æœæ›´å…³å¿ƒF1,åˆ™è®¾ç½®æ›´é«˜çš„æƒé‡åœ¨å¯¹åº”çš„F1ä¸Šã€‚è¿™é‡Œåˆ†é…mAPæƒé‡ä¸º0.8ã€F1æƒé‡ä¸º0.2ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªé—®é¢˜ï¼š</strong>å¦‚ä½•è¿›è¡Œè¿›åŒ–ï¼Ÿ</p>
<p>è¿›åŒ–è¿‡ç¨‹ä¸­æœ‰<strong>ä¸¤ä¸ªé‡è¦çš„å‚æ•°</strong>:</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<strong>parent</strong>, å¯é€‰å€¼ä¸º<code>single</code>æˆ–è€…<code>weighted</code>ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ï¼šå†³å®šå¦‚ä½•é€‰æ‹©ä¸Šä¸€ä»£ã€‚å¦‚æœé€‰æ‹©singleï¼Œä»£è¡¨åªé€‰æ‹©ä¸Šä¸€ä»£ä¸­æœ€å¥½çš„é‚£ä¸ªã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> parent == <span class="string">&#x27;single&#x27;</span> <span class="keyword">or</span> <span class="built_in">len</span>(x) == <span class="number">1</span>:</span><br><span class="line">	x = x[fitness(x).argmax()]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé€‰æ‹©weightedï¼Œä»£è¡¨é€‰æ‹©å¾—åˆ†çš„å‰10ä¸ªåŠ æƒå¹³å‡çš„ç»“æœä½œä¸ºä¸‹ä¸€ä»£ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">elif</span> parent == <span class="string">&#x27;weighted&#x27;</span>:  <span class="comment"># weighted combination</span></span><br><span class="line">    n = <span class="built_in">min</span>(<span class="number">10</span>, <span class="built_in">len</span>(x))  <span class="comment"># number to merge</span></span><br><span class="line">    x = x[np.argsort(-fitness(x))][:n]  <span class="comment"># top n mutations</span></span><br><span class="line">    w = fitness(x) - fitness(x).<span class="built_in">min</span>()  <span class="comment"># weights</span></span><br><span class="line">    x = (x * w.reshape(n, <span class="number">1</span>)).<span class="built_in">sum</span>(<span class="number">0</span>) / w.<span class="built_in">sum</span>()  <span class="comment"># new parent</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªå‚æ•°ä¸º<strong>method</strong>ï¼Œå¯é€‰å€¼ä¸º<code>1,2,3</code>, åˆ†åˆ«ä»£è¡¨ä½¿ç”¨ä¸‰ç§æ¨¡å¼æ¥è¿›åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mutate</span></span><br><span class="line">method = <span class="number">2</span></span><br><span class="line">s = <span class="number">0.2</span>  <span class="comment"># 20% sigma</span></span><br><span class="line">np.random.seed(<span class="built_in">int</span>(time.time()))</span><br><span class="line">g = np.array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">.1</span>, \</span><br><span class="line">              <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])  <span class="comment"># gains</span></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„gç±»ä¼¼åŠ æƒ</span></span><br><span class="line">ng = <span class="built_in">len</span>(g)</span><br><span class="line"><span class="keyword">if</span> method == <span class="number">1</span>:</span><br><span class="line">    v = (np.random.randn(ng) *</span><br><span class="line">         np.random.random() * g * s + <span class="number">1</span>) ** <span class="number">2.0</span></span><br><span class="line"><span class="keyword">elif</span> method == <span class="number">2</span>:</span><br><span class="line">    v = (np.random.randn(ng) *</span><br><span class="line">         np.random.random(ng) * g * s + <span class="number">1</span>) ** <span class="number">2.0</span></span><br><span class="line"><span class="keyword">elif</span> method == <span class="number">3</span>:</span><br><span class="line">    v = np.ones(ng)</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">all</span>(v == <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># ä¸ºäº†é˜²æ­¢é‡å¤ï¼Œç›´åˆ°æœ‰å˜åŒ–æ‰åœä¸‹æ¥</span></span><br><span class="line">         r = (np.random.random(ng) &lt; <span class="number">0.1</span>) * np.random.randn(ng)</span><br><span class="line">         <span class="comment"># 10% çš„çªå˜å‡ ç‡</span></span><br><span class="line">         v = (g * s * r + <span class="number">1</span>) ** <span class="number">2.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(hyp.keys()):</span><br><span class="line">    hyp[k] = x[i + <span class="number">7</span>] * v[i]</span><br><span class="line">    <span class="comment"># è¿›è¡Œçªå˜</span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢çªå˜è¿‡ç¨‹ï¼Œå¯¼è‡´å‚æ•°å‡ºç°æ˜æ˜¾ä¸åˆç†çš„èŒƒå›´ï¼Œéœ€è¦ç”¨ä¸€ä¸ªèŒƒå›´è¿›è¡Œæ¡†å®šï¼Œå°†è¶…å‡ºèŒƒå›´çš„å†…å®¹å‰ªåˆ‡æ‰ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Clip to limits</span></span><br><span class="line">keys = [<span class="string">&#x27;lr0&#x27;</span>, <span class="string">&#x27;iou_t&#x27;</span>, <span class="string">&#x27;momentum&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;weight_decay&#x27;</span>, <span class="string">&#x27;hsv_s&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;hsv_v&#x27;</span>, <span class="string">&#x27;translate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;scale&#x27;</span>, <span class="string">&#x27;fl_gamma&#x27;</span>]</span><br><span class="line">limits = [(<span class="number">1e-5</span>, <span class="number">1e-2</span>), (<span class="number">0.00</span>, <span class="number">0.70</span>),</span><br><span class="line">          (<span class="number">0.60</span>, <span class="number">0.98</span>), (<span class="number">0</span>, <span class="number">0.001</span>),</span><br><span class="line">          (<span class="number">0</span>, <span class="number">.9</span>), (<span class="number">0</span>, <span class="number">.9</span>), (<span class="number">0</span>, <span class="number">.9</span>),</span><br><span class="line">          (<span class="number">0</span>, <span class="number">.9</span>), (<span class="number">0</span>, <span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(keys, limits):</span><br><span class="line">    hyp[k] = np.clip(hyp[k], v[<span class="number">0</span>], v[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆè®­ç»ƒçš„è¶…å‚æ•°æœç´¢çš„ç»“æœå¯è§†åŒ–ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/647.webp" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3çš„æ•°æ®åŠ è½½æœºåˆ¶å’Œå¢å¼ºæ–¹æ³•</title>
    <url>/2020/02/15/YOLOv3%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%92%8C%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="1-æ ‡æ³¨æ ¼å¼"><a href="#1-æ ‡æ³¨æ ¼å¼" class="headerlink" title="1. æ ‡æ³¨æ ¼å¼"></a>1. æ ‡æ³¨æ ¼å¼</h2><p><code>voc_label.py</code>ï¼Œå…¶ä½œç”¨æ˜¯å°†xmlæ–‡ä»¶è½¬æˆtxtæ–‡ä»¶æ ¼å¼ï¼Œå…·ä½“æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># class id, x, y, w, h</span><br><span class="line">0 0.8604166666666666 0.5403899721448469 0.058333333333333334 0.055710306406685235</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„x,y çš„æ„ä¹‰æ˜¯å½’ä¸€åŒ–ä»¥åçš„æ¡†çš„ä¸­å¿ƒåæ ‡ï¼Œw,hæ˜¯å½’ä¸€åŒ–åçš„æ¡†çš„å®½å’Œé«˜ã€‚</p>
<p>å…·ä½“çš„å½’ä¸€åŒ–æ–¹å¼ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">size, box</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    sizeæ˜¯å›¾ç‰‡çš„é•¿å’Œå®½</span></span><br><span class="line"><span class="string">    boxæ˜¯xmin,xmax,ymin,ymaxåæ ‡å€¼</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    dw = <span class="number">1.</span> / (size[<span class="number">0</span>])</span><br><span class="line">    dh = <span class="number">1.</span> / (size[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># å¾—åˆ°é•¿å’Œå®½çš„ç¼©æ”¾æ¯”</span></span><br><span class="line">    x = (box[<span class="number">0</span>] + box[<span class="number">1</span>])/<span class="number">2.0</span>  </span><br><span class="line">    y = (box[<span class="number">2</span>] + box[<span class="number">3</span>])/<span class="number">2.0</span>  </span><br><span class="line">    w = box[<span class="number">1</span>] - box[<span class="number">0</span>]</span><br><span class="line">    h = box[<span class="number">3</span>] - box[<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># åˆ†åˆ«è®¡ç®—ä¸­å¿ƒç‚¹åæ ‡ï¼Œæ¡†çš„å®½å’Œé«˜</span></span><br><span class="line">    x = x * dw</span><br><span class="line">    w = w * dw</span><br><span class="line">    y = y * dh</span><br><span class="line">    h = h * dh</span><br><span class="line">    <span class="comment"># æŒ‰ç…§å›¾ç‰‡é•¿å’Œå®½è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> (x,y,w,h)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå½’ä¸€åŒ–éƒ½æ˜¯ç›¸å¯¹äºå›¾ç‰‡çš„å®½å’Œé«˜è¿›è¡Œå½’ä¸€åŒ–çš„ã€‚</p>
<h2 id="2-è°ƒç”¨"><a href="#2-è°ƒç”¨" class="headerlink" title="2. è°ƒç”¨"></a>2. è°ƒç”¨</h2><p>ä¸‹è¾¹æ˜¯train.pyæ–‡ä»¶ä¸­çš„æœ‰å…³æ•°æ®çš„è°ƒç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dataset</span></span><br><span class="line">dataset = LoadImagesAndLabels(train_path, img_size, batch_size,</span><br><span class="line">                              augment=<span class="literal">True</span>,</span><br><span class="line">                              hyp=hyp,  <span class="comment"># augmentation hyperparameters</span></span><br><span class="line">                              rect=opt.rect,  <span class="comment"># rectangular training</span></span><br><span class="line">                              cache_labels=<span class="literal">True</span>,</span><br><span class="line">                              cache_images=opt.cache_images)</span><br><span class="line"></span><br><span class="line">batch_size = <span class="built_in">min</span>(batch_size, <span class="built_in">len</span>(dataset))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹åŠ è½½æ•°æ®é›†</span></span><br><span class="line">nw = <span class="built_in">min</span>([os.cpu_count(), batch_size <span class="keyword">if</span> batch_size &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">dataloader = DataLoader(dataset,</span><br><span class="line">                        batch_size=batch_size,</span><br><span class="line">                        num_workers=nw,</span><br><span class="line">                        shuffle=<span class="keyword">not</span> opt.rect,</span><br><span class="line">                        <span class="comment"># Shuffle=True</span></span><br><span class="line">                        <span class="comment"># unless rectangular training is used</span></span><br><span class="line">                        pin_memory=<span class="literal">True</span>,</span><br><span class="line">                        collate_fn=dataset.collate_fn)</span><br></pre></td></tr></table></figure>
<p>åœ¨pytorchä¸­ï¼Œæ•°æ®é›†åŠ è½½ä¸»è¦æ˜¯é‡æ„datasetsç±»ï¼Œç„¶åå†ä½¿ç”¨dataloaderä¸­åŠ è½½datasetï¼Œå°±æ„å»ºå¥½äº†æ•°æ®éƒ¨åˆ†ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ¨¡æ¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®è‡ªå·±çš„æ•°æ®é›†æ ¼å¼è¿›è¡Œé‡æ„</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDataset</span>(<span class="params">Dataset</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#ä¸‹è½½æ•°æ®ã€åˆå§‹åŒ–æ•°æ®ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå®Œæˆ</span></span><br><span class="line">        xy = np.loadtxt(<span class="string">&#x27;label.txt&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=np.float32)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨numpyè¯»å–æ•°æ®</span></span><br><span class="line">        self.x_data = torch.from_numpy(xy[:, <span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">        self.y_data = torch.from_numpy(xy[:, [-<span class="number">1</span>]])</span><br><span class="line">        self.<span class="built_in">len</span> = xy.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, index</span>):</span></span><br><span class="line">        <span class="comment"># dataloaderä¸­ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œé€šè¿‡indexè¿›è¡Œè®¿é—®</span></span><br><span class="line">        <span class="keyword">return</span> self.x_data[index], self.y_data[index]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢æ•°æ®é›†ä¸­æ•°é‡ï¼Œå¯ä»¥é€šè¿‡len(mydataset)å¾—åˆ°</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">len</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†Datasetç±»å‹çš„æ•°æ®ï¼Œè®°ä¸‹æ¥å°±å°†è¿™ä¸ªç±»ä¼ ç»™DataLoaderï¼Œå°±å¯ä»¥äº†ã€‚</span></span><br><span class="line">myDataset = MyDataset()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºdataloader</span></span><br><span class="line">train_loader = DataLoader(dataset=myDataset,</span><br><span class="line">                          batch_size=<span class="number">32</span>,</span><br><span class="line">                          shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        <span class="comment"># å°†æ•°æ®ä» train_loader ä¸­è¯»å‡ºæ¥,ä¸€æ¬¡è¯»å–çš„æ ·æœ¬æ•°æ˜¯32ä¸ª</span></span><br><span class="line">        inputs, labels = data</span><br><span class="line">        <span class="comment"># å°†è¿™äº›æ•°æ®è½¬æ¢æˆVariableç±»å‹</span></span><br><span class="line">        inputs, labels = Variable(inputs), Variable(labels)</span><br><span class="line">		<span class="comment"># æ¨¡å‹è®­ç»ƒ...</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šæ¨¡æ¿å°±èƒ½å¤§è‡´äº†è§£pytorchä¸­çš„æ•°æ®åŠ è½½æœºåˆ¶ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»YOLOv3ä¸­çš„æ•°æ®åŠ è½½ã€‚</p>
<h2 id="3-YOLOv3ä¸­çš„æ•°æ®åŠ è½½"><a href="#3-YOLOv3ä¸­çš„æ•°æ®åŠ è½½" class="headerlink" title="3. YOLOv3ä¸­çš„æ•°æ®åŠ è½½"></a>3. YOLOv3ä¸­çš„æ•°æ®åŠ è½½</h2><p>ä¸‹é¢è§£æçš„æ˜¯LoadImagesAndLabelsç±»ä¸­çš„å‡ ä¸ªä¸»è¦çš„å‡½æ•°ï¼š</p>
<h3 id="3-1-initå‡½æ•°"><a href="#3-1-initå‡½æ•°" class="headerlink" title="3.1 initå‡½æ•°"></a>3.1 initå‡½æ•°</h3><p>initå‡½æ•°ä¸­åŒ…å«äº†å¤§éƒ¨åˆ†éœ€è¦å¤„ç†çš„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoadImagesAndLabels</span>(<span class="params">Dataset</span>):</span>  <span class="comment"># for training/testing</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">                 path,</span></span></span><br><span class="line"><span class="params"><span class="function">                 img_size=<span class="number">416</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 batch_size=<span class="number">16</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 augment=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 hyp=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 rect=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 image_weights=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 cache_labels=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 cache_images=<span class="literal">False</span></span>):</span></span><br><span class="line">        path = <span class="built_in">str</span>(Path(path))  <span class="comment"># os-agnostic</span></span><br><span class="line">        <span class="keyword">assert</span> os.path.isfile(path), <span class="string">&#x27;File not found %s. See %s&#x27;</span> % (path,</span><br><span class="line">                                                                    help_url)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.img_files = [</span><br><span class="line">                x.replace(<span class="string">&#x27;/&#x27;</span>, os.sep)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> f.read().splitlines()  <span class="comment"># os-agnostic</span></span><br><span class="line">                <span class="keyword">if</span> os.path.splitext(x)[-<span class="number">1</span>].lower() <span class="keyword">in</span> img_formats</span><br><span class="line">            ]</span><br><span class="line">        <span class="comment"># img_filesæ˜¯ä¸€ä¸ªlistï¼Œä¿å­˜çš„æ˜¯å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">        n = <span class="built_in">len</span>(self.img_files)</span><br><span class="line">        <span class="keyword">assert</span> n &gt; <span class="number">0</span>, <span class="string">&#x27;No images found in %s. See %s&#x27;</span> % (path, help_url)</span><br><span class="line">        bi = np.floor(np.arange(n) / batch_size).astype(np.<span class="built_in">int</span>)  <span class="comment"># batch index</span></span><br><span class="line">        <span class="comment"># å¦‚æœn=10, batch=2, bi=[0,0,1,1,2,2,3,3,4,4]</span></span><br><span class="line">        nb = bi[-<span class="number">1</span>] + <span class="number">1</span>  <span class="comment"># æœ€å¤šæœ‰å¤šå°‘ä¸ªbatch</span></span><br><span class="line"></span><br><span class="line">        self.n = n</span><br><span class="line">        self.batch = bi  <span class="comment"># å›¾ç‰‡çš„batchç´¢å¼•ï¼Œä»£è¡¨ç¬¬å‡ ä¸ªbatchçš„å›¾ç‰‡</span></span><br><span class="line">        self.img_size = img_size</span><br><span class="line">        self.augment = augment</span><br><span class="line">        self.hyp = hyp</span><br><span class="line">        self.image_weights = image_weights <span class="comment"># æ˜¯å¦é€‰æ‹©æ ¹æ®æƒé‡è¿›è¡Œé‡‡æ ·</span></span><br><span class="line">        self.rect = <span class="literal">False</span> <span class="keyword">if</span> image_weights <span class="keyword">else</span> rect</span><br><span class="line">        <span class="comment"># å¦‚æœé€‰æ‹©æ ¹æ®æƒé‡è¿›è¡Œé‡‡æ ·ï¼Œå°†æ— æ³•ä½¿ç”¨çŸ©å½¢è®­ç»ƒï¼š</span></span><br><span class="line">        <span class="comment"># å…·ä½“å†…å®¹è§ä¸‹æ–‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ ‡ç­¾æ–‡ä»¶æ˜¯é€šè¿‡imagesæ›¿æ¢ä¸ºlabels, .jpgæ›¿æ¢ä¸º.txtå¾—åˆ°çš„ã€‚</span></span><br><span class="line">        self.label_files = [</span><br><span class="line">            x.replace(<span class="string">&#x27;images&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;labels&#x27;</span>).replace(os.path.splitext(x)[-<span class="number">1</span>], <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> self.img_files</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># çŸ©å½¢è®­ç»ƒå…·ä½“å†…å®¹è§ä¸‹æ–‡è§£æ</span></span><br><span class="line">        <span class="keyword">if</span> self.rect:</span><br><span class="line">            <span class="comment"># è·å–å›¾ç‰‡çš„é•¿å’Œå®½ (wh)</span></span><br><span class="line">            sp = path.replace(<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.shapes&#x27;</span>)</span><br><span class="line">            <span class="comment"># å­—ç¬¦ä¸²æ›¿æ¢</span></span><br><span class="line">            <span class="comment"># shapefile path</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(sp, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:  <span class="comment"># è¯»å–shapeæ–‡ä»¶</span></span><br><span class="line">                    s = [x.split() <span class="keyword">for</span> x <span class="keyword">in</span> f.read().splitlines()]</span><br><span class="line">                    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == n, <span class="string">&#x27;Shapefile out of sync&#x27;</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                s = [</span><br><span class="line">                    exif_size(Image.<span class="built_in">open</span>(f))</span><br><span class="line">                    <span class="keyword">for</span> f <span class="keyword">in</span> tqdm(self.img_files, desc=<span class="string">&#x27;Reading image shapes&#x27;</span>)</span><br><span class="line">                ]</span><br><span class="line">                np.savetxt(sp, s, fmt=<span class="string">&#x27;%g&#x27;</span>)  <span class="comment"># overwrites existing (if any)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ ¹æ®é•¿å®½æ¯”è¿›è¡Œæ’åº</span></span><br><span class="line">            s = np.array(s, dtype=np.float64)</span><br><span class="line">            ar = s[:, <span class="number">1</span>] / s[:, <span class="number">0</span>]  <span class="comment"># aspect ratio</span></span><br><span class="line">            i = ar.argsort()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ ¹æ®é¡ºåºé‡æ’é¡ºåº</span></span><br><span class="line">            self.img_files = [self.img_files[i] <span class="keyword">for</span> i <span class="keyword">in</span> i]</span><br><span class="line">            self.label_files = [self.label_files[i] <span class="keyword">for</span> i <span class="keyword">in</span> i]</span><br><span class="line">            self.shapes = s[i]  <span class="comment"># wh</span></span><br><span class="line">            ar = ar[i]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è®¾ç½®è®­ç»ƒçš„å›¾ç‰‡å½¢çŠ¶</span></span><br><span class="line">            shapes = [[<span class="number">1</span>, <span class="number">1</span>]] * nb</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nb):</span><br><span class="line">                ari = ar[bi == i]</span><br><span class="line">                mini, maxi = ari.<span class="built_in">min</span>(), ari.<span class="built_in">max</span>()</span><br><span class="line">                <span class="keyword">if</span> maxi &lt; <span class="number">1</span>:</span><br><span class="line">                    shapes[i] = [maxi, <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> mini &gt; <span class="number">1</span>:</span><br><span class="line">                    shapes[i] = [<span class="number">1</span>, <span class="number">1</span> / mini]</span><br><span class="line"></span><br><span class="line">            self.batch_shapes = np.ceil(</span><br><span class="line">                np.array(shapes) * img_size / <span class="number">32.</span>).astype(np.<span class="built_in">int</span>) * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é¢„è½½æ ‡ç­¾</span></span><br><span class="line">        <span class="comment"># weighted CE è®­ç»ƒæ—¶éœ€è¦è¿™ä¸ªæ­¥éª¤</span></span><br><span class="line">        <span class="comment"># å¦åˆ™æ— æ³•æŒ‰ç…§æƒé‡è¿›è¡Œé‡‡æ ·</span></span><br><span class="line">        self.imgs = [<span class="literal">None</span>] * n</span><br><span class="line">        self.labels = [<span class="literal">None</span>] * n</span><br><span class="line">        <span class="keyword">if</span> cache_labels <span class="keyword">or</span> image_weights:  <span class="comment"># cache labels for faster training</span></span><br><span class="line">            self.labels = [np.zeros((<span class="number">0</span>, <span class="number">5</span>))] * n</span><br><span class="line">            extract_bounding_boxes = <span class="literal">False</span></span><br><span class="line">            create_datasubset = <span class="literal">False</span></span><br><span class="line">            pbar = tqdm(self.label_files, desc=<span class="string">&#x27;Caching labels&#x27;</span>)</span><br><span class="line">            nm, nf, ne, ns, nd = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>  <span class="comment"># number missing, found, empty, datasubset, duplicate</span></span><br><span class="line">            <span class="keyword">for</span> i, file <span class="keyword">in</span> <span class="built_in">enumerate</span>(pbar):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># è¯»å–æ¯ä¸ªæ–‡ä»¶å†…å®¹</span></span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        l = np.array(</span><br><span class="line">                            [x.split() <span class="keyword">for</span> x <span class="keyword">in</span> f.read().splitlines()],</span><br><span class="line">                            dtype=np.float32)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    nm += <span class="number">1</span>  <span class="comment"># print(&#x27;missing labels for image %s&#x27; % self.img_files[i])  # file missing</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> l.shape[<span class="number">0</span>]:</span><br><span class="line">                    <span class="comment"># åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚</span></span><br><span class="line">                    <span class="comment"># æ‰€æœ‰çš„å€¼éœ€è¦&gt;0, &lt;1, ä¸€å…±5åˆ—</span></span><br><span class="line">                    <span class="keyword">assert</span> l.shape[<span class="number">1</span>] == <span class="number">5</span>, <span class="string">&#x27;&gt; 5 label columns: %s&#x27;</span> % file</span><br><span class="line">                    <span class="keyword">assert</span> (l &gt;= <span class="number">0</span>).<span class="built_in">all</span>(), <span class="string">&#x27;negative labels: %s&#x27;</span> % file</span><br><span class="line">                    <span class="keyword">assert</span> (l[:, <span class="number">1</span>:] &lt;= <span class="number">1</span>).<span class="built_in">all</span>(</span><br><span class="line">                    ), <span class="string">&#x27;non-normalized or out of bounds coordinate labels: %s&#x27;</span> % file</span><br><span class="line">                    <span class="keyword">if</span> np.unique(</span><br><span class="line">                            l, axis=<span class="number">0</span>).shape[<span class="number">0</span>] &lt; l.shape[<span class="number">0</span>]:  <span class="comment"># duplicate rows</span></span><br><span class="line">                        nd += <span class="number">1</span>  <span class="comment"># print(&#x27;WARNING: duplicate rows in %s&#x27; % self.label_files[i])  # duplicate rows</span></span><br><span class="line"></span><br><span class="line">                    self.labels[i] = l</span><br><span class="line">                    nf += <span class="number">1</span>  <span class="comment"># file found</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># åˆ›å»ºä¸€ä¸ªå°å‹çš„æ•°æ®é›†è¿›è¡Œè¯•éªŒ</span></span><br><span class="line">                    <span class="keyword">if</span> create_datasubset <span class="keyword">and</span> ns &lt; <span class="number">1E4</span>:</span><br><span class="line">                        <span class="keyword">if</span> ns == <span class="number">0</span>:</span><br><span class="line">                            create_folder(path=<span class="string">&#x27;./datasubset&#x27;</span>)</span><br><span class="line">                            os.makedirs(<span class="string">&#x27;./datasubset/images&#x27;</span>)</span><br><span class="line">                        exclude_classes = <span class="number">43</span></span><br><span class="line">                        <span class="keyword">if</span> exclude_classes <span class="keyword">not</span> <span class="keyword">in</span> l[:, <span class="number">0</span>]:</span><br><span class="line">                            ns += <span class="number">1</span></span><br><span class="line">                            <span class="comment"># shutil.copy(src=self.img_files[i], dst=&#x27;./datasubset/images/&#x27;)  # copy image</span></span><br><span class="line">                            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./datasubset/images.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                                f.write(self.img_files[i] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># ä¸ºä¸¤é˜¶æ®µåˆ†ç±»å™¨æå–ç›®æ ‡æ£€æµ‹çš„æ£€æµ‹æ¡†</span></span><br><span class="line">                    <span class="comment"># é»˜è®¤å¼€å…³æ˜¯å…³æ‰çš„ï¼Œä¸æ˜¯å¾ˆç†è§£</span></span><br><span class="line">                    <span class="keyword">if</span> extract_bounding_boxes:</span><br><span class="line">                        p = Path(self.img_files[i])</span><br><span class="line">                        img = cv2.imread(<span class="built_in">str</span>(p))</span><br><span class="line">                        h, w = img.shape[:<span class="number">2</span>]</span><br><span class="line">                        <span class="keyword">for</span> j, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(l):</span><br><span class="line">                            f = <span class="string">&#x27;%s%sclassifier%s%g_%g_%s&#x27;</span> % (p.parent.parent,</span><br><span class="line">                                                              os.sep, os.sep,</span><br><span class="line">                                                              x[<span class="number">0</span>], j, p.name)</span><br><span class="line">                            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(Path(f).parent):</span><br><span class="line">                                os.makedirs(Path(f).parent)</span><br><span class="line">                                <span class="comment"># make new output folder</span></span><br><span class="line"></span><br><span class="line">                            b = x[<span class="number">1</span>:] * np.array([w, h, w, h])  <span class="comment"># box</span></span><br><span class="line">                            b[<span class="number">2</span>:] = b[<span class="number">2</span>:].<span class="built_in">max</span>()  <span class="comment"># rectangle to square</span></span><br><span class="line">                            b[<span class="number">2</span>:] = b[<span class="number">2</span>:] * <span class="number">1.3</span> + <span class="number">30</span>  <span class="comment"># pad</span></span><br><span class="line"></span><br><span class="line">                            b = xywh2xyxy(b.reshape(-<span class="number">1</span>,<span class="number">4</span>)).ravel().astype(np.<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">                            b[[<span class="number">0</span>,<span class="number">2</span>]] = np.clip(b[[<span class="number">0</span>, <span class="number">2</span>]], <span class="number">0</span>,w)  <span class="comment"># clip boxes outside of image</span></span><br><span class="line">                            b[[<span class="number">1</span>, <span class="number">3</span>]] = np.clip(b[[<span class="number">1</span>, <span class="number">3</span>]], <span class="number">0</span>, h)</span><br><span class="line">                            <span class="keyword">assert</span> cv2.imwrite(f, img[b[<span class="number">1</span>]:b[<span class="number">3</span>], b[<span class="number">0</span>]:b[<span class="number">2</span>]]), <span class="string">&#x27;Failure extracting classifier boxes&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ne += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                pbar.desc = <span class="string">&#x27;Caching labels (%g found, %g missing, %g empty, %g duplicate, for %g images)&#x27;</span> </span><br><span class="line">                % (nf, nm, ne, nd, n) <span class="comment"># ç»Ÿè®¡å‘ç°ï¼Œä¸¢å¤±ï¼Œç©ºï¼Œé‡å¤æ ‡ç­¾çš„æ•°é‡ã€‚</span></span><br><span class="line">            <span class="keyword">assert</span> nf &gt; <span class="number">0</span>, <span class="string">&#x27;No labels found. See %s&#x27;</span> % help_url</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯ä»¥åŠ é€Ÿè®­ç»ƒ</span></span><br><span class="line">        <span class="comment"># è­¦å‘Šï¼šå¦‚æœåœ¨æ•°æ®æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹å¯èƒ½ä¼šè¶…å‡ºRAM</span></span><br><span class="line">        <span class="keyword">if</span> cache_images:  <span class="comment"># if training</span></span><br><span class="line">            gb = <span class="number">0</span>  <span class="comment"># è®¡ç®—ç¼“å­˜åˆ°å†…å­˜ä¸­çš„å›¾ç‰‡å ç”¨çš„ç©ºé—´GBä¸ºå•ä½</span></span><br><span class="line">            pbar = tqdm(<span class="built_in">range</span>(<span class="built_in">len</span>(self.img_files)), desc=<span class="string">&#x27;Caching images&#x27;</span>)</span><br><span class="line">            self.img_hw0, self.img_hw = [<span class="literal">None</span>] * n, [<span class="literal">None</span>] * n</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> pbar:  <span class="comment"># max 10k images</span></span><br><span class="line">                self.imgs[i], self.img_hw0[i], self.img_hw[i] = load_image(</span><br><span class="line">                    self, i)  <span class="comment"># img, hw_original, hw_resized</span></span><br><span class="line">                gb += self.imgs[i].nbytes</span><br><span class="line">                pbar.desc = <span class="string">&#x27;Caching images (%.1fGB)&#x27;</span> % (gb / <span class="number">1E9</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ é™¤æŸåçš„æ–‡ä»¶</span></span><br><span class="line">        <span class="comment"># æ ¹æ®éœ€è¦è¿›è¡Œæ‰‹åŠ¨å¼€å…³</span></span><br><span class="line">        detect_corrupted_images = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> detect_corrupted_images:</span><br><span class="line">            <span class="keyword">from</span> skimage <span class="keyword">import</span> io  <span class="comment"># conda install -c conda-forge scikit-image</span></span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> tqdm(self.img_files,</span><br><span class="line">                             desc=<span class="string">&#x27;Detecting corrupted images&#x27;</span>):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    _ = io.imread(file)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Corrupted image detected: %s&#x27;</span> % file)</span><br></pre></td></tr></table></figure>
<p><strong>Rectangular inferenceï¼ˆçŸ©å½¢æ¨ç†ï¼‰</strong></p>
<ol>
<li>çŸ©å½¢æ¨ç†æ˜¯åœ¨detect.pyï¼Œä¹Ÿå°±æ˜¯æµ‹è¯•è¿‡ç¨‹ä¸­çš„å®ç°ï¼Œå¯ä»¥å‡å°‘æ¨ç†æ—¶é—´ã€‚YOLOv3ä¸­æ˜¯ä¸‹é‡‡æ ·32å€ï¼Œé•¿å®½ä¹Ÿå¿…é¡»æ˜¯32çš„å€æ•°ï¼Œæ‰€ä»¥åœ¨è¿›å…¥æ¨¡å‹å‰ï¼Œæ•°æ®éœ€è¦å¤„ç†åˆ°416Ã—416å¤§å°ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä»¿å°„å˜æ¢ï¼Œå¦‚æœç”¨opencvå®ç°å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¥è‡ª https://zhuanlan.zhihu.com/p/93822508</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv2_letterbox_image</span>(<span class="params">image, expected_size</span>):</span></span><br><span class="line">    ih, iw = image.shape[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">    ew, eh = expected_size</span><br><span class="line">    scale = <span class="built_in">min</span>(eh / ih, ew / iw)</span><br><span class="line">    nh = <span class="built_in">int</span>(ih * scale)</span><br><span class="line">    nw = <span class="built_in">int</span>(iw * scale)</span><br><span class="line">    image = cv2.resize(image, (nw, nh), interpolation=cv2.INTER_CUBIC)</span><br><span class="line">    top = (eh - nh) // <span class="number">2</span></span><br><span class="line">    bottom = eh - nh - top</span><br><span class="line">    left = (ew - nw) // <span class="number">2</span></span><br><span class="line">    right = ew - nw - left</span><br><span class="line">    new_img = cv2.copyMakeBorder(image, top, bottom, left, right, cv2.BORDER_CONSTANT)</span><br><span class="line">    <span class="keyword">return</span> new_img</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªh&gt;wï¼Œä¸€ä¸ªæ˜¯w&gt;hçš„å›¾ç‰‡ç»è¿‡ä»¿å°„å˜æ¢åresizeåˆ°416Ã—416çš„ç¤ºä¾‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/643.webp" alt></p>
<p>ä»¥ä¸Šå°±æ˜¯æ­£æ–¹å½¢æ¨ç†ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºä»¥ä¸Šé€šè¿‡è¡¥å……å¾—åˆ°çš„ç»“æœä¼šå­˜åœ¨å¾ˆå¤šå†—ä½™ä¿¡æ¯ï¼Œè€ŒRectangular Trainingæ€è·¯å°±æ˜¯æƒ³è¦å»æ‰è¿™äº›å†—ä½™çš„éƒ¨åˆ†ã€‚</p>
<p>å…·ä½“è¿‡ç¨‹ä¸ºï¼šæ±‚å¾—è¾ƒé•¿è¾¹ç¼©æ”¾åˆ°416çš„æ¯”ä¾‹ï¼Œç„¶åå¯¹å›¾ç‰‡w:hæŒ‰è¿™ä¸ªæ¯”ä¾‹ç¼©æ”¾ï¼Œä½¿å¾—è¾ƒé•¿è¾¹è¾¾åˆ°416,å†å¯¹è¾ƒçŸ­è¾¹è¿›è¡Œå°½é‡å°‘çš„å¡«å……ä½¿å¾—è¾ƒçŸ­è¾¹æ»¡è¶³32çš„å€æ•°ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/644.webp" alt></p>
<p><strong>Rectangular Trainingï¼ˆçŸ©å½¢è®­ç»ƒï¼‰</strong></p>
<p>å¾ˆè‡ªç„¶çš„ï¼Œè®­ç»ƒçš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ç”¨åˆ°è¿™ä¸ªæƒ³æ³•ï¼Œå‡å°‘å†—ä½™ã€‚ä¸è¿‡è®­ç»ƒçš„æ—¶å€™æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œç”±äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ˜¯ä¸€ä¸ªbatchçš„å›¾ç‰‡ï¼Œè€Œæ¯ä¸ªbatchå›¾ç‰‡æ˜¯æœ‰å¯èƒ½é•¿å®½æ¯”ä¸åŒçš„ï¼Œè¿™å°±æ˜¯ä¸æµ‹è¯•æœ€å¤§çš„åŒºåˆ«ã€‚å…·ä½“æ˜¯å®ç°æ˜¯å–è¿™ä¸ªbatchä¸­æœ€å¤§çš„åœºåˆå®½ï¼Œç„¶åå°†æ•´ä¸ªbatchä¸­å¡«å……åˆ°max widthå’Œmax  height,è¿™æ ·æ“ä½œå¯¹å°ä¸€äº›çš„å›¾ç‰‡æ¥è¯´ä¹Ÿæ˜¯æ¯”è¾ƒæµªè´¹ã€‚è¿™é‡Œçš„yolov3çš„å®ç°ä¸»è¦å°±æ˜¯ä¼˜åŒ–äº†ä¸€ä¸‹å¦‚ä½•å°†æ¯”ä¾‹ç›¸è¿‘çš„å›¾ç‰‡æ”¾åœ¨ä¸€ä¸ªbatchï¼Œè¿™æ ·æ˜¾ç„¶å¡«å……çš„å°±æ›´å°‘ä¸€äº›äº†ã€‚ä½œè€…åœ¨issueä¸­æåˆ°ï¼Œåœ¨cocoæ•°æ®é›†ä¸­ä½¿ç”¨è¿™ä¸ªç­–ç•¥è¿›è¡Œè®­ç»ƒï¼Œèƒ½å¤Ÿå¿«1/3ã€‚</p>
<p>è€Œå¦‚æœé€‰æ‹©å¼€å¯çŸ©å½¢è®­ç»ƒï¼Œå¿…é¡»è¦å…³é—­dataloaderä¸­çš„shuffleå‚æ•°ï¼Œé˜²æ­¢å¯¹æ•°æ®çš„é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚åŒæ—¶å¦‚æœé€‰æ‹©image_weights, æ ¹æ®å›¾ç‰‡è¿›è¡Œé‡‡æ ·ï¼Œä¹Ÿæ— æ³•ä¸çŸ©é˜µè®­ç»ƒåŒæ—¶ä½¿ç”¨ã€‚</p>
<h3 id="3-2-getitemå‡½æ•°"><a href="#3-2-getitemå‡½æ•°" class="headerlink" title="3.2 getitemå‡½æ•°"></a>3.2 getitemå‡½æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, index</span>):</span></span><br><span class="line">    <span class="comment"># æ–°çš„ä¸‹è§’æ ‡</span></span><br><span class="line">    <span class="keyword">if</span> self.image_weights:</span><br><span class="line">        index = self.indices[index]</span><br><span class="line"></span><br><span class="line">    img_path = self.img_files[index]</span><br><span class="line">    label_path = self.label_files[index]</span><br><span class="line"></span><br><span class="line">    hyp = self.hyp</span><br><span class="line">    mosaic = <span class="literal">True</span> <span class="keyword">and</span> self.augment</span><br><span class="line">    <span class="comment"># å¦‚æœå¼€å¯ç»„åˆå˜åŒ–ã€æ•°æ®å¢å¼º</span></span><br><span class="line">    <span class="comment"># åŠ è½½å››å¼ å›¾ç‰‡ï¼Œä½œä¸ºä¸€ä¸ªæ‹¼å›¾ï¼Œå…·ä½“çœ‹ä¸‹æ–‡è§£æã€‚</span></span><br><span class="line">    <span class="keyword">if</span> mosaic:</span><br><span class="line">        <span class="comment"># åŠ è½½æ‹¼å›¾å†…å®¹</span></span><br><span class="line">        img, labels = load_mosaic(self, index)</span><br><span class="line">        shapes = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># åŠ è½½å›¾ç‰‡</span></span><br><span class="line">        img, (h0, w0), (h, w) = load_image(self, index)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä»¿å°„å˜æ¢</span></span><br><span class="line">        shape = self.batch_shapes[self.batch[</span><br><span class="line">            index]] <span class="keyword">if</span> self.rect <span class="keyword">else</span> self.img_size</span><br><span class="line">        img, ratio, pad = letterbox(img,</span><br><span class="line">                                    shape,</span><br><span class="line">                                    auto=<span class="literal">False</span>,</span><br><span class="line">                                    scaleup=self.augment)</span><br><span class="line">        shapes = (h0, w0), (</span><br><span class="line">            (h / h0, w / w0), pad)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åŠ è½½æ ‡æ³¨æ–‡ä»¶</span></span><br><span class="line">        labels = []</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(label_path):</span><br><span class="line">            x = self.labels[index]</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># å¦‚æœæ ‡ç­¾æ²¡æœ‰åŠ è½½ï¼Œè¯»å–label_pathå†…å®¹</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(label_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    x = np.array(</span><br><span class="line">                        [x.split() <span class="keyword">for</span> x <span class="keyword">in</span> f.read().splitlines()],</span><br><span class="line">                        dtype=np.float32)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> x.size &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># å°†å½’ä¸€åŒ–åçš„xywhè½¬åŒ–ä¸ºå·¦ä¸Šè§’ã€å³ä¸‹è§’çš„è¡¨è¾¾å½¢å¼</span></span><br><span class="line">                labels = x.copy()</span><br><span class="line">                labels[:, <span class="number">1</span>] = ratio[<span class="number">0</span>] * w * (</span><br><span class="line">                    x[:, <span class="number">1</span>] - x[:, <span class="number">3</span>] / <span class="number">2</span>) + pad[<span class="number">0</span>]  <span class="comment"># pad width</span></span><br><span class="line">                labels[:, <span class="number">2</span>] = ratio[<span class="number">1</span>] * h * (</span><br><span class="line">                    x[:, <span class="number">2</span>] - x[:, <span class="number">4</span>] / <span class="number">2</span>) + pad[<span class="number">1</span>]  <span class="comment"># pad height</span></span><br><span class="line">                labels[:, <span class="number">3</span>] = ratio[<span class="number">0</span>] * w * (x[:, <span class="number">1</span>] +</span><br><span class="line">                                               x[:, <span class="number">3</span>] / <span class="number">2</span>) + pad[<span class="number">0</span>]</span><br><span class="line">                labels[:, <span class="number">4</span>] = ratio[<span class="number">1</span>] * h * (x[:, <span class="number">2</span>] +</span><br><span class="line">                                               x[:, <span class="number">4</span>] / <span class="number">2</span>) + pad[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.augment:</span><br><span class="line">        <span class="comment"># å›¾ç‰‡ç©ºé—´çš„æ•°æ®å¢å¼º</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mosaic:</span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰ä½¿ç”¨ç»„åˆçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹å›¾ç‰‡è¿›è¡Œéšæœºæ”¾å°„</span></span><br><span class="line">            img, labels = random_affine(img,</span><br><span class="line">                                        labels,</span><br><span class="line">                                        degrees=hyp[<span class="string">&#x27;degrees&#x27;</span>],</span><br><span class="line">                                        translate=hyp[<span class="string">&#x27;translate&#x27;</span>],</span><br><span class="line">                                        scale=hyp[<span class="string">&#x27;scale&#x27;</span>],</span><br><span class="line">                                        shear=hyp[<span class="string">&#x27;shear&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¢å¼ºhsvç©ºé—´</span></span><br><span class="line">        augment_hsv(img,</span><br><span class="line">                    hgain=hyp[<span class="string">&#x27;hsv_h&#x27;</span>],</span><br><span class="line">                    sgain=hyp[<span class="string">&#x27;hsv_s&#x27;</span>],</span><br><span class="line">                    vgain=hyp[<span class="string">&#x27;hsv_v&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    nL = <span class="built_in">len</span>(labels)  <span class="comment"># æ ‡æ³¨æ–‡ä»¶ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nL:</span><br><span class="line">        <span class="comment"># å°† xyxy æ ¼å¼è½¬åŒ–ä¸º xywh æ ¼å¼</span></span><br><span class="line">        labels[:, <span class="number">1</span>:<span class="number">5</span>] = xyxy2xywh(labels[:, <span class="number">1</span>:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å½’ä¸€åŒ–åˆ°0-1ä¹‹é—´</span></span><br><span class="line">        labels[:, [<span class="number">2</span>, <span class="number">4</span>]] /= img.shape[<span class="number">0</span>]  <span class="comment"># height</span></span><br><span class="line">        labels[:, [<span class="number">1</span>, <span class="number">3</span>]] /= img.shape[<span class="number">1</span>]  <span class="comment"># width</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.augment:</span><br><span class="line">        <span class="comment"># éšæœºå·¦å³ç¿»è½¬</span></span><br><span class="line">        lr_flip = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> lr_flip <span class="keyword">and</span> random.random() &lt; <span class="number">0.5</span>:</span><br><span class="line">            img = np.fliplr(img)</span><br><span class="line">            <span class="keyword">if</span> nL:</span><br><span class="line">                labels[:, <span class="number">1</span>] = <span class="number">1</span> - labels[:, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éšæœºä¸Šä¸‹ç¿»è½¬</span></span><br><span class="line">        ud_flip = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> ud_flip <span class="keyword">and</span> random.random() &lt; <span class="number">0.5</span>:</span><br><span class="line">            img = np.flipud(img)</span><br><span class="line">            <span class="keyword">if</span> nL:</span><br><span class="line">                labels[:, <span class="number">2</span>] = <span class="number">1</span> - labels[:, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    labels_out = torch.zeros((nL, <span class="number">6</span>))</span><br><span class="line">    <span class="keyword">if</span> nL:</span><br><span class="line">        labels_out[:, <span class="number">1</span>:] = torch.from_numpy(labels)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å›¾åƒç»´åº¦è½¬æ¢</span></span><br><span class="line">    img = img[:, :, ::-<span class="number">1</span>].transpose(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>)  <span class="comment"># BGR to RGB, to 3x416x416</span></span><br><span class="line">    img = np.ascontiguousarray(img)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> torch.from_numpy(img), labels_out, img_path, shapes</span><br></pre></td></tr></table></figure>
<p>ä¸‹å›¾æ˜¯å¼€å¯äº†ç»„åˆå’Œæ—‹è½¬ä»¥åçš„å¢å¼ºæ•ˆæœ</p>
<p>è¿™é‡Œç†è§£ç»„åˆå°±æ˜¯å°†å››å¼ å›¾ç‰‡ï¼Œä»¥ä¸åŒçš„æ¯”ä¾‹ï¼Œåˆæˆä¸ºä¸€å¼ å›¾ç‰‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/645.webp" alt></p>
<h3 id="3-3-collate-fnå‡½æ•°"><a href="#3-3-collate-fnå‡½æ•°" class="headerlink" title="3.3 collate_fnå‡½æ•°"></a>3.3 collate_fnå‡½æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collate_fn</span>(<span class="params">batch</span>):</span></span><br><span class="line">    img, label, path, shapes = <span class="built_in">zip</span>(*batch)  <span class="comment"># transposed</span></span><br><span class="line">    <span class="keyword">for</span> i, l <span class="keyword">in</span> <span class="built_in">enumerate</span>(label):</span><br><span class="line">        l[:, <span class="number">0</span>] = i  <span class="comment"># add target image index for build_targets()</span></span><br><span class="line">    <span class="keyword">return</span> torch.stack(img, <span class="number">0</span>), torch.cat(label, <span class="number">0</span>), path, shapes</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰æœ€åä¸€ç‚¹å†…å®¹ï¼Œæ˜¯å…³äºpytorchçš„æ•°æ®è¯»å–æœºåˆ¶ï¼Œåœ¨pytorchçš„dataloaderä¸­æ˜¯ä¼šå¯¹é€šè¿‡getitemæ–¹æ³•å¾—åˆ°çš„ç»“æœï¼ˆbatchï¼‰è¿›è¡ŒåŒ…è£…ï¼Œè€Œè¿™ä¸ªåŒ…è£…å¯èƒ½ä¸æˆ‘ä»¬æƒ³è¦çš„æœ‰æ‰€ä¸åŒã€‚é»˜è®¤çš„æ–¹æ³•å¯ä»¥çœ‹ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default_collate</span>(<span class="params">batch</span>):</span></span><br><span class="line">    <span class="string">r&quot;&quot;&quot;Puts each data field into a tensor with outer dimension batch size&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    elem_type = <span class="built_in">type</span>(batch[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], torch.Tensor):</span><br><span class="line">        out = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> _use_shared_memory:</span><br><span class="line">            <span class="comment"># If we&#x27;re in a background process, concatenate directly into a</span></span><br><span class="line">            <span class="comment"># shared memory tensor to avoid an extra copy</span></span><br><span class="line">            numel = <span class="built_in">sum</span>([x.numel() <span class="keyword">for</span> x <span class="keyword">in</span> batch])</span><br><span class="line">            storage = batch[<span class="number">0</span>].storage()._new_shared(numel)</span><br><span class="line">            out = batch[<span class="number">0</span>].new(storage)</span><br><span class="line">        <span class="keyword">return</span> torch.stack(batch, <span class="number">0</span>, out=out)</span><br><span class="line">    <span class="keyword">elif</span> elem_type.__module__ == <span class="string">&#x27;numpy&#x27;</span> <span class="keyword">and</span> elem_type.__name__ != <span class="string">&#x27;str_&#x27;</span> \</span><br><span class="line">            <span class="keyword">and</span> elem_type.__name__ != <span class="string">&#x27;string_&#x27;</span>:</span><br><span class="line">        elem = batch[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> elem_type.__name__ == <span class="string">&#x27;ndarray&#x27;</span>:</span><br><span class="line">            <span class="comment"># array of string classes and object</span></span><br><span class="line">            <span class="keyword">if</span> np_str_obj_array_pattern.search(elem.dtype.<span class="built_in">str</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(error_msg_fmt.<span class="built_in">format</span>(elem.dtype))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> default_collate([torch.from_numpy(b) <span class="keyword">for</span> b <span class="keyword">in</span> batch])</span><br><span class="line">        <span class="keyword">if</span> elem.shape == ():  <span class="comment"># scalars</span></span><br><span class="line">            py_type = <span class="built_in">float</span> <span class="keyword">if</span> elem.dtype.name.startswith(<span class="string">&#x27;float&#x27;</span>) <span class="keyword">else</span> <span class="built_in">int</span></span><br><span class="line">            <span class="keyword">return</span> numpy_type_map[elem.dtype.name](<span class="built_in">list</span>(<span class="built_in">map</span>(py_type, batch)))</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], <span class="built_in">float</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.tensor(batch, dtype=torch.float64)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], int_classes):</span><br><span class="line">        <span class="keyword">return</span> torch.tensor(batch)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], string_classes):</span><br><span class="line">        <span class="keyword">return</span> batch</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], container_abcs.Mapping):</span><br><span class="line">        <span class="keyword">return</span> &#123;key: default_collate([d[key] <span class="keyword">for</span> d <span class="keyword">in</span> batch]) <span class="keyword">for</span> key <span class="keyword">in</span> batch[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], <span class="built_in">tuple</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(batch[<span class="number">0</span>], <span class="string">&#x27;_fields&#x27;</span>):  <span class="comment"># namedtuple</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">type</span>(batch[<span class="number">0</span>])(*(default_collate(samples) <span class="keyword">for</span> samples <span class="keyword">in</span> <span class="built_in">zip</span>(*batch)))</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(batch[<span class="number">0</span>], container_abcs.<span class="type">Sequence</span>):</span><br><span class="line">        transposed = <span class="built_in">zip</span>(*batch)</span><br><span class="line">        <span class="keyword">return</span> [default_collate(samples) <span class="keyword">for</span> samples <span class="keyword">in</span> transposed]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">raise</span> TypeError((error_msg_fmt.<span class="built_in">format</span>(<span class="built_in">type</span>(batch[<span class="number">0</span>]))))</span><br></pre></td></tr></table></figure>
<p>ä¼šæ ¹æ®ä½ çš„æ•°æ®ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯è¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹<code>collate_fn</code>,å…·ä½“å†…å®¹è¯·çœ‹ä»£ç ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±ä¸å¤šèµ˜è¿°ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3çš„cfgæ–‡ä»¶è§£æ</title>
    <url>/2020/02/14/YOLOv3%E7%9A%84cfg%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="1-Netå±‚"><a href="#1-Netå±‚" class="headerlink" title="1. Netå±‚"></a>1. Netå±‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[net]</span><br><span class="line">#Testing</span><br><span class="line">#batch=1</span><br><span class="line">#subdivisions=1</span><br><span class="line">#åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè®¾ç½®batch=1,subdivisions=1</span><br><span class="line">#Training</span><br><span class="line">batch=16</span><br><span class="line">subdivisions=4</span><br><span class="line">#è¿™é‡Œçš„batchä¸æ™®éæ„ä¹‰ä¸Šçš„batchä¸æ˜¯ä¸€è‡´çš„ã€‚</span><br><span class="line">#è®­ç»ƒçš„è¿‡ç¨‹ä¸­å°†ä¸€æ¬¡æ€§åŠ è½½16å¼ å›¾ç‰‡è¿›å†…å­˜ï¼Œç„¶ååˆ†4æ¬¡å®Œæˆå‰å‘ä¼ æ’­ï¼Œæ¯æ¬¡4å¼ ã€‚</span><br><span class="line">#ç»è¿‡16å¼ å›¾ç‰‡çš„å‰å‘ä¼ æ’­ä»¥åï¼Œè¿›è¡Œä¸€æ¬¡åå‘ä¼ æ’­ã€‚</span><br><span class="line">width=416</span><br><span class="line">height=416</span><br><span class="line">channels=3</span><br><span class="line">#è®¾ç½®å›¾ç‰‡è¿›å…¥ç½‘ç»œçš„å®½ã€é«˜å’Œé€šé“ä¸ªæ•°ã€‚</span><br><span class="line">#ç”±äºYOLOv3çš„ä¸‹é‡‡æ ·ä¸€èˆ¬æ˜¯32å€ï¼Œæ‰€ä»¥å®½é«˜å¿…é¡»èƒ½è¢«32æ•´é™¤ã€‚</span><br><span class="line">#å¤šå°ºåº¦è®­ç»ƒé€‰æ‹©ä¸º32çš„å€æ•°æœ€å°320*320ï¼Œæœ€å¤§608*608ã€‚</span><br><span class="line">#é•¿å’Œå®½è¶Šå¤§ï¼Œå¯¹å°ç›®æ ‡è¶Šå¥½ï¼Œä½†æ˜¯å ç”¨æ˜¾å­˜ä¹Ÿä¼šé«˜ï¼Œéœ€è¦æƒè¡¡ã€‚</span><br><span class="line">momentum=0.9</span><br><span class="line">#åŠ¨é‡å‚æ•°å½±å“ç€æ¢¯åº¦ä¸‹é™åˆ°æœ€ä¼˜å€¼çš„é€Ÿåº¦ã€‚</span><br><span class="line">decay=0.0005</span><br><span class="line">#æƒé‡è¡°å‡æ­£åˆ™é¡¹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</span><br><span class="line">angle=0</span><br><span class="line">#æ•°æ®å¢å¼ºï¼Œè®¾ç½®æ—‹è½¬è§’åº¦ã€‚</span><br><span class="line">saturation = 1.5</span><br><span class="line">#é¥±å’Œåº¦</span><br><span class="line">exposure = 1.5</span><br><span class="line">#æ›å…‰é‡</span><br><span class="line">hue=.1</span><br><span class="line">#è‰²è°ƒ</span><br><span class="line"></span><br><span class="line">learning_rate=0.001</span><br><span class="line">#å­¦ä¹ ç‡:åˆšå¼€å§‹è®­ç»ƒæ—¶å¯ä»¥å°†å­¦ä¹ ç‡è®¾ç½®çš„é«˜ä¸€ç‚¹ï¼Œè€Œä¸€å®šè½®æ•°ä¹‹åï¼Œå°†å…¶å‡å°ã€‚</span><br><span class="line">#åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ ¹æ®è®­ç»ƒè½®æ•°è®¾ç½®åŠ¨æ€å˜åŒ–çš„å­¦ä¹ ç‡ã€‚</span><br><span class="line">burn_in=1000</span><br><span class="line">#åœ¨è¿­ä»£æ¬¡æ•°å°äºburn_inæ—¶ï¼Œå…¶å­¦ä¹ ç‡çš„æ›´æ–°æœ‰ä¸€ç§æ–¹å¼ï¼Œå¤§äºburn inæ—¶ï¼Œæ‰é‡‡ç”¨policyçš„æ›´æ–°æ–¹å¼</span><br><span class="line">max_batches = 500200</span><br><span class="line">#æœ€å¤§batch</span><br><span class="line">policy=steps</span><br><span class="line">#å­¦ä¹ ç‡è°ƒæ•´çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹policyï¼š</span><br><span class="line">#constant, steps, exp, poly, step, sig, RANDOMï¼Œconstantç­‰æ–¹å¼</span><br><span class="line">#è°ƒæ•´å­¦ä¹ ç‡çš„policyï¼Œ</span><br><span class="line">#æœ‰å¦‚ä¸‹policyï¼šconstant, steps, exp, poly, step, sig, RANDOMã€‚</span><br><span class="line">#steps#æ¯”è¾ƒå¥½ç†è§£ï¼ŒæŒ‰ç…§stepsæ¥æ”¹å˜å­¦ä¹ ç‡ã€‚</span><br><span class="line"></span><br><span class="line">steps=400000,450000</span><br><span class="line">scales=.1,.1</span><br><span class="line">#åœ¨è¾¾åˆ°40000ã€45000çš„æ—¶å€™å°†å­¦ä¹ ç‡ä¹˜ä»¥å¯¹åº”çš„scale</span><br><span class="line">#å³stepså’Œscaleæ˜¯è®¾ç½®å­¦ä¹ ç‡çš„å˜åŒ–ï¼Œè¿­ä»£åˆ°40000æ¬¡æ—¶ï¼Œå­¦ä¹ ç‡è¡°å‡10å€ï¼Œ45000æ¬¡è¿­ä»£æ—¶ï¼Œå­¦ä¹ ç‡åˆä¼šåœ¨å‰ä¸€ä¸ªå­¦ä¹ ç‡çš„åŸºç¡€ä¸Šè¡°å‡10å€</span><br></pre></td></tr></table></figure>
<h2 id="2-å·ç§¯å±‚"><a href="#2-å·ç§¯å±‚" class="headerlink" title="2. å·ç§¯å±‚"></a>2. å·ç§¯å±‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1    		</span><br><span class="line">#æ˜¯å¦åšBNæ“ä½œ</span><br><span class="line">filters=32                  </span><br><span class="line">#è¾“å‡ºç‰¹å¾å›¾çš„æ•°é‡</span><br><span class="line">size=3               		</span><br><span class="line">#å·ç§¯æ ¸çš„å°ºå¯¸</span><br><span class="line">stride=1                	</span><br><span class="line">#åšå·ç§¯è¿ç®—çš„æ­¥é•¿</span><br><span class="line">pad=1               		</span><br><span class="line">#å·ç§¯æ—¶æ˜¯å¦è¿›è¡Œè¡¥é›¶paddingï¼›paddingçš„ä¸ªæ•°ä¸å·ç§¯æ ¸å°ºå¯¸æœ‰å…³ï¼Œä¸ºsize/2å‘ä¸‹å–æ•´ï¼Œå¦‚3/2=1</span><br><span class="line">activation=leaky		</span><br><span class="line">#æ¿€æ´»å‡½æ•°çš„ç±»å‹ï¼šlogisticï¼Œloggyï¼Œreluï¼Œ</span><br><span class="line">#eluï¼Œrelieï¼Œplseï¼Œhardtanï¼Œlhtanï¼Œ</span><br><span class="line">#linearï¼Œrampï¼Œleakyï¼Œtanhï¼Œstair</span><br><span class="line"># alexeyABç‰ˆæ·»åŠ äº†mish, swish, nrom_chanç­‰æ–°çš„æ¿€æ´»å‡½æ•°</span><br></pre></td></tr></table></figure>
<p>feature mapè®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
OutFeature =\frac{\text {InFeature}+2 \times \text { padding }-\text {size}}{\text {stride}}+1</script><h2 id="3-ä¸‹é‡‡æ ·"><a href="#3-ä¸‹é‡‡æ ·" class="headerlink" title="3. ä¸‹é‡‡æ ·"></a>3. ä¸‹é‡‡æ ·</h2><p>å¯ä»¥é€šè¿‡è°ƒæ•´å·ç§¯å±‚å‚æ•°è¿›è¡Œä¸‹é‡‡æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=3</span><br><span class="line">stride=2</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡å¸¦å…¥ä»¥ä¸Šå…¬å¼ï¼Œå¯ä»¥å¾—åˆ°OutFeatureæ˜¯InFeatureçš„ä¸€åŠã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨maxpoolingè¿›è¡Œä¸‹é‡‡æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br></pre></td></tr></table></figure>
<h2 id="4-ä¸Šé‡‡æ ·"><a href="#4-ä¸Šé‡‡æ ·" class="headerlink" title="4. ä¸Šé‡‡æ ·"></a>4. ä¸Šé‡‡æ ·</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[upsample]</span><br><span class="line">stride=2</span><br></pre></td></tr></table></figure>
<p>ä¸Šé‡‡æ ·æ˜¯é€šè¿‡çº¿æ€§æ’å€¼å®ç°çš„ã€‚</p>
<h2 id="5-Shortcutå’ŒRouteå±‚"><a href="#5-Shortcutå’ŒRouteå±‚" class="headerlink" title="5. Shortcutå’ŒRouteå±‚"></a>5. Shortcutå’ŒRouteå±‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[shortcut]</span><br><span class="line">from=-3</span><br><span class="line">activation=linear</span><br><span class="line">#shortcutæ“ä½œæ˜¯ç±»ä¼¼ResNetçš„è·¨å±‚è¿æ¥ï¼Œå‚æ•°fromæ˜¯âˆ’3ï¼Œ</span><br><span class="line">#æ„æ€æ˜¯shortcutçš„è¾“å‡ºæ˜¯å½“å‰å±‚ä¸å…ˆå‰çš„å€’æ•°ç¬¬ä¸‰å±‚ç›¸åŠ è€Œå¾—åˆ°ã€‚</span><br><span class="line"># é€šä¿—æ¥è®²å°±æ˜¯addæ“ä½œ</span><br><span class="line"></span><br><span class="line">[route]</span><br><span class="line">layers = -1, 36</span><br><span class="line"># å½“å±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œå°±æ˜¯å°†ä¸Šä¸€å±‚å’Œç¬¬36å±‚è¿›è¡Œconcate</span><br><span class="line">#å³æ²¿æ·±åº¦çš„ç»´åº¦è¿æ¥ï¼Œè¿™ä¹Ÿè¦æ±‚feature mapå¤§å°æ˜¯ä¸€è‡´çš„ã€‚</span><br><span class="line">[route]</span><br><span class="line">layers = -4</span><br><span class="line">#å½“å±æ€§åªæœ‰ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒä¼šè¾“å‡ºç”±è¯¥å€¼ç´¢å¼•çš„ç½‘ç»œå±‚çš„ç‰¹å¾å›¾ã€‚</span><br><span class="line">#æœ¬ä¾‹å­ä¸­å°±æ˜¯æå–ä»å½“å‰å€’æ•°ç¬¬å››ä¸ªå±‚è¾“å‡º</span><br></pre></td></tr></table></figure>
<h2 id="6-YOLOå±‚"><a href="#6-YOLOå±‚" class="headerlink" title="6. YOLOå±‚"></a>6. YOLOå±‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=18</span><br><span class="line">#æ¯ä¸€ä¸ª[region/yolo]å±‚å‰çš„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­çš„</span><br><span class="line">#filters=num(yoloå±‚ä¸ªæ•°)*(classes+5) ,5çš„æ„ä¹‰æ˜¯5ä¸ªåæ ‡ï¼Œ</span><br><span class="line">#ä»£è¡¨è®ºæ–‡ä¸­çš„tx,ty,tw,th,po</span><br><span class="line">#è¿™é‡Œç±»åˆ«ä¸ªæ•°ä¸º1ï¼Œï¼ˆ1+5ï¼‰*3=18</span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line">[yolo]	</span><br><span class="line">mask = 6,7,8 				</span><br><span class="line">#è®­ç»ƒæ¡†maskçš„å€¼æ˜¯0,1,2ï¼Œ			</span><br><span class="line">#è¿™æ„å‘³ç€ä½¿ç”¨ç¬¬ä¸€ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªanchor</span><br><span class="line">anchors = 10,13,  16,30,  33,23,  30,61,  62,45,\</span><br><span class="line">		  59,119,  116,90,  156,198,  373,326</span><br><span class="line"># æ€»å…±æœ‰ä¸‰ä¸ªæ£€æµ‹å±‚ï¼Œå…±è®¡9ä¸ªanchor</span><br><span class="line"># è¿™é‡Œçš„anchoræ˜¯ç”±kmeansèšç±»ç®—æ³•å¾—åˆ°çš„ã€‚</span><br><span class="line">classes=1 </span><br><span class="line">#ç±»åˆ«ä¸ªæ•°</span><br><span class="line">num=9     			</span><br><span class="line">#æ¯ä¸ªgridé¢„æµ‹çš„BoundingBox num/yoloå±‚ä¸ªæ•°</span><br><span class="line">jitter=.3    		</span><br><span class="line">#åˆ©ç”¨æ•°æ®æŠ–åŠ¨äº§ç”Ÿæ›´å¤šæ•°æ®ï¼Œ</span><br><span class="line">#å±äºTTAï¼ˆTest Time Augmentationï¼‰</span><br><span class="line">ignore_thresh = .5</span><br><span class="line"># ignore_thresh æŒ‡çš„æ˜¯å‚ä¸è®¡ç®—çš„IOUé˜ˆå€¼å¤§å°ã€‚</span><br><span class="line">#å½“é¢„æµ‹çš„æ£€æµ‹æ¡†ä¸ground trueçš„IOUå¤§äºignore_threshçš„æ—¶å€™ï¼Œ</span><br><span class="line">#å‚ä¸lossçš„è®¡ç®—ï¼Œå¦åˆ™ï¼Œæ£€æµ‹æ¡†çš„ä¸å‚ä¸æŸå¤±è®¡ç®—ã€‚</span><br><span class="line">#ç›®çš„æ˜¯æ§åˆ¶å‚ä¸lossè®¡ç®—çš„æ£€æµ‹æ¡†çš„è§„æ¨¡ï¼Œå½“ignore_threshè¿‡äºå¤§ï¼Œ</span><br><span class="line">#æ¥è¿‘äº1çš„æ—¶å€™ï¼Œé‚£ä¹ˆå‚ä¸æ£€æµ‹æ¡†å›å½’lossçš„ä¸ªæ•°å°±ä¼šæ¯”è¾ƒå°‘ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼›</span><br><span class="line">#è€Œå¦‚æœignore_threshè®¾ç½®çš„è¿‡äºå°ï¼Œé‚£ä¹ˆå‚ä¸è®¡ç®—çš„ä¼šæ•°é‡è§„æ¨¡å°±ä¼šå¾ˆå¤§ã€‚</span><br><span class="line">#åŒæ—¶ä¹Ÿå®¹æ˜“åœ¨è¿›è¡Œæ£€æµ‹æ¡†å›å½’çš„æ—¶å€™é€ æˆæ¬ æ‹Ÿåˆã€‚</span><br><span class="line">#ignore_thresh ä¸€èˆ¬é€‰å–0.5-0.7ä¹‹é—´çš„ä¸€ä¸ªå€¼</span><br><span class="line"># å°å°ºåº¦ï¼ˆ13*13ï¼‰ç”¨çš„æ˜¯0.7ï¼Œ</span><br><span class="line"># å¤§å°ºåº¦ï¼ˆ26*26ï¼‰ç”¨çš„æ˜¯0.5ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="7-æ¨¡å—æ€»ç»“"><a href="#7-æ¨¡å—æ€»ç»“" class="headerlink" title="7. æ¨¡å—æ€»ç»“"></a>7. æ¨¡å—æ€»ç»“</h2><p>Darket-53ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-e65c08c61bfaa7c7.png" alt></p>
<p>å®ƒæ˜¯ç”±é‡å¤çš„ç±»ä¼¼äºResNetçš„æ¨¡å—ç»„æˆçš„ï¼Œå…¶ä¸‹é‡‡æ ·æ˜¯é€šè¿‡å·ç§¯æ¥å®Œæˆçš„ã€‚é€šè¿‡å¯¹cfgæ–‡ä»¶çš„è§‚å¯Ÿï¼Œæå‡ºäº†ä»¥ä¸‹æ€»ç»“ï¼š</p>
<p><strong>ä¸æ”¹å˜featureå¤§å°çš„æ¨¡å—ï¼š</strong></p>
<ol>
<li>æ®‹å·®æ¨¡å—ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=256</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br><span class="line"></span><br><span class="line">[shortcut]</span><br><span class="line">from=-3</span><br><span class="line">activation=linear</span><br></pre></td></tr></table></figure>
<ol>
<li>1Ã—1å·ç§¯ï¼šå¯ä»¥é™ä½è®¡ç®—é‡</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=512</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br></pre></td></tr></table></figure>
<ol>
<li>æ™®é€š3Ã—3å·ç§¯ï¼šå¯ä»¥å¯¹filterä¸ªæ•°è¿›è¡Œè°ƒæ•´</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=1024</span><br><span class="line">size=3</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br></pre></td></tr></table></figure>
<p><strong>æ”¹å˜feature mapå¤§å°</strong></p>
<ol>
<li>feature mapå‡åŠï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=2</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">batch_normalize=1</span><br><span class="line">filters=128</span><br><span class="line">size=3</span><br><span class="line">stride=2</span><br><span class="line">pad=1</span><br><span class="line">activation=leaky</span><br></pre></td></tr></table></figure>
<ol>
<li>feature mapåŠ å€:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[maxpool]</span><br><span class="line">size=2</span><br><span class="line">stride=1</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹å¾èåˆæ“ä½œ</strong></p>
<ol>
<li>ä½¿ç”¨Routeå±‚è·å–æŒ‡å®šçš„å±‚ï¼ˆ13Ã—13ï¼‰ã€‚</li>
<li>æ·»åŠ å·ç§¯å±‚è¿›è¡Œå­¦ä¹ ä½†ä¸æ”¹å˜feature mapå¤§å°ã€‚</li>
<li>è¿›è¡Œä¸Šé‡‡æ ·ï¼ˆ26Ã—26ï¼‰ã€‚</li>
<li>ä»backboneä¸­æ‰¾åˆ°å¯¹åº”feature mapå¤§å°çš„å±‚è¿›è¡ŒRouteæˆ–è€…Shortcutï¼ˆ26Ã—26ï¼‰ã€‚</li>
<li>èåˆå®Œæˆã€‚</li>
</ol>
<blockquote>
<p>åè®°ï¼šä»¥ä¸Šæ˜¯ä½¿ç”¨darknetè¿‡ç¨‹ä¸­æ”¶é›†å’Œæ€»ç»“çš„ä¸€äº›ç»éªŒï¼ŒæŒæ¡ä»¥ä¸Šå†…å®¹å¹¶è¯»æ‡‚yolov3è®ºæ–‡åï¼Œå°±å¯ä»¥ç€æ‰‹è¿è¡Œä»£ç äº†ã€‚ç›®å‰ä½¿ç”¨ä¸darknetä¸€è‡´çš„cfgæ–‡ä»¶è§£æçš„æœ‰ä¸€äº›ï¼Œæ¯”å¦‚åŸç‰ˆDarknetï¼ŒAlexeyABç‰ˆæœ¬çš„Darknetï¼Œè¿˜æœ‰ä¸€ä¸ªpytorchç‰ˆæœ¬çš„yolov3ã€‚AlexeyABç‰ˆæœ¬çš„æ·»åŠ äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæ¯”å¦‚ [conv_lstm], [scale_channels] SE/ASFF/BiFPN, [local_avgpool], [sam],  [Gaussian_yolo], [reorg3d] (fixed [reorg]),  [batchnorm]ç­‰ç­‰ã€‚è€Œpytorchç‰ˆæœ¬çš„yolov3å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ã€‚ä¹‹åæˆ‘ä»¬å°†ä¼šå¯¹è¿™ä¸ªç‰ˆæœ¬è¿›è¡Œæ”¹è¿›ï¼Œæ·»åŠ å­”æ´å·ç§¯ã€SEã€CBAMã€SKç­‰æ¨¡å—ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorchç‰ˆYOLOv3ä¸­çš„ä»£ç é…ç½®å’Œæ•°æ®é›†æ„å»º</title>
    <url>/2020/02/15/Pytorch%E7%89%88YOLOv3%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE%E5%92%8C%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h3 id="1-ç¯å¢ƒæ­å»º"><a href="#1-ç¯å¢ƒæ­å»º" class="headerlink" title="1. ç¯å¢ƒæ­å»º"></a>1. ç¯å¢ƒæ­å»º</h3><ol>
<li>å°†githubåº“downloadä¸‹æ¥ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/ultralytics/yolov3.git</span><br></pre></td></tr></table></figure>
<ol>
<li>å»ºè®®åœ¨linuxç¯å¢ƒä¸‹ä½¿ç”¨anacondaè¿›è¡Œæ­å»º</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">conda create -n yolov3 python=3.7</span><br></pre></td></tr></table></figure>
<ol>
<li>å®‰è£…éœ€è¦çš„è½¯ä»¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p>ç¯å¢ƒè¦æ±‚ï¼š</p>
<ul>
<li>python &gt;= 3.7</li>
<li>pytorch &gt;= 1.1</li>
<li>numpy</li>
<li>tqdm</li>
<li>opencv-python</li>
</ul>
<p>å…¶ä¸­åªéœ€è¦æ³¨æ„pytorchçš„å®‰è£…ï¼š</p>
<p>åˆ°<a href="https://pytorch.org/">https://pytorch.org/</a>ä¸­æ ¹æ®æ“ä½œç³»ç»Ÿï¼Œpythonç‰ˆæœ¬ï¼Œcudaç‰ˆæœ¬ç­‰é€‰æ‹©å‘½ä»¤å³å¯ã€‚</p>
<h3 id="2-æ•°æ®é›†æ„å»º"><a href="#2-æ•°æ®é›†æ„å»º" class="headerlink" title="2. æ•°æ®é›†æ„å»º"></a>2. æ•°æ®é›†æ„å»º</h3><h4 id="1-xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶"><a href="#1-xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶" class="headerlink" title="1. xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶"></a>1. xmlæ–‡ä»¶ç”Ÿæˆéœ€è¦Labelimgè½¯ä»¶</h4><p>åœ¨Windowsä¸‹ä½¿ç”¨LabelImgè½¯ä»¶è¿›è¡Œæ ‡æ³¨ï¼š</p>
<ul>
<li>ä½¿ç”¨å¿«æ·é”®ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl + u  åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰å›¾åƒï¼Œé¼ æ ‡ç‚¹å‡»Open diråŒåŠŸèƒ½</span><br><span class="line">Ctrl + r  æ›´æ”¹é»˜è®¤æ³¨é‡Šç›®æ ‡ç›®å½•(xmlæ–‡ä»¶ä¿å­˜çš„åœ°å€)</span><br><span class="line">Ctrl + s  ä¿å­˜</span><br><span class="line">Ctrl + d  å¤åˆ¶å½“å‰æ ‡ç­¾å’ŒçŸ©å½¢æ¡†</span><br><span class="line">space     å°†å½“å‰å›¾åƒæ ‡è®°ä¸ºå·²éªŒè¯</span><br><span class="line">w         åˆ›å»ºä¸€ä¸ªçŸ©å½¢æ¡†</span><br><span class="line">d         ä¸‹ä¸€å¼ å›¾ç‰‡</span><br><span class="line">a         ä¸Šä¸€å¼ å›¾ç‰‡</span><br><span class="line">del       åˆ é™¤é€‰å®šçš„çŸ©å½¢æ¡†</span><br><span class="line">Ctrl++    æ”¾å¤§</span><br><span class="line">Ctrl--    ç¼©å°</span><br><span class="line">â†‘â†’â†“â†        é”®ç›˜ç®­å¤´ç§»åŠ¨é€‰å®šçš„çŸ©å½¢æ¡†</span><br></pre></td></tr></table></figure>
<h4 id="2-VOC2007-æ•°æ®é›†æ ¼å¼"><a href="#2-VOC2007-æ•°æ®é›†æ ¼å¼" class="headerlink" title="2. VOC2007 æ•°æ®é›†æ ¼å¼"></a>2. VOC2007 æ•°æ®é›†æ ¼å¼</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-data</span><br><span class="line">    - VOCdevkit2007</span><br><span class="line">        - VOC2007</span><br><span class="line">            - Annotations (æ ‡ç­¾XMLæ–‡ä»¶ï¼Œç”¨å¯¹åº”çš„å›¾ç‰‡å¤„ç†å·¥å…·äººå·¥ç”Ÿæˆçš„)</span><br><span class="line">            - ImageSets (ç”Ÿæˆçš„æ–¹æ³•æ˜¯ç”¨shæˆ–è€…MATLABè¯­è¨€ç”Ÿæˆ)</span><br><span class="line">                - Main</span><br><span class="line">                    - test.txt</span><br><span class="line">                    - train.txt</span><br><span class="line">                    - trainval.txt</span><br><span class="line">                    - val.txt</span><br><span class="line">            - JPEGImages(åŸå§‹æ–‡ä»¶)</span><br><span class="line">            - labels (xmlæ–‡ä»¶å¯¹åº”çš„txtæ–‡ä»¶)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šè½¯ä»¶ä¸»è¦æ„é€ å¥½JPEGImageså’ŒAnnotationsæ–‡ä»¶å¤¹ä¸­å†…å®¹,Mainæ–‡ä»¶å¤¹ä¸­çš„txtæ–‡ä»¶å¯ä»¥é€šè¿‡ä»¥ä¸‹pythonè„šæœ¬ç”Ÿæˆï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">  </span><br><span class="line">trainval_percent = <span class="number">0.9</span></span><br><span class="line">train_percent = <span class="number">1</span></span><br><span class="line">xmlfilepath = <span class="string">&#x27;Annotations&#x27;</span></span><br><span class="line">txtsavepath = <span class="string">&#x27;ImageSets\Main&#x27;</span></span><br><span class="line">total_xml = os.listdir(xmlfilepath)</span><br><span class="line">  </span><br><span class="line">num=<span class="built_in">len</span>(total_xml)</span><br><span class="line"><span class="built_in">list</span>=<span class="built_in">range</span>(num)</span><br><span class="line">tv=<span class="built_in">int</span>(num*trainval_percent)</span><br><span class="line">tr=<span class="built_in">int</span>(tv*train_percent)</span><br><span class="line">trainval= random.sample(<span class="built_in">list</span>,tv)</span><br><span class="line">train=random.sample(trainval,tr)</span><br><span class="line">  </span><br><span class="line">ftrainval = <span class="built_in">open</span>(<span class="string">&#x27;ImageSets/Main/trainval.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">ftest = <span class="built_in">open</span>(<span class="string">&#x27;ImageSets/Main/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">ftrain = <span class="built_in">open</span>(<span class="string">&#x27;ImageSets/Main/train.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">fval = <span class="built_in">open</span>(<span class="string">&#x27;ImageSets/Main/val.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i  <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    name=total_xml[i][:-<span class="number">4</span>]+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> trainval:</span><br><span class="line">        ftrainval.write(name)</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> train:</span><br><span class="line">            ftrain.write(name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fval.write(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ftest.write(name)</span><br><span class="line">  </span><br><span class="line">ftrainval.close()</span><br><span class="line">ftrain.close()</span><br><span class="line">fval.close()</span><br><span class="line">ftest.close()</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ç”Ÿæˆlabelsæ–‡ä»¶å¤¹ä¸­çš„txtæ–‡ä»¶ï¼Œvoc_label.pyæ–‡ä»¶å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on Tue Oct  2 11:42:13 2018</span></span><br><span class="line"><span class="string">å°†æœ¬æ–‡ä»¶æ”¾åˆ°VOC2007ç›®å½•ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è¿è¡Œ</span></span><br><span class="line"><span class="string">éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š</span></span><br><span class="line"><span class="string">1. setsä¸­æ›¿æ¢ä¸ºè‡ªå·±çš„æ•°æ®é›†</span></span><br><span class="line"><span class="string">2. classesä¸­æ›¿æ¢ä¸ºè‡ªå·±çš„ç±»åˆ«</span></span><br><span class="line"><span class="string">3. å°†æœ¬æ–‡ä»¶æ”¾åˆ°VOC2007ç›®å½•ä¸‹</span></span><br><span class="line"><span class="string">4. ç›´æ¥å¼€å§‹è¿è¡Œ</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir, getcwd</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br><span class="line">sets=[(<span class="string">&#x27;2007&#x27;</span>, <span class="string">&#x27;train&#x27;</span>), (<span class="string">&#x27;2007&#x27;</span>, <span class="string">&#x27;val&#x27;</span>), (<span class="string">&#x27;2007&#x27;</span>, <span class="string">&#x27;test&#x27;</span>)]  <span class="comment">#æ›¿æ¢ä¸ºè‡ªå·±çš„æ•°æ®é›†</span></span><br><span class="line">classes = [<span class="string">&quot;person&quot;</span>]     <span class="comment">#ä¿®æ”¹ä¸ºè‡ªå·±çš„ç±»åˆ«</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">size, box</span>):</span></span><br><span class="line">    dw = <span class="number">1.</span>/(size[<span class="number">0</span>])</span><br><span class="line">    dh = <span class="number">1.</span>/(size[<span class="number">1</span>])</span><br><span class="line">    x = (box[<span class="number">0</span>] + box[<span class="number">1</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    y = (box[<span class="number">2</span>] + box[<span class="number">3</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    w = box[<span class="number">1</span>] - box[<span class="number">0</span>]</span><br><span class="line">    h = box[<span class="number">3</span>] - box[<span class="number">2</span>]</span><br><span class="line">    x = x*dw</span><br><span class="line">    w = w*dw</span><br><span class="line">    y = y*dh</span><br><span class="line">    h = h*dh</span><br><span class="line">    <span class="keyword">return</span> (x,y,w,h)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_annotation</span>(<span class="params">year, image_id</span>):</span></span><br><span class="line">    in_file = <span class="built_in">open</span>(<span class="string">&#x27;VOC%s/Annotations/%s.xml&#x27;</span>%(year, image_id))  <span class="comment">#å°†æ•°æ®é›†æ”¾äºå½“å‰ç›®å½•ä¸‹</span></span><br><span class="line">    out_file = <span class="built_in">open</span>(<span class="string">&#x27;VOC%s/labels/%s.txt&#x27;</span>%(year, image_id), <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    tree=ET.parse(in_file)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line">    size = root.find(<span class="string">&#x27;size&#x27;</span>)</span><br><span class="line">    w = <span class="built_in">int</span>(size.find(<span class="string">&#x27;width&#x27;</span>).text)</span><br><span class="line">    h = <span class="built_in">int</span>(size.find(<span class="string">&#x27;height&#x27;</span>).text)</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">&#x27;object&#x27;</span>):</span><br><span class="line">        difficult = obj.find(<span class="string">&#x27;difficult&#x27;</span>).text</span><br><span class="line">        cls = obj.find(<span class="string">&#x27;name&#x27;</span>).text</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> classes <span class="keyword">or</span> <span class="built_in">int</span>(difficult)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        cls_id = classes.index(cls)</span><br><span class="line">        xmlbox = obj.find(<span class="string">&#x27;bndbox&#x27;</span>)</span><br><span class="line">        b = (<span class="built_in">float</span>(xmlbox.find(<span class="string">&#x27;xmin&#x27;</span>).text), <span class="built_in">float</span>(xmlbox.find(<span class="string">&#x27;xmax&#x27;</span>).text), <span class="built_in">float</span>(xmlbox.find(<span class="string">&#x27;ymin&#x27;</span>).text), <span class="built_in">float</span>(xmlbox.find(<span class="string">&#x27;ymax&#x27;</span>).text))</span><br><span class="line">        bb = convert((w,h), b)</span><br><span class="line">        out_file.write(<span class="built_in">str</span>(cls_id) + <span class="string">&quot; &quot;</span> + <span class="string">&quot; &quot;</span>.join([<span class="built_in">str</span>(a) <span class="keyword">for</span> a <span class="keyword">in</span> bb]) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">wd = getcwd()</span><br><span class="line"><span class="keyword">for</span> year, image_set <span class="keyword">in</span> sets:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;VOC%s/labels/&#x27;</span>%(year)):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;VOC%s/labels/&#x27;</span>%(year))</span><br><span class="line">    image_ids = <span class="built_in">open</span>(<span class="string">&#x27;VOC%s/ImageSets/Main/%s.txt&#x27;</span>%(year, image_set)).read().strip().split()</span><br><span class="line">    list_file = <span class="built_in">open</span>(<span class="string">&#x27;%s_%s.txt&#x27;</span>%(year, image_set), <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> image_id <span class="keyword">in</span> image_ids:</span><br><span class="line">        list_file.write(<span class="string">&#x27;VOC%s/JPEGImages/%s.jpg\n&#x27;</span>%(year, image_id))</span><br><span class="line">        convert_annotation(year, image_id)</span><br><span class="line">    list_file.close()</span><br></pre></td></tr></table></figure>
<p>åˆ°åº•ä¸ºæ­¢ï¼ŒVOCæ ¼å¼æ•°æ®é›†æ„é€ å®Œæ¯•ï¼Œä½†æ˜¯è¿˜éœ€è¦ç»§ç»­æ„é€ ç¬¦åˆdarknetæ ¼å¼çš„æ•°æ®é›†(coco)ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼šå¦‚æœæ‰“ç®—ä½¿ç”¨cocoè¯„ä»·æ ‡å‡†ï¼Œéœ€è¦æ„é€ cocoä¸­jsonæ ¼å¼ï¼Œå¦‚æœè¦æ±‚ä¸é«˜ï¼Œåªéœ€è¦VOCæ ¼å¼å³å¯ï¼Œä½¿ç”¨ä½œè€…å†™çš„mAPè®¡ç®—ç¨‹åºå³å¯ã€‚</p>
<h4 id="3-åˆ›å»º-names-file"><a href="#3-åˆ›å»º-names-file" class="headerlink" title="3. åˆ›å»º*.names file,"></a>3. åˆ›å»º*.names file,</h4><p>å…¶ä¸­ä¿å­˜çš„æ˜¯ä½ çš„æ‰€æœ‰çš„ç±»åˆ«ï¼Œæ¯è¡Œä¸€ä¸ªç±»åˆ«ï¼Œå¦‚data/coco.namesï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">person</span><br></pre></td></tr></table></figure>
<h4 id="4-æ›´æ–°data-coco-data-å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯"><a href="#4-æ›´æ–°data-coco-data-å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯" class="headerlink" title="4. æ›´æ–°data/coco.data,å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯"></a>4. æ›´æ–°data/coco.data,å…¶ä¸­ä¿å­˜çš„æ˜¯å¾ˆå¤šé…ç½®ä¿¡æ¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classes = 1 # æ”¹æˆä½ çš„æ•°æ®é›†çš„ç±»åˆ«ä¸ªæ•°</span><br><span class="line">train = ./data/2007_train.txt # é€šè¿‡voc_label.pyæ–‡ä»¶ç”Ÿæˆçš„txtæ–‡ä»¶</span><br><span class="line">valid = ./data/2007_test.txt # é€šè¿‡voc_label.pyæ–‡ä»¶ç”Ÿæˆçš„txtæ–‡ä»¶</span><br><span class="line">names = data/coco.names # è®°å½•ç±»åˆ«</span><br><span class="line">backup = backup/ # åœ¨æœ¬åº“ä¸­æ²¡æœ‰ç”¨åˆ°</span><br><span class="line">eval = coco # é€‰æ‹©mapè®¡ç®—æ–¹å¼</span><br></pre></td></tr></table></figure>
<h4 id="5-æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯"><a href="#5-æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯" class="headerlink" title="5. æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯"></a>5. æ›´æ–°cfgæ–‡ä»¶ï¼Œä¿®æ”¹ç±»åˆ«ç›¸å…³ä¿¡æ¯</h4><p>æ‰“å¼€cfgæ–‡ä»¶å¤¹ä¸‹çš„yolov3.cfgæ–‡ä»¶ï¼Œå¤§ä½“è€Œè¨€ï¼Œcfgæ–‡ä»¶è®°å½•çš„æ˜¯æ•´ä¸ªç½‘ç»œçš„ç»“æ„ï¼Œæ˜¯æ ¸å¿ƒéƒ¨åˆ†ã€‚</p>
<p>åªéœ€è¦æ›´æ”¹æ¯ä¸ª[yolo]å±‚å‰è¾¹å·ç§¯å±‚çš„filterä¸ªæ•°å³å¯ï¼š</p>
<blockquote>
<p>æ¯ä¸€ä¸ª[region/yolo]å±‚å‰çš„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­çš„ filters=é¢„æµ‹æ¡†çš„ä¸ªæ•°(maskå¯¹åº”çš„ä¸ªæ•°ï¼Œæ¯”å¦‚mask=0,1,2,  ä»£è¡¨ä½¿ç”¨äº†anchorsä¸­çš„å‰ä¸‰å¯¹ï¼Œè¿™é‡Œé¢„æµ‹æ¡†ä¸ªæ•°å°±åº”è¯¥æ˜¯3*(classes+5)  ,5çš„æ„ä¹‰æ˜¯5ä¸ªåæ ‡ï¼ˆè®ºæ–‡ä¸­çš„tx,ty,tw,th,poï¼‰ï¼Œ3çš„æ„ä¹‰å°±æ˜¯ç”¨äº†3ä¸ªanchorã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘æœ‰ä¸‰ä¸ªç±»ï¼Œn = 3, é‚£ä¹ˆfilter  = 3 Ã— (n+5) = 24</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=255 # æ”¹ä¸º 24</span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask = 6,7,8</span><br><span class="line">anchors = 10,13,  16,30,  33,23,  30,61,  62,45,  59,119,  116,90,  156,198,  373,326</span><br><span class="line">classes=80 # æ”¹ä¸º 3</span><br><span class="line">num=9</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .7</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1</span><br></pre></td></tr></table></figure>
<h4 id="6-æ•°æ®é›†æ ¼å¼è¯´æ˜"><a href="#6-æ•°æ®é›†æ ¼å¼è¯´æ˜" class="headerlink" title="6. æ•°æ®é›†æ ¼å¼è¯´æ˜"></a>6. æ•°æ®é›†æ ¼å¼è¯´æ˜</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- yolov3</span><br><span class="line">    - data</span><br><span class="line">      - 2007_train.txt</span><br><span class="line">      - 2007_test.txt</span><br><span class="line">      - coco.names</span><br><span class="line">      - coco.data</span><br><span class="line">      - annotations(json files)</span><br><span class="line">      - images(å°†2007_train.txtä¸­çš„å›¾ç‰‡æ”¾åˆ°train2014æ–‡ä»¶å¤¹ä¸­ï¼ŒteståŒç†)</span><br><span class="line">        - train2014</span><br><span class="line">          - 0001.jpg</span><br><span class="line">          - 0002.jpg</span><br><span class="line">        - val2014</span><br><span class="line">          - 0003.jpg</span><br><span class="line">          - 0004.jpg</span><br><span class="line">      - labelsï¼ˆvoc_labels.pyç”Ÿæˆçš„å†…å®¹éœ€è¦é‡æ–°ç»„ç»‡ä¸€ä¸‹ï¼‰</span><br><span class="line">        - train2014</span><br><span class="line">          - 0001.txt</span><br><span class="line">          - 0002.txt</span><br><span class="line">        - val2014</span><br><span class="line">          - 0003.txt</span><br><span class="line">          - 0004.txt</span><br><span class="line">      - samples(å­˜æ”¾å¾…æµ‹è¯•å›¾ç‰‡)</span><br></pre></td></tr></table></figure>
<p>2007_train.txtå†…å®¹ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/home/dpj/yolov3-master/data/images/val2014/Cow_1192.jpg</span><br><span class="line">/home/dpj/yolov3-master/data/images/val2014/Cow_1196.jpg</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„imageså’Œlabelsæ–‡ä»¶æ¶æ„ä¸€è‡´æ€§ï¼Œå› ä¸ºtxtæ˜¯é€šè¿‡ç®€å•çš„æ›¿æ¢å¾—åˆ°çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">images -&gt; labels</span><br><span class="line">.jpg -&gt; .txt</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å†…å®¹å¯ä»¥åœ¨datasets.pyæ–‡ä»¶ä¸­æ‰¾åˆ°è¯¦ç»†çš„æ›¿æ¢ã€‚</p>
<h3 id="3-è®­ç»ƒæ¨¡å‹"><a href="#3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="3. è®­ç»ƒæ¨¡å‹"></a>3. è®­ç»ƒæ¨¡å‹</h3><p>é¢„è®­ç»ƒæ¨¡å‹ï¼š</p>
<ul>
<li><p>Darknet <code>*.weights</code> format: <a href="https://pjreddie.com/media/files/yolov3.weights">https://pjreddie.com/media/files/yolov3.weights</a></p>
</li>
<li><p>PyTorch <code>*.pt</code> format: </p>
<p><a href="https://drive.google.com/open?id=1LezFG5g3BCW6iYaV89B2i64cqEUZD7e0">https://drive.google.com/open?id=1LezFG5g3BCW6iYaV89B2i64cqEUZD7e0</a></p>
</li>
</ul>
<p>å¼€å§‹è®­ç»ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python train.py --data data/coco.data --cfg cfg/yolov3.cfg</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ—¥å¿—æ­£å¸¸è¾“å‡ºé‚£è¯æ˜å¯ä»¥è¿è¡Œäº†</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/640.webp" alt></p>
<p>å¦‚æœä¸­æ–­äº†ï¼Œå¯ä»¥æ¢å¤è®­ç»ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python train.py --data data/coco.data --cfg cfg/yolov3.cfg --resume</span><br></pre></td></tr></table></figure>
<h3 id="4-æµ‹è¯•æ¨¡å‹"><a href="#4-æµ‹è¯•æ¨¡å‹" class="headerlink" title="4. æµ‹è¯•æ¨¡å‹"></a>4. æµ‹è¯•æ¨¡å‹</h3><p>å°†å¾…æµ‹è¯•å›¾ç‰‡æ”¾åˆ°data/samplesä¸­ï¼Œç„¶åè¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python detect.py --cfg cfg/yolov3.cfg --weights weights/best.pt</span><br></pre></td></tr></table></figure>
<p>ç›®å‰è¯¥æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥æ”¾å…¥è§†é¢‘è¿›è¡Œè§†é¢‘ç›®æ ‡æ£€æµ‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/641.webp" alt></p>
<ul>
<li>Image: <code>--source file.jpg</code></li>
<li>Video: <code>--source file.mp4</code></li>
<li>Directory: <code>--source dir/</code></li>
<li>Webcam: <code>--source 0</code></li>
<li>RTSP stream: <code>--source rtsp://170.93.143.139/rtplive/470011e600ef003a004ee33696235daa</code></li>
<li>HTTP stream: <code>--source http://wmccpinetop.axiscam.net/mjpg/video.mjpg</code></li>
</ul>
<h3 id="5-è¯„ä¼°æ¨¡å‹"><a href="#5-è¯„ä¼°æ¨¡å‹" class="headerlink" title="5. è¯„ä¼°æ¨¡å‹"></a>5. è¯„ä¼°æ¨¡å‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python test.py --weights weights/best.pt</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨cocoAPIä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ python3 test.py --img-size 608 --iou-thr 0.6 --weights ultralytics68.pt --cfg yolov3-spp.cfg</span><br><span class="line"></span><br><span class="line">Namespace(batch_size=32, cfg=&#x27;yolov3-spp.cfg&#x27;, conf_thres=0.001, data=&#x27;data/coco2014.data&#x27;, device=&#x27;&#x27;, img_size=608, iou_thres=0.6, save_json=True, task=&#x27;test&#x27;, weights=&#x27;ultralytics68.pt&#x27;)</span><br><span class="line">Using CUDA device0 _CudaDeviceProperties(name=&#x27;Tesla V100-SXM2-16GB&#x27;, total_memory=16130MB)</span><br><span class="line">               Class    Images   Targets         P         R   mAP@0.5        F1: 100% 157/157 [03:30&lt;00:00,  1.16it/s]</span><br><span class="line">                 all     5e+03  3.51e+04    0.0353     0.891     0.606    0.0673</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.409</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.615</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.437</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.242</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.448</span><br><span class="line"> Average Precision  (AP) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.519</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=  1 ] = 0.337</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets= 10 ] = 0.557</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.612</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.438</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.658</span><br><span class="line"> Average Recall     (AR) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.746</span><br></pre></td></tr></table></figure>
<p><strong>mAPè®¡ç®—</strong></p>
<ul>
<li>mAP@0.5 run at <code>--iou-thr 0.5</code>, mAP@0.5â€¦0.95 run at <code>--iou-thr 0.7</code></li>
</ul>
<h3 id="6-å¯è§†åŒ–"><a href="#6-å¯è§†åŒ–" class="headerlink" title="6. å¯è§†åŒ–"></a>6. å¯è§†åŒ–</h3><p>å¯ä»¥ä½¿ç”¨<code>python -c from utils import utils;utils.plot_results()</code></p>
<p>åˆ›å»ºdrawLog.py</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def plot_results():</span><br><span class="line">    # Plot YOLO training results file &#x27;results.txt&#x27;</span><br><span class="line">    import glob</span><br><span class="line">    import numpy as np</span><br><span class="line">    import matplotlib.pyplot as plt</span><br><span class="line">    #import os; os.system(&#x27;rm -rf results.txt &amp;&amp; wget https://storage.googleapis.com/ultralytics/results_v1_0.txt&#x27;)</span><br><span class="line"></span><br><span class="line">    plt.figure(figsize=(16, 8))</span><br><span class="line">    s = [&#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Width&#x27;, &#x27;Height&#x27;, &#x27;Objectness&#x27;, &#x27;Classification&#x27;, &#x27;Total Loss&#x27;, &#x27;Precision&#x27;, &#x27;Recall&#x27;, &#x27;mAP&#x27;]</span><br><span class="line">    files = sorted(glob.glob(&#x27;results.txt&#x27;))</span><br><span class="line">    for f in files:</span><br><span class="line">        results = np.loadtxt(f, usecols=[2, 3, 4, 5, 6, 7, 8, 17, 18, 16]).T  # column 16 is mAP</span><br><span class="line">        n = results.shape[1]</span><br><span class="line">        for i in range(10):</span><br><span class="line">            plt.subplot(2, 5, i + 1)</span><br><span class="line">            plt.plot(range(1, n), results[i, 1:], marker=&#x27;.&#x27;, label=f)</span><br><span class="line">            plt.title(s[i])</span><br><span class="line">            if i == 0:</span><br><span class="line">                plt.legend()</span><br><span class="line">    plt.savefig(&#x27;./plot.png&#x27;)</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    plot_results()</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/pyyolov3/642.webp" alt></p>
<p><strong>7. æ•°æ®é›†é…å¥—ä»£ç </strong></p>
<p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œäº†ï¼Œæ­å–œä½ ï¼Œä½ å¯ä»¥é¿å¼€ä»¥ä¸Šç•¥æ˜¾å¤æ‚çš„æ•°æ®å¤„ç†ã€‚è¿™é‡Œæä¾›äº†ä¸€å¥—ä»£ç ï¼Œé›†æˆäº†ä»¥ä¸Šè„šæœ¬ï¼Œåªéœ€è¦ä½ æœ‰jpgå›¾ç‰‡å’Œå¯¹åº”çš„xmlæ–‡ä»¶ï¼Œå°±å¯ä»¥ç›´æ¥ç”Ÿæˆç¬¦åˆè¦æ±‚çš„æ•°æ®é›†ï¼Œç„¶åæŒ‰ç…§è¦æ±‚ä¿®æ”¹ä¸€äº›ä»£ç å³å¯ã€‚</p>
<p>ä»£ç åœ°å€ï¼š<a href="https://github.com/pprp/voc2007_for_yolo_torch">https://github.com/pprp/voc2007_for_yolo_torch</a></p>
<p>è¯·æŒ‰ç…§readmeä¸­è¿›è¡Œå¤„ç†å°±å¯ä»¥å¾—åˆ°æ•°æ®é›†ã€‚</p>
<blockquote>
<p>åè®°ï¼šè¿™å¥—ä»£ç ä¸€ç›´ç”±ä¸€ä¸ªå¤–å›½çš„å›¢é˜Ÿè¿›è¡Œç»´æŠ¤ï¼Œä¹Ÿæ·»åŠ äº†å¾ˆå¤šæ–°çš„trickã€‚ç›®å‰å·²è·å¾—äº†3.3kä¸ªstarï¼Œ1k  forkã€‚ä¸ä»…å¦‚æ­¤ï¼Œå…¶å›¢é˜Ÿä¼šç»å¸¸å›å¤issueï¼Œç›®å‰ä¹Ÿæœ‰æ¥è¿‘1kçš„issueã€‚åªè¦å¤„ç†è¿‡ä¸€éæ•°æ®ï¼Œå°±ä¼šäº†è§£åˆ°è¿™ä¸ªåº“çš„äº®ç‚¹ï¼Œéå¸¸å®¹æ˜“é…ç½®ï¼Œä¸éœ€è¦è¿›è¡Œç¼–è¯‘ç­‰æ“ä½œï¼Œæ˜“ç”¨æ€§æå¼ºã€‚å†åŠ ä¸Šæä¾›çš„é…å¥—æ•°æ®å¤„ç†ä»£ç ï¼Œåœ¨çŸ­çŸ­10å¤šåˆ†é’Ÿå°±å¯ä»¥é…ç½®å¥½ã€‚(âœªÏ‰âœª)</p>
</blockquote>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOV3æŸå¤±å‡½æ•°ä»£ç è¯¦è§£(yolo_layer.c)</title>
    <url>/2020/02/28/YOLOV3%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3(yolo_layer.c)/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>YOLOV3çš„æŸå¤±å‡½æ•°åœ¨YOLOV2çš„åŸºç¡€ä¸Šï¼Œç”¨å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘å›å½’æŸå¤±ä»£æ›¿äº†YOLOV2é‡Œé¢çš„softmaxæŸå¤±ï¼Œç„¶åå»æ‰äº†å¯¹Anchoråœ¨å‰12800æ¬¡è®­ç»ƒè½®æ¬¡ä¸­çš„å›å½’æŸå¤±ï¼Œä¹Ÿå³æ˜¯YOLOV2æŸå¤±å‡½æ•°çš„ç¬¬äºŒé¡¹ã€‚å¦å¤–æ–°å¢äº†ä¸€ä¸ªignore_threshå‚æ•°æ¥å¿½ç•¥ä¸€äº›å’ŒGT boxçš„IOUå¤§äºignore_threshçš„é¢„æµ‹æ¡†çš„objectnessæŸå¤±ã€‚é™¤äº†ä»¥ä¸Šç»†èŠ‚ï¼Œå…¶å®ƒéƒ¨åˆ†å’ŒYOLOV2çš„å¤„ç†ç±»ä¼¼ã€‚</p>
<h2 id="AlexeyABçš„ä¸€äº›æ›´æ–°"><a href="#AlexeyABçš„ä¸€äº›æ›´æ–°" class="headerlink" title="AlexeyABçš„ä¸€äº›æ›´æ–°"></a>AlexeyABçš„ä¸€äº›æ›´æ–°</h2><p>é™¤äº†ä¸Šé¢æåˆ°çš„ç›¸å¯¹äºYOLOV2ä¸€äº›åŸºç¡€æ”¹åŠ¨ï¼ŒAlexeyABå¤§ç¥åœ¨ç›®æ ‡æ¡†å›å½’è¿‡ç¨‹ä¸­æ–°å¢äº†IOU/GIOU/DIOU/CIOU Lossï¼Œå¹¶ä¸”åœ¨åˆ†ç±»è¿‡ç¨‹ä¸­æ–°å¢äº†Focal Lossï¼Œæ–¹ä¾¿å¤§å®¶åœ¨è‡ªå·±çš„æ•°æ®é›†ä¸Šè¿›è¡Œè¯•éªŒï¼Œé¢„ç¥æ¶¨ç‚¹ã€‚</p>
<h2 id="ä»£ç è§£ææ­¥éª¤"><a href="#ä»£ç è§£ææ­¥éª¤" class="headerlink" title="ä»£ç è§£ææ­¥éª¤"></a>ä»£ç è§£ææ­¥éª¤</h2><h3 id="yolo-å±‚"><a href="#yolo-å±‚" class="headerlink" title="[yolo]å±‚"></a>[yolo]å±‚</h3><p>YOLOV3ä½¿ç”¨[yolo] å±‚æ¥è®¡ç®—æŸå¤±å‡½æ•°ä»¥åŠé¢„æµ‹åˆ†ç±»å’Œè¾¹ç•Œæ¡†å›å½’ï¼Œå‰é¢ç»è¿‡ darknet-53 çš„åŸºç¡€ç½‘ç»œæå–ç‰¹å¾ï¼Œåˆç»è¿‡ä¸€äº›ç‰¹å¾èåˆï¼Œå°±å¾—åˆ°äº†3ä¸ªä¸åŒå°ºåº¦çš„ yolo å±‚ï¼Œåˆ†åˆ«é¢„æµ‹å¤§ã€ä¸­ã€å°ç‰©ä½“ã€‚ä¸»è¦ä»£ç åœ¨<code>/src/yolo_layer.c</code>ã€‚cfgæ–‡ä»¶çš„é…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[yolo]</span><br><span class="line">mask = 0,1,2  #è¯¥å±‚é¢„æµ‹å“ªä¸ªè§„æ¨¡çš„æ¡†ï¼Œ0,1,2è¡¨ç¤ºé¢„æµ‹å°ç‰©ä½“</span><br><span class="line">anchors = 10,13,  16,30,  33,23,  30,61,  62,45,  59,119,  116,90,  156,198,  373,326 </span><br><span class="line">classes=80</span><br><span class="line">num=9</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .7</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1</span><br></pre></td></tr></table></figure></p>
<h3 id="make-yolo-layer-å®Œæˆ-yolo-å±‚åˆå§‹åŒ–æ“ä½œ"><a href="#make-yolo-layer-å®Œæˆ-yolo-å±‚åˆå§‹åŒ–æ“ä½œ" class="headerlink" title="make_yolo_layer å®Œæˆ yolo å±‚åˆå§‹åŒ–æ“ä½œ"></a>make_yolo_layer å®Œæˆ yolo å±‚åˆå§‹åŒ–æ“ä½œ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ„é€ YOLOV3çš„yoloå±‚</span></span><br><span class="line"><span class="comment">// batch ä¸€ä¸ªbatchä¸­åŒ…å«å›¾ç‰‡çš„å¼ æ•°</span></span><br><span class="line"><span class="comment">// w è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line"><span class="comment">// h è¾“å…¥å›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">// n ä¸€ä¸ªcellé¢„æµ‹å¤šå°‘ä¸ªbbox</span></span><br><span class="line"><span class="comment">// total total Anchor bboxçš„æ•°ç›®</span></span><br><span class="line"><span class="comment">// mask ä½¿ç”¨çš„æ˜¯0,1,2 è¿˜æ˜¯</span></span><br><span class="line"><span class="comment">// classes ç½‘ç»œéœ€è¦è¯†åˆ«çš„ç‰©ä½“ç±»åˆ«æ•°</span></span><br><span class="line"><span class="function">layer <span class="title">make_yolo_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> n, <span class="keyword">int</span> total, <span class="keyword">int</span> *mask, <span class="keyword">int</span> classes, <span class="keyword">int</span> max_boxes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    l.type = YOLO; <span class="comment">//å±‚ç±»åˆ«</span></span><br><span class="line"></span><br><span class="line">    l.n = n; <span class="comment">//ä¸€ä¸ªcellé¢„æµ‹å¤šå°‘ä¸ªbbox</span></span><br><span class="line">    l.total = total; <span class="comment">//anchorsçš„æ•°ç›®ï¼Œä¸º9</span></span><br><span class="line">    l.batch = batch;<span class="comment">// ä¸€ä¸ªbatchåŒ…å«å›¾ç‰‡çš„å¼ æ•°</span></span><br><span class="line">    l.h = h; <span class="comment">// è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">    l.w = w; <span class="comment">// è¾“å…¥å›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line">    l.c = n*(classes + <span class="number">4</span> + <span class="number">1</span>); <span class="comment">// è¾“å…¥å›¾ç‰‡çš„é€šé“æ•°, 3*(20 + 5)</span></span><br><span class="line">    l.out_w = l.w;<span class="comment">// è¾“å‡ºå›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">    l.out_h = l.h;<span class="comment">// è¾“å‡ºå›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line">    l.out_c = l.c;<span class="comment">// è¾“å‡ºå›¾ç‰‡çš„é€šé“æ•°</span></span><br><span class="line">    l.classes = classes;<span class="comment">//ç›®æ ‡ç±»åˆ«æ•°</span></span><br><span class="line">    l.cost = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//yoloå±‚æ€»çš„æŸå¤±</span></span><br><span class="line">    l.biases = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(total * <span class="number">2</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//å­˜å‚¨bboxçš„Anchor boxçš„[w,h]</span></span><br><span class="line">    <span class="keyword">if</span>(mask) l.mask = mask; <span class="comment">//yolov3æœ‰maskä¼ å…¥</span></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        l.mask = (<span class="keyword">int</span>*)<span class="built_in">xcalloc</span>(n, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">            l.mask[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//å­˜å‚¨bboxçš„Anchor boxçš„[w,h]çš„æ›´æ–°å€¼</span></span><br><span class="line">    l.bias_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(n * <span class="number">2</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">// ä¸€å¼ è®­ç»ƒå›¾ç‰‡ç»è¿‡yoloå±‚åå¾—åˆ°çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼ˆç­‰äºç½‘æ ¼æ•°*æ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„çŸ©å½¢æ¡†æ•°*æ¯ä¸ªçŸ©å½¢æ¡†çš„å‚æ•°ä¸ªæ•°ï¼‰</span></span><br><span class="line">    l.outputs = h*w*n*(classes + <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//ä¸€å¼ è®­ç»ƒå›¾ç‰‡è¾“å…¥åˆ°yoloå±‚çš„å…ƒç´ ä¸ªæ•°ï¼ˆæ³¨æ„æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå¯¹äºyolo_layerï¼Œè¾“å…¥å’Œè¾“å‡ºçš„å…ƒç´ ä¸ªæ•°ç›¸ç­‰ï¼‰</span></span><br><span class="line">    l.inputs = l.outputs;</span><br><span class="line">	<span class="comment">//æ¯å¼ å›¾ç‰‡å«æœ‰çš„çœŸå®çŸ©å½¢æ¡†å‚æ•°çš„ä¸ªæ•°ï¼ˆmax_boxesè¡¨ç¤ºä¸€å¼ å›¾ç‰‡ä¸­æœ€å¤šæœ‰max_boxesä¸ªground truthçŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçœŸå®çŸ©å½¢æ¡†æœ‰</span></span><br><span class="line">    <span class="comment">//5ä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬x,y,w,hå››ä¸ªå®šä½å‚æ•°ï¼Œä»¥åŠç‰©ä½“ç±»åˆ«ï¼‰,æ³¨æ„max_boxesæ˜¯darknetç¨‹åºå†…å†™æ­»çš„ï¼Œå®é™…ä¸Šæ¯å¼ å›¾ç‰‡å¯èƒ½</span></span><br><span class="line">    <span class="comment">//å¹¶æ²¡æœ‰max_boxesä¸ªçœŸå®çŸ©å½¢æ¡†ï¼Œä¹Ÿèƒ½æ²¡æœ‰è¿™ä¹ˆå¤šå‚æ•°ï¼Œä½†ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œè¿˜æ˜¯ä¼šç•™ç€è¿™ä¹ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œåªæ˜¯å…¶ä¸­çš„</span></span><br><span class="line">    <span class="comment">//å€¼ä¸ºç©ºè€Œå·².</span></span><br><span class="line">    l.max_boxes = max_boxes;</span><br><span class="line">	<span class="comment">// GT: max_boxes*(4+1) å­˜å‚¨max_boxesä¸ªbboxçš„ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯å‡è®¾å›¾ç‰‡ä¸­GT bboxçš„æ•°é‡æ˜¯</span></span><br><span class="line">	<span class="comment">//å°äºmax_boxesçš„ï¼Œè¿™é‡Œæ˜¯å†™æ­»çš„ï¼›æ­¤å¤„ä¸yolov1æ˜¯ä¸åŒçš„</span></span><br><span class="line">    l.truths = l.max_boxes*(<span class="number">4</span> + <span class="number">1</span>);    <span class="comment">// 90*(4 + 1);</span></span><br><span class="line">	<span class="comment">// yoloå±‚è¯¯å·®é¡¹(åŒ…å«æ•´ä¸ªbatchçš„)</span></span><br><span class="line">    l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">//yoloå±‚æ‰€æœ‰è¾“å‡ºï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line">    <span class="comment">//yoloçš„è¾“å‡ºç»´åº¦æ˜¯l.out_w*l.out_hï¼Œç­‰äºè¾“å‡ºçš„ç»´åº¦ï¼Œè¾“å‡ºçš„é€šé“æ•°ä¸ºl.out_cï¼Œä¹Ÿå³æ˜¯è¾“å…¥çš„é€šé“æ•°ï¼Œå…·ä½“ä¸ºï¼šn*(classes+coords+1)</span></span><br><span class="line">	<span class="comment">//YOLOæ£€æµ‹æ¨¡å‹å°†å›¾ç‰‡åˆ†æˆS*Sä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼åˆé¢„æµ‹Bä¸ªçŸ©å½¢æ¡†ï¼Œæœ€åè¾“å‡ºçš„å°±æ˜¯è¿™äº›ç½‘æ ¼ä¸­åŒ…å«çš„æ‰€æœ‰çŸ©å½¢æ¡†çš„ä¿¡æ¯</span></span><br><span class="line">    l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">// å­˜å‚¨bboxçš„Anchor boxçš„[w,h]çš„åˆå§‹åŒ–,åœ¨src/parse.cä¸­parse_yoloå‡½æ•°ä¼šåŠ è½½cfgä¸­Anchorå°ºå¯¸</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; total*<span class="number">2</span>; ++i)&#123;</span><br><span class="line">        l.biases[i] = <span class="number">.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// yoloå±‚çš„å‰å‘ä¼ æ’­</span></span><br><span class="line">    l.forward = forward_yolo_layer;</span><br><span class="line">	<span class="comment">// yoloå±‚çš„åå‘ä¼ æ’­</span></span><br><span class="line">    l.backward = backward_yolo_layer;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    l.forward_gpu = forward_yolo_layer_gpu;</span><br><span class="line">    l.backward_gpu = backward_yolo_layer_gpu;</span><br><span class="line">    l.output_gpu = <span class="built_in">cuda_make_array</span>(l.output, batch*l.outputs);</span><br><span class="line">    l.delta_gpu = <span class="built_in">cuda_make_array</span>(l.delta, batch*l.outputs);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(l.output);</span><br><span class="line">    <span class="keyword">if</span> (cudaSuccess == <span class="built_in">cudaHostAlloc</span>(&amp;l.output, batch*l.outputs*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>), cudaHostRegisterMapped)) l.output_pinned = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">cudaGetLastError</span>(); <span class="comment">// reset CUDA-error</span></span><br><span class="line">        l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(l.delta);</span><br><span class="line">    <span class="keyword">if</span> (cudaSuccess == <span class="built_in">cudaHostAlloc</span>(&amp;l.delta, batch*l.outputs*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>), cudaHostRegisterMapped)) l.delta_pinned = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">cudaGetLastError</span>(); <span class="comment">// reset CUDA-error</span></span><br><span class="line">        l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;yolo\n&quot;</span>);</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="get-yolo-box-è·å¾—é¢„æµ‹çš„è¾¹ç•Œæ¡†"><a href="#get-yolo-box-è·å¾—é¢„æµ‹çš„è¾¹ç•Œæ¡†" class="headerlink" title="get_yolo_box è·å¾—é¢„æµ‹çš„è¾¹ç•Œæ¡†"></a>get_yolo_box è·å¾—é¢„æµ‹çš„è¾¹ç•Œæ¡†</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–æŸä¸ªçŸ©å½¢æ¡†çš„4ä¸ªå®šä½ä¿¡æ¯ï¼Œå³æ ¹æ®è¾“å…¥çš„çŸ©å½¢æ¡†ç´¢å¼•ä»l.outputä¸­è·å–è¯¥çŸ©å½¢æ¡†çš„å®šä½ä¿¡æ¯x,y,w,h</span></span><br><span class="line"><span class="comment">//x  yolo_layerçš„è¾“å‡ºï¼Œå³l.outputï¼ŒåŒ…å«æ‰€æœ‰batché¢„æµ‹å¾—åˆ°çš„çŸ©å½¢æ¡†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//biases è¡¨ç¤ºAnchoræ¡†çš„é•¿å’Œå®½</span></span><br><span class="line"><span class="comment">//index çŸ©å½¢æ¡†çš„é¦–åœ°å€ï¼ˆç´¢å¼•ï¼ŒçŸ©å½¢æ¡†ä¸­å­˜å‚¨çš„é¦–ä¸ªå‚æ•°xåœ¨l.outputä¸­çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="comment">//i ç¬¬å‡ è¡Œï¼ˆyolo_layerç»´åº¦ä¸ºl.out_w*l.out_cï¼‰</span></span><br><span class="line"><span class="comment">//j ç¬¬å‡ åˆ—</span></span><br><span class="line"><span class="comment">//lw ç‰¹å¾å›¾çš„å®½åº¦</span></span><br><span class="line"><span class="comment">//lh ç‰¹å¾å›¾çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">//w è¾“å…¥å›¾åƒçš„å®½åº¦</span></span><br><span class="line"><span class="comment">//h è¾“å…¥å›¾åƒçš„é«˜åº¦</span></span><br><span class="line"><span class="comment">//stride ä¸åŒçš„ç‰¹å¾å›¾å…·æœ‰ä¸åŒçš„æ­¥é•¿(å³æ˜¯ä¸¤ä¸ªgrid cellä¹‹é—´è·¨çš„åƒç´ ä¸ªæ•°ä¸åŒ)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//biasesä¸­å­˜å‚¨çš„æ˜¯é¢„å®šä»¥çš„anchor boxçš„å®½å’Œé«˜ï¼ˆè¾“å…¥å›¾å°ºåº¦ï¼‰ï¼Œ(lw,lh)æ˜¯yoloå±‚è¾“å…¥çš„ç‰¹å¾å›¾å°ºåº¦ï¼Œ</span></span><br><span class="line"><span class="comment">//(w,h)æ˜¯æ•´ä¸ªç½‘ç»œè¾“å…¥å›¾å°ºåº¦ï¼Œget_yolo_box()å‡½æ•°åˆ©ç”¨äº†è®ºæ–‡æˆªå›¾ä¸­çš„å…¬å¼ï¼Œè€Œä¸”æŠŠç»“æœåˆ†åˆ«åˆ©ç”¨ç‰¹å¾</span></span><br><span class="line"><span class="comment">//å›¾å®½é«˜å’Œè¾“å…¥å›¾å®½é«˜åšäº†å½’ä¸€åŒ–ã€‚æ—¢ç„¶è¿™ä¸ªæœºåˆ¶æ˜¯ç”¨æ¥é™åˆ¶å›å½’ï¼Œé¿å…é¢„æµ‹å¾ˆè¿œçš„ç›®æ ‡ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢„æµ‹</span></span><br><span class="line"><span class="comment">//èŒƒå›´æ˜¯å¤šå¤§å‘¢ï¼Ÿ(b.x,by)æœ€å°æ˜¯(i,j),æœ€å¤§æ˜¯(i+1,x+1)ï¼Œå³ä¸­å¿ƒç‚¹åœ¨ç‰¹å¾å›¾ä¸Šæœ€å¤šä¸€å®šä¸€ä¸ªåƒç´ ï¼ˆå‡è®¾</span></span><br><span class="line"><span class="comment">//è¾“å…¥å›¾ä¸‹é‡‡æ ·nå¾—åˆ°ç‰¹å¾å›¾ï¼Œç‰¹å¾å›¾ä¸­ä¸€ä¸ªåƒç´ å¯¹åº”è¾“å…¥å›¾çš„nä¸ªåƒç´ ï¼‰(b.w,b.h)æœ€å¤§æ˜¯(2.7 * anchor.w,</span></span><br><span class="line"><span class="comment">//2.7 * anchor.h),æœ€å°å°±æ˜¯(anchor.w,anchor.h)ï¼Œè¿™æ˜¯åœ¨è¾“å…¥å›¾å°ºå¯¸ä¸‹çš„å€¼ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function">box <span class="title">get_yolo_box</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *biases, <span class="keyword">int</span> n, <span class="keyword">int</span> index, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> lw, <span class="keyword">int</span> lh, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> stride)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    box b;</span><br><span class="line">    <span class="comment">// ln - natural logarithm (base = e)</span></span><br><span class="line">    <span class="comment">// x` = t.x * lw - i;   // x = ln(x`/(1-x`))   // x - output of previous conv-layer</span></span><br><span class="line">    <span class="comment">// y` = t.y * lh - i;   // y = ln(y`/(1-y`))   // y - output of previous conv-layer</span></span><br><span class="line">                            <span class="comment">// w = ln(t.w * net.w / anchors_w); // w - output of previous conv-layer</span></span><br><span class="line">                            <span class="comment">// h = ln(t.h * net.h / anchors_h); // h - output of previous conv-layer</span></span><br><span class="line">    b.x = (i + x[index + <span class="number">0</span>*stride]) / lw;</span><br><span class="line">    b.y = (j + x[index + <span class="number">1</span>*stride]) / lh;</span><br><span class="line">    b.w = <span class="built_in">exp</span>(x[index + <span class="number">2</span>*stride]) * biases[<span class="number">2</span>*n]   / w;</span><br><span class="line">    b.h = <span class="built_in">exp</span>(x[index + <span class="number">3</span>*stride]) * biases[<span class="number">2</span>*n+<span class="number">1</span>] / h;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="delta-yolo-box-è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†çš„è¯¯å·®"><a href="#delta-yolo-box-è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†çš„è¯¯å·®" class="headerlink" title="delta_yolo_box è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†çš„è¯¯å·®"></a>delta_yolo_box è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†çš„è¯¯å·®</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨æ–¹å¼ï¼šdelta_yolo_box(truth, l.output, l.biases, l.mask[n], box_index, i, j, l.w, l.h, state.net.w, state.net.h, l.delta, (2 - truth.w*truth.h), l.w*l.h, l.iou_normalizer * class_multiplier, l.iou_loss, 1, l.max_delta);</span></span><br><span class="line"><span class="comment">// è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†çš„è¯¯å·®</span></span><br><span class="line"><span class="function">ious <span class="title">delta_yolo_box</span><span class="params">(box truth, <span class="keyword">float</span> *x, <span class="keyword">float</span> *biases, <span class="keyword">int</span> n, <span class="keyword">int</span> index, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> lw, <span class="keyword">int</span> lh, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">float</span> *delta, <span class="keyword">float</span> scale, <span class="keyword">int</span> stride, <span class="keyword">float</span> iou_normalizer, IOU_LOSS iou_loss, <span class="keyword">int</span> accumulate, <span class="keyword">int</span> max_delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ious all_ious = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="comment">// i - step in layer width</span></span><br><span class="line">    <span class="comment">// j - step in layer height</span></span><br><span class="line">    <span class="comment">//  Returns a box in absolute coordinates</span></span><br><span class="line">	<span class="comment">// è·å¾—ç¬¬j*w+iä¸ªcellçš„ç¬¬nä¸ªbboxåœ¨å½“å‰ç‰¹å¾å›¾çš„[x,y,w,h]</span></span><br><span class="line">    box pred = <span class="built_in">get_yolo_box</span>(x, biases, n, index, i, j, lw, lh, w, h, stride);</span><br><span class="line">	<span class="comment">//iou</span></span><br><span class="line">    all_ious.iou = <span class="built_in">box_iou</span>(pred, truth);</span><br><span class="line">	<span class="comment">//giou</span></span><br><span class="line">    all_ious.giou = <span class="built_in">box_giou</span>(pred, truth);</span><br><span class="line">	<span class="comment">//diou</span></span><br><span class="line">    all_ious.diou = <span class="built_in">box_diou</span>(pred, truth);</span><br><span class="line">	<span class="comment">//ciou</span></span><br><span class="line">    all_ious.ciou = <span class="built_in">box_ciou</span>(pred, truth);</span><br><span class="line">    <span class="comment">// avoid nan in dx_box_iou</span></span><br><span class="line">	</span><br><span class="line">    <span class="keyword">if</span> (pred.w == <span class="number">0</span>) &#123; pred.w = <span class="number">1.0</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span> (pred.h == <span class="number">0</span>) &#123; pred.h = <span class="number">1.0</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span> (iou_loss == MSE)    <span class="comment">// old loss</span></span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">// è®¡ç®—GT bboxçš„tx, ty, tw, th</span></span><br><span class="line">        <span class="keyword">float</span> tx = (truth.x*lw - i); <span class="comment">//å’Œé¢„æµ‹å€¼åŒ¹é…</span></span><br><span class="line">        <span class="keyword">float</span> ty = (truth.y*lh - j);</span><br><span class="line">        <span class="keyword">float</span> tw = <span class="built_in">log</span>(truth.w*w / biases[<span class="number">2</span> * n]); <span class="comment">//log ä½¿å¤§æ¡†å’Œå°æ¡†çš„è¯¯å·®å½±å“æ¥è¿‘</span></span><br><span class="line">        <span class="keyword">float</span> th = <span class="built_in">log</span>(truth.h*h / biases[<span class="number">2</span> * n + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// accumulate delta</span></span><br><span class="line">		<span class="comment">//è®¡ç®—tx, ty, tw, thçš„æ¢¯åº¦</span></span><br><span class="line">        delta[index + <span class="number">0</span> * stride] += scale * (tx - x[index + <span class="number">0</span> * stride]) * iou_normalizer;  <span class="comment">//è®¡ç®—è¯¯å·® deltaï¼Œä¹˜äº†æƒé‡ç³»æ•° scale=(2-truth.w*truth.h)</span></span><br><span class="line">        delta[index + <span class="number">1</span> * stride] += scale * (ty - x[index + <span class="number">1</span> * stride]) * iou_normalizer;</span><br><span class="line">        delta[index + <span class="number">2</span> * stride] += scale * (tw - x[index + <span class="number">2</span> * stride]) * iou_normalizer;</span><br><span class="line">        delta[index + <span class="number">3</span> * stride] += scale * (th - x[index + <span class="number">3</span> * stride]) * iou_normalizer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// https://github.com/generalized-iou/g-darknet</span></span><br><span class="line">        <span class="comment">// https://arxiv.org/abs/1902.09630v2</span></span><br><span class="line">        <span class="comment">// https://giou.stanford.edu/</span></span><br><span class="line">        all_ious.dx_iou = <span class="built_in">dx_box_iou</span>(pred, truth, iou_loss);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// jacobian^t (transpose)</span></span><br><span class="line">        <span class="comment">//float dx = (all_ious.dx_iou.dl + all_ious.dx_iou.dr);</span></span><br><span class="line">        <span class="comment">//float dy = (all_ious.dx_iou.dt + all_ious.dx_iou.db);</span></span><br><span class="line">        <span class="comment">//float dw = ((-0.5 * all_ious.dx_iou.dl) + (0.5 * all_ious.dx_iou.dr));</span></span><br><span class="line">        <span class="comment">//float dh = ((-0.5 * all_ious.dx_iou.dt) + (0.5 * all_ious.dx_iou.db));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// jacobian^t (transpose)</span></span><br><span class="line">        <span class="keyword">float</span> dx = all_ious.dx_iou.dt;</span><br><span class="line">        <span class="keyword">float</span> dy = all_ious.dx_iou.db;</span><br><span class="line">        <span class="keyword">float</span> dw = all_ious.dx_iou.dl;</span><br><span class="line">        <span class="keyword">float</span> dh = all_ious.dx_iou.dr;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// predict exponential, apply gradient of e^delta_t ONLY for w,h</span></span><br><span class="line">        dw *= <span class="built_in">exp</span>(x[index + <span class="number">2</span> * stride]);</span><br><span class="line">        dh *= <span class="built_in">exp</span>(x[index + <span class="number">3</span> * stride]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// normalize iou weight</span></span><br><span class="line">        dx *= iou_normalizer;</span><br><span class="line">        dy *= iou_normalizer;</span><br><span class="line">        dw *= iou_normalizer;</span><br><span class="line">        dh *= iou_normalizer;</span><br><span class="line"></span><br><span class="line">        dx = <span class="built_in">fix_nan_inf</span>(dx);</span><br><span class="line">        dy = <span class="built_in">fix_nan_inf</span>(dy);</span><br><span class="line">        dw = <span class="built_in">fix_nan_inf</span>(dw);</span><br><span class="line">        dh = <span class="built_in">fix_nan_inf</span>(dh);</span><br><span class="line"></span><br><span class="line">        dx = <span class="built_in">clip_value</span>(dx, max_delta);</span><br><span class="line">        dy = <span class="built_in">clip_value</span>(dy, max_delta);</span><br><span class="line">        dw = <span class="built_in">clip_value</span>(dw, max_delta);</span><br><span class="line">        dh = <span class="built_in">clip_value</span>(dh, max_delta);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!accumulate) &#123;</span><br><span class="line">            delta[index + <span class="number">0</span> * stride] = <span class="number">0</span>;</span><br><span class="line">            delta[index + <span class="number">1</span> * stride] = <span class="number">0</span>;</span><br><span class="line">            delta[index + <span class="number">2</span> * stride] = <span class="number">0</span>;</span><br><span class="line">            delta[index + <span class="number">3</span> * stride] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// accumulate delta</span></span><br><span class="line">        delta[index + <span class="number">0</span> * stride] += dx;</span><br><span class="line">        delta[index + <span class="number">1</span> * stride] += dy;</span><br><span class="line">        delta[index + <span class="number">2</span> * stride] += dw;</span><br><span class="line">        delta[index + <span class="number">3</span> * stride] += dh;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›æ¢¯åº¦</span></span><br><span class="line">    <span class="keyword">return</span> all_ious;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="delta-yolo-class-è®¡ç®—ç±»åˆ«è¯¯å·®"><a href="#delta-yolo-class-è®¡ç®—ç±»åˆ«è¯¯å·®" class="headerlink" title="delta_yolo_class è®¡ç®—ç±»åˆ«è¯¯å·®"></a>delta_yolo_class è®¡ç®—ç±»åˆ«è¯¯å·®</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—ç±»åˆ«è¯¯å·®</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delta_yolo_class</span><span class="params">(<span class="keyword">float</span> *output, <span class="keyword">float</span> *delta, <span class="keyword">int</span> index, <span class="keyword">int</span> class_id, <span class="keyword">int</span> classes, <span class="keyword">int</span> stride, <span class="keyword">float</span> *avg_cat, <span class="keyword">int</span> focal_loss, <span class="keyword">float</span> label_smooth_eps, <span class="keyword">float</span> *classes_multipliers)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">if</span> (delta[index + stride*class_id])&#123; <span class="comment">//åº”è¯¥ä¸ä¼šè¿›å…¥è¿™ä¸ªåˆ¤æ–­ï¼Œå› ä¸º delta[index] åˆå€¼ä¸º0</span></span><br><span class="line">        delta[index + stride*class_id] = (<span class="number">1</span> - label_smooth_eps) - output[index + stride*class_id];</span><br><span class="line">        <span class="keyword">if</span> (classes_multipliers) delta[index + stride*class_id] *= classes_multipliers[class_id];</span><br><span class="line">        <span class="keyword">if</span>(avg_cat) *avg_cat += output[index + stride*class_id];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Focal loss</span></span><br><span class="line">    <span class="keyword">if</span> (focal_loss) &#123;</span><br><span class="line">        <span class="comment">// Focal Loss</span></span><br><span class="line">        <span class="keyword">float</span> alpha = <span class="number">0.5</span>;    <span class="comment">// 0.25 or 0.5</span></span><br><span class="line">        <span class="comment">//float gamma = 2;    // hardcoded in many places of the grad-formula</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ti = index + stride*class_id;</span><br><span class="line">        <span class="keyword">float</span> pt = output[ti] + <span class="number">0.000000000000001F</span>;</span><br><span class="line">        <span class="comment">// http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiItKDEteCkqKDIqeCpsb2coeCkreC0xKSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMH1d</span></span><br><span class="line">        <span class="keyword">float</span> grad = -(<span class="number">1</span> - pt) * (<span class="number">2</span> * pt*<span class="built_in">logf</span>(pt) + pt - <span class="number">1</span>);    <span class="comment">// http://blog.csdn.net/linmingan/article/details/77885832</span></span><br><span class="line">        <span class="comment">//float grad = (1 - pt) * (2 * pt*logf(pt) + pt - 1);    // https://github.com/unsky/focal-loss</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; classes; ++n) &#123; <span class="comment">//å¯¹æ‰€æœ‰ç±»åˆ«ï¼Œå¦‚æœé¢„æµ‹æ­£ç¡®ï¼Œåˆ™è¯¯å·®ä¸º 1-predictï¼Œå¦åˆ™ä¸º 0-predict</span></span><br><span class="line">            delta[index + stride*n] = (((n == class_id) ? <span class="number">1</span> : <span class="number">0</span>) - output[index + stride*n]);</span><br><span class="line"></span><br><span class="line">            delta[index + stride*n] *= alpha*grad;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (n == class_id &amp;&amp; avg_cat) *avg_cat += output[index + stride*n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// default</span></span><br><span class="line">        <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; classes; ++n) &#123;</span><br><span class="line">            delta[index + stride*n] = ((n == class_id) ? (<span class="number">1</span> - label_smooth_eps) : (<span class="number">0</span> + label_smooth_eps/classes)) - output[index + stride*n];</span><br><span class="line">            <span class="keyword">if</span> (classes_multipliers &amp;&amp; n == class_id) delta[index + stride*class_id] *= classes_multipliers[class_id];</span><br><span class="line">            <span class="keyword">if</span> (n == class_id &amp;&amp; avg_cat) *avg_cat += output[index + stride*n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="entry-index-å¾—åˆ°æŒ‡é’ˆåç§»é‡ï¼Œå³å…¥å£éœ€è¦çš„ç´¢å¼•"><a href="#entry-index-å¾—åˆ°æŒ‡é’ˆåç§»é‡ï¼Œå³å…¥å£éœ€è¦çš„ç´¢å¼•" class="headerlink" title="entry_index å¾—åˆ°æŒ‡é’ˆåç§»é‡ï¼Œå³å…¥å£éœ€è¦çš„ç´¢å¼•"></a>entry_index å¾—åˆ°æŒ‡é’ˆåç§»é‡ï¼Œå³å…¥å£éœ€è¦çš„ç´¢å¼•</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief è®¡ç®—æŸä¸ªçŸ©å½¢æ¡†ä¸­æŸä¸ªå‚æ•°åœ¨l.outputä¸­çš„ç´¢å¼•ã€‚ä¸€ä¸ªçŸ©å½¢æ¡†åŒ…å«äº†x,y,w,h,c,C1,C2...,Cnä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment"> *        å‰å››ä¸ªç”¨äºå®šä½ï¼Œç¬¬äº”ä¸ªä¸ºçŸ©å½¢æ¡†å«æœ‰ç‰©ä½“çš„ç½®ä¿¡åº¦ä¿¡æ¯cï¼Œå³çŸ©å½¢æ¡†ä¸­å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡ä¸ºå¤šå¤§ï¼Œè€ŒC1åˆ°Cn</span></span><br><span class="line"><span class="comment"> *        ä¸ºçŸ©å½¢æ¡†ä¸­æ‰€åŒ…å«çš„ç‰©ä½“åˆ†åˆ«å±äºè¿™nç±»ç‰©ä½“çš„æ¦‚ç‡ã€‚æœ¬å‡½æ•°è´Ÿè´£è·å–è¯¥çŸ©å½¢æ¡†é¦–ä¸ªå®šä½ä¿¡æ¯ä¹Ÿå³xå€¼åœ¨</span></span><br><span class="line"><span class="comment"> *        l.outputä¸­ç´¢å¼•ã€è·å–è¯¥çŸ©å½¢æ¡†ç½®ä¿¡åº¦ä¿¡æ¯cåœ¨l.outputä¸­çš„ç´¢å¼•ã€è·å–è¯¥çŸ©å½¢æ¡†åˆ†ç±»æ‰€å±æ¦‚ç‡çš„é¦–ä¸ª</span></span><br><span class="line"><span class="comment"> *        æ¦‚ç‡ä¹Ÿå³C1å€¼çš„ç´¢å¼•ï¼Œå…·ä½“æ˜¯è·å–çŸ©å½¢æ¡†å“ªä¸ªå‚æ•°çš„ç´¢å¼•ï¼Œå–å†³äºè¾“å…¥å‚æ•°entryçš„å€¼ï¼Œè¿™äº›åœ¨</span></span><br><span class="line"><span class="comment"> *        forward_region_layer()å‡½æ•°ä¸­éƒ½æœ‰ç”¨åˆ°ï¼Œç”±äºl.outputçš„å­˜å‚¨æ–¹å¼ï¼Œå½“entry=0æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†</span></span><br><span class="line"><span class="comment"> *        xå‚æ•°åœ¨l.outputä¸­çš„ç´¢å¼•ï¼›å½“entry=4æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†ç½®ä¿¡åº¦ä¿¡æ¯cåœ¨l.outputä¸­çš„ç´¢å¼•ï¼›å½“</span></span><br><span class="line"><span class="comment"> *        entry=5æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†é¦–ä¸ªæ‰€å±æ¦‚ç‡C1åœ¨l.outputä¸­çš„ç´¢å¼•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒforward_region_layer()</span></span><br><span class="line"><span class="comment"> *        ä¸­è°ƒç”¨æœ¬å‡½æ•°æ—¶çš„æ³¨é‡Š.</span></span><br><span class="line"><span class="comment"> * @param l å½“å‰region_layer</span></span><br><span class="line"><span class="comment"> * @param batch å½“å‰ç…§ç‰‡æ˜¯æ•´ä¸ªbatchä¸­çš„ç¬¬å‡ å¼ ï¼Œå› ä¸ºl.outputä¸­åŒ…å«æ•´ä¸ªbatchçš„è¾“å‡ºï¼Œæ‰€ä»¥è¦å®šä½æŸå¼ è®­ç»ƒå›¾ç‰‡</span></span><br><span class="line"><span class="comment"> *              è¾“å‡ºçš„ä¼—å¤šç½‘æ ¼ä¸­çš„æŸä¸ªçŸ©å½¢æ¡†ï¼Œå½“ç„¶éœ€è¦è¯¥å‚æ•°.</span></span><br><span class="line"><span class="comment"> * @param location è¿™ä¸ªå‚æ•°ï¼Œè¯´å®è¯ï¼Œæ„Ÿè§‰åƒä¸ªé¸¡è‚‹å‚æ•°ï¼Œå‡½æ•°ä¸­ç”¨è¿™ä¸ªå‚æ•°è·å–nå’Œlocçš„å€¼ï¼Œè¿™ä¸ªnå°±æ˜¯è¡¨ç¤ºç½‘æ ¼ä¸­</span></span><br><span class="line"><span class="comment"> *                 çš„ç¬¬å‡ ä¸ªé¢„æµ‹çŸ©å½¢æ¡†ï¼ˆæ¯”å¦‚æ¯ä¸ªç½‘æ ¼é¢„æµ‹5ä¸ªçŸ©å½¢æ¡†ï¼Œé‚£ä¹ˆnå–å€¼èŒƒå›´å°±æ˜¯ä»0~4ï¼Œlocå°±æ˜¯æŸä¸ª</span></span><br><span class="line"><span class="comment"> *                 é€šé“ä¸Šçš„å…ƒç´ åç§»ï¼ˆregion_layerè¾“å‡ºçš„é€šé“æ•°ä¸ºl.out_c = (classes + coords + 1)ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 è¿™æ ·è¯´å¯èƒ½æ²¡æœ‰è¯´æ˜ç™½ï¼Œè¿™éƒ½ä¸l.outputçš„å­˜å‚¨ç»“æ„ç›¸å…³ï¼Œè§ä¸‹é¢è¯¦ç»†æ³¨é‡Šä»¥åŠå…¶ä»–è¯´æ˜ã€‚æ€»ä¹‹ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 æŸ¥çœ‹ä¸€ä¸‹è°ƒç”¨æœ¬å‡½æ•°çš„çˆ¶å‡½æ•°forward_region_layer()å°±çŸ¥é“äº†ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥nå’Œj*l.w+içš„ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 æ²¡æœ‰å¿…è¦è¾“å…¥locationï¼Œè¿™æ ·è¿˜å¾—é‡æ–°è®¡ç®—ä¸€æ¬¡nå’Œloc.</span></span><br><span class="line"><span class="comment"> * @param entry åˆ‡å…¥ç‚¹åç§»ç³»æ•°ï¼Œå…³äºè¿™ä¸ªå‚æ•°ï¼Œå°±åˆè¦æ‰¯åˆ°l.outputçš„å­˜å‚¨ç»“æ„äº†ï¼Œè§ä¸‹é¢è¯¦ç»†æ³¨é‡Šä»¥åŠå…¶ä»–è¯´æ˜.</span></span><br><span class="line"><span class="comment"> * @details l.outputè¿™ä¸ªå‚æ•°çš„å­˜å‚¨å†…å®¹ä»¥åŠå­˜å‚¨æ–¹å¼å·²ç»åœ¨å¤šä¸ªåœ°æ–¹è¯´æ˜äº†ï¼Œå†å¤šçš„æ–‡å­—éƒ½ä¸åŠå›¾æ–‡è¯´æ˜ï¼Œæ­¤å¤„å†</span></span><br><span class="line"><span class="comment"> *          ç®€è¦ç½—å—¦å‡ å¥ï¼Œæ›´ä¸ºå…·ä½“çš„å‚è€ƒå›¾æ–‡è¯´æ˜ã€‚l.outputä¸­å­˜å‚¨äº†æ•´ä¸ªbatchçš„è®­ç»ƒè¾“å‡ºï¼Œæ¯å¼ è®­ç»ƒå›¾ç‰‡éƒ½ä¼šè¾“å‡º</span></span><br><span class="line"><span class="comment"> *          l.out_w*l.out_hä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼ä¼šé¢„æµ‹l.nä¸ªçŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†å«æœ‰l.classes+l.coords+1ä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è€Œæœ€åä¸€å±‚çš„è¾“å‡ºé€šé“æ•°ä¸ºl.n*(l.classes+l.coords+1)ï¼Œå¯ä»¥æƒ³è±¡ä¸‹æœ€ç»ˆè¾“å‡ºçš„ä¸‰ç»´å¼ é‡æ˜¯ä¸ªä»€ä¹ˆæ ·å­çš„ã€‚</span></span><br><span class="line"><span class="comment"> *          å±•æˆä¸€ç»´æ•°ç»„å­˜å‚¨æ—¶ï¼Œl.outputå¯ä»¥é¦–å…ˆåˆ†æˆbatchä¸ªå¤§æ®µï¼Œæ¯ä¸ªå¤§æ®µå­˜å‚¨äº†ä¸€å¼ è®­ç»ƒå›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºï¼›è¿›ä¸€æ­¥ç»†åˆ†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å–å…¶ä¸­ç¬¬ä¸€å¤§æ®µåˆ†æï¼Œè¯¥å¤§æ®µä¸­å­˜å‚¨äº†ç¬¬ä¸€å¼ è®­ç»ƒå›¾ç‰‡æ‰€æœ‰è¾“å‡ºç½‘æ ¼é¢„æµ‹çš„çŸ©å½¢æ¡†ä¿¡æ¯ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹äº†l.nä¸ªçŸ©å½¢æ¡†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å­˜å‚¨æ—¶ï¼Œl.nä¸ªçŸ©å½¢æ¡†æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯å…ˆå­˜å‚¨æ‰€æœ‰ç½‘æ ¼ä¸­çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œè€Œåå­˜å‚¨æ‰€æœ‰ç½‘æ ¼ä¸­çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          ä¾æ¬¡ç±»æ¨ï¼Œå¦‚æœæ¯ä¸ªç½‘æ ¼ä¸­é¢„æµ‹5ä¸ªçŸ©å½¢æ¡†ï¼Œåˆ™å¯ä»¥ç»§ç»­æŠŠè¿™ä¸€å¤§æ®µåˆ†æˆ5ä¸ªä¸­æ®µã€‚ç»§ç»­ç»†åˆ†ï¼Œ5ä¸ªä¸­æ®µä¸­å–ç¬¬</span></span><br><span class="line"><span class="comment"> *          ä¸€ä¸ªä¸­æ®µæ¥åˆ†æï¼Œè¿™ä¸ªä¸­æ®µä¸­æŒ‰è¡Œï¼ˆæœ‰l.out_w*l.out_hä¸ªç½‘æ ¼ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼‰ä¾æ¬¡å­˜å‚¨äº†è¿™å¼ è®­ç»ƒå›¾ç‰‡æ‰€æœ‰è¾“å‡ºç½‘æ ¼ä¸­</span></span><br><span class="line"><span class="comment"> *          çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ä¿¡æ¯ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¸­æ®µå­˜å‚¨çš„é¡ºåºå¹¶ä¸æ˜¯æŒ¨ä¸ªæŒ¨ä¸ªå­˜å‚¨æ¯ä¸ªçŸ©å½¢æ¡†çš„æ‰€æœ‰ä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è€Œæ˜¯å…ˆå­˜å‚¨æ‰€æœ‰çŸ©å½¢æ¡†çš„xï¼Œè€Œåæ˜¯æ‰€æœ‰çš„y,ç„¶åæ˜¯æ‰€æœ‰çš„w,å†æ˜¯hï¼Œcï¼Œæœ€åçš„çš„æ¦‚ç‡æ•°ç»„ä¹Ÿæ˜¯æ‹†åˆ†è¿›è¡Œå­˜å‚¨ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å¹¶ä¸æ˜¯ä¸€ä¸‹å­å­˜å‚¨å®Œä¸€ä¸ªçŸ©å½¢æ¡†æ‰€æœ‰ç±»çš„æ¦‚ç‡ï¼Œè€Œæ˜¯å…ˆå­˜å‚¨æ‰€æœ‰ç½‘æ ¼æ‰€å±ç¬¬ä¸€ç±»çš„æ¦‚ç‡ï¼Œå†å­˜å‚¨æ‰€å±ç¬¬äºŒç±»çš„æ¦‚ç‡ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å…·ä½“æ¥è¯´è¿™ä¸€ä¸­æ®µé¦–å…ˆå­˜å‚¨äº†l.out_w*l.out_hä¸ªxï¼Œç„¶åæ˜¯l.out_w*l.out_cä¸ªyï¼Œä¾æ¬¡ä¸‹å»ï¼Œ</span></span><br><span class="line"><span class="comment"> *          æœ€åæ˜¯l.out_w*l.out_hä¸ªC1ï¼ˆå±äºç¬¬ä¸€ç±»çš„æ¦‚ç‡ï¼Œç”¨C1è¡¨ç¤ºï¼Œä¸‹é¢ç±»ä¼¼ï¼‰ï¼Œl.out_w*l.outhä¸ªC2,...,</span></span><br><span class="line"><span class="comment"> *          l.out_w*l.out_c*Cnï¼ˆå‡è®¾å…±æœ‰nç±»ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­å°†ä¸­æ®µåˆ†æˆå‡ ä¸ªå°æ®µï¼Œä¾æ¬¡ä¸ºx,y,w,h,c,C1,C2,...Cn</span></span><br><span class="line"><span class="comment"> *          å°æ®µï¼Œæ¯å°æ®µçš„é•¿åº¦éƒ½ä¸ºl.out_w*l.out_c.</span></span><br><span class="line"><span class="comment"> *          ç°åœ¨å›è¿‡æ¥çœ‹æœ¬å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œbatchå°±æ˜¯å¤§æ®µçš„åç§»æ•°ï¼ˆä»ç¬¬å‡ ä¸ªå¤§æ®µå¼€å§‹ï¼Œå¯¹åº”æ˜¯ç¬¬å‡ å¼ è®­ç»ƒå›¾ç‰‡ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> *          ç”±locationè®¡ç®—å¾—åˆ°çš„nå°±æ˜¯ä¸­æ®µçš„åç§»æ•°ï¼ˆä»ç¬¬å‡ ä¸ªä¸­æ®µå¼€å§‹ï¼Œå¯¹åº”æ˜¯ç¬¬å‡ ä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> *          entryå°±æ˜¯å°æ®µçš„åç§»æ•°ï¼ˆä»å‡ ä¸ªå°æ®µå¼€å§‹ï¼Œå¯¹åº”å…·ä½“æ˜¯é‚£ç§å‚æ•°ï¼Œx,cè¿˜æ˜¯C1ï¼‰ï¼Œè€Œlocåˆ™æ˜¯æœ€åçš„å®šä½ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å‰é¢ç¡®å®šå¥½ç¬¬å‡ å¤§æ®µä¸­çš„ç¬¬å‡ ä¸­æ®µä¸­çš„ç¬¬å‡ å°æ®µçš„é¦–åœ°å€ï¼Œlocå°±æ˜¯ä»è¯¥é¦–åœ°å€å¾€åæ•°locä¸ªå…ƒç´ ï¼Œå¾—åˆ°æœ€ç»ˆå®šä½</span></span><br><span class="line"><span class="comment"> *          æŸä¸ªå…·ä½“å‚æ•°ï¼ˆxæˆ–cæˆ–C1ï¼‰çš„ç´¢å¼•å€¼ï¼Œæ¯”å¦‚l.outputä¸­å­˜å‚¨çš„æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼ˆè¿™é‡Œå‡è®¾åªå­˜äº†ä¸€å¼ è®­ç»ƒå›¾ç‰‡çš„è¾“å‡ºï¼Œ</span></span><br><span class="line"><span class="comment"> *          å› æ­¤batchåªèƒ½ä¸º0ï¼›å¹¶å‡è®¾l.out_w=l.out_h=2,l.classes=2ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"> *          xxxxyyyywwwwhhhhccccC1C1C1C1C2C2C2C2-#-xxxxyyyywwwwhhhhccccC1C1C1C1C2C2C2C2ï¼Œ</span></span><br><span class="line"><span class="comment"> *          n=0åˆ™å®šä½åˆ°-#-å·¦è¾¹çš„é¦–åœ°å€ï¼ˆè¡¨ç¤ºæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œn=1åˆ™å®šä½åˆ°-#-å³è¾¹çš„é¦–åœ°å€ï¼ˆè¡¨ç¤ºæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ï¼‰</span></span><br><span class="line"><span class="comment"> *          entry=0,loc=0è·å–çš„æ˜¯xçš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬ä¸€ä¸ªxä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†xå‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          entry=4,loc=1è·å–çš„æ˜¯cçš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬äºŒä¸ªcä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬äºŒä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†cå‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          entry=5,loc=2è·å–çš„æ˜¯C1çš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬ä¸‰ä¸ªC1ä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬ä¸‰ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†C1å‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          å¦‚æœè¦è·å–ç¬¬ä¸€ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†wå‚æ•°çš„ç´¢å¼•å‘¢ï¼Ÿå¦‚æœå·²ç»è·å–äº†å…¶xå€¼çš„ç´¢å¼•ï¼Œæ˜¾ç„¶ç”¨xçš„ç´¢å¼•åŠ ä¸Š3*l.out_w*l.out_hå³å¯è·å–åˆ°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è¿™æ­£æ˜¯delta_region_box()å‡½æ•°çš„åšæ³•ï¼›</span></span><br><span class="line"><span class="comment"> *          å¦‚æœè¦è·å–ç¬¬ä¸‰ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†C2å‚æ•°çš„ç´¢å¼•å‘¢ï¼Ÿå¦‚æœå·²ç»è·å–äº†å…¶C1å€¼çš„ç´¢å¼•ï¼Œæ˜¾ç„¶ç”¨C1çš„ç´¢å¼•åŠ ä¸Šl.out_w*l.out_hå³å¯è·å–åˆ°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è¿™æ­£æ˜¯delta_region_class()å‡½æ•°ä¸­çš„åšæ³•ï¼›</span></span><br><span class="line"><span class="comment"> *          ç”±ä¸Šå¯çŸ¥ï¼Œentry=0æ—¶,å³åç§»0ä¸ªå°æ®µï¼Œæ˜¯è·å–xçš„ç´¢å¼•ï¼›entry=4,æ˜¯è·å–è‡ªä¿¡åº¦ä¿¡æ¯cçš„ç´¢å¼•ï¼›entry=5ï¼Œæ˜¯è·å–C1çš„ç´¢å¼•.</span></span><br><span class="line"><span class="comment"> *          l.outputçš„å­˜å‚¨æ–¹å¼å¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œä¸ªäººè§‰å¾—è¯´çš„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œä½†å¯è§†åŒ–æ•ˆæœç»ˆç©¶ä¸å¦‚å›¾æ–‡è¯´æ˜ï½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">entry_index</span><span class="params">(layer l, <span class="keyword">int</span> batch, <span class="keyword">int</span> location, <span class="keyword">int</span> entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n =   location / (l.w*l.h);</span><br><span class="line">    <span class="keyword">int</span> loc = location % (l.w*l.h);</span><br><span class="line">    <span class="keyword">return</span> batch*l.outputs + n*l.w*l.h*(<span class="number">4</span>+l.classes+<span class="number">1</span>) + entry*l.w*l.h + loc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="forward-yolo-layer-å‰å‘ä¼ æ’­å‡½æ•°"><a href="#forward-yolo-layer-å‰å‘ä¼ æ’­å‡½æ•°" class="headerlink" title="forward_yolo_layer å‰å‘ä¼ æ’­å‡½æ•°"></a>forward_yolo_layer å‰å‘ä¼ æ’­å‡½æ•°</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‰å‘ä¼ æ’­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_yolo_layer</span><span class="params">(<span class="keyword">const</span> layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, b, t, n;</span><br><span class="line">	<span class="comment">//å°†å±‚è¾“å…¥ç›´æ¥æ‹·è´åˆ°å±‚è¾“å‡º</span></span><br><span class="line">    <span class="built_in">memcpy</span>(l.output, state.input, l.outputs*l.batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">   <span class="comment">//åœ¨ cpu é‡Œï¼ŒæŠŠé¢„æµ‹è¾“å‡ºçš„ x,y,confidence å’Œ80ç§ç±»åˆ«éƒ½ sigmoid æ¿€æ´»ï¼Œç¡®ä¿å€¼åœ¨0~1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> GPU</span></span><br><span class="line">    <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">        <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123;</span><br><span class="line">			<span class="comment">// è·å–ç¬¬bä¸ªbatchå¼€å§‹çš„index</span></span><br><span class="line">            <span class="keyword">int</span> index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h, <span class="number">0</span>);</span><br><span class="line">			<span class="comment">// å¯¹é¢„æµ‹çš„tx,tyè¿›è¡Œé€»è¾‘å›å½’é¢„æµ‹,</span></span><br><span class="line">            <span class="built_in">activate_array</span>(l.output + index, <span class="number">2</span> * l.w*l.h, LOGISTIC);        <span class="comment">// x,y,</span></span><br><span class="line">            <span class="built_in">scal_add_cpu</span>(<span class="number">2</span> * l.w*l.h, l.scale_x_y, <span class="number">-0.5</span>*(l.scale_x_y - <span class="number">1</span>), l.output + index, <span class="number">1</span>);    <span class="comment">// scale x,y</span></span><br><span class="line">            <span class="comment">// è·å–ç¬¬bä¸ªbatch confidenceå¼€å§‹çš„index</span></span><br><span class="line">			index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h, <span class="number">4</span>);</span><br><span class="line">			<span class="comment">// å¯¹é¢„æµ‹çš„confidenceä»¥åŠclassè¿›è¡Œé€»è¾‘å›å½’</span></span><br><span class="line">            <span class="built_in">activate_array</span>(l.output + index, (<span class="number">1</span> + l.classes)*l.w*l.h, LOGISTIC);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// delta is zeroed</span></span><br><span class="line">	<span class="comment">//å°†yoloå±‚çš„è¯¯å·®é¡¹è¿›è¡Œåˆå§‹åŒ–(åŒ…å«æ•´ä¸ªbatchçš„)</span></span><br><span class="line">    <span class="built_in">memset</span>(l.delta, <span class="number">0</span>, l.outputs * l.batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">// inferenceé˜¶æ®µ,åˆ°æ­¤ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!state.train) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//float avg_iou = 0;</span></span><br><span class="line">    <span class="keyword">float</span> tot_iou = <span class="number">0</span>; <span class="comment">//æ€»çš„IoUï¼ˆIntersection over Unionï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> tot_giou = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_diou = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_ciou = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_iou_loss = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_giou_loss = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_diou_loss = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> tot_ciou_loss = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> recall = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> recall75 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> avg_cat = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> avg_obj = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> avg_anyobj = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> class_count = <span class="number">0</span>;</span><br><span class="line">    *(l.cost) = <span class="number">0</span>; <span class="comment">// yoloå±‚çš„æ€»æŸå¤±åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;<span class="comment">// éå†batchä¸­çš„æ¯ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.h; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w; ++i) &#123;<span class="comment">// éå†æ¯ä¸ªcell, å½“å‰cellç¼–å·[j, i]</span></span><br><span class="line">                <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123;<span class="comment">// éå†æ¯ä¸€ä¸ªbbox, å½“å‰bboxç¼–å· [n]</span></span><br><span class="line">					<span class="comment">// åœ¨è¿™é‡Œä¸yolov2 reorgå±‚æ˜¯ç›¸ä¼¼çš„, è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxçš„index</span></span><br><span class="line">                    <span class="keyword">int</span> box_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">0</span>);</span><br><span class="line">					<span class="comment">// è®¡ç®—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxåœ¨å½“å‰ç‰¹å¾å›¾ä¸Šçš„ç›¸å¯¹ä½ç½®[x,y],åœ¨ç½‘ç»œè¾“å…¥å›¾ç‰‡ä¸Šçš„ç›¸å¯¹å®½åº¦,é«˜åº¦[w,h]</span></span><br><span class="line">                    box pred = <span class="built_in">get_yolo_box</span>(l.output, l.biases, l.mask[n], box_index, i, j, l.w, l.h, state.net.w, state.net.h, l.w*l.h);</span><br><span class="line">                    <span class="keyword">float</span> best_match_iou = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">int</span> <span class="keyword">best_match_t</span> = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">float</span> best_iou = <span class="number">0</span>; <span class="comment">// ä¿å­˜æœ€å¤§iou</span></span><br><span class="line">                    <span class="keyword">int</span> <span class="keyword">best_t</span> = <span class="number">0</span>;<span class="comment">// ä¿å­˜æœ€å¤§iouçš„bbox id</span></span><br><span class="line">                    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; l.max_boxes; ++t) &#123;<span class="comment">// éå†æ¯ä¸€ä¸ªGT bbox</span></span><br><span class="line">						<span class="comment">// å°†ç¬¬tä¸ªbboxç”±floatæ•°ç»„è½¬bboxç»“æ„ä½“,æ–¹ä¾¿è®¡ç®—iou</span></span><br><span class="line">                        box truth = <span class="built_in">float_to_box_stride</span>(state.truth + t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths, <span class="number">1</span>);</span><br><span class="line">						<span class="comment">//è·å–ç¬¬tä¸ªbboxçš„ç±»åˆ«ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ ‡æ³¨é”™è¯¯</span></span><br><span class="line">                        <span class="keyword">int</span> class_id = state.truth[t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                        <span class="keyword">if</span> (class_id &gt;= l.classes) &#123;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot; Warning: in txt-labels class_id=%d &gt;= classes=%d in cfg-file. In txt-labels class_id should be [from 0 to %d] \n&quot;</span>, class_id, l.classes, l.classes - <span class="number">1</span>);</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot; truth.x = %f, truth.y = %f, truth.w = %f, truth.h = %f, class_id = %d \n&quot;</span>, truth.x, truth.y, truth.w, truth.h, class_id);</span><br><span class="line">                            <span class="built_in">getchar</span>();</span><br><span class="line">                            <span class="keyword">continue</span>; <span class="comment">// if label contains class_id more than number of classes in the cfg-file</span></span><br><span class="line">                        &#125;</span><br><span class="line">						<span class="comment">// å¦‚æœxåæ ‡ä¸º0åˆ™å–æ¶ˆ,å› ä¸ºyolov3è¿™é‡Œå®šä¹‰äº†max_boxesä¸ªbbox</span></span><br><span class="line">                        <span class="keyword">if</span> (!truth.x) <span class="keyword">break</span>;  <span class="comment">// continue;</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">4</span> + <span class="number">1</span>);<span class="comment">//é¢„æµ‹bbox ç±»åˆ«sä¸‹æ ‡</span></span><br><span class="line">                        <span class="keyword">int</span> obj_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">4</span>); <span class="comment">//é¢„æµ‹bbox objectnessä¸‹æ ‡</span></span><br><span class="line">                        <span class="keyword">float</span> objectness = l.output[obj_index]; <span class="comment">//é¢„æµ‹bbox objectç½®ä¿¡åº¦</span></span><br><span class="line">						<span class="comment">//è·å¾—é¢„æµ‹bbox çš„ç±»åˆ«ä¿¡æ¯ï¼Œå¦‚æœæŸä¸ªç±»åˆ«çš„æ¦‚ç‡è¶…è¿‡0.25è¿”å›1</span></span><br><span class="line">                        <span class="keyword">int</span> class_id_match = <span class="built_in">compare_yolo_class</span>(l.output, l.classes, class_index, l.w*l.h, objectness, class_id, <span class="number">0.25f</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth); <span class="comment">// è®¡ç®—pred bboxä¸ç¬¬tä¸ªGT bboxä¹‹é—´çš„iou</span></span><br><span class="line">						<span class="comment">// è¿™ä¸ªåœ°æ–¹å’ŒåŸå§‹çš„DarkNetå®ç°ä¸å¤ªä¸€æ ·ï¼Œå¤šäº†ä¸€ä¸ªclass_id_match=1çš„é™åˆ¶ï¼Œå³é¢„æµ‹bboxçš„ç½®ä¿¡åº¦å¿…é¡»å¤§äº0.25</span></span><br><span class="line">                        <span class="keyword">if</span> (iou &gt; best_match_iou &amp;&amp; class_id_match == <span class="number">1</span>) &#123;</span><br><span class="line">                            best_match_iou = iou;</span><br><span class="line">                            <span class="keyword">best_match_t</span> = t;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (iou &gt; best_iou) &#123;</span><br><span class="line">                            best_iou = iou; <span class="comment">// è®°å½•iouæœ€å¤§çš„iou</span></span><br><span class="line">                            <span class="keyword">best_t</span> = t; <span class="comment">// è®°å½•è¯¥GT bboxçš„ç¼–å·t</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">					<span class="comment">// åœ¨è¿™é‡Œä¸yolov2 reorgå±‚æ˜¯ç›¸ä¼¼çš„, è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxçš„confidence</span></span><br><span class="line">                    <span class="keyword">int</span> obj_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">4</span>);</span><br><span class="line">					<span class="comment">// ç»Ÿè®¡pred bboxçš„confidence</span></span><br><span class="line">                    avg_anyobj += l.output[obj_index];</span><br><span class="line">					 <span class="comment">// ä¸yolov1ç›¸ä¼¼,å…ˆå°†æ‰€æœ‰pred bboxéƒ½å½“åšnoobject, è®¡ç®—å…¶confidenceæ¢¯åº¦ï¼Œä¸è¿‡è¿™é‡Œå¤šäº†ä¸€ä¸ªå¹³è¡¡ç³»æ•°</span></span><br><span class="line">                    l.delta[obj_index] = l.cls_normalizer * (<span class="number">0</span> - l.output[obj_index]);</span><br><span class="line">					<span class="comment">// best_iouå¤§äºé˜ˆå€¼åˆ™è¯´æ˜pred boxæœ‰ç‰©ä½“,åœ¨yolov3ä¸­æ­£æ ·æœ¬é˜ˆå€¼ignore_thresh=.5</span></span><br><span class="line">                    <span class="keyword">if</span> (best_match_iou &gt; l.ignore_thresh) &#123;</span><br><span class="line">                        l.delta[obj_index] = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">					<span class="comment">// pred bboxä¸ºå®Œå…¨é¢„æµ‹æ­£ç¡®æ ·æœ¬,åœ¨yolov3å®Œå…¨é¢„æµ‹æ­£ç¡®æ ·æœ¬çš„é˜ˆå€¼truth_thresh=1.</span></span><br><span class="line">					<span class="comment">//è¿™ä¸ªå‚æ•°åœ¨cfgæ–‡ä»¶ä¸­ï¼Œå€¼ä¸º1ï¼Œè¿™ä¸ªæ¡ä»¶è¯­å¥æ°¸è¿œä¸å¯èƒ½æˆç«‹</span></span><br><span class="line">                    <span class="keyword">if</span> (best_iou &gt; l.truth_thresh) &#123;</span><br><span class="line">						<span class="comment">// ä½œè€…åœ¨YOLOV3è®ºæ–‡ä¸­çš„ç¬¬4èŠ‚æåˆ°äº†è¿™éƒ¨åˆ†ã€‚</span></span><br><span class="line">						<span class="comment">// ä½œè€…å°è¯•Faster-RCNNä¸­æåˆ°çš„åŒIOUç­–ç•¥ï¼Œå½“Anchorä¸GTçš„IoUå¤§äº0.7æ—¶ï¼Œè¯¥Anchorè¢«ç®—ä½œæ­£æ ·æœ¬</span></span><br><span class="line">						<span class="comment">//è®¡å…¥æŸå¤±ä¸­ï¼Œä½†è®­ç»ƒè¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰äº§ç”Ÿå¥½çš„ç»“æœï¼Œæ‰€ä»¥æœ€åæ”¾å¼ƒäº†ã€‚</span></span><br><span class="line">                        l.delta[obj_index] = l.cls_normalizer * (<span class="number">1</span> - l.output[obj_index]);</span><br><span class="line">						 <span class="comment">// è·å¾—best_iouå¯¹åº”GT bboxçš„classçš„index</span></span><br><span class="line">                        <span class="keyword">int</span> class_id = state.truth[<span class="keyword">best_t</span>*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths + <span class="number">4</span>];</span><br><span class="line">						<span class="comment">//yolov3 yoloå±‚ä¸­map=0, ä¸å‚ä¸è®¡ç®—</span></span><br><span class="line">                        <span class="keyword">if</span> (l.map) class_id = l.map[class_id];</span><br><span class="line">						<span class="comment">// è·å¾—best_iouå¯¹åº”pred bboxçš„classçš„index</span></span><br><span class="line">                        <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">                        <span class="built_in">delta_yolo_class</span>(l.output, l.delta, class_index, class_id, l.classes, l.w*l.h, <span class="number">0</span>, l.focal_loss, l.label_smooth_eps, l.classes_multipliers);</span><br><span class="line">                        box truth = <span class="built_in">float_to_box_stride</span>(state.truth + <span class="keyword">best_t</span>*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths, <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">float</span> class_multiplier = (l.classes_multipliers) ? l.classes_multipliers[class_id] : <span class="number">1.0f</span>;</span><br><span class="line">                        <span class="comment">// è®¡ç®—pred bboxçš„[x,y,w,h]çš„æ¢¯åº¦</span></span><br><span class="line">						<span class="built_in">delta_yolo_box</span>(truth, l.output, l.biases, l.mask[n], box_index, i, j, l.w, l.h, state.net.w, state.net.h, l.delta, (<span class="number">2</span> - truth.w*truth.h), l.w*l.h, l.iou_normalizer * class_multiplier, l.iou_loss, <span class="number">1</span>, l.max_delta);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; l.max_boxes; ++t) &#123;</span><br><span class="line">			<span class="comment">//éå†æ¯ä¸€ä¸ªGT box</span></span><br><span class="line">			<span class="comment">// å°†ç¬¬tä¸ªbboxç”±floatæ•°ç»„è½¬bboxç»“æ„ä½“,æ–¹ä¾¿è®¡ç®—iou</span></span><br><span class="line">            box truth = <span class="built_in">float_to_box_stride</span>(state.truth + t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (truth.x &lt; <span class="number">0</span> || truth.y &lt; <span class="number">0</span> || truth.x &gt; <span class="number">1</span> || truth.y &gt; <span class="number">1</span> || truth.w &lt; <span class="number">0</span> || truth.h &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">char</span> buff[<span class="number">256</span>];</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot; Wrong label: truth.x = %f, truth.y = %f, truth.w = %f, truth.h = %f \n&quot;</span>, truth.x, truth.y, truth.w, truth.h);</span><br><span class="line">                <span class="built_in">sprintf</span>(buff, <span class="string">&quot;echo \&quot;Wrong label: truth.x = %f, truth.y = %f, truth.w = %f, truth.h = %f\&quot; &gt;&gt; bad_label.list&quot;</span>,</span><br><span class="line">                    truth.x, truth.y, truth.w, truth.h);</span><br><span class="line">                <span class="built_in">system</span>(buff);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> class_id = state.truth[t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths + <span class="number">4</span>];</span><br><span class="line">            <span class="keyword">if</span> (class_id &gt;= l.classes) <span class="keyword">continue</span>; <span class="comment">// if label contains class_id more than number of classes in the cfg-file</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!truth.x) <span class="keyword">break</span>;  <span class="comment">// å¦‚æœxåæ ‡ä¸º0åˆ™å–æ¶ˆï¼Œå› ä¸ºyolov3å®šä¹‰äº†max_boxesä¸ªbbox,å¯èƒ½å®é™…ä¸Šæ²¡é‚£ä¹ˆå¤š</span></span><br><span class="line">            <span class="keyword">float</span> best_iou = <span class="number">0</span>; <span class="comment">//ä¿å­˜æœ€å¤§çš„IOU</span></span><br><span class="line">            <span class="keyword">int</span> best_n = <span class="number">0</span>; <span class="comment">//ä¿å­˜æœ€å¤§IOUçš„bbox index</span></span><br><span class="line">            i = (truth.x * l.w); <span class="comment">// è·å¾—å½“å‰tä¸ªGT bboxæ‰€åœ¨çš„cell</span></span><br><span class="line">            j = (truth.y * l.h);</span><br><span class="line">            box truth_shift = truth;</span><br><span class="line">            truth_shift.x = truth_shift.y = <span class="number">0</span>; <span class="comment">//å°†truth_shiftçš„boxä½ç½®ç§»åŠ¨åˆ°0,0</span></span><br><span class="line">            <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.total; ++n) &#123; <span class="comment">// éå†æ¯ä¸€ä¸ªanchor bboxæ‰¾åˆ°ä¸GT bboxæœ€å¤§çš„IOU</span></span><br><span class="line">                box pred = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">                pred.w = l.biases[<span class="number">2</span> * n] / state.net.w; <span class="comment">// è®¡ç®—pred bboxçš„wåœ¨ç›¸å¯¹æ•´å¼ è¾“å…¥å›¾ç‰‡çš„ä½ç½®</span></span><br><span class="line">                pred.h = l.biases[<span class="number">2</span> * n + <span class="number">1</span>] / state.net.h; <span class="comment">// è®¡ç®—pred bboxçš„håœ¨ç›¸å¯¹æ•´å¼ è¾“å…¥å›¾ç‰‡çš„ä½ç½®</span></span><br><span class="line">                <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth_shift); <span class="comment">// è®¡ç®—GT box truth_shift ä¸ é¢„æµ‹bbox predäºŒè€…ä¹‹é—´çš„IOU</span></span><br><span class="line">                <span class="keyword">if</span> (iou &gt; best_iou) &#123;</span><br><span class="line">                    best_iou = iou;<span class="comment">// è®°å½•æœ€å¤§çš„IOU</span></span><br><span class="line">                    best_n = n;<span class="comment">// ä»¥åŠè®°å½•è¯¥bboxçš„ç¼–å·n</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¸Šé¢è®°å½•bboxçš„ç¼–å·,æ˜¯å¦ç”±è¯¥å±‚Anchoré¢„æµ‹çš„</span></span><br><span class="line">            <span class="keyword">int</span> mask_n = <span class="built_in">int_index</span>(l.mask, best_n, l.n);</span><br><span class="line">            <span class="keyword">if</span> (mask_n &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> class_id = state.truth[t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                <span class="keyword">if</span> (l.map) class_id = l.map[class_id];</span><br><span class="line">				<span class="comment">// è·å¾—best_iouå¯¹åº”anchor boxçš„index</span></span><br><span class="line">                <span class="keyword">int</span> box_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">0</span>);</span><br><span class="line">				<span class="comment">//è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ§åˆ¶æ ·æœ¬æ•°é‡ä¸å‡è¡¡çš„ï¼Œå³Focal Lossä¸­çš„alpha</span></span><br><span class="line">                <span class="keyword">const</span> <span class="keyword">float</span> class_multiplier = (l.classes_multipliers) ? l.classes_multipliers[class_id] : <span class="number">1.0f</span>;</span><br><span class="line">				<span class="comment">// è®¡ç®—best_iouå¯¹åº”Anchor bboxçš„[x,y,w,h]çš„æ¢¯åº¦</span></span><br><span class="line">                ious all_ious = <span class="built_in">delta_yolo_box</span>(truth, l.output, l.biases, best_n, box_index, i, j, l.w, l.h, state.net.w, state.net.h, l.delta, (<span class="number">2</span> - truth.w*truth.h), l.w*l.h, l.iou_normalizer * class_multiplier, l.iou_loss, <span class="number">1</span>, l.max_delta);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// ä¸‹é¢çš„éƒ½æ˜¯æ¨¡æ¿æ£€æµ‹æœ€æ–°çš„å·¥ä½œï¼Œmetricl learningï¼ŒåŒ…æ‹¬IOU/GIOU/DIOU/CIOU Loss</span></span><br><span class="line">                <span class="comment">// range is 0 &lt;= 1</span></span><br><span class="line">                tot_iou += all_ious.iou;</span><br><span class="line">                tot_iou_loss += <span class="number">1</span> - all_ious.iou;</span><br><span class="line">                <span class="comment">// range is -1 &lt;= giou &lt;= 1</span></span><br><span class="line">                tot_giou += all_ious.giou;</span><br><span class="line">                tot_giou_loss += <span class="number">1</span> - all_ious.giou;</span><br><span class="line"></span><br><span class="line">                tot_diou += all_ious.diou;</span><br><span class="line">                tot_diou_loss += <span class="number">1</span> - all_ious.diou;</span><br><span class="line"></span><br><span class="line">                tot_ciou += all_ious.ciou;</span><br><span class="line">                tot_ciou_loss += <span class="number">1</span> - all_ious.ciou;</span><br><span class="line">				<span class="comment">// è·å¾—best_iouå¯¹åº”anchor boxçš„confidenceçš„index</span></span><br><span class="line">                <span class="keyword">int</span> obj_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">4</span>);</span><br><span class="line">				<span class="comment">//ç»Ÿè®¡confidence</span></span><br><span class="line">                avg_obj += l.output[obj_index];</span><br><span class="line">				<span class="comment">// è®¡ç®—confidenceçš„æ¢¯åº¦</span></span><br><span class="line">                l.delta[obj_index] = class_multiplier * l.cls_normalizer * (<span class="number">1</span> - l.output[obj_index]);</span><br><span class="line">				<span class="comment">// è·å¾—best_iouå¯¹åº”GT boxçš„classçš„index</span></span><br><span class="line">                <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">				<span class="comment">// è·å¾—best_iouå¯¹åº”anchor boxçš„classçš„index</span></span><br><span class="line">                <span class="built_in">delta_yolo_class</span>(l.output, l.delta, class_index, class_id, l.classes, l.w*l.h, &amp;avg_cat, l.focal_loss, l.label_smooth_eps, l.classes_multipliers);</span><br><span class="line"></span><br><span class="line">                ++count;</span><br><span class="line">                ++class_count;</span><br><span class="line">                <span class="keyword">if</span> (all_ious.iou &gt; <span class="number">.5</span>) recall += <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (all_ious.iou &gt; <span class="number">.75</span>) recall75 += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸è¿‡å¤šçº¦æŸäº†ä¸€ä¸ªiou_thresh</span></span><br><span class="line">            <span class="comment">// iou_thresh</span></span><br><span class="line">            <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.total; ++n) &#123;</span><br><span class="line">                <span class="keyword">int</span> mask_n = <span class="built_in">int_index</span>(l.mask, n, l.n);</span><br><span class="line">                <span class="keyword">if</span> (mask_n &gt;= <span class="number">0</span> &amp;&amp; n != best_n &amp;&amp; l.iou_thresh &lt; <span class="number">1.0f</span>) &#123;</span><br><span class="line">                    box pred = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">                    pred.w = l.biases[<span class="number">2</span> * n] / state.net.w;</span><br><span class="line">                    pred.h = l.biases[<span class="number">2</span> * n + <span class="number">1</span>] / state.net.h;</span><br><span class="line">                    <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth_shift);</span><br><span class="line">                    <span class="comment">// iou, n</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (iou &gt; l.iou_thresh) &#123;</span><br><span class="line">                        <span class="keyword">int</span> class_id = state.truth[t*(<span class="number">4</span> + <span class="number">1</span>) + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                        <span class="keyword">if</span> (l.map) class_id = l.map[class_id];</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">int</span> box_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">float</span> class_multiplier = (l.classes_multipliers) ? l.classes_multipliers[class_id] : <span class="number">1.0f</span>;</span><br><span class="line">                        ious all_ious = <span class="built_in">delta_yolo_box</span>(truth, l.output, l.biases, n, box_index, i, j, l.w, l.h, state.net.w, state.net.h, l.delta, (<span class="number">2</span> - truth.w*truth.h), l.w*l.h, l.iou_normalizer * class_multiplier, l.iou_loss, <span class="number">1</span>, l.max_delta);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// range is 0 &lt;= 1</span></span><br><span class="line">                        tot_iou += all_ious.iou;</span><br><span class="line">                        tot_iou_loss += <span class="number">1</span> - all_ious.iou;</span><br><span class="line">                        <span class="comment">// range is -1 &lt;= giou &lt;= 1</span></span><br><span class="line">                        tot_giou += all_ious.giou;</span><br><span class="line">                        tot_giou_loss += <span class="number">1</span> - all_ious.giou;</span><br><span class="line"></span><br><span class="line">                        tot_diou += all_ious.diou;</span><br><span class="line">                        tot_diou_loss += <span class="number">1</span> - all_ious.diou;</span><br><span class="line"></span><br><span class="line">                        tot_ciou += all_ious.ciou;</span><br><span class="line">                        tot_ciou_loss += <span class="number">1</span> - all_ious.ciou;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">int</span> obj_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">4</span>);</span><br><span class="line">                        avg_obj += l.output[obj_index];</span><br><span class="line">                        l.delta[obj_index] = class_multiplier * l.cls_normalizer * (<span class="number">1</span> - l.output[obj_index]);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, b, mask_n*l.w*l.h + j*l.w + i, <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">                        <span class="built_in">delta_yolo_class</span>(l.output, l.delta, class_index, class_id, l.classes, l.w*l.h, &amp;avg_cat, l.focal_loss, l.label_smooth_eps, l.classes_multipliers);</span><br><span class="line"></span><br><span class="line">                        ++count;</span><br><span class="line">                        ++class_count;</span><br><span class="line">                        <span class="keyword">if</span> (all_ious.iou &gt; <span class="number">.5</span>) recall += <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">if</span> (all_ious.iou &gt; <span class="number">.75</span>) recall75 += <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// averages the deltas obtained by the function: delta_yolo_box()_accumulate</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.h; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w; ++i) &#123;</span><br><span class="line">                <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123;</span><br><span class="line">					<span class="comment">// åœ¨è¿™é‡Œä¸yolov2 reorgå±‚æ˜¯ç›¸ä¼¼çš„, è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxçš„index</span></span><br><span class="line">                    <span class="keyword">int</span> box_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">0</span>);</span><br><span class="line">					<span class="comment">//è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxçš„ç±»åˆ«</span></span><br><span class="line">                    <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">					<span class="comment">//ç‰¹å¾å›¾çš„å¤§å°</span></span><br><span class="line">                    <span class="keyword">const</span> <span class="keyword">int</span> stride = l.w*l.h;</span><br><span class="line">					<span class="comment">//å¯¹æ¢¯åº¦è¿›è¡Œå¹³å‡</span></span><br><span class="line">                    <span class="built_in">averages_yolo_deltas</span>(class_index, box_index, stride, l.classes, l.delta);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//*(l.cost) = pow(mag_array(l.delta, l.outputs * l.batch), 2);</span></span><br><span class="line">    <span class="comment">//printf(&quot;Region %d Avg IOU: %f, Class: %f, Obj: %f, No Obj: %f, .5R: %f, .75R: %f,  count: %d\n&quot;, state.index, avg_iou / count, avg_cat / class_count, avg_obj / count, avg_anyobj / (l.w*l.h*l.n*l.batch), recall / count, recall75 / count, count);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> stride = l.w*l.h;</span><br><span class="line">    <span class="keyword">float</span>* no_iou_loss_delta = (<span class="keyword">float</span> *)<span class="built_in">calloc</span>(l.batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="built_in">memcpy</span>(no_iou_loss_delta, l.delta, l.batch * l.outputs * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.h; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w; ++i) &#123;</span><br><span class="line">                <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123;</span><br><span class="line">					<span class="comment">//yolov3å¦‚æœä½¿ç”¨çš„æ˜¯iou lossï¼Œä¹Ÿå°±æ˜¯metric learningçš„æ–¹å¼ï¼Œé‚£ä¹ˆx,y,w,hçš„losså¯ä»¥è®¾ç½®ä¸º0</span></span><br><span class="line">                    <span class="keyword">int</span> index = <span class="built_in">entry_index</span>(l, b, n*l.w*l.h + j*l.w + i, <span class="number">0</span>);</span><br><span class="line">                    no_iou_loss_delta[index + <span class="number">0</span> * stride] = <span class="number">0</span>;</span><br><span class="line">                    no_iou_loss_delta[index + <span class="number">1</span> * stride] = <span class="number">0</span>;</span><br><span class="line">                    no_iou_loss_delta[index + <span class="number">2</span> * stride] = <span class="number">0</span>;</span><br><span class="line">                    no_iou_loss_delta[index + <span class="number">3</span> * stride] = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//è®¡ç®—æ‰€æœ‰çš„åˆ†ç±»loss</span></span><br><span class="line">    <span class="keyword">float</span> classification_loss = l.cls_normalizer * <span class="built_in">pow</span>(<span class="built_in">mag_array</span>(no_iou_loss_delta, l.outputs * l.batch), <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">free</span>(no_iou_loss_delta);</span><br><span class="line">	<span class="comment">//è®¡ç®—æ€»çš„loss</span></span><br><span class="line">    <span class="keyword">float</span> loss = <span class="built_in">pow</span>(<span class="built_in">mag_array</span>(l.delta, l.outputs * l.batch), <span class="number">2</span>);</span><br><span class="line">	<span class="comment">//è®¡ç®—å›å½’loss</span></span><br><span class="line">    <span class="keyword">float</span> iou_loss = loss - classification_loss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> avg_iou_loss = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// gIOU loss + MSE (objectness) loss</span></span><br><span class="line">    <span class="keyword">if</span> (l.iou_loss == MSE) &#123;</span><br><span class="line">        *(l.cost) = <span class="built_in">pow</span>(<span class="built_in">mag_array</span>(l.delta, l.outputs * l.batch), <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Always compute classification loss both for iou + cls loss and for logging with mse loss</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> remove IOU loss fields before computing MSE on class</span></span><br><span class="line">        <span class="comment">//   probably split into two arrays</span></span><br><span class="line">        <span class="keyword">if</span> (l.iou_loss == GIOU) &#123;</span><br><span class="line">            avg_iou_loss = count &gt; <span class="number">0</span> ? l.iou_normalizer * (tot_giou_loss / count) : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//countä»£è¡¨ç›®æ ‡ä¸ªæ•°</span></span><br><span class="line">            avg_iou_loss = count &gt; <span class="number">0</span> ? l.iou_normalizer * (tot_iou_loss / count) : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        *(l.cost) = avg_iou_loss + classification_loss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    loss /= l.batch;</span><br><span class="line">    classification_loss /= l.batch;</span><br><span class="line">    iou_loss /= l.batch;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;v3 (%s loss, Normalizer: (iou: %f, cls: %f) Region %d Avg (IOU: %f, GIOU: %f), Class: %f, Obj: %f, No Obj: %f, .5R: %f, .75R: %f, count: %d, loss = %f, class_loss = %f, iou_loss = %f\n&quot;</span>,</span><br><span class="line">        (l.iou_loss == MSE ? <span class="string">&quot;mse&quot;</span> : (l.iou_loss == GIOU ? <span class="string">&quot;giou&quot;</span> : <span class="string">&quot;iou&quot;</span>)), l.iou_normalizer, l.cls_normalizer, state.index, tot_iou / count, tot_giou / count, avg_cat / class_count, avg_obj / count, avg_anyobj / (l.w*l.h*l.n*l.batch), recall / count, recall75 / count, count,</span><br><span class="line">        loss, classification_loss, iou_loss);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="backward-yolo-layer-è¯¯å·®åå‘ä¼ æ’­"><a href="#backward-yolo-layer-è¯¯å·®åå‘ä¼ æ’­" class="headerlink" title="backward_yolo_layer è¯¯å·®åå‘ä¼ æ’­"></a>backward_yolo_layer è¯¯å·®åå‘ä¼ æ’­</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯¯å·®åå‘ä¼ æ’­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_yolo_layer</span><span class="params">(<span class="keyword">const</span> layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//ç›´æ¥æŠŠ l.delta æ‹·è´ç»™ä¸Šä¸€å±‚çš„ deltaã€‚æ³¨æ„ net.delta æŒ‡å‘ prev_layer.deltaã€‚</span></span><br><span class="line">   <span class="built_in">axpy_cpu</span>(l.batch*l.inputs, <span class="number">1</span>, l.delta, <span class="number">1</span>, state.delta, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="correct-yolo-boxes-è°ƒæ•´é¢„æµ‹-box-ä¸­å¿ƒå’Œå¤§å°"><a href="#correct-yolo-boxes-è°ƒæ•´é¢„æµ‹-box-ä¸­å¿ƒå’Œå¤§å°" class="headerlink" title="correct_yolo_boxes è°ƒæ•´é¢„æµ‹ box ä¸­å¿ƒå’Œå¤§å°"></a>correct_yolo_boxes è°ƒæ•´é¢„æµ‹ box ä¸­å¿ƒå’Œå¤§å°</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒæ•´é¢„æµ‹ box ä¸­å¿ƒå’Œå¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">correct_yolo_boxes</span><span class="params">(detection *dets, <span class="keyword">int</span> n, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> netw, <span class="keyword">int</span> neth, <span class="keyword">int</span> relative, <span class="keyword">int</span> letter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//w å’Œ h æ˜¯è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸ï¼Œnetw å’Œ neth æ˜¯ç½‘ç»œè¾“å…¥å°ºå¯¸</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="comment">// network height (or width)</span></span><br><span class="line">    <span class="keyword">int</span> new_w = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// network height (or width)</span></span><br><span class="line">    <span class="keyword">int</span> new_h = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// Compute scale given image w,h vs network w,h</span></span><br><span class="line">    <span class="comment">// I think this &quot;rotates&quot; the image to match network to input image w/h ratio</span></span><br><span class="line">    <span class="comment">// new_h and new_w are really just network width and height</span></span><br><span class="line">    <span class="keyword">if</span> (letter) &#123;</span><br><span class="line">        <span class="keyword">if</span> (((<span class="keyword">float</span>)netw / w) &lt; ((<span class="keyword">float</span>)neth / h)) &#123; <span class="comment">//æ–°å›¾ç‰‡å°ºå¯¸</span></span><br><span class="line">            new_w = netw;</span><br><span class="line">            new_h = (h * netw) / w;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            new_h = neth;</span><br><span class="line">            new_w = (w * neth) / h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        new_w = netw;</span><br><span class="line">        new_h = neth;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// difference between network width and &quot;rotated&quot; width</span></span><br><span class="line">    <span class="keyword">float</span> deltaw = netw - new_w;</span><br><span class="line">    <span class="comment">// difference between network height and &quot;rotated&quot; height</span></span><br><span class="line">    <span class="keyword">float</span> deltah = neth - new_h;</span><br><span class="line">    <span class="comment">// ratio between rotated network width and network width</span></span><br><span class="line">    <span class="keyword">float</span> ratiow = (<span class="keyword">float</span>)new_w / netw;</span><br><span class="line">    <span class="comment">// ratio between rotated network width and network width</span></span><br><span class="line">    <span class="keyword">float</span> ratioh = (<span class="keyword">float</span>)new_h / neth;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123; <span class="comment">//è°ƒæ•´ box ç›¸å¯¹æ–°å›¾ç‰‡å°ºå¯¸çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">        box b = dets[i].bbox;</span><br><span class="line">        <span class="comment">// x = ( x - (deltaw/2)/netw ) / ratiow;</span></span><br><span class="line">        <span class="comment">//   x - [(1/2 the difference of the network width and rotated width) / (network width)]</span></span><br><span class="line">        b.x = (b.x - deltaw / <span class="number">2.</span> / netw) / ratiow;</span><br><span class="line">        b.y = (b.y - deltah / <span class="number">2.</span> / neth) / ratioh;</span><br><span class="line">        <span class="comment">// scale to match rotation of incoming image</span></span><br><span class="line">        b.w *= <span class="number">1</span> / ratiow;</span><br><span class="line">        b.h *= <span class="number">1</span> / ratioh;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// relative seems to always be == 1, I don&#x27;t think we hit this condition, ever.</span></span><br><span class="line">        <span class="keyword">if</span> (!relative) &#123;</span><br><span class="line">            b.x *= w;</span><br><span class="line">            b.w *= w;</span><br><span class="line">            b.y *= h;</span><br><span class="line">            b.h *= h;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dets[i].bbox = b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="yolo-num-detections-é¢„æµ‹è¾“å‡ºä¸­ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼çš„-box-ä¸ªæ•°"><a href="#yolo-num-detections-é¢„æµ‹è¾“å‡ºä¸­ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼çš„-box-ä¸ªæ•°" class="headerlink" title="yolo_num_detections é¢„æµ‹è¾“å‡ºä¸­ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼çš„ box ä¸ªæ•°"></a>yolo_num_detections é¢„æµ‹è¾“å‡ºä¸­ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼çš„ box ä¸ªæ•°</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¢„æµ‹è¾“å‡ºä¸­ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼çš„ box ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yolo_num_detections</span><span class="params">(layer l, <span class="keyword">float</span> thresh)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, n;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w*l.h; ++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(n = <span class="number">0</span>; n &lt; l.n; ++n)&#123;</span><br><span class="line">			<span class="comment">////è·å¾—ç½®ä¿¡åº¦åç§»ä½ç½®</span></span><br><span class="line">            <span class="keyword">int</span> obj_index  = <span class="built_in">entry_index</span>(l, <span class="number">0</span>, n*l.w*l.h + i, <span class="number">4</span>);</span><br><span class="line">			<span class="comment">//ç½®ä¿¡åº¦è¶…è¿‡é˜ˆå€¼</span></span><br><span class="line">            <span class="keyword">if</span>(l.output[obj_index] &gt; thresh)&#123;</span><br><span class="line">                ++count;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="get-yolo-detections-è·å¾—é¢„æµ‹è¾“å‡ºä¸­è¶…è¿‡é˜ˆå€¼çš„-box"><a href="#get-yolo-detections-è·å¾—é¢„æµ‹è¾“å‡ºä¸­è¶…è¿‡é˜ˆå€¼çš„-box" class="headerlink" title="get_yolo_detections è·å¾—é¢„æµ‹è¾“å‡ºä¸­è¶…è¿‡é˜ˆå€¼çš„ box"></a>get_yolo_detections è·å¾—é¢„æµ‹è¾“å‡ºä¸­è¶…è¿‡é˜ˆå€¼çš„ box</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å¾—é¢„æµ‹è¾“å‡ºä¸­è¶…è¿‡é˜ˆå€¼çš„ box</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_yolo_detections</span><span class="params">(layer l, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> netw, <span class="keyword">int</span> neth, <span class="keyword">float</span> thresh, <span class="keyword">int</span> *map, <span class="keyword">int</span> relative, detection *dets, <span class="keyword">int</span> letter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;\n l.batch = %d, l.w = %d, l.h = %d, l.n = %d \n&quot;, l.batch, l.w, l.h, l.n);</span></span><br><span class="line">    <span class="keyword">int</span> i,j,n;</span><br><span class="line">    <span class="keyword">float</span> *predictions = l.output;</span><br><span class="line">    <span class="comment">// This snippet below is not necessary</span></span><br><span class="line">    <span class="comment">// Need to comment it in order to batch processing &gt;= 2 images</span></span><br><span class="line">    <span class="comment">//if (l.batch == 2) avg_flipped_yolo(l);</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w*l.h; ++i)&#123;</span><br><span class="line">        <span class="keyword">int</span> row = i / l.w;</span><br><span class="line">        <span class="keyword">int</span> col = i % l.w;</span><br><span class="line">        <span class="keyword">for</span>(n = <span class="number">0</span>; n &lt; l.n; ++n)&#123;</span><br><span class="line">            <span class="keyword">int</span> obj_index  = <span class="built_in">entry_index</span>(l, <span class="number">0</span>, n*l.w*l.h + i, <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">float</span> objectness = predictions[obj_index]; <span class="comment">//ç½®ä¿¡åº¦</span></span><br><span class="line">            <span class="comment">//if(objectness &lt;= thresh) continue;    // incorrect behavior for Nan values</span></span><br><span class="line">            <span class="keyword">if</span> (objectness &gt; thresh) &#123;</span><br><span class="line">                <span class="comment">//printf(&quot;\n objectness = %f, thresh = %f, i = %d, n = %d \n&quot;, objectness, thresh, i, n);</span></span><br><span class="line">                <span class="keyword">int</span> box_index = <span class="built_in">entry_index</span>(l, <span class="number">0</span>, n*l.w*l.h + i, <span class="number">0</span>);</span><br><span class="line">                dets[count].bbox = <span class="built_in">get_yolo_box</span>(predictions, l.biases, l.mask[n], box_index, col, row, l.w, l.h, netw, neth, l.w*l.h);</span><br><span class="line">                dets[count].objectness = objectness;</span><br><span class="line">                dets[count].classes = l.classes;</span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.classes; ++j) &#123;</span><br><span class="line">                    <span class="keyword">int</span> class_index = <span class="built_in">entry_index</span>(l, <span class="number">0</span>, n*l.w*l.h + i, <span class="number">4</span> + <span class="number">1</span> + j);</span><br><span class="line">                    <span class="keyword">float</span> prob = objectness*predictions[class_index];<span class="comment">//ç½®ä¿¡åº¦ x ç±»åˆ«æ¦‚ç‡</span></span><br><span class="line">                    dets[count].prob[j] = (prob &gt; thresh) ? prob : <span class="number">0</span>;<span class="comment">//å°äºé˜ˆå€¼åˆ™æ¦‚ç‡ç½®0</span></span><br><span class="line">                &#125;</span><br><span class="line">                ++count;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">correct_yolo_boxes</span>(dets, count, w, h, netw, neth, relative, letter);<span class="comment">//è°ƒæ•´ box å¤§å°</span></span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOV2æŸå¤±å‡½æ•°ä»£ç è¯¦è§£(region_layer.c)</title>
    <url>/2020/02/27/YOLOV2%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3(region_layer.c)/</url>
    <content><![CDATA[<h2 id="YOLOV2æŸå¤±å‡½æ•°"><a href="#YOLOV2æŸå¤±å‡½æ•°" class="headerlink" title="YOLOV2æŸå¤±å‡½æ•°"></a>YOLOV2æŸå¤±å‡½æ•°</h2><p>YOLOV2å¯¹æ¯ä¸ªé¢„æµ‹<code>box</code>çš„<code>[x,y]</code>ï¼Œ<code>confidence</code>è¿›è¡Œé€»è¾‘å›å½’ï¼Œç±»åˆ«è¿›è¡Œ<code>softmax</code>å›å½’ï¼›</p>
<p>åœ¨Darknetä¸­ï¼ŒæŸå¤±å‡½æ•°å¯ä»¥ç”¨ä¸‹å›¾æ¥è¿›è¡Œè¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/661.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæŸå¤±å‡½æ•°æ˜¯ç›¸å½“å¤æ‚çš„ï¼ŒæŸå¤±å‡½æ•°çš„å®šä¹‰åœ¨Darknet/src/region_layer.cä¸­ã€‚å¯¹äºä¸Šé¢è¿™ä¸€å †å…¬å¼ï¼Œæˆ‘ä»¬å…ˆç®€å•çœ‹ä¸€ä¸‹ï¼Œç„¶åæˆ‘ä»¬åœ¨æºç ä¸­å»æ‰¾åˆ°å¯¹åº”éƒ¨åˆ†ã€‚è¿™é‡Œçš„$W$å’Œ$H$ä»£è¡¨çš„æ˜¯ç‰¹å¾å›¾çš„é«˜å®½ï¼Œéƒ½ä¸º13ï¼Œè€Œ$A$æŒ‡çš„æ˜¯Anchorä¸ªæ•°ï¼ŒYOLOv2ä¸­æ˜¯5ï¼Œå„ä¸ª$\lambda$å€¼æ˜¯å„ä¸ªlosséƒ¨åˆ†çš„æƒé‡ç³»æ•°ã€‚æˆ‘ä»¬å°†æŸå¤±å‡½æ•°åˆ†æˆ3å¤§éƒ¨åˆ†æ¥è§£é‡Šï¼š</p>
<ul>
<li><p>ç¬¬ä¸€éƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/662.png" alt><br>ç¬¬ä¸€é¡¹éœ€è¦å¥½å¥½è§£é‡Šä¸€ä¸‹ï¼Œè¿™ä¸ªlossæ˜¯è®¡ç®—backgroundçš„ç½®ä¿¡åº¦è¯¯å·®ï¼Œè¿™ä¹Ÿæ˜¯YOLOç³»åˆ—ç®—æ³•çš„ç‰¹è‰²ï¼Œä½†æ˜¯ç”¨å“ªäº›é¢„æµ‹æ¡†æ¥é¢„æµ‹èƒŒæ™¯å‘¢ï¼Ÿè¿™é‡Œéœ€è¦è®¡ç®—å„ä¸ªé¢„æµ‹æ¡†å’Œæ‰€æœ‰çš„ground  truthä¹‹é—´çš„IOUå€¼ï¼Œå¹¶ä¸”å–æœ€å¤§å€¼è®°ä½œMaxIOUï¼Œå¦‚æœè¯¥å€¼å°äºä¸€å®šçš„é˜ˆå€¼ï¼ŒYOLOv2è®ºæ–‡å–äº†0.6ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢„æµ‹æ¡†å°±æ ‡è®°ä¸ºbackgroundï¼Œéœ€è¦è®¡ç®—$\lambda_{n o o b j}$è¿™ä¹ˆå¤šå€çš„æŸå¤±å‡½æ•°ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªå…¬å¼å¯ä»¥è¿™æ ·è¡¨è¾¾å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æœ‰ç‰©ä½“çš„è¯ï¼Œé‚£ä¹ˆ$\lambda_{n o o b j}=0$ï¼Œå¦‚æœæ²¡æœ‰ç‰©ä½“$\lambda_{\text {noob} j}=1$ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå€¼å¸¦å…¥åˆ°ä¸‹é¢çš„å…¬å¼å°±å¯ä»¥æ¨å‡ºç¬¬ä¸€é¡¹å•¦ï¼<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/663.webp" alt></p>
</li>
<li><p>ç¬¬äºŒéƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/664.png" alt><br>è¿™ä¸€éƒ¨åˆ†æ˜¯è®¡ç®—Anchor boxeså’Œé¢„æµ‹æ¡†çš„åæ ‡è¯¯å·®ï¼Œä½†æ˜¯åªåœ¨å‰12800ä¸ªiterè®¡ç®—ï¼Œè¿™ä¸€é¡¹åº”è¯¥æ˜¯ä¿ƒè¿›ç½‘ç»œå­¦ä¹ åˆ°Anchorçš„å½¢çŠ¶ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/665.webp" alt><br>è¿™ä¸€éƒ¨åˆ†è®¡ç®—çš„æ˜¯å’Œground truthåŒ¹é…çš„é¢„æµ‹æ¡†å„éƒ¨åˆ†çš„æŸå¤±æ€»å’Œï¼ŒåŒ…æ‹¬åæ ‡æŸå¤±ï¼Œç½®ä¿¡åº¦æŸå¤±ä»¥åŠåˆ†ç±»æŸå¤±ã€‚<br><strong>3.1 åæ ‡æŸå¤±</strong> è¿™é‡Œçš„åŒ¹é…åŸåˆ™æ˜¯æŒ‡å¯¹äºæŸä¸ªç‰¹å®šçš„ground truthï¼Œé¦–å…ˆè¦è®¡ç®—å…¶ä¸­å¿ƒç‚¹è½åœ¨å“ªä¸ªcellä¸Šï¼Œç„¶åè®¡ç®—è¿™ä¸ªcellçš„5ä¸ªå…ˆéªŒæ¡†å’Œgrond  truthçš„IOUå€¼ï¼Œè®¡ç®—IOUå€¼çš„æ—¶å€™ä¸è€ƒè™‘åæ ‡åªè€ƒè™‘å½¢çŠ¶ï¼Œæ‰€ä»¥å…ˆå°†Anchor boxeså’Œground  truthçš„ä¸­å¿ƒéƒ½åç§»åˆ°åŒä¸€ä½ç½®ï¼Œç„¶åè®¡ç®—å‡ºå¯¹åº”çš„IOUå€¼ï¼ŒIOUå€¼æœ€å¤§çš„å…ˆéªŒæ¡†å’Œground  truthåŒ¹é…ï¼Œå¯¹åº”çš„é¢„æµ‹æ¡†ç”¨æ¥é¢„æµ‹è¿™ä¸ªground truthã€‚<br><strong>3.2 ç½®ä¿¡åº¦æŸå¤±</strong> åœ¨è®¡ç®—objç½®ä¿¡åº¦æ—¶ï¼Œ å¢åŠ äº†ä¸€é¡¹æƒé‡ç³»æ•°ï¼Œä¹Ÿè¢«ç§°ä¸ºrescoreå‚æ•°ï¼Œå½“å…¶ä¸º1æ—¶ï¼ŒæŸå¤±æ˜¯é¢„æµ‹æ¡†å’Œground truthçš„çœŸå®IOUå€¼(darknetä¸­é‡‡ç”¨äº†è¿™ç§å®ç°æ–¹å¼)ã€‚è€Œå¯¹äºæ²¡æœ‰å’Œground  truthåŒ¹é…çš„å…ˆéªŒæ¡†ï¼Œé™¤å»é‚£äº›Max_IOUä½äºé˜ˆå€¼çš„ï¼Œå…¶å®ƒå°±å…¨éƒ¨å¿½ç•¥ã€‚YOLOv2å’ŒSSDä¸RPNç½‘ç»œçš„å¤„ç†æ–¹å¼æœ‰å¾ˆå¤§ä¸åŒï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å°†ä¸€ä¸ªground truthåˆ†é…ç»™å¤šä¸ªå…ˆéªŒæ¡†ã€‚<br><strong>3.3 åˆ†ç±»æŸå¤±</strong> è¿™ä¸ªå’ŒYOLOv1ä¸€è‡´ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ã€‚</p>
</li>
</ul>
<p>æˆ‘çœ‹äº†ä¸€ç¯‡è®²è§£YOLOv2æŸå¤±å‡½æ•°éå¸¸å¥½çš„æ–‡ç« ï¼š<a href="https://www.cnblogs.com/YiXiaoZhou/p/7429481.html">https://www.cnblogs.com/YiXiaoZhou/p/7429481.html</a> ã€‚é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹ï¼š</p>
<p>åœ¨è®¡ç®—boxesçš„$w$å’Œ$h$è¯¯å·®æ—¶ï¼ŒYOLOv1ä¸­é‡‡ç”¨çš„æ˜¯å¹³æ–¹æ ¹ä»¥é™ä½boxesçš„å¤§å°å¯¹è¯¯å·®çš„å½±å“ï¼Œè€ŒYOLOv2æ˜¯ç›´æ¥è®¡ç®—ï¼Œä½†æ˜¯æ ¹æ®ground truthçš„å¤§å°å¯¹æƒé‡ç³»æ•°è¿›è¡Œä¿®æ­£ï¼šl.coord_scale x (2 - truth.w x truth.h)ï¼ˆè¿™é‡Œå’Œéƒ½å½’ä¸€åŒ–åˆ°(0,1))ï¼Œè¿™æ ·å¯¹äºå°ºåº¦è¾ƒå°çš„boxeså…¶æƒé‡ç³»æ•°ä¼šæ›´å¤§ä¸€äº›ï¼Œå¯ä»¥æ”¾å¤§è¯¯å·®ï¼Œèµ·åˆ°å’ŒYOLOv1è®¡ç®—å¹³æ–¹æ ¹ç›¸ä¼¼çš„æ•ˆæœã€‚</p>
<h2 id="ä»£ç è¯¦è§£"><a href="#ä»£ç è¯¦è§£" class="headerlink" title="ä»£ç è¯¦è§£"></a>ä»£ç è¯¦è§£</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DOABS 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºYOLOv2 region_layerå±‚</span></span><br><span class="line"><span class="comment">// batch ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡æ•°</span></span><br><span class="line"><span class="comment">// w è¾“å…¥ç‰¹å¾å›¾çš„å®½åº¦</span></span><br><span class="line"><span class="comment">// h è¾“å…¥ç‰¹å¾å›¾çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">// n ä¸€ä¸ªcellé¢„æµ‹å¤šå°‘ä¸ªbbox</span></span><br><span class="line"><span class="comment">// classes ç½‘ç»œéœ€è¦è¯†åˆ«çš„ç‰©ä½“ç±»åˆ«æ•°</span></span><br><span class="line"><span class="comment">// coord ä¸€ä¸ªbboxåŒ…å«çš„[x,y,w,h]</span></span><br><span class="line"><span class="function">region_layer <span class="title">make_region_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> n, <span class="keyword">int</span> classes, <span class="keyword">int</span> coords, <span class="keyword">int</span> max_boxes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    region_layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    l.type = REGION; <span class="comment">//å±‚ç±»åˆ«</span></span><br><span class="line">	<span class="comment">// è¿™äº›å˜é‡éƒ½å¯ä»¥å‚è€ƒdarknet.hä¸­çš„æ³¨é‡Š</span></span><br><span class="line">    l.n = n; <span class="comment">//ä¸€ä¸ªcellä¸­é¢„æµ‹å¤šå°‘ä¸ªbox</span></span><br><span class="line">    l.batch = batch; <span class="comment">//ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡æ•°</span></span><br><span class="line">    l.h = h; <span class="comment">//è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">    l.w = w; <span class="comment">//è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">    l.classes = classes; <span class="comment">//ç½‘ç»œéœ€è¦è¯†åˆ«çš„ç‰©ä½“ç±»æ•°</span></span><br><span class="line">    l.coords = coords; <span class="comment">//å®šä½ä¸€ä¸ªç‰©ä½“æ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼ˆä¸€èˆ¬å€¼ä¸º4,åŒ…æ‹¬çŸ©å½¢ä¸­å¿ƒç‚¹åæ ‡x,yä»¥åŠé•¿å®½w,hï¼‰</span></span><br><span class="line">    l.cost = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//ç›®æ ‡å‡½æ•°å€¼ï¼Œä¸ºå•ç²¾åº¦æµ®ç‚¹å‹æŒ‡é’ˆ</span></span><br><span class="line">    l.biases = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(n * <span class="number">2</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    l.bias_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(n * <span class="number">2</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    l.outputs = h*w*n*(classes + coords + <span class="number">1</span>);  <span class="comment">//ä¸€å¼ è®­ç»ƒå›¾ç‰‡ç»è¿‡region_layerå±‚åå¾—åˆ°çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼ˆç­‰äºç½‘æ ¼æ•°*æ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„çŸ©å½¢æ¡†æ•°*æ¯ä¸ªçŸ©å½¢æ¡†çš„å‚æ•°ä¸ªæ•°ï¼‰</span></span><br><span class="line">    l.inputs = l.outputs;   <span class="comment">//ä¸€å¼ è®­ç»ƒå›¾ç‰‡è¾“å…¥åˆ°reigon_layerå±‚çš„å…ƒç´ ä¸ªæ•°ï¼ˆæ³¨æ„æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå¯¹äºregion_layerï¼Œè¾“å…¥å’Œè¾“å‡ºçš„å…ƒç´ ä¸ªæ•°ç›¸ç­‰ï¼‰</span></span><br><span class="line">    <span class="comment">//æ¯å¼ å›¾ç‰‡å«æœ‰çš„çœŸå®çŸ©å½¢æ¡†å‚æ•°çš„ä¸ªæ•°ï¼ˆmax_boxesè¡¨ç¤ºä¸€å¼ å›¾ç‰‡ä¸­æœ€å¤šæœ‰max_boxesä¸ªground truthçŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçœŸå®çŸ©å½¢æ¡†æœ‰</span></span><br><span class="line">    <span class="comment">//5ä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬x,y,w,hå››ä¸ªå®šä½å‚æ•°ï¼Œä»¥åŠç‰©ä½“ç±»åˆ«ï¼‰,æ³¨æ„max_boxesæ˜¯darknetç¨‹åºå†…å†™æ­»çš„ï¼Œå®é™…ä¸Šæ¯å¼ å›¾ç‰‡å¯èƒ½</span></span><br><span class="line">    <span class="comment">//å¹¶æ²¡æœ‰max_boxesä¸ªçœŸå®çŸ©å½¢æ¡†ï¼Œä¹Ÿèƒ½æ²¡æœ‰è¿™ä¹ˆå¤šå‚æ•°ï¼Œä½†ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œè¿˜æ˜¯ä¼šç•™ç€è¿™ä¹ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œåªæ˜¯å…¶ä¸­çš„</span></span><br><span class="line">    <span class="comment">//å€¼ä¸ºç©ºè€Œå·².</span></span><br><span class="line">	l.max_boxes = max_boxes;</span><br><span class="line">	<span class="comment">// GT: max_boxes*(4+1) å­˜å‚¨max_boxesä¸ªbboxçš„ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯å‡è®¾å›¾ç‰‡ä¸­GT bboxçš„æ•°é‡æ˜¯</span></span><br><span class="line">	<span class="comment">//å°äºmax_boxesçš„ï¼Œè¿™é‡Œæ˜¯å†™æ­»çš„ï¼›æ­¤å¤„ä¸yolov1æ˜¯ä¸åŒçš„</span></span><br><span class="line">    l.truths = max_boxes*(<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//  regionå±‚è¯¯å·®é¡¹ï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line">    l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">// regionå±‚æ‰€æœ‰è¾“å‡ºï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line">    <span class="comment">//region_layerçš„è¾“å‡ºç»´åº¦æ˜¯l.out_w*l.out_hï¼Œç­‰äºè¾“å‡ºçš„ç»´åº¦ï¼Œè¾“å‡ºçš„é€šé“æ•°ä¸ºl.out_cï¼Œä¹Ÿå³æ˜¯è¾“å…¥çš„é€šé“æ•°ï¼Œå…·ä½“ä¸ºï¼šn*(classes+coords+1)</span></span><br><span class="line">	<span class="comment">//YOLOæ£€æµ‹æ¨¡å‹å°†å›¾ç‰‡åˆ†æˆS*Sä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼åˆé¢„æµ‹Bä¸ªçŸ©å½¢æ¡†ï¼Œæœ€åä¸€å±‚è¾“å‡ºçš„å°±æ˜¯è¿™äº›ç½‘æ ¼ä¸­åŒ…å«çš„æ‰€æœ‰çŸ©å½¢æ¡†çš„ä¿¡æ¯</span></span><br><span class="line">	l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">//å­˜å‚¨bboxçš„Anchor boxçš„[w,h]çš„åˆå§‹åŒ–,åœ¨src/parse.cä¸­parse_yoloå‡½æ•°ä¼šåŠ è½½cfgä¸­Anchorå°ºå¯¸</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n*<span class="number">2</span>; ++i)&#123;</span><br><span class="line">        l.biases[i] = <span class="number">.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    l.forward = forward_region_layer;</span><br><span class="line">    l.backward = backward_region_layer;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    l.forward_gpu = forward_region_layer_gpu;</span><br><span class="line">    l.backward_gpu = backward_region_layer_gpu;</span><br><span class="line">    l.output_gpu = <span class="built_in">cuda_make_array</span>(l.output, batch*l.outputs);</span><br><span class="line">    l.delta_gpu = <span class="built_in">cuda_make_array</span>(l.delta, batch*l.outputs);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;detection\n&quot;</span>);</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize_region_layer</span><span class="params">(layer *l, <span class="keyword">int</span> w, <span class="keyword">int</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="keyword">int</span> old_w = l-&gt;w;</span><br><span class="line">    <span class="keyword">int</span> old_h = l-&gt;h;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    l-&gt;w = w;</span><br><span class="line">    l-&gt;h = h;</span><br><span class="line"></span><br><span class="line">    l-&gt;outputs = h*w*l-&gt;n*(l-&gt;classes + l-&gt;coords + <span class="number">1</span>);</span><br><span class="line">    l-&gt;inputs = l-&gt;outputs;</span><br><span class="line"></span><br><span class="line">    l-&gt;output = (<span class="keyword">float</span>*)<span class="built_in">xrealloc</span>(l-&gt;output, l-&gt;batch * l-&gt;outputs * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    l-&gt;delta = (<span class="keyword">float</span>*)<span class="built_in">xrealloc</span>(l-&gt;delta, l-&gt;batch * l-&gt;outputs * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="keyword">if</span> (old_w &lt; w || old_h &lt; h) &#123;</span><br><span class="line">        <span class="built_in">cuda_free</span>(l-&gt;delta_gpu);</span><br><span class="line">        <span class="built_in">cuda_free</span>(l-&gt;output_gpu);</span><br><span class="line"></span><br><span class="line">        l-&gt;delta_gpu = <span class="built_in">cuda_make_array</span>(l-&gt;delta, l-&gt;batch*l-&gt;outputs);</span><br><span class="line">        l-&gt;output_gpu = <span class="built_in">cuda_make_array</span>(l-&gt;output, l-&gt;batch*l-&gt;outputs);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–æŸä¸ªçŸ©å½¢æ¡†çš„4ä¸ªå®šä½ä¿¡æ¯ï¼Œå³æ ¹æ®è¾“å…¥çš„çŸ©å½¢æ¡†ç´¢å¼•ä»l.outputä¸­è·å–è¯¥çŸ©å½¢æ¡†çš„å®šä½ä¿¡æ¯x,y,w,h</span></span><br><span class="line"><span class="comment">//x  region_layerçš„è¾“å‡ºï¼Œå³l.outputï¼ŒåŒ…å«æ‰€æœ‰batché¢„æµ‹å¾—åˆ°çš„çŸ©å½¢æ¡†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//biases è¡¨ç¤ºAnchoræ¡†çš„é•¿å’Œå®½</span></span><br><span class="line"><span class="comment">//index çŸ©å½¢æ¡†çš„é¦–åœ°å€ï¼ˆç´¢å¼•ï¼ŒçŸ©å½¢æ¡†ä¸­å­˜å‚¨çš„é¦–ä¸ªå‚æ•°xåœ¨l.outputä¸­çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="comment">//i ç¬¬å‡ è¡Œï¼ˆregion_layerç»´åº¦ä¸ºl.out_w*l.out_cï¼‰</span></span><br><span class="line"><span class="comment">//j ç¬¬å‡ åˆ—</span></span><br><span class="line"><span class="comment">//w ç‰¹å¾å›¾çš„å®½åº¦</span></span><br><span class="line"><span class="comment">//h ç‰¹å¾å›¾çš„é«˜åº¦</span></span><br><span class="line"><span class="function">box <span class="title">get_region_box</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *biases, <span class="keyword">int</span> n, <span class="keyword">int</span> index, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> w, <span class="keyword">int</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    box b;</span><br><span class="line">    b.x = (i + <span class="built_in">logistic_activate</span>(x[index + <span class="number">0</span>])) / w;</span><br><span class="line">    b.y = (j + <span class="built_in">logistic_activate</span>(x[index + <span class="number">1</span>])) / h;</span><br><span class="line">    b.w = <span class="built_in">exp</span>(x[index + <span class="number">2</span>]) * biases[<span class="number">2</span>*n];</span><br><span class="line">    b.h = <span class="built_in">exp</span>(x[index + <span class="number">3</span>]) * biases[<span class="number">2</span>*n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span>(DOABS)&#123;</span><br><span class="line">        b.w = <span class="built_in">exp</span>(x[index + <span class="number">2</span>]) * biases[<span class="number">2</span>*n]   / w;</span><br><span class="line">        b.h = <span class="built_in">exp</span>(x[index + <span class="number">3</span>]) * biases[<span class="number">2</span>*n+<span class="number">1</span>] / h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">delta_region_box</span><span class="params">(box truth, <span class="keyword">float</span> *x, <span class="keyword">float</span> *biases, <span class="keyword">int</span> n, <span class="keyword">int</span> index, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">float</span> *delta, <span class="keyword">float</span> scale)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxåœ¨å½“å‰ç‰¹å¾å›¾ä¸Šä½ç½®å’Œå®½é«˜</span></span><br><span class="line">    box pred = <span class="built_in">get_region_box</span>(x, biases, n, index, i, j, w, h);</span><br><span class="line">	<span class="comment">// è®¡ç®—pred bbox ä¸ GT bboxçš„IOUã€å‰12800GT booxä¸ºå½“å‰cellç¬¬nä¸ªbboxçš„Anchorã€‘</span></span><br><span class="line">    <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—GT bboxçš„tx,ty,tw,th</span></span><br><span class="line">    <span class="keyword">float</span> tx = (truth.x*w - i);</span><br><span class="line">    <span class="keyword">float</span> ty = (truth.y*h - j);</span><br><span class="line">    <span class="keyword">float</span> tw = <span class="built_in">log</span>(truth.w / biases[<span class="number">2</span>*n]);</span><br><span class="line">    <span class="keyword">float</span> th = <span class="built_in">log</span>(truth.h / biases[<span class="number">2</span>*n + <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span>(DOABS)&#123;</span><br><span class="line">        tw = <span class="built_in">log</span>(truth.w*w / biases[<span class="number">2</span>*n]);</span><br><span class="line">        th = <span class="built_in">log</span>(truth.h*h / biases[<span class="number">2</span>*n + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—tx,ty,tw,thæ¢¯åº¦</span></span><br><span class="line">    delta[index + <span class="number">0</span>] = scale * (tx - <span class="built_in">logistic_activate</span>(x[index + <span class="number">0</span>])) * <span class="built_in">logistic_gradient</span>(<span class="built_in">logistic_activate</span>(x[index + <span class="number">0</span>]));</span><br><span class="line">    delta[index + <span class="number">1</span>] = scale * (ty - <span class="built_in">logistic_activate</span>(x[index + <span class="number">1</span>])) * <span class="built_in">logistic_gradient</span>(<span class="built_in">logistic_activate</span>(x[index + <span class="number">1</span>]));</span><br><span class="line">    delta[index + <span class="number">2</span>] = scale * (tw - x[index + <span class="number">2</span>]);</span><br><span class="line">    delta[index + <span class="number">3</span>] = scale * (th - x[index + <span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> iou;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delta_region_class</span><span class="params">(<span class="keyword">float</span> *output, <span class="keyword">float</span> *delta, <span class="keyword">int</span> index, <span class="keyword">int</span> class_id, <span class="keyword">int</span> classes, tree *hier, <span class="keyword">float</span> scale, <span class="keyword">float</span> *avg_cat, <span class="keyword">int</span> focal_loss)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, n;</span><br><span class="line">    <span class="keyword">if</span>(hier)&#123; <span class="comment">// åœ¨yolov2 ä¸­regionå±‚, æ­¤éƒ¨åˆ†ä¸å‚ä¸è®¡ç®—ã€è¿™æ˜¯åœ¨yolo9000æ‰å‚ä¸è®¡ç®—ã€‘</span></span><br><span class="line">        <span class="keyword">float</span> pred = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(class_id &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            pred *= output[index + class_id];</span><br><span class="line">            <span class="keyword">int</span> g = hier-&gt;group[class_id];</span><br><span class="line">            <span class="keyword">int</span> offset = hier-&gt;group_offset[g];</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; hier-&gt;group_size[g]; ++i)&#123;</span><br><span class="line">                delta[index + offset + i] = scale * (<span class="number">0</span> - output[index + offset + i]);</span><br><span class="line">            &#125;</span><br><span class="line">            delta[index + class_id] = scale * (<span class="number">1</span> - output[index + class_id]);</span><br><span class="line"></span><br><span class="line">            class_id = hier-&gt;parent[class_id];</span><br><span class="line">        &#125;</span><br><span class="line">        *avg_cat += pred;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Focal loss</span></span><br><span class="line">        <span class="keyword">if</span> (focal_loss) &#123; <span class="comment">//å¦‚æœä½¿ç”¨focal loss</span></span><br><span class="line">            <span class="comment">// Focal Loss</span></span><br><span class="line">            <span class="keyword">float</span> alpha = <span class="number">0.5</span>;    <span class="comment">// 0.25 or 0.5</span></span><br><span class="line">            <span class="comment">//float gamma = 2;    // hardcoded in many places of the grad-formula</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> ti = index + class_id;</span><br><span class="line">            <span class="keyword">float</span> pt = output[ti] + <span class="number">0.000000000000001F</span>;</span><br><span class="line">            <span class="comment">// http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiItKDEteCkqKDIqeCpsb2coeCkreC0xKSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMH1d</span></span><br><span class="line">            <span class="keyword">float</span> grad = -(<span class="number">1</span> - pt) * (<span class="number">2</span> * pt*<span class="built_in">logf</span>(pt) + pt - <span class="number">1</span>);    <span class="comment">// http://blog.csdn.net/linmingan/article/details/77885832</span></span><br><span class="line">            <span class="comment">//float grad = (1 - pt) * (2 * pt*logf(pt) + pt - 1);    // https://github.com/unsky/focal-loss</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; classes; ++n) &#123;</span><br><span class="line">				<span class="comment">// focal lossçš„æ¢¯åº¦</span></span><br><span class="line">                delta[index + n] = scale * (((n == class_id) ? <span class="number">1</span> : <span class="number">0</span>) - output[index + n]);</span><br><span class="line"></span><br><span class="line">                delta[index + n] *= alpha*grad;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (n == class_id) *avg_cat += output[index + n];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// default</span></span><br><span class="line">            <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; classes; ++n) &#123;</span><br><span class="line">				<span class="comment">// è®¡ç®—ç±»åˆ«æŸå¤±çš„æ¢¯åº¦, åå‘ä¼ é€’åˆ°è¯¯å·®é¡¹l.deltaä¸­, åœ¨yolo v2ä¸­scale=1</span></span><br><span class="line">                delta[index + n] = scale * (((n == class_id) ? <span class="number">1</span> : <span class="number">0</span>) - output[index + n]);</span><br><span class="line">                <span class="keyword">if</span> (n == class_id) *avg_cat += output[index + n];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">logit</span><span class="params">(<span class="keyword">float</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">log</span>(x/(<span class="number">1.</span>-x));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">tisnan</span><span class="params">(<span class="keyword">float</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x != x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief è®¡ç®—æŸä¸ªçŸ©å½¢æ¡†ä¸­æŸä¸ªå‚æ•°åœ¨l.outputä¸­çš„ç´¢å¼•ã€‚ä¸€ä¸ªçŸ©å½¢æ¡†åŒ…å«äº†x,y,w,h,c,C1,C2...,Cnä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment"> *        å‰å››ä¸ªç”¨äºå®šä½ï¼Œç¬¬äº”ä¸ªä¸ºçŸ©å½¢æ¡†å«æœ‰ç‰©ä½“çš„ç½®ä¿¡åº¦ä¿¡æ¯cï¼Œå³çŸ©å½¢æ¡†ä¸­å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡ä¸ºå¤šå¤§ï¼Œè€ŒC1åˆ°Cn</span></span><br><span class="line"><span class="comment"> *        ä¸ºçŸ©å½¢æ¡†ä¸­æ‰€åŒ…å«çš„ç‰©ä½“åˆ†åˆ«å±äºè¿™nç±»ç‰©ä½“çš„æ¦‚ç‡ã€‚æœ¬å‡½æ•°è´Ÿè´£è·å–è¯¥çŸ©å½¢æ¡†é¦–ä¸ªå®šä½ä¿¡æ¯ä¹Ÿå³xå€¼åœ¨</span></span><br><span class="line"><span class="comment"> *        l.outputä¸­ç´¢å¼•ã€è·å–è¯¥çŸ©å½¢æ¡†ç½®ä¿¡åº¦ä¿¡æ¯cåœ¨l.outputä¸­çš„ç´¢å¼•ã€è·å–è¯¥çŸ©å½¢æ¡†åˆ†ç±»æ‰€å±æ¦‚ç‡çš„é¦–ä¸ª</span></span><br><span class="line"><span class="comment"> *        æ¦‚ç‡ä¹Ÿå³C1å€¼çš„ç´¢å¼•ï¼Œå…·ä½“æ˜¯è·å–çŸ©å½¢æ¡†å“ªä¸ªå‚æ•°çš„ç´¢å¼•ï¼Œå–å†³äºè¾“å…¥å‚æ•°entryçš„å€¼ï¼Œè¿™äº›åœ¨</span></span><br><span class="line"><span class="comment"> *        forward_region_layer()å‡½æ•°ä¸­éƒ½æœ‰ç”¨åˆ°ï¼Œç”±äºl.outputçš„å­˜å‚¨æ–¹å¼ï¼Œå½“entry=0æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†</span></span><br><span class="line"><span class="comment"> *        xå‚æ•°åœ¨l.outputä¸­çš„ç´¢å¼•ï¼›å½“entry=4æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†ç½®ä¿¡åº¦ä¿¡æ¯cåœ¨l.outputä¸­çš„ç´¢å¼•ï¼›å½“</span></span><br><span class="line"><span class="comment"> *        entry=5æ—¶ï¼Œå°±æ˜¯è·å–çŸ©å½¢æ¡†é¦–ä¸ªæ‰€å±æ¦‚ç‡C1åœ¨l.outputä¸­çš„ç´¢å¼•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒforward_region_layer()</span></span><br><span class="line"><span class="comment"> *        ä¸­è°ƒç”¨æœ¬å‡½æ•°æ—¶çš„æ³¨é‡Š.</span></span><br><span class="line"><span class="comment"> * @param l å½“å‰region_layer</span></span><br><span class="line"><span class="comment"> * @param batch å½“å‰ç…§ç‰‡æ˜¯æ•´ä¸ªbatchä¸­çš„ç¬¬å‡ å¼ ï¼Œå› ä¸ºl.outputä¸­åŒ…å«æ•´ä¸ªbatchçš„è¾“å‡ºï¼Œæ‰€ä»¥è¦å®šä½æŸå¼ è®­ç»ƒå›¾ç‰‡</span></span><br><span class="line"><span class="comment"> *              è¾“å‡ºçš„ä¼—å¤šç½‘æ ¼ä¸­çš„æŸä¸ªçŸ©å½¢æ¡†ï¼Œå½“ç„¶éœ€è¦è¯¥å‚æ•°.</span></span><br><span class="line"><span class="comment"> * @param location è¿™ä¸ªå‚æ•°ï¼Œè¯´å®è¯ï¼Œæ„Ÿè§‰åƒä¸ªé¸¡è‚‹å‚æ•°ï¼Œå‡½æ•°ä¸­ç”¨è¿™ä¸ªå‚æ•°è·å–nå’Œlocçš„å€¼ï¼Œè¿™ä¸ªnå°±æ˜¯è¡¨ç¤ºç½‘æ ¼ä¸­</span></span><br><span class="line"><span class="comment"> *                 çš„ç¬¬å‡ ä¸ªé¢„æµ‹çŸ©å½¢æ¡†ï¼ˆæ¯”å¦‚æ¯ä¸ªç½‘æ ¼é¢„æµ‹5ä¸ªçŸ©å½¢æ¡†ï¼Œé‚£ä¹ˆnå–å€¼èŒƒå›´å°±æ˜¯ä»0~4ï¼Œlocå°±æ˜¯æŸä¸ª</span></span><br><span class="line"><span class="comment"> *                 é€šé“ä¸Šçš„å…ƒç´ åç§»ï¼ˆregion_layerè¾“å‡ºçš„é€šé“æ•°ä¸ºl.out_c = (classes + coords + 1)ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 è¿™æ ·è¯´å¯èƒ½æ²¡æœ‰è¯´æ˜ç™½ï¼Œè¿™éƒ½ä¸l.outputçš„å­˜å‚¨ç»“æ„ç›¸å…³ï¼Œè§ä¸‹é¢è¯¦ç»†æ³¨é‡Šä»¥åŠå…¶ä»–è¯´æ˜ã€‚æ€»ä¹‹ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 æŸ¥çœ‹ä¸€ä¸‹è°ƒç”¨æœ¬å‡½æ•°çš„çˆ¶å‡½æ•°forward_region_layer()å°±çŸ¥é“äº†ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥nå’Œj*l.w+içš„ï¼Œ</span></span><br><span class="line"><span class="comment"> *                 æ²¡æœ‰å¿…è¦è¾“å…¥locationï¼Œè¿™æ ·è¿˜å¾—é‡æ–°è®¡ç®—ä¸€æ¬¡nå’Œloc.</span></span><br><span class="line"><span class="comment"> * @param entry åˆ‡å…¥ç‚¹åç§»ç³»æ•°ï¼Œå…³äºè¿™ä¸ªå‚æ•°ï¼Œå°±åˆè¦æ‰¯åˆ°l.outputçš„å­˜å‚¨ç»“æ„äº†ï¼Œè§ä¸‹é¢è¯¦ç»†æ³¨é‡Šä»¥åŠå…¶ä»–è¯´æ˜.</span></span><br><span class="line"><span class="comment"> * @details l.outputè¿™ä¸ªå‚æ•°çš„å­˜å‚¨å†…å®¹ä»¥åŠå­˜å‚¨æ–¹å¼å·²ç»åœ¨å¤šä¸ªåœ°æ–¹è¯´æ˜äº†ï¼Œå†å¤šçš„æ–‡å­—éƒ½ä¸åŠå›¾æ–‡è¯´æ˜ï¼Œæ­¤å¤„å†</span></span><br><span class="line"><span class="comment"> *          ç®€è¦ç½—å—¦å‡ å¥ï¼Œæ›´ä¸ºå…·ä½“çš„å‚è€ƒå›¾æ–‡è¯´æ˜ã€‚l.outputä¸­å­˜å‚¨äº†æ•´ä¸ªbatchçš„è®­ç»ƒè¾“å‡ºï¼Œæ¯å¼ è®­ç»ƒå›¾ç‰‡éƒ½ä¼šè¾“å‡º</span></span><br><span class="line"><span class="comment"> *          l.out_w*l.out_hä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼ä¼šé¢„æµ‹l.nä¸ªçŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†å«æœ‰l.classes+l.coords+1ä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è€Œæœ€åä¸€å±‚çš„è¾“å‡ºé€šé“æ•°ä¸ºl.n*(l.classes+l.coords+1)ï¼Œå¯ä»¥æƒ³è±¡ä¸‹æœ€ç»ˆè¾“å‡ºçš„ä¸‰ç»´å¼ é‡æ˜¯ä¸ªä»€ä¹ˆæ ·å­çš„ã€‚</span></span><br><span class="line"><span class="comment"> *          å±•æˆä¸€ç»´æ•°ç»„å­˜å‚¨æ—¶ï¼Œl.outputå¯ä»¥é¦–å…ˆåˆ†æˆbatchä¸ªå¤§æ®µï¼Œæ¯ä¸ªå¤§æ®µå­˜å‚¨äº†ä¸€å¼ è®­ç»ƒå›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºï¼›è¿›ä¸€æ­¥ç»†åˆ†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å–å…¶ä¸­ç¬¬ä¸€å¤§æ®µåˆ†æï¼Œè¯¥å¤§æ®µä¸­å­˜å‚¨äº†ç¬¬ä¸€å¼ è®­ç»ƒå›¾ç‰‡æ‰€æœ‰è¾“å‡ºç½‘æ ¼é¢„æµ‹çš„çŸ©å½¢æ¡†ä¿¡æ¯ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹äº†l.nä¸ªçŸ©å½¢æ¡†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å­˜å‚¨æ—¶ï¼Œl.nä¸ªçŸ©å½¢æ¡†æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯å…ˆå­˜å‚¨æ‰€æœ‰ç½‘æ ¼ä¸­çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œè€Œåå­˜å‚¨æ‰€æœ‰ç½‘æ ¼ä¸­çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ï¼Œ</span></span><br><span class="line"><span class="comment"> *          ä¾æ¬¡ç±»æ¨ï¼Œå¦‚æœæ¯ä¸ªç½‘æ ¼ä¸­é¢„æµ‹5ä¸ªçŸ©å½¢æ¡†ï¼Œåˆ™å¯ä»¥ç»§ç»­æŠŠè¿™ä¸€å¤§æ®µåˆ†æˆ5ä¸ªä¸­æ®µã€‚ç»§ç»­ç»†åˆ†ï¼Œ5ä¸ªä¸­æ®µä¸­å–ç¬¬</span></span><br><span class="line"><span class="comment"> *          ä¸€ä¸ªä¸­æ®µæ¥åˆ†æï¼Œè¿™ä¸ªä¸­æ®µä¸­æŒ‰è¡Œï¼ˆæœ‰l.out_w*l.out_hä¸ªç½‘æ ¼ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼‰ä¾æ¬¡å­˜å‚¨äº†è¿™å¼ è®­ç»ƒå›¾ç‰‡æ‰€æœ‰è¾“å‡ºç½‘æ ¼ä¸­</span></span><br><span class="line"><span class="comment"> *          çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ä¿¡æ¯ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¸­æ®µå­˜å‚¨çš„é¡ºåºå¹¶ä¸æ˜¯æŒ¨ä¸ªæŒ¨ä¸ªå­˜å‚¨æ¯ä¸ªçŸ©å½¢æ¡†çš„æ‰€æœ‰ä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è€Œæ˜¯å…ˆå­˜å‚¨æ‰€æœ‰çŸ©å½¢æ¡†çš„xï¼Œè€Œåæ˜¯æ‰€æœ‰çš„y,ç„¶åæ˜¯æ‰€æœ‰çš„w,å†æ˜¯hï¼Œcï¼Œæœ€åçš„çš„æ¦‚ç‡æ•°ç»„ä¹Ÿæ˜¯æ‹†åˆ†è¿›è¡Œå­˜å‚¨ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å¹¶ä¸æ˜¯ä¸€ä¸‹å­å­˜å‚¨å®Œä¸€ä¸ªçŸ©å½¢æ¡†æ‰€æœ‰ç±»çš„æ¦‚ç‡ï¼Œè€Œæ˜¯å…ˆå­˜å‚¨æ‰€æœ‰ç½‘æ ¼æ‰€å±ç¬¬ä¸€ç±»çš„æ¦‚ç‡ï¼Œå†å­˜å‚¨æ‰€å±ç¬¬äºŒç±»çš„æ¦‚ç‡ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å…·ä½“æ¥è¯´è¿™ä¸€ä¸­æ®µé¦–å…ˆå­˜å‚¨äº†l.out_w*l.out_hä¸ªxï¼Œç„¶åæ˜¯l.out_w*l.out_cä¸ªyï¼Œä¾æ¬¡ä¸‹å»ï¼Œ</span></span><br><span class="line"><span class="comment"> *          æœ€åæ˜¯l.out_w*l.out_hä¸ªC1ï¼ˆå±äºç¬¬ä¸€ç±»çš„æ¦‚ç‡ï¼Œç”¨C1è¡¨ç¤ºï¼Œä¸‹é¢ç±»ä¼¼ï¼‰ï¼Œl.out_w*l.outhä¸ªC2,...,</span></span><br><span class="line"><span class="comment"> *          l.out_w*l.out_c*Cnï¼ˆå‡è®¾å…±æœ‰nç±»ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­å°†ä¸­æ®µåˆ†æˆå‡ ä¸ªå°æ®µï¼Œä¾æ¬¡ä¸ºx,y,w,h,c,C1,C2,...Cn</span></span><br><span class="line"><span class="comment"> *          å°æ®µï¼Œæ¯å°æ®µçš„é•¿åº¦éƒ½ä¸ºl.out_w*l.out_c.</span></span><br><span class="line"><span class="comment"> *          ç°åœ¨å›è¿‡æ¥çœ‹æœ¬å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œbatchå°±æ˜¯å¤§æ®µçš„åç§»æ•°ï¼ˆä»ç¬¬å‡ ä¸ªå¤§æ®µå¼€å§‹ï¼Œå¯¹åº”æ˜¯ç¬¬å‡ å¼ è®­ç»ƒå›¾ç‰‡ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> *          ç”±locationè®¡ç®—å¾—åˆ°çš„nå°±æ˜¯ä¸­æ®µçš„åç§»æ•°ï¼ˆä»ç¬¬å‡ ä¸ªä¸­æ®µå¼€å§‹ï¼Œå¯¹åº”æ˜¯ç¬¬å‡ ä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> *          entryå°±æ˜¯å°æ®µçš„åç§»æ•°ï¼ˆä»å‡ ä¸ªå°æ®µå¼€å§‹ï¼Œå¯¹åº”å…·ä½“æ˜¯é‚£ç§å‚æ•°ï¼Œx,cè¿˜æ˜¯C1ï¼‰ï¼Œè€Œlocåˆ™æ˜¯æœ€åçš„å®šä½ï¼Œ</span></span><br><span class="line"><span class="comment"> *          å‰é¢ç¡®å®šå¥½ç¬¬å‡ å¤§æ®µä¸­çš„ç¬¬å‡ ä¸­æ®µä¸­çš„ç¬¬å‡ å°æ®µçš„é¦–åœ°å€ï¼Œlocå°±æ˜¯ä»è¯¥é¦–åœ°å€å¾€åæ•°locä¸ªå…ƒç´ ï¼Œå¾—åˆ°æœ€ç»ˆå®šä½</span></span><br><span class="line"><span class="comment"> *          æŸä¸ªå…·ä½“å‚æ•°ï¼ˆxæˆ–cæˆ–C1ï¼‰çš„ç´¢å¼•å€¼ï¼Œæ¯”å¦‚l.outputä¸­å­˜å‚¨çš„æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼ˆè¿™é‡Œå‡è®¾åªå­˜äº†ä¸€å¼ è®­ç»ƒå›¾ç‰‡çš„è¾“å‡ºï¼Œ</span></span><br><span class="line"><span class="comment"> *          å› æ­¤batchåªèƒ½ä¸º0ï¼›å¹¶å‡è®¾l.out_w=l.out_h=2,l.classes=2ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"> *          xxxxyyyywwwwhhhhccccC1C1C1C1C2C2C2C2-#-xxxxyyyywwwwhhhhccccC1C1C1C1C2C2C2C2ï¼Œ</span></span><br><span class="line"><span class="comment"> *          n=0åˆ™å®šä½åˆ°-#-å·¦è¾¹çš„é¦–åœ°å€ï¼ˆè¡¨ç¤ºæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œn=1åˆ™å®šä½åˆ°-#-å³è¾¹çš„é¦–åœ°å€ï¼ˆè¡¨ç¤ºæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç¬¬äºŒä¸ªçŸ©å½¢æ¡†ï¼‰</span></span><br><span class="line"><span class="comment"> *          entry=0,loc=0è·å–çš„æ˜¯xçš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬ä¸€ä¸ªxä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†xå‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          entry=4,loc=1è·å–çš„æ˜¯cçš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬äºŒä¸ªcä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬äºŒä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†cå‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          entry=5,loc=2è·å–çš„æ˜¯C1çš„ç´¢å¼•ï¼Œä¸”è·å–çš„æ˜¯ç¬¬ä¸‰ä¸ªC1ä¹Ÿå³l.out_w*l.out_hä¸ªç½‘æ ¼ä¸­ç¬¬ä¸‰ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†C1å‚æ•°çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"> *          å¦‚æœè¦è·å–ç¬¬ä¸€ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†wå‚æ•°çš„ç´¢å¼•å‘¢ï¼Ÿå¦‚æœå·²ç»è·å–äº†å…¶xå€¼çš„ç´¢å¼•ï¼Œæ˜¾ç„¶ç”¨xçš„ç´¢å¼•åŠ ä¸Š3*l.out_w*l.out_hå³å¯è·å–åˆ°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è¿™æ­£æ˜¯delta_region_box()å‡½æ•°çš„åšæ³•ï¼›</span></span><br><span class="line"><span class="comment"> *          å¦‚æœè¦è·å–ç¬¬ä¸‰ä¸ªç½‘æ ¼ä¸­ç¬¬ä¸€ä¸ªçŸ©å½¢æ¡†C2å‚æ•°çš„ç´¢å¼•å‘¢ï¼Ÿå¦‚æœå·²ç»è·å–äº†å…¶C1å€¼çš„ç´¢å¼•ï¼Œæ˜¾ç„¶ç”¨C1çš„ç´¢å¼•åŠ ä¸Šl.out_w*l.out_hå³å¯è·å–åˆ°ï¼Œ</span></span><br><span class="line"><span class="comment"> *          è¿™æ­£æ˜¯delta_region_class()å‡½æ•°ä¸­çš„åšæ³•ï¼›</span></span><br><span class="line"><span class="comment"> *          ç”±ä¸Šå¯çŸ¥ï¼Œentry=0æ—¶,å³åç§»0ä¸ªå°æ®µï¼Œæ˜¯è·å–xçš„ç´¢å¼•ï¼›entry=4,æ˜¯è·å–è‡ªä¿¡åº¦ä¿¡æ¯cçš„ç´¢å¼•ï¼›entry=5ï¼Œæ˜¯è·å–C1çš„ç´¢å¼•.</span></span><br><span class="line"><span class="comment"> *          l.outputçš„å­˜å‚¨æ–¹å¼å¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œä¸ªäººè§‰å¾—è¯´çš„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œä½†å¯è§†åŒ–æ•ˆæœç»ˆç©¶ä¸å¦‚å›¾æ–‡è¯´æ˜ï½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">entry_index</span><span class="params">(layer l, <span class="keyword">int</span> batch, <span class="keyword">int</span> location, <span class="keyword">int</span> entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = location / (l.w*l.h);</span><br><span class="line">    <span class="keyword">int</span> loc = location % (l.w*l.h);</span><br><span class="line">    <span class="keyword">return</span> batch*l.outputs + n*l.w*l.h*(l.coords + l.classes + <span class="number">1</span>) + entry*l.w*l.h + loc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">softmax_tree</span><span class="params">(<span class="keyword">float</span> *input, <span class="keyword">int</span> batch, <span class="keyword">int</span> inputs, <span class="keyword">float</span> temp, tree *hierarchy, <span class="keyword">float</span> *output)</span></span>;</span><br><span class="line"><span class="comment">//æœ¬å‡½æ•°å¤šæ¬¡è°ƒç”¨äº†entry_index()å‡½æ•°ï¼Œä¸”ä½¿ç”¨çš„å‚æ•°ä¸å°½ç›¸åŒï¼Œå°¤å…¶æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œé€šè¿‡æœ€åä¸€ä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">//å¯ä»¥ç¡®å®šå‡ºregion_layerè¾“å‡ºl.outputçš„æ•°æ®å­˜å‚¨æ–¹å¼ã€‚ä¸ºæ–¹ä¾¿å™è¿°ï¼Œå‡è®¾æœ¬å±‚è¾“å‡ºå‚æ•°l.w = 2, l.h= 3,</span></span><br><span class="line"><span class="comment">//l.n = 2, l.classes = 2, l.coords = 4, l.c = l.n * (l.coords + l.classes + 1) = 21,</span></span><br><span class="line"><span class="comment">//l.outputä¸­å­˜å‚¨äº†æ‰€æœ‰çŸ©å½¢æ¡†çš„ä¿¡æ¯å‚æ•°ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†åŒ…æ‹¬4æ¡å®šä½ä¿¡æ¯å‚æ•°x,y,w,hï¼Œä¸€æ¡ç½®ä¿¡åº¦ï¼ˆconfidienceï¼‰</span></span><br><span class="line"><span class="comment">//å‚æ•°cï¼Œä»¥åŠæ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡C1,C2ï¼ˆæœ¬ä¾‹ä¸­ï¼Œå‡è®¾å°±åªæœ‰ä¸¤ä¸ªç±»åˆ«ï¼Œl.classes=2ï¼‰ï¼Œé‚£ä¹ˆä¸€å¼ æ ·æœ¬å›¾ç‰‡æœ€ç»ˆä¼šæœ‰</span></span><br><span class="line"><span class="comment">//l.w*l.h*l.nä¸ªçŸ©å½¢æ¡†ï¼ˆl.w*l.hå³ä¸ºæœ€ç»ˆå›¾åƒåˆ’åˆ†å±‚ç½‘æ ¼çš„ä¸ªæ•°ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹l.nä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œé‚£ä¹ˆ</span></span><br><span class="line"><span class="comment">//l.outputä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å…±æœ‰l.w*l.h*l.n*(l.coords + 1 + l.classes)ï¼Œè¿™äº›å…ƒç´ å…¨éƒ¨æ‹‰ä¼¸æˆä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">//çš„å½¢å¼å­˜å‚¨åœ¨l.outputä¸­ï¼Œå­˜å‚¨çš„é¡ºåºä¸ºï¼š</span></span><br><span class="line"><span class="comment">//xxxxxx-yyyyyy-wwwwww-hhhhhh-cccccc-C1C1C1C1C1C1C2C2C2C2C2C2-##-xxxxxx-yyyyyy-wwwwww-hhhhhh-cccccc-C1C2C1C2C1C2C1C2C1C2C1C2</span></span><br><span class="line"><span class="comment">//æ–‡å­—è¯´æ˜å¦‚ä¸‹ï¼š-##-éš”å¼€åˆ†æˆä¸¤æ®µï¼Œå·¦å³åˆ†åˆ«æ˜¯ä»£è¡¨æ‰€æœ‰ç½‘æ ¼çš„ç¬¬1ä¸ªboxå’Œç¬¬2ä¸ªboxï¼ˆå› ä¸ºl.n=2ï¼Œè¡¨ç¤ºæ¯ä¸ªç½‘æ ¼é¢„æµ‹ä¸¤ä¸ªboxï¼‰</span></span><br><span class="line"><span class="comment">//æ€»å…±æœ‰l.w*l.hä¸ªç½‘æ ¼ï¼Œä¸”å­˜å‚¨æ—¶ï¼ŒæŠŠæ‰€æœ‰ç½‘æ ¼çš„x,y,w,h,cä¿¡æ¯èšåˆ°ä¸€èµ·å†æ‹¼æ¥èµ·æ¥ï¼Œå› æ­¤xxxxxxåŠå…¶ä»–ä¿¡æ¯éƒ½æœ‰l.w*l.h=6ä¸ªï¼Œ</span></span><br><span class="line"><span class="comment">//å› ä¸ºæ¯ä¸ªæœ‰l.classesä¸ªç‰©ä½“ç±»åˆ«ï¼Œè€Œä¸”ä¹Ÿæ˜¯å’Œxywhä¸€æ ·ï¼Œæ¯ä¸€ç±»éƒ½é›†ä¸­å­˜å‚¨ï¼Œå…ˆå­˜å‚¨l.w*l.h=6ä¸ªC1ç±»ï¼Œè€Œåå­˜å‚¨6ä¸ªC2ç±»ï¼Œ</span></span><br><span class="line"><span class="comment">//ç½®ä¿¡åº¦å‚æ•°cè¡¨ç¤ºçš„æ˜¯è¯¥çŸ©å½¢æ¡†å†…å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡ï¼Œè€ŒC1ï¼ŒC2åˆ†åˆ«è¡¨ç¤ºçŸ©å½¢æ¡†å†…å­˜åœ¨ç‰©ä½“æ—¶å±äºç‰©ä½“1å’Œç‰©ä½“2çš„æ¦‚ç‡ï¼Œ</span></span><br><span class="line"><span class="comment">//å› æ­¤c*C1å³å¾—çŸ©å½¢æ¡†å†…å­˜åœ¨ç‰©ä½“1çš„æ¦‚ç‡ï¼Œc*C2å³å¾—çŸ©å½¢æ¡†å†…å­˜åœ¨ç‰©ä½“2çš„æ¦‚ç‡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_region_layer</span><span class="params">(<span class="keyword">const</span> region_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j,b,t,n;</span><br><span class="line">    <span class="keyword">int</span> size = l.coords + l.classes + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">//å†…å­˜æ‹·è´, l.output = state.input</span></span><br><span class="line">    <span class="built_in">memcpy</span>(l.output, state.input, l.outputs*l.batch*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">	<span class="comment">//è¿™ä¸ª#ifndefé¢„ç¼–è¯‘æŒ‡ä»¤æ²¡æœ‰å¿…è¦ç”¨çš„ï¼Œå› ä¸ºforward_region_layer()å‡½æ•°æœ¬èº«å°±å¯¹åº”æ²¡æœ‰å®šä¹‰gpuç‰ˆçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šæ‰§è¡Œå…¶ä¸­çš„è¯­å¥</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> GPU</span></span><br><span class="line">    <span class="built_in">flatten</span>(l.output, l.w*l.h, size*l.n, l.batch, <span class="number">1</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b)&#123;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.h*l.w*l.n; ++i)&#123;</span><br><span class="line">            <span class="keyword">int</span> index = size*i + b*l.outputs;</span><br><span class="line">			<span class="comment">// å¯¹confidenceè¿›è¡Œé€»è¾‘å›å½’</span></span><br><span class="line">            l.output[index + <span class="number">4</span>] = <span class="built_in">logistic_activate</span>(l.output[index + <span class="number">4</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> GPU</span></span><br><span class="line">    <span class="keyword">if</span> (l.softmax_tree)&#123;</span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.h*l.w*l.n; ++i)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = size*i + b*l.outputs;</span><br><span class="line">                <span class="built_in">softmax_tree</span>(l.output + index + <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, l.softmax_tree, l.output + index + <span class="number">5</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l.softmax)&#123;</span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.h*l.w*l.n; ++i)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = size*i + b*l.outputs;</span><br><span class="line">				<span class="comment">// l.softmax å¯¹classè¿›è¡Œsoftmaxå›å½’</span></span><br><span class="line">                <span class="built_in">softmax</span>(l.output + index + <span class="number">5</span>, l.classes, <span class="number">1</span>, l.output + index + <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="comment">// inferenceé˜¶æ®µï¼Œåˆ™åˆ°æ­¤ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span>(!state.train) <span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">// å°†reorgå±‚çš„è¯¯å·®é¡¹è¿›è¡Œåˆå§‹åŒ–ï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line">    <span class="built_in">memset</span>(l.delta, <span class="number">0</span>, l.outputs * l.batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">float</span> avg_iou = <span class="number">0</span>; <span class="comment">//å¹³å‡IoUï¼ˆIntersection over Unionï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> recall = <span class="number">0</span>; <span class="comment">//å¬å›ç‡</span></span><br><span class="line">    <span class="keyword">float</span> avg_cat = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> avg_obj = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> avg_anyobj = <span class="number">0</span>; <span class="comment">//ä¸€å¼ è®­ç»ƒå›¾ç‰‡æ‰€æœ‰é¢„æµ‹çŸ©å½¢æ¡†çš„å¹³å‡ç½®ä¿¡åº¦ï¼ˆçŸ©å½¢æ¡†ä¸­å«æœ‰ç‰©ä½“çš„æ¦‚ç‡ï¼‰ï¼Œè¯¥å‚æ•°æ²¡æœ‰å®é™…ç”¨å¤„ï¼Œä»…ç”¨äºè¾“å‡ºæ‰“å°</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> class_count = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// regionå±‚çš„æ€»æŸå¤±åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    *(l.cost) = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// éå†batchä¸­æ¯ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(l.softmax_tree)&#123; <span class="comment">//ã€è¿™æ˜¯åœ¨yolo9000æ‰å‚ä¸è®¡ç®—ã€‘</span></span><br><span class="line">            <span class="keyword">int</span> onlyclass_id = <span class="number">0</span>;</span><br><span class="line">			<span class="comment">// å¾ªç¯max_boxesæ¬¡ï¼Œæ¯å¼ å›¾ç‰‡å›ºå®šå¤„ç†max_boxesä¸ªçŸ©å½¢æ¡†</span></span><br><span class="line">            <span class="keyword">for</span>(t = <span class="number">0</span>; t &lt; l.max_boxes; ++t)&#123;</span><br><span class="line">				<span class="comment">// é€šè¿‡ç§»ä½æ¥è·å–æ¯ä¸€ä¸ªçœŸå®çŸ©å½¢æ¡†çš„ä¿¡æ¯ï¼Œnet.truthå­˜å‚¨äº†ç½‘ç»œåå…¥çš„æ‰€æœ‰å›¾ç‰‡çš„çœŸå®çŸ©å½¢æ¡†ä¿¡æ¯ï¼ˆä¸€æ¬¡åå…¥ä¸€ä¸ªbatchçš„è®­ç»ƒå›¾ç‰‡ï¼‰ï¼Œ</span></span><br><span class="line">                <span class="comment">// net.truthä½œä¸ºè¿™ä¸€ä¸ªå¤§æ•°ç»„çš„é¦–åœ°å€ï¼Œl.truthså‚æ•°æ˜¯æ¯ä¸€å¼ å›¾ç‰‡å«æœ‰çš„çœŸå®å€¼å‚æ•°ä¸ªæ•°ï¼ˆå¯å‚è€ƒlayer.hä¸­çš„truthså‚æ•°ä¸­çš„æ³¨é‡Šï¼‰ï¼Œ</span></span><br><span class="line">                <span class="comment">// bæ˜¯batchä¸­å·²ç»å¤„ç†å®Œå›¾ç‰‡çš„å›¾ç‰‡çš„å¼ æ•°ï¼Œ5æ˜¯æ¯ä¸ªçœŸå®çŸ©å½¢æ¡†éœ€è¦5ä¸ªå‚æ•°å€¼ï¼ˆä¹Ÿå³æ¯æ¡çŸ©å½¢æ¡†çœŸå€¼æœ‰5ä¸ªå‚æ•°ï¼‰ï¼Œtæ˜¯æœ¬å¼ å›¾ç‰‡å·²ç»å¤„ç†</span></span><br><span class="line">                <span class="comment">// è¿‡çš„çŸ©å½¢æ¡†çš„ä¸ªæ•°ï¼ˆæ¯å¼ å›¾ç‰‡æœ€å¤šå¤„ç†max_boxesä¸ªçŸ©å½¢æ¡†ï¼‰ï¼Œæ˜ç™½äº†ä¸Šé¢çš„å‚æ•°ä¹‹åå¯¹äºä¸‹é¢çš„ç§»ä½è·å–å¯¹åº”çŸ©å½¢æ¡†çœŸå®å€¼çš„ä»£ç å°±ä¸éš¾äº†</span></span><br><span class="line">                box truth = <span class="built_in">float_to_box</span>(state.truth + t*<span class="number">5</span> + b*l.truths);</span><br><span class="line">                <span class="comment">// è¿™ä¸ªifè¯­å¥æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æœ‰è¯»åˆ°çœŸå®çŸ©å½¢æ¡†å€¼ï¼ˆæ¯ä¸ªçŸ©å½¢æ¡†æœ‰5ä¸ªå‚æ•°,float_to_boxåªè¯»å–å…¶ä¸­çš„4ä¸ªå®šä½å‚æ•°ï¼Œ</span></span><br><span class="line">                <span class="comment">// åªè¦éªŒè¯xçš„å€¼ä¸ä¸º0,é‚£è‚¯å®šæ˜¯4ä¸ªå‚æ•°å€¼éƒ½è¯»å–åˆ°äº†ï¼Œè¦ä¹ˆå…¨éƒ¨è¯»å–åˆ°äº†ï¼Œè¦ä¹ˆä¸€ä¸ªä¹Ÿæ²¡æœ‰ï¼‰ï¼Œå¦å¤–ï¼Œå› ä¸ºç¨‹åºä¸­å†™æ­»äº†æ¯å¼ å›¾ç‰‡å¤„ç†max_boxesä¸ªçŸ©å½¢æ¡†ï¼Œ</span></span><br><span class="line">                <span class="comment">// é‚£ä¹ˆæœ‰äº›å›¾ç‰‡æ²¡æœ‰è¿™ä¹ˆå¤šçŸ©å½¢æ¡†ï¼Œå°±ä¼šå‡ºç°æ²¡æœ‰è¯»åˆ°çš„æƒ…å†µã€‚</span></span><br><span class="line">				<span class="keyword">if</span>(!truth.x) <span class="keyword">break</span>; <span class="comment">// continue;</span></span><br><span class="line">				<span class="comment">//float_to_box()ä¸­æ²¡æœ‰è¯»å–çŸ©å½¢æ¡†ä¸­åŒ…å«çš„ç‰©ä½“ç±»åˆ«ç¼–å·çš„ä¿¡æ¯ï¼Œå°±åœ¨æ­¤å¤„è·å–ã€‚ï¼ˆdarknetä¸­ï¼Œç‰©ä½“ç±»åˆ«æ ‡ç­¾å€¼ä¸ºç¼–å·ï¼Œ</span></span><br><span class="line">				<span class="comment">//æ¯ä¸€ä¸ªç±»åˆ«éƒ½æœ‰ä¸€ä¸ªç¼–å·å€¼ï¼Œè¿™äº›ç‰©ä½“å…·ä½“çš„å­—ç¬¦åç§°å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¦‚data/*.namesæ–‡ä»¶ï¼Œå…¶æ‰€åœ¨è¡Œæ•°å°±æ˜¯å…¶ç¼–å·å€¼ï¼‰</span></span><br><span class="line">                <span class="keyword">int</span> class_id = state.truth[t*<span class="number">5</span> + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                <span class="keyword">float</span> maxp = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> maxi = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(truth.x &gt; <span class="number">100000</span> &amp;&amp; truth.y &gt; <span class="number">100000</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(n = <span class="number">0</span>; n &lt; l.n*l.w*l.h; ++n)&#123;</span><br><span class="line">                        <span class="keyword">int</span> index = size*n + b*l.outputs + <span class="number">5</span>;</span><br><span class="line">                        <span class="keyword">float</span> scale =  l.output[index<span class="number">-1</span>];</span><br><span class="line">                        <span class="keyword">float</span> p = scale*<span class="built_in">get_hierarchy_probability</span>(l.output + index, l.softmax_tree, class_id);</span><br><span class="line">                        <span class="keyword">if</span>(p &gt; maxp)&#123;</span><br><span class="line">                            maxp = p;</span><br><span class="line">                            maxi = n;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">int</span> index = size*maxi + b*l.outputs + <span class="number">5</span>;</span><br><span class="line">                    <span class="built_in">delta_region_class</span>(l.output, l.delta, index, class_id, l.classes, l.softmax_tree, l.class_scale, &amp;avg_cat, l.focal_loss);</span><br><span class="line">                    ++class_count;</span><br><span class="line">                    onlyclass_id = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(onlyclass_id) <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.h; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.w; ++i) &#123; <span class="comment">// éå†æ¯ä¸ªcell, å½“å‰cellç¼–å·ä¸º[j, i]</span></span><br><span class="line">                <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123; <span class="comment">// éå†æ¯ä¸ªbboxï¼Œå½“å‰bboxç¼–å·ä¸º[n]</span></span><br><span class="line">					<span class="comment">//æ ¹æ®i,j,nè®¡ç®—è¯¥çŸ©å½¢æ¡†çš„ç´¢å¼•ï¼Œå®é™…æ˜¯çŸ©å½¢æ¡†ä¸­å­˜å‚¨çš„xå‚æ•°åœ¨l.outputä¸­çš„ç´¢å¼•ï¼ŒçŸ©å½¢æ¡†ä¸­åŒ…å«å¤šä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line">					<span class="comment">//xæ˜¯å…¶å­˜å‚¨çš„é¦–ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è¯´æ˜¯è·å–è¯¥çŸ©å½¢æ¡†çš„é¦–åœ°å€ã€‚</span></span><br><span class="line">                    <span class="keyword">int</span> index = size*(j*l.w*l.n + i*l.n + n) + b*l.outputs;</span><br><span class="line">					<span class="comment">// æ ¹æ®çŸ©å½¢æ¡†çš„ç´¢å¼•ï¼Œè·å–çŸ©å½¢æ¡†çš„å®šä½ä¿¡æ¯</span></span><br><span class="line">                    box pred = <span class="built_in">get_region_box</span>(l.output, l.biases, n, index, i, j, l.w, l.h);</span><br><span class="line">                    <span class="comment">// æœ€é«˜IoUï¼Œèµ‹åˆå€¼0</span></span><br><span class="line">					<span class="keyword">float</span> best_iou = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">int</span> best_class_id = <span class="number">-1</span>;</span><br><span class="line">					<span class="comment">// éå†æ¯ä¸€ä¸ªGT bbox</span></span><br><span class="line">                    <span class="keyword">for</span>(t = <span class="number">0</span>; t &lt; l.max_boxes; ++t)&#123;</span><br><span class="line">						<span class="comment">//å°†ç¬¬tä¸ªbboxç”±floatæ•°ç»„è½¬bboxç»“æ„ä½“,æ–¹ä¾¿è®¡ç®—IOU</span></span><br><span class="line">                        box truth = <span class="built_in">float_to_box</span>(state.truth + t*<span class="number">5</span> + b*l.truths);</span><br><span class="line">						<span class="comment">//è·å–ç¬¬tä¸ªbboxçš„ç‰©ä½“ç±»åˆ«</span></span><br><span class="line">                        <span class="keyword">int</span> class_id = state.truth[t * <span class="number">5</span> + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                        <span class="keyword">if</span> (class_id &gt;= l.classes) <span class="keyword">continue</span>; <span class="comment">// if label contains class_id more than number of classes in the cfg-file</span></span><br><span class="line">                        <span class="keyword">if</span>(!truth.x) <span class="keyword">break</span>; <span class="comment">// continue;</span></span><br><span class="line">						<span class="comment">// è®¡ç®—predä¸ç¬¬tä¸ªGTä¹‹é—´çš„IOU</span></span><br><span class="line">                        <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth);</span><br><span class="line">                        <span class="keyword">if</span> (iou &gt; best_iou) &#123;</span><br><span class="line">                            best_class_id = state.truth[t*<span class="number">5</span> + b*l.truths + <span class="number">4</span>];</span><br><span class="line">                            best_iou = iou; <span class="comment">// æœ€å¤§IOUæ›´æ–°</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">					<span class="comment">// ç»Ÿè®¡æœ‰ç›®æ ‡çš„æ¦‚ç‡</span></span><br><span class="line">                    avg_anyobj += l.output[index + <span class="number">4</span>];</span><br><span class="line">					<span class="comment">// ä¸yolov1ç›¸ä¼¼, å…ˆå°†æ‰€æœ‰pred bboxéƒ½å½“åšnoobjectï¼Œè®¡ç®—å…¶confidenceæŸå¤±æ¢¯åº¦</span></span><br><span class="line">                    l.delta[index + <span class="number">4</span>] = l.noobject_scale * ((<span class="number">0</span> - l.output[index + <span class="number">4</span>]) * <span class="built_in">logistic_gradient</span>(l.output[index + <span class="number">4</span>]));</span><br><span class="line">                    <span class="comment">// åœ¨yolov2ä¸­å¹¶æ²¡æœ‰æ‰§è¡Œ</span></span><br><span class="line">					<span class="keyword">if</span>(l.classfix == <span class="number">-1</span>) l.delta[index + <span class="number">4</span>] = l.noobject_scale * ((best_iou - l.output[index + <span class="number">4</span>]) * <span class="built_in">logistic_gradient</span>(l.output[index + <span class="number">4</span>]));</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">// best_iouå¤§äºé˜ˆå€¼åˆ™è¯´æ˜æœ‰object, åœ¨yolo v2ä¸­é˜ˆå€¼ä¸º0.6</span></span><br><span class="line">                        <span class="keyword">if</span> (best_iou &gt; l.thresh) &#123;</span><br><span class="line">                            l.delta[index + <span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">if</span>(l.classfix &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                                <span class="built_in">delta_region_class</span>(l.output, l.delta, index + <span class="number">5</span>, best_class_id, l.classes, l.softmax_tree, l.class_scale*(l.classfix == <span class="number">2</span> ? l.output[index + <span class="number">4</span>] : <span class="number">1</span>), &amp;avg_cat, l.focal_loss);</span><br><span class="line">                                ++class_count;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">					<span class="comment">// net.seen ä¿å­˜å½“å‰æ˜¯è®­ç»ƒç¬¬å¤šå°‘å¼ å›¾ç‰‡</span></span><br><span class="line">                    <span class="keyword">if</span>(*(state.net.seen) &lt; <span class="number">12800</span>)&#123;</span><br><span class="line">						<span class="comment">// å¯¹äºè®­ç»ƒé˜¶æ®µçš„å‰12800å¼ å›¾ç‰‡,GT bbox ç›´æ¥ç”¨äº†anchor box</span></span><br><span class="line">                        box truth = &#123;<span class="number">0</span>&#125;; <span class="comment">// è®¡ç®—ç¬¬[j, i]cell, ç¬¬nä¸ªbboxçš„anchor bbox</span></span><br><span class="line">                        truth.x = (i + <span class="number">.5</span>)/l.w; <span class="comment">// +0.5æ˜¯å› ä¸ºxä½äºå‡ ä½•ä¸­å¿ƒ, ç„¶åè®¡ç®—xç›¸å¯¹æ•´å¼ ç‰¹å¾å›¾çš„ä½ç½®</span></span><br><span class="line">                        truth.y = (j + <span class="number">.5</span>)/l.h;</span><br><span class="line">                        truth.w = l.biases[<span class="number">2</span>*n];</span><br><span class="line">                        truth.h = l.biases[<span class="number">2</span>*n+<span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">if</span>(DOABS)&#123;</span><br><span class="line">                            truth.w = l.biases[<span class="number">2</span>*n]/l.w;</span><br><span class="line">                            truth.h = l.biases[<span class="number">2</span>*n+<span class="number">1</span>]/l.h;</span><br><span class="line">                        &#125;</span><br><span class="line">						<span class="comment">// å°†pred bboxçš„tx,ty,tw,thå’Œä¸Šé¢çš„truth boxçš„å·®å€¼åå‘ä¼ é€’åˆ°l.detla</span></span><br><span class="line">                        <span class="built_in">delta_region_box</span>(truth, l.output, l.biases, n, index, i, j, l.w, l.h, l.delta, <span class="number">.01</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// éå†æ¯ä¸€ä¸ªGT bbox</span></span><br><span class="line">        <span class="keyword">for</span>(t = <span class="number">0</span>; t &lt; l.max_boxes; ++t)&#123;</span><br><span class="line">			<span class="comment">// å°†ç¬¬tä¸ªbboxç”±floatæ•°ç»„è½¬bboxç»“æ„ä½“,æ–¹ä¾¿è®¡ç®—IOU</span></span><br><span class="line">            box truth = <span class="built_in">float_to_box</span>(state.truth + t*<span class="number">5</span> + b*l.truths);</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">int</span> class_id = state.truth[t * <span class="number">5</span> + b*l.truths + <span class="number">4</span>];</span><br><span class="line">            <span class="keyword">if</span> (class_id &gt;= l.classes) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot; Warning: in txt-labels class_id=%d &gt;= classes=%d in cfg-file. In txt-labels class_id should be [from 0 to %d] \n&quot;</span>, class_id, l.classes, l.classes<span class="number">-1</span>);</span><br><span class="line">                <span class="built_in">getchar</span>();</span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">// if label contains class_id more than number of classes in the cfg-file</span></span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// å¦‚æœxåæ ‡ä¸º0åˆ™å–æ¶ˆ, å› ä¸ºyolov2è¿™é‡Œå®šä¹‰äº†30 bbox, å¯èƒ½å®é™…ä¸Šæ²¡æœ‰bbox</span></span><br><span class="line">            <span class="keyword">if</span>(!truth.x) <span class="keyword">break</span>; <span class="comment">// continue;</span></span><br><span class="line">            <span class="keyword">float</span> best_iou = <span class="number">0</span>; <span class="comment">// ä¿å­˜æœ€å¤§IOU</span></span><br><span class="line">            <span class="keyword">int</span> best_index = <span class="number">0</span>;<span class="comment">// ä¿å­˜æœ€å¤§IOUçš„bbox index</span></span><br><span class="line">            <span class="keyword">int</span> best_n = <span class="number">0</span>;</span><br><span class="line">            i = (truth.x * l.w); <span class="comment">// è·å¾—å½“å‰ç¬¬tä¸ªGT bboxæ‰€åœ¨cell</span></span><br><span class="line">            j = (truth.y * l.h);</span><br><span class="line">            <span class="comment">//printf(&quot;%d %f %d %f\n&quot;, i, truth.x*l.w, j, truth.y*l.h);</span></span><br><span class="line">            box truth_shift = truth; <span class="comment">// å°†truth_shiftçš„boxç§»åŠ¨åˆ°0,0</span></span><br><span class="line">            truth_shift.x = <span class="number">0</span>;</span><br><span class="line">            truth_shift.y = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">//printf(&quot;index %d %d\n&quot;,i, j);</span></span><br><span class="line">            <span class="keyword">for</span>(n = <span class="number">0</span>; n &lt; l.n; ++n)&#123; <span class="comment">// éå†cell[j,i]æ‰€åœ¨çš„nä¸ªé¢„æµ‹bbox</span></span><br><span class="line">				<span class="comment">// è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxçš„index</span></span><br><span class="line">                <span class="keyword">int</span> index = size*(j*l.w*l.n + i*l.n + n) + b*l.outputs;</span><br><span class="line">				<span class="comment">// è·å¾—ç¬¬j*w+iä¸ªcellç¬¬nä¸ªbboxåœ¨å½“å‰ç‰¹å¾å›¾ä¸Šä½ç½®å’Œå®½é«˜</span></span><br><span class="line">                box pred = <span class="built_in">get_region_box</span>(l.output, l.biases, n, index, i, j, l.w, l.h);</span><br><span class="line">                <span class="keyword">if</span>(l.bias_match)&#123;<span class="comment">// yolov2 reorgå±‚ bias_match = 1</span></span><br><span class="line">                    pred.w = l.biases[<span class="number">2</span>*n];</span><br><span class="line">                    pred.h = l.biases[<span class="number">2</span>*n+<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span>(DOABS)&#123;</span><br><span class="line">                        pred.w = l.biases[<span class="number">2</span>*n]/l.w; <span class="comment">// ç„¶åè®¡ç®—pred boxçš„wç›¸å¯¹æ•´å¼ ç‰¹å¾å›¾çš„ä½ç½®</span></span><br><span class="line">                        pred.h = l.biases[<span class="number">2</span>*n+<span class="number">1</span>]/l.h;  <span class="comment">// ç„¶åè®¡ç®—pred boxçš„hç›¸å¯¹æ•´å¼ ç‰¹å¾å›¾çš„ä½ç½®</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//printf(&quot;pred: (%f, %f) %f x %f\n&quot;, pred.x, pred.y, pred.w, pred.h);</span></span><br><span class="line">                pred.x = <span class="number">0</span>; <span class="comment">// å°†é¢„æµ‹çš„bboxç§»åŠ¨åˆ°0,0</span></span><br><span class="line">                pred.y = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth_shift); <span class="comment">// è®¡ç®—GT box truth_shift ä¸ é¢„æµ‹bbox pred äºŒè€…ä¹‹é—´çš„IOU</span></span><br><span class="line">                <span class="keyword">if</span> (iou &gt; best_iou)&#123;</span><br><span class="line">                    best_index = index;  <span class="comment">// è®°å½•best_iouå¯¹åº”bboxçš„index</span></span><br><span class="line">                    best_iou = iou; <span class="comment">// è®°å½•IOUæœ€å¤§çš„IOU</span></span><br><span class="line">                    best_n = n; <span class="comment">// ä»¥åŠè®°å½•è¯¥bboxçš„ç¼–å·n</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//printf(&quot;%d %f (%f, %f) %f x %f\n&quot;, best_n, best_iou, truth.x, truth.y, truth.w, truth.h);</span></span><br><span class="line">			<span class="comment">// è®¡ç®—è·å¾—best_iouçš„pred bbox ä¸ GT bboxä¹‹é—´çš„çœŸå®iou, ä¹‹å‰best_iouæ˜¯æ–¹ä¾¿è®¡ç®—,ä»¥åŠåŠ é€Ÿ,</span></span><br><span class="line">            <span class="comment">// åŒæ—¶å®Œæˆåæ ‡æŸå¤±çš„åå‘ä¼ é€’</span></span><br><span class="line">            <span class="keyword">float</span> iou = <span class="built_in">delta_region_box</span>(truth, l.output, l.biases, best_n, best_index, i, j, l.w, l.h, l.delta, l.coord_scale);</span><br><span class="line">            <span class="comment">// å¦‚æœiouå¤§äº0.5, recall ++;</span></span><br><span class="line">			<span class="keyword">if</span>(iou &gt; <span class="number">.5</span>) recall += <span class="number">1</span>;</span><br><span class="line">            avg_iou += iou;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//l.delta[best_index + 4] = iou - l.output[best_index + 4];</span></span><br><span class="line">			<span class="comment">// ç»Ÿè®¡æœ‰ç›®æ ‡çš„æ¦‚ç‡</span></span><br><span class="line">            avg_obj += l.output[best_index + <span class="number">4</span>];</span><br><span class="line">			<span class="comment">// ä¸yolov1ç›¸ä¼¼, è¯¥pred bboxä¸­æ˜¯æœ‰objectï¼Œè®¡ç®—å…¶confidenceæŸå¤±æ¢¯åº¦; object_scale = 5</span></span><br><span class="line">            l.delta[best_index + <span class="number">4</span>] = l.object_scale * (<span class="number">1</span> - l.output[best_index + <span class="number">4</span>]) * <span class="built_in">logistic_gradient</span>(l.output[best_index + <span class="number">4</span>]);</span><br><span class="line">            <span class="keyword">if</span> (l.rescore) &#123; <span class="comment">// yolov2 reorgå±‚ä¸­rescore = 1, å‚äºè®¡ç®—</span></span><br><span class="line">				<span class="comment">//å®šä¹‰äº†rescoreè¡¨ç¤ºåŒæ—¶å¯¹confidence scoreè¿›è¡Œå›å½’</span></span><br><span class="line">				<span class="comment">// è¯¥pred bboxä¸­æ˜¯æœ‰objectï¼Œè®¡ç®—å…¶confidenceæŸå¤±æ¢¯åº¦çš„æ–¹æ³•å‘ç”Ÿå˜åŒ–; object_scale = 5,</span></span><br><span class="line">				l.delta[best_index + <span class="number">4</span>] = l.object_scale * (iou - l.output[best_index + <span class="number">4</span>]) * <span class="built_in">logistic_gradient</span>(l.output[best_index + <span class="number">4</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// yolov2 reorgå±‚ä¸­map = 0, ä¸å‚ä¸è®¡ç®— ã€è¿™æ˜¯åœ¨yolo9000æ‰å‚ä¸è®¡ç®—ã€‘</span></span><br><span class="line">            <span class="keyword">if</span> (l.map) class_id = l.map[class_id];</span><br><span class="line">			 <span class="comment">// ä¸yolov1ç›¸ä¼¼, è¯¥pred bboxä¸­æ˜¯æœ‰objectï¼Œè®¡ç®—å…¶classæŸå¤±æ¢¯åº¦; class_scale = 1</span></span><br><span class="line">            <span class="built_in">delta_region_class</span>(l.output, l.delta, best_index + <span class="number">5</span>, class_id, l.classes, l.softmax_tree, l.class_scale, &amp;avg_cat, l.focal_loss);</span><br><span class="line">            ++count;<span class="comment">// æ­£æ ·æœ¬ä¸ªæ•°+1</span></span><br><span class="line">            ++class_count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> GPU</span></span><br><span class="line">    <span class="built_in">flatten</span>(l.delta, l.w*l.h, size*l.n, l.batch, <span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    *(l.cost) = <span class="built_in">pow</span>(<span class="built_in">mag_array</span>(l.delta, l.outputs * l.batch), <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Region Avg IOU: %f, Class: %f, Obj: %f, No Obj: %f, Avg Recall: %f,  count: %d\n&quot;</span>, avg_iou/count, avg_cat/class_count, avg_obj/count, avg_anyobj/(l.w*l.h*l.n*l.batch), recall/count, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv2æŸå¤±å‡½æ•°è¯¦è§£</title>
    <url>/2020/03/01/YOLOv2%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>YOLOv2è¯¦ç»†è®²è§£äº†YOLOv2çš„ç®—æ³•åŸç†ï¼Œä½†å®˜æ–¹è®ºæ–‡æ²¡æœ‰åƒYOLOv1é‚£æ ·æä¾›YOLOv2çš„æŸå¤±å‡½æ•°ï¼Œéš¾æ€ªNgè¯´YOLOæ˜¯ç›®æ ‡æ£€æµ‹ä¸­æœ€éš¾æ‡‚çš„ç®—æ³•ã€‚ä»Šå¤©æˆ‘ä»¬å°è¯•ç»“åˆDarkNetçš„æºç æ¥åˆ†æYOLOv2çš„æŸå¤±å‡½æ•°ã€‚</p>
<h2 id="å…³é”®ç‚¹å›é¡¾"><a href="#å…³é”®ç‚¹å›é¡¾" class="headerlink" title="å…³é”®ç‚¹å›é¡¾"></a>å…³é”®ç‚¹å›é¡¾</h2><h3 id="ç›´æ¥ä½ç½®é¢„æµ‹"><a href="#ç›´æ¥ä½ç½®é¢„æµ‹" class="headerlink" title="ç›´æ¥ä½ç½®é¢„æµ‹"></a>ç›´æ¥ä½ç½®é¢„æµ‹</h3><p>YOLOv2å€Ÿé‰´RPNç½‘ç»œä½¿ç”¨Anchor boxesæ¥é¢„æµ‹è¾¹ç•Œæ¡†ç›¸å¯¹äºå…ˆéªŒæ¡†çš„offsetsã€‚è¾¹ç•Œæ¡†çš„å®é™…ä¸­å¿ƒä½ç½®$(x, y)$éœ€è¦åˆ©ç”¨é¢„æµ‹çš„åæ ‡åç§»å€¼$\left(t_{x}, t_{y}\right)$ï¼Œå…ˆéªŒæ¡†çš„å°ºåº¦$\left(w_{a}, h_{a}\right)$ä»¥åŠä¸­å¿ƒåæ ‡$\left(x_{a}, y_{a}\right)$æ¥è®¡ç®—ï¼Œè¿™é‡Œçš„${x}_{a}$å’Œ${y}_{a}$ä¹Ÿå³æ˜¯ç‰¹å¾å›¾æ¯ä¸ªä½ç½®çš„ä¸­å¿ƒç‚¹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/644.png" alt></p>
<p>ä¸Šé¢çš„å…¬å¼ä¹Ÿæ˜¯Faster-RCNNä¸­é¢„æµ‹è¾¹ç•Œæ¡†çš„æ–¹å¼ã€‚ä½†ä¸Šé¢çš„é¢„æµ‹æ–¹å¼æ˜¯æ²¡æœ‰çº¦æŸçš„ï¼Œé¢„æµ‹çš„è¾¹ç•Œæ¡†å®¹æ˜“å‘ä»»ä½•æ–¹å‘åç§»ï¼Œä¾‹å¦‚å½“$t_{x}=1$æ—¶è¾¹ç•Œæ¡†å°†å‘å³åç§»Anchorçš„ä¸€ä¸ªå®½åº¦å¤§å°ï¼Œå¯¼è‡´æ¯ä¸ªä½ç½®é¢„æµ‹çš„è¾¹ç•Œæ¡†å¯ä»¥è½åœ¨å›¾ç‰‡çš„ä»»æ„ä½ç½®ï¼Œè¿™å°±å¯¼è‡´æ¨¡å‹è®­ç»ƒçš„ä¸ç¨³å®šæ€§ï¼Œåœ¨è®­ç»ƒçš„æ—¶å€™è¦èŠ±å¾ˆé•¿æ—¶é—´æ‰å¯ä»¥å¾—åˆ°æ­£ç¡®çš„offsetsã€‚æ‰€ä»¥ï¼ŒYOLOv2å¼ƒç”¨äº†è¿™ç§é¢„æµ‹æ–¹å¼ï¼Œè€Œæ˜¯æ²¿ç”¨YOLOv1çš„æ–¹æ³•ï¼Œå°±æ˜¯é¢„æµ‹è¾¹ç•Œæ¡†ä¸­å¿ƒç‚¹ç›¸å¯¹äºå¯¹åº”cellå·¦ä¸Šè§’ä½ç½®çš„ç›¸å¯¹åç§»å€¼ï¼Œä¸ºäº†å°†è¾¹ç•Œæ¡†ä¸­å¿ƒç‚¹çº¦æŸåœ¨å½“å‰cellä¸­ï¼Œä½¿ç”¨sigmoidå‡½æ•°å¤„ç†åç§»å€¼ï¼Œè¿™æ ·é¢„æµ‹çš„åç§»å€¼åœ¨(0,1)èŒƒå›´å†…ï¼ˆæ¯ä¸ªcellçš„å°ºåº¦çœ‹åš1ï¼‰ã€‚</p>
<p>ç»¼ä¸Šï¼Œæ ¹æ®è¾¹ç•Œæ¡†é¢„æµ‹çš„4ä¸ªåç§»å€¼$t_{x}, t_{y}, t_{w}, t_{h}$ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼æ¥è®¡ç®—è¾¹ç•Œæ¡†å®é™…ä¸­å¿ƒä½ç½®å’Œé•¿å®½ï¼Œå…¬å¼åœ¨å›¾ä¸­ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/645.webp" alt></p>
<p>å…¶ä¸­ï¼Œ$\left(c_{x}, c_{y}\right)$ä¸ºcellçš„å·¦ä¸Šè§’åæ ‡ã€‚åœ¨Fig3ä¸­ï¼Œå½“å‰çš„cellçš„å·¦ä¸Šè§’åæ ‡ä¸º$(1,1)$ã€‚ç”±äºsigmoidå‡½æ•°çš„å¤„ç†ï¼Œè¾¹ç•Œæ¡†çš„ä¸­å¿ƒä½ç½®ä¼šè¢«çº¦æŸåœ¨å½“å‰cellçš„å†…éƒ¨ï¼Œé˜²æ­¢åç§»è¿‡å¤šï¼Œç„¶å$p_{w}$å’Œ$p_{h}$æ˜¯å…ˆéªŒæ¡†çš„å®½åº¦ä¸é«˜åº¦ï¼Œå®ƒä»¬çš„å€¼ä¹Ÿæ˜¯ç›¸å¯¹äºç‰¹å¾å›¾ï¼ˆè¿™é‡Œæ˜¯13 x 13ï¼Œæˆ‘ä»¬æŠŠç‰¹å¾å›¾çš„é•¿å®½è®°ä½œHï¼ŒWï¼‰å¤§å°çš„ï¼Œåœ¨ç‰¹å¾å›¾ä¸­çš„cellé•¿å®½å‡ä¸º1ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç®—å‡ºè¾¹ç•Œæ¡†ç›¸å¯¹äºæ•´ä¸ªç‰¹å¾å›¾çš„ä½ç½®å’Œå¤§å°äº†ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
b_{x}=\left(\sigma\left(t_{x}\right)+c_{x}\right) / W \quad b_{y}=\left(\sigma\left(t_{y}\right)+c_{y}\right) / H \quad b_{w}=p_{w} e^{t_{w}} / W \quad b_{h}=p_{h} e^{t_{h}} / H</script><p>æˆ‘ä»¬å¦‚æœå°†ä¸Šé¢è¾¹ç•Œæ¡†çš„4ä¸ªå€¼ä¹˜ä»¥è¾“å…¥å›¾åƒé•¿å®½ï¼Œå°±å¯ä»¥å¾—åˆ°è¾¹ç•Œæ¡†åœ¨åŸå›¾ä¸­çš„ä½ç½®å’Œå¤§å°äº†ã€‚</p>
<h3 id="ç»†ç²’åº¦ç‰¹å¾"><a href="#ç»†ç²’åº¦ç‰¹å¾" class="headerlink" title="ç»†ç²’åº¦ç‰¹å¾"></a>ç»†ç²’åº¦ç‰¹å¾</h3><p>YOLOv2æå–Darknet-19æœ€åä¸€ä¸ªmax poolå±‚çš„è¾“å…¥ï¼Œå¾—åˆ°26x26x512çš„ç‰¹å¾å›¾ã€‚ç»è¿‡1x1x64çš„å·ç§¯ä»¥é™ä½ç‰¹å¾å›¾çš„ç»´åº¦ï¼Œå¾—åˆ°26x26x64çš„ç‰¹å¾å›¾ï¼Œç„¶åç»è¿‡pass  throughå±‚çš„å¤„ç†å˜æˆ13x13x256çš„ç‰¹å¾å›¾ï¼ˆæŠ½å–åŸç‰¹å¾å›¾æ¯ä¸ª2x2çš„å±€éƒ¨åŒºåŸŸç»„æˆæ–°çš„channelï¼Œå³åŸç‰¹å¾å›¾å¤§å°é™ä½4å€ï¼Œchannelå¢åŠ 4å€ï¼‰ï¼Œå†ä¸13x13x1024å¤§å°çš„ç‰¹å¾å›¾è¿æ¥ï¼Œå˜æˆ13x13x1280çš„ç‰¹å¾å›¾ï¼Œæœ€ååœ¨è¿™äº›ç‰¹å¾å›¾ä¸Šåšé¢„æµ‹ã€‚ä½¿ç”¨Fine-Grained Featuresï¼ŒYOLOv2çš„æ€§èƒ½æå‡äº†1%ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨ä¸‹é¢çš„YOLOv2çš„ç»“æ„å›¾ä¸­çœ‹å¾—å¾ˆæ¸…æ¥šï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/646.webp" alt></p>
<p>è¿™ä¸ªåœ°æ–¹ä»Šå¤©è¿˜è¦è¡¥å……ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯passthroughå±‚åˆ°åº•æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Œåœ¨DarkNetä¸­passthoughå±‚å«ä½œreorg_layerï¼Œå¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºè¿™ä¸ªæ“ä½œï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/649.webp" alt></p>
<h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>YOLOv2çš„è®­ç»ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œå…·ä½“å°±ä¸å†èµ˜è¿°äº†ã€‚è¿™é‡Œä¸»è¦é‡æ–°å…³æ³¨ä¸€ä¸‹è®­ç»ƒåçš„ç»´åº¦å˜åŒ–ï¼Œæˆ‘ä»¬ä»ä¸Šä¸€å°èŠ‚å¯ä»¥çœ‹åˆ°æœ€åYOLOv2çš„è¾“å‡ºç»´åº¦æ˜¯$13 \times 13 \times 125$ã€‚è¿™ä¸ª125ä½¿ç”¨ä¸‹é¢çš„å…¬å¼æ¥è®¡ç®—çš„ï¼š</p>
<script type="math/tex; mode=display">
numanchors \times(5+\text {num\_classes})</script><p>å’Œè®­ç»ƒé‡‡ç”¨çš„æ•°æ®é›†æœ‰å…³ç³»ã€‚ç”±äºanchorsæ•°ä¸º5ï¼Œå¯¹äºVOCæ•°æ®é›†è¾“å‡ºçš„channelsæ•°å°±æ˜¯125ï¼Œè€Œå¯¹äºCOCOæ•°æ®é›†åˆ™ä¸º425ã€‚è¿™é‡Œä»¥VOCæ•°æ®é›†ä¸ºä¾‹ï¼Œæœ€ç»ˆçš„é¢„æµ‹çŸ©é˜µä¸º$T$ï¼Œshapeä¸º$\left[\text {batch}_{\text {size}}, 13,13,125\right]$ï¼Œå¯ä»¥å°†å…¶reshapeæˆ[batch_size, $13,13,5,25]$ï¼Œè¿™æ ·$T[:, :, :, :, 0: 4]$æ˜¯è¾¹ç•Œæ¡†çš„ä½ç½®å’Œå¤§å°$\left(t_{x}, t_{y}, t_{w}, t_{h}\right)$ï¼Œ$T[:, :, :, :, 4]$è¡¨ç¤ºè¾¹ç•Œæ¡†çš„ç½®ä¿¡åº¦$t_{o}$ï¼Œ$T[:, :, :, :, 5:]$è€Œè¡¨ç¤ºç±»åˆ«é¢„æµ‹å€¼ã€‚</p>
<h2 id="YOLOv2çš„æ¨¡å‹ç»“æ„"><a href="#YOLOv2çš„æ¨¡å‹ç»“æ„" class="headerlink" title="YOLOv2çš„æ¨¡å‹ç»“æ„"></a>YOLOv2çš„æ¨¡å‹ç»“æ„</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/650.webp" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/651.webp" alt></p>
<h2 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h2><p>æ¥ä¸‹æ¥å°±è¯´ä¸€è¯´ä»Šå¤©çš„ä¸»é¢˜ï¼ŒæŸå¤±å‡½æ•°ã€‚æŸå¤±å‡½æ•°æˆ‘çœ‹ç½‘ä¸Šçš„ä¼—å¤šè®²è§£ï¼Œå‘ç°æœ‰ä¸¤ç§è§£é‡Šã€‚</p>
<h3 id="è§£é‡Š1"><a href="#è§£é‡Š1" class="headerlink" title="è§£é‡Š1"></a>è§£é‡Š1</h3><p>YOLOv2çš„æŸå¤±å‡½æ•°å’ŒYOLOv1ä¸€æ ·ï¼Œå¯¹äºè®­ç»ƒé›†ä¸­çš„ground truthï¼Œä¸­å¿ƒè½åœ¨å“ªä¸ªcellï¼Œé‚£ä¹ˆè¯¥cellçš„5ä¸ªAnchor  boxå¯¹åº”çš„è¾¹ç•Œæ¡†å°±è´Ÿè´£é¢„æµ‹å®ƒï¼Œå…·ä½“ç”±å“ªä¸€ä¸ªé¢„æµ‹åŒæ ·ä¹Ÿæ˜¯æ ¹æ®IOUè®¡ç®—åçš„é˜ˆå€¼æ¥ç¡®å®šçš„ï¼Œæœ€åé€‰IOUå€¼æœ€å¤§çš„é‚£ä¸ªã€‚è¿™ä¹Ÿæ˜¯å»ºç«‹åœ¨æ¯ä¸ªCellè‡³å¤šå«æœ‰ä¸€ä¸ªç›®æ ‡çš„æƒ…ä¸‹ï¼Œå®é™…ä¸Šä¹ŸåŸºæœ¬ä¸ä¼šå‡ºç°å¤šä½™1ä¸ªçš„æƒ…å†µã€‚å’Œground  truthåŒ¹é…ä¸Šçš„å…ˆéªŒæ¡†è´Ÿè´£è®¡ç®—åæ ‡è¯¯å·®ï¼Œç½®ä¿¡åº¦è¯¯å·®ä»¥åŠåˆ†ç±»è¯¯å·®ï¼Œè€Œå…¶å®ƒ4ä¸ªè¾¹ç•Œæ¡†åªè®¡ç®—ç½®ä¿¡åº¦è¯¯å·®ã€‚è¿™ä¸ªè§£é‡Šå‚è€ƒçš„YOLOv2å®ç°æ˜¯darkflowã€‚æºç åœ°å€ä¸ºï¼š<a href="https://github.com/thtrieu/darkflow">https://github.com/thtrieu/darkflow</a></p>
<h3 id="è§£é‡Š2"><a href="#è§£é‡Š2" class="headerlink" title="è§£é‡Š2"></a>è§£é‡Š2</h3><p>åœ¨å®˜æ–¹æä¾›çš„Darknetä¸­ï¼ŒYOLOv2çš„æŸå¤±å‡½æ•°å¯ä»¥ä¸æ˜¯å’ŒYOLOv1ä¸€æ ·çš„ï¼ŒæŸå¤±å‡½æ•°å¯ä»¥ç”¨ä¸‹å›¾æ¥è¿›è¡Œè¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/661.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæŸå¤±å‡½æ•°æ˜¯ç›¸å½“å¤æ‚çš„ï¼ŒæŸå¤±å‡½æ•°çš„å®šä¹‰åœ¨Darknet/src/region_layer.cä¸­ã€‚å¯¹äºä¸Šé¢è¿™ä¸€å †å…¬å¼ï¼Œæˆ‘ä»¬å…ˆç®€å•çœ‹ä¸€ä¸‹ï¼Œç„¶åæˆ‘ä»¬åœ¨æºç ä¸­å»æ‰¾åˆ°å¯¹åº”éƒ¨åˆ†ã€‚è¿™é‡Œçš„$W$å’Œ$H$ä»£è¡¨çš„æ˜¯ç‰¹å¾å›¾çš„é«˜å®½ï¼Œéƒ½ä¸º13ï¼Œè€Œ$A$æŒ‡çš„æ˜¯Anchorä¸ªæ•°ï¼ŒYOLOv2ä¸­æ˜¯5ï¼Œå„ä¸ª$\lambda$å€¼æ˜¯å„ä¸ªlosséƒ¨åˆ†çš„æƒé‡ç³»æ•°ã€‚æˆ‘ä»¬å°†æŸå¤±å‡½æ•°åˆ†æˆ3å¤§éƒ¨åˆ†æ¥è§£é‡Šï¼š</p>
<ul>
<li><p>ç¬¬ä¸€éƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/662.png" alt><br>ç¬¬ä¸€é¡¹éœ€è¦å¥½å¥½è§£é‡Šä¸€ä¸‹ï¼Œè¿™ä¸ªlossæ˜¯è®¡ç®—backgroundçš„ç½®ä¿¡åº¦è¯¯å·®ï¼Œè¿™ä¹Ÿæ˜¯YOLOç³»åˆ—ç®—æ³•çš„ç‰¹è‰²ï¼Œä½†æ˜¯ç”¨å“ªäº›é¢„æµ‹æ¡†æ¥é¢„æµ‹èƒŒæ™¯å‘¢ï¼Ÿè¿™é‡Œéœ€è¦è®¡ç®—å„ä¸ªé¢„æµ‹æ¡†å’Œæ‰€æœ‰çš„ground  truthä¹‹é—´çš„IOUå€¼ï¼Œå¹¶ä¸”å–æœ€å¤§å€¼è®°ä½œMaxIOUï¼Œå¦‚æœè¯¥å€¼å°äºä¸€å®šçš„é˜ˆå€¼ï¼ŒYOLOv2è®ºæ–‡å–äº†0.6ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢„æµ‹æ¡†å°±æ ‡è®°ä¸ºbackgroundï¼Œéœ€è¦è®¡ç®—$\lambda_{n o o b j}$è¿™ä¹ˆå¤šå€çš„æŸå¤±å‡½æ•°ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªå…¬å¼å¯ä»¥è¿™æ ·è¡¨è¾¾å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æœ‰ç‰©ä½“çš„è¯ï¼Œé‚£ä¹ˆ$\lambda_{n o o b j}=0$ï¼Œå¦‚æœæ²¡æœ‰ç‰©ä½“$\lambda_{\text {noob} j}=1$ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå€¼å¸¦å…¥åˆ°ä¸‹é¢çš„å…¬å¼å°±å¯ä»¥æ¨å‡ºç¬¬ä¸€é¡¹å•¦ï¼<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/663.webp" alt></p>
</li>
<li><p>ç¬¬äºŒéƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/664.png" alt><br>è¿™ä¸€éƒ¨åˆ†æ˜¯è®¡ç®—Anchor boxeså’Œé¢„æµ‹æ¡†çš„åæ ‡è¯¯å·®ï¼Œä½†æ˜¯åªåœ¨å‰12800ä¸ªiterè®¡ç®—ï¼Œè¿™ä¸€é¡¹åº”è¯¥æ˜¯ä¿ƒè¿›ç½‘ç»œå­¦ä¹ åˆ°Anchorçš„å½¢çŠ¶ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/665.webp" alt><br>è¿™ä¸€éƒ¨åˆ†è®¡ç®—çš„æ˜¯å’Œground truthåŒ¹é…çš„é¢„æµ‹æ¡†å„éƒ¨åˆ†çš„æŸå¤±æ€»å’Œï¼ŒåŒ…æ‹¬åæ ‡æŸå¤±ï¼Œç½®ä¿¡åº¦æŸå¤±ä»¥åŠåˆ†ç±»æŸå¤±ã€‚<br><strong>3.1 åæ ‡æŸå¤±</strong> è¿™é‡Œçš„åŒ¹é…åŸåˆ™æ˜¯æŒ‡å¯¹äºæŸä¸ªç‰¹å®šçš„ground truthï¼Œé¦–å…ˆè¦è®¡ç®—å…¶ä¸­å¿ƒç‚¹è½åœ¨å“ªä¸ªcellä¸Šï¼Œç„¶åè®¡ç®—è¿™ä¸ªcellçš„5ä¸ªå…ˆéªŒæ¡†å’Œgrond  truthçš„IOUå€¼ï¼Œè®¡ç®—IOUå€¼çš„æ—¶å€™ä¸è€ƒè™‘åæ ‡åªè€ƒè™‘å½¢çŠ¶ï¼Œæ‰€ä»¥å…ˆå°†Anchor boxeså’Œground  truthçš„ä¸­å¿ƒéƒ½åç§»åˆ°åŒä¸€ä½ç½®ï¼Œç„¶åè®¡ç®—å‡ºå¯¹åº”çš„IOUå€¼ï¼ŒIOUå€¼æœ€å¤§çš„å…ˆéªŒæ¡†å’Œground  truthåŒ¹é…ï¼Œå¯¹åº”çš„é¢„æµ‹æ¡†ç”¨æ¥é¢„æµ‹è¿™ä¸ªground truthã€‚<br><strong>3.2 ç½®ä¿¡åº¦æŸå¤±</strong> åœ¨è®¡ç®—objç½®ä¿¡åº¦æ—¶ï¼Œ å¢åŠ äº†ä¸€é¡¹æƒé‡ç³»æ•°ï¼Œä¹Ÿè¢«ç§°ä¸ºrescoreå‚æ•°ï¼Œå½“å…¶ä¸º1æ—¶ï¼ŒæŸå¤±æ˜¯é¢„æµ‹æ¡†å’Œground truthçš„çœŸå®IOUå€¼(darknetä¸­é‡‡ç”¨äº†è¿™ç§å®ç°æ–¹å¼)ã€‚è€Œå¯¹äºæ²¡æœ‰å’Œground  truthåŒ¹é…çš„å…ˆéªŒæ¡†ï¼Œé™¤å»é‚£äº›Max_IOUä½äºé˜ˆå€¼çš„ï¼Œå…¶å®ƒå°±å…¨éƒ¨å¿½ç•¥ã€‚YOLOv2å’ŒSSDä¸RPNç½‘ç»œçš„å¤„ç†æ–¹å¼æœ‰å¾ˆå¤§ä¸åŒï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å°†ä¸€ä¸ªground truthåˆ†é…ç»™å¤šä¸ªå…ˆéªŒæ¡†ã€‚<br><strong>3.3 åˆ†ç±»æŸå¤±</strong> è¿™ä¸ªå’ŒYOLOv1ä¸€è‡´ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ã€‚</p>
</li>
</ul>
<p>æˆ‘çœ‹äº†ä¸€ç¯‡è®²è§£YOLOv2æŸå¤±å‡½æ•°éå¸¸å¥½çš„æ–‡ç« ï¼š<a href="https://www.cnblogs.com/YiXiaoZhou/p/7429481.html">https://www.cnblogs.com/YiXiaoZhou/p/7429481.html</a> ã€‚é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹ï¼š</p>
<p>åœ¨è®¡ç®—boxesçš„$w$å’Œ$h$è¯¯å·®æ—¶ï¼ŒYOLOv1ä¸­é‡‡ç”¨çš„æ˜¯å¹³æ–¹æ ¹ä»¥é™ä½boxesçš„å¤§å°å¯¹è¯¯å·®çš„å½±å“ï¼Œè€ŒYOLOv2æ˜¯ç›´æ¥è®¡ç®—ï¼Œä½†æ˜¯æ ¹æ®ground truthçš„å¤§å°å¯¹æƒé‡ç³»æ•°è¿›è¡Œä¿®æ­£ï¼šl.coord_scale x (2 - truth.w x truth.h)ï¼ˆè¿™é‡Œå’Œéƒ½å½’ä¸€åŒ–åˆ°(0,1))ï¼Œè¿™æ ·å¯¹äºå°ºåº¦è¾ƒå°çš„boxeså…¶æƒé‡ç³»æ•°ä¼šæ›´å¤§ä¸€äº›ï¼Œå¯ä»¥æ”¾å¤§è¯¯å·®ï¼Œèµ·åˆ°å’ŒYOLOv1è®¡ç®—å¹³æ–¹æ ¹ç›¸ä¼¼çš„æ•ˆæœã€‚</p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>è´´ä¸€ä¸‹YOLOv2åœ¨Kerasä¸Šçš„å¤ç°ä»£ç ï¼Œåœ°å€ä¸ºï¼š<a href="https://github.com/yhcc/yolo2">https://github.com/yhcc/yolo2</a> ã€‚ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼Œå¯ä»¥ç»“åˆä¸Šé¢å¯è§†åŒ–å›¾æ¥çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">darknet</span>(<span class="params">images, n_last_channels=<span class="number">425</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Darknet19 for YOLOv2&quot;&quot;&quot;</span></span><br><span class="line">    net = conv2d(images, <span class="number">32</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv1&quot;</span>)</span><br><span class="line">    net = maxpool(net, name=<span class="string">&quot;pool1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">64</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv2&quot;</span>)</span><br><span class="line">    net = maxpool(net, name=<span class="string">&quot;pool2&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">128</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv3_1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">64</span>, <span class="number">1</span>, name=<span class="string">&quot;conv3_2&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">128</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv3_3&quot;</span>)</span><br><span class="line">    net = maxpool(net, name=<span class="string">&quot;pool3&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv4_1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">128</span>, <span class="number">1</span>, name=<span class="string">&quot;conv4_2&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv4_3&quot;</span>)</span><br><span class="line">    net = maxpool(net, name=<span class="string">&quot;pool4&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">512</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv5_1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">256</span>, <span class="number">1</span>, name=<span class="string">&quot;conv5_2&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">512</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv5_3&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">256</span>, <span class="number">1</span>, name=<span class="string">&quot;conv5_4&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">512</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv5_5&quot;</span>)</span><br><span class="line">    shortcut = net</span><br><span class="line">    net = maxpool(net, name=<span class="string">&quot;pool5&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv6_1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">512</span>, <span class="number">1</span>, name=<span class="string">&quot;conv6_2&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv6_3&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">512</span>, <span class="number">1</span>, name=<span class="string">&quot;conv6_4&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv6_5&quot;</span>)</span><br><span class="line">    <span class="comment"># ---------</span></span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv7_1&quot;</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv7_2&quot;</span>)</span><br><span class="line">    <span class="comment"># shortcut</span></span><br><span class="line">    shortcut = conv2d(shortcut, <span class="number">64</span>, <span class="number">1</span>, name=<span class="string">&quot;conv_shortcut&quot;</span>)</span><br><span class="line">    shortcut = reorg(shortcut, <span class="number">2</span>)</span><br><span class="line">    net = tf.concat([shortcut, net], axis=-<span class="number">1</span>)</span><br><span class="line">    net = conv2d(net, <span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>, name=<span class="string">&quot;conv8&quot;</span>)</span><br><span class="line">    <span class="comment"># detection layer</span></span><br><span class="line">    net = conv2d(net, n_last_channels, <span class="number">1</span>, batch_normalize=<span class="number">0</span>,</span><br><span class="line">                 activation=<span class="literal">None</span>, use_bias=<span class="literal">True</span>, name=<span class="string">&quot;conv_dec&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> net</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œç½‘ç»œç»è¿‡ä»‹ç»çš„æŸå¤±å‡½æ•°ä¼˜åŒ–è®­ç»ƒä»¥åï¼Œå¯¹ç½‘ç»œè¾“å‡ºç»“æœè¿›è¡Œè§£ç å¾—åˆ°æœ€ç»ˆçš„æ£€æµ‹ç»“æœï¼Œè¿™éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">detection_feat, feat_sizes=(<span class="params"><span class="number">13</span>, <span class="number">13</span></span>), num_classes=<span class="number">80</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">           anchors=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;decode from the detection feature&quot;&quot;&quot;</span></span><br><span class="line">    H, W = feat_sizes</span><br><span class="line">    num_anchors = <span class="built_in">len</span>(anchors)</span><br><span class="line">    detetion_results = tf.reshape(detection_feat, [-<span class="number">1</span>, H * W, num_anchors,</span><br><span class="line">                                        num_classes + <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">    bbox_xy = tf.nn.sigmoid(detetion_results[:, :, :, <span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">    bbox_wh = tf.exp(detetion_results[:, :, :, <span class="number">2</span>:<span class="number">4</span>])</span><br><span class="line">    obj_probs = tf.nn.sigmoid(detetion_results[:, :, :, <span class="number">4</span>])</span><br><span class="line">    class_probs = tf.nn.softmax(detetion_results[:, :, :, <span class="number">5</span>:])</span><br><span class="line"></span><br><span class="line">    anchors = tf.constant(anchors, dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">    height_ind = tf.<span class="built_in">range</span>(H, dtype=tf.float32)</span><br><span class="line">    width_ind = tf.<span class="built_in">range</span>(W, dtype=tf.float32)</span><br><span class="line">    x_offset, y_offset = tf.meshgrid(height_ind, width_ind)</span><br><span class="line">    x_offset = tf.reshape(x_offset, [<span class="number">1</span>, -<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">    y_offset = tf.reshape(y_offset, [<span class="number">1</span>, -<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># decode</span></span><br><span class="line">    bbox_x = (bbox_xy[:, :, :, <span class="number">0</span>] + x_offset) / W</span><br><span class="line">    bbox_y = (bbox_xy[:, :, :, <span class="number">1</span>] + y_offset) / H</span><br><span class="line">    bbox_w = bbox_wh[:, :, :, <span class="number">0</span>] * anchors[:, <span class="number">0</span>] / W * <span class="number">0.5</span></span><br><span class="line">    bbox_h = bbox_wh[:, :, :, <span class="number">1</span>] * anchors[:, <span class="number">1</span>] / H * <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    bboxes = tf.stack([bbox_x - bbox_w, bbox_y - bbox_h,</span><br><span class="line">                       bbox_x + bbox_w, bbox_y + bbox_h], axis=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bboxes, obj_probs, class_probs</span><br></pre></td></tr></table></figure>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>è¿™ä¸ªæŸå¤±å‡½æ•°æœ€éš¾çš„åœ°æ–¹åº”è¯¥æ˜¯YOLOv2åˆ©ç”¨sigmoidå‡½æ•°è®¡ç®—é»˜è®¤æ¡†åæ ‡ä¹‹åæ€ä¹ˆæ¢¯åº¦å›ä¼ ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœ‹ä¸‹é¢çš„ä»£ç (æ¥è‡ªDarknetæºç )ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// boxè¯¯å·®å‡½æ•°ï¼Œè®¡ç®—æ¢¯åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">delta_region_box</span><span class="params">(box truth, <span class="keyword">float</span> *x, <span class="keyword">float</span> *biases, <span class="keyword">int</span> n, <span class="keyword">int</span> index, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">float</span> *delta, <span class="keyword">float</span> scale, <span class="keyword">int</span> stride)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    box pred = <span class="built_in">get_region_box</span>(x, biases, n, index, i, j, w, h, stride);</span><br><span class="line">    <span class="keyword">float</span> iou = <span class="built_in">box_iou</span>(pred, truth);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// è®¡ç®—ground truthçš„offsetså€¼</span></span><br><span class="line">    <span class="keyword">float</span> tx = (truth.x*w - i);</span><br><span class="line">    <span class="keyword">float</span> ty = (truth.y*h - j);</span><br><span class="line">    <span class="keyword">float</span> tw = <span class="built_in">log</span>(truth.w*w / biases[<span class="number">2</span>*n]);</span><br><span class="line">    <span class="keyword">float</span> th = <span class="built_in">log</span>(truth.h*h / biases[<span class="number">2</span>*n + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    delta[index + <span class="number">0</span>*stride] = scale * (tx - x[index + <span class="number">0</span>*stride]);</span><br><span class="line">    delta[index + <span class="number">1</span>*stride] = scale * (ty - x[index + <span class="number">1</span>*stride]);</span><br><span class="line">    delta[index + <span class="number">2</span>*stride] = scale * (tw - x[index + <span class="number">2</span>*stride]);</span><br><span class="line">    delta[index + <span class="number">3</span>*stride] = scale * (th - x[index + <span class="number">3</span>*stride]);</span><br><span class="line">    <span class="keyword">return</span> iou;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“åˆä¸€ä¸‹å‰é¢ä»‹ç»çš„å…¬å¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªé€†è¿‡ç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOV1æŸå¤±å‡½æ•°ä»£ç è¯¦è§£(detection_layer.c)</title>
    <url>/2020/02/26/YOLOV1%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3(detection_layer.c)/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çµé­‚æ‹·é—®ï¼Œä½ çœŸçš„æ‡‚YOLOV1çš„æŸå¤±å‡½æ•°å—ï¼Ÿè¿›ä¸€æ­¥ï¼Œæ‡‚äº†æŸå¤±å‡½æ•°ï¼Œä½ æ¸…æ¥šå®ƒçš„åå‘æ±‚å¯¼è¿‡ç¨‹å—ï¼Ÿä¸ºäº†è§£å†³è¿™ä¿©é—®é¢˜ï¼Œæœ¬æ–‡å°±ç»“åˆDarkNetä¸­çš„YOLOV1çš„æŸå¤±å‡½æ•°ä»£ç å®ç°(åœ¨<code>src/detection_layer.c</code>ä¸­)æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p>
<h2 id="æŸå¤±å‡½æ•°å…¬å¼"><a href="#æŸå¤±å‡½æ•°å…¬å¼" class="headerlink" title="æŸå¤±å‡½æ•°å…¬å¼"></a>æŸå¤±å‡½æ•°å…¬å¼</h2><p>YOLOV1çš„æŸå¤±å‡½æ•°å°±æ˜¯è¿™æ ·ï¼Œä¸åšè¿‡å¤šè§£é‡Šäº†ã€‚éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œåœ¨åå‘ä¼ æ’­æ±‚å¯¼çš„æ—¶å€™ï¼Œå„ä¸ªå˜é‡çš„æ¢¯åº¦å…¶å®åº”è¯¥éƒ½æœ‰ä¸€ä¸ª<strong>ç³»æ•°2</strong>çš„ï¼Œä½†æ˜¯ä»£ç ä¸­å…¨éƒ¨éƒ½çœæ‰äº†ï¼Œè¿™å¯¹æ•´ä¸ªä¼˜åŒ–è¿‡ç¨‹å…¶å®æ˜¯æ²¡æœ‰å½±å“çš„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/660.png" alt></p>
<h2 id="ä»£ç è¯¦ç»†è§£æ"><a href="#ä»£ç è¯¦ç»†è§£æ" class="headerlink" title="ä»£ç è¯¦ç»†è§£æ"></a>ä»£ç è¯¦ç»†è§£æ</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„å»ºdetectionå±‚ï¼Œyolov1ä¸­æœ€åä¸€å±‚</span></span><br><span class="line"><span class="comment"> * @param batch ä¸€ä¸ªbatchåŒ…å«å›¾ç‰‡çš„å¼ æ•°</span></span><br><span class="line"><span class="comment"> * @param inputs detectionå±‚ä¸€å¼ è¾“å…¥å›¾ç‰‡å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> * @param n yolov1ä¸€ä¸ªgrid cellé¢„æµ‹bboxçš„æ•°é‡ 2</span></span><br><span class="line"><span class="comment"> * @param side // grid cellçš„å¤§å° 7</span></span><br><span class="line"><span class="comment"> * @param classes yolov1 é¢„æµ‹ç±»çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> * @param coords ä¸€ä¸ªbboxåŒ…å«çš„åæ ‡æ•°é‡ 4</span></span><br><span class="line"><span class="comment"> * @param rescore</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">detection_layer <span class="title">make_detection_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> inputs, <span class="keyword">int</span> n, <span class="keyword">int</span> side, <span class="keyword">int</span> classes, <span class="keyword">int</span> coords, <span class="keyword">int</span> rescore)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    detection_layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    l.type = DETECTION;</span><br><span class="line">	<span class="comment">// è¿™äº›å˜é‡éƒ½å¯ä»¥å‚è€ƒdarknet.hä¸­çš„æ³¨é‡Š</span></span><br><span class="line">    l.n = n; <span class="comment">//ä¸€ä¸ªcellä¸­é¢„æµ‹å¤šå°‘ä¸ªbox</span></span><br><span class="line">    l.batch = batch; <span class="comment">//ä¸€ä¸ªbatchä¸­åŒ…å«å›¾ç‰‡çš„å¼ æ•°</span></span><br><span class="line">    l.inputs = inputs; <span class="comment">//detectionå±‚ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    l.classes = classes; <span class="comment">//ç±»åˆ«æ•°</span></span><br><span class="line">    l.coords = coords; <span class="comment">//ä¸€ä¸ªbboxåŒ…å«çš„åæ ‡æ•°é‡</span></span><br><span class="line">    l.rescore = rescore;</span><br><span class="line">    l.side = side; <span class="comment">//grid cellçš„å¤§å° 7</span></span><br><span class="line">    l.w = side; <span class="comment">//grid cellçš„å®½åº¦</span></span><br><span class="line">    l.h = side; <span class="comment">//grid cellçš„é«˜åº¦</span></span><br><span class="line">    <span class="built_in">assert</span>(side*side*((<span class="number">1</span> + l.coords)*l.n + l.classes) == inputs); <span class="comment">//7*7*(1 + 4) * 2 + 30 ) = 7*7*30</span></span><br><span class="line">    l.cost = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//detectionå±‚çš„æ€»æŸå¤±</span></span><br><span class="line">    l.outputs = l.inputs; <span class="comment">//detectionå±‚å¯¹åº”è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼Œdetectionå±‚ä¸æ”¹å˜è¾“å…¥è¾“å‡ºå¤§å°</span></span><br><span class="line">    l.truths = l.side*l.side*(<span class="number">1</span>+l.coords+l.classes); <span class="comment">//GT:7*7*(1+4+20) åªæœ‰ä¸€ä¸ªbboxå’Œç½®ä¿¡åº¦</span></span><br><span class="line">    l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// detectionå±‚æ‰€æœ‰è¾“å‡ºï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line">    l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(batch * l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//detectionå±‚è¯¯å·®é¡¹ï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line"></span><br><span class="line">    l.forward = forward_detection_layer; <span class="comment">//å‰å‘ä¼ æ’­</span></span><br><span class="line">    l.backward = backward_detection_layer; <span class="comment">//åå‘ä¼ æ’­</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    l.forward_gpu = forward_detection_layer_gpu;</span><br><span class="line">    l.backward_gpu = backward_detection_layer_gpu;</span><br><span class="line">    l.output_gpu = <span class="built_in">cuda_make_array</span>(l.output, batch*l.outputs);</span><br><span class="line">    l.delta_gpu = <span class="built_in">cuda_make_array</span>(l.delta, batch*l.outputs);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Detection Layer\n&quot;</span>);</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * detectionå±‚å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @param l å½“å‰detectionå±‚</span></span><br><span class="line"><span class="comment"> * @param net æ•´ä¸ªç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_detection_layer</span><span class="params">(<span class="keyword">const</span> detection_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> locations = l.side*l.side; <span class="comment">//grid cellçš„æ•°é‡7*7=49</span></span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="built_in">memcpy</span>(l.output, state.input, l.outputs*l.batch*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="comment">//if(l.reorg) reorg(l.output, l.w*l.h, size*l.n, l.batch, 1);</span></span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    <span class="keyword">if</span> (l.softmax)&#123; <span class="comment">//yolo v1è¿™é‡Œä¸º0ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">for</span>(b = <span class="number">0</span>; b &lt; l.batch; ++b)&#123;</span><br><span class="line">            <span class="keyword">int</span> index = b*l.inputs;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; locations; ++i) &#123;</span><br><span class="line">                <span class="keyword">int</span> offset = i*l.classes;</span><br><span class="line">                <span class="built_in">softmax</span>(l.output + index + offset, l.classes, <span class="number">1</span>,</span><br><span class="line">                        l.output + index + offset, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(state.train)&#123;</span><br><span class="line">        <span class="keyword">float</span> avg_iou = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> avg_cat = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> avg_allcat = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> avg_obj = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> avg_anyobj = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        *(l.cost) = <span class="number">0</span>; <span class="comment">//detectionå±‚çš„æ€»æŸå¤±</span></span><br><span class="line">        <span class="keyword">int</span> size = l.inputs * l.batch; <span class="comment">//è¯¯å·®é¡¹çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="built_in">memset</span>(l.delta, <span class="number">0</span>, size * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//è¯¯å·®é¡¹åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b)&#123;</span><br><span class="line">            <span class="keyword">int</span> index = b*l.inputs; <span class="comment">//ç¬¬bä¸ªbatchçš„èµ·å§‹ä½ç½®</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; locations; ++i) &#123; <span class="comment">//ç¬¬iä¸ªgrid cellï¼Œä¸€å…±æœ‰7*7ä¸ª</span></span><br><span class="line">                <span class="keyword">int</span> truth_index = (b*locations + i)*(<span class="number">1</span>+l.coords+l.classes); <span class="comment">//è·å–ç¬¬iä¸ªgrid cellçš„bboxçš„GT</span></span><br><span class="line">                <span class="keyword">int</span> is_obj = state.truth[truth_index]; <span class="comment">//è·å–ç¬¬iä¸ªgrid cellæ˜¯å¦åŒ…å«ç‰©ä½“</span></span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.n; ++j) &#123; <span class="comment">// è·å–yolov1 ç¬¬iä¸ªgrid cellé¢„æµ‹çš„ä¸¤ä¸ªbboxï¼Œä¸GTæ¯”è¾ƒ</span></span><br><span class="line">                    <span class="keyword">int</span> p_index = index + locations*l.classes + i*l.n + j; <span class="comment">// è·å–ç¬¬jä¸ªé¢„æµ‹çš„bboxèµ·å§‹ä½ç½®</span></span><br><span class="line">                    l.delta[p_index] = l.noobject_scale*(<span class="number">0</span> - l.output[p_index]); <span class="comment">// bboxä¸­ä¸å«objectçš„ç½®ä¿¡åº¦è¯¯å·®é¡¹ï¼Œ noobject_scale=0.5 Loss 1-4(1-4æŒ‡çš„æ˜¯å…¬å¼)</span></span><br><span class="line">                    *(l.cost) += l.noobject_scale*<span class="built_in">pow</span>(l.output[p_index], <span class="number">2</span>); <span class="comment">//ç¬¬iä¸ªgrid cellä¸­ç¬¬jä¸ªé¢„æµ‹bboxä¸­ï¼Œä¸å«objectçš„ç½®ä¿¡åº¦æŸå¤±è®¡ç®—ï¼ŒLoss 1-4</span></span><br><span class="line">                    avg_anyobj += l.output[p_index]; <span class="comment">//bboxä¸­ä¸å«objectçš„ç½®ä¿¡åº¦æ±‚å’Œ</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> best_index = <span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">float</span> best_iou = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">float</span> best_rmse = <span class="number">20</span>; <span class="comment">//best bboxçš„rmseé˜ˆå€¼</span></span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (!is_obj)&#123; <span class="comment">// å½“å‰ç¬¬iä¸ªgrid cell, ç¬¬jä¸ªbboxä¸å«object, åˆ™lossè®¡ç®—å®Œæˆ</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// å½“å‰ç¬¬iä¸ªgrid cell, ç¬¬jä¸ªbboxå«æœ‰objectï¼Œç»§ç»­è®¡ç®—åæ ‡é¢„æµ‹æŸå¤±Loss 1-1,1-2ï¼Œconfidenceé¢„æµ‹æŸå¤±Loss 1-3ï¼Œç±»åˆ«é¢„æµ‹æŸå¤±Loss 1-5</span></span><br><span class="line">                <span class="keyword">int</span> class_index = index + i*l.classes;<span class="comment">// è·å–ç¬¬iä¸ªgrid cellçš„classesèµ·å§‹ä½ç½®</span></span><br><span class="line">                <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; l.classes; ++j) &#123;</span><br><span class="line">					<span class="comment">//ç¬¬iä¸ªgrid cellé¢„æµ‹åˆ†ç±»è¯¯å·®é¡¹</span></span><br><span class="line">                    l.delta[class_index+j] = l.class_scale * (state.truth[truth_index+<span class="number">1</span>+j] - l.output[class_index+j]); <span class="comment">// ç¬¬iä¸ªgrid cellé¢„æµ‹åˆ†ç±»è¯¯å·®é¡¹</span></span><br><span class="line">                    *(l.cost) += l.class_scale * <span class="built_in">pow</span>(state.truth[truth_index+<span class="number">1</span>+j] - l.output[class_index+j], <span class="number">2</span>); <span class="comment">// ç±»åˆ«é¢„æµ‹æŸå¤±è®¡ç®—ï¼Œ Loss 1-5</span></span><br><span class="line">                    <span class="keyword">if</span>(state.truth[truth_index + <span class="number">1</span> + j]) avg_cat += l.output[class_index+j]; <span class="comment">// GTå¯¹åº”çš„grid cellé¢„æµ‹åˆ†ç±»å€¼æ±‚å’Œ</span></span><br><span class="line">                    avg_allcat += l.output[class_index+j]; <span class="comment">// æ‰€æœ‰grid cellé¢„æµ‹åˆ†ç±»å€¼æ±‚å’Œ</span></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// è·å–ç¬¬iä¸ªgrid cell, GT BBOXçš„[x, y, w, h], float_to_box ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯bboxèµ·å§‹ä½ç½®</span></span><br><span class="line">                box truth = <span class="built_in">float_to_box</span>(state.truth + truth_index + <span class="number">1</span> + l.classes);</span><br><span class="line">                truth.x /= l.side;</span><br><span class="line">                truth.y /= l.side;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//åæ ‡é¢„æµ‹æŸå¤±è®¡ç®— Loss 1-1, 1-2</span></span><br><span class="line">				<span class="comment">// æ‰¾åˆ°ç¬¬iä¸ªgrid cellçš„best bbox</span></span><br><span class="line">                <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; l.n; ++j)&#123;</span><br><span class="line">					<span class="comment">//ç¬¬iä¸ªgrid cellé¢„æµ‹ç¬¬jä¸ªbboxçš„èµ·å§‹ä½ç½®</span></span><br><span class="line">                    <span class="keyword">int</span> box_index = index + locations*(l.classes + l.n) + (i*l.n + j) * l.coords;</span><br><span class="line">                    box out = <span class="built_in">float_to_box</span>(l.output + box_index); <span class="comment">// è·å–é¢„æµ‹bboxçš„[x,y,w,h]</span></span><br><span class="line">					<span class="comment">//yolo v1 ç›´æ¥å›å½’çš„æ˜¯ 7*x, æ‰€ä»¥ä¸GT bbox è®¡ç®—IOU, éœ€è¦å…ˆé™¤ä»¥7</span></span><br><span class="line">                    out.x /= l.side;</span><br><span class="line">                    out.y /= l.side;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (l.sqrt)&#123;</span><br><span class="line">						<span class="comment">//yolo v1ç›´æ¥å›å½’çš„sqrt(w), æ‰€ä»¥ä¸GT bbox è®¡ç®—IOUå‰ï¼Œéœ€è¦powä¸€ä¸‹</span></span><br><span class="line">                        out.w = out.w*out.w;</span><br><span class="line">                        out.h = out.h*out.h;</span><br><span class="line">                    &#125;</span><br><span class="line">					<span class="comment">//è®¡ç®—é¢„æµ‹bboxä¸ GT bboxä¹‹é—´çš„IOU</span></span><br><span class="line">                    <span class="keyword">float</span> iou  = <span class="built_in">box_iou</span>(out, truth);</span><br><span class="line">                    <span class="comment">//iou = 0;</span></span><br><span class="line">					<span class="comment">//è®¡ç®—é¢„æµ‹bboxçš„[x,y]ä¸GT bboxçš„[x,y]ä¹‹é—´çš„å‡æ–¹å·®æŸå¤± Loss 1-1</span></span><br><span class="line">                    <span class="keyword">float</span> rmse = <span class="built_in">box_rmse</span>(out, truth);</span><br><span class="line">					<span class="comment">// æ‰¾åˆ°ç¬¬iä¸ªgrid cellé¢„æµ‹æœ€å¤§çš„é‚£ä¸ªbbox</span></span><br><span class="line">                    <span class="keyword">if</span>(best_iou &gt; <span class="number">0</span> || iou &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(iou &gt; best_iou)&#123;</span><br><span class="line">                            best_iou = iou;</span><br><span class="line">                            best_index = j;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123; <span class="comment">// å‡æ–¹å·®æœ€å°çš„</span></span><br><span class="line">                        <span class="keyword">if</span>(rmse &lt; best_rmse)&#123;</span><br><span class="line">                            best_rmse = rmse;</span><br><span class="line">                            best_index = j;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªbbox</span></span><br><span class="line">                <span class="keyword">if</span>(l.forced)&#123;</span><br><span class="line">					<span class="comment">// GT bbox w*h &lt; 0.1,å¼ºåˆ¶æœ€å¥½çš„bbox indexæ˜¯1</span></span><br><span class="line">                    <span class="keyword">if</span>(truth.w*truth.h &lt; <span class="number">.1</span>)&#123;</span><br><span class="line">                        best_index = <span class="number">1</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        best_index = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">//éšæœºé€‰æ‹©æœ€ä½³bbox</span></span><br><span class="line">                <span class="keyword">if</span>(l.random &amp;&amp; *(state.net.seen) &lt; <span class="number">64000</span>)&#123;</span><br><span class="line">                    best_index = <span class="built_in">rand</span>()%l.n;</span><br><span class="line">                &#125;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// æ¨¡å‹é¢„æµ‹çš„bboxèµ·å§‹ä½ç½®</span></span><br><span class="line">                <span class="keyword">int</span> box_index = index + locations*(l.classes + l.n) + (i*l.n + best_index) * l.coords;</span><br><span class="line">                <span class="keyword">int</span> tbox_index = truth_index + <span class="number">1</span> + l.classes;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// è·å–æœ€ä½³bboxçš„[x, y, w, h]</span></span><br><span class="line">                box out = <span class="built_in">float_to_box</span>(l.output + box_index);</span><br><span class="line">                out.x /= l.side; <span class="comment">// å½’ä¸€åŒ–x</span></span><br><span class="line">                out.y /= l.side;</span><br><span class="line">                <span class="keyword">if</span> (l.sqrt) &#123; <span class="comment">// yolo v1ç›´æ¥å›å½’çš„sqrt(w), æ‰€ä»¥ä¸GT bbox è®¡ç®—IOUå‰ï¼Œéœ€è¦powä¸€ä¸‹</span></span><br><span class="line">                    out.w = out.w*out.w;</span><br><span class="line">                    out.h = out.h*out.h;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">float</span> iou  = <span class="built_in">box_iou</span>(out, truth); <span class="comment">// è®¡ç®—äºŒè€…IOU</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//printf(&quot;%d,&quot;, best_index);</span></span><br><span class="line">				<span class="comment">// è·å–ç¬¬iä¸ªgrid cellï¼Œbest bboxçš„èµ·å§‹ä½ç½®</span></span><br><span class="line">                <span class="keyword">int</span> p_index = index + locations*l.classes + i*l.n + best_index;</span><br><span class="line">				<span class="comment">// å‡å»ä¹‹å‰è®¡ç®—ä¸å«objectçš„confidenceé¢„æµ‹æŸå¤±</span></span><br><span class="line">                *(l.cost) -= l.noobject_scale * <span class="built_in">pow</span>(l.output[p_index], <span class="number">2</span>);</span><br><span class="line">				<span class="comment">// å«æœ‰objectçš„confidenceçš„é¢„æµ‹æŸå¤±</span></span><br><span class="line">                *(l.cost) += l.object_scale * <span class="built_in">pow</span>(<span class="number">1</span>-l.output[p_index], <span class="number">2</span>);</span><br><span class="line">				<span class="comment">// bboxä¸­å«objectçš„ç½®ä¿¡åº¦æ±‚å’Œ</span></span><br><span class="line">                avg_obj += l.output[p_index];</span><br><span class="line">				<span class="comment">// ç¬¬iä¸ªå«æœ‰objectçš„é‚£ä¸ªbest bbox,grid cellé¢„æµ‹åˆ†ç±»è¯¯å·®é¡¹</span></span><br><span class="line">                l.delta[p_index] = l.object_scale * (<span class="number">1.</span>-l.output[p_index]);</span><br><span class="line">				<span class="comment">//yolo v1è¿™é‡Œä¸º0ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨</span></span><br><span class="line">                <span class="keyword">if</span>(l.rescore)&#123;</span><br><span class="line">                    l.delta[p_index] = l.object_scale * (iou - l.output[p_index]);</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// ç¬¬iä¸ªgrid cellçš„xå¯¹åº”è¯¯å·®é¡¹è®¡ç®—</span></span><br><span class="line">                l.delta[box_index+<span class="number">0</span>] = l.coord_scale*(state.truth[tbox_index + <span class="number">0</span>] - l.output[box_index + <span class="number">0</span>]);</span><br><span class="line">				<span class="comment">// ç¬¬iä¸ªgrid cellçš„yå¯¹åº”è¯¯å·®é¡¹è®¡ç®—</span></span><br><span class="line">                l.delta[box_index+<span class="number">1</span>] = l.coord_scale*(state.truth[tbox_index + <span class="number">1</span>] - l.output[box_index + <span class="number">1</span>]);</span><br><span class="line">				<span class="comment">// ç¬¬iä¸ªgrid cellçš„wå¯¹åº”è¯¯å·®é¡¹è®¡ç®—</span></span><br><span class="line">                l.delta[box_index+<span class="number">2</span>] = l.coord_scale*(state.truth[tbox_index + <span class="number">2</span>] - l.output[box_index + <span class="number">2</span>]);</span><br><span class="line">				<span class="comment">// ç¬¬iä¸ªgrid cellçš„hå¯¹åº”è¯¯å·®é¡¹è®¡ç®—</span></span><br><span class="line">                l.delta[box_index+<span class="number">3</span>] = l.coord_scale*(state.truth[tbox_index + <span class="number">3</span>] - l.output[box_index + <span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">if</span>(l.sqrt)&#123;</span><br><span class="line">					<span class="comment">// Loss 1-2è®¡ç®—, GT bboxéœ€è¦å¼€æ ¹å·</span></span><br><span class="line">                    l.delta[box_index+<span class="number">2</span>] = l.coord_scale*(<span class="built_in">sqrt</span>(state.truth[tbox_index + <span class="number">2</span>]) - l.output[box_index + <span class="number">2</span>]);</span><br><span class="line">                    l.delta[box_index+<span class="number">3</span>] = l.coord_scale*(<span class="built_in">sqrt</span>(state.truth[tbox_index + <span class="number">3</span>]) - l.output[box_index + <span class="number">3</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                *(l.cost) += <span class="built_in">pow</span>(<span class="number">1</span>-iou, <span class="number">2</span>);</span><br><span class="line">                avg_iou += iou; <span class="comment">// åŒ…å«objectçš„grid cellï¼Œbest bbox ä¸ GT bboxçš„IOUæ±‚å’Œ</span></span><br><span class="line">                ++count;  <span class="comment">// è®­ç»ƒé˜¶æ®µï¼Œæˆªæ­¢åˆ°æœ¬batchçš„è®­ç»ƒå®Œï¼ŒåŒ…å«objectæ€»æ•°é‡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// ä¸€ä¸ªbatchä¸­æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">float</span>* costs = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(l.batch * locations * l.n, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">            <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = b*l.inputs;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; locations; ++i) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.n; ++j) &#123;</span><br><span class="line">                        <span class="keyword">int</span> p_index = index + locations*l.classes + i*l.n + j;</span><br><span class="line">                        costs[b*locations*l.n + i*l.n + j] = l.delta[p_index]*l.delta[p_index];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> indexes[<span class="number">100</span>];</span><br><span class="line">            <span class="built_in">top_k</span>(costs, l.batch*locations*l.n, <span class="number">100</span>, indexes);</span><br><span class="line">            <span class="keyword">float</span> cutoff = costs[indexes[<span class="number">99</span>]];</span><br><span class="line">            <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = b*l.inputs;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; locations; ++i) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.n; ++j) &#123;</span><br><span class="line">                        <span class="keyword">int</span> p_index = index + locations*l.classes + i*l.n + j;</span><br><span class="line">                        <span class="keyword">if</span> (l.delta[p_index]*l.delta[p_index] &lt; cutoff) l.delta[p_index] = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">free</span>(costs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//ä¸€ä¸ªbatchçš„æ€»æŸå¤±è®¡ç®—</span></span><br><span class="line">        *(l.cost) = <span class="built_in">pow</span>(<span class="built_in">mag_array</span>(l.delta, l.outputs * l.batch), <span class="number">2</span>); <span class="comment">// ä¸€ä¸ªbatchçš„æ€»æŸå¤±è®¡ç®—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Detection Avg IOU: %f, Pos Cat: %f, All Cat: %f, Pos Obj: %f, Any Obj: %f, count: %d\n&quot;</span>, avg_iou/count, avg_cat/count, avg_allcat/(count*l.classes), avg_obj/count, avg_anyobj/(l.batch*locations*l.n), count);</span><br><span class="line">        <span class="comment">//if(l.reorg) reorg(l.delta, l.w*l.h, size*l.n, l.batch, 0);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * detectionå±‚åå‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @param l å½“å‰detectionå±‚</span></span><br><span class="line"><span class="comment"> * @param net æ•´ä¸ªç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_detection_layer</span><span class="params">(<span class="keyword">const</span> detection_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">axpy_cpu</span>(l.batch*l.inputs, <span class="number">1</span>, l.delta, <span class="number">1</span>, state.delta, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * yolo v1 Infence é˜¶æ®µï¼Œè§£æ7*7*30</span></span><br><span class="line"><span class="comment"> * @param l å½“å‰detectionå±‚</span></span><br><span class="line"><span class="comment"> * @param w è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line"><span class="comment"> * @param h è¾“å…¥å›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line"><span class="comment"> * @param thresh confidenceé˜ˆå€¼</span></span><br><span class="line"><span class="comment"> * @param dets ç”¨äºä¿å­˜ç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_detection_detections</span><span class="params">(layer l, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">float</span> thresh, detection *dets)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j, n;</span><br><span class="line">	<span class="keyword">float</span> *predictions = l.output;</span><br><span class="line">	<span class="comment">//int per_cell = 5*num+classes;</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.side*l.side; ++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> row = i / l.side; <span class="comment">//è·å–grid cellçš„è¡Œå·</span></span><br><span class="line">		<span class="keyword">int</span> col = i % l.side; <span class="comment">//è·å–grid cellçš„åˆ—å·</span></span><br><span class="line">		<span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.n; ++n) &#123; <span class="comment">//éå†ä¸¤ä¸ªbox</span></span><br><span class="line">			<span class="keyword">int</span> index = i*l.n + n;</span><br><span class="line">			<span class="keyword">int</span> p_index = l.side*l.side*l.classes + i*l.n + n;</span><br><span class="line">			<span class="keyword">float</span> scale = predictions[p_index];</span><br><span class="line">			<span class="keyword">int</span> box_index = l.side*l.side*(l.classes + l.n) + (i*l.n + n) * <span class="number">4</span>;</span><br><span class="line">			box b;</span><br><span class="line">			b.x = (predictions[box_index + <span class="number">0</span>] + col) / l.side * w; <span class="comment">// åæ ‡è½¬æ¢ä¸ºçœŸå®å€¼</span></span><br><span class="line">			b.y = (predictions[box_index + <span class="number">1</span>] + row) / l.side * h;</span><br><span class="line">			b.w = <span class="built_in">pow</span>(predictions[box_index + <span class="number">2</span>], (l.sqrt ? <span class="number">2</span> : <span class="number">1</span>)) * w;</span><br><span class="line">			b.h = <span class="built_in">pow</span>(predictions[box_index + <span class="number">3</span>], (l.sqrt ? <span class="number">2</span> : <span class="number">1</span>)) * h;</span><br><span class="line">			dets[index].bbox = b;</span><br><span class="line">			dets[index].objectness = scale; <span class="comment">// ä¿å­˜æ¡†ç½®ä¿¡åº¦å¾—åˆ†</span></span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.classes; ++j) &#123;</span><br><span class="line">				<span class="keyword">int</span> class_index = i*l.classes;</span><br><span class="line">				<span class="keyword">float</span> prob = scale*predictions[class_index + j]; <span class="comment">// ç±»åˆ«ç½®ä¿¡åº¦å¾—åˆ†=æ¡ä»¶ç±»åˆ«æ¦‚ç‡Ã—æ¡†ç½®ä¿¡åº¦å¾—åˆ†</span></span><br><span class="line">				dets[index].prob[j] = (prob &gt; thresh) ? prob : <span class="number">0</span>; <span class="comment">// ä½äºé˜ˆå€¼ä¸€å¾‹ç½®ä¸º0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv3åŠYOLOv3-Tiny</title>
    <url>/2020/03/02/YOLOv3%E5%8F%8AYOLOv3-Tiny/</url>
    <content><![CDATA[<h2 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h2><p>YOLOv3åº”è¯¥æ˜¯ç°åœ¨YOLOç³»åˆ—åº”ç”¨çš„æœ€å¹¿æ³›çš„ç®—æ³•äº†ï¼ŒåŸºæœ¬å°±å¾ˆå°‘æœ‰äººåšå·¥ç¨‹è¿˜ç”¨V2äº†ã€‚è€ŒYOLOv3çš„ç®—æ³•åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±å¼•å…¥äº†2ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ®‹å·®æ¨¡å‹ï¼Œä¸€ä¸ªæ˜¯FPNæ¶æ„ã€‚</p>
<h2 id="æ®‹å·®æ¨¡å‹Darknet-53"><a href="#æ®‹å·®æ¨¡å‹Darknet-53" class="headerlink" title="æ®‹å·®æ¨¡å‹Darknet-53"></a>æ®‹å·®æ¨¡å‹Darknet-53</h2><p>YOLOv3åœ¨YOLOv2æå‡ºçš„Darknet-19çš„åŸºç¡€ä¸Šå¼•å…¥äº†æ®‹å·®æ¨¡å—ï¼Œå¹¶è¿›ä¸€æ­¥åŠ æ·±äº†ç½‘ç»œï¼Œæ”¹è¿›åçš„ç½‘ç»œæœ‰53ä¸ªå·ç§¯å±‚ï¼Œå‘½åä¸ºDarknet-53ï¼Œç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/2709767-e65c08c61bfaa7c7.png" alt></p>
<p>åŒæ—¶ä¸ºäº†è¯´æ˜Darknet-53çš„æœ‰æ•ˆæ€§ï¼Œä½œè€…ç»™å‡ºäº†åœ¨TitanXä¸Šï¼Œä½¿ç”¨ç›¸åŒçš„æ¡ä»¶å°†256 x 256çš„å›¾ç‰‡åˆ†åˆ«è¾“å…¥åˆ°ä»¥Darknet-19ï¼ŒResnet-101ï¼Œä»¥åŠResnet-152ä»¥åŠDarknet-53ä¸ºåŸºç¡€ç½‘ç»œçš„åˆ†ç±»æ¨¡å‹æ€»ï¼Œå®éªŒç»“æœå¦‚ä¸‹è¡¨ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv3/640.png" alt></p>
<p>ä»ç»“æœæ¥çœ‹ï¼ŒDarknet-53æ¯”ResNet-101çš„æ€§èƒ½æ›´å¥½ï¼Œè€Œä¸”é€Ÿåº¦æ˜¯å…¶1.5å€ï¼ŒDarknet-53ä¸ResNet-152æ€§èƒ½ç›¸ä¼¼ä½†é€Ÿåº¦å‡ ä¹æ˜¯å…¶2å€ã€‚åŒæ—¶ï¼ŒDarknet-53ç›¸æ¯”äºå…¶å®ƒç½‘ç»œç»“æ„å®ç°äº†æ¯ç§’æœ€é«˜çš„æµ®ç‚¹æ•°è®¡ç®—é‡ï¼Œè¯´æ˜å…¶ç½‘ç»œç»“æ„å¯ä»¥æ›´å¥½çš„åˆ©ç”¨GPUã€‚</p>
<h2 id="YOLOV3ç»“æ„"><a href="#YOLOV3ç»“æ„" class="headerlink" title="YOLOV3ç»“æ„"></a>YOLOV3ç»“æ„</h2><p>ä¸€å¼ éå¸¸è¯¦ç»†çš„ç»“æ„å›¾ï¼Œå…¶ä¸­YOLOv3æœ‰ä¸‰ä¸ªè¾“å‡ºï¼Œç»´åº¦åˆ†åˆ«æ˜¯: (batchsize, 52,52,75 ) (batchsize, 26,26,75 ) (batchsize, 13,13,75 )è¿™é‡Œçš„75ä»£è¡¨çš„$3 \times(20+5)$ï¼Œå…¶ä¸­20ä»£è¡¨çš„æ˜¯COCOæ•°æ®é›†ç›®æ ‡ç±»åˆ«æ•°ï¼Œ5ä»£è¡¨çš„æ˜¯æ¯ä¸ªç›®æ ‡é¢„æµ‹æ¡†çš„$t_{x}, t_{y}, t_{w}, t_{h}, t_{o}$ï¼Œ3ä»£è¡¨çš„æ˜¯æŸä¸€ä¸ªç‰¹å¾å›¾çš„Anchorï¼Œä¹Ÿå³å…ˆéªŒæ¡†çš„æ•°ç›®ã€‚æ‰€ä»¥YOLOv3ä¸€å…±æœ‰9ä¸ªAnchorï¼Œä¸è¿‡è¢«å¹³å‡åˆ†åœ¨äº†3ä¸ªç‰¹å¾å±‚ä¸­ï¼Œè¿™ä¹Ÿå®ç°äº†å¤šå°ºåº¦æ£€æµ‹ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv3/641.webp" alt></p>
<h2 id="å¤šå°ºåº¦æ£€æµ‹"><a href="#å¤šå°ºåº¦æ£€æµ‹" class="headerlink" title="å¤šå°ºåº¦æ£€æµ‹"></a>å¤šå°ºåº¦æ£€æµ‹</h2><p>æ€»ç»“ä¸€ä¸‹ï¼ŒYOLOv3å€Ÿé‰´äº†FPNçš„æ€æƒ³ï¼Œä»ä¸åŒå°ºåº¦æå–ç‰¹å¾ã€‚ç›¸æ¯”YOLOv2ï¼ŒYOLOv3æå–æœ€å3å±‚ç‰¹å¾å›¾ï¼Œä¸ä»…åœ¨æ¯ä¸ªç‰¹å¾å›¾ä¸Šåˆ†åˆ«ç‹¬ç«‹åšé¢„æµ‹ï¼ŒåŒæ—¶é€šè¿‡å°†å°ç‰¹å¾å›¾ä¸Šé‡‡æ ·åˆ°ä¸å¤§çš„ç‰¹å¾å›¾ç›¸åŒå¤§å°ï¼Œç„¶åä¸å¤§çš„ç‰¹å¾å›¾æ‹¼æ¥åšè¿›ä¸€æ­¥é¢„æµ‹ã€‚ç”¨ç»´åº¦èšç±»çš„æ€æƒ³èšç±»å‡º9ç§å°ºåº¦çš„anchor boxï¼Œå°†9ç§å°ºåº¦çš„anchor boxå‡åŒ€çš„åˆ†é…ç»™3ç§å°ºåº¦çš„ç‰¹å¾å›¾ã€‚</p>
<h2 id="è¡¥å……ï¼šYOLOv3-Tiny"><a href="#è¡¥å……ï¼šYOLOv3-Tiny" class="headerlink" title="è¡¥å……ï¼šYOLOv3-Tiny"></a>è¡¥å……ï¼šYOLOv3-Tiny</h2><p>æˆ–è®¸å¯¹äºé€Ÿåº¦è¦æ±‚æ¯”è¾ƒé«˜çš„é¡¹ç›®ï¼ŒYOLOV3-tinyæ‰æ˜¯æˆ‘ä»¬çš„é¦–è¦é€‰æ‹©ï¼Œè¿™ä¸ªç½‘ç»œçš„åŸç†ä¸ç”¨å¤šè¯´äº†ï¼Œå°±æ˜¯åœ¨YOLOv3çš„åŸºç¡€ä¸Šå»æ‰äº†ä¸€äº›ç‰¹å¾å±‚ï¼Œåªä¿ç•™äº†2ä¸ªç‹¬ç«‹é¢„æµ‹åˆ†æ”¯ï¼Œå…·ä½“çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv3/642.jpg" alt></p>
<p>è¿™ä¸ªæ˜¯å·¥ç¨‹ä¸‹æ›´åŠ å¸¸ç”¨çš„ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv2</title>
    <url>/2020/02/28/YOLOv2/</url>
    <content><![CDATA[<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>YOLOv1ä½œä¸ºOne-Stageç›®æ ‡æ£€æµ‹ç®—æ³•çš„å¼€å±±ä¹‹ä½œï¼Œé€Ÿåº¦å¿«æ˜¯å®ƒæœ€å¤§çš„ä¼˜åŠ¿ã€‚ä½†æˆ‘ä»¬çŸ¥é“ï¼ŒYOLOv1çš„å®šä½ä¸å¤Ÿå‡†ï¼Œå¹¶ä¸”å¬å›ç‡ä½ã€‚ä¸ºäº†æå‡å®šä½å‡†ç¡®åº¦ï¼Œæé«˜å¬å›ç‡ï¼ŒYOLOv2åœ¨YOLOv1çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ã€‚å…·ä½“çš„æ”¹è¿›æ–¹æ³•å¦‚å›¾Fig1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/640.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°YOLOv2é€šè¿‡å¢åŠ ä¸€äº›Trickä½¿å¾—v1çš„mapå€¼ä»63.4æé«˜åˆ°äº†78.6ï¼Œè¯´æ˜äº†YOLOv2æ”¹è¿›æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ†æä¸€ä¸‹è¿™äº›æ”¹è¿›æ–¹æ³•ã€‚</p>
<h2 id="æ‰¹é‡å½’ä¸€åŒ–"><a href="#æ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–"></a>æ‰¹é‡å½’ä¸€åŒ–</h2><p>è¿™ä¸ªåº”è¯¥ä¸ç”¨å¤šè¯´äº†ï¼ŒYOLOv2åœ¨æ¯ä¸ªå·ç§¯å±‚åé¢å¢åŠ äº†BNå±‚ï¼Œå»æ‰å…¨è¿æ¥çš„dropoutã€‚ä½¿ç”¨BNç­–ç•¥å°†mapå€¼æé«˜äº†2%ã€‚</p>
<h2 id="é«˜åˆ†è¾¨ç‡"><a href="#é«˜åˆ†è¾¨ç‡" class="headerlink" title="é«˜åˆ†è¾¨ç‡"></a>é«˜åˆ†è¾¨ç‡</h2><p>å½“å‰å¤§å¤šæ•°ç›®æ ‡æ£€æµ‹ç½‘ç»œéƒ½å–œæ¬¢ä½¿ç”¨ä¸»æµåˆ†ç±»ç½‘ç»œå¦‚VGG,ResNetæ¥åšBackboneï¼Œè€Œè¿™äº›ç½‘ç»œå¤§å¤šæ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ï¼Œè€Œåˆ†è¾¨ç‡çš„å¤§å°å¿…ç„¶ä¼šå½±å“åˆ°æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°ã€‚æ‰€ä»¥ï¼ŒYOLOv2å°†è¾“å…¥çš„åˆ†è¾¨ç‡æå‡åˆ°$448 \times 448$ï¼ŒåŒæ—¶ï¼Œä¸ºäº†ä½¿ç½‘ç»œé€‚åº”é«˜åˆ†è¾¨ç‡ï¼ŒYOLOv2å…ˆåœ¨ImageNetä¸Šä»¥$448 \times 448$çš„åˆ†è¾¨ç‡å¯¹ç½‘ç»œè¿›è¡Œ10ä¸ªepochçš„å¾®è°ƒï¼Œè®©ç½‘ç»œé€‚åº”é«˜åˆ†è¾¨ç‡çš„è¾“å…¥ã€‚é€šè¿‡ä½¿ç”¨é«˜åˆ†è¾¨ç‡çš„è¾“å…¥ï¼ŒYOLOv2å°†mapå€¼æé«˜äº†çº¦4%ã€‚</p>
<h2 id="åŸºäºå·ç§¯çš„Anchoræœºåˆ¶"><a href="#åŸºäºå·ç§¯çš„Anchoræœºåˆ¶" class="headerlink" title="åŸºäºå·ç§¯çš„Anchoræœºåˆ¶"></a>åŸºäºå·ç§¯çš„Anchoræœºåˆ¶</h2><p>YOLOv1åˆ©ç”¨å…¨è¿æ¥å±‚ç›´æ¥å¯¹è¾¹ç•Œæ¡†è¿›è¡Œé¢„æµ‹ï¼Œå¯¼è‡´ä¸¢å¤±è¾ƒå¤šç©ºé—´ä¿¡æ¯ï¼Œå®šä½ä¸å‡†ã€‚YOLOv2å»æ‰äº†YOLOv1ä¸­çš„å…¨è¿æ¥å±‚ï¼Œä½¿ç”¨Anchor  Boxesé¢„æµ‹è¾¹ç•Œæ¡†ï¼ŒåŒæ—¶ä¸ºäº†å¾—åˆ°æ›´é«˜åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ï¼ŒYOLOv2è¿˜å»æ‰äº†ä¸€ä¸ªæ± åŒ–å±‚ã€‚ç”±äºå›¾ç‰‡ä¸­çš„ç‰©ä½“éƒ½å€¾å‘äºå‡ºç°åœ¨å›¾ç‰‡çš„ä¸­å¿ƒä½ç½®ï¼Œè‹¥ç‰¹å¾å›¾æ°å¥½æœ‰ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼Œåˆ©ç”¨è¿™ä¸ªä¸­å¿ƒä½ç½®é¢„æµ‹ä¸­å¿ƒç‚¹è½å…¥è¯¥ä½ç½®çš„ç‰©ä½“ï¼Œå¯¹è¿™äº›ç‰©ä½“çš„æ£€æµ‹ä¼šæ›´å®¹æ˜“ã€‚æ‰€ä»¥æ€»å¸Œæœ›å¾—åˆ°çš„ç‰¹å¾å›¾çš„å®½é«˜éƒ½ä¸ºå¥‡æ•°ã€‚YOLOv2é€šè¿‡ç¼©å‡ç½‘ç»œï¼Œä½¿ç”¨416x416çš„è¾“å…¥ï¼Œæ¨¡å‹ä¸‹é‡‡æ ·çš„æ€»æ­¥é•¿ä¸º32ï¼Œæœ€åå¾—åˆ°13x13çš„ç‰¹å¾å›¾ï¼Œç„¶åå¯¹13x13çš„ç‰¹å¾å›¾çš„æ¯ä¸ªcellé¢„æµ‹5ä¸ªanchor boxesï¼Œå¯¹æ¯ä¸ªanchor boxé¢„æµ‹è¾¹ç•Œæ¡†çš„ä½ç½®ä¿¡æ¯ã€ç½®ä¿¡åº¦å’Œä¸€å¥—åˆ†ç±»æ¦‚ç‡å€¼ã€‚ä½¿ç”¨anchor boxesä¹‹åï¼ŒYOLOv2å¯ä»¥é¢„æµ‹13x13x5=845ä¸ªè¾¹ç•Œæ¡†ï¼Œæ¨¡å‹çš„å¬å›ç‡ç”±åŸæ¥çš„81%æå‡åˆ°88%ï¼ŒmAPç”±åŸæ¥çš„69.5%é™ä½åˆ°69.2%.å¬å›ç‡æå‡äº†7%ï¼Œå‡†ç¡®ç‡ä¸‹é™äº†0.3%ã€‚è¿™é‡Œæˆ‘ä»¬å’ŒSSDä»¥åŠFaster-RCNNåšä¸ªå¯¹æ¯”ï¼ŒFaster  RCNNè¾“å…¥å¤§å°ä¸º1000*600æ—¶çš„boxesæ•°é‡å¤§æ¦‚æ˜¯6000ï¼Œåœ¨SSD300ä¸­boxesæ•°é‡æ˜¯8732ã€‚æ˜¾ç„¶å¢åŠ boxæ•°é‡æ˜¯ä¸ºäº†æé«˜objectçš„å®šä½å‡†ç¡®ç‡ã€‚</p>
<h2 id="ç»´åº¦èšç±»"><a href="#ç»´åº¦èšç±»" class="headerlink" title="ç»´åº¦èšç±»"></a>ç»´åº¦èšç±»</h2><p>åœ¨Faster-RCNNä¸­ï¼ŒAnchoréƒ½æ˜¯æ‰‹åŠ¨è®¾å®šçš„ï¼ŒYOLOv2ä½¿ç”¨k-meansèšç±»ç®—æ³•å¯¹è®­ç»ƒé›†ä¸­çš„è¾¹ç•Œæ¡†åšäº†èšç±»åˆ†æï¼Œå°è¯•æ‰¾åˆ°åˆé€‚å°ºå¯¸çš„Anchorã€‚å¦å¤–ä½œè€…å‘ç°å¦‚æœé‡‡ç”¨æ ‡å‡†çš„k-meansèšç±»ï¼Œåœ¨boxçš„å°ºå¯¸æ¯”è¾ƒå¤§çš„æ—¶å€™å…¶è¯¯å·®ä¹Ÿæ›´å¤§ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯è¯¯å·®å’Œboxçš„å°ºå¯¸æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚æ‰€ä»¥é€šè¿‡IOUå®šä¹‰äº†å¦‚ä¸‹çš„è·ç¦»å‡½æ•°ï¼Œä½¿å¾—è¯¯å·®å’Œboxçš„å¤§å°æ— å…³ï¼š</p>
<script type="math/tex; mode=display">
d(\text {box }, \text { centroid })=1-I O U(\text { box }, \text { centroid })</script><p>Fig2å±•ç¤ºäº†èšç±»çš„ç°‡çš„ä¸ªæ•°å’ŒIOUä¹‹é—´çš„å…³ç³»ï¼Œä¸¤æ¡æ›²çº¿åˆ†åˆ«ä»£è¡¨äº†VOCå’ŒCOCOæ•°æ®é›†çš„æµ‹è¯•ç»“æœã€‚æœ€åç»“åˆä¸åŒçš„Kå€¼å¯¹å¬å›ç‡çš„å½±å“ï¼Œè®ºæ–‡é€‰æ‹©äº†K=5ï¼ŒFigure2ä¸­å³è¾¹çš„ç¤ºæ„å›¾æ˜¯é€‰å‡ºæ¥çš„5ä¸ªboxçš„å¤§å°ï¼Œè¿™é‡Œç´«è‰²å’Œé»‘è‰²ä¹Ÿæ˜¯åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªä¸åŒçš„æ•°æ®é›†ï¼Œå¯ä»¥çœ‹å‡ºå…¶åŸºæœ¬å½¢çŠ¶æ˜¯ç±»ä¼¼çš„ã€‚è€Œä¸”å‘ç°èšç±»çš„ç»“æœå’Œæ‰‹åŠ¨è®¾ç½®çš„anchor boxå¤§å°å·®åˆ«æ˜¾è‘—ã€‚èšç±»çš„ç»“æœä¸­å¤šæ˜¯é«˜ç˜¦çš„boxï¼Œè€ŒçŸ®èƒ–çš„boxæ•°é‡è¾ƒå°‘ï¼Œè¿™ä¹Ÿæ¯”è¾ƒç¬¦åˆæ•°æ®é›†ä¸­ç›®æ ‡çš„è§†è§‰æ•ˆæœã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/641.png" alt></p>
<p>åœ¨ç»“æœæµ‹è¯•æ—¶ï¼ŒYOLOv2é‡‡ç”¨çš„5ç§Anchorå¯ä»¥è¾¾åˆ°çš„Avg  IOUæ˜¯61ï¼Œè€ŒFaster-RCNNé‡‡ç”¨9ç§Anchorè¾¾åˆ°çš„å¹³å‡IOUæ˜¯60.9ï¼Œä¹Ÿå³æ˜¯è¯´æœ¬æ–‡ä»…ä»…é€‰å–5ç§Anchorå°±å¯ä»¥è¾¾åˆ°Faster-RCNNä¸­9ç§Anchorçš„æ•ˆæœã€‚å¦‚Table1æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/642.png" alt></p>
<h2 id="æ–°Backbone-Darknet-19"><a href="#æ–°Backbone-Darknet-19" class="headerlink" title="æ–°Backbone:Darknet-19"></a>æ–°Backbone:Darknet-19</h2><p>YOLOv2é‡‡ç”¨Darknet-19ï¼Œå…¶ç½‘ç»œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬19ä¸ªå·ç§¯å±‚å’Œ5ä¸ªmax poolingå±‚ï¼Œä¸»è¦é‡‡ç”¨$3 \times 3$å·ç§¯å’Œ$1 \times 1$å·ç§¯ï¼Œè¿™é‡Œ$1 \times 1$å·ç§¯å¯ä»¥å‹ç¼©ç‰¹å¾å›¾é€šé“æ•°ä»¥é™ä½æ¨¡å‹è®¡ç®—é‡å’Œå‚æ•°ï¼Œæ¯ä¸ªå·ç§¯å±‚åä½¿ç”¨BNå±‚ä»¥åŠ å¿«æ¨¡å‹æ”¶æ•›åŒæ—¶é˜²æ­¢è¿‡æ‹Ÿåˆã€‚æœ€ç»ˆé‡‡ç”¨global avg pool åšé¢„æµ‹ã€‚é‡‡ç”¨YOLOv2ï¼Œæ¨¡å‹çš„mAPå€¼æ²¡æœ‰æ˜¾è‘—æå‡ï¼Œä½†è®¡ç®—é‡å‡å°‘äº†ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/643.webp" alt></p>
<h2 id="ç›´æ¥ä½ç½®é¢„æµ‹"><a href="#ç›´æ¥ä½ç½®é¢„æµ‹" class="headerlink" title="ç›´æ¥ä½ç½®é¢„æµ‹"></a>ç›´æ¥ä½ç½®é¢„æµ‹</h2><p>YOLOv2åœ¨å¼•å…¥Anchorçš„æ—¶å€™ç¢°åˆ°ç¬¬2ä¸ªé—®é¢˜ï¼šæ¨¡å‹ä¸ç¨³å®šï¼Œå°¤å…¶æ˜¯è®­ç»ƒåˆšå¼€å§‹é˜¶æ®µã€‚è®ºæ–‡ä»»åŠ¡è¿™ç§ä¸ç¨³å®šä¸»è¦æ¥è‡ªboxçš„(x,y)é¢„æµ‹å€¼ã€‚æˆ‘ä»¬çŸ¥é“åœ¨Faster-RCNNä¸­ï¼Œæ˜¯é€šè¿‡é¢„æµ‹ä¸‹å›¾ä¸­çš„$t_x$å’Œ$t_y$æ¥å¾—åˆ°(x,y)å€¼ï¼Œä¹Ÿå°±æ˜¯é¢„æµ‹çš„æ˜¯offsetã€‚å¦å¤–å…³äºæ–‡ä¸­çš„è¿™ä¸ªå…¬å¼ï¼Œè¿™ä¸ªåœ°æ–¹åº”è¯¥æŠŠåé¢çš„å‡å·æ”¹æˆåŠ å·ï¼Œè¿™æ ·æ‰èƒ½ç¬¦åˆå…¬å¼ä¸‹é¢çš„exampleã€‚è¿™é‡Œ$\boldsymbol{x}_{\boldsymbol{a}}$å’Œ$\boldsymbol{y}_{\boldsymbol{a}}$æ˜¯anchorçš„åæ ‡ï¼Œ$\boldsymbol{w}_{\boldsymbol{a}}$å’Œ$\boldsymbol{h}_{\boldsymbol{a}}$æ˜¯anchorçš„sizeï¼Œ$\boldsymbol{x}$å’Œ$\boldsymbol{y}$æ˜¯åæ ‡çš„é¢„æµ‹å€¼ï¼Œ$\boldsymbol{t}_{\boldsymbol{x}}$å’Œ$\boldsymbol{t}_{\boldsymbol{y}}$æ˜¯åç§»é‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/644.png" alt></p>
<p>ä¾‹å­ç¿»è¯‘è¿‡æ¥æ˜¯ï¼šå½“é¢„æµ‹æ—¶$t_{x}=1$ï¼Œå°±ä¼šæŠŠboxå‘å³è¾¹ç§»åŠ¨ä¸€å®šè·ç¦»ï¼ˆå…·ä½“ä¸ºanchor boxçš„å®½åº¦ï¼‰ï¼Œé¢„æµ‹æ—¶$t_{x}=-1$ï¼Œå°±ä¼šæŠŠboxå‘å·¦è¾¹ç§»åŠ¨ç›¸åŒçš„è·ç¦»ã€‚è¿™ä¸ªå…¬å¼æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä½¿å¾—æ— è®ºåœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œé¢„æµ‹ï¼Œä»»ä½•anchor boxeså¯ä»¥åœ¨å›¾åƒä¸­ä»»æ„ä¸€ç‚¹ç»“æŸï¼Œæ¨¡å‹éšæœºåˆå§‹åŒ–åï¼Œéœ€è¦èŠ±å¾ˆé•¿ä¸€æ®µæ—¶é—´æ‰èƒ½ç¨³å®šé¢„æµ‹æ•æ„Ÿçš„ç‰©ä½“ä½ç½®ã€‚.</p>
<p>æ³¨æ„ï¼Œé«˜èƒ½æ¥äº†ï¼ï¼ï¼åˆ†æäº†åŸå› ä¹‹åï¼ŒYOLOv2æ²¡æœ‰é‡‡ç”¨ç›´æ¥é¢„æµ‹offsetçš„æ–¹æ³•ï¼Œè¿˜æ˜¯æ²¿ç”¨äº†YOLOç®—æ³•ä¸­ç›´æ¥é¢„æµ‹ç›¸å¯¹äºgrid  cellçš„åæ ‡ä½ç½®çš„æ–¹å¼ã€‚å‰é¢æåˆ°ç½‘ç»œåœ¨æœ€åä¸€ä¸ªå·ç§¯å±‚è¾“å‡º13*13å¤§å°çš„ç‰¹å¾å›¾ï¼Œç„¶åæ¯ä¸ªcellé¢„æµ‹5ä¸ªbounding  boxï¼Œç„¶åæ¯ä¸ªbounding boxé¢„æµ‹5ä¸ªå€¼ï¼š$t_{x}, t_{y}, t_{w}, t_{h}$å’Œ$t_o$ï¼ˆè¿™é‡Œçš„$t_{o}$ç±»ä¼¼YOLOv1ä¸­çš„confidenceï¼‰ã€‚$t_x$å’Œ$t_{y}$ç»è¿‡sigmoidå‡½æ•°å¤„ç†åèŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œè¿™æ ·çš„å½’ä¸€åŒ–å¤„ç†ä½¿å¾—æ¨¡å‹è®­ç»ƒæ›´åŠ ç¨³å®šã€‚$c_x$å’Œ$c_{y}$è¡¨ç¤ºä¸€ä¸ªcellå’Œå›¾åƒå·¦ä¸Šè§’çš„æ¨ªçºµè·ç¦»ã€‚$p_w$å’Œ$p_h$è¡¨ç¤ºbounding boxçš„å®½é«˜ï¼Œè¿™æ ·$b_x$å’Œ$b_y$å°±æ˜¯$c_x$å’Œ$c_y$è¿™ä¸ªcellé™„è¿‘çš„anchoræ¥é¢„æµ‹$t_x$å’Œ$t<br>_y$å¾—åˆ°çš„ç»“æœã€‚å¦‚Fig3æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/645.webp" alt></p>
<p>å…¶ä¸­ï¼Œ$c_x$å’Œ$c_{y}$è¡¨ç¤ºgrid cellä¸å›¾åƒå·¦ä¸Šè§’çš„æ¨ªçºµåæ ‡è·ç¦»ï¼Œé»‘è‰²è™šçº¿æ¡†æ˜¯bounding boxï¼Œè“è‰²çŸ©å½¢æ¡†å°±æ˜¯æœ€ç»ˆé¢„æµ‹çš„ç»“æœã€‚æ³¨æ„ï¼Œä¸Šå›¾å³è¾¹é‡Œé¢çš„$\delta\left(t_{x}\right)$å¯ä»¥ç†è§£ä¸º$s t_{x}$ï¼Œ$\delta\left(t_{y}\right)$å¯ä»¥ç†è§£ä¸º$s t_{y}$ã€‚æ¯ä¸€ä¸ªè¾“å‡ºçš„bounding boxæ˜¯é’ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„anchorï¼Œanchorå…¶å®æ˜¯bounding boxçš„widthåŠheightçš„ä¸€ä¸ªå‚è€ƒã€‚$p_{w}$å’Œ$p_{h}$æ˜¯æŸä¸ªanchor boxçš„å®½å’Œé«˜ï¼Œä¸€ä¸ªæ ¼å­çš„$c_{x}$å’Œ$c_{y}$å•ä½éƒ½æ˜¯1ï¼Œ$\delta\left(t_{x}\right)$ï¼Œ$\delta\left(t_{y}\right)$æ˜¯ç›¸å¯¹äºæŸä¸ªæ ¼å­å·¦ä¸Šè§’çš„åç§»é‡ã€‚</p>
<h2 id="ç»†ç²’åº¦ç‰¹å¾"><a href="#ç»†ç²’åº¦ç‰¹å¾" class="headerlink" title="ç»†ç²’åº¦ç‰¹å¾"></a>ç»†ç²’åº¦ç‰¹å¾</h2><p>YOLOv2æå–Darknet-19æœ€åä¸€ä¸ªmax poolå±‚çš„è¾“å…¥ï¼Œå¾—åˆ°26x26x512çš„ç‰¹å¾å›¾ã€‚ç»è¿‡1x1x64çš„å·ç§¯ä»¥é™ä½ç‰¹å¾å›¾çš„ç»´åº¦ï¼Œå¾—åˆ°26x26x64çš„ç‰¹å¾å›¾ï¼Œç„¶åç»è¿‡pass  throughå±‚çš„å¤„ç†å˜æˆ13x13x256çš„ç‰¹å¾å›¾ï¼ˆæŠ½å–åŸç‰¹å¾å›¾æ¯ä¸ª2x2çš„å±€éƒ¨åŒºåŸŸç»„æˆæ–°çš„channelï¼Œå³åŸç‰¹å¾å›¾å¤§å°é™ä½4å€ï¼Œchannelå¢åŠ 4å€ï¼‰ï¼Œå†ä¸13x13x1024å¤§å°çš„ç‰¹å¾å›¾è¿æ¥ï¼Œå˜æˆ13x13x1280çš„ç‰¹å¾å›¾ï¼Œæœ€ååœ¨è¿™äº›ç‰¹å¾å›¾ä¸Šåšé¢„æµ‹ã€‚ä½¿ç”¨Fine-Grained Featuresï¼ŒYOLOv2çš„æ€§èƒ½æå‡äº†1%ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨ä¸‹é¢çš„YOLOv2çš„ç»“æ„å›¾ä¸­çœ‹å¾—å¾ˆæ¸…æ¥šï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/646.webp" alt></p>
<h2 id="å¤šå°ºåº¦è®­ç»ƒ"><a href="#å¤šå°ºåº¦è®­ç»ƒ" class="headerlink" title="å¤šå°ºåº¦è®­ç»ƒ"></a><strong>å¤šå°ºåº¦è®­ç»ƒ</strong></h2><p>YOLOv2ä¸­ä½¿ç”¨çš„Darknet-19ç½‘ç»œç»“æ„ä¸­åªæœ‰å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œæ‰€ä»¥å…¶å¯¹è¾“å…¥å›¾ç‰‡çš„å¤§å°æ²¡æœ‰é™åˆ¶ã€‚YOLOv2é‡‡ç”¨å¤šå°ºåº¦è¾“å…¥çš„æ–¹å¼è®­ç»ƒï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¯éš”10ä¸ªbatches,é‡æ–°éšæœºé€‰æ‹©è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸ï¼Œç”±äºDarknet-19ä¸‹é‡‡æ ·æ€»æ­¥é•¿ä¸º32ï¼Œè¾“å…¥å›¾ç‰‡çš„å°ºå¯¸ä¸€èˆ¬é€‰æ‹©32çš„å€æ•°{320,352,â€¦,608}ã€‚é‡‡ç”¨Multi-Scale Training,  å¯ä»¥é€‚åº”ä¸åŒå¤§å°çš„å›¾ç‰‡è¾“å…¥ï¼Œå½“é‡‡ç”¨ä½åˆ†è¾¨ç‡çš„å›¾ç‰‡è¾“å…¥æ—¶ï¼ŒmAPå€¼ç•¥æœ‰ä¸‹é™ï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼Œå½“é‡‡ç”¨é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡è¾“å…¥æ—¶ï¼Œèƒ½å¾—åˆ°è¾ƒé«˜mAPå€¼ï¼Œä½†é€Ÿåº¦æœ‰æ‰€ä¸‹é™ã€‚</p>
<p>è¿™ç§æœºåˆ¶ä½¿å¾—ç½‘ç»œå¯ä»¥æ›´å¥½åœ°é¢„æµ‹ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œæ„å‘³ç€åŒä¸€ä¸ªç½‘ç»œå¯ä»¥è¿›è¡Œä¸åŒåˆ†è¾¨ç‡çš„æ£€æµ‹ä»»åŠ¡ï¼Œåœ¨å°å°ºå¯¸å›¾ç‰‡ä¸ŠYOLOv2è¿è¡Œæ›´å¿«ï¼Œåœ¨é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¾¾åˆ°äº†å¹³è¡¡ã€‚åœ¨å°å°ºå¯¸å›¾ç‰‡æ£€æµ‹ä¸­ï¼ŒYOLOv2æˆç»©å¾ˆå¥½ï¼Œè¾“å…¥ä¸º228 x 228çš„æ—¶å€™ï¼Œå¸§ç‡è¾¾åˆ°90FPSï¼ŒmAPå‡ ä¹å’ŒFaster  R-CNNçš„æ°´å‡†ç›¸åŒã€‚ä½¿å¾—å…¶åœ¨ä½æ€§èƒ½GPUã€é«˜å¸§ç‡è§†é¢‘ã€å¤šè·¯è§†é¢‘åœºæ™¯ä¸­æ›´åŠ é€‚ç”¨ã€‚åœ¨å¤§å°ºå¯¸å›¾ç‰‡æ£€æµ‹ä¸­ï¼ŒYOLOv2è¾¾åˆ°äº†SOATç»“æœï¼ŒVOC2007 ä¸ŠmAPä¸º78.6%ï¼Œä»ç„¶é«˜äºå¹³å‡æ°´å‡†ï¼Œä¸‹å›¾æ˜¯YOLOv2å’Œå…¶ä»–ç½‘ç»œçš„ç²¾åº¦å¯¹æ¯”ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/647.jfif" alt></p>
<p>é€Ÿåº¦å¯¹æ¯”ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv2/648.webp" alt></p>
<h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>YOLOv2çš„è®­ç»ƒä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µï¼šä½œè€…ä½¿ç”¨Darknet-19åœ¨æ ‡å‡†1000ç±»çš„ImageNetä¸Šè®­ç»ƒäº†160æ¬¡ï¼Œç”¨çš„éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œstarting learning rate ä¸º0.1ï¼Œpolynomial rate decay ä¸º4ï¼Œweight decayä¸º0.0005  ï¼Œmomentum ä¸º0.9ã€‚è®­ç»ƒçš„æ—¶å€™ä»ç„¶ä½¿ç”¨äº†å¾ˆå¤šå¸¸è§çš„æ•°æ®æ‰©å……æ–¹æ³•ï¼ˆdata augmentationï¼‰ï¼ŒåŒ…æ‹¬random crops,  rotations, and hue, saturation, and exposure  shiftsã€‚ï¼ˆè¿™äº›è®­ç»ƒå‚æ•°æ˜¯åŸºäºdarknetæ¡†æ¶ï¼Œå’Œcaffeä¸å°½ç›¸åŒï¼‰åˆå§‹çš„224 <em> 224è®­ç»ƒåï¼Œä½œè€…æŠŠåˆ†è¾¨ç‡ä¸Šè°ƒåˆ°äº†448 </em>  448ï¼Œç„¶ååˆè®­ç»ƒäº†10æ¬¡ï¼Œå­¦ä¹ ç‡è°ƒæ•´åˆ°äº†0.001ã€‚é«˜åˆ†è¾¨ç‡ä¸‹è®­ç»ƒçš„åˆ†ç±»ç½‘ç»œåœ¨top-1å‡†ç¡®ç‡76.5%ï¼Œtop-5å‡†ç¡®ç‡93.3%ã€‚</p>
<p>ç¬¬äºŒä¸ªé˜¶æ®µï¼šåˆ†ç±»ç½‘ç»œè®­ç»ƒå®Œåï¼Œå°±è¯¥è®­ç»ƒæ£€æµ‹ç½‘ç»œäº†ï¼Œä½œè€…å»æ‰äº†åŸç½‘ç»œæœ€åä¸€ä¸ªå·ç§¯å±‚ï¼Œè½¬è€Œå¢åŠ äº†ä¸‰ä¸ª3 <em> 3 </em> 1024çš„å·ç§¯å±‚ï¼ˆå¯å‚è€ƒdarknetä¸­cfgæ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€ä¸ªä¸Šè¿°å·ç§¯å±‚åé¢è·Ÿä¸€ä¸ª1 <em>  1çš„å·ç§¯å±‚ï¼Œè¾“å‡ºç»´åº¦æ˜¯æ£€æµ‹æ‰€éœ€çš„æ•°é‡ã€‚å¯¹äºVOCæ•°æ®é›†ï¼Œé¢„æµ‹5ç§boxeså¤§å°ï¼Œæ¯ä¸ªboxåŒ…å«5ä¸ªåæ ‡å€¼å’Œ20ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥æ€»å…±æ˜¯5 </em>  ï¼ˆ5+20ï¼‰= 125ä¸ªè¾“å‡ºç»´åº¦ã€‚åŒæ—¶ä¹Ÿæ·»åŠ äº†è½¬ç§»å±‚ï¼ˆpassthrough layer ï¼‰ï¼Œä»æœ€åé‚£ä¸ª3 <em> 3 </em>  512çš„å·ç§¯å±‚è¿åˆ°å€’æ•°ç¬¬äºŒå±‚ï¼Œä½¿æ¨¡å‹æœ‰äº†ç»†ç²’åº¦ç‰¹å¾ã€‚ä½œè€…çš„æ£€æµ‹æ¨¡å‹ä»¥0.001çš„åˆå§‹å­¦ä¹ ç‡è®­ç»ƒäº†160æ¬¡ï¼Œåœ¨60æ¬¡å’Œ90æ¬¡çš„æ—¶å€™ï¼Œå­¦ä¹ ç‡å‡ä¸ºåŸæ¥çš„ååˆ†ä¹‹ä¸€ã€‚å…¶ä»–çš„æ–¹é¢ï¼Œweight decayä¸º0.0005ï¼Œmomentumä¸º0.9ï¼Œä¾ç„¶ä½¿ç”¨äº†ç±»ä¼¼äºFaster-RCNNå’ŒSSDçš„æ•°æ®æ‰©å……ï¼ˆdata  augmentationï¼‰ç­–ç•¥ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>YOLOv2å€Ÿé‰´äº†å¾ˆå¤šå…¶å®ƒç›®æ ‡æ£€æµ‹æ–¹æ³•çš„ä¸€äº›æŠ€å·§ï¼Œå¦‚Faster R-CNNçš„anchor boxes,  SSDä¸­çš„å¤šå°ºåº¦æ£€æµ‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒYOLOv2åœ¨ç½‘ç»œè®¾è®¡ä¸Šåšäº†å¾ˆå¤štricks,ä½¿å®ƒèƒ½åœ¨ä¿è¯é€Ÿåº¦çš„åŒæ—¶æé«˜æ£€æµ‹å‡†ç¡®ç‡ï¼ŒMulti-Scale  Trainingæ›´ä½¿å¾—åŒä¸€ä¸ªæ¨¡å‹é€‚åº”ä¸åŒå¤§å°çš„è¾“å…¥ï¼Œä»è€Œå¯ä»¥åœ¨é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¿›è¡Œè‡ªç”±æƒè¡¡ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv1</title>
    <url>/2020/02/27/YOLOv1/</url>
    <content><![CDATA[<h2 id="åˆ›æ–°ç‚¹"><a href="#åˆ›æ–°ç‚¹" class="headerlink" title="åˆ›æ–°ç‚¹"></a>åˆ›æ–°ç‚¹</h2><ul>
<li>å°†æ•´å¼ å›¾ä½œä¸ºç½‘ç»œçš„è¾“å…¥ï¼Œç›´æ¥åœ¨è¾“å‡ºå±‚å›å½’bounding boxçš„ä½ç½®å’Œæ‰€å±ç±»åˆ«ã€‚</li>
<li>é€Ÿåº¦å¿«ï¼ŒOne-Stageæ£€æµ‹ç®—æ³•å¼€å±±ä¹‹ä½œã€‚</li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å›é¡¾YOLOä¹‹å‰çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œéƒ½æ˜¯åŸºäºäº§ç”Ÿå¤§é‡å¯èƒ½åŒ…å«ç‰©ä½“çš„å…ˆéªŒæ¡†ï¼Œç„¶åç”¨åˆ†ç±»å™¨åˆ¤æ–­æ¯ä¸ªå…ˆéªŒæ¡†å¯¹åº”çš„è¾¹ç•Œæ¡†é‡Œæ˜¯å¦åŒ…å«å¾…æ£€æµ‹ç‰©ä½“ï¼Œä»¥åŠç‰©ä½“æ‰€å±ç±»åˆ«çš„æ¦‚ç‡æˆ–è€…ç½®ä¿¡åº¦ï¼ŒåŒæ—¶éœ€è¦åå¤„ç†ä¿®æ­£è¾¹ç•Œæ¡†ï¼Œæœ€ååŸºäºä¸€äº›å‡†åˆ™è¿‡æ»¤æ‰ç½®ä¿¡åº¦ä¸é«˜å’Œé‡å åº¦è¾ƒé«˜çš„è¾¹ç•Œæ¡†ï¼Œè¿›è€Œå¾—åˆ°æ£€æµ‹ç»“æœã€‚è¿™ç§åŸºäºå…ˆäº§ç”Ÿå€™é€‰åŒºåŸŸå†è¿›è¡Œæ£€æµ‹çš„æ–¹æ³•è™½ç„¶æœ‰è¾ƒé«˜çš„ç²¾åº¦ï¼Œä½†é€Ÿåº¦éå¸¸æ…¢ã€‚YOLOç›´æ¥å°†ç›®æ ‡æ£€æµ‹å ªç§°ä¸€ä¸ªå›å½’é—®é¢˜è¿›è¡Œå¤„ç†ï¼Œå°†å€™é€‰åŒºå’Œæ£€æµ‹ä¸¤ä¸ªé˜¶æ®µåˆäºŒä¸ºä¸€ã€‚YOLOçš„æ£€æµ‹è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/640.webp" alt><br>äº‹å®ä¸Šï¼ŒYOLOå¹¶æ²¡æœ‰çœŸæ­£çš„å»æ‰å€™é€‰åŒºï¼Œè€Œæ˜¯ç›´æ¥å°†è¾“å…¥å›¾ç‰‡åˆ’åˆ†æˆ7 x 7=49ä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹ä¸¤ä¸ªè¾¹ç•Œæ¡†ï¼Œä¸€å…±é¢„æµ‹49 x 2=98ä¸ªè¾¹ç•Œæ¡†ã€‚å¯ä»¥è¿‘ä¼¼ç†è§£ä¸ºåœ¨è¾“å…¥å›¾ç‰‡ä¸Šç²—ç•¥çš„é€‰å–98ä¸ªå€™é€‰åŒºï¼Œè¿™98ä¸ªå€™é€‰åŒºè¦†ç›–äº†å›¾ç‰‡çš„æ•´ä¸ªåŒºåŸŸï¼Œè¿›è€Œç”¨å›å½’é¢„æµ‹è¿™98ä¸ªå€™é€‰æ¡†å¯¹åº”çš„è¾¹ç•Œæ¡†ã€‚</p>
<h2 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h2><p>YOLOå°†è¾“å…¥å›¾åƒåˆ’åˆ†ä¸ºS x Sçš„æ …æ ¼ï¼Œæ¯ä¸ªæ …æ ¼è´Ÿè´£æ£€æµ‹ä¸­å¿ƒè½åœ¨è¯¥æ …æ ¼ä¸­çš„ç‰©ä½“ã€‚æ¯ä¸€ä¸ªæ …æ ¼é¢„æµ‹Bä¸ªbounding boxesï¼Œä»¥åŠè¿™äº›bounding boxesçš„confidence scoresã€‚è¿™ä¸ªconfidence  scoresåæ˜ äº†æ¨¡å‹å¯¹äºè¿™ä¸ªæ …æ ¼çš„é¢„æµ‹ï¼šè¯¥æ …æ ¼æ˜¯å¦å«æœ‰ç‰©ä½“ï¼Œä»¥åŠè¿™ä¸ªboxçš„åæ ‡é¢„æµ‹çš„æœ‰å¤šå‡†ã€‚å…¬å¼å®šä¹‰å¦‚ä¸‹ï¼š </p>
<script type="math/tex; mode=display">
confidence =\operatorname{Pr}(\text { Object }) * I O U_{\text {pred}}^{\text {truth}}</script><p>å¦‚æœè¿™ä¸ªæ …æ ¼ä¸­ä¸å­˜åœ¨ä¸€ä¸ªobjectï¼Œåˆ™confidence scoreåº”è¯¥ä¸º0ã€‚ç›¸åï¼Œconfidence scoreåˆ™ä¸ºé¢„æµ‹æ¡†ä¸çœŸå®æ¡†æ¡†ä¹‹é—´çš„äº¤å¹¶æ¯”ã€‚YOLOå¯¹æ¯ä¸ªbounding  boxæœ‰5ä¸ªpredictionsï¼šxï¼Œyï¼Œwï¼Œhå’Œ confidenceã€‚åæ ‡xï¼Œyä»£è¡¨äº†é¢„æµ‹çš„bounding  boxçš„ä¸­å¿ƒä¸æ …æ ¼è¾¹ç•Œçš„ç›¸å¯¹å€¼ã€‚åæ ‡wï¼Œhä»£è¡¨äº†é¢„æµ‹çš„bounding  boxçš„widthã€heightç›¸å¯¹äºæ•´å¹…å›¾åƒwidth,heightçš„æ¯”ä¾‹ã€‚confidenceå°±æ˜¯é¢„æµ‹çš„bounding  boxå’Œground truth boxçš„IOUå€¼ã€‚æ¯ä¸€ä¸ªæ …æ ¼è¿˜è¦é¢„æµ‹Cä¸ªconditional class probabilityï¼ˆæ¡ä»¶ç±»åˆ«æ¦‚ç‡ï¼‰ï¼š$Pr(Class_i|Object)$ã€‚å³åœ¨ä¸€ä¸ªæ …æ ¼åŒ…å«ä¸€ä¸ªObjectçš„å‰æä¸‹ï¼Œå®ƒå±äºæŸä¸ªç±»çš„æ¦‚ç‡ã€‚æˆ‘ä»¬åªä¸ºæ¯ä¸ªæ …æ ¼é¢„æµ‹ä¸€ç»„ï¼ˆCä¸ªï¼‰ç±»æ¦‚ç‡ï¼Œè€Œä¸è€ƒè™‘æ¡†Bçš„æ•°é‡ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/641.webp" alt><br>å®ƒå°†å›¾åƒåˆ’åˆ†ä¸ºS Ã— Sç½‘æ ¼ï¼Œå¹¶ä¸”æ¯ä¸ªç½‘æ ¼å•å…ƒé¢„æµ‹Bä¸ªè¾¹ç•Œæ¡†ï¼Œå¯¹è¿™äº›æ¡†çš„ç½®ä¿¡åº¦ä»¥åŠCç±»æ¦‚ç‡ã€‚è¿™äº›é¢„æµ‹å€¼è¢«ç¼–ç ä¸ºS Ã— S Ã— (B Ã— 5 + C)å¼ é‡ã€‚ä¸ºäº†è¯„ä¼°PASCAL VOCä¸Šçš„YOLOï¼Œæˆ‘ä»¬ä½¿ç”¨S = 7ï¼ŒB = 2ã€‚PASCAL VOCæœ‰20ä¸ªæ ‡è®°ç±»ï¼Œå› æ­¤C = 20ã€‚æˆ‘ä»¬çš„æœ€ç»ˆé¢„æµ‹æ˜¯7 Ã— 7 Ã— 30å¼ é‡ã€‚</p>
<h2 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h2><p>æˆ‘ä»¬å°†æ­¤æ¨¡å‹ä½œä¸ºå·ç§¯ç¥ç»ç½‘ç»œå®æ–½å¹¶åœ¨PASCAL  VOCæ£€æµ‹æ•°æ®é›†ä¸Šè¿›è¡Œè¯„ä¼°ã€‚ç½‘ç»œçš„åˆå§‹å·ç§¯å±‚ä»å›¾åƒä¸­æå–ç‰¹å¾ï¼Œè€Œå…¨è¿æ¥çš„å±‚é¢„æµ‹è¾“å‡ºæ¦‚ç‡å’Œåæ ‡ã€‚YOLOç½‘ç»œå€Ÿé‰´äº†GoogLeNetåˆ†ç±»ç½‘ç»œç»“æ„ã€‚ä¸åŒçš„æ˜¯ï¼ŒYOLOæœªä½¿ç”¨inception  moduleï¼Œè€Œæ˜¯ä½¿ç”¨1 x 1å·ç§¯å±‚ï¼ˆæ­¤å¤„1x1å·ç§¯å±‚çš„å­˜åœ¨æ˜¯ä¸ºäº†è·¨é€šé“ä¿¡æ¯æ•´åˆï¼‰+3 x 3å·ç§¯å±‚ç®€å•æ›¿ä»£ã€‚å®Œæ•´çš„ç½‘ç»œç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œæœ€ç»ˆçš„è¾“å‡ºç»“æœæ˜¯ä¸€ä¸ª7 x 7 x 30çš„å¼ é‡ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/642.webp" alt></p>
<h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>é¦–å…ˆåˆ©ç”¨ImageNet 1000-classçš„åˆ†ç±»ä»»åŠ¡æ•°æ®é›†Pretrainå·ç§¯å±‚ã€‚ä½¿ç”¨ä¸Šè¿°ç½‘ç»œä¸­çš„å‰20 ä¸ªå·ç§¯å±‚ï¼ŒåŠ ä¸Šä¸€ä¸ª average-pooling  layerï¼Œæœ€ååŠ ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œä½œä¸º Pretrain çš„ç½‘ç»œã€‚è®­ç»ƒå¤§çº¦ä¸€å‘¨çš„æ—¶é—´ï¼Œä½¿å¾—åœ¨ImageNet  2012çš„éªŒè¯æ•°æ®é›†Top-5çš„ç²¾åº¦è¾¾åˆ° 88%ï¼Œè¿™ä¸ªç»“æœè·Ÿ GoogleNet çš„æ•ˆæœç›¸å½“ã€‚</p>
<p>å°†Pretrainçš„ç»“æœçš„å‰20å±‚å·ç§¯å±‚åº”ç”¨åˆ°Detectionä¸­ï¼Œå¹¶åŠ å…¥å‰©ä¸‹çš„4ä¸ªå·ç§¯å±‚åŠ2ä¸ªå…¨è¿æ¥ã€‚åŒæ—¶ä¸ºäº†è·å–æ›´ç²¾ç»†åŒ–çš„ç»“æœï¼Œå°†è¾“å…¥å›¾åƒçš„åˆ†è¾¨ç‡ç”± 224<em> 224 æå‡åˆ° 448</em> 448ã€‚å°†æ‰€æœ‰çš„é¢„æµ‹ç»“æœéƒ½å½’ä¸€åŒ–åˆ° 0~1, ä½¿ç”¨ Leaky RELU ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚Leaky  RELUçš„å…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/643.png" alt></p>
<p>Leaky RELUå¯ä»¥è§£å†³RELUçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p>
<p>æŸå¤±å‡½æ•°çš„è®¾è®¡ç›®æ ‡å°±æ˜¯è®©åæ ‡ï¼ˆx,y,w,hï¼‰ï¼Œconfidenceï¼Œclassification è¿™ä¸ªä¸‰ä¸ªæ–¹é¢è¾¾åˆ°å¾ˆå¥½çš„å¹³è¡¡ã€‚ç®€å•çš„å…¨éƒ¨é‡‡ç”¨äº†sum-squared error lossæ¥åšè¿™ä»¶äº‹ä¼šæœ‰ä»¥ä¸‹ä¸è¶³ï¼š</p>
<ul>
<li>8ç»´çš„localization errorå’Œ20ç»´çš„classification erroråŒç­‰é‡è¦æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</li>
<li>å¦‚æœä¸€äº›æ …æ ¼ä¸­æ²¡æœ‰objectï¼ˆä¸€å¹…å›¾ä¸­è¿™ç§æ …æ ¼å¾ˆå¤šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå°†è¿™äº›æ …æ ¼ä¸­çš„bounding boxçš„confidenceç½®ä¸º0ï¼Œç›¸æ¯”äºè¾ƒå°‘çš„æœ‰objectçš„æ …æ ¼ï¼Œè¿™äº›ä¸åŒ…å«ç‰©ä½“çš„æ …æ ¼å¯¹æ¢¯åº¦æ›´æ–°çš„è´¡çŒ®ä¼šè¿œå¤§äºåŒ…å«ç‰©ä½“çš„æ …æ ¼å¯¹æ¢¯åº¦æ›´æ–°çš„è´¡çŒ®ï¼Œè¿™ä¼šå¯¼è‡´ç½‘ç»œä¸ç¨³å®šç”šè‡³å‘æ•£ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒYOLOçš„æŸå¤±å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/object_detection/20180511204751564.png" alt></p>
<p>YOLOçš„æŸå¤±å‡½æ•°æ›´é‡è§†8ç»´çš„åæ ‡é¢„æµ‹ï¼Œç»™è¿™äº›æŸå¤±å‰é¢èµ‹äºˆæ›´å¤§çš„loss weight, è®°ä¸º Î»coord ï¼Œåœ¨pascal VOCè®­ç»ƒä¸­å–5ï¼ˆä¸Šå›¾è“è‰²æ¡†ï¼‰ã€‚ å¯¹æ²¡æœ‰objectçš„bboxçš„confidence lossï¼Œèµ‹äºˆå°çš„loss weightï¼Œè®°ä¸º Î»noobj ï¼Œåœ¨pascal VOCè®­ç»ƒä¸­å–0.5ï¼ˆä¸Šå›¾æ©™è‰²æ¡†ï¼‰ã€‚ æœ‰objectçš„bboxçš„confidence loss (ä¸Šå›¾çº¢è‰²æ¡†) å’Œç±»åˆ«çš„loss ï¼ˆä¸Šå›¾ç´«è‰²æ¡†ï¼‰çš„loss weightæ­£å¸¸å–1ã€‚å¯¹ä¸åŒå¤§å°çš„bboxé¢„æµ‹ä¸­ï¼Œç›¸æ¯”äºå¤§bboxé¢„æµ‹åä¸€ç‚¹ï¼Œå°boxé¢„æµ‹åç›¸åŒçš„å°ºå¯¸å¯¹IOUçš„å½±å“æ›´å¤§ã€‚è€Œsum-square error lossä¸­å¯¹åŒæ ·çš„åç§»lossæ˜¯ä¸€æ ·ã€‚ä¸ºäº†ç¼“å’Œè¿™ä¸ªé—®é¢˜ï¼Œä½œè€…ç”¨äº†ä¸€ä¸ªå·§å¦™çš„åŠæ³•ï¼Œå°±æ˜¯å°†boxçš„widthå’Œheightå–å¹³æ–¹æ ¹ä»£æ›¿åŸæœ¬çš„heightå’Œwidthã€‚å¦‚ä¸‹å›¾ï¼šsmall bboxçš„æ¨ªè½´å€¼çš„åç§»ä¸big bboxä¸€æ ·éƒ½ä¸º0.1ï¼Œååº”åˆ°yè½´ä¸Šçš„lossï¼ˆä¸‹å›¾ç»¿è‰²ï¼‰æ¯”big box(ä¸‹å›¾çº¢è‰²)è¦å¤§ã€‚å³æ”¾å¤§äº†small boxxçš„è¯¯å·®ï¼Œä½¿ç½‘ç»œæ›´æ³¨é‡äºå°å°ºåº¦bboxçš„è¯¯å·®ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/644.webp" alt></p>
<p>åœ¨ YOLOä¸­ï¼Œæ¯ä¸ªæ …æ ¼é¢„æµ‹å¤šä¸ªbounding boxï¼Œä½†åœ¨ç½‘ç»œæ¨¡å‹çš„è®­ç»ƒä¸­ï¼Œå¸Œæœ›æ¯ä¸€ä¸ªç‰©ä½“æœ€åç”±ä¸€ä¸ªbounding box  predictoræ¥è´Ÿè´£é¢„æµ‹ã€‚å› æ­¤ï¼Œå½“å‰å“ªä¸€ä¸ªpredictoré¢„æµ‹çš„bounding boxä¸ground truth  boxçš„IOUæœ€å¤§ï¼Œè¿™ä¸ªpredictorå°±è´Ÿè´£predict  objectã€‚è¿™ä¼šä½¿å¾—æ¯ä¸ªpredictorå¯ä»¥ä¸“é—¨çš„è´Ÿè´£ç‰¹å®šçš„ç‰©ä½“æ£€æµ‹ã€‚éšç€è®­ç»ƒçš„è¿›è¡Œï¼Œæ¯ä¸€ä¸ªpredictorå¯¹ç‰¹å®šçš„ç‰©ä½“å°ºå¯¸ã€é•¿å®½æ¯”çš„ç‰©ä½“çš„ç±»åˆ«çš„é¢„æµ‹ä¼šè¶Šæ¥è¶Šå¥½ã€‚</p>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>æµ‹è¯•çš„æ—¶å€™ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„classä¿¡æ¯$\left(\operatorname{Pr}\left(\text {Class}_{i} | \text {Object}\right)\right)$å’Œbounding boxé¢„æµ‹çš„confidenceä¿¡æ¯$\left(\operatorname{Pr}(\text { Object }) * I O U_{\text {pred }}^{\text {truth }}\right)$ç›¸ä¹˜ï¼Œå°±å¾—åˆ°æ¯ä¸ªbounding boxçš„class-specific confidence scoreã€‚</p>
<script type="math/tex; mode=display">
P_r(Class_i|Object) âˆ— P_r(Object) âˆ— IOU^{truth}_{pred} = P_r(Class_i) âˆ— IOU^{truth}_{pred}</script><ul>
<li><p>ç­‰å¼å·¦è¾¹ç¬¬ä¸€é¡¹å°±æ˜¯æ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç±»åˆ«ä¿¡æ¯ï¼Œç¬¬äºŒä¸‰é¡¹å°±æ˜¯æ¯ä¸ªbounding boxé¢„æµ‹çš„confidenceã€‚è¿™ä¸ªä¹˜ç§¯å³encodeäº†é¢„æµ‹çš„boxå±äºæŸä¸€ç±»çš„æ¦‚ç‡ï¼Œä¹Ÿæœ‰è¯¥boxå‡†ç¡®åº¦çš„ä¿¡æ¯ã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/645.webp" alt></p>
</li>
<li><p>å¯¹æ¯ä¸€ä¸ªç½‘æ ¼çš„æ¯ä¸€ä¸ªbboxæ‰§è¡ŒåŒæ ·æ“ä½œï¼š7 x 7 x 2 = 98 bbox ï¼ˆæ¯ä¸ªbboxæ—¢æœ‰å¯¹åº”çš„classä¿¡æ¯åˆæœ‰åæ ‡ä¿¡æ¯ï¼‰<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/646.webp" alt></p>
</li>
<li><p>å¾—åˆ°æ¯ä¸ªbboxçš„class-specific confidence scoreä»¥åï¼Œè®¾ç½®é˜ˆå€¼ï¼Œæ»¤æ‰å¾—åˆ†ä½çš„boxesï¼Œå¯¹ä¿ç•™çš„boxesè¿›è¡ŒNMSå¤„ç†ï¼Œå°±å¾—åˆ°æœ€ç»ˆçš„æ£€æµ‹ç»“æœã€‚<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/647.webp" alt></p>
<p>NMSçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/648.gif" alt></p>
</li>
</ul>
<h2 id="ç®—æ³•ä¼˜ç¼ºç‚¹"><a href="#ç®—æ³•ä¼˜ç¼ºç‚¹" class="headerlink" title="ç®—æ³•ä¼˜ç¼ºç‚¹"></a>ç®—æ³•ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å°±åƒåœ¨è®­ç»ƒä¸­ä¸€æ ·ï¼Œå›¾åƒçš„æ£€æµ‹åªéœ€è¦ä¸€ä¸ªç½‘ç»œè¯„ä¼°ã€‚åœ¨PASCAL VOCä¸Šï¼Œç½‘ç»œé¢„æµ‹æ¯ä¸ªå›¾åƒçš„98ä¸ªè¾¹ç•Œæ¡†å’Œæ¯ä¸ªæ¡†çš„ç±»æ¦‚ç‡ã€‚YOLOåœ¨æµ‹è¯•æ—¶é—´é€Ÿåº¦éå¸¸å¿«ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªç½‘ç»œé¢„æµ‹ï¼Œè€Œä¸åƒåŸºäºåˆ†ç±»å™¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆå¿«ã€‚</li>
<li>é€Ÿåº¦å¿«ï¼ŒYOLOå°†ç‰©ä½“æ£€æµ‹ä½œä¸ºå›å½’é—®é¢˜è¿›è¡Œæ±‚è§£ï¼Œæ•´ä¸ªæ£€æµ‹ç½‘ç»œpipelineç®€å•ã€‚åœ¨titan x GPUä¸Šï¼Œåœ¨ä¿è¯æ£€æµ‹å‡†ç¡®ç‡çš„å‰æä¸‹ï¼ˆ63.4% mAPï¼ŒVOC 2007 test setï¼‰ï¼Œå¯ä»¥è¾¾åˆ°45fpsçš„æ£€æµ‹é€Ÿåº¦ã€‚</li>
<li>èƒŒæ™¯è¯¯æ£€ç‡ä½ã€‚YOLOåœ¨è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­èƒ½çœ‹åˆ°æ•´å¼ å›¾åƒçš„æ•´ä½“ä¿¡æ¯ï¼Œè€ŒåŸºäºregion proposalçš„ç‰©ä½“æ£€æµ‹æ–¹æ³•ï¼ˆå¦‚rcnn/fast  rcnnï¼‰ï¼Œåœ¨æ£€æµ‹è¿‡ç¨‹ä¸­ï¼Œåªçœ‹åˆ°å€™é€‰æ¡†å†…çš„å±€éƒ¨å›¾åƒä¿¡æ¯ã€‚å› æ­¤ï¼Œè‹¥å½“å›¾åƒèƒŒæ™¯ï¼ˆéç‰©ä½“ï¼‰ä¸­çš„éƒ¨åˆ†æ•°æ®è¢«åŒ…å«åœ¨å€™é€‰æ¡†ä¸­é€å…¥æ£€æµ‹ç½‘ç»œè¿›è¡Œæ£€æµ‹æ—¶ï¼Œå®¹æ˜“è¢«è¯¯æ£€æµ‹æˆç‰©ä½“ã€‚æµ‹è¯•è¯æ˜ï¼ŒYOLOå¯¹äºèƒŒæ™¯å›¾åƒçš„è¯¯æ£€ç‡ä½äºfast rcnnè¯¯æ£€ç‡çš„ä¸€åŠã€‚</li>
<li>é€šç”¨æ€§å¼ºã€‚YOLOå¯¹äºè‰ºæœ¯ç±»ä½œå“ä¸­çš„ç‰©ä½“æ£€æµ‹åŒæ ·é€‚ç”¨ã€‚å®ƒå¯¹éè‡ªç„¶å›¾åƒç‰©ä½“çš„æ£€æµ‹ç‡è¿œè¿œé«˜äºDPMå’ŒRCNNç³»åˆ—æ£€æµ‹æ–¹æ³•ã€‚</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>æ¯ä¸ª grid cell åªé¢„æµ‹ä¸€ä¸ª ç±»åˆ«çš„ Bounding Boxesï¼Œè€Œä¸”æœ€ååªå–ç½®ä¿¡åº¦æœ€å¤§çš„é‚£ä¸ª Boxã€‚è¿™å°±å¯¼è‡´å¦‚æœå¤šä¸ªä¸åŒç‰©ä½“(æˆ–è€…åŒç±»ç‰©ä½“çš„ä¸åŒå®ä½“)çš„ä¸­å¿ƒè½åœ¨åŒä¸€ä¸ªç½‘æ ¼ä¸­ï¼Œä¼šé€ æˆæ¼æ£€ã€‚</li>
<li>é¢„æµ‹çš„ Box å¯¹äºå°ºåº¦çš„å˜åŒ–æ¯”è¾ƒæ•æ„Ÿï¼Œåœ¨å°ºåº¦ä¸Šçš„æ³›åŒ–èƒ½åŠ›æ¯”è¾ƒå·®ã€‚</li>
<li>è¯†åˆ«ç‰©ä½“ä½ç½®ç²¾å‡†æ€§å·®ã€‚</li>
<li>å¬å›ç‡ä½ã€‚</li>
</ul>
<h3 id="å’Œå…¶å®ƒç®—æ³•å¯¹æ¯”"><a href="#å’Œå…¶å®ƒç®—æ³•å¯¹æ¯”" class="headerlink" title="å’Œå…¶å®ƒç®—æ³•å¯¹æ¯”"></a>å’Œå…¶å®ƒç®—æ³•å¯¹æ¯”</h3><p>Table1ç»™å‡ºäº†YOLOä¸å…¶ä»–ç‰©ä½“æ£€æµ‹æ–¹æ³•ï¼Œåœ¨æ£€æµ‹é€Ÿåº¦å’Œå‡†ç¡®æ€§æ–¹é¢çš„æ¯”è¾ƒç»“æœï¼ˆä½¿ç”¨VOC 2007æ•°æ®é›†ï¼‰ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/649.png" alt></p>
<p>è®ºæ–‡ä¸­ï¼Œä½œè€…è¿˜ç»™å‡ºäº†YOLOä¸Fast RCNNåœ¨å„æ–¹é¢çš„è¯†åˆ«è¯¯å·®æ¯”ä¾‹ï¼Œå¦‚Table4æ‰€ç¤ºã€‚YOLOå¯¹èƒŒæ™¯å†…å®¹çš„è¯¯åˆ¤ç‡ï¼ˆ4.75%ï¼‰æ¯”Fast  RCNNçš„è¯¯åˆ¤ç‡ï¼ˆ13.6%ï¼‰ä½å¾ˆå¤šã€‚ä½†æ˜¯YOLOçš„å®šä½å‡†ç¡®ç‡è¾ƒå·®ï¼Œå æ€»è¯¯å·®æ¯”ä¾‹çš„19.0%ï¼Œè€ŒFast RCNNä»…ä¸º8.6%ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/YOLOv1/650.png" alt></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>YOLOv1æœ€å¤§çš„å¼€åˆ›æ€§è´¡çŒ®åœ¨äºå°†ç‰©ä½“æ£€æµ‹ä½œä¸ºä¸€ä¸ªå›å½’é—®é¢˜è¿›è¡Œæ±‚è§£ï¼Œè¾“å…¥å›¾åƒç»è¿‡ä¸€æ¬¡inferenceï¼Œä¾¿èƒ½å¾—åˆ°å›¾åƒä¸­æ‰€æœ‰ç‰©ä½“çš„ä½ç½®å’Œå…¶æ‰€å±ç±»åˆ«åŠç›¸åº”çš„ç½®ä¿¡æ¦‚ç‡ã€‚è€Œrcnn/fast rcnn/faster rcnnå°†æ£€æµ‹ç»“æœåˆ†ä¸ºä¸¤éƒ¨åˆ†æ±‚è§£ï¼šç‰©ä½“ç±»åˆ«ï¼ˆåˆ†ç±»é—®é¢˜ï¼‰ï¼Œç‰©ä½“ä½ç½®å³bounding  boxï¼ˆå›å½’é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥YOLOçš„ç›®æ ‡æ£€æµ‹é€Ÿåº¦å¾ˆå¿«ã€‚</li>
<li>YOLOä»ç„¶æ˜¯ä¸€ä¸ªé€Ÿåº¦æ¢ç²¾åº¦çš„ç®—æ³•ï¼Œç›®æ ‡æ£€æµ‹çš„ç²¾åº¦ä¸å¦‚RCNN</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNet Dropoutå±‚ä»£ç è¯¦è§£</title>
    <url>/2020/04/17/AlexeyAB-DarkNet-Dropout%E5%B1%82%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ¬¡è§£æ<code>src/dropout.h</code>å’Œ<code>src/dropout.c</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå³æ˜¯Dropoutå±‚ã€‚</p>
<h2 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h2><p>åœ¨CNNä¸­ä½¿ç”¨Dropoutåˆ†æˆè®­ç»ƒå’Œæµ‹è¯•ä¸¤ä¸ªé˜¶æ®µï¼Œåœ¨è®­ç»ƒé˜¶æ®µï¼ŒDropoutä»¥ä¸€å®šçš„æ¦‚ç‡$p$éšæœºä¸¢å¼ƒä¸€éƒ¨åˆ†ç¥ç»å…ƒèŠ‚ç‚¹ï¼Œå³è¿™éƒ¨åˆ†ç¥ç»å…ƒèŠ‚ç‚¹ä¸å‚ä¸è®¡ç®—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/669.webp" alt></p>
<p>åœ¨è®­ç»ƒæ—¶ï¼Œæ¯ä¸ªç¥ç»å…ƒæœ‰æ¦‚ç‡$p$çš„å¯èƒ½æ€§è¢«ä¿ç•™ä¸‹æ¥ï¼Œå³Dropoutçš„ä¸¢å¼ƒæ¦‚ç‡ä¸º$1-p$ã€‚åœ¨æµ‹è¯•é˜¶æ®µï¼Œæ¯ä¸ªç¥ç»å…ƒéƒ½æ˜¯å­˜åœ¨çš„ï¼Œæƒé‡å‚æ•°$w$è¦ä¹˜ä»¥$p$æˆä¸º$pw$ã€‚ä¸ºä»€ä¹ˆæµ‹è¯•é˜¶æ®µè¦ä¹˜ä»¥$p$å‘¢ï¼Ÿ</p>
<p>è€ƒè™‘ç¬¬ä¸€ä¸ªéšè—å±‚çš„ä¸€ä¸ªç¥ç»å…ƒåœ¨Dropoutä¹‹å‰çš„è¾“å‡ºæ˜¯$x$ï¼Œé‚£ä¹ˆDropoutä¹‹åçš„æœŸæœ›å€¼ä¸º$E=px+(1-p)0$ï¼Œåœ¨æµ‹è¯•æ—¶è¯¥ç¥ç»å…ƒæ€»æ˜¯æ¿€æ´»çš„ï¼Œä¸ºäº†ä¿æŒåŒæ ·çš„è¾“å‡ºæœŸæœ›å€¼å¹¶ä½¿å¾—ä¸‹ä¸€å±‚ä¹Ÿå¾—åˆ°åŒæ ·çš„ç»“æœï¼Œéœ€è¦è°ƒæ•´$x-&gt;px$ã€‚å…¶ä¸­$p$æ˜¯<strong>Bernoulliåˆ†å¸ƒ</strong>ï¼ˆ0-1åˆ†å¸ƒï¼‰ä¸­å€¼ä¸º1çš„æ¦‚ç‡ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/670.png" alt></p>
<h2 id="Inverted-Dropout"><a href="#Inverted-Dropout" class="headerlink" title="Inverted Dropout"></a>Inverted Dropout</h2><p>åœ¨è®­ç»ƒçš„æ—¶å€™ç”±äºèˆå¼ƒä¸€äº›ç¥ç»å…ƒï¼Œå› æ­¤åœ¨æµ‹è¯•çš„æ—¶å€™éœ€è¦åœ¨æ¿€æ´»çš„ç»“æœä¸­ä¹˜ä¸Šå› å­$p$è¿›è¡Œç¼©æ”¾ï¼Œä½†æ˜¯è¿™æ ·éœ€è¦å¯¹æµ‹è¯•çš„ä»£ç è¿›è¡Œä¿®æ”¹å¹¶å¢åŠ äº†æµ‹è¯•æ—¶çš„è¿ç®—é‡ï¼Œååˆ†å½±å“æµ‹è¯•æ—¶çš„æ€§èƒ½ã€‚é€šå¸¸ä¸ºäº†æé«˜æµ‹è¯•çš„æ€§èƒ½ï¼Œå¯ä»¥å°†ç¼©æ”¾çš„å·¥ä½œè½¬ç§»åˆ°è®­ç»ƒé˜¶æ®µï¼Œè€Œæµ‹è¯•é˜¶æ®µå’Œä¸ä½¿ç”¨Dropoutä¸€è‡´ï¼Œè¿™ä¸€æ“ä½œå°±è¢«å«ä½œ<strong>Inverted Dropout</strong>ã€‚å…·ä½“å®ç°çš„æ—¶å€™åªéœ€è¦å°†å‰å‘ä¼ æ’­Dropoutæ—¶ä¿ç•™ä¸‹æ¥çš„ç¥ç»å…ƒçš„æƒé‡ä¹˜ä¸Š$\frac{1}{p}$å³å¯ã€‚</p>
<h2 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h2><h3 id="dropout-layer-hä»£ç è§£æ"><a href="#dropout-layer-hä»£ç è§£æ" class="headerlink" title="dropout_layer.hä»£ç è§£æ"></a>dropout_layer.hä»£ç è§£æ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;layer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;network.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> layer dropout_layer;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">// æ„å»ºä¸€ä¸ªdropoutå±‚</span></span><br><span class="line"><span class="function">dropout_layer <span class="title">make_dropout_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> inputs, <span class="keyword">float</span> probability, <span class="keyword">int</span> dropblock, <span class="keyword">float</span> dropblock_size_rel, <span class="keyword">int</span> dropblock_size_abs, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> c)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dropoutå‰å‘ä¼ æ’­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_dropout_layer</span><span class="params">(dropout_layer l, network_state state)</span></span>;</span><br><span class="line"><span class="comment">// dropoutåå‘ä¼ æ’­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_dropout_layer</span><span class="params">(dropout_layer l, network_state state)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize_dropout_layer</span><span class="params">(dropout_layer *l, <span class="keyword">int</span> inputs)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_dropout_layer_gpu</span><span class="params">(dropout_layer l, network_state state)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_dropout_layer_gpu</span><span class="params">(dropout_layer l, network_state state)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="dropout-layer-cppä»£ç è§£æ"><a href="#dropout-layer-cppä»£ç è§£æ" class="headerlink" title="dropout_layer.cppä»£ç è§£æ"></a>dropout_layer.cppä»£ç è§£æ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æ„å»ºdropoutå±‚</span></span><br><span class="line"><span class="comment"> * batch ä¸€ä¸ªbatchä¸­å›¾ç‰‡å¼ æ•°</span></span><br><span class="line"><span class="comment"> * inputs  dropoutå±‚æ¯å¼ è¾“å…¥å›¾ç‰‡çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> * probability dropoutæ¦‚ç‡,å³æŸä¸ªè¾“å…¥ç¥ç»å…ƒè¢«ä¸¢å¼ƒçš„æ¦‚ç‡,ç”±é…ç½®æ–‡ä»¶æŒ‡å®š;å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœªæŒ‡å®š,åˆ™é»˜è®¤å€¼ä¸º0.5(å‚è§parse_dropout_layer()å‡½æ•°)</span></span><br><span class="line"><span class="comment"> * è¿”å›dropout_layer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜: dropoutå±‚çš„æ„å»ºå‡½æ•°éœ€è¦çš„è¾“å…¥å‚æ•°æ¯”è¾ƒå°‘,ç½‘ç»œè¾“å…¥æ•°æ®å°ºå¯¸h,w,cä¹Ÿä¸éœ€è¦;</span></span><br><span class="line"><span class="comment"> * æ³¨æ„: dropoutå±‚æœ‰l.inputs = l.outputs; å¦å¤–æ­¤å¤„å®ç°ä½¿ç”¨äº†inverted dropout, ä¸æ˜¯æ ‡å‡†çš„dropout</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">dropout_layer <span class="title">make_dropout_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> inputs, <span class="keyword">float</span> probability, <span class="keyword">int</span> dropblock, <span class="keyword">float</span> dropblock_size_rel, <span class="keyword">int</span> dropblock_size_abs, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dropout_layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    l.type = DROPOUT;</span><br><span class="line">    l.probability = probability; <span class="comment">//ä¸¢å¼ƒæ¦‚ç‡ (1-probability ä¸ºä¿ç•™æ¦‚ç‡)</span></span><br><span class="line">    l.dropblock = dropblock; </span><br><span class="line">    l.dropblock_size_rel = dropblock_size_rel;</span><br><span class="line">    l.dropblock_size_abs = dropblock_size_abs;</span><br><span class="line">    <span class="keyword">if</span> (l.dropblock) &#123;</span><br><span class="line">        l.out_w = l.w = w;</span><br><span class="line">        l.out_h = l.h = h;</span><br><span class="line">        l.out_c = l.c = c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (l.w &lt;= <span class="number">0</span> || l.h &lt;= <span class="number">0</span> || l.c &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot; Error: DropBlock - there must be positive values for: l.w=%d, l.h=%d, l.c=%d \n&quot;</span>, l.w, l.h, l.c);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    l.inputs = inputs; <span class="comment">// dropoutå±‚ä¸ä¼šæ”¹å˜è¾“å…¥è¾“å‡ºçš„ä¸ªæ•°,å› æ­¤æœ‰ l.inputs == l.outputs</span></span><br><span class="line">    l.outputs = inputs; <span class="comment">// è™½ç„¶dropoutä¼šä¸¢å¼ƒä¸€äº›è¾“å…¥ç¥ç»å…ƒ, ä½†è¿™ä¸¢å¼ƒåªæ˜¯ç½®è¯¥è¾“å…¥å…ƒç´ å€¼ä¸º0, å¹¶æ²¡æœ‰åˆ é™¤</span></span><br><span class="line">    l.batch = batch; <span class="comment">// ä¸€ä¸ªbatchä¸­å›¾ç‰‡æ•°é‡</span></span><br><span class="line">    l.rand = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(inputs * batch, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//åŠ¨æ€åˆ†é…å†…å­˜,</span></span><br><span class="line">    l.scale = <span class="number">1.</span>/(<span class="number">1.0</span> - probability); <span class="comment">//ä½¿ç”¨inverted dropout, scaleå–ä¿ç•™æ¦‚ç‡çš„å€’æ•°</span></span><br><span class="line">    l.forward = forward_dropout_layer; <span class="comment">//å‰å‘ä¼ æ’­</span></span><br><span class="line">    l.backward = backward_dropout_layer; <span class="comment">// åå‘ä¼ æ’­</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    l.forward_gpu = forward_dropout_layer_gpu;</span><br><span class="line">    l.backward_gpu = backward_dropout_layer_gpu;</span><br><span class="line">    l.rand_gpu = <span class="built_in">cuda_make_array</span>(l.rand, inputs*batch);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (l.dropblock) &#123;</span><br><span class="line">        <span class="keyword">if</span>(l.dropblock_size_abs) <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;dropblock       p = %.2f   l.dropblock_size_abs = %d         %4d  -&gt;   %4d\n&quot;</span>, probability, l.dropblock_size_abs, inputs, inputs);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;dropblock       p = %.2f   l.dropblock_size_rel = %.2f         %4d  -&gt;   %4d\n&quot;</span>, probability, l.dropblock_size_rel, inputs, inputs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;dropout       p = %.2f                  %4d  -&gt;   %4d\n&quot;</span>, probability, inputs, inputs);</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize_dropout_layer</span><span class="params">(dropout_layer *l, <span class="keyword">int</span> inputs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l-&gt;inputs = l-&gt;outputs = inputs;</span><br><span class="line">    l-&gt;rand = (<span class="keyword">float</span>*)<span class="built_in">xrealloc</span>(l-&gt;rand, l-&gt;inputs * l-&gt;batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="built_in">cuda_free</span>(l-&gt;rand_gpu);</span><br><span class="line"></span><br><span class="line">    l-&gt;rand_gpu = <span class="built_in">cuda_make_array</span>(l-&gt;rand, l-&gt;inputs*l-&gt;batch);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * dropoutå±‚å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @l å½“å‰dropoutå±‚å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @state æ•´ä¸ªç½‘ç»œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜:dropoutå±‚æ²¡æœ‰è®­ç»ƒå‚æ•°,å› æ­¤å‰å‘ä¼ æ’­å‡½æ•°æ¯”è¾ƒç®€å•,åªéœ€è¦å®Œæˆä¸€ä»¶äº‹: æŒ‰æŒ‡å®šæ¦‚ç‡ l.probability</span></span><br><span class="line"><span class="comment"> * ä¸¢å¼ƒè¾“å…¥å…ƒç´ ,å¹¶å°†ä¿ç•™ä¸‹æ¥çš„è¾“å…¥å…ƒç´ ä¹˜ä»¥æ¯”ä¾‹å› å­scale(é‡‡ç”¨inverted dropout, è¿™ç§å‡¡æ˜¯å®ç°æ›´ä¸ºæ–¹ä¾¿,</span></span><br><span class="line"><span class="comment"> * ä¸”ä»£ç æ¥å£æ¯”è¾ƒç»Ÿä¸€;å¦‚æœé‡‡ç”¨æ ‡å‡†çš„dropout, åˆ™æµ‹è¯•é˜¶æ®µéœ€è¦è¿›å…¥ forward_dropout_layer(),</span></span><br><span class="line"><span class="comment"> * ä½¿æ¯ä¸ªè¾“å…¥ä¹˜ä»¥ä¿ç•™æ¦‚ç‡,è€Œä½¿ç”¨inverted dropout, æµ‹è¯•é˜¶æ®µå°±ä¸éœ€è¦è¿›å…¥åˆ°forward_dropout_layer())</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜: dropoutå±‚æœ‰l.inputs = l.outputs;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_dropout_layer</span><span class="params">(dropout_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// å› ä¸ºä½¿ç”¨inverted dropout,æ‰€ä»¥æµ‹è¯•é˜¶æ®µä¸éœ€è¦è¿›å…¥forward_dropout_layer()</span></span><br><span class="line">    <span class="keyword">if</span> (!state.train) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.batch * l.inputs; ++i)&#123;</span><br><span class="line">		<span class="comment">// é‡‡æ ·ä¸€ä¸ª0-1ä¹‹é—´å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°</span></span><br><span class="line">        <span class="keyword">float</span> r = <span class="built_in">rand_uniform</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        l.rand[i] = r; <span class="comment">// æ¯ä¸€ä¸ªéšæœºæ•°éƒ½è¦ä¿å­˜åˆ°l.rand,ä¹‹ååå‘ä¼ æ’­æ—¶å€™ä¼šç”¨åˆ°</span></span><br><span class="line">        <span class="keyword">if</span>(r &lt; l.probability) state.input[i] = <span class="number">0</span>; <span class="comment">// èˆå¼ƒè¯¥å…ƒç´ ,å°†å…¶å€¼ç½®ä¸º0, æ‰€ä»¥è¿™é‡Œå…ƒç´ çš„æ€»ä¸ªæ•°å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–;</span></span><br><span class="line">        <span class="keyword">else</span> state.input[i] *= l.scale; <span class="comment">//ä¿ç•™è¯¥è¾“å…¥å…ƒç´ ,å¹¶ä¹˜ä»¥æ¯”ä¾‹å› å­scale</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * dropoutå±‚åå‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment"> * l å½“å‰dropoutå±‚ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> * state æ•´ä¸ªç½‘ç»œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜: dropoutå±‚çš„åå‘ä¼ æ’­ç›¸å¯¹ç®€å•,å› ä¸ºå…¶æœ¬èº«æ²¡æœ‰è®­ç»ƒå‚æ•°,ä¹Ÿæ²¡æœ‰æ¿€æ´»å‡½æ•°,æˆ–è€…è¯´æ¿€æ´»å‡½æ•°ä¸ºf(x) =x,</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå°±æ˜¯æ¿€æ´»å‡½æ•°å…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ä¸º1, å› æ­¤å…¶è‡ªèº«çš„è¯¯å·®é¡¹å€¼ä»¥åç”±ä¸‹ä¸€å±‚ç½‘ç»œåå‘ä¼ æ’­æ—¶è®¡ç®—å®Œäº†,</span></span><br><span class="line"><span class="comment"> * æ²¡æœ‰å¿…è¦å†æ›¾ä»¥æ¿€æ´»å‡½æ•°å…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°äº†.å‰©ä¸‹è¦åšçš„å°±æ˜¯è®¡ç®—ä¸Šä¸€å±‚çš„è¯¯å·®é¡¹net.delta, è¿™ä¸ªè®¡ç®—ä¹Ÿå¾ˆç®€å•;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_dropout_layer</span><span class="params">(dropout_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// å¦‚æœstate.deltaä¸ºç©º,åˆ™è¿”å›(state.deltaä¸ºç©ºåˆ™è¯´æ˜å·²ç»åå‘ä¼ æ’­åˆ°ç¬¬ä¸€å±‚äº†,æ­¤å¤„æ‰€æŒ‡å®šçš„ç¬¬ä¸€å±‚,æ˜¯state.layers[0]</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯ä¸è¾“å…¥å±‚ç›´æ¥ç›¸è¿çš„ç¬¬ä¸€å±‚éšå«å±‚, è¯¦ç»†è§ network.c ä¸­çš„ forward_network()å‡½æ•°)</span></span><br><span class="line">    <span class="keyword">if</span>(!state.delta) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.batch * l.inputs; ++i)&#123;</span><br><span class="line">		<span class="comment">// ä¸å‰å‘è¿‡ç¨‹ forward_dropout_layer ç…§åº”,æ ¹æ®l.randæŒ‡ç¤º,</span></span><br><span class="line">        <span class="keyword">float</span> r = l.rand[i];</span><br><span class="line">		<span class="comment">// å¦‚æœr &lt;ã€€probability,è¯´æ˜èˆä¸¢å¼ƒçš„è¾“å…¥ï¼Œå…¶è¯¯å·®é¡¹å€¼ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span>(r &lt; l.probability) state.delta[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// ä¿ç•™ä¸‹çš„è¾“å…¥å…ƒç´ ,å…¶è¯¯å·®é¡¹å€¼ä¸ºå½“å‰å±‚å¯¹åº”è¾“å‡ºçš„è¯¯å·®é¡¹å€¼ä¹˜ä»¥l.scale</span></span><br><span class="line">        <span class="keyword">else</span> state.delta[i] *= l.scale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNet BNå±‚ä»£ç è¯¦è§£(batchnorm_layer.c)</title>
    <url>/2020/03/01/AlexeyAB-DarkNet-BN%E5%B1%82%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3(batchnorm_layer.c)/</url>
    <content><![CDATA[<h2 id="BatchNormåŸç†"><a href="#BatchNormåŸç†" class="headerlink" title="BatchNormåŸç†"></a>BatchNormåŸç†</h2><p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/667.png" alt></p>
<p>è¿™æ˜¯è®ºæ–‡ä¸­ç»™å‡ºçš„å¯¹BatchNormçš„ç®—æ³•æµç¨‹è§£é‡Šï¼Œè¿™ç¯‡æ¨æ–‡çš„ç›®çš„ä¸»è¦æ˜¯æ¨å¯¼å’Œä»æºç è§’åº¦è§£è¯»BatchNormçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œå°±ä¸å…³æ³¨å…·ä½“çš„åŸç†äº†ï¼ˆå®é™…ä¸Šæ˜¯å› ä¸ºBNå±‚çš„åŸç†éå¸¸å¤æ‚ï¼‰ï¼Œæˆ‘ä»¬æš‚æ—¶çŸ¥é“BNå±‚æ˜¯ç”¨æ¥è°ƒæ•´æ•°æ®åˆ†å¸ƒï¼Œé™ä½è¿‡æ‹Ÿåˆçš„å°±å¤Ÿäº†ã€‚</p>
<h2 id="å‰å‘ä¼ æ’­æ¨å¯¼"><a href="#å‰å‘ä¼ æ’­æ¨å¯¼" class="headerlink" title="å‰å‘ä¼ æ’­æ¨å¯¼"></a>å‰å‘ä¼ æ’­æ¨å¯¼</h2><p>å‰å‘ä¼ æ’­å®é™…å°±æ˜¯å°†Algorithm1çš„4ä¸ªå…¬å¼è½¬åŒ–ä¸ºç¼–ç¨‹è¯­è¨€ï¼Œè¿™é‡Œå…ˆè´´ä¸€æ®µCS231Nå®˜æ–¹æä¾›çš„ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">def <span class="title">batchnorm_forward</span><span class="params">(x, gamma, beta, bn_param)</span>:</span></span><br><span class="line"><span class="function">  <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="function">  Input:</span></span></span><br><span class="line"><span class="string"><span class="function">  - x: (N, D)ç»´è¾“å…¥æ•°æ®</span></span></span><br><span class="line"><span class="string"><span class="function">  - gamma: (D,)ç»´å°ºåº¦å˜åŒ–å‚æ•°</span></span></span><br><span class="line"><span class="string"><span class="function">  - beta: (D,)ç»´å°ºåº¦å˜åŒ–å‚æ•°</span></span></span><br><span class="line"><span class="string"><span class="function">  - bn_param: Dictionary with the following keys:</span></span></span><br><span class="line"><span class="string"><span class="function">    - mode: &#x27;train&#x27; æˆ–è€… &#x27;test&#x27;</span></span></span><br><span class="line"><span class="string"><span class="function">    - eps: ä¸€èˆ¬å–1e-8~1e-4</span></span></span><br><span class="line"><span class="string"><span class="function">    - momentum: è®¡ç®—å‡å€¼ã€æ–¹å·®çš„æ›´æ–°å‚æ•°</span></span></span><br><span class="line"><span class="string"><span class="function">    - running_mean: (D,)åŠ¨æ€å˜åŒ–arrayå­˜å‚¨è®­ç»ƒé›†çš„å‡å€¼</span></span></span><br><span class="line"><span class="string"><span class="function">    - running_varï¼š(D,)åŠ¨æ€å˜åŒ–arrayå­˜å‚¨è®­ç»ƒé›†çš„æ–¹å·®</span></span></span><br><span class="line"><span class="string"><span class="function"></span></span></span><br><span class="line"><span class="string"><span class="function">  Returns a tuple of:</span></span></span><br><span class="line"><span class="string"><span class="function">  - out: è¾“å‡ºy_iï¼ˆNï¼ŒDï¼‰ç»´</span></span></span><br><span class="line"><span class="string"><span class="function">  - cache: å­˜å‚¨åå‘ä¼ æ’­æ‰€éœ€æ•°æ®</span></span></span><br><span class="line"><span class="string"><span class="function">  &quot;</span><span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="function">  mode =</span> bn_param[<span class="string">&#x27;mode&#x27;</span>]</span><br><span class="line">  eps = bn_param.<span class="built_in">get</span>(<span class="string">&#x27;eps&#x27;</span>, <span class="number">1e-5</span>)</span><br><span class="line">  momentum = bn_param.<span class="built_in">get</span>(<span class="string">&#x27;momentum&#x27;</span>, <span class="number">0.9</span>)</span><br><span class="line"></span><br><span class="line">  N, D = x.shape</span><br><span class="line">  # åŠ¨æ€å˜é‡ï¼Œå­˜å‚¨è®­ç»ƒé›†çš„å‡å€¼æ–¹å·®</span><br><span class="line">  running_mean = bn_param.<span class="built_in">get</span>(<span class="string">&#x27;running_mean&#x27;</span>, np.<span class="built_in">zeros</span>(D, dtype=x.dtype))</span><br><span class="line">  running_var = bn_param.<span class="built_in">get</span>(<span class="string">&#x27;running_var&#x27;</span>, np.<span class="built_in">zeros</span>(D, dtype=x.dtype))</span><br><span class="line"></span><br><span class="line">  out, cache = None, None</span><br><span class="line">  # TRAIN å¯¹æ¯ä¸ªbatchæ“ä½œ</span><br><span class="line">  <span class="keyword">if</span> mode == <span class="string">&#x27;train&#x27;</span>:</span><br><span class="line">    sample_mean = np.<span class="built_in">mean</span>(x, axis = <span class="number">0</span>)</span><br><span class="line">    sample_var = np.<span class="built_in">var</span>(x, axis = <span class="number">0</span>)</span><br><span class="line">    x_hat = (x - sample_mean) / np.<span class="built_in">sqrt</span>(sample_var + eps)</span><br><span class="line">    out = gamma * x_hat + beta</span><br><span class="line">    cache = (x, gamma, beta, x_hat, sample_mean, sample_var, eps)</span><br><span class="line">    running_mean = momentum * running_mean + (<span class="number">1</span> - momentum) * sample_mean</span><br><span class="line">    running_var = momentum * running_var + (<span class="number">1</span> - momentum) * sample_var</span><br><span class="line">  # TESTï¼šè¦ç”¨æ•´ä¸ªè®­ç»ƒé›†çš„å‡å€¼ã€æ–¹å·®</span><br><span class="line">  elif mode == <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">    x_hat = (x - running_mean) / np.<span class="built_in">sqrt</span>(running_var + eps)</span><br><span class="line">    out = gamma * x_hat + beta</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    raise <span class="built_in">ValueError</span>(<span class="string">&#x27;Invalid forward batchnorm mode &quot;%s&quot;&#x27;</span> % mode)</span><br><span class="line"></span><br><span class="line">  bn_param[<span class="string">&#x27;running_mean&#x27;</span>] = running_mean</span><br><span class="line">  bn_param[<span class="string">&#x27;running_var&#x27;</span>] = running_var</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> out, cache</span><br></pre></td></tr></table></figure>
<p>å°±æ˜¯ä¸€ä¸ªå…¬å¼å¸¦å…¥çš„é—®é¢˜ï¼Œè¿™é‡Œå€’æ˜¯æ²¡å•¥å¥½è¯´çš„ï¼Œä¸è¿‡äº†ä¸ºäº†å’Œä¸‹é¢åå‘ä¼ æ’­å¯¹æ¯”ç†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜ç¡®æ¯ä¸€ä¸ªå¼ é‡çš„ç»´åº¦ï¼š</p>
<ul>
<li><strong>x</strong> shapeä¸º(N,D)ï¼Œå¯ä»¥å°†Nçœ‹æˆbatch size,Dçœ‹æˆç‰¹å¾å›¾å±•å¼€ä¸º1åˆ—çš„å…ƒç´ ä¸ªæ•°</li>
<li><strong>gamma</strong> shapeä¸º(D,)</li>
<li><strong>beta</strong> shapeä¸º(D,)</li>
<li><strong>running_mean</strong> shapeä¸º(D,)</li>
<li><strong>running_var</strong> shapeä¸º(D,)</li>
</ul>
<p>è¯·ç‰¹åˆ«æ³¨æ„æ»‘åŠ¨å¹³å‡(å½±å­å˜é‡)è¿™ç§Trickçš„å¼•å…¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æ§åˆ¶å˜é‡æ›´æ–°çš„é€Ÿåº¦ï¼Œé˜²æ­¢å˜é‡çš„çªç„¶å˜åŒ–å¯¹å˜é‡çš„æ•´ä½“å½±å“ï¼Œè¿™èƒ½æé«˜æ¨¡å‹çš„é²æ£’æ€§ã€‚</p>
<h2 id="åå‘ä¼ æ’­æ¨å¯¼"><a href="#åå‘ä¼ æ’­æ¨å¯¼" class="headerlink" title="åå‘ä¼ æ’­æ¨å¯¼"></a>åå‘ä¼ æ’­æ¨å¯¼</h2><p>è¿™æ‰æ˜¯é‡ç‚¹ï¼Œç°åœ¨åšä¸€äº›çº¦å®šï¼š</p>
<ul>
<li>$\delta$ä¸ºä¸€ä¸ªBatchæ‰€æœ‰æ ·æœ¬çš„æ–¹å·®</li>
<li>$\mu$ä¸ºæ ·æœ¬å‡å€¼</li>
<li>$\hat{x}$ä¸ºå½’ä¸€åŒ–åçš„æ ·æœ¬æ•°æ®</li>
<li>$y_{i}$ä¸ºè¾“å…¥æ ·æœ¬$x_{i}$ç»è¿‡å°ºåº¦å˜åŒ–çš„è¾“å‡ºé‡</li>
<li>$\gamma$å’Œ$\beta$ä¸ºå°ºåº¦å˜åŒ–ç³»æ•°</li>
<li>$\frac{\partial L}{\partial y}$æ˜¯ä¸Šä¸€å±‚çš„æ¢¯åº¦ï¼Œå¹¶å‡è®¾$x$å’Œ$y$éƒ½æ˜¯$(\mathrm{N}, \mathrm{D})$ç»´ï¼Œå³æœ‰Nä¸ªç»´åº¦ä¸ºDçš„æ ·æœ¬åœ¨BNå±‚çš„å‰å‘ä¼ æ’­ä¸­$x_{i}$é€šè¿‡$\gamma, \beta, \hat{x}$å°†$x_{i}$å˜æ¢ä¸º$y_{i}$ï¼Œé‚£ä¹ˆåå‘ä¼ æ’­åˆ™æ˜¯æ ¹æ®$\frac{\partial L}{\partial y_{i}}$æ±‚å¾—$\frac{\partial L}{\partial \gamma}, \frac{\partial L}{\partial \beta}, \frac{\partial L}{\partial x_{i}}$</li>
<li>æ±‚è§£$\frac{\partial L}{\partial \gamma}$  $\frac{\partial L}{\partial \gamma}=\sum_{i} \frac{\partial L}{\partial y_{i}} \frac{\partial y_{i}}{\partial \gamma}=\sum_{i} \frac{\partial L}{\partial y_{i}} \hat{x}$</li>
<li>æ±‚è§£$\frac{\partial L}{\partial \beta}$  $\frac{\partial L}{\partial \beta}=\sum_{i} \frac{\partial L}{\partial y_{i}} \frac{\partial y_{i}}{\partial \beta}=\sum_{i} \frac{\partial L}{\partial y_{i}}$</li>
<li>æ±‚è§£$\frac{\partial L}{\partial x_{i}}$æ ¹æ®è®ºæ–‡çš„å…¬å¼å’Œé“¾å¼æ³•åˆ™å¯å¾—ä¸‹é¢çš„ç­‰å¼: $\frac{\partial L}{\partial x_{i}}=\frac{\partial L}{\partial \widehat{x}_{i}} \frac{\partial \widehat{x}_{i}}{\partial x_{i}}+\frac{\partial L}{\partial \sigma} \frac{\partial \sigma}{\partial x_{i}}+\frac{\partial L}{\partial \mu} \frac{\partial \mu}{\partial x_{i}}$æˆ‘ä»¬è¿™é‡Œåˆå¯ä»¥å…ˆæ±‚$\frac{\partial L}{\partial \hat{x}}$</li>
<li>$\frac{\partial L}{\partial \hat{x}}=\frac{\partial L}{\partial y} \frac{\partial y}{\partial \hat{x}}=\frac{\partial L}{\partial y} \gamma$    (1)</li>
<li>$\frac{\partial L}{\partial \sigma}=\sum_{i} \frac{\partial L}{\partial y_{i}} \frac{\partial y_{i}}{\partial \hat{x}_{i}} \frac{\partial \hat{x}_{i}}{\partial \sigma}=-\frac{1}{2} \sum_{i} \frac{\partial L}{\partial \widehat{x}_{i}}\left(x_{i}-\mu\right)(\sigma+\varepsilon)^{-1.5}$    (2)</li>
<li>$\frac{\partial L}{\partial \mu}=\frac{\partial L}{\partial \hat{x}} \frac{\partial \hat{x}}{\partial \mu}+\frac{\partial L}{\partial \sigma} \frac{\partial \sigma}{\partial \mu}=\sum_{i} \frac{\partial L}{\partial \hat{x}_{i}} \frac{-1}{\sqrt{\sigma+\varepsilon}}+\frac{\partial L}{\partial \sigma} \frac{-2 \Sigma_{i}\left(x_{i}-\mu\right)}{N}$    (3)</li>
<li>æœ‰äº†(1) (2) (3)å°±å¯ä»¥æ±‚å‡º$\frac{\partial L}{\partial x_{i}}$<br>$\frac{\partial L}{\partial x_{i}}=\frac{\partial L}{\partial \widehat{x}_{i}} \frac{\partial \widehat{x}_{i}}{\partial x_{i}}+\frac{\partial L}{\partial \sigma} \frac{\partial \sigma}{\partial x_{i}}+\frac{\partial L}{\partial \mu} \frac{\partial \mu}{\partial x_{i}}=\frac{\partial L}{\partial \hat{x}_{i}} \frac{1}{\sqrt{\sigma+\varepsilon}}+\frac{\partial L}{\partial \sigma} \frac{2\left(x_{i}-\mu\right)}{N}+\frac{\partial L}{\partial \mu} \frac{1}{N}$</li>
</ul>
<p>åˆ°è¿™é‡Œå°±æ¨åˆ°å‡ºäº†BNå±‚çš„åå‘ä¼ æ’­å…¬å¼äº†ï¼Œå’Œè®ºæ–‡ä¸­ä¸€æ ·ï¼Œæˆªå–ä¸€ä¸‹è®ºæ–‡ä¸­çš„ç»“æœå›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/668.webp" alt></p>
<p>è´´ä¸€ä»½CS231Nåå‘ä¼ æ’­ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">def <span class="title">batchnorm_backward</span><span class="params">(dout, cache)</span>:</span></span><br><span class="line"><span class="function">  <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="function">  Inputs:</span></span></span><br><span class="line"><span class="string"><span class="function">  - dout: ä¸Šä¸€å±‚çš„æ¢¯åº¦ï¼Œç»´åº¦(N, D)ï¼Œå³ dL/dy</span></span></span><br><span class="line"><span class="string"><span class="function">  - cache: æ‰€éœ€çš„ä¸­é—´å˜é‡ï¼Œæ¥è‡ªäºå‰å‘ä¼ æ’­</span></span></span><br><span class="line"><span class="string"><span class="function"></span></span></span><br><span class="line"><span class="string"><span class="function">  Returns a tuple of:</span></span></span><br><span class="line"><span class="string"><span class="function">  - dx: (N, D)ç»´çš„ dL/dx</span></span></span><br><span class="line"><span class="string"><span class="function">  - dgamma: (D,)ç»´çš„dL/dgamma</span></span></span><br><span class="line"><span class="string"><span class="function">  - dbeta: (D,)ç»´çš„dL/dbeta</span></span></span><br><span class="line"><span class="string"><span class="function">  &quot;</span><span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="function">    x, gamma, beta, x_hat, sample_mean, sample_var, eps =</span> cache</span><br><span class="line">  N = x.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  dgamma = np.<span class="built_in">sum</span>(dout * x_hat, axis = <span class="number">0</span>)</span><br><span class="line">  dbeta = np.<span class="built_in">sum</span>(dout, axis = <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  dx_hat = dout * gamma</span><br><span class="line">  dsigma = <span class="number">-0.5</span> * np.<span class="built_in">sum</span>(dx_hat * (x - sample_mean), axis=<span class="number">0</span>) * np.<span class="built_in">power</span>(sample_var + eps, <span class="number">-1.5</span>)</span><br><span class="line">  dmu = -np.<span class="built_in">sum</span>(dx_hat / np.<span class="built_in">sqrt</span>(sample_var + eps), axis=<span class="number">0</span>) - <span class="number">2</span> * dsigma*np.<span class="built_in">sum</span>(x-sample_mean, axis=<span class="number">0</span>)/ N</span><br><span class="line">  dx = dx_hat /np.<span class="built_in">sqrt</span>(sample_var + eps) + <span class="number">2.0</span> * dsigma * (x - sample_mean) / N + dmu / N</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dx, dgamma, dbeta</span><br></pre></td></tr></table></figure>
<h2 id="DarkNetä»£ç è¯¦è§£"><a href="#DarkNetä»£ç è¯¦è§£" class="headerlink" title="DarkNetä»£ç è¯¦è§£"></a>DarkNetä»£ç è¯¦è§£</h2><h3 id="1-æ„é€ BNå±‚"><a href="#1-æ„é€ BNå±‚" class="headerlink" title="1. æ„é€ BNå±‚"></a>1. æ„é€ BNå±‚</h3><p>æ„é€ BNå±‚çš„ä»£ç åœ¨<code>src/batchnorm_layer.c</code>ä¸­å®ç°ï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">layer <span class="title">make_batchnorm_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> c, <span class="keyword">int</span> train)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Batch Normalization Layer: %d x %d x %d image\n&quot;</span>, w,h,c);</span><br><span class="line">    layer layer = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    layer.type = BATCHNORM; <span class="comment">// ç½‘ç»œå±‚çš„åå­—</span></span><br><span class="line">    layer.batch = batch; <span class="comment">//ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡æ•°</span></span><br><span class="line">    layer.train = train;</span><br><span class="line">    layer.h = layer.out_h = h;  <span class="comment">// å½“å‰å±‚çš„è¾“å‡ºé«˜åº¦ç­‰äºè¾“å…¥é«˜åº¦h</span></span><br><span class="line">    layer.w = layer.out_w = w; <span class="comment">// å½“å‰å±‚çš„è¾“å‡ºå®½åº¦ç­‰äºè¾“å…¥å®½åº¦w</span></span><br><span class="line">    layer.c = layer.out_c = c; <span class="comment">// å½“å‰å±‚çš„è¾“å‡ºé€šé“æ•°ç­‰äºè¾“å…¥é€šé“æ•°</span></span><br><span class="line"></span><br><span class="line">    layer.n = layer.c;</span><br><span class="line">    layer.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(h * w * c * batch, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// layer.outputä¸ºè¯¥å±‚æ‰€æœ‰çš„è¾“å‡ºï¼ˆåŒ…æ‹¬mini-batchæ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼‰</span></span><br><span class="line">    layer.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(h * w * c * batch, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">//layer.delta æ˜¯è¯¥å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå’Œè¾“å‡ºçš„ç»´åº¦æƒ³åŒ</span></span><br><span class="line">    layer.inputs = w*h*c; <span class="comment">//mini-batchä¸­æ¯å¼ è¾“å…¥å›¾ç‰‡çš„åƒç´ å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    layer.outputs = layer.inputs; <span class="comment">// å¯¹åº”æ¯å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆæ¯å¼ è¾“å…¥å›¾ç‰‡ä¼šå¾—åˆ°nä¹Ÿå³layer.out_cå¼ ç‰¹å¾å›¾ï¼‰</span></span><br><span class="line"></span><br><span class="line">    layer.biases = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// BNå±‚ç‰¹æœ‰å‚æ•°ï¼Œç¼©æ”¾ç³»æ•°</span></span><br><span class="line">    layer.bias_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// ç¼©æ”¾ç³»æ•°çš„æ•æ„Ÿåº¦å›¾</span></span><br><span class="line"></span><br><span class="line">    layer.scales = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// BNå±‚ç‰¹æœ‰å‚æ•°ï¼Œåç½®ç³»æ•°</span></span><br><span class="line">    layer.scale_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// åç½®ç³»æ•°çš„æ•æ„Ÿåº¦å›¾</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; c; ++i)&#123;</span><br><span class="line">        layer.scales[i] = <span class="number">1</span>; <span class="comment">// å°†ç¼©æ”¾ç³»æ•°åˆå§‹åŒ–ä¸º1</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    layer.mean = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// mean ä¸€ä¸ªbatchä¸­æ‰€æœ‰å›¾ç‰‡çš„å‡å€¼ï¼Œåˆ†é€šé“æ±‚å–</span></span><br><span class="line">    layer.variance = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));  <span class="comment">// variance ä¸€ä¸ªbatchä¸­æ‰€æœ‰å›¾ç‰‡çš„æ–¹å·®ï¼Œåˆ†é€šé“æ±‚å–</span></span><br><span class="line"></span><br><span class="line">    layer.rolling_mean = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// å‡å€¼çš„æ»‘åŠ¨å¹³å‡ï¼Œå½±å­å˜é‡</span></span><br><span class="line">    layer.rolling_variance = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(c, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// æ–¹å·®çš„æ»‘åŠ¨å¹³å‡ï¼Œå½±å­å˜é‡</span></span><br><span class="line"></span><br><span class="line">    layer.forward = forward_batchnorm_layer; <span class="comment">// å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line">    layer.backward = backward_batchnorm_layer; <span class="comment">// åå‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line">    layer.update = update_batchnorm_layer;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> layer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-å‰å‘ä¼ æ’­å…¬å¼å®ç°"><a href="#2-å‰å‘ä¼ æ’­å…¬å¼å®ç°" class="headerlink" title="2.å‰å‘ä¼ æ’­å…¬å¼å®ç°"></a>2.å‰å‘ä¼ æ’­å…¬å¼å®ç°</h3><p>DarkNetä¸­åœ¨<code>src/blas.h</code>ä¸­å®ç°äº†å‰å‘ä¼ æ’­çš„å‡ ä¸ªå…¬å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** è®¡ç®—è¾“å…¥æ•°æ®xçš„å¹³å‡å€¼ï¼Œè¾“å‡ºçš„meanæ˜¯ä¸€ä¸ªçŸ¢é‡ï¼Œæ¯”å¦‚å¦‚æœxæ˜¯å¤šå¼ ä¸‰é€šé“çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆmeançš„ç»´åº¦å°±ä¸ºé€šé“3</span></span><br><span class="line"><span class="comment">** ç”±äºæ¯æ¬¡è®­ç»ƒè¾“å…¥çš„éƒ½æ˜¯ä¸€ä¸ªbatchçš„å›¾ç‰‡ï¼Œå› æ­¤æœ€ç»ˆä¼šè¾“å‡ºbatchå¼ ä¸‰é€šé“çš„å›¾ç‰‡ï¼Œmeanä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯ç¬¬</span></span><br><span class="line"><span class="comment">** ä¸€ä¸ªé€šé“ä¸Šå…¨éƒ¨batchå¼ è¾“å‡ºç‰¹å¾å›¾æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ï¼Œæœ¬å‡½æ•°çš„ç”¨å¤„ä¹‹ä¸€å°±æ˜¯batch normalizationçš„ç¬¬ä¸€æ­¥äº†</span></span><br><span class="line"><span class="comment">** x: åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œæ¯”å¦‚l.outputï¼Œå…¶åŒ…å«çš„å…ƒç´ ä¸ªæ•°ä¸ºl.batch*l.outputs</span></span><br><span class="line"><span class="comment">** batch: ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡å¼ æ•°ï¼Œå³l.batch</span></span><br><span class="line"><span class="comment">** filters: è¯¥å±‚ç¥ç»ç½‘ç»œçš„æ»¤æ³¢å™¨ä¸ªæ•°ï¼Œä¹Ÿå³è¯¥å±‚ç½‘ç»œè¾“å‡ºå›¾ç‰‡çš„é€šé“æ•°ï¼ˆæ¯”å¦‚å¯¹å·ç§¯ç½‘ç»œæ¥è¯´ï¼Œå°±æ˜¯æ ¸çš„ä¸ªæ•°äº†ï¼‰</span></span><br><span class="line"><span class="comment">** spatial: è¯¥å±‚ç¥ç»ç½‘ç»œæ¯å¼ è¾“å‡ºç‰¹å¾å›¾çš„å°ºå¯¸ï¼Œä¹Ÿå³ç­‰äºl.out_w*l.out_h</span></span><br><span class="line"><span class="comment">** mean: æ±‚å¾—çš„å¹³å‡å€¼ï¼Œç»´åº¦ä¸ºfiltersï¼Œä¹Ÿå³æ¯ä¸ªæ»¤æ³¢å™¨å¯¹åº”æœ‰ä¸€ä¸ªå‡å€¼ï¼ˆæ¯ä¸ªæ»¤æ³¢å™¨ä¼šå¤„ç†æ‰€æœ‰å›¾ç‰‡ï¼‰</span></span><br><span class="line"><span class="comment">** xçš„å†…å­˜æ’å¸ƒï¼Ÿæ­¤å¤„è¿˜æ˜¯ç»“åˆbatchnorm_layer.cä¸­çš„forward_batch_norm_layer()å‡½æ•°çš„è°ƒç”¨æ¥è§£é‡Šï¼Œå…¶ä¸­xä¸ºl.outputï¼Œå…¶åŒ…å«çš„å…ƒç´ ä¸ªæ•°ä¸ºl</span></span><br><span class="line"><span class="comment">** æœ‰l.batchè¡Œï¼Œæ¯è¡Œæœ‰l.out_c*l.out_w*l.out_hä¸ªå…ƒç´ ï¼Œæ¯ä¸€è¡Œåˆå¯ä»¥åˆ†æˆl.out_cè¡Œï¼Œl.out_w*l.out_håˆ—ï¼Œ</span></span><br><span class="line"><span class="comment">** é‚£ä¹ˆl.meanä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯æŸä¸€ä¸ªé€šé“ä¸Šæ‰€æœ‰batchçš„è¾“å‡ºçš„å¹³å‡å€¼</span></span><br><span class="line"><span class="comment">** ï¼ˆæ¯”å¦‚å·ç§¯å±‚ï¼Œæœ‰3ä¸ªæ ¸ï¼Œé‚£ä¹ˆè¾“å‡ºé€šé“æœ‰3ä¸ªï¼Œæ¯å¼ è¾“å…¥å›¾ç‰‡éƒ½ä¼šè¾“å‡º3å¼ ç‰¹å¾å›¾ï¼Œå¯ä»¥ç†è§£æ¯å¼ è¾“å‡ºå›¾ç‰‡æ˜¯3é€šé“çš„ï¼Œ</span></span><br><span class="line"><span class="comment">** è‹¥æ¯æ¬¡è¾“å…¥batch=64å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆå°†ä¼šè¾“å‡º64å¼ 3é€šé“çš„å›¾ç‰‡ï¼Œè€Œmeanä¸­çš„æ¯ä¸ªå…ƒç´ å°±æ˜¯æŸä¸ªé€šé“ä¸Šæ‰€æœ‰64å¼ å›¾ç‰‡</span></span><br><span class="line"><span class="comment">** æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ï¼Œæ¯”å¦‚ç¬¬1ä¸ªé€šé“ä¸Šï¼Œæ‰€æœ‰64å¼ å›¾ç‰‡åƒç´ å¹³å‡å€¼ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mean_cpu</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial, <span class="keyword">float</span> *mean)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// scaleå³æ˜¯å‡å€¼ä¸­çš„åˆ†æ¯é¡¹</span></span><br><span class="line">    <span class="keyword">float</span> scale = <span class="number">1.</span>/(batch * spatial);</span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    <span class="comment">// å¤–å¾ªç¯æ¬¡æ•°ä¸ºfiltersï¼Œä¹Ÿå³meançš„ç»´åº¦ï¼Œæ¯æ¬¡å¾ªç¯å°†å¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; filters; ++i)&#123;</span><br><span class="line">        mean[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ä¸­é—´å¾ªç¯æ¬¡æ•°ä¸ºbatchï¼Œä¹Ÿå³å åŠ æ¯å¼ è¾“å…¥å›¾ç‰‡å¯¹åº”çš„æŸä¸€é€šé“ä¸Šçš„è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; batch; ++j)&#123;</span><br><span class="line">            <span class="comment">// å†…å±‚å¾ªç¯å³å åŠ ä¸€å¼ è¾“å‡ºç‰¹å¾å›¾çš„æ‰€æœ‰åƒç´ å€¼</span></span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; spatial; ++k)&#123;</span><br><span class="line">                <span class="comment">// è®¡ç®—åç§»</span></span><br><span class="line">                <span class="keyword">int</span> index = j*filters*spatial + i*spatial + k;</span><br><span class="line">                mean[i] += x[index];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mean[i] *= scale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** è®¡ç®—è¾“å…¥xä¸­æ¯ä¸ªå…ƒç´ çš„æ–¹å·®</span></span><br><span class="line"><span class="comment">** æœ¬å‡½æ•°çš„ä¸»è¦ç”¨å¤„åº”è¯¥å°±æ˜¯batch normalizationçš„ç¬¬äºŒæ­¥äº†</span></span><br><span class="line"><span class="comment">** x: åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œæ¯”å¦‚l.outputï¼Œå…¶åŒ…å«çš„å…ƒç´ ä¸ªæ•°ä¸ºl.batch*l.outputs</span></span><br><span class="line"><span class="comment">** batch: ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡å¼ æ•°ï¼Œå³l.batch</span></span><br><span class="line"><span class="comment">** filters: è¯¥å±‚ç¥ç»ç½‘ç»œçš„æ»¤æ³¢å™¨ä¸ªæ•°ï¼Œä¹Ÿå³æ˜¯è¯¥ç½‘ç»œå±‚è¾“å‡ºå›¾ç‰‡çš„é€šé“æ•°</span></span><br><span class="line"><span class="comment">** spatial: è¯¥å±‚ç¥ç»ç½‘ç»œæ¯å¼ ç‰¹å¾å›¾çš„å°ºå¯¸ï¼Œä¹Ÿå³ç­‰äºl.out_w*l.out_h</span></span><br><span class="line"><span class="comment">** mean: æ±‚å¾—çš„å¹³å‡å€¼ï¼Œç»´åº¦ä¸ºfiltersï¼Œä¹Ÿå³æ¯ä¸ªæ»¤æ³¢å™¨å¯¹åº”æœ‰ä¸€ä¸ªå‡å€¼ï¼ˆæ¯ä¸ªæ»¤æ³¢å™¨ä¼šå¤„ç†æ‰€æœ‰å›¾ç‰‡ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">variance_cpu</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *mean, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial, <span class="keyword">float</span> *variance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè®¡ç®—æ–¹å·®åˆ†æ¯è¦å‡å»1çš„åŸå› æ˜¯æ— åä¼°è®¡ï¼Œå¯ä»¥çœ‹ï¼šhttps://www.zhihu.com/question/20983193</span></span><br><span class="line">    <span class="comment">// äº‹å®ä¸Šï¼Œåœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œå¾€å¾€é‡‡ç”¨çš„æ–¹å·®è®¡ç®—å…¬å¼éƒ½ä¼šè®©åˆ†æ¯å‡1,è¿™æ—¶å› ä¸ºæ‰€æœ‰æ•°æ®çš„æ–¹å·®æ˜¯åŸºäºå‡å€¼è¿™ä¸ªå›ºå®šç‚¹æ¥è®¡ç®—çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯¹äºæœ‰nä¸ªæ•°æ®çš„æ ·æœ¬ï¼Œåœ¨å‡å€¼å›ºå®šçš„æƒ…å†µä¸‹ï¼Œå…¶é‡‡æ ·è‡ªç”±åº¦ä¸ºn-1ï¼ˆåªè¦n-1ä¸ªæ•°æ®å›ºå®šï¼Œç¬¬nä¸ªå¯ä»¥ç”±å‡å€¼æ¨å‡ºï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> scale = <span class="number">1.</span>/(batch * spatial - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; filters; ++i)&#123;</span><br><span class="line">        variance[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; batch; ++j)&#123;</span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; spatial; ++k)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = j*filters*spatial + i*spatial + k;</span><br><span class="line">                <span class="comment">// æ¯ä¸ªå…ƒç´ å‡å»å‡å€¼æ±‚å¹³æ–¹</span></span><br><span class="line">                variance[i] += <span class="built_in">pow</span>((x[index] - mean[i]), <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        variance[i] *= scale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">normalize_cpu</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *mean, <span class="keyword">float</span> *variance, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b, f, i;</span><br><span class="line">    <span class="keyword">for</span>(b = <span class="number">0</span>; b &lt; batch; ++b)&#123;</span><br><span class="line">        <span class="keyword">for</span>(f = <span class="number">0</span>; f &lt; filters; ++f)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; spatial; ++i)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = b*filters*spatial + f*spatial + i;</span><br><span class="line">                x[index] = (x[index] - mean[f])/(<span class="built_in">sqrt</span>(variance[f]) + <span class="number">.000001</span>f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** axpy æ˜¯çº¿æ€§ä»£æ•°ä¸­çš„ä¸€ç§åŸºæœ¬æ“ä½œ(ä»¿å°„å˜æ¢)å®Œæˆy= alpha*x + yæ“ä½œï¼Œå…¶ä¸­x,yä¸ºçŸ¢é‡ï¼Œalphaä¸ºå®æ•°ç³»æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">** è¯·çœ‹: https://www.jianshu.com/p/e3f386771c51</span></span><br><span class="line"><span class="comment">** N: Xä¸­åŒ…å«çš„æœ‰æ•ˆå…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">** ALPHA: ç³»æ•°alpha</span></span><br><span class="line"><span class="comment">** X: å‚ä¸è¿ç®—çš„çŸ¢é‡X</span></span><br><span class="line"><span class="comment">** INCX: æ­¥é•¿(å€æ•°æ­¥é•¿)ï¼Œå³xä¸­å‡¡æ˜¯INCXå€æ•°ç¼–å·çš„å‚ä¸è¿ç®—</span></span><br><span class="line"><span class="comment">** Y: å‚ä¸è¿ç®—çš„çŸ¢é‡ï¼Œä¹Ÿç›¸å½“äºæ˜¯è¾“å‡º</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">axpy_cpu</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">float</span> ALPHA, <span class="keyword">float</span> *X, <span class="keyword">int</span> INCX, <span class="keyword">float</span> *Y, <span class="keyword">int</span> INCY)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; N; ++i) Y[i*INCY] += ALPHA*X[i*INCX];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scal_cpu</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">float</span> ALPHA, <span class="keyword">float</span> *X, <span class="keyword">int</span> INCX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; N; ++i) X[i*INCX] *= ALPHA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æ¥å£å‡½æ•°"><a href="#3-å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æ¥å£å‡½æ•°" class="headerlink" title="3. å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æ¥å£å‡½æ•°"></a>3. å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æ¥å£å‡½æ•°</h3><p>DarkNetåœ¨<code>src/batchnorm_layer.c</code>ä¸­å®ç°äº†å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„æ¥å£å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BNå±‚çš„å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_batchnorm_layer</span><span class="params">(layer l, network net)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l.type == BATCHNORM) <span class="built_in">copy_cpu</span>(l.outputs*l.batch, net.input, <span class="number">1</span>, l.output, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy_cpu</span>(l.outputs*l.batch, l.output, <span class="number">1</span>, l.x, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// è®­ç»ƒé˜¶æ®µ</span></span><br><span class="line">    <span class="keyword">if</span>(net.train)&#123;</span><br><span class="line">        <span class="comment">// blas.cä¸­æœ‰è¯¦ç»†æ³¨é‡Šï¼Œè®¡ç®—è¾“å…¥æ•°æ®çš„å‡å€¼ï¼Œä¿å­˜ä¸ºl.mean</span></span><br><span class="line">        <span class="built_in">mean_cpu</span>(l.output, l.batch, l.out_c, l.out_h*l.out_w, l.mean);</span><br><span class="line">        <span class="comment">// blas.cä¸­æœ‰è¯¦ç»†æ³¨é‡Šï¼Œè®¡ç®—è¾“å…¥æ•°æ®çš„æ–¹å·®ï¼Œä¿å­˜ä¸ºl.variance</span></span><br><span class="line">        <span class="built_in">variance_cpu</span>(l.output, l.mean, l.batch, l.out_c, l.out_h*l.out_w, l.variance);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—æ»‘åŠ¨å¹³å‡å’Œæ–¹å·®ï¼Œå½±å­å˜é‡ï¼Œå¯ä»¥å‚è€ƒhttps://blog.csdn.net/just_sort/article/details/100039418</span></span><br><span class="line">        <span class="built_in">scal_cpu</span>(l.out_c, <span class="number">.99</span>, l.rolling_mean, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">axpy_cpu</span>(l.out_c, <span class="number">.01</span>, l.mean, <span class="number">1</span>, l.rolling_mean, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scal_cpu</span>(l.out_c, <span class="number">.99</span>, l.rolling_variance, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">axpy_cpu</span>(l.out_c, <span class="number">.01</span>, l.variance, <span class="number">1</span>, l.rolling_variance, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å‡å»å‡å€¼ï¼Œé™¤ä»¥æ–¹å·®å¾—åˆ°x^ï¼Œè®ºæ–‡ä¸­çš„ç¬¬3ä¸ªå…¬å¼</span></span><br><span class="line">        <span class="built_in">normalize_cpu</span>(l.output, l.mean, l.variance, l.batch, l.out_c, l.out_h*l.out_w);</span><br><span class="line">        <span class="comment">// BNå±‚çš„è¾“å‡º</span></span><br><span class="line">        <span class="built_in">copy_cpu</span>(l.outputs*l.batch, l.output, <span class="number">1</span>, l.x_norm, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æµ‹è¯•é˜¶æ®µï¼Œç›´æ¥ç”¨æ»‘åŠ¨å˜é‡æ¥è®¡ç®—è¾“å‡º</span></span><br><span class="line">        <span class="built_in">normalize_cpu</span>(l.output, l.rolling_mean, l.rolling_variance, l.batch, l.out_c, l.out_h*l.out_w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€åä¸€ä¸ªå…¬å¼ï¼Œå¯¹è¾“å‡ºè¿›è¡Œç§»ä½å’Œåç½®</span></span><br><span class="line">    <span class="built_in">scale_bias</span>(l.output, l.scales, l.batch, l.out_c, l.out_h*l.out_w);</span><br><span class="line">    <span class="built_in">add_bias</span>(l.output, l.biases, l.batch, l.out_c, l.out_h*l.out_w);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BNå±‚çš„åå‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_batchnorm_layer</span><span class="params">(layer l, network net)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœåœ¨æµ‹è¯•é˜¶æ®µï¼Œå‡å€¼å’Œæ–¹å·®éƒ½å¯ä»¥ç›´æ¥ç”¨æ»‘åŠ¨å˜é‡æ¥èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span>(!net.train)&#123;</span><br><span class="line">        l.mean = l.rolling_mean;</span><br><span class="line">        l.variance = l.rolling_variance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åœ¨å·ç§¯å±‚ä¸­å®šä¹‰äº†backward_biasï¼Œå¹¶æœ‰è¯¦ç»†æ³¨é‡Š</span></span><br><span class="line">    <span class="built_in">backward_bias</span>(l.bias_updates, l.delta, l.batch, l.out_c, l.out_w*l.out_h);</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯å¯¹è®ºæ–‡ä¸­æœ€åä¸€ä¸ªå…¬å¼çš„ç¼©æ”¾ç³»æ•°æ±‚æ¢¯åº¦æ›´æ–°å€¼</span></span><br><span class="line">    <span class="built_in">backward_scale_cpu</span>(l.x_norm, l.delta, l.batch, l.out_c, l.out_w*l.out_h, l.scale_updates);</span><br><span class="line">    <span class="comment">// ä¹Ÿæ˜¯åœ¨convlution_layer.cä¸­å®šä¹‰çš„å‡½æ•°ï¼Œå…ˆå°†æ•æ„Ÿåº¦å›¾ä¹˜ä»¥l.scales</span></span><br><span class="line">    <span class="built_in">scale_bias</span>(l.delta, l.scales, l.batch, l.out_c, l.out_h*l.out_w);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹åº”äº†https://blog.csdn.net/just_sort/article/details/100039418 ä¸­å¯¹å‡å€¼æ±‚å¯¼æ•°</span></span><br><span class="line">    <span class="built_in">mean_delta_cpu</span>(l.delta, l.variance, l.batch, l.out_c, l.out_w*l.out_h, l.mean_delta);</span><br><span class="line">    <span class="comment">// å¯¹åº”äº†https://blog.csdn.net/just_sort/article/details/100039418 ä¸­å¯¹æ–¹å·®æ±‚å¯¼æ•°</span></span><br><span class="line">    <span class="built_in">variance_delta_cpu</span>(l.x, l.delta, l.mean, l.variance, l.batch, l.out_c, l.out_w*l.out_h, l.variance_delta);</span><br><span class="line">    <span class="comment">// è®¡ç®—æ•æ„Ÿåº¦å›¾ï¼Œå¯¹åº”äº†è®ºæ–‡ä¸­çš„æœ€åä¸€éƒ¨åˆ†</span></span><br><span class="line">    <span class="built_in">normalize_delta_cpu</span>(l.x, l.mean, l.variance, l.mean_delta, l.variance_delta, l.batch, l.out_c, l.out_w*l.out_h, l.delta);</span><br><span class="line">    <span class="keyword">if</span>(l.type == BATCHNORM) <span class="built_in">copy_cpu</span>(l.outputs*l.batch, l.delta, <span class="number">1</span>, net.delta, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-åå‘ä¼ æ’­å‡½æ•°å…¬å¼å®ç°"><a href="#4-åå‘ä¼ æ’­å‡½æ•°å…¬å¼å®ç°" class="headerlink" title="4.åå‘ä¼ æ’­å‡½æ•°å…¬å¼å®ç°"></a>4.åå‘ä¼ æ’­å‡½æ•°å…¬å¼å®ç°</h3><p>å…¶ä¸­åå‘ä¼ æ’­çš„å‡½æ•°å¦‚ä¸‹ï¼Œå°±æ˜¯åˆ©ç”¨æ¨å¯¼å‡ºçš„å…¬å¼æ¥è®¡ç®—ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæ˜¯å¯¹è®ºæ–‡ä¸­æœ€åä¸€ä¸ªå…¬å¼çš„ç¼©æ”¾ç³»æ•°æ±‚æ¢¯åº¦æ›´æ–°å€¼</span></span><br><span class="line"><span class="comment">// x_norm ä»£è¡¨BNå±‚å‰å‘ä¼ æ’­çš„è¾“å‡ºå€¼</span></span><br><span class="line"><span class="comment">// delta ä»£è¡¨ä¸Šä¸€å±‚çš„æ¢¯åº¦å›¾</span></span><br><span class="line"><span class="comment">// batch ä¸ºl.batchï¼Œå³ä¸€ä¸ªbatchçš„å›¾ç‰‡æ•°</span></span><br><span class="line"><span class="comment">// nä»£è¡¨è¾“å‡ºé€šé“æ•°ï¼Œä¹Ÿå³æ˜¯è¾“å…¥é€šé“æ•°</span></span><br><span class="line"><span class="comment">// size ä»£è¡¨w * h</span></span><br><span class="line"><span class="comment">// scale_updates ä»£è¡¨scaleçš„æ¢¯åº¦æ›´æ–°å€¼</span></span><br><span class="line"><span class="comment">// y = gamma * x + beta</span></span><br><span class="line"><span class="comment">// dy / d(gamma) = x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_scale_cpu</span><span class="params">(<span class="keyword">float</span> *x_norm, <span class="keyword">float</span> *delta, <span class="keyword">int</span> batch, <span class="keyword">int</span> n, <span class="keyword">int</span> size, <span class="keyword">float</span> *scale_updates)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,b,f;</span><br><span class="line">    <span class="keyword">for</span>(f = <span class="number">0</span>; f &lt; n; ++f)&#123;</span><br><span class="line">        <span class="keyword">float</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(b = <span class="number">0</span>; b &lt; batch; ++b)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; size; ++i)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = i + size*(f + n*b);</span><br><span class="line">                sum += delta[index] * x_norm[index];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        scale_updates[f] += sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å‡å€¼æ±‚å¯¼</span></span><br><span class="line"><span class="comment">// å¯¹åº”äº†è®ºæ–‡ä¸­çš„æ±‚å¯¼å…¬å¼3ï¼Œä¸è¿‡Darknetç‰¹æ®Šçš„ç‚¹åœ¨äºæ˜¯å…ˆè®¡ç®—å‡å€¼çš„æ¢¯åº¦</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ—¶å€™æ–¹å·®æ˜¯æ²¡æœ‰æ¢¯åº¦çš„ï¼Œæ‰€ä»¥å…¬å¼3çš„ååŠéƒ¨åˆ†ä¸º0ï¼Œä¹Ÿå°±åªä¿ç•™äº†å…¬å¼3çš„å‰åŠéƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// ä¸è¿‡æˆ‘ä»ç†è®ºä¸Šæ— æ³•è§£é‡Šè¿™ç§æ“ä½œä¼šå¸¦æ¥ä»€ä¹ˆå½±å“ï¼Œä½†ä»ç›®æ ‡æ£€æµ‹æ¥çœ‹åº”è¯¥æ˜¯æ²¡æœ‰å½±å“çš„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mean_delta_cpu</span><span class="params">(<span class="keyword">float</span> *delta, <span class="keyword">float</span> *variance, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial, <span class="keyword">float</span> *mean_delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; filters; ++i)&#123;</span><br><span class="line">        mean_delta[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; batch; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; spatial; ++k) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = j*filters*spatial + i*spatial + k;</span><br><span class="line">                mean_delta[i] += delta[index];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mean_delta[i] *= (<span class="number">-1.</span>/<span class="built_in">sqrt</span>(variance[i] + <span class="number">.00001</span>f));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹æ–¹å·®æ±‚å¯¼</span></span><br><span class="line"><span class="comment">// å¯¹åº”äº†è®ºæ–‡ä¸­çš„æ±‚å¯¼å…¬å¼2</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">variance_delta_cpu</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *delta, <span class="keyword">float</span> *mean, <span class="keyword">float</span> *variance, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial, <span class="keyword">float</span> *variance_delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; filters; ++i)&#123;</span><br><span class="line">        variance_delta[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; batch; ++j)&#123;</span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; spatial; ++k)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = j*filters*spatial + i*spatial + k;</span><br><span class="line">                variance_delta[i] += delta[index]*(x[index] - mean[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        variance_delta[i] *= <span class="number">-.5</span> * <span class="built_in">pow</span>(variance[i] + <span class="number">.00001</span>f, (<span class="keyword">float</span>)(<span class="number">-3.</span>/<span class="number">2.</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ±‚å‡ºBNå±‚çš„æ¢¯åº¦æ•æ„Ÿåº¦å›¾</span></span><br><span class="line"><span class="comment">// å¯¹åº”äº†è®ºæ–‡ä¸­çš„æ±‚å¯¼å…¬å¼4ï¼Œå³æ˜¯å¯¹x_iæ±‚å¯¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">normalize_delta_cpu</span><span class="params">(<span class="keyword">float</span> *x, <span class="keyword">float</span> *mean, <span class="keyword">float</span> *variance, <span class="keyword">float</span> *mean_delta, <span class="keyword">float</span> *variance_delta, <span class="keyword">int</span> batch, <span class="keyword">int</span> filters, <span class="keyword">int</span> spatial, <span class="keyword">float</span> *delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f, j, k;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; batch; ++j)&#123;</span><br><span class="line">        <span class="keyword">for</span>(f = <span class="number">0</span>; f &lt; filters; ++f)&#123;</span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; spatial; ++k)&#123;</span><br><span class="line">                <span class="keyword">int</span> index = j*filters*spatial + f*spatial + k;</span><br><span class="line">                delta[index] = delta[index] * <span class="number">1.</span>/(<span class="built_in">sqrt</span>(variance[f] + <span class="number">.00001</span>f)) + variance_delta[f] * <span class="number">2.</span> * (x[index] - mean[f]) / (spatial * batch) + mean_delta[f]/(spatial*batch);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetæ± åŒ–å±‚ä»£ç è¯¦è§£(maxpool_layer.c)</title>
    <url>/2020/02/29/AlexeyAB-DarkNet%E6%B1%A0%E5%8C%96%E5%B1%82%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3(maxpool_layer.c)/</url>
    <content><![CDATA[<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸ºäº†å›¾æ–‡å¹¶èŒ‚çš„è§£é‡Šè¿™ä¸ªå±‚ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥è¯´ä¸€ä¸‹æ± åŒ–å±‚çš„åŸç†ï¼Œæ± åŒ–å±‚åˆ†ä¸ºæœ€å¤§æ± åŒ–ä»¥åŠå¹³å‡æ± åŒ–ã€‚æœ€å¤§æ± åŒ–å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/666.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°æœ€å¤§æ± åŒ–å±‚éœ€è¦è®°å½•æ± åŒ–è¾“å‡ºç‰¹å¾å›¾çš„æ¯ä¸ªå€¼æ˜¯ç”±åŸå§‹ç‰¹å¾å›¾ä¸­å“ªä¸ªå€¼å¾—æ¥çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦é¢å¤–è®°å½•ä¸€ä¸ªæœ€å¤§å€¼åœ¨åŸå›¾çš„ä¸­çš„ç´¢å¼•ã€‚è€Œå¹³å‡æ± åŒ–åªéœ€è¦å°†ä¸Šé¢çš„æ±‚æœ€å¤§å€¼çš„æ“ä½œæ¢æˆæ±‚å¹³å‡çš„æ“ä½œå³å¯ï¼Œå› ä¸ºæ˜¯å¹³å‡æ“ä½œæ‰€ä»¥å°±æ²¡å¿…è¦è®°å½•ç´¢å¼•äº†ã€‚</p>
<h2 id="æ± åŒ–å±‚çš„æ„é€ "><a href="#æ± åŒ–å±‚çš„æ„é€ " class="headerlink" title="æ± åŒ–å±‚çš„æ„é€ "></a>æ± åŒ–å±‚çš„æ„é€ </h2><p>æ± åŒ–å±‚çš„æ„é€ ç”±<code>make_maxpool_layer</code>å‡½æ•°å®ç°ï¼Œè™½ç„¶åå­—æ˜¯æ„é€ <code>maxpool_layer</code>ï¼Œä½†å…¶å®ç°ä¹Ÿè€ƒè™‘äº†å¹³å‡æ± åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡å‚æ•°è®¾ç½®å¯ä»¥å°†æ± åŒ–å±‚å˜æˆå¹³å‡æ± åŒ–ã€‚è¿™ä¸€å‡½æ•°çš„è¯¦ç»†è®²è§£è¯·çœ‹å¦‚ä¸‹ä»£ç ï¼Œä¸ºäº†ç¾è§‚ï¼Œæˆ‘å»æ‰äº†ä¸€äº›æ— å…³ä»£ç ï¼Œå®Œæ•´ä»£ç è¯·åˆ°githubæŸ¥çœ‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** æ„å»ºæœ€å¤§/å¹³å‡æ± åŒ–å±‚</span></span><br><span class="line"><span class="comment">** batch: è¯¥å±‚è¾“å…¥ä¸­ä¸€ä¸ªbatchæ‰€å«æœ‰çš„å›¾ç‰‡å¼ æ•°ï¼Œç­‰äºnet.batch</span></span><br><span class="line"><span class="comment">** h,w,c: è¯¥å±‚è¾“å…¥å›¾ç‰‡çš„é«˜åº¦ï¼Œå®½åº¦ä¸é€šé“æ•°</span></span><br><span class="line"><span class="comment">** size: æ± åŒ–æ ¸çš„å¤§å°</span></span><br><span class="line"><span class="comment">** stride: æ»‘åŠ¨æ­¥é•¿</span></span><br><span class="line"><span class="comment">** padding: å››å‘¨è¡¥0é•¿åº¦</span></span><br><span class="line"><span class="comment">è¿”å›: æœ€å¤§/å¹³å‡æ± åŒ–å±‚l</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">maxpool_layer <span class="title">make_maxpool_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> h, <span class="keyword">int</span> w, <span class="keyword">int</span> c, <span class="keyword">int</span> size, <span class="keyword">int</span> stride_x, <span class="keyword">int</span> stride_y, <span class="keyword">int</span> padding, <span class="keyword">int</span> maxpool_depth, <span class="keyword">int</span> out_channels, <span class="keyword">int</span> antialiasing, <span class="keyword">int</span> avgpool, <span class="keyword">int</span> train)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    maxpool_layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">	<span class="comment">//å±‚ç±»åˆ«</span></span><br><span class="line">    l.avgpool = avgpool;</span><br><span class="line">    <span class="keyword">if</span> (avgpool) l.type = LOCAL_AVGPOOL;</span><br><span class="line">    <span class="keyword">else</span> l.type = MAXPOOL;</span><br><span class="line">    l.train = train;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> blur_stride_x = stride_x;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> blur_stride_y = stride_y;</span><br><span class="line">    l.antialiasing = antialiasing;</span><br><span class="line">    <span class="keyword">if</span> (antialiasing) &#123;</span><br><span class="line">        stride_x = stride_y = l.stride = l.stride_x = l.stride_y = <span class="number">1</span>; <span class="comment">// use stride=1 in host-layer</span></span><br><span class="line">    &#125;</span><br><span class="line">    l.batch = batch;<span class="comment">//ä¸€ä¸ªbatchä¸­åŒ…å«çš„å›¾ç‰‡æ•°</span></span><br><span class="line">    l.h = h; <span class="comment">//è¾“å…¥å›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line">    l.w = w; <span class="comment">//è¾“å…¥å›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">    l.c = c; <span class="comment">//è¾“å…¥å›¾ç‰‡çš„é€šé“æ•°</span></span><br><span class="line">    l.pad = padding; <span class="comment">// è¡¥0çš„ä¸ªæ•°</span></span><br><span class="line">    l.maxpool_depth = maxpool_depth; <span class="comment">//æ± åŒ–å±‚æ¯éš”l.maxpool_depthæ‰§è¡Œä¸€æ¬¡poolæ“ä½œ</span></span><br><span class="line">    l.out_channels = out_channels; <span class="comment">//è¾“å‡ºå›¾ç‰‡çš„é€šé“æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (maxpool_depth) &#123;</span><br><span class="line">        l.out_c = out_channels;</span><br><span class="line">        l.out_w = l.w;</span><br><span class="line">        l.out_h = l.h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        l.out_w = (w + padding - size) / stride_x + <span class="number">1</span>; <span class="comment">//è¾“å‡ºå›¾ç‰‡çš„å®½åº¦</span></span><br><span class="line">        l.out_h = (h + padding - size) / stride_y + <span class="number">1</span>; <span class="comment">//è¾“å‡ºå›¾ç‰‡çš„é«˜åº¦</span></span><br><span class="line">        l.out_c = c; <span class="comment">//è¾“å‡ºå›¾ç‰‡çš„é€šé“æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">    l.outputs = l.out_h * l.out_w * l.out_c; <span class="comment">//æ± åŒ–åŒ–å±‚å¯¹åº”ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    l.inputs = h*w*c; <span class="comment">//æ± åŒ–å±‚</span></span><br><span class="line">    l.size = size; <span class="comment">//æ± åŒ–å±‚æ± åŒ–çª—å£å¤§å°</span></span><br><span class="line">    l.stride = stride_x; <span class="comment">//æ± åŒ–å±‚æ­¥å¹…</span></span><br><span class="line">    l.stride_x = stride_x; <span class="comment">//åœ¨xæ–¹å‘ä¸Šçš„æ± åŒ–å±‚æ­¥å¹…</span></span><br><span class="line">    l.stride_y = stride_y; <span class="comment">//åœ¨yæ–¹å‘ä¸Šçš„æ± åŒ–å±‚æ­¥å¹…</span></span><br><span class="line">    <span class="keyword">int</span> output_size = l.out_h * l.out_w * l.out_c * batch; <span class="comment">// æ± åŒ–å±‚æ‰€æœ‰è¾“å‡ºçš„å…ƒç´ ä¸ªæ•°ï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (train) &#123;</span><br><span class="line">		<span class="comment">// è®­ç»ƒçš„æ—¶å€™ï¼Œç”¨äºä¿å­˜æ¯ä¸ªæœ€å¤§æ± åŒ–çª—å£å†…çš„æœ€å¤§å€¼å¯¹åº”çš„ç´¢å¼•ï¼Œæ–¹ä¾¿ä¹‹åçš„åå‘ä¼ æ’­</span></span><br><span class="line">		<span class="comment">// å¦‚æœæ˜¯å¹³å‡æ± åŒ–å±‚å°±ä¸ç”¨äº†</span></span><br><span class="line">        <span class="keyword">if</span> (!avgpool) l.indexes = (<span class="keyword">int</span>*)<span class="built_in">xcalloc</span>(output_size, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br><span class="line">		<span class="comment">//æ± åŒ–å±‚çš„è¯¯å·®é¡¹</span></span><br><span class="line">        l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(output_size, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//æ± åŒ–å±‚çš„æ‰€æœ‰è¾“å‡º(åŒ…å«æ•´ä¸ªbatchçš„)</span></span><br><span class="line">    l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(output_size, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">if</span> (avgpool) &#123;</span><br><span class="line">		<span class="comment">//å¹³å‡æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­</span></span><br><span class="line">        l.forward = forward_local_avgpool_layer;</span><br><span class="line">        l.backward = backward_local_avgpool_layer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//æœ€å¤§æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­</span></span><br><span class="line">        l.forward = forward_maxpool_layer;</span><br><span class="line">        l.backward = backward_maxpool_layer;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// GPUä¸Šå’ŒCPUä¸Šçš„æ“ä½œç±»ä¼¼</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="keyword">if</span> (avgpool) &#123;</span><br><span class="line">        l.forward_gpu = forward_local_avgpool_layer_gpu;</span><br><span class="line">        l.backward_gpu = backward_local_avgpool_layer_gpu;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        l.forward_gpu = forward_maxpool_layer_gpu;</span><br><span class="line">        l.backward_gpu = backward_maxpool_layer_gpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (train) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!avgpool) l.indexes_gpu = <span class="built_in">cuda_make_int_array</span>(output_size);</span><br><span class="line">        l.delta_gpu = <span class="built_in">cuda_make_array</span>(l.delta, output_size);</span><br><span class="line">    &#125;</span><br><span class="line">    l.output_gpu  = <span class="built_in">cuda_make_array</span>(l.output, output_size);</span><br><span class="line">    <span class="built_in">create_maxpool_cudnn_tensors</span>(&amp;l);</span><br><span class="line">    <span class="keyword">if</span> (avgpool) <span class="built_in">cudnn_local_avgpool_setup</span>(&amp;l);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cudnn_maxpool_setup</span>(&amp;l);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// GPU</span></span></span><br><span class="line">    <span class="comment">//è®¡ç®—æ± åŒ–å±‚çš„å‚æ•°é‡ï¼Œä»¥BFLOPsä¸ºå•ä½ï¼Œè¿™æ˜¯AlexeyAB DarkNetæ–°å¢çš„</span></span><br><span class="line">	l.bflops = (l.size*l.size*l.c * l.out_h*l.out_w) / <span class="number">1000000000.</span>;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ€å¤§æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­"><a href="#æœ€å¤§æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­" class="headerlink" title="æœ€å¤§æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­"></a>æœ€å¤§æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­</h2><p>AlexeyAB DarkNetçš„æ± åŒ–å±‚å’ŒåŸå§‹çš„DarkNetçš„æ± åŒ–å±‚æœ€å¤§çš„ä¸åŒåœ¨äºæ–°å¢äº†ä¸€ä¸ª<code>l.maxpool_depth</code>å‚æ•°ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸ä¸º0ï¼Œé‚£ä¹ˆæ± åŒ–å±‚éœ€è¦æ¯éš”<code>l.out_channels</code>ä¸ªç‰¹å¾å›¾æ‰§è¡Œæœ€å¤§æ± åŒ–ï¼Œæ³¨æ„è¿™ä¸ªå‚æ•°åªå¯¹æœ€å¤§æ± åŒ–æœ‰æ•ˆã€‚æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å‡½æ•°ä¸º<code>forward_maxpool_layer</code>ï¼Œè¯¦ç»†è§£é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment">** l: å½“å‰å±‚(æœ€å¤§æ± åŒ–å±‚/å¹³å‡æ± åŒ–å±‚)</span></span><br><span class="line"><span class="comment">** net: æ•´ä¸ªç½‘ç»œç»“æ„</span></span><br><span class="line"><span class="comment">** æœ€å¤§æ± åŒ–å±‚å¤„ç†å›¾åƒçš„æ–¹å¼ä¸å·ç§¯å±‚ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†æœ€å¤§æ± åŒ–æ ¸åœ¨å›¾åƒ</span></span><br><span class="line"><span class="comment">** å¹³é¢ä¸ŠæŒ‰ç…§æŒ‡å®šçš„è·¨åº¦ç§»åŠ¨ï¼Œå¹¶å–å¯¹åº”æ± åŒ–æ ¸åŒºåŸŸä¸­æœ€å¤§å…ƒç´ å€¼ä¸ºå¯¹åº”è¾“å‡ºå…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">** æœ€å¤§æ± åŒ–å±‚æ²¡æœ‰è®­ç»ƒå‚æ•°ï¼ˆæ²¡æœ‰æƒé‡ä»¥åŠåç½®ï¼‰ï¼Œå› æ­¤ï¼Œç›¸å¯¹ä¸å·ç§¯æ¥è¯´ï¼Œ</span></span><br><span class="line"><span class="comment">** å…¶å‰å‘ï¼ˆä»¥åŠä¸‹é¢çš„åå‘ï¼‰è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå®ç°ä¸Šä¹Ÿæ˜¯éå¸¸ç›´æ¥ï¼Œä¸éœ€è¦ä»€ä¹ˆæŠ€å·§ã€‚</span></span><br><span class="line"><span class="comment">** ä½†éœ€è¦æ³¨æ„AlexeyAB DarkNetåœ¨åŸå§‹çš„ä»£ç ä¸Šæ”¹åŠ¨æ¯”è¾ƒå¤šï¼Œå…·ä½“æ³¨é‡Šå¦‚ä¸‹ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_maxpool_layer</span><span class="params">(<span class="keyword">const</span> maxpool_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//å¦‚æœl.maxpool_depthå‚æ•°ç”Ÿæ•ˆï¼Œæ‰§è¡Œä¸‹é¢çš„å‰å‘ä¼ æ’­è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (l.maxpool_depth)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> b, i, j, k, g;</span><br><span class="line">		<span class="comment">// éå†batchä¸­æ¯ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼Œè®¡ç®—å¾—åˆ°ä¸æ¯ä¸€å¼ è¾“å…¥å›¾ç‰‡å…·æœ‰l.maxpool_depthä¸ªé€šé“çš„è¾“å‡ºå›¾</span></span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">			<span class="comment">//openmpä¼˜åŒ–</span></span><br><span class="line">			<span class="comment">//å¤–å±‚å¾ªç¯éå†ç‰¹å¾å›¾çš„é•¿</span></span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.h; ++i) &#123;</span><br><span class="line">				<span class="comment">//ä¸­å±‚å¾ªç¯éå†ç‰¹å¾å›¾çš„å®½</span></span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.w; ++j) &#123;</span><br><span class="line">					<span class="comment">//å†…å±‚å¾ªç¯éå†ç‰¹å¾å›¾çš„è¾“å‡ºé€šé“</span></span><br><span class="line">                    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; l.out_c; ++g)</span><br><span class="line">                    &#123;</span><br><span class="line">						<span class="comment">//out_indexä¸ºè¾“å‡ºå›¾ä¸­çš„ç´¢å¼•</span></span><br><span class="line">                        <span class="keyword">int</span> out_index = j + l.w*(i + l.h*(g + l.out_c*b));</span><br><span class="line">                        <span class="keyword">float</span> max = -FLT_MAX;</span><br><span class="line">                        <span class="keyword">int</span> max_i = <span class="number">-1</span>;</span><br><span class="line">						<span class="comment">//å¦‚ä¸Šæ‰€è¿°ï¼Œæ¯éš”l.out_cä¸ªé€šé“æ‰§è¡Œä¸€æ¬¡æœ€å¤§æ± åŒ–æ“ä½œ</span></span><br><span class="line">                        <span class="keyword">for</span> (k = g; k &lt; l.c; k += l.out_c)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">int</span> in_index = j + l.w*(i + l.h*(k + l.c*b));</span><br><span class="line">                            <span class="keyword">float</span> val = state.input[in_index];</span><br><span class="line">                            <span class="comment">//è®°å½•æœ€å¤§æ± åŒ–çš„ç´¢å¼•</span></span><br><span class="line">                            max_i = (val &gt; max) ? in_index : max_i;</span><br><span class="line">                            max = (val &gt; max) ? val : max;</span><br><span class="line">                        &#125;</span><br><span class="line">                        l.output[out_index] = max;</span><br><span class="line">                        <span class="keyword">if</span> (l.indexes) l.indexes[out_index] = max_i;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!state.train &amp;&amp; l.stride_x == l.stride_y) &#123;</span><br><span class="line">		<span class="comment">//å‰å‘æ¨ç†å¹¶ä¸”xå’Œyæ–¹å‘çš„æ­¥å¹…ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨avxæŒ‡ä»¤é›†ä¼˜åŒ–Poolå±‚çš„å‰å‘ä¼ æ’­</span></span><br><span class="line">        forward_maxpool_layer_avx(state.input, l.output, l.indexes, l.size, l.w, l.h, l.out_w, l.out_h, l.c, l.pad, l.stride, l.batch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> b, i, j, k, m, n;</span><br><span class="line">		<span class="comment">// åˆå§‹åç§»è®¾å®šä¸ºå››å‘¨è¡¥0é•¿åº¦çš„è´Ÿå€¼</span></span><br><span class="line">        <span class="keyword">int</span> w_offset = -l.pad / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> h_offset = -l.pad / <span class="number">2</span>;</span><br><span class="line">		<span class="comment">// è·å–å½“å‰å±‚çš„è¾“å‡ºå°ºå¯¸</span></span><br><span class="line">        <span class="keyword">int</span> h = l.out_h;</span><br><span class="line">        <span class="keyword">int</span> w = l.out_w;</span><br><span class="line">		<span class="comment">// è·å–å½“å‰å±‚è¾“å…¥å›¾åƒçš„é€šé“æ•°ï¼Œä¸ºä»€ä¹ˆæ˜¯è¾“å…¥é€šé“æ•°ï¼Ÿä¸åº”è¯¥ä¸ºè¾“å‡ºé€šé“æ•°å—ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// å®é™…äºŒè€…æ²¡æœ‰åŒºåˆ«ï¼Œå¯¹äºæœ€å¤§æ± åŒ–å±‚æ¥è¯´ï¼Œè¾“å…¥æœ‰å¤šå°‘é€šé“ï¼Œè¾“å‡ºå°±æœ‰å¤šå°‘é€šé“ï¼</span></span><br><span class="line">		<span class="comment">// æ³¨æ„ä¸Šé¢å¦‚æœmaxpool_depthæœ‰å€¼ï¼Œé‚£ä¹ˆè¾“å‡ºé€šé“æ•°å°±å’Œè¾“å…¥é€šé“æ•°ä¸ä¸€æ ·äº†ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> c = l.c;</span><br><span class="line">		<span class="comment">// éå†batchä¸­æ¯ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼Œè®¡ç®—å¾—åˆ°ä¸æ¯ä¸€å¼ è¾“å…¥å›¾ç‰‡å…·æœ‰ç›¸åŒé€šé“çš„è¾“å‡ºå›¾</span></span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>; b &lt; l.batch; ++b) &#123;</span><br><span class="line">			<span class="comment">// å¯¹äºæ¯å¼ è¾“å…¥å›¾ç‰‡ï¼Œå°†å¾—åˆ°é€šé“æ•°ä¸€æ ·çš„è¾“å‡ºå›¾ï¼Œä»¥è¾“å‡ºå›¾ä¸ºåŸºå‡†ï¼ŒæŒ‰è¾“å‡ºå›¾é€šé“ï¼Œè¡Œï¼Œåˆ—ä¾æ¬¡éå†</span></span><br><span class="line">			<span class="comment">// ï¼ˆè¿™å¯¹åº”å›¾åƒåœ¨l.outputçš„å­˜å‚¨æ–¹å¼ï¼Œæ¯å¼ å›¾ç‰‡æŒ‰è¡Œé“ºæ’æˆä¸€å¤§è¡Œï¼Œç„¶åå›¾ç‰‡ä¸å›¾ç‰‡ä¹‹é—´å†å¹¶æˆä¸€è¡Œï¼‰ã€‚</span></span><br><span class="line">			<span class="comment">// ä»¥è¾“å‡ºå›¾ä¸ºåŸºå‡†è¿›è¡Œéå†ï¼Œæœ€ç»ˆå¾ªç¯çš„æ€»æ¬¡æ•°åˆšå¥½è¦†ç›–æ± åŒ–æ ¸åœ¨è¾“å…¥å›¾ç‰‡ä¸åŒä½ç½®è¿›è¡Œæ± åŒ–æ“ä½œã€‚</span></span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; c; ++k) &#123;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; h; ++i) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; w; ++j) &#123;</span><br><span class="line">						<span class="comment">// out_indexä¸ºè¾“å‡ºå›¾ä¸­çš„ç´¢å¼•ï¼šout_index = b * c * w * h + k * w * h + h * w + wï¼Œå±•å¼€å†™å¯èƒ½æ›´ä¸ºæ¸…æ™°äº›</span></span><br><span class="line">                        <span class="keyword">int</span> out_index = j + w*(i + h*(k + c*b));</span><br><span class="line">                        <span class="keyword">float</span> max = -FLT_MAX;</span><br><span class="line">                        <span class="keyword">int</span> max_i = <span class="number">-1</span>;</span><br><span class="line">						<span class="comment">// ä¸‹é¢ä¸¤ä¸ªå¾ªç¯å›åˆ°äº†è¾“å…¥å›¾ç‰‡ï¼Œè®¡ç®—å¾—åˆ°çš„cur_hä»¥åŠcur_wéƒ½æ˜¯åœ¨å½“å‰å±‚æ‰€æœ‰è¾“å…¥å…ƒç´ çš„ç´¢å¼•ï¼Œå†…å¤–å¾ªç¯çš„ç›®çš„æ˜¯</span></span><br><span class="line">                        <span class="comment">// æ‰¾å¯»è¾“å…¥å›¾åƒä¸­ï¼Œä»¥(h_offset + i*l.stride, w_offset + j*l.stride)ä¸ºå·¦ä¸Šèµ·ç‚¹ï¼Œå°ºå¯¸ä¸ºl.sizeæ± åŒ–åŒºåŸŸä¸­çš„</span></span><br><span class="line">                        <span class="comment">//æœ€å¤§å…ƒç´ å€¼maxåŠå…¶åœ¨æ‰€æœ‰è¾“å…¥å…ƒç´ ä¸­çš„ç´¢å¼•max_i</span></span><br><span class="line">                        <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; l.size; ++n) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (m = <span class="number">0</span>; m &lt; l.size; ++m) &#123;</span><br><span class="line">								<span class="comment">//cur_h, cur_wæ˜¯åœ¨æ‰€æœ‰è¾“å…¥å›¾åƒçš„ç¬¬ké€šé“çš„cur_hè¡Œä¸cur_wåˆ—ï¼Œindexæ˜¯åœ¨æ‰€æœ‰è¾“å…¥å›¾åƒå…ƒç´ ä¸­çš„æ€»ç´¢å¼•</span></span><br><span class="line">                                <span class="keyword">int</span> cur_h = h_offset + i*l.stride_y + n;</span><br><span class="line">                                <span class="keyword">int</span> cur_w = w_offset + j*l.stride_x + m;</span><br><span class="line">                                <span class="keyword">int</span> index = cur_w + l.w*(cur_h + l.h*(k + b*l.c));</span><br><span class="line">								<span class="comment">// è¾¹ç•Œæ£€æŸ¥ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šè¶Šç•Œçš„ï¼Œä½†æ˜¯å¦‚æœæœ‰è¡¥0æ“ä½œï¼Œå°±ä¼šè¶Šç•Œäº†ï¼Œè¿™é‡Œçš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥è®©è¿™äº›å…ƒç´ å€¼ä¸º-FLT_MAX</span></span><br><span class="line">                                <span class="keyword">int</span> valid = (cur_h &gt;= <span class="number">0</span> &amp;&amp; cur_h &lt; l.h &amp;&amp;</span><br><span class="line">                                    cur_w &gt;= <span class="number">0</span> &amp;&amp; cur_w &lt; l.w);</span><br><span class="line">								<span class="comment">// è®°å½•è¿™ä¸ªæ± åŒ–åŒºåŸŸä¸­æœ€å¤§çš„å…ƒç´ åŠå…¶åœ¨æ‰€æœ‰è¾“å…¥å…ƒç´ ä¸­çš„æ€»ç´¢å¼•</span></span><br><span class="line">                                <span class="keyword">float</span> val = (valid != <span class="number">0</span>) ? state.input[index] : -FLT_MAX;</span><br><span class="line">                                max_i = (val &gt; max) ? index : max_i;</span><br><span class="line">                                max = (val &gt; max) ? val : max;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">						<span class="comment">// ç”±æ­¤å¾—åˆ°æœ€å¤§æ± åŒ–å±‚æ¯ä¸€ä¸ªè¾“å‡ºå…ƒç´ å€¼åŠå…¶åœ¨æ‰€æœ‰è¾“å…¥å…ƒç´ ä¸­çš„æ€»ç´¢å¼•ã€‚</span></span><br><span class="line">						<span class="comment">// ä¸ºä»€ä¹ˆéœ€è¦è®°å½•æ¯ä¸ªè¾“å‡ºå…ƒç´ å€¼å¯¹åº”åœ¨è¾“å…¥å…ƒç´ ä¸­çš„æ€»ç´¢å¼•å‘¢ï¼Ÿå› ä¸ºåœ¨ä¸‹é¢çš„åå‘è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°ï¼Œåœ¨è®¡ç®—å½“å‰æœ€å¤§æ± åŒ–å±‚ä¸Šä¸€å±‚ç½‘ç»œçš„æ•æ„Ÿåº¦æ—¶ï¼Œ</span></span><br><span class="line">						<span class="comment">// éœ€è¦è¯¥ç´¢å¼•æ˜ç¡®å½“å‰å±‚çš„æ¯ä¸ªå…ƒç´ ç©¶ç«Ÿæ˜¯å–ä¸Šä¸€å±‚è¾“å‡ºï¼ˆä¹Ÿå³ä¸Šå‰å±‚è¾“å…¥ï¼‰çš„å“ªä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œå…·ä½“è§ä¸‹é¢backward_maxpool_layer()å‡½æ•°çš„æ³¨é‡Šã€‚</span></span><br><span class="line">                        l.output[out_index] = max;</span><br><span class="line">                        <span class="keyword">if</span> (l.indexes) l.indexes[out_index] = max_i;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l.antialiasing) &#123;</span><br><span class="line">        network_state s = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        s.train = state.train;</span><br><span class="line">        s.workspace = state.workspace;</span><br><span class="line">        s.net = state.net;</span><br><span class="line">        s.input = l.output;</span><br><span class="line">        forward_convolutional_layer(*(l.input_layer), s);</span><br><span class="line">        <span class="comment">//simple_copy_ongpu(l.outputs*l.batch, l.output, l.input_antialiasing);</span></span><br><span class="line">        <span class="built_in">memcpy</span>(l.output, l.input_layer-&gt;output, l.input_layer-&gt;outputs * l.input_layer-&gt;batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ€å¤§æ± åŒ–å±‚çš„åå‘ä¼ æ’­"><a href="#æœ€å¤§æ± åŒ–å±‚çš„åå‘ä¼ æ’­" class="headerlink" title="æœ€å¤§æ± åŒ–å±‚çš„åå‘ä¼ æ’­"></a>æœ€å¤§æ± åŒ–å±‚çš„åå‘ä¼ æ’­</h2><p>æ± åŒ–å±‚çš„åå‘ä¼ æ’­ç”±<code>backward_maxpool_layer</code>å®ç°ï¼Œåå‘ä¼ æ’­å®é™…ä¸Šæ¯”å‰å‘ä¼ æ’­æ›´åŠ ç®€å•ï¼Œä½ å¯ä»¥åœä¸‹æ¥æƒ³æƒ³ä¸ºä»€ä¹ˆï¼Œå†çœ‹æˆ‘ä¸‹é¢çš„è¯¦ç»†è§£é‡Šã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** æœ€å¤§æ± åŒ–å±‚åå‘ä¼ æ’­å‡½æ•°</span></span><br><span class="line"><span class="comment">** l: å½“å‰æœ€å¤§æ± åŒ–å±‚</span></span><br><span class="line"><span class="comment">** state: æ•´ä¸ªç½‘ç»œ</span></span><br><span class="line"><span class="comment">** è¯´æ˜ï¼šè¿™ä¸ªå‡½æ•°çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œæ¯”èµ·backward_convolutional_layer()å°‘äº†å¾ˆå¤šï¼Œè¿™éƒ½æ˜¯æœ‰åŸå› çš„ã€‚å®é™…ä¸Šï¼Œåœ¨darknetä¸­ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆå±‚ï¼Œ</span></span><br><span class="line"><span class="comment">**      å…¶åå‘ä¼ æ’­å‡½æ•°éƒ½ä¼šå…ˆååšä¸¤ä»¶äº‹ï¼š1ï¼‰è®¡ç®—å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾l.deltaã€æƒé‡æ›´æ–°å€¼ä»¥åŠåç½®æ›´æ–°å€¼ï¼›2ï¼‰è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾net.deltaï¼ˆéƒ¨åˆ†è®¡ç®—ï¼Œ</span></span><br><span class="line"><span class="comment">**      è¦å®Œæˆè®¡ç®—å¾—ç­‰åˆ°çœŸæ­£åˆ°äº†è¿™ä¸€å±‚å†è¯´ï¼‰ã€‚è€Œè¿™é‡Œï¼Œæ˜¾ç„¶æ²¡æœ‰ç¬¬ä¸€æ­¥ï¼Œåªæœ‰ç¬¬äºŒæ­¥ï¼Œè€Œä¸”å¾ˆç®€å•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆå›ç­”ä¸ºä»€ä¹ˆæ²¡æœ‰ç¬¬ä¸€æ­¥ã€‚æ³¨æ„å½“å‰å±‚læ˜¯æœ€å¤§æ± åŒ–å±‚ï¼Œ</span></span><br><span class="line"><span class="comment">**      æœ€å¤§æ± åŒ–å±‚æ²¡æœ‰è®­ç»ƒå‚æ•°ï¼Œè¯´çš„å†ç›´ç™½ä¸€ç‚¹å°±æ˜¯æ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œæˆ–è€…è®¤ä¸ºæ¿€æ´»å‡½æ•°å°±æ˜¯f(x)=xï¼Œæ‰€ä»¥æ¿€æ´»å‡½æ•°å¯¹äºåŠ æƒè¾“å…¥çš„å¯¼æ•°å…¶å®å°±æ˜¯1,</span></span><br><span class="line"><span class="comment">**      æ­£å¦‚åœ¨backward_convolutional_layer()æ³¨é‡Šçš„é‚£æ ·ï¼Œæ¯ä¸€å±‚çš„åå‘ä¼ æ’­å‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯å°†ä¹‹å‰ï¼ˆå°±æ˜¯ä¸‹ä¸€å±‚è®¡ç®—å¾—åˆ°çš„ï¼Œæ³¨æ„è¿‡ç¨‹æ˜¯åå‘çš„ï¼‰</span></span><br><span class="line"><span class="comment">**      æœªè®¡ç®—å®Œå¾—åˆ°çš„l.deltaä¹˜ä»¥æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œä»¥æœ€ç»ˆå¾—åˆ°å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œè€Œå¯¹äºæœ€å¤§æ± åŒ–å±‚æ¥è¯´ï¼Œæ¯ä¸€ä¸ªè¾“å‡ºå¯¹äºåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼éƒ½æ˜¯1,</span></span><br><span class="line"><span class="comment">**      åŒæ—¶å¹¶æ²¡æœ‰æƒé‡åŠåç½®è¿™äº›éœ€è¦è®­ç»ƒçš„å‚æ•°ï¼Œè‡ªç„¶ä¸å†éœ€è¦ç¬¬ä¸€æ­¥ï¼›å¯¹äºç¬¬äºŒæ­¥ä¸ºä»€ä¹ˆä¼šå¦‚æ­¤ç®€å•ã€‚è¯·çœ‹ä»£ç æ³¨é‡Šã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_maxpool_layer</span><span class="params">(<span class="keyword">const</span> maxpool_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">//è·å–å½“å‰æœ€å¤§æ± åŒ–å±‚lçš„è¾“å‡ºå°ºå¯¸h,w</span></span><br><span class="line">    <span class="keyword">int</span> h = l.out_h;</span><br><span class="line">    <span class="keyword">int</span> w = l.out_w;</span><br><span class="line">	<span class="comment">//è·å–å½“å‰å±‚è¾“å…¥/è¾“å‡ºé€šé“æ•°</span></span><br><span class="line">    <span class="keyword">int</span> c = l.out_c;</span><br><span class="line">	<span class="comment">// è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆæœªè®¡ç®—å®Œå…¨ï¼Œè¿˜å·®ä¸€ä¸ªç¯èŠ‚ï¼Œè¿™ä¸ªç¯èŠ‚ç­‰çœŸæ­£åå‘åˆ°äº†é‚£å±‚å†æ‰§è¡Œï¼Œä½†æ˜¯å…¶å®å·²ç»å®Œå…¨è®¡ç®—äº†ï¼Œå› ä¸ºæ± åŒ–å±‚æ— å‚æ•°ï¼‰</span></span><br><span class="line">    <span class="comment">// å¾ªç¯æ€»æ¬¡æ•°ä¸ºå½“å‰å±‚è¾“å‡ºæ€»å…ƒç´ ä¸ªæ•°ï¼ˆåŒ…å«æ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼Œå³ç»´åº¦ä¸ºl.out_h * l.out_w * l.c * l.batchï¼Œæ³¨æ„æ­¤å¤„l.c==l.out_cï¼‰</span></span><br><span class="line">    <span class="comment">// å¯¹äºä¸Šä¸€å±‚è¾“å‡ºä¸­çš„å¾ˆå¤šå…ƒç´ çš„å¯¼æ•°å€¼ä¸º0,è€Œå¯¹æœ€å¤§å€¼å…ƒç´ ï¼Œå…¶å¯¼æ•°å€¼ä¸º1ï¼›å†ä¹˜ä»¥å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå¯¼æ•°å€¼ä¸º0çš„è¿˜æ˜¯ä¸º0,å¯¼æ•°å€¼ä¸º1åˆ™å°±ç­‰äºå½“å‰å±‚çš„æ•æ„Ÿåº¦å€¼ã€‚</span></span><br><span class="line">    <span class="comment">// ä»¥è¾“å‡ºå›¾æ€»å…ƒç´ ä¸ªæ•°è¿›è¡Œéå†ï¼Œåˆšå¥½å¯ä»¥æ‰¾å‡ºä¸Šä¸€å±‚è¾“å‡ºä¸­æ‰€æœ‰çœŸæ­£èµ·ä½œç”¨ï¼ˆåœ¨æŸä¸ªæ± åŒ–åŒºåŸŸä¸­å……å½“äº†æœ€å¤§å…ƒç´ å€¼ï¼‰ä¹Ÿå³æ•æ„Ÿåº¦å€¼ä¸ä¸º0çš„å…ƒç´ ï¼Œè€Œé‚£äº›æ²¡æœ‰èµ·ä½œç”¨çš„å…ƒç´ ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä¸ç”¨ç†ä¼šï¼Œä¿æŒå…¶åˆå§‹å€¼0å°±å¯ä»¥äº†ã€‚</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for <span class="comment">//openmpä¼˜åŒ–</span></span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; h*w*c*l.batch; ++i)&#123;</span><br><span class="line">        <span class="keyword">int</span> index = l.indexes[i];</span><br><span class="line">		<span class="comment">// éå†çš„åŸºå‡†æ˜¯ä»¥å½“å‰å±‚çš„è¾“å‡ºå…ƒç´ ä¸ºåŸºå‡†çš„ï¼Œl.indexesè®°å½•äº†å½“å‰å±‚æ¯ä¸€ä¸ªè¾“å‡ºå…ƒç´ ä¸ä¸Šä¸€å±‚å“ªä¸€ä¸ªè¾“å‡ºå…ƒç´ æœ‰çœŸæ­£è”ç³»ï¼ˆä¹Ÿå³ä¸Šä¸€å±‚å¯¹åº”æ± åŒ–æ ¸åŒºåŸŸä¸­æœ€å¤§å€¼å…ƒç´ çš„ç´¢å¼•ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥indexæ˜¯ä¸Šä¸€å±‚ä¸­æ‰€æœ‰è¾“å‡ºå…ƒç´ çš„ç´¢å¼•ï¼Œä¸”è¯¥å…ƒç´ åœ¨å½“å‰å±‚æŸä¸ªæ± åŒ–åŸŸä¸­å……å½“äº†æœ€å¤§å€¼å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ çš„æ•æ„Ÿåº¦å€¼å°†ç›´æ¥ä¼ æ‰¿å½“å‰å±‚å¯¹åº”å…ƒç´ çš„æ•æ„Ÿåº¦å€¼ã€‚</span></span><br><span class="line">        <span class="comment">// è€Œnet.deltaä¸­ï¼Œå‰©ä¸‹æ²¡æœ‰è¢«indexæŒ‰ç´¢å¼•è®¿é—®åˆ°çš„å…ƒç´ ï¼Œå°±æ˜¯é‚£äº›æ²¡æœ‰çœŸæ­£èµ·åˆ°ä½œç”¨çš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ çš„æ•æ„Ÿåº¦å€¼ä¸º0ï¼ˆnet.deltaå·²ç»åœ¨å‰å‘æ—¶å°†æ‰€æœ‰å…ƒç´ å€¼åˆå§‹åŒ–ä¸º0ï¼‰</span></span><br><span class="line">        <span class="comment">// è‡³äºä¸ºä»€ä¹ˆè¦ç”¨+=è¿ç®—ç¬¦ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼Œå’Œå·ç§¯ç±»ä¼¼ï¼šä¸€æ˜¯æ± åŒ–æ ¸ç”±äºè·¨åº¦è¾ƒå°ï¼Œå¯¼è‡´æœ‰é‡å åŒºåŸŸï¼›äºŒæ˜¯batchä¸­æœ‰å¤šå¼ å›¾ç‰‡ï¼Œéœ€è¦å°†æ‰€æœ‰å›¾ç‰‡çš„å½±å“åŠ èµ·æ¥ã€‚</span></span><br><span class="line">        state.delta[index] += l.delta[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¹³å‡æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"><a href="#å¹³å‡æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­" class="headerlink" title="å¹³å‡æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"></a>å¹³å‡æ± åŒ–å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­</h2><p>åˆšæ‰å·²ç»è®²åˆ°äº†ï¼Œæœ€å¤§æ± åŒ–ä»¥åŠå¹³å‡æ± åŒ–æ•´ç†æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œåªæ˜¯æŠŠæœ€å¤§çš„ç®—æœ¯æ“ä½œæ¢æˆå¹³å‡ï¼Œç„¶åå¹³å‡æ± åŒ–å±‚çš„åå‘ä¼ æ’­å°±å®Œæˆäº†ï¼Œå…·ä½“çš„ä»£ç å¯ä»¥å»githubé¡¹ç›®ä¸­æŸ¥çœ‹ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetå·ç§¯å±‚çš„åå‘ä¼ æ’­è§£æ</title>
    <url>/2020/02/24/AlexeyAB-DarkNet%E5%8D%B7%E7%A7%AF%E5%B1%82%E7%9A%84%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰é¢å·²ç»è¯¦ç»†è®²è§£äº†å·ç§¯å±‚çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œå¤§è‡´æ€è·¯å°±æ˜¯ä½¿ç”¨im2colæ–¹æ³•å¯¹æ•°æ®è¿›è¡Œé‡æ’ï¼Œç„¶ååˆ©ç”¨sgemmç®—æ³•è®¡ç®—å‡ºç»“æœï¼Œåå‘ä¼ æ’­å®é™…ä¸Šå°±æ˜¯å‰å‘ä¼ æ’­çš„é€†è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹æºç å§ã€‚</p>
<h2 id="åå‘ä¼ æ’­è§£æ"><a href="#åå‘ä¼ æ’­è§£æ" class="headerlink" title="åå‘ä¼ æ’­è§£æ"></a>åå‘ä¼ æ’­è§£æ</h2><ul>
<li>é¦–å…ˆè°ƒç”¨<code>gradient_array()</code>è®¡ç®—å½“å‰å±‚<code>l</code>æ‰€æœ‰è¾“å‡ºå…ƒç´ å…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ï¼ˆä¹Ÿå³æ¿€æ´»å‡½æ•°å…³äºè¾“å…¥çš„å¯¼æ•°å€¼ï¼‰ï¼Œå¹¶ä¹˜ä¸Šä¸Šä¸€æ¬¡è°ƒç”¨<code>backward_convolutional_layer()</code>è¿˜æ²¡è®¡ç®—å®Œçš„<code>l.delta</code>ï¼Œå¾—åˆ°å½“å‰å±‚æœ€ç»ˆçš„æ•æ„Ÿåº¦å›¾ã€‚è¿™éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** è®¡ç®—æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œå¹¶ä¹˜ä»¥deltaï¼Œå¾—åˆ°å½“å‰å±‚æœ€ç»ˆçš„deltaï¼ˆæ•æ„Ÿåº¦å›¾ï¼‰</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šx    å½“å‰å±‚çš„æ‰€æœ‰è¾“å‡ºï¼ˆç»´åº¦ä¸ºl.batch * l.out_c * l.out_w * l.out_hï¼‰</span></span><br><span class="line"><span class="comment">**      n    l.outputçš„ç»´åº¦ï¼Œå³ä¸ºl.batch * l.out_c * l.out_w * l.out_hï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰</span></span><br><span class="line"><span class="comment">**      ACTIVATION    æ¿€æ´»å‡½æ•°ç±»å‹</span></span><br><span class="line"><span class="comment">**      delta     å½“å‰å±‚æ•æ„Ÿåº¦å›¾ï¼ˆä¸å½“å‰æˆè¾“å‡ºxç»´åº¦ä¸€æ ·ï¼‰</span></span><br><span class="line"><span class="comment">** è¯´æ˜1ï¼šè¯¥å‡½æ•°ä¸ä½†è®¡ç®—äº†æ¿€æ´»å‡½æ•°å¯¹äºåŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œè¿˜å°†è¯¥å¯¼æ•°ä¹˜ä»¥äº†ä¹‹å‰å®Œæˆå¤§éƒ¨åˆ†è®¡ç®—çš„æ•æ„Ÿåº¦å›¾deltaï¼ˆå¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼‰ï¼Œå› æ­¤è°ƒç”¨æ”¹å‡½æ•°ä¹‹åï¼Œå°†å¾—åˆ°è¯¥å±‚æœ€ç»ˆçš„æ•æ„Ÿåº¦å›¾</span></span><br><span class="line"><span class="comment">** è¯´æ˜2ï¼šè¿™é‡Œç›´æ¥åˆ©ç”¨è¾“å‡ºå€¼æ±‚æ¿€æ´»å‡½æ•°å…³äºè¾“å…¥çš„å¯¼æ•°å€¼æ˜¯å› ä¸ºç¥ç»ç½‘ç»œä¸­æ‰€ä½¿ç”¨çš„ç»å¤§éƒ¨åˆ†æ¿€æ´»å‡½æ•°ï¼Œå…¶å…³äºè¾“å…¥çš„å¯¼æ•°å€¼éƒ½å¯ä»¥æè¿°ä¸ºè¾“å‡ºå€¼çš„å‡½æ•°è¡¨è¾¾å¼ï¼Œ</span></span><br><span class="line"><span class="comment">          æ¯”å¦‚å¯¹äºSigmoidæ¿€æ´»å‡½æ•°ï¼ˆè®°ä½œf(x)ï¼‰ï¼Œå…¶å¯¼æ•°å€¼ä¸ºf(x)&#x27;=f(x)*(1-f(x)),å› æ­¤å¦‚æœç»™å‡ºy=f(x)ï¼Œé‚£ä¹ˆf(x)&#x27;=y*(1-y)ï¼Œåªéœ€è¦è¾“å‡ºå€¼yå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦è¾“å…¥xçš„å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">          ï¼ˆæš‚æ—¶ä¸ç¡®å®šdarknetä¸­æœ‰æ²¡æœ‰ä½¿ç”¨ç‰¹æ®Šçš„æ¿€æ´»å‡½æ•°ï¼Œä»¥è‡´äºå¿…é¡»è¦è¾“å…¥å€¼æ‰èƒ½å¤Ÿæ±‚å‡ºå¯¼æ•°å€¼ï¼Œåœ¨activiation.cæ–‡ä»¶ä¸­ï¼Œæœ‰å‡ ä¸ªæ¿€æ´»å‡½æ•°æš‚æ—¶æ²¡çœ‹æ‡‚ï¼Œä¹Ÿæ²¡åœ¨ç½‘ä¸ŠæŸ¥åˆ°ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">** è¯´æ˜3ï¼šå…³äºl.deltaçš„åˆå€¼ï¼Œå¯èƒ½ä½ æœ‰æ³¨æ„åˆ°åœ¨çœ‹æŸä¸€ç±»å‹ç½‘ç»œå±‚çš„æ—¶å€™ï¼Œæ¯”å¦‚å·ç§¯å±‚ä¸­çš„backward_convolutional_layer()å‡½æ•°ï¼Œæ²¡æœ‰å‘ç°åœ¨æ­¤ä¹‹å‰å¯¹l.deltaèµ‹åˆå€¼çš„è¯­å¥ï¼Œ</span></span><br><span class="line"><span class="comment">**        åªæ˜¯ç”¨callocä¸ºå…¶åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œè¿™æ ·çš„l.deltaå…¶æ‰€æœ‰å…ƒç´ çš„å€¼éƒ½ä¸º0,é‚£ä¹ˆè¿™é‡Œä½¿ç”¨*=è¿ç®—ç¬¦å¾—åˆ°çš„å€¼å°†æ’ä¸º0ã€‚æ˜¯çš„ï¼Œå¦‚æœåªçœ‹æŸä¸€å±‚ï¼Œæˆ–è€…è¯´æŸä¸€ç±»å‹çš„å±‚ï¼Œçš„ç¡®æœ‰è¿™ä¸ªç–‘æƒ‘ï¼Œ</span></span><br><span class="line"><span class="comment">**        ä½†æ˜¯æ•´ä¸ªç½‘ç»œæ˜¯æœ‰å¾ˆå¤šå±‚çš„ï¼Œä¸”æœ‰å¤šç§ç±»å‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šä»¥å·ç§¯å±‚ä¸ºæœ€åä¸€å±‚ï¼Œè€Œå›ä»¥COSTæˆ–è€…REGIONä¸ºæœ€åä¸€å±‚ï¼Œè¿™äº›å±‚ä¸­ï¼Œä¼šå¯¹l.deltaèµ‹åˆå€¼ï¼Œåˆç”±äºl.deltaæ˜¯ç”±å</span></span><br><span class="line"><span class="comment">**        ç½‘å‰é€å±‚ä¼ æ’­çš„ï¼Œå› æ­¤ï¼Œå½“åå‘è¿è¡Œåˆ°æŸä¸€å±‚æ—¶ï¼Œl.deltaçš„å€¼å°†éƒ½ä¸ä¼šä¸º0.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gradient_array</span><span class="params">(<span class="keyword">const</span> <span class="keyword">float</span> *x, <span class="keyword">const</span> <span class="keyword">int</span> n, <span class="keyword">const</span> ACTIVATION a, <span class="keyword">float</span> *delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">        delta[i] *= <span class="built_in">gradient</span>(x[i], a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>gradient</code>å‡½æ•°çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** æ ¹æ®ä¸åŒçš„æ¿€æ´»å‡½æ•°æ±‚å–å¯¹è¾“å…¥çš„æ¢¯åº¦ï¼ˆå¯¼æ•°ï¼‰</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šx    æ¿€æ´»å‡½æ•°æ¥æ”¶çš„è¾“å…¥å€¼</span></span><br><span class="line"><span class="comment">**      a    æ¿€æ´»å‡½æ•°ç±»å‹ï¼ŒåŒ…æ‹¬çš„æ¿€æ´»å‡½æ•°ç±»å‹è§activations.hä¸­æšä¸¾ç±»å‹ACTIVATIONçš„å®šä¹‰</span></span><br><span class="line"><span class="comment">** è¾“å‡ºï¼šæ¿€æ´»å‡½æ•°å…³äºè¾“å…¥xçš„å¯¼æ•°å€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">gradient</span><span class="params">(<span class="keyword">float</span> x, ACTIVATION a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ä»¥ä¸‹åˆ†åˆ«æ±‚å–å„ç§æ¿€æ´»å‡½æ•°å¯¹è¾“å…¥çš„å¯¼æ•°å€¼ï¼Œè¯¦è§å„ä¸ªå¯¼æ•°æ±‚å–å‡½æ•°çš„å†…éƒ¨æ³¨é‡Š</span></span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span>(a)&#123;</span><br><span class="line">        <span class="keyword">case</span> LINEAR:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">linear_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> LOGISTIC:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">logistic_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> LOGGY:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">loggy_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> RELU:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">relu_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> NORM_CHAN:</span><br><span class="line">            <span class="comment">//return relu_gradient(x);</span></span><br><span class="line">        <span class="keyword">case</span> NORM_CHAN_SOFTMAX_MAXVAL:</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">case</span> NORM_CHAN_SOFTMAX:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot; Error: should be used custom NORM_CHAN or NORM_CHAN_SOFTMAX-function for gradient \n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">case</span> ELU:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">elu_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> SELU:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">selu_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> RELIE:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">relie_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> RAMP:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ramp_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> LEAKY:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">leaky_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> TANH:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">tanh_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> PLSE:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">plse_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> STAIR:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">stair_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> HARDTAN:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">hardtan_gradient</span>(x);</span><br><span class="line">        <span class="keyword">case</span> LHTAN:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">lhtan_gradient</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç„¶åï¼Œå¦‚æœç½‘ç»œè¿›è¡Œäº†BNï¼Œåˆ™è°ƒç”¨backward_batchnorm_layerï¼Œå¦åˆ™ç›´æ¥è°ƒç”¨  backward_bias()è®¡ç®—å½“å‰å±‚æ‰€æœ‰å·ç§¯æ ¸çš„åç½®æ›´æ–°å€¼ã€‚backward_batchnorm_layerä¹‹åä¼šå•ç‹¬è®²ï¼Œè¿™é‡Œæ¥çœ‹çœ‹backward_bias()çš„å®ç°ã€‚</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** è®¡ç®—æ¯ä¸ªå·ç§¯æ ¸çš„åç½®æ›´æ–°å€¼ï¼Œæ‰€è°“åç½®æ›´æ–°å€¼ï¼Œå°±æ˜¯bias = bias - alpha * bias_updateä¸­çš„bias_update</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šbias_updates     å½“å‰å±‚æ‰€æœ‰åç½®çš„æ›´æ–°å€¼ï¼Œç»´åº¦ä¸ºl.nï¼ˆå³å½“å‰å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼‰</span></span><br><span class="line"><span class="comment">**      delta            å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆå³l.deltaï¼‰</span></span><br><span class="line"><span class="comment">**      batch            ä¸€ä¸ªbatchå«æœ‰çš„å›¾ç‰‡å¼ æ•°ï¼ˆå³l.batchï¼‰</span></span><br><span class="line"><span class="comment">**      n                å½“å‰å±‚å·ç§¯æ ¸ä¸ªæ•°ï¼ˆå³l.nï¼‰</span></span><br><span class="line"><span class="comment">**      k                å½“å‰å±‚è¾“å…¥ç‰¹å¾å›¾å°ºå¯¸ï¼ˆå³l.out_w*l.out_hï¼‰</span></span><br><span class="line"><span class="comment">** åŸç†ï¼šå½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾l.deltaæ˜¯è¯¯å·®å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œä¹Ÿå°±æ˜¯åç½®æ›´æ–°å€¼ï¼Œåªæ˜¯å…¶ä¸­æ¯l.out_w*l.out_hä¸ªå…ƒç´ éƒ½å¯¹åº”åŒä¸€ä¸ª</span></span><br><span class="line"><span class="comment">**      åç½®ï¼Œå› æ­¤éœ€è¦å°†å…¶åŠ èµ·æ¥ï¼Œå¾—åˆ°çš„å’Œå°±æ˜¯è¯¯å·®å‡½æ•°å¯¹å½“å‰å±‚å„åç½®çš„å¯¼æ•°ï¼ˆl.deltaçš„ç»´åº¦ä¸ºl.batch*l.n*l.out_h*l.out_w,</span></span><br><span class="line"><span class="comment">**      å¯ç†è§£æˆå…±æœ‰l.batchè¡Œï¼Œæ¯è¡Œæœ‰l.n*l.out_h*l.out_wåˆ—ï¼Œè€Œè¿™ä¸€å¤§è¡Œåˆå¯ä»¥ç†è§£æˆæœ‰l.nï¼Œl.out_h*l.out_wåˆ—ï¼Œè¿™æ¯ä¸€å°è¡Œå°±</span></span><br><span class="line"><span class="comment">**      å¯¹åº”åŒä¸€ä¸ªå·ç§¯æ ¸ä¹Ÿå³åŒä¸€ä¸ªåç½®ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_bias</span><span class="params">(<span class="keyword">float</span> *bias_updates, <span class="keyword">float</span> *delta, <span class="keyword">int</span> batch, <span class="keyword">int</span> n, <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,b;</span><br><span class="line">	<span class="comment">// éå†batchä¸­æ¯å¼ è¾“å…¥å›¾ç‰‡</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œæœ€åçš„åç½®æ›´æ–°å€¼æ˜¯æ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„æ€»å’Œï¼ˆå¤šå¼ å›¾ç‰‡æ— éå°±æ˜¯é‡å¤ä¸€å¼ å›¾ç‰‡çš„æ“ä½œï¼Œæ±‚å’Œå³å¯ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment">// æ€»ä¹‹ï¼šä¸€ä¸ªå·ç§¯æ ¸å¯¹åº”ä¸€ä¸ªåç½®æ›´æ–°å€¼ï¼Œè¯¥åç½®æ›´æ–°å€¼ç­‰äºbatchä¸­æ‰€æœ‰è¾“å…¥å›¾ç‰‡ç´¯ç§¯çš„åç½®æ›´æ–°å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// è€Œæ¯å¼ å›¾ç‰‡ä¹Ÿéœ€è¦è¿›è¡Œåç½®æ›´æ–°å€¼æ±‚å’Œï¼ˆå› ä¸ºæ¯ä¸ªå·ç§¯æ ¸åœ¨æ¯å¼ å›¾ç‰‡å¤šä¸ªä½ç½®åšäº†å·ç§¯è¿ç®—ï¼Œè¿™éƒ½å¯¹åç½®æ›´æ–°å€¼æœ‰è´¡çŒ®ï¼‰ä»¥å¾—åˆ°æ¯å¼ å›¾ç‰‡çš„æ€»åç½®æ›´æ–°å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">for</span>(b = <span class="number">0</span>; b &lt; batch; ++b)&#123;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">            bias_updates[i] += <span class="built_in">sum_array</span>(delta+size*(i+b*n), size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ¥ä¸‹æ¥ä¾æ¬¡è°ƒç”¨im2col_cpu()ï¼Œgemm_nt()å‡½æ•°è®¡ç®—å½“å‰å±‚æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼›å¦‚æœä¸Šä¸€å±‚çš„deltaå·²ç»åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œåˆ™ä¾æ¬¡è°ƒç”¨gemm_tn(), col2im_cpu()è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆå¹¶æœªå®Œæˆæ‰€æœ‰è®¡ç®—ï¼Œè¿˜å·®ä¸€ä¸ªæ­¥éª¤ï¼‰ã€‚æ•´ä¸ªåå‘ä¼ æ’­çš„æ ¸å¿ƒå‡½æ•°è§£é‡Šå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** å·ç§¯ç¥ç»ç½‘ç»œåå‘ä¼ æ’­æ ¸å¿ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">** ä¸»è¦æµç¨‹ï¼š1ï¼‰ è°ƒç”¨gradient_array()è®¡ç®—å½“å‰å±‚læ‰€æœ‰è¾“å‡ºå…ƒç´ å…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ï¼ˆä¹Ÿå³æ¿€æ´»å‡½æ•°å…³äºè¾“å…¥çš„å¯¼æ•°å€¼ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">**             å¹¶ä¹˜ä¸Šä¸Šä¸€æ¬¡è°ƒç”¨backward_convolutional_layer()è¿˜æ²¡è®¡ç®—å®Œçš„l.deltaï¼Œå¾—åˆ°å½“å‰å±‚æœ€ç»ˆçš„æ•æ„Ÿåº¦å›¾ï¼›</span></span><br><span class="line"><span class="comment">**          2ï¼‰ å¦‚æœç½‘ç»œè¿›è¡Œäº†BNï¼Œåˆ™backward_batchnorm_layerã€‚</span></span><br><span class="line"><span class="comment">**          3ï¼‰ å¦‚æœç½‘ç»œæ²¡æœ‰è¿›è¡ŒBNï¼Œåˆ™ç›´æ¥è°ƒç”¨ backward_bias()è®¡ç®—å½“å‰å±‚æ‰€æœ‰å·ç§¯æ ¸çš„åç½®æ›´æ–°å€¼ï¼›</span></span><br><span class="line"><span class="comment">**          4ï¼‰ ä¾æ¬¡è°ƒç”¨im2col_cpu()ï¼Œgemm_nt()å‡½æ•°è®¡ç®—å½“å‰å±‚æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼›</span></span><br><span class="line"><span class="comment">**          5ï¼‰ å¦‚æœä¸Šä¸€å±‚çš„deltaå·²ç»åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œåˆ™ä¾æ¬¡è°ƒç”¨gemm_tn(), col2im_cpu()è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆå¹¶æœªå®Œæˆæ‰€æœ‰è®¡ç®—ï¼Œè¿˜å·®ä¸€ä¸ªæ­¥éª¤ï¼‰ï¼›</span></span><br><span class="line"><span class="comment">** å¼ºè°ƒï¼šæ¯æ¬¡è°ƒç”¨æœ¬å‡½æ•°ä¼šè®¡ç®—å®Œæˆå½“å‰å±‚çš„æ•æ„Ÿåº¦è®¡ç®—ï¼ŒåŒæ—¶è®¡ç®—å½“å‰å±‚çš„åç½®ã€æƒé‡æ›´æ–°å€¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œ</span></span><br><span class="line"><span class="comment">**      å¹¶æ²¡æœ‰å®Œå…¨è®¡ç®—å®Œï¼Œè¿˜å·®ä¸€æ­¥ï¼šä¹˜ä¸Šæ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ã€‚è¿™ä¸€æ­¥åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æœ¬å‡½æ•°æ—¶å®Œæˆã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_convolutional_layer</span><span class="params">(convolutional_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="comment">// å·ç§¯æ ¸ä¸ªæ•°ï¼Œè€ƒè™‘åˆ°åˆ†ç»„å·ç§¯</span></span><br><span class="line">    <span class="keyword">int</span> m = l.n / l.groups;</span><br><span class="line">	<span class="comment">// æ¯ä¸€ä¸ªå·ç§¯æ ¸å…ƒç´ ä¸ªæ•°ï¼ˆåŒ…æ‹¬l.cï¼ˆl.cä¸ºè¯¥å±‚ç½‘ç»œæ¥å—çš„è¾“å…¥å›¾ç‰‡çš„é€šé“æ•°ï¼‰ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸å…ƒç´ ä¸ªæ•°æ€»æ•°ï¼Œæ¯”å¦‚å·ç§¯æ ¸å°ºå¯¸ä¸º3*3,</span></span><br><span class="line">    <span class="comment">// è¾“å…¥å›¾ç‰‡æœ‰3ä¸ªé€šé“ï¼Œå› ä¸ºè¦åŒæ—¶ä½œç”¨äºè¾“å…¥çš„3ä¸ªé€šé“ä¸Šï¼Œæ‰€ä»¥å®é™…ä¸Šè¿™ä¸ªå·ç§¯æ ¸æ˜¯ä¸€ä¸ªç«‹ä½“çš„ï¼Œå…±æœ‰3*3*3=27ä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ éƒ½æ˜¯è¦è®­ç»ƒçš„å‚æ•°ï¼‰ï¼ŒåŒæ ·éœ€è¦è€ƒè™‘åˆ†ç»„æ•°</span></span><br><span class="line">    <span class="keyword">int</span> n = l.size*l.size*l.c / l.groups;</span><br><span class="line">	<span class="comment">// æ¯å¼ è¾“å‡ºç‰¹å¾å›¾çš„å…ƒç´ ä¸ªæ•°ï¼šout_wï¼Œout_hæ˜¯è¾“å‡ºç‰¹å¾å›¾çš„å®½é«˜</span></span><br><span class="line">    <span class="keyword">int</span> k = l.out_w*l.out_h;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—å½“å‰å±‚æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼å¹¶ä¹˜ä»¥l.deltaç›¸åº”å…ƒç´ ï¼Œä»è€Œå½»åº•å®Œæˆå½“å‰å±‚æ•æ„Ÿåº¦å›¾çš„è®¡ç®—ï¼Œå¾—åˆ°å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾l.deltaã€‚</span></span><br><span class="line">    <span class="comment">// l.outputå­˜å‚¨äº†è¯¥å±‚ç½‘ç»œçš„æ‰€æœ‰è¾“å‡ºï¼šè¯¥å±‚ç½‘ç»œæ¥å—ä¸€ä¸ªbatchçš„è¾“å…¥å›¾ç‰‡ï¼Œå…¶ä¸­æ¯å¼ å›¾ç‰‡ç»å·ç§¯å¤„ç†åå¾—åˆ°çš„ç‰¹å¾å›¾å°ºå¯¸ä¸ºï¼šl.out_w,l.out_hï¼Œ</span></span><br><span class="line">    <span class="comment">// è¯¥å±‚å·ç§¯ç½‘ç»œå…±æœ‰l.nä¸ªå·ç§¯æ ¸ï¼Œå› æ­¤ä¸€å¼ è¾“å…¥å›¾ç‰‡å…±è¾“å‡ºl.nå¼ å®½é«˜ä¸ºl.out_w,l.out_hçš„ç‰¹å¾å›¾ï¼ˆl.outputä¸ºä¸€å¼ å›¾æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æ‰€æœ‰è¾“å…¥å›¾ç‰‡ä¹Ÿå³l.outputä¸­çš„æ€»å…ƒç´ ä¸ªæ•°ä¸ºï¼šl.n*l.out_w*l.out_h*l.batchï¼›</span></span><br><span class="line">    <span class="comment">// l.activationä¸ºè¯¥å·ç§¯å±‚çš„æ¿€æ´»å‡½æ•°ç±»å‹ï¼Œl.deltaå°±æ˜¯gradient_array()å‡½æ•°è®¡ç®—å¾—åˆ°çš„l.outputä¸­æ¯ä¸€ä¸ªå…ƒç´ å…³äºæ¿€æ´»å‡½æ•°å‡½æ•°è¾“å…¥çš„å¯¼æ•°å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè¿™é‡Œç›´æ¥åˆ©ç”¨è¾“å‡ºå€¼æ±‚å¾—æ¿€æ´»å‡½æ•°å…³äºè¾“å…¥çš„å¯¼æ•°å€¼æ˜¯å› ä¸ºç¥ç»ç½‘ç»œä¸­æ‰€ä½¿ç”¨çš„ç»å¤§éƒ¨åˆ†æ¿€æ´»å‡½æ•°å…³äºè¾“å…¥çš„å¯¼æ•°å€¼éƒ½å¯ä»¥æè¿°ä¸ºè¾“å‡ºå€¼çš„å‡½æ•°è¡¨è¾¾å¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚å¯¹äºSigmoidæ¿€æ´»å‡½æ•°ï¼ˆè®°ä½œf(x)ï¼‰ï¼Œå…¶å¯¼æ•°å€¼ä¸ºf(x)&#x27;=f(x)*(1-f(x)),å› æ­¤å¦‚æœç»™å‡ºy=f(x)ï¼Œé‚£ä¹ˆf(x)&#x27;=y*(1-y)ï¼Œåªéœ€è¦è¾“å‡ºå€¼yå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦è¾“å…¥xçš„å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// ï¼ˆæš‚æ—¶ä¸ç¡®å®šdarknetä¸­æœ‰æ²¡æœ‰ä½¿ç”¨ç‰¹æ®Šçš„æ¿€æ´»å‡½æ•°ï¼Œä»¥è‡´äºå¿…é¡»è¦è¾“å…¥å€¼æ‰èƒ½å¤Ÿæ±‚å‡ºå¯¼æ•°å€¼ï¼Œåœ¨activiation.cæ–‡ä»¶ä¸­ï¼Œæœ‰å‡ ä¸ªæ¿€æ´»å‡½æ•°æš‚æ—¶æ²¡çœ‹æ‡‚ï¼Œä¹Ÿæ²¡åœ¨ç½‘ä¸ŠæŸ¥åˆ°ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment">// l.deltaæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œé•¿åº¦ä¸ºl.batch * l.outputsï¼ˆå…¶ä¸­l.outputs = l.out_h * l.out_w * l.out_cï¼‰ï¼Œåœ¨make_convolutional_layer()åŠ¨æ€åˆ†é…å†…å­˜ï¼›</span></span><br><span class="line">    <span class="comment">// å†å¼ºè°ƒä¸€æ¬¡ï¼šgradient_array()ä¸å•å•æ˜¯å®Œæˆæ¿€æ´»å‡½æ•°å¯¹è¾“å…¥çš„æ±‚å¯¼è¿ç®—ï¼Œè¿˜å®Œæˆè®¡ç®—å½“å‰å±‚æ•æ„Ÿåº¦å›¾çš„æœ€åä¸€æ­¥ï¼šl.deltaä¸­æ¯ä¸ªå…ƒç´ ä¹˜ä»¥æ¿€æ´»å‡½æ•°å¯¹è¾“å…¥çš„å¯¼æ•°ï¼ˆæ³¨æ„gradient_arryä¸­ä½¿ç”¨çš„æ˜¯*=è¿ç®—ç¬¦ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡è°ƒç”¨backward_convolutional_layeæ—¶ï¼Œéƒ½ä¼šå®Œæˆå½“å‰å±‚æ•æ„Ÿåº¦å›¾çš„è®¡ç®—ï¼ŒåŒæ—¶ä¼šè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œä½†å¯¹äºä¸Šä¸€å±‚ï¼Œå…¶æ•æ„Ÿåº¦å›¾å¹¶æ²¡æœ‰å®Œå…¨è®¡ç®—å®Œæˆï¼Œè¿˜å·®ä¸€æ­¥ï¼Œ</span></span><br><span class="line">    <span class="comment">// éœ€è¦ç­‰åˆ°ä¸‹ä¸€æ¬¡è°ƒç”¨backward_convolutional_layer()æ—¶æ¥å®Œæˆï¼Œè¯šå¦‚col2im_cpu()ä¸­æ³¨é‡Šä¸€æ ·ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (l.activation == SWISH) <span class="built_in">gradient_array_swish</span>(l.output, l.outputs*l.batch, l.activation_input, l.delta);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == MISH) <span class="built_in">gradient_array_mish</span>(l.outputs*l.batch, l.activation_input, l.delta);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN_SOFTMAX || l.activation == NORM_CHAN_SOFTMAX_MAXVAL) <span class="built_in">gradient_array_normalize_channels_softmax</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.delta);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN) <span class="built_in">gradient_array_normalize_channels</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.delta);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">gradient_array</span>(l.output, l.outputs*l.batch, l.activation, l.delta);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l.batch_normalize) &#123;</span><br><span class="line">		<span class="comment">// ä¹‹åå•ç‹¬è®²BNå±‚çš„å‰å‘å’Œåå‘ä¼ æ’­</span></span><br><span class="line">        <span class="built_in">backward_batchnorm_layer</span>(l, state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// è®¡ç®—åç½®çš„æ›´æ–°å€¼ï¼šæ¯ä¸ªå·ç§¯æ ¸éƒ½æœ‰ä¸€ä¸ªåç½®ï¼Œåç½®çš„æ›´æ–°å€¼ä¹Ÿå³è¯¯å·®å‡½æ•°å¯¹åç½®çš„å¯¼æ•°ï¼Œè¿™ä¸ªå¯¼æ•°çš„è®¡ç®—å¾ˆç®€å•ï¼Œå®é™…æ‰€æœ‰çš„å¯¼æ•°å·²ç»æ±‚å®Œäº†ï¼Œéƒ½å­˜å‚¨åœ¨l.deltaä¸­ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¥ä¸‹æ¥åªéœ€æŠŠl.deltaä¸­å¯¹åº”åŒä¸€ä¸ªå·ç§¯æ ¸çš„é¡¹åŠ èµ·æ¥å°±å¯ä»¥ï¼ˆå·ç§¯æ ¸åœ¨å›¾åƒä¸Šé€è¡Œé€åˆ—è·¨æ­¥ç§»åŠ¨åšå·ç§¯ï¼Œæ¯ä¸ªä½ç½®å¤„éƒ½æœ‰ä¸€ä¸ªè¾“å‡ºï¼Œå…±æœ‰l.out_w*l.out_hä¸ªï¼Œ</span></span><br><span class="line">        <span class="comment">// è¿™äº›è¾“å‡ºéƒ½ä¸åŒä¸€ä¸ªåç½®å…³è”ï¼Œå› æ­¤å°†l.deltaä¸­å¯¹åº”åŒä¸€ä¸ªå·ç§¯æ ¸çš„é¡¹åŠ èµ·æ¥å³å¾—è¯¯å·®å‡½æ•°å¯¹è¿™ä¸ªåç½®çš„å¯¼æ•°ï¼‰</span></span><br><span class="line">        <span class="built_in">backward_bias</span>(l.bias_updates, l.delta, l.batch, l.n, k);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// éå†batchä¸­çš„æ¯å¼ ç…§ç‰‡ï¼Œå¯¹äºl.deltaæ¥è¯´ï¼Œæ¯å¼ ç…§ç‰‡æ˜¯åˆ†å¼€å­˜çš„ï¼Œå› æ­¤å…¶ç»´åº¦ä¼šè¾¾åˆ°ï¼šl.batch*l.n*l.out_w*l.out_hï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯¹äºl.weights,l.weight_updatesä»¥åŠä¸Šé¢æåˆ°çš„l.bias,l.bias_updatesï¼Œæ˜¯å°†æ‰€æœ‰ç…§ç‰‡å¯¹åº”å…ƒç´ å åŠ èµ·æ¥</span></span><br><span class="line">    <span class="comment">// ï¼ˆå¾ªç¯çš„è¿‡ç¨‹å°±æ˜¯å åŠ çš„è¿‡ç¨‹ï¼Œæ³¨æ„gemm()è¿™ç³»åˆ—å‡½æ•°å«æœ‰å åŠ æ•ˆæœï¼Œä¸æ˜¯è¦†ç›–è¾“å…¥Cçš„å€¼ï¼Œè€Œæ˜¯å åŠ åˆ°ä¹‹å‰çš„Cä¸Šï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› æ­¤l.weightsä¸l.weight_updatesç»´åº¦ä¸ºl.n*l.size*l.sizeï¼Œl.biasä¸l.bias_updatesçš„ç»´åº¦ä¸ºl.hï¼Œéƒ½ä¸l.batchæ— å…³</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l.batch; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.groups; ++j) &#123;</span><br><span class="line">			<span class="keyword">float</span> *a = l.delta + (i*l.groups + j)*m*k;</span><br><span class="line">			<span class="comment">// net.workspaceçš„å…ƒç´ ä¸ªæ•°ä¸ºæ‰€æœ‰å±‚ä¸­æœ€å¤§çš„l.workspace_sizeï¼ˆåœ¨make_convolutional_layer()è®¡ç®—å¾—åˆ°workspace_sizeçš„å¤§å°ï¼Œåœ¨parse_network_cfg()ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼Œæ­¤å€¼å¯¹åº”æœªä½¿ç”¨gpuæ—¶çš„æƒ…å†µï¼‰,</span></span><br><span class="line">			<span class="comment">// net.workspaceå……å½“ä¸€ä¸ªä¸´æ—¶å·¥ä½œç©ºé—´çš„ä½œç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ‰€éœ€è¦çš„è®¡ç®—å‚æ•°ï¼Œæ¯”å¦‚æ¯å±‚å•å¼ å›¾ç‰‡é‡æ’åçš„ç»“æœï¼ˆè¿™äº›å‚æ•°é©¬ä¸Šå°±ä¼šå‚ä¸å·ç§¯è¿ç®—ï¼‰ï¼Œä¸€æ—¦ç”¨å®Œï¼Œå°±ä¼šè¢«é©¬ä¸Šæ›´æ–°ï¼ˆå› æ­¤è¯¥å˜é‡çš„å€¼çš„æ›´æ–°é¢‘ç‡æ¯”è¾ƒå¤§ï¼‰</span></span><br><span class="line">            <span class="keyword">float</span> *b = state.workspace;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">float</span> *c = l.weight_updates + j*l.nweights / l.groups;</span><br><span class="line">			<span class="comment">// è¿›å…¥æœ¬å‡½æ•°ä¹‹å‰ï¼Œåœ¨backward_network()å‡½æ•°ä¸­ï¼Œå·²ç»å°†net.inputèµ‹å€¼ä¸ºprev.outputï¼Œä¹Ÿå³è‹¥å½“å‰å±‚ä¸ºç¬¬lå±‚ï¼Œnet.inputæ­¤æ—¶å·²ç»æ˜¯ç¬¬l-1å±‚çš„è¾“å‡º</span></span><br><span class="line">			<span class="comment">// æ³¨æ„åå‘ä¼ æ’­ä»åå¾€å‰æ¥çœ‹</span></span><br><span class="line">            <span class="keyword">float</span> *im = state.input + (i*l.groups + j)* (l.c / l.groups)*l.h*l.w;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//im2col_cpu(im, l.c / l.groups, l.h, l.w, l.size, l.stride, l.pad, b);</span></span><br><span class="line">			<span class="comment">// ä¸‹é¢ä¸¤æ­¥ï¼šim2col_cpu()ä¸gemm()æ˜¯ä¸ºäº†è®¡ç®—å½“å‰å±‚çš„æƒé‡æ›´æ–°å€¼ï¼ˆå…¶å®ä¹Ÿå°±æ˜¯è¯¯å·®å‡½æ•°å¯¹å½“å‰å±‚æƒé‡çš„å¯¼æ•°ï¼‰</span></span><br><span class="line">			<span class="comment">// å°†å¤šé€šé“äºŒç»´å›¾åƒnet.inputå˜æˆæŒ‰ä¸€å®šå­˜å‚¨è§„åˆ™æ’åˆ—çš„æ•°ç»„bï¼Œä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°è¿›è¡ŒçŸ©é˜µï¼ˆå·ç§¯ï¼‰è®¡ç®—ï¼Œè¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰ï¼Œ</span></span><br><span class="line">			<span class="comment">// im2col_cpu_extæ¯æ¬¡ä»…å¤„ç†net.inputï¼ˆåŒ…å«æ•´ä¸ªbatchï¼‰ä¸­çš„ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼ˆå¯¹äºç¬¬ä¸€å±‚ï¼Œåˆ™å°±æ˜¯è¯»å…¥çš„å›¾ç‰‡ï¼Œå¯¹äºä¹‹åçš„å±‚ï¼Œè¿™äº›å›¾ç‰‡éƒ½æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºï¼Œé€šé“æ•°ç­‰äºä¸Šä¸€å±‚å·ç§¯æ ¸ä¸ªæ•°ï¼‰ã€‚</span></span><br><span class="line">			<span class="comment">// æœ€ç»ˆé‡æ’çš„bä¸ºl.c * l.size * l.sizeè¡Œï¼Œl.out_h * l.out_wåˆ—ã€‚</span></span><br><span class="line">			<span class="comment">// ä½ ä¼šå‘ç°åœ¨å‰å‘forward_convolutional_layer()å‡½æ•°ä¸­ï¼Œä¹Ÿä¸ºæ¯å±‚çš„è¾“å…¥è¿›è¡Œäº†é‡æ’ï¼Œä½†æ˜¯å¾ˆé—æ†¾çš„æ˜¯ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªl.workspaceæŠŠæ¯ä¸€å±‚çš„é‡æ’ç»“æœä¿å­˜ä¸‹æ¥ï¼Œè€Œæ˜¯ç»Ÿä¸€å­˜å‚¨åˆ°net.workspaceä¸­ï¼Œ</span></span><br><span class="line">			<span class="comment">// å¹¶è¢«ä¸æ–­æ“¦é™¤æ›´æ–°ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ä¿å­˜å‘¢ï¼Ÿä¿å­˜ä¸‹æ¥ä¸æ˜¯çœæ‰ä¸€å¤§ç¬”é¢å¤–é‡å¤è®¡ç®—å¼€é”€ï¼ŸåŸå› æœ‰ä¸¤ä¸ªï¼š1ï¼‰net.workspaceä¸­åªå­˜å‚¨äº†ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„é‡æ’ç»“æœï¼Œæ‰€ä»¥é‡æ’ä¸‹å¼ å›¾ç‰‡æ—¶ï¼Œé©¬ä¸Šå°±ä¼šè¢«æ“¦é™¤ï¼Œ</span></span><br><span class="line">			<span class="comment">// å½“ç„¶ä½ å¯èƒ½ä¼šæƒ³ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å¼„ä¸€ä¸ªl.worspaceså°†æ¯å±‚æ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„ç»“æœä¿å­˜å‘¢ï¼Ÿè¿™å¼•å‡ºç¬¬äºŒä¸ªåŸå› ï¼›2ï¼‰è®¡ç®—æˆæœ¬æ˜¯é™ä½äº†ï¼Œä½†å­˜å‚¨ç©ºé—´éœ€æ±‚æ€¥å‰§å¢åŠ ï¼Œæƒ³æƒ³æ¯ä¸€å±‚éƒ½æœ‰l.batchå¼ å›¾ï¼Œä¸”æ¯å¼ éƒ½æ˜¯å¤šé€šé“çš„ï¼Œ</span></span><br><span class="line">			<span class="comment">// é‡æ’åå…¶å…ƒç´ ä¸ªæ•°è¿˜ä¼šå¢å¤šï¼Œè¿™ä¸ªå­˜å‚¨é‡æè°éƒ½å—ä¸äº†ï¼Œå¦‚æœä¸€ä¸ªbatchæœ‰128å¼ å›¾ï¼Œè¾“å…¥å›¾ç‰‡å°ºå¯¸ä¸º400*400ï¼Œ3é€šé“ï¼Œç½‘ç»œæœ‰16å±‚ï¼ˆå‡è®¾æ¯å±‚è¾“å…¥è¾“å‡ºå°ºå¯¸åŠé€šé“æ•°éƒ½ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆå•å•ä¸ºäº†å­˜å‚¨è¿™äº›é‡æ’ç»“æœï¼Œ</span></span><br><span class="line">			<span class="comment">// å°±éœ€è¦128*400*400*3*16*4/1024/1024/1024 = 3.66Gï¼Œæ‰€ä»¥ä¸ºäº†æƒè¡¡ï¼Œåªèƒ½é‡å¤è®¡ç®—ï¼</span></span><br><span class="line">            <span class="built_in">im2col_cpu_ext</span>(</span><br><span class="line">                im,                 <span class="comment">// input</span></span><br><span class="line">                l.c / l.groups,     <span class="comment">// input channels</span></span><br><span class="line">                l.h, l.w,           <span class="comment">// input size (h, w)</span></span><br><span class="line">                l.size, l.size,     <span class="comment">// kernel size (h, w)</span></span><br><span class="line">                l.pad, l.pad,       <span class="comment">// padding (h, w)</span></span><br><span class="line">                l.stride_y, l.stride_x, <span class="comment">// stride (h, w)</span></span><br><span class="line">                l.dilation, l.dilation, <span class="comment">// dilation (h, w)</span></span><br><span class="line">                b);                 <span class="comment">// output</span></span><br><span class="line">			<span class="comment">// ä¸‹é¢è®¡ç®—å½“å‰å±‚çš„æƒé‡æ›´æ–°å€¼ï¼Œæ‰€è°“æƒé‡æ›´æ–°å€¼å°±æ˜¯weight = weight - alpha * weight_updateä¸­çš„weight_updateï¼Œ</span></span><br><span class="line">			<span class="comment">// æƒé‡æ›´æ–°å€¼ç­‰äºå½“å‰å±‚æ•æ„Ÿåº¦å›¾ä¸­æ¯ä¸ªå…ƒç´ ä¹˜ä»¥ç›¸åº”çš„åƒç´ å€¼ï¼Œå› ä¸ºä¸€ä¸ªæƒé‡è·Ÿå½“å‰å±‚å¤šä¸ªè¾“å‡ºæœ‰å…³è”ï¼ˆæƒå€¼å…±äº«ï¼Œå³å·ç§¯æ ¸åœ¨å›¾åƒä¸­è·¨æ­¥ç§»åŠ¨åšå·ç§¯ï¼Œæ¯ä¸ªä½ç½®å·ç§¯å¾—åˆ°çš„å€¼</span></span><br><span class="line">			<span class="comment">// éƒ½ä¸è¯¥æƒå€¼ç›¸å…³ï¼‰ï¼Œæ‰€ä»¥å¯¹æ¯ä¸€ä¸ªæƒé‡æ›´æ–°å€¼æ¥è¯´ï¼Œéœ€è¦åœ¨l.deltaä¸­æ‰¾å‡ºæ‰€æœ‰ä¸ä¹‹ç›¸å…³çš„æ•æ„Ÿåº¦ï¼Œä¹˜ä»¥ç›¸åº”åƒç´ å€¼ï¼Œå†æ±‚å’Œï¼Œå…·ä½“å®ç°çš„æ–¹å¼ä¾é im2col_cpu()ä¸gemm_nt()å®Œæˆã€‚</span></span><br><span class="line">			<span class="comment">// ï¼ˆbackward_convolutional_layeræ•´ä¸ªå‡½æ•°çš„ä»£ç éå¸¸é‡è¦ï¼Œä»…é æ–‡å­—æ²¡æœ‰å…¬å¼ä¸å›¾è¡¨è¾…åŠ©è¯´æ˜å¯èƒ½å¾ˆéš¾è¯´æ¸…ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ›´ä¸ºæ¸…æ™°è¯¦ç»†çš„è¯´æ˜ï¼Œè¯·å‚è€ƒä¸ªäººåšå®¢ï¼ï¼‰</span></span><br><span class="line">			<span class="comment">// GEneral Matrix to Matrix Multiplication</span></span><br><span class="line">			<span class="comment">// æ­¤å¤„åœ¨im2col_cpuæ“ä½œåŸºç¡€ä¸Šï¼Œåˆ©ç”¨çŸ©é˜µä¹˜æ³•c=alpha*a*b+beta*cå®Œæˆå¯¹å›¾åƒå·ç§¯çš„æ“ä½œï¼›</span></span><br><span class="line">			<span class="comment">// 0è¡¨ç¤ºä¸å¯¹è¾“å…¥aè¿›è¡Œè½¬ç½®ï¼Œ1è¡¨ç¤ºå¯¹è¾“å…¥bè¿›è¡Œè½¬ç½®ï¼›</span></span><br><span class="line">			<span class="comment">// mæ˜¯è¾“å…¥a,cçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºå·ç§¯æ ¸çš„ä¸ªæ•°(l.n)ï¼›</span></span><br><span class="line">			<span class="comment">// næ˜¯è¾“å…¥b,cçš„åˆ—æ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªå·ç§¯æ ¸å…ƒç´ ä¸ªæ•°ä¹˜ä»¥è¾“å…¥å›¾åƒçš„é€šé“æ•°(l.size*l.size*l.c)ï¼›</span></span><br><span class="line">			<span class="comment">// kæ˜¯è¾“å…¥açš„åˆ—æ•°ä¹Ÿæ˜¯bçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªè¾“å‡ºç‰¹å¾å›¾çš„å…ƒç´ ä¸ªæ•°ï¼ˆl.out_w*l.out_hï¼‰ï¼›</span></span><br><span class="line">			<span class="comment">// a,b,cå³ä¸ºä¸‰ä¸ªå‚ä¸è¿ç®—çš„çŸ©é˜µï¼ˆç”¨ä¸€ç»´æ•°ç»„å­˜å‚¨ï¼‰,alpha=beta=1ä¸ºå¸¸ç³»æ•°ï¼›</span></span><br><span class="line">			<span class="comment">// aä¸ºl.deltaçš„ä¸€å¤§è¡Œã€‚l.deltaä¸ºæœ¬å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ï¼ˆåŒ…å«æ•´ä¸ªbatchä¸­æ¯å¼ å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾ï¼‰å…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼ˆå³æ¿€æ´»å‡½æ•°çš„å¯¼æ•°å€¼ï¼‰é›†åˆ,</span></span><br><span class="line">			<span class="comment">// å…ƒç´ ä¸ªæ•°ä¸ºl.batch * l.out_h * l.out_w * l.out_cï¼ˆl.out_c = l.nï¼‰ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå…±æœ‰l.batchè¡Œï¼Œl.out_c * l.out_h * l.out_wåˆ—ï¼Œ</span></span><br><span class="line">			<span class="comment">// å³l.deltaä¸­æ¯è¡ŒåŒ…å«ä¸€å¼ å›¾çš„æ‰€æœ‰è¾“å‡ºå›¾ï¼Œæ•…è¿™ä¹ˆä¸€å¤§è¡Œï¼Œåˆå¯ä»¥è§†ä½œæœ‰l.out_cï¼ˆl.out_c=l.nï¼‰å°è¡Œï¼Œl.out_h*l*out_wå°åˆ—ï¼Œè€Œä¸€æ¬¡å¾ªç¯å°±æ˜¯å¤„ç†l.deltaçš„ä¸€å¤§è¡Œï¼Œ</span></span><br><span class="line">			<span class="comment">// æ•…å¯ä»¥å°†aè§†ä½œl.out_cè¡Œï¼Œl.out_h*l*out_wåˆ—çš„çŸ©é˜µï¼›</span></span><br><span class="line">			<span class="comment">// bä¸ºå•å¼ è¾“å…¥å›¾åƒç»è¿‡im2col_cpué‡æ’åçš„å›¾åƒæ•°æ®ï¼›</span></span><br><span class="line">			<span class="comment">// cä¸ºè¾“å‡ºï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå¯è§†ä½œæœ‰l.nè¡Œï¼Œl.c*l.size*l.sizeåˆ—ï¼ˆl.cæ˜¯è¾“å…¥å›¾åƒçš„é€šé“æ•°ï¼Œl.næ˜¯å·ç§¯æ ¸ä¸ªæ•°ï¼‰ï¼Œ</span></span><br><span class="line">			<span class="comment">// å³cå°±æ˜¯æ‰€è°“çš„è¯¯å·®é¡¹ï¼ˆè¾“å‡ºå…³äºåŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼‰ï¼Œæˆ–è€…æ•æ„Ÿåº¦ï¼ˆå¼ºçƒˆæ¨èï¼šhttps://www.zybuluo.com/hanbingtao/note/485480ï¼‰ï¼ˆä¸€ä¸ªæ ¸æœ‰l.c*l.size*l.sizeä¸ªæƒé‡ï¼Œå…±æœ‰l.nä¸ªæ ¸ï¼‰ã€‚</span></span><br><span class="line">			<span class="comment">// ç”±ä¸Šå¯çŸ¥ï¼š</span></span><br><span class="line">			<span class="comment">// a: (l.out_c) * (l.out_h*l*out_w)</span></span><br><span class="line">			<span class="comment">// b: (l.c * l.size * l.size) * (l.out_h * l.out_w)</span></span><br><span class="line">			<span class="comment">// c: (l.n) * (l.c*l.size*l.size)ï¼ˆæ³¨æ„ï¼šl.n = l.out_cï¼‰</span></span><br><span class="line">			<span class="comment">// æ•…è¦è¿›è¡Œa * b + cè®¡ç®—ï¼Œå¿…é¡»å¯¹bè¿›è¡Œè½¬ç½®ï¼ˆå¦åˆ™è¡Œåˆ—ä¸åŒ¹é…ï¼‰ï¼Œå› æ•…è°ƒç”¨gemm_nt()å‡½æ•°</span></span><br><span class="line">            <span class="built_in">gemm</span>(<span class="number">0</span>, <span class="number">1</span>, m, n, k, <span class="number">1</span>, a, k, b, k, <span class="number">1</span>, c, n);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ¥ä¸‹æ¥ï¼Œç”¨å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾l.deltaä»¥åŠæƒé‡l.weightsï¼ˆè¿˜æœªæ›´æ–°ï¼‰æ¥è·å–ä¸Šä¸€å±‚ç½‘ç»œçš„æ•æ„Ÿåº¦å›¾ï¼ŒBPç®—æ³•çš„ä¸»è¦æµç¨‹å°±æ˜¯ä¾é è¿™ç§å±‚ä¸å±‚ä¹‹é—´æ•æ„Ÿåº¦åå‘é€’æ¨ä¼ æ’­å…³ç³»æ¥å®ç°ã€‚</span></span><br><span class="line">			<span class="comment">// åœ¨network.cçš„backward_network()ä¸­ï¼Œä¼šä»æœ€åä¸€å±‚ç½‘ç»œå¾€å‰éå¾ªç¯å†è‡³ç¬¬ä¸€å±‚ï¼Œè€Œæ¯æ¬¡å¼€å§‹éå†æŸä¸€å±‚ç½‘ç»œä¹‹å‰ï¼Œéƒ½ä¼šæ›´æ–°net.inputä¸ºè¿™ä¸€å±‚ç½‘ç»œå‰ä¸€å±‚çš„è¾“å‡ºï¼Œå³prev.output,</span></span><br><span class="line">			<span class="comment">// åŒæ—¶æ›´æ–°net.deltaä¸ºprev.deltaï¼Œå› æ­¤ï¼Œè¿™é‡Œçš„net.deltaæ˜¯å½“å‰å±‚å‰ä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ã€‚</span></span><br><span class="line">			<span class="comment">// å·²ç»å¼ºè°ƒå¾ˆå¤šæ¬¡äº†ï¼Œå†è¯´ä¸€æ¬¡ï¼šä¸‹é¢å¾—åˆ°çš„ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å¹¶ä¸å®Œæ•´ï¼Œå®Œæ•´çš„æ•æ„Ÿåº¦å›¾æ˜¯æŸå¤±å‡½æ•°å¯¹ä¸Šä¸€å±‚çš„åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œ</span></span><br><span class="line">			<span class="comment">// è€Œè¿™é‡Œå¾—åˆ°çš„æ•æ„Ÿåº¦å›¾æ˜¯æŸå¤±å‡½æ•°å¯¹ä¸Šä¸€å±‚è¾“å‡ºå€¼çš„å¯¼æ•°ï¼Œè¿˜å·®ä¹˜ä»¥ä¸€ä¸ªè¾“å‡ºå€¼ä¹Ÿå³æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (state.delta) &#123;</span><br><span class="line">				<span class="comment">// å½“å‰å±‚è¿˜æœªæ›´æ–°çš„æƒé‡</span></span><br><span class="line">                a = l.weights + j*l.nweights / l.groups;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// æ¯æ¬¡å¾ªç¯ä»…å¤„ç†ä¸€å¼ è¾“å…¥å›¾ï¼Œæ³¨æ„ç§»ä½ï¼ˆl.deltaçš„ç»´åº¦ä¸ºl.batch * l.out_c * l.out_w * l.out_hï¼‰ï¼ˆæ³¨æ„l.n = l.out_cï¼Œå¦å¤–æä¸€ä¸‹ï¼Œå¯¹æ•´ä¸ªç½‘ç»œæ¥è¯´ï¼Œæ¯ä¸€å±‚çš„l.batchå…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼‰</span></span><br><span class="line">                b = l.delta + (i*l.groups + j)*m*k;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// net.workspaceå’Œä¸Šé¢ä¸€æ ·ï¼Œè¿˜æ˜¯ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„é‡æ’ï¼Œä¸åŒçš„æ˜¯ï¼Œæ­¤å¤„æˆ‘ä»¬åªéœ€è¦è¿™ä¸ªå®¹å™¨ï¼Œè€Œé‡Œé¢å­˜å‚¨çš„å€¼æˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œåœ¨åé¢çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œ</span></span><br><span class="line">				<span class="comment">// ä¼šå°†å…¶ä¸­å­˜å‚¨çš„å€¼ä¸€ä¸€è¦†ç›–æ‰ï¼ˆå°ºå¯¸ç»´æŒä¸å˜ï¼Œè¿˜æ˜¯(l.c * l.size * l.size) * (l.out_h * l.out_wï¼‰</span></span><br><span class="line">                c = state.workspace;</span><br><span class="line">				</span><br><span class="line">				 <span class="comment">// ç›¸æ¯”ä¸Šä¸€ä¸ªgemmï¼Œæ­¤å¤„çš„aå¯¹åº”ä¸Šä¸€ä¸ªçš„c,bå¯¹åº”ä¸Šä¸€ä¸ªçš„aï¼Œcå¯¹åº”ä¸Šä¸€ä¸ªçš„bï¼Œå³æ­¤å¤„a,b,cçš„è¡Œåˆ—åˆ†åˆ«ä¸ºï¼š</span></span><br><span class="line">				<span class="comment">// a: (l.n) * (l.c*l.size*l.size)ï¼Œè¡¨ç¤ºå½“å‰å±‚æ‰€æœ‰æƒé‡ç³»æ•°</span></span><br><span class="line">				<span class="comment">// b: (l.out_c) * (l.out_h*l*out_w)ï¼ˆæ³¨æ„ï¼šl.n = l.out_cï¼‰ï¼Œè¡¨ç¤ºå½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾</span></span><br><span class="line">				<span class="comment">// c: (l.c * l.size * l.size) * (l.out_h * l.out_w)ï¼Œè¡¨ç¤ºä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆå…¶å…ƒç´ ä¸ªæ•°ç­‰äºä¸Šä¸€å±‚ç½‘ç»œå•å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼‰ï¼Œ</span></span><br><span class="line">				<span class="comment">// æ­¤æ—¶è¦å®Œæˆa * b + cè®¡ç®—ï¼Œå¿…é¡»å¯¹aè¿›è¡Œè½¬ç½®ï¼ˆå¦åˆ™è¡Œåˆ—ä¸åŒ¹é…ï¼‰ï¼Œå› æ•…è°ƒç”¨gemm_tn()å‡½æ•°ã€‚</span></span><br><span class="line">				<span class="comment">// æ­¤æ“ä½œå«ä¹‰æ˜¯ç”¨ï¼šç”¨å½“å‰å±‚è¿˜æœªæ›´æ–°çš„æƒé‡å€¼å¯¹æ•æ„Ÿåº¦å›¾åšå·ç§¯ï¼Œå¾—åˆ°åŒ…å«ä¸Šä¸€å±‚æ‰€æœ‰æ•æ„Ÿåº¦ä¿¡æ¯çš„çŸ©é˜µï¼Œä½†è¿™ä¸æ˜¯ä¸Šä¸€å±‚æœ€ç»ˆçš„æ•æ„Ÿåº¦å›¾ï¼Œ</span></span><br><span class="line">				<span class="comment">// å› ä¸ºæ­¤æ—¶çš„cï¼Œä¹Ÿå³net.workspaceçš„å°ºå¯¸ä¸º(l.c * l.size * l.size) * (l.out_h * l.out_w)ï¼Œæ˜æ˜¾ä¸æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºå°ºå¯¸l.c*l.w*l.hï¼Œ</span></span><br><span class="line">				<span class="comment">// æ¥ä¸‹æ¥è¿˜éœ€è¦è°ƒç”¨col2im_cpu()å‡½æ•°å°†å…¶æ¢å¤è‡³l.c*l.w*l.hï¼ˆå¯è§†ä¸ºl.cè¡Œï¼Œl.w*l.håˆ—ï¼‰ï¼Œè¿™æ‰æ˜¯ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼ˆå®é™…è¿˜å·®ä¸€ä¸ªç¯èŠ‚ï¼Œ</span></span><br><span class="line">				<span class="comment">// è¿™ä¸ªç¯èŠ‚éœ€è¦ç­‰åˆ°ä¸‹ä¸€æ¬¡è°ƒç”¨backward_convolutional_layer()æ‰å®Œæˆï¼šå°†net.deltaä¸­æ¯ä¸ªå…ƒç´ ä¹˜ä»¥æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ï¼‰ã€‚</span></span><br><span class="line">				<span class="comment">// å®Œæˆgemmè¿™ä¸€æ­¥ï¼Œå¦‚col2im_cpu()ä¸­æ³¨é‡Šï¼Œæ˜¯è€ƒè™‘äº†å¤šä¸ªå·ç§¯æ ¸å¯¼è‡´çš„ä¸€å¯¹å¤šå…³ç³»ï¼ˆä¸Šä¸€å±‚çš„ä¸€ä¸ªè¾“å‡ºå…ƒç´ ä¼šæµå…¥åˆ°ä¸‹ä¸€å±‚å¤šä¸ªè¾“å‡ºå…ƒç´ ä¸­ï¼‰ï¼Œ</span></span><br><span class="line">				<span class="comment">// æ¥ä¸‹æ¥è°ƒç”¨col2im_cpu()åˆ™æ˜¯è€ƒè™‘å·ç§¯æ ¸é‡å ï¼ˆæ­¥é•¿è¾ƒå°ï¼‰å¯¼è‡´çš„ä¸€å¯¹å¤šå…³ç³»ã€‚</span></span><br><span class="line">                <span class="built_in">gemm</span>(<span class="number">1</span>, <span class="number">0</span>, n, k, m, <span class="number">1</span>, a, n, b, k, <span class="number">0</span>, c, k);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//col2im_cpu(state.workspace, l.c / l.groups, l.h, l.w, l.size, l.stride,</span></span><br><span class="line">                <span class="comment">//     l.pad, state.delta + (i*l.groups + j)*l.c / l.groups*l.h*l.w);</span></span><br><span class="line">				</span><br><span class="line">				<span class="comment">// å¯¹cä¹Ÿå³state.workspaceè¿›è¡Œé‡æ’ï¼Œå¾—åˆ°çš„ç»“æœå­˜å‚¨åœ¨state.deltaä¸­ï¼Œæ¯æ¬¡å¾ªç¯åªä¼šå¤„ç†ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼Œå› æ­¤ï¼Œæ­¤å¤„åªä¼šå¾—åˆ°ä¸€å¼ è¾“å…¥å›¾äº§ç”Ÿçš„æ•æ„Ÿå›¾ï¼ˆæ³¨æ„net.deltaçš„ç§»ä½ï¼‰,</span></span><br><span class="line">				<span class="comment">// æ•´ä¸ªå¾ªç¯ç»“æŸåï¼Œnet.deltaçš„æ€»å°ºå¯¸ä¸ºl.batch * l.h * l.w * l.cï¼Œè¿™å°±æ˜¯ä¸Šä¸€å±‚ç½‘ç»œæ•´ä¸ªbatchçš„æ•æ„Ÿåº¦å›¾ï¼Œå¯è§†ä¸ºæœ‰l.batchè¡Œï¼Œl.h*l.w*l.cåˆ—ï¼Œ</span></span><br><span class="line">				<span class="comment">// æ¯è¡Œå­˜å‚¨äº†ä¸€å¼ è¾“å…¥å›¾ç‰‡æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ•æ„Ÿåº¦</span></span><br><span class="line">				<span class="comment">// col2im_cpu()å‡½æ•°ä¸­ä¼šè°ƒç”¨col2im_add_pixel()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­ä½¿ç”¨äº†+=è¿ç®—ç¬¦ï¼Œä¹Ÿå³è¯¥å‡½æ•°è¦æ±‚è¾“å…¥çš„net.deltaçš„åˆå§‹å€¼ä¸º0,è€Œåœ¨gradient_array()ä¸­æ³¨é‡Šåˆ°l.deltaçš„å…ƒç´ æ˜¯ä¸ä¸º0ï¼ˆä¹Ÿä¸èƒ½ä¸º0ï¼‰çš„ï¼Œ</span></span><br><span class="line">				<span class="comment">// çœ‹ä¸Šå»æ˜¯çŸ›ç›¾çš„ï¼Œå®åˆ™ä¸ç„¶ï¼Œgradient_array()ä½¿ç”¨çš„l.deltaæ˜¯å½“å‰å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œè€Œåœ¨col2im_cpu()ä½¿ç”¨çš„net.deltaæ˜¯ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œæ­£å¦‚gradient_array()ä¸­æ‰€æ³¨é‡Šçš„ï¼Œ</span></span><br><span class="line">				<span class="comment">// å½“å‰å±‚l.deltaä¹‹æ‰€ä»¥ä¸ä¸º0,æ˜¯å› ä¸ºä»åé¢å±‚åå‘ä¼ æ’­è¿‡æ¥çš„ï¼Œå¯¹äºä¸Šä¸€å±‚ï¼Œæ˜¾ç„¶è¿˜æ²¡æœ‰åå‘ä¼ æ’­åˆ°é‚£ï¼Œå› æ­¤net.deltaçš„åˆå§‹å€¼éƒ½æ˜¯ä¸º0çš„ï¼ˆæ³¨æ„ï¼Œæ¯ä¸€å±‚åœ¨æ„å»ºæ—¶ï¼Œå°±ä¸ºå…¶deltaåŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œ</span></span><br><span class="line">				<span class="comment">// ä¸”åœ¨å‰å‘ä¼ æ’­æ—¶ï¼Œä¸ºæ¯ä¸€å±‚çš„deltaéƒ½èµ‹å€¼ä¸º0,å¯ä»¥å‚è€ƒnetwork.cä¸­forward_network()å‡½æ•°ï¼‰</span></span><br><span class="line">                <span class="built_in">col2im_cpu_ext</span>(</span><br><span class="line">                    state.workspace,        <span class="comment">// input</span></span><br><span class="line">                    l.c / l.groups,         <span class="comment">// input channels (h, w)</span></span><br><span class="line">                    l.h, l.w,               <span class="comment">// input size (h, w)</span></span><br><span class="line">                    l.size, l.size,         <span class="comment">// kernel size (h, w)</span></span><br><span class="line">                    l.pad, l.pad,           <span class="comment">// padding (h, w)</span></span><br><span class="line">                    l.stride_y, l.stride_x,     <span class="comment">// stride (h, w)</span></span><br><span class="line">                    l.dilation, l.dilation, <span class="comment">// dilation (h, w)</span></span><br><span class="line">                    state.delta + (i*l.groups + j)* (l.c / l.groups)*l.h*l.w); <span class="comment">// output (delta)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="col2imå‡½æ•°è§£æ"><a href="#col2imå‡½æ•°è§£æ" class="headerlink" title="col2imå‡½æ•°è§£æ"></a>col2imå‡½æ•°è§£æ</h2><p>col2imå‡½æ•°æ˜¯im2colçš„é€†è¿‡ç¨‹ï¼Œä»£ç åœ¨<code>src/col2im.c</code>ä¸­å®ç°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨é‡Šæ¥è‡ªhttps://github.com/hgpvision/darknet/blob/master/src/col2im.c</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  å°†è¾“å…¥å›¾åƒimçš„channelé€šé“ä¸Šçš„ç¬¬rowè¡Œï¼Œcolåˆ—åƒç´ ç°åº¦å€¼åŠ ä¸Švalï¼ˆç›´æ¥ä¿®æ”¹imçš„å€¼ï¼Œå› æ­¤imç›¸å½“äºæ˜¯è¿”å›å€¼ï¼‰</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šim         è¾“å…¥å›¾åƒ</span></span><br><span class="line"><span class="comment">**       channels   è¾“å…¥å›¾åƒçš„imé€šé“æ•°ï¼ˆè¿™ä¸ªå‚æ•°æ²¡ç”¨ã€‚ã€‚ã€‚ï¼‰</span></span><br><span class="line"><span class="comment">**       height     è¾“å…¥å›¾åƒimçš„é«˜åº¦ï¼ˆè¡Œï¼‰</span></span><br><span class="line"><span class="comment">**       width      è¾“å…¥å›¾åƒimçš„å®½åº¦ï¼ˆåˆ—ï¼‰</span></span><br><span class="line"><span class="comment">**       row        éœ€è¦åŠ ä¸Švalçš„åƒç´ æ‰€åœ¨çš„è¡Œæ•°ï¼ˆè¡¥é›¶ä¹‹åçš„è¡Œæ•°ï¼Œå› æ­¤éœ€è¦å…ˆå‡å»padæ‰èƒ½å¾—åˆ°çœŸæ­£åœ¨imä¸­çš„è¡Œæ•°ï¼‰</span></span><br><span class="line"><span class="comment">**       col        éœ€è¦åŠ ä¸Švalçš„åƒç´ æ‰€åœ¨çš„åˆ—æ•°ï¼ˆè¡¥é›¶ä¹‹åçš„åˆ—æ•°ï¼Œå› æ­¤éœ€è¦å…ˆå‡å»padæ‰èƒ½å¾—åˆ°çœŸæ­£åœ¨imä¸­çš„åˆ—æ•°ï¼‰</span></span><br><span class="line"><span class="comment">**       channel    éœ€è¦åŠ ä¸Švalçš„åƒç´ æ‰€åœ¨çš„é€šé“æ•°</span></span><br><span class="line"><span class="comment">**       pad        å››å‘¨è¡¥0é•¿åº¦</span></span><br><span class="line"><span class="comment">**       val        åƒç´ ç°åº¦æ·»åŠ å€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">col2im_add_pixel</span><span class="params">(<span class="keyword">float</span> *im, <span class="keyword">int</span> height, <span class="keyword">int</span> width, <span class="keyword">int</span> channels,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">int</span> row, <span class="keyword">int</span> col, <span class="keyword">int</span> channel, <span class="keyword">int</span> pad, <span class="keyword">float</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    row -= pad;</span><br><span class="line">    col -= pad;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &lt; <span class="number">0</span> || col &lt; <span class="number">0</span> ||</span><br><span class="line">        row &gt;= height || col &gt;= width) <span class="keyword">return</span>;</span><br><span class="line">    im[col + width*(row + height*channel)] += val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//This one might be too, can&#x27;t remember.</span></span><br><span class="line"><span class="comment">// æ³¨é‡Šæ¥è‡ªï¼šhttps://github.com/hgpvision/darknet/blob/master/src/col2im.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** æ­¤å‡½æ•°ä¸im2col_cpu()å‡½æ•°çš„æµç¨‹ç›¸åï¼Œç›®åœ°æ˜¯å°†im2col_cpu()å‡½æ•°é‡æ’å¾—åˆ°çš„å›¾ç‰‡data_colæ¢å¤è‡³æ­£å¸¸çš„å›¾åƒçŸ©é˜µæ’åˆ—ï¼Œå¹¶ä¸data_imç›¸åŠ ï¼Œæœ€ç»ˆdata_imç›¸å½“äºæ˜¯è¾“å‡ºå€¼ï¼Œ</span></span><br><span class="line"><span class="comment">** è¦æ³¨æ„çš„æ˜¯ï¼Œdata_imçš„å°ºå¯¸æ˜¯åœ¨å‡½æ•°å¤–ç¡®å®šçš„ï¼Œä¸”å¹¶æ²¡æœ‰æ˜¾ç¤ºçš„å°†data_colè½¬ä¸ºä¸€ä¸ªä¸data_imå°ºå¯¸ç›¸åŒçš„çŸ©é˜µï¼Œè€Œæ˜¯å°†å…¶ä¸­å…ƒç´ ç›´æ¥åŠ åœ¨data_imå¯¹åº”å…ƒç´ ä¸Šï¼ˆdata_imåˆå§‹æ‰€æœ‰å…ƒç´ å€¼éƒ½ä¸º0ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">** å¾—åˆ°çš„data_imå°ºå¯¸ä¸ºl.c*l.h*l.wï¼Œå³ä¸ºå½“å‰å±‚çš„è¾“å…¥å›¾åƒå°ºå¯¸ï¼Œä¸Šä¸€å±‚çš„è¾“å‡ºå›¾åƒå°ºå¯¸ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå¯è§†ä¸ºl.cè¡Œï¼Œl.h*l.wåˆ—ï¼Œå³å…¶ä¸­æ¯è¡Œå¯¹åº”ä¸€å¼ è¾“å‡ºç‰¹å¾å›¾çš„æ•æ„Ÿåº¦å›¾ï¼ˆå®é™…ä¸Šè¿™è¿˜ä¸æ˜¯æœ€ç»ˆçš„æ•æ„Ÿåº¦ï¼Œ</span></span><br><span class="line"><span class="comment">** è¿˜å·®ä¸€ä¸ªç¯èŠ‚ï¼šä¹˜ä»¥æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œè¿™å°†åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨backward_convolutional_layeæ—¶å®Œæˆï¼‰ã€‚</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment">** ä¸¾ä¸ªä¾‹å­ï¼šç¬¬L-1å±‚æ¯å¼ è¾“å…¥å›¾ç‰‡ï¼ˆæœ¬ä¾‹å­åªåˆ†æå•å¼ è¾“å…¥å›¾ç‰‡ï¼‰çš„è¾“å‡ºä¸º5*5*3ï¼ˆ3ä¸ºè¾“å‡ºé€šé“æ•°ï¼‰ï¼Œç¬¬Lå±‚å…±æœ‰2ä¸ªå·ç§¯æ ¸ï¼Œæ¯ä¸ªå·ç§¯æ ¸çš„å°ºå¯¸ä¸º3*3ï¼Œstride = 2,</span></span><br><span class="line"><span class="comment">**         ç¬¬L-1å±‚çš„è¾“å‡ºæ˜¯ç¬¬Lå±‚çš„è¾“å…¥ï¼Œç¬¬Lå±‚çš„2ä¸ªå·ç§¯æ ¸åŒæ—¶å¯¹ä¸Šä¸€å±‚3ä¸ªé€šé“çš„è¾“å‡ºåšå·ç§¯è¿ç®—ï¼Œä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œéœ€è¦è°ƒç”¨im2col_cpu()å‡½æ•°å°†</span></span><br><span class="line"><span class="comment">**         ä¸Šä¸€å±‚çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æœ¬å±‚çš„è¾“å…¥é‡æ’ä¸º27è¡Œ4åˆ—çš„å›¾ï¼Œä¹Ÿå°±æ˜¯ç”±5*5*3å˜æ¢è‡³27*4ï¼Œä½ ä¼šå‘ç°æ€»çš„å…ƒç´ ä¸ªæ•°å˜å¤šäº†ï¼ˆ75å¢å¤šåˆ°äº†98ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">**         è¿™æ˜¯å› ä¸ºå·ç§¯æ ¸stride=2,å°äºå·ç§¯æ ¸çš„å°ºå¯¸3,å› æ­¤å·ç§¯åœ¨ä¸¤ä¸ªè¿ç»­ä½ç½®åšå·ç§¯ï¼Œä¼šæœ‰é‡å éƒ¨åˆ†ï¼Œè€Œim2col_cpu()å‡½æ•°ä¸ºäº†ä¾¿äºå·ç§¯è¿ç®—ï¼Œå®Œå…¨å°†å…¶</span></span><br><span class="line"><span class="comment">**         é“ºæ’å¼€æ¥ï¼Œå¹¶æ²¡æœ‰åœ¨ç©ºé—´ä¸Šé¿å…é‡å¤å…ƒç´ ï¼Œå› æ­¤åƒç´ å…ƒç´ ä¼šå¢å¤šã€‚æ­¤å¤–ï¼Œä¹‹æ‰€ä»¥æ˜¯27è¡Œï¼Œæ˜¯å› ä¸ºå·ç§¯æ ¸å°ºå¯¸ä¸º3*3ï¼Œè€Œä¸Šä¸€å±‚çš„è¾“å‡ºå³æœ¬å±‚è¾“å…¥æœ‰3ä¸ªé€šé“ï¼Œ</span></span><br><span class="line"><span class="comment">**         ä¸ºäº†åŒæ—¶ç»™3ä¸ªé€šé“åšå·ç§¯è¿ç®—ï¼Œéœ€è¦å°†3ä¸ªé€šé“ä¸Šçš„è¾“å…¥ä¸€èµ·è€ƒè™‘ï¼Œå³å¾—åˆ°3*3*3è¡Œï¼Œ4åˆ—æ˜¯å› ä¸ºå¯¹äºå¯¹äº5*5çš„å›¾åƒï¼Œä½¿ç”¨3*3çš„å·ç§¯æ ¸ï¼Œstride=2çš„å·ç§¯è·¨åº¦ï¼Œ</span></span><br><span class="line"><span class="comment">**         æœ€ç»ˆä¼šå¾—åˆ°2*2çš„ç‰¹å¾å›¾ï¼Œä¹Ÿå°±æ˜¯4ä¸ªå…ƒç´ ã€‚é™¤äº†è°ƒç”¨im2col_cpu()å¯¹è¾“å…¥å›¾åƒåšé‡æ’ï¼Œç›¸åº”çš„ï¼Œä¹Ÿè¦å°†æ‰€æœ‰å·ç§¯æ ¸é‡æ’æˆä¸€ä¸ª2*27çš„çŸ©é˜µï¼Œä¸ºä»€ä¹ˆæ˜¯2å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">**         å› ä¸ºæœ‰ä¸¤ä¸ªå·ç§¯æ ¸ï¼Œä¸ºäº†åšåˆ°åŒæ—¶å°†ä¸¤ä¸ªå·ç§¯æ ¸ä½œç”¨åˆ°è¾“å…¥å›¾åƒä¸Šï¼Œéœ€è¦å°†ä¸¤ä¸ªæ ¸åˆåˆ°ä¸€ä¸ªçŸ©é˜µä¸­ï¼Œæ¯ä¸ªæ ¸å¯¹åº”ä¸€è¡Œï¼Œå› æ­¤æœ‰2è¡Œï¼Œé‚£ä¸ºä»€ä¹ˆæ˜¯27å‘¢ï¼Ÿæ¯ä¸ªæ ¸</span></span><br><span class="line"><span class="comment">**         å…ƒç´ ä¸ªæ•°ä¸æ˜¯3*3=9å—ï¼Ÿæ˜¯çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¦åŒæ—¶ä½œç”¨åˆ°3ä¸ªé€šé“ä¸Šï¼Œæ‰€ä»¥å®é™…ä¸€ä¸ªå·ç§¯æ ¸æœ‰9*3=27ä¸ªå…ƒç´ ã€‚ç»¼è¿°ï¼Œå¾—åˆ°2*27çš„å·ç§¯æ ¸çŸ©é˜µä¸27*4çš„è¾“å…¥å›¾åƒçŸ©é˜µï¼Œ</span></span><br><span class="line"><span class="comment">**         ä¸¤ä¸ªçŸ©é˜µç›¸ä¹˜ï¼Œå³å¯å®Œæˆå°†2ä¸ªå·ç§¯æ ¸åŒæ—¶ä½œç”¨äº3é€šé“çš„è¾“å…¥å›¾åƒä¸Šï¼ˆéå¸¸æ–¹ä¾¿ï¼Œä¸æ‰å‰é¢éè¿™ä¹ˆå¤§åŠ²çš„é‡æ’ï¼ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°2*4çš„çŸ©é˜µï¼Œè¿™2*4çŸ©é˜µåˆä»£è¡¨è¿™ä»€ä¹ˆå‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">**         2ä»£è¡¨è¿™æœ‰ä¸¤ä¸ªè¾“å‡ºå›¾ï¼ˆå¯¹åº”2ä¸ªå·ç§¯æ ¸ï¼Œå³l.out_c=2ï¼‰ï¼Œæ¯ä¸ªè¾“å‡ºå›¾å ä¸€è¡Œï¼Œ4ä»£è¡¨è¿™æ¯ä¸ªè¾“å‡ºå›¾å…ƒç´ æœ‰4ä¸ªï¼ˆå‰é¢è¯´äº†ï¼Œæ¯ä¸ªå·ç§¯æ ¸ä¼šå¾—åˆ°2*2çš„ç‰¹å¾å›¾ï¼Œå³l.out_h=l.out_w=2ï¼‰ã€‚è¿™ä¸ªä¾‹å­è¯´åˆ°è¿™ï¼Œåªè¯´å®Œäº†</span></span><br><span class="line"><span class="comment">**         å‰å‘ä¼ æ’­éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºim2col_cpu()è¿™ä¸ªå‡½æ•°çš„é‡è¦æ€§ã€‚è€Œæ­¤å¤„çš„col2im_cpu()æ˜¯ä¸€ä¸ªé€†è¿‡ç¨‹ï¼Œä¸»è¦ç”¨äºåå‘ä¼ æ’­ä¸­ï¼Œç”±Lå±‚çš„æ•æ„Ÿåº¦å›¾(sensitivity mapï¼Œ</span></span><br><span class="line"><span class="comment">**         å¯èƒ½æ¯ä¸ªåœ°æ–¹å«çš„ä¸ä¸€æ ·ï¼Œæ­¤å¤„å‚è€ƒåšå®¢ï¼šhttps://www.zybuluo.com/hanbingtao/note/485480)åå‘æ±‚å¾—ç¬¬L-1å±‚çš„æ•æ„Ÿåº¦å›¾ã€‚é¡ºæ‰¿ä¸Šé¢çš„ä¾‹å­ï¼Œç¬¬L-1å±‚çš„è¾“å‡º</span></span><br><span class="line"><span class="comment">**         æ˜¯ä¸€ä¸ª5*5*3ï¼ˆl.w=l.h=5,l.c=3ï¼‰çš„çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯æ•æ„Ÿåº¦å›¾çš„ç»´åº¦ä¸º5*5*3ï¼ˆæ¯ä¸ªè¾“å‡ºå…ƒç´ ï¼Œå¯¹åº”ä¸€ä¸ªæ•æ„Ÿåº¦å€¼ï¼‰ï¼Œç¬¬Lå±‚çš„è¾“å‡ºæ˜¯ä¸€ä¸ª2*4çš„çŸ©é˜µï¼Œæ•æ„Ÿåº¦å›¾çš„ç»´åº¦ä¸º2*4ï¼Œå‡è®¾å·²ç»è®¡ç®—å¾—åˆ°äº†</span></span><br><span class="line"><span class="comment">**         ç¬¬Lå±‚çš„2*4çš„æ•æ„Ÿåº¦å›¾ï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•ç”±ç¬¬Lå±‚çš„2*4æ•æ„Ÿåº¦å›¾ä»¥åŠ2ä¸ªå·ç§¯æ ¸ï¼ˆ2*27ï¼‰åå‘è·å–ç¬¬L-1å±‚çš„æ•æ„Ÿåº¦å›¾å‘¢ï¼Ÿä¸Šé¢ç»™çš„åšå®¢é“¾æ¥ç»™å‡ºäº†ä¸€ç§å¾ˆå¥½çš„æ±‚è§£æ–¹å¼ï¼Œ</span></span><br><span class="line"><span class="comment">**         ä½†darknetå¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå‰é¢æœ‰im2col_cpu()ï¼Œim2col_cpu()å‡½æ•°ä¸­çš„é‡æ’æ–¹å¼ï¼Œä½¿å¾—æˆ‘ä»¬ä¸å†éœ€è¦åšå®¢ä¸­æåˆ°çš„å°†sensitivity mapè¿˜åŸä¸ºæ­¥é•¿ä¸º1çš„sensitivity mapï¼Œ</span></span><br><span class="line"><span class="comment">**         åªéœ€å†ä½¿ç”¨col2im_cpu()å°±å¯ä»¥äº†ï¼è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Œçœ‹backward_convolutional_layer()å‡½æ•°ä¸­if(net.delta)ä¸­çš„è¯­å¥å°±çŸ¥é“äº†ï¼Œæ­¤å¤„ä»…è®¨è®ºcol2im_cpu()çš„è¿‡ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment">**         åœ¨backward_convolutional_layer()å·²ç»å¾—åˆ°äº†data_colï¼Œè¿™ä¸ªçŸ©é˜µå«æœ‰äº†æ‰€æœ‰çš„ç¬¬L-1å±‚æ•æ„Ÿåº¦çš„ä¿¡æ¯ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œä¸èƒ½ç›´æ¥ç”¨ï¼Œéœ€è¦æ•´ç†ï¼Œå› ä¸ºæ­¤æ—¶çš„data_colè¿˜æ˜¯ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">**         27*4çš„çŸ©é˜µï¼Œè€Œæˆ‘ä»¬çŸ¥é“ç¬¬L-1å±‚çš„æ•æ„Ÿåº¦å›¾æ˜¯ä¸€ä¸ª5*5*3çš„çŸ©é˜µï¼Œå¦‚ä½•å°†ä¸€ä¸ª27*4çš„çŸ©é˜µå˜æ¢è‡³ä¸€ä¸ª5*5*3çš„çŸ©é˜µæ˜¯æœ¬å‡½æ•°è¦å®Œæˆçš„å·¥ä½œï¼Œå‰é¢è¯´åˆ°27*4å…ƒç´ ä¸ªæ•°å¤šäº5*5*3,</span></span><br><span class="line"><span class="comment">**         å¾ˆæ˜¾ç„¶è¦ä»27*4å˜æ¢è‡³5*5*3ï¼Œè‚¯å®šä¼šå°†æŸäº›å…ƒç´ ç›¸åŠ åˆå¹¶ï¼ˆä¸‹é¢col2im_add_pixel()å‡½æ•°å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼‰ï¼Œå…·ä½“æ€æ ·ï¼Œå…ˆä¸è¯´ï¼Œå…ˆæ¥çœ‹çœ‹è¾“å…¥å‚æ•°éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€å§ï¼š</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šdata_col    backward_convolutional_layer()ä¸­è®¡ç®—å¾—åˆ°çš„åŒ…å«ä¸Šä¸€å±‚æ‰€æœ‰æ•æ„Ÿåº¦ä¿¡æ¯çš„çŸ©é˜µï¼Œè¡Œæ•°ä¸ºl.n*l.size*l.sizeï¼ˆlä»£è¡¨æœ¬å±‚/å½“å‰å±‚ï¼‰ï¼Œåˆ—æ•°ä¸ºl.out_h*l.out_wï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œè¡Œæ•°ä¸º27,åˆ—æ•°ä¸º4,ä¸Šä¸€å±‚ä¸ºç¬¬L-1å±‚ï¼Œæœ¬å±‚æ˜¯ç¬¬Lå±‚ï¼‰</span></span><br><span class="line"><span class="comment">**       channels    å½“å‰å±‚è¾“å…¥å›¾åƒçš„é€šé“æ•°ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸º3ï¼‰</span></span><br><span class="line"><span class="comment">**       height      å½“å‰å±‚è¾“å…¥å›¾åƒçš„è¡Œæ•°ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸º5ï¼‰</span></span><br><span class="line"><span class="comment">**       width       å½“å‰å±‚è¾“å…¥å›¾åƒçš„åˆ—æ•°ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸º5ï¼‰</span></span><br><span class="line"><span class="comment">**       ksize       å½“å‰å±‚å·ç§¯æ ¸å°ºå¯¸ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸º3ï¼‰</span></span><br><span class="line"><span class="comment">**       stride      å½“å‰å±‚å·ç§¯è·¨åº¦ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸º2ï¼‰</span></span><br><span class="line"><span class="comment">**       pad         å½“å‰å±‚å¯¹è¾“å…¥å›¾åƒåšå·ç§¯æ—¶å››å‘¨è¡¥0çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">**       data_im     ç»col2im_cpu()é‡æ’æ¢å¤ä¹‹åå¾—åˆ°çš„è¾“å‡ºçŸ©é˜µï¼Œä¹Ÿå³ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå°ºå¯¸ä¸ºl.c * l.h * l.wï¼ˆåˆšå¥½å°±æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºå½“å‰å±‚è¾“å…¥çš„å°ºå¯¸ï¼Œå¯¹äºæœ¬ä¾‹å­ï¼Œ5è¡Œ5åˆ—3é€šé“ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">**                   æ³¨æ„data_imçš„å°ºå¯¸ï¼Œæ˜¯åœ¨æœ¬å‡½æ•°ä¹‹å¤–å°±å·²ç»ç¡®å®šçš„ï¼Œä¸æ˜¯åœ¨æœ¬å‡½æ•°å†…éƒ¨è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸im2col_cpu()ä¸åŒï¼Œim2col_cpu()è®¡ç®—å¾—åˆ°çš„data_colçš„å°ºå¯¸éƒ½æ˜¯åœ¨å‡½æ•°å†…éƒ¨è®¡ç®—å¾—åˆ°çš„ï¼Œ</span></span><br><span class="line"><span class="comment">**                   å¹¶ä¸æ˜¯äº‹å…ˆæŒ‡å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œcol2im_cpu()å‡½æ•°å®Œæˆçš„æ˜¯æŒ‡å®šå°ºå¯¸çš„è¾“å…¥çŸ©é˜µå¾€æŒ‡å®šå°ºå¯¸çš„è¾“å‡ºçŸ©é˜µçš„è½¬æ¢ã€‚</span></span><br><span class="line"><span class="comment">** åŸç†ï¼šåŸç†æ¯”è¾ƒå¤æ‚ï¼Œå¾ˆéš¾ç”¨æ–‡å­—å™è¿°ï¼Œåšå®¢ï¼šhttps://www.zybuluo.com/hanbingtao/note/485480ä¸­åŸºæœ¬åŸç†è¯´å¾—å¾ˆè¯¦ç»†äº†ï¼Œä½†æ˜¯æ­¤å¤„çš„å®ç°ä¸åšå®¢ä¸­å¹¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å…·ä½“å®ç°çš„åŸç†æ­¤å¤„ç®€è¦å™è¿°ä¸€ä¸‹ï¼Œå…·ä½“è§ä¸ªäººåšå®¢ã€‚</span></span><br><span class="line"><span class="comment">**      ç¬¬L-1å±‚å¾—åˆ°l.h*l.w*l.cè¾“å‡ºï¼Œä¹Ÿæ˜¯ç¬¬Lå±‚çš„è¾“å…¥ï¼Œç»Lå±‚å·ç§¯åŠæ¿€æ´»å‡½æ•°å¤„ç†ä¹‹åï¼Œå¾—åˆ°l.out_h*l.out_w*l.out_cçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ç”±l.h*l.w*l.c--&gt;l.out_h*l.out_w*l.out_cï¼Œ</span></span><br><span class="line"><span class="comment">**      ç”±äºç¬¬Lå±‚æœ‰å¤šä¸ªå·ç§¯æ ¸ï¼Œæ‰€ä»¥ç¬¬L-1å±‚ä¸­çš„ä¸€ä¸ªè¾“å‡ºå…ƒç´ ä¼šæµå…¥åˆ°ç¬¬Lå±‚å¤šä¸ªè¾“å‡ºä¸­ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œç”±äºå·ç§¯æ ¸ä¹‹é—´çš„é‡å ï¼Œä¹Ÿå¯¼è‡´éƒ¨åˆ†å…ƒç´ æµå…¥åˆ°ç¬¬Lå±‚çš„å¤šä¸ªè¾“å‡ºä¸­ï¼Œè¿™ä¸¤ç§æƒ…å†µï¼Œéƒ½å¯¼è‡´ç¬¬L-1å±‚ä¸­çš„æŸä¸ªæ•æ„Ÿåº¦ä¼šä¸ç¬¬Lå±‚å¤šä¸ªè¾“å‡ºæœ‰å…³ï¼Œ</span></span><br><span class="line"><span class="comment">**      ä¸ºæ¸…æ™°ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è§£é‡Šï¼Œç¬¬L-1å±‚å¾—åˆ°5*5*3(3*25)çš„è¾“å‡ºï¼Œç¬¬Lå±‚å¾—åˆ°2*2*2ï¼ˆ2*4ï¼‰çš„è¾“å‡ºï¼Œåœ¨backward_convolutional_layer()å·²ç»è®¡ç®—å¾—åˆ°çš„data_colå®é™…æ˜¯27*2çŸ©é˜µä¸2*4çŸ©é˜µç›¸ä¹˜çš„ç»“æœï¼Œ</span></span><br><span class="line"><span class="comment">**      ä¸ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬è®°27*2çš„çŸ©é˜µä¸ºaï¼Œè®°2*4çŸ©é˜µä¸ºbï¼Œé‚£ä¹ˆaä¸­ä¸€è¡Œï¼ˆ2ä¸ªå…ƒç´ ï¼‰ä¸bä¸­ä¸€åˆ—ï¼ˆ2ä¸ªå…ƒç´ ï¼‰ç›¸ä¹˜å¯¹åº”è¿™ä»€ä¹ˆå‘¢ï¼Ÿå¯¹åº”ç¬¬ä¸€æƒ…å†µï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªå·ç§¯æ ¸ï¼Œä½¿å¾—L-1ä¸­ä¸€ä¸ªè¾“å‡ºè‡³å°‘ä¸Lå±‚ä¸­ä¸¤ä¸ªè¾“å‡ºæœ‰å…³ç³»ï¼Œç»æ­¤çŸ©é˜µç›¸ä¹˜ï¼Œå¾—åˆ°27*4çš„çŸ©é˜µï¼Œ</span></span><br><span class="line"><span class="comment">**      å·²ç»è€ƒè™‘äº†ç¬¬ä¸€ç§æƒ…å†µï¼ˆ27*4è¿™ä¸ªçŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸¤ä¸ªå·ç§¯æ ¸å½±å“ç»“æœçš„æ±‚å’Œï¼‰ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å°±æ˜¯è¦è€ƒè™‘ç¬¬äºŒç§æƒ…å†µï¼šå·ç§¯æ ¸é‡å å¯¼è‡´çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œå…·ä½“åšæ³•å°±æ˜¯å°†data_colä¸­å¯¹åº”ç›¸åŒåƒç´ çš„å€¼ç›¸åŠ ï¼Œè¿™æ˜¯ç”±</span></span><br><span class="line"><span class="comment">**      im2col_cpu()å‡½æ•°å†³å®šçš„ï¼ˆå¯ä»¥é…åˆim2col_cpu()æ¥ç†è§£ï¼‰ï¼Œå› ä¸ºim2col_cpu()å°†è¿™äº›é‡å å…ƒç´ ä¹Ÿé“ºé™ˆä¿å­˜åœ¨data_colä¸­ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ï¼Œåªè¦æŒ‰ç…§im2col_cpu()é€†å‘å°†è¿™äº›é‡å å…ƒç´ çš„å½±å“å åŠ å°±å¯ä»¥äº†ï¼Œ</span></span><br><span class="line"><span class="comment">**      å¤§è‡´å°±æ˜¯è¿™ä¸ªæ€è·¯ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚å¯èƒ½å¾—è§ä¸ªäººåšå®¢äº†ï¼ˆè¿™æ®µå†™çš„æœ‰ç‚¹ç½—å—¦ï½ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">col2im_cpu</span><span class="params">(<span class="keyword">float</span>* data_col,</span></span></span><br><span class="line"><span class="params"><span class="function">         <span class="keyword">int</span> channels,  <span class="keyword">int</span> height,  <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="params"><span class="function">         <span class="keyword">int</span> ksize,  <span class="keyword">int</span> stride, <span class="keyword">int</span> pad, <span class="keyword">float</span>* data_im)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c,h,w;</span><br><span class="line">	<span class="comment">// å½“å‰å±‚è¾“å‡ºå›¾çš„å°ºå¯¸ï¼ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œheight_col=2,width_col=2ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> height_col = (height + <span class="number">2</span>*pad - ksize) / stride + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> width_col = (width + <span class="number">2</span>*pad - ksize) / stride + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// å½“å‰å±‚æ¯ä¸ªå·ç§¯æ ¸åœ¨æ‰€æœ‰è¾“å…¥å›¾åƒé€šé“ä¸Šçš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œchannels_col=3*3*3=27ï¼‰</span></span><br><span class="line">    <span class="comment">// æ³¨æ„channels_colå®é™…æ˜¯data_colçš„è¡Œæ•°</span></span><br><span class="line">    <span class="keyword">int</span> channels_col = channels * ksize * ksize;</span><br><span class="line">	<span class="comment">// å¼€å§‹éå†ï¼šå¤–å¾ªç¯éå†data_colçš„æ¯ä¸€è¡Œï¼ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œdata_colå…±27è¡Œï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; channels_col; ++c) &#123;</span><br><span class="line">		<span class="comment">// åˆ—åç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå¹¶æŒ‰è¡Œå­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­ï¼Œåˆ©ç”¨æ±‚ä½™è¿ç®—è·å–å¯¹åº”åœ¨å·ç§¯æ ¸ä¸­çš„åˆ—æ•°ï¼Œæ¯”å¦‚å¯¹äº</span></span><br><span class="line">        <span class="comment">// 3*3çš„å·ç§¯æ ¸ï¼Œå½“c=0æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬ä¸€åˆ—ï¼Œå½“c=5æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬2åˆ—ï¼Œå½“c=9æ—¶ï¼Œåœ¨ç¬¬äºŒé€šé“ä¸Šçš„å·ç§¯æ ¸çš„ç¬¬ä¸€åˆ—</span></span><br><span class="line">        <span class="keyword">int</span> w_offset = c % ksize;</span><br><span class="line">		<span class="comment">// è¡Œåç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼Œä¸”æ˜¯æŒ‰è¡Œï¼ˆå·ç§¯æ ¸æ‰€æœ‰è¡Œå¹¶æˆä¸€è¡Œï¼‰å­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¯”å¦‚å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œå¤„ç†3é€šé“çš„å›¾åƒï¼Œé‚£ä¹ˆä¸€ä¸ªå·ç§¯æ ¸å…·æœ‰27ä¸ªå…ƒç´ ï¼Œæ¯9ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸ï¼ˆäº’ä¸ºä¸€æ ·ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¯å½“cä¸º3çš„å€æ•°ï¼Œå°±æ„å‘³ç€å·ç§¯æ ¸æ¢äº†ä¸€è¡Œï¼Œh_offsetå–å€¼ä¸º0,1,2</span></span><br><span class="line">        <span class="keyword">int</span> h_offset = (c / ksize) % ksize;</span><br><span class="line">		<span class="comment">// é€šé“åç§»ï¼Œchannels_colæ˜¯å¤šé€šé“çš„å·ç§¯æ ¸å¹¶åœ¨ä¸€èµ·çš„ï¼Œæ¯”å¦‚å¯¹äº3é€šé“ï¼Œ3*3å·ç§¯æ ¸ï¼Œæ¯è¿‡9ä¸ªå…ƒç´ å°±è¦æ¢ä¸€é€šé“æ•°ï¼Œ</span></span><br><span class="line">        <span class="comment">// å½“c=0~8æ—¶ï¼Œc_im=0;c=9~17æ—¶ï¼Œc_im=1;c=18~26æ—¶ï¼Œc_im=2</span></span><br><span class="line">        <span class="comment">// c_imæ˜¯data_imçš„é€šé“æ•°ï¼ˆå³ä¸Šä¸€å±‚è¾“å‡ºå½“å‰å±‚è¾“å…¥çš„é€šé“æ•°ï¼‰ï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œc_imå–å€¼ä¸º0,1,2</span></span><br><span class="line">        <span class="keyword">int</span> c_im = c / ksize / ksize;</span><br><span class="line">		<span class="comment">// ä¸­å¾ªç¯ä¸å†…å¾ªç¯å’Œèµ·æ¥åˆšå¥½éå†data_colçš„æ¯ä¸€è¡Œï¼ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œdata_colçš„åˆ—æ•°ä¸º4,height_col*width_col=4ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (h = <span class="number">0</span>; h &lt; height_col; ++h) &#123;</span><br><span class="line">            <span class="keyword">for</span> (w = <span class="number">0</span>; w &lt; width_col; ++w) &#123;</span><br><span class="line">				<span class="comment">// è·å–åœ¨è¾“å‡ºdata_imä¸­çš„è¡Œæ•°im_rowä¸åˆ—æ•°im_col</span></span><br><span class="line">                <span class="comment">// ç”±ä¸Šé¢å¯çŸ¥ï¼Œå¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œh_offsetå–å€¼ä¸º0,1,2,å½“h_offset=0æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ç¬¬ä¸€è¡Œå…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¾æ¬¡ç±»æ¨ï¼›åŠ ä¸Šh*strideæ˜¯å¯¹å·ç§¯æ ¸è¿›è¡Œè¡Œç§»ä½æ“ä½œï¼Œæ¯”å¦‚å·ç§¯æ ¸ä»å›¾åƒ(0,0)ä½ç½®å¼€å§‹åšå·ç§¯ï¼Œé‚£ä¹ˆæœ€å…ˆå¼€å§‹æ¶‰åŠ(0,0)~(3,3)</span></span><br><span class="line">                <span class="comment">// ä¹‹é—´çš„åƒç´ å€¼ï¼Œè‹¥stride=2ï¼Œé‚£ä¹ˆå·ç§¯æ ¸è¿›è¡Œè¡Œç§»ä½ä¸€æ¬¡æ—¶ï¼Œä¸‹ä¸€è¡Œçš„å·ç§¯æ“ä½œæ˜¯ä»å…ƒç´ (2,0)ï¼ˆ2ä¸ºå›¾åƒè¡Œå·ï¼Œ0ä¸ºåˆ—å·ï¼‰å¼€å§‹</span></span><br><span class="line">                <span class="keyword">int</span> im_row = h_offset + h * stride;</span><br><span class="line">				<span class="comment">// å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œw_offsetå–å€¼ä¹Ÿä¸º0,1,2ï¼Œå½“w_offsetå–1æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ä¸­ç¬¬2åˆ—å…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span></span><br><span class="line">                <span class="comment">// å®é™…åœ¨åšå·ç§¯æ“ä½œæ—¶ï¼Œå·ç§¯æ ¸å¯¹å›¾åƒé€è¡Œæ‰«æåšå·ç§¯ï¼ŒåŠ ä¸Šw*strideå°±æ˜¯ä¸ºäº†åšåˆ—ç§»ä½ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ¯”å¦‚å‰ä¸€æ¬¡å·ç§¯å…¶å®åƒç´ å…ƒç´ ä¸º(0,0)ï¼Œè‹¥stride=2,é‚£ä¹ˆä¸‹æ¬¡å·ç§¯å…ƒç´ èµ·å§‹åƒç´ ä½ç½®ä¸º(0,2)ï¼ˆ0ä¸ºè¡Œå·ï¼Œ2ä¸ºåˆ—å·ï¼‰</span></span><br><span class="line">                <span class="keyword">int</span> im_col = w_offset + w * stride;</span><br><span class="line">				<span class="comment">// è®¡ç®—åœ¨è¾“å‡ºdata_imä¸­çš„ç´¢å¼•å·</span></span><br><span class="line">                <span class="comment">// å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œim_rowçš„å–å€¼èŒƒå›´ä¸º0~4,im_colä»0~4ï¼Œcä»0~2ï¼ˆå…¶ä¸­h_offsetä»0~2,w_offsetä»0~2, hä»0~1,wä»0~1ï¼‰</span></span><br><span class="line">                <span class="comment">// è¾“å‡ºçš„data_imçš„å°ºå¯¸ä¸ºl.c * l.h * lwï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œä¸º3*5*5,å› æ­¤ï¼Œim_row,im_col,cçš„å–å€¼èŒƒå›´åˆšå¥½å¡«æ»¡data_im</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// è·å–data_colä¸­ç´¢å¼•ä¸ºcol_indexçš„å…ƒç´ ï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œdata_colä¸º27*4è¡Œï¼ŒæŒ‰è¡Œå­˜å‚¨</span></span><br><span class="line">                <span class="comment">// col_index = c * height_col * width_col + h * width_col + wé€è¡Œè¯»å–data_colä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line">                <span class="comment">// ç›¸åŒçš„im_row,im_colä¸c_imå¯èƒ½ä¼šå¯¹åº”å¤šä¸ªä¸åŒçš„col_indexï¼Œè¿™å°±æ˜¯å·ç§¯æ ¸é‡å å¸¦æ¥çš„å½±å“ï¼Œå¤„ç†çš„æ–¹å¼æ˜¯å°†è¿™äº›valéƒ½åŠ èµ·æ¥ï¼Œ</span></span><br><span class="line">                <span class="comment">// å­˜åœ¨data_imçš„ç¬¬im_row - padè¡Œï¼Œç¬¬im_col - padåˆ—ï¼ˆc_imé€šé“ä¸Šï¼‰ä¸­ã€‚</span></span><br><span class="line">                <span class="comment">// æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœå›ºå®šim_row = 0, im_col =2, c_im =0ï¼Œç”±c_im = 0å¯ä»¥çŸ¥é“cåœ¨0~8ä¹‹é—´ï¼Œç”±im_row=0,å¯ä»¥ç¡®å®šh = 0, h_offset =0ï¼Œ</span></span><br><span class="line">                <span class="comment">// å¯ä»¥å¾—åˆ°ä¸¤ç»„ï¼š1)w_offset = 0, w = 1; 2) w_offset = 2, w =0ï¼Œç¬¬ä¸€ç»„ï¼Œåˆ™å¯ä»¥å®Œå…¨å®šä¸‹ï¼šc=0,h=0,w=1ï¼Œæ­¤æ—¶col_index=1ï¼Œç”±ç¬¬äºŒç»„ï¼Œå¯å®Œå…¨å®šä¸‹ï¼šc=2,h=0,w=0ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ­¤æ—¶col_index = 2*2*2=8</span></span><br><span class="line">                <span class="keyword">int</span> col_index = (c * height_col + h) * width_col + w;</span><br><span class="line">                <span class="keyword">float</span> val = data_col[col_index];</span><br><span class="line">				<span class="comment">// ä»data_imæ‰¾å‡ºc_imé€šé“ä¸Šç¬¬im_row - padè¡Œim_col - padåˆ—å¤„çš„åƒç´ ï¼Œä½¿å…¶åŠ ä¸Šval</span></span><br><span class="line">                <span class="comment">// height, width, channelséƒ½æ˜¯ä¸Šä¸€å±‚è¾“å‡ºå³å½“å‰å±‚è¾“å…¥å›¾åƒçš„å°ºå¯¸ï¼Œä¹Ÿæ˜¯data_imçš„å°ºå¯¸ï¼ˆå¯¹äºæœ¬ä¾‹å­ï¼Œä¸‰è€…çš„å€¼åˆ†åˆ«ä¸º5,5,3ï¼‰,</span></span><br><span class="line">                <span class="comment">// im_row - pad,im_col - pad,c_iméƒ½æ˜¯æŸä¸€å…·ä½“å…ƒç´ åœ¨data_imä¸­çš„è¡Œæ•°ä¸åˆ—æ•°ä¸é€šé“æ•°ï¼ˆå› ä¸ºim_rowä¸im_colæ˜¯æ ¹æ®å·ç§¯è¿‡ç¨‹è®¡ç®—çš„ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ‰€ä»¥im_colå’Œim_rowä¸­å®é™…è¿˜åŒ…å«äº†è¡¥é›¶é•¿åº¦padï¼Œéœ€è¦å‡å»ä¹‹åï¼Œæ‰æ˜¯åŸæœ¬çš„æ²¡æœ‰è¡¥é›¶çŸ©é˜µdata_imä¸­çš„è¡Œåˆ—å·ï¼‰</span></span><br><span class="line">                <span class="built_in">col2im_add_pixel</span>(data_im, height, width, channels,</span><br><span class="line">                        im_row, im_col, c_im, pad, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å›¾ç¤º"><a href="#å›¾ç¤º" class="headerlink" title="å›¾ç¤º"></a>å›¾ç¤º</h2><p>ä¸Šé¢ä»‹ç»çš„åå‘ä¼ æ’­å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼Œæ›´å®¹æ˜“ç†è§£ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/659.webp" alt></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetå·ç§¯å±‚çš„å‰å‘ä¼ æ’­è§£æ</title>
    <url>/2020/02/23/AlexeyAB-DarkNet%E5%8D%B7%E7%A7%AF%E5%B1%82%E7%9A%84%E5%89%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©æ¥ä»‹ç»ä¸€ä¸‹DarkNetä¸­å·ç§¯å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„å®ç°ï¼Œå·ç§¯å±‚æ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œäº†è§£å®ƒçš„åº•å±‚ä»£ç å®ç°å¯¹æˆ‘ä»¬ç†è§£å·ç§¯ç¥ç»ç½‘ç»œä»¥åŠä¼˜åŒ–å·ç§¯ç¥ç»ç½‘ç»œéƒ½æœ‰ä¸€äº›å¸®åŠ©ã€‚</p>
<h2 id="å·ç§¯å±‚çš„æ„é€ "><a href="#å·ç§¯å±‚çš„æ„é€ " class="headerlink" title="å·ç§¯å±‚çš„æ„é€ "></a>å·ç§¯å±‚çš„æ„é€ </h2><p>å·ç§¯å±‚çš„æ„é€ ä¸»è¦åœ¨<code>src/convolutional_layer.c</code>ä¸­çš„<code>make_convolutional_layer</code>ä¸­è¿›è¡Œå®ç°ï¼Œä¸‹é¢ç»™å‡ºéƒ¨åˆ†æ ¸å¿ƒä»£ç ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** batch æ¯ä¸ªbatchå«æœ‰çš„å›¾ç‰‡æ•°</span></span><br><span class="line"><span class="comment">** step</span></span><br><span class="line"><span class="comment">** h å›¾åƒé«˜åº¦(è¡Œæ•°)</span></span><br><span class="line"><span class="comment">** w å›¾åƒå®½åº¦(åˆ—æ•°)</span></span><br><span class="line"><span class="comment">** c è¾“å…¥å›¾åƒé€šé“æ•°</span></span><br><span class="line"><span class="comment">** n å·ç§¯æ ¸ä¸ªæ•°</span></span><br><span class="line"><span class="comment">** groups åˆ†ç»„æ•°</span></span><br><span class="line"><span class="comment">** size å·ç§¯æ ¸å°ºå¯¸</span></span><br><span class="line"><span class="comment">** stride æ­¥é•¿</span></span><br><span class="line"><span class="comment">** dilation ç©ºæ´å·ç§¯ç©ºæ´ç‡</span></span><br><span class="line"><span class="comment">** padding å››å‘¨è¡¥0é•¿åº¦</span></span><br><span class="line"><span class="comment">** activation æ¿€æ´»å‡½æ•°ç±»åˆ«</span></span><br><span class="line"><span class="comment">** batch_normalize æ˜¯å¦è¿›è¡ŒBN</span></span><br><span class="line"><span class="comment">** binary æ˜¯å¦å¯¹æƒé‡è¿›è¡ŒäºŒå€¼åŒ–</span></span><br><span class="line"><span class="comment">** xnor æ˜¯å¦å¯¹æƒé‡ä»¥åŠè¾“å…¥è¿›è¡ŒäºŒå€¼åŒ–</span></span><br><span class="line"><span class="comment">** adam ä¼˜åŒ–æ–¹å¼</span></span><br><span class="line"><span class="comment">** use_bin_output</span></span><br><span class="line"><span class="comment">** index åˆ†ç»„å·ç§¯çš„æ—¶å€™åˆ†ç»„ç´¢å¼•</span></span><br><span class="line"><span class="comment">** antialiasing æŠ—é”¯é½¿æ ‡å¿—ï¼Œå¦‚æœä¸ºçœŸå¼ºè¡Œè®¾ç½®æ‰€æœ‰çš„æ­¥é•¿ä¸º1</span></span><br><span class="line"><span class="comment">** share_layer æ ‡å¿—å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸€ä¸ªå·ç§¯å±‚æ˜¯å¦å’Œå…¶å®ƒå·ç§¯å±‚å…±äº«æƒé‡</span></span><br><span class="line"><span class="comment">** assisted_excitation</span></span><br><span class="line"><span class="comment">** deform æš‚æ—¶ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment">** train æ ‡å¿—å‚æ•°ï¼Œæ˜¯å¦åœ¨è®­ç»ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">convolutional_layer <span class="title">make_convolutional_layer</span><span class="params">(<span class="keyword">int</span> batch, <span class="keyword">int</span> steps, <span class="keyword">int</span> h, <span class="keyword">int</span> w, <span class="keyword">int</span> c, <span class="keyword">int</span> n, <span class="keyword">int</span> groups, <span class="keyword">int</span> size, <span class="keyword">int</span> stride_x, <span class="keyword">int</span> stride_y, <span class="keyword">int</span> dilation, <span class="keyword">int</span> padding, ACTIVATION activation,</span></span></span><br><span class="line"><span class="params"><span class="function"> <span class="keyword">int</span> batch_normalize, <span class="keyword">int</span> binary, <span class="keyword">int</span> xnor, <span class="keyword">int</span> adam, <span class="keyword">int</span> use_bin_output, <span class="keyword">int</span> index, <span class="keyword">int</span> antialiasing, convolutional_layer *share_layer, <span class="keyword">int</span> assisted_excitation, <span class="keyword">int</span> deform, <span class="keyword">int</span> train)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> total_batch = batch*steps;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    convolutional_layer l = &#123; (LAYER_TYPE)<span class="number">0</span> &#125;;</span><br><span class="line">    l.type = CONVOLUTIONAL;</span><br><span class="line">    l.train = train;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (xnor) groups = <span class="number">1</span>;   <span class="comment">//å¯¹äºäºŒå€¼ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨åˆ†ç»„å·ç§¯</span></span><br><span class="line">    <span class="keyword">if</span> (groups &lt; <span class="number">1</span>) groups = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> blur_stride_x = stride_x;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> blur_stride_y = stride_y;</span><br><span class="line">    l.antialiasing = antialiasing;</span><br><span class="line">    <span class="keyword">if</span> (antialiasing) &#123;</span><br><span class="line">        stride_x = stride_y = l.stride = l.stride_x = l.stride_y = <span class="number">1</span>; <span class="comment">// use stride=1 in host-layer</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    l.deform = deform;</span><br><span class="line">    l.assisted_excitation = assisted_excitation;</span><br><span class="line">    l.share_layer = share_layer;</span><br><span class="line">    l.index = index;</span><br><span class="line">    l.h = h;</span><br><span class="line">    l.w = w;</span><br><span class="line">    l.c = c;</span><br><span class="line">    l.groups = groups;</span><br><span class="line">    l.n = n;</span><br><span class="line">    l.binary = binary;</span><br><span class="line">    l.xnor = xnor;</span><br><span class="line">    l.use_bin_output = use_bin_output;</span><br><span class="line">    l.batch = batch;</span><br><span class="line">    l.steps = steps;</span><br><span class="line">    l.stride = stride_x;</span><br><span class="line">    l.stride_x = stride_x;</span><br><span class="line">    l.stride_y = stride_y;</span><br><span class="line">    l.dilation = dilation;</span><br><span class="line">    l.size = size;</span><br><span class="line">    l.pad = padding;</span><br><span class="line">    l.batch_normalize = batch_normalize;</span><br><span class="line">    l.learning_rate_scale = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// è¯¥å·ç§¯å±‚æ€»çš„æƒé‡å…ƒç´ ä¸ªæ•°ï¼ˆæƒé‡å…ƒç´ ä¸ªæ•°ç­‰äºè¾“å…¥æ•°æ®çš„é€šé“æ•°/åˆ†ç»„æ•°*å·ç§¯æ ¸ä¸ªæ•°*å·ç§¯æ ¸çš„äºŒç»´å°ºå¯¸ï¼Œæ³¨æ„å› ä¸ºæ¯ä¸€ä¸ªå·ç§¯æ ¸æ˜¯åŒæ—¶ä½œç”¨äºè¾“å…¥æ•°æ®</span></span><br><span class="line">    <span class="comment">// çš„å¤šä¸ªé€šé“ä¸Šçš„ï¼Œå› æ­¤å®é™…ä¸Šå·ç§¯æ ¸æ˜¯ä¸‰ç»´çš„ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªç»´åº¦çš„å¹³é¢å°ºå¯¸ï¼Œä»¥åŠè¾“å…¥æ•°æ®é€šé“æ•°è¿™ä¸ªç»´åº¦ï¼Œæ¯ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸å‚æ•°éƒ½æ˜¯ç‹¬ç«‹çš„è®­ç»ƒå‚æ•°ï¼‰</span></span><br><span class="line">    l.nweights = (c / groups) * n * size * size;</span><br><span class="line">	<span class="comment">// å¦‚æœæ˜¯å…±äº«å·ç§¯å±‚ï¼Œå¯ä»¥ç›´æ¥ç”¨å…±äº«çš„å·ç§¯å±‚æ¥èµ‹å€¼ï¼ˆçŒœæµ‹æ˜¯æœ‰é¢„è®­ç»ƒæƒé‡çš„æ—¶å€™å¯ä»¥ç›´æ¥èµ‹å€¼ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (l.share_layer) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l.size != l.share_layer-&gt;size || l.nweights != l.share_layer-&gt;nweights || l.c != l.share_layer-&gt;c || l.n != l.share_layer-&gt;n) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Layer size, nweights, channels or filters don&#x27;t match for the share_layer&quot;</span>);</span><br><span class="line">            <span class="built_in">getchar</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        l.weights = l.share_layer-&gt;weights;</span><br><span class="line">        l.weight_updates = l.share_layer-&gt;weight_updates;</span><br><span class="line"></span><br><span class="line">        l.biases = l.share_layer-&gt;biases;</span><br><span class="line">        l.bias_updates = l.share_layer-&gt;bias_updates;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// è¯¥å·ç§¯å±‚æ€»çš„æƒé‡å…ƒç´ (å·ç§¯æ ¸å…ƒç´ )ä¸ªæ•°=è¾“å…¥å›¾åƒé€šé“æ•° / åˆ†ç»„æ•°*å·ç§¯æ ¸ä¸ªæ•°*å·ç§¯æ ¸å°ºå¯¸</span></span><br><span class="line">        l.weights = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(l.nweights, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">		<span class="comment">// biaså°±æ˜¯Wx+bä¸­çš„bï¼ˆä¸Šé¢çš„weightså°±æ˜¯Wï¼‰ï¼Œæœ‰å¤šå°‘ä¸ªå·ç§¯æ ¸ï¼Œå°±æœ‰å¤šå°‘ä¸ªbï¼ˆä¸Wçš„ä¸ªæ•°ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸ªWçš„å…ƒç´ ä¸ªæ•°ä¸ºc*size*sizeï¼‰</span></span><br><span class="line">        l.biases = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(n, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">		<span class="comment">// è®­ç»ƒæœŸé—´ï¼Œéœ€è¦æ‰§è¡Œåå‘ä¼ æ’­</span></span><br><span class="line">        <span class="keyword">if</span> (train) &#123;</span><br><span class="line">			<span class="comment">// æ•æ„Ÿå›¾å’Œç‰¹å¾å›¾çš„å°ºå¯¸åº”è¯¥æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">            l.weight_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(l.nweights, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">			<span class="comment">// biasçš„æ•æ„Ÿå›¾ï¼Œç»´åº¦å’Œbiasä¸€è‡´</span></span><br><span class="line">            l.bias_updates = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(n, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// float scale = 1./sqrt(size*size*c);</span></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–æƒé‡ï¼šç¼©æ”¾å› å­*æ ‡å‡†æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼Œç¼©æ”¾å› å­ç­‰äºsqrt(2./(size*size*c))ï¼Œéšæœºåˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// æ­¤å¤„åˆå§‹åŒ–æƒé‡ä¸ºæ­£æ€åˆ†å¸ƒï¼Œè€Œåœ¨å…¨è¿æ¥å±‚make_connected_layer()ä¸­åˆå§‹åŒ–æƒé‡æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚</span></span><br><span class="line">    <span class="comment">// TODOï¼šä¸ªäººæ„Ÿè§‰ï¼Œè¿™é‡Œåº”è¯¥åŠ ä¸€ä¸ªifæ¡ä»¶è¯­å¥ï¼šif(weightfile)ï¼Œå› ä¸ºå¦‚æœå¯¼å…¥äº†é¢„è®­ç»ƒæƒé‡æ–‡ä»¶ï¼Œå°±æ²¡æœ‰å¿…è¦è¿™æ ·åˆå§‹åŒ–äº†ï¼ˆäº‹å®ä¸Šåœ¨detector.cçš„train_detector()å‡½æ•°ä¸­ï¼Œ</span></span><br><span class="line">    <span class="comment">// ç´§æ¥ç€parse_network_cfg()å‡½æ•°ä¹‹åï¼Œå°±æ·»åŠ äº†if(weightfile)è¯­å¥åˆ¤æ–­æ˜¯å¦å¯¼å…¥æƒé‡ç³»æ•°æ–‡ä»¶ï¼Œå¦‚æœå¯¼å…¥äº†æƒé‡ç³»æ•°æ–‡ä»¶ï¼Œä¹Ÿè®¸è¿™é‡Œåˆå§‹åŒ–çš„å€¼ä¹Ÿä¼šè¦†ç›–æ‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ€»ä¹‹è¿™é‡Œçš„æƒé‡åˆå§‹åŒ–çš„å¤„ç†æ–¹å¼è¿˜æ˜¯å€¼å¾—æ€è€ƒçš„ï¼Œä¹Ÿè®¸æ›´å¥½çš„æ–¹å¼æ˜¯åº”è¯¥è®¾ç½®ä¸“é—¨çš„å‡½æ•°è¿›è¡Œæƒé‡çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶åç½®ä¹Ÿæ˜¯ï¼Œä¸è¿‡è¿™é‡Œä¼¼ä¹æ²¡æœ‰è€ƒè™‘åç½®çš„åˆå§‹åŒ–ï¼Œåœ¨make_connected_layer()ä¸­å€’æ˜¯æœ‰ã€‚ã€‚ã€‚ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> scale = <span class="built_in">sqrt</span>(<span class="number">2.</span>/(size*size*c/groups));</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.nweights; ++i) l.weights[i] = scale*<span class="built_in">rand_uniform</span>(<span class="number">-1</span>, <span class="number">1</span>);   <span class="comment">// rand_normal();</span></span><br><span class="line">	<span class="comment">// æ ¹æ®è¯¥å±‚è¾“å…¥å›¾åƒçš„å°ºå¯¸ã€å·ç§¯æ ¸å°ºå¯¸ä»¥åŠè·¨åº¦è®¡ç®—è¾“å‡ºç‰¹å¾å›¾çš„å®½åº¦å’Œé«˜åº¦</span></span><br><span class="line">    <span class="keyword">int</span> out_h = <span class="built_in">convolutional_out_height</span>(l);</span><br><span class="line">    <span class="keyword">int</span> out_w = <span class="built_in">convolutional_out_width</span>(l);</span><br><span class="line">	<span class="comment">// è¾“å‡ºå›¾åƒé«˜åº¦</span></span><br><span class="line">    l.out_h = out_h;</span><br><span class="line">	<span class="comment">// è¾“å‡ºå›¾åƒå®½åº¦	</span></span><br><span class="line">    l.out_w = out_w;</span><br><span class="line">	<span class="comment">// è¾“å‡ºå›¾åƒé€šé“æ•°(ç­‰äºå·ç§¯æ ¸ä¸ªæ•°,æœ‰å¤šå°‘ä¸ªå·ç§¯æ ¸ï¼Œæœ€ç»ˆå°±å¾—åˆ°å¤šå°‘å¼ ç‰¹å¾å›¾ï¼Œæ¯å¼ ç‰¹å¾å›¾æ˜¯ä¸€ä¸ªé€šé“)</span></span><br><span class="line">    l.out_c = n;</span><br><span class="line">    l.outputs = l.out_h * l.out_w * l.out_c; <span class="comment">// å¯¹åº”æ¯å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆæ¯å¼ è¾“å…¥å›¾ç‰‡ä¼šå¾—åˆ°nä¹Ÿå³l.out_cå¼ ç‰¹å¾å›¾ï¼‰</span></span><br><span class="line">    l.inputs = l.w * l.h * l.c; <span class="comment">// mini-batchä¸­æ¯å¼ è¾“å…¥å›¾ç‰‡çš„åƒç´ å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    l.activation = activation;</span><br><span class="line"></span><br><span class="line">    l.output = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(total_batch*l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>)); <span class="comment">// l.outputä¸ºè¯¥å±‚æ‰€æœ‰çš„è¾“å‡ºï¼ˆåŒ…æ‹¬mini-batchæ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼‰</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> GPU</span></span><br><span class="line">    <span class="keyword">if</span> (train) l.delta = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(total_batch*l.outputs, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));  <span class="comment">// l.delta è¯¥å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå’Œè¾“å‡ºçš„ç»´åº¦æƒ³åŒ</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// not GPU</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å·ç§¯å±‚ä¸‰ç§æŒ‡é’ˆå‡½æ•°ï¼Œå¯¹åº”ä¸‰ç§è®¡ç®—ï¼šå‰å‘ï¼Œåå‘ï¼Œæ›´æ–°</span></span><br><span class="line">    l.forward = forward_convolutional_layer;</span><br><span class="line">    l.backward = backward_convolutional_layer;</span><br><span class="line">    l.update = update_convolutional_layer;</span><br></pre></td></tr></table></figure>
<h2 id="å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ"><a href="#å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ" class="headerlink" title="å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ"></a>å·ç§¯å±‚å‰å‘ä¼ æ’­çš„ä»£ç è§£æ</h2><p>ä»£ç åœ¨<code>src/convolutional_layer.c</code>ä¸­ï¼Œæ³¨é‡Šå¦‚ä¸‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å·ç§¯å±‚çš„å‰å‘ä¼ æ’­æ ¸å¿ƒä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_convolutional_layer</span><span class="params">(convolutional_layer l, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> out_h = <span class="built_in">convolutional_out_height</span>(l);</span><br><span class="line">    <span class="keyword">int</span> out_w = <span class="built_in">convolutional_out_width</span>(l);</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="comment">// l.outputs = l.out_h * l.out_w * l.out_cåœ¨makeå„ç½‘ç»œå±‚å‡½æ•°ä¸­èµ‹å€¼ï¼ˆæ¯”å¦‚make_convolutional_layer()ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯¹åº”æ¯å¼ è¾“å…¥å›¾ç‰‡çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾çš„æ€»å…ƒç´ ä¸ªæ•°ï¼ˆæ¯å¼ è¾“å…¥å›¾ç‰‡ä¼šå¾—åˆ°nä¹Ÿå³l.out_cå¼ ç‰¹å¾å›¾ï¼‰</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è¾“å‡ºl.outputå…¨ä¸º0.0ï¼›è¾“å…¥l.outputs*l.batchä¸ºè¾“å‡ºçš„æ€»å…ƒç´ ä¸ªæ•°ï¼Œå…¶ä¸­l.outputsä¸ºbatch</span></span><br><span class="line">    <span class="comment">// ä¸­ä¸€ä¸ªè¾“å…¥å¯¹åº”çš„è¾“å‡ºçš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°ï¼Œl.batchä¸ºä¸€ä¸ªbatchè¾“å…¥åŒ…å«çš„å›¾ç‰‡å¼ æ•°ï¼›0è¡¨ç¤ºåˆå§‹åŒ–æ‰€æœ‰è¾“å‡ºä¸º0ï¼›</span></span><br><span class="line">    <span class="built_in">fill_cpu</span>(l.outputs*l.batch, <span class="number">0</span>, l.output, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ˜¯å¦è¿›è¡ŒäºŒå€¼åŒ–æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (l.xnor &amp;&amp; (!l.align_bit_weights || state.train)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!l.align_bit_weights || state.train) &#123;</span><br><span class="line">            <span class="built_in">binarize_weights</span>(l.weights, l.n, l.nweights, l.binary_weights);</span><br><span class="line">            <span class="comment">//printf(&quot;\n binarize_weights l.align_bit_weights = %p \n&quot;, l.align_bit_weights);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">swap_binary</span>(&amp;l);</span><br><span class="line">        <span class="built_in">binarize_cpu</span>(state.input, l.c*l.h*l.w*l.batch, l.binary_input);</span><br><span class="line">        state.input = l.binary_input;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> m = l.n / l.groups; <span class="comment">// è¯¥å±‚çš„å·ç§¯æ ¸ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">int</span> k = l.size*l.size*l.c / l.groups; <span class="comment">// è¯¥å±‚æ¯ä¸ªå·ç§¯æ ¸çš„å‚æ•°å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">int</span> n = out_h*out_w; <span class="comment">// è¯¥å±‚æ¯ä¸ªç‰¹å¾å›¾çš„å°ºå¯¸(å…ƒç´ ä¸ªæ•°)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    u++;</span><br><span class="line">    <span class="comment">// è¯¥å¾ªç¯å³ä¸ºå·ç§¯è®¡ç®—æ ¸å¿ƒä»£ç ï¼šæ‰€æœ‰å·ç§¯æ ¸å¯¹batchä¸­æ¯å¼ å›¾ç‰‡è¿›è¡Œå·ç§¯è¿ç®—</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡å¾ªç¯å¤„ç†ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼ˆæ‰€æœ‰å·ç§¯æ ¸å¯¹batchä¸­ä¸€å¼ å›¾ç‰‡åšå·ç§¯è¿ç®—ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; l.batch; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">// è¯¥å¾ªç¯æ˜¯ä¸ºäº†å¤„ç†åˆ†ç»„å·ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; l.groups; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">// å½“å‰ç»„å·ç§¯æ ¸(ä¹Ÿå³æƒé‡)ï¼Œå…ƒç´ ä¸ªæ•°ä¸ºl.n*l.c/l.groups*l.size*l.size,</span></span><br><span class="line">            <span class="comment">// å…±æœ‰l.nè¡Œï¼Œl.c/l.gropus,l.c*l.size*l.sizeåˆ—</span></span><br><span class="line">            <span class="keyword">float</span> *a = l.weights +j*l.nweights / l.groups;</span><br><span class="line">			<span class="comment">// å¯¹è¾“å…¥å›¾åƒè¿›è¡Œé‡æ’ä¹‹åçš„å›¾åƒæ•°æ®ï¼Œæ‰€ä»¥å†…å­˜ç©ºé—´ç”³è¯·ä¸ºç½‘ç»œä¸­æœ€å¤§å ç”¨å†…å­˜</span></span><br><span class="line">            <span class="keyword">float</span> *b = state.workspace;</span><br><span class="line">			<span class="comment">// å­˜å‚¨ä¸€å¼ è¾“å…¥å›¾ç‰‡ï¼ˆå¤šé€šé“ï¼‰å½“å‰ç»„çš„è¾“å‡ºç‰¹å¾å›¾ï¼ˆè¾“å…¥å›¾ç‰‡æ˜¯å¤šé€šé“çš„ï¼Œè¾“å‡º</span></span><br><span class="line">            <span class="comment">// å›¾ç‰‡ä¹Ÿæ˜¯å¤šé€šé“çš„ï¼Œæœ‰å¤šå°‘ç»„å·ç§¯æ ¸å°±æœ‰å¤šå°‘ç»„é€šé“ï¼Œæ¯ä¸ªåˆ†ç»„åçš„å·ç§¯æ ¸å¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾å³ä¸ºä¸€ä¸ªé€šé“ï¼‰</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œä¼¼ä¹æœ‰ç‚¹æ‹—å£ï¼Œå¯ä»¥çœ‹ä¸‹åˆ†ç»„å·ç§¯åŸç†ã€‚</span></span><br><span class="line">            <span class="keyword">float</span> *c = l.output +(i*l.groups + j)*n*m;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//gemm(0,0,m,n,k,1,a,k,b,n,1,c,n);</span></span><br><span class="line">            <span class="comment">//gemm_nn_custom(m, n, k, 1, a, k, b, n, c, n);</span></span><br><span class="line">			<span class="comment">//äºŒå€¼ç½‘ç»œï¼Œç‰¹æ®Šå¤„ç†ï¼Œé‡Œé¢è¿˜æœ‰ä¸€äº›ä¼˜åŒ–ï¼Œç»†èŠ‚å¾ˆå¤šï¼Œè¿™é‡Œæš‚æ—¶ä¸ç®¡äºŒå€¼ç½‘ç»œè¿™éƒ¨åˆ†ï¼ŒæŠŠæ³¨æ„åŠ›å…ˆæ”¾åœ¨æ™®é€šå·ç§¯å±‚çš„è®¡ç®—ä¸Š</span></span><br><span class="line">            <span class="keyword">if</span> (l.xnor &amp;&amp; l.align_bit_weights &amp;&amp; !state.train &amp;&amp; l.stride_x == l.stride_y)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">memset</span>(b, <span class="number">0</span>, l.bit_align*l.size*l.size*l.c * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (l.c % <span class="number">32</span> == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//printf(&quot; l.index = %d - new XNOR \n&quot;, l.index);</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span> ldb_align = l.lda_align;</span><br><span class="line">                    <span class="keyword">size_t</span> new_ldb = k + (ldb_align - k%ldb_align); <span class="comment">// (k / 8 + 1) * 8;</span></span><br><span class="line">                    <span class="comment">//size_t t_intput_size = new_ldb * l.bit_align;// n;</span></span><br><span class="line">                    <span class="comment">//size_t t_bit_input_size = t_intput_size / 8;// +1;</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span> re_packed_input_size = l.c * l.w * l.h;</span><br><span class="line">                    <span class="built_in">memset</span>(state.workspace, <span class="number">0</span>, re_packed_input_size * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">const</span> <span class="keyword">size_t</span> new_c = l.c / <span class="number">32</span>;</span><br><span class="line">                    <span class="keyword">size_t</span> in_re_packed_input_size = new_c * l.w * l.h + <span class="number">1</span>;</span><br><span class="line">                    <span class="built_in">memset</span>(l.bin_re_packed_input, <span class="number">0</span>, in_re_packed_input_size * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">uint32_t</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//float *re_packed_input = calloc(l.c * l.w * l.h, sizeof(float));</span></span><br><span class="line">                    <span class="comment">//uint32_t *bin_re_packed_input = calloc(new_c * l.w * l.h + 1, sizeof(uint32_t));</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// float32x4 by channel (as in cuDNN)</span></span><br><span class="line">                    <span class="built_in">repack_input</span>(state.input, state.workspace, l.w, l.h, l.c);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 32 x floats -&gt; 1 x uint32_t</span></span><br><span class="line">                    <span class="built_in">float_to_bit</span>(state.workspace, (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)l.bin_re_packed_input, l.c * l.w * l.h);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//free(re_packed_input);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// slow - convolution the packed inputs and weights: float x 32 by channel (as in cuDNN)</span></span><br><span class="line">                    <span class="comment">//convolution_repacked((uint32_t *)bin_re_packed_input, (uint32_t *)l.align_bit_weights, l.output,</span></span><br><span class="line">                    <span class="comment">//    l.w, l.h, l.c, l.n, l.size, l.pad, l.new_lda, l.mean_arr);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// // then exit from if()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="built_in">im2col_cpu_custom</span>((<span class="keyword">float</span> *)l.bin_re_packed_input, new_c, l.h, l.w, l.size, l.stride, l.pad, state.workspace);</span><br><span class="line">                    <span class="comment">//im2col_cpu((float *)bin_re_packed_input, new_c, l.h, l.w, l.size, l.stride, l.pad, b);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//free(bin_re_packed_input);</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span> new_k = l.size*l.size*l.c / <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// good for (l.c == 64)</span></span><br><span class="line">                    <span class="comment">//gemm_nn_bin_32bit_packed(m, n, new_k, 1,</span></span><br><span class="line">                    <span class="comment">//    l.align_bit_weights, l.new_lda/32,</span></span><br><span class="line">                    <span class="comment">//    b, n,</span></span><br><span class="line">                    <span class="comment">//    c, n, l.mean_arr);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// // then exit from if()</span></span><br><span class="line"></span><br><span class="line">                    <span class="built_in">transpose_uint32</span>((<span class="keyword">uint32_t</span> *)state.workspace, (<span class="keyword">uint32_t</span>*)l.t_bit_input, new_k, n, n, new_ldb);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// the main GEMM function</span></span><br><span class="line">                    <span class="built_in">gemm_nn_custom_bin_mean_transposed</span>(m, n, k, <span class="number">1</span>, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)l.align_bit_weights, new_ldb, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)l.t_bit_input, new_ldb, c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// // alternative GEMM</span></span><br><span class="line">                    <span class="comment">//gemm_nn_bin_transposed_32bit_packed(m, n, new_k, 1,</span></span><br><span class="line">                    <span class="comment">//    l.align_bit_weights, l.new_lda/32,</span></span><br><span class="line">                    <span class="comment">//    t_bit_input, new_ldb / 32,</span></span><br><span class="line">                    <span class="comment">//    c, n, l.mean_arr);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//free(t_bit_input);</span></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123; <span class="comment">// else (l.c % 32 != 0)</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//--------------------------------------------------------</span></span><br><span class="line">                    <span class="comment">//printf(&quot; l.index = %d - old XNOR \n&quot;, l.index);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//im2col_cpu_custom_align(state.input, l.c, l.h, l.w, l.size, l.stride, l.pad, b, l.bit_align);</span></span><br><span class="line">                    <span class="built_in">im2col_cpu_custom_bin</span>(state.input, l.c, l.h, l.w, l.size, l.stride, l.pad, state.workspace, l.bit_align);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//size_t output_size = l.outputs;</span></span><br><span class="line">                    <span class="comment">//float *count_output = calloc(output_size, sizeof(float));</span></span><br><span class="line">                    <span class="comment">//size_t bit_output_size = output_size / 8 + 1;</span></span><br><span class="line">                    <span class="comment">//char *bit_output = calloc(bit_output_size, sizeof(char));</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//size_t intput_size = n * k; // (out_h*out_w) X (l.size*l.size*l.c) : after im2col()</span></span><br><span class="line">                    <span class="comment">//size_t bit_input_size = intput_size / 8 + 1;</span></span><br><span class="line">                    <span class="comment">//char *bit_input = calloc(bit_input_size, sizeof(char));</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//size_t weights_size = k * m; //l.size*l.size*l.c*l.n; // l.nweights</span></span><br><span class="line">                    <span class="comment">//size_t bit_weights_size = weights_size / 8 + 1;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//char *bit_weights = calloc(bit_weights_size, sizeof(char));</span></span><br><span class="line">                    <span class="comment">//float *mean_arr = calloc(l.n, sizeof(float));</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// transpose B from NxK to KxN (x-axis (ldb = l.size*l.size*l.c) - should be multiple of 8 bits)</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">//size_t ldb_align = 256; // 256 bit for AVX2</span></span><br><span class="line">                        <span class="keyword">int</span> ldb_align = l.lda_align;</span><br><span class="line">                        <span class="keyword">size_t</span> new_ldb = k + (ldb_align - k%ldb_align);</span><br><span class="line">                        <span class="keyword">size_t</span> t_intput_size = <span class="built_in">binary_transpose_align_input</span>(k, n, state.workspace, &amp;l.t_bit_input, ldb_align, l.bit_align);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 5x times faster than gemm()-float32</span></span><br><span class="line">                        <span class="built_in">gemm_nn_custom_bin_mean_transposed</span>(m, n, k, <span class="number">1</span>, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)l.align_bit_weights, new_ldb, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)l.t_bit_input, new_ldb, c, n, l.mean_arr);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//gemm_nn_custom_bin_mean_transposed(m, n, k, 1, bit_weights, k, t_bit_input, new_ldb, c, n, mean_arr);</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">//free(t_input);</span></span><br><span class="line">                        <span class="comment">//free(t_bit_input);</span></span><br><span class="line">                        <span class="comment">//&#125;</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">add_bias</span>(l.output, l.biases, l.batch, l.n, out_h*out_w);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//activate_array(l.output, m*n*l.batch, l.activation);</span></span><br><span class="line">                <span class="keyword">if</span> (l.activation == SWISH) <span class="built_in">activate_array_swish</span>(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == MISH) <span class="built_in">activate_array_mish</span>(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN) <span class="built_in">activate_array_normalize_channels</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN_SOFTMAX) <span class="built_in">activate_array_normalize_channels_softmax</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN_SOFTMAX_MAXVAL) <span class="built_in">activate_array_normalize_channels_softmax</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">activate_array_cpu_custom</span>(l.output, m*n*l.batch, l.activation);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//printf(&quot; l.index = %d - FP32 \n&quot;, l.index);</span></span><br><span class="line">				<span class="comment">// ç”±äºæœ‰åˆ†ç»„å·ç§¯ï¼Œæ‰€ä»¥è·å–å±äºå½“å‰ç»„çš„è¾“å…¥imå¹¶æŒ‰ä¸€å®šå­˜å‚¨è§„åˆ™æ’åˆ—çš„æ•°ç»„bï¼Œ</span></span><br><span class="line">				<span class="comment">// ä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°è¿›è¡ŒçŸ©é˜µï¼ˆå·ç§¯ï¼‰è®¡ç®—ï¼Œè¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span></span><br><span class="line">				<span class="comment">// è¿™é‡Œçš„imå®é™…ä¸ŠåªåŠ è½½äº†ä¸€å¼ å›¾ç‰‡çš„æ•°æ®</span></span><br><span class="line">				<span class="comment">// å…³äºim2colçš„åŸç†æˆ‘ä¼šè®²</span></span><br><span class="line">                <span class="keyword">float</span> *im = state.input + (i*l.groups + j)*(l.c / l.groups)*l.h*l.w;</span><br><span class="line">				<span class="comment">// å¦‚æœè¿™é‡Œå·ç§¯æ ¸å°ºå¯¸ä¸º1ï¼Œæ˜¯ä¸éœ€è¦æ”¹å˜å†…å­˜æ’å¸ƒæ–¹å¼</span></span><br><span class="line">                <span class="keyword">if</span> (l.size == <span class="number">1</span>) &#123;</span><br><span class="line">                    b = im;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//im2col_cpu(im, l.c / l.groups, l.h, l.w, l.size, l.stride, l.pad, b);</span></span><br><span class="line">					<span class="comment">// å°†å¤šé€šé“äºŒç»´å›¾åƒimå˜æˆæŒ‰ä¸€å®šå­˜å‚¨è§„åˆ™æ’åˆ—çš„æ•°ç»„bï¼Œ</span></span><br><span class="line">					<span class="comment">// ä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°è¿›è¡ŒçŸ©é˜µï¼ˆå·ç§¯ï¼‰è®¡ç®—ï¼Œè¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span></span><br><span class="line">					<span class="comment">// è¿›è¡Œé‡æ’ï¼Œl.c/groupsä¸ºæ¯å¼ å›¾ç‰‡çš„é€šé“æ•°åˆ†ç»„ï¼Œl.hä¸ºæ¯å¼ å›¾ç‰‡çš„é«˜åº¦ï¼Œl.wä¸ºæ¯å¼ å›¾ç‰‡çš„å®½åº¦ï¼Œl.sizeä¸ºå·ç§¯æ ¸å°ºå¯¸ï¼Œl.strideä¸ºæ­¥é•¿</span></span><br><span class="line">					<span class="comment">// å¾—åˆ°çš„bä¸ºä¸€å¼ å›¾ç‰‡é‡æ’åçš„ç»“æœï¼Œä¹Ÿæ˜¯æŒ‰è¡Œå­˜å‚¨çš„ä¸€ç»´æ•°ç»„ï¼ˆå…±æœ‰l.c/l.groups*l.size*l.sizeè¡Œï¼Œl.out_w*l.out_håˆ—ï¼‰</span></span><br><span class="line">                    <span class="built_in">im2col_cpu_ext</span>(im,   <span class="comment">// input</span></span><br><span class="line">                        l.c / l.groups,     <span class="comment">// input channels</span></span><br><span class="line">                        l.h, l.w,           <span class="comment">// input size (h, w)</span></span><br><span class="line">                        l.size, l.size,     <span class="comment">// kernel size (h, w)</span></span><br><span class="line">                        l.pad, l.pad,       <span class="comment">// padding (h, w)</span></span><br><span class="line">                        l.stride_y, l.stride_x, <span class="comment">// stride (h, w)</span></span><br><span class="line">                        l.dilation, l.dilation, <span class="comment">// dilation (h, w)</span></span><br><span class="line">                        b);                 <span class="comment">// output</span></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// æ­¤å¤„åœ¨im2col_cpuæ“ä½œåŸºç¡€ä¸Šï¼Œåˆ©ç”¨çŸ©é˜µä¹˜æ³•c=alpha*a*b+beta*cå®Œæˆå¯¹å›¾åƒå·ç§¯çš„æ“ä½œ</span></span><br><span class="line">				<span class="comment">// 0,0è¡¨ç¤ºä¸å¯¹è¾“å…¥a,bè¿›è¡Œè½¬ç½®ï¼Œ</span></span><br><span class="line">				<span class="comment">// mæ˜¯è¾“å…¥a,cçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªå·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œ</span></span><br><span class="line">				<span class="comment">// næ˜¯è¾“å…¥b,cçš„åˆ—æ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºæ¯ä¸ªè¾“å‡ºç‰¹å¾å›¾çš„å…ƒç´ ä¸ªæ•°(out_h*out_w)ï¼Œ</span></span><br><span class="line">				<span class="comment">// kæ˜¯è¾“å…¥açš„åˆ—æ•°ä¹Ÿæ˜¯bçš„è¡Œæ•°ï¼Œå…·ä½“å«ä¹‰ä¸ºå·ç§¯æ ¸å…ƒç´ ä¸ªæ•°ä¹˜ä»¥è¾“å…¥å›¾åƒçš„é€šé“æ•°é™¤ä»¥åˆ†ç»„æ•°ï¼ˆl.size*l.size*l.c/l.groupsï¼‰ï¼Œ</span></span><br><span class="line">				<span class="comment">// a,b,cå³ä¸ºä¸‰ä¸ªå‚ä¸è¿ç®—çš„çŸ©é˜µï¼ˆç”¨ä¸€ç»´æ•°ç»„å­˜å‚¨ï¼‰,alpha=beta=1ä¸ºå¸¸ç³»æ•°ï¼Œ</span></span><br><span class="line">				<span class="comment">// aä¸ºæ‰€æœ‰å·ç§¯æ ¸é›†åˆ,å…ƒç´ ä¸ªæ•°ä¸ºl.n*l.c/l.groups*l.size*l.sizeï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå…±æœ‰l*nè¡Œï¼Œl.c/l.groups*l.size*l.sizeåˆ—ï¼Œ</span></span><br><span class="line">				<span class="comment">// å³aä¸­æ¯è¡Œä»£è¡¨ä¸€ä¸ªå¯ä»¥ä½œç”¨åœ¨3é€šé“ä¸Šçš„å·ç§¯æ ¸ï¼Œ</span></span><br><span class="line">				<span class="comment">// bä¸ºä¸€å¼ è¾“å…¥å›¾åƒç»è¿‡im2col_cpué‡æ’åçš„å›¾åƒæ•°æ®ï¼ˆå…±æœ‰l.c/l.group*l.size*l.sizeè¡Œï¼Œl.out_w*l.out_håˆ—ï¼‰ï¼Œ</span></span><br><span class="line">				<span class="comment">// cä¸ºgemm()è®¡ç®—å¾—åˆ°çš„å€¼ï¼ŒåŒ…å«ä¸€å¼ è¾“å…¥å›¾ç‰‡å¾—åˆ°çš„æ‰€æœ‰è¾“å‡ºç‰¹å¾å›¾ï¼ˆæ¯ä¸ªå·ç§¯æ ¸å¾—åˆ°ä¸€å¼ ç‰¹å¾å›¾ï¼‰ï¼Œcä¸­ä¸€è¡Œä»£è¡¨ä¸€å¼ ç‰¹å¾å›¾ï¼Œ</span></span><br><span class="line">				<span class="comment">// å„ç‰¹å¾å›¾é“ºæ’å¼€æˆä¸€è¡Œåï¼Œå†å°†æ‰€æœ‰ç‰¹å¾å›¾å¹¶æˆä¸€å¤§è¡Œï¼Œå­˜å‚¨åœ¨cä¸­ï¼Œå› æ­¤cå¯è§†ä½œæœ‰l.nè¡Œï¼Œl.out_h*l.out_wåˆ—ã€‚</span></span><br><span class="line">				<span class="comment">// è¯¦ç»†æŸ¥çœ‹è¯¥å‡½æ•°æ³¨é‡Šï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰</span></span><br><span class="line">                <span class="built_in">gemm</span>(<span class="number">0</span>, <span class="number">0</span>, m, n, k, <span class="number">1</span>, a, k, b, n, <span class="number">1</span>, c, n);</span><br><span class="line">                <span class="comment">// bit-count to float</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//c += n*m;</span></span><br><span class="line">            <span class="comment">//state.input += l.c*l.h*l.w;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// å¦‚æœå·ç§¯å±‚ä½¿ç”¨äº†BatchNormï¼Œé‚£ä¹ˆæ‰§è¡Œforward_batchnormï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ åç½®</span></span><br><span class="line">    <span class="keyword">if</span>(l.batch_normalize)&#123;</span><br><span class="line">        forward_batchnorm_layer(l, state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">add_bias</span>(l.output, l.biases, l.batch, l.n, out_h*out_w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//activate_array(l.output, m*n*l.batch, l.activation);</span></span><br><span class="line">	<span class="comment">// ä½¿ç”¨ä¸åŒçš„æ¿€æ´»å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (l.activation == SWISH) <span class="built_in">activate_array_swish</span>(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == MISH) <span class="built_in">activate_array_mish</span>(l.output, l.outputs*l.batch, l.activation_input, l.output);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN) <span class="built_in">activate_array_normalize_channels</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN_SOFTMAX) <span class="built_in">activate_array_normalize_channels_softmax</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l.activation == NORM_CHAN_SOFTMAX_MAXVAL) <span class="built_in">activate_array_normalize_channels_softmax</span>(l.output, l.outputs*l.batch, l.batch, l.out_c, l.out_w*l.out_h, l.output, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">activate_array_cpu_custom</span>(l.output, l.outputs*l.batch, l.activation);</span><br><span class="line">	<span class="comment">// äºŒå€¼ç½‘ç»œï¼Œå‰å‘ä¼ æ’­ç»“æŸä¹‹åè½¬å›float</span></span><br><span class="line">    <span class="keyword">if</span>(l.binary || l.xnor) <span class="built_in">swap_binary</span>(&amp;l);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//visualize_convolutional_layer(l, &quot;conv_visual&quot;, NULL);</span></span><br><span class="line">    <span class="comment">//wait_until_press_key_cv();</span></span><br><span class="line">	<span class="comment">// æš‚æ—¶ä¸æ‡‚</span></span><br><span class="line">    <span class="keyword">if</span>(l.assisted_excitation &amp;&amp; state.train) <span class="built_in">assisted_excitation_forward</span>(l, state);</span><br><span class="line">	<span class="comment">// æš‚æ—¶ä¸æ‡‚</span></span><br><span class="line">    <span class="keyword">if</span> (l.antialiasing) &#123;</span><br><span class="line">        network_state s = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        s.train = state.train;</span><br><span class="line">        s.workspace = state.workspace;</span><br><span class="line">        s.net = state.net;</span><br><span class="line">        s.input = l.output;</span><br><span class="line">        forward_convolutional_layer(*(l.input_layer), s);</span><br><span class="line">        <span class="comment">//simple_copy_ongpu(l.outputs*l.batch, l.output, l.input_antialiasing);</span></span><br><span class="line">        <span class="built_in">memcpy</span>(l.output, l.input_layer-&gt;output, l.input_layer-&gt;outputs * l.input_layer-&gt;batch * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="im2colè§£æ"><a href="#im2colè§£æ" class="headerlink" title="im2colè§£æ"></a>im2colè§£æ</h2><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œå·ç§¯å±‚çš„å‰å‘ä¼ æ’­æ ¸å¿ƒç‚¹æ˜¯im2colæ“ä½œè¿˜æœ‰sgemmçŸ©é˜µè®¡ç®—æ–¹æ³•å¯¹ä½¿ç”¨im2colè¿›è¡Œé‡æ’åçš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ç°åœ¨æ¥è§£æä¸€ä¸‹im2colç®—æ³•ï¼Œsgemmç®—æ³•å°±æ˜¯im2colè¿è¡Œåç›´æ¥è°ƒç”¨å³å¯ï¼Œå°±ä¸ç»†è®²äº†ã€‚</p>
<p>è¿™é‡Œè€ƒè™‘åˆ°ç»“åˆå›¾ç‰‡æ›´å®¹æ˜“ç†è§£im2colçš„æ€æƒ³ï¼Œæˆ‘åˆ©ç”¨CSDN Tiger-Gaoåšä¸»çš„å›¾æè¿°ä¸€ä¸‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ªå•é€šé“çš„é•¿å®½å‡ä¸º4çš„å›¾ç‰‡é€šè¿‡im2colé‡æ–°æ’å¸ƒåä¼šå˜æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿçœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/649.webp" alt></p>
<p>æ¥å…·ä½“çœ‹ä¸€ä¸‹å˜åŒ–è¿‡ç¨‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/650.webp" alt></p>
<p>è¿™æ˜¯å•é€šé“çš„å˜åŒ–è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¤šé€šé“çš„å‘¢ï¼Ÿé¦–å…ˆæ¥çœ‹åŸå›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/651.png" alt></p>
<p>å¤šé€šé“çš„im2colçš„è¿‡ç¨‹ï¼Œæ˜¯é¦–å…ˆim2colç¬¬ä¸€é€šé“ï¼Œç„¶åå†im2colç¬¬äºŒé€šé“ï¼Œæœ€åim2colç¬¬ä¸‰é€šé“ã€‚å„é€šé“im2colçš„æ•°æ®åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­å­˜å‚¨çš„ã€‚çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/652.webp" alt></p>
<p>è¿™æ˜¯åŸå›¾ç»è¿‡im2colçš„å˜åŒ–ï¼Œé‚£ä¹ˆkernelå‘¢ï¼Ÿçœ‹åŸå›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/653.webp" alt></p>
<p>kernelçš„é€šé“æ•°æ®åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­å­˜å‚¨çš„ã€‚æ‰€ä»¥ä¸Šé¢çš„kernelå›¾åƒç»è¿‡im2colç®—æ³•åå¯ä»¥è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/654.webp" alt></p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦‚ä½•å¾—åˆ°å‰å‘ä¼ æ’­çš„ç»“æœå‘¢ï¼Ÿåœ¨DarkNetä¸­å’ŒCaffeçš„å®ç°æ–¹å¼ä¸€æ ·ï¼Œéƒ½æ˜¯Kernel*Imgï¼Œå³æ˜¯åœ¨çŸ©é˜µä¹˜æ³•ä¸­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">M=<span class="number">1</span> </span><br><span class="line">N=output_h * output_w</span><br><span class="line">K=input_channels * kernel_h * kernel_w</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/655.webp" alt></p>
<p>å›¾åƒæ•°æ®æ˜¯è¿ç»­å­˜å‚¨ï¼Œå› æ­¤è¾“å‡ºå›¾åƒä¹Ÿå¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€output_h x output_wã€‘=ã€2 x 2ã€‘ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/656.png" alt></p>
<p>å¯¹äºå¤šé€šé“å›¾åƒè¿‡ç¨‹ç±»ä¼¼ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/657.webp" alt></p>
<p>åŒæ ·ï¼Œå¤šä¸ªè¾“å‡ºé€šé“å›¾åƒçš„æ•°æ®æ˜¯è¿ç»­å­˜å‚¨ï¼Œå› æ­¤è¾“å‡ºå›¾åƒä¹Ÿå¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€output_channels x output_h x output_wã€‘=ã€3 x 2 x 2ã€‘</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/658.webp" alt></p>
<p>im2colç®—æ³•çš„å®ç°åœ¨<code>src/im2col.c</code>ä¸­ï¼Œå³<code>im2col_cpu</code>å‡½æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** ä»è¾“å…¥çš„å¤šé€šé“æ•°ç»„imï¼ˆå­˜å‚¨å›¾åƒæ•°æ®ï¼‰ä¸­è·å–æŒ‡å®šè¡Œï¼Œåˆ—ï¼Œé€šé“æ•°å¤„çš„å…ƒç´ å€¼</span></span><br><span class="line"><span class="comment">** im:  å‡½æ•°çš„è¾“å…¥ï¼Œæ‰€æœ‰çš„æ•°æ®å­˜æˆä¸€ä¸ªä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">** height: æ¯ä¸€ä¸ªé€šé“çš„é«˜åº¦(å³æ˜¯è¾“å…¥å›¾åƒçš„çœŸæ­£é«˜åº¦ï¼Œè¡¥0ä¹‹å‰)</span></span><br><span class="line"><span class="comment">** width: æ¯ä¸€ä¸ªé€šé“çš„å®½åº¦(å³æ˜¯è¾“å…¥å›¾åƒçš„çœŸæ­£å®½åº¦ï¼Œè¡¥0ä¹‹å‰)</span></span><br><span class="line"><span class="comment">** channlesï¼šè¾“å…¥é€šé“æ•°</span></span><br><span class="line"><span class="comment">** row: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„è¡Œ(paddingä¹‹åçš„è¡Œæ•°)</span></span><br><span class="line"><span class="comment">** col: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„åˆ—(paddingä¹‹åçš„åˆ—æ•°)</span></span><br><span class="line"><span class="comment">** channel: è¦æå–çš„å…ƒç´ æ‰€åœ¨çš„é€šé“</span></span><br><span class="line"><span class="comment">** pad: å›¾åƒä¸Šä¸‹å·¦å³è¡¥0çš„ä¸ªæ•°ï¼Œå››å‘¨æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">** è¿”å›imä¸­channelé€šé“ï¼Œrow-padè¡Œ,col-padåˆ—å¤„çš„å…ƒç´ å€¼</span></span><br><span class="line"><span class="comment">** åœ¨imä¸­å¹¶æ²¡æœ‰å­˜å‚¨è¡¥0çš„å…ƒç´ å€¼ï¼Œå› æ­¤heightï¼Œwidthéƒ½æ˜¯æ²¡æœ‰è¡¥0æ—¶è¾“å…¥å›¾åƒçœŸæ­£çš„é«˜ã€å®½ï¼›</span></span><br><span class="line"><span class="comment">** è€Œrowä¸colåˆ™æ˜¯è¡¥0ä¹‹åï¼Œå…ƒç´ æ‰€åœ¨çš„è¡Œåˆ—ï¼Œå› æ­¤ï¼Œè¦å‡†ç¡®è·å–åœ¨imä¸­çš„å…ƒç´ å€¼ï¼Œé¦–å…ˆéœ€è¦</span></span><br><span class="line"><span class="comment">** å‡å»padä»¥è·å–åœ¨imä¸­çœŸå®çš„è¡Œåˆ—æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">im2col_get_pixel</span><span class="params">(<span class="keyword">float</span> *im, <span class="keyword">int</span> height, <span class="keyword">int</span> width, <span class="keyword">int</span> channels,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">int</span> row, <span class="keyword">int</span> col, <span class="keyword">int</span> channel, <span class="keyword">int</span> pad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//å‡å»è¡¥0é•¿åº¦ï¼Œè·å–åƒç´ çœŸå®çš„è¡Œåˆ—æ•°</span></span><br><span class="line">    row -= pad;</span><br><span class="line">    col -= pad;</span><br><span class="line">	<span class="comment">// å¦‚æœè¡Œåˆ—æ•°&lt;0ï¼Œæˆ–è€…è¶…è¿‡height/widthï¼Œåˆ™è¿”å›0(åˆšå¥½æ˜¯è¡¥0çš„æ•ˆæœ)</span></span><br><span class="line">    <span class="keyword">if</span> (row &lt; <span class="number">0</span> || col &lt; <span class="number">0</span> ||</span><br><span class="line">        row &gt;= height || col &gt;= width) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// imå­˜å‚¨å¤šé€šé“äºŒç»´å›¾åƒçš„æ•°æ®æ ¼å¼ä¸º: å„ä¸ªé€šé“æ‰€æœ‰çš„æ‰€æœ‰è¡Œå¹¶æˆ1è¡Œï¼Œå†å¤šé€šé“ä¾æ¬¡å¹¶æˆä¸€è¡Œ</span></span><br><span class="line">    <span class="comment">// å› æ­¤width*height*channelé¦–å…ˆç§»ä½åˆ°æ‰€åœ¨é€šé“çš„èµ·ç‚¹ä½ç½®ï¼Œå†åŠ ä¸Šwidth*rowç§»ä½åˆ°æ‰€åœ¨æŒ‡å®š</span></span><br><span class="line">    <span class="comment">// é€šé“è¡Œï¼Œå†åŠ ä¸Šcolç§»ä½åˆ°æ‰€åœ¨åˆ—</span></span><br><span class="line">    <span class="keyword">return</span> im[col + width*(row + height*channel)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//From Berkeley Vision&#x27;s Caffe!</span></span><br><span class="line"><span class="comment">//https://github.com/BVLC/caffe/blob/master/LICENSE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** å°†è¾“å…¥å›¾ç‰‡è½¬ä¸ºä¾¿äºè®¡ç®—çš„æ•°ç»„æ ¼å¼</span></span><br><span class="line"><span class="comment">** data_im: è¾“å…¥å›¾åƒ</span></span><br><span class="line"><span class="comment">** height: è¾“å…¥å›¾åƒçš„é«˜åº¦(è¡Œ)</span></span><br><span class="line"><span class="comment">** width: è¾“å…¥å›¾åƒçš„å®½åº¦(åˆ—)</span></span><br><span class="line"><span class="comment">** ksize: å·ç§¯æ ¸å°ºå¯¸</span></span><br><span class="line"><span class="comment">** stride: å·ç§¯æ ¸è·¨åº¦</span></span><br><span class="line"><span class="comment">** pad: å››å‘¨è¡¥0çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">** data_col: ç›¸å½“äºè¾“å‡ºï¼Œä¸ºè¿›è¡Œæ ¼å¼é‡æ’åçš„è¾“å…¥å›¾åƒæ•°æ®</span></span><br><span class="line"><span class="comment">** è¾“å‡ºdata_colçš„å…ƒç´ ä¸ªæ•°ä¸data_imä¸ªæ•°ä¸ç›¸ç­‰ï¼Œä¸€èˆ¬æ¯”data_imä¸ªæ•°å¤šï¼Œå› ä¸ºstrideè¾ƒå°ï¼Œå„ä¸ªå·ç§¯æ ¸ä¹‹é—´æœ‰å¾ˆå¤šé‡å ï¼Œ</span></span><br><span class="line"><span class="comment">** å®é™…data_colä¸­çš„å…ƒç´ ä¸ªæ•°ä¸ºchannels*ksize*ksize*height_col*width_colï¼Œå…¶ä¸­channelsä¸ºdata_imçš„é€šé“æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">** ksizeä¸ºå·ç§¯æ ¸å¤§å°ï¼Œheight_colå’Œwidth_colå¦‚ä¸‹æ‰€æ³¨ã€‚data_colçš„è¿˜æ˜¯æŒ‰è¡Œæ’åˆ—ï¼Œåªæ˜¯è¡Œæ•°ä¸ºchannels*ksize*ksize,</span></span><br><span class="line"><span class="comment">** åˆ—æ•°ä¸ºheight_col*width_colï¼Œå³ä¸€å¼ ç‰¹å¾å›¾æ€»çš„å…ƒç´ ä¸ªæ•°ï¼Œæ¯æ•´åˆ—åŒ…å«ä¸æŸä¸ªä½ç½®å¤„çš„å·ç§¯æ ¸è®¡ç®—çš„æ‰€æœ‰é€šé“ä¸Šçš„åƒç´ ï¼Œ</span></span><br><span class="line"><span class="comment">** ï¼ˆæ¯”å¦‚è¾“å…¥å›¾åƒé€šé“æ•°ä¸º3,å·ç§¯æ ¸å°ºå¯¸ä¸º3*3ï¼Œåˆ™å…±æœ‰27è¡Œï¼Œæ¯åˆ—æœ‰27ä¸ªå…ƒç´ ï¼‰ï¼Œä¸åŒåˆ—å¯¹åº”å·ç§¯æ ¸åœ¨å›¾åƒä¸Šçš„ä¸åŒä½ç½®åšå·ç§¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">im2col_cpu</span><span class="params">(<span class="keyword">float</span>* data_im,</span></span></span><br><span class="line"><span class="params"><span class="function">     <span class="keyword">int</span> channels,  <span class="keyword">int</span> height,  <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="params"><span class="function">     <span class="keyword">int</span> ksize,  <span class="keyword">int</span> stride, <span class="keyword">int</span> pad, <span class="keyword">float</span>* data_col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c,h,w;</span><br><span class="line">	<span class="comment">// è®¡ç®—è¯¥å±‚ç¥ç»ç½‘ç»œçš„è¾“å‡ºå›¾åƒå°ºå¯¸ï¼ˆå…¶å®æ²¡æœ‰å¿…è¦å†æ¬¡è®¡ç®—çš„ï¼Œå› ä¸ºåœ¨æ„å»ºå·ç§¯å±‚æ—¶ï¼Œmake_convolutional_layer()å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å·²ç»è°ƒç”¨convolutional_out_width()ï¼Œconvolutional_out_height()å‡½æ•°æ±‚å–äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ­¤å¤„ç›´æ¥ä½¿ç”¨l.out_h,l.out_wå³å¯ï¼Œå‡½æ•°å‚æ•°åªè¦ä¼ å…¥è¯¥å±‚ç½‘ç»œæŒ‡é’ˆå°±å¯äº†ï¼Œæ²¡å¿…è¦å¼„è¿™ä¹ˆå¤šå‚æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> height_col = (height + <span class="number">2</span>*pad - ksize) / stride + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> width_col = (width + <span class="number">2</span>*pad - ksize) / stride + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// å·ç§¯æ ¸å¤§å°ï¼šksize*ksizeæ˜¯ä¸€ä¸ªå·ç§¯æ ¸çš„å¤§å°ï¼Œä¹‹æ‰€ä»¥ä¹˜ä»¥é€šé“æ•°channelsï¼Œæ˜¯å› ä¸ºè¾“å…¥å›¾åƒæœ‰å¤šé€šé“ï¼Œæ¯ä¸ªå·ç§¯æ ¸åœ¨åšå·ç§¯æ—¶ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ˜¯åŒæ—¶å¯¹åŒä¸€ä½ç½®å¤šé€šé“çš„å›¾åƒè¿›è¡Œå·ç§¯è¿ç®—ï¼Œè¿™é‡Œä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œå°†ä¸‰ä¸ªé€šé“å°†ä¸‰é€šé“ä¸Šçš„å·ç§¯æ ¸å¹¶åœ¨ä¸€èµ·ä»¥ä¾¿è¿›è¡Œè®¡ç®—ï¼Œå› æ­¤å·ç§¯æ ¸</span></span><br><span class="line">    <span class="comment">// å®é™…ä¸Šå¹¶ä¸æ˜¯äºŒç»´çš„ï¼Œè€Œæ˜¯ä¸‰ç»´çš„ï¼Œæ¯”å¦‚å¯¹äº3é€šé“å›¾åƒï¼Œå·ç§¯æ ¸å°ºå¯¸ä¸º3*3ï¼Œè¯¥å·ç§¯æ ¸å°†åŒæ—¶ä½œç”¨äºä¸‰é€šé“å›¾åƒä¸Šï¼Œè¿™æ ·å¹¶èµ·æ¥å°±å¾—</span></span><br><span class="line">    <span class="comment">// åˆ°å«æœ‰27ä¸ªå…ƒç´ çš„å·ç§¯æ ¸ï¼Œä¸”è¿™27ä¸ªå…ƒç´ éƒ½æ˜¯ç‹¬ç«‹çš„éœ€è¦è®­ç»ƒçš„å‚æ•°ã€‚æ‰€ä»¥åœ¨è®¡ç®—è®­ç»ƒå‚æ•°ä¸ªæ•°æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ¯ä¸€ä¸ªå·ç§¯æ ¸çš„å®é™…</span></span><br><span class="line">    <span class="comment">// è®­ç»ƒå‚æ•°éœ€è¦ä¹˜ä»¥è¾“å…¥é€šé“æ•°ã€‚</span></span><br><span class="line">    <span class="keyword">int</span> channels_col = channels * ksize * ksize;</span><br><span class="line">	<span class="comment">// å¤–å¾ªç¯æ¬¡æ•°ä¸ºä¸€ä¸ªå·ç§¯æ ¸çš„å°ºå¯¸æ•°ï¼Œå¾ªç¯æ¬¡æ•°å³ä¸ºæœ€ç»ˆå¾—åˆ°çš„data_colçš„æ€»è¡Œæ•°</span></span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; channels_col; ++c) &#123;</span><br><span class="line">		<span class="comment">// åˆ—åç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå¹¶æŒ‰è¡Œå­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­ï¼Œåˆ©ç”¨æ±‚ä½™è¿ç®—è·å–å¯¹åº”åœ¨å·ç§¯æ ¸ä¸­çš„åˆ—æ•°ï¼Œæ¯”å¦‚å¯¹äº</span></span><br><span class="line">        <span class="comment">// 3*3çš„å·ç§¯æ ¸ï¼ˆ3é€šé“ï¼‰ï¼Œå½“c=0æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬ä¸€åˆ—ï¼Œå½“c=5æ—¶ï¼Œæ˜¾ç„¶åœ¨ç¬¬2åˆ—ï¼Œå½“c=9æ—¶ï¼Œåœ¨ç¬¬äºŒé€šé“ä¸Šçš„å·ç§¯æ ¸çš„ç¬¬ä¸€åˆ—ï¼Œ</span></span><br><span class="line">        <span class="comment">// å½“c=26æ—¶ï¼Œåœ¨ç¬¬ä¸‰åˆ—ï¼ˆç¬¬ä¸‰é€šé“ä¸Šï¼‰</span></span><br><span class="line">        <span class="keyword">int</span> w_offset = c % ksize;</span><br><span class="line">		<span class="comment">// è¡Œåç§»ï¼Œå·ç§¯æ ¸æ˜¯ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼Œä¸”æ˜¯æŒ‰è¡Œï¼ˆå·ç§¯æ ¸æ‰€æœ‰è¡Œå¹¶æˆä¸€è¡Œï¼‰å­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¯”å¦‚å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œå¤„ç†3é€šé“çš„å›¾åƒï¼Œé‚£ä¹ˆä¸€ä¸ªå·ç§¯æ ¸å…·æœ‰27ä¸ªå…ƒç´ ï¼Œæ¯9ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªé€šé“ä¸Šçš„å·ç§¯æ ¸ï¼ˆäº’ä¸ºä¸€æ ·ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¯å½“cä¸º3çš„å€æ•°ï¼Œå°±æ„å‘³ç€å·ç§¯æ ¸æ¢äº†ä¸€è¡Œï¼Œh_offsetå–å€¼ä¸º0,1,2ï¼Œå¯¹åº”3*3å·ç§¯æ ¸ä¸­çš„ç¬¬1, 2, 3è¡Œ</span></span><br><span class="line">        <span class="keyword">int</span> h_offset = (c / ksize) % ksize;</span><br><span class="line">		<span class="comment">// é€šé“åç§»ï¼Œchannels_colæ˜¯å¤šé€šé“çš„å·ç§¯æ ¸å¹¶åœ¨ä¸€èµ·çš„ï¼Œæ¯”å¦‚å¯¹äº3é€šé“ï¼Œ3*3å·ç§¯æ ¸ï¼Œæ¯è¿‡9ä¸ªå…ƒç´ å°±è¦æ¢ä¸€é€šé“æ•°ï¼Œ</span></span><br><span class="line">        <span class="comment">// å½“c=0~8æ—¶ï¼Œc_im=0;c=9~17æ—¶ï¼Œc_im=1;c=18~26æ—¶ï¼Œc_im=2</span></span><br><span class="line">        <span class="keyword">int</span> c_im = c / ksize / ksize;</span><br><span class="line">		<span class="comment">// ä¸­å¾ªç¯æ¬¡æ•°ç­‰äºè¯¥å±‚è¾“å‡ºå›¾åƒè¡Œæ•°height_colï¼Œè¯´æ˜data_colä¸­çš„æ¯ä¸€è¡Œå­˜å‚¨äº†ä¸€å¼ ç‰¹å¾å›¾ï¼Œè¿™å¼ ç‰¹å¾å›¾åˆæ˜¯æŒ‰è¡Œå­˜å‚¨åœ¨data_colä¸­çš„æŸè¡Œä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (h = <span class="number">0</span>; h &lt; height_col; ++h) &#123;</span><br><span class="line">			<span class="comment">// å†…å¾ªç¯ç­‰äºè¯¥å±‚è¾“å‡ºå›¾åƒåˆ—æ•°width_colï¼Œè¯´æ˜æœ€ç»ˆå¾—åˆ°çš„data_colæ€»æœ‰channels_colè¡Œï¼Œheight_col*width_colåˆ—</span></span><br><span class="line">            <span class="keyword">for</span> (w = <span class="number">0</span>; w &lt; width_col; ++w) &#123;</span><br><span class="line">				<span class="comment">// ç”±ä¸Šé¢å¯çŸ¥ï¼Œå¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œh_offsetå–å€¼ä¸º0,1,2,å½“h_offset=0æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ç¬¬ä¸€è¡Œå…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¾æ¬¡ç±»æ¨ï¼›åŠ ä¸Šh*strideæ˜¯å¯¹å·ç§¯æ ¸è¿›è¡Œè¡Œç§»ä½æ“ä½œï¼Œæ¯”å¦‚å·ç§¯æ ¸ä»å›¾åƒ(0,0)ä½ç½®å¼€å§‹åšå·ç§¯ï¼Œé‚£ä¹ˆæœ€å…ˆå¼€å§‹æ¶‰åŠ(0,0)~(3,3)</span></span><br><span class="line">                <span class="comment">// ä¹‹é—´çš„åƒç´ å€¼ï¼Œè‹¥stride=2ï¼Œé‚£ä¹ˆå·ç§¯æ ¸è¿›è¡Œä¸€æ¬¡è¡Œç§»ä½æ—¶ï¼Œä¸‹ä¸€è¡Œçš„å·ç§¯æ“ä½œæ˜¯ä»å…ƒç´ (2,0)ï¼ˆ2ä¸ºå›¾åƒè¡Œå·ï¼Œ0ä¸ºåˆ—å·ï¼‰å¼€å§‹</span></span><br><span class="line">                <span class="keyword">int</span> im_row = h_offset + h * stride;</span><br><span class="line">				<span class="comment">// å¯¹äº3*3çš„å·ç§¯æ ¸ï¼Œw_offsetå–å€¼ä¹Ÿä¸º0,1,2ï¼Œå½“w_offsetå–1æ—¶ï¼Œä¼šæå–å‡ºæ‰€æœ‰ä¸å·ç§¯æ ¸ä¸­ç¬¬2åˆ—å…ƒç´ è¿›è¡Œè¿ç®—çš„åƒç´ ï¼Œ</span></span><br><span class="line">                <span class="comment">// å®é™…åœ¨åšå·ç§¯æ“ä½œæ—¶ï¼Œå·ç§¯æ ¸å¯¹å›¾åƒé€è¡Œæ‰«æåšå·ç§¯ï¼ŒåŠ ä¸Šw*strideå°±æ˜¯ä¸ºäº†åšåˆ—ç§»ä½ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ¯”å¦‚å‰ä¸€æ¬¡å·ç§¯å…¶å®åƒç´ å…ƒç´ ä¸º(0,0)ï¼Œè‹¥stride=2,é‚£ä¹ˆä¸‹æ¬¡å·ç§¯å…ƒç´ èµ·å§‹åƒç´ ä½ç½®ä¸º(0,2)ï¼ˆ0ä¸ºè¡Œå·ï¼Œ2ä¸ºåˆ—å·ï¼‰</span></span><br><span class="line">                <span class="keyword">int</span> im_col = w_offset + w * stride;</span><br><span class="line">				<span class="comment">// col_indexä¸ºé‡æ’åå›¾åƒä¸­çš„åƒç´ ç´¢å¼•ï¼Œç­‰äºc * height_col * width_col + h * width_col +wï¼ˆè¿˜æ˜¯æŒ‰è¡Œå­˜å‚¨ï¼Œæ‰€æœ‰é€šé“å†å¹¶æˆä¸€è¡Œï¼‰ï¼Œ</span></span><br><span class="line">                <span class="comment">// å¯¹åº”ç¬¬cé€šé“ï¼Œhè¡Œï¼Œwåˆ—çš„å…ƒç´ </span></span><br><span class="line">                <span class="keyword">int</span> col_index = (c * height_col + h) * width_col + w;</span><br><span class="line">				<span class="comment">// im2col_get_pixelå‡½æ•°è·å–è¾“å…¥å›¾åƒdata_imä¸­ç¬¬c_imé€šé“ï¼Œim_row,im_colçš„åƒç´ å€¼å¹¶èµ‹å€¼ç»™é‡æ’åçš„å›¾åƒï¼Œ</span></span><br><span class="line">                <span class="comment">// heightå’Œwidthä¸ºè¾“å…¥å›¾åƒdata_imçš„çœŸå®é«˜ã€å®½ï¼Œpadä¸ºå››å‘¨è¡¥0çš„é•¿åº¦ï¼ˆæ³¨æ„im_row,im_colæ˜¯è¡¥0ä¹‹åçš„è¡Œåˆ—å·ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¸æ˜¯çœŸå®è¾“å…¥å›¾åƒä¸­çš„è¡Œåˆ—å·ï¼Œå› æ­¤éœ€è¦å‡å»padè·å–çœŸå®çš„è¡Œåˆ—å·ï¼‰</span></span><br><span class="line">                data_col[col_index] = <span class="built_in">im2col_get_pixel</span>(data_im, height, width, channels,</span><br><span class="line">                        im_row, im_col, c_im, pad);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetç½‘ç»œçš„å‰å‘å’Œåå‘ä¼ æ’­ä»‹ç»ä»¥åŠlayerçš„è¯¦ç»†è§£æ</title>
    <url>/2020/02/22/AlexeyAB-DarkNet%E7%BD%91%E7%BB%9C%E7%9A%84%E5%89%8D%E5%90%91%E5%92%8C%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8Alayer%E7%9A%84%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰é¢æˆ‘ä»¬å·²ç»æˆåŠŸçš„è·å–äº†ç›®æ ‡æ£€æµ‹çš„ç½‘ç»œç»“æ„(<code>cfg</code>æ–‡ä»¶çš„å†…å®¹)ï¼Œå¹¶å°†ç½‘ç»œä¿å­˜åœ¨äº†ä¸€ä¸ª<code>network</code>ç»“æ„ä½“ä¸­ï¼Œç„¶åæˆ‘ä»¬è¿˜åˆ†æäº†æ•°æ®åŠ è½½æ–¹å¼ã€‚ç°åœ¨æ•°æ®å’Œç½‘ç»œç»“æ„éƒ½æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¼€å§‹è®­ç»ƒ/æµ‹è¯•çš„è¿‡ç¨‹äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦è°ƒç”¨çš„æ˜¯<code>network</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­å‡½æ•°ï¼Œè€Œ<code>network</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­åˆå¯ä»¥ç»†åˆ†ä¸ºæ¯ä¸€ä¸ª<code>layer</code>çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ä»¥åŠ<code>layer</code>æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚</p>
<h2 id="ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"><a href="#ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­" class="headerlink" title="ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­"></a>ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­</h2><p>ç½‘ç»œçš„å‰å‘ä¼ æ’­å‡½æ•°åœ¨<code>src/network.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** å‰å‘è®¡ç®—ç½‘ç»œnetæ¯ä¸€å±‚çš„è¾“å‡º</span></span><br><span class="line"><span class="comment">** stateç”¨æ¥æ ‡è®°å½“å‰ç½‘ç»œçš„çŠ¶æ€ï¼Œ</span></span><br><span class="line"><span class="comment">** éå†netçš„æ¯ä¸€å±‚ç½‘ç»œï¼Œä»ç¬¬0å±‚åˆ°æœ€åä¸€å±‚ï¼Œé€å±‚è®¡ç®—æ¯å±‚çš„è¾“å‡º</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_network</span><span class="params">(network net, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ç½‘ç»œçš„å·¥ä½œç©ºé—´, æŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§çš„é‚£ä¸ªå±‚çš„ workspace_size,</span></span><br><span class="line">    <span class="comment">// å› ä¸ºå®é™…ä¸Šåœ¨ GPU æˆ– CPU ä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘è¿ç®—</span></span><br><span class="line">    state.workspace = net.workspace;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// éå†æ‰€æœ‰å±‚ï¼Œä»ç¬¬ä¸€å±‚åˆ°æœ€åä¸€å±‚ï¼Œé€å±‚è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œç½‘ç»œå…±æœ‰net.nå±‚</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; net.n; ++i)&#123;</span><br><span class="line">		<span class="comment">// å½“å‰æ­£åœ¨è¿›è¡Œç¬¬iå±‚çš„å¤„ç†</span></span><br><span class="line">        state.index = i;</span><br><span class="line">		<span class="comment">// è·å–å½“å‰å±‚</span></span><br><span class="line">        layer l = net.layers[i];</span><br><span class="line">		<span class="comment">// å¦‚æœå½“å‰å±‚çš„l.deltaå·²ç»åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œåˆ™è°ƒç”¨fill_cpu()å‡½æ•°å°†å…¶æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span>(l.delta &amp;&amp; state.train)&#123;</span><br><span class="line">			<span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºl.deltaçš„å…ƒç´ ä¸ªæ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåˆå§‹åŒ–å€¼ï¼Œä¸º0</span></span><br><span class="line">            <span class="built_in">scal_cpu</span>(l.outputs * l.batch, <span class="number">0</span>, l.delta, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//double time = get_time_point();</span></span><br><span class="line">		<span class="comment">// å‰å‘ä¼ æ’­: å®Œæˆå½“å‰å±‚å‰å‘æ¨ç†</span></span><br><span class="line">        l.forward(l, state);</span><br><span class="line">		<span class="comment">// å®ŒæˆæŸä¸€å±‚çš„æ¨ç†æ—¶ï¼Œç½®ç½‘ç»œçš„è¾“å…¥ä¸ºå½“å‰å±‚çš„è¾“å‡ºï¼ˆè¿™å°†æˆä¸ºä¸‹ä¸€å±‚ç½‘ç»œçš„è¾“å…¥ï¼‰ï¼Œæ³¨æ„æ­¤å¤„æ›´æ”¹çš„æ˜¯stateï¼Œè€ŒéåŸå§‹çš„net</span></span><br><span class="line">        <span class="comment">//printf(&quot;%d - Predicted in %lf milli-seconds.\n&quot;, i, ((double)get_time_point() - time) / 1000);</span></span><br><span class="line">        state.input = l.output;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç½‘ç»œçš„åå‘ä¼ æ’­å‡½æ•°ä¹Ÿåœ¨<code>src/network.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** åå‘è®¡ç®—ç½‘ç»œnetæ¯ä¸€å±‚çš„æ¢¯åº¦å›¾ï¼Œå¹¶è¿›è€Œè®¡ç®—æ¯ä¸€å±‚çš„æƒé‡ã€åç½®æ›´æ–°å€¼ï¼Œæœ€åå®Œæˆæ¯ä¸€å±‚æƒé‡ä¸åç½®æ›´æ–°</span></span><br><span class="line"><span class="comment">** æµç¨‹: éå†netçš„æ¯ä¸€å±‚ç½‘ç»œï¼Œä»æœ€åä¸€å±‚åˆ°ç¬¬ä¸€å±‚(æ­¤å¤„æ‰€æŒ‡çš„ç¬¬ä¸€å±‚ä¸æ˜¯æŒ‡è¾“å…¥å±‚ï¼Œè€Œæ˜¯ä¸è¾“å…¥å±‚ç›´æ¥ç›¸è¿çš„ç¬¬ä¸€å±‚éšå«å±‚)è¿›è¡Œåå‘ä¼ æ’­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backward_network</span><span class="params">(network net, network_state state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// åœ¨è¿›è¡Œåå‘ä¼ æ’­ä¹‹å‰å…ˆä¿å­˜ä¸€ä¸‹åŸæ¥çš„netä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">float</span> *original_input = state.input;</span><br><span class="line">    <span class="keyword">float</span> *original_delta = state.delta;</span><br><span class="line">    state.workspace = net.workspace;</span><br><span class="line">    <span class="keyword">for</span>(i = net.n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i)&#123;</span><br><span class="line">		<span class="comment">// æ ‡å¿—å‚æ•°ï¼Œå½“å‰ç½‘ç»œçš„æ´»è·ƒå±‚</span></span><br><span class="line">        state.index = i;</span><br><span class="line">		<span class="comment">// i = 0æ—¶ï¼Œä¹Ÿå³å·²ç»åˆ°äº†ç½‘ç»œçš„ç¬¬1å±‚ï¼ˆæˆ–è€…è¯´ç¬¬0å±‚ï¼Œçœ‹ä¸ªäººä¹ æƒ¯äº†ï½ï¼‰äº†ï¼Œ</span></span><br><span class="line">        <span class="comment">// å°±æ˜¯ç›´æ¥ä¸è¾“å…¥å±‚ç›¸è¿çš„ç¬¬ä¸€å±‚éšå«å±‚ï¼ˆæ³¨æ„ä¸æ˜¯è¾“å…¥å±‚ï¼Œæˆ‘ç†è§£çš„è¾“å…¥å±‚å°±æ˜¯æŒ‡è¾“å…¥çš„å›¾åƒæ•°æ®ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä¸¥æ ¼æ¥è¯´ï¼Œè¾“å…¥å±‚ä¸ç®—ä¸€å±‚ç½‘ç»œï¼Œå› ä¸ºè¾“å…¥å±‚æ²¡æœ‰è®­ç»ƒå‚æ•°ï¼Œä¹Ÿæ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸éœ€è¦elseä¸­çš„èµ‹å€¼ï¼Œ1ï¼‰å¯¹äºç¬¬1å±‚æ¥è¯´ï¼Œå…¶å‰é¢å·²ç»æ²¡æœ‰ç½‘ç»œå±‚äº†ï¼ˆè¾“å…¥å±‚ä¸ç®—ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// å› æ­¤æ²¡æœ‰å¿…è¦å†è®¡ç®—å‰ä¸€å±‚çš„å‚æ•°ï¼Œæ•…æ²¡æœ‰å¿…è¦åœ¨è·å–ä¸Šä¸€å±‚ï¼›2ï¼‰ç¬¬ä¸€å±‚çš„è¾“å…¥å°±æ˜¯å›¾åƒè¾“å…¥ï¼Œä¹Ÿå³æ•´ä¸ªnetæœ€åŸå§‹çš„è¾“å…¥ï¼Œåœ¨å¼€å§‹è¿›è¡Œåå‘ä¼ æ’­ä¹‹å‰ï¼Œå·²ç»ç”¨original_*å˜é‡ä¿å­˜äº†</span></span><br><span class="line">        <span class="comment">// æœ€ä¸ºåŸå§‹çš„netï¼Œæ‰€ä»¥net.inputå°±æ˜¯ç¬¬ä¸€å±‚çš„è¾“å…¥ï¼Œä¸éœ€è¦è·å–ä¸Šä¸€å±‚çš„è¾“å‡ºä½œä¸ºå½“å‰å±‚çš„è¾“å…¥ï¼›3ï¼‰åŒ1ï¼‰ï¼Œç¬¬ä¸€å±‚ä¹‹å‰å·²ç»æ²¡æœ‰å±‚äº†ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå°±ä¸éœ€è¦è®¡ç®—ä¸Šä¸€å±‚çš„deltaï¼Œå³ä¸éœ€è¦å†å°†net.deltaé“¾æ¥åˆ°prev.deltaï¼Œæ­¤æ—¶è¿›å…¥åˆ°l.backward()ä¸­åï¼Œnet.deltaå°±æ˜¯NULLï¼ˆå¯ä»¥å‚çœ‹darknet.hä¸­å…³äºdelta</span></span><br><span class="line">        <span class="comment">// çš„æ³¨é‡Šï¼‰ï¼Œä¹Ÿå°±ä¸ä¼šå†è®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦äº†ï¼ˆæ¯”å¦‚å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„backward_convolutional_layer()å‡½æ•°ï¼‰</span></span><br><span class="line">        <span class="comment">// è¿™å‡ è¡Œä»£ç å°±æ˜¯ç»™net.inputå’Œnet.deltaèµ‹å€¼</span></span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">            state.input = original_input;</span><br><span class="line">            state.delta = original_delta;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            layer prev = net.layers[i<span class="number">-1</span>];</span><br><span class="line">            state.input = prev.output;</span><br><span class="line">            state.delta = prev.delta;</span><br><span class="line">        &#125;</span><br><span class="line">        layer l = net.layers[i];</span><br><span class="line">        <span class="keyword">if</span> (l.stopbackward) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (l.onlyforward) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="comment">// åå‘è®¡ç®—ç¬¬iå±‚çš„æ•æ„Ÿåº¦å›¾ã€æƒé‡åŠåç½®æ›´æ–°å€¼ï¼Œå¹¶æ›´æ–°æƒé‡ã€åç½®ï¼ˆåŒæ—¶ä¼šè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œ</span></span><br><span class="line">        <span class="comment">// å­˜å‚¨åœ¨net.deltaä¸­ï¼Œä½†æ˜¯è¿˜å·®ä¸€ä¸ªç¯èŠ‚ï¼šä¹˜ä¸Šä¸Šä¸€å±‚è¾“å‡ºå¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼Œä¹Ÿå³ä¸Šä¸€å±‚æ¿€æ´»å‡½æ•°å¯¹åŠ æƒè¾“å…¥çš„å¯¼æ•°ï¼‰</span></span><br><span class="line">        l.<span class="built_in">backward</span>(l, state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="layerçš„è§£é‡Š"><a href="#layerçš„è§£é‡Š" class="headerlink" title="layerçš„è§£é‡Š"></a>layerçš„è§£é‡Š</h2><p>åœ¨å°†å…·ä½“æŸä¸ªå±‚å¦‚å·ç§¯å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ä¹‹å‰ï¼Œéœ€è¦å…ˆæ¥çœ‹ä¸€ä¸‹<code>layer</code>æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Œå› ä¸ºç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­å®é™…ä¸Šå°±æ˜¯å„ä¸ªç½‘ç»œå±‚(<code>layer</code>)çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œè¿™éƒ¨åˆ†åŠ å¥½æ³¨é‡Šçš„ä»£ç ï¼ˆåœ¨<code>src/darknet.h</code>ä¸­ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰layer</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">layer</span> &#123;</span></span><br><span class="line">    LAYER_TYPE type; <span class="comment">// ç½‘ç»œå±‚çš„ç±»å‹ï¼Œæšä¸¾ç±»å‹ï¼Œå–å€¼æ¯”å¦‚DROPOUT,CONVOLUTIONAL,MAXPOOLåˆ†åˆ«è¡¨ç¤ºdropoutå±‚ï¼Œå·ç§¯å±‚ï¼Œæœ€å¤§æ± åŒ–å±‚ï¼Œå¯å‚è§LAYER_TYPEæšä¸¾ç±»å‹çš„å®šä¹‰</span></span><br><span class="line">    ACTIVATION activation; <span class="comment">//æ¿€æ´»å‡½æ•°ç±»å‹ï¼Œæšä¸¾ç±»å‹</span></span><br><span class="line">    COST_TYPE cost_type; <span class="comment">//æŸå¤±å‡½æ•°ç±»å‹ï¼Œæšä¸¾ç±»å‹</span></span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*forward)   (struct layer, struct network_state);</span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*backward)  (struct layer, struct network_state);</span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*update)    (struct layer, <span class="keyword">int</span>, <span class="keyword">float</span>, <span class="keyword">float</span>, <span class="keyword">float</span>);</span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*forward_gpu)   (struct layer, struct network_state);</span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*backward_gpu)  (struct layer, struct network_state);</span><br><span class="line">    <span class="built_in"><span class="keyword">void</span></span>(*update_gpu)    (struct layer, <span class="keyword">int</span>, <span class="keyword">float</span>, <span class="keyword">float</span>, <span class="keyword">float</span>);</span><br><span class="line">    layer *share_layer;</span><br><span class="line">    <span class="keyword">int</span> train;</span><br><span class="line">    <span class="keyword">int</span> avgpool;</span><br><span class="line">    <span class="keyword">int</span> batch_normalize; <span class="comment">// æ˜¯å¦è¿›è¡ŒBNï¼Œå¦‚æœè¿›è¡ŒBNï¼Œåˆ™å€¼ä¸º1</span></span><br><span class="line">    <span class="keyword">int</span> shortcut;</span><br><span class="line">    <span class="keyword">int</span> batch; <span class="comment">// ä¸€ä¸ªbatchä¸­å«æœ‰çš„å›¾ç‰‡å¼ æ•°ï¼Œç­‰äºnet.batchï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒnetwork.hä¸­çš„æ³¨é‡Šï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶èµ‹å€¼ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> forced;</span><br><span class="line">    <span class="keyword">int</span> flipped;</span><br><span class="line">    <span class="keyword">int</span> inputs; <span class="comment">// ä¸€å¼ è¾“å…¥å›¾ç‰‡æ‰€å«çš„å…ƒç´ ä¸ªæ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰ï¼Œç¬¬ä¸€å±‚çš„å€¼ç­‰äºl.h*l.w*l.cï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¹‹åçš„æ¯ä¸€å±‚éƒ½æ˜¯ç”±ä¸Šä¸€å±‚çš„è¾“å‡ºè‡ªåŠ¨æ¨ç®—å¾—åˆ°çš„ï¼ˆå‚è§parse_network_cfg()ï¼Œåœ¨æ„å»ºæ¯ä¸€å±‚åï¼Œä¼šæ›´æ–°params.inputsä¸ºä¸Šä¸€å±‚çš„l.outputsï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> outputs; <span class="comment">// è¯¥å±‚å¯¹åº”ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„è¾“å‡ºå…ƒç´ ä¸ªæ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span></span><br><span class="line">                 <span class="comment">// å¯¹äºä¸€äº›ç½‘ç»œï¼Œå¯ç”±è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸åŠç›¸å…³å‚æ•°è®¡ç®—å‡ºï¼Œæ¯”å¦‚å·ç§¯å±‚ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥å°ºå¯¸ä»¥åŠæ­¥é•¿ã€æ ¸å¤§å°è®¡ç®—å‡ºï¼›</span></span><br><span class="line">                 <span class="comment">// å¯¹äºå¦ä¸€äº›å°ºå¯¸ï¼Œåˆ™éœ€è¦é€šè¿‡ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœªæŒ‡å®šï¼Œå–é»˜è®¤å€¼1ï¼Œæ¯”å¦‚å…¨è¿æ¥å±‚ï¼ˆè§parse_connected()å‡½æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> nweights;</span><br><span class="line">    <span class="keyword">int</span> nbiases;</span><br><span class="line">    <span class="keyword">int</span> extra;</span><br><span class="line">    <span class="keyword">int</span> truths;  <span class="comment">// &lt; æ ¹æ®region_layer.cåˆ¤æ–­ï¼Œè¿™ä¸ªå˜é‡è¡¨ç¤ºä¸€å¼ å›¾ç‰‡å«æœ‰çš„çœŸå®å€¼çš„ä¸ªæ•°ï¼Œå¯¹äºæ£€æµ‹æ¨¡å‹æ¥è¯´ï¼Œä¸€ä¸ªçœŸå®çš„æ ‡ç­¾å«æœ‰5ä¸ªå€¼ï¼Œ</span></span><br><span class="line">                <span class="comment">// åŒ…æ‹¬ç±»å‹å¯¹åº”çš„ç¼–å·ä»¥åŠå®šä½çŸ©å½¢æ¡†ç”¨åˆ°çš„w,h,x,yå››ä¸ªå‚æ•°ï¼Œä¸”åœ¨darknetä¸­å›ºå®šæ¯å¼ å›¾ç‰‡æœ€å¤§å¤„ç†30ä¸ªçŸ©å½¢æ¡†ï¼Œï¼ˆå¯æŸ¥çœ‹max_boxeså‚æ•°ï¼‰ï¼Œ</span></span><br><span class="line">                <span class="comment">// å› æ­¤ï¼Œåœ¨region_layer.cçš„make_region_layer()å‡½æ•°ä¸­èµ‹å€¼ä¸º30*5.</span></span><br><span class="line">    <span class="keyword">int</span> h, w, c;  <span class="comment">// è¯¥å±‚è¾“å…¥çš„å›¾ç‰‡çš„å®½ï¼Œé«˜ï¼Œé€šé“æ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> out_h, out_w, out_c;<span class="comment">// è¯¥å±‚è¾“å‡ºå›¾ç‰‡çš„é«˜ã€å®½ã€é€šé“æ•°ï¼ˆä¸€èˆ¬åœ¨å„ç½‘ç»œå±‚æ„å»ºå‡½æ•°ä¸­èµ‹å€¼ï¼Œæ¯”å¦‚make_connected_layer()ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> n; <span class="comment">// å¯¹äºå·ç§¯å±‚ï¼Œè¯¥å‚æ•°è¡¨ç¤ºå·ç§¯æ ¸ä¸ªæ•°ï¼Œç­‰äºout_cï¼Œå…¶å€¼ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼›å¯¹äºregion_layerå±‚ï¼Œè¯¥å‚æ•°ç­‰äºé…ç½®æ–‡ä»¶ä¸­çš„numå€¼</span></span><br><span class="line">           <span class="comment">// (è¯¥å‚æ•°é€šè¿‡make_region_layer()å‡½æ•°èµ‹å€¼ï¼Œåœ¨parser.cä¸­è°ƒç”¨çš„make_region_layer()å‡½æ•°)ï¼Œ</span></span><br><span class="line">           <span class="comment">// å¯ä»¥åœ¨darknet/cfgæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå‘½ä»¤ï¼šgrep num *.cfgä¾¿å¯ä»¥æœç´¢å‡ºæ‰€æœ‰è®¾ç½®äº†numå‚æ•°çš„ç½‘ç»œï¼Œè¿™é‡Œé¢åŒ…æ‹¬yolo.cfgç­‰ï¼Œå…¶å€¼æœ‰</span></span><br><span class="line">           <span class="comment">// è®¾å®šä¸º3,5,2çš„ï¼Œè¯¥å‚æ•°å°±æ˜¯Yoloè®ºæ–‡ä¸­çš„Bï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªcellä¸­é¢„æµ‹å¤šå°‘ä¸ªboxã€‚</span></span><br><span class="line">    <span class="keyword">int</span> max_boxes; <span class="comment">// æ¯å¼ å›¾ç‰‡æœ€å¤šå«æœ‰çš„æ ‡ç­¾çŸ©å½¢æ¡†æ•°ï¼ˆå‚çœ‹ï¼šdata.cä¸­çš„load_data_detection()ï¼Œå…¶è¾“å…¥å‚æ•°boxeså°±æ˜¯æŒ‡è¿™ä¸ªå‚æ•°ï¼‰ï¼Œ</span></span><br><span class="line">                   <span class="comment">// ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯æ¯å¼ å›¾ç‰‡ä¸­æœ€å¤šæ‰“äº†max_boxesä¸ªæ ‡ç­¾ç‰©ä½“ï¼Œæ¨¡å‹é¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé¢„æµ‹å‡ºå¾ˆå¤šçš„ç‰©ä½“ï¼Œä½†å®é™…ä¸Šï¼Œ</span></span><br><span class="line">                   <span class="comment">// å›¾ç‰‡ä¸­æ‰“ä¸Šæ ‡ç­¾çš„çœŸæ­£å­˜åœ¨çš„ç‰©ä½“æœ€å¤šå°±max_boxesä¸ªï¼Œé¢„æµ‹å¤šå‡ºæ¥çš„è‚¯å®šå­˜åœ¨false positiveï¼Œéœ€è¦æ»¤å‡ºä¸ç­›é€‰ï¼Œ</span></span><br><span class="line">                   <span class="comment">// å¯å‚çœ‹region_layer.cä¸­forward_region_layer()å‡½æ•°çš„ç¬¬äºŒä¸ªforå¾ªç¯ä¸­çš„æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">int</span> groups; <span class="comment">// åº”è¯¥æ˜¯æ§åˆ¶ç»„å·ç§¯çš„ç»„æ•°ï¼Œç±»ä¼¼äºcaffeçš„groupå‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> group_id;</span><br><span class="line">    <span class="keyword">int</span> size; <span class="comment">// æ ¸å°ºå¯¸ï¼ˆæ¯”å¦‚å·ç§¯æ ¸ï¼Œæ± åŒ–æ ¸ç­‰ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> side;</span><br><span class="line">    <span class="keyword">int</span> stride; <span class="comment">// æ»‘åŠ¨æ­¥é•¿ï¼Œå¦‚å·ç§¯æ ¸çš„æ»‘åŠ¨æ­¥é•¿</span></span><br><span class="line">    <span class="keyword">int</span> stride_x;</span><br><span class="line">    <span class="keyword">int</span> stride_y;</span><br><span class="line">    <span class="keyword">int</span> dilation; <span class="comment">//ç©ºæ´å·ç§¯å‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> antialiasing;</span><br><span class="line">    <span class="keyword">int</span> maxpool_depth;</span><br><span class="line">    <span class="keyword">int</span> out_channels; <span class="comment">// è¾“å‡ºé€šé“æ•°</span></span><br><span class="line">    <span class="keyword">int</span> reverse;</span><br><span class="line">    <span class="keyword">int</span> flatten;</span><br><span class="line">    <span class="keyword">int</span> spatial;</span><br><span class="line">    <span class="keyword">int</span> pad; <span class="comment">// è¯¥å±‚å¯¹è¾“å…¥æ•°æ®å››å‘¨çš„è¡¥0é•¿åº¦ï¼ˆç°åœ¨å‘ç°åœ¨å·ç§¯å±‚ï¼Œæœ€å¤§æ± åŒ–å±‚ä¸­æœ‰ç”¨åˆ°è¯¥å‚æ•°ï¼‰ï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶èµ‹å€¼ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> sqrt;</span><br><span class="line">    <span class="keyword">int</span> flip;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">int</span> scale_wh;</span><br><span class="line">    <span class="keyword">int</span> binary;</span><br><span class="line">    <span class="keyword">int</span> xnor;</span><br><span class="line">    <span class="keyword">int</span> peephole;</span><br><span class="line">    <span class="keyword">int</span> use_bin_output;</span><br><span class="line">    <span class="keyword">int</span> keep_delta_gpu;</span><br><span class="line">    <span class="keyword">int</span> optimized_memory;</span><br><span class="line">    <span class="keyword">int</span> steps;</span><br><span class="line">    <span class="keyword">int</span> state_constrain;</span><br><span class="line">    <span class="keyword">int</span> hidden;</span><br><span class="line">    <span class="keyword">int</span> truth;</span><br><span class="line">    <span class="keyword">float</span> smooth;</span><br><span class="line">    <span class="keyword">float</span> dot;</span><br><span class="line">    <span class="keyword">int</span> deform;</span><br><span class="line">    <span class="keyword">int</span> sway;</span><br><span class="line">    <span class="keyword">int</span> rotate;</span><br><span class="line">    <span class="keyword">int</span> stretch;</span><br><span class="line">    <span class="keyword">int</span> stretch_sway;</span><br><span class="line">    <span class="keyword">float</span> angle;</span><br><span class="line">    <span class="keyword">float</span> jitter;</span><br><span class="line">    <span class="keyword">float</span> saturation;</span><br><span class="line">    <span class="keyword">float</span> exposure;</span><br><span class="line">    <span class="keyword">float</span> shift;</span><br><span class="line">    <span class="keyword">float</span> ratio;</span><br><span class="line">    <span class="keyword">float</span> learning_rate_scale;</span><br><span class="line">    <span class="keyword">float</span> clip;</span><br><span class="line">    <span class="keyword">int</span> focal_loss;</span><br><span class="line">    <span class="keyword">float</span> *classes_multipliers;</span><br><span class="line">    <span class="keyword">float</span> label_smooth_eps;</span><br><span class="line">    <span class="keyword">int</span> noloss;</span><br><span class="line">    <span class="keyword">int</span> softmax;</span><br><span class="line">    <span class="keyword">int</span> classes; <span class="comment">// ç‰©ä½“ç±»åˆ«ç§æ•°ï¼Œä¸€ä¸ªè®­ç»ƒå¥½çš„ç½‘ç»œï¼Œåªèƒ½æ£€æµ‹æŒ‡å®šæ‰€æœ‰ç‰©ä½“ç±»åˆ«ä¸­çš„ç‰©ä½“ï¼Œæ¯”å¦‚yolo9000.cfgï¼Œè®¾ç½®è¯¥å€¼ä¸º9418ï¼Œ</span></span><br><span class="line">                 <span class="comment">// ä¹Ÿå°±æ˜¯è¯¥ç½‘ç»œè®­ç»ƒå¥½äº†ä¹‹åå¯ä»¥æ£€æµ‹9418ç§ç‰©ä½“ã€‚è¯¥å‚æ•°ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šã€‚ç›®å‰åœ¨ä½œè€…ç»™çš„ä¾‹å­ä¸­,</span></span><br><span class="line">                 <span class="comment">// æœ‰è®¾ç½®è¯¥å€¼çš„é…ç½®æ–‡ä»¶å¤§éƒ½æ˜¯æ£€æµ‹æ¨¡å‹ï¼Œçº¯è¯†åˆ«çš„ç½‘ç»œæ¨¡å‹æ²¡æœ‰è®¾ç½®è¯¥å€¼ï¼Œæˆ‘æƒ³æ˜¯å› ä¸ºæ£€æµ‹æ¨¡å‹è¾“å‡ºçš„ä¸€èˆ¬ä¼šä¸ºå„ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œ</span></span><br><span class="line">                 <span class="comment">// æ‰€ä»¥éœ€è¦çŸ¥é“è¿™ä¸ªç§ç±»æ•°ç›®ï¼Œè€Œè¯†åˆ«çš„è¯ï¼Œä¸éœ€è¦çŸ¥é“æŸä¸ªç‰©ä½“å±äºè¿™äº›æ‰€æœ‰ç±»çš„å…·ä½“æ¦‚ç‡ï¼Œå› æ­¤å¯ä»¥ä¸çŸ¥é“ã€‚</span></span><br><span class="line">    <span class="keyword">int</span> coords; <span class="comment">// è¿™ä¸ªå‚æ•°ä¸€èˆ¬ç”¨åœ¨æ£€æµ‹æ¨¡å‹ä¸­ï¼Œä¸”ä¸æ˜¯æ‰€æœ‰å±‚éƒ½æœ‰è¿™ä¸ªå‚æ•°ï¼Œä¸€èˆ¬åœ¨æ£€æµ‹æ¨¡å‹æœ€åä¸€å±‚æœ‰ï¼Œæ¯”å¦‚region_layerå±‚ï¼Œè¯¥å‚æ•°çš„å«ä¹‰</span></span><br><span class="line">                <span class="comment">// æ˜¯å®šä½ä¸€ä¸ªç‰©ä½“æ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼Œä¸€èˆ¬ä¸º4ä¸ªï¼ŒåŒ…æ‹¬ç‰©ä½“æ‰€åœ¨çŸ©å½¢æ¡†ä¸­å¿ƒåæ ‡x,yä¸¤ä¸ªå‚æ•°ä»¥åŠçŸ©å½¢æ¡†é•¿å®½w,hä¸¤ä¸ªå‚æ•°ï¼Œ</span></span><br><span class="line">                <span class="comment">// å¯ä»¥åœ¨darknet/cfgæ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰§è¡Œgrep coords *.cfgï¼Œä¼šæœç´¢å‡ºæ‰€æœ‰ä½¿ç”¨è¯¥å‚æ•°çš„æ¨¡å‹ï¼Œå¹¶å¯çœ‹åˆ°è¯¥å€¼éƒ½è®¾ç½®ä¸º4</span></span><br><span class="line">    <span class="keyword">int</span> background;</span><br><span class="line">    <span class="keyword">int</span> rescore;</span><br><span class="line">    <span class="keyword">int</span> objectness;</span><br><span class="line">    <span class="keyword">int</span> does_cost;</span><br><span class="line">    <span class="keyword">int</span> joint;</span><br><span class="line">    <span class="keyword">int</span> noadjust;</span><br><span class="line">    <span class="keyword">int</span> reorg;</span><br><span class="line">    <span class="keyword">int</span> log;</span><br><span class="line">    <span class="keyword">int</span> tanh;</span><br><span class="line">    <span class="keyword">int</span> *mask;</span><br><span class="line">    <span class="keyword">int</span> total;</span><br><span class="line">    <span class="keyword">float</span> bflops;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> adam;</span><br><span class="line">    <span class="keyword">float</span> B1;</span><br><span class="line">    <span class="keyword">float</span> B2;</span><br><span class="line">    <span class="keyword">float</span> eps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> alpha;</span><br><span class="line">    <span class="keyword">float</span> beta;</span><br><span class="line">    <span class="keyword">float</span> kappa;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> coord_scale;</span><br><span class="line">    <span class="keyword">float</span> object_scale;</span><br><span class="line">    <span class="keyword">float</span> noobject_scale;</span><br><span class="line">    <span class="keyword">float</span> mask_scale;</span><br><span class="line">    <span class="keyword">float</span> class_scale;</span><br><span class="line">    <span class="keyword">int</span> bias_match;</span><br><span class="line">    <span class="keyword">float</span> random;</span><br><span class="line">    <span class="keyword">float</span> ignore_thresh;</span><br><span class="line">    <span class="keyword">float</span> truth_thresh;</span><br><span class="line">    <span class="keyword">float</span> iou_thresh;</span><br><span class="line">    <span class="keyword">float</span> thresh;</span><br><span class="line">    <span class="keyword">float</span> focus;</span><br><span class="line">    <span class="keyword">int</span> classfix;</span><br><span class="line">    <span class="keyword">int</span> absolute;</span><br><span class="line">    <span class="keyword">int</span> assisted_excitation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> onlyforward; <span class="comment">// æ ‡å¿—å‚æ•°ï¼Œå½“å€¼ä¸º1é‚£ä¹ˆå½“å‰å±‚åªæ‰§è¡Œå‰å‘ä¼ æ’­</span></span><br><span class="line">    <span class="keyword">int</span> stopbackward;  <span class="comment">// æ ‡å¿—å‚æ•°ï¼Œç”¨æ¥å¼ºåˆ¶åœæ­¢åå‘ä¼ æ’­è¿‡ç¨‹ï¼ˆå€¼ä¸º1åˆ™åœæ­¢åå‘ä¼ æ’­ï¼‰ï¼Œå‚çœ‹network.cä¸­çš„backward_network()å‡½æ•°</span></span><br><span class="line">    <span class="keyword">int</span> dontload;</span><br><span class="line">    <span class="keyword">int</span> dontsave;</span><br><span class="line">    <span class="keyword">int</span> dontloadscales;</span><br><span class="line">    <span class="keyword">int</span> numload;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> temperature; <span class="comment">// æ¸©åº¦å‚æ•°ï¼Œsoftmaxå±‚ç‰¹æœ‰å‚æ•°ï¼Œåœ¨parse_softmax()å‡½æ•°ä¸­èµ‹å€¼ï¼Œç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼1ï¼ˆè§parse_softmax()ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> probability; <span class="comment">// dropoutæ¦‚ç‡ï¼Œå³èˆå¼ƒæ¦‚ç‡ï¼Œç›¸åº”çš„1-probabilityä¸ºä¿ç•™æ¦‚ç‡ï¼ˆå…·ä½“çš„ä½¿ç”¨å¯å‚è§forward_dropout_layer()ï¼‰ï¼Œåœ¨make_dropout_layer()ä¸­èµ‹å€¼ï¼Œ</span></span><br><span class="line">						<span class="comment">// å…¶å€¼ç”±ç½‘ç»œé…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¦‚æœç½‘ç»œé…ç½®æ–‡ä»¶æœªæŒ‡å®šï¼Œåˆ™å–é»˜è®¤å€¼0.5ï¼ˆè§parse_dropout()ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> dropblock_size_rel;</span><br><span class="line">    <span class="keyword">int</span> dropblock_size_abs;</span><br><span class="line">    <span class="keyword">int</span> dropblock;</span><br><span class="line">    <span class="keyword">float</span> scale; <span class="comment">// åœ¨dropoutå±‚ä¸­ï¼Œè¯¥å˜é‡æ˜¯ä¸€ä¸ªæ¯”ä¾‹å› å­ï¼Œå–å€¼ä¸ºä¿ç•™æ¦‚ç‡çš„å€’æ•°ï¼ˆdarknetå®ç°ç”¨çš„æ˜¯inverted dropoutï¼‰ï¼Œç”¨äºç¼©æ”¾è¾“å…¥å…ƒç´ çš„å€¼</span></span><br><span class="line">                       <span class="comment">// ï¼ˆåœ¨ç½‘ä¸Šéšä¾¿æœç´¢å…³äºdropoutçš„åšå®¢ï¼Œéƒ½ä¼šæåˆ°inverted dropoutï¼‰ï¼Œåœ¨make_dropout_layer()å‡½æ•°ä¸­èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>  * cweights;</span><br><span class="line">    <span class="keyword">int</span>   * indexes; <span class="comment">// ç»´åº¦ä¸ºl.out_h * l.out_w * l.out_c * l.batchï¼Œå¯çŸ¥åŒ…å«æ•´ä¸ªbatchè¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span></span><br><span class="line">                     <span class="comment">// ç›®å‰ä»…å‘ç°å…¶ç”¨åœ¨åœ¨æœ€å¤§æ± åŒ–å±‚ä¸­ã€‚è¯¥å˜é‡å­˜å‚¨çš„æ˜¯ç´¢å¼•å€¼ï¼Œå¹¶ä¸å½“å‰å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œè¡¨ç¤ºå½“å‰å±‚æ¯ä¸ªè¾“å‡ºå…ƒç´ çš„å€¼æ˜¯ä¸Šä¸€å±‚è¾“å‡ºä¸­çš„å“ªä¸€ä¸ªå…ƒç´ å€¼ï¼ˆå­˜å‚¨çš„ç´¢å¼•å€¼æ˜¯</span></span><br><span class="line">                     <span class="comment">// åœ¨ä¸Šä¸€å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ï¼ˆåŒ…å«æ•´ä¸ªbatchï¼‰ä¸­çš„ç´¢å¼•ï¼‰ï¼Œå› ä¸ºå¯¹äºæœ€å¤§æ± åŒ–å±‚ï¼Œæ¯ä¸€ä¸ªè¾“å‡ºå…ƒç´ çš„å€¼å®é™…æ˜¯ä¸Šä¸€å±‚è¾“å‡ºï¼ˆä¹Ÿå³å½“å‰å±‚è¾“å…¥ï¼‰æŸä¸ªæ± åŒ–åŒºåŸŸä¸­çš„æœ€å¤§å…ƒç´ å€¼ï¼Œindexeså°±æ˜¯è®°å½•</span></span><br><span class="line">                     <span class="comment">// è¿™äº›å±€éƒ¨æœ€å¤§å…ƒç´ å€¼åœ¨ä¸Šä¸€å±‚æ‰€æœ‰è¾“å‡ºå…ƒç´ ä¸­çš„æ€»ç´¢å¼•ã€‚è®°å½•è¿™äº›å€¼æœ‰ä»€ä¹ˆç”¨å—ï¼Ÿå½“ç„¶æœ‰ï¼Œç”¨äºåå‘ä¼ æ’­è¿‡ç¨‹è®¡ç®—ä¸Šä¸€å±‚æ•æ„Ÿåº¦å€¼ï¼Œè¯¦è§backward_maxpool_layer()ä»¥åŠforward_maxpool_layer()å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="keyword">int</span>   * input_layers; <span class="comment">//è¿™ä¸ªå±‚æœ‰å“ªäº›è¾“å…¥å±‚</span></span><br><span class="line">    <span class="keyword">int</span>   * input_sizes; <span class="comment">// è¾“å…¥å±‚çš„å°ºå¯¸</span></span><br><span class="line">    <span class="keyword">float</span> **layers_output; <span class="comment">//äº§ç”Ÿçš„ä¸€ç³»åˆ—è¾“å‡ºå±‚</span></span><br><span class="line">    <span class="keyword">float</span> **layers_delta;</span><br><span class="line">    WEIGHTS_TYPE_T weights_type;</span><br><span class="line">    WEIGHTS_NORMALIZATION_T weights_normalizion;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªå‚æ•°ç”¨çš„ä¸å¤šï¼Œä»…åœ¨region_layer.cä¸­ä½¿ç”¨ï¼Œè¯¥å‚æ•°çš„ä½œç”¨æ˜¯ç”¨äºä¸åŒæ•°æ®é›†é—´ç±»åˆ«ç¼–å·çš„è½¬æ¢ï¼Œæ›´ä¸ºå…·ä½“çš„ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ˜¯cocoæ•°æ®é›†ä¸­80ç±»ç‰©ä½“ç¼–å·ä¸è”åˆæ•°æ®é›†ä¸­9000+ç‰©ä½“ç±»åˆ«ç¼–å·ä¹‹é—´çš„è½¬æ¢ï¼Œå¯ä»¥å¯¹æ¯”æŸ¥çœ‹data/coco.namesä¸</span></span><br><span class="line"><span class="comment">     * data/9k.namesä»¥åŠdata/coco9k.mapä¸‰ä¸ªæ–‡ä»¶ï¼ˆæ—§ç‰ˆçš„darknetå¯èƒ½æ²¡æœ‰ï¼Œæ–°ç‰ˆçš„darknetæ‰æœ‰coco9k.mapè¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¯ä»¥å‘ç°ï¼Œcoco.namesä¸­æ¯ä¸€ä¸ªç‰©ä½“ç±»åˆ«éƒ½å¯ä»¥åœ¨9k.namesä¸­æ‰¾åˆ°,ä¸”coco.namesä¸­æ¯ä¸ªç‰©ä½“ç±»åˆ«åç§°åœ¨9k.names</span></span><br><span class="line"><span class="comment">     * ä¸­æ‰€åœ¨çš„è¡Œæ•°å°±æ˜¯coco9k.mapä¸­çš„ç¼–å·å€¼ï¼ˆå‡äº†1,å› ä¸ºåœ¨ç¨‹åºæ•°ç»„ä¸­ç¼–å·ä»0å¼€å§‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªmapå°†cocoæ•°æ®é›†ä¸­</span></span><br><span class="line"><span class="comment">     * çš„ç±»åˆ«ç¼–å·æ˜ å°„åˆ°è”å’Œæ•°æ®é›†9kä¸­çš„ç±»åˆ«ç¼–å·ï¼ˆè¿™ä¸ª9kæ•°æ®é›†æ˜¯ä¸€ä¸ªè”å’Œå¤šä¸ªæ•°æ®é›†çš„å¤§æ•°é›†ï¼Œå…¶åç§°åˆ†ç±»è¢«å±‚çº§åˆ’åˆ†ï¼Œ</span></span><br><span class="line"><span class="comment">     * ï¼‰ï¼ˆæ³¨æ„ä¸¤ä¸ªæ–‡ä»¶ä¸­ç‰©ä½“çš„ç±»åˆ«åç§°å¤§éƒ¨åˆ†éƒ½ç›¸åŒï¼Œæœ‰å°éƒ¨åˆ†å­˜åœ¨å°å·®å¼‚ï¼Œè™½ç„¶æœ‰å·®å¼‚ï¼Œä½†åªæ˜¯ä¸¤ä¸ªæ•°æ®é›†ä¸­ä½¿ç”¨çš„åç§°æœ‰æ‰€å·®å¼‚è€Œå·²ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¯¹åº”çš„ç‰©ä½“æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚åœ¨coco.namesä¸­æ‘©æ‰˜è½¦çš„åç§°ä¸ºmotorbikeï¼Œåœ¨è”åˆæ•°æ®é›†9k.namesï¼Œå…¶åç§°ä¸ºmotorcycleï¼‰.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span>   * map;</span><br><span class="line">    <span class="keyword">int</span>   * counts;</span><br><span class="line">    <span class="keyword">float</span> ** sums;</span><br><span class="line">	<span class="comment">// è¿™ä¸ªå‚æ•°ç›®å‰åªå‘ç°ç”¨åœ¨dropoutå±‚ï¼Œç”¨äºå­˜å‚¨ä¸€äº›åˆ—çš„éšæœºæ•°ï¼Œè¿™äº›éšæœºæ•°ä¸dropoutå±‚çš„è¾“å…¥å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œç»´åº¦ä¸ºl.batch*l.inputsï¼ˆåŒ…å«æ•´ä¸ªbatchçš„ï¼‰ï¼Œåœ¨make_dropout_layer()å‡½æ•°ä¸­ç”¨callocåŠ¨æ€åˆ†é…å†…å­˜ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¹¶åœ¨å‰å‘ä¼ æ’­å‡½æ•°forward_dropout_layer()å‡½æ•°ä¸­é€å…ƒç´ èµ‹å€¼ã€‚é‡Œé¢å­˜å‚¨çš„éšæœºæ•°æ»¡è¶³0~1å‡åŒ€åˆ†å¸ƒï¼Œå¹²ä»€ä¹ˆç”¨å‘¢ï¼Ÿç”¨äºå†³å®šè¯¥è¾“å…¥å…ƒç´ çš„å»ç•™ï¼Œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çŸ¥é“dropoutå±‚å°±å®Œæˆä¸€ä¸ªäº‹ï¼šæŒ‰ç…§ä¸€å®šæ¦‚ç‡èˆå¼ƒè¾“å…¥ç¥ç»å…ƒï¼ˆæ‰€è°“èˆå¼ƒå°±æ˜¯ç½®è¯¥è¾“å…¥çš„å€¼ä¸º0ï¼‰ï¼Œrandä¸­å­˜å‚¨çš„å€¼å°±æ˜¯å¦‚æœå°äºl.probabilityï¼Œåˆ™èˆå¼ƒè¯¥è¾“å…¥ç¥ç»å…ƒï¼ˆè¯¦è§ï¼šforward_dropout_layer()ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment">// ä¸ºä»€ä¹ˆè¦ä¿ç•™è¿™äº›éšæœºæ•°å‘¢ï¼Ÿå’Œæœ€å¤§æ± åŒ–å±‚ä¸­çš„l.indexesç±»ä¼¼ï¼Œåœ¨åå‘ä¼ æ’­å‡½æ•°backward_dropout_layer()ä¸­ç”¨æ¥æŒ‡ç¤ºè®¡ç®—ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å€¼ï¼Œå› ä¸ºdropoutèˆå¼ƒäº†ä¸€äº›è¾“å…¥ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™äº›è¾“å…¥ï¼ˆdropoutå±‚çš„è¾“å…¥ï¼Œä¸Šä¸€å±‚çš„è¾“å‡ºï¼‰å¯¹åº”çš„æ•æ„Ÿåº¦å€¼å¯ä»¥ç½®ä¸º0ï¼Œè€Œé‚£äº›æ²¡æœ‰èˆå¼ƒçš„è¾“å…¥ï¼Œæ‰æœ‰å¿…è¦ç”±å½“å‰dropoutå±‚åå‘ä¼ æ’­è¿‡å»ã€‚</span></span><br><span class="line">    <span class="keyword">float</span> * rand;</span><br><span class="line">    <span class="keyword">float</span> * cost;</span><br><span class="line">    <span class="keyword">float</span> * state;</span><br><span class="line">    <span class="keyword">float</span> * prev_state;</span><br><span class="line">    <span class="keyword">float</span> * forgot_state;</span><br><span class="line">    <span class="keyword">float</span> * forgot_delta;</span><br><span class="line">    <span class="keyword">float</span> * state_delta;</span><br><span class="line">    <span class="keyword">float</span> * combine_cpu;</span><br><span class="line">    <span class="keyword">float</span> * combine_delta_cpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *concat;</span><br><span class="line">    <span class="keyword">float</span> *concat_delta;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *binary_weights;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *biases;  <span class="comment">// å½“å‰å±‚æ‰€æœ‰åç½®ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦l.nï¼Œæ¯ä¸ªå·ç§¯æ ¸æœ‰ä¸€ä¸ªåç½®ï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ç­‰äºå•å¼ è¾“å…¥å›¾ç‰‡å¯¹åº”çš„å…ƒç´ ä¸ªæ•°å³outputsï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()</span></span><br><span class="line">    <span class="keyword">float</span> *bias_updates; <span class="comment">// å½“å‰å±‚æ‰€æœ‰åç½®æ›´æ–°å€¼ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦l.nï¼Œæ¯ä¸ªå·ç§¯æ ¸æœ‰ä¸€ä¸ªåç½®ï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºoutputsã€‚æ‰€è°“æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå°±æ˜¯æ¢¯åº¦ä¸‹é™ä¸­ä¸æ­¥é•¿ç›¸ä¹˜çš„é‚£é¡¹ï¼Œä¹Ÿå³è¯¯å·®å¯¹åç½®çš„å¯¼æ•°ï¼Œ</span></span><br><span class="line">                          <span class="comment">// ä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer())</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *scales;</span><br><span class="line">    <span class="keyword">float</span> *scale_updates;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *weights; <span class="comment">//å½“å‰å±‚æ‰€æœ‰æƒé‡ç³»æ•°ï¼ˆè¿æ¥å½“å‰å±‚å’Œä¸Šä¸€å±‚çš„ç³»æ•°ï¼Œä½†è®°åœ¨å½“å‰å±‚ä¸Šï¼‰ï¼Œå¯¹äºå·ç§¯å±‚ï¼Œç»´åº¦ä¸ºl.n*l.c*l.size*l.sizeï¼Œå³å·ç§¯æ ¸ä¸ªæ•°ä¹˜ä»¥å·ç§¯æ ¸å°ºå¯¸å†ä¹˜ä»¥è¾“å…¥é€šé“æ•°ï¼ˆå„ä¸ªé€šé“ä¸Šçš„æƒé‡ç³»æ•°ç‹¬ç«‹ä¸ä¸€æ ·ï¼‰ï¼›</span></span><br><span class="line">                     <span class="comment">// å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºå•å¼ å›¾ç‰‡è¾“å…¥ä¸è¾“å‡ºå…ƒç´ ä¸ªæ•°ä¹‹ç§¯inputs*outputsï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> *weight_updates;<span class="comment">// å½“å‰å±‚æ‰€æœ‰æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå¯¹äºå·ç§¯å±‚ç»´åº¦ä¸ºl.n*l.c*l.size*l.sizeï¼›å¯¹äºå…¨è¿æ¥å±‚ï¼Œç»´åº¦ä¸ºå•å¼ å›¾ç‰‡è¾“å…¥ä¸è¾“å‡ºå…ƒç´ ä¸ªæ•°ä¹‹ç§¯inputs*outputsï¼Œ</span></span><br><span class="line">                            <span class="comment">// æ‰€è°“æƒé‡ç³»æ•°æ›´æ–°å€¼ï¼Œå°±æ˜¯æ¢¯åº¦ä¸‹é™ä¸­ä¸æ­¥é•¿ç›¸ä¹˜çš„é‚£é¡¹ï¼Œä¹Ÿå³è¯¯å·®å¯¹æƒé‡çš„å¯¼æ•°ï¼Œä¸€èˆ¬åœ¨å„ç½‘ç»œæ„å»ºå‡½æ•°ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_connected_layer()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> scale_x_y;</span><br><span class="line">    <span class="keyword">float</span> max_delta;</span><br><span class="line">    <span class="keyword">float</span> uc_normalizer;</span><br><span class="line">    <span class="keyword">float</span> iou_normalizer;</span><br><span class="line">    <span class="keyword">float</span> cls_normalizer;</span><br><span class="line">    IOU_LOSS iou_loss;</span><br><span class="line">    NMS_KIND nms_kind;</span><br><span class="line">    <span class="keyword">float</span> beta_nms;</span><br><span class="line">    YOLO_POINT yolo_point;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *align_bit_weights_gpu;</span><br><span class="line">    <span class="keyword">float</span> *mean_arr_gpu;</span><br><span class="line">    <span class="keyword">float</span> *align_workspace_gpu;</span><br><span class="line">    <span class="keyword">float</span> *transposed_align_workspace_gpu;</span><br><span class="line">    <span class="keyword">int</span> align_workspace_size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *align_bit_weights;</span><br><span class="line">    <span class="keyword">float</span> *mean_arr;</span><br><span class="line">    <span class="keyword">int</span> align_bit_weights_size;</span><br><span class="line">    <span class="keyword">int</span> lda_align;</span><br><span class="line">    <span class="keyword">int</span> new_lda;</span><br><span class="line">    <span class="keyword">int</span> bit_align;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *col_image;</span><br><span class="line">    <span class="keyword">float</span> * delta; <span class="comment">// å­˜å‚¨æ¯ä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼šåŒ…å«æ‰€æœ‰è¾“å‡ºå…ƒç´ çš„æ•æ„Ÿåº¦å€¼ï¼ˆæ•´ä¸ªbatchæ‰€æœ‰å›¾ç‰‡ï¼‰ã€‚æ‰€è°“æ•æ„Ÿåº¦ï¼Œå³è¯¯å·®å‡½æ•°å…³äºå½“å‰å±‚æ¯ä¸ªåŠ æƒè¾“å…¥çš„å¯¼æ•°å€¼ï¼Œ</span></span><br><span class="line">                   <span class="comment">// å…³äºæ•æ„Ÿåº¦å›¾è¿™ä¸ªåç§°ï¼Œå…¶å®å°±æ˜¯æ¢¯åº¦ï¼Œå¯ä»¥å‚è€ƒhttps://www.zybuluo.com/hanbingtao/note/485480ã€‚</span></span><br><span class="line">                   <span class="comment">// å…ƒç´ ä¸ªæ•°ä¸ºl.batch * l.outputsï¼ˆå…¶ä¸­l.outputs = l.out_h * l.out_w * l.out_cï¼‰ï¼Œ</span></span><br><span class="line">                   <span class="comment">// å¯¹äºå·ç§¯ç¥ç»ç½‘ç»œï¼Œåœ¨make_convolutional_layer()åŠ¨æ€åˆ†é…å†…å­˜ï¼ŒæŒ‰è¡Œå­˜å‚¨ï¼Œå¯è§†ä¸ºl.batchè¡Œï¼Œl.outputsåˆ—ï¼Œ</span></span><br><span class="line">                   <span class="comment">// å³batchä¸­æ¯ä¸€å¼ å›¾ç‰‡ï¼Œå¯¹åº”l.deltaä¸­çš„ä¸€è¡Œï¼Œè€Œè¿™ä¸€è¡Œï¼Œåˆå¯ä»¥è§†ä½œæœ‰l.out_cè¡Œï¼Œl.out_h*l.out_cåˆ—ï¼Œ</span></span><br><span class="line">                   <span class="comment">// å…¶ä¸­æ¯å°è¡Œå¯¹åº”ä¸€å¼ è¾“å…¥å›¾ç‰‡çš„ä¸€å¼ è¾“å‡ºç‰¹å¾å›¾çš„æ•æ„Ÿåº¦ã€‚ä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span></span><br><span class="line">    <span class="keyword">float</span> * output; <span class="comment">// å­˜å‚¨è¯¥å±‚æ‰€æœ‰çš„è¾“å‡ºï¼Œç»´åº¦ä¸ºl.out_h * l.out_w * l.out_c * l.batchï¼Œå¯çŸ¥åŒ…å«æ•´ä¸ªbatchè¾“å…¥å›¾ç‰‡çš„è¾“å‡ºï¼Œä¸€èˆ¬åœ¨æ„å»ºå…·ä½“ç½‘ç»œå±‚æ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆæ¯”å¦‚make_maxpool_layer()ä¸­ï¼‰ã€‚</span></span><br><span class="line">                    <span class="comment">// æŒ‰è¡Œå­˜å‚¨ï¼šæ¯å¼ å›¾ç‰‡æŒ‰è¡Œé“ºæ’æˆä¸€å¤§è¡Œï¼Œå›¾ç‰‡é—´å†å¹¶æˆä¸€è¡Œã€‚</span></span><br><span class="line">    <span class="keyword">float</span> * activation_input;</span><br><span class="line">    <span class="keyword">int</span> delta_pinned;</span><br><span class="line">    <span class="keyword">int</span> output_pinned;</span><br><span class="line">    <span class="keyword">float</span> * loss;</span><br><span class="line">    <span class="keyword">float</span> * squared;</span><br><span class="line">    <span class="keyword">float</span> * norms;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * spatial_mean;</span><br><span class="line">    <span class="keyword">float</span> * mean;</span><br><span class="line">    <span class="keyword">float</span> * variance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * mean_delta;</span><br><span class="line">    <span class="keyword">float</span> * variance_delta;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * rolling_mean;</span><br><span class="line">    <span class="keyword">float</span> * rolling_variance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * x;</span><br><span class="line">    <span class="keyword">float</span> * x_norm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * m;</span><br><span class="line">    <span class="keyword">float</span> * v;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * bias_m;</span><br><span class="line">    <span class="keyword">float</span> * bias_v;</span><br><span class="line">    <span class="keyword">float</span> * scale_m;</span><br><span class="line">    <span class="keyword">float</span> * scale_v;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *z_cpu;</span><br><span class="line">    <span class="keyword">float</span> *r_cpu;</span><br><span class="line">    <span class="keyword">float</span> *h_cpu;</span><br><span class="line">    <span class="keyword">float</span> *stored_h_cpu;</span><br><span class="line">    <span class="keyword">float</span> * prev_state_cpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *temp_cpu;</span><br><span class="line">    <span class="keyword">float</span> *temp2_cpu;</span><br><span class="line">    <span class="keyword">float</span> *temp3_cpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *dh_cpu;</span><br><span class="line">    <span class="keyword">float</span> *hh_cpu;</span><br><span class="line">    <span class="keyword">float</span> *prev_cell_cpu;</span><br><span class="line">    <span class="keyword">float</span> *cell_cpu;</span><br><span class="line">    <span class="keyword">float</span> *f_cpu;</span><br><span class="line">    <span class="keyword">float</span> *i_cpu;</span><br><span class="line">    <span class="keyword">float</span> *g_cpu;</span><br><span class="line">    <span class="keyword">float</span> *o_cpu;</span><br><span class="line">    <span class="keyword">float</span> *c_cpu;</span><br><span class="line">    <span class="keyword">float</span> *stored_c_cpu;</span><br><span class="line">    <span class="keyword">float</span> *dc_cpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *binary_input;</span><br><span class="line">    <span class="keyword">uint32_t</span> *bin_re_packed_input;</span><br><span class="line">    <span class="keyword">char</span> *t_bit_input;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">self_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">output_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">reset_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">update_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_gate_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_gate_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_save_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_save_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_state_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_state_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_z_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_z_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_r_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_r_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">input_h_layer</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">state_h_layer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wz</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">uz</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wr</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">ur</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wh</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">uh</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">uo</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wo</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">vo</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">uf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">vf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">ui</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wi</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">vi</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">ug</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">layer</span> *<span class="title">wg</span>;</span></span><br><span class="line"> </span><br><span class="line">    tree *softmax_tree; <span class="comment">// softmaxå±‚ç”¨åˆ°çš„ä¸€ä¸ªå‚æ•°ï¼Œä¸è¿‡è¿™ä¸ªå‚æ•°ä¼¼ä¹å¹¶ä¸å¸¸è§ï¼Œå¾ˆå¤šç”¨åˆ°softmaxå±‚çš„ç½‘ç»œå¹¶æ²¡ç”¨ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œç›®å‰ä»…å‘ç°darknet9000.cfgä¸­ä½¿ç”¨äº†è¯¥å‚æ•°ï¼Œå¦‚æœæœªç”¨åˆ°è¯¥å‚æ•°ï¼Œå…¶å€¼ä¸ºNULLï¼Œå¦‚æœç”¨åˆ°äº†åˆ™ä¼šåœ¨parse_softmax()ä¸­èµ‹å€¼ï¼Œ</span></span><br><span class="line">                       <span class="comment">// ç›®å‰ä¸ªäººçš„åˆæ­¥çŒœæµ‹æ˜¯åˆ©ç”¨è¯¥å‚æ•°æ¥ç»„ç»‡æ ‡ç­¾æ•°æ®ï¼Œä»¥æ–¹ä¾¿è®¿é—®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span> workspace_size; <span class="comment">// net.workspaceçš„å…ƒç´ ä¸ªæ•°ï¼Œä¸ºæ‰€æœ‰å±‚ä¸­æœ€å¤§çš„l.out_h*l.out_w*l.size*l.size*l.cï¼Œï¼ˆåœ¨make_convolutional_layer()è®¡ç®—å¾—åˆ°workspace_sizeçš„å¤§å°ï¼Œåœ¨parse_network_cfg()ä¸­åŠ¨æ€åˆ†é…å†…å­˜ï¼Œæ­¤å€¼å¯¹åº”æœªä½¿ç”¨gpuæ—¶çš„æƒ…å†µ</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="keyword">int</span> *indexes_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *z_gpu;</span><br><span class="line">    <span class="keyword">float</span> *r_gpu;</span><br><span class="line">    <span class="keyword">float</span> *h_gpu;</span><br><span class="line">    <span class="keyword">float</span> *stored_h_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *temp_gpu;</span><br><span class="line">    <span class="keyword">float</span> *temp2_gpu;</span><br><span class="line">    <span class="keyword">float</span> *temp3_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *dh_gpu;</span><br><span class="line">    <span class="keyword">float</span> *hh_gpu;</span><br><span class="line">    <span class="keyword">float</span> *prev_cell_gpu;</span><br><span class="line">    <span class="keyword">float</span> *prev_state_gpu;</span><br><span class="line">    <span class="keyword">float</span> *last_prev_state_gpu;</span><br><span class="line">    <span class="keyword">float</span> *last_prev_cell_gpu;</span><br><span class="line">    <span class="keyword">float</span> *cell_gpu;</span><br><span class="line">    <span class="keyword">float</span> *f_gpu;</span><br><span class="line">    <span class="keyword">float</span> *i_gpu;</span><br><span class="line">    <span class="keyword">float</span> *g_gpu;</span><br><span class="line">    <span class="keyword">float</span> *o_gpu;</span><br><span class="line">    <span class="keyword">float</span> *c_gpu;</span><br><span class="line">    <span class="keyword">float</span> *stored_c_gpu;</span><br><span class="line">    <span class="keyword">float</span> *dc_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// adam</span></span><br><span class="line">    <span class="keyword">float</span> *m_gpu;</span><br><span class="line">    <span class="keyword">float</span> *v_gpu;</span><br><span class="line">    <span class="keyword">float</span> *bias_m_gpu;</span><br><span class="line">    <span class="keyword">float</span> *scale_m_gpu;</span><br><span class="line">    <span class="keyword">float</span> *bias_v_gpu;</span><br><span class="line">    <span class="keyword">float</span> *scale_v_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * combine_gpu;</span><br><span class="line">    <span class="keyword">float</span> * combine_delta_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * forgot_state_gpu;</span><br><span class="line">    <span class="keyword">float</span> * forgot_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * state_gpu;</span><br><span class="line">    <span class="keyword">float</span> * state_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * gate_gpu;</span><br><span class="line">    <span class="keyword">float</span> * gate_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * save_gpu;</span><br><span class="line">    <span class="keyword">float</span> * save_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * concat_gpu;</span><br><span class="line">    <span class="keyword">float</span> * concat_delta_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *binary_input_gpu;</span><br><span class="line">    <span class="keyword">float</span> *binary_weights_gpu;</span><br><span class="line">    <span class="keyword">float</span> *bin_conv_shortcut_in_gpu;</span><br><span class="line">    <span class="keyword">float</span> *bin_conv_shortcut_out_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * mean_gpu;</span><br><span class="line">    <span class="keyword">float</span> * variance_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * rolling_mean_gpu;</span><br><span class="line">    <span class="keyword">float</span> * rolling_variance_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * variance_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * mean_delta_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * col_image_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * x_gpu;</span><br><span class="line">    <span class="keyword">float</span> * x_norm_gpu;</span><br><span class="line">    <span class="keyword">float</span> * weights_gpu;</span><br><span class="line">    <span class="keyword">float</span> * weight_updates_gpu;</span><br><span class="line">    <span class="keyword">float</span> * weight_deform_gpu;</span><br><span class="line">    <span class="keyword">float</span> * weight_change_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * weights_gpu16;</span><br><span class="line">    <span class="keyword">float</span> * weight_updates_gpu16;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * biases_gpu;</span><br><span class="line">    <span class="keyword">float</span> * bias_updates_gpu;</span><br><span class="line">    <span class="keyword">float</span> * bias_change_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * scales_gpu;</span><br><span class="line">    <span class="keyword">float</span> * scale_updates_gpu;</span><br><span class="line">    <span class="keyword">float</span> * scale_change_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> * input_antialiasing_gpu;</span><br><span class="line">    <span class="keyword">float</span> * output_gpu;</span><br><span class="line">    <span class="keyword">float</span> * activation_input_gpu;</span><br><span class="line">    <span class="keyword">float</span> * loss_gpu;</span><br><span class="line">    <span class="keyword">float</span> * delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> * rand_gpu;</span><br><span class="line">    <span class="keyword">float</span> * squared_gpu;</span><br><span class="line">    <span class="keyword">float</span> * norms_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *gt_gpu;</span><br><span class="line">    <span class="keyword">float</span> *a_avg_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *input_sizes_gpu;</span><br><span class="line">    <span class="keyword">float</span> **layers_output_gpu;</span><br><span class="line">    <span class="keyword">float</span> **layers_delta_gpu;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CUDNN</span></span><br><span class="line">    cudnnTensorDescriptor_t srcTensorDesc, dstTensorDesc;</span><br><span class="line">    cudnnTensorDescriptor_t srcTensorDesc16, dstTensorDesc16;</span><br><span class="line">    cudnnTensorDescriptor_t dsrcTensorDesc, ddstTensorDesc;</span><br><span class="line">    cudnnTensorDescriptor_t dsrcTensorDesc16, ddstTensorDesc16;</span><br><span class="line">    cudnnTensorDescriptor_t normTensorDesc, normDstTensorDesc, normDstTensorDescF16;</span><br><span class="line">    cudnnFilterDescriptor_t weightDesc, weightDesc16;</span><br><span class="line">    cudnnFilterDescriptor_t dweightDesc, dweightDesc16;</span><br><span class="line">    cudnnConvolutionDescriptor_t convDesc;</span><br><span class="line">    cudnnConvolutionFwdAlgo_t fw_algo, fw_algo16;</span><br><span class="line">    cudnnConvolutionBwdDataAlgo_t bd_algo, bd_algo16;</span><br><span class="line">    cudnnConvolutionBwdFilterAlgo_t bf_algo, bf_algo16;</span><br><span class="line">    cudnnPoolingDescriptor_t poolingDesc;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// CUDNN</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// GPU</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetæ¡†æ¶æ€»è§ˆ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E6%A1%86%E6%9E%B6%E6%80%BB%E8%A7%88/</url>
    <content><![CDATA[<h2 id="Darknetæ¡†æ¶åˆ†æä¸»çº¿"><a href="#Darknetæ¡†æ¶åˆ†æä¸»çº¿" class="headerlink" title="Darknetæ¡†æ¶åˆ†æä¸»çº¿"></a>Darknetæ¡†æ¶åˆ†æä¸»çº¿</h2><h3 id="åˆ†æä¸»çº¿çš„ç¡®å®š"><a href="#åˆ†æä¸»çº¿çš„ç¡®å®š" class="headerlink" title="åˆ†æä¸»çº¿çš„ç¡®å®š"></a>åˆ†æä¸»çº¿çš„ç¡®å®š</h3><p>Darknetç›¸æ¯”å½“å‰è®­ç»ƒçš„C/C++ä¸»æµæ¡†æ¶ï¼ˆå¦‚Caffeï¼‰æ¥è®²ï¼Œå…·æœ‰ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¾èµ–å°‘ï¼Œæ˜“éƒ¨ç½²ç­‰ä¼—å¤šä¼˜ç‚¹ï¼Œæˆ‘ä»¬å…ˆå®šä½åˆ°<code>src/darknet.c</code>é‡Œé¢çš„<code>main</code>å‡½æ•°ï¼Œè¿™æ˜¯è¿™ä¸ªæ¡†æ¶å®ç°åˆ†ç±»ï¼Œå®šä½ï¼Œå›å½’ï¼Œåˆ†å‰²ç­‰åŠŸèƒ½çš„åˆå§‹å…¥å£ã€‚è¿™ä¸€èŠ‚çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„ä¸€ä¸‹å°±æ˜¯<code>run_yolo</code>åªæä¾›äº†<code>yolo</code>ç›®æ ‡æ£€æµ‹ç®—æ³•çš„åŸå§‹å®ç°ã€‚è€Œ<code>run_detector</code>å‡½æ•°æä¾›äº†AlexeyABæ·»åŠ äº†å„ç§æ–°ç‰¹æ€§çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œæ‰€ä»¥ä¹‹åæˆ‘ä»¬ä¼šä»è¿™ä¸ªå‡½æ•°è·Ÿè¿›å»æ¥è§£æDarknetæ¡†æ¶ã€‚Darknetæä¾›çš„å…¶ä»–åŠŸèƒ½å¦‚<code>run_super</code>ï¼ˆé«˜åˆ†è¾¨ç‡é‡å»ºï¼‰ï¼Œ<code>run_classifier</code>ï¼ˆå›¾åƒåˆ†ç±»ï¼‰ï¼Œ<code>run_char_rnn</code>ï¼ˆRNNæ–‡æœ¬è¯†åˆ«ï¼‰æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»è¯»ï¼ˆè¿™ä¸ªæ¡†æ¶ç”¨æ¥åšç›®æ ‡æ£€æµ‹æ¯”è¾ƒå¥½ï¼Œå…¶ä»–ç®—æ³•å»ºè®®è¿˜æ˜¯å»å…¶å®ƒæ¡†æ¶å®ç°å§ï¼‰ï¼Œæœ¬ç³»åˆ—åªè®²ç›®æ ‡æ£€æµ‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;average&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">average</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;yolo&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_yolo</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;voxel&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_voxel</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;super&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_super</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;detector&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_detector</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;detect&quot;</span>))&#123;</span><br><span class="line">       <span class="keyword">float</span> thresh = <span class="built_in">find_float_arg</span>(argc, argv, <span class="string">&quot;-thresh&quot;</span>, <span class="number">.24</span>);</span><br><span class="line">	<span class="keyword">int</span> ext_output = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-ext_output&quot;</span>);</span><br><span class="line">       <span class="keyword">char</span> *filename = (argc &gt; <span class="number">4</span>) ? argv[<span class="number">4</span>]: <span class="number">0</span>;</span><br><span class="line">       <span class="built_in">test_detector</span>(<span class="string">&quot;cfg/coco.data&quot;</span>, argv[<span class="number">2</span>], argv[<span class="number">3</span>], filename, thresh, <span class="number">0.5</span>, <span class="number">0</span>, ext_output, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;cifar&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_cifar</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;go&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_go</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;rnn&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_char_rnn</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;vid&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_vid_rnn</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;coco&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_coco</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;classify&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">predict_classifier</span>(<span class="string">&quot;cfg/imagenet1k.data&quot;</span>, argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>], <span class="number">5</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;classifier&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_classifier</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;art&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_art</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;tag&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_tag</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;compare&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_compare</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;dice&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_dice</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;writing&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_writing</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;3d&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">composite_3d</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>], (argc &gt; <span class="number">5</span>) ? <span class="built_in">atof</span>(argv[<span class="number">5</span>]) : <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;test&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">test_resize</span>(argv[<span class="number">2</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;captcha&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_captcha</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;nightmare&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">run_nightmare</span>(argc, argv);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;rgbgr&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">rgbgr_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;reset&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">reset_normalize_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;denormalize&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">denormalize_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;statistics&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">statistics_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;normalize&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">normalize_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;rescale&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">rescale_net</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;ops&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">operations</span>(argv[<span class="number">2</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;speed&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">speed</span>(argv[<span class="number">2</span>], (argc &gt; <span class="number">3</span> &amp;&amp; argv[<span class="number">3</span>]) ? <span class="built_in">atoi</span>(argv[<span class="number">3</span>]) : <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;oneoff&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">oneoff</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;partial&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">partial</span>(argv[<span class="number">2</span>], argv[<span class="number">3</span>], argv[<span class="number">4</span>], <span class="built_in">atoi</span>(argv[<span class="number">5</span>]));</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;visualize&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">visualize</span>(argv[<span class="number">2</span>], (argc &gt; <span class="number">3</span>) ? argv[<span class="number">3</span>] : <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;imtest&quot;</span>))&#123;</span><br><span class="line">       <span class="built_in">test_resize</span>(argv[<span class="number">2</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Not an option: %s\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·Ÿè¿›run-detector"><a href="#è·Ÿè¿›run-detector" class="headerlink" title="è·Ÿè¿›run_detector"></a>è·Ÿè¿›run_detector</h3><p><code>run_detector</code>å‡½æ•°åœ¨<code>src/detector.c</code>é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆæœ‰å¾ˆå¤šè¶…å‚æ•°å¯ä»¥è®¾ç½®ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°åŒ…å«äº†è®­ç»ƒéªŒè¯ï¼Œæµ‹è¯•ï¼Œè®¡ç®—Anchorsï¼Œdemoå±•ç¤ºï¼Œè®¡ç®—mapå€¼å’Œrecallå€¼ç­‰åŠŸèƒ½ã€‚ç”±äºè®­ç»ƒï¼Œæµ‹è¯•ï¼ŒéªŒè¯é˜¶æ®µå·®ä¸å¤šï¼Œæˆ‘ä»¬è·Ÿè¿›å»ä¸€ä¸ªçœ‹çœ‹å°±å¥½ï¼Œè‡³äºåé¢é‚£å‡ ä¸ªåŠŸèƒ½æ˜¯AlexeyABæ·»åŠ çš„ï¼Œä¹‹åå†é€ä¸€è§£é‡Šã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run_detector</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dont_show = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-dont_show&quot;</span>);<span class="comment">//å±•ç¤ºå›¾åƒç•Œé¢</span></span><br><span class="line">    <span class="keyword">int</span> benchmark = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-benchmark&quot;</span>);<span class="comment">//è¯„ä¼°æ¨¡å‹çš„è¡¨ç°</span></span><br><span class="line">    <span class="keyword">int</span> benchmark_layers = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-benchmark_layers&quot;</span>);</span><br><span class="line">    <span class="comment">//if (benchmark_layers) benchmark = 1;</span></span><br><span class="line">    <span class="keyword">if</span> (benchmark) dont_show = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> show = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-show&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> letter_box = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-letter_box&quot;</span>);<span class="comment">//æ˜¯å¦å¯¹å›¾åƒåšletter-boxå˜æ¢</span></span><br><span class="line">    <span class="keyword">int</span> calc_map = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-map&quot;</span>);<span class="comment">//æ˜¯å¦è®¡ç®—mapå€¼</span></span><br><span class="line">    <span class="keyword">int</span> map_points = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-points&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    check_mistakes = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-check_mistakes&quot;</span>);<span class="comment">//æ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">    <span class="keyword">int</span> show_imgs = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-show_imgs&quot;</span>);<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">int</span> mjpeg_port = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-mjpeg_port&quot;</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> json_port = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-json_port&quot;</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">char</span> *http_post_host = <span class="built_in">find_char_arg</span>(argc, argv, <span class="string">&quot;-http_post_host&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> time_limit_sec = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-time_limit_sec&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">char</span> *out_filename = <span class="built_in">find_char_arg</span>(argc, argv, <span class="string">&quot;-out_filename&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">char</span> *outfile = <span class="built_in">find_char_arg</span>(argc, argv, <span class="string">&quot;-out&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">char</span> *prefix = <span class="built_in">find_char_arg</span>(argc, argv, <span class="string">&quot;-prefix&quot;</span>, <span class="number">0</span>);<span class="comment">//æ¨¡å‹ä¿å­˜çš„å‰ç¼€</span></span><br><span class="line">    <span class="keyword">float</span> thresh = <span class="built_in">find_float_arg</span>(argc, argv, <span class="string">&quot;-thresh&quot;</span>, <span class="number">.25</span>);    <span class="comment">// ç½®ä¿¡åº¦</span></span><br><span class="line">    <span class="keyword">float</span> iou_thresh = <span class="built_in">find_float_arg</span>(argc, argv, <span class="string">&quot;-iou_thresh&quot;</span>, <span class="number">.5</span>);    <span class="comment">// 0.5 for mAP</span></span><br><span class="line">    <span class="keyword">float</span> hier_thresh = <span class="built_in">find_float_arg</span>(argc, argv, <span class="string">&quot;-hier&quot;</span>, <span class="number">.5</span>);</span><br><span class="line">    <span class="keyword">int</span> cam_index = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-c&quot;</span>, <span class="number">0</span>);<span class="comment">//æ‘„åƒå¤´ç¼–å·</span></span><br><span class="line">    <span class="keyword">int</span> frame_skip = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-s&quot;</span>, <span class="number">0</span>);<span class="comment">//è·³å¸§æ£€æµ‹é—´éš”</span></span><br><span class="line">    <span class="keyword">int</span> num_of_clusters = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-num_of_clusters&quot;</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">int</span> width = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-width&quot;</span>, <span class="number">-1</span>);<span class="comment">// è¾“å…¥ç½‘ç»œçš„å›¾åƒå®½åº¦</span></span><br><span class="line">    <span class="keyword">int</span> height = <span class="built_in">find_int_arg</span>(argc, argv, <span class="string">&quot;-height&quot;</span>, <span class="number">-1</span>);<span class="comment">// è¾“å…¥ç½‘ç»œçš„å›¾åƒé«˜åº¦</span></span><br><span class="line">    <span class="comment">// extended output in test mode (output of rect bound coords)</span></span><br><span class="line">    <span class="comment">// and for recall mode (extended output table-like format with results for best_class fit)</span></span><br><span class="line">    <span class="keyword">int</span> ext_output = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-ext_output&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> save_labels = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-save_labels&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;usage: %s %s [train/test/valid/demo/map] [data] [cfg] [weights (optional)]\n&quot;</span>, argv[<span class="number">0</span>], argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> *gpu_list = <span class="built_in">find_char_arg</span>(argc, argv, <span class="string">&quot;-gpus&quot;</span>, <span class="number">0</span>);<span class="comment">// å¤šä¸ªgpuè®­ç»ƒ</span></span><br><span class="line">    <span class="keyword">int</span> *gpus = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> gpu = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ngpus = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (gpu_list) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, gpu_list);</span><br><span class="line">        <span class="keyword">int</span> len = (<span class="keyword">int</span>)<span class="built_in">strlen</span>(gpu_list);</span><br><span class="line">        ngpus = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (gpu_list[i] == <span class="string">&#x27;,&#x27;</span>) ++ngpus;</span><br><span class="line">        &#125;</span><br><span class="line">        gpus = (<span class="keyword">int</span>*)<span class="built_in">xcalloc</span>(ngpus, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ngpus; ++i) &#123;</span><br><span class="line">            gpus[i] = <span class="built_in">atoi</span>(gpu_list);</span><br><span class="line">            gpu_list = <span class="built_in">strchr</span>(gpu_list, <span class="string">&#x27;,&#x27;</span>) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        gpu = gpu_index;</span><br><span class="line">        gpus = &amp;gpu;</span><br><span class="line">        ngpus = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> clear = <span class="built_in">find_arg</span>(argc, argv, <span class="string">&quot;-clear&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *datacfg = argv[<span class="number">3</span>];<span class="comment">//å­˜å‚¨è®­ç»ƒé›†ï¼ŒéªŒè¯é›†ï¼Œä»¥åŠç±»åˆ«å¯¹åº”åå­—ç­‰ä¿¡æ¯çš„cfgæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">char</span> *cfg = argv[<span class="number">4</span>];<span class="comment">//è¦è®­ç»ƒçš„ç½‘ç»œcfgæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">char</span> *weights = (argc &gt; <span class="number">5</span>) ? argv[<span class="number">5</span>] : <span class="number">0</span>;<span class="comment">//æ˜¯å¦æœ‰é¢„è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    <span class="keyword">if</span> (weights)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strlen</span>(weights) &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> (weights[<span class="built_in">strlen</span>(weights) - <span class="number">1</span>] == <span class="number">0x0d</span>) weights[<span class="built_in">strlen</span>(weights) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> *filename = (argc &gt; <span class="number">6</span>) ? argv[<span class="number">6</span>] : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;test&quot;</span>)) <span class="built_in">test_detector</span>(datacfg, cfg, weights, filename, thresh, hier_thresh, dont_show, ext_output, save_labels, outfile, letter_box, benchmark_layers);<span class="comment">//æ‰§è¡Œç›®æ ‡æ£€æµ‹æ¨¡å‹æµ‹è¯•</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;train&quot;</span>)) <span class="built_in">train_detector</span>(datacfg, cfg, weights, gpus, ngpus, clear, dont_show, calc_map, mjpeg_port, show_imgs, benchmark_layers);<span class="comment">//ç›®æ ‡æ£€æµ‹æ¨¡å‹è®­ç»ƒ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;valid&quot;</span>)) <span class="built_in">validate_detector</span>(datacfg, cfg, weights, outfile);<span class="comment">//ç›®æ ‡æ£€æµ‹æ¨¡å‹éªŒè¯</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;recall&quot;</span>)) <span class="built_in">validate_detector_recall</span>(datacfg, cfg, weights);<span class="comment">///è®¡ç®—éªŒè¯é›†çš„å¬å›ç‡</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;map&quot;</span>)) <span class="built_in">validate_detector_map</span>(datacfg, cfg, weights, thresh, iou_thresh, map_points, letter_box, <span class="literal">NULL</span>);<span class="comment">//è®¡ç®—éªŒè¯é›†çš„mapå€¼</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;calc_anchors&quot;</span>)) <span class="built_in">calc_anchors</span>(datacfg, num_of_clusters, width, height, show);<span class="comment">//è®¡ç®—éªŒè¯é›†çš„anchors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;demo&quot;</span>)) &#123;<span class="comment">//demoå±•ç¤º</span></span><br><span class="line">        list *options = <span class="built_in">read_data_cfg</span>(datacfg);</span><br><span class="line">        <span class="keyword">int</span> classes = <span class="built_in">option_find_int</span>(options, <span class="string">&quot;classes&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="keyword">char</span> *name_list = <span class="built_in">option_find_str</span>(options, <span class="string">&quot;names&quot;</span>, <span class="string">&quot;data/names.list&quot;</span>);</span><br><span class="line">        <span class="keyword">char</span> **names = <span class="built_in">get_labels</span>(name_list);</span><br><span class="line">        <span class="keyword">if</span> (filename)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strlen</span>(filename) &gt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">if</span> (filename[<span class="built_in">strlen</span>(filename) - <span class="number">1</span>] == <span class="number">0x0d</span>) filename[<span class="built_in">strlen</span>(filename) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">demo</span>(cfg, weights, thresh, hier_thresh, cam_index, filename, names, classes, frame_skip, prefix, out_filename,</span><br><span class="line">            mjpeg_port, json_port, dont_show, ext_output, letter_box, time_limit_sec, http_post_host, benchmark, benchmark_layers);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">free_list_contents_kvp</span>(options);</span><br><span class="line">        <span class="built_in">free_list</span>(options);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot; There isn&#x27;t such command: %s&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (gpus &amp;&amp; gpu_list &amp;&amp; ngpus &gt; <span class="number">1</span>) <span class="built_in">free</span>(gpus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·Ÿè¿›train-detector"><a href="#è·Ÿè¿›train-detector" class="headerlink" title="è·Ÿè¿›train_detector"></a>è·Ÿè¿›train_detector</h3><p>ç”±äºè®­ç»ƒï¼ŒéªŒè¯å’Œæµ‹è¯•é˜¶æ®µä»£ç å‡ ä¹æ˜¯å·®ä¸å¤šçš„ï¼Œåªä¸è¿‡è®­ç»ƒå¤šäº†ä¸€ä¸ªåå‘ä¼ æ’­çš„è¿‡ç¨‹ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸»è¦åˆ†æä¸€ä¸‹è®­ç»ƒè¿‡ç¨‹ï¼Œè®­ç»ƒè¿‡ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œä¸è¿‡å®è§‚ä¸Šå¤§è‡´åˆ†ä¸ºè§£æç½‘ç»œé…ç½®æ–‡ä»¶ï¼ŒåŠ è½½è®­ç»ƒæ ·æœ¬å›¾åƒå’Œæ ‡ç­¾ï¼Œå¼€å¯è®­ç»ƒï¼Œç»“æŸè®­ç»ƒä¿å­˜æ¨¡å‹è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼ˆæˆ‘çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œå› ä¸ºè¿™ä¸€èŠ‚æ˜¯æ¡†æ¶æ€»è§ˆï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Šçš„ï¼‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">train_detector</span><span class="params">(<span class="keyword">char</span> *datacfg, <span class="keyword">char</span> *cfgfile, <span class="keyword">char</span> *weightfile, <span class="keyword">int</span> *gpus, <span class="keyword">int</span> ngpus, <span class="keyword">int</span> clear, <span class="keyword">int</span> dont_show, <span class="keyword">int</span> calc_map, <span class="keyword">int</span> mjpeg_port, <span class="keyword">int</span> show_imgs, <span class="keyword">int</span> benchmark_layers)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä»optionsæ‰¾å‡ºè®­ç»ƒå›¾ç‰‡è·¯å¾„ä¿¡æ¯ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œé»˜è®¤ä½¿ç”¨&quot;data/train.list&quot;è·¯å¾„ä¸‹çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆtrain.listå«æœ‰æ ‡å‡†çš„ä¿¡æ¯æ ¼å¼ï¼š&lt;object-class&gt; &lt;x&gt; &lt;y&gt; &lt;width&gt; &lt;height&gt;ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¯¥æ–‡ä»¶å¯ä»¥ç”±darknetæä¾›çš„scripts/voc_label.pyæ ¹æ®è‡ªè¡Œåœ¨ç½‘ä¸Šä¸‹è½½çš„vocæ•°æ®é›†ç”Ÿæˆï¼Œæ‰€ä»¥è¯´æ˜¯é»˜è®¤è·¯å¾„ï¼Œå…¶å®ä¹Ÿéœ€è¦ä½¿ç”¨è€…è‡ªè¡Œè°ƒæ•´ï¼Œä¹Ÿå¯ä»¥ä»»æ„å‘½åï¼Œä¸ä¸€å®šè¦ä¸ºtrain.listï¼Œ</span></span><br><span class="line">    <span class="comment">// ç”šè‡³å¯ä»¥ä¸ç”¨voc_label.pyç”Ÿæˆï¼Œå¯ä»¥è‡ªå·±ä¸åŒå…¶çƒ¦çš„åˆ¶ä½œä¸€ä¸ªï¼ˆå½“ç„¶è§„æ¨¡åº”è¯¥æ˜¯å¾ˆå°çš„ï¼Œä¸ç„¶å¤ªç´¯äº†ã€‚ã€‚ã€‚ï¼‰</span></span><br><span class="line">    <span class="comment">// è¯»å…¥åï¼Œtrain_imageså°†å«æœ‰è®­ç»ƒå›¾ç‰‡ä¸­æ‰€æœ‰å›¾ç‰‡çš„æ ‡ç­¾ä»¥åŠå®šä½ä¿¡æ¯</span></span><br><span class="line">    list *options = <span class="built_in">read_data_cfg</span>(datacfg);</span><br><span class="line">    <span class="keyword">char</span> *train_images = <span class="built_in">option_find_str</span>(options, <span class="string">&quot;train&quot;</span>, <span class="string">&quot;data/train.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">char</span> *valid_images = <span class="built_in">option_find_str</span>(options, <span class="string">&quot;valid&quot;</span>, train_images);</span><br><span class="line">    <span class="keyword">char</span> *backup_directory = <span class="built_in">option_find_str</span>(options, <span class="string">&quot;backup&quot;</span>, <span class="string">&quot;/backup/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    network net_map;</span><br><span class="line">    <span class="comment">//å¦‚æœè¦è®¡ç®—map</span></span><br><span class="line">    <span class="keyword">if</span> (calc_map) &#123;</span><br><span class="line">        FILE* valid_file = <span class="built_in">fopen</span>(valid_images, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!valid_file) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n Error: There is no %s file for mAP calculation!\n Don&#x27;t use -map flag.\n Or set valid=%s in your %s file. \n&quot;</span>, valid_images, train_images, datacfg);</span><br><span class="line">            <span class="built_in">getchar</span>();</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">fclose</span>(valid_file);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cuda_set_device</span>(gpus[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; Prepare additional network for mAP calculation...\n&quot;</span>);</span><br><span class="line">        net_map = <span class="built_in">parse_network_cfg_custom</span>(cfgfile, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//åˆ†ç±»æ•°</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> net_classes = net_map.layers[net_map.n - <span class="number">1</span>].classes;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> k;  <span class="comment">// free memory unnecessary arrays</span></span><br><span class="line">        <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; net_map.n - <span class="number">1</span>; ++k) <span class="built_in">free_layer_custom</span>(net_map.layers[k], <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> *name_list = <span class="built_in">option_find_str</span>(options, <span class="string">&quot;names&quot;</span>, <span class="string">&quot;data/names.list&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> names_size = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//è·å–ç±»åˆ«å¯¹åº”çš„åå­—</span></span><br><span class="line">        <span class="keyword">char</span> **names = <span class="built_in">get_labels_custom</span>(name_list, &amp;names_size);</span><br><span class="line">        <span class="keyword">if</span> (net_classes != names_size) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot; Error: in the file %s number of names %d that isn&#x27;t equal to classes=%d in the file %s \n&quot;</span>,</span><br><span class="line">                name_list, names_size, net_classes, cfgfile);</span><br><span class="line">            <span class="keyword">if</span> (net_classes &gt; names_size) <span class="built_in">getchar</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free_ptrs</span>((<span class="keyword">void</span>**)names, net_map.layers[net_map.n - <span class="number">1</span>].classes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">     <span class="comment">// æå–é…ç½®æ–‡ä»¶åç§°ä¸­çš„ä¸»è¦ä¿¡æ¯ï¼Œç”¨äºè¾“å‡ºæ‰“å°ï¼ˆå¹¶æ— å®è´¨ä½œç”¨ï¼‰ï¼Œæ¯”å¦‚æå–cfg/yolo.cfgä¸­çš„yoloï¼Œç”¨äºä¸‹é¢çš„è¾“å‡ºæ‰“å°</span></span><br><span class="line">    <span class="keyword">char</span> *base = <span class="built_in">basecfg</span>(cfgfile);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, base);</span><br><span class="line">    <span class="keyword">float</span> avg_loss = <span class="number">-1</span>;</span><br><span class="line">    <span class="comment">// æ„å»ºç½‘ç»œï¼šç”¨å¤šå°‘å—GPUï¼Œå°±ä¼šæ„å»ºå¤šå°‘ä¸ªç›¸åŒçš„ç½‘ç»œï¼ˆä¸ä½¿ç”¨GPUæ—¶ï¼Œngpus=1ï¼‰</span></span><br><span class="line">    network* nets = (network*)<span class="built_in">xcalloc</span>(ngpus, <span class="built_in"><span class="keyword">sizeof</span></span>(network));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è®¾å®šéšæœºæ•°ç§å­</span></span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">int</span> seed = <span class="built_in">rand</span>();</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">      <span class="comment">// forå¾ªç¯æ¬¡æ•°ä¸ºngpusï¼Œä½¿ç”¨å¤šå°‘å—GPUï¼Œå°±å¾ªç¯å¤šå°‘æ¬¡ï¼ˆä¸ä½¿ç”¨GPUæ—¶ï¼Œngpus=1ï¼Œä¹Ÿä¼šå¾ªç¯ä¸€æ¬¡ï¼‰</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½ä¼šæ„å»ºä¸€ä¸ªç›¸åŒçš„ç¥ç»ç½‘ç»œï¼Œå¦‚æœæä¾›äº†åˆå§‹è®­ç»ƒå‚æ•°ï¼Œä¹Ÿä¼šä¸ºæ¯ä¸ªç½‘ç»œå¯¼å…¥ç›¸åŒçš„åˆå§‹è®­ç»ƒå‚æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ngpus; ++i) &#123;</span><br><span class="line">        <span class="built_in">srand</span>(seed);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">        <span class="built_in">cuda_set_device</span>(gpus[i]);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">		<span class="comment">//è§£æç½‘ç»œé…ç½®æ–‡ä»¶</span></span><br><span class="line">        nets[i] = <span class="built_in">parse_network_cfg</span>(cfgfile);</span><br><span class="line">        <span class="comment">//æµ‹è¯•æŸä¸€ä¸ªç½‘ç»œå±‚çš„ç›¸å…³æŒ‡æ ‡å¦‚è¿è¡Œæ—¶é—´</span></span><br><span class="line">        nets[i].benchmark_layers = benchmark_layers;</span><br><span class="line">        <span class="comment">//å¦‚æœæœ‰é¢„è®­ç»ƒæ¨¡å‹åˆ™åŠ è½½</span></span><br><span class="line">        <span class="keyword">if</span> (weightfile) &#123;</span><br><span class="line">            <span class="built_in">load_weights</span>(&amp;nets[i], weightfile);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">if</span> (clear) *nets[i].seen = <span class="number">0</span>;</span><br><span class="line">        nets[i].learning_rate *= ngpus;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£æé…ç½®æ–‡ä»¶"><a href="#è§£æé…ç½®æ–‡ä»¶" class="headerlink" title="è§£æé…ç½®æ–‡ä»¶"></a>è§£æé…ç½®æ–‡ä»¶</h3><p>æˆªå›¾éƒ¨åˆ†<code>yolov3.cfg</code>ç½‘ç»œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/647.webp" alt></p>
<p>å¯ä»¥çœ‹åˆ°é…ç½®å‚æ•°å¤§æ¦‚åˆ†ä¸º2ç±»ï¼š</p>
<ul>
<li>ä¸è®­ç»ƒç›¸å…³çš„é¡¹ï¼Œä»¥ [net] è¡Œå¼€å¤´çš„æ®µ. å…¶ä¸­åŒ…å«çš„å‚æ•°æœ‰: <code>batch_size, width,height,channel,momentum,decay,angle,saturation,  exposure,hue,learning_rate,burn_in,max_batches,policy,steps,scales</code>ã€‚</li>
<li>ä¸åŒç±»å‹çš„å±‚çš„é…ç½®å‚æ•°. å¦‚<code>[convolutional], [short_cut], [yolo], [route], [upsample]</code>å±‚ç­‰ã€‚</li>
</ul>
<p>åœ¨src/parse.cä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€è¡Œä»£ç ï¼Œ<code>net-&gt;batch /= net-&gt;subdivisions;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>batch_size</code> åœ¨ darknet å†…éƒ¨åˆè¢«å‡åˆ†ä¸º <code>net-&gt;subdivisions</code>ä»½, æˆä¸ºæ›´å°çš„<code>batch_size</code>ã€‚ ä½†æ˜¯è¿™äº›å°çš„ <code>batch_size</code> æœ€ç»ˆåˆè¢«æ±‡æ€», å› æ­¤ darknet ä¸­çš„<code>batch_size = net-&gt;batch / net-&gt;subdivisions * net-&gt;subdivisions</code>ã€‚æ­¤å¤–ï¼Œå’Œè¿™ä¸ªå‚æ•°ç›¸å…³çš„è®¡ç®—è®­ç»ƒå›¾ç‰‡æ•°ç›®çš„æ—¶å€™æ˜¯è¿™æ ·ï¼Œ<code>int imgs = net-&gt;batch * net-&gt;subdivisions * ngpus;</code>ï¼Œè¿™æ ·å¯ä»¥ä¿è¯<code>imgs</code>å¯ä»¥è¢«<code>subdivisions</code>æ•´é™¤ï¼Œå› æ­¤ï¼Œé€šå¸¸å°†è¿™ä¸ªå‚æ•°è®¾ä¸º8çš„å€æ•°ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¯ä¸ªgpuæˆ–è€…cpuéƒ½ä¼šè®­ç»ƒ<code>batch</code>ä¸ªæ ·æœ¬ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“äº†å‚æ•°æ˜¯ä»€ä¹ˆæ ·å­ï¼Œé‚£ä¹ˆdarknetæ˜¯å¦‚ä½•ä¿å­˜è¿™äº›å‚æ•°çš„å‘¢ï¼Ÿè¿™å°±è¦çœ‹ä¸‹åŸºæœ¬æ•°æ®ç»“æ„äº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetæ•°æ®ç»“æ„è§£æ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="åŸºç¡€æ•°æ®ç»“æ„"><a href="#åŸºç¡€æ•°æ®ç»“æ„" class="headerlink" title="åŸºç¡€æ•°æ®ç»“æ„"></a>åŸºç¡€æ•°æ®ç»“æ„</h2><p>ä¸ºäº†è§£æç½‘ç»œé…ç½®å‚æ•°ï¼ŒDarkNet ä¸­å®šä¹‰äº†ä¸‰ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ç±»å‹ã€‚<code>list</code>ç±»å‹å˜é‡ä¿å­˜æ‰€æœ‰çš„ç½‘ç»œå‚æ•°, <code>section</code>ç±»å‹å˜é‡ä¿å­˜çš„æ˜¯ç½‘ç»œä¸­æ¯ä¸€å±‚çš„ç½‘ç»œç±»å‹å’Œå‚æ•°, å…¶ä¸­çš„å‚æ•°åˆæ˜¯ä½¿ç”¨listç±»å‹æ¥è¡¨ç¤ºã€‚<code>kvp</code>é”®å€¼å¯¹ç±»å‹ç”¨æ¥ä¿å­˜è§£æåçš„å‚æ•°å˜é‡å’Œå‚æ•°å€¼ã€‚</p>
<ul>
<li>listç±»å‹å®šä¹‰åœ¨<code>src/list.h</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">void</span> *val;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">prev</span>;</span></span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">list</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> size; <span class="comment">//listçš„æ‰€æœ‰èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">    node *front; <span class="comment">//listçš„é¦–èŠ‚ç‚¹</span></span><br><span class="line">    node *back; <span class="comment">//listçš„æ™®é€šèŠ‚ç‚¹</span></span><br><span class="line">&#125; list;</span><br></pre></td></tr></table></figure>
<ul>
<li>section ç±»å‹å®šä¹‰åœ¨<code>src/parser.c</code>æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰section</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> *type;</span><br><span class="line">    list *options;</span><br><span class="line">&#125;section;</span><br></pre></td></tr></table></figure>
<ul>
<li>kvp é”®å€¼å¯¹ç±»å‹å®šä¹‰åœ¨<code>src/option_list.h</code>æ–‡ä»¶ä¸­ï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// kvp é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> *key;</span><br><span class="line">    <span class="keyword">char</span> *val;</span><br><span class="line">    <span class="keyword">int</span> used;</span><br><span class="line">&#125; kvp;</span><br></pre></td></tr></table></figure>
<p>åœ¨Darknetçš„ç½‘ç»œé…ç½®æ–‡ä»¶(<code>.cfg</code>ç»“å°¾)ä¸­ï¼Œä»¥<code>[</code>å¼€å¤´çš„è¡Œè¢«ç§°ä¸ºä¸€ä¸ªæ®µ(<code>section</code>)ã€‚æ‰€æœ‰çš„ç½‘ç»œé…ç½®å‚æ•°ä¿å­˜åœ¨<code>list</code>ç±»å‹å˜é‡ä¸­ï¼Œ<code>list</code>ä¸­æœ‰å¾ˆå¤šçš„<code>section</code>èŠ‚ç‚¹ï¼Œæ¯ä¸ª<code>section</code>ä¸­åˆæœ‰ä¸€ä¸ªä¿å­˜å±‚å‚æ•°çš„å°<code>list</code>ï¼Œæ•´ä½“ä¸Šå‡ºç°äº†ä¸€ç§å¤§é“¾æŒ‚å°é“¾çš„ç»“æ„ã€‚å¤§é“¾çš„æ¯ä¸ªèŠ‚ç‚¹ä¸º<code>section</code>ï¼Œæ¯ä¸ª<code>section</code>ä¸­åŒ…å«çš„å‚æ•°ä¿å­˜åœ¨å°é“¾ä¸­ï¼Œå°é“¾çš„èŠ‚ç‚¹å€¼çš„æ•°æ®ç±»å‹ä¸ºkvpé”®å€¼å¯¹ï¼Œè¿™é‡Œæœ‰ä¸ªå›¾ç‰‡å¯ä»¥è§£é‡Šè¿™ç§ç»“æ„ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/648.webp" alt></p>
<p>æˆ‘ä»¬æ¥å¤§æ¦‚è§£é‡Šä¸‹è¯¥å‚æ•°ç½‘ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>list</code>ï¼Œå–å<code>sections</code>ï¼Œè®°å½•ä¸€å…±æœ‰å¤šå°‘ä¸ª<code>section</code>ï¼ˆä¸€ä¸ª<code>section</code>å­˜å‚¨äº†æŸä¸€ç½‘ç»œå±‚æ‰€éœ€å‚æ•°ï¼‰ï¼›ç„¶ååˆ›å»ºä¸€ä¸ª<code>node</code>ï¼Œè¯¥<code>node</code>çš„<code>void</code>ç±»å‹çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„<code>section</code>ï¼›è¯¥<code>section</code>çš„<code>char</code>ç±»å‹æŒ‡é’ˆæŒ‡å‘<code>.cfg</code>æ–‡ä»¶ä¸­çš„æŸä¸€è¡Œï¼ˆ<code>line</code>ï¼‰ï¼Œç„¶åå°†è¯¥<code>section</code>çš„<code>list</code>æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„<code>node</code>ï¼Œè¯¥<code>node</code>çš„<code>void</code>æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª<code>kvp</code>ç»“æ„ä½“ï¼Œ<code>kvp</code>ç»“æ„ä½“ä¸­çš„<code>key</code>å°±æ˜¯<code>.cfg</code>æ–‡ä»¶ä¸­çš„å…³é”®å­—ï¼ˆå¦‚ï¼š<code>batchï¼Œsubdivisions</code>ç­‰ï¼‰ï¼Œ<code>val</code>å°±æ˜¯å¯¹åº”çš„å€¼ï¼›å¦‚æ­¤å¾ªç¯å°±å½¢æˆäº†ä¸Šè¿°çš„å‚æ•°ç½‘ç»œå›¾ã€‚</p>
<h2 id="è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­"><a href="#è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­" class="headerlink" title="è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­"></a>è§£æå¹¶ä¿å­˜ç½‘ç»œå‚æ•°åˆ°é“¾è¡¨ä¸­</h2><p>è¯»å–é…ç½®æ–‡ä»¶ç”±<code>src/parser.c</code>ä¸­çš„<code>read_cfg()</code>å‡½æ•°å®ç°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * è¯»å–ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶ï¼ˆ.cfgæ–‡ä»¶ï¼‰ä¸­çš„é…ç½®æ•°æ®ï¼Œ å°†æ¯ä¸ªç¥ç»ç½‘ç»œå±‚å‚æ•°è¯»å–åˆ°æ¯ä¸ª</span></span><br><span class="line"><span class="comment"> * section ç»“æ„ä½“ (æ¯ä¸ª section æ˜¯ sections çš„ä¸€ä¸ªèŠ‚ç‚¹) ä¸­ï¼Œ è€Œåå…¨éƒ¨æ’å…¥åˆ°</span></span><br><span class="line"><span class="comment"> * list ç»“æ„ä½“ sections ä¸­å¹¶è¿”å›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \param: filename    C é£æ ¼å­—ç¬¦æ•°ç»„ï¼Œ ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \return: list ç»“æ„ä½“æŒ‡é’ˆï¼ŒåŒ…å«ä»ç¥ç»ç½‘ç»œç»“æ„é…ç½®æ–‡ä»¶ä¸­è¯»å…¥çš„æ‰€æœ‰ç¥ç»ç½‘ç»œå±‚çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> * æ¯ä¸ª section çš„æ‰€åœ¨è¡Œçš„å¼€å¤´æ˜¯ â€˜[â€™ , â€˜\0â€™ , â€˜#â€™ å’Œ â€˜;â€™ ç¬¦å·å¼€å¤´çš„è¡Œä¸ºæ— æ•ˆè¡Œ, é™¤æ­¤</span></span><br><span class="line"><span class="comment"> *ä¹‹å¤–çš„è¡Œä¸º section å¯¹åº”çš„å‚æ•°è¡Œ. æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªç­‰å¼, ç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *å¯ä»¥çœ‹åˆ°, å¦‚æœæŸä¸€è¡Œå¼€å¤´æ˜¯ç¬¦å· â€˜[â€™ , è¯´æ˜è¯»åˆ°äº†ä¸€ä¸ªæ–°çš„ section: current, ç„¶åç¬¬1508è¡Œ</span></span><br><span class="line"><span class="comment"> *list_insert(options, current);` å°†è¯¥æ–°çš„ section ä¿å­˜èµ·æ¥.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *åœ¨è¯»å–åˆ°ä¸‹ä¸€ä¸ªå¼€å¤´ç¬¦å·ä¸º â€˜[â€™ çš„è¡Œä¹‹å‰çš„æ‰€æœ‰è¡Œéƒ½æ˜¯è¯¥ section çš„å‚æ•°, åœ¨ç¬¬ 1518 è¡Œ</span></span><br><span class="line"><span class="comment"> *read_option(line, current-&gt;options) å°†è¯»å–åˆ°çš„å‚æ•°ä¿å­˜åœ¨ current å˜é‡çš„ options ä¸­.</span></span><br><span class="line"><span class="comment"> *æ³¨æ„, è¿™é‡Œä¿å­˜åœ¨ options èŠ‚ç‚¹ä¸­çš„æ•°æ®ä¸º kvp é”®å€¼å¯¹ç±»å‹.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *å½“ç„¶å¯¹äº kvp ç±»å‹çš„å‚æ•°, éœ€è¦å…ˆå°†æ¯ä¸€è¡Œä¸­å¯¹åº”çš„é”®å’Œå€¼(ç”¨ â€˜=â€™ åˆ†å‰²) åˆ†ç¦»å‡ºæ¥, ç„¶åå†</span></span><br><span class="line"><span class="comment"> *æ„é€ ä¸€ä¸ª kvp ç±»å‹çš„å˜é‡ä½œä¸ºèŠ‚ç‚¹å…ƒç´ çš„æ•°æ®.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">list *<span class="title">read_cfg</span><span class="params">(<span class="keyword">char</span> *filename)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *file = <span class="built_in">fopen</span>(filename, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	<span class="comment">//ä¸€ä¸ªsectionè¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œç»“æ„ä¸­çš„ä¸€å±‚</span></span><br><span class="line">    <span class="comment">//å› æ­¤ï¼Œä¸€ä¸ªsectionå°†è¯»å–å¹¶å­˜å‚¨æŸä¸€å±‚çš„å‚æ•°ä»¥åŠè¯¥å±‚çš„type</span></span><br><span class="line">    <span class="keyword">if</span>(file == <span class="number">0</span>) <span class="built_in">file_error</span>(filename);</span><br><span class="line">    <span class="keyword">char</span> *line;</span><br><span class="line">    <span class="keyword">int</span> nu = <span class="number">0</span>; <span class="comment">//å½“å‰è¯»å–è¡Œå·</span></span><br><span class="line">    list *sections = <span class="built_in">make_list</span>(); <span class="comment">//sectionsåŒ…å«æ‰€æœ‰çš„ç¥ç»ç½‘ç»œå±‚å‚æ•°</span></span><br><span class="line">    section *current = <span class="number">0</span>;<span class="comment">//å½“å‰è¯»å–åˆ°æŸä¸€å±‚</span></span><br><span class="line">    <span class="keyword">while</span>((line=<span class="built_in">fgetl</span>(file)) != <span class="number">0</span>)&#123;</span><br><span class="line">        ++ nu;</span><br><span class="line">        <span class="built_in">strip</span>(line); <span class="comment">//å»é™¤è¯»å…¥è¡Œä¸­å«æœ‰çš„ç©ºæ ¼ç¬¦</span></span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>(line[<span class="number">0</span>])&#123;</span><br><span class="line">			 <span class="comment">// ä»¥ &#x27;[&#x27; å¼€å¤´çš„è¡Œæ˜¯ä¸€ä¸ªæ–°çš„ section , å…¶å†…å®¹æ˜¯å±‚çš„ type</span></span><br><span class="line">            <span class="comment">// æ¯”å¦‚ [net], [maxpool], [convolutional] ...</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">                current = (section*)<span class="built_in">xmalloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(section));</span><br><span class="line">                <span class="built_in">list_insert</span>(sections, current);</span><br><span class="line">                current-&gt;options = <span class="built_in">make_list</span>();</span><br><span class="line">                current-&gt;type = line;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>: <span class="comment">//ç©ºè¡Œ</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>: <span class="comment">//æ³¨é‡Š</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;;&#x27;</span>: <span class="comment">//ç©ºè¡Œ</span></span><br><span class="line">                <span class="built_in">free</span>(line); <span class="comment">// å¯¹äºä¸Šè¿°ä¸‰ç§æƒ…å†µç›´æ¥é‡Šæ”¾å†…å­˜å³å¯</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">			    <span class="comment">// å‰©ä¸‹çš„æ‰çœŸæ­£æ˜¯ç½‘ç»œç»“æ„çš„æ•°æ®ï¼Œè°ƒç”¨ read_option() å‡½æ•°è¯»å–</span></span><br><span class="line">                <span class="comment">// è¿”å› 0 è¯´æ˜æ–‡ä»¶ä¸­çš„æ•°æ®æ ¼å¼æœ‰é—®é¢˜ï¼Œå°†ä¼šæç¤ºé”™è¯¯</span></span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">read_option</span>(line, current-&gt;options))&#123;</span><br><span class="line">                    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Config file error line %d, could parse: %s\n&quot;</span>, nu, line);</span><br><span class="line">                    <span class="built_in">free</span>(line);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">fclose</span>(file);</span><br><span class="line">    <span class="keyword">return</span> sections;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é“¾è¡¨çš„æ’å…¥æ“ä½œ"><a href="#é“¾è¡¨çš„æ’å…¥æ“ä½œ" class="headerlink" title="é“¾è¡¨çš„æ’å…¥æ“ä½œ"></a>é“¾è¡¨çš„æ’å…¥æ“ä½œ</h2><p>ä¿å­˜<code>section</code>å’Œæ¯ä¸ªå‚æ•°ç»„æˆçš„é”®å€¼å¯¹æ—¶ä½¿ç”¨çš„æ˜¯<code>list_insert()</code>å‡½æ•°, å‰é¢æåˆ°äº†å‚æ•°ä¿å­˜çš„ç»“æ„å…¶å®æ˜¯å¤§é“¾(èŠ‚ç‚¹ä¸º<code>section</code>)ä¸Šè¾¹æŒ‚ç€å¾ˆå¤šå°é“¾(æ¯ä¸ª<code>section</code>èŠ‚ç‚¹çš„å„ä¸ªå‚æ•°)ã€‚<code>list_insert()</code>å‡½æ•°å®ç°äº†é“¾è¡¨æ’å…¥æ“ä½œï¼Œè¯¥å‡½æ•°å®šä¹‰åœ¨<code>src/list.c</code>æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ç®€ä»‹: å°† val æŒ‡é’ˆæ’å…¥ list ç»“æ„ä½“ l ä¸­ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯ç”¨ C å®ç°äº† C++ ä¸­çš„</span></span><br><span class="line"><span class="comment"> *         list çš„å…ƒç´ æ’å…¥åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å‚æ•°: l    é“¾è¡¨æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment"> *         val  é“¾è¡¨èŠ‚ç‚¹çš„å…ƒç´ å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æµç¨‹ï¼šlist ä¸­ä¿å­˜çš„æ˜¯ node æŒ‡é’ˆ. å› æ­¤ï¼Œéœ€è¦ç”¨ node ç»“æ„ä½“å°† val åŒ…è£¹èµ·æ¥åæ‰å¯ä»¥</span></span><br><span class="line"><span class="comment"> *       æ’å…¥ list æŒ‡é’ˆ l ä¸­</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ³¨æ„: æ­¤å‡½æ•°ç±»ä¼¼ C++ çš„ insert() æ’å…¥æ–¹å¼ï¼›</span></span><br><span class="line"><span class="comment"> *      è€Œ opion_insert() å‡½æ•°ç±»ä¼¼ C++ map çš„æŒ‰å€¼æ’å…¥æ–¹å¼ï¼Œæ¯”å¦‚ map[key]= value</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      ä¸¤ä¸ªå‡½æ•°æ“ä½œå¯¹è±¡éƒ½æ˜¯ list å˜é‡ï¼Œ åªæ˜¯æ“ä½œæ–¹å¼ç•¥æœ‰ä¸åŒã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">list_insert</span><span class="params">(list *l, <span class="keyword">void</span> *val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node* newnode = (node*)<span class="built_in">xmalloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(node));</span><br><span class="line">    newnode-&gt;val = val;</span><br><span class="line">    newnode-&gt;next = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœ list çš„ back æˆå‘˜ä¸ºç©º(åˆå§‹åŒ–ä¸º 0), è¯´æ˜ l åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰å­˜å…¥æ•°æ®</span></span><br><span class="line">    <span class="comment">// å¦å¤–, ä»¤ l çš„ front ä¸º new ï¼ˆæ­¤å front å°†ä¸ä¼šå†å˜ï¼Œé™¤éåˆ é™¤ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span>(!l-&gt;back)&#123;</span><br><span class="line">        l-&gt;front = newnode;</span><br><span class="line">        newnode-&gt;prev = <span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        l-&gt;back-&gt;next = newnode;</span><br><span class="line">        newnode-&gt;prev = l-&gt;back;</span><br><span class="line">    &#125;</span><br><span class="line">    l-&gt;back = newnode;</span><br><span class="line">    ++l-&gt;size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°, æ’å…¥çš„æ•°æ®éƒ½ä¼šè¢«é‡æ–°åŒ…è£…åœ¨ä¸€ä¸ªæ–°çš„<code>node</code> : å˜é‡<code>new</code>ä¸­ï¼Œç„¶åå†å°†è¿™ä¸ªèŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨ä¸­ã€‚ç½‘ç»œç»“æ„è§£æåˆ°é“¾è¡¨ä¸­åè¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨, å› ä¸ºæƒ³ä½¿ç”¨ä»»æ„ä¸€ä¸ªå‚æ•°éƒ½ä¸å¾—ä¸æ¯æ¬¡å»éå†æ•´ä¸ªé“¾è¡¨, è¿™æ ·å°±ä¼šå¯¼è‡´ç¨‹åºæ•ˆç‡å˜ä½, æ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯å°†å…¶ä¿å­˜åˆ°ä¸€ä¸ªç»“æ„ä½“å˜é‡ä¸­, ä½¿ç”¨çš„æ—¶å€™æŒ‰ç…§æˆå‘˜è¿›è¡Œè®¿é—®ã€‚å¤æ‚åº¦ä»$O(n)-&gt;O(1)$ã€‚</p>
<h2 id="å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“"><a href="#å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“" class="headerlink" title="å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“"></a>å°†é“¾è¡¨ä¸­çš„ç½‘ç»œç»“æ„ä¿å­˜åˆ°networkç»“æ„ä½“</h2><ul>
<li>é¦–å…ˆæ¥çœ‹çœ‹<code>network</code>ç»“æ„ä½“çš„å®šä¹‰ï¼Œåœ¨<code>include/darknet.h</code>ä¸­ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰networkç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">network</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n; <span class="comment">//ç½‘ç»œçš„å±‚æ•°ï¼Œè°ƒç”¨make_network(int n)æ—¶èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">int</span> batch; <span class="comment">//ä¸€æ‰¹è®­ç»ƒä¸­çš„å›¾ç‰‡å‚æ•°ï¼Œå’Œsubdivsionså‚æ•°ç›¸å…³</span></span><br><span class="line">    <span class="keyword">uint64_t</span> *seen; <span class="comment">//ç›®å‰å·²ç»è¯»å…¥çš„å›¾ç‰‡å¼ æ•°(ç½‘ç»œå·²ç»å¤„ç†çš„å›¾ç‰‡å¼ æ•°)</span></span><br><span class="line">    <span class="keyword">int</span> *t;</span><br><span class="line">    <span class="keyword">float</span> epoch; <span class="comment">//åˆ°ç›®å‰ä¸ºæ­¢è®­ç»ƒäº†æ•´ä¸ªæ•°æ®é›†çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">int</span> subdivisions;</span><br><span class="line">    layer *layers; <span class="comment">//å­˜å‚¨ç½‘ç»œä¸­çš„æ‰€æœ‰å±‚</span></span><br><span class="line">    <span class="keyword">float</span> *output;</span><br><span class="line">    learning_rate_policy policy; <span class="comment">// å­¦ä¹ ç‡ä¸‹é™ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">int</span> benchmark_layers;</span><br><span class="line">    <span class="comment">// æ¢¯åº¦ä¸‹é™æ³•ç›¸å…³å‚æ•°</span></span><br><span class="line">    <span class="keyword">float</span> learning_rate; <span class="comment">//å­¦ä¹ ç‡</span></span><br><span class="line">    <span class="keyword">float</span> learning_rate_min; <span class="comment">//å­¦ä¹ ç‡æœ€å°å€¼</span></span><br><span class="line">    <span class="keyword">float</span> learning_rate_max;  <span class="comment">//å­¦ä¹ ç‡æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">int</span> batches_per_cycle; <span class="comment">//</span></span><br><span class="line">    <span class="keyword">int</span> batches_cycle_mult;</span><br><span class="line">    <span class="keyword">float</span> momentum;</span><br><span class="line">    <span class="keyword">float</span> decay;</span><br><span class="line">    <span class="keyword">float</span> gamma;</span><br><span class="line">    <span class="keyword">float</span> scale;</span><br><span class="line">    <span class="keyword">float</span> power;</span><br><span class="line">    <span class="keyword">int</span> time_steps;</span><br><span class="line">    <span class="keyword">int</span> step;</span><br><span class="line">    <span class="keyword">int</span> max_batches;</span><br><span class="line">    <span class="keyword">int</span> num_boxes;</span><br><span class="line">    <span class="keyword">int</span> train_images_num;</span><br><span class="line">    <span class="keyword">float</span> *seq_scales;</span><br><span class="line">    <span class="keyword">float</span> *scales;</span><br><span class="line">    <span class="keyword">int</span>   *steps;</span><br><span class="line">    <span class="keyword">int</span> num_steps;</span><br><span class="line">    <span class="keyword">int</span> burn_in;</span><br><span class="line">    <span class="keyword">int</span> cudnn_half;</span><br><span class="line">    <span class="comment">// ADAMä¼˜åŒ–æ–¹æ³•ç›¸å…³ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">int</span> adam;</span><br><span class="line">    <span class="keyword">float</span> B1;</span><br><span class="line">    <span class="keyword">float</span> B2;</span><br><span class="line">    <span class="keyword">float</span> eps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> inputs;</span><br><span class="line">    <span class="keyword">int</span> outputs;</span><br><span class="line">    <span class="keyword">int</span> truths;</span><br><span class="line">    <span class="keyword">int</span> notruth;</span><br><span class="line">    <span class="keyword">int</span> h, w, c;</span><br><span class="line">    <span class="keyword">int</span> max_crop;</span><br><span class="line">    <span class="keyword">int</span> min_crop;</span><br><span class="line">    <span class="keyword">float</span> max_ratio;</span><br><span class="line">    <span class="keyword">float</span> min_ratio;</span><br><span class="line">    <span class="keyword">int</span> center;</span><br><span class="line">    <span class="keyword">int</span> flip; <span class="comment">// horizontal flip 50% probability augmentaiont for classifier training (default = 1)</span></span><br><span class="line">    <span class="keyword">int</span> blur;</span><br><span class="line">    <span class="keyword">int</span> mixup;</span><br><span class="line">    <span class="keyword">float</span> label_smooth_eps;</span><br><span class="line">    <span class="keyword">int</span> resize_step;</span><br><span class="line">    <span class="keyword">int</span> letter_box;</span><br><span class="line">    <span class="keyword">float</span> angle;</span><br><span class="line">    <span class="keyword">float</span> aspect;</span><br><span class="line">    <span class="keyword">float</span> exposure;</span><br><span class="line">    <span class="keyword">float</span> saturation;</span><br><span class="line">    <span class="keyword">float</span> hue;</span><br><span class="line">    <span class="keyword">int</span> random;</span><br><span class="line">    <span class="keyword">int</span> track;</span><br><span class="line">    <span class="keyword">int</span> augment_speed;</span><br><span class="line">    <span class="keyword">int</span> sequential_subdivisions;</span><br><span class="line">    <span class="keyword">int</span> init_sequential_subdivisions;</span><br><span class="line">    <span class="keyword">int</span> current_subdivision;</span><br><span class="line">    <span class="keyword">int</span> try_fix_nan;</span><br><span class="line">    <span class="comment">//darknet ä¸ºæ¯ä¸ª GPU ç»´æŠ¤ä¸€ä¸ªç›¸åŒçš„ network, æ¯ä¸ª network ä»¥ gpu_index åŒºåˆ†</span></span><br><span class="line">    <span class="keyword">int</span> gpu_index;</span><br><span class="line">    tree *hierarchy;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¸­é—´å˜é‡ï¼Œç”¨æ¥æš‚å­˜æŸå±‚ç½‘ç»œçš„è¾“å…¥ï¼ˆåŒ…å«ä¸€ä¸ª batch çš„è¾“å…¥ï¼Œæ¯”å¦‚æŸå±‚ç½‘ç»œå®Œæˆå‰å‘ï¼Œ</span></span><br><span class="line">    <span class="comment">//å°†å…¶è¾“å‡ºèµ‹ç»™è¯¥å˜é‡ï¼Œä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œå¯ä»¥å‚çœ‹ network.c ä¸­çš„forward_network()</span></span><br><span class="line">    <span class="keyword">float</span> *input;</span><br><span class="line">	<span class="comment">// ä¸­é—´å˜é‡ï¼Œä¸ä¸Šé¢çš„ input å¯¹åº”ï¼Œç”¨æ¥æš‚å­˜ input æ•°æ®å¯¹åº”çš„æ ‡ç­¾æ•°æ®ï¼ˆçœŸå®æ•°æ®ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> *truth;</span><br><span class="line">	 <span class="comment">// ä¸­é—´å˜é‡ï¼Œç”¨æ¥æš‚å­˜æŸå±‚ç½‘ç»œçš„æ•æ„Ÿåº¦å›¾ï¼ˆåå‘ä¼ æ’­å¤„ç†å½“å‰å±‚æ—¶ï¼Œç”¨æ¥å­˜å‚¨ä¸Šä¸€å±‚çš„æ•</span></span><br><span class="line">    <span class="comment">//æ„Ÿåº¦å›¾ï¼Œå› ä¸ºå½“å‰å±‚ä¼šè®¡ç®—éƒ¨åˆ†ä¸Šä¸€å±‚çš„æ•æ„Ÿåº¦å›¾ï¼Œå¯ä»¥å‚çœ‹ network.c ä¸­çš„ backward_network() å‡½æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">float</span> *delta;</span><br><span class="line">	<span class="comment">// ç½‘ç»œçš„å·¥ä½œç©ºé—´, æŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§çš„é‚£ä¸ªå±‚çš„ workspace_size,</span></span><br><span class="line">    <span class="comment">// å› ä¸ºå®é™…ä¸Šåœ¨ GPU æˆ– CPU ä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘è¿ç®—</span></span><br><span class="line">    <span class="keyword">float</span> *workspace;</span><br><span class="line">	<span class="comment">// ç½‘ç»œæ˜¯å¦å¤„äºè®­ç»ƒé˜¶æ®µçš„æ ‡å¿—å‚æ•°ï¼Œå¦‚æœæ˜¯åˆ™å€¼ä¸º1. è¿™ä¸ªå‚æ•°ä¸€èˆ¬ç”¨äºè®­ç»ƒä¸æµ‹è¯•é˜¶æ®µæœ‰ä¸</span></span><br><span class="line">    <span class="comment">// åŒæ“ä½œçš„æƒ…å†µï¼Œæ¯”å¦‚ dropout å±‚ï¼Œåœ¨è®­ç»ƒé˜¶æ®µæ‰éœ€è¦è¿›è¡Œ forward_dropout_layer()</span></span><br><span class="line">    <span class="comment">// å‡½æ•°ï¼Œ æµ‹è¯•é˜¶æ®µåˆ™ä¸éœ€è¦è¿›å…¥åˆ°è¯¥å‡½æ•°</span></span><br><span class="line">    <span class="keyword">int</span> train;</span><br><span class="line">	<span class="comment">// æ ‡å¿—å‚æ•°ï¼Œå½“å‰ç½‘ç»œçš„æ´»è·ƒå±‚</span></span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">	<span class="comment">//æ¯ä¸€å±‚çš„æŸå¤±ï¼Œåªæœ‰[yolo]å±‚æœ‰å€¼</span></span><br><span class="line">    <span class="keyword">float</span> *cost;</span><br><span class="line">    <span class="keyword">float</span> clip;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    <span class="comment">//float *input_gpu;</span></span><br><span class="line">    <span class="comment">//float *truth_gpu;</span></span><br><span class="line">    <span class="keyword">float</span> *delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> *output_gpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *input_state_gpu;</span><br><span class="line">    <span class="keyword">float</span> *input_pinned_cpu;</span><br><span class="line">    <span class="keyword">int</span> input_pinned_cpu_flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> **input_gpu;</span><br><span class="line">    <span class="keyword">float</span> **truth_gpu;</span><br><span class="line">    <span class="keyword">float</span> **input16_gpu;</span><br><span class="line">    <span class="keyword">float</span> **output16_gpu;</span><br><span class="line">    <span class="keyword">size_t</span> *max_input16_size;</span><br><span class="line">    <span class="keyword">size_t</span> *max_output16_size;</span><br><span class="line">    <span class="keyword">int</span> wait_stream;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> *global_delta_gpu;</span><br><span class="line">    <span class="keyword">float</span> *state_delta_gpu;</span><br><span class="line">    <span class="keyword">size_t</span> max_delta_gpu_size;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> optimized_memory;</span><br><span class="line">    <span class="keyword">size_t</span> workspace_size_limit;</span><br><span class="line">&#125; network;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸º<code>network</code>ç»“æ„ä½“åˆ†é…å†…å­˜ç©ºé—´ï¼Œå‡½æ•°å®šä¹‰åœ¨<code>src/network.c</code>æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ºnetworkç»“æ„ä½“åˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="function">network <span class="title">make_network</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    network net = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    net.n = n;</span><br><span class="line">    net.layers = (layer*)<span class="built_in">xcalloc</span>(net.n, <span class="built_in"><span class="keyword">sizeof</span></span>(layer));</span><br><span class="line">    net.seen = (<span class="keyword">uint64_t</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">uint64_t</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> GPU</span></span><br><span class="line">    net.input_gpu = (<span class="keyword">float</span>**)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>*));</span><br><span class="line">    net.truth_gpu = (<span class="keyword">float</span>**)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>*));</span><br><span class="line"></span><br><span class="line">    net.input16_gpu = (<span class="keyword">float</span>**)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>*));</span><br><span class="line">    net.output16_gpu = (<span class="keyword">float</span>**)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>*));</span><br><span class="line">    net.max_input16_size = (<span class="keyword">size_t</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">size_t</span>));</span><br><span class="line">    net.max_output16_size = (<span class="keyword">size_t</span>*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">size_t</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> net;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>src/parser.c</code>ä¸­çš„<code>parse_network_cfg()</code>å‡½æ•°ä¸­ï¼Œä»<code>net</code>å˜é‡å¼€å§‹ï¼Œä¾æ¬¡ä¸ºå…¶ä¸­çš„æŒ‡é’ˆå˜é‡åˆ†é…å†…å­˜ã€‚ç”±äºç¬¬ä¸€ä¸ªæ®µ<code>[net]</code>ä¸­å­˜æ”¾çš„æ˜¯å’Œç½‘ç»œå¹¶ä¸ç›´æ¥ç›¸å…³çš„é…ç½®å‚æ•°, å› æ­¤ç½‘ç»œå±‚çš„æ•°ç›®ä¸º<code>sections-&gt;size - 1</code>ï¼Œå³ï¼š<code>network *net = make_network(sections-&gt;size - 1);</code></p>
<ul>
<li><p>å°†é“¾è¡¨ä¸­çš„ç½‘ç»œå‚æ•°è§£æåä¿å­˜åˆ°<code>network</code>ç»“æ„ä½“ï¼Œé…ç½®æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªæ®µä¸€å®šæ˜¯<code>[net]</code>æ®µï¼Œè¯¥æ®µçš„å‚æ•°è§£æç”±<code>parse_net_options()</code>å‡½æ•°å®Œæˆï¼Œå‡½æ•°å®šä¹‰åœ¨<code>src/parser.c</code>ä¸­ã€‚ä¹‹åçš„å„æ®µéƒ½æ˜¯ç½‘ç»œä¸­çš„å±‚ã€‚æ¯”å¦‚å®Œæˆç‰¹å®šç‰¹å¾æå–çš„å·ç§¯å±‚ï¼Œç”¨æ¥é™ä½è®­ç»ƒè¯¯å·®çš„<code>shortcur</code>å±‚å’Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„<code>dropout</code>å±‚ç­‰ã€‚è¿™äº›å±‚éƒ½æœ‰ç‰¹å®šçš„è§£æå‡½æ•°ï¼šæ¯”å¦‚<code>parse_convolutional()</code>, <code>parse_shortcut()</code>å’Œ<code>parse_dropout()</code>ã€‚æ¯ä¸ªè§£æå‡½æ•°è¿”å›ä¸€ä¸ªå¡«å……å¥½çš„å±‚<code>l</code>ï¼Œå°†è¿™äº›å±‚å…¨éƒ¨æ·»åŠ åˆ°<code>network</code>ç»“æ„ä½“çš„<code>layers</code>æ•°ç»„ä¸­ã€‚å³æ˜¯ï¼š<code>net-&gt;layers[count] = l</code>;å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™è¡Œä»£ç ï¼š<code>if (l.workspace_size &gt; workspace_size) workspace_size = l.workspace_size</code>;ï¼Œå…¶ä¸­<code>workspace</code>ä»£è¡¨ç½‘ç»œçš„å·¥ä½œç©ºé—´ï¼ŒæŒ‡çš„æ˜¯æ‰€æœ‰å±‚ä¸­å ç”¨è¿ç®—ç©ºé—´æœ€å¤§é‚£ä¸ªå±‚çš„<code>workspace</code>ã€‚å› ä¸ºåœ¨CPUæˆ–GPUä¸­æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå±‚åœ¨åšå‰å‘æˆ–åå‘ä¼ æ’­ã€‚è¾“å‡ºå±‚åªèƒ½åœ¨ç½‘ç»œæ­å»ºå®Œæ¯•ä¹‹åæ‰å¯ä»¥ç¡®å®šï¼Œè¾“å…¥å±‚éœ€è¦è€ƒè™‘<code>batch_size</code>çš„å› ç´ ï¼Œ<code>truth</code>æ˜¯è¾“å…¥æ ‡ç­¾ï¼ŒåŒæ ·éœ€è¦è€ƒè™‘<code>batch_size</code>çš„å› ç´ ã€‚å…·ä½“å±‚çš„å‚æ•°è§£æåé¢ä¸“é—¨å†™ä¸€ç¯‡æ¨æ–‡æ¥å¸®åŠ©ç†è§£ã€‚</p>
</li>
<li><p>åˆ°è¿™é‡Œï¼Œç½‘ç»œçš„å®è§‚è§£æç»“æŸã€‚<code>parse_network_cfg()</code>(<code>src/parser.c</code>ä¸­)å‡½æ•°è¿”å›è§£æå¥½çš„<code>network</code>ç±»å‹çš„æŒ‡é’ˆå˜é‡ã€‚</p>
</li>
</ul>
<h2 id="ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ"></a>ä¸ºå•¥éœ€è¦ä¸­é—´æ•°æ®ç»“æ„ç¼“å­˜ï¼Ÿ</h2><p>è¿™é‡Œå¯èƒ½æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸å°†é…ç½®æ–‡ä»¶è¯»å–å¹¶è§£æåˆ°<code>network</code>ç»“æ„ä½“å˜é‡ä¸­, è€Œè¦ä½¿ç”¨ä¸€ä¸ªä¸­é—´æ•°æ®ç»“æ„æ¥ç¼“å­˜è¯»å–åˆ°çš„æ–‡ä»¶å‘¢ï¼Ÿå› ä¸ºï¼Œå¦‚æœä¸ä½¿ç”¨ä¸­é—´æ•°æ®ç»“æ„æ¥ç¼“å­˜. å°†è¯»å–å’Œè§£ææµç¨‹ä¸²è¡Œè¿›è¡Œçš„è¯, å¦‚æœé…ç½®æ–‡ä»¶è¾ƒä¸ºå¤æ‚,  å°±ä¼šé•¿æ—¶é—´ä½¿æ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ­¤æ—¶ç”¨æˆ·æ›´æ”¹äº†é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›æ¡ç›®,  å°±ä¼šå¯¼è‡´è¯»å–å’Œè§£æè¿‡ç¨‹å‡ºç°é—®é¢˜ã€‚åˆ†å¼€ä¸¤æ­¥è¿›è¡Œå¯ä»¥å…ˆå¿«é€Ÿè¯»å–æ–‡ä»¶ä¿¡æ¯åˆ°å†…å­˜ä¸­ç»„ç»‡å¥½çš„ç»“æ„ä¸­, è¿™æ—¶å°±å¯ä»¥å…³é—­æ–‡ä»¶.  ç„¶åå†æ…¢æ…¢çš„è§£æå‚æ•°ã€‚è¿™ç§æœºåˆ¶ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­æ–­çš„åº•åŠéƒ¨æœºåˆ¶, å…ˆå¤„ç†é‡è¦çš„ä¸­æ–­ä¿¡å·, ç„¶ååœ¨ç³»ç»Ÿè´Ÿè·è¾ƒå°æ—¶å†å¤„ç†ä¸­æ–­ä¿¡å·ä¸­æºå¸¦çš„ä»»åŠ¡ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyAB DarkNetåŠ è½½æ•°æ®è¿›è¡Œè®­ç»ƒ</title>
    <url>/2020/02/21/AlexeyAB-DarkNet%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E8%AE%AD%E7%BB%83/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰è®²äº†DarkNetçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å°†ç½‘ç»œé…ç½®æ–‡ä»¶è¿›è¡Œäº†è§£æå­˜æ”¾åˆ°äº†ä¸€ä¸ª<code>network</code>ç»“æ„ä½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æ¥çœ‹ä¸€ä¸‹Darknetæ˜¯å¦‚ä½•åŠ è½½æ•°æ®è¿›è¡Œè®­ç»ƒçš„ã€‚</p>
<h2 id="åŠ è½½è®­ç»ƒæ•°æ®"><a href="#åŠ è½½è®­ç»ƒæ•°æ®" class="headerlink" title="åŠ è½½è®­ç»ƒæ•°æ®"></a>åŠ è½½è®­ç»ƒæ•°æ®</h2><p>DarkNetçš„æ•°æ®åŠ è½½å‡½æ•°<code>load_data()</code>åœ¨<code>src/data.c</code>ä¸­å®ç°ï¼ˆ<code>src/detector.c</code>å‡½æ•°ä¸­çš„<code>train_detector</code>ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°åŠ è½½æ•°æ®ï¼‰ã€‚<code>load_data()</code>å‡½æ•°è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š<code>load_data(args)-&gt;load_threads()-&gt;load_data_in_threads()-&gt;load_thread()-&gt;load_data_detection()</code>ï¼Œå‰å››ä¸ªå‡½æ•°éƒ½æ˜¯åœ¨å¯¹çº¿ç¨‹çš„è°ƒç”¨è¿›è¡Œå°è£…ã€‚æœ€åº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡ç”±<code>load_data_detection()</code>å‡½æ•°å®Œæˆã€‚æ‰€æœ‰çš„æ•°æ®(å›¾ç‰‡æ•°æ®å’Œæ ‡æ³¨ä¿¡æ¯æ•°æ®)åŠ è½½å®Œæˆä¹‹åå†æ‹¼æ¥åˆ°ä¸€ä¸ªå¤§çš„æ•°ç»„ä¸­ã€‚åœ¨DarkNetä¸­ï¼Œå›¾ç‰‡çš„å­˜å‚¨å½¢å¼æ˜¯ä¸€ä¸ªè¡Œå‘é‡ï¼Œå‘é‡é•¿åº¦ä¸º<code>h*w*3</code>ã€‚åŒæ—¶å›¾ç‰‡è¢«å½’ä¸€åŒ–åˆ°<code>[0, 1]</code>ä¹‹é—´ã€‚</p>
<h2 id="load-threads-å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥"><a href="#load-threads-å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥" class="headerlink" title="load_threads()å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥"></a>load_threads()å®Œæˆçº¿ç¨‹åˆ†é…å’Œæ•°æ®æ‹¼æ¥</h2><p><code>load_threads</code>åœ¨<code>src/data.c</code>ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// copy from https://github.com/hgpvision/darknet/blob/master/src/data.c#L355</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** å¼€è¾Ÿå¤šä¸ªçº¿ç¨‹è¯»å…¥å›¾ç‰‡æ•°æ®ï¼Œè¯»å…¥æ•°æ®å­˜å‚¨è‡³ptr.dä¸­ï¼ˆä¸»è¦è°ƒç”¨load_in_thread()å‡½æ•°å®Œæˆï¼‰</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šptr    åŒ…å«æ‰€æœ‰çº¿ç¨‹è¦è¯»å…¥å›¾ç‰‡æ•°æ®çš„ä¿¡æ¯ï¼ˆè¯»å…¥å¤šå°‘å¼ ï¼Œå¼€å‡ ä¸ªçº¿ç¨‹è¯»å…¥ï¼Œè¯»å…¥å›¾ç‰‡æœ€ç»ˆçš„å®½é«˜ï¼Œå›¾ç‰‡è·¯å¾„ç­‰ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">** è¿”å›ï¼švoid*  ä¸‡èƒ½æŒ‡é’ˆï¼ˆå®é™…ä¸Šä¸éœ€è¦è¿”å›ä»€ä¹ˆï¼‰</span></span><br><span class="line"><span class="comment">** è¯´æ˜ï¼š1) load_threads()æ˜¯ä¸€ä¸ªæŒ‡é’ˆå‡½æ•°ï¼Œåªæ˜¯ä¸€ä¸ªè¿”å›å˜é‡ä¸ºvoid*çš„æ™®é€šå‡½æ•°ï¼Œä¸æ˜¯å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">**       2) è¾“å…¥ptræ˜¯ä¸€ä¸ªvoid*æŒ‡é’ˆï¼ˆä¸‡èƒ½æŒ‡é’ˆï¼‰ï¼Œä½¿ç”¨æ—¶éœ€è¦å¼ºè½¬ä¸ºå…·ä½“ç±»å‹çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">**       3) å‡½æ•°ä¸­æ¶‰åŠå››ä¸ªç”¨æ¥å­˜å‚¨è¯»å…¥æ•°æ®çš„å˜é‡ï¼šptr, args, out, buffersï¼Œé™¤argså¤–éƒ½æ˜¯data*ç±»å‹ï¼Œæ‰€æœ‰è¿™äº›å˜é‡çš„</span></span><br><span class="line"><span class="comment">**          æŒ‡é’ˆå˜é‡å…¶å®éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜ï¼ˆå½“ç„¶å‡½æ•°ä¸­é—´æœ‰äº›åŠ¨æ€å˜åŒ–ï¼‰ï¼Œå› æ­¤è¯»å…¥çš„æ•°æ®éƒ½æ˜¯äº’é€šçš„ã€‚</span></span><br><span class="line"><span class="comment">** æµç¨‹ï¼šæœ¬å‡½æ•°é¦–å…ˆä¼šè·å–è¦è¯»å…¥å›¾ç‰‡çš„å¼ æ•°ã€è¦å¼€å¯çº¿ç¨‹çš„ä¸ªæ•°ï¼Œè€Œåè®¡ç®—æ¯ä¸ªçº¿ç¨‹åº”è¯¥è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼ˆå°½å¯èƒ½çš„å‡åŒ€åˆ†é…ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">**       å¹¶åˆ›å»ºæ‰€æœ‰çš„çº¿ç¨‹ï¼Œå¹¶è¡Œè¯»å…¥æ•°æ®ï¼Œæœ€ååˆå¹¶æ¯ä¸ªçº¿ç¨‹è¯»å…¥çš„æ•°æ®è‡³ä¸€ä¸ªå¤§dataä¸­ï¼Œè¿™ä¸ªdataçš„æŒ‡é’ˆå˜é‡ä¸ptrçš„æŒ‡é’ˆå˜é‡</span></span><br><span class="line"><span class="comment">**       æŒ‡å‘çš„æ˜¯ç»Ÿä¸€å—å†…å­˜ï¼Œå› æ­¤ä¹Ÿå°±æœ€ç»ˆå°†æ•°æ®è¯»å…¥åˆ°ptr.dä¸­ï¼ˆæ‰€ä»¥å…¶å®æ²¡æœ‰è¿”å›å€¼ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">load_threads</span><span class="params">(<span class="keyword">void</span> *ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//srand(time(0));</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// å…ˆä½¿ç”¨(load_args*)å¼ºè½¬void*æŒ‡é’ˆï¼Œè€Œåå–ptræ‰€æŒ‡å†…å®¹èµ‹å€¼ç»™args</span></span><br><span class="line">    <span class="comment">// è™½ç„¶argsä¸æ˜¯æŒ‡é’ˆï¼Œargsæ˜¯æ·±æ‹·è´äº†pträ¸­çš„å†…å®¹ï¼Œä½†æ˜¯è¦çŸ¥é“ptrï¼ˆä¹Ÿå°±æ˜¯load_argsæ•°æ®ç±»å‹ï¼‰ï¼Œæœ‰å¾ˆå¤šçš„</span></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆå˜é‡ï¼Œargsæ·±æ‹·è´å°†æ‹·è´è¿™äº›æŒ‡é’ˆå˜é‡åˆ°argsä¸­ï¼ˆè¿™äº›æŒ‡é’ˆå˜é‡æœ¬èº«å¯¹ptræ¥è¯´å°±æ˜¯å†…å®¹ï¼Œ</span></span><br><span class="line">    <span class="comment">// è€Œargsæ‰€æŒ‡çš„å€¼æ˜¯argsçš„å†…å®¹ï¼Œä¸æ˜¯ptrçš„ï¼Œä¸è¦æ··ä¸ºä¸€è°ˆï¼‰ï¼Œå› æ­¤ï¼Œargsä¸ptrå°†ä¼šå…±äº«æ‰€æœ‰æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å†…å®¹</span></span><br><span class="line">    load_args args = *(load_args *)ptr;</span><br><span class="line">    <span class="keyword">if</span> (args.threads == <span class="number">0</span>) args.threads = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// å¦æŒ‡é’ˆå˜é‡out=args.dï¼Œä½¿å¾—outä¸args.dæŒ‡å‘ç»Ÿä¸€å—å†…å­˜ï¼Œä¹‹åï¼Œargs.dæ‰€æŒ‡çš„å†…å­˜å—ä¼šå˜ï¼ˆåæ­£ä¹Ÿæ²¡ä»€ä¹ˆç”¨äº†ï¼Œå˜å°±å˜å§ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†outä¸ä¼šå˜ï¼Œè¿™æ ·å¯ä»¥ä¿è¯outä¸æœ€åŸå§‹çš„ptræŒ‡å‘åŒä¸€å—å­˜å‚¨è¯»å…¥å›¾ç‰‡æ•°æ®çš„å†…å­˜å—ï¼Œå› æ­¤æœ€ç»ˆå°†å›¾ç‰‡è¯»åˆ°outä¸­ï¼Œ</span></span><br><span class="line">    <span class="comment">// å®é™…å°±æ˜¯è¯»åˆ°äº†æœ€åŸå§‹çš„pträ¸­ï¼Œæ¯”å¦‚train_detector()å‡½æ•°ä¸­å®šä¹‰çš„args.dä¸­</span></span><br><span class="line">    data *out = args.d;</span><br><span class="line">	<span class="comment">// è¯»å…¥å›¾ç‰‡çš„æ€»å¼ æ•°= batch * subdivision * ngpusï¼Œå¯å‚è§train_detector()å‡½æ•°ä¸­çš„èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">int</span> total = args.n;</span><br><span class="line">	<span class="comment">// é‡Šæ”¾ptrï¼šptræ˜¯ä¼ å…¥çš„æŒ‡é’ˆå˜é‡ï¼Œä¼ å…¥çš„æŒ‡é’ˆå˜é‡æœ¬èº«ä¹Ÿæ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œå³ä¼ å…¥å‡½æ•°ä¹‹åï¼ŒæŒ‡é’ˆå˜é‡å¾—åˆ°å¤åˆ¶ï¼Œå‡½æ•°å†…çš„å½¢å‚ptr</span></span><br><span class="line">    <span class="comment">// è·å–å¤–éƒ¨å®å‚çš„å€¼ä¹‹åï¼ŒäºŒè€…æœ¬èº«æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯ç”±äºæ˜¯æŒ‡é’ˆå˜é‡ï¼ŒäºŒè€…ä¹‹é—´åˆå­˜åœ¨ä¸€ä¸å…³ç³»ï¼Œé‚£å°±æ˜¯å‡½æ•°å†…å½¢å‚ä¸å‡½æ•°å¤–å®å‚æŒ‡å‘</span></span><br><span class="line">    <span class="comment">// åŒä¸€å—å†…å­˜ã€‚åˆç”±äºå‡½æ•°å¤–å®å‚å†…å­˜æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œå› æ­¤å‡½æ•°å†…çš„å½¢å‚å¯ä»¥ä½¿ç”¨free()å‡½æ•°è¿›è¡Œå†…å­˜é‡Šæ”¾ï¼Œä½†ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšï¼Œå› ä¸ºå‡½æ•°å†…é‡Šæ”¾å†…å­˜ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¼šå½±å“å‡½æ•°å¤–å®å‚çš„ä½¿ç”¨ï¼Œå¯èƒ½ä½¿ä¹‹æˆä¸ºé‡æŒ‡é’ˆï¼Œé‚£ä¸ºä»€ä¹ˆè¿™é‡Œå¯ä»¥ç”¨free()é‡Šæ”¾ptrå‘¢ï¼Œä¸ä¼šå‡ºç°é—®é¢˜å—ï¼Ÿ</span></span><br><span class="line">    <span class="comment">// å…¶ä¸€ï¼Œå› ä¸ºptræ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«ä¼—å¤šçš„æŒ‡é’ˆå˜é‡çš„ç»“æ„ä½“ï¼Œå¦‚data* dç­‰ï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–éæŒ‡é’ˆå˜é‡å¦‚int hç­‰ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// ç›´æ¥free(ptr)å°†ä¼šå¯¼è‡´å‡½æ•°å¤–å®å‚æ— æ³•å†è®¿é—®éæŒ‡é’ˆå˜é‡int hç­‰ï¼ˆå®é™…ç»è¿‡æµ‹è¯•ï¼Œåœ¨gccç¼–è¯‘å™¨ä¸‹ï¼Œèƒ½è®¿é—®ä½†æ˜¯å€¼è¢«é‡æ–°åˆå§‹åŒ–ä¸º0ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºå‡½æ•°å†…å½¢å‚å’Œå‡½æ•°å¤–å®å‚å…±äº«ä¸€å—å †å†…å­˜ï¼Œè€Œè¿™äº›éæŒ‡é’ˆå˜é‡éƒ½æ˜¯å­˜åœ¨è¿™å—å †å†…å­˜ä¸Šçš„ï¼Œå†…å­˜ä¸€é‡Šæ”¾ï¼Œå°±æ— æ³•è®¿é—®äº†ï¼›</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯å¯¹äºæŒ‡é’ˆå˜é‡ï¼Œfree(ptr)å°†æ— ä½œä¸ºï¼ˆè¿™ä¸ªç»“è®ºä¹Ÿæ˜¯ç»è¿‡æµ‹è¯•çš„ï¼Œä¹Ÿæ˜¯ç”¨çš„gccç¼–è¯‘å™¨ï¼‰ï¼Œä¸ä¼šé‡Šæ”¾æˆ–è€…æ“¦å†™æ‰ptræŒ‡é’ˆå˜é‡æœ¬èº«çš„å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// å½“ç„¶ä¹Ÿä¸ä¼šå½±å“å‡½æ•°å¤–å®å‚ï¼Œæ›´ä¸ä¼šç‰µæ‰¯åˆ°è¿™äº›æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å†…å­˜å—ï¼Œæ€»çš„æ¥è¯´ï¼Œ</span></span><br><span class="line">    <span class="comment">// free(ptr)å°†ä½¿å¾—pträ¸èƒ½å†è®¿é—®æŒ‡é’ˆå˜é‡ï¼ˆå¦‚int hç­‰ï¼Œå®é™…ç»è¿‡æµ‹è¯•ï¼Œåœ¨gccç¼–è¯‘å™¨ä¸‹ï¼Œèƒ½è®¿é—®ä½†æ˜¯å€¼è¢«é‡æ–°åˆå§‹åŒ–ä¸º0ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†å…¶æŒ‡é’ˆå˜é‡æœ¬èº«æ²¡æœ‰å—å½±å“ï¼Œä¾æ—§å¯ä»¥è®¿é—®ï¼›å¯¹äºå‡½æ•°å¤–å®å‚ï¼ŒåŒæ ·ä¸èƒ½è®¿é—®éæŒ‡é’ˆå˜é‡ï¼Œè€ŒæŒ‡é’ˆå˜é‡ä¸å—å½±å“ï¼Œä¾æ—§å¯ä»¥è®¿é—®ã€‚</span></span><br><span class="line">    <span class="comment">// å…¶äºŒï¼Œdarknetæ•°æ®è¯»å–çš„å®ç°ä¸€å±‚å¥—ä¸€å±‚ï¼ˆä¼¼ä¹æœ‰ç‚¹ç½—å—¦ï¼Œæ€»æ„Ÿè§‰ä»£ç å¯ä»¥ä¸ç”¨è¿™ä¹ˆå†™çš„:)ï¼‰ï¼Œå…·ä½“è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</span></span><br><span class="line">    <span class="comment">// load_data(load_args args)-&gt;load_threads(load_args* ptr)-&gt;load_data_in_thread(load_args args)-&gt;load_thread(load_args* ptr)ï¼Œ</span></span><br><span class="line">    <span class="comment">// å°±åœ¨load_data()ä¸­ï¼Œé‡æ–°å®šä¹‰äº†ptrï¼Œå¹¶ä¸ºä¹‹åŠ¨æ€åˆ†é…äº†å†…å­˜ï¼Œä¸”æ·±æ‹·è´äº†ä¼ ç»™load_data()å‡½æ•°çš„å€¼argsï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ­¤ä¹‹åload_data()å‡½æ•°ä¸­çš„argsé™¤äº†å…¶ä¸­çš„æŒ‡é’ˆå˜é‡æŒ‡ç€åŒä¸€å—å †å†…å­˜ä¹‹å¤–ï¼Œ</span></span><br><span class="line">    <span class="comment">// äºŒè€…çš„éæŒ‡é’ˆå˜é‡å†æ— ç“œè‘›ï¼Œä¸ç®¡ä¹‹åç»è¿‡å¤šå°‘ä¸ªå‡½æ•°ï¼Œå¯¹ptrçš„éæŒ‡é’ˆå˜é‡åšäº†ä»€ä¹ˆæ”¹åŠ¨ï¼Œæ¯”å¦‚è¿™é‡Œç›´æ¥free(ptr)ï¼Œä½¿å¾—éæŒ‡é’ˆå˜é‡å€¼ä¸º0,éƒ½ä¸ä¼šå½±å“load_data()ä¸­çš„argsçš„éæŒ‡é’ˆå˜é‡ï¼Œä¹Ÿå°±ä¸ä¼šå½±å“æ›´ä¸ºé¡¶å±‚å‡½æ•°ä¸­å®šä¹‰çš„argsçš„éæŒ‡é’ˆå˜é‡çš„å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚train_detector()å‡½æ•°ä¸­çš„argsï¼Œtrain_detector()å¯¹argséæŒ‡é’ˆå˜é‡èµ‹çš„å€¼éƒ½ä¸ä¼šå—å½±å“ï¼Œä¿æŒä¸å˜ã€‚ç»¼å…¶ä¸¤ç‚¹ï¼Œæ­¤å¤„ç›´æ¥free(ptr)æ˜¯å®‰å…¨çš„ã€‚</span></span><br><span class="line">    <span class="comment">// è¯´æ˜ï¼šfree(ptr)å‡½æ•°ï¼Œç¡®å®šä¼šåšçš„äº‹æ˜¯ä½¿å¾—å†…å­˜å—å¯ä»¥é‡æ–°åˆ†é…ï¼Œä¸”ä¸ä¼šå½±å“æŒ‡é’ˆå˜é‡ptræœ¬èº«çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ptrè¿˜æ˜¯æŒ‡å‘é‚£å—åœ°å€ï¼Œ è™½ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†å¾ˆå±é™©ï¼Œå› ä¸ºè¿™å—å†…å­˜å®é™…æ˜¯æ— æ•ˆçš„ï¼Œ</span></span><br><span class="line">    <span class="comment">//      ç³»ç»Ÿå·²ç»è®¤ä¸ºè¿™å—å†…å­˜æ˜¯å¯åˆ†é…çš„ï¼Œä¼šæ¯«ä¸è€ƒè™‘çš„å°†è¿™å—å†…å­˜åˆ†ç»™å…¶ä»–å˜é‡ï¼Œè¿™æ ·ï¼Œå…¶å€¼éšæ—¶éƒ½å¯èƒ½ä¼šè¢«å…¶ä»–å˜é‡æ”¹å˜ï¼Œè¿™ç§æƒ…å†µä¸‹çš„ptræŒ‡é’ˆå°±æ˜¯æ‰€è°“çš„é‡æŒ‡é’ˆï¼ˆæ‰€ä»¥ç»å¸¸å¯ä»¥çœ‹åˆ°freeä¹‹åï¼Œç½®åŸæŒ‡é’ˆä¸ºNULLï¼‰ã€‚</span></span><br><span class="line">    <span class="comment">//      è€Œè‡³äºfree(ptr)è¿˜ä¸ä¼šåšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚ä¼šä¸ä¼šé‡æ–°åˆå§‹åŒ–è¿™å—å†…å­˜ä¸º0ï¼ˆæ“¦å†™æ‰ï¼‰ï¼Œä»¥åŠæ€ä¹ˆæ“¦å†™ï¼Œè¿™äº›æ“ä½œï¼Œæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½è·Ÿå…·ä½“çš„ç¼–è¯‘å™¨æœ‰å…³ï¼ˆä¸ªäººçŒœæµ‹ï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">//      ç»è¿‡æµ‹è¯•ï¼Œå¯¹äºgccç¼–è¯‘å™¨ï¼Œfree(ptr)ä¹‹åï¼Œpträ¸­çš„éæŒ‡é’ˆå˜é‡çš„åœ°å€ä¸å˜ï¼Œä½†å…¶å€¼å…¨éƒ¨æ“¦å†™ä¸º0ï¼›pträ¸­çš„æŒ‡é’ˆå˜é‡ï¼Œä¸æ¯«ä¸å—å½±å“ï¼ŒæŒ‡é’ˆå˜é‡æœ¬èº«æ²¡æœ‰è¢«æ“¦å†™ï¼Œ</span></span><br><span class="line">    <span class="comment">//      å­˜å‚¨çš„åœ°å€è¿˜æ˜¯æŒ‡å‘å…ˆå‰åˆ†é…çš„å†…å­˜å—ï¼Œæ‰€ä»¥ptrèƒ½å¤Ÿæ­£å¸¸è®¿é—®å…¶æŒ‡é’ˆå˜é‡æ‰€æŒ‡çš„å€¼ã€‚æµ‹è¯•ä»£ç ä¸ºdarknet_test_struct_memory_free.cã€‚</span></span><br><span class="line">    <span class="comment">//      ä¸çŸ¥é“è¿™æ®µæµ‹è¯•ä»£ç åœ¨VSä¸­æ‰§è¡Œä¼šæ€æ ·ï¼Œè¿˜æ²¡ç»è¿‡æµ‹è¯•ï¼Œä¹Ÿä¸çŸ¥é“æ¢ç”¨å…¶ä»–ç¼–è¯‘å™¨ï¼ˆdarknetçš„Makefileæ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šäº†ç¼–è¯‘å™¨ä¸ºgccï¼‰ï¼Œdarknetçš„ç¼–è¯‘ä¼šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼Ÿ</span></span><br><span class="line">    <span class="comment">//      å…³äºfree()ï¼Œå¯ä»¥çœ‹çœ‹ï¼šhttp://blog.sina.com.cn/s/blog_615ec1630102uwle.htmlï¼Œæ–‡ç« æœ€åæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ¯”å–»ï¼Œä½†æ„æ€å¥½åƒå°±å’Œæˆ‘è¿™é‡Œè¯´çš„æœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼ˆåˆ°åº•æ˜¯ä¸æ˜¯ç¼–è¯‘å™¨æå¾—é¬¼å‘¢ï¼Ÿï¼Ÿï¼‰ã€‚</span></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">	<span class="comment">// æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šè¯»å…¥ä¸€ä¸ªdataï¼Œå®šä¹‰å¹¶åˆ†é…args.threadä¸ªdataçš„å†…å­˜</span></span><br><span class="line">    data* buffers = (data*)<span class="built_in">xcalloc</span>(args.threads, <span class="built_in"><span class="keyword">sizeof</span></span>(data));</span><br><span class="line">    <span class="keyword">pthread_t</span>* threads = (<span class="keyword">pthread_t</span>*)<span class="built_in">xcalloc</span>(args.threads, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">pthread_t</span>));</span><br><span class="line">	<span class="comment">// æ­¤å¤„å®šä¹‰äº†å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹åŠ¨æ€åˆ†é…å†…å­˜</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; args.threads; ++i)&#123;</span><br><span class="line">		<span class="comment">// æ­¤å¤„å°±æ‰¿åº”äº†ä¸Šé¢çš„æ³¨é‡Šï¼Œargs.dæŒ‡é’ˆå˜é‡æœ¬èº«å‘ç”Ÿäº†æ”¹åŠ¨ï¼Œä½¿å¾—æœ¬å‡½æ•°çš„args.dä¸outä¸å†æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ”¹ä¸ºæŒ‡å‘buffersæŒ‡å‘çš„æŸä¸€æ®µå†…å­˜ï¼Œå› ä¸ºä¸‹é¢çš„load_data_in_thread()å‡½æ•°ç»Ÿä¸€äº†ç»“å£ï¼Œéœ€è¦è¾“å…¥ä¸€ä¸ªload_argsç±»å‹å‚æ•°ï¼Œ</span></span><br><span class="line">        <span class="comment">// å®é™…æ˜¯æƒ³æŠŠå›¾ç‰‡æ•°æ®è¯»å…¥åˆ°buffers[i]ä¸­ï¼Œåªèƒ½ä»¤args.dä¸buffers[i]æŒ‡å‘åŒä¸€å—å†…å­˜</span></span><br><span class="line">        args.d = buffers + i;</span><br><span class="line">		 <span class="comment">// ä¸‹é¢è¿™å¥å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çº¿ç¨‹è¯»å…¥çš„æ€»å›¾ç‰‡å¼ æ•°ä¸ºtotalï¼Œéœ€è¦å°†totalå‡åŒ€çš„åˆ†åˆ°å„ä¸ªçº¿ç¨‹ä¸Šï¼Œ</span></span><br><span class="line">        <span class="comment">// ä½†å¾ˆå¯èƒ½ä¼šé‡åˆ°totalä¸èƒ½æ•´é™¤çš„args.threadsçš„æƒ…å†µï¼Œæ¯”å¦‚total = 61, args.threads =8,æ˜¾ç„¶ä¸èƒ½åšåˆ°</span></span><br><span class="line">        <span class="comment">// å®Œå…¨å‡åŒ€çš„åˆ†é…ï¼Œä½†åˆè¦ä¿è¯è¯»å…¥å›¾ç‰‡çš„æ€»å¼ æ•°ä¸€å®šç­‰äºtotalï¼Œç”¨ä¸‹é¢çš„è¯­å¥åˆšå¥½åœ¨å°½é‡å‡åŒ€çš„æƒ…å†µä¸‹ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä¿è¯æ€»å’Œä¸ºtotalï¼Œæ¯”å¦‚61,é‚£ä¹ˆ8ä¸ªçº¿ç¨‹å„è‡ªè¯»å…¥çš„ç…§ç‰‡å¼ æ•°åˆ†åˆ«ä¸ºï¼š7, 8, 7, 8, 8, 7, 8, 8</span></span><br><span class="line">        args.n = (i+<span class="number">1</span>) * total/args.threads - i * total/args.threads;</span><br><span class="line">		<span class="comment">// å¼€å¯çº¿ç¨‹ï¼Œè¯»å…¥æ•°æ®åˆ°args.dä¸­ï¼ˆä¹Ÿå°±è¯»å…¥åˆ°buffers[i]ä¸­ï¼‰</span></span><br><span class="line">        <span class="comment">// load_data_in_thread()å‡½æ•°è¿”å›æ‰€å¼€å¯çš„çº¿ç¨‹ï¼Œå¹¶å­˜å‚¨ä¹‹å‰å·²ç»åŠ¨æ€åˆ†é…å†…å­˜ç”¨æ¥å­˜å‚¨æ‰€æœ‰çº¿ç¨‹çš„threadsä¸­ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ–¹ä¾¿ä¸‹é¢ä½¿ç”¨pthread_join()å‡½æ•°æ§åˆ¶ç›¸åº”çº¿ç¨‹</span></span><br><span class="line">        threads[i] = <span class="built_in">load_data_in_thread</span>(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; args.threads; ++i)&#123;</span><br><span class="line">		<span class="comment">// ä»¥é˜»å¡çš„æ–¹å¼ç­‰å¾…çº¿ç¨‹threads[i]ç»“æŸï¼šé˜»å¡æ˜¯æŒ‡é˜»å¡å¯åŠ¨è¯¥å­çº¿ç¨‹çš„æ¯çº¿ç¨‹ï¼ˆæ­¤å¤„åº”ä¸ºä¸»çº¿ç¨‹ï¼‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ˜¯æ¯çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸€ç›´ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œï¼ˆè¯»å®Œæ‰€æœ‰æ•°æ®ï¼‰æ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥</span></span><br><span class="line">        <span class="comment">// å…³äºå¤šçº¿ç¨‹çš„ä½¿ç”¨ï¼Œè¿›è¡Œè¿‡ä»£ç æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¯¹åº”ï¼šdarknet_test_pthread_join.c</span></span><br><span class="line">        <span class="built_in">pthread_join</span>(threads[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// å¤šä¸ªçº¿ç¨‹è¯»å…¥æ‰€æœ‰æ•°æ®ä¹‹åï¼Œåˆ†åˆ«å­˜å‚¨åˆ°buffers[0],buffers[1]...ä¸­ï¼Œæ¥ç€ä½¿ç”¨concat_datas()å‡½æ•°å°†buffersä¸­çš„æ•°æ®å…¨éƒ¨åˆå¹¶æˆä¸€ä¸ªå¤§æ•°ç»„å¾—åˆ°out</span></span><br><span class="line">    *out = <span class="built_in">concat_datas</span>(buffers, args.threads);</span><br><span class="line">	 <span class="comment">// ä¹Ÿå°±åªæœ‰outçš„shallowæ•¢ç½®ä¸º0äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºoutæ˜¯æ­¤æ¬¡è¿­ä»£è¯»å…¥çš„æœ€ç»ˆæ•°æ®ï¼Œè¯¥æ•°æ®å‚ä¸è®­ç»ƒï¼ˆç”¨å®Œï¼‰ä¹‹åï¼Œå½“ç„¶å¯ä»¥æ·±å±‚é‡Šæ”¾äº†ï¼Œè€Œæ­¤å‰çš„éƒ½æ˜¯ä¸­é—´å˜é‡ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿˜å¤„äºè¯»å…¥æ•°æ®é˜¶æ®µï¼Œä¸‡ä¸å¯è®¾ç½®shallow=0</span></span><br><span class="line">    out-&gt;shallow = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// é‡Šæ”¾buffersï¼Œbuffersä¹Ÿæ˜¯ä¸ªä¸­é—´å˜é‡ï¼Œåˆ‡è®°shallowè®¾ç½®ä¸º1,å¦‚æœè®¾ç½®ä¸º0,é‚£å°±è¿outä¸­çš„æ•°æ®ä¹Ÿæ²¡äº†</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; args.threads; ++i)&#123;</span><br><span class="line">        buffers[i].shallow = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">free_data</span>(buffers[i]);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æœ€ç»ˆç›´æ¥é‡Šæ”¾buffers,threadsï¼Œæ³¨æ„buffersæ˜¯ä¸€ä¸ªå­˜å‚¨dataçš„ä¸€ç»´æ•°ç»„ï¼Œä¸Šé¢å¾ªç¯ä¸­çš„å†…å­˜é‡Šæ”¾ï¼Œå®é™…æ˜¯é‡Šæ”¾æ¯ä¸€ä¸ªdataçš„éƒ¨åˆ†å†…å­˜</span></span><br><span class="line">    <span class="comment">// ï¼ˆè¿™éƒ¨åˆ†å†…å­˜å¯¹dataè€Œè¨€æ˜¯éä¸»è¦å†…å­˜ï¼Œä¸æ˜¯å­˜å‚¨è¯»å…¥æ•°æ®çš„å†…å­˜å—ï¼Œè€Œæ˜¯å­˜å‚¨æŒ‡å‘è¿™äº›å†…å­˜å—çš„æŒ‡é’ˆå˜é‡ï¼Œå¯ä»¥é‡Šæ”¾çš„ï¼‰</span></span><br><span class="line">    <span class="built_in">free</span>(buffers);</span><br><span class="line">    <span class="built_in">free</span>(threads);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="load-data-in-thread-åˆ†é…çº¿ç¨‹"><a href="#load-data-in-thread-åˆ†é…çº¿ç¨‹" class="headerlink" title="load_data_in_thread()åˆ†é…çº¿ç¨‹"></a>load_data_in_thread()åˆ†é…çº¿ç¨‹</h2><p><code>load_data_in_thread()</code>å‡½æ•°ä»ç„¶åœ¨<code>src/data.c</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¯»å…¥ç›¸åº”å›¾ç‰‡æ•°æ®ï¼ˆæ­¤æ—¶args.nä¸å†æ˜¯ä¸€æ¬¡è¿­ä»£è¯»å…¥çš„æ‰€æœ‰å›¾ç‰‡çš„å¼ æ•°ï¼Œè€Œæ˜¯ç»è¿‡load_threads()å‡åŒ€åˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹çš„å›¾ç‰‡å¼ æ•°ï¼‰</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼šargs    åŒ…å«è¯¥çº¿ç¨‹è¦è¯»å…¥å›¾ç‰‡æ•°æ®çš„ä¿¡æ¯ï¼ˆè¯»å…¥å¤šå°‘å¼ ï¼Œè¯»å…¥å›¾ç‰‡æœ€ç»ˆçš„å®½é«˜ï¼Œå›¾ç‰‡è·¯å¾„ç­‰ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">** è¿”å›ï¼šphtread_t   çº¿ç¨‹id</span></span><br><span class="line"><span class="comment">** è¯´æ˜ï¼šæœ¬å‡½æ•°å®é™…æ²¡æœ‰åšä»€ä¹ˆï¼Œå°±æ˜¯æ·±æ‹·è´äº†argsç»™ptr,ç„¶ååˆ›å»ºäº†ä¸€ä¸ªè°ƒç”¨load_thread()å‡½æ•°çš„çº¿ç¨‹å¹¶è¿”å›çº¿ç¨‹id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">pthread_t</span> <span class="title">load_data_in_thread</span><span class="params">(load_args args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pthread_t</span> thread;</span><br><span class="line">	<span class="comment">// åŒæ ·ç¬¬ä¸€ä»¶äº‹æ·±æ‹·è´äº†argsç»™ptr</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">load_args</span>* <span class="title">ptr</span> =</span> (load_args*)<span class="built_in">xcalloc</span>(<span class="number">1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(struct load_args));</span><br><span class="line">    *ptr = args;</span><br><span class="line">	<span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¯»å…¥ç›¸åº”æ•°æ®ï¼Œç»‘å®šload_thread()å‡½æ•°åˆ°è¯¥çº¿ç¨‹ä¸Šï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯load_thread()çš„è¾“å…¥å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºçº¿ç¨‹å±æ€§ï¼Œè®¾ç½®ä¸º0ï¼ˆå³NULLï¼‰</span></span><br><span class="line">	<span class="comment">//å½“åˆ›å»ºçº¿ç¨‹æˆåŠŸæ—¶ï¼Œå‡½æ•°è¿”å›0ï¼Œè‹¥ä¸ä¸º0åˆ™è¯´æ˜åˆ›å»ºçº¿ç¨‹å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">pthread_create</span>(&amp;thread, <span class="number">0</span>, load_thread, ptr)) <span class="built_in">error</span>(<span class="string">&quot;Thread creation failed&quot;</span>); </span><br><span class="line">    <span class="keyword">return</span> thread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="load-data-detection-å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡"><a href="#load-data-detection-å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡" class="headerlink" title="load_data_detection()å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡"></a>load_data_detection()å®Œæˆåº•å±‚çš„æ•°æ®åŠ è½½ä»»åŠ¡</h2><p><code>load_data_detection()</code>å‡½æ•°ä¹Ÿå®šä¹‰åœ¨<code>src/data.c</code>ä¸­ï¼Œå¸¦æ³¨é‡Šçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** å¯ä»¥å‚è€ƒï¼Œçœ‹ä¸€ä¸‹å¯¹å›¾åƒè¿›è¡Œjitterå¤„ç†çš„å„ç§æ•ˆæœ:</span></span><br><span class="line"><span class="comment">** https://github.com/vxy10/ImageAugmentation</span></span><br><span class="line"><span class="comment">** ä»æ‰€æœ‰è®­ç»ƒå›¾ç‰‡ä¸­ï¼Œéšæœºè¯»å–nå¼ ï¼Œå¹¶å¯¹è¿™nå¼ å›¾ç‰‡è¿›è¡Œæ•°æ®å¢å¼ºï¼ŒåŒæ—¶çŸ«æ­£å¢å¼ºåçš„æ•°æ®æ ‡ç­¾ä¿¡æ¯ã€‚æœ€ç»ˆå¾—åˆ°çš„å›¾ç‰‡çš„å®½é«˜ä¸ºw,hï¼ˆåŸå§‹è®­ç»ƒé›†ä¸­çš„å›¾ç‰‡å°ºå¯¸ä¸å®šï¼‰ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾ç‰‡å°ºå¯¸ï¼Œ</span></span><br><span class="line"><span class="comment">** æ•°æ®å¢å¼ºåŒ…æ‹¬ï¼šå¯¹åŸå§‹å›¾ç‰‡è¿›è¡Œå®½é«˜æ–¹å‘ä¸Šçš„æ’å€¼ç¼©æ”¾ï¼ˆä¸¤æ–¹å‘ä¸Šç¼©æ”¾ç³»æ•°ä¸ä¸€å®šç›¸åŒï¼‰ï¼Œä¸‹é¢ç§°ä¹‹ä¸ºç¼©æ”¾æŠ–åŠ¨ï¼›éšæœºæŠ å–æˆ–è€…å¹³ç§»å›¾ç‰‡ï¼ˆä½ç½®æŠ–åŠ¨ï¼‰ï¼›</span></span><br><span class="line"><span class="comment">** åœ¨hsvé¢œè‰²ç©ºé—´å¢åŠ å™ªå£°ï¼ˆé¢œè‰²æŠ–åŠ¨ï¼‰ï¼›å·¦å³æ°´å¹³ç¿»è½¬ï¼Œä¸å«æ—‹è½¬æŠ–åŠ¨ã€‚</span></span><br><span class="line"><span class="comment">** è¾“å…¥ï¼š n         ä¸€ä¸ªçº¿ç¨‹è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼ˆè¯¦è§å‡½æ•°å†…éƒ¨æ³¨é‡Šï¼‰</span></span><br><span class="line"><span class="comment">**       paths     æ‰€æœ‰è®­ç»ƒå›¾ç‰‡æ‰€åœ¨è·¯å¾„é›†åˆï¼Œæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ¯ä¸€è¡Œå¯¹åº”ä¸€å¼ å›¾ç‰‡çš„è·¯å¾„ï¼ˆå°†åœ¨å…¶ä¸­éšæœºå–nä¸ªï¼‰</span></span><br><span class="line"><span class="comment">**       m         pathsçš„è¡Œæ•°ï¼Œä¹Ÿå³è®­ç»ƒå›¾ç‰‡æ€»æ•°</span></span><br><span class="line"><span class="comment">**       w         ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾çš„å®½åº¦ï¼ˆä¹Ÿå°±æ˜¯è¾“å…¥å›¾ç‰‡ç»è¿‡ä¸€ç³»åˆ—æ•°æ®å¢å¼ºã€å˜æ¢ä¹‹åæœ€ç»ˆè¾“å…¥åˆ°ç½‘ç»œçš„å›¾çš„å®½åº¦ï¼‰</span></span><br><span class="line"><span class="comment">**       h         ç½‘ç»œèƒ½å¤Ÿå¤„ç†çš„å›¾çš„é«˜åº¦ï¼ˆä¹Ÿå°±æ˜¯è¾“å…¥å›¾ç‰‡ç»è¿‡ä¸€ç³»åˆ—æ•°æ®å¢å¼ºã€å˜æ¢ä¹‹åæœ€ç»ˆè¾“å…¥åˆ°ç½‘ç»œçš„å›¾çš„é«˜åº¦ï¼‰</span></span><br><span class="line"><span class="comment">**       c         ç”¨æ¥æŒ‡å®šè®­ç»ƒå›¾ç‰‡çš„é€šé“æ•°ï¼ˆé»˜è®¤ä¸º3ï¼Œå³RGBå›¾ï¼‰</span></span><br><span class="line"><span class="comment">**       boxes     æ¯å¼ è®­ç»ƒå›¾ç‰‡æœ€å¤§å¤„ç†çš„çŸ©å½¢æ¡†æ•°ï¼ˆå›¾ç‰‡å†…å¯èƒ½å«æœ‰æ›´å¤šçš„ç‰©ä½“ï¼Œå³æ›´å¤šçš„çŸ©å½¢æ¡†ï¼Œé‚£ä¹ˆå°±åœ¨å…¶ä¸­éšæœºé€‰æ‹©boxesä¸ªå‚ä¸è®­ç»ƒï¼Œå…·ä½“æ‰§è¡Œåœ¨fill_truth_detection()å‡½æ•°ä¸­ï¼‰</span></span><br><span class="line"><span class="comment">**       classes   ç±»åˆ«æ€»æ•°ï¼Œæœ¬å‡½æ•°å¹¶æœªç”¨åˆ°ï¼ˆfill_truth_detectionå‡½æ•°å…¶å®å¹¶æ²¡æœ‰ç”¨è¿™ä¸ªå‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">**       use_flip  æ˜¯å¦ä½¿ç”¨æ°´å¹³ç¿»è½¬</span></span><br><span class="line"><span class="comment">**       use_mixup æ˜¯å¦ä½¿ç”¨mixupæ•°æ®å¢å¼º</span></span><br><span class="line"><span class="comment">**       jitter    è¿™ä¸ªå‚æ•°ä¸ºç¼©æ”¾æŠ–åŠ¨ç³»æ•°ï¼Œå°±æ˜¯å›¾ç‰‡ç¼©æ”¾æŠ–åŠ¨çš„å‰§çƒˆç¨‹åº¦ï¼Œè¶Šå¤§ï¼Œå…è®¸çš„æŠ–åŠ¨èŒƒå›´è¶Šå¤§ï¼ˆæ‰€è°“ç¼©æ”¾æŠ–åŠ¨ï¼Œå°±æ˜¯åœ¨å®½é«˜ä¸Šæ’å€¼ç¼©æ”¾å›¾ç‰‡ï¼Œå®½é«˜ä¸¤æ–¹å‘ä¸Šç¼©æ”¾çš„ç³»æ•°ä¸ä¸€å®šç›¸åŒï¼‰</span></span><br><span class="line"><span class="comment">**       hue       é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šè‰²è°ƒï¼ˆå–å€¼0åº¦åˆ°360åº¦ï¼‰åå·®æœ€å¤§å€¼ï¼Œå®é™…è‰²è°ƒåå·®ä¸º-hue~hueä¹‹é—´çš„éšæœºå€¼</span></span><br><span class="line"><span class="comment">**       saturation é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šè‰²å½©é¥±å’Œåº¦ï¼ˆå–å€¼èŒƒå›´0~1ï¼‰ç¼©æ”¾æœ€å¤§å€¼ï¼Œå®é™…ä¸ºèŒƒå›´å†…çš„éšæœºå€¼</span></span><br><span class="line"><span class="comment">**       exposure  é¢œè‰²ï¼ˆhsvé¢œè‰²ç©ºé—´ï¼‰æ•°æ®å¢å¼ºå‚æ•°ï¼šæ˜åº¦ï¼ˆè‰²å½©æ˜äº®ç¨‹åº¦ï¼Œ0~1ï¼‰ç¼©æ”¾æœ€å¤§å€¼ï¼Œå®é™…ä¸ºèŒƒå›´å†…çš„éšæœºå€¼</span></span><br><span class="line"><span class="comment">**       mini_batch      å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span></span><br><span class="line"><span class="comment">**       track           å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span></span><br><span class="line"><span class="comment">**       augment_speed   å’Œç›®æ ‡è·Ÿè¸ªæœ‰å…³ï¼Œè¿™é‡Œä¸å…³æ³¨</span></span><br><span class="line"><span class="comment">**       letter_box æ˜¯å¦è¿›è¡Œletter_boxå˜æ¢</span></span><br><span class="line"><span class="comment">**       show_imgs</span></span><br><span class="line"><span class="comment">** è¿”å›ï¼šdataç±»å‹æ•°æ®ï¼ŒåŒ…å«ä¸€ä¸ªçº¿ç¨‹è¯»å…¥çš„æ‰€æœ‰å›¾ç‰‡æ•°æ®ï¼ˆå«æœ‰nå¼ å›¾ç‰‡ï¼‰</span></span><br><span class="line"><span class="comment">** è¯´æ˜ï¼šæœ€åå››ä¸ªå‚æ•°ç”¨äºæ•°æ®å¢å¼ºï¼Œä¸»è¦å¯¹åŸå›¾è¿›è¡Œç¼©æ”¾æŠ–åŠ¨ï¼Œä½ç½®æŠ–åŠ¨ï¼ˆå¹³ç§»ï¼‰ä»¥åŠé¢œè‰²æŠ–åŠ¨ï¼ˆé¢œè‰²å€¼å¢åŠ ä¸€å®šå™ªå£°ï¼‰ï¼ŒæŠ–åŠ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç†è§£æˆå¯¹å›¾åƒå¢åŠ å™ªå£°ã€‚</span></span><br><span class="line"><span class="comment">**       é€šè¿‡å¯¹åŸå§‹å›¾åƒè¿›è¡ŒæŠ–åŠ¨ï¼Œå®ç°æ•°æ®å¢å¼ºã€‚æœ€åä¸‰ä¸ªå‚æ•°å…·ä½“ç”¨æ³•å‚è€ƒæœ¬å‡½æ•°å†…è°ƒç”¨çš„random_distort_image()å‡½æ•°</span></span><br><span class="line"><span class="comment">** è¯´æ˜2ï¼šä»æ­¤å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œdarknetå¯¹è®­ç»ƒé›†ä¸­å›¾ç‰‡çš„å°ºå¯¸æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥æ˜¯ä»»æ„å°ºå¯¸çš„å›¾ç‰‡ï¼Œå› ä¸ºç»è¯¥å‡½æ•°å¤„ç†ï¼ˆç¼©æ”¾/è£å‰ªï¼‰ä¹‹åï¼Œ</span></span><br><span class="line"><span class="comment">**       ä¸ç®¡æ˜¯ä»€ä¹ˆå°ºå¯¸çš„ç…§ç‰‡ï¼Œéƒ½ä¼šç»Ÿä¸€ä¸ºç½‘ç»œè®­ç»ƒä½¿ç”¨çš„å°ºå¯¸</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">data <span class="title">load_data_detection</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">char</span> **paths, <span class="keyword">int</span> m, <span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> c, <span class="keyword">int</span> boxes, <span class="keyword">int</span> classes, <span class="keyword">int</span> use_flip, <span class="keyword">int</span> use_blur, <span class="keyword">int</span> use_mixup, <span class="keyword">float</span> jitter,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">float</span> hue, <span class="keyword">float</span> saturation, <span class="keyword">float</span> exposure, <span class="keyword">int</span> mini_batch, <span class="keyword">int</span> track, <span class="keyword">int</span> augment_speed, <span class="keyword">int</span> letter_box, <span class="keyword">int</span> show_imgs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> random_index = <span class="built_in">random_gen</span>();</span><br><span class="line">    c = c ? c : <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">char</span> **random_paths;</span><br><span class="line">    <span class="keyword">char</span> **mixup_random_paths = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">// pathsåŒ…å«æ‰€æœ‰è®­ç»ƒå›¾ç‰‡çš„è·¯å¾„ï¼Œget_random_pathså‡½æ•°ä»ä¸­éšæœºæå‡ºnæ¡ï¼Œå³ä¸ºæ­¤æ¬¡è¯»å…¥çš„nå¼ å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span>(track) random_paths = <span class="built_in">get_sequential_paths</span>(paths, n, m, mini_batch, augment_speed);</span><br><span class="line">    <span class="keyword">else</span> random_paths = <span class="built_in">get_random_paths</span>(paths, n, m);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert</span>(use_mixup &lt; <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">int</span> mixup = use_mixup ? <span class="built_in">random_gen</span>() % <span class="number">2</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;\n mixup = %d \n&quot;, mixup);</span></span><br><span class="line">	<span class="comment">// å¦‚æœä½¿ç”¨mixupç­–ç•¥ï¼Œéœ€è¦å†éšæœºå–å‡ºnæ¡æ•°æ®ï¼Œå³nå¼ å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">if</span> (mixup) &#123;</span><br><span class="line">        <span class="keyword">if</span> (track) mixup_random_paths = <span class="built_in">get_sequential_paths</span>(paths, n, m, mini_batch, augment_speed);</span><br><span class="line">        <span class="keyword">else</span> mixup_random_paths = <span class="built_in">get_random_paths</span>(paths, n, m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ä¸º0,æ¸…ç©ºå†…å­˜ä¸­ä¹‹å‰çš„æ—§å€¼</span></span><br><span class="line">    data d = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    d.shallow = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// ä¸€æ¬¡è¯»å…¥çš„å›¾ç‰‡å¼ æ•°ï¼šd.Xä¸­æ¯è¡Œå°±æ˜¯ä¸€å¼ å›¾ç‰‡çš„æ•°æ®ï¼Œå› æ­¤d.X.colsç­‰äºh*w*3</span></span><br><span class="line">    <span class="comment">// n = net.batch * net.subdivisions * ngpus</span></span><br><span class="line">    <span class="comment">// ä»parse_net_option()å‡½æ•°å¯çŸ¥ï¼Œnet.batch = net.batch / net.subdivision</span></span><br><span class="line">    <span class="comment">// net.batch * net.subdivisionså°±å¾—åˆ°äº†åœ¨ç½‘ç»œé…ç½®æ–‡ä»¶ä¸­è®¾å®šçš„batchå€¼ï¼Œå³ç½‘ç»œé…ç½®æ–‡ä»¶.cfgä¸­è®¾ç½®çš„æ¯ä¸ªbatchçš„å›¾ç‰‡æ•°é‡, ç„¶åä¹˜ä»¥ngpusï¼Œæ˜¯è€ƒè™‘å¤šä¸ªGPUå®ç°æ•°æ®å¹¶è¡Œï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¸€æ¬¡è¯»å…¥å¤šä¸ªbatchçš„æ•°æ®ï¼Œåˆ†é…åˆ°ä¸åŒGPUä¸Šè¿›è¡Œè®­ç»ƒã€‚åœ¨load_threads()å‡½æ•°ä¸­ï¼Œåˆå°†æ•´ä¸ªçš„nä»…å¯èƒ½å‡åŒ€çš„åˆ’åˆ†åˆ°æ¯ä¸ªçº¿ç¨‹ä¸Šï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯æ€»çš„è¯»å…¥å›¾ç‰‡å¼ æ•°ä¸ºn = net.batch * net.subdivisions * ngpusï¼Œä½†è¿™äº›å›¾ç‰‡ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹è¯»å®Œçš„ï¼Œè€Œæ˜¯åˆ†é…åˆ°å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¯»å…¥ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› æ­¤æœ¬å‡½æ•°ä¸­çš„nå®é™…ä¸æ˜¯æ€»çš„nï¼Œè€Œæ˜¯åˆ†é…åˆ°è¯¥çº¿ç¨‹ä¸Šçš„nï¼Œæ¯”å¦‚æ€»å…±è¦è¯»å…¥128å¼ å›¾ç‰‡ï¼Œå…±å¼€å¯8ä¸ªçº¿ç¨‹è¯»æ•°æ®ï¼Œé‚£ä¹ˆæœ¬å‡½æ•°ä¸­çš„nä¸º16,è€Œä¸æ˜¯æ€»æ•°128</span></span><br><span class="line">    d.X.rows = n;</span><br><span class="line">	<span class="comment">//d.Xä¸ºä¸€ä¸ªmatrixç±»å‹æ•°æ®ï¼Œå…¶ä¸­d.X.valsæ˜¯å…¶å…·ä½“æ•°æ®ï¼Œæ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆï¼ˆå³ä¸ºäºŒç»´æ•°ç»„ï¼‰ï¼Œæ­¤å¤„å…ˆä¸ºç¬¬ä¸€ç»´åŠ¨æ€åˆ†é…å†…å­˜</span></span><br><span class="line">    d.X.vals = (<span class="keyword">float</span>**)<span class="built_in">xcalloc</span>(d.X.rows, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>*));</span><br><span class="line">    d.X.cols = h*w*c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> r1 = <span class="number">0</span>, r2 = <span class="number">0</span>, r3 = <span class="number">0</span>, r4 = <span class="number">0</span>, r_scale;</span><br><span class="line">    <span class="keyword">float</span> dhue = <span class="number">0</span>, dsat = <span class="number">0</span>, dexp = <span class="number">0</span>, flip = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> augmentation_calculated = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// d.yå­˜å‚¨äº†æ‰€æœ‰è¯»å…¥ç…§ç‰‡çš„æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯æ¡æ ‡ç­¾åŒ…å«5æ¡ä¿¡æ¯ï¼šç±»åˆ«ï¼Œä»¥åŠçŸ©å½¢æ¡†çš„x,y,w,h</span></span><br><span class="line">    <span class="comment">// boxesä¸ºä¸€å¼ å›¾ç‰‡æœ€å¤šèƒ½å¤Ÿå¤„ç†ï¼ˆå‚ä¸è®­ç»ƒï¼‰çš„çŸ©å½¢æ¡†çš„æ•°ï¼ˆå¦‚æœå›¾ç‰‡ä¸­çš„çŸ©å½¢æ¡†æ•°å¤šäºè¿™ä¸ªæ•°ï¼Œé‚£ä¹ˆéšæœºæŒ‘é€‰boxesä¸ªï¼Œè¿™ä¸ªå‚æ•°ä»…åœ¨parse_regionä»¥åŠparse_detectionä¸­å‡ºç°</span></span><br><span class="line">    <span class="comment">// åœ¨å…¶ä»–ç½‘ç»œè§£æå‡½æ•°ä¸­å¹¶æ²¡æœ‰å‡ºç°ã€‚åŒæ ·ï¼Œd.yæ˜¯ä¸€ä¸ªmatrixï¼Œmake_matrixä¼šæŒ‡å®šyçš„è¡Œæ•°å’Œåˆ—æ•°ï¼ŒåŒæ—¶ä¼šä¸ºå…¶ç¬¬ä¸€ç»´åŠ¨æ€åˆ†é…å†…å­˜</span></span><br><span class="line">    d.y = <span class="built_in">make_matrix</span>(n, <span class="number">5</span> * boxes);</span><br><span class="line">    <span class="keyword">int</span> i_mixup = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i_mixup = <span class="number">0</span>; i_mixup &lt;= mixup; i_mixup++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i_mixup) augmentation_calculated = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">float</span> *truth = (<span class="keyword">float</span>*)<span class="built_in">xcalloc</span>(<span class="number">5</span> * boxes, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line">            <span class="keyword">char</span> *filename = (i_mixup) ? mixup_random_paths[i] : random_paths[i];</span><br><span class="line">			<span class="comment">//è¯»å…¥åŸå§‹çš„å›¾ç‰‡</span></span><br><span class="line">            image orig = <span class="built_in">load_image</span>(filename, <span class="number">0</span>, <span class="number">0</span>, c);</span><br><span class="line">			<span class="comment">// åŸå§‹å›¾åƒé•¿å®½</span></span><br><span class="line">            <span class="keyword">int</span> oh = orig.h;</span><br><span class="line">            <span class="keyword">int</span> ow = orig.w;</span><br><span class="line">			<span class="comment">// ç¼©æ”¾æŠ–åŠ¨å¤§å°ï¼šç¼©æ”¾æŠ–åŠ¨ç³»æ•°ä¹˜ä»¥åŸå§‹å›¾å®½é«˜å³å¾—åƒç´ å•ä½æ„ä¹‰ä¸Šçš„ç¼©æ”¾æŠ–åŠ¨</span></span><br><span class="line">            <span class="keyword">int</span> dw = (ow*jitter);</span><br><span class="line">            <span class="keyword">int</span> dh = (oh*jitter);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!augmentation_calculated || !track)</span><br><span class="line">            &#123;</span><br><span class="line">                augmentation_calculated = <span class="number">1</span>;</span><br><span class="line">                r1 = <span class="built_in">random_float</span>();</span><br><span class="line">                r2 = <span class="built_in">random_float</span>();</span><br><span class="line">                r3 = <span class="built_in">random_float</span>();</span><br><span class="line">                r4 = <span class="built_in">random_float</span>();</span><br><span class="line"></span><br><span class="line">                r_scale = <span class="built_in">random_float</span>();</span><br><span class="line"></span><br><span class="line">                dhue = <span class="built_in">rand_uniform_strong</span>(-hue, hue);</span><br><span class="line">                dsat = <span class="built_in">rand_scale</span>(saturation);</span><br><span class="line">                dexp = <span class="built_in">rand_scale</span>(exposure);</span><br><span class="line"></span><br><span class="line">                flip = use_flip ? <span class="built_in">random_gen</span>() % <span class="number">2</span> : <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> pleft = <span class="built_in">rand_precalc_random</span>(-dw, dw, r1);</span><br><span class="line">            <span class="keyword">int</span> pright = <span class="built_in">rand_precalc_random</span>(-dw, dw, r2);</span><br><span class="line">            <span class="keyword">int</span> ptop = <span class="built_in">rand_precalc_random</span>(-dh, dh, r3);</span><br><span class="line">            <span class="keyword">int</span> pbot = <span class="built_in">rand_precalc_random</span>(-dh, dh, r4);</span><br><span class="line">			<span class="comment">// è¿™ä¸ªç³»æ•°æ²¡ç”¨åˆ°</span></span><br><span class="line">            <span class="keyword">float</span> scale = <span class="built_in">rand_precalc_random</span>(<span class="number">.25</span>, <span class="number">2</span>, r_scale); <span class="comment">// unused currently</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (letter_box)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">float</span> img_ar = (<span class="keyword">float</span>)ow / (<span class="keyword">float</span>)oh; <span class="comment">//åŸå§‹å›¾åƒå®½é«˜æ¯”</span></span><br><span class="line">                <span class="keyword">float</span> net_ar = (<span class="keyword">float</span>)w / (<span class="keyword">float</span>)h; <span class="comment">//è¾“å…¥åˆ°ç½‘ç»œè¦æ±‚çš„å›¾åƒå®½é«˜æ¯”</span></span><br><span class="line">                <span class="keyword">float</span> result_ar = img_ar / net_ar; <span class="comment">//ä¸¤è€…æ±‚æ¯”å€¼æ¥åˆ¤æ–­å¦‚ä½•è¿›è¡Œletter_boxç¼©æ”¾</span></span><br><span class="line">                <span class="comment">//printf(&quot; ow = %d, oh = %d, w = %d, h = %d, img_ar = %f, net_ar = %f, result_ar = %f \n&quot;, ow, oh, w, h, img_ar, net_ar, result_ar);</span></span><br><span class="line">                <span class="keyword">if</span> (result_ar &gt; <span class="number">1</span>)  <span class="comment">// sheight - should be increased</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">float</span> oh_tmp = ow / net_ar;</span><br><span class="line">                    <span class="keyword">float</span> delta_h = (oh_tmp - oh) / <span class="number">2</span>;</span><br><span class="line">                    ptop = ptop - delta_h;</span><br><span class="line">                    pbot = pbot - delta_h;</span><br><span class="line">                    <span class="comment">//printf(&quot; result_ar = %f, oh_tmp = %f, delta_h = %d, ptop = %f, pbot = %f \n&quot;, result_ar, oh_tmp, delta_h, ptop, pbot);</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>  <span class="comment">// swidth - should be increased</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">float</span> ow_tmp = oh * net_ar;</span><br><span class="line">                    <span class="keyword">float</span> delta_w = (ow_tmp - ow) / <span class="number">2</span>;</span><br><span class="line">                    pleft = pleft - delta_w;</span><br><span class="line">                    pright = pright - delta_w;</span><br><span class="line">                    <span class="comment">//printf(&quot; result_ar = %f, ow_tmp = %f, delta_w = %d, pleft = %f, pright = %f \n&quot;, result_ar, ow_tmp, delta_w, pleft, pright);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// ä»¥ä¸‹æ­¥éª¤å°±æ˜¯æ‰§è¡Œäº†letter_boxå˜æ¢</span></span><br><span class="line">            <span class="keyword">int</span> swidth = ow - pleft - pright;</span><br><span class="line">            <span class="keyword">int</span> sheight = oh - ptop - pbot;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> sx = (<span class="keyword">float</span>)swidth / ow;</span><br><span class="line">            <span class="keyword">float</span> sy = (<span class="keyword">float</span>)sheight / oh;</span><br><span class="line"></span><br><span class="line">            image cropped = <span class="built_in">crop_image</span>(orig, pleft, ptop, swidth, sheight);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> dx = ((<span class="keyword">float</span>)pleft / ow) / sx;</span><br><span class="line">            <span class="keyword">float</span> dy = ((<span class="keyword">float</span>)ptop / oh) / sy;</span><br><span class="line">			<span class="comment">// resizeåˆ°æŒ‡å®šå¤§å°</span></span><br><span class="line">            image sized = <span class="built_in">resize_image</span>(cropped, w, h);</span><br><span class="line">            <span class="comment">// ç¿»è½¬</span></span><br><span class="line">			<span class="keyword">if</span> (flip) <span class="built_in">flip_image</span>(sized);</span><br><span class="line">			<span class="comment">//éšæœºå¯¹å›¾åƒjitterï¼ˆåœ¨hsvä¸‰ä¸ªé€šé“ä¸Šæ·»åŠ æ‰°åŠ¨ï¼‰ï¼Œå®ç°æ•°æ®å¢å¼º</span></span><br><span class="line">            <span class="built_in">distort_image</span>(sized, dhue, dsat, dexp);</span><br><span class="line">            <span class="comment">//random_distort_image(sized, hue, saturation, exposure);</span></span><br><span class="line">			<span class="comment">// truthåŒ…å«æ‰€æœ‰å›¾åƒçš„æ ‡ç­¾ä¿¡æ¯ï¼ˆåŒ…æ‹¬çœŸå®ç±»åˆ«ä¸ä½ç½®</span></span><br><span class="line">            <span class="comment">// å› ä¸ºå¯¹åŸå§‹å›¾ç‰‡è¿›è¡Œäº†æ•°æ®å¢å¼ºï¼Œå…¶ä¸­çš„å¹³ç§»æŠ–åŠ¨åŠ¿å¿…ä¼šæ”¹åŠ¨æ¯ä¸ªç‰©ä½“çš„çŸ©å½¢æ¡†æ ‡ç­¾ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯çŸ©å½¢æ¡†çš„åƒç´ åæ ‡ä¿¡æ¯ï¼‰ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„æ•°æ®å¢å¼ºæ–¹å¼è¿›è¡Œç›¸åº”çŸ«æ­£</span></span><br><span class="line">            <span class="comment">// åé¢çš„å‚æ•°å°±æ˜¯ç”¨äºæ•°æ®å¢å¼ºåçš„çŸ©å½¢æ¡†ä¿¡æ¯çŸ«æ­£</span></span><br><span class="line">            <span class="built_in">fill_truth_detection</span>(filename, boxes, truth, classes, flip, dx, dy, <span class="number">1.</span> / sx, <span class="number">1.</span> / sy, w, h);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i_mixup) &#123;</span><br><span class="line">                image old_img = sized;</span><br><span class="line">                old_img.data = d.X.vals[i];</span><br><span class="line">                <span class="comment">//show_image(sized, &quot;new&quot;);</span></span><br><span class="line">                <span class="comment">//show_image(old_img, &quot;old&quot;);</span></span><br><span class="line">                <span class="comment">//wait_until_press_key_cv();</span></span><br><span class="line">				<span class="comment">// åšmixupï¼Œæ··åˆç³»æ•°ä¸º0.5</span></span><br><span class="line">                <span class="built_in">blend_images</span>(sized, <span class="number">0.5</span>, old_img, <span class="number">0.5</span>);</span><br><span class="line">				<span class="comment">// æ ‡ç­¾ä¹Ÿè¦å¯¹åº”æ”¹å˜</span></span><br><span class="line">                <span class="built_in">blend_truth</span>(truth, boxes, d.y.vals[i]);</span><br><span class="line">                <span class="built_in">free_image</span>(old_img);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            d.X.vals[i] = sized.data;</span><br><span class="line">            <span class="built_in">memcpy</span>(d.y.vals[i], truth, <span class="number">5</span> * boxes * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">float</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (show_imgs)<span class="comment">// &amp;&amp; i_mixup)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">char</span> buff[<span class="number">1000</span>];</span><br><span class="line">                <span class="built_in">sprintf</span>(buff, <span class="string">&quot;aug_%d_%d_%s_%d&quot;</span>, random_index, i, <span class="built_in">basecfg</span>(filename), <span class="built_in">random_gen</span>());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> t;</span><br><span class="line">                <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; boxes; ++t) &#123;</span><br><span class="line">                    box b = <span class="built_in">float_to_box_stride</span>(d.y.vals[i] + t*(<span class="number">4</span> + <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (!b.x) <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">int</span> left = (b.x - b.w / <span class="number">2.</span>)*sized.w;</span><br><span class="line">                    <span class="keyword">int</span> right = (b.x + b.w / <span class="number">2.</span>)*sized.w;</span><br><span class="line">                    <span class="keyword">int</span> top = (b.y - b.h / <span class="number">2.</span>)*sized.h;</span><br><span class="line">                    <span class="keyword">int</span> bot = (b.y + b.h / <span class="number">2.</span>)*sized.h;</span><br><span class="line">                    <span class="built_in">draw_box_width</span>(sized, left, top, right, bot, <span class="number">1</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">50</span>); <span class="comment">// 3 channels RGB</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">save_image</span>(sized, buff);</span><br><span class="line">                <span class="keyword">if</span> (show_imgs == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">show_image</span>(sized, buff);</span><br><span class="line">                    <span class="built_in">wait_until_press_key_cv</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\nYou use flag -show_imgs, so will be saved aug_...jpg images. Press Enter: \n&quot;</span>);</span><br><span class="line">                <span class="comment">//getchar();</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">free_image</span>(orig);</span><br><span class="line">            <span class="built_in">free_image</span>(cropped);</span><br><span class="line">            <span class="built_in">free</span>(truth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(random_paths);</span><br><span class="line">    <span class="keyword">if</span> (mixup_random_paths) <span class="built_in">free</span>(mixup_random_paths);</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>    <span class="comment">// OPENCV</span></span></span><br></pre></td></tr></table></figure>
<h2 id="load-data-args-ä½¿ç”¨æ–¹æ³•"><a href="#load-data-args-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="load_data(args)ä½¿ç”¨æ–¹æ³•"></a>load_data(args)ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨<code>src/detector.c</code>ä¸­çš„çš„<code>train_detector()</code>å‡½æ•°å…±æœ‰<code>3</code>æ¬¡è°ƒç”¨<code>load_data(args)</code>ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸ºè®­ç»ƒé˜¶æ®µåšå¥½æ•°æ®å‡†å¤‡å·¥ä½œï¼Œå……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥åŠ è½½æ•°æ®ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨æ˜¯åœ¨<code>resize</code>æ“ä½œä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œåªæœ‰<code>random</code>å’Œ<code>count</code>åŒæ—¶æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ä¼šåš<code>resize</code>æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´<code>resize</code>åŠ è½½çš„æ•°æ®æ˜¯æœªè¿›è¡Œ<code>resize</code>è¿‡çš„ï¼Œå› æ­¤ï¼Œéœ€è¦è°ƒæ•´<code>args</code>ä¸­çš„å›¾åƒå®½é«˜ä¹‹åå†é‡æ–°è°ƒç”¨<code>load_data(args)</code>åŠ è½½æ•°æ®ã€‚åä¹‹ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œä¹‹å‰åŠ è½½çš„æ•°æ®ä»ç„¶å¯ç”¨ã€‚ç¬¬ä¸‰æ¬¡è°ƒç”¨å°±æ˜¯åœ¨æ•°æ®åŠ è½½å®Œæˆåï¼Œå°†åŠ è½½å¥½çš„æ•°æ®ä¿å­˜èµ·æ¥<code>train=buffer</code>; ç„¶åå¼€å§‹ä¸‹ä¸€æ¬¡çš„åŠ è½½å·¥ä½œã€‚è¿™ä¸€æ¬¡çš„æ•°æ®å°±ä¼šè¿›è¡Œè¿™ä¸€æ¬¡çš„è®­ç»ƒæ“ä½œ(è°ƒç”¨<code>train_network</code>å‡½æ•°)ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
  <entry>
    <title>AlexeyABç‰ˆDarknetä½¿ç”¨æ•™ç¨‹</title>
    <url>/2020/02/20/AlexeyAB%E7%89%88Darknet%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è‡ªä»Joseph Redmonæå‡ºäº†yolov3åï¼Œå…¶darknetä»“åº“å·²ç»è·å¾—äº†16kçš„starï¼Œè¶³ä»¥è¯´æ˜darknetçš„æµè¡Œã€‚è¯¥ä½œè€…æœ€æ–°ä¸€æ¬¡æ›´æ–°ä¹Ÿæ˜¯ä¸€å¹´å‰äº†ï¼Œæ²¡æœ‰ç»§ç»­ç»´æŠ¤ã€‚ä¸è¿‡è‡ªæ¥è‡ªä¿„å›½çš„å¤§ç¥AlexeyABåœ¨ä¸æ–­åœ°æ›´æ–°darknet, ä¸ä»…æ·»åŠ äº†darknetåœ¨windowä¸‹çš„é€‚é…ï¼Œè€Œä¸”å®ç°äº†å¤šç§SOTAç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚AlexeyABä¹Ÿåœ¨åº“ä¸­æä¾›äº†ä¸€ä»½è¯¦ç»†çš„å»ºè®®ï¼Œä»ç¼–è¯‘ã€é…ç½®ã€æ¶‰åŠç½‘ç»œåˆ°æµ‹é‡æŒ‡æ ‡ç­‰ï¼Œä¸€åº”ä¿±å…¨ã€‚é€šè¿‡é˜…è¯»å’Œç†è§£AlexeyABçš„å»ºè®®ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬å¸¦æ¥å¾ˆå¤šå¯å‘ã€‚æœ¬æ–‡æ˜¯æ¥è‡ªç¿»è¯‘AlexeyABçš„darknetä¸­çš„READMEã€‚</p>
<p>ä¸‹å›¾æ˜¯CSPNetä¸­ç»Ÿè®¡çš„ç›®å‰çš„State of the Artçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ã€‚å…¶ä¸­csresnext50-panet-spp-optimalæ¨¡å‹æ˜¯CSPNetä¸­æå‡ºæ¥çš„ï¼Œç»“åˆAlexeyABç‰ˆæœ¬çš„Darknetå°±å¯ä»¥å®ç°ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/640.jpg" alt></p>
<h2 id="1-ä¾èµ–"><a href="#1-ä¾èµ–" class="headerlink" title="1. ä¾èµ–"></a>1. ä¾èµ–</h2><h3 id="1-1-ç¯å¢ƒè¦æ±‚"><a href="#1-1-ç¯å¢ƒè¦æ±‚" class="headerlink" title="1.1 ç¯å¢ƒè¦æ±‚"></a>1.1 ç¯å¢ƒè¦æ±‚</h3><ul>
<li>windowç³»ç»Ÿæˆ–è€…linuxç³»ç»Ÿã€‚</li>
<li>CMakeç‰ˆæœ¬é«˜äº3.8ã€‚</li>
<li>CUDA 10.0ï¼ŒcuDNN&gt;=7.0ã€‚</li>
<li>OpenCVç‰ˆæœ¬é«˜äº2.4ã€‚</li>
<li>Linuxä¸‹éœ€è¦GCC æˆ–è€…Clang, Windowä¸‹éœ€è¦Visual Studio 15ã€17æˆ–19ç‰ˆã€‚</li>
</ul>
<h3 id="1-2-æ•°æ®é›†è·å–"><a href="#1-2-æ•°æ®é›†è·å–" class="headerlink" title="1.2 æ•°æ®é›†è·å–"></a>1.2 æ•°æ®é›†è·å–</h3><ol>
<li>MS COCOæ•°æ®é›†: ä½¿ç”¨<code>./scripits/get_coco_dataset.sh</code>æ¥è·å–æ•°æ®é›†ã€‚</li>
<li>OpenImagesæ•°æ®é›†: ä½¿ç”¨<code>./scripits/get_openimages_dataset.py</code>è·å–æ•°æ®é›†,å¹¶æŒ‰ç…§è§„å®šçš„æ ¼å¼é‡æ’è®­ç»ƒé›†ã€‚</li>
<li>Pascal VOCæ•°æ®é›†: ä½¿ç”¨<code>./scripits/voc_label.py</code>å¯¹æ•°æ®é›†æ ‡æ³¨è¿›è¡Œå¤„ç†ã€‚</li>
<li>ILSVRC2012æ•°æ®é›†(ImageNet Classification): ä½¿ç”¨<code>./scripits/get_imagenet_train.sh</code>è·å–æ•°æ®é›†ï¼Œè¿è¡Œ<code>./scripits/imagenet_label.sh</code>ç”¨äºéªŒè¯é›†ã€‚</li>
<li>German/Belgium/Russian/LISA/MASTIF äº¤é€šæ ‡å¿—æ•°æ®é›†ã€‚</li>
<li>å…¶ä»–æ•°æ®é›†ï¼Œè¯·è®¿é—®<code>https://github.com/AlexeyAB/darknet/tree/master/scripts#datasets</code></li>
</ol>
<p>ç»“æœç¤ºæ„ï¼š</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/641.webp" alt></p>
<p>å…¶ä»–æµ‹è¯•ç»“æœå¯ä»¥è®¿é—®:<code>https://www.youtube.com/user/pjreddie/videos</code></p>
<h2 id="2-ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›"><a href="#2-ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›" class="headerlink" title="2. ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›"></a>2. ç›¸æ¯”åŸä½œè€…Darknetçš„æ”¹è¿›</h2><ul>
<li>æ·»åŠ äº†å¯¹windowsä¸‹è¿è¡Œdarknetçš„æ”¯æŒã€‚</li>
<li>æ·»åŠ äº†SOTAæ¨¡å‹ï¼š CSPNet, PRN, EfficientNetã€‚</li>
<li>åœ¨å®˜æ–¹Darknetçš„åŸºç¡€ä¸Šæ·»åŠ äº†æ–°çš„å±‚ï¼š[conv_lstm], [scale_channels] SE/ASFF/BiFPN, [local_avgpool], [sam],  [Gaussian_yolo], [reorg3d] (ä¿®å¤ [reorg]), ä¿®å¤ [batchnorm]ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>[conv_lstm]</code>å±‚æˆ–è€…<code>[crnn]</code>å±‚æ¥å®ç°é’ˆå¯¹è§†é¢‘çš„ç›®æ ‡æ£€æµ‹ã€‚</li>
<li>æ·»åŠ äº†å¤šç§æ•°æ®å¢å¼ºç­–ç•¥: <code>[net] mixup=1 cutmix=1 mosaic=1 blur=1</code>ã€‚</li>
<li>æ·»åŠ äº†å¤šç§æ¿€æ´»å‡½æ•°: SWISH, MISH, NORM_CHAN, NORM\CHAN_SOFTMAXã€‚</li>
<li>å¢åŠ äº†ä½¿ç”¨CPU-RAMæé«˜GPUå¤„ç†è®­ç»ƒçš„èƒ½åŠ›ï¼Œä»¥å¢åŠ <code>mini_batch_size</code>å’Œå‡†ç¡®æ€§ã€‚</li>
<li>æå‡äº†äºŒå€¼ç½‘ç»œï¼Œè®©å…¶åœ¨CPUå’ŒGPUä¸Šçš„è®­ç»ƒå’Œæµ‹è¯•é€Ÿåº¦å˜ä¸ºåŸæ¥çš„2-4å€ã€‚</li>
<li>é€šè¿‡å°†Convolutionalå±‚å’ŒBatch-Normå±‚åˆå¹¶æˆä¸€ä¸ªå±‚ï¼Œæå‡äº†çº¦7%é€Ÿåº¦ã€‚</li>
<li>å¦‚æœåœ¨Makefileä¸­ä½¿ç”¨CUDNN_HALFå‚æ•°ï¼Œå¯ä»¥è®©ç½‘ç»œåœ¨TeslaV100ï¼ŒGeForce RTXç­‰å‹å·çš„GPUä¸Šçš„æ£€æµ‹é€Ÿåº¦æå‡ä¸¤å€ã€‚</li>
<li>é’ˆå¯¹è§†é¢‘çš„æ£€æµ‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹é«˜æ¸…è§†é¢‘æ£€æµ‹é€Ÿåº¦å¯ä»¥æå‡1.2å€ï¼Œå¯¹4kçš„è§†é¢‘æ£€æµ‹é€Ÿåº¦å¯ä»¥æå‡2å€ã€‚</li>
<li>æ•°æ®å¢å¼ºéƒ¨åˆ†ä½¿ç”¨Opencv SSE/AVXæŒ‡ä»¤ä¼˜åŒ–äº†åŸæ¥æœ´ç´ å®ç°çš„æ•°æ®å¢å¼ºï¼Œæ•°æ®å¢å¼ºé€Ÿåº¦æå‡ä¸ºåŸæ¥çš„3.5å€ã€‚</li>
<li>åœ¨CPUä¸Šä½¿ç”¨AVXæŒ‡ä»¤æ¥æé«˜äº†æ£€æµ‹é€Ÿåº¦ï¼Œyolov3æé«˜äº†çº¦85%ã€‚</li>
<li>åœ¨ç½‘ç»œå¤šå°ºåº¦è®­ç»ƒï¼ˆ<code>random=1</code>ï¼‰çš„æ—¶å€™ä¼˜åŒ–äº†å†…å­˜åˆ†é…ã€‚</li>
<li>ä¼˜åŒ–äº†æ£€æµ‹æ—¶çš„GPUåˆå§‹åŒ–ç­–ç•¥ï¼Œåœ¨bacth=1çš„æ—¶å€™æ‰§è¡Œåˆå§‹åŒ–è€Œä¸æ˜¯å½“batch=1çš„æ—¶å€™é‡æ–°åˆå§‹åŒ–ã€‚</li>
<li>æ·»åŠ äº†è®¡ç®—mAP,F1,IoU, Precision-Recallç­‰æŒ‡æ ‡çš„æ–¹æ³•ï¼Œåªéœ€è¦è¿è¡Œ<code>darknet detector map</code>å‘½ä»¤å³å¯ã€‚</li>
<li>æ”¯æŒåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ç”»lossæ›²çº¿å’Œå‡†ç¡®ç‡æ›²çº¿ï¼Œåªéœ€è¦æ·»åŠ <code>-map</code>æ ‡å¿—å³å¯ã€‚</li>
<li>æä¾›äº†<code>-json_port</code>,<code>-mjpeg_port</code>é€‰é¡¹ï¼Œæ”¯æŒä½œä¸ºjsonå’Œmjpeg æœåŠ¡å™¨æ¥åœ¨çº¿è·å–çš„ç»“æœã€‚å¯ä»¥ä½¿ç”¨ä½ çš„ç¼–å†™çš„è½¯ä»¶æˆ–è€…webæµè§ˆå™¨ä¸<strong>jsonå’ŒmjpegæœåŠ¡å™¨</strong>è¿æ¥ã€‚</li>
<li>æ·»åŠ äº†Anchorçš„è®¡ç®—åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®æ•°æ®é›†æ¥èšç±»å¾—åˆ°åˆé€‚çš„Anchorã€‚</li>
<li>æ·»åŠ äº†ä¸€äº›ç›®æ ‡æ£€æµ‹å’Œç›®æ ‡è·Ÿè¸ªçš„ç¤ºä¾‹ï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/src/yolo_console_dll.cpp</code></li>
<li>åœ¨ä½¿ç”¨é”™è¯¯çš„cfgæ–‡ä»¶æˆ–è€…æ•°æ®é›†çš„æ—¶å€™ï¼Œæ·»åŠ äº†è¿è¡Œæ—¶çš„å»ºè®®å’Œè­¦å‘Šã€‚</li>
<li>å…¶å®ƒä¸€äº›ä»£ç ä¿®å¤ã€‚</li>
</ul>
<h2 id="3-å‘½ä»¤è¡Œä½¿ç”¨"><a href="#3-å‘½ä»¤è¡Œä½¿ç”¨" class="headerlink" title="3. å‘½ä»¤è¡Œä½¿ç”¨"></a>3. å‘½ä»¤è¡Œä½¿ç”¨</h2><p>Linuxä¸­ä½¿ç”¨./darknetï¼Œwindowä¸‹ä½¿ç”¨darknet.exe.</p>
<p>Linuxä¸­å‘½ä»¤æ ¼å¼ç±»ä¼¼<code>./darknet detector test ./cfg/coco.data ./cfg/yolov3.cfg ./yolov3.weights</code></p>
<p>Linuxä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨æ ¹ç›®å½•ä¸‹ï¼ŒWindowä¸‹åˆ™åœ¨<code>\build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚ä»¥æ˜¯ä¸åŒæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨çš„å‘½ä»¤ï¼š</p>
<ul>
<li>Yolo v3 COCO - <strong>å›¾ç‰‡æµ‹è¯•</strong>: <code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -thresh 0.25</code></li>
<li><strong>è¾“å‡ºåæ ‡</strong> of objects: <code>darknet.exe detector test cfg/coco.data yolov3.cfg yolov3.weights -ext_output dog.jpg</code></li>
<li>Yolo v3 COCO - <strong>è§†é¢‘æµ‹è¯•</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights -ext_output test.mp4</code></li>
<li><strong>ç½‘ç»œæ‘„åƒå¤´</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights -c 0</code></li>
<li><strong>ç½‘ç»œè§†é¢‘æ‘„åƒå¤´</strong> - Smart WebCam: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights http://192.168.0.80:8080/video?dummy=param.mjpg</code></li>
<li>Yolo v3 - <strong>ä¿å­˜è§†é¢‘ç»“æœä¸ºres.avi</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights test.mp4 -out_filename res.avi</code></li>
<li>Yolo v3 <strong>Tinyç‰ˆæœ¬</strong> COCO - video: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3-tiny.cfg yolov3-tiny.weights test.mp4</code></li>
<li><strong>JSON and MJPEG æœåŠ¡å™¨</strong> ï¼šåˆ›å»ºJSONå’ŒMJPEGæœåŠ¡å™¨ï¼Œå…è®¸è½¯ä»¶æˆ–Webæµè§ˆå™¨è¿›è¡Œä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå¤šä¸ªè¿æ¥ ã€‚å‡è®¾ä¸¤è€…éœ€è¦çš„ç«¯å£ä¸º<code>ip-address:8070</code> å’Œ <code>8090</code>: <code>./darknet detector demo ./cfg/coco.data ./cfg/yolov3.cfg ./yolov3.weights  test50.mp4 -json_port 8070 -mjpeg_port 8090 -ext_output</code></li>
<li>Yolo v3 <strong>Tiny</strong> <strong>on GPU</strong>: <code>darknet.exe detector demo cfg/coco.data cfg/yolov3-tiny.cfg yolov3-tiny.weights -i 1 test.mp4</code></li>
<li>å¦ä¸€ä¸ªå¯è¿›è¡Œå›¾ç‰‡æµ‹è¯•çš„å‘½ä»¤ Yolo v3 COCO - <strong>å›¾ç‰‡æµ‹è¯•</strong>: <code>darknet.exe detect cfg/yolov3.cfg yolov3.weights -i 0 -thresh 0.25</code></li>
<li>åœ¨ <strong>Amazon EC2</strong>ä¸Šè®­ç»ƒ, å¦‚æœæƒ³è¦çœ‹mAPå’ŒLossæ›²çº¿ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤: <code>http://ec2-35-160-228-91.us-west-2.compute.amazonaws.com:8090</code>  (<strong>Darknet å¿…é¡»ä½¿ç”¨OpenCVè¿›è¡Œç¼–è¯‘æ‰èƒ½ä½¿ç”¨è¯¥åŠŸèƒ½</strong>): <code>./darknet detector train cfg/coco.data yolov3.cfg darknet53.conv.74 -dont_show -mjpeg_port 8090 -map</code></li>
<li>186 MB Yolo9000 - <strong>å›¾ç‰‡åˆ†ç±»</strong>: <code>darknet.exe detector test cfg/combine9k.data cfg/yolo9000.cfg yolo9000.weights</code></li>
<li><strong>å¤„ç†ä¸€ç³»åˆ—å›¾ç‰‡ï¼Œå¹¶ä¿å­˜ç»“æœä¸ºjsonæ–‡ä»¶</strong>ï¼š<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -ext_output  -dont_show -out result.json &lt; data/train.txt</code></li>
<li><strong>å¤„ç†ä¸€ç³»åˆ—å›¾ç‰‡ï¼Œå¹¶ä¿å­˜ç»“æœä¸ºtxtæ–‡ä»¶</strong>:<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -dont_show -ext_output &lt; data/train.txt &gt; result.txt</code></li>
<li><strong>ä¼ªæ ‡æ³¨ï¼š</strong> å¤„ç†ä¸€ä¸ªlistçš„å›¾ç‰‡ <code>data/new_train.txt</code> ï¼Œå¯ä»¥è®©ç»“æœä¿å­˜ä¸ºYoloè®­ç»ƒæ‰€éœ€çš„æ ¼å¼ï¼Œæ ‡æ³¨æ–‡ä»¶ä¸º <code>.txt</code> ã€‚é€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥è¿…é€Ÿå¢åŠ è®­ç»ƒæ•°æ®é‡ã€‚å…·ä½“å‘½ä»¤ä¸º:<code>darknet.exe detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights -thresh 0.25  -dont_show -save_labels &lt; data/new_train.txt</code></li>
<li><strong>å¦‚ä½•è®¡ç®—anchor</strong>(é€šè¿‡èšç±»å¾—åˆ°): <code>darknet.exe detector calc_anchors data/obj.data -num_of_clusters 9 -width 416 -height 416</code></li>
<li><strong>è®¡ç®—mAP@IoU=50</strong>: <code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights</code></li>
<li><strong>è®¡ç®—mAP@IoU=75</strong>: <code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights -iou_thresh 0.75</code></li>
</ul>
<p><strong>åˆ©ç”¨Video-Cameraå’ŒMjepg-Streamåœ¨Androidæ™ºèƒ½è®¾å¤‡ä¸­è¿è¡ŒYOLOv3</strong></p>
<ol>
<li><p>ä¸‹è½½ mjpeg-stream APP: IP Webcam / Smart WebCam:</p>
</li>
<li><ul>
<li>Smart WebCam - ä»æ­¤å¤„ä¸‹è½½: <code>https://play.google.com/store/apps/details?id=com.acontech.android.SmartWebCam2</code></li>
<li>IP Webcamä¸‹è½½åœ°å€: <code>https://play.google.com/store/apps/details?id=com.pas.webcam</code></li>
</ul>
</li>
<li><p>å°†ä½ çš„æ‰‹æœºä¸ç”µè„‘é€šè¿‡WIFIæˆ–è€…USBç›¸è¿ã€‚</p>
</li>
<li><p>å¼€å¯æ‰‹æœºä¸­çš„Smart WebCam APPã€‚</p>
</li>
<li><p>å°†ä»¥ä¸‹IPåœ°å€æ›¿æ¢,åœ¨Smart WebCam APPä¸­æ˜¾ç¤ºï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
</li>
</ol>
<p>Yolo v3 COCO-model: <code>darknet.exe detector demo data/coco.data yolov3.cfg yolov3.weights http://192.168.0.80:8080/video?dummy=param.mjpg -i 0</code></p>
<h2 id="4-Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet"><a href="#4-Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet" class="headerlink" title="4. Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet"></a>4. Linuxä¸‹å¦‚ä½•ç¼–è¯‘Darknet</h2><h3 id="4-1-ä½¿ç”¨CMakeç¼–è¯‘Darknet"><a href="#4-1-ä½¿ç”¨CMakeç¼–è¯‘Darknet" class="headerlink" title="4.1 ä½¿ç”¨CMakeç¼–è¯‘Darknet"></a>4.1 ä½¿ç”¨CMakeç¼–è¯‘Darknet</h3><p>CMakeList.txtæ˜¯ä¸€ä¸ªå°è¯•å‘ç°æ‰€æœ‰å®‰è£…è¿‡çš„ã€å¯é€‰çš„ä¾èµ–é¡¹(æ¯”å¦‚CUDAï¼ŒcuDNN, ZED)çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨è¿™äº›ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘ã€‚å®ƒå°†åˆ›å»ºä¸€ä¸ªå…±äº«åº“æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Darknetè¿›è¡Œä»£ç å¼€å‘ã€‚</p>
<p>åœ¨å…‹éš†äº†é¡¹ç›®åº“ä»¥åæŒ‰ç…§ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir build-release</span><br><span class="line">cd build-release</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h3 id="4-2-ä½¿ç”¨makeç¼–è¯‘Darknet"><a href="#4-2-ä½¿ç”¨makeç¼–è¯‘Darknet" class="headerlink" title="4.2 ä½¿ç”¨makeç¼–è¯‘Darknet"></a>4.2 ä½¿ç”¨makeç¼–è¯‘Darknet</h3><p>åœ¨å…‹éš†äº†é¡¹ç›®åº“ä»¥åï¼Œç›´æ¥è¿è¡Œ<code>make</code>å‘½ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯Makefileä¸­æœ‰ä¸€äº›å¯é€‰å‚æ•°ï¼š</p>
<ul>
<li>GPU=1ä»£è¡¨ç¼–è¯‘å®Œæˆåå°†å¯ä»¥ä½¿ç”¨CUDAæ¥è¿›è¡ŒGPUåŠ é€Ÿ(CUDAåº”è¯¥åœ¨<code>/usr/local/cuda</code>ä¸­)ã€‚</li>
<li>CUDNN=1ä»£è¡¨é€šè¿‡cuDNN v5-v7è¿›è¡Œç¼–è¯‘ï¼Œè¿™æ ·å°†å¯ä»¥åŠ é€Ÿä½¿ç”¨GPUè®­ç»ƒè¿‡ç¨‹(cuDNNåº”è¯¥åœ¨<code>/usr/local/cudnn</code>ä¸­)ã€‚</li>
<li>CUDNN_HALF=1ä»£è¡¨åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­æ˜¯å¦æ·»åŠ Tensor Cores, ç¼–è¯‘å®Œæˆåå°†å¯ä»¥å°†ç›®æ ‡æ£€æµ‹é€Ÿåº¦æå‡ä¸ºåŸæ¥çš„3å€ï¼Œè®­ç»ƒç½‘ç»œçš„é€Ÿåº¦æé«˜ä¸ºåŸæ¥çš„2å€ã€‚</li>
<li>OPENCV=1ä»£è¡¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­åŠ å…¥OpenCV, ç›®å‰æ”¯æŒçš„OpenCVçš„ç‰ˆæœ¬æœ‰4.x/3.x/2.4.xï¼Œ ç¼–è¯‘ç»“æŸåå°†å…è®¸Darknetå¯¹ç½‘ç»œæ‘„åƒå¤´çš„è§†é¢‘æµæˆ–è€…è§†é¢‘æ–‡ä»¶è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚</li>
<li>DEBUG=1 ä»£è¡¨æ˜¯å¦å¼€å¯YOLOçš„debugæ¨¡å¼ã€‚</li>
<li>OPENMP=1ä»£è¡¨ç¼–è¯‘è¿‡ç¨‹å°†å¼•å…¥openmp,ç¼–è¯‘ç»“æŸåå°†ä»£è¡¨å¯ä»¥ä½¿ç”¨å¤šæ ¸CPUå¯¹yoloè¿›è¡ŒåŠ é€Ÿã€‚</li>
<li>LIBSO=1 ä»£è¡¨ç¼–è¯‘åº“darknet.soã€‚</li>
<li>ZED_CAMERA=1 æ„å»ºå…·æœ‰ZED-3Dç›¸æœºæ”¯æŒçš„åº“(åº”å®‰è£…ZED SDK)ï¼Œç„¶åè¿è¡Œã€‚</li>
</ul>
<h2 id="5-å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet"><a href="#5-å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet" class="headerlink" title="5. å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet"></a>5. å¦‚ä½•åœ¨Windowä¸‹ç¼–è¯‘Darknet</h2><h3 id="5-1-ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘"><a href="#5-1-ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.1 ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘"></a>5.1 ä½¿ç”¨CMake-GUIè¿›è¡Œç¼–è¯‘</h3><p>å»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥å®ŒæˆWindowä¸‹Darknetçš„ç¼–è¯‘ï¼Œéœ€è¦ç¯å¢ƒæœ‰ï¼šVisual Studio 15/17/19, CUDA&gt;10.0, cuDNN&gt;7.0, OpenCV&gt;2.4</p>
<p>ä½¿ç”¨CMake-GUIç¼–è¯‘æµç¨‹ï¼š</p>
<ol>
<li>Configure.</li>
<li>Optional platform for generator (Set: x64) .</li>
<li>Finish.</li>
<li>Generate.</li>
<li>Open Project.</li>
<li>Set: x64 &amp; Release.</li>
<li>Build.</li>
<li>Build solution.</li>
</ol>
<h3 id="5-2-ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘"><a href="#5-2-ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.2 ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘"></a>5.2 ä½¿ç”¨vcpkgè¿›è¡Œç¼–è¯‘</h3><p>å¦‚æœä½ å·²ç»æ»¡è¶³Visual Studio 15/17/19 ã€CUDA&gt;10.0ã€ cuDNN&gt;7.0ã€OpenCV&gt;2.4çš„æ¡ä»¶, é‚£ä¹ˆæ¨èä½¿ç”¨é€šè¿‡CMake-GUIçš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚</p>
<p>å¦åˆ™æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç¼–è¯‘:</p>
<ul>
<li>å®‰è£…æˆ–æ›´æ–°Visual Studioåˆ°17+,ç¡®ä¿å·²ç»å¯¹å…¶è¿›è¡Œå…¨é¢ä¿®è¡¥ã€‚</li>
<li>å®‰è£…CUDAå’ŒcuDNNã€‚</li>
<li>å®‰è£…Gitå’ŒCMake, å¹¶å°†å®ƒä»¬åŠ å…¥ç¯å¢ƒå˜é‡ä¸­ã€‚</li>
<li>å®‰è£…vcpkgç„¶åå°è¯•å®‰è£…ä¸€ä¸ªæµ‹è¯•åº“æ¥ç¡®è®¤å®‰è£…æ˜¯æ­£ç¡®çš„ï¼Œæ¯”å¦‚ï¼š<code>vcpkg install opengl</code>ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡<code>VCPKG_ROOT</code>, æŒ‡å‘vcpkgçš„å®‰è£…è·¯å¾„ã€‚</li>
<li>å®šä¹‰å¦ä¸€ä¸ªç¯å¢ƒå˜é‡<code>VCPKG_DEFAULT_TRIPLET</code>å°†å…¶æŒ‡å‘x64-windowsã€‚</li>
<li>æ‰“å¼€Powershellç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PS \&gt;                  cd $env:VCPKG_ROOT</span><br><span class="line">PS Code\vcpkg&gt;         .\vcpkg install pthreads opencv[ffmpeg] </span><br><span class="line">#replace with opencv[cuda,ffmpeg] in case you want to use cuda-accelerated openCV</span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“å¼€Powershell, åˆ‡æ¢åˆ°darknetæ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œ<code>.\build.ps1</code>è¿›è¡Œç¼–è¯‘ã€‚å¦‚æœè¦ä½¿ç”¨Visual Studioï¼Œå°†åœ¨Buildåæ‰¾åˆ°CMakeä¸ºæ‚¨åˆ›å»ºçš„ä¸¤ä¸ªè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆï¼Œä¸€ä¸ªåœ¨<code>build_win_debug</code>ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨<code>build_win_release</code>ä¸­ï¼Œå…¶ä¸­åŒ…å«é€‚ç”¨äºç³»ç»Ÿçš„æ‰€æœ‰é…ç½®æ ‡å¿—ã€‚</li>
</ul>
<h3 id="5-3-ä½¿ç”¨legacy-wayè¿›è¡Œç¼–è¯‘"><a href="#5-3-ä½¿ç”¨legacy-wayè¿›è¡Œç¼–è¯‘" class="headerlink" title="5.3 ä½¿ç”¨legacy wayè¿›è¡Œç¼–è¯‘"></a>5.3 ä½¿ç”¨legacy wayè¿›è¡Œç¼–è¯‘</h3><ul>
<li><p>å¦‚æœä½ æœ‰CUDA10.0ã€cuDNN 7.4 å’ŒOpenCV 3.x , é‚£ä¹ˆæ‰“å¼€<code>build\darknet\darknet.sln</code>, è®¾ç½®x64å’ŒRelease ç„¶åè¿è¡ŒBuildï¼Œ è¿›è¡Œdarknetçš„ç¼–è¯‘ï¼Œå°†cuDNNåŠ å…¥ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<ul>
<li>åœ¨<code>C:\opencv_3.0\opencv\build\x64\vc14\bin</code>æ‰¾åˆ°<code>opencv_world320.dll</code>å’Œ<code>opencv_ffmpeg320_64.dll</code>, ç„¶åå°†å…¶å¤åˆ¶åˆ°<code>darknet.exe</code>åŒçº§ç›®å½•ä¸­ã€‚</li>
<li>åœ¨<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.0</code>ä¸­æ£€æŸ¥æ˜¯å¦å«æœ‰binå’Œincludeæ–‡ä»¶å¤¹ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œé‚£å°±å°†ä»–ä»¬ä»CUDAå®‰è£…çš„åœ°æ–¹å¤åˆ¶åˆ°è¿™ä¸ªåœ°æ–¹ã€‚</li>
<li>å®‰è£…cuDNN 7.4.1 æ¥åŒ¹é…CUDA 10.0, å°†cuDNNæ·»åŠ åˆ°ç¯å¢ƒå˜é‡<code>CUDNN</code>ã€‚å°†<code>cudnn64_7.dll</code>å¤åˆ¶åˆ°<code>\build\darknet\x64</code>ä¸­ã€‚</li>
</ul>
</li>
<li><p>å¦‚æœä½ æ˜¯ç”¨çš„æ˜¯å…¶ä»–ç‰ˆæœ¬çš„CUDAï¼ˆä¸æ˜¯CUDA 10.0ï¼‰, é‚£ä¹ˆä½¿ç”¨Notepadæ‰“å¼€<code>build\darknet\darknet.vxcproj</code>, å°†å…¶ä¸­çš„CUDA 10.0æ›¿æ¢ä¸ºä½ çš„CUDAçš„ç‰ˆæœ¬ã€‚ç„¶åæ‰“å¼€<code>\darknet.sln</code>, ç„¶åå³å‡»å·¥ç¨‹ï¼Œç‚¹å‡»å±æ€§properties, é€‰æ‹©CUDA C/C++, ç„¶åé€‰æ‹©Device , ç„¶åç§»é™¤<code>compute_75,sm_75</code>ã€‚ä¹‹åä»ç¬¬ä¸€æ­¥ä»å¤´å¼€å§‹æ‰§è¡Œã€‚</p>
</li>
<li><p>å¦‚æœä½ æ²¡æœ‰GPUä½†æ˜¯æœ‰OpenCV3.0ï¼Œ é‚£ä¹ˆæ‰“å¼€<code>build\darknet\darknet_no_gpu.sln</code>, è®¾ç½®x64å’ŒReleaseï¼Œ ç„¶åè¿è¡Œbuild -&gt; build darknet_no_gpuã€‚</p>
</li>
<li><p>å¦‚æœä½ åªå®‰è£…äº†OpenCV 2.4.14ï¼Œé‚£ä½ åº”è¯¥ä¿®æ”¹<code>\darknet.sln</code>ä¸­çš„è·¯å¾„ã€‚</p>
</li>
<li><ul>
<li>(å³é”®ç‚¹å‡»å·¥ç¨‹) -&gt; properties -&gt; C/C++ -&gt; General -&gt; Additional Include Directories: <code>C:\opencv_2.4.13\opencv\build\include</code></li>
<li>(å³é”®ç‚¹å‡»å·¥ç¨‹)-&gt; properties -&gt; Linker -&gt; General -&gt; Additional Library Directories: <code>C:\opencv_2.4.13\opencv\build\x64\vc14\lib</code></li>
</ul>
</li>
<li><p>å¦‚æœä½ çš„GPUæœ‰Tensor Cores(Nvidia Titan V/ Tesla V100/ DGX-2ç­‰å‹å·)ï¼Œ å¯ä»¥æå‡ç›®æ ‡æ£€æµ‹æ¨¡å‹æµ‹è¯•é€Ÿåº¦ä¸ºåŸæ¥çš„3å€ï¼Œè®­ç»ƒé€Ÿåº¦å˜ä¸ºåŸæ¥çš„2å€ã€‚<code>\darknet.sln</code> -&gt; (å³é”®ç‚¹å‡»å·¥ç¨‹) -&gt; properties -&gt; C/C++ -&gt; Preprocessor -&gt; Preprocessor Definitions, and add here: <code>CUDNN_HALF;</code></p>
<p><strong>æ³¨æ„</strong>ï¼šCUDA å¿…é¡»åœ¨Visual Studioå®‰è£…åå†å®‰è£…ã€‚</p>
</li>
</ul>
<h2 id="6-å¦‚ä½•è®­ç»ƒ"><a href="#6-å¦‚ä½•è®­ç»ƒ" class="headerlink" title="6. å¦‚ä½•è®­ç»ƒ"></a>6. å¦‚ä½•è®­ç»ƒ</h2><h3 id="6-1-Pascal-VOC-dataset"><a href="#6-1-Pascal-VOC-dataset" class="headerlink" title="6.1 Pascal VOC dataset"></a>6.1 Pascal VOC dataset</h3><ol>
<li><p>ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ (154 MB): <code>http://pjreddie.com/media/files/darknet53.conv.74</code> å°†å…¶æ”¾åœ¨ <code>build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
</li>
<li><p>ä¸‹è½½pascal vocæ•°æ®é›†å¹¶è§£å‹åˆ° <code>build\darknet\x64\data\voc</code> æ”¾åœ¨ <code>build\darknet\x64\data\voc\VOCdevkit\</code>æ–‡ä»¶å¤¹ä¸­:</p>
<p>2.1 ä¸‹è½½ <code>voc_label.py</code> åˆ° <code>build\darknet\x64\data\voc</code>ï¼Œåœ°å€ä¸º: <code>http://pjreddie.com/media/files/voc_label.pyã€‚</code></p>
</li>
<li><ul>
<li><code>http://pjreddie.com/media/files/VOCtrainval_11-May-2012.tar</code>ã€‚</li>
<li><code>http://pjreddie.com/media/files/VOCtrainval_06-Nov-2007.tar</code>ã€‚</li>
<li><code>http://pjreddie.com/media/files/VOCtest_06-Nov-2007.tar</code>ã€‚</li>
</ul>
</li>
<li><p>ä¸‹è½½å¹¶å®‰è£…python: <code>https://www.python.org/ftp/python/3.5.2/python-3.5.2-amd64.exe</code></p>
</li>
<li><p>è¿è¡Œå‘½ä»¤: <code>python build\darknet\x64\data\voc\voc_label.py</code> (æ¥ç”Ÿæˆæ–‡ä»¶: 2007_test.txt, 2007_train.txt, 2007_val.txt, 2012_train.txt, 2012_val.txt)ã€‚</p>
</li>
<li><p>è¿è¡Œå‘½ä»¤: <code>type 2007_train.txt 2007_val.txt 2012_*.txt &gt; train.txt</code>ã€‚</p>
</li>
<li><p>åœ¨ <code>yolov3-voc.cfg</code>æ–‡ä»¶ä¸­è®¾ç½® <code>batch=64</code> å’Œ<code>subdivisions=8</code>ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>train_voc.cmd</code> æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ:</p>
<p><code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg darknet53.conv.74</code>ã€‚</p>
</li>
</ol>
<p>(<strong>Note:</strong> å¦‚æœæƒ³è¦åœæ­¢lossæ˜¾ç¤ºï¼Œæ·»åŠ  <code>-dont_show</code>æ ‡å¿—. å¦‚æœä½¿ç”¨CPUè¿è¡Œ, ç”¨<code>darknet_no_gpu.exe</code> ä»£æ›¿ <code>darknet.exe</code>ã€‚)</p>
<p>å¦‚æœæƒ³è¦æ”¹æ•°æ®é›†è·¯å¾„çš„è¯ï¼Œè¯·ä¿®æ”¹ <code>build\darknet\cfg\voc.data</code>æ–‡ä»¶ã€‚</p>
<p><strong>Note:</strong> åœ¨è®­ç»ƒä¸­å¦‚æœä½ çœ‹åˆ°avgä¸ºnanï¼Œé‚£è¯æ˜è®­ç»ƒå‡ºé”™ã€‚ä½†æ˜¯å¦‚æœåœ¨å…¶ä»–éƒ¨åˆ†å‡ºç°nanï¼Œè¿™å±äºæ­£å¸¸ç°è±¡ï¼Œè®­ç»ƒè¿‡ç¨‹æ˜¯æ­£å¸¸çš„ã€‚</p>
<h3 id="6-2-å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ"><a href="#6-2-å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ" class="headerlink" title="6.2 å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ"></a>6.2 å¦‚ä½•ä½¿ç”¨å¤šGPUè®­ç»ƒï¼Ÿ</h3><ol>
<li>é¦–å…ˆåœ¨ä¸€ä¸ªGPUä¸­è®­ç»ƒå¤§æ¦‚1000ä¸ªè½®æ¬¡: <code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg darknet53.conv.74</code>ã€‚</li>
<li>ç„¶ååœä¸‹æ¥åŸºäºè¿™ä¸ªä¿å­˜çš„æ¨¡å‹ <code>/backup/yolov3-voc_1000.weights</code> ä½¿ç”¨å¤šGPU (æœ€å¤š4ä¸ªGPU): <code>darknet.exe detector train cfg/voc.data cfg/yolov3-voc.cfg /backup/yolov3-voc_1000.weights -gpus 0,1,2,3</code>ã€‚</li>
</ol>
<p>åœ¨å¤šGPUè®­ç»ƒçš„æ—¶å€™ï¼Œ<code>learning rate</code>éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚å•<code>gpuä½¿ç”¨0.001</code>ï¼Œé‚£ä¹ˆå¤šgpuåº”è¯¥ä½¿ç”¨0.001/GPUSã€‚ç„¶å<code>cfg</code>æ–‡ä»¶ä¸­çš„<code>burn_in</code>å‚æ•°å’Œ<code>max_batches</code>å‚æ•°è¦è®¾ç½®ä¸ºåŸæ¥çš„GPUSå€ã€‚</p>
<h3 id="6-3-è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†-é‡ç‚¹å…³æ³¨"><a href="#6-3-è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†-é‡ç‚¹å…³æ³¨" class="headerlink" title="6.3 è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†(é‡ç‚¹å…³æ³¨)"></a>6.3 è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†(é‡ç‚¹å…³æ³¨)</h3><p>è®­ç»ƒè¾ƒæ—©æå‡ºçš„Yoloç³»åˆ—ç®—æ³•å¦‚<code>yolov2-voc.cfg</code>, <code>yolov2-tiny-voc.cfg</code>, <code>yolo-voc.cfg</code>, <code>yolo-voc.2.0.cfg</code>ï¼Œè¯·çœ‹<code>https://github.com/AlexeyAB/darknet/tree/47c7af1cea5bbdedf1184963355e6418cb8b1b4f#how-to-train-pascal-voc-data</code>ã€‚</p>
<p>Training Yolo v3:</p>
<ol>
<li>åˆ›å»ºä¸ <code>yolov3.cfg</code>å†…å®¹ç›¸åŒçš„ <code>yolo-obj.cfg</code> æˆ–è€…ç›´æ¥å¤åˆ¶ç„¶åé‡å‘½åä¸º<code>yolo-obj.cfg</code> ç„¶å</li>
</ol>
<ul>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­ <code>batch=64</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­ <code>subdivisions=16</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>cfg</code>æ–‡ä»¶ä¸­<code>max_batches</code>å‚æ•° (ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸º<code>classes*2000</code> ä½†æ˜¯ä¸è¦ä½äº <code>4000</code>), æ¯”å¦‚ å¦‚æœä½ æœ‰ä¸‰ä¸ªç±»ï¼Œé‚£ä¹ˆè®¾ç½®<code>max_batches=6000</code>ã€‚</p>
</li>
<li><p>è®¾ç½®<code>steps</code>å‚æ•°ï¼Œä¸€èˆ¬ä¸º80%å’Œ90%çš„<code>max_batches</code>ã€‚æ¯”å¦‚ <code>steps=4800,5400</code></p>
</li>
<li><p>è®¾ç½®ç½‘ç»œè¾“å…¥é•¿å®½å¿…é¡»èƒ½å¤Ÿæ•´é™¤32ï¼Œæ¯”å¦‚ <code>width=416 height=416</code> `</p>
</li>
<li><p>ä¿®æ”¹yoloå±‚ä¸­çš„ <code>classes=80</code> æ”¹ä¸ºä½ çš„ç±»åˆ«çš„ä¸ªæ•°ï¼Œæ¯”å¦‚<code>classes=3</code>:</p>
</li>
<li><p>ä¿®æ”¹yoloå±‚å‰ä¸€ä¸ªå·ç§¯å±‚convolutionalè¾“å‡ºé€šé“æ•°ã€‚ä¿®æ”¹çš„<code>filter</code>ä¸ªæ•°æœ‰ä¸€å®šè¦æ±‚ï¼ŒæŒ‰ç…§å…¬å¼<code>filters=(classes+5)Ã—3</code>æ¥è®¾ç½®ã€‚è¿™é‡Œçš„<code>5</code>ä»£è¡¨<code>x, y, w, h, conf</code>, è¿™é‡Œçš„<code>3</code>ä»£è¡¨åˆ†é…<code>3</code>ä¸ªanchorã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨ <code>[Gaussian_yolo]</code> (Gaussian_yolov3_BDD.cfg)ï¼Œ<code>filters</code>è®¡ç®—æ–¹å¼ä¸å¤ªä¸€æ ·ï¼ŒæŒ‰ç…§ <code>filters=(classes + 9)x3</code>è¿›è¡Œè®¡ç®—ã€‚</p>
</li>
<li><p>é€šå¸¸æ¥è®²ï¼Œfiltersçš„ä¸ªæ•°è®¡ç®—ä¾èµ–äºç±»åˆ«ä¸ªæ•°ï¼Œåæ ‡ä»¥åŠ<code>mask</code>çš„ä¸ªæ•°ï¼ˆ<code>cfg</code>ä¸­çš„<code>mask</code>å‚æ•°ä¹Ÿå°±æ˜¯<code>anchors</code>çš„ä¸ªæ•°ï¼‰ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­,å¯¹äºä¸¤ä¸ªç›®æ ‡,ä½ çš„ <code>yolo-obj.cfg</code> å’Œ<code>yolov3.cfg</code> ä¸åŒçš„åœ°æ–¹åº”è¯¥åœ¨æ¯ä¸ª<code>[yolo]/[region]</code>å±‚çš„ä¸‹é¢å‡ è¡Œ:</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">filters=21</span><br><span class="line"></span><br><span class="line">[region]</span><br><span class="line">classes=2</span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>build\darknet\x64\data\</code>åˆ›å»ºæ–‡ä»¶ <code>obj.names</code> , æ¯è¡Œä¸€ä¸ªç±»åˆ«çš„åç§°ã€‚</li>
<li>åœ¨<code>build\darknet\x64\data\</code> åˆ›å»º<code>obj.data</code>, å…·ä½“å†…å®¹å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classes= 2 # ä½ çš„ç±»åˆ«çš„ä¸ªæ•°</span><br><span class="line">train  = data/train.txt # å­˜å‚¨ç”¨äºè®­ç»ƒçš„å›¾ç‰‡ä½ç½®</span><br><span class="line">valid  = data/test.txt # å­˜å‚¨ç”¨äºæµ‹è¯•çš„å›¾ç‰‡çš„ä½ç½®</span><br><span class="line">names = data/obj.names # æ¯è¡Œä¸€ä¸ªç±»åˆ«çš„åç§°</span><br><span class="line">backup = backup/</span><br></pre></td></tr></table></figure>
<ol>
<li>å°†ä½ çš„å›¾ç‰‡æ”¾åœ¨ <code>build\darknet\x64\data\obj\</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</li>
<li>ä½ åº”è¯¥æ ‡æ³¨ä½ çš„æ•°æ®é›†ä¸­çš„æ¯ä¸€å¼ å›¾ç‰‡ï¼Œä½¿ç”¨<code>Yolo_mark</code>è¿™ä¸ªå¯è§†åŒ–GUIè½¯ä»¶æ¥æ ‡æ³¨å‡ºç›®æ ‡æ¡†å¹¶ä¸”äº§ç”Ÿæ ‡æ³¨æ–‡ä»¶ã€‚åœ°å€ï¼š <code>https://github.com/AlexeyAB/Yolo_mark</code>ã€‚</li>
</ol>
<p>è½¯ä»¶å°†ä¼šä¸ºæ¯ä¸€ä¸ªå›¾åƒåˆ›å»ºä¸€ä¸ª<code>txt</code>æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå‘½åä¸åŸå›¾ç‰‡çš„åç§°ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯åç¼€æ˜¯txtã€‚txtæ ‡æ³¨æ–‡ä»¶ä¸­æ¯ä¸€ä¸ªç›®æ ‡ç‹¬å ä¸€è¡Œï¼ŒæŒ‰ç…§<code>&lt;object-class&gt; &lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;</code>çš„æ ¼å¼æ’å¸ƒã€‚</p>
<p>å…·ä½“å‚æ•°è§£é‡Šï¼š</p>
<ul>
<li><p><code>&lt;object-class&gt;</code>- æ˜¯ä» <code>0</code> åˆ° <code>(classes-1)</code>çš„æ•´æ•°ï¼Œä»£è¡¨å…·ä½“çš„ç±»åˆ«ã€‚</p>
</li>
<li><p><code>&lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;</code> -  æ˜¯å½’ä¸€åŒ–åˆ°<code>(0.0 to 1.0]</code>ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯ç›¸å¯¹äºå›¾ç‰‡æ•´ä½“çš„å®½å’Œé«˜çš„ä¸€ä¸ªç›¸å¯¹å€¼ã€‚</p>
</li>
<li><p>æ¯”å¦‚: <code>&lt;x&gt; = &lt;absolute_x&gt; / &lt;image_width&gt;</code> æˆ–è€… <code>&lt;height&gt; = &lt;absolute_height&gt; / &lt;image_height&gt;</code></p>
</li>
<li><p>éœ€è¦æ³¨æ„çš„æ˜¯: <code>&lt;x_center&gt; &lt;y_center&gt;</code> - æ˜¯æ ‡æ³¨æ¡†çš„ä¸­å¿ƒç‚¹ï¼Œè€Œä¸æ˜¯å·¦ä¸Šè§’ã€‚è¯·æ³¨æ„æ ¼å¼ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œimg1.txtä¸­å†…å®¹å¦‚ä¸‹ï¼Œä»£è¡¨æœ‰ä¸¤ä¸ªç±»åˆ«çš„ä¸‰ä¸ªç›®æ ‡ï¼š</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 0.716797 0.395833 0.216406 0.147222</span><br><span class="line">0 0.687109 0.379167 0.255469 0.158333</span><br><span class="line">1 0.420312 0.395833 0.140625 0.166667</span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>build\darknet\x64\data\</code>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºtrain.txtæ–‡ä»¶ï¼Œæ¯è¡ŒåŒ…å«çš„æ˜¯è®­ç»ƒé›†å›¾ç‰‡çš„å†…å®¹ã€‚å…¶è·¯å¾„æ˜¯ç›¸å¯¹äº <code>darknet.exe</code>çš„è·¯å¾„æˆ–è€…ç»å¯¹è·¯å¾„ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">data/obj/img1.jpg</span><br><span class="line">data/obj/img2.jpg</span><br><span class="line">data/obj/img3.jpg</span><br></pre></td></tr></table></figure>
<ol>
<li><p>ä¸‹è½½é¢„è®­ç»ƒæƒé‡ï¼Œå¹¶å°†å…¶æ”¾åœ¨ <code>build\darknet\x64</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<ul>
<li>å¯¹äº<code>csresnext50-panet-spp.cfg</code> (133 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>yolov3.cfg, yolov3-spp.cfg</code> (154 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>yolov3-tiny-prn.cfg , yolov3-tiny.cfg</code> (6 MB)ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
<li>å¯¹äº<code>enet-coco.cfg (EfficientNetB0-Yolov3)</code>ï¼šè¯·æŸ¥çœ‹åŸå·¥ç¨‹ã€‚</li>
</ul>
</li>
<li><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå¼€å§‹è®­ç»ƒ: <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74</code>ã€‚</p>
<p>å¯¹äºlinuxç”¨æˆ·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ: <code>./darknet detector train data/obj.data yolo-obj.cfg darknet53.conv.74</code> (ä½¿ç”¨<code>./darknet</code> è€Œä¸æ˜¯ <code>darknet.exe</code>)ã€‚</p>
<p>å¦‚æœæƒ³è®­ç»ƒçš„è¿‡ç¨‹ä¸­åŒæ­¥æ˜¾ç¤ºmAPï¼ˆæ¯å››ä¸ªepochè¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼‰ï¼Œè¿è¡Œå‘½ä»¤: <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -map</code>ã€‚</p>
<ul>
<li>æƒé‡æ–‡ä»¶ <code>yolo-obj_last.weights</code> å°†ä¼šä¿å­˜åœ¨ <code>build\darknet\x64\backup\</code> æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯100ä¸ªè¿­ä»£ä¿å­˜ä¸€æ¬¡ã€‚</li>
<li>æƒé‡æ–‡ä»¶<code>yolo-obj_xxxx.weights</code> å°†ä¼šä¿å­˜åœ¨ <code>build\darknet\x64\backup\</code> æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯1000ä¸ªè¿­ä»£ä¿å­˜ä¸€æ¬¡ã€‚</li>
<li>å¦‚æœä¸æƒ³åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­åŒæ­¥å±•ç¤ºlossæ›²çº¿ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ <code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -dont_show</code>ã€‚</li>
<li>å¦‚æœæƒ³åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŸ¥çœ‹mAPå’ŒLossæ›²çº¿ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<code>darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -dont_show -mjpeg_port 8090 -map</code> ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL <code>http://ip-address:8090</code> ã€‚</li>
</ul>
</li>
<li><p>è®­ç»ƒç»“æŸä»¥åï¼Œå°†ä¼šåœ¨æ–‡ä»¶å¤¹<code>build\darknet\x64\backup\</code>ä¸­å¾—åˆ°æƒé‡æ–‡ä»¶ <code>yolo-obj_final.weights</code> ã€‚</p>
</li>
</ol>
<ul>
<li>åœ¨100æ¬¡è¿­ä»£ä»¥åï¼Œä½ å¯ä»¥åœä¸‹æ¥ï¼Œç„¶åä»è¿™ä¸ªç‚¹åŠ è½½æ¨¡å‹ç»§ç»­è®­ç»ƒã€‚æ¯”å¦‚è¯´, ä½ åœ¨2000æ¬¡è¿­ä»£ä»¥ååœæ­¢è®­ç»ƒï¼Œå¦‚æœä½ ä¹‹åæƒ³è¦æ¢å¤è®­ç»ƒï¼Œåªéœ€è¦è¿è¡Œå‘½ä»¤ï¼š <code>darknet.exe detector train data/obj.data yolo-obj.cfg backup\yolo-obj_2000.weights</code>ï¼Œè€Œä¸éœ€è¦é‡å¤´å¼€å§‹è®­ç»ƒã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ol>
<li>å¦‚æœåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°<code>avg</code>æŒ‡æ ‡å˜ä¸º<code>nan</code>ï¼Œé‚£è¯æ˜è®­ç»ƒè¿‡ç¨‹æœ‰è¯¯ï¼Œå¯èƒ½æ˜¯æ•°æ®æ ‡æ³¨è¶Šç•Œå¯¼è‡´çš„é—®é¢˜ã€‚ä½†æ˜¯å…¶ä»–æŒ‡æ ‡æœ‰<code>nan</code>æ˜¯æ­£å¸¸çš„ã€‚</li>
<li>ä¿®æ”¹<code>width</code>,<code>height</code>çš„æ—¶å€™å¿…é¡»è¦ä¿è¯ä¸¤è€…éƒ½èƒ½å¤Ÿè¢«32æ•´é™¤ã€‚</li>
<li>è®­ç»ƒç»“æŸåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•ï¼š<code>darknet.exe detector test data/obj.data yolo-obj.cfg yolo-obj_8000.weights</code></li>
<li>å¦‚æœå‡ºç°<code>Ouf of memery</code>é—®é¢˜ï¼Œé‚£è¯´æ˜æ˜¾å¡çš„æ˜¾å­˜ä¸å¤Ÿï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>subdivisions</code>å‚æ•°ï¼Œå°†å…¶ä»åŸæ¥çš„<code>16</code>æé«˜ä¸º<code>32</code>æˆ–è€…<code>64</code>ï¼Œè¿™æ ·å°±èƒ½é™ä½ä½¿ç”¨çš„æ˜¾å­˜ï¼Œä¿è¯ç¨‹åºæ­£å¸¸è¿è¡Œã€‚</li>
</ol>
<h3 id="6-4-è®­ç»ƒtiny-yolo"><a href="#6-4-è®­ç»ƒtiny-yolo" class="headerlink" title="6.4 è®­ç»ƒtiny-yolo"></a>6.4 è®­ç»ƒtiny-yolo</h3><p>è®­ç»ƒtiny yoloä¸ä»¥ä¸Šçš„è®­ç»ƒè¿‡ç¨‹å¹¶æ— æ˜æ˜¾åŒºåˆ«ï¼Œé™¤äº†ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ä¸‹è½½tiny yoloçš„é¢„è®­ç»ƒæƒé‡ï¼š<code>https://pjreddie.com/media/files/yolov3-tiny.weights</code></li>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œæ¥è·å–é¢„è®­ç»ƒæƒé‡: <code>darknet.exe partial cfg/yolov3-tiny.cfg yolov3-tiny.weights yolov3-tiny.conv.15 15</code>ï¼Œ è¿™é‡Œçš„15ä»£è¡¨å‰15ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯backboneæ‰€åœ¨çš„å±‚ã€‚</li>
<li>ä½¿ç”¨çš„é…ç½®æ–‡ä»¶åº”è¯¥æ˜¯ <code>cfg/yolov3-tiny_obj.cfg</code> è€Œä¸æ˜¯ <code>yolov3.cfg</code></li>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹è®­ç»ƒ: <code>darknet.exe detector train data/obj.data yolov3-tiny-obj.cfg yolov3-tiny.conv.15</code></li>
</ul>
<p>å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–backboneè¿›è¡Œè®­ç»ƒæ¯”å¦‚ DenseNet201-Yoloæˆ–è€…ResNet50-Yolo, ä½ å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­æ‰¾åˆ°:<code>https://github.com/AlexeyAB/darknet/blob/master/build/darknet/x64/partial.cmd</code></p>
<p>å¦‚æœä½ é‡‡ç”¨çš„æ˜¯è‡ªå·±è®¾è®¡çš„backbone,é‚£å°±æ— æ³•è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œbackboneå¯ä»¥ç›´æ¥è¿›è¡Œå‚æ•°éšæœºåˆå§‹åŒ–ã€‚</p>
<h3 id="6-5-ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ"><a href="#6-5-ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ" class="headerlink" title="6.5 ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ"></a>6.5 ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒ</h3><p>å»ºè®®ä¸ºæ¯ä¸ªç±»åˆ†é…è‡³å°‘2000æ¬¡è¿­ä»£ï¼Œä½†æ˜¯æ•´ä½“è¿­ä»£æ¬¡æ•°ä¸åº”å°‘äº4000æ¬¡ã€‚å¦‚æœæƒ³è¦æ›´åŠ ç²¾å‡†åœ°å®šä¹‰ä»€ä¹ˆæ—¶å€™è¯¥åœæ­¢è®­ç»ƒï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li>è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä½ å°†ä¼šçœ‹åˆ°æ—¥å¿—ä¸­æœ‰å¾ˆå¤šé”™è¯¯çš„åº¦é‡æŒ‡æ ‡ï¼Œä½ éœ€è¦åœ¨avgæŒ‡æ ‡ä¸å†ä¸‹é™çš„æ—¶å€™åœæ­¢è®­ç»ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</li>
</ol>
<blockquote>
<p>Region Avg IOU: 0.798363, Class: 0.893232, Obj: 0.700808, No Obj: 0.004567, Avg Recall: 1.000000,  count: 8 Region Avg IOU: 0.800677, Class: 0.892181, Obj: 0.701590, No Obj: 0.004574, Avg Recall: 1.000000,  count: 8</p>
<p><strong>9002</strong>: 0.211667, <strong>0.60730 avg</strong>, 0.001000 rate, 3.868000 seconds, 576128 images Loaded: 0.000000 seconds</p>
</blockquote>
<ul>
<li><p><strong>9002</strong> - ä»£è¡¨å½“å‰çš„è¿­ä»£æ¬¡æ•°ã€‚</p>
</li>
<li><p><strong>0.60730 avg</strong> - average loss (error) - <strong>è¿™ä¸ªæŒ‡æ ‡æ˜¯å¹³å‡loss, å…¶è¶Šä½è¶Šå¥½ã€‚</strong></p>
<p>åœ¨è¿™ä¸ªæŒ‡æ ‡ä¸å†ä¸‹é™çš„æ—¶å€™å°±å¯ä»¥åœæ­¢è®­ç»ƒäº†ã€‚æœ€ç»ˆçš„å€¼å¤§æ¦‚åˆ†å¸ƒåœ¨0.05-3.0ä¹‹é—´ï¼Œå°è€Œç®€å•çš„æ¨¡å‹é€šå¸¸æœ€ç»ˆlossæ¯”è¾ƒå°ï¼Œå¤§è€Œå¤æ‚çš„losså¯èƒ½ä¼šæ¯”è¾ƒå¤§ã€‚</p>
</li>
</ul>
<p>è®­ç»ƒå®Œæˆåï¼Œä½ å°±å¯ä»¥ä» <code>darknet\build\darknet\x64\backup</code> æ–‡ä»¶å¤¹ä¸­å–å‡ºæ¯”è¾ƒé åçš„å‡ ä¸ª<code>weights</code>æ–‡ä»¶ï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œæµ‹è¯•ï¼Œé€‰æ‹©æœ€å¥½çš„æƒé‡æ–‡ä»¶ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ åœ¨<code>9000</code>æ¬¡è¿­ä»£ååœæ­¢è®­ç»ƒï¼Œä½†æœ€å¥½çš„æƒé‡å¯èƒ½æ˜¯<code>7000,8000,9000</code>æ¬¡çš„å€¼ã€‚è¿™ç§æƒ…å†µçš„å‡ºç°æ˜¯ç”±äº<strong>è¿‡æ‹Ÿåˆ</strong>å¯¼è‡´çš„ã€‚<strong>è¿‡æ‹Ÿåˆ</strong>æ˜¯ç”±äºè¿‡åº¦å­¦ä¹ è®­ç»ƒé›†çš„åˆ†å¸ƒï¼Œè€Œé™ä½äº†æ¨¡å‹åœ¨æµ‹è¯•é›†çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<p><strong>Early Stopping Point</strong>ç¤ºæ„å›¾:</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/642.webp" alt></p>
<p>ä¸ºäº†å¾—åˆ°åœ¨early stopping pointå¤„çš„æƒé‡ï¼š</p>
<p>2.1 é¦–å…ˆï¼Œä½ çš„obj.dataæ–‡ä»¶ä¸­åº”è¯¥å«æœ‰valid=valid.txtä¸€é¡¹ï¼Œç”¨äºæµ‹è¯•åœ¨éªŒè¯é›†çš„å‡†ç¡®ç‡ã€‚å¦‚æœä½ æ²¡æœ‰éªŒè¯é›†å›¾ç‰‡ï¼Œé‚£å°±ç›´æ¥å¤åˆ¶train.txté‡å‘½åä¸ºvalid.txtã€‚</p>
<p>2.2 å‡å¦‚ä½ é€‰æ‹©åœ¨<code>9000</code>æ¬¡è¿­ä»£ååœæ­¢ï¼Œé‚£å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æµ‹è¯•<code>7000,8000,9000</code>ä¸‰ä¸ªæ¨¡å‹çš„ç›¸å…³æŒ‡æ ‡ã€‚é€‰æ‹©æœ€é«˜<code>mAP</code>æˆ–è€…æœ€é«˜<code>IoU</code>çš„æ¨¡å‹æœ€ä¸ºæœ€ç»ˆæ¨¡å‹ã€‚</p>
<ul>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_7000.weights</code></li>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_8000.weights</code></li>
<li><code>darknet.exe detector map data/obj.data yolo-obj.cfg backup\yolo-obj_9000.weights</code></li>
</ul>
<p>æˆ–è€…ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨<code>-map</code>æ ‡å¿—ç¬¦æ¥ç›´æ¥å®æ—¶æµ‹è¯•mAPå€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">darknet.exe detector train data/obj.data yolo-obj.cfg darknet53.conv.74 -map</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½ å°±èƒ½å¾—åˆ°lossæ›²çº¿å’ŒmAPæ›²çº¿ï¼ŒmAPæ¯4ä¸ªepochå¯¹éªŒè¯é›†è¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼Œå¹¶å°†ç»“æœæ˜¾ç¤ºåœ¨å›¾ä¸­ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/643.webp" alt></p>
<p>æŒ‡æ ‡è§£é‡Š</p>
<ul>
<li><p><strong>IoU</strong> (intersect over union) - å¹³å‡äº¤å¹¶æ¯”</p>
</li>
<li><p><strong>mAP</strong> (mean average precision) - æ¯ä¸ªç±»çš„å¹³å‡ç²¾åº¦ã€‚</p>
</li>
</ul>
<p><strong>mAP</strong> æ˜¯Pascal VOCç«èµ›çš„é»˜è®¤æŒ‡æ ‡ï¼Œä¸MS COCOç«èµ›ä¸­çš„AP50æŒ‡æ ‡æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>Precisionå’ŒRecallå‚æ•°åœ¨Pascal VOCç«èµ›ä¸­ç•¥å¾®ä¸åŒï¼Œä½† <strong>IoU çš„æ„ä¹‰éƒ½æ˜¯ç›¸åŒçš„</strong>ã€‚</p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/644.jpg" alt></p>
<h3 id="6-6-å¦‚ä½•åœ¨pascal-voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡"><a href="#6-6-å¦‚ä½•åœ¨pascal-voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡" class="headerlink" title="6.6 å¦‚ä½•åœ¨pascal voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡"></a>6.6 å¦‚ä½•åœ¨pascal voc2007æ•°æ®é›†ä¸Šè®¡ç®—mAPæŒ‡æ ‡</h3><ol>
<li>åœ¨VOC2007ä¸­è®¡ç®—mAPï¼š</li>
</ol>
<ul>
<li>ä¸‹è½½VOCæ•°æ®é›†ï¼Œå®‰è£…pythonå¹¶ä¸”ä¸‹è½½<code>`2007_test.txt</code>æ–‡ä»¶ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé“¾æ¥ï¼š<code>https://github.com/AlexeyAB/darknet#how-to-train-pascal-voc-data</code></li>
<li>ä¸‹è½½æ–‡ä»¶ <code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/scripts/voc_label_difficult.py</code> åˆ° <code>build\darknet\x64\data\</code> æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œ <code>voc_label_difficult.py</code> ä»è€Œå¾—åˆ° <code>difficult_2007_test.txt</code>ã€‚</li>
<li>å°†ä¸‹é¢voc.dataæ–‡ä»¶ä¸­çš„ç¬¬å››è¡Œ#åˆ é™¤</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classes= 20</span><br><span class="line">train  = data/train_voc.txt</span><br><span class="line">valid  = data/2007_test.txt</span><br><span class="line">#difficult = data/difficult_2007_test.txt</span><br><span class="line">names = data/voc.names</span><br><span class="line">backup = backup/</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥è®¡ç®—å¾—åˆ°mAP:</p>
<ol>
<li>ä½¿ç”¨Darknet + Python: è¿è¡Œ <code>build/darknet/x64/calc_mAP_voc_py.cmd</code> ï¼Œä½ å°†å¾—åˆ° <code>yolo-voc.cfg</code> æ¨¡å‹çš„mAPå€¼, mAP = 75.9%</li>
<li>ç›´æ¥ä½¿ç”¨å‘½ä»¤: è¿è¡Œæ–‡ä»¶ <code>build/darknet/x64/calc_mAP.cmd</code> -ä½ å°†å¾—åˆ° <code>yolo-voc.cfg</code> æ¨¡å‹, å¾—åˆ°mAP = 75.8%</li>
</ol>
<p>YOLOv3çš„è®ºæ–‡ï¼š<code>https://arxiv.org/pdf/1612.08242v1.pdf</code>æŒ‡å‡ºå¯¹äº416x416çš„YOLOv2ï¼ŒPascal Vocä¸Šçš„mAPå€¼æ˜¯76.8%ã€‚æˆ‘ä»¬å¾—åˆ°çš„å€¼è¾ƒä½ï¼Œå¯èƒ½æ˜¯ç”±äºæ¨¡å‹åœ¨è¿›è¡Œæ£€æµ‹æ—¶çš„ä»£ç ç•¥æœ‰ä¸åŒã€‚</p>
<p>å¦‚æœä½ æƒ³ä¸º<code>tiny-yolo-voc</code>è®¡ç®—mAPå€¼ï¼Œå°†è„šæœ¬ä¸­<code>tiny-yolo-voc.cfg</code>å–æ¶ˆæ³¨é‡Šï¼Œå°†<code>yolo-voc.cfg</code>æ³¨é‡Šæ‰ã€‚</p>
<p>å¦‚æœä½ æ˜¯ç”¨çš„æ˜¯python 2.x è€Œä¸æ˜¯python 3.x, è€Œä¸”ä½ é€‰æ‹©ä½¿ç”¨Darknet+Pythonçš„æ–¹å¼æ¥è®¡ç®—mAP, é‚£ä½ åº”è¯¥ä½¿ç”¨ <code>reval_voc.py</code> å’Œ <code>voc_eval.py</code> è€Œä¸æ˜¯ä½¿ç”¨ <code>reval_voc_py3.py</code> å’Œ <code>voc_eval_py3.py</code> ã€‚ä»¥ä¸Šè„šæœ¬æ¥è‡ªä»¥ä¸‹ç›®å½•ï¼š<code>https://github.com/AlexeyAB/darknet/tree/master/scripts</code>ã€‚</p>
<p>ç›®æ ‡æ£€æµ‹çš„ä¾‹å­ï¼š<code>darknet.exe detector test data/obj.data yolo-obj.cfg yolo-obj_8000.weights</code></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/645.webp" alt></p>
<p><img src="https://gitee.com/qiyuan-z/yuan-blog-image/raw/master/img/ABDarknet/646.webp" alt></p>
<h2 id="7-å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ"><a href="#7-å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ" class="headerlink" title="7. å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ"></a>7. å¦‚ä½•æå‡ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Ÿ</h2><ol>
<li><p>è®­ç»ƒä¹‹å‰ï¼š</p>
<ul>
<li><code>train_network_width * train_obj_width / train_image_width ~= detection_network_width *  detection_obj_width / detection_image_width</code></li>
<li><p><code>train_network_height * train_obj_height / train_image_height ~= detection_network_height *  detection_obj_height / detection_image_height</code></p>
</li>
<li><p>å®Œæ•´æ¨¡å‹ï¼ˆ5ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3_5l.cfg</code>ã€‚</p>
</li>
<li><p>Tinyæ¨¡å‹ï¼ˆ3ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3-tiny_3l.cfg</code>ã€‚</p>
</li>
<li><p>å¸¦ç©ºé—´é‡‘å­—å¡”æ± åŒ–çš„å®Œæ•´æ¨¡å‹ï¼ˆ3ä¸ªyoloå±‚ï¼‰ï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/cfg/yolov3-spp.cfg</code>ã€‚</p>
</li>
<li><p>åœ¨<code>cfg</code>æ–‡ä»¶ä¸­å°†<code>random</code>è®¾ä¸º1ï¼šè¿™å°†åœ¨Yoloä¸­ä½¿ç”¨å¤šå°ºåº¦è®­ç»ƒï¼Œä¼šæå‡æ£€æµ‹æ¨¡å‹å‡†ç¡®ç‡ã€‚</p>
</li>
<li><p>åœ¨<code>cfg</code>æ–‡ä»¶ä¸­æŠŠè¾“å…¥åˆ†è¾¨ç‡å¢å¤§(<code>height=608</code>, <code>width=608</code>æˆ–è€…å…¶ä»–ä»»æ„32çš„å€æ•°)ï¼šè¿™å°†æå‡æ£€æµ‹æ¨¡å‹å‡†ç¡®ç‡ã€‚</p>
</li>
<li><p>æ£€æŸ¥ä½ è¦æ£€æµ‹çš„æ¯ä¸ªç›®æ ‡åœ¨æ•°æ®é›†ä¸­æ˜¯å¦è¢«æ ‡è®°ï¼Œæ•°æ®é›†ä¸­ä»»ä½•ç›®æ ‡éƒ½ä¸åº”è¯¥æ²¡æœ‰æ ‡ç­¾ã€‚åœ¨å¤§å¤šæ•°è®­ç»ƒå‡ºé—®é¢˜çš„æƒ…å†µä¸­åŸºæœ¬éƒ½æ˜¯æœ‰é”™è¯¯çš„æ ‡ç­¾ï¼ˆé€šè¿‡ä½¿ç”¨æŸäº›è½¬æ¢è„šæœ¬ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ ‡æ³¨æ¥è·å¾—æ ‡ç­¾ï¼‰ï¼Œå¯ä»¥é€šè¿‡<code>https://github.com/AlexeyAB/Yolo_mark</code>æ¥æ£€æŸ¥ä½ çš„æ•°æ®é›†æ˜¯å¦å…¨éƒ¨æ ‡æ³¨æ­£ç¡®ã€‚</p>
</li>
<li><p>æˆ‘çš„æŸå¤±å‡½æ•°å¾ˆé«˜å¹¶ä¸”mAPå¾ˆä½ï¼Œè®­ç»ƒå‡ºé”™äº†å—ï¼Ÿåœ¨è®­ç»ƒå‘½ä»¤æœ«ç«¯ä½¿ç”¨<code>-show_imgs</code> æ ‡å¿—æ¥è¿è¡Œè®­ç»ƒï¼Œä½ æ˜¯å¦èƒ½çœ‹åˆ°æœ‰æ­£ç¡®çš„è¾¹ç•Œé¢„æµ‹æ¡†çš„ç›®æ ‡ï¼ˆåœ¨çª—å£æˆ–è€…<code>aug_...jpg</code>ï¼‰ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œè®­ç»ƒæ˜¯å‘ç”Ÿé”™è¯¯äº†ã€‚</p>
</li>
<li><p>å¯¹äºä½ è¦æ£€æµ‹çš„æ¯ä¸ªç›®æ ‡ï¼Œè®­ç»ƒæ•°æ®é›†ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç›¸ä¼¼çš„ç›®æ ‡ï¼Œå®ƒä»¬å…·æœ‰å¤§è‡´ç›¸åŒçš„å½¢çŠ¶ï¼Œç‰©ä½“ä¾§é¢å§¿æ€ï¼Œç›¸å¯¹å¤§å°ï¼Œæ—‹è½¬è§’åº¦ï¼Œå€¾æ–œåº¦ï¼Œç…§æ˜åº¦ç­‰ã€‚ç†æƒ³çš„æ˜¯ï¼Œä½ çš„è®­ç»ƒæ•°æ®é›†åŒ…æ‹¬å…·æœ‰ä¸åŒæ¯”ä¾‹ï¼Œæ—‹è½¬è§’åº¦ï¼Œç…§æ˜åº¦ï¼Œç‰©ä½“ä¾§é¢å§¿æ€å’Œå¤„äºä¸åŒèƒŒæ™¯çš„ç›®æ ‡å›¾åƒï¼Œä½ æœ€å¥½æ‹¥æœ‰2000å¼ ä¸åŒçš„å›¾åƒï¼Œå¹¶ä¸”è‡³å°‘è®­ç»ƒ<code>2000Ã—classes</code>è½®æ¬¡ã€‚</p>
</li>
<li><p>å¸Œæœ›ä½ çš„è®­ç»ƒæ•°æ®é›†å›¾ç‰‡åŒ…å«ä½ ä¸æƒ³æ£€æµ‹çš„æœªæ ‡æ³¨çš„ç›®æ ‡ï¼Œä¹Ÿå³æ˜¯æ— è¾¹ç•Œæ¡†çš„è´Ÿæ ·æœ¬å›¾ç‰‡(ç©ºçš„<code>.txt</code>æ–‡ä»¶)ï¼Œå¹¶ä¸”è´Ÿæ ·æœ¬å›¾ç‰‡çš„æ•°é‡å’Œå¸¦æœ‰ç›®æ ‡çš„æ­£æ ·æœ¬å›¾ç‰‡æ•°é‡æœ€å¥½ä¸€æ ·å¤šã€‚</p>
</li>
<li><p>æ ‡æ³¨ç›®æ ‡çš„æœ€ä½³æ–¹æ³•æ˜¯ï¼šä»…ä»…æ ‡è®°ç›®æ ‡çš„å¯è§éƒ¨åˆ†æˆ–è€…æ ‡è®°ç›®æ ‡çš„å¯è§å’Œé‡å éƒ¨åˆ†ï¼Œæˆ–æ ‡è®°æ¯”æ•´ä¸ªç›®æ ‡å¤šä¸€ç‚¹(æœ‰ä¸€ç‚¹é—´éš™)?æ ¹æ®ä½ å¸Œæœ›å¦‚ä½•æ£€æµ‹ç›®æ ‡æ¥è¿›è¡Œæ ‡è®°ã€‚</p>
</li>
<li><p>ä¸ºäº†å¯¹å›¾ç‰‡ä¸­åŒ…å«å¤§é‡ç›®æ ‡çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæ·»åŠ <code>max=200</code>æˆ–è€…æ›´é«˜çš„å€¼åœ¨ä½ <code>cfg</code>æ–‡ä»¶ä¸­<code>yolo</code>å±‚æˆ–è€…<code>region</code>å±‚çš„æœ€åä¸€è¡Œï¼ˆYOLOv3å¯ä»¥æ£€æµ‹åˆ°çš„ç›®æ ‡å…¨å±€æœ€å¤§æ•°é‡ä¸º<code>0,0615234375*(width*height)</code>å…¶ä¸­<code>width</code>å’Œ<code>height</code>æ˜¯åœ¨<code>cfg</code>æ–‡ä»¶ä¸­çš„<code>[net]</code>éƒ¨åˆ†æŒ‡å®šçš„ï¼‰ã€‚</p>
</li>
<li><p>å¯¹äºå°ç›®æ ‡çš„è®­ç»ƒï¼ˆæŠŠå›¾åƒresizeåˆ°416x416å¤§å°åå°äº16x16çš„ç›®æ ‡ï¼‰ï¼šè®¾ç½®<code>layers = -1, 11</code>è€Œä¸æ˜¯<code>layers=-1, 36</code>ï¼›è®¾ç½®<code>stride=4</code>è€Œä¸æ˜¯<code>stride=2</code>ã€‚</p>
</li>
<li><p>å¯¹äºæ—¢æœ‰å¤§ç›®æ ‡åˆæœ‰å°ç›®æ ‡çš„è®­ç»ƒä½¿ç”¨ä¸‹é¢çš„æ¨¡å‹ï¼š</p>
</li>
<li><p>å¦‚æœä½ è¦è®­ç»ƒæ¨¡å‹å°†å·¦å³ç›®æ ‡åˆ†ä¸ºå•ç‹¬çš„ç±»åˆ«ï¼ˆå·¦/å³æ‰‹ï¼Œå·¦/å³äº¤é€šæ ‡å¿—ï¼‰ï¼Œé‚£å°±ç¦ç”¨ç¿»è½¬çš„æ•°æ®æ‰©å……æ–¹å¼ï¼Œå³åœ¨æ•°æ®è¾“å…¥éƒ¨åˆ†æ·»åŠ <code>flip=0</code>ã€‚</p>
</li>
<li><p>ä¸€èˆ¬è§„åˆ™ï¼šä½ çš„è®­ç»ƒæ•°æ®é›†åº”åŒ…æ‹¬ä¸€ç»„æ‚¨æƒ³è¦æ£€æµ‹çš„ç›¸å¯¹å¤§å°çš„ç›®æ ‡ï¼Œå¦‚ä¸‹ï¼š</p>
<p>å³ï¼Œå¯¹äºæµ‹è¯•é›†ä¸­çš„æ¯ä¸ªç›®æ ‡ï¼Œè®­ç»ƒé›†ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåŒç±»ç›®æ ‡å’Œå®ƒå…·æœ‰å¤§çº¦ç›¸åŒçš„å°ºå¯¸ï¼š</p>
<p><code>object width in percent from Training dataset</code> ~= <code>object width in percent from Test dataset</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè®­ç»ƒé›†ä¸­ä»…å­˜åœ¨å å›¾åƒæ¯”ä¾‹80%-90%çš„ç›®æ ‡ï¼Œåˆ™è®­ç»ƒåçš„ç›®æ ‡æ£€æµ‹ç½‘ç»œå°†æ— æ³•æ£€æµ‹åˆ°å å›¾åƒæ¯”ä¾‹ä¸º1-10%çš„ç›®æ ‡ã€‚</p>
</li>
<li><p>ä¸ºäº†åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼ˆåŒæ—¶ä¼šé™ä½æ£€æµ‹ç²¾åº¦ï¼‰ä½¿ç”¨å¾®è°ƒè€Œä¸æ˜¯è¿ç§»å­¦ä¹ ï¼Œåœ¨[net]ä¸‹é¢è®¾ç½®<code>stopbackward=1</code>ã€‚ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<code>./darknet partial cfg/yolov3.cfg yolov3.weights yolov3.conv.81 81</code>è¿™å°†ä¼šåˆ›å»º<code>yolov3.conv.81</code>æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨<code>yolov3.conv.81</code>æ–‡ä»¶è¿›è¡Œè®­ç»ƒè€Œä¸æ˜¯<code>darknet53.conv.74</code>ã€‚</p>
</li>
<li><p>åœ¨è§‚å¯Ÿç›®æ ‡çš„æ—¶å€™ï¼Œä»ä¸åŒçš„æ–¹å‘ã€ä¸åŒçš„ç…§æ˜æƒ…å†µã€ä¸åŒå°ºåº¦ã€ä¸åŒçš„è½¬è§’å’Œå€¾æ–œè§’åº¦æ¥çœ‹ï¼Œå¯¹ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸åŒçš„ç›®æ ‡ã€‚å› æ­¤ï¼Œè¦æ£€æµ‹çš„ç›®æ ‡è¶Šå¤šï¼Œåº”ä½¿ç”¨è¶Šå¤æ‚çš„ç½‘ç»œæ¨¡å‹ã€‚</p>
</li>
<li><p>ä¸ºäº†è®©æ£€æµ‹æ¡†æ›´å‡†ï¼Œä½ å¯ä»¥åœ¨æ¯ä¸ª<code>yolo</code>å±‚æ·»åŠ ä¸‹é¢ä¸‰ä¸ªå‚æ•°<code>ignore_thresh = .9 iou_normalizer=0.5 iou_loss=giou</code>ï¼Œè¿™å›æé«˜map@0.9ï¼Œä½†ä¼šé™ä½map@0.5ã€‚</p>
</li>
<li><p>å½“ä½ æ˜¯ç¥ç»ç½‘ç»œæ–¹é¢çš„ä¸“å®¶æ—¶ï¼Œå¯ä»¥é‡æ–°è®¡ç®—ç›¸å¯¹äº<code>width</code>å’Œ<code>height</code>çš„<code>anchors</code>ï¼š<code>darknet.exe detector calc_anchors data/obj.data -num_of_clusters 9 -width 416 -height 416</code>ç„¶ååœ¨3ä¸ª<code>[yolo]</code>å±‚æ”¾ç½®è¿™9ä¸ª<code>anchors</code>ã€‚ä½†æ˜¯ä½ éœ€è¦ä¿®æ”¹æ¯ä¸ª<code>[yolo]</code>å±‚çš„<code>masks</code>å‚æ•°ï¼Œè®©ç¬¬ä¸€ä¸ª<code>[yolo]</code>å±‚çš„<code>anchors</code>å°ºå¯¸å¤§äº60x60ï¼Œç¬¬äºŒä¸ª<code>[yolo]</code>å±‚çš„<code>anchors</code>å°ºå¯¸å¤§äº30x30ï¼Œå‰©ä¸‹å°±æ˜¯ç¬¬ä¸‰ä¸ª<code>[yolo]</code>å±‚çš„<code>mask</code>ã€‚å®å¤–ï¼Œä½ éœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ª<code>[yolo]</code>å±‚å‰é¢çš„<code>filters=(classes + 5)x</code>ã€‚å¦‚æœå¾ˆå¤šè®¡ç®—çš„<code>anchors</code>éƒ½æ‰¾ä¸åˆ°åˆé€‚çš„å±‚ï¼Œé‚£è¿˜æ˜¯ä½¿ç”¨Yoloçš„é»˜è®¤<code>anchors</code>å§ã€‚</p>
</li>
</ul>
</li>
<li><p>è®­ç»ƒä¹‹åï¼š</p>
<ul>
<li>æ²¡æœ‰å¿…è¦é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œç›´æ¥ä½¿ç”¨ç”¨<code>416x416</code>åˆ†è¾¨ç‡è®­ç»ƒå‡ºæ¥çš„<code>.weights</code>æ¨¡å‹æ–‡ä»¶ã€‚</li>
<li>ä½†æ˜¯è¦è·å¾—æ›´é«˜çš„å‡†ç¡®ç‡ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>608x608</code>æˆ–è€…<code>832x832</code>æ¥è®­ç»ƒï¼Œæ³¨æ„å¦‚æœ<code>Out of memory</code>å‘ç”Ÿäº†ï¼Œä½ åº”è¯¥åœ¨<code>.cfg</code>æ–‡ä»¶ä¸­å¢åŠ <code>subdivisions=16ï¼Œ32ï¼Œ64</code>ã€‚</li>
<li>é€šè¿‡åœ¨<code>.cfg</code>æ–‡ä»¶ä¸­è®¾ç½®ï¼ˆ<code>height=608</code> and <code>width=608</code>ï¼‰æˆ–è€…ï¼ˆ<code>height=832</code> and <code>width=832</code>ï¼‰æˆ–è€…ä»»ä½•32çš„å€æ•°ï¼Œè¿™ä¼šæå‡å‡†ç¡®ç‡å¹¶ä½¿å¾—å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ›´åŠ å®¹æ˜“ã€‚</li>
</ul>
</li>
</ol>
<h2 id="8-å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶"><a href="#8-å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶" class="headerlink" title="8. å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶"></a>8. å¦‚ä½•æ ‡æ³¨ä»¥åŠåˆ›å»ºæ ‡æ³¨æ–‡ä»¶</h2><p>ä¸‹é¢çš„å·¥ç¨‹æä¾›äº†ç”¨äºæ ‡è®°ç›®æ ‡è¾¹ç•Œæ¡†å¹¶ä¸ºYOLO v2&amp;v3 ç”Ÿæˆæ ‡æ³¨æ–‡ä»¶çš„å¸¦å›¾åƒç•Œé¢è½¯ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://github.com/AlexeyAB/Yolo_mark</code>ã€‚</p>
<p>ä¾‹å¦‚å¯¹äºåªæœ‰ä¸¤ç±»ç›®æ ‡çš„æ•°æ®é›†æ ‡æ³¨åæœ‰ä»¥ä¸‹æ–‡ä»¶<code>train.txt</code>,<code>obj.names</code>,<code>obj.data</code>,<code>yolo-obj.cfg</code>,<code>air 1-6.txt</code>,<code>bird 1-4.txt</code>ï¼Œæ¥ç€é…åˆ<code>train_obj.cmd</code>å°±å¯ä»¥ä½¿ç”¨YOLO v2å’ŒYOLO v3æ¥è®­ç»ƒè¿™ä¸ªæ•°æ®é›†äº†ã€‚</p>
<p>ä¸‹é¢æä¾›äº†5é‡å¸¸è§çš„ç›®æ ‡æ ‡æ³¨å·¥å…·ï¼š</p>
<ul>
<li>C++å®ç°çš„ï¼š<code>https://github.com/AlexeyAB/Yolo_mark</code></li>
<li>Pythonå®ç°çš„ï¼š<code>https://github.com/tzutalin/labelImg</code></li>
<li>Pythonå®ç°çš„ï¼š<code>https://github.com/Cartucho/OpenLabeling</code></li>
<li>C++å®ç°çš„ï¼š<code>https://www.ccoderun.ca/darkmark/</code></li>
<li>JavaScriptå®ç°çš„ï¼š<code>https://github.com/opencv/cvat</code></li>
</ul>
<h2 id="9-ä½¿ç”¨YOLO9000"><a href="#9-ä½¿ç”¨YOLO9000" class="headerlink" title="9. ä½¿ç”¨YOLO9000"></a>9. ä½¿ç”¨YOLO9000</h2><p>åŒæ—¶æ£€æµ‹å’Œåˆ†ç±»9000ä¸ªç›®æ ‡ï¼š<code>darknet.exe detector test cfg/combine9k.data cfg/yolo9000.cfg yolo9000.weights data/dog.jpg</code></p>
<ul>
<li><p><code>yolo9000.weights</code>ï¼š186Mbçš„YOLO9000æ¨¡å‹éœ€è¦4G GPUæ˜¾å­˜ï¼Œè®­ç»ƒå¥½çš„æ¨¡å‹ä¸‹è½½åœ°å€ï¼š<code>http://pjreddie.com/media/files/yolo9000.weights</code>ã€‚</p>
</li>
<li><p><code>yolo9000.cfg</code>ï¼šYOLO9000çš„cç½‘ç»œç»“æ„æ–‡ä»¶ï¼ŒåŒæ—¶è¿™é‡Œä¹Ÿæœ‰<code>9k.tree</code>å’Œ<code>coco9k.map</code>æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tree=data/9k.tree</span><br><span class="line">map = data/coco9k.map</span><br></pre></td></tr></table></figure>
<ul>
<li><code>9k.tree</code>ï¼š9418ä¸ªç±»åˆ«çš„å•è¯æ•°ï¼Œæ¯ä¸€è¡Œçš„å½¢å¼ä¸º<code>`ï¼Œå¦‚æœ</code>parent_id==-1<code>é‚£ä¹ˆè¿™ä¸ªæ ‡ç­¾æ²¡æœ‰çˆ¶ç±»åˆ«ï¼Œåœ°å€ä¸ºï¼š</code><a href="https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.tree`ã€‚">https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.tree`ã€‚</a></li>
<li><code>coco9k.map</code>ï¼šå°†MSCOCOçš„80ä¸ªç›®æ ‡ç±»åˆ«æ˜ å°„åˆ°<code>9k.tree</code>çš„æ–‡ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/coco9k.map</code>ã€‚</li>
</ul>
</li>
<li><p><code>combine9k.data</code>ï¼šæ•°æ®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯<code>9k.labels</code>ã€‚<code>9k.names</code>ï¼Œ<code>inet9k.map</code>çš„è·¯å¾„ï¼ˆä¿®æ”¹<code>combine9k.train.list</code>æ–‡ä»¶çš„è·¯å¾„ä¸ºä½ è‡ªå·±çš„ï¼‰ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/combine9k.data</code>ã€‚</p>
</li>
<li><p><code>9k.labels</code>ï¼š9418ç±»ç›®æ ‡çš„æ ‡ç­¾ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.labels</code>ã€‚</p>
</li>
<li><p><code>9k.names</code>ï¼š9418ç±»ç›®æ ‡çš„åå­—ã€‚åœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/9k.names</code>ã€‚</p>
</li>
<li><p><code>inet9k.map</code>ï¼šå°†ImageNetçš„200ä¸ªç›®æ ‡ç±»åˆ«æ˜ å°„åˆ°<code>9k.tree</code>çš„æ–‡ä»¶ï¼Œåœ°å€ä¸ºï¼š<code>https://raw.githubusercontent.com/AlexeyAB/darknet/master/build/darknet/x64/data/inet9k.map</code>ã€‚</p>
</li>
</ul>
<h2 id="10-å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ"><a href="#10-å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ" class="headerlink" title="10. å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ"></a>10. å¦‚ä½•å°†YOLOä½œä¸ºDLLå’ŒSOåº“è¿›è¡Œä½¿ç”¨ï¼Ÿ</h2><ul>
<li><p>åœ¨Linuxä¸Šã€‚</p>
<ul>
<li>ä½¿ç”¨<code>build.sh</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>cmake</code>ç¼–è¯‘<code>darknet</code> æˆ–è€…</li>
<li>å°†<code>Makefile</code>é‡çš„<code>LIBSO=0</code>æ”¹ä¸º<code>LIBSO=1</code>ï¼Œç„¶åæ‰§è¡Œ<code>make</code>ç¼–è¯‘<code>darknet</code></li>
</ul>
</li>
<li><p>åœ¨Windowsä¸Šã€‚</p>
<ul>
<li>ä½¿ç”¨<code>build.ps1</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>cmake</code>ç¼–è¯‘<code>darknet</code> æˆ–è€…</li>
<li>ä½¿ç”¨<code>build\darknet\yolo_cpp_dll.sln</code>æˆ–<code>build\darknet\yolo_cpp_dll_no_gpu.sln</code>è§£å†³æ–¹æ³•ç¼–è¯‘<code>darknet</code></li>
</ul>
</li>
<li><p>è¿™é‡Œæœ‰ä¸¤ä¸ªAPIï¼š</p>
<ul>
<li>ä½¿ç”¨C++ APIçš„C++ä¾‹å­ï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/src/yolo_console_dll.cpp</code></li>
<li>ä½¿ç”¨C APIçš„Pythonä¾‹å­ï¼š<br><code>https://github.com/AlexeyAB/darknet/blob/master/darknet.py</code><br><code>https://github.com/AlexeyAB/darknet/blob/master/darknet_video.py</code></li>
<li>C APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/darknet.h</code></li>
<li>C++ APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/yolo_v2_class.hpp</code></li>
</ul>
</li>
</ul>
<h2 id="11-é™„å½•"><a href="#11-é™„å½•" class="headerlink" title="11. é™„å½•"></a>11. é™„å½•</h2><ol>
<li><p>ä¸ºäº†å°†Yoloç¼–è¯‘æˆC++çš„DLLæ–‡ä»¶<code>yolo_cpp_dll.dll</code>ï¼šæ‰“å¼€<code>build\darknet\yolo_cpp_dll.sln</code>è§£å†³æ–¹æ¡ˆï¼Œç¼–è¯‘é€‰é¡¹é€‰<strong>X64</strong>å’Œ<strong>Release</strong>ï¼Œç„¶åæ‰§è¡ŒBuild-&gt;Build yolo_cpp_dllå°±ï¼Œç¼–è¯‘çš„ä¸€äº›å‰ç½®æ¡ä»¶ä¸ºï¼š</p>
<ul>
<li>å®‰è£…<strong>CUDA 10.0</strong>ã€‚</li>
<li>ä¸ºäº†ä½¿ç”¨cuDNNæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼šç‚¹å‡»å·¥ç¨‹å±æ€§-&gt;properties-&gt;C++-&gt;Preprocessor-&gt;Preprocessor Definitionsï¼Œç„¶ååœ¨å¼€å¤´æ·»åŠ ä¸€è¡Œ<code>CUDNN</code>ã€‚</li>
</ul>
</li>
<li><p>åœ¨è‡ªå·±çš„C++å·¥ç¨‹ä¸­å°†Yoloå½“æˆDLLæ–‡ä»¶ä½¿ç”¨ï¼šæ‰“å¼€<code>build\darknet\yolo_console_dll.sln</code>è§£å†³æ–¹æ¡ˆï¼Œç¼–è¯‘é€‰é¡¹é€‰<strong>X64</strong>å’Œ<strong>Release</strong>ï¼Œç„¶åæ‰§è¡ŒBuild-&gt;Build yolo_console_dllï¼š</p>
<p><code>yolo_cpp_dll.dll</code>-APIï¼š<code>https://github.com/AlexeyAB/darknet/blob/master/include/yolo_v2_class.hpp</code></p>
<ul>
<li>ä½ å¯ä»¥åˆ©ç”¨Windowsèµ„æºç®¡ç†å™¨è¿è¡Œ<code>build\darknet\x64\yolo_console_dll.exe</code>å¯æ‰§è¡Œç¨‹åºå¹¶<strong>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</strong>:  <code>yolo_console_dll.exe data/coco.names yolov3.cfg yolov3.weights test.mp4</code></li>
<li>å¯åŠ¨æ§åˆ¶å°åº”ç”¨ç¨‹åºå¹¶è¾“å…¥å›¾åƒæ–‡ä»¶ååï¼Œä½ å°†çœ‹åˆ°æ¯ä¸ªç›®æ ‡çš„ä¿¡æ¯ï¼š<code> </code></li>
<li>å¦‚æœè¦ä½¿ç”¨OpenCV-GUIä½ åº”è¯¥å°†<code>yolo_console_dll.cpp</code>ä¸­çš„<code>//#define OPENCV</code>å–æ¶ˆæ³¨é‡Šã€‚</li>
<li>ä½ å¯ä»¥çœ‹åˆ°è§†é¢‘æ£€æµ‹ä¾‹å­çš„æºä»£ç ï¼Œåœ°å€ä¸ºyolo_console_dll.cppçš„ç¬¬75è¡Œã€‚<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bbox_t</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> x, y, w, h;    <span class="comment">// (x,y) - top-left corner, (w, h) - width &amp; height of bounded box</span></span><br><span class="line">    <span class="keyword">float</span> prob;                    <span class="comment">// confidence - probability that the object was found correctly</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> obj_id;        <span class="comment">// class of object - from range [0, classes-1]</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> track_id;        <span class="comment">// tracking id for video (0 - untracked, 1 - inf - tracked object)</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> frames_counter;<span class="comment">// counter of frames on which the object was detected</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Detector</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Detector</span>(std::string cfg_filename, std::string weight_filename, <span class="keyword">int</span> gpu_id = <span class="number">0</span>);</span><br><span class="line">        ~<span class="built_in">Detector</span>();</span><br><span class="line"></span><br><span class="line">        <span class="function">std::vector&lt;<span class="keyword">bbox_t</span>&gt; <span class="title">detect</span><span class="params">(std::string image_filename, <span class="keyword">float</span> thresh = <span class="number">0.2</span>, <span class="keyword">bool</span> use_mean = <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="function">std::vector&lt;<span class="keyword">bbox_t</span>&gt; <span class="title">detect</span><span class="params">(<span class="keyword">image_t</span> img, <span class="keyword">float</span> thresh = <span class="number">0.2</span>, <span class="keyword">bool</span> use_mean = <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">image_t</span> <span class="title">load_image</span><span class="params">(std::string image_filename)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">free_image</span><span class="params">(<span class="keyword">image_t</span> m)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> OPENCV</span></span><br><span class="line">        <span class="function">std::vector&lt;<span class="keyword">bbox_t</span>&gt; <span class="title">detect</span><span class="params">(cv::Mat mat, <span class="keyword">float</span> thresh = <span class="number">0.2</span>, <span class="keyword">bool</span> use_mean = <span class="literal">false</span>)</span></span>;</span><br><span class="line">	<span class="function">std::shared_ptr&lt;<span class="keyword">image_t</span>&gt; <span class="title">mat_to_image_resize</span><span class="params">(cv::Mat mat)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ç›®æ ‡æ£€æµ‹</tag>
        <tag>YOLOv3</tag>
      </tags>
  </entry>
</search>
